<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1700470865350" as="style"/><link rel="stylesheet" href="styles.css?v=1700470865350"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://magazine.sebastianraschka.com/p/practical-tips-for-finetuning-llms">Practical Tips for Finetuning LLMs Using LoRA (Low-Rank Adaptation)</a>Â <span class="domain">(<a href="https://magazine.sebastianraschka.com">magazine.sebastianraschka.com</a>)</span></div><div class="subtext"><span>rasbt</span> | <span>22 comments</span></div><br/><div><div id="38340686" class="c"><input type="checkbox" id="c-38340686" checked=""/><div class="controls bullet"><span class="by">kromem</span><span>|</span><a href="#38340818">next</a><span>|</span><label class="collapse" for="c-38340686">[-]</label><label class="expand" for="c-38340686">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been increasingly wondering if the field considering LLMs as a continuum as opposed to a set of distinct thresholds is leading to erroneous &quot;rules of thumb&quot; as most research on methodology is concentrated in smaller and more accessible model experimentation right now.<p>We generally recognize (nearly ad nauseum) that mouse models of medical research don&#x27;t necessarily translate to humans.<p>Similarly, I&#x27;d imagine most would laugh at the idea that a neurology researcher who found the best way to get a fruit fly&#x27;s brain to navigate a maze should extrapolate that methodology to a dolphin or a chimp&#x27;s brain.<p>Maybe we should be defining &quot;weight classes&quot; for LLMs and grouping research based on those classes. Like &quot;these are the techniques that work best for lightweight models&quot; but not necessarily assuming those as a general rule of thumb for &quot;heavyweight models.&quot;<p>Even something like the discussion of synthetic data on model collapse is a good example of where there might be a very significant difference in the effect on model quality for a cheaper and less sophisticated model generating synthetic data to feed back into itself and a much more complex and sophisticated model. Maybe the lesson is actually &quot;recursive training on synthetic data leads to model collapse <i>in lightweight and medium weight models</i>.&quot;<p>So while the writeup is a great one on fine tuning 7B models with LoRA, I would be curious just what % of the recommendations hold true in replication for even just a 65B model.</div><br/><div id="38341392" class="c"><input type="checkbox" id="c-38341392" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#38340686">parent</a><span>|</span><a href="#38340818">next</a><span>|</span><label class="collapse" for="c-38341392">[-]</label><label class="expand" for="c-38341392">[2 more]</label></div><br/><div class="children"><div class="content">&gt; research on methodology is concentrated in smaller and more accessible model experimentation<p>Lets pull out a part of the article: &quot;Note that my experiments also included two arithmetic benchmarks (they are included in my other more technical write-up), on which LoRA-finetuned models performed significantly worse than the pretrained base models. My hypothesis is that the model unlearned arithmetic because the Alpaca dataset did not contain corresponding examples. Whether the model completely lost the knowledge or whether it&#x27;s because the model can&#x27;t handle the instructions anymore would require further investigation. However, a takeaway here is that it&#x27;s probably a good idea to include examples of each task you care about when finetuning LLMs.&quot;<p>The llm for your average customer service bot isn&#x27;t going to have a lot of need for arithmetic, or an ability to code! Can we get smaller models without math, or take a big model and prune that section, or better yet tell it &quot;see Wolfram alpha&quot; ...<p>Stuff like this is how we go from PhD projects that are black boxes to, opaque systems that engineers can beat on till they are clear and well understood.</div><br/><div id="38342011" class="c"><input type="checkbox" id="c-38342011" checked=""/><div class="controls bullet"><span class="by">kromem</span><span>|</span><a href="#38340686">root</a><span>|</span><a href="#38341392">parent</a><span>|</span><a href="#38340818">next</a><span>|</span><label class="collapse" for="c-38342011">[-]</label><label class="expand" for="c-38342011">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not saying that smaller model task specialization is a bad thing. If anything the research kicked off with Orca into using more complex models to jumpstart fine tuning of much smaller models is probably my pick for the most important ML research trend of 2023.<p>But even in the example you bring up and your comments on it, I&#x27;d strongly recommend considering Goodhart&#x27;s Law - turning a handful of measurements into the target by which we are throwing other things away to improve model scores on those measurements doesn&#x27;t necessarily represent a path to best in class production feasibility.<p>I can imagine a number of edge cases where a customer service bot not having basic math capabilities could lead to issues (&quot;Did the package come with at least 4 screws?&quot; &quot;It only had three&quot; &quot;Ok, great - I don&#x27;t see any issues with the shipment and am denying the return request&quot;).<p>Further, many qualities which probably <i>do</i> matter for applications like customer service, like patience, empathy, or de-escalation - don&#x27;t happen to be parts of the measurements <i>any</i> LLMs are being optimized to hit (even though they are almost certainly represented at least in part in the pretrained models given the presence in the data).<p>We&#x27;ve become a bit too focused on optimizing LLMs around measurements reflecting our anchoring biases of what AI should look like as imagined decades ago rather than evaluating the starting point and use cases as they actually occur as we might for a tool by any other name.<p>Though this is all an entirely different issue from whether different model sizes require their own best practices.</div><br/></div></div></div></div></div></div><div id="38340818" class="c"><input type="checkbox" id="c-38340818" checked=""/><div class="controls bullet"><span class="by">nl</span><span>|</span><a href="#38340686">prev</a><span>|</span><a href="#38341025">next</a><span>|</span><label class="collapse" for="c-38340818">[-]</label><label class="expand" for="c-38340818">[2 more]</label></div><br/><div class="children"><div class="content">This is an exceptionally useful article. A few highlights:<p>* QLoRA works really well compared to LoRA if you need to save memory (at the cost of time)<p>* For small LoRAs, Adam has almost no memory usage penalty compared to SGD<p>* Multiple training epochs lower performance (!). To quote: &quot;This performance decline is likely due to increased overfitting, which warrants additional investigation.&quot; (Note that this is LoRA overfitting, and unclear which layers it was enabled for for this experiment).<p>* The best results for alpha and r parameters in LoRA seems to be alpha = 2r.<p>* Better datasets are much better. 1k LIMA gives better results than 50k Alpaca</div><br/><div id="38343518" class="c"><input type="checkbox" id="c-38343518" checked=""/><div class="controls bullet"><span class="by">3abiton</span><span>|</span><a href="#38340818">parent</a><span>|</span><a href="#38341025">next</a><span>|</span><label class="collapse" for="c-38343518">[-]</label><label class="expand" for="c-38343518">[1 more]</label></div><br/><div class="children"><div class="content">I wish there is a benchmark comparing the impact of all the different tweaks on the performance of the model.</div><br/></div></div></div></div><div id="38341025" class="c"><input type="checkbox" id="c-38341025" checked=""/><div class="controls bullet"><span class="by">Nevin1901</span><span>|</span><a href="#38340818">prev</a><span>|</span><a href="#38339990">next</a><span>|</span><label class="collapse" for="c-38341025">[-]</label><label class="expand" for="c-38341025">[3 more]</label></div><br/><div class="children"><div class="content">I fine tuned LLama-2 on code&#x2F;comment generation (in python) for around $2 and was able to run it natively on an m1 macbook air. I can totally see smaller fine tuned LLM&#x27;s being used locally on consumer devices in the future. I think people underestimate how cheap and efficient this stuff is.<p>I&#x27;ve actually built a service which lets you fine tune LLama-2&#x2F;other llms by uploading a JSON dataset. I&#x27;m looking for feedback, the link is <a href="https:&#x2F;&#x2F;useftn.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;useftn.com</a>.</div><br/><div id="38342752" class="c"><input type="checkbox" id="c-38342752" checked=""/><div class="controls bullet"><span class="by">xur17</span><span>|</span><a href="#38341025">parent</a><span>|</span><a href="#38342076">next</a><span>|</span><label class="collapse" for="c-38342752">[-]</label><label class="expand" for="c-38342752">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been playing with llama-2, and I&#x27;ve been pleasantly surprised with its ability to process images. So you plan to offer image inputs on your fine tuning service?</div><br/></div></div><div id="38342076" class="c"><input type="checkbox" id="c-38342076" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#38341025">parent</a><span>|</span><a href="#38342752">prev</a><span>|</span><a href="#38339990">next</a><span>|</span><label class="collapse" for="c-38342076">[-]</label><label class="expand" for="c-38342076">[1 more]</label></div><br/><div class="children"><div class="content">What is the cost for a useful run? $2.4&#x2F;Mb sounds good, but how many megabytes did you need for example to do your fine tuning to your satisfaction.</div><br/></div></div></div></div><div id="38339990" class="c"><input type="checkbox" id="c-38339990" checked=""/><div class="controls bullet"><span class="by">hkonsti</span><span>|</span><a href="#38341025">prev</a><span>|</span><a href="#38342238">next</a><span>|</span><label class="collapse" for="c-38339990">[-]</label><label class="expand" for="c-38339990">[2 more]</label></div><br/><div class="children"><div class="content">LoRA blew me away the first time I looked into it. Especially since you can host many LoRA adapters at once for a fraction of the cost of hosting an entire model by sharing the base between the adapters. I built a little tool to make LoRA fine-tuning easier. The adapters export to Huggingface. You can check it out here: <a href="https:&#x2F;&#x2F;app.haven.run">https:&#x2F;&#x2F;app.haven.run</a></div><br/><div id="38340698" class="c"><input type="checkbox" id="c-38340698" checked=""/><div class="controls bullet"><span class="by">Havoc</span><span>|</span><a href="#38339990">parent</a><span>|</span><a href="#38342238">next</a><span>|</span><label class="collapse" for="c-38340698">[-]</label><label class="expand" for="c-38340698">[1 more]</label></div><br/><div class="children"><div class="content">What software do you use for the lora sharing?</div><br/></div></div></div></div><div id="38342238" class="c"><input type="checkbox" id="c-38342238" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#38339990">prev</a><span>|</span><a href="#38339935">next</a><span>|</span><label class="collapse" for="c-38342238">[-]</label><label class="expand" for="c-38342238">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m still waiting for someone to publish a &quot;LoRA in ten steps&quot; document, with working code, aimed at impatient people like me.</div><br/><div id="38344844" class="c"><input type="checkbox" id="c-38344844" checked=""/><div class="controls bullet"><span class="by">ianpurton</span><span>|</span><a href="#38342238">parent</a><span>|</span><a href="#38339935">next</a><span>|</span><label class="collapse" for="c-38344844">[-]</label><label class="expand" for="c-38344844">[1 more]</label></div><br/><div class="children"><div class="content">Then put that in a docker container for people like me who are too impatient to read 10 step documents.</div><br/></div></div></div></div><div id="38339935" class="c"><input type="checkbox" id="c-38339935" checked=""/><div class="controls bullet"><span class="by">behnamoh</span><span>|</span><a href="#38342238">prev</a><span>|</span><a href="#38343813">next</a><span>|</span><label class="collapse" for="c-38339935">[-]</label><label class="expand" for="c-38339935">[8 more]</label></div><br/><div class="children"><div class="content">Ever since the author paywalled some of his useful posts, I stopped following him. I have read his ML book and I know he used to be a professor and is now working in the industry, and heâs quite famous in the field. Thatâs why I donât understand why such a figure would even need the extra income generated by Substackâs paywall.</div><br/><div id="38340014" class="c"><input type="checkbox" id="c-38340014" checked=""/><div class="controls bullet"><span class="by">p1esk</span><span>|</span><a href="#38339935">parent</a><span>|</span><a href="#38340047">next</a><span>|</span><label class="collapse" for="c-38340014">[-]</label><label class="expand" for="c-38340014">[5 more]</label></div><br/><div class="children"><div class="content">Thatâs a strange question. He wants to make money doing what he loves - teaching about AI. Whatâs wrong with that?</div><br/><div id="38340095" class="c"><input type="checkbox" id="c-38340095" checked=""/><div class="controls bullet"><span class="by">behnamoh</span><span>|</span><a href="#38339935">root</a><span>|</span><a href="#38340014">parent</a><span>|</span><a href="#38340047">next</a><span>|</span><label class="collapse" for="c-38340095">[-]</label><label class="expand" for="c-38340095">[4 more]</label></div><br/><div class="children"><div class="content">Nothing wrong with that. But it&#x27;s strange that such a person (who undoubtedly makes $$$) wants to make some more $Ã10^-n (n â¥1) by paywalling his articles.</div><br/><div id="38340435" class="c"><input type="checkbox" id="c-38340435" checked=""/><div class="controls bullet"><span class="by">PheonixPharts</span><span>|</span><a href="#38339935">root</a><span>|</span><a href="#38340095">parent</a><span>|</span><a href="#38342087">next</a><span>|</span><label class="collapse" for="c-38340435">[-]</label><label class="expand" for="c-38340435">[2 more]</label></div><br/><div class="children"><div class="content">&gt;  (who undoubtedly makes $$$)<p>He worked at a public university until 2021, you can look up his salary as it&#x27;s public information: $118,472.99 [0], not as much as your average mid-level software engineer.<p>Now he works at a startup [1], but not as a c-level, so he&#x27;s likely making average startup software engineer salary (certainly more than a public university professor, but not exactly FIRE money).<p>It&#x27;s amazing how much people begrudge anyone wanting to make some money for the tremendous effort the put in to helping people better understand an important subject. Anyone working in software can easily afford to support his work if they find it valuable.<p>Generally, anyone &quot;famous&quot; for teaching a technical topic is typically doing it as a charity even if people are paying for their content.<p>0. <a href="https:&#x2F;&#x2F;madison.com&#x2F;uw-salary-database&#x2F;html_e37ff025-9a87-5a31-91ea-b2eb50aba4cb.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;madison.com&#x2F;uw-salary-database&#x2F;html_e37ff025-9a87-5a...</a>
1. <a href="https:&#x2F;&#x2F;sebastian.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;sebastian.com</a></div><br/><div id="38342258" class="c"><input type="checkbox" id="c-38342258" checked=""/><div class="controls bullet"><span class="by">ProtoAES256</span><span>|</span><a href="#38339935">root</a><span>|</span><a href="#38340435">parent</a><span>|</span><a href="#38342087">next</a><span>|</span><label class="collapse" for="c-38342258">[-]</label><label class="expand" for="c-38342258">[1 more]</label></div><br/><div class="children"><div class="content">I second to this too!<p>People paid for hundred upon hundreds of dollars just to access a course, but not willing to give for an article that provided the same stuff to you, for your own time and pace, while charging only a tiny fraction of the course? 
Beats me...</div><br/></div></div></div></div><div id="38342087" class="c"><input type="checkbox" id="c-38342087" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#38339935">root</a><span>|</span><a href="#38340095">parent</a><span>|</span><a href="#38340435">prev</a><span>|</span><a href="#38340047">next</a><span>|</span><label class="collapse" for="c-38342087">[-]</label><label class="expand" for="c-38342087">[1 more]</label></div><br/><div class="children"><div class="content">If you pay you can help make n smaller!</div><br/></div></div></div></div></div></div><div id="38340047" class="c"><input type="checkbox" id="c-38340047" checked=""/><div class="controls bullet"><span class="by">tomp</span><span>|</span><a href="#38339935">parent</a><span>|</span><a href="#38340014">prev</a><span>|</span><a href="#38343813">next</a><span>|</span><label class="collapse" for="c-38340047">[-]</label><label class="expand" for="c-38340047">[2 more]</label></div><br/><div class="children"><div class="content">looks like this one isn&#x27;t paywalled (for me at least)</div><br/><div id="38340075" class="c"><input type="checkbox" id="c-38340075" checked=""/><div class="controls bullet"><span class="by">behnamoh</span><span>|</span><a href="#38339935">root</a><span>|</span><a href="#38340047">parent</a><span>|</span><a href="#38343813">next</a><span>|</span><label class="collapse" for="c-38340075">[-]</label><label class="expand" for="c-38340075">[1 more]</label></div><br/><div class="children"><div class="content">This isn&#x27;t, but some other articles are.</div><br/></div></div></div></div></div></div><div id="38343813" class="c"><input type="checkbox" id="c-38343813" checked=""/><div class="controls bullet"><span class="by">xgbzvzj</span><span>|</span><a href="#38339935">prev</a><span>|</span><label class="collapse" for="c-38343813">[-]</label><label class="expand" for="c-38343813">[1 more]</label></div><br/><div class="children"><div class="content">à¤¶à¤à¤¹à¤¸
à¤¹à¥à¤·à¤¬
à¤¡à¥à¤¬à¥à¤à¤¨à¤à¤¸</div><br/></div></div></div></div></div></div></div></body></html>