<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1732784458451" as="style"/><link rel="stylesheet" href="styles.css?v=1732784458451"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://proot-me.github.io/">PRoot: User-space implementation of chroot, mount –bind, and binfmt_misc</a> <span class="domain">(<a href="https://proot-me.github.io">proot-me.github.io</a>)</span></div><div class="subtext"><span>nateb2022</span> | <span>12 comments</span></div><br/><div><div id="42263534" class="c"><input type="checkbox" id="c-42263534" checked=""/><div class="controls bullet"><span class="by">albertzeyer</span><span>|</span><a href="#42263133">next</a><span>|</span><label class="collapse" for="c-42263534">[-]</label><label class="expand" for="c-42263534">[1 more]</label></div><br/><div class="children"><div class="content">A similar tool for this user-space bind-mount is <a href="https:&#x2F;&#x2F;github.com&#x2F;fritzw&#x2F;ld-preload-open">https:&#x2F;&#x2F;github.com&#x2F;fritzw&#x2F;ld-preload-open</a>, which relies on LD_PRELOAD to overwrite common libc functions. Thus this is less reliable as the presented tool which uses ptrace, but it still works reasonably well (I run e.g. PyCharm with it).</div><br/></div></div><div id="42263133" class="c"><input type="checkbox" id="c-42263133" checked=""/><div class="controls bullet"><span class="by">CaliforniaKarl</span><span>|</span><a href="#42263534">prev</a><span>|</span><a href="#42263217">next</a><span>|</span><label class="collapse" for="c-42263133">[-]</label><label class="expand" for="c-42263133">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s an example of how we&#x27;ve used this.<p>RStudio Server[0] 1.3 and older hard-coded a number of paths, such as the path for storing temporary files: Instead of looking for the TMPDIR environment variable (as specified by POSIX[1]), R Studio Server would always use &#x2F;tmp.  That is extremely annoying, because we set TMPDIR to a path on fast local storage (SATA or NVMe SSDs) that the job scheduler cleans up at the end of the compute job.<p>We do have a last-resort mechanism using pam_namespace[2], such that a user going to `&#x2F;tmp` actually takes them to `&#x2F;namespace&#x2F;tmp&#x2F;${username}`, but that is per-user, not per-job.  If a user has two R Studio jobs, and those two jobs landed on the same host, there would be trouble.<p>So, we used PRoot to wrap R Studio, with &#x2F;tmp bind-mounted to a directory under TMPDIR.<p>[0]: <a href="https:&#x2F;&#x2F;www.rstudio.com&#x2F;products&#x2F;rstudio&#x2F;download-server&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.rstudio.com&#x2F;products&#x2F;rstudio&#x2F;download-server&#x2F;</a><p>[1]: <a href="https:&#x2F;&#x2F;pubs.opengroup.org&#x2F;onlinepubs&#x2F;9699919799&#x2F;basedefs&#x2F;V1_chap08.html" rel="nofollow">https:&#x2F;&#x2F;pubs.opengroup.org&#x2F;onlinepubs&#x2F;9699919799&#x2F;basedefs&#x2F;V1...</a><p>[2]: <a href="https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;8&#x2F;pam_namespace" rel="nofollow">https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;8&#x2F;pam_namespace</a></div><br/></div></div><div id="42263217" class="c"><input type="checkbox" id="c-42263217" checked=""/><div class="controls bullet"><span class="by">hks0</span><span>|</span><a href="#42263133">prev</a><span>|</span><a href="#42262799">next</a><span>|</span><label class="collapse" for="c-42263217">[-]</label><label class="expand" for="c-42263217">[3 more]</label></div><br/><div class="children"><div class="content">Termux has now a nice wrapper (manager?) for proot [1]. I once wanted to submit a wrapper but got an angry response as the first comment to my PR and it was closed. Guess enough people did that until they decided maybe it&#x27;s not a bad idea after all.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;termux&#x2F;proot-distro">https:&#x2F;&#x2F;github.com&#x2F;termux&#x2F;proot-distro</a></div><br/><div id="42263251" class="c"><input type="checkbox" id="c-42263251" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#42263217">parent</a><span>|</span><a href="#42262799">next</a><span>|</span><label class="collapse" for="c-42263251">[-]</label><label class="expand" for="c-42263251">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I once wanted to submit a wrapper but got an angry response as the first comment to my PR and it was closed.<p>I don&#x27;t follow; you made a PR to add this functionality to proot itself?</div><br/><div id="42263293" class="c"><input type="checkbox" id="c-42263293" checked=""/><div class="controls bullet"><span class="by">hks0</span><span>|</span><a href="#42263217">root</a><span>|</span><a href="#42263251">parent</a><span>|</span><a href="#42262799">next</a><span>|</span><label class="collapse" for="c-42263293">[-]</label><label class="expand" for="c-42263293">[1 more]</label></div><br/><div class="children"><div class="content">Ah no, sorry I was so lost in my thoughts and explained badly.<p>I was taking in the context of Termux app for Android, nothing to do with proot itself. Termux uses apt and deb repos, and provides a patched proot. I wanted to add a package similar to one I linked.</div><br/></div></div></div></div></div></div><div id="42262799" class="c"><input type="checkbox" id="c-42262799" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#42263217">prev</a><span>|</span><a href="#42262696">next</a><span>|</span><label class="collapse" for="c-42262799">[-]</label><label class="expand" for="c-42262799">[2 more]</label></div><br/><div class="children"><div class="content">Unless I am mistaken this cannot elide over the fundamental protections Android enforce which make it impossible to do cross-device symlinks to external SD cards in a non-rooted Android: the outer kernel blocks this, even though you can cd into the paths.<p>If (for example) you can overlay&#x2F;union mount and have a synthetic upper layer FS which manages things, I could use this.</div><br/><div id="42263261" class="c"><input type="checkbox" id="c-42263261" checked=""/><div class="controls bullet"><span class="by">hks0</span><span>|</span><a href="#42262799">parent</a><span>|</span><a href="#42262696">next</a><span>|</span><label class="collapse" for="c-42263261">[-]</label><label class="expand" for="c-42263261">[1 more]</label></div><br/><div class="children"><div class="content">proot works by hijacking and altering syscalls. So maybe you could emulate the symlink yourself, by altering the file paths at ptrace level?<p>Thinking more, maybe it works out of the box? Just mount the overlays (there&#x27;s a cli flag IIRC) and proot takes care of syscalls by definition.</div><br/></div></div></div></div><div id="42262696" class="c"><input type="checkbox" id="c-42262696" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#42262799">prev</a><span>|</span><label class="collapse" for="c-42262696">[-]</label><label class="expand" for="c-42262696">[4 more]</label></div><br/><div class="children"><div class="content">Ah! Finally I see a way to try nix (the package manager) on my existing installation without it requiring access to the root directory and other such stuff!</div><br/><div id="42262710" class="c"><input type="checkbox" id="c-42262710" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#42262696">parent</a><span>|</span><label class="collapse" for="c-42262710">[-]</label><label class="expand" for="c-42262710">[3 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;nixos.wiki&#x2F;wiki&#x2F;Nix_Installation_Guide" rel="nofollow">https:&#x2F;&#x2F;nixos.wiki&#x2F;wiki&#x2F;Nix_Installation_Guide</a> discusses that a bit more (also other solutions)</div><br/><div id="42263014" class="c"><input type="checkbox" id="c-42263014" checked=""/><div class="controls bullet"><span class="by">lostmsu</span><span>|</span><a href="#42262696">root</a><span>|</span><a href="#42262710">parent</a><span>|</span><label class="collapse" for="c-42263014">[-]</label><label class="expand" for="c-42263014">[2 more]</label></div><br/><div class="children"><div class="content">Unrelated, but does anyone know what&#x27;s the deal between wiki.nixos.org and nixos.wiki? The former appears to be actually functional, but the latter ranks much higher in search engines and seems to be incorrectly treated by them as the primary source.</div><br/><div id="42263041" class="c"><input type="checkbox" id="c-42263041" checked=""/><div class="controls bullet"><span class="by">Reventlov</span><span>|</span><a href="#42262696">root</a><span>|</span><a href="#42263014">parent</a><span>|</span><label class="collapse" for="c-42263041">[-]</label><label class="expand" for="c-42263041">[1 more]</label></div><br/><div class="children"><div class="content">Because nixos.wiki was the primary source, until very recently. Then, wiki.nixos.org was introduced, and mass edits were made (without the owner of nixos.wiki being ok with that) trying to redirect people from nixos.wiki to wiki.nixos.org, and now both co-exist.<p>Reminds me a bit the archlinux.fr vs wiki.archlinux.org fr wiki situation from 10 years ago.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>