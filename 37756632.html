<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696410064615" as="style"/><link rel="stylesheet" href="styles.css?v=1696410064615"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://georgek.github.io/blog/posts/multiple-web-projects-traefik/">Working on Multiple Web Projects with Docker Compose and Traefik</a> <span class="domain">(<a href="https://georgek.github.io">georgek.github.io</a>)</span></div><div class="subtext"><span>globular-toast</span> | <span>50 comments</span></div><br/><div><div id="37757984" class="c"><input type="checkbox" id="c-37757984" checked=""/><div class="controls bullet"><span class="by">nickjj</span><span>|</span><a href="#37761674">next</a><span>|</span><label class="collapse" for="c-37757984">[-]</label><label class="expand" for="c-37757984">[3 more]</label></div><br/><div class="children"><div class="content">The article mentions:<p><i>&gt; What if that compose.yaml file is checked in as part of the project? Does the whole team have to agree on a set of port numbers to use for each project?</i><p>That&#x27;s only if you choose to use hard coded values. You can use environment variables instead.<p>You can change `- &quot;8000:80&quot;` to `- &quot;${DOCKER_WEB_PORT_FORWARD:-127.0.0.1:8000}:${PORT:-80}&quot;` and now any developer can customize the forwarded port however they see fit in a git ignored `.env` file. This is what I&#x27;ve done in all of my example Docker web apps at: <a href="https:&#x2F;&#x2F;github.com&#x2F;nickjj?tab=repositories&amp;q=docker-*-example">https:&#x2F;&#x2F;github.com&#x2F;nickjj?tab=repositories&amp;q=docker-*-exampl...</a><p>No Traefik or override file is needed, at least not for allowing a user to customize the forwarded port.<p>I like the override file and used it for years but I stopped using it entirely about 6 months ago. It&#x27;s too much of a headache to commit a `docker-compose.override.yml.example` file to version control and then have folks copy that to a git ignored `docker-compose.override.yml` file. You end up with serious config drift, especially if you have a team with a few developers. It&#x27;s been a source of so many &quot;oh yeah, I forgot to update my real file&quot; type of issues.<p>Between environment variables and Docker Compose profiles[0] you can have a single committed `docker-compose.yml` file that is usable in all environments for all users.<p>[0]: <a href="https:&#x2F;&#x2F;nickjanetakis.com&#x2F;blog&#x2F;docker-tip-94-docker-compose-v2-and-profiles-are-the-best-thing-ever" rel="nofollow noreferrer">https:&#x2F;&#x2F;nickjanetakis.com&#x2F;blog&#x2F;docker-tip-94-docker-compose-...</a></div><br/><div id="37761153" class="c"><input type="checkbox" id="c-37761153" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#37757984">parent</a><span>|</span><a href="#37761241">next</a><span>|</span><label class="collapse" for="c-37761153">[-]</label><label class="expand" for="c-37761153">[1 more]</label></div><br/><div class="children"><div class="content">Note that it is no longer called docker-compose.yml, now they are just called compose.yml and compose.override.yml.
Another worthy mention are profiles. You can have a dev profile in there that is configurable with environment variables.</div><br/></div></div><div id="37761241" class="c"><input type="checkbox" id="c-37761241" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#37757984">parent</a><span>|</span><a href="#37761153">prev</a><span>|</span><a href="#37761674">next</a><span>|</span><label class="collapse" for="c-37761241">[-]</label><label class="expand" for="c-37761241">[1 more]</label></div><br/><div class="children"><div class="content">By using the !reset tag I&#x27;ve tried to make use of the override file completely optional and therefore no example override file is needed.<p>I did also consider using environment variables instead of the override file. It&#x27;s not a bad idea and perhaps gets around some of the limitations with !reset.<p>I still think using traefik to get names instead of a load of different port numbers is cool, though, especially if you want to share these links with others on your network. For that I think you would need the override file, or you could just commit the labels to the main file as they wouldn&#x27;t cause any harm, but then you&#x27;ve you a load of noise that people might not care about (and what if they have their own label based tool of choice?)<p>Thanks for the link to your work, it looks very useful.</div><br/></div></div></div></div><div id="37761674" class="c"><input type="checkbox" id="c-37761674" checked=""/><div class="controls bullet"><span class="by">hknmtt</span><span>|</span><a href="#37757984">prev</a><span>|</span><a href="#37761954">next</a><span>|</span><label class="collapse" for="c-37761674">[-]</label><label class="expand" for="c-37761674">[3 more]</label></div><br/><div class="children"><div class="content">I am presently developing a project that runs five back-end servers and two front-end servers. I ended up solving the same issues of ports with traefik, like the author. But it must be said that traefik&#x27;s configuration is a nightmare to get working as you need it to. Also ssl certificates are still humongous pain in the ass to get going on local machine even in 2023. And you cannot ignore them on local because of those retarded CORS that only bring pain and suffering to the developers and literally nothing to the consumer.<p>I do not use docker compose because each server is in active development so I cannot compile it into an image and I have to spin them all up manually. But I will use docker compose after i am done for front-end developers so they can keep developing the UI locally.</div><br/><div id="37762389" class="c"><input type="checkbox" id="c-37762389" checked=""/><div class="controls bullet"><span class="by">throwaway6835-8</span><span>|</span><a href="#37761674">parent</a><span>|</span><a href="#37761827">next</a><span>|</span><label class="collapse" for="c-37762389">[-]</label><label class="expand" for="c-37762389">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I do not use docker compose because each server is in active development so I cannot compile it into an image<p>That&#x27;s something I&#x27;ve seen many times said by many people but I don&#x27;t understand. Your code can be mounted from the host into the container. There&#x27;s no need to rebuild images with each change. Inside such &quot;development&quot; container some form of watcher&#x2F;auto-rebuild can run and recompile &amp; restart your program after changes are made in code. Isn&#x27;t it standard practice?</div><br/></div></div><div id="37761827" class="c"><input type="checkbox" id="c-37761827" checked=""/><div class="controls bullet"><span class="by">nikita2206</span><span>|</span><a href="#37761674">parent</a><span>|</span><a href="#37762389">prev</a><span>|</span><a href="#37761954">next</a><span>|</span><label class="collapse" for="c-37761827">[-]</label><label class="expand" for="c-37761827">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I do not use docker compose because each server is in active development so I cannot compile it into an image<p>I’m curious to know, are you actively developing all 5+2 codebases, or could you theoretically run half of them in docker and another half (the ones you’re actively changing) on the host?</div><br/></div></div></div></div><div id="37761954" class="c"><input type="checkbox" id="c-37761954" checked=""/><div class="controls bullet"><span class="by">knallfrosch</span><span>|</span><a href="#37761674">prev</a><span>|</span><a href="#37757741">next</a><span>|</span><label class="collapse" for="c-37761954">[-]</label><label class="expand" for="c-37761954">[1 more]</label></div><br/><div class="children"><div class="content">Looks like we&#x27;re all solving the same problems. I&#x27;ve used jwilder&#x2F;nginx-proxy for the same purpose.<p>Letsencrypt certificates, reverse proxy and all this stuff. Took a bit, but at the end of the day, I&#x27;d only have to specify &quot;testing.example.org&quot; in the docker-compose, docker-compose up and everything would be routed correctly. I could check out a different branch and bring up &quot;staging.example.org&quot; within 10 seconds. Sadly, it only worked at home, where this real domain would be hooked up to my private router.<p>Then, however, it was 10 times better than port routing, localhost development certificates and all the other stuff you need to have just to test something that uses the camera on the mobile device.</div><br/></div></div><div id="37757741" class="c"><input type="checkbox" id="c-37757741" checked=""/><div class="controls bullet"><span class="by">theK</span><span>|</span><a href="#37761954">prev</a><span>|</span><a href="#37761932">next</a><span>|</span><label class="collapse" for="c-37757741">[-]</label><label class="expand" for="c-37757741">[6 more]</label></div><br/><div class="children"><div class="content">Seriously, don&#x27;t put traefik in front of your localdev if.you don&#x27;t explicitly have to. It is way too much complexity and introduces an added layer of noise to bedug.<p>Also, does local host subdomain resolution work on all OSes OOB now? Iirc this was an apple exclusive feature in the past.</div><br/><div id="37758642" class="c"><input type="checkbox" id="c-37758642" checked=""/><div class="controls bullet"><span class="by">CGamesPlay</span><span>|</span><a href="#37757741">parent</a><span>|</span><a href="#37757978">next</a><span>|</span><label class="collapse" for="c-37758642">[-]</label><label class="expand" for="c-37758642">[3 more]</label></div><br/><div class="children"><div class="content">Note that the article uses <a href="http:&#x2F;&#x2F;traefik.me&#x2F;" rel="nofollow noreferrer">http:&#x2F;&#x2F;traefik.me&#x2F;</a>, one of those sites that resolves all subdomains to localhost (like lvh.me, <a href="http:&#x2F;&#x2F;readme.localtest.me&#x2F;" rel="nofollow noreferrer">http:&#x2F;&#x2F;readme.localtest.me&#x2F;</a>, or <a href="http:&#x2F;&#x2F;local.gd&#x2F;" rel="nofollow noreferrer">http:&#x2F;&#x2F;local.gd&#x2F;</a>), so you don&#x27;t need any &quot;localhost subdomain resolution&quot;.</div><br/><div id="37759109" class="c"><input type="checkbox" id="c-37759109" checked=""/><div class="controls bullet"><span class="by">benatkin</span><span>|</span><a href="#37757741">root</a><span>|</span><a href="#37758642">parent</a><span>|</span><a href="#37757978">next</a><span>|</span><label class="collapse" for="c-37759109">[-]</label><label class="expand" for="c-37759109">[2 more]</label></div><br/><div class="children"><div class="content">I thought Let&#x27;s Encrypt wouldn&#x27;t allow SSL certificates with public private keys. It defeats the purpose.<p>Edit: indeed, it says this:<p>&gt; You warrant to ISRG and the public-at-large that You have taken, and You agree that at all times You will take, all appropriate, reasonable, and necessary steps to assure control of, secure, properly protect, and keep secret and confidential the Private Key corresponding to the Public Key in Your Certificate (and any associated activation data or device, e.g. password or token).<p><a href="https:&#x2F;&#x2F;letsencrypt.org&#x2F;documents&#x2F;LE-SA-v1.3-September-21-2022.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;letsencrypt.org&#x2F;documents&#x2F;LE-SA-v1.3-September-21-20...</a> via <a href="https:&#x2F;&#x2F;letsencrypt.org&#x2F;repository&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;letsencrypt.org&#x2F;repository&#x2F;</a></div><br/><div id="37762317" class="c"><input type="checkbox" id="c-37762317" checked=""/><div class="controls bullet"><span class="by">tinco</span><span>|</span><a href="#37757741">root</a><span>|</span><a href="#37759109">parent</a><span>|</span><a href="#37757978">next</a><span>|</span><label class="collapse" for="c-37762317">[-]</label><label class="expand" for="c-37762317">[1 more]</label></div><br/><div class="children"><div class="content">If you click what looks like the link to the privkey it shows a warning encouraging you to not revoke the key with LetsEncrypt. I suppose a *.traefik.me is as untrustworthy as any other you don&#x27;t the owner of, so it doesn&#x27;t really matter that anyone can sign a key for it, anyone can already get a key for any untrustworthy domain name they could come up with via letsencrypt.<p>So it&#x27;s probably only a problem for people who use traefik.me, they might be tricked into thinking they&#x27;re visiting their own locally hosted site, and instead might be man-in-the-middled. Though that&#x27;s a fairly specific attack coming from an APT or as a means to escalation from someone who already gained access through other means.</div><br/></div></div></div></div></div></div><div id="37757978" class="c"><input type="checkbox" id="c-37757978" checked=""/><div class="controls bullet"><span class="by">folmar</span><span>|</span><a href="#37757741">parent</a><span>|</span><a href="#37758642">prev</a><span>|</span><a href="#37760772">next</a><span>|</span><label class="collapse" for="c-37757978">[-]</label><label class="expand" for="c-37757978">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  local host subdomain resolution<p>Works fine on current ubuntu, both with systemd stub-nameserver and even if I replace it with a real one in &#x2F;etc&#x2F;resolv.conf.</div><br/></div></div><div id="37760772" class="c"><input type="checkbox" id="c-37760772" checked=""/><div class="controls bullet"><span class="by">papruapap</span><span>|</span><a href="#37757741">parent</a><span>|</span><a href="#37757978">prev</a><span>|</span><a href="#37761932">next</a><span>|</span><label class="collapse" for="c-37760772">[-]</label><label class="expand" for="c-37760772">[1 more]</label></div><br/><div class="children"><div class="content">I normally use nginx and works just fine tbh, easiest way to emulate an ingress service imo (I deploy to k8s afterwards).</div><br/></div></div></div></div><div id="37761932" class="c"><input type="checkbox" id="c-37761932" checked=""/><div class="controls bullet"><span class="by">ripperdoc</span><span>|</span><a href="#37757741">prev</a><span>|</span><a href="#37757759">next</a><span>|</span><label class="collapse" for="c-37761932">[-]</label><label class="expand" for="c-37761932">[3 more]</label></div><br/><div class="children"><div class="content">I use Nginx as reverse proxy, and each service runs on the same internal port. There is a way to configure Nginx natively to dynamically route to the container with the same name. If I need multiple services up locally for development, I bring up Nginx there too, and each service is mapped to a domain that ends with .test, which I have added to local DNS (in my case &#x2F;etc&#x2F;hosts ). I find that it&#x27;s anyway better to run development with reverse proxy to find errors that otherwise only would appear in prod.<p>The main thing I want to improve is to not use one big compose file for all services, as it would be cleaner to have one per service and just deploy them to the same network. But I haven&#x27;t figured the best way to auto-deploy each service&#x27;s compose file to the server (as the current auto-deploy only updates container images).</div><br/><div id="37762352" class="c"><input type="checkbox" id="c-37762352" checked=""/><div class="controls bullet"><span class="by">edulix</span><span>|</span><a href="#37761932">parent</a><span>|</span><a href="#37757759">next</a><span>|</span><label class="collapse" for="c-37762352">[-]</label><label class="expand" for="c-37762352">[2 more]</label></div><br/><div class="children"><div class="content">Can you please elaborate on how to &quot;dynamically route to the container with the same name&quot; with nginx?</div><br/><div id="37762616" class="c"><input type="checkbox" id="c-37762616" checked=""/><div class="controls bullet"><span class="by">ripperdoc</span><span>|</span><a href="#37761932">root</a><span>|</span><a href="#37762352">parent</a><span>|</span><a href="#37757759">next</a><span>|</span><label class="collapse" for="c-37762616">[-]</label><label class="expand" for="c-37762616">[1 more]</label></div><br/><div class="children"><div class="content">Something like this:<p><pre><code>  location ~ ^&#x2F;([a-z0-9_-]+)&#x2F;  {
    proxy_pass http:&#x2F;&#x2F;internal-$1:8000;
  }
</code></pre>
We pickup the service name from the URL and use it to select where to proxy_pass to. So &#x2F;service1 would route to the docker container named internal-service1 . We can reach it via the name only as long as Nginx is also running in Docker and on the same network.</div><br/></div></div></div></div></div></div><div id="37757759" class="c"><input type="checkbox" id="c-37757759" checked=""/><div class="controls bullet"><span class="by">Jnr</span><span>|</span><a href="#37761932">prev</a><span>|</span><a href="#37757684">next</a><span>|</span><label class="collapse" for="c-37757759">[-]</label><label class="expand" for="c-37757759">[4 more]</label></div><br/><div class="children"><div class="content">I run some (20+) services using docker compose on my home server, and Traefik is great.<p>Cloudflare manages my domain and it allows Traefik to get letsencrypt certificates even for internal services not exposed to the outside world.<p>I also have multiple Traefik entrypoints for internal and external services. And cloudflared tunnel container set up to manage access to the public resources.<p>Then on the home router level I set&#x2F;override DNS entries for internal services so they would connect directly to Traefik, instead of going through Cloudflare.<p>Incredibly these Cloudflare services cost exactly 0$ for now.<p>But I do not use compose overrides, don&#x27;t really see the benefits.</div><br/><div id="37758057" class="c"><input type="checkbox" id="c-37758057" checked=""/><div class="controls bullet"><span class="by">slig</span><span>|</span><a href="#37757759">parent</a><span>|</span><a href="#37757878">next</a><span>|</span><label class="collapse" for="c-37758057">[-]</label><label class="expand" for="c-37758057">[2 more]</label></div><br/><div class="children"><div class="content">I thought that the Cloudflare tunnel was the very expensive pay-per-gb &quot;argo route&quot;. Really nice to know that they offer a simple and free reverse proxy, thanks!</div><br/><div id="37760490" class="c"><input type="checkbox" id="c-37760490" checked=""/><div class="controls bullet"><span class="by">apitman</span><span>|</span><a href="#37757759">root</a><span>|</span><a href="#37758057">parent</a><span>|</span><a href="#37757878">next</a><span>|</span><label class="collapse" for="c-37760490">[-]</label><label class="expand" for="c-37760490">[1 more]</label></div><br/><div class="children"><div class="content">They made it free a couple years ago and rebranded as Cloudflare Tunnel. Currently an excellent free option though technically you&#x27;re not supposed to use it for anything other than basic HTML sites.</div><br/></div></div></div></div><div id="37757878" class="c"><input type="checkbox" id="c-37757878" checked=""/><div class="controls bullet"><span class="by">6LLvveMx2koXfwn</span><span>|</span><a href="#37757759">parent</a><span>|</span><a href="#37758057">prev</a><span>|</span><a href="#37757684">next</a><span>|</span><label class="collapse" for="c-37757878">[-]</label><label class="expand" for="c-37757878">[1 more]</label></div><br/><div class="children"><div class="content">As per the article I guess the benefit is specifically for managing compose files across teams through git.</div><br/></div></div></div></div><div id="37757684" class="c"><input type="checkbox" id="c-37757684" checked=""/><div class="controls bullet"><span class="by">teekert</span><span>|</span><a href="#37757759">prev</a><span>|</span><a href="#37758568">next</a><span>|</span><label class="collapse" for="c-37757684">[-]</label><label class="expand" for="c-37757684">[6 more]</label></div><br/><div class="children"><div class="content">I used traefik a lot, but man those labels get tedious. I still don’t get all the middleware stuff. I switched to using caddy, a caddyfile feels like a huge improvement. Much less lines for the same results. No routers no middleware just define a port mapping to the container:port.<p>If you go to a server you get https for free, no extra config.</div><br/><div id="37758539" class="c"><input type="checkbox" id="c-37758539" checked=""/><div class="controls bullet"><span class="by">patapong</span><span>|</span><a href="#37757684">parent</a><span>|</span><a href="#37761023">next</a><span>|</span><label class="collapse" for="c-37758539">[-]</label><label class="expand" for="c-37758539">[1 more]</label></div><br/><div class="children"><div class="content">I have had a great experience with using this: <a href="https:&#x2F;&#x2F;github.com&#x2F;lucaslorentz&#x2F;caddy-docker-proxy">https:&#x2F;&#x2F;github.com&#x2F;lucaslorentz&#x2F;caddy-docker-proxy</a><p>It combines caddy with docker-compose labels, making it super easy to spin up new projects that can immediately be exposed.</div><br/></div></div><div id="37761023" class="c"><input type="checkbox" id="c-37761023" checked=""/><div class="controls bullet"><span class="by">menacingly</span><span>|</span><a href="#37757684">parent</a><span>|</span><a href="#37758539">prev</a><span>|</span><a href="#37758488">next</a><span>|</span><label class="collapse" for="c-37761023">[-]</label><label class="expand" for="c-37761023">[1 more]</label></div><br/><div class="children"><div class="content">Same frustration. I just ended up writing a set of shorthand macros in my compose.yml labels, then have a little script that blows them up into whatever their associated long-winded traefik labels are in the compose.override.yml.<p>Most of the time, I just have to set the port from the container and a host, the rest gets expanded, but I have macros to add the tedious middleware lines</div><br/></div></div><div id="37758488" class="c"><input type="checkbox" id="c-37758488" checked=""/><div class="controls bullet"><span class="by">apt-get</span><span>|</span><a href="#37757684">parent</a><span>|</span><a href="#37761023">prev</a><span>|</span><a href="#37758038">next</a><span>|</span><label class="collapse" for="c-37758488">[-]</label><label class="expand" for="c-37758488">[1 more]</label></div><br/><div class="children"><div class="content">I personally use a file provider for the dynamic traefik configs (yaml files) loaded from a bind mount in the same folder I keep my compose. Auto-reload on changes, and it makes it clear what I&#x27;m routing to and from by having proper indentation for my router, service, and middleware fields. And since everything is in the same network, I can just define the container name as hostname -- the DNS entries are automatically created.</div><br/></div></div><div id="37758038" class="c"><input type="checkbox" id="c-37758038" checked=""/><div class="controls bullet"><span class="by">GabeIsko</span><span>|</span><a href="#37757684">parent</a><span>|</span><a href="#37758488">prev</a><span>|</span><a href="#37757809">next</a><span>|</span><label class="collapse" for="c-37758038">[-]</label><label class="expand" for="c-37758038">[1 more]</label></div><br/><div class="children"><div class="content">I do something similar, but even managing a separate configuration just for the reverse proxy gets tiring. I have plans to move to something kubernetes based and use an ingress controller to automatically set up everything based on a deployment chart, but I never get around to it...</div><br/></div></div><div id="37757809" class="c"><input type="checkbox" id="c-37757809" checked=""/><div class="controls bullet"><span class="by">Jnr</span><span>|</span><a href="#37757684">parent</a><span>|</span><a href="#37758038">prev</a><span>|</span><a href="#37758568">next</a><span>|</span><label class="collapse" for="c-37757809">[-]</label><label class="expand" for="c-37757809">[1 more]</label></div><br/><div class="children"><div class="content">Being able dynamically configure Traefik routes from docker compose labels is the whole point. It is a very useful feature. In most cases I get full overview in a single compose file, and I do not have to configure or restart the http proxy separately, `docker compose up -d` does everything.</div><br/></div></div></div></div><div id="37758568" class="c"><input type="checkbox" id="c-37758568" checked=""/><div class="controls bullet"><span class="by">CGamesPlay</span><span>|</span><a href="#37757684">prev</a><span>|</span><a href="#37761438">next</a><span>|</span><label class="collapse" for="c-37758568">[-]</label><label class="expand" for="c-37758568">[2 more]</label></div><br/><div class="children"><div class="content">You can set this up with even less customization. Here&#x27;s my snippet for doing so [0]. In this way, the default rule for all containers that are part of compose projects gets assigned a subdomain (service.compose-stack.lvh.me). Note that we also expose the traffic admin interface on `lvh.me`, which is perhaps a little more convenient than using `traefik.me`.<p>However, even with my tweaks, the overall solution is still limited. Because it&#x27;s not on &quot;localhost&quot;, the browser considers it an &quot;insecure context&quot; unless you also set up local HTTPS.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;CGamesPlay&#x2F;dotfiles&#x2F;blob&#x2F;13659d19ca899cea8b7afcfbdc26ad693fd7c006&#x2F;files&#x2F;.local&#x2F;bin&#x2F;.argc#L43">https:&#x2F;&#x2F;github.com&#x2F;CGamesPlay&#x2F;dotfiles&#x2F;blob&#x2F;13659d19ca899cea...</a></div><br/><div id="37761294" class="c"><input type="checkbox" id="c-37761294" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#37758568">parent</a><span>|</span><a href="#37761438">next</a><span>|</span><label class="collapse" for="c-37761294">[-]</label><label class="expand" for="c-37761294">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s really nice and combined with the environment variable solutions suggested by others could remove the need for the override file entirely. Also like the setting of a longer timeout which is suitable for dev.<p>In theory traefik.me can be set up with HTTPS but I haven&#x27;t tried it yet.</div><br/></div></div></div></div><div id="37761438" class="c"><input type="checkbox" id="c-37761438" checked=""/><div class="controls bullet"><span class="by">wdavidw</span><span>|</span><a href="#37758568">prev</a><span>|</span><a href="#37761587">next</a><span>|</span><label class="collapse" for="c-37761438">[-]</label><label class="expand" for="c-37761438">[1 more]</label></div><br/><div class="children"><div class="content">My work environment is now similar, using Traefik, Docker Compose and dnsmasq with easy to remember and customized fqdn such as api.myapp, www.myapp, db.myapp, … I had way too many servers to start for each project with ports to remember and creating conflict. The setup is described here: <a href="https:&#x2F;&#x2F;www.adaltas.com&#x2F;en&#x2F;2022&#x2F;11&#x2F;17&#x2F;traefik-docker-dnsmasq&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.adaltas.com&#x2F;en&#x2F;2022&#x2F;11&#x2F;17&#x2F;traefik-docker-dnsmasq...</a></div><br/></div></div><div id="37761587" class="c"><input type="checkbox" id="c-37761587" checked=""/><div class="controls bullet"><span class="by">karlshea</span><span>|</span><a href="#37761438">prev</a><span>|</span><a href="#37758191">next</a><span>|</span><label class="collapse" for="c-37761587">[-]</label><label class="expand" for="c-37761587">[1 more]</label></div><br/><div class="children"><div class="content">I use <a href="https:&#x2F;&#x2F;ddev.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;ddev.com</a> for almost all of my web project development, which basically automates all of this. Per-project databases, web containers, plugins, etc, and it’s now using Traefik as its router.</div><br/></div></div><div id="37758191" class="c"><input type="checkbox" id="c-37758191" checked=""/><div class="controls bullet"><span class="by">ravenstine</span><span>|</span><a href="#37761587">prev</a><span>|</span><a href="#37757178">next</a><span>|</span><label class="collapse" for="c-37758191">[-]</label><label class="expand" for="c-37758191">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using Yggdrasil to achieve something similar. Basically, my docker compose file includes a service for Yggdrasil that is configured to join the host Yggdrasil network listening at host.docker.internal. The service uses socat to forward ports from each of the other services. The end result is that each docker-compose.yml gets its own IPv6 address, and all the ports can be kept the same. No need for Let&#x27;s Encrypt, unless maybe you want the network to be exposed publicly.<p>It just so happens that I wrote a gist recently that explains how to do this.<p><a href="https:&#x2F;&#x2F;gist.github.com&#x2F;Ravenstine&#x2F;707180ef29e9d37a8f816e019ca32dbf#how-to-run-yggdrasil-in-docker" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;Ravenstine&#x2F;707180ef29e9d37a8f816e019...</a></div><br/></div></div><div id="37757178" class="c"><input type="checkbox" id="c-37757178" checked=""/><div class="controls bullet"><span class="by">theK</span><span>|</span><a href="#37758191">prev</a><span>|</span><a href="#37757230">next</a><span>|</span><label class="collapse" for="c-37757178">[-]</label><label class="expand" for="c-37757178">[6 more]</label></div><br/><div class="children"><div class="content">Compose overrides are quite cool but can get very involved.<p>An easier way is to make the port range dynamic by adding a prefix variable in .env&#x2F;example.env. So, once configured, the whole localdev binds to ports in the prefix range, eg: 342xx.<p>Experience shows that localdevs will need that env file anyway and adding this config step to the readme is quite effective.</div><br/><div id="37757405" class="c"><input type="checkbox" id="c-37757405" checked=""/><div class="controls bullet"><span class="by">dennisy</span><span>|</span><a href="#37757178">parent</a><span>|</span><a href="#37757230">next</a><span>|</span><label class="collapse" for="c-37757405">[-]</label><label class="expand" for="c-37757405">[5 more]</label></div><br/><div class="children"><div class="content">Could you elaborate a little more here please?</div><br/><div id="37757683" class="c"><input type="checkbox" id="c-37757683" checked=""/><div class="controls bullet"><span class="by">theK</span><span>|</span><a href="#37757178">root</a><span>|</span><a href="#37757405">parent</a><span>|</span><a href="#37757709">next</a><span>|</span><label class="collapse" for="c-37757683">[-]</label><label class="expand" for="c-37757683">[3 more]</label></div><br/><div class="children"><div class="content">Well, the idea is that your port mappings in the docker compose look roughly like this<p>```<p>ports:<p>- &quot;${PORT_PREFIX}01:80&quot;<p>```<p>This means that devs can drive the port range that the project bind to by editing their .env file.</div><br/><div id="37758312" class="c"><input type="checkbox" id="c-37758312" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#37757178">root</a><span>|</span><a href="#37757683">parent</a><span>|</span><a href="#37757709">next</a><span>|</span><label class="collapse" for="c-37758312">[-]</label><label class="expand" for="c-37758312">[2 more]</label></div><br/><div class="children"><div class="content">I like this a lot. It works well alongside setting the compose project name.<p>However I&#x27;d suggest at least specifying a default value so developers don&#x27;t need to mess with version-controlled .env files to customize their local setups.</div><br/><div id="37762262" class="c"><input type="checkbox" id="c-37762262" checked=""/><div class="controls bullet"><span class="by">theK</span><span>|</span><a href="#37757178">root</a><span>|</span><a href="#37758312">parent</a><span>|</span><a href="#37757709">next</a><span>|</span><label class="collapse" for="c-37762262">[-]</label><label class="expand" for="c-37762262">[1 more]</label></div><br/><div class="children"><div class="content">&gt; However I&#x27;d suggest at least specifying a default value so developers don&#x27;t need to mess with version-controlled .env<p>That&#x27;s a good point. Most of my projects tend to ship an `example.env` which documents each env var and introduces a sane default.<p>When introducing the principle to projects some times a dev will complain about config drift and the like but experience in practice shows that these files tend to change a bit when introduced and then rarely at all so it really is not that much of a deal.</div><br/></div></div></div></div></div></div><div id="37757709" class="c"><input type="checkbox" id="c-37757709" checked=""/><div class="controls bullet"><span class="by">melolife</span><span>|</span><a href="#37757178">root</a><span>|</span><a href="#37757405">parent</a><span>|</span><a href="#37757683">prev</a><span>|</span><a href="#37757230">next</a><span>|</span><label class="collapse" for="c-37757709">[-]</label><label class="expand" for="c-37757709">[1 more]</label></div><br/><div class="children"><div class="content">Edit: see TheK&#x27;s answer, which is virtually identical.</div><br/></div></div></div></div></div></div><div id="37757230" class="c"><input type="checkbox" id="c-37757230" checked=""/><div class="controls bullet"><span class="by">lux</span><span>|</span><a href="#37757178">prev</a><span>|</span><a href="#37758854">next</a><span>|</span><label class="collapse" for="c-37757230">[-]</label><label class="expand" for="c-37757230">[1 more]</label></div><br/><div class="children"><div class="content">This seems like an improvement over my current solution in that it can keep multiple projects open simultaneously and route to each of them, but does add more complexity to the setup.<p>I&#x27;m using Dnsmasq (<a href="https:&#x2F;&#x2F;thekelleys.org.uk&#x2F;dnsmasq&#x2F;doc.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;thekelleys.org.uk&#x2F;dnsmasq&#x2F;doc.html</a>) to map anything at .lo to the currently running project, like so:<p><pre><code>  brew install dnsmasq
  sh -c &#x27;echo &quot;address=&#x2F;.lo&#x2F;127.0.0.1\naddress=&#x2F;.lo&#x2F;::1\n&quot; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;dnsmasq.conf&#x27;
  sudo mkdir -p &#x2F;etc&#x2F;resolver
  sudo sh -c &#x27;echo &quot;nameserver 127.0.0.1\n&quot; &gt; &#x2F;etc&#x2F;resolver&#x2F;lo&#x27;
  sudo brew services start dnsmasq
</code></pre>
Would love to expand on that to route to specific projects, but since it&#x27;s working &quot;well enough&quot; I probably won&#x27;t touch that for the foreseeable future.</div><br/></div></div><div id="37758854" class="c"><input type="checkbox" id="c-37758854" checked=""/><div class="controls bullet"><span class="by">djbusby</span><span>|</span><a href="#37757230">prev</a><span>|</span><a href="#37759980">next</a><span>|</span><label class="collapse" for="c-37758854">[-]</label><label class="expand" for="c-37758854">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve got one compose that has like five web-services in it. And I had a heck of a time getting a config that allows each contained thing to see the others - and also be visible outside. For now I&#x27;m using fixed IPs in the compose to get it so it&#x27;s all visible. Now, the network can be overwrite via env but I wish I knew an easier way to get containers visible to outside and each other easier. Else, in the service I&#x27;d have to have two references to the other services: the internal name and external name.</div><br/><div id="37758928" class="c"><input type="checkbox" id="c-37758928" checked=""/><div class="controls bullet"><span class="by">idonttalkenough</span><span>|</span><a href="#37758854">parent</a><span>|</span><a href="#37758926">next</a><span>|</span><label class="collapse" for="c-37758928">[-]</label><label class="expand" for="c-37758928">[1 more]</label></div><br/><div class="children"><div class="content">&gt;And I had a heck of a time getting a config that allows each contained thing to see the others<p>Use a utility container to learn some of the network&#x2F;options of docker. The network-multitool[1] container is a good one I use.<p>So for example, create a few containers in a manifests&#x2F;compose file with different network settings and try pinging, telneting, etc from one container to another.<p>This container can also be used to help debug workload containers that are having connectivity issues. If you need more tooling just create an image with this container as a base.<p>[1]<a href="https:&#x2F;&#x2F;github.com&#x2F;wbitt&#x2F;Network-MultiTool">https:&#x2F;&#x2F;github.com&#x2F;wbitt&#x2F;Network-MultiTool</a></div><br/></div></div><div id="37758926" class="c"><input type="checkbox" id="c-37758926" checked=""/><div class="controls bullet"><span class="by">ponector</span><span>|</span><a href="#37758854">parent</a><span>|</span><a href="#37758928">prev</a><span>|</span><a href="#37759980">next</a><span>|</span><label class="collapse" for="c-37758926">[-]</label><label class="expand" for="c-37758926">[1 more]</label></div><br/><div class="children"><div class="content">I use extra_hosts parameter for this particular scenario</div><br/></div></div></div></div><div id="37759980" class="c"><input type="checkbox" id="c-37759980" checked=""/><div class="controls bullet"><span class="by">steviedotboston</span><span>|</span><a href="#37758854">prev</a><span>|</span><a href="#37760619">next</a><span>|</span><label class="collapse" for="c-37759980">[-]</label><label class="expand" for="c-37759980">[2 more]</label></div><br/><div class="children"><div class="content">A colleague of mine has a project that&#x27;s meant to simplify this stack for Drupal sites. But I think it could be repurposed for other platforms fairly easily.<p><a href="https:&#x2F;&#x2F;source.cknweb.it&#x2F;open&#x2F;shuttle" rel="nofollow noreferrer">https:&#x2F;&#x2F;source.cknweb.it&#x2F;open&#x2F;shuttle</a></div><br/><div id="37761558" class="c"><input type="checkbox" id="c-37761558" checked=""/><div class="controls bullet"><span class="by">dackerlunghack</span><span>|</span><a href="#37759980">parent</a><span>|</span><a href="#37760619">next</a><span>|</span><label class="collapse" for="c-37761558">[-]</label><label class="expand" for="c-37761558">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    For some reason the idea got new
    Still remember https:&#x2F;&#x2F;lando.dev&#x2F; ?</code></pre></div><br/></div></div></div></div><div id="37760619" class="c"><input type="checkbox" id="c-37760619" checked=""/><div class="controls bullet"><span class="by">theanonymousone</span><span>|</span><a href="#37759980">prev</a><span>|</span><a href="#37757853">next</a><span>|</span><label class="collapse" for="c-37760619">[-]</label><label class="expand" for="c-37760619">[1 more]</label></div><br/><div class="children"><div class="content">I believe this is the core of what Coolify[0] does.<p>[0] <a href="https:&#x2F;&#x2F;coolify.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;coolify.io&#x2F;</a></div><br/></div></div><div id="37757853" class="c"><input type="checkbox" id="c-37757853" checked=""/><div class="controls bullet"><span class="by">flurdy</span><span>|</span><a href="#37760619">prev</a><span>|</span><a href="#37757840">next</a><span>|</span><label class="collapse" for="c-37757853">[-]</label><label class="expand" for="c-37757853">[1 more]</label></div><br/><div class="children"><div class="content">If Traefik is not your thing Im happily using <a href="https:&#x2F;&#x2F;github.com&#x2F;nginx-proxy&#x2F;nginx-proxy">https:&#x2F;&#x2F;github.com&#x2F;nginx-proxy&#x2F;nginx-proxy</a> and sslip.io for local docker compose development.<p>And then even plain nginx under that to proxy to non docker services...<p>(And ipv6 for really short urls. example.com.--1.sslip.io etc)</div><br/></div></div><div id="37757840" class="c"><input type="checkbox" id="c-37757840" checked=""/><div class="controls bullet"><span class="by">creativenolo</span><span>|</span><a href="#37757853">prev</a><span>|</span><a href="#37760136">next</a><span>|</span><label class="collapse" for="c-37757840">[-]</label><label class="expand" for="c-37757840">[1 more]</label></div><br/><div class="children"><div class="content">Nit: the justification of the text on mobile makes this straining to read.<p>One source: <a href="https:&#x2F;&#x2F;www.powermapper.com&#x2F;products&#x2F;sortsite&#x2F;rules&#x2F;accwcag2-f88-1&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.powermapper.com&#x2F;products&#x2F;sortsite&#x2F;rules&#x2F;accwcag2...</a></div><br/></div></div><div id="37760136" class="c"><input type="checkbox" id="c-37760136" checked=""/><div class="controls bullet"><span class="by">NationOfJoe</span><span>|</span><a href="#37757840">prev</a><span>|</span><a href="#37759884">next</a><span>|</span><label class="collapse" for="c-37760136">[-]</label><label class="expand" for="c-37760136">[2 more]</label></div><br/><div class="children"><div class="content">at the agency i work at we have been using <a href="https:&#x2F;&#x2F;lando.dev" rel="nofollow noreferrer">https:&#x2F;&#x2F;lando.dev</a> for some time with a lot of success. It is an abstraction over docker which isn&#x27;t ideal but it allows us to quickly get going with projects and switch with no down time.</div><br/><div id="37761325" class="c"><input type="checkbox" id="c-37761325" checked=""/><div class="controls bullet"><span class="by">Kimitri</span><span>|</span><a href="#37760136">parent</a><span>|</span><a href="#37759884">next</a><span>|</span><label class="collapse" for="c-37761325">[-]</label><label class="expand" for="c-37761325">[1 more]</label></div><br/><div class="children"><div class="content">+1 for Lando. We used to rely on a bunch of shell scripts based on Docker4Drupal but it was such a PITA to maintain. Lando provides essentially the same customizability with a fraction of the hassle of our previous solution.</div><br/></div></div></div></div><div id="37759884" class="c"><input type="checkbox" id="c-37759884" checked=""/><div class="controls bullet"><span class="by">moron4hire</span><span>|</span><a href="#37760136">prev</a><span>|</span><label class="collapse" for="c-37759884">[-]</label><label class="expand" for="c-37759884">[1 more]</label></div><br/><div class="children"><div class="content">Uuuhm, what if you just bind to port 0, let the OS assign you a random port?</div><br/></div></div></div></div></div></div></div></body></html>