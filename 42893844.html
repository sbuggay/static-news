<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1738400470282" as="style"/><link rel="stylesheet" href="styles.css?v=1738400470282"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://johan-mabille.medium.com/sparrow-1f23817f6696">Sparrow, a modern C++ implementation of the Apache Arrow columnar format</a> <span class="domain">(<a href="https://johan-mabille.medium.com">johan-mabille.medium.com</a>)</span></div><div class="subtext"><span>SylvainCorlay</span> | <span>12 comments</span></div><br/><div><div id="42894911" class="c"><input type="checkbox" id="c-42894911" checked=""/><div class="controls bullet"><span class="by">amluto</span><span>|</span><a href="#42895564">next</a><span>|</span><label class="collapse" for="c-42894911">[-]</label><label class="expand" for="c-42894911">[9 more]</label></div><br/><div class="children"><div class="content">This is supposed to be idiomatic?!?<p><pre><code>    namespace sp = sparrow;
    sp::primitive_array&lt;int&gt; ar = { 1, 3, 5, 7, 9 };
    &#x2F;&#x2F; Caution: get_arrow_structures returns pointers, not values
    auto [arrow_array, arrow_schema] = sp::get_arrow_structures(std::move(ar));
    &#x2F;&#x2F; Use arrow_array and arrow_schema as you need (serialization,
    &#x2F;&#x2F; passing it to a third party library)
    &#x2F;&#x2F; ...
    &#x2F;&#x2F; do NOT release the C structures in the end, the &quot;ar&quot; variable will do it
   &#x2F;&#x2F; for you
</code></pre>
I’m sorry, resources are kept alive by an object <i>that has been moved from</i>?</div><br/><div id="42896979" class="c"><input type="checkbox" id="c-42896979" checked=""/><div class="controls bullet"><span class="by">arka2147483647</span><span>|</span><a href="#42894911">parent</a><span>|</span><a href="#42895460">next</a><span>|</span><label class="collapse" for="c-42896979">[-]</label><label class="expand" for="c-42896979">[1 more]</label></div><br/><div class="children"><div class="content">Why does sp::primitive_array&lt;&gt; even exist?<p>Should it not be std::array&lt;&gt;?</div><br/></div></div><div id="42895460" class="c"><input type="checkbox" id="c-42895460" checked=""/><div class="controls bullet"><span class="by">senkora</span><span>|</span><a href="#42894911">parent</a><span>|</span><a href="#42896979">prev</a><span>|</span><a href="#42895191">next</a><span>|</span><label class="collapse" for="c-42895460">[-]</label><label class="expand" for="c-42895460">[2 more]</label></div><br/><div class="children"><div class="content">This bothered me enough to check the source code, because I simply had to know:<p><pre><code>    template &lt;layout_or_array A&gt;
    std::pair&lt;ArrowArray*, ArrowSchema*&gt; get_arrow_structures(A&amp; a)
    {
        arrow_proxy&amp; proxy = detail::array_access::get_arrow_proxy(a);
        return std::make_pair(&amp;(proxy.array()), &amp;(proxy.schema()));
    }
</code></pre>
<a href="https:&#x2F;&#x2F;github.com&#x2F;man-group&#x2F;sparrow&#x2F;blob&#x2F;c01a768f590ebf3b229b22fe3d46585bf9648f5b&#x2F;include&#x2F;sparrow&#x2F;array.hpp#L72">https:&#x2F;&#x2F;github.com&#x2F;man-group&#x2F;sparrow&#x2F;blob&#x2F;c01a768f590ebf3b22...</a><p>So the answer is that the `std::move` does nothing and should be omitted, because this function only has one overload, and that overload takes its argument by lvalue-reference.<p>(And as far as I can tell, `detail::array_access::get_arrow_proxy(a)` eventually just reads a member on `a`, so there&#x27;s no copying anywhere)<p>It&#x27;s a harmless mistake; I&#x27;m just surprised it wasn&#x27;t caught. The authors seem pretty experienced with the language.</div><br/><div id="42895767" class="c"><input type="checkbox" id="c-42895767" checked=""/><div class="controls bullet"><span class="by">quietbritishjim</span><span>|</span><a href="#42894911">root</a><span>|</span><a href="#42895460">parent</a><span>|</span><a href="#42895191">next</a><span>|</span><label class="collapse" for="c-42895767">[-]</label><label class="expand" for="c-42895767">[1 more]</label></div><br/><div class="children"><div class="content">&gt; So the answer is that the `std::move` does nothing and should be omitted<p>You can&#x27;t assign an rvalue into an lvalue reference, precisely to avoid this sort of mistake. If this is the only overload then this just wouldn&#x27;t compile (e.g. [1]). So the std::move isn&#x27;t doing nothing, but yes it should be omitted. Maybe it&#x27;s just a weird typo.<p>[1] <a href="https:&#x2F;&#x2F;ideone.com&#x2F;4NS5dI" rel="nofollow">https:&#x2F;&#x2F;ideone.com&#x2F;4NS5dI</a></div><br/></div></div></div></div><div id="42895191" class="c"><input type="checkbox" id="c-42895191" checked=""/><div class="controls bullet"><span class="by">jandrewrogers</span><span>|</span><a href="#42894911">parent</a><span>|</span><a href="#42895460">prev</a><span>|</span><a href="#42895136">next</a><span>|</span><label class="collapse" for="c-42895191">[-]</label><label class="expand" for="c-42895191">[3 more]</label></div><br/><div class="children"><div class="content">Not speaking to the specific design choices here, but in C++ moved-from objects are not destroyed and must be valid in their moved-from state (e.g. a sentinel value to indicate they’ve been moved) so that they can be destroyed in the indefinite future. This is useful even though “destroy on move” is the correct semantics for most cases. Making “move” and “destroy” distinct operations increases the flexibility and expressiveness.<p>A common case where this is useful is if the address space where the object lives is accessible, for read or write, by references exogenous to the process like some kinds of shared memory or hardware DMA. If the object is immediately destroyed on move, <i>it implies the memory can be reused</i> while things your process can’t control may not know you destroyed the object. This is essentially a use-after-free bug factory. Being able to defer destruction to a point in time when you can guarantee this kind of UAF bug is not possible is valuable.</div><br/><div id="42895680" class="c"><input type="checkbox" id="c-42895680" checked=""/><div class="controls bullet"><span class="by">quietbritishjim</span><span>|</span><a href="#42894911">root</a><span>|</span><a href="#42895191">parent</a><span>|</span><a href="#42895136">next</a><span>|</span><label class="collapse" for="c-42895680">[-]</label><label class="expand" for="c-42895680">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Making “move” and “destroy” distinct operations increases the flexibility and expressiveness.<p>No, it does not. It&#x27;s an artefact of the evolution of the language and highly undesirable. Rust has destructive moves (and copies built on top of moves, rather than the other way round) and it&#x27;s far cleaner.</div><br/><div id="42895837" class="c"><input type="checkbox" id="c-42895837" checked=""/><div class="controls bullet"><span class="by">jandrewrogers</span><span>|</span><a href="#42894911">root</a><span>|</span><a href="#42895680">parent</a><span>|</span><a href="#42895136">next</a><span>|</span><label class="collapse" for="c-42895837">[-]</label><label class="expand" for="c-42895837">[1 more]</label></div><br/><div class="children"><div class="content">Sure, if you never need to deal with actual low-level high-performance systems code. Just because this use case doesn’t apply to anything you do doesn’t mean it applies to nobody. This is the kind of attitude that undermines languages like Rust (which I use in my systems). A fair criticism of Rust as a “systems language” is that it simply excludes all the really difficult parts of being a systems language.<p>C++ deserves a lot of criticism. Many aspects of the language are quite fucked. But willfully ignoring that it solves real problems that other nominal systems languages are unwilling to address doesn’t mean those problems don’t exist.</div><br/></div></div></div></div></div></div><div id="42895136" class="c"><input type="checkbox" id="c-42895136" checked=""/><div class="controls bullet"><span class="by">juunpp</span><span>|</span><a href="#42894911">parent</a><span>|</span><a href="#42895191">prev</a><span>|</span><a href="#42895154">next</a><span>|</span><label class="collapse" for="c-42895136">[-]</label><label class="expand" for="c-42895136">[1 more]</label></div><br/><div class="children"><div class="content">I think that comment is a copy-paste mistake. If you look at the next code snippet, the comment actually makes sense there.<p>That being said, I&#x27;ve also given up on C++ and learn it mostly to keep up with the job, if that&#x27;s where you are coming from. I don&#x27;t find Rust to be a satisfying replacement, though. No language scratches the itch for me right now.</div><br/></div></div></div></div><div id="42895564" class="c"><input type="checkbox" id="c-42895564" checked=""/><div class="controls bullet"><span class="by">rubenvanwyk</span><span>|</span><a href="#42894911">prev</a><span>|</span><label class="collapse" for="c-42895564">[-]</label><label class="expand" for="c-42895564">[2 more]</label></div><br/><div class="children"><div class="content">Seems cool but I have questions about Arcticdb - is Polars, DuckDB etc really so limited for data science analysis that it&#x27;s justified to write a new library specifically for time-series analysis on S3 files?</div><br/><div id="42895585" class="c"><input type="checkbox" id="c-42895585" checked=""/><div class="controls bullet"><span class="by">rubenvanwyk</span><span>|</span><a href="#42895564">parent</a><span>|</span><label class="collapse" for="c-42895585">[-]</label><label class="expand" for="c-42895585">[1 more]</label></div><br/><div class="children"><div class="content">Apparently this: <a href="https:&#x2F;&#x2F;www.infoq.com&#x2F;presentations&#x2F;arcticdb&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.infoq.com&#x2F;presentations&#x2F;arcticdb&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>