<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729760475229" as="style"/><link rel="stylesheet" href="styles.css?v=1729760475229"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.davidreis.me/2024/what-happens-when-you-make-a-move-in-lichess">What happens when you make a move in lichess.org?</a> <span class="domain">(<a href="https://www.davidreis.me">www.davidreis.me</a>)</span></div><div class="subtext"><span>dreis_sw</span> | <span>115 comments</span></div><br/><div><div id="41928942" class="c"><input type="checkbox" id="c-41928942" checked=""/><div class="controls bullet"><span class="by">MobileVet</span><span>|</span><a href="#41928953">next</a><span>|</span><label class="collapse" for="c-41928942">[-]</label><label class="expand" for="c-41928942">[32 more]</label></div><br/><div class="children"><div class="content">I wish this discussed the timing arbitration of each move.  Based on the packet information (if that is correct &amp; complete) then the timing is done entirely on the clients.  However, they show the time in seconds which can&#x27;t be right so I am curious how accurate this packet schema is (or if those are float values).<p>Regardless, one thing I find maddening about chess.com is the time architecture of the game.  I haven&#x27;t seen the underlying code, but it feels like the SERVER is tracking the time.  This completely neglects transport time &amp; latency meaning that 1s to move isn&#x27;t really a second.  Playing on the mobile client is an exercise in frustration if you are playing timed games and down to the wire.  Even when you aren&#x27;t, your clock will jump on normal moves and it is most obvious during the opening.<p>This could also be due to general poor network code as well.  The number of errors I get during puzzles is also frustrating.  Do they really not retry a send automatically??  &lt;breath&gt;<p>Chess.com has the brand and the names... but dang, the tech feels SO rough to me.</div><br/><div id="41932334" class="c"><input type="checkbox" id="c-41932334" checked=""/><div class="controls bullet"><span class="by">bluecalm</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41929393">next</a><span>|</span><label class="collapse" for="c-41932334">[-]</label><label class="expand" for="c-41932334">[1 more]</label></div><br/><div class="children"><div class="content">Chess.com software might be the worst public facing software ever assembled.
During their most popular weekly tournament (by the number of spectators) called Titled Tuesday where significant % of the world elite regularly competes they send links on a public chat to a 3rd site every 4 rounds. The reason is that there is a few minutes break and they failed implementing a clock on their side so they need 3rd party service for that.<p>This is one of the many, many things but imo it&#x27;s the most telling. They can&#x27;t even add a clock counting down the 6 minutes to their web client.</div><br/></div></div><div id="41929393" class="c"><input type="checkbox" id="c-41929393" checked=""/><div class="controls bullet"><span class="by">pshc</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41932334">prev</a><span>|</span><a href="#41929718">next</a><span>|</span><label class="collapse" for="c-41929393">[-]</label><label class="expand" for="c-41929393">[17 more]</label></div><br/><div class="children"><div class="content"><i>&gt; it feels like the SERVER is tracking the time</i><p>TBH this is what I expected for all online chess. How else to reconcile the two players&#x27; differing clocks and also prevent client-side cheating?</div><br/><div id="41930521" class="c"><input type="checkbox" id="c-41930521" checked=""/><div class="controls bullet"><span class="by">MobileVet</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929393">parent</a><span>|</span><a href="#41933226">next</a><span>|</span><label class="collapse" for="c-41930521">[-]</label><label class="expand" for="c-41930521">[4 more]</label></div><br/><div class="children"><div class="content">I guess my naive frustration comes from crazy fps games tracking things so precisely and yet somehow Chess.com can’t handle a turn based game?!  Honestly.<p>I do recognize that fps games utilize predictive algorithms and planning to estimate future player positions but still, turn based networking with 100ms accuracy should be a solved problem</div><br/><div id="41931514" class="c"><input type="checkbox" id="c-41931514" checked=""/><div class="controls bullet"><span class="by">pshc</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930521">parent</a><span>|</span><a href="#41933226">next</a><span>|</span><label class="collapse" for="c-41931514">[-]</label><label class="expand" for="c-41931514">[3 more]</label></div><br/><div class="children"><div class="content">Yeah honestly I agree like it would be nice if they switched to WebRTC or UDP.</div><br/><div id="41933199" class="c"><input type="checkbox" id="c-41933199" checked=""/><div class="controls bullet"><span class="by">palata</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41931514">parent</a><span>|</span><a href="#41933226">next</a><span>|</span><label class="collapse" for="c-41933199">[-]</label><label class="expand" for="c-41933199">[2 more]</label></div><br/><div class="children"><div class="content">So you need to send a few bytes of information every few seconds, but you want to spam the network with UDP packets containing those few bytes?</div><br/><div id="41933564" class="c"><input type="checkbox" id="c-41933564" checked=""/><div class="controls bullet"><span class="by">lomase</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41933199">parent</a><span>|</span><a href="#41933226">next</a><span>|</span><label class="collapse" for="c-41933564">[-]</label><label class="expand" for="c-41933564">[1 more]</label></div><br/><div class="children"><div class="content">Every single online multiplayer game that cares about latency reimplements a subset of HTTP over UDP.</div><br/></div></div></div></div></div></div></div></div><div id="41933226" class="c"><input type="checkbox" id="c-41933226" checked=""/><div class="controls bullet"><span class="by">palata</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929393">parent</a><span>|</span><a href="#41930521">prev</a><span>|</span><a href="#41931233">next</a><span>|</span><label class="collapse" for="c-41933226">[-]</label><label class="expand" for="c-41933226">[1 more]</label></div><br/><div class="children"><div class="content">&gt; How else to reconcile the two players&#x27; differing clocks and also prevent client-side cheating?<p>Is there a point in preventing cheating, really? I can just make a bot...</div><br/></div></div><div id="41931233" class="c"><input type="checkbox" id="c-41931233" checked=""/><div class="controls bullet"><span class="by">nightowl_games</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929393">parent</a><span>|</span><a href="#41933226">prev</a><span>|</span><a href="#41929496">next</a><span>|</span><label class="collapse" for="c-41931233">[-]</label><label class="expand" for="c-41931233">[2 more]</label></div><br/><div class="children"><div class="content">Netcode dev here. Predicting the clock is a trivially solved problem. The client and server know the latency between each other, the server can offset the timestamp on the input from the client to compensate for this difference, and the client can offset it&#x27;s rendering of the clock data from the server. The same techniques used in regular online gaming would apply here. The only X factor here is the impact of the client lieing about its latency to the server, perhaps that could have an impact, not sure.</div><br/><div id="41931433" class="c"><input type="checkbox" id="c-41931433" checked=""/><div class="controls bullet"><span class="by">crashbunny</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41931233">parent</a><span>|</span><a href="#41929496">next</a><span>|</span><label class="collapse" for="c-41931433">[-]</label><label class="expand" for="c-41931433">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The only X factor here is the impact of the client lieing about its latency to the server, perhaps that could have an impact, not sure.<p>on lichess it does have an impact. lichess has a thing they call lag compensation where the server can add time to a player&#x27;s clock after the server receives their move.<p>The goal is to make it fair for someone with high lag playing someone with low lag.<p>I don&#x27;t know the exact cheating method used. I&#x27;ll have a guess, though. What if someone spent a few seconds looking at the board before making their move, and then adding (edit: oops, subtracting) a few seconds to their clock in their response packet. The server would see the client made their move instantly based on the time in the response packet, but it took a few seconds for the server to receive the packet. i.e. lag. So it might add time to compensate for the perceived lag.<p>Lag compensation cheating is a frequent topic on the lichess forums.</div><br/></div></div></div></div><div id="41929496" class="c"><input type="checkbox" id="c-41929496" checked=""/><div class="controls bullet"><span class="by">MichaelZuo</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929393">parent</a><span>|</span><a href="#41931233">prev</a><span>|</span><a href="#41929569">next</a><span>|</span><label class="collapse" for="c-41929496">[-]</label><label class="expand" for="c-41929496">[5 more]</label></div><br/><div class="children"><div class="content">It hasn’t been done client side in any pvp game I’ve heard of.</div><br/><div id="41929862" class="c"><input type="checkbox" id="c-41929862" checked=""/><div class="controls bullet"><span class="by">stevage</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929496">parent</a><span>|</span><a href="#41929569">next</a><span>|</span><label class="collapse" for="c-41929862">[-]</label><label class="expand" for="c-41929862">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;m pretty sure freechess.org did.</div><br/><div id="41930512" class="c"><input type="checkbox" id="c-41930512" checked=""/><div class="controls bullet"><span class="by">MichaelZuo</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929862">parent</a><span>|</span><a href="#41929569">next</a><span>|</span><label class="collapse" for="c-41930512">[-]</label><label class="expand" for="c-41930512">[3 more]</label></div><br/><div class="children"><div class="content">How is it being done client side?</div><br/><div id="41932359" class="c"><input type="checkbox" id="c-41932359" checked=""/><div class="controls bullet"><span class="by">compiler-guy</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930512">parent</a><span>|</span><a href="#41930707">next</a><span>|</span><label class="collapse" for="c-41932359">[-]</label><label class="expand" for="c-41932359">[1 more]</label></div><br/><div class="children"><div class="content">Freechess shipped a binary called “timeseal” that did the calculations for you and encrypted the communications. It was not foolproof—-not by a long shot, but it also didn’t completely suck.<p>You can read about what became timeseal here. <a href="https:&#x2F;&#x2F;eprint.iacr.org&#x2F;2004&#x2F;203.pdf" rel="nofollow">https:&#x2F;&#x2F;eprint.iacr.org&#x2F;2004&#x2F;203.pdf</a></div><br/></div></div><div id="41930707" class="c"><input type="checkbox" id="c-41930707" checked=""/><div class="controls bullet"><span class="by">stevage</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930512">parent</a><span>|</span><a href="#41932359">prev</a><span>|</span><a href="#41929569">next</a><span>|</span><label class="collapse" for="c-41930707">[-]</label><label class="expand" for="c-41930707">[1 more]</label></div><br/><div class="children"><div class="content">Well it&#x27;s a long time since I played there. But it had custom chess clients, which I assume just recorded how much time your move actually took and sent that with the move.<p>Yes, it&#x27;s easy to cheat with this, but it&#x27;s very easy to cheat with chess anyway.</div><br/></div></div></div></div></div></div></div></div><div id="41929569" class="c"><input type="checkbox" id="c-41929569" checked=""/><div class="controls bullet"><span class="by">bongodongobob</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929393">parent</a><span>|</span><a href="#41929496">prev</a><span>|</span><a href="#41929718">next</a><span>|</span><label class="collapse" for="c-41929569">[-]</label><label class="expand" for="c-41929569">[4 more]</label></div><br/><div class="children"><div class="content">Track the two clients pings? What client side cheating prevention would you need to do in chess? Afaik you can&#x27;t cheat by clipping through walls or jumping around on the map.</div><br/><div id="41929589" class="c"><input type="checkbox" id="c-41929589" checked=""/><div class="controls bullet"><span class="by">connicpu</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929569">parent</a><span>|</span><a href="#41929619">next</a><span>|</span><label class="collapse" for="c-41929589">[-]</label><label class="expand" for="c-41929589">[2 more]</label></div><br/><div class="children"><div class="content">The client side cheating would by lying about when you received the packet in order to give yourself more time to think. Even if you only shifted it by 200ms per move, that could add up to a lot over the course of a long game.</div><br/><div id="41930032" class="c"><input type="checkbox" id="c-41930032" checked=""/><div class="controls bullet"><span class="by">kaoD</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929589">parent</a><span>|</span><a href="#41929619">next</a><span>|</span><label class="collapse" for="c-41930032">[-]</label><label class="expand" for="c-41930032">[1 more]</label></div><br/><div class="children"><div class="content">To give additional context: bullet chess can go down to 1 minute per player. Lying about a few millisecond per move there is <i>huge</i>.</div><br/></div></div></div></div><div id="41929619" class="c"><input type="checkbox" id="c-41929619" checked=""/><div class="controls bullet"><span class="by">HDThoreaun</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929569">parent</a><span>|</span><a href="#41929589">prev</a><span>|</span><a href="#41929718">next</a><span>|</span><label class="collapse" for="c-41929619">[-]</label><label class="expand" for="c-41929619">[1 more]</label></div><br/><div class="children"><div class="content">Cheat by giving yourself more time</div><br/></div></div></div></div></div></div><div id="41929718" class="c"><input type="checkbox" id="c-41929718" checked=""/><div class="controls bullet"><span class="by">pengowray</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41929393">prev</a><span>|</span><a href="#41930890">next</a><span>|</span><label class="collapse" for="c-41929718">[-]</label><label class="expand" for="c-41929718">[3 more]</label></div><br/><div class="children"><div class="content">&gt; they show the time in seconds which can&#x27;t be right<p>Seems right.<p>If you export&#x2F;download games from lichess, they use the .pgn (Portable Game Notation) format, which is a standard plain-text format circa 1993, used by pretty much everyone for describing a chess game.<p>Lichess follows the specification to the letter, and as it only technically allows one-second accuracy, lichess only record moves with one-second accuracy. It seems insane, but that&#x27;s how they do it.<p>Chess.com also exports PGN files, but they add a decimal place, allowing subsecond accuracy. No one has a problem with this. There is no software which cannot handle this. But Lichess refuses to &quot;break&quot; the spec.<p>lichess PGN export example:<p>&gt; 1. d3 { [%eval -0.15] [%clk 0:01:00] } 1... g6 { [%eval 0.04] [%clk 0:01:00] }<p>Chess.com PGN export example:<p>&gt; 1. d4 {[%clk 0:02:58.6]} 1... b6 {[%clk 0:02:59.2]}</div><br/><div id="41930479" class="c"><input type="checkbox" id="c-41930479" checked=""/><div class="controls bullet"><span class="by">kibwen</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929718">parent</a><span>|</span><a href="#41930890">next</a><span>|</span><label class="collapse" for="c-41930479">[-]</label><label class="expand" for="c-41930479">[2 more]</label></div><br/><div class="children"><div class="content"><i>&gt; lichess only record moves with one-second accuracy</i><p>According to this blog post, this doesn&#x27;t appear to be the case since at least 2017:<p><a href="https:&#x2F;&#x2F;lichess.org&#x2F;@&#x2F;lichess&#x2F;blog&#x2F;a-better-game-clock-history&#x2F;WOEVrjAA" rel="nofollow">https:&#x2F;&#x2F;lichess.org&#x2F;@&#x2F;lichess&#x2F;blog&#x2F;a-better-game-clock-histo...</a><p><i>&quot;Move times are now stored and displayed with a precision of one tenth of a second. The precision even goes up to one hundredth of a second, for positions where the player had less than 10 seconds left on their clock.&quot;</i></div><br/><div id="41930903" class="c"><input type="checkbox" id="c-41930903" checked=""/><div class="controls bullet"><span class="by">pengowray</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930479">parent</a><span>|</span><a href="#41930890">next</a><span>|</span><label class="collapse" for="c-41930903">[-]</label><label class="expand" for="c-41930903">[1 more]</label></div><br/><div class="children"><div class="content">Interesting. Thanks for the correction and link. I&#x27;ll note though the .pgn downloads still only show 1 second precision, as do the game PGNs in lichess&#x27;s &quot;open database&quot; archive.</div><br/></div></div></div></div></div></div><div id="41930890" class="c"><input type="checkbox" id="c-41930890" checked=""/><div class="controls bullet"><span class="by">Scene_Cast2</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41929718">prev</a><span>|</span><a href="#41929123">next</a><span>|</span><label class="collapse" for="c-41930890">[-]</label><label class="expand" for="c-41930890">[3 more]</label></div><br/><div class="children"><div class="content">What I&#x27;d love is for my pre-moves to be sent to the server immediately so I don&#x27;t time out when I pre-moved.</div><br/><div id="41931113" class="c"><input type="checkbox" id="c-41931113" checked=""/><div class="controls bullet"><span class="by">fbernier</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930890">parent</a><span>|</span><a href="#41931430">next</a><span>|</span><label class="collapse" for="c-41931113">[-]</label><label class="expand" for="c-41931113">[1 more]</label></div><br/><div class="children"><div class="content">What&#x27;s interesting about this is chess.com allows you to stack as many pre-moves as you like but they each cost 0.1s, whereas on lichess you can only have one pre-move which is technically free but maybe not because of delay.</div><br/></div></div><div id="41931430" class="c"><input type="checkbox" id="c-41931430" checked=""/><div class="controls bullet"><span class="by">y-curious</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41930890">parent</a><span>|</span><a href="#41931113">prev</a><span>|</span><a href="#41929123">next</a><span>|</span><label class="collapse" for="c-41931430">[-]</label><label class="expand" for="c-41931430">[1 more]</label></div><br/><div class="children"><div class="content">The worst part is they call it an intentional choice. 
&quot;First off, premoves take 0.1 seconds. That is what has been preferred and agreed upon by most professional players we have consulted on the topic. They prefer .1 to .0 for premove. This is also what other chess servers do.&quot;[1]<p>It&#x27;s super annoying and the reason I only play blitz+ on chesscom.<p>[1]<a href="https:&#x2F;&#x2F;www.chess.com&#x2F;forum&#x2F;view&#x2F;help-support&#x2F;mate-in-one-queued-in-premove-and-still-lose-on-time" rel="nofollow">https:&#x2F;&#x2F;www.chess.com&#x2F;forum&#x2F;view&#x2F;help-support&#x2F;mate-in-one-qu...</a></div><br/></div></div></div></div><div id="41929123" class="c"><input type="checkbox" id="c-41929123" checked=""/><div class="controls bullet"><span class="by">mkagenius</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41930890">prev</a><span>|</span><a href="#41929554">next</a><span>|</span><label class="collapse" for="c-41929123">[-]</label><label class="expand" for="c-41929123">[6 more]</label></div><br/><div class="children"><div class="content">Vladimir Kramnik agrees with your observations about chesscom.</div><br/><div id="41930148" class="c"><input type="checkbox" id="c-41930148" checked=""/><div class="controls bullet"><span class="by">tkahlrt</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929123">parent</a><span>|</span><a href="#41929282">next</a><span>|</span><label class="collapse" for="c-41930148">[-]</label><label class="expand" for="c-41930148">[1 more]</label></div><br/><div class="children"><div class="content">Yes, he had timing problems in an online tournament on chess.com (against a Mexican GM in the same room) where his computer did not have all Windows updates and&#x2F;or the timezone was wrong.<p>chess.com confirmed the issue.</div><br/></div></div><div id="41929282" class="c"><input type="checkbox" id="c-41929282" checked=""/><div class="controls bullet"><span class="by">chongli</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929123">parent</a><span>|</span><a href="#41930148">prev</a><span>|</span><a href="#41929444">next</a><span>|</span><label class="collapse" for="c-41929282">[-]</label><label class="expand" for="c-41929282">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m surprised to see anyone bring him up here!</div><br/><div id="41931200" class="c"><input type="checkbox" id="c-41931200" checked=""/><div class="controls bullet"><span class="by">sourcepluck</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929282">parent</a><span>|</span><a href="#41929444">next</a><span>|</span><label class="collapse" for="c-41931200">[-]</label><label class="expand" for="c-41931200">[2 more]</label></div><br/><div class="children"><div class="content">You&#x27;re surprised that Kramnik is mentioned when the discussion topic is related to chess? I don&#x27;t understand why. He&#x27;s well-known in chess (and in chess memeland).</div><br/><div id="41932339" class="c"><input type="checkbox" id="c-41932339" checked=""/><div class="controls bullet"><span class="by">chongli</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41931200">parent</a><span>|</span><a href="#41929444">next</a><span>|</span><label class="collapse" for="c-41932339">[-]</label><label class="expand" for="c-41932339">[1 more]</label></div><br/><div class="children"><div class="content">Kramnik is a former world champion who has taken a torch to his own reputation by accusing tons of people of cheating without evidence. He’s been banned as a regular columnist on chess.com after using his column as a platform to attack people. He has next to no credibility on any chess issues these days.</div><br/></div></div></div></div></div></div><div id="41929444" class="c"><input type="checkbox" id="c-41929444" checked=""/><div class="controls bullet"><span class="by">nih</span><span>|</span><a href="#41928942">root</a><span>|</span><a href="#41929123">parent</a><span>|</span><a href="#41929282">prev</a><span>|</span><a href="#41929554">next</a><span>|</span><label class="collapse" for="c-41929444">[-]</label><label class="expand" for="c-41929444">[1 more]</label></div><br/><div class="children"><div class="content">Interesting</div><br/></div></div></div></div><div id="41929554" class="c"><input type="checkbox" id="c-41929554" checked=""/><div class="controls bullet"><span class="by">bongodongobob</span><span>|</span><a href="#41928942">parent</a><span>|</span><a href="#41929123">prev</a><span>|</span><a href="#41928953">next</a><span>|</span><label class="collapse" for="c-41929554">[-]</label><label class="expand" for="c-41929554">[1 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t play bullet on chess.com for this reason. Lost way too many games on &quot;time&quot; even though I had a second or two on the clock. Incredibly frustrating.</div><br/></div></div></div></div><div id="41928953" class="c"><input type="checkbox" id="c-41928953" checked=""/><div class="controls bullet"><span class="by">galkk</span><span>|</span><a href="#41928942">prev</a><span>|</span><a href="#41927585">next</a><span>|</span><label class="collapse" for="c-41928953">[-]</label><label class="expand" for="c-41928953">[10 more]</label></div><br/><div class="children"><div class="content">So essentially lichess chose StackOverflow approach - (rather) beefy servers, instead of &quot;treating them like a cattle&quot;.<p>Interesting that they accumulate and periodically store game state. Unfortunately it is not very clear, where they store ongoing game state - in redis or on server itself. Also cost breakdown doesn&#x27;t have server for redis, only for DB.<p>BTW, their github has better architectural picture, than overly simplified one in the article: <a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;lichess-org&#x2F;lila&#x2F;master&#x2F;public&#x2F;images&#x2F;architecture.png" rel="nofollow">https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;lichess-org&#x2F;lila&#x2F;master&#x2F;pu...</a>. Unfortunately, I&#x27;m afraid, drawing something like that during interview may not land a job at faang =(<p>Note that they have cost per game fairly low: $0.00027, 3,671 games per dollar.<p>Their cost breakdown, for ones who are curious
<a href="https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1Si3PMUJGR9KrpE5lngSkHLJKJkb0ZuI4&#x2F;preview" rel="nofollow">https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1Si3PMUJGR9KrpE5lngSk...</a><p>p.s. I&#x27;m not saying that Lichess&#x27;s approach is the best or faang is the worst. Remember, lichess had 10 hours outage exactly because of the architecture chosen (single datacenter dependency). <a href="https:&#x2F;&#x2F;lichess.org&#x2F;@&#x2F;Lichess&#x2F;blog&#x2F;post-mortem-of-our-longest-downtime&#x2F;XAgG7jbd" rel="nofollow">https:&#x2F;&#x2F;lichess.org&#x2F;@&#x2F;Lichess&#x2F;blog&#x2F;post-mortem-of-our-longes...</a> . And outages like that are exactly the reasons why multi-datacenter and multi-region architectures are drilled down into faang engineers.<p>My point is is that there are cases when this approach is legit, but typical interview is laser focused on different things, and most probably won&#x27;t appreciate the &quot;old style&quot; approach to the problem. I&#x27;m sure that if Thibault will ever decide to land in faang he will neither do whiteboard coding nor system design.</div><br/><div id="41932596" class="c"><input type="checkbox" id="c-41932596" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#41928953">parent</a><span>|</span><a href="#41929502">next</a><span>|</span><label class="collapse" for="c-41932596">[-]</label><label class="expand" for="c-41932596">[1 more]</label></div><br/><div class="children"><div class="content">The downtime here is mostly OVH&#x27;s fault. They&#x27;re not known for fast support on hardware failures, that&#x27;s why they&#x27;re cheap. If they had this architecture on AWS EC2 and could just spin up a new AMI, then they&#x27;d only have a few minutes downtime, and the same simple architecture.</div><br/></div></div><div id="41929502" class="c"><input type="checkbox" id="c-41929502" checked=""/><div class="controls bullet"><span class="by">benediktwerner</span><span>|</span><a href="#41928953">parent</a><span>|</span><a href="#41932596">prev</a><span>|</span><a href="#41929831">next</a><span>|</span><label class="collapse" for="c-41929502">[-]</label><label class="expand" for="c-41929502">[1 more]</label></div><br/><div class="children"><div class="content">Redid runs on the main server, where lila runs, as indicated in the diagram you linked. And moves are buffered in lila. Redis is only used for pub-sub.</div><br/></div></div><div id="41929831" class="c"><input type="checkbox" id="c-41929831" checked=""/><div class="controls bullet"><span class="by">juujian</span><span>|</span><a href="#41928953">parent</a><span>|</span><a href="#41929502">prev</a><span>|</span><a href="#41931473">next</a><span>|</span><label class="collapse" for="c-41929831">[-]</label><label class="expand" for="c-41929831">[2 more]</label></div><br/><div class="children"><div class="content">I remember Meta having a few outages of their own. And outlook as well. So I&#x27;m not sure what to think now. But sure, on paper FAANG is redundant and hence better.</div><br/><div id="41932144" class="c"><input type="checkbox" id="c-41932144" checked=""/><div class="controls bullet"><span class="by">xmprt</span><span>|</span><a href="#41928953">root</a><span>|</span><a href="#41929831">parent</a><span>|</span><a href="#41931473">next</a><span>|</span><label class="collapse" for="c-41932144">[-]</label><label class="expand" for="c-41932144">[1 more]</label></div><br/><div class="children"><div class="content">In my experience, issues scale exponentially with scale. So handling 10x the traffic might mean 100x the potentially issues. Redundancy helps with that so when something inevitably fails, the architecture is able to automatically recover and the end user doesn&#x27;t see any degradation. So what works for lichess wouldn&#x27;t work for Meta.</div><br/></div></div></div></div><div id="41931473" class="c"><input type="checkbox" id="c-41931473" checked=""/><div class="controls bullet"><span class="by">jeanlucas</span><span>|</span><a href="#41928953">parent</a><span>|</span><a href="#41929831">prev</a><span>|</span><a href="#41929048">next</a><span>|</span><label class="collapse" for="c-41931473">[-]</label><label class="expand" for="c-41931473">[1 more]</label></div><br/><div class="children"><div class="content">roughtly 3600 games per dollar? I have over 30k games... Time to pay up</div><br/></div></div><div id="41929048" class="c"><input type="checkbox" id="c-41929048" checked=""/><div class="controls bullet"><span class="by">epolanski</span><span>|</span><a href="#41928953">parent</a><span>|</span><a href="#41931473">prev</a><span>|</span><a href="#41927585">next</a><span>|</span><label class="collapse" for="c-41929048">[-]</label><label class="expand" for="c-41929048">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Unfortunately, I&#x27;m afraid, drawing something like that during interview may not land a job at faang =(<p>Yet another reason to be skeptical of the quality of hiring in faang if anything.</div><br/><div id="41929139" class="c"><input type="checkbox" id="c-41929139" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#41928953">root</a><span>|</span><a href="#41929048">parent</a><span>|</span><a href="#41927585">next</a><span>|</span><label class="collapse" for="c-41929139">[-]</label><label class="expand" for="c-41929139">[3 more]</label></div><br/><div class="children"><div class="content">Why feel anything about it at all? You work at FAANG: be glad for the money or quit if there isn&#x27;t any. You don&#x27;t work at FAANG: bad hiring makes it easier for you to get hired and make money.</div><br/><div id="41929177" class="c"><input type="checkbox" id="c-41929177" checked=""/><div class="controls bullet"><span class="by">epolanski</span><span>|</span><a href="#41928953">root</a><span>|</span><a href="#41929139">parent</a><span>|</span><a href="#41929768">next</a><span>|</span><label class="collapse" for="c-41929177">[-]</label><label class="expand" for="c-41929177">[1 more]</label></div><br/><div class="children"><div class="content">You haven&#x27;t considered the third option: couldn&#x27;t care less about working at these companies because of different reasons (personal, financial, geography, cv or whatever).<p>My criticism was mostly towards the very poor metrics these companies have introduced behind hiring, albeit I can understand that given the gigantic amount of applications they get a mechanism for removing false positives is acceptable even if missing on false negatives.<p>And even more that it spread to companies that do not have their problems and can&#x27;t afford false negatives.</div><br/></div></div><div id="41929768" class="c"><input type="checkbox" id="c-41929768" checked=""/><div class="controls bullet"><span class="by">simplify</span><span>|</span><a href="#41928953">root</a><span>|</span><a href="#41929139">parent</a><span>|</span><a href="#41929177">prev</a><span>|</span><a href="#41927585">next</a><span>|</span><label class="collapse" for="c-41929768">[-]</label><label class="expand" for="c-41929768">[1 more]</label></div><br/><div class="children"><div class="content">This is a limited, self-centered way of thinking (not self-ish, just self in the neutral sense of the word).<p>Looking at second-order effects, many companies look up to FAANG for &quot;best practices&quot;, which often includes them blindly copying their hiring practices. Without feeling or calling out any healthy skepticism, the software hiring world becomes a worse place overall.</div><br/></div></div></div></div></div></div></div></div><div id="41927585" class="c"><input type="checkbox" id="c-41927585" checked=""/><div class="controls bullet"><span class="by">perihelions</span><span>|</span><a href="#41928953">prev</a><span>|</span><a href="#41927736">next</a><span>|</span><label class="collapse" for="c-41927585">[-]</label><label class="expand" for="c-41927585">[12 more]</label></div><br/><div class="children"><div class="content">- <i>&quot;While these moves could be calculated client-side, providing them server-side ensures consistency - especially for complex or esoteric chess variants - and optimizes performance on clients with limited processing capabilities or energy restrictions.&quot;</i><p>Just a wild guess: might be intended to lower the implementation barrier for new open-source software clients on new platforms, and&#x2F;or preempt them from implementing subtle logic bugs that only show up much later.<p>The rules of chess are a bit tedious to implement, and you can easily get tired and code an edge-case bug that&#x27;s almost invisible. Lichess itself did this—it once had a logic error that affected a very tiny number (exactly 7) of games,<p><a href="https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;database&#x2F;issues&#x2F;23">https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;database&#x2F;issues&#x2F;23</a> (<i>&quot;Before 2015: Some games with illegal moves were recorded&quot;</i>)<p>(I apologize I couldn&#x27;t find the specific patch that fixed this)</div><br/><div id="41928244" class="c"><input type="checkbox" id="c-41928244" checked=""/><div class="controls bullet"><span class="by">xmprt</span><span>|</span><a href="#41927585">parent</a><span>|</span><a href="#41928903">next</a><span>|</span><label class="collapse" for="c-41928244">[-]</label><label class="expand" for="c-41928244">[4 more]</label></div><br/><div class="children"><div class="content">For those curious about the illegal move, it seems like it&#x27;s allowing queen side castling through the king side rook (or vice versa). eg. if this is the first rank, R _ _ R K _ _ _, then you could make the move O-O-O and end up with _ _ _ R K _ _ _<p>Naturally, it&#x27;s not possible to view this move anymore, but this game (<a href="https:&#x2F;&#x2F;lichess.org&#x2F;XDQeUk6j#48" rel="nofollow">https:&#x2F;&#x2F;lichess.org&#x2F;XDQeUk6j#48</a>) has everything up until the last legal move right before the illegal castling happened.</div><br/><div id="41928979" class="c"><input type="checkbox" id="c-41928979" checked=""/><div class="controls bullet"><span class="by">ARandumGuy</span><span>|</span><a href="#41927585">root</a><span>|</span><a href="#41928244">parent</a><span>|</span><a href="#41929805">next</a><span>|</span><label class="collapse" for="c-41928979">[-]</label><label class="expand" for="c-41928979">[1 more]</label></div><br/><div class="children"><div class="content">I can see why that only appeared in 7 games. It&#x27;s pretty rare to see a rook in between a king and another rook that are otherwise legally able to castle. Even rarer for someone to get into that position and actually try to castle.<p>Also that linked game is pretty entertaining. It&#x27;s not a good game, but it can be fun watching lower ranked players make moves that you&#x27;d never see in higher level games. Like, who plays Bb5+ against the Scandinavian? Amazing stuff.</div><br/></div></div><div id="41929805" class="c"><input type="checkbox" id="c-41929805" checked=""/><div class="controls bullet"><span class="by">complexworld</span><span>|</span><a href="#41927585">root</a><span>|</span><a href="#41928244">parent</a><span>|</span><a href="#41928979">prev</a><span>|</span><a href="#41929303">next</a><span>|</span><label class="collapse" for="c-41929805">[-]</label><label class="expand" for="c-41929805">[1 more]</label></div><br/><div class="children"><div class="content">Wouldn&#x27;t the bug with queen side castling end up with _ _ K R _ _ _ _?</div><br/></div></div><div id="41929303" class="c"><input type="checkbox" id="c-41929303" checked=""/><div class="controls bullet"><span class="by">adamisom</span><span>|</span><a href="#41927585">root</a><span>|</span><a href="#41928244">parent</a><span>|</span><a href="#41929805">prev</a><span>|</span><a href="#41928903">next</a><span>|</span><label class="collapse" for="c-41929303">[-]</label><label class="expand" for="c-41929303">[1 more]</label></div><br/><div class="children"><div class="content">Wow it just ate the rook huh?</div><br/></div></div></div></div><div id="41928903" class="c"><input type="checkbox" id="c-41928903" checked=""/><div class="controls bullet"><span class="by">ARandumGuy</span><span>|</span><a href="#41927585">parent</a><span>|</span><a href="#41928244">prev</a><span>|</span><a href="#41928998">next</a><span>|</span><label class="collapse" for="c-41928903">[-]</label><label class="expand" for="c-41928903">[2 more]</label></div><br/><div class="children"><div class="content">Another wild guess: Lichess could be pre-calculating and caching the legal moves for the most common chess positions. While pre-calculating every possible legal move for every position would be impossible, you could pre-calculate the most common openings and endgames, which could cover a lot of real-world positions. This cache could easily be larger then practical for the client, but a server could hold onto it no problem. This could save on the net processing time, compared to the client determining all legal moves for every position.</div><br/></div></div><div id="41928998" class="c"><input type="checkbox" id="c-41928998" checked=""/><div class="controls bullet"><span class="by">pfedak</span><span>|</span><a href="#41927585">parent</a><span>|</span><a href="#41928903">prev</a><span>|</span><a href="#41929557">next</a><span>|</span><label class="collapse" for="c-41928998">[-]</label><label class="expand" for="c-41928998">[1 more]</label></div><br/><div class="children"><div class="content">This looks like the relevant fix:
<a href="https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;scalachess&#x2F;pull&#x2F;154">https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;scalachess&#x2F;pull&#x2F;154</a><p>(the broken code checked that the only pieces on the king&#x27;s path to its new position were kings and rooks of the appropriate color)</div><br/></div></div><div id="41929557" class="c"><input type="checkbox" id="c-41929557" checked=""/><div class="controls bullet"><span class="by">benediktwerner</span><span>|</span><a href="#41927585">parent</a><span>|</span><a href="#41928998">prev</a><span>|</span><a href="#41927901">next</a><span>|</span><label class="collapse" for="c-41929557">[-]</label><label class="expand" for="c-41929557">[2 more]</label></div><br/><div class="children"><div class="content">From what I remember, one of the main reason also was to avoid bloating the JS on the game page. That page is kept especially slim to maximize performance and load times for low-powered devices.</div><br/><div id="41933173" class="c"><input type="checkbox" id="c-41933173" checked=""/><div class="controls bullet"><span class="by">ngcc_hk</span><span>|</span><a href="#41927585">root</a><span>|</span><a href="#41929557">parent</a><span>|</span><a href="#41927901">next</a><span>|</span><label class="collapse" for="c-41933173">[-]</label><label class="expand" for="c-41933173">[1 more]</label></div><br/><div class="children"><div class="content">Great!<p>A bit of surprise consideration … is that even common in these days of overfancy web sites.</div><br/></div></div></div></div><div id="41927901" class="c"><input type="checkbox" id="c-41927901" checked=""/><div class="controls bullet"><span class="by">epcoa</span><span>|</span><a href="#41927585">parent</a><span>|</span><a href="#41929557">prev</a><span>|</span><a href="#41927736">next</a><span>|</span><label class="collapse" for="c-41927901">[-]</label><label class="expand" for="c-41927901">[2 more]</label></div><br/><div class="children"><div class="content">&gt; and&#x2F;or preempt them from implementing subtle logic bugs that only show up much later.<p>Validating a submitted move is distinct from listing valid moves. I assumed the server would need to validate regardless of providing a list to the client.</div><br/><div id="41927919" class="c"><input type="checkbox" id="c-41927919" checked=""/><div class="controls bullet"><span class="by">perihelions</span><span>|</span><a href="#41927585">root</a><span>|</span><a href="#41927901">parent</a><span>|</span><a href="#41927736">next</a><span>|</span><label class="collapse" for="c-41927919">[-]</label><label class="expand" for="c-41927919">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s still duplicated work, and clients are likely to get it wrong and create more work for both devs.</div><br/></div></div></div></div></div></div><div id="41927736" class="c"><input type="checkbox" id="c-41927736" checked=""/><div class="controls bullet"><span class="by">hyperhopper</span><span>|</span><a href="#41927585">prev</a><span>|</span><a href="#41931206">next</a><span>|</span><label class="collapse" for="c-41927736">[-]</label><label class="expand" for="c-41927736">[4 more]</label></div><br/><div class="children"><div class="content">I wish the article explained how it dealt with message loss from the at-most-once redis pub&#x2F;sub channel</div><br/><div id="41928116" class="c"><input type="checkbox" id="c-41928116" checked=""/><div class="controls bullet"><span class="by">benatkin</span><span>|</span><a href="#41927736">parent</a><span>|</span><a href="#41931960">next</a><span>|</span><label class="collapse" for="c-41928116">[-]</label><label class="expand" for="c-41928116">[1 more]</label></div><br/><div class="children"><div class="content">Indeed, it does deal with the message loss. I was momentarily confused because in my many thousands of bullet chess games on Lichess I haven&#x27;t had much of any message loss that can be attributed to Lichess&#x27;s servers (but plenty when my Internet connection is down or unstable).<p>I will have to take a look, because whatever it&#x27;s doing, it works very well!</div><br/></div></div><div id="41931960" class="c"><input type="checkbox" id="c-41931960" checked=""/><div class="controls bullet"><span class="by">MathMonkeyMan</span><span>|</span><a href="#41927736">parent</a><span>|</span><a href="#41928116">prev</a><span>|</span><a href="#41929140">next</a><span>|</span><label class="collapse" for="c-41931960">[-]</label><label class="expand" for="c-41931960">[1 more]</label></div><br/><div class="children"><div class="content">I have no idea, but the in-house pub&#x2F;sub tech at a previous job used [PGM][1] together with some hand-written brokers and a client library. The overall delivery guarantee is at-most-once, but in over ten years and across tens of thousands of machines in multiple datacenters, they never saw a single dropped message. Not sure how they measured that, but I was told the measurements were accurate.<p>Well, except for that one major outage where everything shit the bed due to some misconfiguration of IP multicast in the datacenters, or so I was told.<p>So, maybe if your mission isn&#x27;t life critical, you can just wrongfully assume exactly-once delivery.<p>[1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Pragmatic_General_Multicast" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Pragmatic_General_Multicast</a></div><br/></div></div><div id="41929140" class="c"><input type="checkbox" id="c-41929140" checked=""/><div class="controls bullet"><span class="by">DylanSp</span><span>|</span><a href="#41927736">parent</a><span>|</span><a href="#41931960">prev</a><span>|</span><a href="#41931206">next</a><span>|</span><label class="collapse" for="c-41929140">[-]</label><label class="expand" for="c-41929140">[1 more]</label></div><br/><div class="children"><div class="content">I was hoping for that too, that&#x27;s the kind of interesting architectural question I wanted this article to answer.</div><br/></div></div></div></div><div id="41931206" class="c"><input type="checkbox" id="c-41931206" checked=""/><div class="controls bullet"><span class="by">evrydayhustling</span><span>|</span><a href="#41927736">prev</a><span>|</span><a href="#41928463">next</a><span>|</span><label class="collapse" for="c-41931206">[-]</label><label class="expand" for="c-41931206">[1 more]</label></div><br/><div class="children"><div class="content">It seems shocking to me that the server enumerates and transmits all legal next-moves.  I get that there could be chess variants with server side information, but the article also says it might be good for constrained clients.  Is it really cheaper to read moves off a serialized interface than to compute them client side??</div><br/></div></div><div id="41928463" class="c"><input type="checkbox" id="c-41928463" checked=""/><div class="controls bullet"><span class="by">d4rti</span><span>|</span><a href="#41931206">prev</a><span>|</span><a href="#41929894">next</a><span>|</span><label class="collapse" for="c-41928463">[-]</label><label class="expand" for="c-41928463">[2 more]</label></div><br/><div class="children"><div class="content">I suspect the “l” parameter is for observed latency as the client displays observed latency from the server.</div><br/><div id="41928781" class="c"><input type="checkbox" id="c-41928781" checked=""/><div class="controls bullet"><span class="by">lxgr</span><span>|</span><a href="#41928463">parent</a><span>|</span><a href="#41929894">next</a><span>|</span><label class="collapse" for="c-41928781">[-]</label><label class="expand" for="c-41928781">[1 more]</label></div><br/><div class="children"><div class="content">Lichess also compensates for latency to some extent.<p>To do that, the server needs some measure of “how long does the client think the player actually took to make a move”, to later subtract latency not attributable to actual thinking from the clock.</div><br/></div></div></div></div><div id="41929894" class="c"><input type="checkbox" id="c-41929894" checked=""/><div class="controls bullet"><span class="by">burgerquizz</span><span>|</span><a href="#41928463">prev</a><span>|</span><a href="#41928498">next</a><span>|</span><label class="collapse" for="c-41929894">[-]</label><label class="expand" for="c-41929894">[2 more]</label></div><br/><div class="children"><div class="content">how would you protect your websocket server? I am building a game, but when I put the domain behind (free plan) cloudflare, I get latency delay (3x slower) on the players events.<p>Saw CF had some paying solution, but was wondering about a free solution</div><br/><div id="41930311" class="c"><input type="checkbox" id="c-41930311" checked=""/><div class="controls bullet"><span class="by">NathanFlurry</span><span>|</span><a href="#41929894">parent</a><span>|</span><a href="#41928498">next</a><span>|</span><label class="collapse" for="c-41930311">[-]</label><label class="expand" for="c-41930311">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been managing game servers that get attacked on a daily basis for almost a decade. I&#x27;ve tried Cloudflare a few times (on their business plan) and seen poor results every time.<p>Cloudflare has a lower latency product called Argo Smart Routing [1]. When we tried Argo in 2020, we still saw 10+ ms increased latency across the board, which is unacceptable for competitive multiplayer games. That said, Discord voice still (or used to) uses Argo for voice, so there are certainly less latency-sensitive games where it would work well.<p>The other issue with sockets over Cloudflare (circa 2020 on business plan) is they get terminate liberally with the assumption you have a reconnection mechanism in place. I&#x27;d imagine this is acceptable for traditional WebSocket use cases, but not for games.<p>Services like OVH &amp; Vultr also advertise &quot;DDoS protection for games,&quot; but I&#x27;ve found these to be pretty useless in practice. We can only measure traffic that reaches our game servers, so I have no way of knowing if they&#x27;re actually helping at all.<p>Your best bet is getting familiar with iptables and fine-tuning rules to match your game&#x27;s traffic patterns. Thankfully, LLMs are pretty good at generating these rules for you nowadays if you&#x27;re not already familiar with these tools. Make sure to set up something like node-exporter to be able to monitor attacks and understand where things go wrong. There have been a few other posts on HN in the past that go into more depth about game server DoS mitigation [2] [3].<p>I built something in the same vein for my startup (Apache 2.0 OSS, steal our code!) [4] that runs a series of load balancers in front of game servers in order to act like a mini-Cloudflare. In addition to the basics I already listed, we also have logic under the hood that (a) dynamically routes traffic to load balancers and (b) autoscales hardware based on traffic in order to absorb attacks. We&#x27;re rolling out a dynamic bot attack &amp; mitigation mechanism soon to handle more complex patterns.<p>[1] <a href="https:&#x2F;&#x2F;www.cloudflare.com&#x2F;application-services&#x2F;products&#x2F;argo-smart-routing&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.cloudflare.com&#x2F;application-services&#x2F;products&#x2F;arg...</a><p>[2] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35771466">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35771466</a><p>[3] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28675094">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28675094</a><p>[4] <a href="https:&#x2F;&#x2F;github.com&#x2F;rivet-gg&#x2F;rivet">https:&#x2F;&#x2F;github.com&#x2F;rivet-gg&#x2F;rivet</a></div><br/></div></div></div></div><div id="41928498" class="c"><input type="checkbox" id="c-41928498" checked=""/><div class="controls bullet"><span class="by">zxilly</span><span>|</span><a href="#41929894">prev</a><span>|</span><a href="#41928907">next</a><span>|</span><label class="collapse" for="c-41928498">[-]</label><label class="expand" for="c-41928498">[8 more]</label></div><br/><div class="children"><div class="content">I wonder why this protocol needs an ack? a websocket wrapped in a tls should be perfectly capable of guaranteeing the integrity of the message</div><br/><div id="41928829" class="c"><input type="checkbox" id="c-41928829" checked=""/><div class="controls bullet"><span class="by">parl_match</span><span>|</span><a href="#41928498">parent</a><span>|</span><a href="#41928509">next</a><span>|</span><label class="collapse" for="c-41928829">[-]</label><label class="expand" for="c-41928829">[1 more]</label></div><br/><div class="children"><div class="content">That just means that the message hit the TLS terminator. It doesn&#x27;t mean that the backend logic received the state change.</div><br/></div></div><div id="41928509" class="c"><input type="checkbox" id="c-41928509" checked=""/><div class="controls bullet"><span class="by">andai</span><span>|</span><a href="#41928498">parent</a><span>|</span><a href="#41928829">prev</a><span>|</span><a href="#41928608">next</a><span>|</span><label class="collapse" for="c-41928509">[-]</label><label class="expand" for="c-41928509">[4 more]</label></div><br/><div class="children"><div class="content">You can verify this with ten lines of code and clumsy (a tool for simulating packet loss).<p>I tried this and not all the messages I sent arrived.</div><br/><div id="41928601" class="c"><input type="checkbox" id="c-41928601" checked=""/><div class="controls bullet"><span class="by">enneff</span><span>|</span><a href="#41928498">root</a><span>|</span><a href="#41928509">parent</a><span>|</span><a href="#41928608">next</a><span>|</span><label class="collapse" for="c-41928601">[-]</label><label class="expand" for="c-41928601">[3 more]</label></div><br/><div class="children"><div class="content">What do you mean? If you open a web socket connection it should behave like a normal TCP connection. All sent data guaranteed to be delivered complete and in order, unless the connection fails.</div><br/><div id="41928646" class="c"><input type="checkbox" id="c-41928646" checked=""/><div class="controls bullet"><span class="by">mananaysiempre</span><span>|</span><a href="#41928498">root</a><span>|</span><a href="#41928601">parent</a><span>|</span><a href="#41928608">next</a><span>|</span><label class="collapse" for="c-41928646">[-]</label><label class="expand" for="c-41928646">[2 more]</label></div><br/><div class="children"><div class="content">Unless the connection fails, at which point you have no idea <i>when</i> it failed. You know that the other side received all stream offsets within [initial, X] with X ≥ last received ACK, but other than that you have no idea what X is. Even getting the last received ACK value out of whatever API or upper-level protocol you’re using could be nontrivial, because people rarely bother.</div><br/></div></div></div></div></div></div><div id="41928608" class="c"><input type="checkbox" id="c-41928608" checked=""/><div class="controls bullet"><span class="by">enneff</span><span>|</span><a href="#41928498">parent</a><span>|</span><a href="#41928509">prev</a><span>|</span><a href="#41928737">next</a><span>|</span><label class="collapse" for="c-41928608">[-]</label><label class="expand" for="c-41928608">[1 more]</label></div><br/><div class="children"><div class="content">So that the client knows the message has been delivered and handled by the server, which can make the UI indicate the state of the connection.</div><br/></div></div><div id="41928737" class="c"><input type="checkbox" id="c-41928737" checked=""/><div class="controls bullet"><span class="by">augusto-moura</span><span>|</span><a href="#41928498">parent</a><span>|</span><a href="#41928608">prev</a><span>|</span><a href="#41928907">next</a><span>|</span><label class="collapse" for="c-41928737">[-]</label><label class="expand" for="c-41928737">[1 more]</label></div><br/><div class="children"><div class="content">Maybe authorization, illegal moves? Don&#x27;t know the full protocol to know how they handle edge cases. They might just return a NACK</div><br/></div></div></div></div><div id="41928907" class="c"><input type="checkbox" id="c-41928907" checked=""/><div class="controls bullet"><span class="by">bobmcnamara</span><span>|</span><a href="#41928498">prev</a><span>|</span><a href="#41930266">next</a><span>|</span><label class="collapse" for="c-41928907">[-]</label><label class="expand" for="c-41928907">[6 more]</label></div><br/><div class="children"><div class="content">nit: fen only encodes board state, not game state<p>Edit: also includes move count but not repetition.</div><br/><div id="41929083" class="c"><input type="checkbox" id="c-41929083" checked=""/><div class="controls bullet"><span class="by">xrisk</span><span>|</span><a href="#41928907">parent</a><span>|</span><a href="#41930266">next</a><span>|</span><label class="collapse" for="c-41929083">[-]</label><label class="expand" for="c-41929083">[5 more]</label></div><br/><div class="children"><div class="content">How is the game state not just the board state? Move history doesn’t matter in chess (FEN encodes the 50 move rule)</div><br/><div id="41929171" class="c"><input type="checkbox" id="c-41929171" checked=""/><div class="controls bullet"><span class="by">andrewaylett</span><span>|</span><a href="#41928907">root</a><span>|</span><a href="#41929083">parent</a><span>|</span><a href="#41932843">next</a><span>|</span><label class="collapse" for="c-41929171">[-]</label><label class="expand" for="c-41929171">[1 more]</label></div><br/><div class="children"><div class="content">Per Wikipedia, it doesn&#x27;t encode the threefold repetition rule.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Forsyth%E2%80%93Edwards_Notation" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Forsyth%E2%80%93Edwards_Notati...</a></div><br/></div></div><div id="41932843" class="c"><input type="checkbox" id="c-41932843" checked=""/><div class="controls bullet"><span class="by">kzrdude</span><span>|</span><a href="#41928907">root</a><span>|</span><a href="#41929083">parent</a><span>|</span><a href="#41929171">prev</a><span>|</span><a href="#41929225">next</a><span>|</span><label class="collapse" for="c-41932843">[-]</label><label class="expand" for="c-41932843">[1 more]</label></div><br/><div class="children"><div class="content">Unfortunately move history does matter</div><br/></div></div><div id="41929225" class="c"><input type="checkbox" id="c-41929225" checked=""/><div class="controls bullet"><span class="by">anamexis</span><span>|</span><a href="#41928907">root</a><span>|</span><a href="#41929083">parent</a><span>|</span><a href="#41932843">prev</a><span>|</span><a href="#41929210">next</a><span>|</span><label class="collapse" for="c-41929225">[-]</label><label class="expand" for="c-41929225">[1 more]</label></div><br/><div class="children"><div class="content">Indeed, the 50 move rule, as well as castling rights, whose move it is, and whether any pawns are currently eligible for en passant.</div><br/></div></div><div id="41929210" class="c"><input type="checkbox" id="c-41929210" checked=""/><div class="controls bullet"><span class="by">michaelmarkell</span><span>|</span><a href="#41928907">root</a><span>|</span><a href="#41929083">parent</a><span>|</span><a href="#41929225">prev</a><span>|</span><a href="#41930266">next</a><span>|</span><label class="collapse" for="c-41929210">[-]</label><label class="expand" for="c-41929210">[1 more]</label></div><br/><div class="children"><div class="content">Timing of moves</div><br/></div></div></div></div></div></div><div id="41930266" class="c"><input type="checkbox" id="c-41930266" checked=""/><div class="controls bullet"><span class="by">jackcviers3</span><span>|</span><a href="#41928907">prev</a><span>|</span><a href="#41928039">next</a><span>|</span><label class="collapse" for="c-41930266">[-]</label><label class="expand" for="c-41930266">[2 more]</label></div><br/><div class="children"><div class="content">And scalachess is written in scala, to piggyback off a post earlier this month that claimed the language is dead. The project is very successful and has been around and maintained for years.</div><br/><div id="41930940" class="c"><input type="checkbox" id="c-41930940" checked=""/><div class="controls bullet"><span class="by">valenterry</span><span>|</span><a href="#41930266">parent</a><span>|</span><a href="#41928039">next</a><span>|</span><label class="collapse" for="c-41930940">[-]</label><label class="expand" for="c-41930940">[1 more]</label></div><br/><div class="children"><div class="content">If all the Rust people knew how nice Scala 3 as a language is... they would be surprised.<p>What still isn&#x27;t great is the ecosystem and the build-tooling compared to Rust (part of it because of the JVM). But just language-wise, it basically has all the goodies of Rust and much more. Ofc. it&#x27;s easier for Scala to have that because it does not have to balance against zero-overhead abstraction like Rust does.<p>Still, Scala was hyped at some point (and I find it wasn&#x27;t justified). But now, the language is actually one if not the best of very-high-level-languages that is used in production and not just academic. It&#x27;s kind of sad to see, that it does not receive more traction, but it does not have the marketing budget of, say, golang.</div><br/></div></div></div></div><div id="41928039" class="c"><input type="checkbox" id="c-41928039" checked=""/><div class="controls bullet"><span class="by">shironandon</span><span>|</span><a href="#41930266">prev</a><span>|</span><a href="#41929075">next</a><span>|</span><label class="collapse" for="c-41928039">[-]</label><label class="expand" for="c-41928039">[4 more]</label></div><br/><div class="children"><div class="content">what happens to those websocket connections when the API is updated or redeployed?</div><br/><div id="41928626" class="c"><input type="checkbox" id="c-41928626" checked=""/><div class="controls bullet"><span class="by">paxys</span><span>|</span><a href="#41928039">parent</a><span>|</span><a href="#41928103">next</a><span>|</span><label class="collapse" for="c-41928626">[-]</label><label class="expand" for="c-41928626">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s pretty easy to build auto reconnect capability in the client. The server will drop all its connections and go out of rotation, and the client will start a new connection and find the new one. If the switch happens fast enough then the user shouldn&#x27;t even notice.</div><br/></div></div><div id="41928103" class="c"><input type="checkbox" id="c-41928103" checked=""/><div class="controls bullet"><span class="by">zazaulola</span><span>|</span><a href="#41928039">parent</a><span>|</span><a href="#41928626">prev</a><span>|</span><a href="#41929075">next</a><span>|</span><label class="collapse" for="c-41928103">[-]</label><label class="expand" for="c-41928103">[2 more]</label></div><br/><div class="children"><div class="content">It is to be expected that LLM will make a decision on its own if it suspects any changes to the API. In any case, there is no time to fix the code during the game.</div><br/><div id="41928337" class="c"><input type="checkbox" id="c-41928337" checked=""/><div class="controls bullet"><span class="by">VoidWhisperer</span><span>|</span><a href="#41928039">root</a><span>|</span><a href="#41928103">parent</a><span>|</span><a href="#41929075">next</a><span>|</span><label class="collapse" for="c-41928337">[-]</label><label class="expand" for="c-41928337">[1 more]</label></div><br/><div class="children"><div class="content">They werent talking about an LLM here</div><br/></div></div></div></div></div></div><div id="41929075" class="c"><input type="checkbox" id="c-41929075" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#41928039">prev</a><span>|</span><a href="#41928267">next</a><span>|</span><label class="collapse" for="c-41929075">[-]</label><label class="expand" for="c-41929075">[1 more]</label></div><br/><div class="children"><div class="content">As I understand, the separation between Lila and Lila-ws is primarily for fault isolation rather than independent scaling. Maybe independent scaling becomes useful if websocket overhead exceeds what one machine can handle.</div><br/></div></div><div id="41928267" class="c"><input type="checkbox" id="c-41928267" checked=""/><div class="controls bullet"><span class="by">sam0x17</span><span>|</span><a href="#41929075">prev</a><span>|</span><a href="#41928658">next</a><span>|</span><label class="collapse" for="c-41928267">[-]</label><label class="expand" for="c-41928267">[4 more]</label></div><br/><div class="children"><div class="content">20 years later I still think &quot;female lich&quot; whenever I see the word lichess, even though I know it&#x27;s li chess.</div><br/><div id="41928450" class="c"><input type="checkbox" id="c-41928450" checked=""/><div class="controls bullet"><span class="by">Suppafly</span><span>|</span><a href="#41928267">parent</a><span>|</span><a href="#41928854">next</a><span>|</span><label class="collapse" for="c-41928450">[-]</label><label class="expand" for="c-41928450">[1 more]</label></div><br/><div class="children"><div class="content">makes me think of the Asian fruit.</div><br/></div></div><div id="41928854" class="c"><input type="checkbox" id="c-41928854" checked=""/><div class="controls bullet"><span class="by">AlienRobot</span><span>|</span><a href="#41928267">parent</a><span>|</span><a href="#41928450">prev</a><span>|</span><a href="#41928413">next</a><span>|</span><label class="collapse" for="c-41928854">[-]</label><label class="expand" for="c-41928854">[1 more]</label></div><br/><div class="children"><div class="content">When you promote a pawn to queen that&#x27;s actually the lichess.</div><br/></div></div><div id="41928413" class="c"><input type="checkbox" id="c-41928413" checked=""/><div class="controls bullet"><span class="by">Keyframe</span><span>|</span><a href="#41928267">parent</a><span>|</span><a href="#41928854">prev</a><span>|</span><a href="#41928658">next</a><span>|</span><label class="collapse" for="c-41928413">[-]</label><label class="expand" for="c-41928413">[1 more]</label></div><br/><div class="children"><div class="content">there are more of us then!</div><br/></div></div></div></div><div id="41928658" class="c"><input type="checkbox" id="c-41928658" checked=""/><div class="controls bullet"><span class="by">blastro</span><span>|</span><a href="#41928267">prev</a><span>|</span><a href="#41927846">next</a><span>|</span><label class="collapse" for="c-41928658">[-]</label><label class="expand" for="c-41928658">[8 more]</label></div><br/><div class="children"><div class="content">lichess is one of the best sites on the internet. very happy to contribute my $5&#x2F;mo</div><br/><div id="41929119" class="c"><input type="checkbox" id="c-41929119" checked=""/><div class="controls bullet"><span class="by">hilux</span><span>|</span><a href="#41928658">parent</a><span>|</span><a href="#41928752">next</a><span>|</span><label class="collapse" for="c-41929119">[-]</label><label class="expand" for="c-41929119">[3 more]</label></div><br/><div class="children"><div class="content">Hello, fellow Patron!<p>Even though nowadays I hardly have time to play, I&#x27;m still happy to support such a delightfully honorable and usable(!) open-source project.</div><br/><div id="41930223" class="c"><input type="checkbox" id="c-41930223" checked=""/><div class="controls bullet"><span class="by">dankwizard</span><span>|</span><a href="#41928658">root</a><span>|</span><a href="#41929119">parent</a><span>|</span><a href="#41928752">next</a><span>|</span><label class="collapse" for="c-41930223">[-]</label><label class="expand" for="c-41930223">[2 more]</label></div><br/><div class="children"><div class="content">People love mentioning that they donate to LiChess.<p>It&#x27;s a weird trend. Altruism truly does not exist<p>(I donated btw)
(Probably more than you)
(But who&#x27;s counting)</div><br/><div id="41930364" class="c"><input type="checkbox" id="c-41930364" checked=""/><div class="controls bullet"><span class="by">hilux</span><span>|</span><a href="#41928658">root</a><span>|</span><a href="#41930223">parent</a><span>|</span><a href="#41928752">next</a><span>|</span><label class="collapse" for="c-41930364">[-]</label><label class="expand" for="c-41930364">[1 more]</label></div><br/><div class="children"><div class="content">You must be fun at parties.</div><br/></div></div></div></div></div></div><div id="41928752" class="c"><input type="checkbox" id="c-41928752" checked=""/><div class="controls bullet"><span class="by">trod123</span><span>|</span><a href="#41928658">parent</a><span>|</span><a href="#41929119">prev</a><span>|</span><a href="#41927846">next</a><span>|</span><label class="collapse" for="c-41928752">[-]</label><label class="expand" for="c-41928752">[4 more]</label></div><br/><div class="children"><div class="content">If you consider this to be true, you would seem to have a rather low standard.<p>There are many aspects in which they are not the best.</div><br/><div id="41928959" class="c"><input type="checkbox" id="c-41928959" checked=""/><div class="controls bullet"><span class="by">dibyadarshan</span><span>|</span><a href="#41928658">root</a><span>|</span><a href="#41928752">parent</a><span>|</span><a href="#41927846">next</a><span>|</span><label class="collapse" for="c-41928959">[-]</label><label class="expand" for="c-41928959">[3 more]</label></div><br/><div class="children"><div class="content">Like?<p>Ad-free, compute intensive, non-CRUD, massively scaled, complex cheat moderation, infinite puzzles&#x2F;analysis, educational (studies&#x2F;tactics&#x2F;openings explorer), etc. All this for free. I&#x27;m curious what&#x27;s the best website in your opinion</div><br/><div id="41932863" class="c"><input type="checkbox" id="c-41932863" checked=""/><div class="controls bullet"><span class="by">trod123</span><span>|</span><a href="#41928658">root</a><span>|</span><a href="#41928959">parent</a><span>|</span><a href="#41927846">next</a><span>|</span><label class="collapse" for="c-41932863">[-]</label><label class="expand" for="c-41932863">[2 more]</label></div><br/><div class="children"><div class="content">I could elaborate, but rather, let me ask you this instead since its more relevant.<p>What is the point of responding with any legitimate criticism when any potentially negative sentiment however mild, upfront, expressing disagreement, gets downvoted to the point where the mechanics of the website squelches the person and silences them (by purposeful intent).<p>Can you ever have any legitimate intelligent conversation after a participant has been harmed and effectively silenced in this way?<p>When you cannot speak freely, there can be no intelligent communications raising the bar objectively. The opposite occurs, and anything provided, even seemingly rational conversation falls after such a threat or action of violence, all conversation then falls into the gutter as a result of the added coercive cost imposed. You may contend that its not violence, but it meets the WHO definition for such which properly accounts for psychological torture and coercion (of which this is a common form).<p>It should go without saying, but you cannot have any intelligent conversation when those who embrace totalitarian methods prevent you from speaking (and yes these meet the criteria).<p>At the point this happens, regardless of valid criticism, or pointing out errors in methodology, it all dies on the vine, the communication is clear; you will be punished for disagreeing. That destructive behavior inevitably leads to ruin.<p>This is fairly basic stuff, in order to think and be intelligent, one must be able to risk being offensive. In order to learn something new, one must risk being offended.<p>When neither are possible because you or someone else muzzles any conversation expressing disagreement or corrosively add cost, even under such modest terms as here, the fallout is silent, yet devastating.<p>It might not seem like much, but the light goes out of the world as those with intelligence withdraw their support, and the natural consequences which were held at bay by these people, albeit slow moving, become inevitable.<p>Best of luck to you. There is only the possibility of harm by continuing any discussion under these circumstances.<p>I&#x27;d suggest remembering this when you start wondering, &quot;where have all the intelligent and competent people gone?&quot;.<p>Silence doesn&#x27;t indicate agreement. It is indicative of the best and brightest no longer contributing to the same systems that seek to destroy or enslave them.</div><br/><div id="41933362" class="c"><input type="checkbox" id="c-41933362" checked=""/><div class="controls bullet"><span class="by">palata</span><span>|</span><a href="#41928658">root</a><span>|</span><a href="#41932863">parent</a><span>|</span><a href="#41927846">next</a><span>|</span><label class="collapse" for="c-41933362">[-]</label><label class="expand" for="c-41933362">[1 more]</label></div><br/><div class="children"><div class="content">It seems like your negative sentiment above has been downvoted a lot, and I understand your frustration. Your comment was indeed not offensive.<p>But I believe it was just that: a negative sentiment. Not exactly a &quot;constructive, intelligent criticism&quot;. And when you go there, the reality is that people will vote to reflect their own opinion. If you say &quot;This project is so amazing!&quot; and get a ton of upvotes, it does not mean that your comment is super useful; just that many people agree. Similarly, if you say &quot;Naah, it sucks&quot; and get a ton of downvotes, it means that many people disagree. Not that they want to silent you.<p>Now try an actual constructive criticism: you may get downvotes (that&#x27;s how it is because people are emotional beings), but probably upvotes as well if you bring interesting insights.<p>&gt; There is only the possibility of harm by continuing any discussion under these circumstances.<p>That&#x27;s fair. I think one mistake there is that you should have started with a constructive criticism rather than an admittedly polite &quot;naaaah, I think it sucks&quot;.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41927846" class="c"><input type="checkbox" id="c-41927846" checked=""/><div class="controls bullet"><span class="by">ilrwbwrkhv</span><span>|</span><a href="#41928658">prev</a><span>|</span><a href="#41929335">next</a><span>|</span><label class="collapse" for="c-41927846">[-]</label><label class="expand" for="c-41927846">[16 more]</label></div><br/><div class="children"><div class="content">Beautiful architecture. Startups and companies like Netflix should learn from this instead of cargo culting microservices.</div><br/><div id="41928622" class="c"><input type="checkbox" id="c-41928622" checked=""/><div class="controls bullet"><span class="by">enneff</span><span>|</span><a href="#41927846">parent</a><span>|</span><a href="#41928329">next</a><span>|</span><label class="collapse" for="c-41928622">[-]</label><label class="expand" for="c-41928622">[3 more]</label></div><br/><div class="children"><div class="content">And what exactly do you think lila, lila-ws, and redis are if not microservices (or as they should be called, “services”)? Lichess could easily be implemented as a single monolithic process but it is not.</div><br/><div id="41929165" class="c"><input type="checkbox" id="c-41929165" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928622">parent</a><span>|</span><a href="#41928329">next</a><span>|</span><label class="collapse" for="c-41929165">[-]</label><label class="expand" for="c-41929165">[2 more]</label></div><br/><div class="children"><div class="content">They are services, but not micro. lila-ws spun off of Lila for a good reason (fault isolation) and not because &quot;let&#x27;s make everything a service&quot;. And they don&#x27;t follow any standard microservice pattern - a reverse proxy isn&#x27;t a microservice.</div><br/><div id="41930826" class="c"><input type="checkbox" id="c-41930826" checked=""/><div class="controls bullet"><span class="by">enneff</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41929165">parent</a><span>|</span><a href="#41928329">next</a><span>|</span><label class="collapse" for="c-41930826">[-]</label><label class="expand" for="c-41930826">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;lila?tab=readme-ov-file#production-architecture-as-of-july-2022">https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;lila?tab=readme-ov-file#produ...</a></div><br/></div></div></div></div></div></div><div id="41928329" class="c"><input type="checkbox" id="c-41928329" checked=""/><div class="controls bullet"><span class="by">ajkjk</span><span>|</span><a href="#41927846">parent</a><span>|</span><a href="#41928622">prev</a><span>|</span><a href="#41929335">next</a><span>|</span><label class="collapse" for="c-41928329">[-]</label><label class="expand" for="c-41928329">[12 more]</label></div><br/><div class="children"><div class="content">What? Do you have some reason to think Netflix&#x27;s architecture is deficient?</div><br/><div id="41928469" class="c"><input type="checkbox" id="c-41928469" checked=""/><div class="controls bullet"><span class="by">paxys</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928329">parent</a><span>|</span><a href="#41928331">next</a><span>|</span><label class="collapse" for="c-41928469">[-]</label><label class="expand" for="c-41928469">[1 more]</label></div><br/><div class="children"><div class="content">Because the top 5 comments on HN always say so, so it must be true.</div><br/></div></div><div id="41928331" class="c"><input type="checkbox" id="c-41928331" checked=""/><div class="controls bullet"><span class="by">ilrwbwrkhv</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928329">parent</a><span>|</span><a href="#41928469">prev</a><span>|</span><a href="#41929335">next</a><span>|</span><label class="collapse" for="c-41928331">[-]</label><label class="expand" for="c-41928331">[10 more]</label></div><br/><div class="children"><div class="content">Overly complicated with microservices. Can be made 10x simpler.</div><br/><div id="41928385" class="c"><input type="checkbox" id="c-41928385" checked=""/><div class="controls bullet"><span class="by">LinuxAmbulance</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928331">parent</a><span>|</span><a href="#41931000">next</a><span>|</span><label class="collapse" for="c-41928385">[-]</label><label class="expand" for="c-41928385">[8 more]</label></div><br/><div class="children"><div class="content">Sometimes simplicity is not the best goal.<p>Redundancy, scalability, decoupling, resilience, best possible handling of errors, cost optimization, etc. may be more important at the scale Netflix operates at.</div><br/><div id="41928778" class="c"><input type="checkbox" id="c-41928778" checked=""/><div class="controls bullet"><span class="by">lcnPylGDnU4H9OF</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928385">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41928778">[-]</label><label class="expand" for="c-41928778">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Redundancy, scalability, decoupling, resilience, best possible handling of errors, cost optimization, etc. may be more important at the scale Netflix operates at.<p>So much that they built a tool to intentionally make things difficult (read: it arbitrarily stops production system processes&#x2F;containers&#x2F;etc.) and help inform what decisions to make in favor of fault tolerance.<p>&gt; Exposing engineers to failures more frequently incentivizes them to build resilient services.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;Netflix&#x2F;chaosmonkey">https:&#x2F;&#x2F;github.com&#x2F;Netflix&#x2F;chaosmonkey</a><p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Chaos_engineering" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Chaos_engineering</a></div><br/><div id="41929120" class="c"><input type="checkbox" id="c-41929120" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928778">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41929120">[-]</label><label class="expand" for="c-41929120">[5 more]</label></div><br/><div class="children"><div class="content">Embarrassing. I built 99% of Netflix functionality locally with VLC and a subdirectory of mkv files.</div><br/><div id="41930163" class="c"><input type="checkbox" id="c-41930163" checked=""/><div class="controls bullet"><span class="by">trashburger</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41929120">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41930163">[-]</label><label class="expand" for="c-41930163">[4 more]</label></div><br/><div class="children"><div class="content">Good for you. Now please aim 10,000 requests a second at your file server.</div><br/><div id="41930323" class="c"><input type="checkbox" id="c-41930323" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41930163">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41930323">[-]</label><label class="expand" for="c-41930323">[3 more]</label></div><br/><div class="children"><div class="content">Because I don&#x27;t use microservices, I don&#x27;t need 10,000 requests a second to play a video file.</div><br/><div id="41931423" class="c"><input type="checkbox" id="c-41931423" checked=""/><div class="controls bullet"><span class="by">achierius</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41930323">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41931423">[-]</label><label class="expand" for="c-41931423">[2 more]</label></div><br/><div class="children"><div class="content">I think the point was 10,000 files on 10,000 different hosts, per second.</div><br/><div id="41932047" class="c"><input type="checkbox" id="c-41932047" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41931423">parent</a><span>|</span><a href="#41929287">next</a><span>|</span><label class="collapse" for="c-41932047">[-]</label><label class="expand" for="c-41932047">[1 more]</label></div><br/><div class="children"><div class="content">Well, if they’re only watching one second of video that’s easy. The files could be super small too.<p>Okay, I can’t keep this up. I was parodying the position not being serious.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="41929287" class="c"><input type="checkbox" id="c-41929287" checked=""/><div class="controls bullet"><span class="by">ilrwbwrkhv</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928385">parent</a><span>|</span><a href="#41928778">prev</a><span>|</span><a href="#41931000">next</a><span>|</span><label class="collapse" for="c-41929287">[-]</label><label class="expand" for="c-41929287">[1 more]</label></div><br/><div class="children"><div class="content">For Netflix level of complexity. Pornhub has more traffic and serves more customer than Netflix with monolithic PHP and some services.</div><br/></div></div></div></div><div id="41931000" class="c"><input type="checkbox" id="c-41931000" checked=""/><div class="controls bullet"><span class="by">ajkjk</span><span>|</span><a href="#41927846">root</a><span>|</span><a href="#41928331">parent</a><span>|</span><a href="#41928385">prev</a><span>|</span><a href="#41929335">next</a><span>|</span><label class="collapse" for="c-41931000">[-]</label><label class="expand" for="c-41931000">[1 more]</label></div><br/><div class="children"><div class="content">You know something about their internal architecture and why it was built that way and the tradeoffs involved, I guess?</div><br/></div></div></div></div></div></div></div></div><div id="41929335" class="c"><input type="checkbox" id="c-41929335" checked=""/><div class="controls bullet"><span class="by">huins</span><span>|</span><a href="#41927846">prev</a><span>|</span><label class="collapse" for="c-41929335">[-]</label><label class="expand" for="c-41929335">[2 more]</label></div><br/><div class="children"><div class="content">&gt; - l: Probably some length?<p>I don&#x27;t understand why the author didn&#x27;t just look this up in the source code. Lichess is open source and we can see exactly what this field is here, it&#x27;s the average lag:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;lila&#x2F;blob&#x2F;45b5f0cfbbf6c045ad774bba1b781b7a688e0612&#x2F;ui&#x2F;common&#x2F;src&#x2F;socket.ts#L159">https:&#x2F;&#x2F;github.com&#x2F;lichess-org&#x2F;lila&#x2F;blob&#x2F;45b5f0cfbbf6c045ad7...</a><p><pre><code>  send = (t: string, d: any, o: any = {}, noRetry = false): void =&gt; {
    const msg: Partial&lt;MsgOut&gt; = { t };
    if (d !== undefined) {
      if (o.withLag) d.l = Math.round(this.averageLag);
      if (o.millis &gt;= 0) d.s = Math.round(o.millis * 0.1).toString(36);
      msg.d = d;
    }
    if (o.ackable) {
      msg.d = msg.d || {}; &#x2F;&#x2F; can&#x27;t ack message without data
      this.ackable.register(t, msg.d); &#x2F;&#x2F; adds d.a, the ack ID we expect to get back
    }

    const message = JSON.stringify(msg);
    ...
</code></pre>
Which is calculated from how long the server takes to respond to ping messages that the client sends:<p><pre><code>  private schedulePing = (delay: number): void =&gt; {
    clearTimeout(this.pingSchedule);
    this.pingSchedule = setTimeout(this.pingNow, delay);
  };

  private pingNow = (): void =&gt; {
    clearTimeout(this.pingSchedule);
    clearTimeout(this.connectSchedule);
    const pingData =
      this.options.isAuth &amp;&amp; this.pongCount % 10 == 2
        ? JSON.stringify({
            t: &#x27;p&#x27;,
            l: Math.round(0.1 * this.averageLag),
          })
        : &#x27;null&#x27;;
    try {
      this.ws!.send(pingData);
      this.lastPingTime = performance.now();
    } catch (e) {
      this.debug(e, true);
    }
    this.scheduleConnect();
  };

  private computePingDelay = (): number =&gt; this.options.pingDelay + (this.options.idle ? 1000 : 0);

  private pong = (): void =&gt; {
    clearTimeout(this.connectSchedule);
    this.schedulePing(this.computePingDelay());
    const currentLag = Math.min(performance.now() - this.lastPingTime, 10000);
    this.pongCount++;

    &#x2F;&#x2F; Average first 4 pings, then switch to decaying average.
    const mix = this.pongCount &gt; 4 ? 0.1 : 1 &#x2F; this.pongCount;
    this.averageLag += mix * (currentLag - this.averageLag);

    pubsub.emit(&#x27;socket.lag&#x27;, this.averageLag);
    this.updateStats(currentLag);
  };</code></pre></div><br/><div id="41930276" class="c"><input type="checkbox" id="c-41930276" checked=""/><div class="controls bullet"><span class="by">stevage</span><span>|</span><a href="#41929335">parent</a><span>|</span><label class="collapse" for="c-41930276">[-]</label><label class="expand" for="c-41930276">[1 more]</label></div><br/><div class="children"><div class="content">To be fair, the author already put tons of work into this post. Don&#x27;t begrudge them for not doing even more.</div><br/></div></div></div></div></div></div></div></div></div></body></html>