<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727773257269" as="style"/><link rel="stylesheet" href="styles.css?v=1727773257269"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lucumr.pocoo.org/2024/9/9/multiversion-python/">Multiversion Python Thoughts</a> <span class="domain">(<a href="https://lucumr.pocoo.org">lucumr.pocoo.org</a>)</span></div><div class="subtext"><span>divbzero</span> | <span>10 comments</span></div><br/><div><div id="41705865" class="c"><input type="checkbox" id="c-41705865" checked=""/><div class="controls bullet"><span class="by">andrewchambers</span><span>|</span><a href="#41706009">next</a><span>|</span><label class="collapse" for="c-41705865">[-]</label><label class="expand" for="c-41705865">[5 more]</label></div><br/><div class="children"><div class="content">I feel like most of these problems just disappear if people would follow the same naming scheme sqlite3 uses. Just put the major version in the name and most tools just work out of the box with multiple versions.</div><br/><div id="41706088" class="c"><input type="checkbox" id="c-41706088" checked=""/><div class="controls bullet"><span class="by">bobnamob</span><span>|</span><a href="#41705865">parent</a><span>|</span><a href="#41706010">next</a><span>|</span><label class="collapse" for="c-41706088">[-]</label><label class="expand" for="c-41706088">[1 more]</label></div><br/><div class="children"><div class="content">Of course coming with the _major_ caveat that the interface and behaviour[1] of the dependency is absolutely stable for the entirety of the &quot;major version&quot;.<p>I&#x27;m an advocate for this style of library&#x2F;dependency development, unfortunately in my experience the average dependency doesn&#x27;t have the discipline to pull it off.<p>[1] <a href="https:&#x2F;&#x2F;www.hyrumslaw.com" rel="nofollow">https:&#x2F;&#x2F;www.hyrumslaw.com</a></div><br/></div></div><div id="41706010" class="c"><input type="checkbox" id="c-41706010" checked=""/><div class="controls bullet"><span class="by">the_mitsuhiko</span><span>|</span><a href="#41705865">parent</a><span>|</span><a href="#41706088">prev</a><span>|</span><a href="#41706005">next</a><span>|</span><label class="collapse" for="c-41706010">[-]</label><label class="expand" for="c-41706010">[2 more]</label></div><br/><div class="children"><div class="content">That’s why I called the library “jinja2”. It was a new major version. But people over the years really did not like it and it did not catch on much.</div><br/><div id="41706097" class="c"><input type="checkbox" id="c-41706097" checked=""/><div class="controls bullet"><span class="by">smitty1e</span><span>|</span><a href="#41705865">root</a><span>|</span><a href="#41706010">parent</a><span>|</span><a href="#41706005">next</a><span>|</span><label class="collapse" for="c-41706097">[-]</label><label class="expand" for="c-41706097">[1 more]</label></div><br/><div class="children"><div class="content">Once more, the wisdom of &quot;Explicit is better than implicit&quot; shines.<p>Instead, we jump through hoops with our hair on fire to manage complexity.<p>People.</div><br/></div></div></div></div><div id="41706005" class="c"><input type="checkbox" id="c-41706005" checked=""/><div class="controls bullet"><span class="by">greener_grass</span><span>|</span><a href="#41705865">parent</a><span>|</span><a href="#41706010">prev</a><span>|</span><a href="#41706009">next</a><span>|</span><label class="collapse" for="c-41706005">[-]</label><label class="expand" for="c-41706005">[1 more]</label></div><br/><div class="children"><div class="content">This is Rich Hickey&#x27;s suggestion too<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=oyLBGkS5ICk" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=oyLBGkS5ICk</a></div><br/></div></div></div></div><div id="41706009" class="c"><input type="checkbox" id="c-41706009" checked=""/><div class="controls bullet"><span class="by">orf</span><span>|</span><a href="#41705865">prev</a><span>|</span><a href="#41705935">next</a><span>|</span><label class="collapse" for="c-41706009">[-]</label><label class="expand" for="c-41706009">[1 more]</label></div><br/><div class="children"><div class="content">This comes up every now and again, and there are two fairly simple examples that I think show the complexities:<p>One:<p>Library A takes a callback function, and catches “request.HttpError” when invoking that callback.<p>The callback throws an exception from a differing version of “request”, which is missing an attribute that the exception handler requires.<p>What happens? How?<p>Two:<p>Library A has a function that returns a “request.Response” object.<p>Library B has a function that accepts a “request.Response” object, and performs “isinstance”&#x2F;type equality on the object.<p>Library A and library B have differing and incompatible dependencies on “request”.<p>What version of the request object is sent to library B from library A, and how does “isinstance”&#x2F;“type” interact with it?<p>Both of these resolve around class identities. In Python they are intrinsically linked to the defining module. Either you break this invariant and have two incompatible&#x2F;different types have the same identity and introduce all kinds of bugs, or you don’t and also introduce all kinds of bugs - “yes, this is a request.Response object, but this method doesn’t exist on <i>this</i> request.Response object”, or “yes this is a request.Response object, but it’s not <i>your</i> request.Response object”<p>Getting different module imports to <i>succeed</i> is more than possible, getting them to <i>work together</i> is another thing entirely.</div><br/></div></div><div id="41705935" class="c"><input type="checkbox" id="c-41705935" checked=""/><div class="controls bullet"><span class="by">thingsgg</span><span>|</span><a href="#41706009">prev</a><span>|</span><a href="#41705957">next</a><span>|</span><label class="collapse" for="c-41705935">[-]</label><label class="expand" for="c-41705935">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s one thing to see if something like this is possible from a technical standpoint, but whether this is desirable for the ecosystem as a whole is a different question. I would argue that allowing multiple versions of packages in the dependency tree is bad. It removes incentives for maintainers to adhere to sane versioning standards like semver, and also the incentive to keep dependencies updated, because resolution will never be impossible for package users. Instead, they will get subtle bugs due to unknowingly relying on multiple versions of the same package in their application that are incompatible with each other.<p>For lack of a better word, the single package version forces the ecosystem to keep &quot;moving&quot;: if you want your package to be continued to be used, you better make sure it works with reasonably recent other packages from the ecosystem.</div><br/></div></div><div id="41705957" class="c"><input type="checkbox" id="c-41705957" checked=""/><div class="controls bullet"><span class="by">physicsguy</span><span>|</span><a href="#41705935">prev</a><span>|</span><label class="collapse" for="c-41705957">[-]</label><label class="expand" for="c-41705957">[2 more]</label></div><br/><div class="children"><div class="content">Does this not fall over in the circumstance of linking against a C library (not specifically a Python extension) as many Python libraries do?<p>For e.g. I write “library” of which v1 depends on somelib.so.1.0.0 and v2 depends on somelib.so.2.0.0<p>If somelib has some symbols clashing in the names this can cause real problems!</div><br/><div id="41706043" class="c"><input type="checkbox" id="c-41706043" checked=""/><div class="controls bullet"><span class="by">the_mitsuhiko</span><span>|</span><a href="#41705957">parent</a><span>|</span><label class="collapse" for="c-41706043">[-]</label><label class="expand" for="c-41706043">[1 more]</label></div><br/><div class="children"><div class="content">They don’t show up in the global symbol namespace usually so it’s fine. It’s only an issue for some libraries that load globally so that one library can reference another c library.</div><br/></div></div></div></div></div></div></div></div></div></body></html>