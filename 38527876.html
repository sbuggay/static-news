<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701766854762" as="style"/><link rel="stylesheet" href="styles.css?v=1701766854762"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://mjg59.dreamwidth.org/68537.html">Why does Gnome fingerprint unlock not unlock the keyring?</a>Â <span class="domain">(<a href="https://mjg59.dreamwidth.org">mjg59.dreamwidth.org</a>)</span></div><div class="subtext"><span>ingve</span> | <span>21 comments</span></div><br/><div><div id="38528391" class="c"><input type="checkbox" id="c-38528391" checked=""/><div class="controls bullet"><span class="by">arianvanp</span><span>|</span><a href="#38528309">next</a><span>|</span><label class="collapse" for="c-38528391">[-]</label><label class="expand" for="c-38528391">[3 more]</label></div><br/><div class="children"><div class="content">Yet Microsoft unlocks the Keyring with the exact same fingerprint readers.<p>Microsoft pushed the reader industry to adopt their protocol almost 6 years ago and it&#x27;s universally implemented in almost all laptops (citation needed; maybe I&#x27;m wrong here and it&#x27;s not as universal).<p>They even have an open source reference implementation
- <a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SecureDeviceConnectionProtocol">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SecureDeviceConnectionProtocol</a> 
- <a href="https:&#x2F;&#x2F;github.com&#x2F;Microsoft&#x2F;SecureDeviceConnectionProtocol&#x2F;wiki&#x2F;Secure-Device-Connection-Protocol">https:&#x2F;&#x2F;github.com&#x2F;Microsoft&#x2F;SecureDeviceConnectionProtocol&#x2F;...</a><p>Yet Fprintd still doesn&#x27;t support it to date.
<a href="https:&#x2F;&#x2F;gitlab.freedesktop.org&#x2F;libfprint&#x2F;libfprint&#x2F;-&#x2F;issues&#x2F;257" rel="nofollow noreferrer">https:&#x2F;&#x2F;gitlab.freedesktop.org&#x2F;libfprint&#x2F;libfprint&#x2F;-&#x2F;issues&#x2F;...</a><p>So the problem really isn&#x27;t with the fingerprint readers (at least on modern laptops) it&#x27;s that fprintd is horribly outdated with current tech<p>The other problem with Linux is that SDCP needs to be implemented in tandem with TPM support. Another area where Linux Distros are at least 10 years behind Windows.<p>However systemd has been slowly making strides with PCRLock<p>I am also pretty sure (but citation needed) that Microsoft has fallback code for image-matching fingerprint readers that run that code in a VM in some kind of trusted execution environment so that Windows Hello also works on old fingerprint readers</div><br/><div id="38528434" class="c"><input type="checkbox" id="c-38528434" checked=""/><div class="controls bullet"><span class="by">noja</span><span>|</span><a href="#38528391">parent</a><span>|</span><a href="#38528443">next</a><span>|</span><label class="collapse" for="c-38528434">[-]</label><label class="expand" for="c-38528434">[1 more]</label></div><br/><div class="children"><div class="content">&gt; it&#x27;s that fprintd is horribly outdated with current tech<p>This current tech? <a href="https:&#x2F;&#x2F;www.theregister.com&#x2F;2023&#x2F;11&#x2F;22&#x2F;windows_hello_fingerprint_bypass&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.theregister.com&#x2F;2023&#x2F;11&#x2F;22&#x2F;windows_hello_fingerp...</a></div><br/></div></div><div id="38528443" class="c"><input type="checkbox" id="c-38528443" checked=""/><div class="controls bullet"><span class="by">mjg59</span><span>|</span><a href="#38528391">parent</a><span>|</span><a href="#38528434">prev</a><span>|</span><a href="#38528309">next</a><span>|</span><label class="collapse" for="c-38528443">[-]</label><label class="expand" for="c-38528443">[1 more]</label></div><br/><div class="children"><div class="content">SCDP describes a driver-level API, it doesn&#x27;t tell you how to talk to the actual hardware. Vendors ship Windows drivers that implement that API but I&#x27;m not aware of any who&#x27;ve documented it. And while SCDP provides a secure communication channel with the biometric device, in itself that doesn&#x27;t give you an ability to seal secrets to that device based on the biometric data.</div><br/></div></div></div></div><div id="38528309" class="c"><input type="checkbox" id="c-38528309" checked=""/><div class="controls bullet"><span class="by">knallfrosch</span><span>|</span><a href="#38528391">prev</a><span>|</span><a href="#38528230">next</a><span>|</span><label class="collapse" for="c-38528309">[-]</label><label class="expand" for="c-38528309">[1 more]</label></div><br/><div class="children"><div class="content">This doesn&#x27;t explain why Linux doesn&#x27;t communicate with the secure enclave.<p>As an aside, Appleland isn&#x27;t the promised land either.<p>Apple laptops with a fingerprint reader lack the interface to be unlocked with depth cameras, like any Windows Hello certified camera. This means biometric authentication requires another connected fingerprint reader when the lid is closed.<p>Apple phones on the other hand have the opposite problem. They have a depth camera and can use your face to unlock, but lack the hardware for fingerprint unlocking. This means you have to lift them up and point them at your face  while other phones have built-in fingerprint readers beneath their screens.</div><br/></div></div><div id="38528230" class="c"><input type="checkbox" id="c-38528230" checked=""/><div class="controls bullet"><span class="by">mrintegrity</span><span>|</span><a href="#38528309">prev</a><span>|</span><a href="#38528383">next</a><span>|</span><label class="collapse" for="c-38528230">[-]</label><label class="expand" for="c-38528230">[2 more]</label></div><br/><div class="children"><div class="content">I was wondering that myself, and just this moment tested it. Interestingly, I pressed cancel on the keyring dialog instead of entering a password.. everything seems to work fine!? I can view saved passwords for wifi networks in gnome network manager, firefox passwords can be viewed in it&#x27;s manager too. So what exactly does this system protect?<p>It seems I have either misunderstood it&#x27;s functionality or it&#x27;s completely broken. Is it literally only protecting the &quot;login keyring&quot;, in which case what is the point when I can still login and seemingly do everything anyway?<p>In the gui &quot;seahorse&quot; I can view all openssh and gpg keys without having unlocked the login keyring.. very confused by this!</div><br/><div id="38528283" class="c"><input type="checkbox" id="c-38528283" checked=""/><div class="controls bullet"><span class="by">oynqr</span><span>|</span><a href="#38528230">parent</a><span>|</span><a href="#38528383">next</a><span>|</span><label class="collapse" for="c-38528283">[-]</label><label class="expand" for="c-38528283">[1 more]</label></div><br/><div class="children"><div class="content">NetworkManager can save credentials for all users, which is probably your case, and the others don&#x27;t use the system keyring by default.</div><br/></div></div></div></div><div id="38528383" class="c"><input type="checkbox" id="c-38528383" checked=""/><div class="controls bullet"><span class="by">captainmuon</span><span>|</span><a href="#38528230">prev</a><span>|</span><a href="#38528352">next</a><span>|</span><label class="collapse" for="c-38528383">[-]</label><label class="expand" for="c-38528383">[2 more]</label></div><br/><div class="children"><div class="content">Couldn&#x27;t you have a small (meaning auditable) priviliged daemon store the keys in RAM when the keychain is unlocked once? The daemon would then release the keys when it determines that the fingerprint is correct.<p>You would have to compare the fingerprints on the PC, or you would have to have a authenticated channel between the fingerprint reader and the PC, otherwise you would open yourself to device spoofing attacks. I think an attack like that was discovered recently for Windows notebooks.<p>This scheme would mean that root can access your keys without the fingerprint (unlike on a Mac I think), but the root account already has other ways to get your passwords.<p>Similar, you might be vulnerable against an attack where somebody confiscates your locked PC, freezes your RAM modules, and reads them out later. But you could encrypt the passwords in locked state using the TPM to make this much more difficult. And again, people who can do these attacks have much easier ways of getting your passwords, such as rootkits, or simply forcing you to put your finger on the sensor.</div><br/><div id="38528455" class="c"><input type="checkbox" id="c-38528455" checked=""/><div class="controls bullet"><span class="by">mjg59</span><span>|</span><a href="#38528383">parent</a><span>|</span><a href="#38528352">next</a><span>|</span><label class="collapse" for="c-38528455">[-]</label><label class="expand" for="c-38528455">[1 more]</label></div><br/><div class="children"><div class="content">How are the secrets kept secret? If the encryption key is stored on disk then giving me physical access lets me extract that and gain all the secrets. The TPM has no knowledge of the biometric state so doesn&#x27;t help here.</div><br/></div></div></div></div><div id="38528352" class="c"><input type="checkbox" id="c-38528352" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#38528383">prev</a><span>|</span><a href="#38528295">next</a><span>|</span><label class="collapse" for="c-38528352">[-]</label><label class="expand" for="c-38528352">[4 more]</label></div><br/><div class="children"><div class="content">This would only work if you could somehow reliably produce a predictable string of some sort from the scan of a fingerprint, but you can&#x27;t. Unless it&#x27;s decrypting the keychain by an artifact of the scanning process itself, the password is stored and available <i>somewhere</i> on the computer, in a &quot;secure enclave&quot; or not. And I don&#x27;t want that. If the finger scanner is just the warden of something that has the power to unlock the keychain without the password that is only stored in my grey cells, then someone can shim a fake finger scanner that pretends to have found a match.</div><br/><div id="38528412" class="c"><input type="checkbox" id="c-38528412" checked=""/><div class="controls bullet"><span class="by">captainmuon</span><span>|</span><a href="#38528352">parent</a><span>|</span><a href="#38528358">next</a><span>|</span><label class="collapse" for="c-38528412">[-]</label><label class="expand" for="c-38528412">[1 more]</label></div><br/><div class="children"><div class="content">There are protocols that you can use to authenticate the fingerprint scanner [1]. When they are not used you can indeed just shim a fake scanner and unlock the PC [2].<p>This all assumes that nobody can break into the secure silicone of the the fingerprint scanner (or the PC) of course, but that is a pretty high bar.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SecureDeviceConnectionProtocol">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SecureDeviceConnectionProtocol</a><p>[2] <a href="https:&#x2F;&#x2F;www.theverge.com&#x2F;2023&#x2F;11&#x2F;22&#x2F;23972220&#x2F;microsoft-windows-hello-fingerprint-authentication-bypass-security-vulnerability" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.theverge.com&#x2F;2023&#x2F;11&#x2F;22&#x2F;23972220&#x2F;microsoft-windo...</a></div><br/></div></div><div id="38528380" class="c"><input type="checkbox" id="c-38528380" checked=""/><div class="controls bullet"><span class="by">ycombinatrix</span><span>|</span><a href="#38528352">parent</a><span>|</span><a href="#38528358">prev</a><span>|</span><a href="#38528295">next</a><span>|</span><label class="collapse" for="c-38528380">[-]</label><label class="expand" for="c-38528380">[1 more]</label></div><br/><div class="children"><div class="content">biometric yubikey seems to be a viable solution</div><br/></div></div></div></div><div id="38528295" class="c"><input type="checkbox" id="c-38528295" checked=""/><div class="controls bullet"><span class="by">3np</span><span>|</span><a href="#38528352">prev</a><span>|</span><a href="#38528189">next</a><span>|</span><label class="collapse" for="c-38528295">[-]</label><label class="expand" for="c-38528295">[1 more]</label></div><br/><div class="children"><div class="content">Theoretically, if using the &quot;it passes a graphical representation of the fingerprint back to the OS&quot; models, it could be done if assuming a method to reliably derive strong cryptographic keys from a fingerprint scan.<p>Reliably mapping to the same key while not dropping down to abysmal entropy probably makes this intractably, hence the need for a TPM.</div><br/></div></div><div id="38528189" class="c"><input type="checkbox" id="c-38528189" checked=""/><div class="controls bullet"><span class="by">baybal2</span><span>|</span><a href="#38528295">prev</a><span>|</span><label class="collapse" for="c-38528189">[-]</label><label class="expand" for="c-38528189">[7 more]</label></div><br/><div class="children"><div class="content">&gt; And that&#x27;s the difference. When you perform TouchID authentication, the secure enclave can decide to release a secret that can be used to decrypt your keyring. We can&#x27;t easily do this under Linux because we don&#x27;t have an interface to store those secrets.<p>&gt; The secret material can&#x27;t just be stored on disk - that would allow anyone who had access to the disk to use that material to decrypt the keyring and get access to the passwords, defeating the object.<p>I&#x27;ll provide a broader explanation: you cannot encrypt your key with a fingerprint.<p>A genuine &quot;throw away the key&quot; lock is only possible when the decryption key is completely erased from memory during the screen lock, and you cannot use your fingerprint or face image as a key by itself.<p>A screen lock using stored secret is inherently incapable of providing encryption at rest. It&#x27;s like a password on a sticky note.<p>A &quot;throw away the key&quot; is only possible with a password, or a smartcard.</div><br/><div id="38528288" class="c"><input type="checkbox" id="c-38528288" checked=""/><div class="controls bullet"><span class="by">mjg59</span><span>|</span><a href="#38528189">parent</a><span>|</span><a href="#38528270">next</a><span>|</span><label class="collapse" for="c-38528288">[-]</label><label class="expand" for="c-38528288">[5 more]</label></div><br/><div class="children"><div class="content">If you trust the hardware then it&#x27;s entirely possible to tie the release of an encryption key to a fingerprint validated by that hardware. Hardware-backed keys are widely used (the entire WebAuthn ecosystem is predicated upon them being trustworthy), and having that hardware validate a fingerprint rather than merely physical presence is an improvement.</div><br/><div id="38528373" class="c"><input type="checkbox" id="c-38528373" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#38528189">root</a><span>|</span><a href="#38528288">parent</a><span>|</span><a href="#38528320">next</a><span>|</span><label class="collapse" for="c-38528373">[-]</label><label class="expand" for="c-38528373">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33311523">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33311523</a> :<p>&gt; [WebAuthn, TPM, U2F&#x2F;FIDO2, <i>Seahorse</i>,]<p>&gt; <i>tpm-fido: <a href="https:&#x2F;&#x2F;github.com&#x2F;psanford&#x2F;tpm-fido">https:&#x2F;&#x2F;github.com&#x2F;psanford&#x2F;tpm-fido</a> </i> :<p>&gt;&gt; <i>tpm-fido is FIDO token implementation for Linux that protects the token keys by using your system&#x27;s TPM. tpm-fido uses Linux&#x27;s uhid facility to emulate a USB HID device so that it is properly detected by browsers.</i><p>TPM &gt; TPM software libraries: 
<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Trusted_Platform_Module#TPM_software_libraries" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Trusted_Platform_Module#TPM_so...</a><p>TPM &gt; Virtualization; virtual TPM devices: 
<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Trusted_Platform_Module#Virtualization" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Trusted_Platform_Module#Virtua...</a><p>WebAuthn: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;WebAuthn" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;WebAuthn</a></div><br/></div></div><div id="38528320" class="c"><input type="checkbox" id="c-38528320" checked=""/><div class="controls bullet"><span class="by">RockRobotRock</span><span>|</span><a href="#38528189">root</a><span>|</span><a href="#38528288">parent</a><span>|</span><a href="#38528373">prev</a><span>|</span><a href="#38528270">next</a><span>|</span><label class="collapse" for="c-38528320">[-]</label><label class="expand" for="c-38528320">[3 more]</label></div><br/><div class="children"><div class="content">As far as physical attacks go, we only trust secure elements because they&#x27;re tiny and very difficult to reverse engineer, right?</div><br/><div id="38528420" class="c"><input type="checkbox" id="c-38528420" checked=""/><div class="controls bullet"><span class="by">g_p</span><span>|</span><a href="#38528189">root</a><span>|</span><a href="#38528320">parent</a><span>|</span><a href="#38528382">next</a><span>|</span><label class="collapse" for="c-38528420">[-]</label><label class="expand" for="c-38528420">[1 more]</label></div><br/><div class="children"><div class="content">Partly that, and partly because they were&#x2F;are built with constrained functionality (do one thing well) that significantly limits the interfaces exposed, and are designed to be secure under the assumption of physical attack (which most things aren&#x27;t!)<p>Partly because many secure enclave type applications have undergone formal verification and verification through something like CC EAL, which should reduce the likelihood of glaring oversights etc.<p>One final aspect, more for hardware enclaves though, is that they&#x27;re often designed specifically to resist the kinds of physical attacks people may try - as security products, they&#x27;ve very likely considered power rail glitching and how to reset the enclave if there&#x27;s a glitch. Similarly, the physical ICs may be produced with physical features to try to prevent successfully decapping the chip, like sensing wires you&#x27;ll disrupt, and inbuilt EM shielding.</div><br/></div></div><div id="38528382" class="c"><input type="checkbox" id="c-38528382" checked=""/><div class="controls bullet"><span class="by">mjg59</span><span>|</span><a href="#38528189">root</a><span>|</span><a href="#38528320">parent</a><span>|</span><a href="#38528420">prev</a><span>|</span><a href="#38528270">next</a><span>|</span><label class="collapse" for="c-38528382">[-]</label><label class="expand" for="c-38528382">[1 more]</label></div><br/><div class="children"><div class="content">In theory you could potentially decap the enclave and read data out of it but you would need extremely high end equipment to do that and it would be obviously destructive so it&#x27;s not in most people&#x27;s threat model</div><br/></div></div></div></div></div></div><div id="38528270" class="c"><input type="checkbox" id="c-38528270" checked=""/><div class="controls bullet"><span class="by">parker_mountain</span><span>|</span><a href="#38528189">parent</a><span>|</span><a href="#38528288">prev</a><span>|</span><label class="collapse" for="c-38528270">[-]</label><label class="expand" for="c-38528270">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure if you&#x27;re familiar with how Touch ID and the secure enclave works?</div><br/></div></div></div></div></div></div></div></div></div></body></html>