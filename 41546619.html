<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1726563668770" as="style"/><link rel="stylesheet" href="styles.css?v=1726563668770"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.infinitepartitions.com/art001.html">Dissecting the gzip format (2011)</a> <span class="domain">(<a href="https://www.infinitepartitions.com">www.infinitepartitions.com</a>)</span></div><div class="subtext"><span>solannou</span> | <span>18 comments</span></div><br/><div><div id="41563181" class="c"><input type="checkbox" id="c-41563181" checked=""/><div class="controls bullet"><span class="by">jmillikin</span><span>|</span><a href="#41563160">next</a><span>|</span><label class="collapse" for="c-41563181">[-]</label><label class="expand" for="c-41563181">[2 more]</label></div><br/><div class="children"><div class="content">(2011)<p>Formatted version: <a href="https:&#x2F;&#x2F;infinitepartitions.com&#x2F;cgi-bin&#x2F;showarticle.cgi?article=art001" rel="nofollow">https:&#x2F;&#x2F;infinitepartitions.com&#x2F;cgi-bin&#x2F;showarticle.cgi?artic...</a></div><br/></div></div><div id="41563160" class="c"><input type="checkbox" id="c-41563160" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41563181">prev</a><span>|</span><a href="#41564035">next</a><span>|</span><label class="collapse" for="c-41563160">[-]</label><label class="expand" for="c-41563160">[2 more]</label></div><br/><div class="children"><div class="content">Besides a persistent off-by-one error, and the use of actual trees instead of table lookup for canonical Huffman, this is a pretty good summary of the LZ+Huffman process in general; and in the 80s through the mid 90s, this combination was widely used for data compression, before the much more resource-intensive adaptive arithmetic schemes started becoming popular. It&#x27;s worth noting that the specifics of DEFLATE were designed by Phil Katz, of PKZIP fame. Meanwhile, a competing format, the Japanese LZH, was chosen by several large BIOS companies for compressing logos and runtime code.<p><i>Note that real-world GZIP decoders (such as the GNU GZIP program) skip this step and opt to create a much more efficient lookup table structure. However, representing the Huffman tree literally as shown in listing 10 makes the subsequent decoding code much easier to understand.</i><p>Is it? I found the classic tree-based approach to become much clearer and simpler when expressed as a table lookup --- along with the realisation that the canonical Huffman codes are nothing more than binary numbers.</div><br/><div id="41563803" class="c"><input type="checkbox" id="c-41563803" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41563160">parent</a><span>|</span><a href="#41564035">next</a><span>|</span><label class="collapse" for="c-41563803">[-]</label><label class="expand" for="c-41563803">[1 more]</label></div><br/><div class="children"><div class="content">The lookup table here would be indexed by a <i>fixed</i> number of lookahead bits, so it for example would duplicate shorter codes and put longer codes into side tables. So a tree structure, either represented as an array or a pointer-chasing structure would be much simpler.</div><br/></div></div></div></div><div id="41564035" class="c"><input type="checkbox" id="c-41564035" checked=""/><div class="controls bullet"><span class="by">hk1337</span><span>|</span><a href="#41563160">prev</a><span>|</span><a href="#41564908">next</a><span>|</span><label class="collapse" for="c-41564035">[-]</label><label class="expand" for="c-41564035">[10 more]</label></div><br/><div class="children"><div class="content">Why do people use gzip more often than bzip? There must be some benefit but I don’t really see it, you can split and join two bzipped files (presumably CSV so you can see the extra rows). Bzip seems to compress better than gzip too.</div><br/><div id="41565112" class="c"><input type="checkbox" id="c-41565112" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#41564035">parent</a><span>|</span><a href="#41565632">next</a><span>|</span><label class="collapse" for="c-41565112">[-]</label><label class="expand" for="c-41565112">[1 more]</label></div><br/><div class="children"><div class="content">Faster than most alternatives, good enough, but most importantly very widely available.  Zstd is better on most axes (than bzip as well), except you can&#x27;t be sure it&#x27;s always there on every machine and in every language and runtime.  zlib&#x2F;gzip is ubiquitous.<p>We use xz&#x2F;lzma when we need a compressed format that you can seek through the compressed data.</div><br/></div></div><div id="41565632" class="c"><input type="checkbox" id="c-41565632" checked=""/><div class="controls bullet"><span class="by">oneshtein</span><span>|</span><a href="#41564035">parent</a><span>|</span><a href="#41565112">prev</a><span>|</span><a href="#41564388">next</a><span>|</span><label class="collapse" for="c-41565632">[-]</label><label class="expand" for="c-41565632">[1 more]</label></div><br/><div class="children"><div class="content">gzip is fast (pigz is even faster), supported everywhere (even in DOS), uses low amounts of memory, and compresses well enough for practical needs.<p>bzip2 is too slow.<p>xz is too complex (see <a href="https:&#x2F;&#x2F;bugs.debian.org&#x2F;cgi-bin&#x2F;bugreport.cgi?bug=1068024" rel="nofollow">https:&#x2F;&#x2F;bugs.debian.org&#x2F;cgi-bin&#x2F;bugreport.cgi?bug=1068024</a> ), designed to compress .exe files.<p>lzip is good, but less popular.<p>zstd is good and fast, but less popular.</div><br/></div></div><div id="41564388" class="c"><input type="checkbox" id="c-41564388" checked=""/><div class="controls bullet"><span class="by">zie</span><span>|</span><a href="#41564035">parent</a><span>|</span><a href="#41565632">prev</a><span>|</span><a href="#41564222">next</a><span>|</span><label class="collapse" for="c-41564388">[-]</label><label class="expand" for="c-41564388">[2 more]</label></div><br/><div class="children"><div class="content">Muscle memory. We&#x27;ve been doing gzip for decades and we are too lazy to remember the zstd commands to tar, assuming the installed version of tar has been updated.</div><br/><div id="41565194" class="c"><input type="checkbox" id="c-41565194" checked=""/><div class="controls bullet"><span class="by">gloflo</span><span>|</span><a href="#41564035">root</a><span>|</span><a href="#41564388">parent</a><span>|</span><a href="#41564222">next</a><span>|</span><label class="collapse" for="c-41565194">[-]</label><label class="expand" for="c-41565194">[1 more]</label></div><br/><div class="children"><div class="content">... --auto-compress ... foo.tar.zstd</div><br/></div></div></div></div><div id="41564222" class="c"><input type="checkbox" id="c-41564222" checked=""/><div class="controls bullet"><span class="by">duskwuff</span><span>|</span><a href="#41564035">parent</a><span>|</span><a href="#41564388">prev</a><span>|</span><a href="#41564908">next</a><span>|</span><label class="collapse" for="c-41564222">[-]</label><label class="expand" for="c-41564222">[5 more]</label></div><br/><div class="children"><div class="content">bzip2 is substantially slower to compress and decompress, and uses more memory.<p>It does achieve higher compression ratios on many inputs than gzip, but xz and zstd are even better, and run faster.</div><br/><div id="41564304" class="c"><input type="checkbox" id="c-41564304" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#41564035">root</a><span>|</span><a href="#41564222">parent</a><span>|</span><a href="#41564908">next</a><span>|</span><label class="collapse" for="c-41564304">[-]</label><label class="expand" for="c-41564304">[4 more]</label></div><br/><div class="children"><div class="content">TBF zstd runs most of the gamut, so depending on your settings you can have it run very fast at a somewhat limited level of compression or much lower at a very high compression.<p>Bzip is pretty completely obsolete though. Especially because of how ungodly slow it is to decompress.</div><br/><div id="41564435" class="c"><input type="checkbox" id="c-41564435" checked=""/><div class="controls bullet"><span class="by">duskwuff</span><span>|</span><a href="#41564035">root</a><span>|</span><a href="#41564304">parent</a><span>|</span><a href="#41565684">next</a><span>|</span><label class="collapse" for="c-41564435">[-]</label><label class="expand" for="c-41564435">[2 more]</label></div><br/><div class="children"><div class="content">&gt; TBF zstd runs most of the gamut<p>Yep. But bzip2 is much less flexible; reducing its block size from the default of 900 kB just reduces its compression ratio. It doesn&#x27;t make it substantially faster; the algorithm it uses is always slow (both to compress and decompress). There&#x27;s no reason to use it when zstd is available.</div><br/><div id="41565143" class="c"><input type="checkbox" id="c-41565143" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#41564035">root</a><span>|</span><a href="#41564435">parent</a><span>|</span><a href="#41565684">next</a><span>|</span><label class="collapse" for="c-41565143">[-]</label><label class="expand" for="c-41565143">[1 more]</label></div><br/><div class="children"><div class="content">Oh I completely agree, as I said bzip2 is obsolete as far as I’m concerned.<p>I was mostly saying zstd is not <i>just</i> comparable to xz (as a slow but high-compression ratio format), it’s also more than competitive with gzip, if it’s available the default configuration (level 3) will very likely compress faster and use less CPU and yield a smaller file size than gzip, though I’m pretty sure it uses more memory to do that (because of the larger window if nothing else).</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41564908" class="c"><input type="checkbox" id="c-41564908" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#41564035">prev</a><span>|</span><a href="#41563576">next</a><span>|</span><label class="collapse" for="c-41564908">[-]</label><label class="expand" for="c-41564908">[2 more]</label></div><br/><div class="children"><div class="content">Has anyone taken the coding as compression (when you create repeated behaviour, stuff it in the dictionary via creating a function; switching frameworks is changing initial dicts; etc.) metaphor seriously?</div><br/><div id="41565227" class="c"><input type="checkbox" id="c-41565227" checked=""/><div class="controls bullet"><span class="by">eapriv</span><span>|</span><a href="#41564908">parent</a><span>|</span><a href="#41563576">next</a><span>|</span><label class="collapse" for="c-41565227">[-]</label><label class="expand" for="c-41565227">[1 more]</label></div><br/><div class="children"><div class="content">Yes. <a href="https:&#x2F;&#x2F;caseymuratori.com&#x2F;blog_0015" rel="nofollow">https:&#x2F;&#x2F;caseymuratori.com&#x2F;blog_0015</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>