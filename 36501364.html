<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687942852557" as="style"/><link rel="stylesheet" href="styles.css?v=1687942852557"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://muhammadraza.me/2022/data-oneliners/">Using command line to process CSV files</a> <span class="domain">(<a href="https://muhammadraza.me">muhammadraza.me</a>)</span></div><div class="subtext"><span>mr_o47</span> | <span>54 comments</span></div><br/><div><div id="36503236" class="c"><input type="checkbox" id="c-36503236" checked=""/><div class="controls bullet"><span class="by">benhoyt</span><span>|</span><a href="#36502107">next</a><span>|</span><label class="collapse" for="c-36503236">[-]</label><label class="expand" for="c-36503236">[4 more]</label></div><br/><div class="children"><div class="content">Unfortunately &quot;awk -F,&quot; (field separator of comma) doesn&#x27;t work with most real CSV files, because of quoted fields, commas in fields, and (less frequently) multiline fields. My GoAWK implementation has a CSV mode activated with &quot;goawk -i csv&quot; (input mode CSV) and some other CSV features that properly handle quoted and multiline fields: <a href="https:&#x2F;&#x2F;benhoyt.com&#x2F;writings&#x2F;goawk-csv&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;benhoyt.com&#x2F;writings&#x2F;goawk-csv&#x2F;</a><p>The frawk tool (written in Rust) also supports this.<p>Interestingly, Brian Kernighan is currently updating the book &quot;The AWK Programming Language&quot; for a second edition (I&#x27;m one of the technical reviewers), and Gawk and awk are adding a &quot;--csv&quot; option for this purpose. So real CSV mode is coming to an AWK near you soon!</div><br/><div id="36503623" class="c"><input type="checkbox" id="c-36503623" checked=""/><div class="controls bullet"><span class="by">midasuni</span><span>|</span><a href="#36503236">parent</a><span>|</span><a href="#36502107">next</a><span>|</span><label class="collapse" for="c-36503623">[-]</label><label class="expand" for="c-36503623">[3 more]</label></div><br/><div class="children"><div class="content">I think “most” is pulling a lot of work there. I make and process csvs a lot, and just avoid quotes when generating them.<p>Sure technically you can do things like having new lines on a line which cause all sorts of grief, but if you control the end to end workflow just avoid it.<p>I have a tool which monitors performance of loading various websites via various proxies at various points ok our network with pupetteer. That outputs a csv which I can then extract data from and make handy graphs to show manglement.</div><br/><div id="36503834" class="c"><input type="checkbox" id="c-36503834" checked=""/><div class="controls bullet"><span class="by">benhoyt</span><span>|</span><a href="#36503236">root</a><span>|</span><a href="#36503623">parent</a><span>|</span><a href="#36503724">next</a><span>|</span><label class="collapse" for="c-36503834">[-]</label><label class="expand" for="c-36503834">[1 more]</label></div><br/><div class="children"><div class="content">&gt; avoid quotes when generating them<p>Yeah, I guess that <i>kinda</i> works if you&#x27;re the one generating them. But you must not have too many generalised strings -- like a name field containing &quot;Smith, John&quot; or a book title like &quot;The Lion, the Witch and the Wardrobe&quot;? When I deal with CSV&#x27;s those kind of things are quote common. I actually prefer TSV because you can (more easily) process them with standard AWK.<p>What do you output for a string field with &#x27;,&#x27; in it? Just strip the commas, or replace it with something else?</div><br/></div></div><div id="36503724" class="c"><input type="checkbox" id="c-36503724" checked=""/><div class="controls bullet"><span class="by">meepmorp</span><span>|</span><a href="#36503236">root</a><span>|</span><a href="#36503623">parent</a><span>|</span><a href="#36503834">prev</a><span>|</span><a href="#36502107">next</a><span>|</span><label class="collapse" for="c-36503724">[-]</label><label class="expand" for="c-36503724">[1 more]</label></div><br/><div class="children"><div class="content">Quotes aren&#x27;t the problem, it&#x27;s having an in-band separator character. Maybe you&#x27;re lucky enough to only need naive splitting on commas, but lots of us need to jam in human-produced text stings where the punctuation needs to be preserved without breaking file parsing.</div><br/></div></div></div></div></div></div><div id="36502107" class="c"><input type="checkbox" id="c-36502107" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#36503236">prev</a><span>|</span><a href="#36502435">next</a><span>|</span><label class="collapse" for="c-36502107">[-]</label><label class="expand" for="c-36502107">[12 more]</label></div><br/><div class="children"><div class="content">For any kind of tabular data, I use DuckDB (parallel CSV reads, works on small to humongous CSVs). It supports full Postgres-like SQL, so you can do arbitrarily complex manipulations on columns and rows. The CSV essentially becomes a dataframe object that can be manipulated in performant ways (DuckDB vectorizes and paralllelizes, so it&#x27;s way faster than awk on large CSV files). You can even manipulate multiple CSVs in a single statement (JOINs, UNIONs etc).<p><pre><code>  % duckdb -c &quot;from &#x27;test.csv&#x27;&quot;
  ┌───────┬───────┬───────┐
  │   A   │   B   │   C   │
  │ int64 │ int64 │ int64 │
  ├───────┼───────┼───────┤
  │     1 │     2 │     3 │
  │     4 │     5 │     6 │
  │     7 │     8 │     9 │
  └───────┴───────┴───────┘

  % duckdb -c &quot;select sum(C) from &#x27;test.csv&#x27;&quot;
  ┌────────┐
  │ sum(C) │
  │ int128 │
  ├────────┤
  │     18 │
  └────────┘

  % duckdb -c &quot;select sum(A + 2*B + C^2) from &#x27;test.csv&#x27;&quot;
  ┌────────────────────────────────┐
  │ sum(((A + (2 * B)) + (C ^ 2))) │
  │             double             │
  ├────────────────────────────────┤
  │                          168.0 │
  └────────────────────────────────┘</code></pre></div><br/><div id="36502737" class="c"><input type="checkbox" id="c-36502737" checked=""/><div class="controls bullet"><span class="by">psanford</span><span>|</span><a href="#36502107">parent</a><span>|</span><a href="#36502394">next</a><span>|</span><label class="collapse" for="c-36502737">[-]</label><label class="expand" for="c-36502737">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, sqlite has been my preferred method for working with csv files for a long time. I will say that one nice thing about DuckDB over SQLite is that it does a better job inferring column types than SQLite does.</div><br/><div id="36503297" class="c"><input type="checkbox" id="c-36503297" checked=""/><div class="controls bullet"><span class="by">dgsb</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502737">parent</a><span>|</span><a href="#36502394">next</a><span>|</span><label class="collapse" for="c-36503297">[-]</label><label class="expand" for="c-36503297">[1 more]</label></div><br/><div class="children"><div class="content">I do use sqlite too to process csv file, but I either rely on csvkit to generate the schema from the csv or create the table with raw sql before inserting data in the sqlite database.</div><br/></div></div></div></div><div id="36502394" class="c"><input type="checkbox" id="c-36502394" checked=""/><div class="controls bullet"><span class="by">theLiminator</span><span>|</span><a href="#36502107">parent</a><span>|</span><a href="#36502737">prev</a><span>|</span><a href="#36502690">next</a><span>|</span><label class="collapse" for="c-36502394">[-]</label><label class="expand" for="c-36502394">[6 more]</label></div><br/><div class="children"><div class="content">iirc it&#x27;s not possible to read csv in a parallel manner if your parsing true to spec?</div><br/><div id="36503271" class="c"><input type="checkbox" id="c-36503271" checked=""/><div class="controls bullet"><span class="by">hermitcrab</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502394">parent</a><span>|</span><a href="#36502770">next</a><span>|</span><label class="collapse" for="c-36503271">[-]</label><label class="expand" for="c-36503271">[1 more]</label></div><br/><div class="children"><div class="content">I think you can use a heuristic approach. E.g. pick a comma in the middle of the CSV, assume it is a delimiter (not inside data) and parse from there in a separate thread. If you find it doesn&#x27;t parse correctly (perhaps because it is inside data) you might have to throw the results of that thread away. Kind of ugly but would probably allow faster parsing in 99% of cases.<p>CSVs are a bit of a mess. Non-trivial to parse properly, due to escaping, and the standard (such as it is) is poorly followed. E.g. sometimes people use semi-colon or pipe instead of comma.<p>See also:
&#x27;Why isn’t there a decent file format for tabular data?&#x27;
<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31220841">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31220841</a></div><br/></div></div><div id="36502770" class="c"><input type="checkbox" id="c-36502770" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502394">parent</a><span>|</span><a href="#36503271">prev</a><span>|</span><a href="#36502696">next</a><span>|</span><label class="collapse" for="c-36502770">[-]</label><label class="expand" for="c-36502770">[1 more]</label></div><br/><div class="children"><div class="content">My understanding is that the CSV is read in chunks, and then each chunk is parsed in a different thread.<p>This is the description in the experimental PR (parallel CSV has since merged into the main branch)<p><a href="https:&#x2F;&#x2F;github.com&#x2F;duckdb&#x2F;duckdb&#x2F;pull&#x2F;5194">https:&#x2F;&#x2F;github.com&#x2F;duckdb&#x2F;duckdb&#x2F;pull&#x2F;5194</a></div><br/></div></div><div id="36502696" class="c"><input type="checkbox" id="c-36502696" checked=""/><div class="controls bullet"><span class="by">pyeri</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502394">parent</a><span>|</span><a href="#36502770">prev</a><span>|</span><a href="#36502800">next</a><span>|</span><label class="collapse" for="c-36502696">[-]</label><label class="expand" for="c-36502696">[1 more]</label></div><br/><div class="children"><div class="content">You can&#x27;t read SAME csv in a parallel manner but you can still read two different csvs in two separate threads? I think that&#x27;s what they meant by &quot;parallel csv&quot;.</div><br/></div></div><div id="36502800" class="c"><input type="checkbox" id="c-36502800" checked=""/><div class="controls bullet"><span class="by">gabagool</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502394">parent</a><span>|</span><a href="#36502696">prev</a><span>|</span><a href="#36502690">next</a><span>|</span><label class="collapse" for="c-36502800">[-]</label><label class="expand" for="c-36502800">[2 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t know that and my Google fu  is lacking, does anyone have a resource I could read to understand that limitation?</div><br/><div id="36503343" class="c"><input type="checkbox" id="c-36503343" checked=""/><div class="controls bullet"><span class="by">RobinL</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502800">parent</a><span>|</span><a href="#36502690">next</a><span>|</span><label class="collapse" for="c-36503343">[-]</label><label class="expand" for="c-36503343">[1 more]</label></div><br/><div class="children"><div class="content">I think the fundamental issue is that a single &#x27;cell&#x27; (value) can contain newlines, so you can&#x27;t just assume each line is a &#x27;row&#x27; and trivially parallelize.<p>The problem is perhaps most obvious when you consider that the value of a single cell could itself be a CSV, and this could be recursive</div><br/></div></div></div></div></div></div><div id="36502690" class="c"><input type="checkbox" id="c-36502690" checked=""/><div class="controls bullet"><span class="by">up2isomorphism</span><span>|</span><a href="#36502107">parent</a><span>|</span><a href="#36502394">prev</a><span>|</span><a href="#36502435">next</a><span>|</span><label class="collapse" for="c-36502690">[-]</label><label class="expand" for="c-36502690">[3 more]</label></div><br/><div class="children"><div class="content">It is kinda sad that one has to go through all the database technologies just in order to read a csv file nowadays.</div><br/><div id="36502792" class="c"><input type="checkbox" id="c-36502792" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502690">parent</a><span>|</span><a href="#36502753">next</a><span>|</span><label class="collapse" for="c-36502792">[-]</label><label class="expand" for="c-36502792">[1 more]</label></div><br/><div class="children"><div class="content">With raw string parsing approaches (awk, perl) you have to handle all kinds of corner cases because CSV is an underspecified spec. CSV is deceptive in that it looks like it parses easily, but the truth is CSV is one of the most difficult formats to reliably parse. I mean, just look at the number of arguments that pandas.read_csv has.<p><a href="https:&#x2F;&#x2F;pandas.pydata.org&#x2F;docs&#x2F;reference&#x2F;api&#x2F;pandas.read_csv.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;pandas.pydata.org&#x2F;docs&#x2F;reference&#x2F;api&#x2F;pandas.read_csv...</a><p>Parsing a CSV by hand is almost always the wrong thing to do unless you also wrote the CSV generating process and can limit the variance.<p>But if not, instead of working with CSVs at the string level and risk running into issues, I&#x27;ve found that the best practice is to farm the CSV parsing out to a battle-tested engine (I use DuckDB, but sqlite, pandas, polars, clickhouse-local or any number of engines work), and work with the parsed object instead.<p>Better yet, avoid CSV and use DuckDB + Parquet (paired with visidata for quick vizes) for anything nontrivial.</div><br/></div></div><div id="36502753" class="c"><input type="checkbox" id="c-36502753" checked=""/><div class="controls bullet"><span class="by">chaxor</span><span>|</span><a href="#36502107">root</a><span>|</span><a href="#36502690">parent</a><span>|</span><a href="#36502792">prev</a><span>|</span><a href="#36502435">next</a><span>|</span><label class="collapse" for="c-36502753">[-]</label><label class="expand" for="c-36502753">[1 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t <i>have</i> to, but you have to admit DuckDB is quite nice for handling csvs quite a bit more intuitively than awk</div><br/></div></div></div></div></div></div><div id="36502435" class="c"><input type="checkbox" id="c-36502435" checked=""/><div class="controls bullet"><span class="by">ldmosquera</span><span>|</span><a href="#36502107">prev</a><span>|</span><a href="#36502681">next</a><span>|</span><label class="collapse" for="c-36502435">[-]</label><label class="expand" for="c-36502435">[3 more]</label></div><br/><div class="children"><div class="content">Have a look at visidata, a TUI table viewer&#x2F;editor with vim keybindings. It&#x27;s incredibly powerful and fully automatable - everything you do gets recorded as a series of commands which you can save and replay.<p>Not the right tool for everything, but it shines for quickly glancing at the shape of tabular data and making sense of it. Sorting, filtering, joins across files, column histograms and even column splitting&#x2F;rejoining are all keystrokes away.<p>It groks anything even remotely table shaped like CSV, JSONL, JSON, even Excel files, it can even directly connect to databases and parse tables out of HTML.<p><a href="https:&#x2F;&#x2F;www.visidata.org&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.visidata.org&#x2F;</a></div><br/><div id="36502699" class="c"><input type="checkbox" id="c-36502699" checked=""/><div class="controls bullet"><span class="by">cool-RR</span><span>|</span><a href="#36502435">parent</a><span>|</span><a href="#36503088">next</a><span>|</span><label class="collapse" for="c-36502699">[-]</label><label class="expand" for="c-36502699">[1 more]</label></div><br/><div class="children"><div class="content">VisiData is amazing. It&#x27;s one of the coolest open source projects I&#x27;ve seen in years. I use it extensively in my research.</div><br/></div></div><div id="36503088" class="c"><input type="checkbox" id="c-36503088" checked=""/><div class="controls bullet"><span class="by">laktak</span><span>|</span><a href="#36502435">parent</a><span>|</span><a href="#36502699">prev</a><span>|</span><a href="#36502681">next</a><span>|</span><label class="collapse" for="c-36503088">[-]</label><label class="expand" for="c-36503088">[1 more]</label></div><br/><div class="children"><div class="content">An intro to the SQL interface (vdsql) can be seen here: <a href="https:&#x2F;&#x2F;www.visidata.org&#x2F;blog&#x2F;2022&#x2F;connect-visidata-to-sql-databases-with-vdsql&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.visidata.org&#x2F;blog&#x2F;2022&#x2F;connect-visidata-to-sql-d...</a></div><br/></div></div></div></div><div id="36502681" class="c"><input type="checkbox" id="c-36502681" checked=""/><div class="controls bullet"><span class="by">pradeepchhetri</span><span>|</span><a href="#36502435">prev</a><span>|</span><a href="#36503944">next</a><span>|</span><label class="collapse" for="c-36502681">[-]</label><label class="expand" for="c-36502681">[4 more]</label></div><br/><div class="children"><div class="content">As an SRE, I used to install one tool for every data format until I came across clickhouse-local. Now I use it for everything.<p>- It works with every data format which I come across in my daily job. It support data formats like Protobuf, Avro, Cap&#x27;n Proto which regular tools don&#x27;t support. Funny thing, it can even read mysql dumps.<p>- I can read the data stored in local or remote location like http, s3, gcs, azure and whatever location I can think of.<p>- I can SQL queries on the raw data and improve my SQL skills on daily basis.</div><br/><div id="36503095" class="c"><input type="checkbox" id="c-36503095" checked=""/><div class="controls bullet"><span class="by">elyobo</span><span>|</span><a href="#36502681">parent</a><span>|</span><a href="#36503630">next</a><span>|</span><label class="collapse" for="c-36503095">[-]</label><label class="expand" for="c-36503095">[2 more]</label></div><br/><div class="children"><div class="content">clickhouse.com is down for me, so for those looking for it the github repo[1] may be more useful<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;ClickHouse&#x2F;ClickHouse&#x2F;tree&#x2F;master#readme">https:&#x2F;&#x2F;github.com&#x2F;ClickHouse&#x2F;ClickHouse&#x2F;tree&#x2F;master#readme</a></div><br/><div id="36503400" class="c"><input type="checkbox" id="c-36503400" checked=""/><div class="controls bullet"><span class="by">zX41ZdbW</span><span>|</span><a href="#36502681">root</a><span>|</span><a href="#36503095">parent</a><span>|</span><a href="#36503630">next</a><span>|</span><label class="collapse" for="c-36503400">[-]</label><label class="expand" for="c-36503400">[1 more]</label></div><br/><div class="children"><div class="content">We bought the clickhouse.com domain two years ago, and it was listed in some adblockers due to abuse by the previous owner. We have cleaned up most of the block lists, but there is still a chance it is filtered by your ad-blocker.</div><br/></div></div></div></div><div id="36503630" class="c"><input type="checkbox" id="c-36503630" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#36502681">parent</a><span>|</span><a href="#36503095">prev</a><span>|</span><a href="#36503944">next</a><span>|</span><label class="collapse" for="c-36503630">[-]</label><label class="expand" for="c-36503630">[1 more]</label></div><br/><div class="children"><div class="content">Great tip, thank you.</div><br/></div></div></div></div><div id="36503944" class="c"><input type="checkbox" id="c-36503944" checked=""/><div class="controls bullet"><span class="by">thibran</span><span>|</span><a href="#36502681">prev</a><span>|</span><a href="#36501983">next</a><span>|</span><label class="collapse" for="c-36503944">[-]</label><label class="expand" for="c-36503944">[1 more]</label></div><br/><div class="children"><div class="content">Nushell can open and write CSV. Those AWK commands look horrible compared to the nu syntax.<p><a href="https:&#x2F;&#x2F;www.nushell.sh&#x2F;commands&#x2F;docs&#x2F;from_csv.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.nushell.sh&#x2F;commands&#x2F;docs&#x2F;from_csv.html</a></div><br/></div></div><div id="36501983" class="c"><input type="checkbox" id="c-36501983" checked=""/><div class="controls bullet"><span class="by">sklarsa</span><span>|</span><a href="#36503944">prev</a><span>|</span><a href="#36503992">next</a><span>|</span><label class="collapse" for="c-36501983">[-]</label><label class="expand" for="c-36501983">[2 more]</label></div><br/><div class="children"><div class="content">Personally, I use xsv and it’s been tremendously helpful, especially when working with larger files. <a href="https:&#x2F;&#x2F;github.com&#x2F;BurntSushi&#x2F;xsv">https:&#x2F;&#x2F;github.com&#x2F;BurntSushi&#x2F;xsv</a></div><br/><div id="36503601" class="c"><input type="checkbox" id="c-36503601" checked=""/><div class="controls bullet"><span class="by">elmolino89</span><span>|</span><a href="#36501983">parent</a><span>|</span><a href="#36503992">next</a><span>|</span><label class="collapse" for="c-36503601">[-]</label><label class="expand" for="c-36503601">[1 more]</label></div><br/><div class="children"><div class="content">xsv is great for a quick sanity checks (i.e. number of columns, unique values counts in a given column) but for a more serious tasks&#x2F;giant files I switch to either polars or duckdb converting CSV&#x2F;TSV files to parquet or parquet data sets.<p>By giant I mean 25G gzipped files with &gt;10^9 rows like these VCFs: <a href="https:&#x2F;&#x2F;ftp.ncbi.nlm.nih.gov&#x2F;snp&#x2F;latest_release&#x2F;VCF&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;ftp.ncbi.nlm.nih.gov&#x2F;snp&#x2F;latest_release&#x2F;VCF&#x2F;</a></div><br/></div></div></div></div><div id="36503992" class="c"><input type="checkbox" id="c-36503992" checked=""/><div class="controls bullet"><span class="by">9735194</span><span>|</span><a href="#36501983">prev</a><span>|</span><a href="#36501844">next</a><span>|</span><label class="collapse" for="c-36503992">[-]</label><label class="expand" for="c-36503992">[1 more]</label></div><br/><div class="children"><div class="content">Can’t wait for the tutorial on ‘ls’. It’s not like there is a manual.</div><br/></div></div><div id="36501844" class="c"><input type="checkbox" id="c-36501844" checked=""/><div class="controls bullet"><span class="by">kippinitreal</span><span>|</span><a href="#36503992">prev</a><span>|</span><a href="#36502441">next</a><span>|</span><label class="collapse" for="c-36501844">[-]</label><label class="expand" for="c-36501844">[2 more]</label></div><br/><div class="children"><div class="content">Cool stuff! But it’s criminal to not call attention to JQ’s elder sibling CSVKit. It’s invaluable for playing with csvs. Much easier to parse out columns, allows you to generate new csvs and even merge them. More importantly, it allows SQL on csvs (via SQLite iirc) which empowers all sorts of csv shenanigans. The bash scripting this enables us incredible (good and bad).<p><a href="https:&#x2F;&#x2F;csvkit.readthedocs.io&#x2F;en&#x2F;latest&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;csvkit.readthedocs.io&#x2F;en&#x2F;latest&#x2F;</a></div><br/><div id="36503310" class="c"><input type="checkbox" id="c-36503310" checked=""/><div class="controls bullet"><span class="by">dgsb</span><span>|</span><a href="#36501844">parent</a><span>|</span><a href="#36502441">next</a><span>|</span><label class="collapse" for="c-36503310">[-]</label><label class="expand" for="c-36503310">[1 more]</label></div><br/><div class="children"><div class="content">I agree it&#x27;s indeed one of the best tool to process csv files. Using basic coreutils command are going to be soon very limited and brittle to process csv files.</div><br/></div></div></div></div><div id="36502441" class="c"><input type="checkbox" id="c-36502441" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#36501844">prev</a><span>|</span><a href="#36502999">next</a><span>|</span><label class="collapse" for="c-36502441">[-]</label><label class="expand" for="c-36502441">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s worth noting that a lot of these tricks will break on non-trivial CSV inputs, e.g. ones that contain escaped commas.<p>I like using the shell (and Awk in particular!) as much as anyone, but for CSV I tend to reach for Python&#x27;s standard csv module[1].<p>[1]: <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;csv.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;csv.html</a></div><br/><div id="36503624" class="c"><input type="checkbox" id="c-36503624" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#36502441">parent</a><span>|</span><a href="#36502999">next</a><span>|</span><label class="collapse" for="c-36503624">[-]</label><label class="expand" for="c-36503624">[1 more]</label></div><br/><div class="children"><div class="content">A thing Python&#x27;s csv module enables that many others don&#x27;t is ragged CSVs (column numbers not all same).</div><br/></div></div></div></div><div id="36502999" class="c"><input type="checkbox" id="c-36502999" checked=""/><div class="controls bullet"><span class="by">vajdagabor</span><span>|</span><a href="#36502441">prev</a><span>|</span><a href="#36503722">next</a><span>|</span><label class="collapse" for="c-36502999">[-]</label><label class="expand" for="c-36502999">[1 more]</label></div><br/><div class="children"><div class="content">Nushell is also quite powerful for this. For example:<p><pre><code>  &gt; open people.csv | where status == &#x27;customer&#x27; | unique-by email | select surname forename email | sort-by email | save customers.json
</code></pre>
<a href="https:&#x2F;&#x2F;www.nushell.sh&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.nushell.sh&#x2F;</a></div><br/></div></div><div id="36503722" class="c"><input type="checkbox" id="c-36503722" checked=""/><div class="controls bullet"><span class="by">asicsp</span><span>|</span><a href="#36502999">prev</a><span>|</span><a href="#36502566">next</a><span>|</span><label class="collapse" for="c-36503722">[-]</label><label class="expand" for="c-36503722">[1 more]</label></div><br/><div class="children"><div class="content">For field extraction (like the first example: `awk -F, &#x27;{print $1}&#x27;`), you can also use `cut -d, -f1`<p>GNU datamash (<a href="https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;datamash&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;datamash&#x2F;</a>) provides features like groupby, statistical operations, etc.<p>See also this free ebook: Data Science at the Command Line (<a href="https:&#x2F;&#x2F;jeroenjanssens.com&#x2F;dsatcl&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;jeroenjanssens.com&#x2F;dsatcl&#x2F;</a>)</div><br/></div></div><div id="36502566" class="c"><input type="checkbox" id="c-36502566" checked=""/><div class="controls bullet"><span class="by">zX41ZdbW</span><span>|</span><a href="#36503722">prev</a><span>|</span><a href="#36503501">next</a><span>|</span><label class="collapse" for="c-36502566">[-]</label><label class="expand" for="c-36502566">[2 more]</label></div><br/><div class="children"><div class="content">My favorite tool is clickhouse-local: <a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;extracting-converting-querying-local-files-with-sql-clickhouse-local" rel="nofollow noreferrer">https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;extracting-converting-querying-l...</a><p>It is the most powerful (works with any formats, with remote datasets, and supports all the ClickHouse SQL) and the most performant.</div><br/><div id="36502640" class="c"><input type="checkbox" id="c-36502640" checked=""/><div class="controls bullet"><span class="by">andreypopp</span><span>|</span><a href="#36502566">parent</a><span>|</span><a href="#36503501">next</a><span>|</span><label class="collapse" for="c-36502640">[-]</label><label class="expand" for="c-36502640">[1 more]</label></div><br/><div class="children"><div class="content">Agreed here, it&#x27;s impressive how easy it is to use and how performant it is.<p>Would be nice to add a seamless ability to call executable UDFs from clickhouse-local, last time I checked clickhouse-local required executables to be in a special directory (as in proper clickhouse). Instead it&#x27;d be nice to be able to reference any executable in an ad-hoc way.</div><br/></div></div></div></div><div id="36503501" class="c"><input type="checkbox" id="c-36503501" checked=""/><div class="controls bullet"><span class="by">dash2</span><span>|</span><a href="#36502566">prev</a><span>|</span><a href="#36503399">next</a><span>|</span><label class="collapse" for="c-36503501">[-]</label><label class="expand" for="c-36503501">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a nice tool called dplyr-cli which lets you use R&#x27;s dplyr data manipulation language on the command line.<p><pre><code>    cat mtcars.csv | group_by cyl | summarise &quot;mpg = mean(mpg)&quot; | kable
    #&gt; | cyl|      mpg|
    #&gt; |---:|--------:|
    #&gt; |   4| 26.66364|
    #&gt; |   6| 19.74286|
    #&gt; |   8| 15.10000|
</code></pre>
<a href="https:&#x2F;&#x2F;github.com&#x2F;coolbutuseless&#x2F;dplyr-cli">https:&#x2F;&#x2F;github.com&#x2F;coolbutuseless&#x2F;dplyr-cli</a></div><br/></div></div><div id="36503399" class="c"><input type="checkbox" id="c-36503399" checked=""/><div class="controls bullet"><span class="by">hfkwer</span><span>|</span><a href="#36503501">prev</a><span>|</span><a href="#36502803">next</a><span>|</span><label class="collapse" for="c-36503399">[-]</label><label class="expand" for="c-36503399">[1 more]</label></div><br/><div class="children"><div class="content">These days I just use powershell. It has built-in csv import and then I&#x27;m dealing with familiar pwsh&#x2F;.net objects. I don&#x27;t miss the days of learning bespoke tools to handle slightly different cases.</div><br/></div></div><div id="36502803" class="c"><input type="checkbox" id="c-36502803" checked=""/><div class="controls bullet"><span class="by">jiehong</span><span>|</span><a href="#36503399">prev</a><span>|</span><a href="#36502493">next</a><span>|</span><label class="collapse" for="c-36502803">[-]</label><label class="expand" for="c-36502803">[1 more]</label></div><br/><div class="children"><div class="content">If you use powershell, you can directly run Import-Csv and don’t really have to think about it.</div><br/></div></div><div id="36502493" class="c"><input type="checkbox" id="c-36502493" checked=""/><div class="controls bullet"><span class="by">dima55</span><span>|</span><a href="#36502803">prev</a><span>|</span><a href="#36502519">next</a><span>|</span><label class="collapse" for="c-36502493">[-]</label><label class="expand" for="c-36502493">[2 more]</label></div><br/><div class="children"><div class="content">Lots of tools do this sort of thing. An incomplete list is in the vnlog docs: <a href="https:&#x2F;&#x2F;github.com&#x2F;dkogan&#x2F;vnlog&#x2F;#description">https:&#x2F;&#x2F;github.com&#x2F;dkogan&#x2F;vnlog&#x2F;#description</a></div><br/><div id="36502587" class="c"><input type="checkbox" id="c-36502587" checked=""/><div class="controls bullet"><span class="by">LeonB</span><span>|</span><a href="#36502493">parent</a><span>|</span><a href="#36502519">next</a><span>|</span><label class="collapse" for="c-36502587">[-]</label><label class="expand" for="c-36502587">[1 more]</label></div><br/><div class="children"><div class="content">Very nice … will see what I can snaffle for adding to this list: <a href="https:&#x2F;&#x2F;github.com&#x2F;secretGeek&#x2F;AwesomeCSV">https:&#x2F;&#x2F;github.com&#x2F;secretGeek&#x2F;AwesomeCSV</a><p>(With credit of course, if I do so.)</div><br/></div></div></div></div><div id="36502519" class="c"><input type="checkbox" id="c-36502519" checked=""/><div class="controls bullet"><span class="by">snthpy</span><span>|</span><a href="#36502493">prev</a><span>|</span><a href="#36503162">next</a><span>|</span><label class="collapse" for="c-36502519">[-]</label><label class="expand" for="c-36502519">[1 more]</label></div><br/><div class="children"><div class="content">Shameless plug: I created prql-query (<a href="https:&#x2F;&#x2F;github.com&#x2F;PRQL&#x2F;prql-query">https:&#x2F;&#x2F;github.com&#x2F;PRQL&#x2F;prql-query</a>) in order to scratch my own itch and use PRQL (prql-lang.org) with DataFusion and DuckDB for things like this.<p>pq is overdue some maintenance but I will update it with the imminent PRQL 0.9 release.<p>I&#x27;ve used pq in anger at my $dayjob and found it incredibly productive to have the full power of SQL combined with the terse and logical syntax of PRQL.</div><br/></div></div><div id="36503162" class="c"><input type="checkbox" id="c-36503162" checked=""/><div class="controls bullet"><span class="by">tanin</span><span>|</span><a href="#36502519">prev</a><span>|</span><a href="#36503221">next</a><span>|</span><label class="collapse" for="c-36503162">[-]</label><label class="expand" for="c-36503162">[6 more]</label></div><br/><div class="children"><div class="content">In my day job, a customer would ask me to reconcile between 2 giant CSVs very often. Think GBs.<p>When I tell them to do it in Excel by themselves, they would say Excel couldn&#x27;t open a CSV larger than 1M rows...<p>At first, I was using sqlite through shell. I hated it so much that I built a desktop app on top of it. It wasn&#x27;t slick enough with all the typing.<p>It is quite a joy to use, and I&#x27;d love for people to try it out: <a href="https:&#x2F;&#x2F;superintendent.app" rel="nofollow noreferrer">https:&#x2F;&#x2F;superintendent.app</a> (disclaimer: I&#x27;m the creator).</div><br/><div id="36503263" class="c"><input type="checkbox" id="c-36503263" checked=""/><div class="controls bullet"><span class="by">wodenokoto</span><span>|</span><a href="#36503162">parent</a><span>|</span><a href="#36503221">next</a><span>|</span><label class="collapse" for="c-36503263">[-]</label><label class="expand" for="c-36503263">[5 more]</label></div><br/><div class="children"><div class="content">You’re hiding the price quite well (although at least you’re not hiding the fact that it has a price)<p>It’s $40&#x2F;year for those wondering.</div><br/><div id="36503426" class="c"><input type="checkbox" id="c-36503426" checked=""/><div class="controls bullet"><span class="by">xarope</span><span>|</span><a href="#36503162">root</a><span>|</span><a href="#36503263">parent</a><span>|</span><a href="#36503391">next</a><span>|</span><label class="collapse" for="c-36503426">[-]</label><label class="expand" for="c-36503426">[1 more]</label></div><br/><div class="children"><div class="content">OMG $40&#x2F;year?!? Most outfits would charge $40&#x2F;month&#x2F;user&#x2F;basic, add $100&#x2F;month&#x2F;user&#x2F;professional, $CALLUS for enterprise.<p>Almost a breath of fresh air!</div><br/></div></div><div id="36503391" class="c"><input type="checkbox" id="c-36503391" checked=""/><div class="controls bullet"><span class="by">tanin</span><span>|</span><a href="#36503162">root</a><span>|</span><a href="#36503263">parent</a><span>|</span><a href="#36503426">prev</a><span>|</span><a href="#36503788">next</a><span>|</span><label class="collapse" for="c-36503391">[-]</label><label class="expand" for="c-36503391">[2 more]</label></div><br/><div class="children"><div class="content">I wasn&#x27;t trying to hide its price.<p>The price is very obvious on the website.<p>Users can&#x27;t use it for an extended period of time without paying.<p>You said it like I was tricking people into paying somehow.</div><br/><div id="36503973" class="c"><input type="checkbox" id="c-36503973" checked=""/><div class="controls bullet"><span class="by">iso1631</span><span>|</span><a href="#36503162">root</a><span>|</span><a href="#36503391">parent</a><span>|</span><a href="#36503788">next</a><span>|</span><label class="collapse" for="c-36503973">[-]</label><label class="expand" for="c-36503973">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The price is very obvious on the website.<p>Hate to agree, but yes right there, 100 pixels above the download link, very nice and clear site, I heartily approve. Not sure how you&#x27;ll get $1b of funding for something that user friendly though -- I don&#x27;t see any dark patterns at all!<p>&gt; Does your workplace reimburse software&#x27;s cost?<p>I don&#x27;t need your app, but my workplace certainly doesn&#x27;t. I can buy all sorts of hardware from preferred suppliers through our purchasing system, I can with a few hoops generate a one-time credit card to buy a random thing from a random person (how I pay for starlink for example), and for some specific cases I can pay myself and claim back later<p>However software is blocked from all this.<p>&gt;  Even if Superintendent.app only saves you 30 minutes per month, it&#x27;s already worth the minimal price tag that we will charge after beta.<p>To buy software in my company would take far longer than the 6 hours that I&#x27;d save each year! This of course is entirely the fault of my company, but I wonder how many other companies have similar policies.<p>What I can do though is spin up a AWS ami with a software charge and nobody bats an eyelid. I&#x27;m not sure how much of a &quot;cut&quot; aws takes, but something to think about.<p>(If it really helped me I&#x27;d just eat the $40 personally and take a day off in lieu, but I&#x27;ve known some people put in receiptless claims to get around the policy)</div><br/></div></div></div></div><div id="36503788" class="c"><input type="checkbox" id="c-36503788" checked=""/><div class="controls bullet"><span class="by">adammarples</span><span>|</span><a href="#36503162">root</a><span>|</span><a href="#36503263">parent</a><span>|</span><a href="#36503391">prev</a><span>|</span><a href="#36503221">next</a><span>|</span><label class="collapse" for="c-36503788">[-]</label><label class="expand" for="c-36503788">[1 more]</label></div><br/><div class="children"><div class="content">Right on the main page under a Pricing subheader...</div><br/></div></div></div></div></div></div><div id="36503221" class="c"><input type="checkbox" id="c-36503221" checked=""/><div class="controls bullet"><span class="by">hermitcrab</span><span>|</span><a href="#36503162">prev</a><span>|</span><a href="#36503066">next</a><span>|</span><label class="collapse" for="c-36503221">[-]</label><label class="expand" for="c-36503221">[1 more]</label></div><br/><div class="children"><div class="content">Presumably this command:<p>awk -F, &#x27;{print $1}&#x27; file.csv<p>Doesn&#x27;t work if the data contains commas (with escapes)? If so, that might be worth spelling out.</div><br/></div></div><div id="36503066" class="c"><input type="checkbox" id="c-36503066" checked=""/><div class="controls bullet"><span class="by">bobnamob</span><span>|</span><a href="#36503221">prev</a><span>|</span><a href="#36503269">next</a><span>|</span><label class="collapse" for="c-36503066">[-]</label><label class="expand" for="c-36503066">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve defaulted to doing all my data munging in a clojure repl.<p>The datasets that I work with are well small enough to fit in memory on my machine and having the full java ecosystem + clojure ergonomics is worth more to me than the performance full db tooling might offer</div><br/></div></div><div id="36502707" class="c"><input type="checkbox" id="c-36502707" checked=""/><div class="controls bullet"><span class="by">pyeri</span><span>|</span><a href="#36503269">prev</a><span>|</span><a href="#36502195">next</a><span>|</span><label class="collapse" for="c-36502707">[-]</label><label class="expand" for="c-36502707">[1 more]</label></div><br/><div class="children"><div class="content">Python&#x27;s pandas library has ability to seamlessly work with csv by importing&#x2F;exporting them as data frames.</div><br/></div></div><div id="36502195" class="c"><input type="checkbox" id="c-36502195" checked=""/><div class="controls bullet"><span class="by">petre</span><span>|</span><a href="#36502707">prev</a><span>|</span><a href="#36502097">next</a><span>|</span><label class="collapse" for="c-36502195">[-]</label><label class="expand" for="c-36502195">[1 more]</label></div><br/><div class="children"><div class="content">I use miller, as it&#x27;s available on my distro.</div><br/></div></div></div></div></div></div></div></body></html>