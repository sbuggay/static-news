<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1724662868663" as="style"/><link rel="stylesheet" href="styles.css?v=1724662868663"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://pillser.com/engineering/2024-08-25-speeding-up-your-website-using-cloudflare-cache">Speeding Up Your Website Using Cloudflare Cache</a> <span class="domain">(<a href="https://pillser.com">pillser.com</a>)</span></div><div class="subtext"><span>lilouartz</span> | <span>23 comments</span></div><br/><div><div id="41350644" class="c"><input type="checkbox" id="c-41350644" checked=""/><div class="controls bullet"><span class="by">pbowyer</span><span>|</span><a href="#41349940">next</a><span>|</span><label class="collapse" for="c-41350644">[-]</label><label class="expand" for="c-41350644">[8 more]</label></div><br/><div class="children"><div class="content">&gt; Serve Stale Content While Revalidating (Not Working as Expected)<p>&gt; This is the only thing that I was not able to figure out.<p>For good reason, because (at the last time I tried this earlier this year) Cloudflare documents stale-while-revalidate as if it&#x27;s supported [1], but it isn&#x27;t [2], [3].<p>Cloudflare instead has a different behaviour [4], [5] which helps in some circumstances but not all.<p>I use Fastly&#x27;s free CDN plan to get round this.<p>1. <a href="https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;cache&#x2F;concepts&#x2F;revalidation&#x2F;" rel="nofollow">https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;cache&#x2F;concepts&#x2F;revalidatio...</a><p>2. <a href="https:&#x2F;&#x2F;community.cloudflare.com&#x2F;t&#x2F;support-for-stale-while-revalidate&#x2F;496788" rel="nofollow">https:&#x2F;&#x2F;community.cloudflare.com&#x2F;t&#x2F;support-for-stale-while-r...</a><p>3. <a href="https:&#x2F;&#x2F;community.cloudflare.com&#x2F;t&#x2F;when-will-cloudflare-fully-support-stale-while-revalidate-with-asynchronous-background-revalidation&#x2F;287764&#x2F;8" rel="nofollow">https:&#x2F;&#x2F;community.cloudflare.com&#x2F;t&#x2F;when-will-cloudflare-full...</a><p>4. <a href="https:&#x2F;&#x2F;kerkour.com&#x2F;cloudflare-stale-while-revalidate" rel="nofollow">https:&#x2F;&#x2F;kerkour.com&#x2F;cloudflare-stale-while-revalidate</a><p>5. <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;48124415&#x2F;does-cloudflare-support-stale-while-revalidate" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;48124415&#x2F;does-cloudflare...</a></div><br/><div id="41354968" class="c"><input type="checkbox" id="c-41354968" checked=""/><div class="controls bullet"><span class="by">lilouartz</span><span>|</span><a href="#41350644">parent</a><span>|</span><a href="#41351738">next</a><span>|</span><label class="collapse" for="c-41354968">[-]</label><label class="expand" for="c-41354968">[1 more]</label></div><br/><div class="children"><div class="content">Ended up ditching Cloudflare for this use case <a href="https:&#x2F;&#x2F;pillser.com&#x2F;engineering&#x2F;2024-08-26-speeding-up-your-website-using-fastify-and-redis-cache" rel="nofollow">https:&#x2F;&#x2F;pillser.com&#x2F;engineering&#x2F;2024-08-26-speeding-up-your-...</a></div><br/></div></div><div id="41351738" class="c"><input type="checkbox" id="c-41351738" checked=""/><div class="controls bullet"><span class="by">bosch_mind</span><span>|</span><a href="#41350644">parent</a><span>|</span><a href="#41354968">prev</a><span>|</span><a href="#41349940">next</a><span>|</span><label class="collapse" for="c-41351738">[-]</label><label class="expand" for="c-41351738">[6 more]</label></div><br/><div class="children"><div class="content">Fastly is trash and nowhere near as good as CF.</div><br/><div id="41351961" class="c"><input type="checkbox" id="c-41351961" checked=""/><div class="controls bullet"><span class="by">Beijinger</span><span>|</span><a href="#41350644">root</a><span>|</span><a href="#41351738">parent</a><span>|</span><a href="#41352675">next</a><span>|</span><label class="collapse" for="c-41351961">[-]</label><label class="expand" for="c-41351961">[4 more]</label></div><br/><div class="children"><div class="content">I think CF is trash, at least in the free version.<p>Why you should never use Cloudflare. It causes problems, is bad for SEO and a Spyware tool.<p><a href="https:&#x2F;&#x2F;expatcircle.com&#x2F;cms&#x2F;why-you-should-never-use-cloudflare-it-causes-problems-is-bad-for-seo-and-a-spyware-tool&#x2F;" rel="nofollow">https:&#x2F;&#x2F;expatcircle.com&#x2F;cms&#x2F;why-you-should-never-use-cloudfl...</a><p>If it is free, then you are the product. If you need a CDN, there are cheap solutions out there. And Pics should always be delivered from your domain, not from CF.</div><br/><div id="41352401" class="c"><input type="checkbox" id="c-41352401" checked=""/><div class="controls bullet"><span class="by">brookst</span><span>|</span><a href="#41350644">root</a><span>|</span><a href="#41351961">parent</a><span>|</span><a href="#41352675">next</a><span>|</span><label class="collapse" for="c-41352401">[-]</label><label class="expand" for="c-41352401">[3 more]</label></div><br/><div class="children"><div class="content">&gt; If it is free, then you are the product<p>I use Linux and it’s free. Am I the product?</div><br/><div id="41352458" class="c"><input type="checkbox" id="c-41352458" checked=""/><div class="controls bullet"><span class="by">Beijinger</span><span>|</span><a href="#41350644">root</a><span>|</span><a href="#41352401">parent</a><span>|</span><a href="#41352675">next</a><span>|</span><label class="collapse" for="c-41352458">[-]</label><label class="expand" for="c-41352458">[2 more]</label></div><br/><div class="children"><div class="content">Good point. But Linux is not a for-profit enterprise. Sex is free too. At least it is better when it is free.</div><br/><div id="41352536" class="c"><input type="checkbox" id="c-41352536" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#41350644">root</a><span>|</span><a href="#41352458">parent</a><span>|</span><a href="#41352675">next</a><span>|</span><label class="collapse" for="c-41352536">[-]</label><label class="expand" for="c-41352536">[1 more]</label></div><br/><div class="children"><div class="content">For the buyer or the seller? The buyer has no incentive to make it good for the seller. The seller has every incentive to make it good for the buyer.<p>How much experience buying and selling it and getting it to free do you have to make that claim? Can you link to any peer reviewed studies?</div><br/></div></div></div></div></div></div></div></div><div id="41352675" class="c"><input type="checkbox" id="c-41352675" checked=""/><div class="controls bullet"><span class="by">aetimmes</span><span>|</span><a href="#41350644">root</a><span>|</span><a href="#41351738">parent</a><span>|</span><a href="#41351961">prev</a><span>|</span><a href="#41349940">next</a><span>|</span><label class="collapse" for="c-41352675">[-]</label><label class="expand" for="c-41352675">[1 more]</label></div><br/><div class="children"><div class="content">Care to explain why?</div><br/></div></div></div></div></div></div><div id="41349940" class="c"><input type="checkbox" id="c-41349940" checked=""/><div class="controls bullet"><span class="by">turtlebits</span><span>|</span><a href="#41350644">prev</a><span>|</span><a href="#41349255">next</a><span>|</span><label class="collapse" for="c-41349940">[-]</label><label class="expand" for="c-41349940">[8 more]</label></div><br/><div class="children"><div class="content">Before adding complexity, try to make your web sites smaller!<p>I&#x27;m not a big fan of adding more complexity (infra and money) to improve performance.</div><br/><div id="41354798" class="c"><input type="checkbox" id="c-41354798" checked=""/><div class="controls bullet"><span class="by">SushiHippie</span><span>|</span><a href="#41349940">parent</a><span>|</span><a href="#41350395">next</a><span>|</span><label class="collapse" for="c-41354798">[-]</label><label class="expand" for="c-41354798">[1 more]</label></div><br/><div class="children"><div class="content">Agreed, for example I have a ping of 200ms to Hacker News, and the last time I checked it still runs on a single core, and yet there was never a moment where I wished that Hacker News would be faster.<p>(Sometimes Hacker News gets fronted by Cloudflare when there is too much spam, but it&#x27;s not the default)</div><br/></div></div><div id="41350395" class="c"><input type="checkbox" id="c-41350395" checked=""/><div class="controls bullet"><span class="by">GenerocUsername</span><span>|</span><a href="#41349940">parent</a><span>|</span><a href="#41354798">prev</a><span>|</span><a href="#41352787">next</a><span>|</span><label class="collapse" for="c-41350395">[-]</label><label class="expand" for="c-41350395">[3 more]</label></div><br/><div class="children"><div class="content">Cloudflare and other cdn caches are a pretty standard web technology. Literally storing files closer to the client and serving it from hardware specializing in fast static serving</div><br/><div id="41350488" class="c"><input type="checkbox" id="c-41350488" checked=""/><div class="controls bullet"><span class="by">jsheard</span><span>|</span><a href="#41349940">root</a><span>|</span><a href="#41350395">parent</a><span>|</span><a href="#41352787">next</a><span>|</span><label class="collapse" for="c-41350488">[-]</label><label class="expand" for="c-41350488">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, there&#x27;s no getting around physics when moving data over a long distance. Even in the absolute best case scenario if you ran a single uninterrupted fiber optic cable half way around the world it would still take about 100ms for light to cross it (fiber isn&#x27;t quite as fast as the speed of light in a vacuum), and it&#x27;s only downhill from there with realistic networking and protocol handshakes slowing things down.</div><br/><div id="41350625" class="c"><input type="checkbox" id="c-41350625" checked=""/><div class="controls bullet"><span class="by">10000truths</span><span>|</span><a href="#41349940">root</a><span>|</span><a href="#41350488">parent</a><span>|</span><a href="#41352787">next</a><span>|</span><label class="collapse" for="c-41350625">[-]</label><label class="expand" for="c-41350625">[1 more]</label></div><br/><div class="children"><div class="content">You can&#x27;t get around the laws of physics, but you <i>can</i> control the number of round trips necessary to render your website. With HTTP&#x2F;3, you can deliver data to a client after just one RTT, and a 200-250 ms time-to-first-byte is still plenty fast for a CRUD app.</div><br/></div></div></div></div></div></div><div id="41352787" class="c"><input type="checkbox" id="c-41352787" checked=""/><div class="controls bullet"><span class="by">ksec</span><span>|</span><a href="#41349940">parent</a><span>|</span><a href="#41350395">prev</a><span>|</span><a href="#41351164">next</a><span>|</span><label class="collapse" for="c-41352787">[-]</label><label class="expand" for="c-41352787">[1 more]</label></div><br/><div class="children"><div class="content">Both CDN and DNS should really be standard sort of practice. Simply because we cant beat speed of light.<p>The problem is modern day CDN do many clever things it is easy to go wrong.</div><br/></div></div><div id="41351164" class="c"><input type="checkbox" id="c-41351164" checked=""/><div class="controls bullet"><span class="by">onion2k</span><span>|</span><a href="#41349940">parent</a><span>|</span><a href="#41352787">prev</a><span>|</span><a href="#41351170">next</a><span>|</span><label class="collapse" for="c-41351164">[-]</label><label class="expand" for="c-41351164">[1 more]</label></div><br/><div class="children"><div class="content">Size isn&#x27;t the only consideration though. Latency is pretty much a fixed cost for web resources, and caching is very beneficial if your edge cache is closer to the user than the origin server (and it is, unless you&#x27;re very unlucky).</div><br/></div></div><div id="41351170" class="c"><input type="checkbox" id="c-41351170" checked=""/><div class="controls bullet"><span class="by">victorbjorklund</span><span>|</span><a href="#41349940">parent</a><span>|</span><a href="#41351164">prev</a><span>|</span><a href="#41349255">next</a><span>|</span><label class="collapse" for="c-41351170">[-]</label><label class="expand" for="c-41351170">[1 more]</label></div><br/><div class="children"><div class="content">of course always better to make the code more efficient. But honestly it isnt very complex to have a CDN for static content</div><br/></div></div></div></div><div id="41349255" class="c"><input type="checkbox" id="c-41349255" checked=""/><div class="controls bullet"><span class="by">daviding</span><span>|</span><a href="#41349940">prev</a><span>|</span><a href="#41351822">next</a><span>|</span><label class="collapse" for="c-41349255">[-]</label><label class="expand" for="c-41349255">[3 more]</label></div><br/><div class="children"><div class="content">Some rough cost numbers of using this would be nice.</div><br/><div id="41350361" class="c"><input type="checkbox" id="c-41350361" checked=""/><div class="controls bullet"><span class="by">freitasm</span><span>|</span><a href="#41349255">parent</a><span>|</span><a href="#41351822">next</a><span>|</span><label class="collapse" for="c-41350361">[-]</label><label class="expand" for="c-41350361">[2 more]</label></div><br/><div class="children"><div class="content">With the exception of Cache Reserves, all these features are free.<p>Cache Reserve pricing is based on storage usage but optional.</div><br/><div id="41351804" class="c"><input type="checkbox" id="c-41351804" checked=""/><div class="controls bullet"><span class="by">arghwhat</span><span>|</span><a href="#41349255">root</a><span>|</span><a href="#41350361">parent</a><span>|</span><a href="#41351822">next</a><span>|</span><label class="collapse" for="c-41351804">[-]</label><label class="expand" for="c-41351804">[1 more]</label></div><br/><div class="children"><div class="content">Caching is free up until a service ceiling - certain file types and sizes are excluded in the free tier for example.</div><br/></div></div></div></div></div></div><div id="41351822" class="c"><input type="checkbox" id="c-41351822" checked=""/><div class="controls bullet"><span class="by">arghwhat</span><span>|</span><a href="#41349255">prev</a><span>|</span><a href="#41350385">next</a><span>|</span><label class="collapse" for="c-41351822">[-]</label><label class="expand" for="c-41351822">[1 more]</label></div><br/><div class="children"><div class="content">To use the cache you shouldn’t need to do any of this - just have appropriate cache headers.</div><br/></div></div><div id="41350385" class="c"><input type="checkbox" id="c-41350385" checked=""/><div class="controls bullet"><span class="by">j45</span><span>|</span><a href="#41351822">prev</a><span>|</span><a href="#41350595">next</a><span>|</span><label class="collapse" for="c-41350385">[-]</label><label class="expand" for="c-41350385">[1 more]</label></div><br/><div class="children"><div class="content">Cloudflares free cache is pretty good as well.<p>Also have heard things like jscompress to reduce the number of calls on loading a page can go a long way too to boost speed.</div><br/></div></div><div id="41350595" class="c"><input type="checkbox" id="c-41350595" checked=""/><div class="controls bullet"><span class="by">wetimeai</span><span>|</span><a href="#41350385">prev</a><span>|</span><label class="collapse" for="c-41350595">[-]</label><label class="expand" for="c-41350595">[1 more]</label></div><br/><div class="children"><div class="content">is is a quick fix. and for smaller websites i recommend it. However it has its limits and it can frustrate when you are developing. But in general yeah good free service.</div><br/></div></div></div></div></div></div></div></body></html>