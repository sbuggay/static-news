<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689325260011" as="style"/><link rel="stylesheet" href="styles.css?v=1689325260011"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://arxiv.org/abs/2306.00229">Minotaur: A SIMD-oriented synthesizing superoptimizer</a>Â <span class="domain">(<a href="https://arxiv.org">arxiv.org</a>)</span></div><div class="subtext"><span>luu</span> | <span>9 comments</span></div><br/><div><div id="36717020" class="c"><input type="checkbox" id="c-36717020" checked=""/><div class="controls bullet"><span class="by">chrisaycock</span><span>|</span><a href="#36701542">next</a><span>|</span><label class="collapse" for="c-36717020">[-]</label><label class="expand" for="c-36717020">[7 more]</label></div><br/><div class="children"><div class="content">As an example optimization, consider this C code:<p><pre><code>  do {
    if (*--p == &#x27;.&#x27;) *p = &#x27;_&#x27;;
  } while (p != name);
</code></pre>
LLVM originally produced this bitcode for AVX-2 instructions:<p><pre><code>  %1 = shufflevector %0, &lt;31, 30, 29, ... , 0&gt;
  %2 = icmp eq %1, &lt;46, 46, 46, ... , 46&gt;
  %3 = shufflevector %2, &lt;31, 30, 29, ... , 0&gt;
</code></pre>
Minotaur instead produced:<p><pre><code>  %1 = icmp eq %0, &lt;46, 46, 46, ... , 46&gt;
</code></pre>
Both compare the register to ASCII 46 (&#x27;.&#x27;), but LLVM originally produced an unnecessary pair of vector reversals. Minotaur removed it.</div><br/><div id="36717384" class="c"><input type="checkbox" id="c-36717384" checked=""/><div class="controls bullet"><span class="by">addaon</span><span>|</span><a href="#36717020">parent</a><span>|</span><a href="#36717971">next</a><span>|</span><label class="collapse" for="c-36717384">[-]</label><label class="expand" for="c-36717384">[5 more]</label></div><br/><div class="children"><div class="content">Super-optimizers always strike me with the same feeling when seeing examples like this. On the one hand, it&#x27;s awesome to be able to have truly-optimal (under chosen assumptions) code sequences for certain operations. On the other hand, so many of the examples just hammer home how many missed practical opportunities there are for peephole optimizations (in this case) and other traditional, local optimization techniques. I almost feel like the most valuable use of a super-optimizer would be to run it against a bunch of real world code patterns, and then use the optimization results to feed back in to simple traditional optimizations.</div><br/><div id="36717732" class="c"><input type="checkbox" id="c-36717732" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#36717020">root</a><span>|</span><a href="#36717384">parent</a><span>|</span><a href="#36717647">next</a><span>|</span><label class="collapse" for="c-36717732">[-]</label><label class="expand" for="c-36717732">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;souper">https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;souper</a><p>&gt; Souper is a superoptimizer for LLVM IR. It uses an SMT solver to help identify missing peephole optimizations in LLVM&#x27;s midend optimizers.</div><br/><div id="36718017" class="c"><input type="checkbox" id="c-36718017" checked=""/><div class="controls bullet"><span class="by">thechao</span><span>|</span><a href="#36717020">root</a><span>|</span><a href="#36717732">parent</a><span>|</span><a href="#36717647">next</a><span>|</span><label class="collapse" for="c-36718017">[-]</label><label class="expand" for="c-36718017">[1 more]</label></div><br/><div class="children"><div class="content">The posted paper is by John, as well as Souper!</div><br/></div></div></div></div><div id="36717647" class="c"><input type="checkbox" id="c-36717647" checked=""/><div class="controls bullet"><span class="by">eslaught</span><span>|</span><a href="#36717020">root</a><span>|</span><a href="#36717384">parent</a><span>|</span><a href="#36717732">prev</a><span>|</span><a href="#36717502">next</a><span>|</span><label class="collapse" for="c-36717647">[-]</label><label class="expand" for="c-36717647">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re exactly right:<p><a href="https:&#x2F;&#x2F;theory.stanford.edu&#x2F;~aiken&#x2F;publications&#x2F;papers&#x2F;asplos06.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;theory.stanford.edu&#x2F;~aiken&#x2F;publications&#x2F;papers&#x2F;asplo...</a></div><br/></div></div><div id="36717502" class="c"><input type="checkbox" id="c-36717502" checked=""/><div class="controls bullet"><span class="by">xxpor</span><span>|</span><a href="#36717020">root</a><span>|</span><a href="#36717384">parent</a><span>|</span><a href="#36717647">prev</a><span>|</span><a href="#36717971">next</a><span>|</span><label class="collapse" for="c-36717502">[-]</label><label class="expand" for="c-36717502">[1 more]</label></div><br/><div class="children"><div class="content">That is in fact what they&#x27;re usually used for.</div><br/></div></div></div></div><div id="36717971" class="c"><input type="checkbox" id="c-36717971" checked=""/><div class="controls bullet"><span class="by">mhh__</span><span>|</span><a href="#36717020">parent</a><span>|</span><a href="#36717384">prev</a><span>|</span><a href="#36701542">next</a><span>|</span><label class="collapse" for="c-36717971">[-]</label><label class="expand" for="c-36717971">[1 more]</label></div><br/><div class="children"><div class="content">LLVM generates so much more code than GCC for that. Crazy - obviously the compiler is damned if it does, damned if it doesn&#x27;t, but optimizing for small strings is probably not a bad idea.</div><br/></div></div></div></div><div id="36701542" class="c"><input type="checkbox" id="c-36701542" checked=""/><div class="controls bullet"><span class="by">brucethemoose2</span><span>|</span><a href="#36717020">prev</a><span>|</span><label class="collapse" for="c-36701542">[-]</label><label class="expand" for="c-36701542">[1 more]</label></div><br/><div class="children"><div class="content">Looks like the source is here: <a href="https:&#x2F;&#x2F;github.com&#x2F;minotaur-toolkit&#x2F;minotaur">https:&#x2F;&#x2F;github.com&#x2F;minotaur-toolkit&#x2F;minotaur</a></div><br/></div></div></div></div></div></div></div></body></html>