<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1733994055633" as="style"/><link rel="stylesheet" href="styles.css?v=1733994055633"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://devblogs.microsoft.com/oldnewthing/20241206-00/?p=110614">Deciphering C++ compiler errors: Nonsensical errors from a function declaration</a> <span class="domain">(<a href="https://devblogs.microsoft.com">devblogs.microsoft.com</a>)</span></div><div class="subtext"><span>signa11</span> | <span>11 comments</span></div><br/><div><div id="42396651" class="c"><input type="checkbox" id="c-42396651" checked=""/><div class="controls bullet"><span class="by">jamesfinlayson</span><span>|</span><a href="#42396944">next</a><span>|</span><label class="collapse" for="c-42396651">[-]</label><label class="expand" for="c-42396651">[2 more]</label></div><br/><div class="children"><div class="content">Ugh... I had something similar recently but much more painful to figure out - apparently googletest defines and and or (lowercase) as macros).<p>I started using googletest in a project with a moderate amount of inline assembly, and of course I got some thoroughly confusing error messages after the substitution replaced the and and or opcodes.<p>Anyway, I didn&#x27;t know that push_macro and pop_macro existed, so I&#x27;ll have to revisit my previous hack around that issue.</div><br/><div id="42397288" class="c"><input type="checkbox" id="c-42397288" checked=""/><div class="controls bullet"><span class="by">cordenr</span><span>|</span><a href="#42396651">parent</a><span>|</span><a href="#42396944">next</a><span>|</span><label class="collapse" for="c-42397288">[-]</label><label class="expand" for="c-42397288">[1 more]</label></div><br/><div class="children"><div class="content">In C++ they&#x27;re alternative tokens and should be keywords, so maybe googletest is providing them as macros as workaround for a compile that didn&#x27;t support this?<p>In other words, maybe a computer flag would allow you to disable them being defined?<p>Although this could result in other issues...</div><br/></div></div></div></div><div id="42396944" class="c"><input type="checkbox" id="c-42396944" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#42396651">prev</a><span>|</span><a href="#42396349">next</a><span>|</span><label class="collapse" for="c-42396944">[-]</label><label class="expand" for="c-42396944">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Doesn’t the non-macro version have a use-after-free?<p>&gt;<p>&gt; &gt; Indeed it does. Rats.<p>Not even the great Raymond Chen writes CVE free code.</div><br/></div></div><div id="42396349" class="c"><input type="checkbox" id="c-42396349" checked=""/><div class="controls bullet"><span class="by">tbrownaw</span><span>|</span><a href="#42396944">prev</a><span>|</span><a href="#42397243">next</a><span>|</span><label class="collapse" for="c-42396349">[-]</label><label class="expand" for="c-42396349">[1 more]</label></div><br/><div class="children"><div class="content">Well, yes. This is why preprocessor macros should have obvious, inconvenient naming conventions. And should be avoided in favor of more modern (better-behaved) features when possible.</div><br/></div></div><div id="42397243" class="c"><input type="checkbox" id="c-42397243" checked=""/><div class="controls bullet"><span class="by">pionaryon</span><span>|</span><a href="#42396349">prev</a><span>|</span><a href="#42396571">next</a><span>|</span><label class="collapse" for="c-42397243">[-]</label><label class="expand" for="c-42397243">[1 more]</label></div><br/><div class="children"><div class="content">You can suppress function like macros by using parenthesis because function like macro expansion is literally defined as &quot;name directly followed by open paren&quot;.<p><pre><code>  #define foo(x) something
  void foo(int a) {} &#x2F;&#x2F; doesn&#x27;t work
  void (foo)(int a) {} &#x2F;&#x2F; does work because &#x27;foo)&#x27; can never be a function macro</code></pre></div><br/></div></div><div id="42396571" class="c"><input type="checkbox" id="c-42396571" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#42397243">prev</a><span>|</span><a href="#42396497">next</a><span>|</span><label class="collapse" for="c-42396571">[-]</label><label class="expand" for="c-42396571">[1 more]</label></div><br/><div class="children"><div class="content">Pro tip: `#pragma GCC poison` is very good for (incrementally) getting rid of specific C-isms (both individual macros and individual functions) and keeping them out. It looks like `#pragma deprecated` is similar for MSVC, but it has the major downside of only being a warning.<p>That said, I am not at all afraid of using macros when appropriate. Just give them names that scream &quot;I_AM_A_MACRO&quot; unless you take care to make them sufficiently function-like, and if public give them a &quot;namespace&quot; prefix either way.</div><br/></div></div><div id="42396497" class="c"><input type="checkbox" id="c-42396497" checked=""/><div class="controls bullet"><span class="by">WalterBright</span><span>|</span><a href="#42396571">prev</a><span>|</span><a href="#42396567">next</a><span>|</span><label class="collapse" for="c-42396497">[-]</label><label class="expand" for="c-42396497">[1 more]</label></div><br/><div class="children"><div class="content">I removed as much macro usage as practical from my ancient C code. Makes the code a lot easier to deal with.</div><br/></div></div><div id="42396567" class="c"><input type="checkbox" id="c-42396567" checked=""/><div class="controls bullet"><span class="by">aleden</span><span>|</span><a href="#42396497">prev</a><span>|</span><a href="#42396943">next</a><span>|</span><label class="collapse" for="c-42396567">[-]</label><label class="expand" for="c-42396567">[2 more]</label></div><br/><div class="children"><div class="content">Before #define ing MY_MACRO, do<p>#ifdef MY_MACRO<p>#error<p>#endif<p>edit: and #undef MY_MACRO after done using it, ideally.</div><br/><div id="42396804" class="c"><input type="checkbox" id="c-42396804" checked=""/><div class="controls bullet"><span class="by">AlotOfReading</span><span>|</span><a href="#42396567">parent</a><span>|</span><a href="#42396943">next</a><span>|</span><label class="collapse" for="c-42396804">[-]</label><label class="expand" for="c-42396804">[1 more]</label></div><br/><div class="children"><div class="content">Not a perfect defense either. If you ever have the misfortune of using mentor graphics code, they #define REGISTER. They also ship a standard library that uses the register keyword. If you build a project using their standard library and their toolchain together, it explodes. If you name something like set_register, it also explodes.</div><br/></div></div></div></div><div id="42396943" class="c"><input type="checkbox" id="c-42396943" checked=""/><div class="controls bullet"><span class="by">oflebbe</span><span>|</span><a href="#42396567">prev</a><span>|</span><label class="collapse" for="c-42396943">[-]</label><label class="expand" for="c-42396943">[1 more]</label></div><br/><div class="children"><div class="content">Wait what? This is an blogpost from Chen? I did remember reading better quality content before. This is the usual nightmare dealing with larger C++ codebase.</div><br/></div></div></div></div></div></div></div></body></html>