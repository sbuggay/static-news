<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704531656404" as="style"/><link rel="stylesheet" href="styles.css?v=1704531656404"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/gfodor/p2pcf">P2pcf: P2P WebRTC via Cloudflare Workers</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>rgbrgb</span> | <span>21 comments</span></div><br/><div><div id="38888737" class="c"><input type="checkbox" id="c-38888737" checked=""/><div class="controls bullet"><span class="by">lostmsu</span><span>|</span><a href="#38886471">next</a><span>|</span><label class="collapse" for="c-38888737">[-]</label><label class="expand" for="c-38888737">[2 more]</label></div><br/><div class="children"><div class="content">Neither this project, nor its predecessor are p2p. In essence both are centralized WebRTC signaling servers&#x2F;services.<p>Sadly both WebRTC and WebSockets seem to have been designed in such a way that excludes pure peer-to-peer operation.</div><br/><div id="38889261" class="c"><input type="checkbox" id="c-38889261" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38888737">parent</a><span>|</span><a href="#38886471">next</a><span>|</span><label class="collapse" for="c-38889261">[-]</label><label class="expand" for="c-38889261">[1 more]</label></div><br/><div class="children"><div class="content">Author here, obviously not. The goal of the project isn&#x27;t to try to solve a problem that can&#x27;t be solved, it&#x27;s to reduce the effort needed to set up a WebRTC signaling server. The &quot;P2P&quot; here is referring to the peer network that is established via the signaling.</div><br/></div></div></div></div><div id="38886471" class="c"><input type="checkbox" id="c-38886471" checked=""/><div class="controls bullet"><span class="by">neftaly</span><span>|</span><a href="#38888737">prev</a><span>|</span><a href="#38888308">next</a><span>|</span><label class="collapse" for="c-38886471">[-]</label><label class="expand" for="c-38886471">[9 more]</label></div><br/><div class="children"><div class="content">I evaluated using this in prod, but came to the conclusion that R2 was a bit shaky as a database. CF has since come out with D1 SQL, DO (beware vendor lock-in), queues, and my favorite, MQTT pub-sub, which would be better options. They&#x27;ve also been teasing some vastly improved options for STUN&#x2F;TURN; I wouldn&#x27;t be surprised if more turnkey signalling popped up.</div><br/><div id="38889287" class="c"><input type="checkbox" id="c-38889287" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38886471">parent</a><span>|</span><a href="#38887600">next</a><span>|</span><label class="collapse" for="c-38889287">[-]</label><label class="expand" for="c-38889287">[1 more]</label></div><br/><div class="children"><div class="content">D1 looks like it could replace R2. Most of the tricky business in p2pcf is dealing with all the ICE details - porting the persistence from R2 to D1 might not be too bad.</div><br/></div></div><div id="38887600" class="c"><input type="checkbox" id="c-38887600" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#38886471">parent</a><span>|</span><a href="#38889287">prev</a><span>|</span><a href="#38888308">next</a><span>|</span><label class="collapse" for="c-38887600">[-]</label><label class="expand" for="c-38887600">[7 more]</label></div><br/><div class="children"><div class="content">I don’t know what the consistency requirements are but workers Kv or r2 + cache might be smarter choices in terms of improving resilience and also performance by a lot (same goes for suggestions of using DO - R2 is kind of a weird choice to manage stateful rendezvous). Queues and pubsub feel like incorrect choices unless I misunderstood what they’re using the storage for.</div><br/><div id="38889267" class="c"><input type="checkbox" id="c-38889267" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38887600">parent</a><span>|</span><a href="#38888087">next</a><span>|</span><label class="collapse" for="c-38889267">[-]</label><label class="expand" for="c-38889267">[1 more]</label></div><br/><div class="children"><div class="content">Author here. KV did not provide the consistency guarantees needed for this to work. If you were signaling across two edge nodes, you didn&#x27;t see candidates until the data was replicated, which took a long time. R2 doesn&#x27;t have this problem.</div><br/></div></div><div id="38888087" class="c"><input type="checkbox" id="c-38888087" checked=""/><div class="controls bullet"><span class="by">neftaly</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38887600">parent</a><span>|</span><a href="#38889267">prev</a><span>|</span><a href="#38888308">next</a><span>|</span><label class="collapse" for="c-38888087">[-]</label><label class="expand" for="c-38888087">[5 more]</label></div><br/><div class="children"><div class="content">R2 was used because it was the only database-like service CF offered at the time.<p>IIRC the P2pcf client polls the worker for new peers. Pubsub would let you use an ongoing websockets connection, plus all the channel management logic is built-in. The game-changer is that they&#x27;ve said they&#x27;ll charge per-message as opposed to per-connection-second, unlike everyone else!</div><br/><div id="38888533" class="c"><input type="checkbox" id="c-38888533" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38888087">parent</a><span>|</span><a href="#38889271">next</a><span>|</span><label class="collapse" for="c-38888533">[-]</label><label class="expand" for="c-38888533">[2 more]</label></div><br/><div class="children"><div class="content">That’s not true though. DO&#x2F;D2 are database as well (DO precedes R2 and D2 overlapped). KV is an eventually consistent database.<p>DO&#x2F;D2 will likely perform better than R2 unless you’re storing everything in the metadata. KV will perform better than all of them although if the storage is to keep a list of peers the API as exists today won’t work well for that - you’ll have to do 1 key per connection and retrieve via a paged list - otherwise you can lose clients since KV has no mechanism to do durable updates of values stored within keys*. You could also do DO with background refresh of cache to maintain good performance while maintaining better bounds on how long a value stays in the cache.<p>* actually it is possible if you mediate updates to KV through a DO (with storage as the ground truth or without it and risk occasional lost writes if the CF infrastructure decides to kill and reset&#x2F;relocate your DO).</div><br/><div id="38889678" class="c"><input type="checkbox" id="c-38889678" checked=""/><div class="controls bullet"><span class="by">neftaly</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38888533">parent</a><span>|</span><a href="#38889271">next</a><span>|</span><label class="collapse" for="c-38889678">[-]</label><label class="expand" for="c-38889678">[1 more]</label></div><br/><div class="children"><div class="content">Fair enough, I didn&#x27;t investigate them very far, as IMO only pubsub maps to the &quot;webrtc signalling for misers&quot; problem neatly enough to make it worth adopting (probably -- they haven&#x27;t actually said how much it will cost).</div><br/></div></div></div></div><div id="38889271" class="c"><input type="checkbox" id="c-38889271" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38888087">parent</a><span>|</span><a href="#38888533">prev</a><span>|</span><a href="#38888308">next</a><span>|</span><label class="collapse" for="c-38889271">[-]</label><label class="expand" for="c-38889271">[2 more]</label></div><br/><div class="children"><div class="content">At the time I wrote this library using websockets on Cloudflare would have been prohibitively expensive compared to this polling method. Has that changed?</div><br/><div id="38889633" class="c"><input type="checkbox" id="c-38889633" checked=""/><div class="controls bullet"><span class="by">neftaly</span><span>|</span><a href="#38886471">root</a><span>|</span><a href="#38889271">parent</a><span>|</span><a href="#38888308">next</a><span>|</span><label class="collapse" for="c-38889633">[-]</label><label class="expand" for="c-38889633">[1 more]</label></div><br/><div class="children"><div class="content">From my understanding, yes. I asked about the billing model on the CF Discord 6-12? months ago. I don&#x27;t know how much it costs per message, or if there is a catch wrt cheap wrtc signalling, however my understanding is that you won&#x27;t be paying per user or per hour etc. To be clear this is through their MQTT 5.0 service only.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="38888308" class="c"><input type="checkbox" id="c-38888308" checked=""/><div class="controls bullet"><span class="by">k8svet</span><span>|</span><a href="#38886471">prev</a><span>|</span><a href="#38888027">next</a><span>|</span><label class="collapse" for="c-38888308">[-]</label><label class="expand" for="c-38888308">[3 more]</label></div><br/><div class="children"><div class="content">Why oh why does this use R2 instead of CF&#x27;s KC product? For just signaling? I don&#x27;t get it.</div><br/><div id="38889090" class="c"><input type="checkbox" id="c-38889090" checked=""/><div class="controls bullet"><span class="by">k8svet</span><span>|</span><a href="#38888308">parent</a><span>|</span><a href="#38888027">next</a><span>|</span><label class="collapse" for="c-38889090">[-]</label><label class="expand" for="c-38889090">[2 more]</label></div><br/><div class="children"><div class="content">I meant KV, and another comment mentions that it didn&#x27;t exist at the time? I don&#x27;t understand that though, since KV debuted in 2018, R2 in 2022-ish. (see: <a href="https:&#x2F;&#x2F;blog.cloudflare.com&#x2F;introducing-workers-kv" rel="nofollow">https:&#x2F;&#x2F;blog.cloudflare.com&#x2F;introducing-workers-kv</a>)</div><br/><div id="38889274" class="c"><input type="checkbox" id="c-38889274" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38888308">root</a><span>|</span><a href="#38889090">parent</a><span>|</span><a href="#38888027">next</a><span>|</span><label class="collapse" for="c-38889274">[-]</label><label class="expand" for="c-38889274">[1 more]</label></div><br/><div class="children"><div class="content">Author here. I tried KV first. It didn&#x27;t work because of replication lag between edge nodes.</div><br/></div></div></div></div></div></div><div id="38888027" class="c"><input type="checkbox" id="c-38888027" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#38888308">prev</a><span>|</span><label class="collapse" for="c-38888027">[-]</label><label class="expand" for="c-38888027">[6 more]</label></div><br/><div class="children"><div class="content">can we stop calling cloudflare worker &quot;serverless&quot; ? There are multiple god damn servers.</div><br/><div id="38889310" class="c"><input type="checkbox" id="c-38889310" checked=""/><div class="controls bullet"><span class="by">gfodor</span><span>|</span><a href="#38888027">parent</a><span>|</span><a href="#38888172">next</a><span>|</span><label class="collapse" for="c-38889310">[-]</label><label class="expand" for="c-38889310">[1 more]</label></div><br/><div class="children"><div class="content">the fact that &#x27;serverless&#x27; platforms use servers doesn&#x27;t take away from the fact that the label &#x27;serverless&#x27; has useful meaning in describing a kind of platform<p>you should just start re-writing the word in your head to something less upsetting since it&#x27;s not going anywhere and it actually does contain information</div><br/></div></div><div id="38888172" class="c"><input type="checkbox" id="c-38888172" checked=""/><div class="controls bullet"><span class="by">bosch_mind</span><span>|</span><a href="#38888027">parent</a><span>|</span><a href="#38889310">prev</a><span>|</span><a href="#38888176">next</a><span>|</span><label class="collapse" for="c-38888172">[-]</label><label class="expand" for="c-38888172">[2 more]</label></div><br/><div class="children"><div class="content">I suggest you review the definition of serverless.<p>Serverless computing is a cloud computing execution model in which the cloud provider allocates machine resources on demand</div><br/><div id="38888967" class="c"><input type="checkbox" id="c-38888967" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#38888027">root</a><span>|</span><a href="#38888172">parent</a><span>|</span><a href="#38888176">next</a><span>|</span><label class="collapse" for="c-38888967">[-]</label><label class="expand" for="c-38888967">[1 more]</label></div><br/><div class="children"><div class="content">yeah we had that some 15 years ago like Google App Engine</div><br/></div></div></div></div><div id="38888176" class="c"><input type="checkbox" id="c-38888176" checked=""/><div class="controls bullet"><span class="by">kolanos</span><span>|</span><a href="#38888027">parent</a><span>|</span><a href="#38888172">prev</a><span>|</span><label class="collapse" for="c-38888176">[-]</label><label class="expand" for="c-38888176">[2 more]</label></div><br/><div class="children"><div class="content">But do you have to manage them?</div><br/><div id="38888992" class="c"><input type="checkbox" id="c-38888992" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#38888027">root</a><span>|</span><a href="#38888176">parent</a><span>|</span><label class="collapse" for="c-38888992">[-]</label><label class="expand" for="c-38888992">[1 more]</label></div><br/><div class="children"><div class="content">Some people jokingly call that Stored Procedure in the 21st century.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>