<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1718528458055" as="style"/><link rel="stylesheet" href="styles.css?v=1718528458055"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://micropolisweb.com/">SimCity in the web browser using WebAssembly and OpenGL</a> <span class="domain">(<a href="https://micropolisweb.com">micropolisweb.com</a>)</span></div><div class="subtext"><span>tambourine_man</span> | <span>16 comments</span></div><br/><div><div id="40695222" class="c"><input type="checkbox" id="c-40695222" checked=""/><div class="controls bullet"><span class="by">modeless</span><span>|</span><a href="#40695269">next</a><span>|</span><label class="collapse" for="c-40695222">[-]</label><label class="expand" for="c-40695222">[4 more]</label></div><br/><div class="children"><div class="content">Porting old games to the web is fun! Many are smaller than a typical modern webpage. They load fast and run great.<p>I just ported Quake 3 and I&#x27;m having some fun with it: <a href="https:&#x2F;&#x2F;thelongestyard.link&#x2F;" rel="nofollow">https:&#x2F;&#x2F;thelongestyard.link&#x2F;</a></div><br/><div id="40695362" class="c"><input type="checkbox" id="c-40695362" checked=""/><div class="controls bullet"><span class="by">geuis</span><span>|</span><a href="#40695222">parent</a><span>|</span><a href="#40695595">next</a><span>|</span><label class="collapse" for="c-40695362">[-]</label><label class="expand" for="c-40695362">[2 more]</label></div><br/><div class="children"><div class="content">That was a lot of fun and a blast from the past. Thanks for porting that.</div><br/><div id="40695394" class="c"><input type="checkbox" id="c-40695394" checked=""/><div class="controls bullet"><span class="by">modeless</span><span>|</span><a href="#40695222">root</a><span>|</span><a href="#40695362">parent</a><span>|</span><a href="#40695595">next</a><span>|</span><label class="collapse" for="c-40695394">[-]</label><label class="expand" for="c-40695394">[1 more]</label></div><br/><div class="children"><div class="content">Thanks! This is loading just the demo assets, but I got the Emscripten support merged into upstream ioquake3 so you can check out the code, build it yourself, and with the right game asset files you can play the full game, Team Arena, mods, or whatever.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;ioquake&#x2F;ioq3&#x2F;pull&#x2F;658">https:&#x2F;&#x2F;github.com&#x2F;ioquake&#x2F;ioq3&#x2F;pull&#x2F;658</a><p>The only major feature missing from the original game is networking. Obviously kind of important for Quake 3. Should be possible with WebRTC DataChannel. And while the original game didn&#x27;t have it, for the modern web a touchscreen control scheme is essential since half of everyone is on their phone. Of course it won&#x27;t be great compared to mouse&#x2F;keyboard but some mobile support is better than none. So those are the two features I&#x27;d like to add (besides performance optimizations; it&#x27;s a bit slower than it should be for some reason).</div><br/></div></div></div></div><div id="40695595" class="c"><input type="checkbox" id="c-40695595" checked=""/><div class="controls bullet"><span class="by">Jyaif</span><span>|</span><a href="#40695222">parent</a><span>|</span><a href="#40695362">prev</a><span>|</span><a href="#40695269">next</a><span>|</span><label class="collapse" for="c-40695595">[-]</label><label class="expand" for="c-40695595">[1 more]</label></div><br/><div class="children"><div class="content">That input latency is why I hate browsers when making games.<p>Great job though!</div><br/></div></div></div></div><div id="40695269" class="c"><input type="checkbox" id="c-40695269" checked=""/><div class="controls bullet"><span class="by">detuks</span><span>|</span><a href="#40695222">prev</a><span>|</span><a href="#40695053">next</a><span>|</span><label class="collapse" for="c-40695269">[-]</label><label class="expand" for="c-40695269">[1 more]</label></div><br/><div class="children"><div class="content">A while back ported RuneScape client to web.
<a href="https:&#x2F;&#x2F;play.rsps.app&#x2F;" rel="nofollow">https:&#x2F;&#x2F;play.rsps.app&#x2F;</a>
Wasm, Typescript and WebGL</div><br/></div></div><div id="40695053" class="c"><input type="checkbox" id="c-40695053" checked=""/><div class="controls bullet"><span class="by">super_linear</span><span>|</span><a href="#40695269">prev</a><span>|</span><a href="#40695565">next</a><span>|</span><label class="collapse" for="c-40695053">[-]</label><label class="expand" for="c-40695053">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore">https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore</a></div><br/></div></div><div id="40695565" class="c"><input type="checkbox" id="c-40695565" checked=""/><div class="controls bullet"><span class="by">DonHopkins</span><span>|</span><a href="#40695053">prev</a><span>|</span><a href="#40695244">next</a><span>|</span><label class="collapse" for="c-40695565">[-]</label><label class="expand" for="c-40695565">[2 more]</label></div><br/><div class="children"><div class="content">Micropolis Web Demo 1:<p>Micropolis Web is the browser based version of Micropolis (open source SimCity), that uses WebAssembly, WebGL, and SvelteKit. Based on the original SimCity Classic code, designed by Will Wright, ported by Don Hopkins. This first demo shows an early version that runs the WebAssembly simulator and animates the tiles with WebGL, but most of the user interface is still a work in progress.<p>Live MicropolisWeb Site:
<a href="https:&#x2F;&#x2F;MicropolisWeb.com" rel="nofollow">https:&#x2F;&#x2F;MicropolisWeb.com</a><p>GitHub Repo with source code and documentation:
<a href="https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore">https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore</a><p>Much more Info in Chaim Gingold&#x27;s book, &quot;Building SimCity&quot;:
<a href="https:&#x2F;&#x2F;mitpress.mit.edu&#x2F;9780262547482&#x2F;building-simcity&#x2F;" rel="nofollow">https:&#x2F;&#x2F;mitpress.mit.edu&#x2F;9780262547482&#x2F;building-simcity&#x2F;</a><p>Chaim Gingold&#x27;s &quot;SimCity Reverse Diagrams&quot;:
<a href="https:&#x2F;&#x2F;smalltalkzoo.thechm.org&#x2F;users&#x2F;Dan&#x2F;uploads&#x2F;SimCityReverseDiagrams.pdf" rel="nofollow">https:&#x2F;&#x2F;smalltalkzoo.thechm.org&#x2F;users&#x2F;Dan&#x2F;uploads&#x2F;SimCityRev...</a><p>Micropolis Web Space Inventory Cellular Automata Music 1:<p>Micropolis Web is the browser based version of Micropolis (open source SimCity), that uses WebAssembly, WebGL, and SvelteKit. Based on the original SimCity Classic code, designed by Will Wright, ported by Don Hopkins. This first video has music by Juho Hietala, Blamstrain, and the Space Inventory Cellular Automata is performed by Don Hopkins.<p>Music by Juho Hietala, Blamstrain:
<a href="https:&#x2F;&#x2F;blamstrain.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;blamstrain.com&#x2F;</a></div><br/><div id="40695667" class="c"><input type="checkbox" id="c-40695667" checked=""/><div class="controls bullet"><span class="by">ziggy_star</span><span>|</span><a href="#40695565">parent</a><span>|</span><a href="#40695244">next</a><span>|</span><label class="collapse" for="c-40695667">[-]</label><label class="expand" for="c-40695667">[1 more]</label></div><br/><div class="children"><div class="content">Mr Hopkins you are by far one of my favorite posters on this website and these sort of comments you post are gold.<p>On occasion they get appropriate engagement but sometimes there are no replies.<p>You should know that it does not go unnoticed. The breadcrumbs you leave will be followed by youngsters far into the future, a worthwhile endeavor.<p>Thank you for brightening my sunday and everything you’ve done and your efforts at documenting and preserving these things.<p>While HN is not what it used to be I consider you loyalty and old school users like yourself are the reason many of us still frequent this place. Cheers.</div><br/></div></div></div></div><div id="40695244" class="c"><input type="checkbox" id="c-40695244" checked=""/><div class="controls bullet"><span class="by">_ache_</span><span>|</span><a href="#40695565">prev</a><span>|</span><a href="#40695027">next</a><span>|</span><label class="collapse" for="c-40695244">[-]</label><label class="expand" for="c-40695244">[2 more]</label></div><br/><div class="children"><div class="content">Seriously, I&#x27;m stun about what happen if you it the space bar. Nice fractals.</div><br/><div id="40695544" class="c"><input type="checkbox" id="c-40695544" checked=""/><div class="controls bullet"><span class="by">DonHopkins</span><span>|</span><a href="#40695244">parent</a><span>|</span><a href="#40695027">next</a><span>|</span><label class="collapse" for="c-40695544">[-]</label><label class="expand" for="c-40695544">[1 more]</label></div><br/><div class="children"><div class="content">Game Helpin&#x27; Squad&#x27;s review of World Quester 2 is the inspiration for the Space Inventory, and I aspire to design the Micropolis menus and user interface to be as freaking awesome as World Quester 2!<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=0Gy9hJauXns" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=0Gy9hJauXns</a></div><br/></div></div></div></div><div id="40695027" class="c"><input type="checkbox" id="c-40695027" checked=""/><div class="controls bullet"><span class="by">gnfedhjmm2</span><span>|</span><a href="#40695244">prev</a><span>|</span><a href="#40695363">next</a><span>|</span><label class="collapse" for="c-40695027">[-]</label><label class="expand" for="c-40695027">[3 more]</label></div><br/><div class="children"><div class="content">It’s funny I was thinking about writing some browser based games using Pyscript with web assembly. But now I think by the time I finish the games they’ll have ported enough of Python into web assembly that I might as well write it with Kivy or Pygame and then it would be cross platform. Pygame already in the browser, but slow and clunky IMO. In 6 months who knows?</div><br/><div id="40695138" class="c"><input type="checkbox" id="c-40695138" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#40695027">parent</a><span>|</span><a href="#40695363">next</a><span>|</span><label class="collapse" for="c-40695138">[-]</label><label class="expand" for="c-40695138">[2 more]</label></div><br/><div class="children"><div class="content">Don&#x27;t let analysis paralysis deter you from writing games. Pyscript is fine. Other stuff is fine too. Pick whatever technology you want, and make quick games with rapid prototyping. Join some game jams and keep your scope small. It&#x27;s better to create and ship many small games.<p>About pygame in the browser: check out pygbag.</div><br/></div></div></div></div><div id="40695363" class="c"><input type="checkbox" id="c-40695363" checked=""/><div class="controls bullet"><span class="by">simonebrunozzi</span><span>|</span><a href="#40695027">prev</a><span>|</span><label class="collapse" for="c-40695363">[-]</label><label class="expand" for="c-40695363">[2 more]</label></div><br/><div class="children"><div class="content">Wondering whether an LLM could be able to port a game like this instantly.</div><br/><div id="40695588" class="c"><input type="checkbox" id="c-40695588" checked=""/><div class="controls bullet"><span class="by">DonHopkins</span><span>|</span><a href="#40695363">parent</a><span>|</span><label class="collapse" for="c-40695588">[-]</label><label class="expand" for="c-40695588">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using ChatGPT to develop it, and it&#x27;s helped a lot, and takes a great deal of iteration and guidance, but it&#x27;s anything but instant.<p>LLMs won&#x27;t replace programmers, but programmers with LLMs will replace programmers without LLMs.<p>Here&#x27;s an example of how it was helpful in simply explaining the documentation and best practices of tools like Emscripten and Embind, getting the makefile to work, analyzing the code, categorizing methods and instance variables as private and public (to be wrapped by embind), generating the boilerplate Embind declarations, and writing the documentation through a back-and-forth discussion of goals and requirements, and acting like a glorified grep that actually understands the code syntax and accepts English queries instead of obscure command line arguments.<p>The comments at the top were mostly written by ChatGPT in response to me writing the strategy, telling it in detail what I wanted to do, describing my goals, and how I wanted it to work, with lots of iterating and refining and hand editing:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore&#x2F;blob&#x2F;main&#x2F;MicropolisEngine&#x2F;src&#x2F;emscripten.cpp">https:&#x2F;&#x2F;github.com&#x2F;SimHacker&#x2F;MicropolisCore&#x2F;blob&#x2F;main&#x2F;Microp...</a><p>The process was anything but automatic and instant -- in total it took about 33 years (and counting, I&#x27;m not done yet).<p>I had to guide ChatGPT a lot, drawing from my previous experience porting the Mac version of SimCity to HyperLook on the NeWS window system in 1991.<p>At the time I considered using a Mac compatibility library for X11, but that would have resulted in a terrible klunky user interface, could not have taken advantages of the Sun Workstation Unix programming and user interface environment (networking, big screen, pie menus and other nice user interface components, lots of computing power to zoom into the map, run the simulation super fast by skipping screen updates, etc), tied the game to a proprietary library that is long obsolete, and would have only supported X11, not NeWS.<p>For a game like SimCity, it was well worth throwing away the Mac UI, cleaning up the simulator to be independent of the UI, and writing a new high quality UI for HyperLook in NeWS (then later another for TCL&#x2F;Tk in X11).<p>Porting it to NeWS required separating the simulator from the user interface and defining a clean network API and shared memory raster animation library, rewriting the user interface in PostScript, and defining a messaging protocol between the simulator and UI.<p>Then a few years later I ported that to TCL&#x2F;Tk on X11, refactoring the simulator&#x2F;UI messaging interface into TCL extensions. TCL&#x2F;Tk made it possible to develop a networked multi-player version of SimCity.<p>A couple of decades later after we made SimCity open source, I cleaned up and refactored the simulator code into C++, and used SWIG to define the API and a callback mechanism, so I could plug it into Python.<p>I implemented a couple of Python user interfaces, including a desktop based PyGTK&#x2F;Cairo&#x2F;X11 interface, and a web based TurboGears&#x2F;AMF&#x2F;OpenLaszlo&#x2F;Flash client&#x2F;server interface.<p>Bil Simser used SWIG it integrate the simulator engine with C#. (SWIG&#x27;s point is to integrate C++ code into many different scripting languages, not just Python.)<p>After all that work, I had a pretty good idea how to prompt ChatGPT to write a design for the Emscripten&#x2F;Embind API, and it was helpful for writing the boilerplate code, and validating the design, but not so much for coming up with the design in the first place.<p>Beyond refactoring and wrapping the API, ChatGPT has also been extremely useful for learning the intricacies and best practices of TypeScript, for developing the user interface.<p><pre><code>  &#x2F;&#x2F; Strategy for Wrapping
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 1. Core Simulation Logic: Focus on the core simulation aspects, such
  &#x2F;&#x2F;    as the methods to run the simulation, update game states, and handle
  &#x2F;&#x2F;    user inputs (like building tools and disaster simulations). This is
  &#x2F;&#x2F;    crucial for any gameplay functionality.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 2. Memory and Performance Considerations: JavaScript and WebAssembly
  &#x2F;&#x2F;    run in a browser context, which can have memory limitations and
  &#x2F;&#x2F;    performance constraints. Carefully manage memory allocation,
  &#x2F;&#x2F;    especially when dealing with the game&#x27;s map and various buffers.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 3. Direct Memory Access: Provide JavaScript access to critical game
  &#x2F;&#x2F;    data structures like the map buffer for efficient reading and
  &#x2F;&#x2F;    writing. This can be done using Emscripten&#x27;s heap access functions
  &#x2F;&#x2F;    (HEAP8, HEAP16, HEAP32, etc.).
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 4. User Interface and Rendering: This part might not be necessary to
  &#x2F;&#x2F;    wrap, as modern web technologies (HTML, CSS, WebGL) can be used for
  &#x2F;&#x2F;    UI. However, providing some hooks for game state (like score, budget,
  &#x2F;&#x2F;    etc.) to JavaScript might be helpful.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 5. Callbacks and Interactivity: Ensure that key game events and
  &#x2F;&#x2F;    callbacks are exposed to JavaScript, allowing for interactive and
  &#x2F;&#x2F;    responsive gameplay.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; 6. Optimizations: Where possible, optimize C++ code for WebAssembly,
  &#x2F;&#x2F;    focusing on critical paths in the simulation loop.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; Decisions and Explanations
  &#x2F;&#x2F;
  &#x2F;&#x2F; - Excluded Elements:
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Low-level rendering or platform-specific code, as this can be
  &#x2F;&#x2F;       handled more efficiently with web technologies.
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Parts of the code that handle file I&#x2F;O directly, as file access
  &#x2F;&#x2F;       in a web context is typically handled differently (e.g., using
  &#x2F;&#x2F;       browser APIs or server-side support).
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Any networking or multiplayer code, as web-based
  &#x2F;&#x2F;       implementations would differ significantly from desktop-based
  &#x2F;&#x2F;       network code.
  &#x2F;&#x2F;
  &#x2F;&#x2F; - Included Elements:
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Core game mechanics, such as map generation, zone simulation
  &#x2F;&#x2F;       (residential, commercial, industrial), disaster simulation, and
  &#x2F;&#x2F;       basic utilities.
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Game state management, including budgeting, scoring, and city
  &#x2F;&#x2F;       evaluation.
  &#x2F;&#x2F;       
  &#x2F;&#x2F;     - Direct memory access to critical structures like the map
  &#x2F;&#x2F;       buffer, allowing efficient manipulation from JavaScript.
  &#x2F;&#x2F; 
  &#x2F;&#x2F;     - Essential callbacks and event handling mechanisms to ensure
  &#x2F;&#x2F;       interactivity.
  &#x2F;&#x2F;
  &#x2F;&#x2F; Conclusion
  &#x2F;&#x2F; 
  &#x2F;&#x2F; Given the complexity and size of the Micropolis class, wrapping the
  &#x2F;&#x2F; entire class directly is impractical. However, focusing on key areas
  &#x2F;&#x2F; essential for gameplay and providing efficient interfaces for
  &#x2F;&#x2F; critical data structures can create a functional and interactive city
  &#x2F;&#x2F; simulation in a web context. Further optimizations and adjustments
  &#x2F;&#x2F; would likely be needed based on testing and specific requirements of
  &#x2F;&#x2F; the web implementation.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; Implementation Notes
  &#x2F;&#x2F;
  &#x2F;&#x2F; The enum_, class_, constructor, function, and property functions
  &#x2F;&#x2F; from the emscripten namespace are used to specify how C++
  &#x2F;&#x2F; constructs should be exposed to JavaScript. You can use these to
  &#x2F;&#x2F; control which parts of your code are accessible and how they should
  &#x2F;&#x2F; be used from JavaScript.
  &#x2F;&#x2F;
  &#x2F;&#x2F; I&#x27;ve made some assumptions here:
  &#x2F;&#x2F;
  &#x2F;&#x2F; The types MapValue and MapTile are simple types (like integers or
  &#x2F;&#x2F; floats). If they are complex types, they would need their own
  &#x2F;&#x2F; bindings.
  &#x2F;&#x2F;
  &#x2F;&#x2F; I&#x27;m assuming that the copy constructor and copy assignment
  &#x2F;&#x2F; operator for the Position class are correctly implemented. If
  &#x2F;&#x2F; they aren&#x27;t, then the Position object may not behave as expected
  &#x2F;&#x2F; in JavaScript.
  &#x2F;&#x2F; 
  &#x2F;&#x2F; Micropolis Binding Design
  &#x2F;&#x2F;
  &#x2F;&#x2F; The Micropolis interface organizes the Micropolis class header into
  &#x2F;&#x2F; categories of functions that are relevant for interaction with the
  &#x2F;&#x2F; JavaScript user interface, scripts, or plugins. The aim is to expose
  &#x2F;&#x2F; functions that could help in monitoring and controlling game state
  &#x2F;&#x2F; effectively.
  &#x2F;&#x2F;</code></pre></div><br/></div></div></div></div></div></div></div></div></div></body></html>