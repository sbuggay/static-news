<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727859676626" as="style"/><link rel="stylesheet" href="styles.css?v=1727859676626"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sidhion.com/blog/posts/nixos_server_issues/">NixOS is a good server OS, except when it isn&#x27;t</a> <span class="domain">(<a href="https://sidhion.com">sidhion.com</a>)</span></div><div class="subtext"><span>IrisBMeredith</span> | <span>78 comments</span></div><br/><div><div id="41718100" class="c"><input type="checkbox" id="c-41718100" checked=""/><div class="controls bullet"><span class="by">arianvanp</span><span>|</span><a href="#41717638">next</a><span>|</span><label class="collapse" for="c-41718100">[-]</label><label class="expand" for="c-41718100">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know any other OS where you could even go on such a trip so easily! Figuring out why things are where and being able to disable them like this is pretty cool.<p>I was really surprised you were able to replace systemdMinimal with systemd in dbus though.<p>I thought it was there to break the cyclic dependency between systemd and dbus</div><br/></div></div><div id="41717638" class="c"><input type="checkbox" id="c-41717638" checked=""/><div class="controls bullet"><span class="by">0x1ceb00da</span><span>|</span><a href="#41718100">prev</a><span>|</span><a href="#41717551">next</a><span>|</span><label class="collapse" for="c-41717638">[-]</label><label class="expand" for="c-41717638">[20 more]</label></div><br/><div class="children"><div class="content">He didn&#x27;t mention that nix uses a lot of ram. If your server is tiny and doesn&#x27;t have swap enabled, running nix command s will make it unresponsive. Are there any nixos alternative that allow you to do system wide configuration from a single source similar to configuration.nix?</div><br/><div id="41717745" class="c"><input type="checkbox" id="c-41717745" checked=""/><div class="controls bullet"><span class="by">niz4ts</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717685">next</a><span>|</span><label class="collapse" for="c-41717745">[-]</label><label class="expand" for="c-41717745">[1 more]</label></div><br/><div class="children"><div class="content">(I&#x27;m the post author)<p>As others said, I&#x27;ve moved away from doing nix builds on servers and into a less wasteful (if you&#x27;re running multiple servers) approach of building once, deploying the bits into a cache, and making the servers fetch them from a cache. I&#x27;ve been slowly working on my own tool to make this workflow easier (nixless-agent, you can find an early version on GitHub).</div><br/></div></div><div id="41717685" class="c"><input type="checkbox" id="c-41717685" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717745">prev</a><span>|</span><a href="#41717683">next</a><span>|</span><label class="collapse" for="c-41717685">[-]</label><label class="expand" for="c-41717685">[3 more]</label></div><br/><div class="children"><div class="content">If you have a different machine with more ram and compute, you can use &#x27;nixos-rebuild --target-host=&lt;server&gt; switch&#x27;. That does all the nix building on the local machine, and then just copies binaries and activates the built configuration on the remote machine.</div><br/><div id="41718004" class="c"><input type="checkbox" id="c-41718004" checked=""/><div class="controls bullet"><span class="by">0x1ceb00da</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717685">parent</a><span>|</span><a href="#41717683">next</a><span>|</span><label class="collapse" for="c-41718004">[-]</label><label class="expand" for="c-41718004">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t run nixos on my PC</div><br/><div id="41718013" class="c"><input type="checkbox" id="c-41718013" checked=""/><div class="controls bullet"><span class="by">arianvanp</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41718004">parent</a><span>|</span><a href="#41717683">next</a><span>|</span><label class="collapse" for="c-41718013">[-]</label><label class="expand" for="c-41718013">[1 more]</label></div><br/><div class="children"><div class="content">you don&#x27;t need to have nixos to have nixos-rebuild installed. Just nix</div><br/></div></div></div></div></div></div><div id="41717683" class="c"><input type="checkbox" id="c-41717683" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717685">prev</a><span>|</span><a href="#41717782">next</a><span>|</span><label class="collapse" for="c-41717683">[-]</label><label class="expand" for="c-41717683">[1 more]</label></div><br/><div class="children"><div class="content">You need not perform your nix evaluation on the same device you are targeting. You can nix copy a system closure to your target and activate it, and there are a number of tools in the nix ecosystem to make this easier.<p>Granted, if you local machine is low on RAM, or isn&#x27;t Linux, then you will be in trouble.</div><br/></div></div><div id="41717782" class="c"><input type="checkbox" id="c-41717782" checked=""/><div class="controls bullet"><span class="by">lugu</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717683">prev</a><span>|</span><a href="#41717777">next</a><span>|</span><label class="collapse" for="c-41717782">[-]</label><label class="expand" for="c-41717782">[5 more]</label></div><br/><div class="children"><div class="content">Not similar to nix, but you can look into Yocto. You can use it to generate an OS. It is, much more involved than using nix, but suitable for low memory environments.</div><br/><div id="41718325" class="c"><input type="checkbox" id="c-41718325" checked=""/><div class="controls bullet"><span class="by">tombl</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717782">parent</a><span>|</span><a href="#41717862">next</a><span>|</span><label class="collapse" for="c-41718325">[-]</label><label class="expand" for="c-41718325">[1 more]</label></div><br/><div class="children"><div class="content">The problem with nix is that compiling a system uses lots of memory, but when deployed there&#x27;s little overhead.<p>Like you would with Yocto, I just build my systems on a proper host then remotely deploy them.</div><br/></div></div><div id="41717862" class="c"><input type="checkbox" id="c-41717862" checked=""/><div class="controls bullet"><span class="by">bayindirh</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717782">parent</a><span>|</span><a href="#41718325">prev</a><span>|</span><a href="#41717777">next</a><span>|</span><label class="collapse" for="c-41717862">[-]</label><label class="expand" for="c-41717862">[3 more]</label></div><br/><div class="children"><div class="content">Yocto is also used by Lenovo to build their software appliances like XClarity Administrator.<p>Also it’s very famous and loved in embedded software circles.</div><br/><div id="41717947" class="c"><input type="checkbox" id="c-41717947" checked=""/><div class="controls bullet"><span class="by">deng</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717862">parent</a><span>|</span><a href="#41717898">next</a><span>|</span><label class="collapse" for="c-41717947">[-]</label><label class="expand" for="c-41717947">[1 more]</label></div><br/><div class="children"><div class="content">Well, &quot;loved&quot; is not the word I would use. It&#x27;s an improvement over the chaos before, where everyone used some other bespoke tool to build their BSPs. Yocto at least is some kind of standard now, but not a particularly good one (granted, it&#x27;s a really difficult problem to solve). I don&#x27;t know anyone actually enjoying working with Yocto.</div><br/></div></div><div id="41717898" class="c"><input type="checkbox" id="c-41717898" checked=""/><div class="controls bullet"><span class="by">xyproto</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717862">parent</a><span>|</span><a href="#41717947">prev</a><span>|</span><a href="#41717777">next</a><span>|</span><label class="collapse" for="c-41717898">[-]</label><label class="expand" for="c-41717898">[1 more]</label></div><br/><div class="children"><div class="content">Yocto is also hated for its unnessesary complexity in embedded software circles.</div><br/></div></div></div></div></div></div><div id="41717777" class="c"><input type="checkbox" id="c-41717777" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717782">prev</a><span>|</span><a href="#41717678">next</a><span>|</span><label class="collapse" for="c-41717777">[-]</label><label class="expand" for="c-41717777">[2 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t tried it personnally but Guix is similar with config in guile scheme. Have a look at the documentation [1][2].<p>Caveat: it is a gnu project so no proprietary stuff like firmwares and drivers included out of the box (but there is a community guix nonfree project available [3]). I believe that isn&#x27;t a problem for virtual machine servers anyway.<p>[1] guix cookbook: <a href="https:&#x2F;&#x2F;guix.gnu.org&#x2F;cookbook&#x2F;en&#x2F;html_node&#x2F;index.html#Top" rel="nofollow">https:&#x2F;&#x2F;guix.gnu.org&#x2F;cookbook&#x2F;en&#x2F;html_node&#x2F;index.html#Top</a><p>[3] guix manual: <a href="https:&#x2F;&#x2F;guix.gnu.org&#x2F;manual&#x2F;en&#x2F;html_node&#x2F;index.html#Top" rel="nofollow">https:&#x2F;&#x2F;guix.gnu.org&#x2F;manual&#x2F;en&#x2F;html_node&#x2F;index.html#Top</a><p>[3] <a href="https:&#x2F;&#x2F;github.com&#x2F;guix-users&#x2F;guix-nonfree">https:&#x2F;&#x2F;github.com&#x2F;guix-users&#x2F;guix-nonfree</a></div><br/><div id="41718181" class="c"><input type="checkbox" id="c-41718181" checked=""/><div class="controls bullet"><span class="by">umanwizard</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717777">parent</a><span>|</span><a href="#41717678">next</a><span>|</span><label class="collapse" for="c-41718181">[-]</label><label class="expand" for="c-41718181">[1 more]</label></div><br/><div class="children"><div class="content">The widely used nonfree guided channel is <a href="https:&#x2F;&#x2F;gitlab.com&#x2F;nonguix&#x2F;nonguix" rel="nofollow">https:&#x2F;&#x2F;gitlab.com&#x2F;nonguix&#x2F;nonguix</a>, not the one you linked.</div><br/></div></div></div></div><div id="41717678" class="c"><input type="checkbox" id="c-41717678" checked=""/><div class="controls bullet"><span class="by">dlahoda</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717777">prev</a><span>|</span><a href="#41717674">next</a><span>|</span><label class="collapse" for="c-41717678">[-]</label><label class="expand" for="c-41717678">[1 more]</label></div><br/><div class="children"><div class="content">author does not use nix on his nixos and removed it, so no ram issue.<p>author does not activate new config on host machine, but deploys new host machines as needed.<p>he evals on build&#x2F;dev&#x2F;ci machine only.</div><br/></div></div><div id="41717674" class="c"><input type="checkbox" id="c-41717674" checked=""/><div class="controls bullet"><span class="by">clhodapp</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717678">prev</a><span>|</span><a href="#41717833">next</a><span>|</span><label class="collapse" for="c-41717674">[-]</label><label class="expand" for="c-41717674">[1 more]</label></div><br/><div class="children"><div class="content">It won&#x27;t necessarily do that if you deploy to your server from a remote machine over ssh</div><br/></div></div><div id="41717833" class="c"><input type="checkbox" id="c-41717833" checked=""/><div class="controls bullet"><span class="by">exe34</span><span>|</span><a href="#41717638">parent</a><span>|</span><a href="#41717674">prev</a><span>|</span><a href="#41717551">next</a><span>|</span><label class="collapse" for="c-41717833">[-]</label><label class="expand" for="c-41717833">[5 more]</label></div><br/><div class="children"><div class="content">guix?</div><br/><div id="41718014" class="c"><input type="checkbox" id="c-41718014" checked=""/><div class="controls bullet"><span class="by">0x1ceb00da</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41717833">parent</a><span>|</span><a href="#41717551">next</a><span>|</span><label class="collapse" for="c-41718014">[-]</label><label class="expand" for="c-41718014">[4 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t it use nixos underneath?</div><br/><div id="41718065" class="c"><input type="checkbox" id="c-41718065" checked=""/><div class="controls bullet"><span class="by">danlitt</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41718014">parent</a><span>|</span><a href="#41718111">next</a><span>|</span><label class="collapse" for="c-41718065">[-]</label><label class="expand" for="c-41718065">[2 more]</label></div><br/><div class="children"><div class="content">guix does not use nixos underneath, it&#x27;s a completely independent implementation (of the same underlying concepts)</div><br/><div id="41718417" class="c"><input type="checkbox" id="c-41718417" checked=""/><div class="controls bullet"><span class="by">tkz1312</span><span>|</span><a href="#41717638">root</a><span>|</span><a href="#41718065">parent</a><span>|</span><a href="#41718111">next</a><span>|</span><label class="collapse" for="c-41718417">[-]</label><label class="expand" for="c-41718417">[1 more]</label></div><br/><div class="children"><div class="content">guix is built on top of the nix daemon</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41717551" class="c"><input type="checkbox" id="c-41717551" checked=""/><div class="controls bullet"><span class="by">Larrikin</span><span>|</span><a href="#41717638">prev</a><span>|</span><a href="#41718279">next</a><span>|</span><label class="collapse" for="c-41717551">[-]</label><label class="expand" for="c-41717551">[17 more]</label></div><br/><div class="children"><div class="content">Have there been any good efforts into getting rid of the language or providing an alternative? My effort into switching and the biggest complaint I&#x27;ve read is that the idea behind NixOS and the ecosystem is genius but one of the biggest draw backs is writing everything in Nix.<p>I spend a weekend every so often defining the core of what I want next time I upgrade, but just find it so annoying I&#x27;m sure I won&#x27;t use anything I&#x27;ve written until there&#x27;s a major change in the ecosystem.</div><br/><div id="41718559" class="c"><input type="checkbox" id="c-41718559" checked=""/><div class="controls bullet"><span class="by">seanhunter</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41717640">next</a><span>|</span><label class="collapse" for="c-41718559">[-]</label><label class="expand" for="c-41718559">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think the language is the issue here[1].<p>It seems inevitable to me that some of the design choices around immutability and isolation are going to result in a larger server image (both on disk and in memory) than if you are prepared to forgo those things. For most people that tradeoff is probably worth it but if you want something to run in an embedded server or with a very low disk footprint it&#x27;s probably not right for you.<p>Around 20 years ago people who wanted to do this[2] used to make tiny immutable redhat servers by remounting &#x2F;usr and a few other things read-only after boot so it&#x27;s certainly doable but it&#x27;s a lot more of a pain than what nix does and there is no process isolation and no rollback etc when things go wrong.<p>[1] ...or generally in fact but that&#x27;s a matter of opinion and I know people feel differently about this.<p>[2] me for one, but others also.</div><br/></div></div><div id="41717640" class="c"><input type="checkbox" id="c-41717640" checked=""/><div class="controls bullet"><span class="by">turboponyy</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41718559">prev</a><span>|</span><a href="#41718450">next</a><span>|</span><label class="collapse" for="c-41717640">[-]</label><label class="expand" for="c-41717640">[6 more]</label></div><br/><div class="children"><div class="content">What&#x27;s so bad about it?<p>Putting aside the poor typing (the lack of proper typing is a shame, so valid criticism), I actually really like the language - it&#x27;s genuinely a great DSL for the particular problems it&#x27;s supposed to handle.<p>It does take a bit of use for it to click, though. A lot of it has to do not with Nixlang itself but about learning nixpkgs&#x27; idioms.</div><br/><div id="41717791" class="c"><input type="checkbox" id="c-41717791" checked=""/><div class="controls bullet"><span class="by">k_bx</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717640">parent</a><span>|</span><a href="#41717797">next</a><span>|</span><label class="collapse" for="c-41717791">[-]</label><label class="expand" for="c-41717791">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not just poor typing. It&#x27;s the lack of discoverability. &quot;What are all my options here in this expression? What are the symbols available?&quot;<p>I think a good IDE integration could solve this, but not sure how much is possible.</div><br/><div id="41717864" class="c"><input type="checkbox" id="c-41717864" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717791">parent</a><span>|</span><a href="#41718042">next</a><span>|</span><label class="collapse" for="c-41717864">[-]</label><label class="expand" for="c-41717864">[2 more]</label></div><br/><div class="children"><div class="content">The nix repl can be a very valuable tool in answering these questions.<p>That said, I strive to structure my nix source so that portions of it can easily be pasted into a repl. ReadTree goes a long way in that regard: <a href="https:&#x2F;&#x2F;github.com&#x2F;tvlfyi&#x2F;kit&#x2F;tree&#x2F;canon&#x2F;readTree">https:&#x2F;&#x2F;github.com&#x2F;tvlfyi&#x2F;kit&#x2F;tree&#x2F;canon&#x2F;readTree</a><p>More to your point, though: I think a lot is possible. Although nix is very dynamic, it is also, for all intents and purposes, side effect free. I&#x27;ve had this idea that a sufficiently advanced IDE should be able to evaluate your nix code and tell you exactly what the possible values (not just types, but value!) are for any particular variable.</div><br/><div id="41718306" class="c"><input type="checkbox" id="c-41718306" checked=""/><div class="controls bullet"><span class="by">lloeki</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717864">parent</a><span>|</span><a href="#41718042">next</a><span>|</span><label class="collapse" for="c-41718306">[-]</label><label class="expand" for="c-41718306">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;ve had this idea that a sufficiently advanced IDE should be able to evaluate your nix code and tell you exactly what the possible values (not just types, but value!)<p>Similarly to the REPL, I&#x27;m often using `nix-instantiate --eval -E &#x27;somethingsomething&#x27;` so it should definitely be possible.</div><br/></div></div></div></div><div id="41718042" class="c"><input type="checkbox" id="c-41718042" checked=""/><div class="controls bullet"><span class="by">arianvanp</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717791">parent</a><span>|</span><a href="#41717864">prev</a><span>|</span><a href="#41717797">next</a><span>|</span><label class="collapse" for="c-41718042">[-]</label><label class="expand" for="c-41718042">[1 more]</label></div><br/><div class="children"><div class="content">There is this: <a href="https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixd">https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixd</a><p>It has jump to definition and autocomplete. Which is very nice.<p>It&#x27;s not perfect. But it&#x27;s pretty good</div><br/></div></div></div></div><div id="41717797" class="c"><input type="checkbox" id="c-41717797" checked=""/><div class="controls bullet"><span class="by">logicchains</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717640">parent</a><span>|</span><a href="#41717791">prev</a><span>|</span><a href="#41718450">next</a><span>|</span><label class="collapse" for="c-41717797">[-]</label><label class="expand" for="c-41717797">[1 more]</label></div><br/><div class="children"><div class="content">Way too much sugar&#x2F;&quot;idioms&quot;, which makes it hard for someone new to the language to figure out what a given piece of code is actually doing. Confusing use of semicolons for what almost every other language uses commas or newlines (or nothing) for. It&#x27;s the same feeling as writing bash, and needing to always look up again exactly what the syntax is and where the semicolons go.</div><br/></div></div></div></div><div id="41718450" class="c"><input type="checkbox" id="c-41718450" checked=""/><div class="controls bullet"><span class="by">tkz1312</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41717640">prev</a><span>|</span><a href="#41717663">next</a><span>|</span><label class="collapse" for="c-41718450">[-]</label><label class="expand" for="c-41718450">[2 more]</label></div><br/><div class="children"><div class="content">I find the nix language to be quite pleasant. There are some syntax quirks and types would be nice, but in general the “json with functions” vibe is imo great and a very nice fit for the domain. Lots of other modern config languages (e.g. dhall, jsonnet) have ended up in this part of the design space too.<p>With that said tweag has been working on a kind of nix 2.0 &#x2F; nix with types for a while with the aim (I think) of being able to use it in nixpkgs: <a href="https:&#x2F;&#x2F;github.com&#x2F;tweag&#x2F;nickel">https:&#x2F;&#x2F;github.com&#x2F;tweag&#x2F;nickel</a></div><br/><div id="41718518" class="c"><input type="checkbox" id="c-41718518" checked=""/><div class="controls bullet"><span class="by">the_duke</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41718450">parent</a><span>|</span><a href="#41717663">next</a><span>|</span><label class="collapse" for="c-41718518">[-]</label><label class="expand" for="c-41718518">[1 more]</label></div><br/><div class="children"><div class="content">I also quite like nixlang for config tasks - in theory! In practice its really annoying. I think the main problem is the interpreter and the bad error messages &#x2F; bad debuggability.<p>Part of that just comes from lazy evaluation, which makes debugging a lot harder in general (you feel this in Haskell...), but also just from nix not being a big popular language that gets lots of polish, and being completely dynamically typed.</div><br/></div></div></div></div><div id="41717663" class="c"><input type="checkbox" id="c-41717663" checked=""/><div class="controls bullet"><span class="by">adrian_b</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41718450">prev</a><span>|</span><a href="#41717583">next</a><span>|</span><label class="collapse" for="c-41717663">[-]</label><label class="expand" for="c-41717663">[3 more]</label></div><br/><div class="children"><div class="content">There is Guix, which replaces the Nix language with Scheme, but which has some limitations related to a smaller user base, e.g. a smaller package collection.<p>Replacing the language requires duplicating all the work that went into Nix, to reach parity, so it is not easy.</div><br/><div id="41717826" class="c"><input type="checkbox" id="c-41717826" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717663">parent</a><span>|</span><a href="#41717583">next</a><span>|</span><label class="collapse" for="c-41717826">[-]</label><label class="expand" for="c-41717826">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Replacing the language requires duplicating all the work that went into Nix, to reach parity, so it is not easy.<p>That seems like a design flaw in Nix, there&#x27;s no reason the data model should be so tightly coupled to the scripting implementation that you can&#x27;t reuse packages written in a different language.</div><br/><div id="41717897" class="c"><input type="checkbox" id="c-41717897" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717826">parent</a><span>|</span><a href="#41717583">next</a><span>|</span><label class="collapse" for="c-41717897">[-]</label><label class="expand" for="c-41717897">[1 more]</label></div><br/><div class="children"><div class="content">There is no technical barrier against doing that. But much of the power and flexibility in nixpkgs arises from the nix language, not the data model (which is comparatively simple).<p>For example, see zb: <a href="https:&#x2F;&#x2F;www.zombiezen.com&#x2F;blog&#x2F;2024&#x2F;09&#x2F;zb-early-stage-build-system&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.zombiezen.com&#x2F;blog&#x2F;2024&#x2F;09&#x2F;zb-early-stage-build-...</a><p>Using a different language to depend on packages derived from .nix would be very much akin to depending on a docker image whose Dockerfile you can not inspect.</div><br/></div></div></div></div></div></div><div id="41717583" class="c"><input type="checkbox" id="c-41717583" checked=""/><div class="controls bullet"><span class="by">maxloh</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41717663">prev</a><span>|</span><a href="#41717592">next</a><span>|</span><label class="collapse" for="c-41717583">[-]</label><label class="expand" for="c-41717583">[1 more]</label></div><br/><div class="children"><div class="content">It seems to be an issue with testing and debugging, rather than the language itself. The same issue would also be present if you could switch to any other language for configuration.</div><br/></div></div><div id="41717592" class="c"><input type="checkbox" id="c-41717592" checked=""/><div class="controls bullet"><span class="by">kjuulh</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41717583">prev</a><span>|</span><a href="#41718188">next</a><span>|</span><label class="collapse" for="c-41717592">[-]</label><label class="expand" for="c-41717592">[2 more]</label></div><br/><div class="children"><div class="content">Nickel lang is such an effort. Id say the syntax is a mix of json and lua and aims for a non-touring complete program. It is still a bit early but it looks promising</div><br/><div id="41717665" class="c"><input type="checkbox" id="c-41717665" checked=""/><div class="controls bullet"><span class="by">pxc</span><span>|</span><a href="#41717551">root</a><span>|</span><a href="#41717592">parent</a><span>|</span><a href="#41718188">next</a><span>|</span><label class="collapse" for="c-41717665">[-]</label><label class="expand" for="c-41717665">[1 more]</label></div><br/><div class="children"><div class="content">No, Nickel is Turing-complete. That&#x27;s been one of the characteristics intended to distinguish it from most other configuration languages from the start.<p>See the &#x27;RATIONALE&#x27; document: <a href="https:&#x2F;&#x2F;github.com&#x2F;tweag&#x2F;nickel&#x2F;blob&#x2F;378ece30b3e3c0ab488f65956ca509345ba62900&#x2F;RATIONALE.md#turing-completeness">https:&#x2F;&#x2F;github.com&#x2F;tweag&#x2F;nickel&#x2F;blob&#x2F;378ece30b3e3c0ab488f659...</a></div><br/></div></div></div></div><div id="41718188" class="c"><input type="checkbox" id="c-41718188" checked=""/><div class="controls bullet"><span class="by">umanwizard</span><span>|</span><a href="#41717551">parent</a><span>|</span><a href="#41717592">prev</a><span>|</span><a href="#41718279">next</a><span>|</span><label class="collapse" for="c-41718188">[-]</label><label class="expand" for="c-41718188">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Have there been any good efforts into getting rid of the language or providing an alternative?<p>Guix is conceptually similar to Nix but uses scheme.</div><br/></div></div></div></div><div id="41718279" class="c"><input type="checkbox" id="c-41718279" checked=""/><div class="controls bullet"><span class="by">contrarian1234</span><span>|</span><a href="#41717551">prev</a><span>|</span><a href="#41717542">next</a><span>|</span><label class="collapse" for="c-41718279">[-]</label><label class="expand" for="c-41718279">[2 more]</label></div><br/><div class="children"><div class="content">How &quot;stable&quot; are these kinds of slimming tweaks though? In a rolling release setup, aren&#x27;t you going to have extraneous packages semi-regularly drag in all of Python or Perl accidentally? The setup might break and you&#x27;d not even notice?<p>I find the premise of a carefully re-compilable&#x2F;re-creatable system very appealing, but not having a stable LTS style release rather incongruous. It takes a huge effort to get all the  pieces working together - and if it&#x27;s rolling and the sand is shifting&#x2F;breaking underneath you it feels you never reach a meaningful stable system. Sure you can recreate your well tested working configuration, but the configurations is effectively immediately out of date and unmaintained once any packages are updated<p>I think this is why they effectively only target x64. I&#x27;m not a &quot;distro guy&quot; so maybe I&#x27;m missing something. It seems it&#x27;d be sensible to just 1-to-1 copy Ubuntu LTS package versions (+ patches) and build a NixOS &quot;stable&quot; version that can be patched and updated as people find issues</div><br/><div id="41718399" class="c"><input type="checkbox" id="c-41718399" checked=""/><div class="controls bullet"><span class="by">tkz1312</span><span>|</span><a href="#41718279">parent</a><span>|</span><a href="#41717542">next</a><span>|</span><label class="collapse" for="c-41718399">[-]</label><label class="expand" for="c-41718399">[1 more]</label></div><br/><div class="children"><div class="content">NixOS has stable releases built every 6 months.</div><br/></div></div></div></div><div id="41717542" class="c"><input type="checkbox" id="c-41717542" checked=""/><div class="controls bullet"><span class="by">danieldk</span><span>|</span><a href="#41718279">prev</a><span>|</span><a href="#41717625">next</a><span>|</span><label class="collapse" for="c-41717542">[-]</label><label class="expand" for="c-41717542">[2 more]</label></div><br/><div class="children"><div class="content">The post is much more interesting than the title suggests. Great deep dive into slimming a NixOS system.</div><br/><div id="41717604" class="c"><input type="checkbox" id="c-41717604" checked=""/><div class="controls bullet"><span class="by">koito17</span><span>|</span><a href="#41717542">parent</a><span>|</span><a href="#41717625">next</a><span>|</span><label class="collapse" for="c-41717604">[-]</label><label class="expand" for="c-41717604">[1 more]</label></div><br/><div class="children"><div class="content">I agree. The title made me expect a low-quality, clickbait article. The actual article provides a lot of educational value to users of Nix and those interested in trying to build the smallest Linux distribution that can run Nix. Despite using Nix (the package manager) for so long, I haven&#x27;t considered what it would take to get this. The article answers the question perfectly.</div><br/></div></div></div></div><div id="41717625" class="c"><input type="checkbox" id="c-41717625" checked=""/><div class="controls bullet"><span class="by">pxc</span><span>|</span><a href="#41717542">prev</a><span>|</span><a href="#41717905">next</a><span>|</span><label class="collapse" for="c-41717625">[-]</label><label class="expand" for="c-41717625">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I was trying to bring NixOS to a bare minimum, which is an exercise similar to building containers with the bare minimum required for the software in the container to run. I think this is a worthy endeavour. I think we have all the tools in regular non-docker, non-kubernetes linux to get to a similar outcome, except we won’t need docker or kubernetes or whatever in this new land, thus removing quite a bunch of complexity from the systems we build.<p>&gt; But doing it on top of NixOS currently feels like a bad path to take.<p>The author of this blog post might be interested in playing with not-os, another, much smaller OS built with Nix: <a href="https:&#x2F;&#x2F;github.com&#x2F;cleverca22&#x2F;not-os">https:&#x2F;&#x2F;github.com&#x2F;cleverca22&#x2F;not-os</a><p>Could be a decent source of inspiration!</div><br/><div id="41717762" class="c"><input type="checkbox" id="c-41717762" checked=""/><div class="controls bullet"><span class="by">niz4ts</span><span>|</span><a href="#41717625">parent</a><span>|</span><a href="#41717905">next</a><span>|</span><label class="collapse" for="c-41717762">[-]</label><label class="expand" for="c-41717762">[1 more]</label></div><br/><div class="children"><div class="content">(I&#x27;m the post author)<p>Thanks! I have to admit that I&#x27;ve had the itch to build my own NixOS-inspired system more than once, and I haven&#x27;t done that because I just don&#x27;t have time to dedicate to this among all the other projects I&#x27;m working on. I wasn&#x27;t aware of not-os before, but I&#x27;ll definitely dig into the code!</div><br/></div></div></div></div><div id="41717905" class="c"><input type="checkbox" id="c-41717905" checked=""/><div class="controls bullet"><span class="by">kstenerud</span><span>|</span><a href="#41717625">prev</a><span>|</span><a href="#41718384">next</a><span>|</span><label class="collapse" for="c-41717905">[-]</label><label class="expand" for="c-41717905">[8 more]</label></div><br/><div class="children"><div class="content">I just finished moving all of my servers off NixOS and I&#x27;m finally breathing a sigh of relief.<p>Deterministic systems are a cool idea, but we&#x27;re just not there yet. The headaches and pain involved in maintaining these systems and warping the software to obey are too great.<p>Everything in NixOS works, until it doesn&#x27;t. And when it doesn&#x27;t, woe be unto you.</div><br/><div id="41717931" class="c"><input type="checkbox" id="c-41717931" checked=""/><div class="controls bullet"><span class="by">judofyr</span><span>|</span><a href="#41717905">parent</a><span>|</span><a href="#41718474">next</a><span>|</span><label class="collapse" for="c-41717931">[-]</label><label class="expand" for="c-41717931">[6 more]</label></div><br/><div class="children"><div class="content">What did you replace it with? I&#x27;ve been been using NixOS for a (non-critical) server which replaces another server that was &quot;managed&quot; by Ansible. Now that&#x27;s it running nicely on NixOS, and while it&#x27;s far from perfect, I&#x27;m really struggling to see how I would manage it in any other way. The experience is <i>so</i> much nicer now.</div><br/><div id="41717961" class="c"><input type="checkbox" id="c-41717961" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41717905">root</a><span>|</span><a href="#41717931">parent</a><span>|</span><a href="#41718000">next</a><span>|</span><label class="collapse" for="c-41717961">[-]</label><label class="expand" for="c-41717961">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll echo this. I can&#x27;t imaging going back.<p>And yes, I have put a lot of blood sweat and tears into making things work in nix&#x2F;NixOS. The thing that keeps me invested is once I get something working, it is far easier to keep it working. If nixpkgs updates break my things, I&#x27;m one git bisect away from figuring out what happened.</div><br/></div></div><div id="41718000" class="c"><input type="checkbox" id="c-41718000" checked=""/><div class="controls bullet"><span class="by">kstenerud</span><span>|</span><a href="#41717905">root</a><span>|</span><a href="#41717931">parent</a><span>|</span><a href="#41717961">prev</a><span>|</span><a href="#41718474">next</a><span>|</span><label class="collapse" for="c-41718000">[-]</label><label class="expand" for="c-41718000">[4 more]</label></div><br/><div class="children"><div class="content">I use Proxmox on top of Debian. Surprisingly, I&#x27;m back to Bash scripts to set things up (because Ansible wouldn&#x27;t allow me to orchestrate between a host and a guest - so if I have to change container config during setup, I&#x27;m back to scripts again, AND the complications of Ansible).<p>I basically build up Proxmox container templates, and then build upon those similar to how Docker does it (I don&#x27;t use Docker because they don&#x27;t allow you to specify your MAC address, so you can&#x27;t control them from a separate LAN-based DHCP server - instead you have to map a bunch of ports on your host and then configure all external clients to match... so dumb).<p>I&#x27;ve basically gone full circle at this point:<p>- Docker<p>- LXD with Bash scripts<p>- LXD with a ton of Python<p>- NixOS<p>- Proxmox with Ansible<p>- Proxmox with Bash scripts (albeit much simpler and flatter than last time)<p>Everything is containerized and has its own IP address on the physical LAN, the templates can be regenerated with a simple script, important data is mapped to a host directory (&#x2F;home&#x2F;data&#x2F;my-container, which gets backed up), and destroying and rebuilding an instance container is a cinch.<p>One really nice feature of this setup is that I can tear down and rebuild a template, launch a test container from that, copy the instance data in &#x2F;home&#x2F;data to the new container, make sure it works with the new stuff, and then launch it for real.<p>Now it doesn&#x27;t matter what technology (container or VM) I use. Everything is a completely separate machine as far as the LAN is concerned, which greatly simplifies things.<p>Everything, from host to software to containers &amp; VMs is built &quot;deterministically&quot; (i.e. deterministically enough) from the scripts. Rebuilding the whole thing (server and all) from scratch takes about an hour and a half. I just use the same set of scripts on all of my servers to make management easier. Hosts have minimal software and configuration, and guests do all the real work. Migrating is an rsync &#x2F;home&#x2F;data away.</div><br/><div id="41718307" class="c"><input type="checkbox" id="c-41718307" checked=""/><div class="controls bullet"><span class="by">koyote</span><span>|</span><a href="#41717905">root</a><span>|</span><a href="#41718000">parent</a><span>|</span><a href="#41718329">next</a><span>|</span><label class="collapse" for="c-41718307">[-]</label><label class="expand" for="c-41718307">[2 more]</label></div><br/><div class="children"><div class="content">As someone who uses Proxmox without bash scripts and is scared of the day I have to re-work out all the config files I (often randomly through trial and error) changed:<p>Do you have any tips on how to get started?
Do you simply make the change and then paste the commands needed into a script?<p>Also I assume you have a script to set up the (Proxmox) host machine?<p>I also have quite a few Proxmox specific things that I had to change (e.g. GPU pass-through) which seems to break your &quot;Now it doesn&#x27;t matter what technology (container or VM) I use&quot; advantage.</div><br/><div id="41718439" class="c"><input type="checkbox" id="c-41718439" checked=""/><div class="controls bullet"><span class="by">kstenerud</span><span>|</span><a href="#41717905">root</a><span>|</span><a href="#41718307">parent</a><span>|</span><a href="#41718329">next</a><span>|</span><label class="collapse" for="c-41718439">[-]</label><label class="expand" for="c-41718439">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s one of my host setup files (run this immediately after installing Proxmox from the iso):<p><pre><code>    DATA_SIZE=600GiB

    # Switch to free mode
    rm &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;ceph.list
    rm &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;pve-enterprise.list
    echo &quot;deb http:&#x2F;&#x2F;download.proxmox.com&#x2F;debian&#x2F;pve bookworm pve-no-subscription&quot; &gt;&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;pve-no-subscription.list

    # Setup locale
    sed -i -e &#x27;s&#x2F;# en_US.UTF-8 UTF-8&#x2F;en_US.UTF-8 UTF-8&#x2F;&#x27; &#x2F;etc&#x2F;locale.gen
    locale-gen
    update-locale LANG=en_US.UTF-8 LANGUAGE=en_US LC_ALL=en_US.UTF-8

    apt update
    apt dist-upgrade -y
    apt install -y software-properties-common
    add-apt-repository -y non-free
    apt install -y vainfo intel-media-va-driver-non-free lm-sensors
    apt install -y ansible pip python3-proxmoxer htop strace git

    # Setup user data area
    lvcreate -V ${DATA_SIZE} -T pve&#x2F;data -n home_data
    mke2fs -t ext4 -O ^has_journal &#x2F;dev&#x2F;pve&#x2F;home_data
    mkdir &#x2F;home&#x2F;data
    echo &quot;&#x2F;dev&#x2F;pve&#x2F;home_data    &#x2F;home&#x2F;data   ext4    rw,discard,relatime   0    2&quot; &gt;&gt;&#x2F;etc&#x2F;fstab
    mkdir -p &#x2F;mnt&#x2F;containers&#x2F;media
    echo &quot;&#x2F;&#x2F;media&#x2F;media  &#x2F;mnt&#x2F;containers&#x2F;media cifs  uid=100000,gid=100000,ro,guest,x-systemd.automount 0 0&quot; &gt;&gt;&#x2F;etc&#x2F;fstab
    mkdir -p &#x2F;mnt&#x2F;containers&#x2F;files
    echo &quot;&#x2F;&#x2F;files&#x2F;files  &#x2F;mnt&#x2F;containers&#x2F;files cifs  uid=100000,gid=100000,ro,credentials=&#x2F;etc&#x2F;samba&#x2F;credentials,x-systemd.automount 0 0&quot; &gt;&gt;&#x2F;etc&#x2F;fstab
    systemctl daemon-reload
    mount -a
</code></pre>
The host is kept VERY simple.<p>Here&#x27;s my basic Ubuntu container template:<p><pre><code>    # ============
    # Local config
    # ============

    TEMPLATE_IMAGE=&quot;ubuntu-24.04-standard_24.04-2_amd64.tar.zst&quot;

    INSTANCE_CT=200
    INSTANCE_NAME=template-ubuntu
    INSTANCE_MEMORY=2048

    # ======
    # Script
    # ======

    pveam download local ${TEMPLATE_IMAGE} || true

    pct create $INSTANCE_CT local:vztmpl&#x2F;${TEMPLATE_IMAGE} \
        --hostname ${INSTANCE_NAME} \
        --memory   ${INSTANCE_MEMORY} \
        --rootfs   local-lvm:1 \
        --net0     name=eth0,ip=dhcp,ip6=dhcp,bridge=vmbr0 \
        --ostype   ubuntu \
        --start    1 \
        --timezone host \
        --features nesting=1 \
        --unprivileged 1

    # Use a fast mirror
    pct exec $INSTANCE_CT -- sed -i &#x27;s&#x2F;archive.ubuntu.com&#x2F;ftp.uni-stuttgart.de&#x2F;g&#x27; &#x2F;etc&#x2F;apt&#x2F;sources.list

    # Set up locale
    pct exec $INSTANCE_CT -- sed -i -e &#x27;s&#x2F;# en_US.UTF-8 UTF-8&#x2F;en_US.UTF-8 UTF-8&#x2F;&#x27; &#x2F;etc&#x2F;locale.gen
    pct exec $INSTANCE_CT -- locale-gen
    pct exec $INSTANCE_CT -- update-locale LANG=en_US.UTF-8 LANGUAGE=en_US LC_ALL=en_US.UTF-8

    # Bring everything up to date
    pct exec $INSTANCE_CT -- apt clean
    pct exec $INSTANCE_CT -- apt update
    pct exec $INSTANCE_CT -- apt dist-upgrade -y
    pct exec $INSTANCE_CT -- apt install -y software-properties-common curl

    # Turn this into a template
    pct stop $INSTANCE_CT
    pct template $INSTANCE_CT
</code></pre>
Here&#x27;s my Plex template (with GPU passthrough):<p><pre><code>    # ============
    # Local config
    # ============

    TEMPLATE_CT=200
    INSTANCE_CT=201
    INSTANCE_NAME=template-plex
    INSTANCE_MEMORY=2048

    # ======
    # Script
    # ======

    passthrough_gpu() {
        local instance_id=&quot;$1&quot;
        echo &#x27;lxc.cgroup2.devices.allow: c 226:0 rwm
    lxc.cgroup2.devices.allow: c 226:128 rwm
    lxc.mount.entry: &#x2F;dev&#x2F;dri&#x2F;renderD128 dev&#x2F;dri&#x2F;renderD128 none bind,optional,create=file
    lxc.hook.pre-start: sh -c &quot;chown 0:108 &#x2F;dev&#x2F;dri&#x2F;renderD128&quot;
    &#x27; &gt;&gt; &#x2F;etc&#x2F;pve&#x2F;lxc&#x2F;${instance_id}.conf
    }

    pct clone $TEMPLATE_CT $INSTANCE_CT --full 1
    pct resize $INSTANCE_CT rootfs 2G
    pct set $INSTANCE_CT \
        --hostname ${INSTANCE_NAME} \
        --memory   ${INSTANCE_MEMORY} \
        --net0     name=eth0,ip=dhcp,ip6=dhcp,bridge=vmbr0

    passthrough_gpu $INSTANCE_CT

    pct start $INSTANCE_CT

    pct exec $INSTANCE_CT -- apt update
    pct exec $INSTANCE_CT -- apt dist-upgrade -y

    # Install Plex
    apt_add_key $INSTANCE_CT plexmediaserver https:&#x2F;&#x2F;downloads.plex.tv&#x2F;plex-keys&#x2F;PlexSign.key CD665CBA0E2F88B7373F7CB997203C7B3ADCA79D
    apt_add_repo $INSTANCE_CT plexmediaserver &quot;https:&#x2F;&#x2F;downloads.plex.tv&#x2F;repo&#x2F;deb public main&quot;
    pct exec $INSTANCE_CT -- apt update
    pct exec $INSTANCE_CT -- apt install -y plexmediaserver

    # Turn this into a template
    pct stop $INSTANCE_CT
    pct template $INSTANCE_CT
</code></pre>
Here&#x27;s the Plex instance script (starts a Plex instance going from the Plex template):<p><pre><code>    # ============
    # Local config
    # ============

    TEMPLATE_CT=201
    INSTANCE_CT=20001
    INSTANCE_NAME=plex
    INSTANCE_ADDRESS=99
    INSTANCE_MEMORY=2048

    # ===========
    # Host config
    # ===========

    HOST_DATA=&#x2F;home&#x2F;data
    HOST_BASE_UID=100000
    HOST_BASE_GID=100000

    # ======
    # Script
    # ======

    pct clone $TEMPLATE_CT $INSTANCE_CT --full 1
    pct set $INSTANCE_CT \
        --onboot   1 \
        --hostname ${INSTANCE_NAME} \
        --memory   ${INSTANCE_MEMORY} \
        --net0     name=eth0,hwaddr=12:4B:53:00:00:${INSTANCE_ADDRESS},ip=dhcp,ip6=dhcp,bridge=vmbr0

    # Mount the media dir
    pct set $INSTANCE_CT -mp0 &#x2F;mnt&#x2F;containers&#x2F;media,mp=&#x2F;media

    # Get the UID and GID of the plex user
    pct start $INSTANCE_CT
    PLEX_UID=$(pct exec $INSTANCE_CT -- id -u plex)
    PLEX_GID=$(pct exec $INSTANCE_CT -- id -g plex)
    PLEX_HOST_UID=$(($HOST_BASE_UID+$PLEX_UID))
    PLEX_HOST_GID=$(($HOST_BASE_GID+$PLEX_GID))
    pct stop $INSTANCE_CT

    # Mount the Plex config dir
    mkdir -p &#x2F;home&#x2F;data&#x2F;${INSTANCE_NAME}&#x2F;var-lib-plexmediaserver
    chown -R ${PLEX_HOST_UID}:${PLEX_HOST_GID} ${HOST_DATA}&#x2F;${INSTANCE_NAME}
    chown -R ${PLEX_HOST_UID}:${PLEX_HOST_GID} ${HOST_DATA}&#x2F;${INSTANCE_NAME}&#x2F;var-lib-plexmediaserver
    pct set $INSTANCE_CT -mp1 ${HOST_DATA}&#x2F;${INSTANCE_NAME}&#x2F;var-lib-plexmediaserver,mp=&#x2F;var&#x2F;lib&#x2F;plexmediaserver

    pct start $INSTANCE_CT
    pct exec $INSTANCE_CT -- apt update
    pct exec $INSTANCE_CT -- apt dist-upgrade -y

    IP_ADDR=$(pct exec $INSTANCE_CT -- hostname -I | xargs)
    set +x
    echo &quot;===========================================================&quot;
    echo &quot;FOR FIRST TIME SETUP (no existing config):&quot;
    echo
    echo &quot;Go to https:&#x2F;&#x2F;www.plex.tv&#x2F;claim&#x2F;&quot;
    echo &quot;pct exec $INSTANCE_CT -- curl -X POST &#x27;http:&#x2F;&#x2F;127.0.0.1:32400&#x2F;myplex&#x2F;claim?token=PASTE_TOKEN_HERE&#x27;&quot;
    echo &quot;Then, go to ${IP_ADDR}:32400&quot;
    echo &quot;===========================================================&quot;</code></pre></div><br/></div></div></div></div><div id="41718329" class="c"><input type="checkbox" id="c-41718329" checked=""/><div class="controls bullet"><span class="by">rcarmo</span><span>|</span><a href="#41717905">root</a><span>|</span><a href="#41718000">parent</a><span>|</span><a href="#41718307">prev</a><span>|</span><a href="#41718474">next</a><span>|</span><label class="collapse" for="c-41718329">[-]</label><label class="expand" for="c-41718329">[1 more]</label></div><br/><div class="children"><div class="content">Proxmox really needs to get their cloud-init story together. If they supported cloud-init for LXC a lot of automation and setup issues would just go away…</div><br/></div></div></div></div></div></div><div id="41718474" class="c"><input type="checkbox" id="c-41718474" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#41717905">parent</a><span>|</span><a href="#41717931">prev</a><span>|</span><a href="#41718384">next</a><span>|</span><label class="collapse" for="c-41718474">[-]</label><label class="expand" for="c-41718474">[1 more]</label></div><br/><div class="children"><div class="content">What didn&#x27;t work in your NixOS servers?</div><br/></div></div></div></div><div id="41718384" class="c"><input type="checkbox" id="c-41718384" checked=""/><div class="controls bullet"><span class="by">wg0</span><span>|</span><a href="#41717905">prev</a><span>|</span><a href="#41718243">next</a><span>|</span><label class="collapse" for="c-41718384">[-]</label><label class="expand" for="c-41718384">[4 more]</label></div><br/><div class="children"><div class="content">On borderline, thinking to learn nix. Few questions:<p>Can I define VM images with nix? Can those VM images be loaded into VirtualBox?
Also, possible to do similar to build AMIs or other cloud VMs such as Hetzner where my &quot;Dockerfile&quot; is a nix file which defines the system to be built and then it has everything in place once built including tools, libraries, configuration and such?<p>Thoughts?<p>EDIT: Typos</div><br/><div id="41718481" class="c"><input type="checkbox" id="c-41718481" checked=""/><div class="controls bullet"><span class="by">arianvanp</span><span>|</span><a href="#41718384">parent</a><span>|</span><a href="#41718406">next</a><span>|</span><label class="collapse" for="c-41718481">[-]</label><label class="expand" for="c-41718481">[1 more]</label></div><br/><div class="children"><div class="content">Yep for sure! We even have a neat upload-ami cli tool:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;amis">https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;amis</a></div><br/></div></div><div id="41718406" class="c"><input type="checkbox" id="c-41718406" checked=""/><div class="controls bullet"><span class="by">tkz1312</span><span>|</span><a href="#41718384">parent</a><span>|</span><a href="#41718481">prev</a><span>|</span><a href="#41718243">next</a><span>|</span><label class="collapse" for="c-41718406">[-]</label><label class="expand" for="c-41718406">[2 more]</label></div><br/><div class="children"><div class="content">yes to all.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-generators">https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-generators</a></div><br/><div id="41718463" class="c"><input type="checkbox" id="c-41718463" checked=""/><div class="controls bullet"><span class="by">gallexme</span><span>|</span><a href="#41718384">root</a><span>|</span><a href="#41718406">parent</a><span>|</span><a href="#41718243">next</a><span>|</span><label class="collapse" for="c-41718463">[-]</label><label class="expand" for="c-41718463">[1 more]</label></div><br/><div class="children"><div class="content">And for cloud&#x2F;dedicated servers  perhaps 
<a href="https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-anywhere">https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-anywhere</a><p>(There&#x27;s also a terraform module )
And for state changes 
<a href="https:&#x2F;&#x2F;github.com&#x2F;serokell&#x2F;deploy-rs">https:&#x2F;&#x2F;github.com&#x2F;serokell&#x2F;deploy-rs</a>
Or Colmena &#x2F;nixops&#x2F; and x other<p>For secret handling perhaps 
<a href="https:&#x2F;&#x2F;github.com&#x2F;ryantm&#x2F;agenix&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;ryantm&#x2F;agenix&#x2F;</a>
+
<a href="https:&#x2F;&#x2F;github.com&#x2F;oddlama&#x2F;agenix-rekey">https:&#x2F;&#x2F;github.com&#x2F;oddlama&#x2F;agenix-rekey</a><p>The ecosystem is in my experience  very well fleshed out (7 yrs of use), as long as you don&#x27;t require a knowledgebase&#x2F;wiki&#x2F; up2date documentation, it&#x27;s not been a issue for me since I could always fall back on Linux knowledge and just looking for how other distributions do x &#x2F; how the thing itself is configured , and looking at how perhaps a existing nix module wraps that</div><br/></div></div></div></div></div></div><div id="41718243" class="c"><input type="checkbox" id="c-41718243" checked=""/><div class="controls bullet"><span class="by">aos</span><span>|</span><a href="#41718384">prev</a><span>|</span><a href="#41718344">next</a><span>|</span><label class="collapse" for="c-41718243">[-]</label><label class="expand" for="c-41718243">[1 more]</label></div><br/><div class="children"><div class="content">Have you taken a look at <a href="https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;srvos">https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;srvos</a> ? It’s a collection of profiles for servers by the Numtide folks.</div><br/></div></div><div id="41718344" class="c"><input type="checkbox" id="c-41718344" checked=""/><div class="controls bullet"><span class="by">steeleduncan</span><span>|</span><a href="#41718243">prev</a><span>|</span><a href="#41717822">next</a><span>|</span><label class="collapse" for="c-41718344">[-]</label><label class="expand" for="c-41718344">[1 more]</label></div><br/><div class="children"><div class="content">What is the security update policy with NixOS? I&#x27;ve always had the impression that I would need to upgrade every 6 months to keep getting critical security fixes, which is unappealing compared to e.g. Debian + Nix<p>I know I can revert easily if there are problems when upgrading, but that doesn&#x27;t really apply if security fixes only land in the new branch</div><br/></div></div><div id="41717822" class="c"><input type="checkbox" id="c-41717822" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41718344">prev</a><span>|</span><a href="#41717529">next</a><span>|</span><label class="collapse" for="c-41717822">[-]</label><label class="expand" for="c-41717822">[1 more]</label></div><br/><div class="children"><div class="content">One technique employed by microvm.nix[0] is to mount the hosts &#x2F;nix&#x2F;store into the guest. This won&#x27;t shrink the size of the system, but should allow it to be amortized across many different VMs.<p>I&#x27;m not sure how exploitable a read-only virtiofs share is, so this is perhaps not appropriate in some circumstances.<p>[0]: <a href="https:&#x2F;&#x2F;github.com&#x2F;astro&#x2F;microvm.nix">https:&#x2F;&#x2F;github.com&#x2F;astro&#x2F;microvm.nix</a></div><br/></div></div><div id="41717529" class="c"><input type="checkbox" id="c-41717529" checked=""/><div class="controls bullet"><span class="by">evgpbfhnr</span><span>|</span><a href="#41717822">prev</a><span>|</span><a href="#41717547">next</a><span>|</span><label class="collapse" for="c-41717529">[-]</label><label class="expand" for="c-41717529">[5 more]</label></div><br/><div class="children"><div class="content">Couple of things spring to mind:<p>- didn&#x27;t check if nixos uses it, but coreutil has a single binary mode (like busybox, a single binary is built and symlinks or hardlinks are used to provide all the commands); that might save some space<p>- instead of trying to strip down the system, maybe go the other way around: only include the command you need with its closure?
closure computation is done in a few places (apparmor profile or systemd.confinement come to mind) and it should be possible to just copy whatever your server binary needs, your kernel (since microVM and not container), and run the binary directly as init (maybe with a simple wrapper that hardcodes network or whatsnot)<p>good luck!</div><br/><div id="41717557" class="c"><input type="checkbox" id="c-41717557" checked=""/><div class="controls bullet"><span class="by">pxc</span><span>|</span><a href="#41717529">parent</a><span>|</span><a href="#41717630">next</a><span>|</span><label class="collapse" for="c-41717557">[-]</label><label class="expand" for="c-41717557">[1 more]</label></div><br/><div class="children"><div class="content">&gt; - didn&#x27;t check if nixos uses it, but coreutil has a single binary mode (like busybox, a single binary is built and symlinks or hardlinks are used to provide all the commands); that might save some space<p>It does. If you have coreutils from Nixpkgs installed you can check this with<p><pre><code>  basename &quot;$(realpath &quot;$(which ls)&quot;)&quot;
</code></pre>
If you see &#x27;ls&#x27;, you&#x27;re looking at separate binaries. If you see &#x27;coreutils&#x27;, it&#x27;s a symlink to a singular &#x27;coreutils&#x27; binary.</div><br/></div></div><div id="41717630" class="c"><input type="checkbox" id="c-41717630" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#41717529">parent</a><span>|</span><a href="#41717557">prev</a><span>|</span><a href="#41717658">next</a><span>|</span><label class="collapse" for="c-41717630">[-]</label><label class="expand" for="c-41717630">[1 more]</label></div><br/><div class="children"><div class="content">&gt; go the other way around<p>I&#x27;m not sure about just the one closure since the result needs to boot, but more generally that looks reasonable if your use case fits. There&#x27;s a couple efforts, IIRC, mostly centered around router firmware where &quot;real&quot; nixos doesn&#x27;t fit, ex. <a href="https:&#x2F;&#x2F;gti.telent.net&#x2F;dan&#x2F;liminix" rel="nofollow">https:&#x2F;&#x2F;gti.telent.net&#x2F;dan&#x2F;liminix</a></div><br/></div></div><div id="41717658" class="c"><input type="checkbox" id="c-41717658" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#41717529">parent</a><span>|</span><a href="#41717630">prev</a><span>|</span><a href="#41717547">next</a><span>|</span><label class="collapse" for="c-41717658">[-]</label><label class="expand" for="c-41717658">[2 more]</label></div><br/><div class="children"><div class="content">2 is very interesting to me. I&#x27;d love to see an example of a &quot;scratch&quot; vm build, in a similar spirit to scratch docker builds. Assume I have all my software and kernel built, what is the minimal filesystem that will boot? How much easier can it get when I am only targeting a VM?</div><br/><div id="41717881" class="c"><input type="checkbox" id="c-41717881" checked=""/><div class="controls bullet"><span class="by">rkeene2</span><span>|</span><a href="#41717529">root</a><span>|</span><a href="#41717658">parent</a><span>|</span><a href="#41717547">next</a><span>|</span><label class="collapse" for="c-41717881">[-]</label><label class="expand" for="c-41717881">[1 more]</label></div><br/><div class="children"><div class="content">This might be something you&#x27;re interested in: <a href="https:&#x2F;&#x2F;appfs.rkeene.org&#x2F;web&#x2F;dir?ci=trunk&amp;name=build&#x2F;qemu" rel="nofollow">https:&#x2F;&#x2F;appfs.rkeene.org&#x2F;web&#x2F;dir?ci=trunk&amp;name=build&#x2F;qemu</a><p>It&#x27;s for running AppFS inside a VM on QEMU.  It uses a statically linked Tcl (which AppFS is written in) to bring the system up.</div><br/></div></div></div></div></div></div><div id="41717547" class="c"><input type="checkbox" id="c-41717547" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#41717529">prev</a><span>|</span><a href="#41717499">next</a><span>|</span><label class="collapse" for="c-41717547">[-]</label><label class="expand" for="c-41717547">[3 more]</label></div><br/><div class="children"><div class="content">Disk space is why one of my laptops doesn&#x27;t run NixOS; 16GB soldered storage fit one generation <i>passably</i>, but it was clear that it wasn&#x27;t gonna work (of course, that&#x27;s with X and a browser; totally different use case). I vaguely recall that locales were shockingly large and I couldn&#x27;t figure out how to trim them down. So that box runs Alpine now, which easily fits with no effort.</div><br/><div id="41717950" class="c"><input type="checkbox" id="c-41717950" checked=""/><div class="controls bullet"><span class="by">shim__</span><span>|</span><a href="#41717547">parent</a><span>|</span><a href="#41718225">next</a><span>|</span><label class="collapse" for="c-41717950">[-]</label><label class="expand" for="c-41717950">[1 more]</label></div><br/><div class="children"><div class="content">Have you tried putting &#x2F;nix on an filesystem with compression? I&#x27;ve experienced &gt;50% in storage savings with Bcachefs + zstd and dedupe</div><br/></div></div><div id="41718225" class="c"><input type="checkbox" id="c-41718225" checked=""/><div class="controls bullet"><span class="by">GianFabien</span><span>|</span><a href="#41717547">parent</a><span>|</span><a href="#41717950">prev</a><span>|</span><a href="#41717499">next</a><span>|</span><label class="collapse" for="c-41718225">[-]</label><label class="expand" for="c-41718225">[1 more]</label></div><br/><div class="children"><div class="content">I too use Alpine. I like how you start small and add what you need.  The option of having a read-only root FS is convenient on flaky SBCs.</div><br/></div></div></div></div><div id="41717499" class="c"><input type="checkbox" id="c-41717499" checked=""/><div class="controls bullet"><span class="by">heavensteeth</span><span>|</span><a href="#41717547">prev</a><span>|</span><a href="#41717798">next</a><span>|</span><label class="collapse" for="c-41717499">[-]</label><label class="expand" for="c-41717499">[1 more]</label></div><br/><div class="children"><div class="content">Good stuff! From the title I thought this would be about sysadmin woes, but this is interesting too :)<p>Another little addendum: you can trivially create bootable custom NixOS installer images with whatever configuration you want pre-applied[0].<p>[0] <a href="https:&#x2F;&#x2F;nix.dev&#x2F;tutorials&#x2F;nixos&#x2F;building-bootable-iso-image" rel="nofollow">https:&#x2F;&#x2F;nix.dev&#x2F;tutorials&#x2F;nixos&#x2F;building-bootable-iso-image</a></div><br/></div></div><div id="41717798" class="c"><input type="checkbox" id="c-41717798" checked=""/><div class="controls bullet"><span class="by">johnklos</span><span>|</span><a href="#41717499">prev</a><span>|</span><a href="#41717746">next</a><span>|</span><label class="collapse" for="c-41717798">[-]</label><label class="expand" for="c-41717798">[1 more]</label></div><br/><div class="children"><div class="content">Taking the time to delve in to things like this can teach you more about the OS you run than many other things can. It&#x27;s not too unlike making a crunchgen OS, or even just a read-only OS with overlays. It&#x27;s sometimes quite enlightening to see what will work with much less than we assumed it needs.<p>Having just installed the entirety of NetBSD on an i386 system (a 200 MHz Pentium), I see it weighs in at around 1 gig. But that&#x27;s everything including X11 with WM and the toolchain (gcc 10). That&#x27;s not bad, but it&#x27;s really amazing how much of that isn&#x27;t necessary for running the OS on a server. Particularly where you might want tiny VM images</div><br/></div></div><div id="41717746" class="c"><input type="checkbox" id="c-41717746" checked=""/><div class="controls bullet"><span class="by">eptcyka</span><span>|</span><a href="#41717798">prev</a><span>|</span><a href="#41717594">next</a><span>|</span><label class="collapse" for="c-41717746">[-]</label><label class="expand" for="c-41717746">[1 more]</label></div><br/><div class="children"><div class="content">This is highly relevant for me, will probably end up using some of the same tricks they&#x27;ve done to trim the size of some of my micro VMs.</div><br/></div></div><div id="41717594" class="c"><input type="checkbox" id="c-41717594" checked=""/><div class="controls bullet"><span class="by">mipselaer</span><span>|</span><a href="#41717746">prev</a><span>|</span><a href="#41718234">next</a><span>|</span><label class="collapse" for="c-41717594">[-]</label><label class="expand" for="c-41717594">[1 more]</label></div><br/><div class="children"><div class="content">Could you run ’nix store optimise’ before you remove ’nix’?</div><br/></div></div><div id="41718234" class="c"><input type="checkbox" id="c-41718234" checked=""/><div class="controls bullet"><span class="by">a_t48</span><span>|</span><a href="#41717594">prev</a><span>|</span><a href="#41717051">next</a><span>|</span><label class="collapse" for="c-41718234">[-]</label><label class="expand" for="c-41718234">[1 more]</label></div><br/><div class="children"><div class="content">This reminds me a little bit of trying to slim Docker images.</div><br/></div></div><div id="41717858" class="c"><input type="checkbox" id="c-41717858" checked=""/><div class="controls bullet"><span class="by">goodpoint</span><span>|</span><a href="#41717051">prev</a><span>|</span><label class="collapse" for="c-41717858">[-]</label><label class="expand" for="c-41717858">[4 more]</label></div><br/><div class="children"><div class="content">Any OS without stable releases and a security team is not a server OS.</div><br/><div id="41718435" class="c"><input type="checkbox" id="c-41718435" checked=""/><div class="controls bullet"><span class="by">Diti</span><span>|</span><a href="#41717858">parent</a><span>|</span><a href="#41718213">next</a><span>|</span><label class="collapse" for="c-41718435">[-]</label><label class="expand" for="c-41718435">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;status.nixos.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;status.nixos.org&#x2F;</a>
<a href="https:&#x2F;&#x2F;nixos.org&#x2F;community&#x2F;teams&#x2F;security&#x2F;" rel="nofollow">https:&#x2F;&#x2F;nixos.org&#x2F;community&#x2F;teams&#x2F;security&#x2F;</a><p>Welcome to NixOS, then! :)</div><br/></div></div><div id="41718213" class="c"><input type="checkbox" id="c-41718213" checked=""/><div class="controls bullet"><span class="by">bpye</span><span>|</span><a href="#41717858">parent</a><span>|</span><a href="#41718435">prev</a><span>|</span><a href="#41717974">next</a><span>|</span><label class="collapse" for="c-41718213">[-]</label><label class="expand" for="c-41718213">[1 more]</label></div><br/><div class="children"><div class="content">NixOS does have &quot;stable&quot; releases every 6 months, but they don&#x27;t have long term support.</div><br/></div></div><div id="41717974" class="c"><input type="checkbox" id="c-41717974" checked=""/><div class="controls bullet"><span class="by">ladyanita22</span><span>|</span><a href="#41717858">parent</a><span>|</span><a href="#41718213">prev</a><span>|</span><label class="collapse" for="c-41717974">[-]</label><label class="expand" for="c-41717974">[1 more]</label></div><br/><div class="children"><div class="content">Then you only have Ubuntu, Fedora, Red Hat&#x2F;CentOS&#x2F;Alma&#x2F;Rocky and Suse&#x2F;OpenSuse.</div><br/></div></div></div></div></div></div></div></div></div></body></html>