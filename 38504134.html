<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701594056206" as="style"/><link rel="stylesheet" href="styles.css?v=1701594056206"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://rachelbythebay.com/w/2023/11/30/armv6/">Clang now makes binaries an original Pi B+ can&#x27;t run</a> <span class="domain">(<a href="https://rachelbythebay.com">rachelbythebay.com</a>)</span></div><div class="subtext"><span>FPGAhacker</span> | <span>51 comments</span></div><br/><div><div id="38505427" class="c"><input type="checkbox" id="c-38505427" checked=""/><div class="controls bullet"><span class="by">stephen_g</span><span>|</span><a href="#38505783">next</a><span>|</span><label class="collapse" for="c-38505427">[-]</label><label class="expand" for="c-38505427">[7 more]</label></div><br/><div class="children"><div class="content">Wow, looking at the history of the ARM generation the original versions of the Raspberry Pi uses, it’s hard to believe it’s so old! When the Raspberry Pi B+ was released (2014), the ARM core it used was already 11 years old (using the ARM1176 core from 2003). So it’s not unbelievable that you might need to start supplying an arch flag to produce compatible code building on a different platform (like the newer Raspberry Pi the article says they first built on).<p>As others have said, it does seem like a misconfiguration (perhaps in the defaults shipped by their distribution) that the correct arch is not picked by default when building on the Raspberry Pi B+ itself.</div><br/><div id="38505788" class="c"><input type="checkbox" id="c-38505788" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#38505427">parent</a><span>|</span><a href="#38505498">next</a><span>|</span><label class="collapse" for="c-38505788">[-]</label><label class="expand" for="c-38505788">[1 more]</label></div><br/><div class="children"><div class="content">[delayed]</div><br/></div></div><div id="38505498" class="c"><input type="checkbox" id="c-38505498" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#38505427">parent</a><span>|</span><a href="#38505788">prev</a><span>|</span><a href="#38505783">next</a><span>|</span><label class="collapse" for="c-38505498">[-]</label><label class="expand" for="c-38505498">[5 more]</label></div><br/><div class="children"><div class="content">&gt; When the Raspberry Pi B+ was released (2014), the ARM core it used was already 11 years old (using the ARM1176 core from 2003).<p>IIRC the original Pi used leftover chips from a TV box, which is the kind of product that IME never ships more compute than they have to, for price reasons.</div><br/><div id="38505770" class="c"><input type="checkbox" id="c-38505770" checked=""/><div class="controls bullet"><span class="by">RantyDave</span><span>|</span><a href="#38505427">root</a><span>|</span><a href="#38505498">parent</a><span>|</span><a href="#38505643">next</a><span>|</span><label class="collapse" for="c-38505770">[-]</label><label class="expand" for="c-38505770">[2 more]</label></div><br/><div class="children"><div class="content">Phones, not TV&#x27;s, but that&#x27;s pretty much the idea. Even better, the ARM core was tacked on as a sort of &quot;dammit, I supposed we&#x27;ll have to run applications&quot; kinda thing and isn&#x27;t even necessarily initialised during boot.<p>Raspberry Pi&#x27;s actually boot on a <i>really</i> fringe processor called a VideoCore. Arguably the GPU bootstraps the CPU, which makes my brain hurt.</div><br/><div id="38505791" class="c"><input type="checkbox" id="c-38505791" checked=""/><div class="controls bullet"><span class="by">phendrenad2</span><span>|</span><a href="#38505427">root</a><span>|</span><a href="#38505770">parent</a><span>|</span><a href="#38505643">next</a><span>|</span><label class="collapse" for="c-38505791">[-]</label><label class="expand" for="c-38505791">[1 more]</label></div><br/><div class="children"><div class="content">[delayed]</div><br/></div></div></div></div><div id="38505643" class="c"><input type="checkbox" id="c-38505643" checked=""/><div class="controls bullet"><span class="by">einr</span><span>|</span><a href="#38505427">root</a><span>|</span><a href="#38505498">parent</a><span>|</span><a href="#38505770">prev</a><span>|</span><a href="#38505783">next</a><span>|</span><label class="collapse" for="c-38505643">[-]</label><label class="expand" for="c-38505643">[2 more]</label></div><br/><div class="children"><div class="content">TV boxes IME usually ship with <i>less</i> compute than they have to [in order to provide reasonable UX] ;)</div><br/><div id="38505732" class="c"><input type="checkbox" id="c-38505732" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#38505427">root</a><span>|</span><a href="#38505643">parent</a><span>|</span><a href="#38505783">next</a><span>|</span><label class="collapse" for="c-38505732">[-]</label><label class="expand" for="c-38505732">[1 more]</label></div><br/><div class="children"><div class="content">Eh, the result may suck, but I don&#x27;t think it&#x27;s usually a hardware problem.</div><br/></div></div></div></div></div></div></div></div><div id="38505783" class="c"><input type="checkbox" id="c-38505783" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#38505427">prev</a><span>|</span><a href="#38505272">next</a><span>|</span><label class="collapse" for="c-38505783">[-]</label><label class="expand" for="c-38505783">[1 more]</label></div><br/><div class="children"><div class="content">[delayed]</div><br/></div></div><div id="38505272" class="c"><input type="checkbox" id="c-38505272" checked=""/><div class="controls bullet"><span class="by">schemescape</span><span>|</span><a href="#38505783">prev</a><span>|</span><a href="#38505516">next</a><span>|</span><label class="collapse" for="c-38505272">[-]</label><label class="expand" for="c-38505272">[5 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t see it addressed here or in the article: this is a bug, right?<p>Edit: oddly, after searching LLVM bugs, I found a bug that sounds pretty much exactly like this issue... but it&#x27;s from 2012 and is closed (although the final couple of comments make it sound like maybe it wasn&#x27;t actually fixed--note: I only skimmed the comments and I probably misunderstood):<p><a href="https:&#x2F;&#x2F;github.com&#x2F;llvm&#x2F;llvm-project&#x2F;issues&#x2F;13989">https:&#x2F;&#x2F;github.com&#x2F;llvm&#x2F;llvm-project&#x2F;issues&#x2F;13989</a><p>Edit again: I forgot about the comment at the end of the article that clarifies that explicitly passing the target results in a working program. In that case, it sounds like some sort of configuration bug--I would assume (but am not certain) that the default target would be the current processor, at least on Unix. That bug I linked was probably about producing incorrect code <i>even when the target was set correctly</i> which, thankfully, isn&#x27;t happening today.</div><br/><div id="38505485" class="c"><input type="checkbox" id="c-38505485" checked=""/><div class="controls bullet"><span class="by">Arnavion</span><span>|</span><a href="#38505272">parent</a><span>|</span><a href="#38505308">next</a><span>|</span><label class="collapse" for="c-38505485">[-]</label><label class="expand" for="c-38505485">[1 more]</label></div><br/><div class="children"><div class="content">Yes, your bug is about the compiler emitting armv7 instructions despite being told to target armv6. Rachel fixed her problem by telling the compiler to target armv6. So I assume your bug is indeed already fixed and not related to Rachel&#x27;s problem.</div><br/></div></div><div id="38505298" class="c"><input type="checkbox" id="c-38505298" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#38505272">parent</a><span>|</span><a href="#38505308">prev</a><span>|</span><a href="#38505290">next</a><span>|</span><label class="collapse" for="c-38505298">[-]</label><label class="expand" for="c-38505298">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, this is not the behavior people expect.</div><br/></div></div></div></div><div id="38505516" class="c"><input type="checkbox" id="c-38505516" checked=""/><div class="controls bullet"><span class="by">matja</span><span>|</span><a href="#38505272">prev</a><span>|</span><a href="#38505243">next</a><span>|</span><label class="collapse" for="c-38505516">[-]</label><label class="expand" for="c-38505516">[4 more]</label></div><br/><div class="children"><div class="content">clang&#x2F;clang++ read from &#x2F;etc&#x2F;env.d&#x2F;gcc to get the target flags&#x2F;profile, it&#x27;s up to the OS to maintain them and make sure they&#x27;re correct, looks like that didn&#x27;t happen for this OS.<p>My Gentoo ARM SBC based on an even more ancient armv4 arch has been chugging along just fine with the latest gcc&#x2F;clang updates:<p><pre><code>    grep CTARGET &#x2F;etc&#x2F;env.d&#x2F;gcc -r
    &#x2F;etc&#x2F;env.d&#x2F;gcc&#x2F;armv4tl-softfloat-linux-gnueabi-11.3.0:CTARGET=&quot;armv4tl-softfloat-linux-gnueabi&quot;</code></pre></div><br/><div id="38505649" class="c"><input type="checkbox" id="c-38505649" checked=""/><div class="controls bullet"><span class="by">Arnavion</span><span>|</span><a href="#38505516">parent</a><span>|</span><a href="#38505562">next</a><span>|</span><label class="collapse" for="c-38505649">[-]</label><label class="expand" for="c-38505649">[2 more]</label></div><br/><div class="children"><div class="content">&#x2F;etc&#x2F;env.d is a Gentoo-specific directory to define default env vars for user sessions. It&#x27;s not a feature of clang to read that directory, so it&#x27;s not correct to assume other distros would have it. It&#x27;s just that Gentoo&#x27;s compiler setup reads the CTARGET env var to select the target, and Gentoo uses &#x2F;etc&#x2F;env.d to set it.</div><br/><div id="38505668" class="c"><input type="checkbox" id="c-38505668" checked=""/><div class="controls bullet"><span class="by">matja</span><span>|</span><a href="#38505516">root</a><span>|</span><a href="#38505649">parent</a><span>|</span><a href="#38505562">next</a><span>|</span><label class="collapse" for="c-38505668">[-]</label><label class="expand" for="c-38505668">[1 more]</label></div><br/><div class="children"><div class="content">Is that why other distros break? :)</div><br/></div></div></div></div><div id="38505562" class="c"><input type="checkbox" id="c-38505562" checked=""/><div class="controls bullet"><span class="by">contingencies</span><span>|</span><a href="#38505516">parent</a><span>|</span><a href="#38505649">prev</a><span>|</span><a href="#38505243">next</a><span>|</span><label class="collapse" for="c-38505562">[-]</label><label class="expand" for="c-38505562">[1 more]</label></div><br/><div class="children"><div class="content">Gentoo always works .. it just takes longer :)</div><br/></div></div></div></div><div id="38505243" class="c"><input type="checkbox" id="c-38505243" checked=""/><div class="controls bullet"><span class="by">teddyh</span><span>|</span><a href="#38505516">prev</a><span>|</span><a href="#38505686">next</a><span>|</span><label class="collapse" for="c-38505243">[-]</label><label class="expand" for="c-38505243">[2 more]</label></div><br/><div class="children"><div class="content">It would probably be helpful to know the output of the command “dpkg-architecture” and the contents of the file “&#x2F;etc&#x2F;os-release”.  Otherwise it will be hard to make any useful comments.</div><br/></div></div><div id="38505686" class="c"><input type="checkbox" id="c-38505686" checked=""/><div class="controls bullet"><span class="by">auselen</span><span>|</span><a href="#38505243">prev</a><span>|</span><a href="#38505398">next</a><span>|</span><label class="collapse" for="c-38505686">[-]</label><label class="expand" for="c-38505686">[3 more]</label></div><br/><div class="children"><div class="content">Confused article? You make a host&#x2F;native build instead of cross and expect it to work on some other machine?</div><br/><div id="38505693" class="c"><input type="checkbox" id="c-38505693" checked=""/><div class="controls bullet"><span class="by">daviddoran</span><span>|</span><a href="#38505686">parent</a><span>|</span><a href="#38505398">next</a><span>|</span><label class="collapse" for="c-38505693">[-]</label><label class="expand" for="c-38505693">[2 more]</label></div><br/><div class="children"><div class="content">No. Half way through the article she specifically starts doing everything on the B+ (the old RPI with the issue).</div><br/><div id="38505778" class="c"><input type="checkbox" id="c-38505778" checked=""/><div class="controls bullet"><span class="by">auselen</span><span>|</span><a href="#38505686">root</a><span>|</span><a href="#38505693">parent</a><span>|</span><a href="#38505398">next</a><span>|</span><label class="collapse" for="c-38505778">[-]</label><label class="expand" for="c-38505778">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for that. I didn’t notice she switch to B+ later.</div><br/></div></div></div></div></div></div><div id="38505241" class="c"><input type="checkbox" id="c-38505241" checked=""/><div class="controls bullet"><span class="by">johnklos</span><span>|</span><a href="#38505398">prev</a><span>|</span><a href="#38505246">next</a><span>|</span><label class="collapse" for="c-38505241">[-]</label><label class="expand" for="c-38505241">[13 more]</label></div><br/><div class="children"><div class="content">You&#x27;ll see a whole bandwagon of people saying things like, &quot;supporting old hardware is BAD! It takes time and money that nobody has!&quot;, as though someone needs to be hired to sit around and do nothing but pore over code and constantly rewrite code for old hardware.<p>There&#x27;s plenty of evidence to the contrary, but since when has evidence mattered when it comes to defending the right of big business &#x2F; big distro to do whatever they want? ;)<p>Really, this is just laziness and sloppiness on the Linux distro makers&#x27; part. Any amount of testing would catch this. Thanks, Rachel!</div><br/><div id="38505816" class="c"><input type="checkbox" id="c-38505816" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505595">next</a><span>|</span><label class="collapse" for="c-38505816">[-]</label><label class="expand" for="c-38505816">[1 more]</label></div><br/><div class="children"><div class="content">This has nothing to do with the distro; it looks like an upstream LLVM bug. And it <i>does</i> demonstrate the problem: old code doesn’t change, but interfaces and invariants do. Those external changes do represent maintainer burden.<p>Armv6 isn’t really “old hardware” in the “disused, actively rotting” sense. That’s reserved for things like Itanium or SPARC, which distributions (and upstreams) would do perfectly well to remove unless paid buckets of money by their respective corporations.</div><br/></div></div><div id="38505595" class="c"><input type="checkbox" id="c-38505595" checked=""/><div class="controls bullet"><span class="by">bee_rider</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505816">prev</a><span>|</span><a href="#38505279">next</a><span>|</span><label class="collapse" for="c-38505595">[-]</label><label class="expand" for="c-38505595">[2 more]</label></div><br/><div class="children"><div class="content">Big distro. These fat-cat volunteer kernel devs are just trying to keep us down by giving us so much free software that we collapse under the weight of it.</div><br/><div id="38505632" class="c"><input type="checkbox" id="c-38505632" checked=""/><div class="controls bullet"><span class="by">zmgsabst</span><span>|</span><a href="#38505241">root</a><span>|</span><a href="#38505595">parent</a><span>|</span><a href="#38505279">next</a><span>|</span><label class="collapse" for="c-38505632">[-]</label><label class="expand" for="c-38505632">[1 more]</label></div><br/><div class="children"><div class="content">Aren’t a lot of kernel devs paid by large corporations?<p>Eg, this article.<p><a href="https:&#x2F;&#x2F;thenewstack.io&#x2F;contributes-linux-kernel&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;thenewstack.io&#x2F;contributes-linux-kernel&#x2F;</a></div><br/></div></div></div></div><div id="38505279" class="c"><input type="checkbox" id="c-38505279" checked=""/><div class="controls bullet"><span class="by">Elucalidavah</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505595">prev</a><span>|</span><a href="#38505447">next</a><span>|</span><label class="collapse" for="c-38505279">[-]</label><label class="expand" for="c-38505279">[3 more]</label></div><br/><div class="children"><div class="content">&gt; sit around and do nothing but pore over code and constantly rewrite code for old hardware<p>In case of refactoring &#x2F; restructuring, that&#x27;s exactly so.<p>But &quot;drop support for this old hardware&quot; is meant to be an intended decision with a clear deprecation warning, not accidentally.</div><br/><div id="38505573" class="c"><input type="checkbox" id="c-38505573" checked=""/><div class="controls bullet"><span class="by">atemerev</span><span>|</span><a href="#38505241">root</a><span>|</span><a href="#38505279">parent</a><span>|</span><a href="#38505447">next</a><span>|</span><label class="collapse" for="c-38505573">[-]</label><label class="expand" for="c-38505573">[2 more]</label></div><br/><div class="children"><div class="content">The bazaar doesn’t work like this. There are no incentives to support old hardware. If there are enough people with old hardware, their activity might be enough to do something. Otherwise — puff, gone.<p>Open source is already a miracle. The fact that something works somewhere is a miracle. I don’t tempt the powers and I don’t demand even more miracles to satisfy some perfectionist urges.</div><br/></div></div></div></div><div id="38505447" class="c"><input type="checkbox" id="c-38505447" checked=""/><div class="controls bullet"><span class="by">yellow_lead</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505279">prev</a><span>|</span><a href="#38505625">next</a><span>|</span><label class="collapse" for="c-38505447">[-]</label><label class="expand" for="c-38505447">[1 more]</label></div><br/><div class="children"><div class="content">&gt; You&#x27;ll see a whole bandwagon of people saying things like, &quot;supporting old hardware is BAD! It takes time and money that nobody has!<p>&gt; Any amount of testing would catch this.<p>Who is paying for the testing? I&#x27;m not suggesting supporting old hardware is bad, but we must recognize it takes some effort to uphold backwards compatibility. Stuff gets broken accidentally always, and testing isn&#x27;t free.</div><br/></div></div><div id="38505625" class="c"><input type="checkbox" id="c-38505625" checked=""/><div class="controls bullet"><span class="by">kaba0</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505447">prev</a><span>|</span><a href="#38505396">next</a><span>|</span><label class="collapse" for="c-38505625">[-]</label><label class="expand" for="c-38505625">[1 more]</label></div><br/><div class="children"><div class="content">&gt; when it comes to defending the right of big business &#x2F; big distro to do whatever they want? ;)<p>Anything else about your alternative reality?<p>Also, why don’t you go and take on support for this given target, if it’s so important for you? Or pay for someone to do it? I’m sure the project wouldn’t mind supporting it if someone would have stepped up, but I’m sure it’s still not too late.</div><br/></div></div><div id="38505396" class="c"><input type="checkbox" id="c-38505396" checked=""/><div class="controls bullet"><span class="by">jenadine</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505625">prev</a><span>|</span><a href="#38505356">next</a><span>|</span><label class="collapse" for="c-38505396">[-]</label><label class="expand" for="c-38505396">[1 more]</label></div><br/><div class="children"><div class="content">The thing with free software is that you are in no position to demand anything. If the maintainer don&#x27;t feel like supporting your hardware, they don&#x27;t have to.<p>But the beauty of free software is that you can always do it yourself. (Or pay someone to do it)</div><br/></div></div><div id="38505356" class="c"><input type="checkbox" id="c-38505356" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#38505241">parent</a><span>|</span><a href="#38505396">prev</a><span>|</span><a href="#38505469">next</a><span>|</span><label class="collapse" for="c-38505356">[-]</label><label class="expand" for="c-38505356">[2 more]</label></div><br/><div class="children"><div class="content">I think RPi has struck a reasonable balance where the mainstream Linux community doesn&#x27;t really support ancient ARMv6 so RPI themselves maintains forked software (e.g. Raspbian). This way the cost of legacy is borne by those who benefit from it, not everyone.</div><br/><div id="38505486" class="c"><input type="checkbox" id="c-38505486" checked=""/><div class="controls bullet"><span class="by">deaddodo</span><span>|</span><a href="#38505241">root</a><span>|</span><a href="#38505356">parent</a><span>|</span><a href="#38505469">next</a><span>|</span><label class="collapse" for="c-38505486">[-]</label><label class="expand" for="c-38505486">[1 more]</label></div><br/><div class="children"><div class="content">Raspbian existed well before ARMv6 support dropped off. It&#x27;s been their main distro from the outset, but mainstream distros with ARM builds only removed support for ARMv6 in the last 1-3 years (depending on distro).</div><br/></div></div></div></div></div></div><div id="38505234" class="c"><input type="checkbox" id="c-38505234" checked=""/><div class="controls bullet"><span class="by">frizlab</span><span>|</span><a href="#38505480">prev</a><span>|</span><label class="collapse" for="c-38505234">[-]</label><label class="expand" for="c-38505234">[5 more]</label></div><br/><div class="children"><div class="content">Title is misleading</div><br/><div id="38505652" class="c"><input type="checkbox" id="c-38505652" checked=""/><div class="controls bullet"><span class="by">usr1106</span><span>|</span><a href="#38505234">parent</a><span>|</span><a href="#38505710">next</a><span>|</span><label class="collapse" for="c-38505652">[-]</label><label class="expand" for="c-38505652">[1 more]</label></div><br/><div class="children"><div class="content">Aka called clickbait. Although the bug and the workaround are useful to know for everyone working with that machine.</div><br/></div></div><div id="38505710" class="c"><input type="checkbox" id="c-38505710" checked=""/><div class="controls bullet"><span class="by">blahgeek</span><span>|</span><a href="#38505234">parent</a><span>|</span><a href="#38505652">prev</a><span>|</span><a href="#38505239">next</a><span>|</span><label class="collapse" for="c-38505710">[-]</label><label class="expand" for="c-38505710">[1 more]</label></div><br/><div class="children"><div class="content">Yes. It should be “clang does not correctly detect host architecture in raspberry pi B+”</div><br/></div></div><div id="38505239" class="c"><input type="checkbox" id="c-38505239" checked=""/><div class="controls bullet"><span class="by">eimrine</span><span>|</span><a href="#38505234">parent</a><span>|</span><a href="#38505710">prev</a><span>|</span><label class="collapse" for="c-38505239">[-]</label><label class="expand" for="c-38505239">[2 more]</label></div><br/><div class="children"><div class="content">Because &quot;as a default&quot; statement is missing?</div><br/><div id="38505379" class="c"><input type="checkbox" id="c-38505379" checked=""/><div class="controls bullet"><span class="by">jenadine</span><span>|</span><a href="#38505234">root</a><span>|</span><a href="#38505239">parent</a><span>|</span><label class="collapse" for="c-38505379">[-]</label><label class="expand" for="c-38505379">[1 more]</label></div><br/><div class="children"><div class="content">Yes.<p>It now sounds like it is completely broken. But you can just fix it with a flag. And the change of default was probably an unintentional bug.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>