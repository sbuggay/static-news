<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689757254306" as="style"/><link rel="stylesheet" href="styles.css?v=1689757254306"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cython.readthedocs.io/en/latest/src/changes.html">Cython 3.0 Released</a> <span class="domain">(<a href="https://cython.readthedocs.io">cython.readthedocs.io</a>)</span></div><div class="subtext"><span>ngoldbaum</span> | <span>60 comments</span></div><br/><div><div id="36782988" class="c"><input type="checkbox" id="c-36782988" checked=""/><div class="controls bullet"><span class="by">bippingchip</span><span>|</span><a href="#36779148">next</a><span>|</span><label class="collapse" for="c-36782988">[-]</label><label class="expand" for="c-36782988">[5 more]</label></div><br/><div class="children"><div class="content">This is a somewhat tangential question to the new release, but there might be folks here that can answer this question.<p>Having used swig to create Python bindings for C++ code over 10 years ago, what’s the recommended way to do this in 2023? There’s still swig, there’s Cython, pybind11 and a few others. I do know swig and how complicated it can get with footguns abound when things grow more complex.<p>Is Cython the way to go? How does it hold up to the alternatives? Google search gives many articles on the topic, but many typical SEO optimized low-value, and those that do show a bit of depth, focus on the basic mechanics, not really on things hold up for larger projects…</div><br/><div id="36783651" class="c"><input type="checkbox" id="c-36783651" checked=""/><div class="controls bullet"><span class="by">gjulianm</span><span>|</span><a href="#36782988">parent</a><span>|</span><a href="#36783647">next</a><span>|</span><label class="collapse" for="c-36783651">[-]</label><label class="expand" for="c-36783651">[1 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t used Cython too much, it does look really interesting but the translation layer worries me a little bit for more complex modules. However, I&#x27;ve been using pybind11 extensively and it&#x27;s a delight. Well designed, documented, predictable, removes a massive amount of boilerplate, integrates perfectly well with C++ idioms (e.g., smart pointers), and doesn&#x27;t completely lock you in, as you can still call the C API in a regular way.</div><br/></div></div><div id="36783647" class="c"><input type="checkbox" id="c-36783647" checked=""/><div class="controls bullet"><span class="by">dagw</span><span>|</span><a href="#36782988">parent</a><span>|</span><a href="#36783651">prev</a><span>|</span><a href="#36783319">next</a><span>|</span><label class="collapse" for="c-36783647">[-]</label><label class="expand" for="c-36783647">[1 more]</label></div><br/><div class="children"><div class="content">If all you need&#x2F;want is to call c++ code from python then pybind11 is the way to go. Cython really comes into its own when you have some existing python code you want to &#x27;port&#x27; to a C extension.</div><br/></div></div><div id="36783319" class="c"><input type="checkbox" id="c-36783319" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36782988">parent</a><span>|</span><a href="#36783647">prev</a><span>|</span><a href="#36783263">next</a><span>|</span><label class="collapse" for="c-36783319">[-]</label><label class="expand" for="c-36783319">[1 more]</label></div><br/><div class="children"><div class="content">Cython is the most general tool. It can be used to do anything from making bindings from C&#x2F;Cpp to Python, Python to C&#x2F;Cpp, to writing compiled “Python-like” code in an intermediate layer that can be used for managing your wrappers or just writing performant code.<p>If you just want the ability to provide a Python interface to a C&#x2F;Cpp library PyBind11 will get you there in fewer LoC than Cython. Nanobind is an even lighter weight option.<p>I’ve heard Swig is a pain to use.</div><br/></div></div><div id="36783263" class="c"><input type="checkbox" id="c-36783263" checked=""/><div class="controls bullet"><span class="by">plonk</span><span>|</span><a href="#36782988">parent</a><span>|</span><a href="#36783319">prev</a><span>|</span><a href="#36779148">next</a><span>|</span><label class="collapse" for="c-36783263">[-]</label><label class="expand" for="c-36783263">[1 more]</label></div><br/><div class="children"><div class="content">The problem with SWIG bindings I’ve used is that they don’t have any type hints. They also don’t offer context managers to handle resources, so it’s a pain to use safely in Python.<p>From the user POV, the best bindings I’ve seen were wrappers with a Python API that calls C++ using Cython.</div><br/></div></div></div></div><div id="36779148" class="c"><input type="checkbox" id="c-36779148" checked=""/><div class="controls bullet"><span class="by">mturk</span><span>|</span><a href="#36782988">prev</a><span>|</span><a href="#36779107">next</a><span>|</span><label class="collapse" for="c-36779148">[-]</label><label class="expand" for="c-36779148">[2 more]</label></div><br/><div class="children"><div class="content">A project I work on is currently working through a bunch of performance issues that arose because we had inlined functions in `pxd` files that we did not declare `noexcept nogil`.  So, heads up if you see similar regressions!  We saw a ridiculous slowdown (7s to 100m, for one suite) because they were inside some awfully tight loops.  But the fix was pretty straightforward once we worked it out.</div><br/><div id="36780508" class="c"><input type="checkbox" id="c-36780508" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36779148">parent</a><span>|</span><a href="#36779107">next</a><span>|</span><label class="collapse" for="c-36780508">[-]</label><label class="expand" for="c-36780508">[1 more]</label></div><br/><div class="children"><div class="content">Yep, my yesterday was also filled with figuring out this issue and changing these annotations. Heads up that the default exception forwarding also breaks function pointer types if you share them with the wrapped C code.</div><br/></div></div></div></div><div id="36779107" class="c"><input type="checkbox" id="c-36779107" checked=""/><div class="controls bullet"><span class="by">navels</span><span>|</span><a href="#36779148">prev</a><span>|</span><a href="#36781549">next</a><span>|</span><label class="collapse" for="c-36779107">[-]</label><label class="expand" for="c-36779107">[17 more]</label></div><br/><div class="children"><div class="content">And chaos ensued. Unable to install aws-cli via pip:  <a href="https:&#x2F;&#x2F;github.com&#x2F;aws&#x2F;aws-cli&#x2F;issues&#x2F;8036">https:&#x2F;&#x2F;github.com&#x2F;aws&#x2F;aws-cli&#x2F;issues&#x2F;8036</a></div><br/><div id="36779702" class="c"><input type="checkbox" id="c-36779702" checked=""/><div class="controls bullet"><span class="by">gchamonlive</span><span>|</span><a href="#36779107">parent</a><span>|</span><a href="#36779313">next</a><span>|</span><label class="collapse" for="c-36779702">[-]</label><label class="expand" for="c-36779702">[6 more]</label></div><br/><div class="children"><div class="content">I am reluctant to refer you to aws-cli V2 because it is way more involved to install. No idea why aws moved away from their original distribution method...
However, the V2 is going to be the way to go moving forwards :&#x2F;</div><br/><div id="36779859" class="c"><input type="checkbox" id="c-36779859" checked=""/><div class="controls bullet"><span class="by">garblegarble</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779702">parent</a><span>|</span><a href="#36782669">next</a><span>|</span><label class="collapse" for="c-36779859">[-]</label><label class="expand" for="c-36779859">[4 more]</label></div><br/><div class="children"><div class="content">&gt;No idea why aws moved away from their original distribution method<p>Didn&#x27;t they move away exactly because of issues like this? As I understand it, aws-cli v2 is still written in Python but ships everything it needs self-contained so it can avoid Python dependency hell[1]<p>1: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=U5y7JI_mHk8#t=3m40">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=U5y7JI_mHk8#t=3m40</a></div><br/><div id="36782841" class="c"><input type="checkbox" id="c-36782841" checked=""/><div class="controls bullet"><span class="by">PartiallyTyped</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779859">parent</a><span>|</span><a href="#36781322">next</a><span>|</span><label class="collapse" for="c-36782841">[-]</label><label class="expand" for="c-36782841">[2 more]</label></div><br/><div class="children"><div class="content">Funnily enough, I didn’t have issues with Python’s dependency hell before working for AWS, not because we have more dependencies, but because… reasons.</div><br/><div id="36783372" class="c"><input type="checkbox" id="c-36783372" checked=""/><div class="controls bullet"><span class="by">RandomThrow321</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36782841">parent</a><span>|</span><a href="#36781322">next</a><span>|</span><label class="collapse" for="c-36783372">[-]</label><label class="expand" for="c-36783372">[1 more]</label></div><br/><div class="children"><div class="content">Is it special files that begin with a capital letter, version sets, version filter instances, and massive symlink farms?</div><br/></div></div></div></div><div id="36781322" class="c"><input type="checkbox" id="c-36781322" checked=""/><div class="controls bullet"><span class="by">gchamonlive</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779859">parent</a><span>|</span><a href="#36782841">prev</a><span>|</span><a href="#36782669">next</a><span>|</span><label class="collapse" for="c-36781322">[-]</label><label class="expand" for="c-36781322">[1 more]</label></div><br/><div class="children"><div class="content">Indeed!</div><br/></div></div></div></div><div id="36782669" class="c"><input type="checkbox" id="c-36782669" checked=""/><div class="controls bullet"><span class="by">takeda</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779702">parent</a><span>|</span><a href="#36779859">prev</a><span>|</span><a href="#36779313">next</a><span>|</span><label class="collapse" for="c-36782669">[-]</label><label class="expand" for="c-36782669">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    cat -n shell.nix
    { pkgs ? import &lt;nixpkgs&gt; {}
    }:
    pkgs.mkShell {
        name  = &quot;dev-env&quot;;
        buildInputs = with pkgs; [
            awscli2
        ];
   }
</code></pre>
And then you can have it available when entering shell with nix-shell.</div><br/></div></div></div></div><div id="36779313" class="c"><input type="checkbox" id="c-36779313" checked=""/><div class="controls bullet"><span class="by">x3n0ph3n3</span><span>|</span><a href="#36779107">parent</a><span>|</span><a href="#36779702">prev</a><span>|</span><a href="#36782315">next</a><span>|</span><label class="collapse" for="c-36779313">[-]</label><label class="expand" for="c-36779313">[9 more]</label></div><br/><div class="children"><div class="content">Mostly because of PyYAML: <a href="https:&#x2F;&#x2F;github.com&#x2F;yaml&#x2F;pyyaml&#x2F;issues&#x2F;724">https:&#x2F;&#x2F;github.com&#x2F;yaml&#x2F;pyyaml&#x2F;issues&#x2F;724</a><p>I was pretty annoyed to discover that it had a separate build-time dependency on cython that you can&#x27;t control from your requirements.txt.</div><br/><div id="36779709" class="c"><input type="checkbox" id="c-36779709" checked=""/><div class="controls bullet"><span class="by">jborean93</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779313">parent</a><span>|</span><a href="#36779770">next</a><span>|</span><label class="collapse" for="c-36779709">[-]</label><label class="expand" for="c-36779709">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s unfortunately a pip limitation. You can either disable build isolation so that the build requirements are using your current environment or you can use the PIP_CONSTRAINTS env var which will be passed through to the isolated build invocation allowing you to constrain the build requirements. In this case PyYAML did release a 6.0.1 version which contains an upper bound constraint on Cython.</div><br/><div id="36779918" class="c"><input type="checkbox" id="c-36779918" checked=""/><div class="controls bullet"><span class="by">x3n0ph3n3</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779709">parent</a><span>|</span><a href="#36779770">next</a><span>|</span><label class="collapse" for="c-36779918">[-]</label><label class="expand" for="c-36779918">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s what I ended up doing just for the pyyaml installation.</div><br/></div></div></div></div><div id="36779770" class="c"><input type="checkbox" id="c-36779770" checked=""/><div class="controls bullet"><span class="by">stabbles</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779313">parent</a><span>|</span><a href="#36779709">prev</a><span>|</span><a href="#36782315">next</a><span>|</span><label class="collapse" for="c-36779770">[-]</label><label class="expand" for="c-36779770">[6 more]</label></div><br/><div class="children"><div class="content">In Spack [1] we can express all these constraints for the dependency solver, and we also try to always re-cythonize sources [2]. The latter is because bundled cythonized files are sometimes forward incompatible with Python, so it&#x27;s better to just regenerate those with an up to date cython.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack&#x2F;</a>
[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack&#x2F;pull&#x2F;35995">https:&#x2F;&#x2F;github.com&#x2F;spack&#x2F;spack&#x2F;pull&#x2F;35995</a></div><br/><div id="36780558" class="c"><input type="checkbox" id="c-36780558" checked=""/><div class="controls bullet"><span class="by">jborean93</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779770">parent</a><span>|</span><a href="#36780556">next</a><span>|</span><label class="collapse" for="c-36780558">[-]</label><label class="expand" for="c-36780558">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s what PyYAML does as well. It uses PEP 518 [1] to specify the dependencies for the build which PyYAML has included Cython [2]. It&#x27;s just that for previous releases there was no upper bound here so pip and other tools just selected the latest version which was incompatible. In the past PyYAML included the cythonised .c files in the sdist but as of 5.4.0 they went the PEP 518 route and ensures the client will cythonise them if installing from the sdist.<p>[1] - <a href="https:&#x2F;&#x2F;peps.python.org&#x2F;pep-0518&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;peps.python.org&#x2F;pep-0518&#x2F;</a>
[2] - <a href="https:&#x2F;&#x2F;github.com&#x2F;yaml&#x2F;pyyaml&#x2F;blob&#x2F;release&#x2F;6.0&#x2F;pyproject.toml#L2">https:&#x2F;&#x2F;github.com&#x2F;yaml&#x2F;pyyaml&#x2F;blob&#x2F;release&#x2F;6.0&#x2F;pyproject.to...</a></div><br/></div></div><div id="36780556" class="c"><input type="checkbox" id="c-36780556" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779770">parent</a><span>|</span><a href="#36780558">prev</a><span>|</span><a href="#36779925">next</a><span>|</span><label class="collapse" for="c-36780556">[-]</label><label class="expand" for="c-36780556">[1 more]</label></div><br/><div class="children"><div class="content">Neat! I had no idea that Spack can be used for cythonize dependencies. I use it to manage my local compiler&#x2F;CUDA&#x2F;Trilinos stack but never considered it for non C++ things.</div><br/></div></div><div id="36779925" class="c"><input type="checkbox" id="c-36779925" checked=""/><div class="controls bullet"><span class="by">x3n0ph3n3</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779770">parent</a><span>|</span><a href="#36780556">prev</a><span>|</span><a href="#36782315">next</a><span>|</span><label class="collapse" for="c-36779925">[-]</label><label class="expand" for="c-36779925">[3 more]</label></div><br/><div class="children"><div class="content">Oh great, yet _another_ Python package manager.</div><br/><div id="36780560" class="c"><input type="checkbox" id="c-36780560" checked=""/><div class="controls bullet"><span class="by">cowsandmilk</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779925">parent</a><span>|</span><a href="#36780367">next</a><span>|</span><label class="collapse" for="c-36780560">[-]</label><label class="expand" for="c-36780560">[1 more]</label></div><br/><div class="children"><div class="content">It’s not a python package manager. It is a generalized package manager written in python.</div><br/></div></div><div id="36780367" class="c"><input type="checkbox" id="c-36780367" checked=""/><div class="controls bullet"><span class="by">zincfingers</span><span>|</span><a href="#36779107">root</a><span>|</span><a href="#36779925">parent</a><span>|</span><a href="#36780560">prev</a><span>|</span><a href="#36782315">next</a><span>|</span><label class="collapse" for="c-36780367">[-]</label><label class="expand" for="c-36780367">[1 more]</label></div><br/><div class="children"><div class="content">Spack is a lot more than just python package manager :)</div><br/></div></div></div></div></div></div></div></div><div id="36782315" class="c"><input type="checkbox" id="c-36782315" checked=""/><div class="controls bullet"><span class="by">BiteCode_dev</span><span>|</span><a href="#36779107">parent</a><span>|</span><a href="#36779313">prev</a><span>|</span><a href="#36781549">next</a><span>|</span><label class="collapse" for="c-36782315">[-]</label><label class="expand" for="c-36782315">[1 more]</label></div><br/><div class="children"><div class="content">And this is why you pin your dependencies + never install the latest version of anything.</div><br/></div></div></div></div><div id="36781549" class="c"><input type="checkbox" id="c-36781549" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#36779107">prev</a><span>|</span><a href="#36780229">next</a><span>|</span><label class="collapse" for="c-36781549">[-]</label><label class="expand" for="c-36781549">[12 more]</label></div><br/><div class="children"><div class="content">I get that if I adorn my python3 with types the right way, cython can uplift C betterer, but if I don&#x27;t adorn my python3 and only use core imports (no pip) do I get any benefit?<p>I have some humongous (for me) dict lookups I am doing on strings, counting in ints, and if I could 2x or 3x faster without having to recode I&#x27;d love it. The Cython web is directed at people willing to recode, I am ultimately willing but I wish there was some low hanging fruit evidence: is this even plausibly going to get faster or is dict() walk cost just &quot;it is what it is&quot; ?<p>Oddly, it looks like across pickle dump&#x2F;load I get some improvement. Does pickle restoring consume less memory than raw-made?</div><br/><div id="36782849" class="c"><input type="checkbox" id="c-36782849" checked=""/><div class="controls bullet"><span class="by">takeda</span><span>|</span><a href="#36781549">parent</a><span>|</span><a href="#36781582">next</a><span>|</span><label class="collapse" for="c-36782849">[-]</label><label class="expand" for="c-36782849">[2 more]</label></div><br/><div class="children"><div class="content">I think in your case you might get a better benefit of using pypy and its jit.<p>The way I look at Cython is that it is a tool that allows me to write C code using python syntax. The biggest gains you get is when you use annotation to specify use simple (C) types with their drawbacks (like overflow etc) and or python features like exceptions, GIL etc</div><br/><div id="36783518" class="c"><input type="checkbox" id="c-36783518" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36782849">parent</a><span>|</span><a href="#36781582">next</a><span>|</span><label class="collapse" for="c-36783518">[-]</label><label class="expand" for="c-36783518">[1 more]</label></div><br/><div class="children"><div class="content">Thanks. I&#x27;m exploring that option, fixing bugs as I go too!</div><br/></div></div></div></div><div id="36781582" class="c"><input type="checkbox" id="c-36781582" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36781549">parent</a><span>|</span><a href="#36782849">prev</a><span>|</span><a href="#36782851">next</a><span>|</span><label class="collapse" for="c-36781582">[-]</label><label class="expand" for="c-36781582">[6 more]</label></div><br/><div class="children"><div class="content">You will ~likely get some improvement by directly putting your python code in a .pyx file and compiling it (without using any cdef functions). In most cases it will be as if you were calling the Python C API directly in a compiled C file. In my experience, the biggest difference will be a reduction in the function call overhead so it is better for tight loops.<p>I wouldn&#x27;t expect a full 2x in every case. But it can also be very significant in cases where Cython deduces the type of local variables.</div><br/><div id="36781683" class="c"><input type="checkbox" id="c-36781683" checked=""/><div class="controls bullet"><span class="by">ngoldbaum</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36781582">parent</a><span>|</span><a href="#36782851">next</a><span>|</span><label class="collapse" for="c-36781683">[-]</label><label class="expand" for="c-36781683">[5 more]</label></div><br/><div class="children"><div class="content">Cython 3 also uses python type annotaions to infer C types now too, so if you add python types you might see surprising cython speedups.</div><br/><div id="36781864" class="c"><input type="checkbox" id="c-36781864" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36781683">parent</a><span>|</span><a href="#36782851">next</a><span>|</span><label class="collapse" for="c-36781864">[-]</label><label class="expand" for="c-36781864">[4 more]</label></div><br/><div class="children"><div class="content">Coming back to this thread, I am running one now. It&#x27;s too early to say if there&#x27;s a speedup.<p>But I want to note it is <i>ridiculously under-documented</i> how to make what I would call a functional a.out from this toolset.<p>You basically are assumed to run python3 &gt;&gt;&gt; import &#x27;mything&#x27; and then run mything.main(args) instead of getting a functional commandline tool which &quot;just runs&quot; -the stepover is small, true, but I would have thought the PRIMARY use case here is commandline executable, not &quot;embed .so in my interpreter&quot;<p>There are a tonne of stack overflow &quot;how do I&quot; and all of them are really whacked: everyone trips over the same problems of :main undefined and a swag of other problems trying to call (g)cc themselves.</div><br/><div id="36781893" class="c"><input type="checkbox" id="c-36781893" checked=""/><div class="controls bullet"><span class="by">ngoldbaum</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36781864">parent</a><span>|</span><a href="#36782342">next</a><span>|</span><label class="collapse" for="c-36781893">[-]</label><label class="expand" for="c-36781893">[2 more]</label></div><br/><div class="children"><div class="content">I guess it’s mismatched expectations. IMO the primary use-case is making python wrappers for C&#x2F;C++ code or converting prototype Python code into a fast C extension for production use by adding types or progressively converting code into a language that is a mix of Python and C.</div><br/><div id="36781933" class="c"><input type="checkbox" id="c-36781933" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36781893">parent</a><span>|</span><a href="#36782342">next</a><span>|</span><label class="collapse" for="c-36781933">[-]</label><label class="expand" for="c-36781933">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s fair. Many happy customers so it&#x27;s very likely I misunderstood the mission and vision.<p>My primary experience in Python3 is to minimise REPL and get to commands which do stdin -&gt; &lt;process it&gt; -&gt; stdout and gang them up, or uplift discrete commands into yield() pipes inside the same interpreter.<p>I guess I fell into the trap of going from the particular to the general.</div><br/></div></div></div></div><div id="36782342" class="c"><input type="checkbox" id="c-36782342" checked=""/><div class="controls bullet"><span class="by">physicsguy</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36781864">parent</a><span>|</span><a href="#36781893">prev</a><span>|</span><a href="#36782851">next</a><span>|</span><label class="collapse" for="c-36782342">[-]</label><label class="expand" for="c-36782342">[1 more]</label></div><br/><div class="children"><div class="content">It’s designed for building libraries really. You write functions in the foo.pyx file, Cython generates a foo.c file which gets compiled to foo.cpython-39m-x86_64-linux-gnu and then in your script you do “import foo”</div><br/></div></div></div></div></div></div></div></div><div id="36782851" class="c"><input type="checkbox" id="c-36782851" checked=""/><div class="controls bullet"><span class="by">Recursing</span><span>|</span><a href="#36781549">parent</a><span>|</span><a href="#36781582">prev</a><span>|</span><a href="#36780229">next</a><span>|</span><label class="collapse" for="c-36782851">[-]</label><label class="expand" for="c-36782851">[3 more]</label></div><br/><div class="children"><div class="content">Did you try pypy.org ?</div><br/><div id="36783340" class="c"><input type="checkbox" id="c-36783340" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36782851">parent</a><span>|</span><a href="#36780229">next</a><span>|</span><label class="collapse" for="c-36783340">[-]</label><label class="expand" for="c-36783340">[2 more]</label></div><br/><div class="children"><div class="content">Yes, and I am still exploring. It is possible I have some scaling issues in dictionary which are not about compiled or not but about the cost of mutating data in a dict and gc costs.</div><br/><div id="36783598" class="c"><input type="checkbox" id="c-36783598" checked=""/><div class="controls bullet"><span class="by">mixmastamyk</span><span>|</span><a href="#36781549">root</a><span>|</span><a href="#36783340">parent</a><span>|</span><a href="#36780229">next</a><span>|</span><label class="collapse" for="c-36783598">[-]</label><label class="expand" for="c-36783598">[1 more]</label></div><br/><div class="children"><div class="content">Things like key lookup are already well optimized.  So finding a more efficient algorithm
 might  yield easier performance gains.<p>If you have for loops inside for loops, that&#x27;s one place to attack.  dict iterators, etc.</div><br/></div></div></div></div></div></div></div></div><div id="36780229" class="c"><input type="checkbox" id="c-36780229" checked=""/><div class="controls bullet"><span class="by">Waterluvian</span><span>|</span><a href="#36781549">prev</a><span>|</span><a href="#36779007">next</a><span>|</span><label class="collapse" for="c-36780229">[-]</label><label class="expand" for="c-36780229">[15 more]</label></div><br/><div class="children"><div class="content">The release of this pretty much hosed my morning at work.  Suddenly CI wouldn’t build because this broke things in pyyaml and awscli.<p>And then I got to re-learn how very bad Poetry and python dependency management is. I’m trying to update pyyaml to 6.0.1 and Poetry systematically downloaded every single major, minor, patch version of another dependency in trying to find which would fit the version constraints.  Took half an hour.</div><br/><div id="36783150" class="c"><input type="checkbox" id="c-36783150" checked=""/><div class="controls bullet"><span class="by">nextlevelwizard</span><span>|</span><a href="#36780229">parent</a><span>|</span><a href="#36783343">next</a><span>|</span><label class="collapse" for="c-36783150">[-]</label><label class="expand" for="c-36783150">[7 more]</label></div><br/><div class="children"><div class="content">Why are you blindly upgrading major versions of your tools?<p>Sounds like fundamental design issue more than anything.</div><br/><div id="36783273" class="c"><input type="checkbox" id="c-36783273" checked=""/><div class="controls bullet"><span class="by">plonk</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783150">parent</a><span>|</span><a href="#36783212">next</a><span>|</span><label class="collapse" for="c-36783273">[-]</label><label class="expand" for="c-36783273">[1 more]</label></div><br/><div class="children"><div class="content">The usual methods to control versions with a lockfile don’t work here because it’s a build dependency. You’d need to disable build isolation and install the right build tools in your environment before installing pyyaml but that can become a mess real quick.</div><br/></div></div><div id="36783212" class="c"><input type="checkbox" id="c-36783212" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783150">parent</a><span>|</span><a href="#36783273">prev</a><span>|</span><a href="#36783244">next</a><span>|</span><label class="collapse" for="c-36783212">[-]</label><label class="expand" for="c-36783212">[3 more]</label></div><br/><div class="children"><div class="content">Version dependencies aren’t propagated and can be outside your local control. As an example elsewhere in this thread: PyYAML did not have a pinned Cython dependency with a maximum version before this, so if your project depended on a pinned version of PyYAML it would break when trying to build it after Cython 3.0.0 released.</div><br/><div id="36783289" class="c"><input type="checkbox" id="c-36783289" checked=""/><div class="controls bullet"><span class="by">nextlevelwizard</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783212">parent</a><span>|</span><a href="#36783244">next</a><span>|</span><label class="collapse" for="c-36783289">[-]</label><label class="expand" for="c-36783289">[2 more]</label></div><br/><div class="children"><div class="content">Why are you constantly rebuilding dependencies? Surely you should only rebuild if there is a new (and vetted) version</div><br/><div id="36783344" class="c"><input type="checkbox" id="c-36783344" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783289">parent</a><span>|</span><a href="#36783244">next</a><span>|</span><label class="collapse" for="c-36783344">[-]</label><label class="expand" for="c-36783344">[1 more]</label></div><br/><div class="children"><div class="content">Lmao you’d think. But this is not the default or recommended pip&#x2F;setuptools behavior: <a href="https:&#x2F;&#x2F;pip.pypa.io&#x2F;en&#x2F;stable&#x2F;reference&#x2F;build-system&#x2F;pyproject-toml&#x2F;#build-isolation" rel="nofollow noreferrer">https:&#x2F;&#x2F;pip.pypa.io&#x2F;en&#x2F;stable&#x2F;reference&#x2F;build-system&#x2F;pyproje...</a></div><br/></div></div></div></div></div></div><div id="36783187" class="c"><input type="checkbox" id="c-36783187" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783150">parent</a><span>|</span><a href="#36783244">prev</a><span>|</span><a href="#36783343">next</a><span>|</span><label class="collapse" for="c-36783187">[-]</label><label class="expand" for="c-36783187">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;d hope people would learn this time, but they&#x27;ll probably just keep blaming their tools...</div><br/></div></div></div></div><div id="36783343" class="c"><input type="checkbox" id="c-36783343" checked=""/><div class="controls bullet"><span class="by">aldanor</span><span>|</span><a href="#36780229">parent</a><span>|</span><a href="#36783150">prev</a><span>|</span><a href="#36783235">next</a><span>|</span><label class="collapse" for="c-36783343">[-]</label><label class="expand" for="c-36783343">[2 more]</label></div><br/><div class="children"><div class="content">And that&#x27;s pretty much why you use binary package distributions like conda, despite all its flaws a sudden release of cython will never break your deps builds because there&#x27;s nothing to build.</div><br/><div id="36783572" class="c"><input type="checkbox" id="c-36783572" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36783343">parent</a><span>|</span><a href="#36783235">next</a><span>|</span><label class="collapse" for="c-36783572">[-]</label><label class="expand" for="c-36783572">[1 more]</label></div><br/><div class="children"><div class="content">You can force pip to only use wheels. Then if something fails, build your own wheel in your own (pinned) environment. Could be done in multi-stage docker build, for example.<p>If one of the build deps has no wheel then you&#x27;re fucked, though. At some level you have to rely on a toolchain.</div><br/></div></div></div></div><div id="36783235" class="c"><input type="checkbox" id="c-36783235" checked=""/><div class="controls bullet"><span class="by">plonk</span><span>|</span><a href="#36780229">parent</a><span>|</span><a href="#36783343">prev</a><span>|</span><a href="#36780283">next</a><span>|</span><label class="collapse" for="c-36783235">[-]</label><label class="expand" for="c-36783235">[1 more]</label></div><br/><div class="children"><div class="content">I think it doesn’t have a choice in downloading all versions if they use a setup.py config file. You have to get the sources to run it and get the package’s metadata.</div><br/></div></div><div id="36780283" class="c"><input type="checkbox" id="c-36780283" checked=""/><div class="controls bullet"><span class="by">gaganyaan</span><span>|</span><a href="#36780229">parent</a><span>|</span><a href="#36783235">prev</a><span>|</span><a href="#36783222">next</a><span>|</span><label class="collapse" for="c-36780283">[-]</label><label class="expand" for="c-36780283">[3 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re using poetry, why not just add a `cython = &quot;&lt;3.0&quot;` to your pyproject.toml file? You can lock down subdependency versions like that, and presumably the versions of everything that worked yesterday still work today.</div><br/><div id="36781271" class="c"><input type="checkbox" id="c-36781271" checked=""/><div class="controls bullet"><span class="by">aeyes</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36780283">parent</a><span>|</span><a href="#36780309">next</a><span>|</span><label class="collapse" for="c-36781271">[-]</label><label class="expand" for="c-36781271">[1 more]</label></div><br/><div class="children"><div class="content">If a top level dependency has build time dependencies then those do not respect the version locks of your pyproject.toml unless you disable build isolation.</div><br/></div></div><div id="36780309" class="c"><input type="checkbox" id="c-36780309" checked=""/><div class="controls bullet"><span class="by">Waterluvian</span><span>|</span><a href="#36780229">root</a><span>|</span><a href="#36780283">parent</a><span>|</span><a href="#36781271">prev</a><span>|</span><a href="#36783222">next</a><span>|</span><label class="collapse" for="c-36780309">[-]</label><label class="expand" for="c-36780309">[1 more]</label></div><br/><div class="children"><div class="content">It’s not part of my dependencies and it wasn’t on my radar.  What I learned was that pyyaml had a new version that fixed the error being thrown by pyyaml.</div><br/></div></div></div></div><div id="36783222" class="c"><input type="checkbox" id="c-36783222" checked=""/><div class="controls bullet"><span class="by">raverbashing</span><span>|</span><a href="#36780229">parent</a><span>|</span><a href="#36780283">prev</a><span>|</span><a href="#36779007">next</a><span>|</span><label class="collapse" for="c-36783222">[-]</label><label class="expand" for="c-36783222">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Poetry systematically downloaded every single major, minor, patch version of another dependency in trying to find which would fit the version constraints.<p>Great news! Better do that then have to do it manually<p>But yes it sucks, still Poetry is much better than Pip (where it just gives up and tell you to go deal with the issue yourself!)<p>Now why do people care about Cython and especially in things like dependencies I don&#x27;t understand. awscli shoud be an independent package! &quot;oh but it is faster&quot; are you counting the time it takes to fix things when they break because you are depending on a fragile thing?</div><br/></div></div></div></div><div id="36779007" class="c"><input type="checkbox" id="c-36779007" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#36780229">prev</a><span>|</span><a href="#36780948">next</a><span>|</span><label class="collapse" for="c-36779007">[-]</label><label class="expand" for="c-36779007">[1 more]</label></div><br/><div class="children"><div class="content">From <a href="https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;changes.html#compatibility-with-python" rel="nofollow noreferrer">https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;changes.html#com...</a> :<p>&gt; <i>Since Cython 3.0.0 started development, CPython 3.8-3.11 were released. All these are supported in Cython, including experimental support for the in-development CPython 3.12</i></div><br/></div></div><div id="36780948" class="c"><input type="checkbox" id="c-36780948" checked=""/><div class="controls bullet"><span class="by">zaps</span><span>|</span><a href="#36779007">prev</a><span>|</span><a href="#36780325">next</a><span>|</span><label class="collapse" for="c-36780948">[-]</label><label class="expand" for="c-36780948">[1 more]</label></div><br/><div class="children"><div class="content">Comments confirmed—Python packaging is broken</div><br/></div></div><div id="36780325" class="c"><input type="checkbox" id="c-36780325" checked=""/><div class="controls bullet"><span class="by">gigatexal</span><span>|</span><a href="#36780948">prev</a><span>|</span><label class="collapse" for="c-36780325">[-]</label><label class="expand" for="c-36780325">[6 more]</label></div><br/><div class="children"><div class="content">This broke a lot of stuff for us at work today. Building the wheels or something I can’t remember. The fix was forcing pip to use not the 3.x and use something older I think.</div><br/><div id="36782354" class="c"><input type="checkbox" id="c-36782354" checked=""/><div class="controls bullet"><span class="by">physicsguy</span><span>|</span><a href="#36780325">parent</a><span>|</span><a href="#36781628">next</a><span>|</span><label class="collapse" for="c-36782354">[-]</label><label class="expand" for="c-36782354">[2 more]</label></div><br/><div class="children"><div class="content">Cython did everything right here since it used a major version number to signify the change.<p>Other projets not pinning their dependencies is not their fault!</div><br/><div id="36782628" class="c"><input type="checkbox" id="c-36782628" checked=""/><div class="controls bullet"><span class="by">lazka</span><span>|</span><a href="#36780325">root</a><span>|</span><a href="#36782354">parent</a><span>|</span><a href="#36781628">next</a><span>|</span><label class="collapse" for="c-36782628">[-]</label><label class="expand" for="c-36782628">[1 more]</label></div><br/><div class="children"><div class="content">They don&#x27;t use pinning in their examples: <a href="https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;userguide&#x2F;source_files_and_compilation.html#basic-setup-py" rel="nofollow noreferrer">https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;userguide&#x2F;source...</a> and <a href="https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;userguide&#x2F;source_files_and_compilation.html#distributing-cython-modules" rel="nofollow noreferrer">https:&#x2F;&#x2F;cython.readthedocs.io&#x2F;en&#x2F;latest&#x2F;src&#x2F;userguide&#x2F;source...</a></div><br/></div></div></div></div><div id="36781628" class="c"><input type="checkbox" id="c-36781628" checked=""/><div class="controls bullet"><span class="by">esafak</span><span>|</span><a href="#36780325">parent</a><span>|</span><a href="#36782354">prev</a><span>|</span><a href="#36780514">next</a><span>|</span><label class="collapse" for="c-36781628">[-]</label><label class="expand" for="c-36781628">[2 more]</label></div><br/><div class="children"><div class="content">As always: pin your dependencies.</div><br/><div id="36782711" class="c"><input type="checkbox" id="c-36782711" checked=""/><div class="controls bullet"><span class="by">unpythonic</span><span>|</span><a href="#36780325">root</a><span>|</span><a href="#36781628">parent</a><span>|</span><a href="#36780514">next</a><span>|</span><label class="collapse" for="c-36782711">[-]</label><label class="expand" for="c-36782711">[1 more]</label></div><br/><div class="children"><div class="content">Sadly, it&#x27;s not always that simple. If one of your well-pinned packages has a build dependency which is not correctly pinned, then you&#x27;re subject to the problem.</div><br/></div></div></div></div><div id="36780514" class="c"><input type="checkbox" id="c-36780514" checked=""/><div class="controls bullet"><span class="by">gyrovagueGeist</span><span>|</span><a href="#36780325">parent</a><span>|</span><a href="#36781628">prev</a><span>|</span><label class="collapse" for="c-36780514">[-]</label><label class="expand" for="c-36780514">[1 more]</label></div><br/><div class="children"><div class="content">Just so anyone who reads this has the version: cython&lt;=0.29.36 is the most recent non 3.0.0 version.</div><br/></div></div></div></div></div></div></div></div></div></body></html>