<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1725872472874" as="style"/><link rel="stylesheet" href="styles.css?v=1725872472874"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.trailofbits.com/2024/09/06/unstripping-binaries-restoring-debugging-information-in-gdb-with-pwndbg/">&quot;Unstripping&quot; binaries: Restoring debugging information in GDB with Pwndbg</a> <span class="domain">(<a href="https://blog.trailofbits.com">blog.trailofbits.com</a>)</span></div><div class="subtext"><span>aa_is_op</span> | <span>21 comments</span></div><br/><div><div id="41482949" class="c"><input type="checkbox" id="c-41482949" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41482036">next</a><span>|</span><label class="collapse" for="c-41482949">[-]</label><label class="expand" for="c-41482949">[6 more]</label></div><br/><div class="children"><div class="content"><i>GDB loses significant functionality when debugging binaries that lack debugging symbols</i><p>IMHO from experience with other debuggers, GDB is actually hostile to debugging at the Asm level, due to many perplexing design choices which may or may not be deliberate. Things like needing to add a superfluous asterisk when breakpointing on an address, the &quot;disassemble&quot; command not being able to do what it says and instead complaining about a lack of functions, etc.</div><br/><div id="41486601" class="c"><input type="checkbox" id="c-41486601" checked=""/><div class="controls bullet"><span class="by">TuxSH</span><span>|</span><a href="#41482949">parent</a><span>|</span><a href="#41483458">next</a><span>|</span><label class="collapse" for="c-41486601">[-]</label><label class="expand" for="c-41486601">[1 more]</label></div><br/><div class="children"><div class="content">&gt; the &quot;disassemble&quot; command not being able to do what it says and instead complaining about a lack of functions, etc.<p>For reference (for other readers), while I totally agree with you, disassembling at a particular address can be done via something like &quot;x&#x2F;20i $pc&quot; (&quot;display 20 instructions starting from content at $pc&quot;).<p>Something quite annoying as well is that you have to patch GDB in order to be able to use software single-step on custom OS&#x2F;baremetal targets (IDA has no such issue, it is an option in their UI). GDB doesn&#x27;t even honor their own remote stub protocol.</div><br/></div></div><div id="41483458" class="c"><input type="checkbox" id="c-41483458" checked=""/><div class="controls bullet"><span class="by">jchw</span><span>|</span><a href="#41482949">parent</a><span>|</span><a href="#41486601">prev</a><span>|</span><a href="#41483362">next</a><span>|</span><label class="collapse" for="c-41483458">[-]</label><label class="expand" for="c-41483458">[3 more]</label></div><br/><div class="children"><div class="content">I have definitely gotten to the point of &quot;Fine, I&#x27;ll just use IDA Pro then&quot;.<p>Of course, visual debuggers are another story entirely, but I&#x27;m not really thrilled with them either. For example I don&#x27;t recall there being a good way to say &quot;Decode the address at rax as a WNDCLASSA&quot; or something like that in IDA. (I&#x27;m crossing my fingers for a Cunningham&#x27;s Law here.)</div><br/><div id="41484876" class="c"><input type="checkbox" id="c-41484876" checked=""/><div class="controls bullet"><span class="by">SoothingSorbet</span><span>|</span><a href="#41482949">root</a><span>|</span><a href="#41483458">parent</a><span>|</span><a href="#41484526">next</a><span>|</span><label class="collapse" for="c-41484876">[-]</label><label class="expand" for="c-41484876">[1 more]</label></div><br/><div class="children"><div class="content">You can jump to the address and then declare the data as a struct.<p>It is annoying though that you can&#x27;t make the register display show a particular type, it only shows unsigned hex integers. If I&#x27;m tracking a 32-bit float it is very frustrating, it won&#x27;t even show you alternate representations on hover...<p>For as good and expensive as IDA is, the UX sure is lacking.</div><br/></div></div><div id="41484526" class="c"><input type="checkbox" id="c-41484526" checked=""/><div class="controls bullet"><span class="by">orisho</span><span>|</span><a href="#41482949">root</a><span>|</span><a href="#41483458">parent</a><span>|</span><a href="#41484876">prev</a><span>|</span><a href="#41483362">next</a><span>|</span><label class="collapse" for="c-41484526">[-]</label><label class="expand" for="c-41484526">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t recall what it was called in the menu, but it was definitely possible to assume a struct on a particular address. Muscle memory tells me the button is U, even though actual memory fails me.</div><br/></div></div></div></div><div id="41483362" class="c"><input type="checkbox" id="c-41483362" checked=""/><div class="controls bullet"><span class="by">kuroguro</span><span>|</span><a href="#41482949">parent</a><span>|</span><a href="#41483458">prev</a><span>|</span><a href="#41482036">next</a><span>|</span><label class="collapse" for="c-41483362">[-]</label><label class="expand" for="c-41483362">[1 more]</label></div><br/><div class="children"><div class="content">+1 there are many pain points, probably for historic reasons. *nix almost always comes with the source, so binary only debugging is never a priority.</div><br/></div></div></div></div><div id="41482036" class="c"><input type="checkbox" id="c-41482036" checked=""/><div class="controls bullet"><span class="by">robin_reala</span><span>|</span><a href="#41482949">prev</a><span>|</span><a href="#41482352">next</a><span>|</span><label class="collapse" for="c-41482036">[-]</label><label class="expand" for="c-41482036">[3 more]</label></div><br/><div class="children"><div class="content">I read “pwndgb” as Welsh for a good 5 seconds before realising which site I was on.</div><br/><div id="41482918" class="c"><input type="checkbox" id="c-41482918" checked=""/><div class="controls bullet"><span class="by">senkora</span><span>|</span><a href="#41482036">parent</a><span>|</span><a href="#41482352">next</a><span>|</span><label class="collapse" for="c-41482918">[-]</label><label class="expand" for="c-41482918">[2 more]</label></div><br/><div class="children"><div class="content">“Welsh or C standard library name?”<p><a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;ProgrammerHumor&#x2F;comments&#x2F;1f123qw&#x2F;letsplayagame&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;ProgrammerHumor&#x2F;comments&#x2F;1f123qw&#x2F;le...</a></div><br/><div id="41484627" class="c"><input type="checkbox" id="c-41484627" checked=""/><div class="controls bullet"><span class="by">tomcam</span><span>|</span><a href="#41482036">root</a><span>|</span><a href="#41482918">parent</a><span>|</span><a href="#41482352">next</a><span>|</span><label class="collapse" for="c-41484627">[-]</label><label class="expand" for="c-41484627">[1 more]</label></div><br/><div class="children"><div class="content">Beautiful</div><br/></div></div></div></div></div></div><div id="41482352" class="c"><input type="checkbox" id="c-41482352" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#41482036">prev</a><span>|</span><a href="#41484713">next</a><span>|</span><label class="collapse" for="c-41482352">[-]</label><label class="expand" for="c-41482352">[2 more]</label></div><br/><div class="children"><div class="content">I’m curious how this compares with <a href="https:&#x2F;&#x2F;github.com&#x2F;mahaloz&#x2F;decomp2dbg">https:&#x2F;&#x2F;github.com&#x2F;mahaloz&#x2F;decomp2dbg</a></div><br/><div id="41485798" class="c"><input type="checkbox" id="c-41485798" checked=""/><div class="controls bullet"><span class="by">unvariant</span><span>|</span><a href="#41482352">parent</a><span>|</span><a href="#41484713">next</a><span>|</span><label class="collapse" for="c-41485798">[-]</label><label class="expand" for="c-41485798">[1 more]</label></div><br/><div class="children"><div class="content">`decomp2dbg` mostly just provides pc to source mapping. It also makes function arguments and local stack variables available through gdb convenience variables (function arguments are broken since it assumes they stay in the registers and are never clobbered). This plugin is a bit nicer because of the syncing it does with binja. Coincidentally, I am working on a binja plugin which live imports types, symbols, and function data using dwarf.</div><br/></div></div></div></div><div id="41484713" class="c"><input type="checkbox" id="c-41484713" checked=""/><div class="controls bullet"><span class="by">ghostpepper</span><span>|</span><a href="#41482352">prev</a><span>|</span><a href="#41482310">next</a><span>|</span><label class="collapse" for="c-41484713">[-]</label><label class="expand" for="c-41484713">[1 more]</label></div><br/><div class="children"><div class="content">This is really cool. Anyone know what license level of binja is required? Does it work with the free edition?</div><br/></div></div><div id="41482310" class="c"><input type="checkbox" id="c-41482310" checked=""/><div class="controls bullet"><span class="by">bieganski</span><span>|</span><a href="#41484713">prev</a><span>|</span><a href="#41482321">next</a><span>|</span><label class="collapse" for="c-41482310">[-]</label><label class="expand" for="c-41482310">[7 more]</label></div><br/><div class="children"><div class="content">sounds like an interesting direction, but I don&#x27;t understand why should we have it coupled to specific tool (pwndbg)? Why not implement a BinaryNinja plugin to dump all user-defined names (function names, stack variables), together with an original (stripped) binary to the new ELF&#x2F;.exe file, with symbol table and presumably with DWARF section?</div><br/><div id="41483070" class="c"><input type="checkbox" id="c-41483070" checked=""/><div class="controls bullet"><span class="by">boricj</span><span>|</span><a href="#41482310">parent</a><span>|</span><a href="#41482354">next</a><span>|</span><label class="collapse" for="c-41483070">[-]</label><label class="expand" for="c-41483070">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve developed a Ghidra extension that exports object files. I&#x27;ve considered generating debugging symbols in order to improve the debugging experience when reusing these object files in new programs, but I keep postponing that feature for various reasons.<p>Executable formats have at least one and often multiple debugging data formats which are very different from each other: ELF has STABS and DWARF version 1 to 5, MSVC has at least COFF symbols and PDB (which isn&#x27;t documented)... Even discarding the old or obsolete stuff, there&#x27;s no universal solution here. gdb+pwndbg seems to side-step this issue by integrating the debugger with Binary Ninja.<p>Projecting reverse-engineered information into a debugging data format would also be a technical challenge once you go past global variables and type definitions. Debuggers already have a terrible user experience when stepping through functions in an optimized executable ; I doubt that reverse-engineered debugging data would be any better.<p>Toolchains also don&#x27;t do a lot of validation or diagnostics on their inputs and I can tell from experience that writing correct object files from scratch is already quite tricky. I expect that serializing correct and meaningful debugging data would be much harder than that.<p>Doing this at the native executable level has the obvious advantage of working out of the box with standard tooling, but it would be a <i>lot</i> of work. I&#x27;ve already taken 2 1&#x2F;2 years to make an object file exporter that&#x27;s good enough for my needs and I&#x27;m still balking at generating DWARF debugging data every time I&#x27;ve considered it. I&#x27;m resigned to a terrible debugging experience and so far I&#x27;ve managed to muddle through it.</div><br/><div id="41483363" class="c"><input type="checkbox" id="c-41483363" checked=""/><div class="controls bullet"><span class="by">jcranmer</span><span>|</span><a href="#41482310">root</a><span>|</span><a href="#41483070">parent</a><span>|</span><a href="#41484897">next</a><span>|</span><label class="collapse" for="c-41483363">[-]</label><label class="expand" for="c-41483363">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Debuggers already have a terrible user experience when stepping through functions in an optimized executable ; I doubt that reverse-engineered debugging data would be any better.<p>Actually, I suspect it could be a world of difference. The main failures of optimized debugging are that code motion makes line number tables more of a suggestion, the source code values may disappear in favor of other related values (e.g., SROA or changing A[i] to p++), live ranges of variables may shrink, and debugging information may only support variables in stack slot or other specific locations. If you generating debugging based on decompiled code, you can control the output code to make the first two problems more or less go away, and so you only really have to worry about narrow live ranges (can&#x27;t do much about that) or debuggers not supporting the features you need (which, given DWARF, is a very real possibility).</div><br/></div></div><div id="41484897" class="c"><input type="checkbox" id="c-41484897" checked=""/><div class="controls bullet"><span class="by">SoothingSorbet</span><span>|</span><a href="#41482310">root</a><span>|</span><a href="#41483070">parent</a><span>|</span><a href="#41483363">prev</a><span>|</span><a href="#41482354">next</a><span>|</span><label class="collapse" for="c-41484897">[-]</label><label class="expand" for="c-41484897">[2 more]</label></div><br/><div class="children"><div class="content">&gt; PDB (which isn&#x27;t documented)...<p>What about <a href="https:&#x2F;&#x2F;github.com&#x2F;Microsoft&#x2F;microsoft-pdb">https:&#x2F;&#x2F;github.com&#x2F;Microsoft&#x2F;microsoft-pdb</a> ? Not technically documentation, but the closest thing to it.</div><br/><div id="41485954" class="c"><input type="checkbox" id="c-41485954" checked=""/><div class="controls bullet"><span class="by">boricj</span><span>|</span><a href="#41482310">root</a><span>|</span><a href="#41484897">parent</a><span>|</span><a href="#41482354">next</a><span>|</span><label class="collapse" for="c-41485954">[-]</label><label class="expand" for="c-41485954">[1 more]</label></div><br/><div class="children"><div class="content">I was mostly aware of <a href="https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;PDB&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;PDB&#x2F;index.html</a>, which paints a rather complex high-level picture.<p>At any rate, while my extension has exporters for both ELF and COFF I&#x27;m personally using only the former. The latter is user-contributed and I don&#x27;t know much about the Microsoft toolchain and file formats.</div><br/></div></div></div></div></div></div><div id="41482354" class="c"><input type="checkbox" id="c-41482354" checked=""/><div class="controls bullet"><span class="by">5-</span><span>|</span><a href="#41482310">parent</a><span>|</span><a href="#41483070">prev</a><span>|</span><a href="#41482321">next</a><span>|</span><label class="collapse" for="c-41482354">[-]</label><label class="expand" for="c-41482354">[2 more]</label></div><br/><div class="children"><div class="content">that&#x27;s already available in binaryninja out of the box, via the (seemingly undocumented) &#x27;plugins&#x27; -&gt; &#x27;export as dwarf&#x27; menu item.</div><br/><div id="41485810" class="c"><input type="checkbox" id="c-41485810" checked=""/><div class="controls bullet"><span class="by">unvariant</span><span>|</span><a href="#41482310">root</a><span>|</span><a href="#41482354">parent</a><span>|</span><a href="#41482321">next</a><span>|</span><label class="collapse" for="c-41485810">[-]</label><label class="expand" for="c-41485810">[1 more]</label></div><br/><div class="children"><div class="content">Not really, export as dwarf only gives types and symbols, it does not generate dwarf pc -&gt; source line information, which this plugin provides via a custom context pane. Manually running the export every time a pc step occurs would also be quite painful.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>