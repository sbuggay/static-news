<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716454870978" as="style"/><link rel="stylesheet" href="styles.css?v=1716454870978"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/ohbarye/pbt">Show HN: PBT – A property-based testing library for Ruby</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>ohbarye</span> | <span>29 comments</span></div><br/><div><div id="40451780" class="c"><input type="checkbox" id="c-40451780" checked=""/><div class="controls bullet"><span class="by">Lio</span><span>|</span><a href="#40451074">next</a><span>|</span><label class="collapse" for="c-40451780">[-]</label><label class="expand" for="c-40451780">[1 more]</label></div><br/><div class="children"><div class="content">Lovely stuff, thank you.<p>It would be cool if we could eventually make use of RBS or inline Sorbet or something better than both to get the types for property testing for free.</div><br/></div></div><div id="40451074" class="c"><input type="checkbox" id="c-40451074" checked=""/><div class="controls bullet"><span class="by">hdjrkaofbdjwm</span><span>|</span><a href="#40451780">prev</a><span>|</span><a href="#40442307">next</a><span>|</span><label class="collapse" for="c-40451074">[-]</label><label class="expand" for="c-40451074">[1 more]</label></div><br/><div class="children"><div class="content">Great work, looks really clean! Check out Minithesis [1] and the paper explaining internal shrinking [2]. It will strongly improve your library&#x27;s shrinking capabilities and prevent users from having to write their own shrinkers for custom objects in most cases.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;DRMacIver&#x2F;minithesis">https:&#x2F;&#x2F;github.com&#x2F;DRMacIver&#x2F;minithesis</a><p>[2] <a href="https:&#x2F;&#x2F;drops.dagstuhl.de&#x2F;entities&#x2F;document&#x2F;10.4230&#x2F;LIPIcs.ECOOP.2020.13" rel="nofollow">https:&#x2F;&#x2F;drops.dagstuhl.de&#x2F;entities&#x2F;document&#x2F;10.4230&#x2F;LIPIcs.E...</a></div><br/></div></div><div id="40442307" class="c"><input type="checkbox" id="c-40442307" checked=""/><div class="controls bullet"><span class="by">cortesoft</span><span>|</span><a href="#40451074">prev</a><span>|</span><a href="#40442687">next</a><span>|</span><label class="collapse" for="c-40442307">[-]</label><label class="expand" for="c-40442307">[2 more]</label></div><br/><div class="children"><div class="content">Can this be used alongside rspec? Like have these be tests that are included in the rspec test run, and have the results alongside your other rspec tests?</div><br/><div id="40442420" class="c"><input type="checkbox" id="c-40442420" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40442307">parent</a><span>|</span><a href="#40442687">next</a><span>|</span><label class="collapse" for="c-40442420">[-]</label><label class="expand" for="c-40442420">[1 more]</label></div><br/><div class="children"><div class="content">The answer to both questions is yes.<p>This gem doesn&#x27;t aim to reimplement a testing framework. It can also be considered just an assertion. You can use this alongside any testing framework like RSpec, minitest, and etc.</div><br/></div></div></div></div><div id="40442687" class="c"><input type="checkbox" id="c-40442687" checked=""/><div class="controls bullet"><span class="by">jack_riminton</span><span>|</span><a href="#40442307">prev</a><span>|</span><a href="#40443992">next</a><span>|</span><label class="collapse" for="c-40442687">[-]</label><label class="expand" for="c-40442687">[10 more]</label></div><br/><div class="children"><div class="content">Interesting! I wonder how this could be applied to a Rails project (since that&#x27;s what ruby is most used for). For example how would it know to test a wide selection of possible values for different variables if they&#x27;re not explicitly set up?</div><br/><div id="40443251" class="c"><input type="checkbox" id="c-40443251" checked=""/><div class="controls bullet"><span class="by">parentheses</span><span>|</span><a href="#40442687">parent</a><span>|</span><a href="#40447461">prev</a><span>|</span><a href="#40442934">next</a><span>|</span><label class="collapse" for="c-40443251">[-]</label><label class="expand" for="c-40443251">[1 more]</label></div><br/><div class="children"><div class="content">I imagine it wouldn&#x27;t be too hard to build up your own data generators for Rails models (or other entities).</div><br/></div></div><div id="40442934" class="c"><input type="checkbox" id="c-40442934" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#40442687">parent</a><span>|</span><a href="#40443251">prev</a><span>|</span><a href="#40443992">next</a><span>|</span><label class="collapse" for="c-40442934">[-]</label><label class="expand" for="c-40442934">[7 more]</label></div><br/><div class="children"><div class="content">&gt; Rails [...] that&#x27;s what ruby is most used for<p>I wish that wasn&#x27;t the case, I use Ruby heavily for gluing different systems together.</div><br/><div id="40443335" class="c"><input type="checkbox" id="c-40443335" checked=""/><div class="controls bullet"><span class="by">mikepurvis</span><span>|</span><a href="#40442687">root</a><span>|</span><a href="#40442934">parent</a><span>|</span><a href="#40443992">next</a><span>|</span><label class="collapse" for="c-40443335">[-]</label><label class="expand" for="c-40443335">[6 more]</label></div><br/><div class="children"><div class="content">Outside of language level preferences, is there something about the <i>ecosystem</i> around Ruby that makes it particularly well suited to this? I would have thought Python was the glue language winner just because there are already bindings to the entire universe available for it.</div><br/><div id="40443582" class="c"><input type="checkbox" id="c-40443582" checked=""/><div class="controls bullet"><span class="by">portpecos</span><span>|</span><a href="#40442687">root</a><span>|</span><a href="#40443335">parent</a><span>|</span><a href="#40444169">next</a><span>|</span><label class="collapse" for="c-40443582">[-]</label><label class="expand" for="c-40443582">[3 more]</label></div><br/><div class="children"><div class="content">Ruby just simply isn’t the glue language winner because of the heavy emphasis on rails.<p>From a systems perspective, I had to switch to python because it has pyroute2, which supports rtnl, devlink, ethtool and more.<p>I would have thought ruby had a full-fledged netlink library right now considering the stability of chef and puppet.<p>But all I could find was this from 8 years ago: <a href="https:&#x2F;&#x2F;github.com&#x2F;BytemarkHosting&#x2F;netlinkrb">https:&#x2F;&#x2F;github.com&#x2F;BytemarkHosting&#x2F;netlinkrb</a><p>I started off with ruby for systems glue but now I have a mix of python and ruby. I wish it was all ruby but the lack of updated “glue gems” and the prevalence of updated “glue eggs” means python really is the “glue language winner”.</div><br/><div id="40445079" class="c"><input type="checkbox" id="c-40445079" checked=""/><div class="controls bullet"><span class="by">sam2426679</span><span>|</span><a href="#40442687">root</a><span>|</span><a href="#40443582">parent</a><span>|</span><a href="#40444209">next</a><span>|</span><label class="collapse" for="c-40445079">[-]</label><label class="expand" for="c-40445079">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I wish it was all ruby<p>Why do you not wish it was all Python?</div><br/></div></div><div id="40444209" class="c"><input type="checkbox" id="c-40444209" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#40442687">root</a><span>|</span><a href="#40443582">parent</a><span>|</span><a href="#40445079">prev</a><span>|</span><a href="#40444169">next</a><span>|</span><label class="collapse" for="c-40444209">[-]</label><label class="expand" for="c-40444209">[1 more]</label></div><br/><div class="children"><div class="content">&gt; all I could find was this from 8 years ago: <a href="https:&#x2F;&#x2F;github.com&#x2F;BytemarkHosting&#x2F;netlinkrb">https:&#x2F;&#x2F;github.com&#x2F;BytemarkHosting&#x2F;netlinkrb</a><p>Yeah, that&#x27;s so typical. I&#x27;ve almost become used to this, seeing useful gems being very old. To me, I see that as either abandoned (which means I have to fork it and polish it) or the gem is considered complete.</div><br/></div></div></div></div><div id="40444169" class="c"><input type="checkbox" id="c-40444169" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#40442687">root</a><span>|</span><a href="#40443335">parent</a><span>|</span><a href="#40443582">prev</a><span>|</span><a href="#40443561">next</a><span>|</span><label class="collapse" for="c-40444169">[-]</label><label class="expand" for="c-40444169">[1 more]</label></div><br/><div class="children"><div class="content">Ruby is my choice primarily because of its syntax and the powerful meta-programming capabilities. The ecosystem in itself is not any richer or better than Python, no, Python has faaar superior libraries and vibrant support.
In my case, I&#x27;ve found ruby-toolbox.com to be useful when I need to scavenge for libraries.</div><br/></div></div></div></div></div></div></div></div><div id="40443992" class="c"><input type="checkbox" id="c-40443992" checked=""/><div class="controls bullet"><span class="by">bloopernova</span><span>|</span><a href="#40442687">prev</a><span>|</span><a href="#40443303">next</a><span>|</span><label class="collapse" for="c-40443992">[-]</label><label class="expand" for="c-40443992">[2 more]</label></div><br/><div class="children"><div class="content">Can anyone recommend an introduction to PBT for someone who knows nothing about it?<p>Edited to add: D&#x27;oh! There&#x27;s an explanation in the linked repo.</div><br/><div id="40449727" class="c"><input type="checkbox" id="c-40449727" checked=""/><div class="controls bullet"><span class="by">arialdomartini</span><span>|</span><a href="#40443992">parent</a><span>|</span><a href="#40443303">next</a><span>|</span><label class="collapse" for="c-40449727">[-]</label><label class="expand" for="c-40449727">[1 more]</label></div><br/><div class="children"><div class="content">You might appreciate this little series of posts, specifically thought to provide a smooth introduction:<p><a href="https:&#x2F;&#x2F;arialdomartini.github.io&#x2F;property-testing" rel="nofollow">https:&#x2F;&#x2F;arialdomartini.github.io&#x2F;property-testing</a></div><br/></div></div></div></div><div id="40443303" class="c"><input type="checkbox" id="c-40443303" checked=""/><div class="controls bullet"><span class="by">parentheses</span><span>|</span><a href="#40443992">prev</a><span>|</span><a href="#40447607">next</a><span>|</span><label class="collapse" for="c-40443303">[-]</label><label class="expand" for="c-40443303">[6 more]</label></div><br/><div class="children"><div class="content">Very specific question: when tests fail due to a single example, you suggest creating a specific assertion with the given seed.<p>I imagine the seed is used to generate data and depending on the order of your generators, it produces different results.<p>For example, in:<p><pre><code>    PBT.assert(seed = ..) do
      PBT.property(PBT.integer, PBT.string) ...
    end
</code></pre>
Would changing the order of parameters to `property` change the actual test case?</div><br/><div id="40443661" class="c"><input type="checkbox" id="c-40443661" checked=""/><div class="controls bullet"><span class="by">tybug</span><span>|</span><a href="#40443303">parent</a><span>|</span><a href="#40447607">next</a><span>|</span><label class="collapse" for="c-40443661">[-]</label><label class="expand" for="c-40443661">[5 more]</label></div><br/><div class="children"><div class="content">(not OP but I would be surprised if the answer wasn&#x27;t) yes, because you&#x27;re changing the order in which the random draws are interpreted. But this isn&#x27;t a problem in practice because you generally aren&#x27;t changing the generator in the middle of debugging a failure.</div><br/><div id="40450876" class="c"><input type="checkbox" id="c-40450876" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40443303">root</a><span>|</span><a href="#40443661">parent</a><span>|</span><a href="#40445235">next</a><span>|</span><label class="collapse" for="c-40450876">[-]</label><label class="expand" for="c-40450876">[1 more]</label></div><br/><div class="children"><div class="content">&gt;yes, because you&#x27;re changing the order in which the random draws are interpreted. But this isn&#x27;t a problem in practice because you generally aren&#x27;t changing the generator in the middle of debugging a failure.<p>Correct. The test inputs are determined by a seed and generators (including the order of generators).</div><br/></div></div><div id="40445235" class="c"><input type="checkbox" id="c-40445235" checked=""/><div class="controls bullet"><span class="by">parentheses</span><span>|</span><a href="#40443303">root</a><span>|</span><a href="#40443661">parent</a><span>|</span><a href="#40450876">prev</a><span>|</span><a href="#40447607">next</a><span>|</span><label class="collapse" for="c-40445235">[-]</label><label class="expand" for="c-40445235">[3 more]</label></div><br/><div class="children"><div class="content">So, this means refactoring becomes potentially difficult. While the gem is still a great accomplishment and very useful, I&#x27;d have to engineer my way around this issue before using it with things like a Rails Model which could have changing shape.<p>@OP:<p>I wonder if the README (and possibly runner) should suggest writing a test-case that doesn&#x27;t rely on PBT when the user wants to preserve a case for future testing.<p>The issue here is that if you&#x27;re saving a singular example and it represents a weird corner case, it&#x27;s totally conceivable that a small change will result in an invisible change to that test case.<p>Another idea: it&#x27;d be great if the test could simply take examples that are failing and add them to a `failing_examples.rb` or some such. I know I&#x27;d use a feature like this quite a bit.</div><br/><div id="40450935" class="c"><input type="checkbox" id="c-40450935" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40443303">root</a><span>|</span><a href="#40445235">parent</a><span>|</span><a href="#40445358">next</a><span>|</span><label class="collapse" for="c-40450935">[-]</label><label class="expand" for="c-40450935">[1 more]</label></div><br/><div class="children"><div class="content">I think there are usually three actions a programmer can take when PBT fails.<p>- Create a test case that doesn&#x27;t depend on PBT as you suggest.<p>- Fix the production code being tested since its failure is an unexpected bug.<p>- Fix the PBT itself. This means that the programmer has had wrong assumption for the test target.<p>I think it&#x27;s difficult for the tool to know which choice is the best on a failure. But if there&#x27;s any good idea, I&#x27;d like to incorporate it. :)</div><br/></div></div></div></div></div></div></div></div><div id="40447607" class="c"><input type="checkbox" id="c-40447607" checked=""/><div class="controls bullet"><span class="by">Lammy</span><span>|</span><a href="#40443303">prev</a><span>|</span><a href="#40441948">next</a><span>|</span><label class="collapse" for="c-40447607">[-]</label><label class="expand" for="c-40447607">[2 more]</label></div><br/><div class="children"><div class="content">Excited to see libraries using Ractors as somebody who has also fallen in love with them ♡</div><br/><div id="40450847" class="c"><input type="checkbox" id="c-40450847" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40447607">parent</a><span>|</span><a href="#40441948">next</a><span>|</span><label class="collapse" for="c-40450847">[-]</label><label class="expand" for="c-40450847">[1 more]</label></div><br/><div class="children"><div class="content">I can really empathize. Hope the Ruby ecosystem gets more compatible with Ractor.</div><br/></div></div></div></div><div id="40441948" class="c"><input type="checkbox" id="c-40441948" checked=""/><div class="controls bullet"><span class="by">lijok</span><span>|</span><a href="#40447607">prev</a><span>|</span><a href="#40442792">next</a><span>|</span><label class="collapse" for="c-40441948">[-]</label><label class="expand" for="c-40441948">[2 more]</label></div><br/><div class="children"><div class="content">Amazing work ! Happy to see any effort towards PBT.</div><br/><div id="40442432" class="c"><input type="checkbox" id="c-40442432" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40441948">parent</a><span>|</span><a href="#40442792">next</a><span>|</span><label class="collapse" for="c-40442432">[-]</label><label class="expand" for="c-40442432">[1 more]</label></div><br/><div class="children"><div class="content">Thank you. I hope the gem will make your testing life happier!</div><br/></div></div></div></div><div id="40442792" class="c"><input type="checkbox" id="c-40442792" checked=""/><div class="controls bullet"><span class="by">mberning</span><span>|</span><a href="#40441948">prev</a><span>|</span><label class="collapse" for="c-40442792">[-]</label><label class="expand" for="c-40442792">[2 more]</label></div><br/><div class="children"><div class="content">Very cool. Wonder how much time this adds to a test suite as you incorporate it more. Might need to have some different test targets to keep things fast.</div><br/><div id="40450841" class="c"><input type="checkbox" id="c-40450841" checked=""/><div class="controls bullet"><span class="by">ohbarye</span><span>|</span><a href="#40442792">parent</a><span>|</span><label class="collapse" for="c-40450841">[-]</label><label class="expand" for="c-40450841">[1 more]</label></div><br/><div class="children"><div class="content">Thank you.<p>In my opinion, PBT should be used in combination with example-based testing. Besides, since example-based testing cases account for the majority of tests, I think it&#x27;s rare that PBT&#x27;s execution time is dominant.<p>As for the combination and usages, refs: <a href="https:&#x2F;&#x2F;medium.com&#x2F;criteo-engineering&#x2F;introduction-to-property-based-testing-f5236229d237" rel="nofollow">https:&#x2F;&#x2F;medium.com&#x2F;criteo-engineering&#x2F;introduction-to-proper...</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>