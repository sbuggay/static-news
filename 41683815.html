<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727600469032" as="style"/><link rel="stylesheet" href="styles.css?v=1727600469032"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://wiki.alopex.li/CrystalNotes">Notes on the Crystal Language</a> <span class="domain">(<a href="https://wiki.alopex.li">wiki.alopex.li</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>29 comments</span></div><br/><div><div id="41684650" class="c"><input type="checkbox" id="c-41684650" checked=""/><div class="controls bullet"><span class="by">bhaney</span><span>|</span><a href="#41685236">next</a><span>|</span><label class="collapse" for="c-41684650">[-]</label><label class="expand" for="c-41684650">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Can you magically return&#x2F;break out of iterator functions like you can in Ruby?<p>Sure can.<p><pre><code>    $ cat break.cr
    (1..).each do |x|
      break if x &gt; 2
      puts x
    end
    
    $ crystal break.cr
    1
    2
    
    $
</code></pre>
The answer to Crystal questions that end in &quot;like you can in Ruby&quot; is usually &quot;yes.&quot; The language really is just Ruby with static typing, warts and all. Most random snippets of Ruby will run just fine when compiled as Crystal.</div><br/><div id="41685119" class="c"><input type="checkbox" id="c-41685119" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#41684650">parent</a><span>|</span><a href="#41684704">next</a><span>|</span><label class="collapse" for="c-41685119">[-]</label><label class="expand" for="c-41685119">[2 more]</label></div><br/><div class="children"><div class="content">I agree this is weird, but I think it&#x27;s largely an analogy issue: Ruby and Crystal both explicitly document blocks as <i>not</i> being closures, even when they can be converted into closures. They&#x27;re their own weird thing.<p>Crystal also documents that it will fail if the block contains return or break statements[1].<p>[1]: <a href="https:&#x2F;&#x2F;crystal-lang.org&#x2F;reference&#x2F;1.13&#x2F;syntax_and_semantics&#x2F;capturing_blocks.html#break-and-next" rel="nofollow">https:&#x2F;&#x2F;crystal-lang.org&#x2F;reference&#x2F;1.13&#x2F;syntax_and_semantics...</a></div><br/></div></div></div></div><div id="41685236" class="c"><input type="checkbox" id="c-41685236" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#41684650">prev</a><span>|</span><a href="#41684839">next</a><span>|</span><label class="collapse" for="c-41685236">[-]</label><label class="expand" for="c-41685236">[6 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the performance like?<p>The comment at the end<p><i>OO language with a static type system that feels as low-friction as a dynamic one</i><p>Sounds nice, but does the performance act like a dynamic language or is it super speedy?  I&#x27;d be happy with half the speed of C.<p>I&#x27;m still on the lookout for a language that feels as low-friction as a dynamic language but could do some form of iterable.map in parallel on all cores transparently.<p>There&#x27;s a blog post on paralellism in Crystal <a href="https:&#x2F;&#x2F;crystal-lang.org&#x2F;2019&#x2F;09&#x2F;06&#x2F;parallelism-in-crystal&#x2F;" rel="nofollow">https:&#x2F;&#x2F;crystal-lang.org&#x2F;2019&#x2F;09&#x2F;06&#x2F;parallelism-in-crystal&#x2F;</a>  but that&#x27;s a fair few years ago now.</div><br/><div id="41685471" class="c"><input type="checkbox" id="c-41685471" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#41685236">parent</a><span>|</span><a href="#41685313">next</a><span>|</span><label class="collapse" for="c-41685471">[-]</label><label class="expand" for="c-41685471">[1 more]</label></div><br/><div class="children"><div class="content">10x compared to Ruby for my use cases.</div><br/></div></div><div id="41685313" class="c"><input type="checkbox" id="c-41685313" checked=""/><div class="controls bullet"><span class="by">transfire</span><span>|</span><a href="#41685236">parent</a><span>|</span><a href="#41685471">prev</a><span>|</span><a href="#41684839">next</a><span>|</span><label class="collapse" for="c-41685313">[-]</label><label class="expand" for="c-41685313">[4 more]</label></div><br/><div class="children"><div class="content">Super speedy. It is in fact about half the speed of C. It has a GC so that’s probably the main slow down, but hey, no memory errors or raking your brain over a barrow checker.</div><br/><div id="41685462" class="c"><input type="checkbox" id="c-41685462" checked=""/><div class="controls bullet"><span class="by">anotherhue</span><span>|</span><a href="#41685236">root</a><span>|</span><a href="#41685313">parent</a><span>|</span><a href="#41684839">next</a><span>|</span><label class="collapse" for="c-41685462">[-]</label><label class="expand" for="c-41685462">[3 more]</label></div><br/><div class="children"><div class="content">The GC in particular is excessively slow. It&#x27;s not a production implementation. I don&#x27;t need JVM level GC engineering everywhere but it really is painful.<p><a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Boehm_garbage_collector" rel="nofollow">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Boehm_garbage_collector</a></div><br/><div id="41685479" class="c"><input type="checkbox" id="c-41685479" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#41685236">root</a><span>|</span><a href="#41685462">parent</a><span>|</span><a href="#41684839">next</a><span>|</span><label class="collapse" for="c-41685479">[-]</label><label class="expand" for="c-41685479">[2 more]</label></div><br/><div class="children"><div class="content">What use cases do you see that in? And do you mean throughput or latency is slow?</div><br/><div id="41685520" class="c"><input type="checkbox" id="c-41685520" checked=""/><div class="controls bullet"><span class="by">anotherhue</span><span>|</span><a href="#41685236">root</a><span>|</span><a href="#41685479">parent</a><span>|</span><a href="#41684839">next</a><span>|</span><label class="collapse" for="c-41685520">[-]</label><label class="expand" for="c-41685520">[1 more]</label></div><br/><div class="children"><div class="content">Web server with DB backend.<p>Pause times can exceed 2000ms. No doubt some code changes could help but the fact remains the GC is not an optimised one.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41684839" class="c"><input type="checkbox" id="c-41684839" checked=""/><div class="controls bullet"><span class="by">hydrolox</span><span>|</span><a href="#41685236">prev</a><span>|</span><a href="#41684800">next</a><span>|</span><label class="collapse" for="c-41684839">[-]</label><label class="expand" for="c-41684839">[5 more]</label></div><br/><div class="children"><div class="content">nothing against the language but it&#x27;s a bit suspicious that the top sponsors include &quot;buy Google reviews&quot; and &quot;buy Instagram followers&quot; (if you navigate to the actual Crystal language site)</div><br/><div id="41685263" class="c"><input type="checkbox" id="c-41685263" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#41684839">parent</a><span>|</span><a href="#41684954">next</a><span>|</span><label class="collapse" for="c-41685263">[-]</label><label class="expand" for="c-41685263">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a bit of an indictment on how poorly projects are supported.  If those sponsors feel like the eyeballs they get from supporting this project is worth it,  probably at least some of the owners of those eyeballs are getting enough value from the project to overbid.<p>Is it an artifact of the Individual&#x2F;Organisation split of OpenCollective?  I see the top 10 individuals that have put in $1000 or more.</div><br/></div></div><div id="41684954" class="c"><input type="checkbox" id="c-41684954" checked=""/><div class="controls bullet"><span class="by">bhaney</span><span>|</span><a href="#41684839">parent</a><span>|</span><a href="#41685263">prev</a><span>|</span><a href="#41684926">next</a><span>|</span><label class="collapse" for="c-41684954">[-]</label><label class="expand" for="c-41684954">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s an interesting form of guerrilla advertising. Find a project with decent website traffic that displays sponsors, and commit just enough to be displayed in the list of top contributors (which includes some delicious SEO-friendly backlinking juice too). $750&#x2F;mo and it&#x27;s already getting the companies mentioned in the currently-top comment of a thread on the front page of HN!</div><br/><div id="41685183" class="c"><input type="checkbox" id="c-41685183" checked=""/><div class="controls bullet"><span class="by">mdasen</span><span>|</span><a href="#41684839">root</a><span>|</span><a href="#41684954">parent</a><span>|</span><a href="#41684926">next</a><span>|</span><label class="collapse" for="c-41685183">[-]</label><label class="expand" for="c-41685183">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure there&#x27;s a lot of SEO-friendly back linking juice. They&#x27;re marked as rel=&quot;nofollow sponsored&quot;</div><br/></div></div></div></div><div id="41684926" class="c"><input type="checkbox" id="c-41684926" checked=""/><div class="controls bullet"><span class="by">graypegg</span><span>|</span><a href="#41684839">parent</a><span>|</span><a href="#41684954">prev</a><span>|</span><a href="#41684800">next</a><span>|</span><label class="collapse" for="c-41684926">[-]</label><label class="expand" for="c-41684926">[1 more]</label></div><br/><div class="children"><div class="content">Oh... and only for 750$ a month. The other sponsors pay more, but have to appear alongside those.</div><br/></div></div></div></div><div id="41684800" class="c"><input type="checkbox" id="c-41684800" checked=""/><div class="controls bullet"><span class="by">sedatk</span><span>|</span><a href="#41684839">prev</a><span>|</span><a href="#41685328">next</a><span>|</span><label class="collapse" for="c-41684800">[-]</label><label class="expand" for="c-41684800">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Oops, looks like its tempfile lib is written in library code in the style of mktemp(3), instead of calling the OS’s mkstemp(3) or equivalent. So it just finds a filename that doesn’t exist and then opens it separately, letting an attacker create a new file which they can read at that location between those two steps. Uh, have fun with your temporary files leading to exploitable race conditions guys.<p>Good catch. The API should be opening the tempfile atomically (the best option), or at least should use a CSPRNG for its random suffix. It doesn’t, currently.</div><br/><div id="41684848" class="c"><input type="checkbox" id="c-41684848" checked=""/><div class="controls bullet"><span class="by">bhaney</span><span>|</span><a href="#41684800">parent</a><span>|</span><a href="#41685328">next</a><span>|</span><label class="collapse" for="c-41684848">[-]</label><label class="expand" for="c-41684848">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think that complaint is even true. A quick glance at the Crystal stdlib source[1] shows that the mktmp implementation uses the O_EXCL mode, which will cause the open call to error out if the file already exists, and the implementation here will handle that and try again with a different filename.<p>I think the worst thing an attacker could do here if they could somehow predict the generated names before the file is created is DoS the mktmp call by racing ahead of it 100 times until it gives up.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;crystal-lang&#x2F;crystal&#x2F;blob&#x2F;release&#x2F;1.13&#x2F;src&#x2F;crystal&#x2F;system&#x2F;file.cr#L53">https:&#x2F;&#x2F;github.com&#x2F;crystal-lang&#x2F;crystal&#x2F;blob&#x2F;release&#x2F;1.13&#x2F;sr...</a></div><br/><div id="41684866" class="c"><input type="checkbox" id="c-41684866" checked=""/><div class="controls bullet"><span class="by">sedatk</span><span>|</span><a href="#41684800">root</a><span>|</span><a href="#41684848">parent</a><span>|</span><a href="#41685328">next</a><span>|</span><label class="collapse" for="c-41684866">[-]</label><label class="expand" for="c-41684866">[1 more]</label></div><br/><div class="children"><div class="content">Also, good catch! :)</div><br/></div></div></div></div></div></div><div id="41685328" class="c"><input type="checkbox" id="c-41685328" checked=""/><div class="controls bullet"><span class="by">steve_adams_86</span><span>|</span><a href="#41684800">prev</a><span>|</span><a href="#41684764">next</a><span>|</span><label class="collapse" for="c-41685328">[-]</label><label class="expand" for="c-41685328">[2 more]</label></div><br/><div class="children"><div class="content">I got to work on a crystal project years ago and loved it. I was exposed to a bunch of people who were really into crystal and it made me come to the completely incorrect conclusion that crystal was up and coming and I’d be able to find more work using it.<p>I was wrong. I’ve never encountered it again. It was a great language, super productive. I helped some people develop a pet insurance service. So weird. I’d work with crystal again for sure.</div><br/><div id="41685421" class="c"><input type="checkbox" id="c-41685421" checked=""/><div class="controls bullet"><span class="by">jaynetics</span><span>|</span><a href="#41685328">parent</a><span>|</span><a href="#41684764">next</a><span>|</span><label class="collapse" for="c-41685421">[-]</label><label class="expand" for="c-41685421">[1 more]</label></div><br/><div class="children"><div class="content">Did you have to work around some rough edges of the language in that job?<p>To me it feels like it never quite reached maturity, although in a better world it would have gotten more support and conquered all territory that is now ruled by the Gophers.<p>I guess to make a successful programming language, you either need corporate backing or extend an existing one nowadays, otherwise it&#x27;s really hard to build a stdlib of modern proportions.</div><br/></div></div></div></div><div id="41684764" class="c"><input type="checkbox" id="c-41684764" checked=""/><div class="controls bullet"><span class="by">nobodywasishere</span><span>|</span><a href="#41685328">prev</a><span>|</span><a href="#41684869">next</a><span>|</span><label class="collapse" for="c-41684764">[-]</label><label class="expand" for="c-41684764">[3 more]</label></div><br/><div class="children"><div class="content">As far as a REPL for Crystal goes, the interpreter is available via &quot;crystal i&quot;</div><br/><div id="41684796" class="c"><input type="checkbox" id="c-41684796" checked=""/><div class="controls bullet"><span class="by">nobodywasishere</span><span>|</span><a href="#41684764">parent</a><span>|</span><a href="#41684869">next</a><span>|</span><label class="collapse" for="c-41684796">[-]</label><label class="expand" for="c-41684796">[2 more]</label></div><br/><div class="children"><div class="content">Also for finding shards&#x2F;libraries&#x2F;documentation, I&#x27;d recommend checking out <a href="https:&#x2F;&#x2F;shards.info&#x2F;" rel="nofollow">https:&#x2F;&#x2F;shards.info&#x2F;</a>, <a href="https:&#x2F;&#x2F;shardbox.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;shardbox.org&#x2F;</a>, and <a href="https:&#x2F;&#x2F;crystaldoc.info&#x2F;" rel="nofollow">https:&#x2F;&#x2F;crystaldoc.info&#x2F;</a></div><br/><div id="41685282" class="c"><input type="checkbox" id="c-41685282" checked=""/><div class="controls bullet"><span class="by">bingo-bongo</span><span>|</span><a href="#41684764">root</a><span>|</span><a href="#41684796">parent</a><span>|</span><a href="#41684869">next</a><span>|</span><label class="collapse" for="c-41685282">[-]</label><label class="expand" for="c-41685282">[1 more]</label></div><br/><div class="children"><div class="content">The awesome crystal repo is also a good:
<a href="https:&#x2F;&#x2F;github.com&#x2F;veelenga&#x2F;awesome-crystal">https:&#x2F;&#x2F;github.com&#x2F;veelenga&#x2F;awesome-crystal</a></div><br/></div></div></div></div></div></div><div id="41684869" class="c"><input type="checkbox" id="c-41684869" checked=""/><div class="controls bullet"><span class="by">flats</span><span>|</span><a href="#41684764">prev</a><span>|</span><a href="#41684745">next</a><span>|</span><label class="collapse" for="c-41684869">[-]</label><label class="expand" for="c-41684869">[1 more]</label></div><br/><div class="children"><div class="content">I work with Ruby every day at work &amp; have always been curious about Crystal. This was a very helpful dive into some overarching concepts &amp; small details. Thanks for sharing!</div><br/></div></div><div id="41684745" class="c"><input type="checkbox" id="c-41684745" checked=""/><div class="controls bullet"><span class="by">Trasmatta</span><span>|</span><a href="#41684869">prev</a><span>|</span><a href="#41685202">next</a><span>|</span><label class="collapse" for="c-41684745">[-]</label><label class="expand" for="c-41684745">[3 more]</label></div><br/><div class="children"><div class="content">Crystal is beautiful. I wish I had a use case for it.</div><br/><div id="41685350" class="c"><input type="checkbox" id="c-41685350" checked=""/><div class="controls bullet"><span class="by">pmontra</span><span>|</span><a href="#41684745">parent</a><span>|</span><a href="#41685641">next</a><span>|</span><label class="collapse" for="c-41685350">[-]</label><label class="expand" for="c-41685350">[1 more]</label></div><br/><div class="children"><div class="content">Seconded. My use case might be running my own Ruby scripts faster, but they don&#x27;t need to run any faster so it&#x27;s not worth the trouble of setting up a development environment, especially one that requires a compilation step.<p>It would be a totally different thing if it could run Rails, which is one of the things I do in my job. The speedup would probably justify using it, especially when running tests on my laptop. My customers are perfectly happy with the performance of Rails on their servers. Same with the ones using Python with Django.</div><br/></div></div><div id="41685641" class="c"><input type="checkbox" id="c-41685641" checked=""/><div class="controls bullet"><span class="by">squarefoot</span><span>|</span><a href="#41684745">parent</a><span>|</span><a href="#41685350">prev</a><span>|</span><a href="#41685202">next</a><span>|</span><label class="collapse" for="c-41685641">[-]</label><label class="expand" for="c-41685641">[1 more]</label></div><br/><div class="children"><div class="content">I would see plenty of use cases as a Micropython substitute if at least a subset of it was ported to microcontrollers.</div><br/></div></div></div></div></div></div></div></div></div></body></html>