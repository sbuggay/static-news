<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714381266442" as="style"/><link rel="stylesheet" href="styles.css?v=1714381266442"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/carsonpo/haystackdb">Haystack DB – 10x faster than FAISS with binary embeddings by default</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>carsonpoole</span> | <span>19 comments</span></div><br/><div><div id="40194254" class="c"><input type="checkbox" id="c-40194254" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#40194525">next</a><span>|</span><label class="collapse" for="c-40194254">[-]</label><label class="expand" for="c-40194254">[8 more]</label></div><br/><div class="children"><div class="content">Is this ready to go? Would love to see a Quickstart usage example somewhere.<p>I have a task which would potentially hugely benefit from this. I have 10 million, 500-element vectors I need to find their nearest pair (could settle for an approximate match). One time job, can crank away for weeks if required. The SQLite options seem like they will not be able to handle the load, so I was going to explore the Postgres vector extensions.<p>Doing napkin math says this would require just a stupid huge number of comparisons, but there is so much buzz about vector databases, I wanted to see if the indexes had some magic which could make this feasible without having terabytes of RAM.</div><br/><div id="40194282" class="c"><input type="checkbox" id="c-40194282" checked=""/><div class="controls bullet"><span class="by">carsonpoole</span><span>|</span><a href="#40194254">parent</a><span>|</span><a href="#40194540">next</a><span>|</span><label class="collapse" for="c-40194282">[-]</label><label class="expand" for="c-40194282">[3 more]</label></div><br/><div class="children"><div class="content">It works right now, but I&#x27;m actively adding a lot of additional things that might make your life easier. The roadmap on the readme shows what I&#x27;m working on adding. Feel free to shoot me an email at carson at poole.ai and I&#x27;d be happy to give some guidance, but a quickstart is definitely at the top of my priorities also. :)</div><br/><div id="40194595" class="c"><input type="checkbox" id="c-40194595" checked=""/><div class="controls bullet"><span class="by">gcr</span><span>|</span><a href="#40194254">root</a><span>|</span><a href="#40194282">parent</a><span>|</span><a href="#40194540">next</a><span>|</span><label class="collapse" for="c-40194595">[-]</label><label class="expand" for="c-40194595">[2 more]</label></div><br/><div class="children"><div class="content">This is really cool! Thanks for writing it!</div><br/><div id="40194656" class="c"><input type="checkbox" id="c-40194656" checked=""/><div class="controls bullet"><span class="by">carsonpoole</span><span>|</span><a href="#40194254">root</a><span>|</span><a href="#40194595">parent</a><span>|</span><a href="#40194540">next</a><span>|</span><label class="collapse" for="c-40194656">[-]</label><label class="expand" for="c-40194656">[1 more]</label></div><br/><div class="children"><div class="content">thank you for the kind words!</div><br/></div></div></div></div></div></div><div id="40194540" class="c"><input type="checkbox" id="c-40194540" checked=""/><div class="controls bullet"><span class="by">gcr</span><span>|</span><a href="#40194254">parent</a><span>|</span><a href="#40194282">prev</a><span>|</span><a href="#40194494">next</a><span>|</span><label class="collapse" for="c-40194540">[-]</label><label class="expand" for="c-40194540">[2 more]</label></div><br/><div class="children"><div class="content">Do your vectors change a lot?<p>What have you tried so far? As a strong baseline, storing 10e6 512-bit vectors in memory should take about 640MiB of RAM. A binary Hamming distance between a query and a gallery is [popcnt(query xor elt) for elt in gallery], which should be plenty fast implemented in vectorized SSE instructions. I’d be shocked if this took more than 10ms per query per thread on modern hardware.</div><br/><div id="40195710" class="c"><input type="checkbox" id="c-40195710" checked=""/><div class="controls bullet"><span class="by">Loic</span><span>|</span><a href="#40194254">root</a><span>|</span><a href="#40194540">parent</a><span>|</span><a href="#40194494">next</a><span>|</span><label class="collapse" for="c-40195710">[-]</label><label class="expand" for="c-40195710">[1 more]</label></div><br/><div class="children"><div class="content">You are spot on, 10ms internal time for 100000 molecules, 60ms with the &quot;stack on top&quot;: <a href="https:&#x2F;&#x2F;www.chemeo.com&#x2F;similar?smiles=CCCCO" rel="nofollow">https:&#x2F;&#x2F;www.chemeo.com&#x2F;similar?smiles=CCCCO</a> 
It is using a manually coded, most likely not that efficient, with popcnt.</div><br/></div></div></div></div><div id="40194494" class="c"><input type="checkbox" id="c-40194494" checked=""/><div class="controls bullet"><span class="by">refibrillator</span><span>|</span><a href="#40194254">parent</a><span>|</span><a href="#40194540">prev</a><span>|</span><a href="#40194525">next</a><span>|</span><label class="collapse" for="c-40194494">[-]</label><label class="expand" for="c-40194494">[2 more]</label></div><br/><div class="children"><div class="content">You don’t need a DB, I would avoid that for a one time job (I’ve used pgvector a lot).<p>Since your data fits in memory (18 GB @ FP32), I would start with a simple python script that does naive exhaustive search, which is O(n^2).<p>You can do approximate search which will sacrifice some accuracy, but you’ll have to build an index first.<p>HNSW index is state of the art right now and will give you accurate and fast approximate vector search, O(logᵏn). But the tradeoff is it can take a significant amount of time to build the graph data structure, which may not be favorable given the one off nature of your situation.<p>I would be sure to use a vectorized (SIMD) similarity search implementation, and multithreading to split the work among all CPU cores on a beefy machine.<p>Also, this falls into the category of “embarrassingly parallel” problems - it should be straightforward to divide the work across multiple machines if really necessary, eg see Ray and the surrounding python ecosystem.</div><br/><div id="40194548" class="c"><input type="checkbox" id="c-40194548" checked=""/><div class="controls bullet"><span class="by">gcr</span><span>|</span><a href="#40194254">root</a><span>|</span><a href="#40194494">parent</a><span>|</span><a href="#40194525">next</a><span>|</span><label class="collapse" for="c-40194548">[-]</label><label class="expand" for="c-40194548">[1 more]</label></div><br/><div class="children"><div class="content">Agree in principle but why use fp32? These are binary vectors, so OP just needs a fast Hamming distance</div><br/></div></div></div></div></div></div><div id="40194525" class="c"><input type="checkbox" id="c-40194525" checked=""/><div class="controls bullet"><span class="by">J_Shelby_J</span><span>|</span><a href="#40194254">prev</a><span>|</span><a href="#40195094">next</a><span>|</span><label class="collapse" for="c-40194525">[-]</label><label class="expand" for="c-40194525">[2 more]</label></div><br/><div class="children"><div class="content">Nice!<p>Can you compare and contrast vs. the other options? For example lancedb, usearch, arroy, and oasysdb?<p>Also, is it possible to use the embedded vs running as a web server?<p>Also, just a note but haystack is an ai project by deep stack.</div><br/><div id="40194902" class="c"><input type="checkbox" id="c-40194902" checked=""/><div class="controls bullet"><span class="by">sdesol</span><span>|</span><a href="#40194525">parent</a><span>|</span><a href="#40195094">next</a><span>|</span><label class="collapse" for="c-40194902">[-]</label><label class="expand" for="c-40194902">[1 more]</label></div><br/><div class="children"><div class="content">When I saw Haystack, I thought it was a DB by deepset.</div><br/></div></div></div></div><div id="40195094" class="c"><input type="checkbox" id="c-40195094" checked=""/><div class="controls bullet"><span class="by">barefeg</span><span>|</span><a href="#40194525">prev</a><span>|</span><a href="#40194827">next</a><span>|</span><label class="collapse" for="c-40195094">[-]</label><label class="expand" for="c-40195094">[1 more]</label></div><br/><div class="children"><div class="content">I was confused for a bit but there is no relation to <a href="https:&#x2F;&#x2F;haystack.deepset.ai&#x2F;" rel="nofollow">https:&#x2F;&#x2F;haystack.deepset.ai&#x2F;</a></div><br/></div></div><div id="40194827" class="c"><input type="checkbox" id="c-40194827" checked=""/><div class="controls bullet"><span class="by">anewhnaccount2</span><span>|</span><a href="#40195094">prev</a><span>|</span><a href="#40194544">next</a><span>|</span><label class="collapse" for="c-40194827">[-]</label><label class="expand" for="c-40194827">[2 more]</label></div><br/><div class="children"><div class="content">The performance numbers do not show time performance versus accuracy perforamnce. Binary embeddings clearly have a time advantage, at the expense of accuracy. Reporting&#x2F;benchmarking in this domain requires (at least) two dimensions.</div><br/><div id="40194914" class="c"><input type="checkbox" id="c-40194914" checked=""/><div class="controls bullet"><span class="by">carsonpoole</span><span>|</span><a href="#40194827">parent</a><span>|</span><a href="#40194544">next</a><span>|</span><label class="collapse" for="c-40194914">[-]</label><label class="expand" for="c-40194914">[1 more]</label></div><br/><div class="children"><div class="content">I wholeheartedly agree :) I&#x27;ve mostly put this together this weekend, so I haven&#x27;t had time to do everything yet, but that&#x27;s definitely on the todo list.<p>I FT&#x27;d some siglip models (see here: <a href="https:&#x2F;&#x2F;huggingface.co&#x2F;carsonpoole&#x2F;binary-siglip-text" rel="nofollow">https:&#x2F;&#x2F;huggingface.co&#x2F;carsonpoole&#x2F;binary-siglip-text</a>) that should be amenable to binary quantization so I&#x27;m going to tomorrow get an inference server running with that and then hopefully do the typical MTEB benchmarks for embeddings</div><br/></div></div></div></div><div id="40194544" class="c"><input type="checkbox" id="c-40194544" checked=""/><div class="controls bullet"><span class="by">esafak</span><span>|</span><a href="#40194827">prev</a><span>|</span><a href="#40194514">next</a><span>|</span><label class="collapse" for="c-40194544">[-]</label><label class="expand" for="c-40194544">[2 more]</label></div><br/><div class="children"><div class="content">Being in such a crowded space, may I ask what your motivation was for creating a new vector store?<p>edit: I suggest creating a comparison table. It would inform potential users and help you plan your roadmap. Also talk to customers; what&#x27;s the market for petabyte-scale RAG?</div><br/><div id="40194639" class="c"><input type="checkbox" id="c-40194639" checked=""/><div class="controls bullet"><span class="by">carsonpoole</span><span>|</span><a href="#40194544">parent</a><span>|</span><a href="#40194514">next</a><span>|</span><label class="collapse" for="c-40194639">[-]</label><label class="expand" for="c-40194639">[1 more]</label></div><br/><div class="children"><div class="content">IMO at least there are a lot of things that other vector DBs are missing and should exist. I want to make this work at petabyte scale data with the features on the readme&#x27;s roadmap plus some others I have nebulous ideas about.</div><br/></div></div></div></div><div id="40194514" class="c"><input type="checkbox" id="c-40194514" checked=""/><div class="controls bullet"><span class="by">babelfish</span><span>|</span><a href="#40194544">prev</a><span>|</span><a href="#40194749">next</a><span>|</span><label class="collapse" for="c-40194514">[-]</label><label class="expand" for="c-40194514">[2 more]</label></div><br/><div class="children"><div class="content">Very impressive! Do you have similar scale tests at higher numbers? I’m curious what the numbers are at 1B&#x2F;1T vectors, and amounts larger than what can fit in memory</div><br/><div id="40194654" class="c"><input type="checkbox" id="c-40194654" checked=""/><div class="controls bullet"><span class="by">carsonpoole</span><span>|</span><a href="#40194514">parent</a><span>|</span><a href="#40194749">next</a><span>|</span><label class="collapse" for="c-40194654">[-]</label><label class="expand" for="c-40194654">[1 more]</label></div><br/><div class="children"><div class="content">not yet, but it&#x27;s roughly linear at scaling, since it&#x27;s a brute force algorithm. so with the current version it&#x27;d probably be about 22 seconds for a 1B vector search. the whole point of having metadata queries are to prevent those kind of searches from being necessary, and hopefully with some FTS interspersed it can reduce the number of similarity comparisons required even more</div><br/></div></div></div></div><div id="40194749" class="c"><input type="checkbox" id="c-40194749" checked=""/><div class="controls bullet"><span class="by">dankle</span><span>|</span><a href="#40194514">prev</a><span>|</span><label class="collapse" for="c-40194749">[-]</label><label class="expand" for="c-40194749">[1 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the performance against for example qdrant?</div><br/></div></div></div></div></div></div></div></body></html>