<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707469260071" as="style"/><link rel="stylesheet" href="styles.css?v=1707469260071"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://forum.snap.berkeley.edu/t/what-does-with-continuation-mean/1518/2">What Does &quot;With Continuation&quot; Mean?</a> <span class="domain">(<a href="https://forum.snap.berkeley.edu">forum.snap.berkeley.edu</a>)</span></div><div class="subtext"><span>d4nyll</span> | <span>22 comments</span></div><br/><div><div id="39310675" class="c"><input type="checkbox" id="c-39310675" checked=""/><div class="controls bullet"><span class="by">canjobear</span><span>|</span><a href="#39309984">next</a><span>|</span><label class="collapse" for="c-39310675">[-]</label><label class="expand" for="c-39310675">[5 more]</label></div><br/><div class="children"><div class="content">I took a Scheme programming class where we did tons of stuff with continuations. I got obsessed and wrote all kinds of weird code. I even started using continuation passing style in Python. It was a dark time. Looking back, none of that code makes any sense at all.<p>When I think back to my days of mucking around with call&#x2F;cc my main emotion is relief that I’ve forgotten how it works. It’s a load off my mind</div><br/><div id="39310896" class="c"><input type="checkbox" id="c-39310896" checked=""/><div class="controls bullet"><span class="by">neilv</span><span>|</span><a href="#39310675">parent</a><span>|</span><a href="#39311862">next</a><span>|</span><label class="collapse" for="c-39310896">[-]</label><label class="expand" for="c-39310896">[2 more]</label></div><br/><div class="children"><div class="content">In case first-class continuations scare anyone away from Scheme: you probably will never use it directly in practice, unless you&#x27;re doing something very unusual that happens to really need it.<p>For example, say you have a really hairy AI search algorithm, capturing a continuation happens to make backtracking easier.<p>Or you&#x27;re implementing another language or DSL in Scheme, and you use first-class continuations to implement some control structure semantics exactly how you want them to be.<p>I think the closest I&#x27;ve used, in writing maybe a hundred modules, is an escape procedure (like a premature `return` statement in many other languages, which you generally avoid in idiomatic Scheme).</div><br/><div id="39311056" class="c"><input type="checkbox" id="c-39311056" checked=""/><div class="controls bullet"><span class="by">jfoutz</span><span>|</span><a href="#39310675">root</a><span>|</span><a href="#39310896">parent</a><span>|</span><a href="#39311862">next</a><span>|</span><label class="collapse" for="c-39311056">[-]</label><label class="expand" for="c-39311056">[1 more]</label></div><br/><div class="children"><div class="content">I’m having trouble recalling, call cc just fixes the stack, right? If you mess with the heap, that sticks around?<p>The backtracking example is a good one. I vaguely remember needing to be careful about global state, or visible in a given context. It’s not awful, but a little tricky.</div><br/></div></div></div></div><div id="39311862" class="c"><input type="checkbox" id="c-39311862" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#39310675">parent</a><span>|</span><a href="#39310896">prev</a><span>|</span><a href="#39312493">next</a><span>|</span><label class="collapse" for="c-39311862">[-]</label><label class="expand" for="c-39311862">[1 more]</label></div><br/><div class="children"><div class="content">For me it&#x27;s the opposite: I can&#x27;t forget how it works, I don&#x27;t want to forget how it works, and I marvel at the beauty of it all.<p>When I was in school I carried one of Guy Steele&#x27;s (I think, if I remember correctly) articles about continuations in my back pocket for a year, breaking it out when I was bored, until I got it.</div><br/></div></div><div id="39312493" class="c"><input type="checkbox" id="c-39312493" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39310675">parent</a><span>|</span><a href="#39311862">prev</a><span>|</span><a href="#39309984">next</a><span>|</span><label class="collapse" for="c-39312493">[-]</label><label class="expand" for="c-39312493">[1 more]</label></div><br/><div class="children"><div class="content">Continuation passing style is mostly a good tool for writers of compilers, and perhaps interpreters.<p>It&#x27;s very, very similar to single-static-assignment (SSA) style that will be more familiar to people coming from imperative languages.</div><br/></div></div></div></div><div id="39309984" class="c"><input type="checkbox" id="c-39309984" checked=""/><div class="controls bullet"><span class="by">jedberg</span><span>|</span><a href="#39310675">prev</a><span>|</span><a href="#39311506">next</a><span>|</span><label class="collapse" for="c-39309984">[-]</label><label class="expand" for="c-39309984">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m just happy to see Professor Harvey still participating in the forums.  He taught me SICP in Scheme 27 years ago and it is still some of the most important computer science I ever learned.</div><br/><div id="39310450" class="c"><input type="checkbox" id="c-39310450" checked=""/><div class="controls bullet"><span class="by">vegashacker</span><span>|</span><a href="#39309984">parent</a><span>|</span><a href="#39311506">next</a><span>|</span><label class="collapse" for="c-39310450">[-]</label><label class="expand" for="c-39310450">[1 more]</label></div><br/><div class="children"><div class="content">Same! (CS 61A Fall Semester 1996) And I agree!</div><br/></div></div></div></div><div id="39311506" class="c"><input type="checkbox" id="c-39311506" checked=""/><div class="controls bullet"><span class="by">carterschonwald</span><span>|</span><a href="#39309984">prev</a><span>|</span><a href="#39309884">next</a><span>|</span><label class="collapse" for="c-39311506">[-]</label><label class="expand" for="c-39311506">[3 more]</label></div><br/><div class="children"><div class="content">So there’s a funny thing this doesn’t touch on: the semantics of call&#x2F;cc is genuinely confusing to understand!  There’s a related construct that’s much more legible and has a much easier to understand: call with delimited continuation!<p>Oleg K wrote a very articulate piece about this some long time ago <a href="https:&#x2F;&#x2F;okmij.org&#x2F;ftp&#x2F;continuations&#x2F;against-callcc.html" rel="nofollow">https:&#x2F;&#x2F;okmij.org&#x2F;ftp&#x2F;continuations&#x2F;against-callcc.html</a></div><br/><div id="39311962" class="c"><input type="checkbox" id="c-39311962" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#39311506">parent</a><span>|</span><a href="#39312502">next</a><span>|</span><label class="collapse" for="c-39311962">[-]</label><label class="expand" for="c-39311962">[1 more]</label></div><br/><div class="children"><div class="content">I think of `call&#x2F;cc` as a parlor trick that helps introduce the concept of continuations more generally.<p>Threads and co-routines are on the heavy-weight end of the concurrent programming techniques spectrum because they require stacks -possibly large, with guard pages and all- and encourage smearing application state onto that stack, increasing cache pressure.<p>Continuation passing style (CPS) is on the light-weight end because it encourages the programmer to make application state explicit and compact rather than smearing it on a stack.  Callback hell is hand-coded continuation passing style (CPS).  Async&#x2F;await is a compromise that gets one close to the light weight of continuations.<p>To understand all of that one has to understand the concept of continuations.  In computer science, the cheap parlor trick that is `call&#x2F;cc` is helpful in introducing the concept of continuations to students.  After all, `call&#x2F;cc` is shocking when one first sees it, and the curious will want to understand it.</div><br/></div></div><div id="39312502" class="c"><input type="checkbox" id="c-39312502" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39311506">parent</a><span>|</span><a href="#39311962">prev</a><span>|</span><a href="#39309884">next</a><span>|</span><label class="collapse" for="c-39312502">[-]</label><label class="expand" for="c-39312502">[1 more]</label></div><br/><div class="children"><div class="content">Approximately everything by Oleg is great!<p>We half-jokingly considered renaming our Sydney Computer Science Paper Club to &#x27;Oleg Fan Club&#x27;.</div><br/></div></div></div></div><div id="39309884" class="c"><input type="checkbox" id="c-39309884" checked=""/><div class="controls bullet"><span class="by">tmoertel</span><span>|</span><a href="#39311506">prev</a><span>|</span><a href="#39311066">next</a><span>|</span><label class="collapse" for="c-39309884">[-]</label><label class="expand" for="c-39309884">[2 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s Oleg&#x27;s great explanation of continuations in terms most programmers already understand: <a href="https:&#x2F;&#x2F;blog.moertel.com&#x2F;posts&#x2F;2008-05-05-olegs-great-way-of-explaining-delimited-continuations.html" rel="nofollow">https:&#x2F;&#x2F;blog.moertel.com&#x2F;posts&#x2F;2008-05-05-olegs-great-way-of...</a></div><br/><div id="39310393" class="c"><input type="checkbox" id="c-39310393" checked=""/><div class="controls bullet"><span class="by">arsdragonfly</span><span>|</span><a href="#39309884">parent</a><span>|</span><a href="#39311066">next</a><span>|</span><label class="collapse" for="c-39310393">[-]</label><label class="expand" for="c-39310393">[1 more]</label></div><br/><div class="children"><div class="content">call&#x2F;cc is undelimited.</div><br/></div></div></div></div><div id="39311066" class="c"><input type="checkbox" id="c-39311066" checked=""/><div class="controls bullet"><span class="by">neilv</span><span>|</span><a href="#39309884">prev</a><span>|</span><a href="#39310190">next</a><span>|</span><label class="collapse" for="c-39311066">[-]</label><label class="expand" for="c-39311066">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know whether it helps, but here&#x27;s another explanation that doesn&#x27;t involve a visual programming language:<p>First, imagine that procedures (or functions) are first-class values, like in some languages are called &quot;anonymous functions&quot;, &quot;closures&quot;, &quot;lambdas&quot;, etc.<p>Now imagine that every procedure call is effectively a goto with arguments... and the familiar part about being able to return from that procedure, to its calling point, is implemented by an implicit additional value created at calling time... which is a &quot;continuation&quot; <i>procedure with argument(s) that you call to return the value(s) from the other procedure</i>.<p>To make it first-class continuations, imagine that &quot;continuation&quot; procedure value you call to return the value(s) from another procedure... can be made accessible to the program as a first-class value.  Which means you can store it in a variable or data structure like any other value.  And you can call that &quot;continuation&quot; procedure value multiple times -- returning to that dynamic state of the calling context in the program many times.<p>It&#x27;s one of those things that application code almost never uses directly, but that could be super useful and simplifying in the implementation of another programming language, or carefully controlled in particular libraries (e.g., you wanted to make a stateful Web backend library or DSL that made it really easy to express the logic for some kind of interaction tree responding to multiple steps of form input).</div><br/></div></div><div id="39310190" class="c"><input type="checkbox" id="c-39310190" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#39311066">prev</a><span>|</span><a href="#39310208">next</a><span>|</span><label class="collapse" for="c-39310190">[-]</label><label class="expand" for="c-39310190">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m glad that this explanation involves a comparison with goto especially with a discussion of &quot;goto considered harmful&quot;. But IMO excessively using continuations results in the same kind of spaghetti code as code that excessively uses goto. Delimited continuations, on the other hand, essentially places a restriction on where the continuation can return to. The analogy with using goto is that the target of the goto has to be within a well specified block of code. This restriction gets rid of the temptation by programmers to take shortcuts and write overly clever but unmaintainable code.</div><br/></div></div><div id="39310208" class="c"><input type="checkbox" id="c-39310208" checked=""/><div class="controls bullet"><span class="by">joe_the_user</span><span>|</span><a href="#39310190">prev</a><span>|</span><a href="#39311844">next</a><span>|</span><label class="collapse" for="c-39310208">[-]</label><label class="expand" for="c-39310208">[4 more]</label></div><br/><div class="children"><div class="content">Required reference &quot;Objects the poor man&#x27;s Closures[continuations]&quot; [1]. Well, the links actually say &quot;Closures And Objects Are Equivalent&quot;, which is the point. But I&#x27;d offer a deeper point - continuations&#x2F;closures are rightly considered one of the hardest things most programmers ever encounter while objects are things most programmers deal with daily. Sure, that means use continuations if you want to look like a bad ass but use objects if you want a project to succeed.<p>[1]<a href="http:&#x2F;&#x2F;wiki.c2.com&#x2F;?ClosuresAndObjectsAreEquivalent" rel="nofollow">http:&#x2F;&#x2F;wiki.c2.com&#x2F;?ClosuresAndObjectsAreEquivalent</a></div><br/><div id="39311851" class="c"><input type="checkbox" id="c-39311851" checked=""/><div class="controls bullet"><span class="by">canjobear</span><span>|</span><a href="#39310208">parent</a><span>|</span><a href="#39311844">next</a><span>|</span><label class="collapse" for="c-39311851">[-]</label><label class="expand" for="c-39311851">[3 more]</label></div><br/><div class="children"><div class="content">Continuations aren&#x27;t equivalent to closures.</div><br/><div id="39311882" class="c"><input type="checkbox" id="c-39311882" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#39310208">root</a><span>|</span><a href="#39311851">parent</a><span>|</span><a href="#39311844">next</a><span>|</span><label class="collapse" for="c-39311882">[-]</label><label class="expand" for="c-39311882">[2 more]</label></div><br/><div class="children"><div class="content">Continuations are closures.  Closures aren&#x27;t continuations.  Though one can build continuations out of closures by converting code into continuation passing style, which makes continuations explicit, and then `call&#x2F;cc` is trivial, since all it does is pass (to its function argument) its [now-explicit, after CPS conversion] continuation, thus reifying it.</div><br/><div id="39312181" class="c"><input type="checkbox" id="c-39312181" checked=""/><div class="controls bullet"><span class="by">sillysaurusx</span><span>|</span><a href="#39310208">root</a><span>|</span><a href="#39311882">parent</a><span>|</span><a href="#39311844">next</a><span>|</span><label class="collapse" for="c-39312181">[-]</label><label class="expand" for="c-39312181">[1 more]</label></div><br/><div class="children"><div class="content">Ehh. I think it makes it a lot harder to understand what a continuation is if you say they’re closures.<p>Continuations capture the stack. Closures capture variables.</div><br/></div></div></div></div></div></div></div></div><div id="39311844" class="c"><input type="checkbox" id="c-39311844" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#39310208">prev</a><span>|</span><a href="#39311418">next</a><span>|</span><label class="collapse" for="c-39311844">[-]</label><label class="expand" for="c-39311844">[1 more]</label></div><br/><div class="children"><div class="content">The easiest way to think about continuations is to consider them a generalization of function returns.  The continuation of a C function f() is the return address <i>and</i> the saved frame pointer of the calling function -- and that looks a lot like a closure, and that&#x27;s because it is, except that a) you can only pass that closure one argument in C: the return value, and b) you actually can&#x27;t get a value for this closure in C, and c) there&#x27;s no closures as such in C anyways :)<p>[And what is a closure?  It&#x27;s a tuple of {function body pointer, data pointer}, and &quot;callbacks&quot; in C often look just like that, but not as a singular value combining the two parts but as two separate values.  In better languages a function is indistinguishable from a closure.]<p>Anywhere that you see `call&#x2F;cc` you can think of it as making a first-class function value (a closure) of the current location (which would be the return address of the call to `call&#x2F;cc`) and then passing that closure to the function given as an argument to `call&#x2F;cc`.  After you parse that sentence you&#x27;ll realize that&#x27;s a bit crazy: how does one make a function out of... a function&#x27;s return address (and saved frame pointer)?  The answer is: reify that {return address, saved frame pointer} as a closure.  (&#x27;Reify&#x27; means, roughly, to make a hidden thing not hidden.)<p>Still, it must seem crazy.  Yet it&#x27;s not that crazy, certainly not if you make it so you can only call it once, and only if `call&#x2F;cc` hasn&#x27;t returned yet.  What&#x27;s crazy is that in Scheme this continuation can be called repeatedly, so how?  Here&#x27;s one way to do it: replace the stack with allocating function call frames on the heap!, which in a language with a GC means that all those function call frames remain alive as long as closures (which a continuation <i>is</i>) refer to them.  (Another way to do it is with copying stacks.)<p>One can easily (for some value of &quot;easily&quot;) implement a language that has `call&#x2F;cc` in a language that doesn&#x27;t but which has a) closures, b) a powerful macro system &#x2F; AST &#x2F; homoiconicity.  All one has to do is take a program, apply continuation passing style (CPS) conversion to it (a fairly straightforward transformation where the result is unreadable for most humans), which automatically causes all function call frames to be captured in closures (thus put on the heap), but also automatically makes continuations explicit values (closures).  The `call&#x2F;cc` is a trivial function that passes its now-explicit continuation argument to the function that `call&#x2F;cc` is given to call.<p>Allocating function call frames on the heap is a performance disaster.  And that&#x27;s where delimited continuations come in: the goal being to allocate function call frames on mini stacks.<p>`call&#x2F;cc` is really a bit of a parlor trick, and a very nifty one at that, but <i>continuations</i> are a very important concept that comes up all over the place, and one that computer scientists and software engineers ought to be at least conversant with.</div><br/></div></div><div id="39311418" class="c"><input type="checkbox" id="c-39311418" checked=""/><div class="controls bullet"><span class="by">TruffleLabs</span><span>|</span><a href="#39311844">prev</a><span>|</span><a href="#39310349">next</a><span>|</span><label class="collapse" for="c-39311418">[-]</label><label class="expand" for="c-39311418">[1 more]</label></div><br/><div class="children"><div class="content">Call&#x2F;cc !</div><br/></div></div><div id="39310349" class="c"><input type="checkbox" id="c-39310349" checked=""/><div class="controls bullet"><span class="by">ChrisArchitect</span><span>|</span><a href="#39311418">prev</a><span>|</span><label class="collapse" for="c-39310349">[-]</label><label class="expand" for="c-39310349">[1 more]</label></div><br/><div class="children"><div class="content">(2020)</div><br/></div></div></div></div></div></div></div></body></html>