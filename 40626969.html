<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1718010073828" as="style"/><link rel="stylesheet" href="styles.css?v=1718010073828"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/haampie/libtree">Libtree: Ldd as a tree saying why a library is found or not</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>fanf2</span> | <span>38 comments</span></div><br/><div><div id="40631545" class="c"><input type="checkbox" id="c-40631545" checked=""/><div class="controls bullet"><span class="by">smoors</span><span>|</span><a href="#40627849">next</a><span>|</span><label class="collapse" for="c-40631545">[-]</label><label class="expand" for="c-40631545">[1 more]</label></div><br/><div class="children"><div class="content">similar tool: lddtree
<a href="https:&#x2F;&#x2F;github.com&#x2F;gentoo&#x2F;pax-utils&#x2F;tree&#x2F;master">https:&#x2F;&#x2F;github.com&#x2F;gentoo&#x2F;pax-utils&#x2F;tree&#x2F;master</a></div><br/></div></div><div id="40627849" class="c"><input type="checkbox" id="c-40627849" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#40631545">prev</a><span>|</span><a href="#40629557">next</a><span>|</span><label class="collapse" for="c-40627849">[-]</label><label class="expand" for="c-40627849">[4 more]</label></div><br/><div class="children"><div class="content">Does this copy that unexpected behavior where ldd will actually execute some libraries it&#x27;s interrogating?<p><a href="https:&#x2F;&#x2F;catonmat.net&#x2F;ldd-arbitrary-code-execution" rel="nofollow">https:&#x2F;&#x2F;catonmat.net&#x2F;ldd-arbitrary-code-execution</a></div><br/><div id="40628502" class="c"><input type="checkbox" id="c-40628502" checked=""/><div class="controls bullet"><span class="by">mid-kid</span><span>|</span><a href="#40627849">parent</a><span>|</span><a href="#40628037">next</a><span>|</span><label class="collapse" for="c-40628502">[-]</label><label class="expand" for="c-40628502">[1 more]</label></div><br/><div class="children"><div class="content">Recent (like 5+ years) versions of &quot;ldd&quot; will not invoke the target binary either.<p>See: <a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;unstable&#x2F;manpages&#x2F;ldd.1.en.html#Security" rel="nofollow">https:&#x2F;&#x2F;manpages.debian.org&#x2F;unstable&#x2F;manpages&#x2F;ldd.1.en.html#...</a></div><br/></div></div><div id="40628037" class="c"><input type="checkbox" id="c-40628037" checked=""/><div class="controls bullet"><span class="by">jcul</span><span>|</span><a href="#40627849">parent</a><span>|</span><a href="#40628502">prev</a><span>|</span><a href="#40628478">next</a><span>|</span><label class="collapse" for="c-40628037">[-]</label><label class="expand" for="c-40628037">[1 more]</label></div><br/><div class="children"><div class="content">From a quick scan of the code, on mobile, it doesn&#x27;t look like it does.<p>This seems to actually manually parse the ELF file and recursively parse any dependencies.<p>Pretty cool.</div><br/></div></div><div id="40628478" class="c"><input type="checkbox" id="c-40628478" checked=""/><div class="controls bullet"><span class="by">zem</span><span>|</span><a href="#40627849">parent</a><span>|</span><a href="#40628037">prev</a><span>|</span><a href="#40629557">next</a><span>|</span><label class="collapse" for="c-40628478">[-]</label><label class="expand" for="c-40628478">[1 more]</label></div><br/><div class="children"><div class="content">I wrote something vaguely similar for python and we could never get around that issue <a href="https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;importlab&#x2F;issues&#x2F;69">https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;importlab&#x2F;issues&#x2F;69</a></div><br/></div></div></div></div><div id="40629557" class="c"><input type="checkbox" id="c-40629557" checked=""/><div class="controls bullet"><span class="by">cozzyd</span><span>|</span><a href="#40627849">prev</a><span>|</span><a href="#40631074">next</a><span>|</span><label class="collapse" for="c-40629557">[-]</label><label class="expand" for="c-40629557">[4 more]</label></div><br/><div class="children"><div class="content">I love this joke:<p>curl -Lfs <a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;haampie&#x2F;libtree&#x2F;master&#x2F;libtree.c" rel="nofollow">https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;haampie&#x2F;libtree&#x2F;master&#x2F;lib...</a> | ${CC:-cc} -o libtree -x c - -std=c99 -D_FILE_OFFSET_BITS=64</div><br/><div id="40630237" class="c"><input type="checkbox" id="c-40630237" checked=""/><div class="controls bullet"><span class="by">slimsag</span><span>|</span><a href="#40629557">parent</a><span>|</span><a href="#40629818">next</a><span>|</span><label class="collapse" for="c-40630237">[-]</label><label class="expand" for="c-40630237">[2 more]</label></div><br/><div class="children"><div class="content">The first suggestion under the `# Install` header is to use a prebuilt binary like:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;haampie&#x2F;libtree&#x2F;releases&#x2F;download&#x2F;v3.1.1&#x2F;libtree_x86_64">https:&#x2F;&#x2F;github.com&#x2F;haampie&#x2F;libtree&#x2F;releases&#x2F;download&#x2F;v3.1.1&#x2F;...</a><p>The only verification provided is a sha256sum provided in the README, there&#x27;s no way to confirm what source code or compiler was used to produce the binary, and no way to verify the binary was produced by that github user &#x2F; that the README sha256 I was served was untampered with.<p>I would propose that the &#x27;unsafe&#x27; curl method is in fact probably safer than the recommended-first choice in the README.</div><br/><div id="40630304" class="c"><input type="checkbox" id="c-40630304" checked=""/><div class="controls bullet"><span class="by">cozzyd</span><span>|</span><a href="#40629557">root</a><span>|</span><a href="#40630237">parent</a><span>|</span><a href="#40629818">next</a><span>|</span><label class="collapse" for="c-40630304">[-]</label><label class="expand" for="c-40630304">[1 more]</label></div><br/><div class="children"><div class="content">yeah, I went with the safer method of `sudo dnf install libtree-ldd`</div><br/></div></div></div></div><div id="40629818" class="c"><input type="checkbox" id="c-40629818" checked=""/><div class="controls bullet"><span class="by">wakawaka28</span><span>|</span><a href="#40629557">parent</a><span>|</span><a href="#40630237">prev</a><span>|</span><a href="#40631074">next</a><span>|</span><label class="collapse" for="c-40629818">[-]</label><label class="expand" for="c-40629818">[1 more]</label></div><br/><div class="children"><div class="content">The joke that kills lol</div><br/></div></div></div></div><div id="40628172" class="c"><input type="checkbox" id="c-40628172" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#40631074">prev</a><span>|</span><a href="#40628624">next</a><span>|</span><label class="collapse" for="c-40628172">[-]</label><label class="expand" for="c-40628172">[3 more]</label></div><br/><div class="children"><div class="content">Basically the Linux CLI version of depends.exe.</div><br/><div id="40631235" class="c"><input type="checkbox" id="c-40631235" checked=""/><div class="controls bullet"><span class="by">PreInternet01</span><span>|</span><a href="#40628172">parent</a><span>|</span><a href="#40630804">next</a><span>|</span><label class="collapse" for="c-40631235">[-]</label><label class="expand" for="c-40631235">[1 more]</label></div><br/><div class="children"><div class="content">Note that that particular tool doesn&#x27;t work very well for modern Windows versions anymore.<p>Use <a href="https:&#x2F;&#x2F;github.com&#x2F;lucasg&#x2F;Dependencies">https:&#x2F;&#x2F;github.com&#x2F;lucasg&#x2F;Dependencies</a> instead (even though that isn&#x27;t exactly up-to-date either...)<p>If you have Visual Studio installed (and have selected the &#x27;x64&#x2F;x86 build tools (latest)&#x27; in the installer), `dumpbin &#x2F;dependents` from a VS Developer Command Prompt remains the most reliable option.</div><br/></div></div><div id="40630804" class="c"><input type="checkbox" id="c-40630804" checked=""/><div class="controls bullet"><span class="by">eps</span><span>|</span><a href="#40628172">parent</a><span>|</span><a href="#40631235">prev</a><span>|</span><a href="#40628624">next</a><span>|</span><label class="collapse" for="c-40630804">[-]</label><label class="expand" for="c-40630804">[1 more]</label></div><br/><div class="children"><div class="content">Yep, my thoughts exactly.<p>[1] <a href="https:&#x2F;&#x2F;www.dependencywalker.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.dependencywalker.com&#x2F;</a></div><br/></div></div></div></div><div id="40628624" class="c"><input type="checkbox" id="c-40628624" checked=""/><div class="controls bullet"><span class="by">dooglius</span><span>|</span><a href="#40628172">prev</a><span>|</span><a href="#40628142">next</a><span>|</span><label class="collapse" for="c-40628624">[-]</label><label class="expand" for="c-40628624">[9 more]</label></div><br/><div class="children"><div class="content">What does &quot;why a library is found or not&quot; mean? It is either in the LD_LIBRARY_PATH or it isn&#x27;t? The screenshot doesn&#x27;t make it clear to me what this refers to.</div><br/><div id="40628681" class="c"><input type="checkbox" id="c-40628681" checked=""/><div class="controls bullet"><span class="by">georgyo</span><span>|</span><a href="#40628624">parent</a><span>|</span><a href="#40629179">next</a><span>|</span><label class="collapse" for="c-40628681">[-]</label><label class="expand" for="c-40628681">[3 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know what it means in the context of this tool, but library searching is much more complicated than a single environment variable.<p>There is the system search path, runpath, rpath, and LD_LIBRARY_PATH as just a few different distinct methods library searched on directories.<p>Libraries are also usually linked just by the short name, IE foo.so, but they can also be dynamically linked to the full path of the library.<p>Side note, as a general rule if you can avoid setting the LD_LIBRARY_PATH you&#x27;ll be much off. It&#x27;s not always possible, but setting puts it at the top of the search for all executions. Even if something dynamically links the full path to a library, LD_LIBRARY_PATH will take precedence. It completely flattens the search.</div><br/><div id="40629417" class="c"><input type="checkbox" id="c-40629417" checked=""/><div class="controls bullet"><span class="by">wpollock</span><span>|</span><a href="#40628624">root</a><span>|</span><a href="#40628681">parent</a><span>|</span><a href="#40629179">next</a><span>|</span><label class="collapse" for="c-40629417">[-]</label><label class="expand" for="c-40629417">[2 more]</label></div><br/><div class="children"><div class="content">On top of that,  libraries can be linked by their SONAME and not the file name.  (This is rarely done however.)</div><br/><div id="40631352" class="c"><input type="checkbox" id="c-40631352" checked=""/><div class="controls bullet"><span class="by">cylemons</span><span>|</span><a href="#40628624">root</a><span>|</span><a href="#40629417">parent</a><span>|</span><a href="#40629179">next</a><span>|</span><label class="collapse" for="c-40631352">[-]</label><label class="expand" for="c-40631352">[1 more]</label></div><br/><div class="children"><div class="content">I thought dynamic linking always uses the soname</div><br/></div></div></div></div></div></div><div id="40629179" class="c"><input type="checkbox" id="c-40629179" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#40628624">parent</a><span>|</span><a href="#40628681">prev</a><span>|</span><a href="#40629247">next</a><span>|</span><label class="collapse" for="c-40629179">[-]</label><label class="expand" for="c-40629179">[1 more]</label></div><br/><div class="children"><div class="content">A library need not be in LD_LIBRARY_PATH in order to be found.<p>The point of the title is to say that libtree makes it easy to find the paths from an executable to all its direct and indirect dependencies, <i>one</i> of the uses of which is to help figure out what&#x27;s up with missing dependencies.<p>In reality if you&#x27;re using a packaging system then you likely won&#x27;t have missing dependencies, so you&#x27;d use libtree for other reasons.</div><br/></div></div><div id="40629247" class="c"><input type="checkbox" id="c-40629247" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#40628624">parent</a><span>|</span><a href="#40629179">prev</a><span>|</span><a href="#40629882">next</a><span>|</span><label class="collapse" for="c-40629247">[-]</label><label class="expand" for="c-40629247">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  It is either in the LD_LIBRARY_PATH or it isn&#x27;t<p>Or RPATH, which is evaluated at load time per each library. The bigger point is that dependencies form a graph (which can be displayed as a tree) and its useful to know why a library wasn&#x27;t found because of the library that required it.</div><br/></div></div><div id="40629882" class="c"><input type="checkbox" id="c-40629882" checked=""/><div class="controls bullet"><span class="by">almostgotcaught</span><span>|</span><a href="#40628624">parent</a><span>|</span><a href="#40629247">prev</a><span>|</span><a href="#40629857">next</a><span>|</span><label class="collapse" for="c-40629882">[-]</label><label class="expand" for="c-40629882">[2 more]</label></div><br/><div class="children"><div class="content">&gt; It is either in the LD_LIBRARY_PATH or it isn&#x27;t?<p>at minimum you have RPATH, RUNPATH, LD_LIBRARY_PATH.<p>this tool is based on ldd and thus also (presumably) resolves DYLD_LIBRARY_PATH, DYLD_FALLBACK_FRAMEWORK_PATH, DYLD_FALLBACK_LIBRARY_PATH, @executable_path, @loader_path and @rpath.</div><br/><div id="40630535" class="c"><input type="checkbox" id="c-40630535" checked=""/><div class="controls bullet"><span class="by">rurban</span><span>|</span><a href="#40628624">root</a><span>|</span><a href="#40629882">parent</a><span>|</span><a href="#40629857">next</a><span>|</span><label class="collapse" for="c-40630535">[-]</label><label class="expand" for="c-40630535">[1 more]</label></div><br/><div class="children"><div class="content">Nope, only elf, no macho support.</div><br/></div></div></div></div><div id="40629857" class="c"><input type="checkbox" id="c-40629857" checked=""/><div class="controls bullet"><span class="by">wakawaka28</span><span>|</span><a href="#40628624">parent</a><span>|</span><a href="#40629882">prev</a><span>|</span><a href="#40628142">next</a><span>|</span><label class="collapse" for="c-40629857">[-]</label><label class="expand" for="c-40629857">[1 more]</label></div><br/><div class="children"><div class="content">LD_LIBRARY_PATH is not the only way libraries are found. The loader considers several other sources to find libraries. Assuming a sane setup, this will be a combination of ordinary ELF fields in each binary that gets loaded and other paths known to the loader. Relying on LD_LIBRARY_PATH can be very short-sighted on systems with many versions of the same library or multiple libraries with the same name. The loader must search the paths in LD_LIBRARY_PATH for each binary in order, and it will pick the first library that matches (unless you have other higher-priority paths set by other means). That may not be the one you really want. This can lead to unexpected errors at runtime. The better way is to set RPATH for the affected binaries to the location that has the libraries that it requires.<p>It is possible to end up loading multiple versions of the same library as well, if your environment and RPATH settings are not consistent. This tool will help you figure out if you have problems and why.</div><br/></div></div></div></div><div id="40628142" class="c"><input type="checkbox" id="c-40628142" checked=""/><div class="controls bullet"><span class="by">jononor</span><span>|</span><a href="#40628624">prev</a><span>|</span><a href="#40627830">next</a><span>|</span><label class="collapse" for="c-40628142">[-]</label><label class="expand" for="c-40628142">[1 more]</label></div><br/><div class="children"><div class="content">Having to recursively and iteratively hunt missing dependencies with ldd can be pretty tedious. So this seems like a good improvement. Will try it next time I get an obscure not found</div><br/></div></div><div id="40627830" class="c"><input type="checkbox" id="c-40627830" checked=""/><div class="controls bullet"><span class="by">mgaunard</span><span>|</span><a href="#40628142">prev</a><span>|</span><a href="#40628350">next</a><span>|</span><label class="collapse" for="c-40627830">[-]</label><label class="expand" for="c-40627830">[1 more]</label></div><br/><div class="children"><div class="content">this is so useful; I usually read sections with readelf to figure out what the real requirements are</div><br/></div></div><div id="40628350" class="c"><input type="checkbox" id="c-40628350" checked=""/><div class="controls bullet"><span class="by">semmulder</span><span>|</span><a href="#40627830">prev</a><span>|</span><a href="#40630851">next</a><span>|</span><label class="collapse" for="c-40628350">[-]</label><label class="expand" for="c-40628350">[3 more]</label></div><br/><div class="children"><div class="content">Is LD_DEBUG=libs not enough?</div><br/><div id="40628563" class="c"><input type="checkbox" id="c-40628563" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#40628350">parent</a><span>|</span><a href="#40630851">next</a><span>|</span><label class="collapse" for="c-40628563">[-]</label><label class="expand" for="c-40628563">[2 more]</label></div><br/><div class="children"><div class="content">This is not a &quot;static&quot; evaluation of the library dependencies, it&#x27;s a loader debug flag.  So it&#x27;s not quite the same thing.</div><br/><div id="40631245" class="c"><input type="checkbox" id="c-40631245" checked=""/><div class="controls bullet"><span class="by">semmulder</span><span>|</span><a href="#40628350">root</a><span>|</span><a href="#40628563">parent</a><span>|</span><a href="#40630851">next</a><span>|</span><label class="collapse" for="c-40631245">[-]</label><label class="expand" for="c-40631245">[1 more]</label></div><br/><div class="children"><div class="content">True! Conversely, libtree will miss dynamically loaded dependencies though (e.g. a lot of stuff in the Python world).</div><br/></div></div></div></div></div></div><div id="40630851" class="c"><input type="checkbox" id="c-40630851" checked=""/><div class="controls bullet"><span class="by">srott</span><span>|</span><a href="#40628350">prev</a><span>|</span><a href="#40628212">next</a><span>|</span><label class="collapse" for="c-40630851">[-]</label><label class="expand" for="c-40630851">[2 more]</label></div><br/><div class="children"><div class="content">libvorbis&#x2F;ogg as a vim dependency, interesting</div><br/><div id="40631400" class="c"><input type="checkbox" id="c-40631400" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#40630851">parent</a><span>|</span><a href="#40628212">next</a><span>|</span><label class="collapse" for="c-40631400">[-]</label><label class="expand" for="c-40631400">[1 more]</label></div><br/><div class="children"><div class="content">It supports playing audio files; got added quite a few years back. :help sound-functions.</div><br/></div></div></div></div><div id="40628212" class="c"><input type="checkbox" id="c-40628212" checked=""/><div class="controls bullet"><span class="by">clumsysmurf</span><span>|</span><a href="#40630851">prev</a><span>|</span><a href="#40630249">next</a><span>|</span><label class="collapse" for="c-40628212">[-]</label><label class="expand" for="c-40628212">[2 more]</label></div><br/><div class="children"><div class="content">Anyone know of something similar for MacOS?</div><br/><div id="40629965" class="c"><input type="checkbox" id="c-40629965" checked=""/><div class="controls bullet"><span class="by">jevinskie</span><span>|</span><a href="#40628212">parent</a><span>|</span><a href="#40630249">next</a><span>|</span><label class="collapse" for="c-40629965">[-]</label><label class="expand" for="c-40629965">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;ReverseApple&#x2F;dgraph">https:&#x2F;&#x2F;github.com&#x2F;ReverseApple&#x2F;dgraph</a> but IIRC it still has some @rpath and its Apple extended family counterpart issues. PRs welcome!</div><br/></div></div></div></div><div id="40630249" class="c"><input type="checkbox" id="c-40630249" checked=""/><div class="controls bullet"><span class="by">exe34</span><span>|</span><a href="#40628212">prev</a><span>|</span><a href="#40631094">next</a><span>|</span><label class="collapse" for="c-40630249">[-]</label><label class="expand" for="c-40630249">[1 more]</label></div><br/><div class="children"><div class="content">i wrote a horrible little script to use ldd recursively on nixos to figure out what I need to include to run a closed source binary, will give this one a go if I ever try that again.</div><br/></div></div><div id="40628251" class="c"><input type="checkbox" id="c-40628251" checked=""/><div class="controls bullet"><span class="by">khoobid_shoma</span><span>|</span><a href="#40631094">prev</a><span>|</span><label class="collapse" for="c-40628251">[-]</label><label class="expand" for="c-40628251">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s great that the implementation is in C and not in less efficient but fashionable languages.</div><br/><div id="40628288" class="c"><input type="checkbox" id="c-40628288" checked=""/><div class="controls bullet"><span class="by">heinrich5991</span><span>|</span><a href="#40628251">parent</a><span>|</span><a href="#40629453">next</a><span>|</span><label class="collapse" for="c-40628288">[-]</label><label class="expand" for="c-40628288">[1 more]</label></div><br/><div class="children"><div class="content">C++, Nim, Rust, Zig would probably work as well.</div><br/></div></div><div id="40629453" class="c"><input type="checkbox" id="c-40629453" checked=""/><div class="controls bullet"><span class="by">speed_spread</span><span>|</span><a href="#40628251">parent</a><span>|</span><a href="#40628288">prev</a><span>|</span><label class="collapse" for="c-40629453">[-]</label><label class="expand" for="c-40629453">[2 more]</label></div><br/><div class="children"><div class="content">Please elaborate on how you measure a language&#x27;s &quot;efficiency&quot;. No, really.</div><br/><div id="40629934" class="c"><input type="checkbox" id="c-40629934" checked=""/><div class="controls bullet"><span class="by">pornel</span><span>|</span><a href="#40628251">root</a><span>|</span><a href="#40629453">parent</a><span>|</span><label class="collapse" for="c-40629934">[-]</label><label class="expand" for="c-40629934">[1 more]</label></div><br/><div class="children"><div class="content">Usually people compile a &quot;hello world&quot; exe, and implicitly extrapolate that size to all programs of all sizes.<p>...which is then followed by arguments about how libc&#x27;s own size should be compared to other libs that need to be linked statically and do a different amount of work.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>