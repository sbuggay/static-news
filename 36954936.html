<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1691053252956" as="style"/><link rel="stylesheet" href="styles.css?v=1691053252956"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://therealmjp.github.io/posts/shader-permutations-part1/">The Shader Permutation Problem – Part 1: How Did We Get Here? (2021)</a> <span class="domain">(<a href="https://therealmjp.github.io">therealmjp.github.io</a>)</span></div><div class="subtext"><span>davikr</span> | <span>11 comments</span></div><br/><div><div id="36981842" class="c"><input type="checkbox" id="c-36981842" checked=""/><div class="controls bullet"><span class="by">Sharlin</span><span>|</span><a href="#36981772">next</a><span>|</span><label class="collapse" for="c-36981842">[-]</label><label class="expand" for="c-36981842">[4 more]</label></div><br/><div class="children"><div class="content">Combinations, not permutations. This seems to be a somewhat common misuse of terminology – maybe because &quot;permutations&quot; sounds cooler and more mathy?</div><br/><div id="36982685" class="c"><input type="checkbox" id="c-36982685" checked=""/><div class="controls bullet"><span class="by">djmips</span><span>|</span><a href="#36981842">parent</a><span>|</span><a href="#36981772">next</a><span>|</span><label class="collapse" for="c-36982685">[-]</label><label class="expand" for="c-36982685">[3 more]</label></div><br/><div class="children"><div class="content">Yeah, that&#x27;s true. Someone at some point started using the term wrong and it stuck. Kind of like the words occlude and albedo which are also typically used incorrectly in graphics.</div><br/><div id="36982719" class="c"><input type="checkbox" id="c-36982719" checked=""/><div class="controls bullet"><span class="by">patrec</span><span>|</span><a href="#36981842">root</a><span>|</span><a href="#36982685">parent</a><span>|</span><a href="#36981772">next</a><span>|</span><label class="collapse" for="c-36982719">[-]</label><label class="expand" for="c-36982719">[2 more]</label></div><br/><div class="children"><div class="content">How are they used and how should they be used?</div><br/><div id="36983153" class="c"><input type="checkbox" id="c-36983153" checked=""/><div class="controls bullet"><span class="by">fartsucker69</span><span>|</span><a href="#36981842">root</a><span>|</span><a href="#36982719">parent</a><span>|</span><a href="#36981772">next</a><span>|</span><label class="collapse" for="c-36983153">[-]</label><label class="expand" for="c-36983153">[1 more]</label></div><br/><div class="children"><div class="content">in permutations the ordering of the individual elements is important (a different order of exactly the same elements is a different permutation), but it&#x27;s irrelevant in uber shaders. they should just say combinations (different elements are toggled on and off).</div><br/></div></div></div></div></div></div></div></div><div id="36981772" class="c"><input type="checkbox" id="c-36981772" checked=""/><div class="controls bullet"><span class="by">FrostKiwi</span><span>|</span><a href="#36981842">prev</a><span>|</span><a href="#36980611">next</a><span>|</span><label class="collapse" for="c-36981772">[-]</label><label class="expand" for="c-36981772">[4 more]</label></div><br/><div class="children"><div class="content">Great article. I struggle to understand when it is fine to create another `if(feature_enabled)` with feature_enabled being a bool uniform I pass into the shader and when to split said shader into two.<p>Even after writing a bunch of them, I still don&#x27;t have formed an intuition as to when to where that threshold lies...<p>...and going further whether it makes sense to always execute that feature and make feature_enabled a float multiplier of that effect&#x27;s intensity instead.<p>I wonder if there is a better answer than the blanket &quot;benchmark and iterate&quot;</div><br/><div id="36982634" class="c"><input type="checkbox" id="c-36982634" checked=""/><div class="controls bullet"><span class="by">djmips</span><span>|</span><a href="#36981772">parent</a><span>|</span><a href="#36981827">next</a><span>|</span><label class="collapse" for="c-36982634">[-]</label><label class="expand" for="c-36982634">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a bit target dependent but say for a particular hardware and a shader use case, having a larger shader could mean that it couldn&#x27;t have as many copies to quickly change context due to an event like a texture read. Context memory is a fixed resource and  sometimes smaller shaders means you can fit more.<p>So as the other answer states, profiling. It&#x27;s also good to have an accurate mental model of the real hardware. Of course this is made difficult unless you are doing specific console development.<p>And it&#x27;s also usually not as useful to do synthetic profiling but profile in actual use.</div><br/></div></div><div id="36981827" class="c"><input type="checkbox" id="c-36981827" checked=""/><div class="controls bullet"><span class="by">rahkiin</span><span>|</span><a href="#36981772">parent</a><span>|</span><a href="#36982634">prev</a><span>|</span><a href="#36980611">next</a><span>|</span><label class="collapse" for="c-36981827">[-]</label><label class="expand" for="c-36981827">[2 more]</label></div><br/><div class="children"><div class="content">Profiling is the only true answer.<p>If the inputs of a shader change, or the outputs: permutation is needed. And this is often: think a variant with vertex colors for wind impact on vertices. Or a variant with normal map vs without. Your uniform and vertex attributes should also be as small as possible (when aligned) for the use.<p>You never want to be sampling a zero-texture in order to have generic shader code as sampling is very expensive.<p>I hope this helps a bit, I am no expert in this field.</div><br/><div id="36982603" class="c"><input type="checkbox" id="c-36982603" checked=""/><div class="controls bullet"><span class="by">ImHereToVote</span><span>|</span><a href="#36981772">root</a><span>|</span><a href="#36981827">parent</a><span>|</span><a href="#36980611">next</a><span>|</span><label class="collapse" for="c-36982603">[-]</label><label class="expand" for="c-36982603">[1 more]</label></div><br/><div class="children"><div class="content">I fail to understand why the inlined pieces of code can&#x27;t be compiled into intermediary lines. Seems like the intermediary language is where this sort of compiler jungle should be solved.</div><br/></div></div></div></div></div></div><div id="36980611" class="c"><input type="checkbox" id="c-36980611" checked=""/><div class="controls bullet"><span class="by">ninepoints</span><span>|</span><a href="#36981772">prev</a><span>|</span><a href="#36982376">next</a><span>|</span><label class="collapse" for="c-36980611">[-]</label><label class="expand" for="c-36980611">[1 more]</label></div><br/><div class="children"><div class="content">This is an excellent series but needs a 2021 tag</div><br/></div></div></div></div></div></div></div></body></html>