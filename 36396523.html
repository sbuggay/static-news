<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687251655311" as="style"/><link rel="stylesheet" href="styles.css?v=1687251655311"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/tonusoo/koduinternet-cpe">Show HN: Debian-based home router</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>tonusoo</span> | <span>17 comments</span></div><br/><div><div id="36398515" class="c"><input type="checkbox" id="c-36398515" checked=""/><div class="controls bullet"><span class="by">Arnavion</span><span>|</span><a href="#36398942">next</a><span>|</span><label class="collapse" for="c-36398515">[-]</label><label class="expand" for="c-36398515">[4 more]</label></div><br/><div class="children"><div class="content">I also use Debian 12 for my home router (switched away from OPNsense). It&#x27;s an old PC that became redundant when I built a new one, now stripped down to just the motherboard in a benchtable. The LAN NIC is an Intel I350 card and wifi is from an AR9280-based PCIe card, so no problems with firmware etc.<p>Unlike TFA I did not try to replace my ISP-provided ONT, and I use nftables (via firewalld) instead of iptables, unbound instead of dnsmasq, and systemd-networkd instead of dhclient and radvd. I also run haproxy to terminate TLS for some exposed LAN servers, and a local OpenSUSE package repository since many of my LAN machines are OpenSUSE.<p>For the internet facing services (chrony, haproxy, unbound) I wrote systemd override files to harden them (run as non-root, temporary mounts instead of direct filesystem access, etc). I also run them in individual network namespaces.<p>I highly recommend a Linux-based router if you have the hardware to spare and want a completely customizable and secure router, never having to worry about ISP malware or lack of updates again. Of course if what you have is more embedded than a full x86 motherboard then something like OpenWRT would be better than Debian.</div><br/><div id="36400930" class="c"><input type="checkbox" id="c-36400930" checked=""/><div class="controls bullet"><span class="by">sschueller</span><span>|</span><a href="#36398515">parent</a><span>|</span><a href="#36398629">next</a><span>|</span><label class="collapse" for="c-36400930">[-]</label><label class="expand" for="c-36400930">[1 more]</label></div><br/><div class="children"><div class="content">I stuck with OPNsense when I upgraded but I virtualized everything which make everything so much easier. [1] You can just replace the router if you want or revert it if an update fails. No more digging up an USB to Serial adapter to connect to the the console on an ALIX board.<p>[1] <a href="https:&#x2F;&#x2F;sschueller.github.io&#x2F;posts&#x2F;wiring-a-home-with-fiber&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;sschueller.github.io&#x2F;posts&#x2F;wiring-a-home-with-fiber&#x2F;</a></div><br/></div></div><div id="36398629" class="c"><input type="checkbox" id="c-36398629" checked=""/><div class="controls bullet"><span class="by">thedougd</span><span>|</span><a href="#36398515">parent</a><span>|</span><a href="#36400930">prev</a><span>|</span><a href="#36399144">next</a><span>|</span><label class="collapse" for="c-36398629">[-]</label><label class="expand" for="c-36398629">[1 more]</label></div><br/><div class="children"><div class="content">I’m finding I can do pretty much everything between systemd-networkd and firewalld. The addition of policies that allow specifying ingress and egress zones was the last piece to make firewalld really useful on a router.</div><br/></div></div><div id="36399144" class="c"><input type="checkbox" id="c-36399144" checked=""/><div class="controls bullet"><span class="by">mindslight</span><span>|</span><a href="#36398515">parent</a><span>|</span><a href="#36398629">prev</a><span>|</span><a href="#36398942">next</a><span>|</span><label class="collapse" for="c-36399144">[-]</label><label class="expand" for="c-36399144">[1 more]</label></div><br/><div class="children"><div class="content">Flexibility indeed. My first router was Linux&#x2F;ipfwadm, and after many years of trying various off the shelf devices I finally came back to straight GNU&#x2F;Linux. Debian for the longest time, now NixOS, as a virtual machine on a larger host. I use nftables directly, with a template engine - the same config generates rules for two premises routers and a bunch of cloud hosts (with a fully-connected mesh of wireguard links between each pair of routers, of course)<p>The rules make extensive use of policy routing, such that every device on my network has its own view of what services it is allowed to access, and what Internet horizon it sees. Loading the rules fails safe in that forwarding is only enabled after a successful (re)load, and the rules fail safe such that if a connection doesn&#x27;t have a valid fwmark then it&#x27;s not allowed to go out any interface. This allows me to do things like have two web browsing VMs that display side by side, one coming from my physical infrastructure IP and one coming from a often-rotated data center IP.<p>The system has served me well, but is obviously quite bespoke. I&#x27;d love to factor it out some day and publish it for general consumption, but I haven&#x27;t quite figured out how to retain the flexibility while making it have broad appeal.</div><br/></div></div></div></div><div id="36398942" class="c"><input type="checkbox" id="c-36398942" checked=""/><div class="controls bullet"><span class="by">stereo</span><span>|</span><a href="#36398515">prev</a><span>|</span><a href="#36400642">next</a><span>|</span><label class="collapse" for="c-36398942">[-]</label><label class="expand" for="c-36398942">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s quite impressive reverse engineering of the ONT. What made you choose to go through all that effort instead of using the ISP&#x27;s stand-alone Huawei ONT?</div><br/></div></div><div id="36400642" class="c"><input type="checkbox" id="c-36400642" checked=""/><div class="controls bullet"><span class="by">teleforce</span><span>|</span><a href="#36398942">prev</a><span>|</span><a href="#36398530">next</a><span>|</span><label class="collapse" for="c-36400642">[-]</label><label class="expand" for="c-36400642">[1 more]</label></div><br/><div class="children"><div class="content">Very nice write up.<p>What we need is new update to this book:<p>[1]Linux Routers: A Primer for Network Administrators (2nd Ed):<p><a href="https:&#x2F;&#x2F;www.linuxjournal.com&#x2F;article&#x2F;6314" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.linuxjournal.com&#x2F;article&#x2F;6314</a></div><br/></div></div><div id="36398530" class="c"><input type="checkbox" id="c-36398530" checked=""/><div class="controls bullet"><span class="by">mongol</span><span>|</span><a href="#36400642">prev</a><span>|</span><a href="#36400483">next</a><span>|</span><label class="collapse" for="c-36398530">[-]</label><label class="expand" for="c-36398530">[2 more]</label></div><br/><div class="children"><div class="content">This text would benefit from a high-level summary what all the steps achieve together.</div><br/><div id="36398683" class="c"><input type="checkbox" id="c-36398683" checked=""/><div class="controls bullet"><span class="by">TheWoodsy</span><span>|</span><a href="#36398530">parent</a><span>|</span><a href="#36400483">next</a><span>|</span><label class="collapse" for="c-36398683">[-]</label><label class="expand" for="c-36398683">[1 more]</label></div><br/><div class="children"><div class="content">They are replacing the ISP&#x27;s FTTP CPE (Media Converter + router&#x2F;firewall in a closed source black box) with their own solution.</div><br/></div></div></div></div><div id="36400483" class="c"><input type="checkbox" id="c-36400483" checked=""/><div class="controls bullet"><span class="by">thepostman0</span><span>|</span><a href="#36398530">prev</a><span>|</span><a href="#36398196">next</a><span>|</span><label class="collapse" for="c-36400483">[-]</label><label class="expand" for="c-36400483">[2 more]</label></div><br/><div class="children"><div class="content">Nice.<p>Does anyone know of any all-in-one hardware that has ADSL, 5 switch ports and WiFi, that is Linux capable?</div><br/><div id="36400529" class="c"><input type="checkbox" id="c-36400529" checked=""/><div class="controls bullet"><span class="by">treffer</span><span>|</span><a href="#36400483">parent</a><span>|</span><a href="#36398196">next</a><span>|</span><label class="collapse" for="c-36400529">[-]</label><label class="expand" for="c-36400529">[1 more]</label></div><br/><div class="children"><div class="content">Depends on the level&#x2F;speed of the line. ALLNET had a VDSL spf modem. No good diagnostics but easy to add to any model.<p>OpenWRT supports a few lantiq systems with xDSL modems.<p>I was running both, but in the end switched to bridge mode on a dedicated modem.</div><br/></div></div></div></div><div id="36398196" class="c"><input type="checkbox" id="c-36398196" checked=""/><div class="controls bullet"><span class="by">rubatuga</span><span>|</span><a href="#36400483">prev</a><span>|</span><a href="#36400761">next</a><span>|</span><label class="collapse" for="c-36398196">[-]</label><label class="expand" for="c-36398196">[4 more]</label></div><br/><div class="children"><div class="content">Not sure how wise it is to use Huawei networking gear when it&#x27;s been banned in some countries for security reasons. Also, setting up wifi access points through Debian can be a bit tedious. I simply recommend OpenWRT when it comes to router software, especially since it comes with firmware and patches for wifi, (such as 5ghz transmit support on atheros) and also provides simple configuration for things like 802.11s mesh networking, and multiple concurrent SSIDs.</div><br/><div id="36398243" class="c"><input type="checkbox" id="c-36398243" checked=""/><div class="controls bullet"><span class="by">mindslight</span><span>|</span><a href="#36398196">parent</a><span>|</span><a href="#36400761">next</a><span>|</span><label class="collapse" for="c-36398243">[-]</label><label class="expand" for="c-36398243">[3 more]</label></div><br/><div class="children"><div class="content">Perhaps you could elaborate on a specific threat model rather than just handwaving about Huawei? As far as I can tell, the two significant threats of Huawei infrastructure are:<p>1. Massive DoS at a strategic moment, which is more relevant at country-scale with everyone losing communication simultaneously, rather than a few rare people having personal problems with their infrastructure.<p>2. Eavesdropping and backhauling the network traffic somehow. This mainly applies to corporations and governments wanting to keep using outdated plain text or even unauthenticated protocols. Individuals should be encrypting everything regardless of who makes the network gear. Especially as most countries lack privacy legislation or functional constraints on government, meaning that the WAN gear is an attacker regardless of who made it.<p>As far as wifi access points, I never had a problem with Debian or now NixOS. OpenWRT is a bunch of clicking and bespoke management, which is exactly what I don&#x27;t want.</div><br/><div id="36399186" class="c"><input type="checkbox" id="c-36399186" checked=""/><div class="controls bullet"><span class="by">waste_monk</span><span>|</span><a href="#36398196">root</a><span>|</span><a href="#36398243">parent</a><span>|</span><a href="#36400761">next</a><span>|</span><label class="collapse" for="c-36399186">[-]</label><label class="expand" for="c-36399186">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;d be more worried about a more permanent DoS with some kind of remote kill-switch. Maybe something that sets an e-fuse and permanently bricks a device.<p>It would not be a big deal for one individual user to have their ONT &#x2F; router &#x2F; etc. killed, but if you had a million devices bricked at approximately the same time it would be extremely disruptive. With work-from-home being so prevalent these days, having a million households suddenly knocked off the internet could be disastrous to the economy. Let alone if something like this happened to an ISP or telco&#x27;s backbone equipment.<p>Nothing that could not be worked around eventually, given time and replacement equipment, but then consider the case where the kill-switch is activated during a trade embargo and you can&#x27;t source replacement equipment for weeks&#x2F;months... not fun. Let alone the case where a kill-switch is activated as a disruption immediately prior to a military conflict (even if your military and government comms are 100% unaffected, there would be utter chaos on the civilian side as people assumed their friends have been bombed because they can&#x27;t get in contact, remote work being crippled, etc. that would take days or weeks to calm down).<p>Completely legit IMHO to not want Huawei deployed at scale or as part of infrastructure in your country, or any equipment with similar concerns, and I am glad it is banned in my country. It sounds paranoid, but keep in mind the Chinese government must agree as well - they are trying to replace their dependence on foreign tech by replacing it with local equivalents [1], such as replacing Intel gear with China&#x27;s domestically manufactured Zhaoxin processors.<p>[1] <a href="https:&#x2F;&#x2F;medium.com&#x2F;technicity&#x2F;chinese-3-5-2-policy-is-a-major-move-towards-tech-independence-48d178157b3f" rel="nofollow noreferrer">https:&#x2F;&#x2F;medium.com&#x2F;technicity&#x2F;chinese-3-5-2-policy-is-a-majo...</a></div><br/><div id="36399604" class="c"><input type="checkbox" id="c-36399604" checked=""/><div class="controls bullet"><span class="by">mindslight</span><span>|</span><a href="#36398196">root</a><span>|</span><a href="#36399186">parent</a><span>|</span><a href="#36400761">next</a><span>|</span><label class="collapse" for="c-36399604">[-]</label><label class="expand" for="c-36399604">[1 more]</label></div><br/><div class="children"><div class="content">I wasn&#x27;t downplaying the problem with widespread infrastructure being Huawei? The scenario you&#x27;re describing is exactly what I was alluding to in my #1.<p>Rather the comment I responded to seemed to just be uncritically beating the dead horse of &quot;Huawei bad&quot;, when it&#x27;s not really a big deal in the <i>individual use</i> context. And in fact rereading the original post, the original ISP-supplied gear was Huawei as well! Which I <i>do</i> agree that <i>widespread</i> usage of <i>is</i> a problem. But the author&#x27;s replacing of a Huawei standlone ONT with a Huawei SFP ONT doesn&#x27;t affect much there!<p>And sure maybe it could have been great opportunity to harden up the author&#x27;s infrastructure so that they could still have comms even if everyone else&#x27;s went dark. Except that the OLT (other end of the link) is likely Huawei as well since ONTs aren&#x27;t chosen in a vacuum.</div><br/></div></div></div></div></div></div></div></div><div id="36400761" class="c"><input type="checkbox" id="c-36400761" checked=""/><div class="controls bullet"><span class="by">redeeman</span><span>|</span><a href="#36398196">prev</a><span>|</span><a href="#36398944">next</a><span>|</span><label class="collapse" for="c-36400761">[-]</label><label class="expand" for="c-36400761">[1 more]</label></div><br/><div class="children"><div class="content">nice tower, i wish chieftec still made them</div><br/></div></div><div id="36398944" class="c"><input type="checkbox" id="c-36398944" checked=""/><div class="controls bullet"><span class="by">tetris11</span><span>|</span><a href="#36400761">prev</a><span>|</span><label class="collapse" for="c-36398944">[-]</label><label class="expand" for="c-36398944">[1 more]</label></div><br/><div class="children"><div class="content">Looks good. What&#x27;s stopping such a machine being modem capable too?</div><br/></div></div></div></div></div></div></div></body></html>