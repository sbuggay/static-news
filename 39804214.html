<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1711270853153" as="style"/><link rel="stylesheet" href="styles.css?v=1711270853153"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.brendangregg.com/blog/2024-03-24/linux-crisis-tools.html">Linux Crisis Tools</a> <span class="domain">(<a href="https://www.brendangregg.com">www.brendangregg.com</a>)</span></div><div class="subtext"><span>samber</span> | <span>72 comments</span></div><br/><div><div id="39804516" class="c"><input type="checkbox" id="c-39804516" checked=""/><div class="controls bullet"><span class="by">FridgeSeal</span><span>|</span><a href="#39805107">next</a><span>|</span><label class="collapse" for="c-39804516">[-]</label><label class="expand" for="c-39804516">[23 more]</label></div><br/><div class="children"><div class="content">This is a handy list.<p>&gt; 4:07pm The package install has failed as it can&#x27;t resolve the repositories. Something is wrong with the &#x2F;etc&#x2F;apt configuration…<p>Cloud definitely has downsides, and isn’t a fit for all scenarios but in my experience it’s great for situations like this. Instead of messing around trying to repair it, simply kill the machine, or take it out of the pool. Get a new one. New machine and app likely comes up clean. Incident resolves. Dig into machine off the hot path.</div><br/><div id="39805044" class="c"><input type="checkbox" id="c-39805044" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39804516">parent</a><span>|</span><a href="#39804552">next</a><span>|</span><label class="collapse" for="c-39805044">[-]</label><label class="expand" for="c-39805044">[13 more]</label></div><br/><div class="children"><div class="content"><i>Dig into machine off the hot path.</i><p>Unfortunately, no one has the time to do that (or let someone do it) after the problem is &quot;solved&quot;, so over time the &quot;rebuild from scratch&quot; approach just results in a loss of actual troubleshooting skills and acquired knowledge --- the software equivalent of a &quot;parts swapper&quot; in the physical world.</div><br/><div id="39805710" class="c"><input type="checkbox" id="c-39805710" checked=""/><div class="controls bullet"><span class="by">Fatnino</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805044">parent</a><span>|</span><a href="#39805324">next</a><span>|</span><label class="collapse" for="c-39805710">[-]</label><label class="expand" for="c-39805710">[1 more]</label></div><br/><div class="children"><div class="content">I was at a place where we had &quot;worker&quot; machines that would handle incoming data with fluctuating volume. If the queues got too long we would automatically spin up new worker instances and when it came time to spin down we would kill the older ones first.<p>You can probably see where this is going. The workers had some problem where they would bog down if left running too long. Causing the queues to back up and indirectly causing themselves to eventually be culled.<p>Never did figure out why they would bog down. We just ran herky jerky like this for a few years till I left. Might still be doing it for all I know.</div><br/></div></div><div id="39805324" class="c"><input type="checkbox" id="c-39805324" checked=""/><div class="controls bullet"><span class="by">Salgat</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805044">parent</a><span>|</span><a href="#39805710">prev</a><span>|</span><a href="#39805227">next</a><span>|</span><label class="collapse" for="c-39805324">[-]</label><label class="expand" for="c-39805324">[3 more]</label></div><br/><div class="children"><div class="content">If it&#x27;s happening so rarely that killing is a viable solution, then there&#x27;s no reason to troubleshoot it to begin with. If it&#x27;s happening often enough to warrant troubleshooting, then your concerns are addressed.</div><br/><div id="39805368" class="c"><input type="checkbox" id="c-39805368" checked=""/><div class="controls bullet"><span class="by">whirlwin</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805324">parent</a><span>|</span><a href="#39805227">next</a><span>|</span><label class="collapse" for="c-39805368">[-]</label><label class="expand" for="c-39805368">[2 more]</label></div><br/><div class="children"><div class="content">That might work in some scenarios. If you&#x27;re a &quot;newer&quot; company where each application is deployed onto individual nodes, you can do this.<p>But consider that the case for older companies, where it was more common to deploy several systems, often complex ones, onto the same node. You will also cause outages to system x, y and z too. Maybe some of them are inter-dependent? You have to outwhey the consequences and risks carefully in any situation before rebooting.</div><br/><div id="39805518" class="c"><input type="checkbox" id="c-39805518" checked=""/><div class="controls bullet"><span class="by">bschne</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805368">parent</a><span>|</span><a href="#39805227">next</a><span>|</span><label class="collapse" for="c-39805518">[-]</label><label class="expand" for="c-39805518">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Cloud definitely has downsides, and isn’t a fit for all scenarios but in my experience it’s great for situations like this.<p>At least as I read it, this contains the assumption that that‘s not how you deploy your applications</div><br/></div></div></div></div></div></div><div id="39805227" class="c"><input type="checkbox" id="c-39805227" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805044">parent</a><span>|</span><a href="#39805324">prev</a><span>|</span><a href="#39805125">next</a><span>|</span><label class="collapse" for="c-39805227">[-]</label><label class="expand" for="c-39805227">[2 more]</label></div><br/><div class="children"><div class="content">Y&#x27;all don&#x27;t do post-mortem investigations &#x2F; action items?<p>I get the desire to troubleshoot but priority 0 is make the system functional for users again, literally everything else can wait. I once had to deal with an outage that required we kill all our app servers every 20 minutes (staggered of course) because of a memory leak while it was being investigated.</div><br/><div id="39805331" class="c"><input type="checkbox" id="c-39805331" checked=""/><div class="controls bullet"><span class="by">Salgat</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805227">parent</a><span>|</span><a href="#39805125">next</a><span>|</span><label class="collapse" for="c-39805331">[-]</label><label class="expand" for="c-39805331">[1 more]</label></div><br/><div class="children"><div class="content">Usually depends on the impact. If it&#x27;s one of many instances behind a load balancer and was easily fixed with no obvious causes, then we move on. If it happens again, we have a known short-term fix and now we have a justified reason to devote man-hours to investigating and doing a post-mortem.</div><br/></div></div></div></div><div id="39805125" class="c"><input type="checkbox" id="c-39805125" checked=""/><div class="controls bullet"><span class="by">patrick451</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805044">parent</a><span>|</span><a href="#39805227">prev</a><span>|</span><a href="#39804552">next</a><span>|</span><label class="collapse" for="c-39805125">[-]</label><label class="expand" for="c-39805125">[6 more]</label></div><br/><div class="children"><div class="content">The end state of a culture that embraces restart&#x2F;reboot&#x2F;clear-cache instead of real diagnoses and troubleshooting is a cohort of junior devs who just delete their git repo and reclone instead of figuring out what a detached HEAD is.<p>I don&#x27;t really fault the junior dev who does that. They are just following the &quot;I don&#x27;t understand something, so just start over&quot; paradigm set by seniors.</div><br/><div id="39805217" class="c"><input type="checkbox" id="c-39805217" checked=""/><div class="controls bullet"><span class="by">zettabomb</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805125">parent</a><span>|</span><a href="#39805203">next</a><span>|</span><label class="collapse" for="c-39805217">[-]</label><label class="expand" for="c-39805217">[2 more]</label></div><br/><div class="children"><div class="content">Honestly, there&#x27;s a certain cost-benefit analysis here. In both instances (rebooting and recloning), it&#x27;s a pretty fast action with high chances of success. How much longer does it take to find the real, permanent solution? For that matter, how long does it take to even dig into the problem and familiarize yourself with its background? For a business, sometimes it&#x27;s just more cost effective to accept that you don&#x27;t really know what the problem is and won&#x27;t figure it out in less time than it takes to cop-out. Personally, I&#x27;m all in favor of actually figuring out the issue too, I just don&#x27;t believe it to be appropriate in every situation.</div><br/><div id="39805287" class="c"><input type="checkbox" id="c-39805287" checked=""/><div class="controls bullet"><span class="by">patrick451</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805217">parent</a><span>|</span><a href="#39805203">next</a><span>|</span><label class="collapse" for="c-39805287">[-]</label><label class="expand" for="c-39805287">[1 more]</label></div><br/><div class="children"><div class="content">There is a short term calculus and long term calculus. Restarting usually wins in the short term calculus. But if you double down on that strategy too much, your engineering team, and culture writ large, will lilt increasingly towards a technological mysticism.</div><br/></div></div></div></div><div id="39805203" class="c"><input type="checkbox" id="c-39805203" checked=""/><div class="controls bullet"><span class="by">yosefk</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805125">parent</a><span>|</span><a href="#39805217">prev</a><span>|</span><a href="#39804552">next</a><span>|</span><label class="collapse" for="c-39805203">[-]</label><label class="expand" for="c-39805203">[3 more]</label></div><br/><div class="children"><div class="content">To be fair, with git, specifically, it&#x27;s a good idea to at least clone for backup before things like major merges. There are lots of horror stories from people losing work to git workflow issues and I&#x27;d rather be ridiculed as an idiot who is afraid of &quot;his tools&quot; (as if I have anything like a choice when using git) and won&#x27;t learn them properly than lose work thanks to a belief that this thing behaves in a way which can actually be learned and followed safely.<p>A special case of this is git rebase after which you &quot;can&quot; access the original history in some obscure way until it&#x27;s garbage-collected; or you could clone the repo before the merge and then you can access the original history straightforwardly and you decide when to garbage-collect it by deleting that repo.</div><br/><div id="39805344" class="c"><input type="checkbox" id="c-39805344" checked=""/><div class="controls bullet"><span class="by">theptip</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805203">parent</a><span>|</span><a href="#39805838">next</a><span>|</span><label class="collapse" for="c-39805344">[-]</label><label class="expand" for="c-39805344">[1 more]</label></div><br/><div class="children"><div class="content">Git is a lot less scary when you understand the reflog; commit or stash your local changes and then you can rebase without fear of losing anything. (As a bonus tip, place “mybranch.bak” branches as pointers to your pre-rebase commit sha to avoid having to dig around in the reflog at all.)<p>I would never ridicule anyone for your approach, just gently encourage them to spend a few mins to grok the ‘git reflog’ command.</div><br/></div></div></div></div></div></div></div></div><div id="39804552" class="c"><input type="checkbox" id="c-39804552" checked=""/><div class="controls bullet"><span class="by">throw5323446</span><span>|</span><a href="#39804516">parent</a><span>|</span><a href="#39805044">prev</a><span>|</span><a href="#39804730">next</a><span>|</span><label class="collapse" for="c-39804552">[-]</label><label class="expand" for="c-39804552">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Instead of messing around trying to repair it, simply kill the machine, or take it out of the pool. Get a new one.<p>&quot;4:10pm the new machine still has the same performance issue&quot;</div><br/><div id="39804620" class="c"><input type="checkbox" id="c-39804620" checked=""/><div class="controls bullet"><span class="by">FridgeSeal</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39804552">parent</a><span>|</span><a href="#39804744">next</a><span>|</span><label class="collapse" for="c-39804620">[-]</label><label class="expand" for="c-39804620">[2 more]</label></div><br/><div class="children"><div class="content">Sure, but more often than not - esp in cloud scenarios, sometimes you just get a machine that is having a bad day and it’s quicker to just eject it, let the rest of the infra pick up the slack, and then debug from there. Additionally if you’ve axed a machine, and got the same issue, you know it’s not a machine issue, so either go look at your networking layer or whatever configs you’re using to boot your machines from…</div><br/><div id="39805816" class="c"><input type="checkbox" id="c-39805816" checked=""/><div class="controls bullet"><span class="by">tjoff</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39804620">parent</a><span>|</span><a href="#39804744">next</a><span>|</span><label class="collapse" for="c-39805816">[-]</label><label class="expand" for="c-39805816">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>esp in cloud scenarios</i><p>... so the nice thing about the about the cloud is that you can workaround cloud-specific issues?</div><br/></div></div></div></div><div id="39804744" class="c"><input type="checkbox" id="c-39804744" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39804552">parent</a><span>|</span><a href="#39804620">prev</a><span>|</span><a href="#39805066">next</a><span>|</span><label class="collapse" for="c-39804744">[-]</label><label class="expand" for="c-39804744">[2 more]</label></div><br/><div class="children"><div class="content">4:20pm Turns out it was DNS</div><br/><div id="39805154" class="c"><input type="checkbox" id="c-39805154" checked=""/><div class="controls bullet"><span class="by">Propelloni</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39804744">parent</a><span>|</span><a href="#39805066">next</a><span>|</span><label class="collapse" for="c-39805154">[-]</label><label class="expand" for="c-39805154">[1 more]</label></div><br/><div class="children"><div class="content">That made me laugh. Thank you. Of course, it is not DNS. DNS has become the new cabling. DNS is not especially complicated, but cabling is neither. Yet, during dot.com and subsequent years the cabling was causing a lot of the problems so that we get used to first check the cabling. But it only took a few more years to realize that it is not always cabling, actually failures are normally distributed.<p>Is it wrong to check DNS first? No, but please realize that DNS misconfiguration is not more common than other SNAFUS.</div><br/></div></div></div></div><div id="39805066" class="c"><input type="checkbox" id="c-39805066" checked=""/><div class="controls bullet"><span class="by">SerCe</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39804552">parent</a><span>|</span><a href="#39804744">prev</a><span>|</span><a href="#39804730">next</a><span>|</span><label class="collapse" for="c-39805066">[-]</label><label class="expand" for="c-39805066">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s actually amazing, a reproducible problem is a 90% solved problem!</div><br/></div></div></div></div><div id="39804730" class="c"><input type="checkbox" id="c-39804730" checked=""/><div class="controls bullet"><span class="by">Jedd</span><span>|</span><a href="#39804516">parent</a><span>|</span><a href="#39804552">prev</a><span>|</span><a href="#39805427">next</a><span>|</span><label class="collapse" for="c-39804730">[-]</label><label class="expand" for="c-39804730">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re describing one of the benefits of virtualised cattle, not necessarily or exclusively &#x27;cloud&#x27;.</div><br/></div></div><div id="39805427" class="c"><input type="checkbox" id="c-39805427" checked=""/><div class="controls bullet"><span class="by">KingOfCoders</span><span>|</span><a href="#39804516">parent</a><span>|</span><a href="#39804730">prev</a><span>|</span><a href="#39805107">next</a><span>|</span><label class="collapse" for="c-39805427">[-]</label><label class="expand" for="c-39805427">[2 more]</label></div><br/><div class="children"><div class="content">Kill the machine might destroy evidence. It might be the case you have everything logged outside, but most often there is something missing.</div><br/><div id="39805488" class="c"><input type="checkbox" id="c-39805488" checked=""/><div class="controls bullet"><span class="by">monkpit</span><span>|</span><a href="#39804516">root</a><span>|</span><a href="#39805427">parent</a><span>|</span><a href="#39805107">next</a><span>|</span><label class="collapse" for="c-39805488">[-]</label><label class="expand" for="c-39805488">[1 more]</label></div><br/><div class="children"><div class="content">Take it out of the pool then.</div><br/></div></div></div></div></div></div><div id="39805107" class="c"><input type="checkbox" id="c-39805107" checked=""/><div class="controls bullet"><span class="by">devsda</span><span>|</span><a href="#39804516">prev</a><span>|</span><a href="#39805288">next</a><span>|</span><label class="collapse" for="c-39805107">[-]</label><label class="expand" for="c-39805107">[2 more]</label></div><br/><div class="children"><div class="content">Not all servers are containerized, but a significant number are and they present their own challenges.<p>Unfortunately, many such tools in docker images will be flagged by automated security scanning tools in the &quot;unnecessary tools that can aid an attacker in observing and modifying system behavior&quot; category. Some of those ( like having gdb) are valid concerns but many are not.<p>To avoid that we have some of these tools in a separate volume as (preferably) static binaries or compile &amp; install them with the mount path as the install prefix (for config files &amp; libs). If there&#x27;s need to debug, we ask operations to mount the volume temporarily as read-only.<p>Another challenge is if there&#x27;s a debug tool that requires enabling a certain kernel feature, there are often questions&#x2F;concerns about how that affects other containers running on the same host.</div><br/><div id="39805671" class="c"><input type="checkbox" id="c-39805671" checked=""/><div class="controls bullet"><span class="by">Too</span><span>|</span><a href="#39805107">parent</a><span>|</span><a href="#39805288">next</a><span>|</span><label class="collapse" for="c-39805671">[-]</label><label class="expand" for="c-39805671">[1 more]</label></div><br/><div class="children"><div class="content">A better way is to build a second image including the debug tools and a root-user, then start it with the prod-containers pid-namespace and network-namespace mounted.<p>Starting a second container is usually a good idea anyway, since you need to add a lot of extra flags like SYS_PTRACE capability, user 0 and --privileged for debuggers to work.<p>This way you don&#x27;t need to restart the prod-container either, potentially loosing reproduction-evidence.<p>Remembering how to do all this in an emergency may not be entirely obvious. Make sure to try it first and write down the steps in your run books.</div><br/></div></div></div></div><div id="39805288" class="c"><input type="checkbox" id="c-39805288" checked=""/><div class="controls bullet"><span class="by">sargun</span><span>|</span><a href="#39805107">prev</a><span>|</span><a href="#39804587">next</a><span>|</span><label class="collapse" for="c-39805288">[-]</label><label class="expand" for="c-39805288">[1 more]</label></div><br/><div class="children"><div class="content">When I was at Netflix, Brendan and his team made sure that we had a fair set of debugging tools installed everywhere (bpftrace, bcc, working perf)<p>These were a lifesaver multiple times.</div><br/></div></div><div id="39804587" class="c"><input type="checkbox" id="c-39804587" checked=""/><div class="controls bullet"><span class="by">mmh0000</span><span>|</span><a href="#39805288">prev</a><span>|</span><a href="#39805679">next</a><span>|</span><label class="collapse" for="c-39804587">[-]</label><label class="expand" for="c-39804587">[7 more]</label></div><br/><div class="children"><div class="content">I was surprised that `strace` wasn&#x27;t on that list. That&#x27;s usually one of my first go-to tools. It&#x27;s so great, especially when programs return useless or wrong error messages.</div><br/><div id="39804608" class="c"><input type="checkbox" id="c-39804608" checked=""/><div class="controls bullet"><span class="by">brendangregg</span><span>|</span><a href="#39804587">parent</a><span>|</span><a href="#39805749">next</a><span>|</span><label class="collapse" for="c-39804608">[-]</label><label class="expand" for="c-39804608">[4 more]</label></div><br/><div class="children"><div class="content">strace is ok as a last resort, but &quot;perf trace&quot; and bpf tracing tools are the production-safe alternative. <a href="https:&#x2F;&#x2F;www.brendangregg.com&#x2F;blog&#x2F;2014-05-11&#x2F;strace-wow-much-syscall.html" rel="nofollow">https:&#x2F;&#x2F;www.brendangregg.com&#x2F;blog&#x2F;2014-05-11&#x2F;strace-wow-much...</a></div><br/><div id="39804688" class="c"><input type="checkbox" id="c-39804688" checked=""/><div class="controls bullet"><span class="by">slacka</span><span>|</span><a href="#39804587">root</a><span>|</span><a href="#39804608">parent</a><span>|</span><a href="#39805059">next</a><span>|</span><label class="collapse" for="c-39804688">[-]</label><label class="expand" for="c-39804688">[2 more]</label></div><br/><div class="children"><div class="content">Why don&#x27;t recommend <i>atop</i>? When a system is unresponsive, I want a I want a high-level tool that immediately shows which subsystem is under heavy load. It should show CPU, Memory, Disk, and Network usage. The other tools you listed are great, once you know what the cause is.</div><br/><div id="39804783" class="c"><input type="checkbox" id="c-39804783" checked=""/><div class="controls bullet"><span class="by">brendangregg</span><span>|</span><a href="#39804587">root</a><span>|</span><a href="#39804688">parent</a><span>|</span><a href="#39805059">next</a><span>|</span><label class="collapse" for="c-39804783">[-]</label><label class="expand" for="c-39804783">[1 more]</label></div><br/><div class="children"><div class="content">My preference is tools that give a rolling output as it let you capture the time-based pattern and share it with others, including in JIRA tickets and SRE chatrooms, whereas top&#x27;s generally clear the screen. atop by default also sets up logging and runs a couple of daemons in systemd, so it&#x27;s more than just a handy tool when needed, it&#x27;s now adding itself to the operating table. (I think I did at least one blog post about performance monitoring agents causing performance issues.) Just something to consider.<p>I&#x27;ve recommended atop in the past for catching short-lived processes because it uses process accounting, although the newer bpf tools provide more detail.</div><br/></div></div></div></div></div></div><div id="39805749" class="c"><input type="checkbox" id="c-39805749" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#39804587">parent</a><span>|</span><a href="#39804608">prev</a><span>|</span><a href="#39805679">next</a><span>|</span><label class="collapse" for="c-39805749">[-]</label><label class="expand" for="c-39805749">[2 more]</label></div><br/><div class="children"><div class="content">fuser and lsof are useful too.<p><a href="https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;fuser.1.html" rel="nofollow">https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man1&#x2F;fuser.1.html</a><p><a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Lsof" rel="nofollow">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Lsof</a></div><br/><div id="39805817" class="c"><input type="checkbox" id="c-39805817" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#39804587">root</a><span>|</span><a href="#39805749">parent</a><span>|</span><a href="#39805679">next</a><span>|</span><label class="collapse" for="c-39805817">[-]</label><label class="expand" for="c-39805817">[1 more]</label></div><br/><div class="children"><div class="content">And I wonder if anyone still uses sar and family.<p>I didn&#x27;t, but a boss or two of mine did.</div><br/></div></div></div></div></div></div><div id="39805679" class="c"><input type="checkbox" id="c-39805679" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#39804587">prev</a><span>|</span><a href="#39805739">next</a><span>|</span><label class="collapse" for="c-39805679">[-]</label><label class="expand" for="c-39805679">[1 more]</label></div><br/><div class="children"><div class="content">The list is great, but only for classical server workloads.<p>Usually not even a shell is available in modern Kubernetes deployments that take a security first approach, with chiseled containers.<p>And by creating a debugging image, not only is the execution environment being changed, deploying it might require disabling security policies doing image scans.</div><br/></div></div><div id="39805739" class="c"><input type="checkbox" id="c-39805739" checked=""/><div class="controls bullet"><span class="by">kureikain</span><span>|</span><a href="#39805679">prev</a><span>|</span><a href="#39804999">next</a><span>|</span><label class="collapse" for="c-39805739">[-]</label><label class="expand" for="c-39805739">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t see nmap, netstat, and nc being mention. They had saved me so many time as well.</div><br/></div></div><div id="39804999" class="c"><input type="checkbox" id="c-39804999" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#39805739">prev</a><span>|</span><a href="#39804568">next</a><span>|</span><label class="collapse" for="c-39804999">[-]</label><label class="expand" for="c-39804999">[5 more]</label></div><br/><div class="children"><div class="content">The only thing I would add is nmap.<p>Network connectivity issues aren&#x27;t always apparent in some apps.</div><br/><div id="39805413" class="c"><input type="checkbox" id="c-39805413" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#39804999">parent</a><span>|</span><a href="#39804568">next</a><span>|</span><label class="collapse" for="c-39805413">[-]</label><label class="expand" for="c-39805413">[4 more]</label></div><br/><div class="children"><div class="content">screen&#x2F;tmux byobu pv rsync and of course vim.</div><br/><div id="39805796" class="c"><input type="checkbox" id="c-39805796" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#39804999">root</a><span>|</span><a href="#39805413">parent</a><span>|</span><a href="#39804568">next</a><span>|</span><label class="collapse" for="c-39805796">[-]</label><label class="expand" for="c-39805796">[3 more]</label></div><br/><div class="children"><div class="content">dd, echo * as a poor man&#x27;s ls if ls is accidentally deleted, busybox, cpio, fsck and fsdb.<p>Used all of these and more, in Unix, not just Linux crisis situations.</div><br/><div id="39805806" class="c"><input type="checkbox" id="c-39805806" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#39804999">root</a><span>|</span><a href="#39805796">parent</a><span>|</span><a href="#39804568">next</a><span>|</span><label class="collapse" for="c-39805806">[-]</label><label class="expand" for="c-39805806">[2 more]</label></div><br/><div class="children"><div class="content">Those are already there. We are talking about diagnostic and recovery tools that should be installed by policy, in advance, so that they are already in place to aid in emergencies.</div><br/><div id="39805827" class="c"><input type="checkbox" id="c-39805827" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#39804999">root</a><span>|</span><a href="#39805806">parent</a><span>|</span><a href="#39804568">next</a><span>|</span><label class="collapse" for="c-39805827">[-]</label><label class="expand" for="c-39805827">[1 more]</label></div><br/><div class="children"><div class="content">Okay, my mistake. But busybox is not always already there, right? Installed, I mean? Not at a box right now.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39804568" class="c"><input type="checkbox" id="c-39804568" checked=""/><div class="controls bullet"><span class="by">reilly3000</span><span>|</span><a href="#39804999">prev</a><span>|</span><a href="#39804919">next</a><span>|</span><label class="collapse" for="c-39804568">[-]</label><label class="expand" for="c-39804568">[5 more]</label></div><br/><div class="children"><div class="content">In such a crisis if installing tools is impossible, you can run many utils via Docker, such as:<p>Build a container with a one-liner:<p>docker build -t tcpdump - &lt;&lt;EOF \nFROM ubuntu \nRUN apt-get update &amp;&amp; apt-get install -y tcpdump \nCMD tcpdump -i eth0 \nEOF<p>Run attached to the host network:<p>docker run -dP --net=host moremagic&#x2F;docker-netstat<p>Run system tools attached to read host processes:<p>for sysstat_tool in iostat sar vmstat mpstat pidstat; do
    alias &quot;sysstat-${sysstat_tool}=docker run --rm -it -v &#x2F;proc:&#x2F;proc --privileged --net host --pid host ghcr.io&#x2F;krishjainx&#x2F;sysstat-docker:main &#x2F;usr&#x2F;bin&#x2F;${sysstat_tool}&quot;
done
unset -v sysstat_tool<p>Sure, yum install is preferred, but so long as docker is available this is a viable alternative if you can manage the extra mapping needed. It probably wouldn’t work with a rootless&#x2F;podman setup.</div><br/><div id="39804581" class="c"><input type="checkbox" id="c-39804581" checked=""/><div class="controls bullet"><span class="by">blueflow</span><span>|</span><a href="#39804568">parent</a><span>|</span><a href="#39805173">next</a><span>|</span><label class="collapse" for="c-39804581">[-]</label><label class="expand" for="c-39804581">[2 more]</label></div><br/><div class="children"><div class="content">Is there a situation where apt cant download and install packages but docker can fetch new containers?<p>apt libs borked or something?</div><br/><div id="39804907" class="c"><input type="checkbox" id="c-39804907" checked=""/><div class="controls bullet"><span class="by">Smar</span><span>|</span><a href="#39804568">root</a><span>|</span><a href="#39804581">parent</a><span>|</span><a href="#39805173">next</a><span>|</span><label class="collapse" for="c-39804907">[-]</label><label class="expand" for="c-39804907">[1 more]</label></div><br/><div class="children"><div class="content">I would just decompress the .deb in such case. As a last resort, even a .rpm might work.<p>Of course handling dependencies by hand is annoying, but depending on situation it might be faster anyway.</div><br/></div></div></div></div><div id="39805173" class="c"><input type="checkbox" id="c-39805173" checked=""/><div class="controls bullet"><span class="by">supriyo-biswas</span><span>|</span><a href="#39804568">parent</a><span>|</span><a href="#39804581">prev</a><span>|</span><a href="#39805045">next</a><span>|</span><label class="collapse" for="c-39805173">[-]</label><label class="expand" for="c-39805173">[1 more]</label></div><br/><div class="children"><div class="content">On that note I&#x27;d largely prefer if `busybox` contained more of these tools, it&#x27;d be very helpful to have a 1MBish file that I can upload into a server and run it there.</div><br/></div></div><div id="39805045" class="c"><input type="checkbox" id="c-39805045" checked=""/><div class="controls bullet"><span class="by">xyst</span><span>|</span><a href="#39804568">parent</a><span>|</span><a href="#39805173">prev</a><span>|</span><a href="#39804919">next</a><span>|</span><label class="collapse" for="c-39805045">[-]</label><label class="expand" for="c-39805045">[1 more]</label></div><br/><div class="children"><div class="content">Unless you are in an air gapped situation. Good luck pulling “Ubuntu” image!</div><br/></div></div></div></div><div id="39804919" class="c"><input type="checkbox" id="c-39804919" checked=""/><div class="controls bullet"><span class="by">rr808</span><span>|</span><a href="#39804568">prev</a><span>|</span><a href="#39805180">next</a><span>|</span><label class="collapse" for="c-39804919">[-]</label><label class="expand" for="c-39804919">[4 more]</label></div><br/><div class="children"><div class="content">You guys get root access? I have to raise a ticket for a sysadmin to do anything.</div><br/><div id="39805032" class="c"><input type="checkbox" id="c-39805032" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#39804919">parent</a><span>|</span><a href="#39805218">next</a><span>|</span><label class="collapse" for="c-39805032">[-]</label><label class="expand" for="c-39805032">[2 more]</label></div><br/><div class="children"><div class="content">I am a consultant now so it&#x27;s a new company every few months.<p>There are groups of people you always make nice with.<p>* Security people. The kinds with poorly fit blazers who let you into the building. Learn these peoples names, Starbucks cards are your friends.<p>* Cleaning people. Be nice, be polite, again learn names. Your area will be spoltless. It&#x27;s worth staying late every now and again just to get to know these folks.<p>* Accounting: Make some friends here. Get coffee, go to lunch, talk to them about non work shit, ask about their job, show interest. If you pick the right ones they are gonna grab you when layoffs are coming or corp money is flowing (hit your boss up for extra money times).<p>* IT. The folks who hand out laptops, manage email. Be nice to these people. Watch how quickly they rip bullshit off your computer or wave some security nonsense. Be first in line for every upgrade possible.<p>* Sysadmins. These are the most important ones. Not just because &quot;root&quot; but because a good SA knows how to code but never says it out loud. A good sysadmin will tell you what dark corners have the bodies and if it&#x27;s just a closet or a whole fucking cemetery. If you learn to build into their platform (hint for them containers are how they isolate your shitty software in most cases) then you&#x27;re going to get a LOT more leeway. This is the one group of people who will ask you for favors and you should do them.</div><br/><div id="39805245" class="c"><input type="checkbox" id="c-39805245" checked=""/><div class="controls bullet"><span class="by">Propelloni</span><span>|</span><a href="#39804919">root</a><span>|</span><a href="#39805032">parent</a><span>|</span><a href="#39805218">next</a><span>|</span><label class="collapse" for="c-39805245">[-]</label><label class="expand" for="c-39805245">[1 more]</label></div><br/><div class="children"><div class="content">So true. If you want to know anything about an office, ask the sysadmins. Double-plus on being nice to the facility managers, cleaning people and security. Not only do they do a thankless job but they are often the most useful and resourceful people around if you need something taken care of. They know how to get shit done.</div><br/></div></div></div></div><div id="39805218" class="c"><input type="checkbox" id="c-39805218" checked=""/><div class="controls bullet"><span class="by">Propelloni</span><span>|</span><a href="#39804919">parent</a><span>|</span><a href="#39805032">prev</a><span>|</span><a href="#39805180">next</a><span>|</span><label class="collapse" for="c-39805218">[-]</label><label class="expand" for="c-39805218">[1 more]</label></div><br/><div class="children"><div class="content">Err, sure. I used to run IT ops (SYS, SRE, and SEC in this context). This article is directed at people who run apps on IT provided infrastructure. But if you would have interactions like in the example, your org failed on an org level, this is not a tech problem. We used to have very clear and very trustworthy lines of communication and people wouldn&#x27;t be on chat, they would be on the phone (or today on Teams or whatever) with dev, ops, security, and compliance. Actually, we had at least a liaison on every team, but most often dev ran the apps on ops provided resources. Compliance green-lighted the setup and SR was a dev job. A lot of problems really go away if you do devops in this sense.</div><br/></div></div></div></div><div id="39805180" class="c"><input type="checkbox" id="c-39805180" checked=""/><div class="controls bullet"><span class="by">donio</span><span>|</span><a href="#39804919">prev</a><span>|</span><a href="#39805522">next</a><span>|</span><label class="collapse" for="c-39805180">[-]</label><label class="expand" for="c-39805180">[1 more]</label></div><br/><div class="children"><div class="content">I always cover such tools when I interview people for SRE-type positions. Not so much about which specific commands the candidate can recall (although it always impresses when somebody teaches me about a new tool) but what&#x27;s possible, what sort of tools are available and how you use them: that you <i>can</i> capture and analyze network traffic, syscalls, execution profiles and examine OS and hardware state.</div><br/></div></div><div id="39805522" class="c"><input type="checkbox" id="c-39805522" checked=""/><div class="controls bullet"><span class="by">logifail</span><span>|</span><a href="#39805180">prev</a><span>|</span><a href="#39805594">next</a><span>|</span><label class="collapse" for="c-39805522">[-]</label><label class="expand" for="c-39805522">[1 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t one increase a system&#x27;s attack surface area&#x2F;privilege escalation risk by pre-installing tools such as these?</div><br/></div></div><div id="39805594" class="c"><input type="checkbox" id="c-39805594" checked=""/><div class="controls bullet"><span class="by">sirwitti</span><span>|</span><a href="#39805522">prev</a><span>|</span><a href="#39804742">next</a><span>|</span><label class="collapse" for="c-39805594">[-]</label><label class="expand" for="c-39805594">[1 more]</label></div><br/><div class="children"><div class="content">Related to that, I recently learned about safe-rm which lets you configure files and directories that can&#x27;t be deleted.<p>This probably would have prevented a stressful incident 3 weeks ago.</div><br/></div></div><div id="39804742" class="c"><input type="checkbox" id="c-39804742" checked=""/><div class="controls bullet"><span class="by">randomgiy3142</span><span>|</span><a href="#39805594">prev</a><span>|</span><a href="#39804536">next</a><span>|</span><label class="collapse" for="c-39804742">[-]</label><label class="expand" for="c-39804742">[1 more]</label></div><br/><div class="children"><div class="content">I use zfsbootmenu with hrmph (<a href="https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;hrmpf">https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;hrmpf</a>). You can see the list of packages here (<a href="https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;hrmpf&#x2F;blob&#x2F;master&#x2F;hrmpf.packages">https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;hrmpf&#x2F;blob&#x2F;master&#x2F;hrmpf.pa...</a>). I usually build images based off this so they’re all there, otherwise you’ll need to ssh into zfsbootmenu and load the 2 gb separate distro. This is for home server, though if I had a startup I’d probably setup a “cloud setup” and throw a bunch of servers somewhere. A lot of times for internal projects and even non-production client research having your own cluster is a lot cheaper and easier then paying for a cloud provider. It also gets around when you can’t run k8s and need bare metal. I’d advised some clients on this setup with contingencies in case of catastrophic failure and more importantly test those contingencies but this is more so you don’t have developers doing nothing not to prevent overnight outages. A lot cheaper than cloud solutions for non critical projects and while larger companies will look at the numbers closely if something happened and devs can’t work for an hour the advantage of a startup is devs will find a way to be productive locally or simply have them take the afternoon off (neither has happened).<p>I imagine these problems described happen on big iron type hardware clusters that are extremely expensive and spare capacity isn’t possible. I might be wrong but especially with (sigh) AI setups with extremely expensive $30k GPUs and crazy bandwidth between planes you buy from IBM for crazy prices (hardware vendor on the line so quickly was a hint) you’re way past the commodity server cloud model. I have no idea what could go wrong with such equipment where nearly ever piece of hardware is close to custom built but I’m glad I don’t have to deal with that. The debugging on those things work hardware only a few huge pharma or research companies use has to come down to really strange things.</div><br/></div></div><div id="39804536" class="c"><input type="checkbox" id="c-39804536" checked=""/><div class="controls bullet"><span class="by">SamuelAdams</span><span>|</span><a href="#39804742">prev</a><span>|</span><a href="#39805350">next</a><span>|</span><label class="collapse" for="c-39804536">[-]</label><label class="expand" for="c-39804536">[4 more]</label></div><br/><div class="children"><div class="content">Would these tools still be useful in a cloud environment, such as EC2?<p>Most dev teams I work with are actively reducing their actual managed server and replace it with either Lambda, or docker images running in K8. I wonder if these tools are still useful for containers and serverless?</div><br/><div id="39804607" class="c"><input type="checkbox" id="c-39804607" checked=""/><div class="controls bullet"><span class="by">yla92</span><span>|</span><a href="#39804536">parent</a><span>|</span><a href="#39804635">next</a><span>|</span><label class="collapse" for="c-39804607">[-]</label><label class="expand" for="c-39804607">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s still useful in EC2 (or any other VM-based environments) and Docker containers, as long as you can install the necessary packages (if they are not installed by default). Because after all, there are &quot;servers&quot; underneath, even for the serverless apps, I suppose.<p>It&#x27;s definitely harder for apps running in Lambda because we may not have access to the underlying OS. In such case, I kind of fallback to using the application level observability tools like Pyroscope (<a href="https:&#x2F;&#x2F;pyroscope.io" rel="nofollow">https:&#x2F;&#x2F;pyroscope.io</a>). It doesn&#x27;t always work for all the cases and have some overheads&#x2F;set up but it&#x27;s still better than flying and more useful than the Cloud Provider&#x27;s provided metrics.</div><br/></div></div><div id="39804635" class="c"><input type="checkbox" id="c-39804635" checked=""/><div class="controls bullet"><span class="by">ranger207</span><span>|</span><a href="#39804536">parent</a><span>|</span><a href="#39804607">prev</a><span>|</span><a href="#39804584">next</a><span>|</span><label class="collapse" for="c-39804635">[-]</label><label class="expand" for="c-39804635">[1 more]</label></div><br/><div class="children"><div class="content">IME there&#x27;s always that one service that wasn&#x27;t ever migrated to containers or lambdas is is off running on an EC2 somewhere, and nobody knows about it because it never breaks, but then the one time AWS schedules an instance retirement for it...</div><br/></div></div><div id="39804584" class="c"><input type="checkbox" id="c-39804584" checked=""/><div class="controls bullet"><span class="by">mdekkers</span><span>|</span><a href="#39804536">parent</a><span>|</span><a href="#39804635">prev</a><span>|</span><a href="#39805350">next</a><span>|</span><label class="collapse" for="c-39804584">[-]</label><label class="expand" for="c-39804584">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Most dev teams I work with are actively reducing their actual managed server and replace it with either Lambda, or docker images running in K8.<p>There are plenty of services that don’t fit on k8s or Lambda. Not all pegs fit in those holes.</div><br/></div></div></div></div><div id="39804747" class="c"><input type="checkbox" id="c-39804747" checked=""/><div class="controls bullet"><span class="by">prydt</span><span>|</span><a href="#39805350">prev</a><span>|</span><a href="#39804504">next</a><span>|</span><label class="collapse" for="c-39804747">[-]</label><label class="expand" for="c-39804747">[1 more]</label></div><br/><div class="children"><div class="content">Love the list and the eBPF tools look super helpful.</div><br/></div></div><div id="39804504" class="c"><input type="checkbox" id="c-39804504" checked=""/><div class="controls bullet"><span class="by">pstuart</span><span>|</span><a href="#39804747">prev</a><span>|</span><a href="#39804513">next</a><span>|</span><label class="collapse" for="c-39804504">[-]</label><label class="expand" for="c-39804504">[2 more]</label></div><br/><div class="children"><div class="content">Sounds like it&#x27;s time to create a crisis-essential package group a la build-essential.</div><br/><div id="39804987" class="c"><input type="checkbox" id="c-39804987" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#39804504">parent</a><span>|</span><a href="#39804513">next</a><span>|</span><label class="collapse" for="c-39804987">[-]</label><label class="expand" for="c-39804987">[1 more]</label></div><br/><div class="children"><div class="content">I have in the past created a package list in ansible&#x2F;salt&#x2F;chef&#x2F;... called devops_tools or whatever to make sure we had all the tools installed ahead of time.</div><br/></div></div></div></div><div id="39804513" class="c"><input type="checkbox" id="c-39804513" checked=""/><div class="controls bullet"><span class="by">kunley</span><span>|</span><a href="#39804504">prev</a><span>|</span><a href="#39804905">next</a><span>|</span><label class="collapse" for="c-39804513">[-]</label><label class="expand" for="c-39804513">[1 more]</label></div><br/><div class="children"><div class="content">Brendan Gregg as always with down to earth approach. Love the warroom example</div><br/></div></div><div id="39804905" class="c"><input type="checkbox" id="c-39804905" checked=""/><div class="controls bullet"><span class="by">josephcsible</span><span>|</span><a href="#39804513">prev</a><span>|</span><a href="#39805732">next</a><span>|</span><label class="collapse" for="c-39804905">[-]</label><label class="expand" for="c-39804905">[1 more]</label></div><br/><div class="children"><div class="content">&gt; and...permission errors. What!? I&#x27;m root, this makes no sense.<p>This is one of the reasons why I fight back as hard as I can against any &quot;security&quot; measures that restrict what root can do.</div><br/></div></div><div id="39805732" class="c"><input type="checkbox" id="c-39805732" checked=""/><div class="controls bullet"><span class="by">ur-whale</span><span>|</span><a href="#39804905">prev</a><span>|</span><a href="#39804648">next</a><span>|</span><label class="collapse" for="c-39805732">[-]</label><label class="expand" for="c-39805732">[1 more]</label></div><br/><div class="children"><div class="content">Can&#x27;t imagine handling a Linxu crisis with ssh</div><br/></div></div><div id="39804648" class="c"><input type="checkbox" id="c-39804648" checked=""/><div class="controls bullet"><span class="by">SuperHeavy256</span><span>|</span><a href="#39805732">prev</a><span>|</span><a href="#39805198">next</a><span>|</span><label class="collapse" for="c-39804648">[-]</label><label class="expand" for="c-39804648">[1 more]</label></div><br/><div class="children"><div class="content">So basically busybox?</div><br/></div></div></div></div></div></div></div></body></html>