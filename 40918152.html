<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720602064561" as="style"/><link rel="stylesheet" href="styles.css?v=1720602064561"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a>Ask HN: How do browsers isolate internal audio from microphone input?</a> </div><div class="subtext"><span>dumbest</span> | <span>85 comments</span></div><br/><div><div id="40918539" class="c"><input type="checkbox" id="c-40918539" checked=""/><div class="controls bullet"><span class="by">padenot</span><span>|</span><a href="#40918786">next</a><span>|</span><label class="collapse" for="c-40918539">[-]</label><label class="expand" for="c-40918539">[47 more]</label></div><br/><div class="children"><div class="content">The way this works (and I&#x27;m obviously taking a high level view here) is by comparing what is being played to what is being captured. There is an inherent latency in between what is called the capture stream (the mic) and the reverse stream (what is being output to the speakers, be it people taking or music or whatever), and by finding this latency and comparing, one can cancel the music from the speech captured.<p>Within a single process, or tree of processes that can cooperate, this is straightforward (modulo the actual audio signal processing which isn&#x27;t) to do: keep what you&#x27;re playing for a few hundreds milliseconds around, compare to what you&#x27;re getting in the microphone, find correlations, cancel.<p>If the process aren&#x27;t related there are multiple ways to do this. Either the OS provides a capture API that does the cancellation, this is what happens e.g. on macOS for Firefox and Safari, you can use this. The OS knows what is being output. This is often available on mobile as well.<p>Sometimes (Linux desktop, Windows) the OS provides a loopback stream: a way to capture the audio that is being played back, and that can similarly be used for cancellation.<p>If none of this is available, you mix the audio output and perform cancellation yourself, and the behaviour your observe happens.<p>Source: I do that, but at Mozilla and we unsurprisingly have the same problems and solutions.</div><br/><div id="40919287" class="c"><input type="checkbox" id="c-40919287" checked=""/><div class="controls bullet"><span class="by">Johnie</span><span>|</span><a href="#40918539">parent</a><span>|</span><a href="#40922245">next</a><span>|</span><label class="collapse" for="c-40919287">[-]</label><label class="expand" for="c-40919287">[3 more]</label></div><br/><div class="children"><div class="content">This reminds me of:<p>&gt;The missile knows where it is at all times. It knows this because it knows where it isn&#x27;t. By subtracting where it is from where it isn&#x27;t, or where it isn&#x27;t from where it is (whichever is greater), it obtains a difference, or deviation<p><a href="https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;the-missile-knows-where-it-is" rel="nofollow">https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;the-missile-knows-where-it-is</a></div><br/><div id="40922613" class="c"><input type="checkbox" id="c-40922613" checked=""/><div class="controls bullet"><span class="by">enva2712</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919287">parent</a><span>|</span><a href="#40922245">next</a><span>|</span><label class="collapse" for="c-40922613">[-]</label><label class="expand" for="c-40922613">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=c8jWx2qmBWI" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=c8jWx2qmBWI</a></div><br/><div id="40924177" class="c"><input type="checkbox" id="c-40924177" checked=""/><div class="controls bullet"><span class="by">TaylorAlexander</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40922613">parent</a><span>|</span><a href="#40922245">next</a><span>|</span><label class="collapse" for="c-40924177">[-]</label><label class="expand" for="c-40924177">[1 more]</label></div><br/><div class="children"><div class="content">the missile is eepy
<a href="https:&#x2F;&#x2F;youtu.be&#x2F;Csp_OABIsBM" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;Csp_OABIsBM</a></div><br/></div></div></div></div></div></div><div id="40922245" class="c"><input type="checkbox" id="c-40922245" checked=""/><div class="controls bullet"><span class="by">wormius</span><span>|</span><a href="#40918539">parent</a><span>|</span><a href="#40919287">prev</a><span>|</span><a href="#40918748">next</a><span>|</span><label class="collapse" for="c-40922245">[-]</label><label class="expand" for="c-40922245">[1 more]</label></div><br/><div class="children"><div class="content">For a little more context on negative feedback to those who want to know more (I believe this is what you&#x27;re referring to?)<p>Here&#x27;s a short historical interview with Harold Black from AT&amp;T on his discovery&#x2F;invention of the negative feedback technique for noise reduction.
It&#x27;s not super explanatory but a nice historical context: <a href="https:&#x2F;&#x2F;youtu.be&#x2F;iFrxyJAtJ7U?si=8ONC8N2KZwq3Jfsq" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;iFrxyJAtJ7U?si=8ONC8N2KZwq3Jfsq</a><p>Here&#x27;s a more indepth circuit explanation: <a href="https:&#x2F;&#x2F;youtu.be&#x2F;iFrxyJAtJ7U?si=8ONC8N2KZwq3Jfsq" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;iFrxyJAtJ7U?si=8ONC8N2KZwq3Jfsq</a><p>IIRC the issue was AT&amp;T was trying to get cross-country calling, but to make the signal carry further you needed a louder signal.  Amplifying the signal also the distortion.<p>So Harold came up with this method that ultimately allowed enough signal reduction to allow calls to cross the country within the power constraints available.<p>For some reason I recall something about transmission about Denver being a cut off point before the signal was too degraded... But I&#x27;m too old and forgetful so I could be misremembering something I read a while ago.  If anyone has more specific info&#x2F;context&#x2F;citations that&#x27;d be great.  Since this is just &quot;hearsay&quot; from memory, but I think it&#x27;s something like this.</div><br/></div></div><div id="40918748" class="c"><input type="checkbox" id="c-40918748" checked=""/><div class="controls bullet"><span class="by">gpvos</span><span>|</span><a href="#40918539">parent</a><span>|</span><a href="#40922245">prev</a><span>|</span><a href="#40918963">next</a><span>|</span><label class="collapse" for="c-40918748">[-]</label><label class="expand" for="c-40918748">[38 more]</label></div><br/><div class="children"><div class="content">It just seems more logical for the OS to do that, rather than the application. Basically every application that uses microphone input will want to do this, and will want to compensate for all audio output of the device, not just its own. Why does the OS not provide a way to do this?</div><br/><div id="40918955" class="c"><input type="checkbox" id="c-40918955" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40920538">next</a><span>|</span><label class="collapse" for="c-40918955">[-]</label><label class="expand" for="c-40918955">[15 more]</label></div><br/><div class="children"><div class="content">&gt; Basically every application that uses microphone input will want to do this<p>The OS doesn&#x27;t have more information about this than applications and it&#x27;s not that obvious whether an application wants the OS to fuck around with the audio input it sees. Even in the applications where this might be the obvious default behavior, you&#x27;re wrong - since most listeners don&#x27;t use loudspeakers at all, and this is not a problem when they wear headphones. And detecting that (also, is the input a microphone at all?) is not straightforward.<p>Not all audio applications are phone calls.</div><br/><div id="40919806" class="c"><input type="checkbox" id="c-40919806" checked=""/><div class="controls bullet"><span class="by">fsckboy</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918955">parent</a><span>|</span><a href="#40920103">next</a><span>|</span><label class="collapse" for="c-40919806">[-]</label><label class="expand" for="c-40919806">[3 more]</label></div><br/><div class="children"><div class="content">&gt;<i>The OS doesn&#x27;t have more information about this than applications</i><p>the OP pointed out that this only works if he uses a browser monoculture<p>the OS does have more information than that, it can know what is being played by any&#x2F;all apps, and what is being picked up by the mic</div><br/><div id="40920152" class="c"><input type="checkbox" id="c-40920152" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919806">parent</a><span>|</span><a href="#40920103">next</a><span>|</span><label class="collapse" for="c-40920152">[-]</label><label class="expand" for="c-40920152">[2 more]</label></div><br/><div class="children"><div class="content">The &quot;OS&quot; isn&#x27;t special here, apps can listen to system audio.<p>fwiw, you only need to know anything about outputs if you are doing AEC. Blind source separation doesn&#x27;t have that problem and can just process the input stream.</div><br/><div id="40921222" class="c"><input type="checkbox" id="c-40921222" checked=""/><div class="controls bullet"><span class="by">dolni</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920152">parent</a><span>|</span><a href="#40920103">next</a><span>|</span><label class="collapse" for="c-40921222">[-]</label><label class="expand" for="c-40921222">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The &quot;OS&quot; isn&#x27;t special here, apps can listen to system audio.<p>Even if this is true, it&#x27;s easy to imagine such functionality being exploited by malicious apps as a security and&#x2F;or privacy concern, particularly if the user needs a screen reader.<p>It definitely makes sense for the operating system to provide this functionality.</div><br/></div></div></div></div></div></div><div id="40920103" class="c"><input type="checkbox" id="c-40920103" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918955">parent</a><span>|</span><a href="#40919806">prev</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40920103">[-]</label><label class="expand" for="c-40920103">[8 more]</label></div><br/><div class="children"><div class="content">Assuming this isn&#x27;t parody, the OS doesn&#x27;t have to do it automatically. Having an application grab a microphone stream and say to the OS &quot;take this and cancel any audio out streams&quot; might be pretty useful.</div><br/><div id="40920206" class="c"><input type="checkbox" id="c-40920206" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920103">parent</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40920206">[-]</label><label class="expand" for="c-40920206">[7 more]</label></div><br/><div class="children"><div class="content">I agree with that, but the point I&#x27;m trying to make is that audio i&#x2F;o handling is pretty complicated and application specific. The idea I&#x27;m challenging is that &quot;any app that wants microphone input wants this&quot; is dubious. I&#x27;d say it&#x27;s only a small number of audio applications that care about mic input want background noise reduced - and it makes sense for this to be configured per-input stream.<p><i>Really</i> what would be nice is if every audio i&#x2F;o backend supported multiplex i&#x2F;o streams and you could configure whether or not to cancel audio based on that set of streams but not all output (because multi output-device audio gets tricky).</div><br/><div id="40924461" class="c"><input type="checkbox" id="c-40924461" checked=""/><div class="controls bullet"><span class="by">Melomololotolo</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920206">parent</a><span>|</span><a href="#40921013">next</a><span>|</span><label class="collapse" for="c-40924461">[-]</label><label class="expand" for="c-40924461">[1 more]</label></div><br/><div class="children"><div class="content">Every normal application already does it through the os because most do not care about this at all.<p>Music player, browser, games, video player...<p>Audio is not app specific<p>The only application were this is true is audio were you want full control and low latency.<p>I find your take very weird.</div><br/></div></div><div id="40921013" class="c"><input type="checkbox" id="c-40921013" checked=""/><div class="controls bullet"><span class="by">Wowfunhappy</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920206">parent</a><span>|</span><a href="#40924461">prev</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40921013">[-]</label><label class="expand" for="c-40921013">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;m honestly having trouble thinking of a case where I wouldn&#x27;t want this.<p>I&#x27;m sure there <i>are</i> some niche cases, but in those cases, the application can specifically request that the OS turn off audio isolation.</div><br/><div id="40921259" class="c"><input type="checkbox" id="c-40921259" checked=""/><div class="controls bullet"><span class="by">swatcoder</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921013">parent</a><span>|</span><a href="#40921366">next</a><span>|</span><label class="collapse" for="c-40921259">[-]</label><label class="expand" for="c-40921259">[1 more]</label></div><br/><div class="children"><div class="content">The technique introduces latency and distortion because it&#x27;s subtracting an estimate of  sound that&#x27;s traveling&#x2F;reflecting in the listening environment, which is imperfect and involves the speed of sound.<p>That latency is within the tolerance that users are comfortable with for voice chat, and much less than video processing&#x2F;transfer is introducing for video calls anyway, so it&#x27;s a very obvious win there. Especially since those users are most interested in just picking out clear words using whatever random mic&#x2F;speaker configuration happens to be most convenient.<p>But musicians, for instance, are much more interested in minimizing the delay between their voice or instrument being captured and returned through a monitor, and they generally choose a hardware arrangement that avoids the problem in the first place. And that&#x27;s not really a niche use case.</div><br/></div></div><div id="40921366" class="c"><input type="checkbox" id="c-40921366" checked=""/><div class="controls bullet"><span class="by">IneffablePigeon</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921013">parent</a><span>|</span><a href="#40921259">prev</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40921366">[-]</label><label class="expand" for="c-40921366">[3 more]</label></div><br/><div class="children"><div class="content">Live video or audio chat is basically the only time you do want this. Granted, that’s a big chunk of microphone usage in practice, but any time you are doing higher fidelity audio recording and you have set up the inputs accordingly you absolutely do not want the artefacts introduced by this cancellation. DAWs, audio calibration, and even live audio when you’ve ensured the output cannot impact the recording all would want it switched off.<p>Default on vs default off is really just an implementation detail of the API though, as you say.</div><br/><div id="40921480" class="c"><input type="checkbox" id="c-40921480" checked=""/><div class="controls bullet"><span class="by">Wowfunhappy</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921366">parent</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40921480">[-]</label><label class="expand" for="c-40921480">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Live video or audio chat is basically the only time you do want this.<p>If I&#x27;m recording a voice memo, or talking to an AI assistant, I would want this. Basically everything I can imagine doing with a PC microphone outside of (!) professional audio recording work.<p>That last case is important and we agree there needs to be a way to turn it off. I think defaults are really important though.</div><br/><div id="40921705" class="c"><input type="checkbox" id="c-40921705" checked=""/><div class="controls bullet"><span class="by">blowski</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921480">parent</a><span>|</span><a href="#40919570">next</a><span>|</span><label class="collapse" for="c-40921705">[-]</label><label class="expand" for="c-40921705">[1 more]</label></div><br/><div class="children"><div class="content">My colleague works in a very quiet house, and has no need for noise cancelling. Sometimes, he has it turned on by accident, and the quality is much worse - his voice gets cut out, and volume of his voice goes up and down.<p>As you say, as long as either option is available, the only question is what the default should be.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40919570" class="c"><input type="checkbox" id="c-40919570" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918955">parent</a><span>|</span><a href="#40920103">prev</a><span>|</span><a href="#40919802">next</a><span>|</span><label class="collapse" for="c-40919570">[-]</label><label class="expand" for="c-40919570">[2 more]</label></div><br/><div class="children"><div class="content">The OS can have multiple sound input devices for the application to choose from, &quot;raw&quot; and &quot;fuckarounded with&quot;</div><br/><div id="40920078" class="c"><input type="checkbox" id="c-40920078" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919570">parent</a><span>|</span><a href="#40919802">next</a><span>|</span><label class="collapse" for="c-40920078">[-]</label><label class="expand" for="c-40920078">[1 more]</label></div><br/><div class="children"><div class="content">That doesn&#x27;t make sense in the context of default devices. MacOS&#x27;s AVKit (or is it CoreAudio?) APIs that configure the streams created on the device makes way more sense, since it&#x27;s a property of the audio i&#x2F;o stream and not the devices.</div><br/></div></div></div></div></div></div><div id="40920538" class="c"><input type="checkbox" id="c-40920538" checked=""/><div class="controls bullet"><span class="by">swatcoder</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40918955">prev</a><span>|</span><a href="#40919211">next</a><span>|</span><label class="collapse" for="c-40920538">[-]</label><label class="expand" for="c-40920538">[9 more]</label></div><br/><div class="children"><div class="content">&gt; Why does the OS not provide a way to do this?<p>Some do.<p>But you need to have a strong-handed OS team that&#x27;s willing to push everybody towards their most modern and highly integrated interfaces and sunset their older interfaces.<p>Not everybody wants that in their OS. Some want operating systems that can be pieced together from myriad components maintained by radically different teams, some want to see their API&#x27;s&#x2F;interfaces preserved for decades of backwards compatibility, some want minimal features from their OS and maximum raw flexibility in user space, etc</div><br/><div id="40920688" class="c"><input type="checkbox" id="c-40920688" checked=""/><div class="controls bullet"><span class="by">dfc</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920538">parent</a><span>|</span><a href="#40924106">next</a><span>|</span><label class="collapse" for="c-40920688">[-]</label><label class="expand" for="c-40920688">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Some do<p>Which Operating systems do this?</div><br/><div id="40921324" class="c"><input type="checkbox" id="c-40921324" checked=""/><div class="controls bullet"><span class="by">swatcoder</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920688">parent</a><span>|</span><a href="#40923158">next</a><span>|</span><label class="collapse" for="c-40921324">[-]</label><label class="expand" for="c-40921324">[2 more]</label></div><br/><div class="children"><div class="content">As others have noted, this is trivial for most macOS and iOS apps to opt in to.<p>Frankly, I imagine its also available at the system level on Windows (and maybe Android and Linux) but probably only among applications that happen to be using certain audio frameworks&#x2F;engines.</div><br/><div id="40921590" class="c"><input type="checkbox" id="c-40921590" checked=""/><div class="controls bullet"><span class="by">beepbooptheory</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921324">parent</a><span>|</span><a href="#40923158">next</a><span>|</span><label class="collapse" for="c-40921590">[-]</label><label class="expand" for="c-40921590">[1 more]</label></div><br/><div class="children"><div class="content">It doesn&#x27;t seem to me that module-echo-cancel in Pulseaudio  completely meets the requirements here (only one source), but it looks close, and seems in general like where you would implement something like this.<p>1. <a href="https:&#x2F;&#x2F;www.freedesktop.org&#x2F;wiki&#x2F;Software&#x2F;PulseAudio&#x2F;Documentation&#x2F;User&#x2F;Modules&#x2F;#module-echo-cancel" rel="nofollow">https:&#x2F;&#x2F;www.freedesktop.org&#x2F;wiki&#x2F;Software&#x2F;PulseAudio&#x2F;Documen...</a></div><br/></div></div></div></div><div id="40923158" class="c"><input type="checkbox" id="c-40923158" checked=""/><div class="controls bullet"><span class="by">jen20</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920688">parent</a><span>|</span><a href="#40921324">prev</a><span>|</span><a href="#40924106">next</a><span>|</span><label class="collapse" for="c-40923158">[-]</label><label class="expand" for="c-40923158">[1 more]</label></div><br/><div class="children"><div class="content">macOS has done this in recent versions. Similarly it will do all the virtual background and bokeh stuff for webcams outside of the (typically horrific) implementations in video conferencing apps.</div><br/></div></div></div></div><div id="40924106" class="c"><input type="checkbox" id="c-40924106" checked=""/><div class="controls bullet"><span class="by">exe34</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920538">parent</a><span>|</span><a href="#40920688">prev</a><span>|</span><a href="#40921577">next</a><span>|</span><label class="collapse" for="c-40924106">[-]</label><label class="expand" for="c-40924106">[1 more]</label></div><br/><div class="children"><div class="content">so something for systemD then?</div><br/></div></div><div id="40921577" class="c"><input type="checkbox" id="c-40921577" checked=""/><div class="controls bullet"><span class="by">hsbauauvhabzb</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40920538">parent</a><span>|</span><a href="#40924106">prev</a><span>|</span><a href="#40919211">next</a><span>|</span><label class="collapse" for="c-40921577">[-]</label><label class="expand" for="c-40921577">[3 more]</label></div><br/><div class="children"><div class="content">Weird microaggression</div><br/><div id="40924509" class="c"><input type="checkbox" id="c-40924509" checked=""/><div class="controls bullet"><span class="by">phito</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921577">parent</a><span>|</span><a href="#40921701">next</a><span>|</span><label class="collapse" for="c-40924509">[-]</label><label class="expand" for="c-40924509">[1 more]</label></div><br/><div class="children"><div class="content">Weird macrosensivity</div><br/></div></div><div id="40921701" class="c"><input type="checkbox" id="c-40921701" checked=""/><div class="controls bullet"><span class="by">swatcoder</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40921577">parent</a><span>|</span><a href="#40924509">prev</a><span>|</span><a href="#40919211">next</a><span>|</span><label class="collapse" for="c-40921701">[-]</label><label class="expand" for="c-40921701">[1 more]</label></div><br/><div class="children"><div class="content">Huh? What&#x27;s the aggression in characterizing the diverse landscape of operating systems and the users&#x2F;developers who very reasonably may prefer each?<p>I think it&#x27;s <i>very good</i> that we have so many options of what an operating system and its vendors&#x2F;developers might prioritize, and that these differences in priority have consequential impact on how software gets built on each.</div><br/></div></div></div></div></div></div><div id="40919211" class="c"><input type="checkbox" id="c-40919211" checked=""/><div class="controls bullet"><span class="by">dilap</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40920538">prev</a><span>|</span><a href="#40922669">next</a><span>|</span><label class="collapse" for="c-40919211">[-]</label><label class="expand" for="c-40919211">[4 more]</label></div><br/><div class="children"><div class="content">On mac&#x2F;iOS, you get this using the AVAudioEngine API if you set voiceProcessingEnabled to true on the input node. It corrects for audio being played from all applications on the device.</div><br/><div id="40919343" class="c"><input type="checkbox" id="c-40919343" checked=""/><div class="controls bullet"><span class="by">vundercind</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919211">parent</a><span>|</span><a href="#40921264">next</a><span>|</span><label class="collapse" for="c-40919343">[-]</label><label class="expand" for="c-40919343">[2 more]</label></div><br/><div class="children"><div class="content">My first thought in reading the question was “if your <i>browser</i> is doing that, your platform architecture has… some room for improvement”.</div><br/><div id="40921274" class="c"><input type="checkbox" id="c-40921274" checked=""/><div class="controls bullet"><span class="by">naniwaduni</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919343">parent</a><span>|</span><a href="#40921264">next</a><span>|</span><label class="collapse" for="c-40921274">[-]</label><label class="expand" for="c-40921274">[1 more]</label></div><br/><div class="children"><div class="content">Having room for nontrivial improvement is, to be fair, a normal state of affairs for platforms.</div><br/></div></div></div></div><div id="40921264" class="c"><input type="checkbox" id="c-40921264" checked=""/><div class="controls bullet"><span class="by">xp84</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919211">parent</a><span>|</span><a href="#40919343">prev</a><span>|</span><a href="#40922669">next</a><span>|</span><label class="collapse" for="c-40921264">[-]</label><label class="expand" for="c-40921264">[1 more]</label></div><br/><div class="children"><div class="content">This has certainly made conference calls significantly more usable. I feel like it must have come around during 2020, because I feel like pre-covid I would go around BEGGING everyone I did calls with to get a headset, because otherwise everyone else&#x27;s voice would echo back through their microphone 0.75s later. Today I recently realized I could just literally do calls out loud on my laptop mic and speaker and somehow it works. Nice to know why!</div><br/></div></div></div></div><div id="40922669" class="c"><input type="checkbox" id="c-40922669" checked=""/><div class="controls bullet"><span class="by">rlpb</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40919211">prev</a><span>|</span><a href="#40920866">next</a><span>|</span><label class="collapse" for="c-40922669">[-]</label><label class="expand" for="c-40922669">[2 more]</label></div><br/><div class="children"><div class="content">There is a third place: a common library that all the apps use. If it is in the OS then it becomes brittle. If there&#x27;s an improvement in the technology which requires an API change, that becomes difficult without keeping backwards compatibility or the previous implementation forever. Instead, there would be a newer generation common library which might eventually replace the first but only if the entire ecosystem chooses to leave the old one behind. Meanwhile there&#x27;d be a place for both. Apps that share use of a library would simply dynamically link to it.<p>This is the way things usually work in the Free Software world. For example: need JPEG support? You&#x27;ll probably end up linking to libjpeg or an equivalent. Most languages have a binding to the same library.<p>Is that part of the OS? I guess the answer depends on how you define OS. On a Free Software platform it&#x27;s difficult to say when a given library is part of the OS and when it is not.</div><br/><div id="40923396" class="c"><input type="checkbox" id="c-40923396" checked=""/><div class="controls bullet"><span class="by">kalleboo</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40922669">parent</a><span>|</span><a href="#40920866">next</a><span>|</span><label class="collapse" for="c-40923396">[-]</label><label class="expand" for="c-40923396">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>If it is in the OS then it becomes brittle</i><p>My experience is the opposite. When it&#x27;s part of the OS, it&#x27;s stable and you just say &quot;you need OS version X or better&quot; and it will just work. When it&#x27;s a library, you eventually end up in dependency hell of deprecated libraries and differing versions (or worst case, the JavaScript ecosystem when the platform provides almost nothing and you get npm).</div><br/></div></div></div></div><div id="40920866" class="c"><input type="checkbox" id="c-40920866" checked=""/><div class="controls bullet"><span class="by">kbolino</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40922669">prev</a><span>|</span><a href="#40920328">next</a><span>|</span><label class="collapse" for="c-40920866">[-]</label><label class="expand" for="c-40920866">[1 more]</label></div><br/><div class="children"><div class="content">This assumes there is an OS-managed software mixer sitting in the middle of all audio streams between programs and devices. Historically, that wasn&#x27;t the case, because it would introduce a lot of latency and jitter in the audio. I believe it is still possible for a program to get exclusive access to an audio output device on Windows (WASAPI) and Linux (ALSA).</div><br/></div></div><div id="40920328" class="c"><input type="checkbox" id="c-40920328" checked=""/><div class="controls bullet"><span class="by">asveikau</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40920866">prev</a><span>|</span><a href="#40919007">next</a><span>|</span><label class="collapse" for="c-40920328">[-]</label><label class="expand" for="c-40920328">[1 more]</label></div><br/><div class="children"><div class="content">The OS doesn&#x27;t know that the application doesn&#x27;t want feedback from the speaker, and not 100% of applications will want such filtering.  I think a best practice from the OS side would be to provide it as an optional flag.  (Default could be on or off, with reasonable possibility for debate in either direction, but an app that really knows what it wants should be able to ask for it.)</div><br/></div></div><div id="40919007" class="c"><input type="checkbox" id="c-40919007" checked=""/><div class="controls bullet"><span class="by">bryanrasmussen</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40920328">prev</a><span>|</span><a href="#40918789">next</a><span>|</span><label class="collapse" for="c-40919007">[-]</label><label class="expand" for="c-40919007">[1 more]</label></div><br/><div class="children"><div class="content">I suppose the OS probably makes something like this available, when using Voiceover on Mac and presenting in teams by default only the mic comes into teams, you need to do something to share the other processes audio.<p>That&#x27;s mac of course but in my experience Windows is much more trusting of what it gives applications access to so I suppose the same thing is available there.</div><br/></div></div><div id="40918789" class="c"><input type="checkbox" id="c-40918789" checked=""/><div class="controls bullet"><span class="by">hpen</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40919007">prev</a><span>|</span><a href="#40919272">next</a><span>|</span><label class="collapse" for="c-40918789">[-]</label><label class="expand" for="c-40918789">[3 more]</label></div><br/><div class="children"><div class="content">How sure are you that Basically every application wants this? So should there be a flag at the os level for enabling the cancellation? How do you control that flag?</div><br/><div id="40923426" class="c"><input type="checkbox" id="c-40923426" checked=""/><div class="controls bullet"><span class="by">kalleboo</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918789">parent</a><span>|</span><a href="#40919511">next</a><span>|</span><label class="collapse" for="c-40923426">[-]</label><label class="expand" for="c-40923426">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>How do you control that flag?</i><p><a href="https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;avfaudio&#x2F;avaudiosession&#x2F;mode" rel="nofollow">https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;avfaudio&#x2F;avaudiose...</a></div><br/></div></div><div id="40919511" class="c"><input type="checkbox" id="c-40919511" checked=""/><div class="controls bullet"><span class="by">gregschlom</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918789">parent</a><span>|</span><a href="#40923426">prev</a><span>|</span><a href="#40919272">next</a><span>|</span><label class="collapse" for="c-40919511">[-]</label><label class="expand" for="c-40919511">[1 more]</label></div><br/><div class="children"><div class="content">It would be trivial to pass that flag in whatever API the application calls to request access to the microphone stream.</div><br/></div></div></div></div><div id="40919272" class="c"><input type="checkbox" id="c-40919272" checked=""/><div class="controls bullet"><span class="by">IvyMike</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918748">parent</a><span>|</span><a href="#40918789">prev</a><span>|</span><a href="#40918963">next</a><span>|</span><label class="collapse" for="c-40919272">[-]</label><label class="expand" for="c-40919272">[1 more]</label></div><br/><div class="children"><div class="content">Did you just invent yet another linux audio stack?</div><br/></div></div></div></div><div id="40918963" class="c"><input type="checkbox" id="c-40918963" checked=""/><div class="controls bullet"><span class="by">generalizations</span><span>|</span><a href="#40918539">parent</a><span>|</span><a href="#40918748">prev</a><span>|</span><a href="#40918786">next</a><span>|</span><label class="collapse" for="c-40918963">[-]</label><label class="expand" for="c-40918963">[4 more]</label></div><br/><div class="children"><div class="content">Is there any way to apply this outside the browser? Like, is there a version of this that can be used with Pulseaudio?</div><br/><div id="40919047" class="c"><input type="checkbox" id="c-40919047" checked=""/><div class="controls bullet"><span class="by">correct-horse</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40918963">parent</a><span>|</span><a href="#40918786">next</a><span>|</span><label class="collapse" for="c-40919047">[-]</label><label class="expand" for="c-40919047">[3 more]</label></div><br/><div class="children"><div class="content">To spare others from googling:<p><a href="https:&#x2F;&#x2F;docs.pipewire.org&#x2F;page_module_echo_cancel.html" rel="nofollow">https:&#x2F;&#x2F;docs.pipewire.org&#x2F;page_module_echo_cancel.html</a><p><a href="https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;PipeWire&#x2F;Examples#Echo_cancellation" rel="nofollow">https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;PipeWire&#x2F;Examples#Echo_canc...</a><p>If you&#x27;re still on pulseaudio for some reason, it ships with a similar module named &quot;module-echo-cancel&quot;:<p><a href="https:&#x2F;&#x2F;www.freedesktop.org&#x2F;wiki&#x2F;Software&#x2F;PulseAudio&#x2F;Documentation&#x2F;User&#x2F;Modules&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.freedesktop.org&#x2F;wiki&#x2F;Software&#x2F;PulseAudio&#x2F;Documen...</a></div><br/><div id="40919698" class="c"><input type="checkbox" id="c-40919698" checked=""/><div class="controls bullet"><span class="by">generalizations</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919047">parent</a><span>|</span><a href="#40918786">next</a><span>|</span><label class="collapse" for="c-40919698">[-]</label><label class="expand" for="c-40919698">[2 more]</label></div><br/><div class="children"><div class="content">Huh, thanks. I was interested in this probably 6-8 years ago, and when I went digging the stackoverflow answer mentioned elsewhere in this thread [0] was as far as I got. I guess the tech has progressed since then.<p>[0] <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;21795944&#x2F;remove-known-audio-output-from-microphone-input" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;21795944&#x2F;remove-known-au...</a></div><br/><div id="40921773" class="c"><input type="checkbox" id="c-40921773" checked=""/><div class="controls bullet"><span class="by">varjag</span><span>|</span><a href="#40918539">root</a><span>|</span><a href="#40919698">parent</a><span>|</span><a href="#40918786">next</a><span>|</span><label class="collapse" for="c-40921773">[-]</label><label class="expand" for="c-40921773">[1 more]</label></div><br/><div class="children"><div class="content">It was there 8 years ago.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40918786" class="c"><input type="checkbox" id="c-40918786" checked=""/><div class="controls bullet"><span class="by">umutisik</span><span>|</span><a href="#40918539">prev</a><span>|</span><a href="#40918941">next</a><span>|</span><label class="collapse" for="c-40918786">[-]</label><label class="expand" for="c-40918786">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s called Acoustic Echo Cancellation. An implementation is included in WebRTC included in Chrome. A FIR filter (1D convolution) is applied to what the browser knows is coming out of the speakers; and this filter is continually optimized to to cancel out as much as possible of what&#x27;s coming into the microphone (this is a first approximation, the actual algorithm is more involved).</div><br/><div id="40919444" class="c"><input type="checkbox" id="c-40919444" checked=""/><div class="controls bullet"><span class="by">Sponge5</span><span>|</span><a href="#40918786">parent</a><span>|</span><a href="#40921513">next</a><span>|</span><label class="collapse" for="c-40919444">[-]</label><label class="expand" for="c-40919444">[1 more]</label></div><br/><div class="children"><div class="content">To spare a search: <a href="https:&#x2F;&#x2F;webrtc.googlesource.com&#x2F;src&#x2F;+&#x2F;refs&#x2F;heads&#x2F;main&#x2F;modules&#x2F;audio_processing&#x2F;aec3&#x2F;" rel="nofollow">https:&#x2F;&#x2F;webrtc.googlesource.com&#x2F;src&#x2F;+&#x2F;refs&#x2F;heads&#x2F;main&#x2F;module...</a></div><br/></div></div><div id="40921513" class="c"><input type="checkbox" id="c-40921513" checked=""/><div class="controls bullet"><span class="by">sojuz151</span><span>|</span><a href="#40918786">parent</a><span>|</span><a href="#40919444">prev</a><span>|</span><a href="#40918941">next</a><span>|</span><label class="collapse" for="c-40921513">[-]</label><label class="expand" for="c-40921513">[1 more]</label></div><br/><div class="children"><div class="content">Remember that convolution is multiplication in the frequency domain, so this also handles different responses at different frequencies, not just delays</div><br/></div></div></div></div><div id="40918941" class="c"><input type="checkbox" id="c-40918941" checked=""/><div class="controls bullet"><span class="by">meindnoch</span><span>|</span><a href="#40918786">prev</a><span>|</span><a href="#40918993">next</a><span>|</span><label class="collapse" for="c-40918941">[-]</label><label class="expand" for="c-40918941">[4 more]</label></div><br/><div class="children"><div class="content">Search for the compilation flag &quot;CHROME_WIDE_ECHO_CANCELLATION&quot; in the Chromium sources, and you will find your answer.<p>Can&#x27;t tell you anything else due to NDAs.</div><br/><div id="40919018" class="c"><input type="checkbox" id="c-40919018" checked=""/><div class="controls bullet"><span class="by">Wowfunhappy</span><span>|</span><a href="#40918941">parent</a><span>|</span><a href="#40922689">next</a><span>|</span><label class="collapse" for="c-40919018">[-]</label><label class="expand" for="c-40919018">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s kind of nuts that (I&#x27;m assuming) the source code is publicly available but the developers who wrote it can&#x27;t talk about it.<p>(I realize this situation isn&#x27;t up to you and I appreciate that you chimed in as you could!)</div><br/><div id="40920472" class="c"><input type="checkbox" id="c-40920472" checked=""/><div class="controls bullet"><span class="by">ygjb</span><span>|</span><a href="#40918941">root</a><span>|</span><a href="#40919018">parent</a><span>|</span><a href="#40922689">next</a><span>|</span><label class="collapse" for="c-40920472">[-]</label><label class="expand" for="c-40920472">[1 more]</label></div><br/><div class="children"><div class="content">This is super common.<p>When I worked at Mozilla, most stuff was open, but I still couldn&#x27;t talk about stuff publicly because I wasn&#x27;t a spokesperson for Mozilla.  Same at OpenDNS&#x2F;Cisco, or at Fastly, and now at Amazon.  Lots of stuff I can talk about, but I generally avoid threads and comments about Amazon, or if I do, it&#x27;s strictly to reference public documentation, public releases, or that sort of thing.<p>It&#x27;s easier to simply not participate, link a document, or say no comment than it is to cross reference what I might say against what&#x27;s public, and what&#x27;s not.</div><br/></div></div></div></div><div id="40922689" class="c"><input type="checkbox" id="c-40922689" checked=""/><div class="controls bullet"><span class="by">geor9e</span><span>|</span><a href="#40918941">parent</a><span>|</span><a href="#40919018">prev</a><span>|</span><a href="#40918993">next</a><span>|</span><label class="collapse" for="c-40922689">[-]</label><label class="expand" for="c-40922689">[1 more]</label></div><br/><div class="children"><div class="content">Thanks, I see it&#x27;s a user toggle too chrome:&#x2F;&#x2F;flags#chrome-wide-echo-cancellation or edge:&#x2F;&#x2F;flags&#x2F;#edge-wide-echo-cancellation . All these years I was praising my macbook, thinking it was the hardware doing the cancellation, but it was Chromium the whole time.</div><br/></div></div></div></div><div id="40918993" class="c"><input type="checkbox" id="c-40918993" checked=""/><div class="controls bullet"><span class="by">codetrotter</span><span>|</span><a href="#40918941">prev</a><span>|</span><a href="#40918753">next</a><span>|</span><label class="collapse" for="c-40918993">[-]</label><label class="expand" for="c-40918993">[2 more]</label></div><br/><div class="children"><div class="content">Side note, this can also cause a bit of difficulty in some situations apparently as seen in a HN post from a few months ago that didn’t get much attention<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39669626">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39669626</a><p>&gt; I&#x27;ve been working on an audio application for a little bit, and was shocked to find Chrome handles simultaneous recording &amp; playback very poorly. Made this site to demo the issue as clearly as possible<p><a href="https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz&#x2F;" rel="nofollow">https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz&#x2F;</a></div><br/><div id="40924973" class="c"><input type="checkbox" id="c-40924973" checked=""/><div class="controls bullet"><span class="by">filleokus</span><span>|</span><a href="#40918993">parent</a><span>|</span><a href="#40918753">next</a><span>|</span><label class="collapse" for="c-40924973">[-]</label><label class="expand" for="c-40924973">[1 more]</label></div><br/><div class="children"><div class="content">Not sure if it&#x27;s the whole story, but the latest response in the linked Chrome ticket seems to indicate that the api&#x27;s were used incorrectly by the author<p>&gt; &lt;he...@google.com&gt;<p>&gt; Status: Won&#x27;t Fix (Intended Behavior)<p>&gt; Looking at the sample in <a href="https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz" rel="nofollow">https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz</a>, the issue seems to be that the constraints just aren&#x27;t being passed correctly [...]<p>&gt; If you supply the constraints within the audio block of the constraints, then it seems to work [...]<p>&gt; See <a href="https:&#x2F;&#x2F;jsfiddle.net&#x2F;40821ukc&#x2F;4&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jsfiddle.net&#x2F;40821ukc&#x2F;4&#x2F;</a> for an adapted version of <a href="https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz" rel="nofollow">https:&#x2F;&#x2F;chrome-please-fix-your-audio.xyz</a>. I can repro the issue on the original page, not on that jsfiddle.<p><a href="https:&#x2F;&#x2F;issues.chromium.org&#x2F;issues&#x2F;327472528#comment14" rel="nofollow">https:&#x2F;&#x2F;issues.chromium.org&#x2F;issues&#x2F;327472528#comment14</a></div><br/></div></div></div></div><div id="40918753" class="c"><input type="checkbox" id="c-40918753" checked=""/><div class="controls bullet"><span class="by">supriyo-biswas</span><span>|</span><a href="#40918993">prev</a><span>|</span><a href="#40918731">next</a><span>|</span><label class="collapse" for="c-40918753">[-]</label><label class="expand" for="c-40918753">[4 more]</label></div><br/><div class="children"><div class="content">The technical term that you&#x27;re looking for is acoustic echo cancellation[1].<p>It&#x27;s a fairly common problem in signal processing, and comes up in &quot;simple&quot; devices like telephones too.<p>[1] <a href="https:&#x2F;&#x2F;www.mathworks.com&#x2F;help&#x2F;audio&#x2F;ug&#x2F;acoustic-echo-cancellation-aec.html#" rel="nofollow">https:&#x2F;&#x2F;www.mathworks.com&#x2F;help&#x2F;audio&#x2F;ug&#x2F;acoustic-echo-cancel...</a></div><br/><div id="40921252" class="c"><input type="checkbox" id="c-40921252" checked=""/><div class="controls bullet"><span class="by">mananaysiempre</span><span>|</span><a href="#40918753">parent</a><span>|</span><a href="#40918731">next</a><span>|</span><label class="collapse" for="c-40921252">[-]</label><label class="expand" for="c-40921252">[3 more]</label></div><br/><div class="children"><div class="content">I seem to remember analog telephone lines used a very simple but magic-looking transformer-based circuit of some sort for this purpose. Presumably that worked because they didn’t need to worry about a processing delay?</div><br/><div id="40924938" class="c"><input type="checkbox" id="c-40924938" checked=""/><div class="controls bullet"><span class="by">chadcmulligan</span><span>|</span><a href="#40918753">root</a><span>|</span><a href="#40921252">parent</a><span>|</span><a href="#40921485">next</a><span>|</span><label class="collapse" for="c-40924938">[-]</label><label class="expand" for="c-40924938">[1 more]</label></div><br/><div class="children"><div class="content">There used to be a transformer in phones for side tone, a small amount of what you say is piped back into the earpiece, they did this because they found people would shout if they couldn&#x27;t here their own voice. I&#x27;ve often wished mobiles would do this.</div><br/></div></div><div id="40921485" class="c"><input type="checkbox" id="c-40921485" checked=""/><div class="controls bullet"><span class="by">ajb</span><span>|</span><a href="#40918753">root</a><span>|</span><a href="#40921252">parent</a><span>|</span><a href="#40924938">prev</a><span>|</span><a href="#40918731">next</a><span>|</span><label class="collapse" for="c-40921485">[-]</label><label class="expand" for="c-40921485">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s slightly different. analog phone lines suffer from &#x27;line echo&#x27;, which is an echo generated by the phone line itself - because the same pair of wires  is used for signals traveling in both directions. If you&#x27;re thinking of the &#x27;hybrid&#x27; , which connects the phone line to the speaker and mic, that matches the impedence of each of the three pairs of wire (to the mic, speaker, and phone line) to avoid generating echo in the first place. But they weren&#x27;t perfect (and echo could be generated at other points in the line) so later, digital electronics was used to do first &quot;echo suppression&quot; (just zero any signal below  certain magnitude) and then echo cancellation, which is very similar to acoustic echo cancellation (an AEC can probably do anything an LEC can do, but the LEC is less capable).<p>I&#x27;m not aware of anyone doing echo cancellation using an analog circuit, but that doesn&#x27;t mean no-one did. I guess it&#x27;s theoretically possible but I don&#x27;t see how the adaption could work.</div><br/></div></div></div></div></div></div><div id="40918731" class="c"><input type="checkbox" id="c-40918731" checked=""/><div class="controls bullet"><span class="by">atoav</span><span>|</span><a href="#40918753">prev</a><span>|</span><a href="#40918624">next</a><span>|</span><label class="collapse" for="c-40918731">[-]</label><label class="expand" for="c-40918731">[1 more]</label></div><br/><div class="children"><div class="content">A side effect of echo cancellation. Browser knows what audio it is playing, can correlate that to whatever comes in through the mic, maybe even by outputing inaudible test signals, or by picking wide supported defaults.<p>This is needed because many people don&#x27;t use headphones and if you have more than one endpoint with mic and speakers open you will get feedback gallore if you don&#x27;t do something to suppress it.</div><br/></div></div><div id="40918624" class="c"><input type="checkbox" id="c-40918624" checked=""/><div class="controls bullet"><span class="by">kajecounterhack</span><span>|</span><a href="#40918731">prev</a><span>|</span><a href="#40921692">next</a><span>|</span><label class="collapse" for="c-40918624">[-]</label><label class="expand" for="c-40918624">[1 more]</label></div><br/><div class="children"><div class="content">Google Meet uses source separation technology to denoise the audio. It&#x27;s a neural net that&#x27;s been trained to separate speech from non-speech and ensure that only speech is being piped through. It can even separate different speakers from one another. This technology got really good around 2021 when semi-supervised ways of training the models were developed, and is still improving :)</div><br/></div></div><div id="40921692" class="c"><input type="checkbox" id="c-40921692" checked=""/><div class="controls bullet"><span class="by">exabrial</span><span>|</span><a href="#40918624">prev</a><span>|</span><a href="#40918497">next</a><span>|</span><label class="collapse" for="c-40921692">[-]</label><label class="expand" for="c-40921692">[4 more]</label></div><br/><div class="children"><div class="content">&quot;echo cancellation&quot; is what its called, there&#x27;s a few general purpose (non-ai) algos out there!<p>What&#x27;s really interesting is I can get the algorithm to &quot;mess up&quot; by using external speakers a foot or two away from my computer&#x27;s mic! Just that little bit of travel time is enough to screw with the algo.</div><br/><div id="40922029" class="c"><input type="checkbox" id="c-40922029" checked=""/><div class="controls bullet"><span class="by">meatmanek</span><span>|</span><a href="#40921692">parent</a><span>|</span><a href="#40918497">next</a><span>|</span><label class="collapse" for="c-40922029">[-]</label><label class="expand" for="c-40922029">[3 more]</label></div><br/><div class="children"><div class="content">Echo cancellation is often disabled if you have headphones plugged in, under the assumption that headphones won&#x27;t be audible in the microphone, and it&#x27;s better to disable it to avoid it degrading your microphone signal.<p>It might be that whatever program you&#x27;re using doesn&#x27;t know the difference between speakers and headphones (possibly because you&#x27;re using the 3.5mm jack?)</div><br/><div id="40923306" class="c"><input type="checkbox" id="c-40923306" checked=""/><div class="controls bullet"><span class="by">exabrial</span><span>|</span><a href="#40921692">root</a><span>|</span><a href="#40922029">parent</a><span>|</span><a href="#40918497">next</a><span>|</span><label class="collapse" for="c-40923306">[-]</label><label class="expand" for="c-40923306">[2 more]</label></div><br/><div class="children"><div class="content">jokes on them, some of us use the headphone jack</div><br/><div id="40924901" class="c"><input type="checkbox" id="c-40924901" checked=""/><div class="controls bullet"><span class="by">pjc50</span><span>|</span><a href="#40921692">root</a><span>|</span><a href="#40923306">parent</a><span>|</span><a href="#40918497">next</a><span>|</span><label class="collapse" for="c-40924901">[-]</label><label class="expand" for="c-40924901">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a whole subfield of &quot;jack detection&quot; (where the final amp stage attempts to determine what&#x27;s plugged in) and probably a &quot;jack assignment&quot; panel in your driver software that can configure whether the OS thinks of it as &quot;speakers&quot; or &quot;headphones&quot;.</div><br/></div></div></div></div></div></div></div></div><div id="40918497" class="c"><input type="checkbox" id="c-40918497" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#40921692">prev</a><span>|</span><a href="#40918446">next</a><span>|</span><label class="collapse" for="c-40918497">[-]</label><label class="expand" for="c-40918497">[1 more]</label></div><br/><div class="children"><div class="content">I think this would be part of echo cancellation: in a meeting you don&#x27;t want the data from the meeting to be fed back to it. I suppose it uses the all the streams from the browser then, though I think in general it would be even better to cancel out everything that comes from the speakers. Maybe it can work this way on some other platforms?<p>E.g. PulseAudio and Pipewire have a module for echo cancellation.</div><br/></div></div><div id="40918446" class="c"><input type="checkbox" id="c-40918446" checked=""/><div class="controls bullet"><span class="by">danhau</span><span>|</span><a href="#40918497">prev</a><span>|</span><a href="#40919073">next</a><span>|</span><label class="collapse" for="c-40918446">[-]</label><label class="expand" for="c-40918446">[1 more]</label></div><br/><div class="children"><div class="content">Since Chrome has the PCM data it‘s writing to the speaker, it can use that to remove similar sounds from a mic. That‘s my guess.<p>There‘s a similar question on SO: <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;21795944&#x2F;remove-known-audio-output-from-microphone-input" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;21795944&#x2F;remove-known-au...</a></div><br/></div></div><div id="40919073" class="c"><input type="checkbox" id="c-40919073" checked=""/><div class="controls bullet"><span class="by">cbracketdash</span><span>|</span><a href="#40918446">prev</a><span>|</span><a href="#40921648">next</a><span>|</span><label class="collapse" for="c-40919073">[-]</label><label class="expand" for="c-40919073">[1 more]</label></div><br/><div class="children"><div class="content">This concept is known as &quot;Echo Cancellation&quot; <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Echo_suppression_and_cancellation" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Echo_suppression_and_cancellat...</a></div><br/></div></div><div id="40921648" class="c"><input type="checkbox" id="c-40921648" checked=""/><div class="controls bullet"><span class="by">sciencesama</span><span>|</span><a href="#40919073">prev</a><span>|</span><a href="#40918770">next</a><span>|</span><label class="collapse" for="c-40921648">[-]</label><label class="expand" for="c-40921648">[2 more]</label></div><br/><div class="children"><div class="content">Windows 11 does this ! Videos playing on browser (edge, tested on youtube, linkedin videos) wont he heard to the meeting folks or folks on call in teams !</div><br/><div id="40921936" class="c"><input type="checkbox" id="c-40921936" checked=""/><div class="controls bullet"><span class="by">blharr</span><span>|</span><a href="#40921648">parent</a><span>|</span><a href="#40918770">next</a><span>|</span><label class="collapse" for="c-40921936">[-]</label><label class="expand" for="c-40921936">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s interesting. Following up, is there any reason why it wouldn&#x27;t be possible for other browsers&#x2F;applications? It seems like the operating system should be able to generally access the audio from any application</div><br/></div></div></div></div><div id="40918770" class="c"><input type="checkbox" id="c-40918770" checked=""/><div class="controls bullet"><span class="by">hpen</span><span>|</span><a href="#40921648">prev</a><span>|</span><a href="#40918464">next</a><span>|</span><label class="collapse" for="c-40918770">[-]</label><label class="expand" for="c-40918770">[1 more]</label></div><br/><div class="children"><div class="content">Since chrome has the data from both sources: the microphone, and the audio stream from YouTube, I imagine you can construct a filter from the impulse response of the YouTube source and then run the microphone through it</div><br/></div></div><div id="40918464" class="c"><input type="checkbox" id="c-40918464" checked=""/><div class="controls bullet"><span class="by">glii</span><span>|</span><a href="#40918770">prev</a><span>|</span><a href="#40921653">next</a><span>|</span><label class="collapse" for="c-40918464">[-]</label><label class="expand" for="c-40918464">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Echo_suppression_and_cancellation" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Echo_suppression_and_cancellat...</a></div><br/></div></div><div id="40921653" class="c"><input type="checkbox" id="c-40921653" checked=""/><div class="controls bullet"><span class="by">sciencesama</span><span>|</span><a href="#40918464">prev</a><span>|</span><a href="#40918468">next</a><span>|</span><label class="collapse" for="c-40921653">[-]</label><label class="expand" for="c-40921653">[1 more]</label></div><br/><div class="children"><div class="content">Windows 11 does that !! Videos playing on edge wont be heard by the folks on teams !!</div><br/></div></div><div id="40918468" class="c"><input type="checkbox" id="c-40918468" checked=""/><div class="controls bullet"><span class="by">bigbones</span><span>|</span><a href="#40921653">prev</a><span>|</span><a href="#40919167">next</a><span>|</span><label class="collapse" for="c-40918468">[-]</label><label class="expand" for="c-40918468">[1 more]</label></div><br/><div class="children"><div class="content">Guessing it&#x27;s a feature of the WebRTC stack if it&#x27;s to be found anywhere, there&#x27;s always a requirement for cancelling feedback from other meeting participants</div><br/></div></div><div id="40919167" class="c"><input type="checkbox" id="c-40919167" checked=""/><div class="controls bullet"><span class="by">lowdownbutter</span><span>|</span><a href="#40918468">prev</a><span>|</span><a href="#40919057">next</a><span>|</span><label class="collapse" for="c-40919167">[-]</label><label class="expand" for="c-40919167">[1 more]</label></div><br/><div class="children"><div class="content">You forgot to mention if you&#x27;re using speakers.</div><br/></div></div><div id="40919057" class="c"><input type="checkbox" id="c-40919057" checked=""/><div class="controls bullet"><span class="by">amelius</span><span>|</span><a href="#40919167">prev</a><span>|</span><a href="#40918723">next</a><span>|</span><label class="collapse" for="c-40919057">[-]</label><label class="expand" for="c-40919057">[3 more]</label></div><br/><div class="children"><div class="content">You can use a multidimensional Kalman filter to do this.</div><br/><div id="40921962" class="c"><input type="checkbox" id="c-40921962" checked=""/><div class="controls bullet"><span class="by">blharr</span><span>|</span><a href="#40919057">parent</a><span>|</span><a href="#40918723">next</a><span>|</span><label class="collapse" for="c-40921962">[-]</label><label class="expand" for="c-40921962">[2 more]</label></div><br/><div class="children"><div class="content">You can use a multidimensional Kalman filter to do many things</div><br/><div id="40924365" class="c"><input type="checkbox" id="c-40924365" checked=""/><div class="controls bullet"><span class="by">amelius</span><span>|</span><a href="#40919057">root</a><span>|</span><a href="#40921962">parent</a><span>|</span><a href="#40918723">next</a><span>|</span><label class="collapse" for="c-40924365">[-]</label><label class="expand" for="c-40924365">[1 more]</label></div><br/><div class="children"><div class="content">But that does not really come close to answering the question.</div><br/></div></div></div></div></div></div><div id="40918476" class="c"><input type="checkbox" id="c-40918476" checked=""/><div class="controls bullet"><span class="by">eonpi</span><span>|</span><a href="#40918622">prev</a><span>|</span><label class="collapse" for="c-40918476">[-]</label><label class="expand" for="c-40918476">[3 more]</label></div><br/><div class="children"><div class="content">This is something that is usually taken care of by the App that&#x27;s receiving the input from the microphone (Google Meet, Teams, etc). The App breaks the audio into frequencies, and the ones that correspond to human voice ranges are accepted, and anything else is rejected. This is referred to as, for example, voice isolation, and has been turned on by default in all major meeting Apps for a little while now.<p>Surprised to hear that it doesn&#x27;t seem to work for you when the audio is generated by a different browser, this shouldn&#x27;t make a difference.</div><br/><div id="40918663" class="c"><input type="checkbox" id="c-40918663" checked=""/><div class="controls bullet"><span class="by">hex4def6</span><span>|</span><a href="#40918476">parent</a><span>|</span><label class="collapse" for="c-40918663">[-]</label><label class="expand" for="c-40918663">[2 more]</label></div><br/><div class="children"><div class="content">Assuming OP is correct, your last sentence implies this isn&#x27;t the solution being used.<p>Additionally, many (<i>citation needed</i>) Youtube videos have people talking in them; this method wouldn&#x27;t help with that.<p>Isolating vocals in general is significantly more difficult than just relying on frequency range. Any instrument I can think of can generate notes that are squarely in the common range of a human (see: <a href="https:&#x2F;&#x2F;www.dbamfordmusic.com&#x2F;frequency-range-of-instruments.html" rel="nofollow">https:&#x2F;&#x2F;www.dbamfordmusic.com&#x2F;frequency-range-of-instruments...</a>)</div><br/><div id="40923647" class="c"><input type="checkbox" id="c-40923647" checked=""/><div class="controls bullet"><span class="by">eonpi</span><span>|</span><a href="#40918476">root</a><span>|</span><a href="#40918663">parent</a><span>|</span><label class="collapse" for="c-40923647">[-]</label><label class="expand" for="c-40923647">[1 more]</label></div><br/><div class="children"><div class="content">Was trying to <i>informally</i> describe the use of Fourier transformations to achieve the isolation. Success will vary depending on the situation, but ML is also used in more recent cases with more uniform end results for the particular use case.<p>The initial question may be specific to the way one particular browser handles things to certain degree, but the comment was also trying to communicate that it can go beyond the browser and can actually be handled by the application. However, the microphone itself can also be participating at some level if it features noise suppression or some other enhancements.<p>The surprise about things being different when using a separate browser, come from assuming that any audio reaching the microphone should be processed equally if using FTs (or machine learning if applicable), so the audio source shouldn&#x27;t matter.<p>References:<p>- <a href="https:&#x2F;&#x2F;www.nti-audio.com&#x2F;en&#x2F;support&#x2F;know-how&#x2F;fast-fourier-transform-fft" rel="nofollow">https:&#x2F;&#x2F;www.nti-audio.com&#x2F;en&#x2F;support&#x2F;know-how&#x2F;fast-fourier-t...</a><p>- <a href="https:&#x2F;&#x2F;pseeth.github.io&#x2F;public&#x2F;papers&#x2F;seetharaman_2dft_waspaa2017.pdf" rel="nofollow">https:&#x2F;&#x2F;pseeth.github.io&#x2F;public&#x2F;papers&#x2F;seetharaman_2dft_wasp...</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>