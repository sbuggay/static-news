<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1731747659969" as="style"/><link rel="stylesheet" href="styles.css?v=1731747659969"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://slimsaas.com/blog/django-scaling-performance/">The Practical Guide to Scaling Django</a> <span class="domain">(<a href="https://slimsaas.com">slimsaas.com</a>)</span></div><div class="subtext"><span>rbanffy</span> | <span>22 comments</span></div><br/><div><div id="42151073" class="c"><input type="checkbox" id="c-42151073" checked=""/><div class="controls bullet"><span class="by">feydaykyn</span><span>|</span><a href="#42155289">next</a><span>|</span><label class="collapse" for="c-42151073">[-]</label><label class="expand" for="c-42151073">[3 more]</label></div><br/><div class="children"><div class="content">The snippets are not false, but there&#x27;s so much context missing it&#x27;s easy to worsen the situation, especially for beginners which seem to be the target audience.<p>First, this guide should emphasize the need to measure before doing anything : django silk, django debug toolbarsm, etc.
Of course, measure after the optimizations too, and measure in production with an apm.<p>Second, some only work sometimes : select_related &#x2F; prefetch_related &#x2F; iterator will lead to giga SQL queries with nested joins all over the place, and ends by exploding ram usage. It will help at first, but soon enough one will pay any missing sql knowledge or naive relationships.<p>Third, caching without taking the context into account will probably lead to data corruption one way or another. Debugging stale cache issues is not fun, since you cannot reproduce them easily.<p>Fourth, celery is a whole new world, which requires workers, retry and idempotent logic, etc.<p>Finally, scaling is also about code:  architecture, good practices, basic algorithm, etc<p>I&#x27;ll end by linking to more complete resources :
- <a href="https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;en&#x2F;5.1&#x2F;topics&#x2F;performance&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;en&#x2F;5.1&#x2F;topics&#x2F;performance&#x2F;</a>
- <a href="https:&#x2F;&#x2F;loadforge.com&#x2F;guides&#x2F;the-ultimate-guide-to-django-performance-best-practices-for-scaling-and-optimization" rel="nofollow">https:&#x2F;&#x2F;loadforge.com&#x2F;guides&#x2F;the-ultimate-guide-to-django-pe...</a>
- <a href="https:&#x2F;&#x2F;medium.com&#x2F;django-unleashed&#x2F;django-application-performance-optimization-a-checklist-63e2c6d69e4e" rel="nofollow">https:&#x2F;&#x2F;medium.com&#x2F;django-unleashed&#x2F;django-application-perfo...</a></div><br/><div id="42155088" class="c"><input type="checkbox" id="c-42155088" checked=""/><div class="controls bullet"><span class="by">pastage</span><span>|</span><a href="#42151073">parent</a><span>|</span><a href="#42155289">next</a><span>|</span><label class="collapse" for="c-42155088">[-]</label><label class="expand" for="c-42155088">[2 more]</label></div><br/><div class="children"><div class="content">&gt; scaling is also about code<p>Which is darn hard if you are a beginner in a framework, loops in loops still bites me after reality does the integration test for me. This is especially true when you try to do a simple thing as a beginner. By scaling I am just talking about normal production, going from 2 developers to a couple of thousand customers.</div><br/><div id="42155182" class="c"><input type="checkbox" id="c-42155182" checked=""/><div class="controls bullet"><span class="by">feydaykyn</span><span>|</span><a href="#42151073">root</a><span>|</span><a href="#42155088">parent</a><span>|</span><a href="#42155289">next</a><span>|</span><label class="collapse" for="c-42155182">[-]</label><label class="expand" for="c-42155182">[1 more]</label></div><br/><div class="children"><div class="content">To mind it&#x27;s a part where the Django guide could be expanded a bit, in order to help scaffold a simple but &quot;open to the future&quot; code architecture.
For instance I would warn against fat models and propose a very light &quot;service pattern&quot; architecture</div><br/></div></div></div></div></div></div><div id="42155289" class="c"><input type="checkbox" id="c-42155289" checked=""/><div class="controls bullet"><span class="by">The_Amp_Walrus</span><span>|</span><a href="#42151073">prev</a><span>|</span><a href="#42154924">next</a><span>|</span><label class="collapse" for="c-42155289">[-]</label><label class="expand" for="c-42155289">[1 more]</label></div><br/><div class="children"><div class="content">I did a more detailed yt video on django query optimisation (mostly for ppl new to the framework) for those interested<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=9uoI6pvuvYs" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=9uoI6pvuvYs</a></div><br/></div></div><div id="42154924" class="c"><input type="checkbox" id="c-42154924" checked=""/><div class="controls bullet"><span class="by">tmarice</span><span>|</span><a href="#42155289">prev</a><span>|</span><a href="#42151467">next</a><span>|</span><label class="collapse" for="c-42154924">[-]</label><label class="expand" for="c-42154924">[1 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re on Postgres, StringAgg and ArrayAgg are nice alternatives to prefetch_related to avoid building Python model instances and waste memory.<p>I wrote a short blog post on recent optimizations we did on our Django codebase: <a href="https:&#x2F;&#x2F;tmarice.dev&#x2F;blog&#x2F;better-living-through-optimized-django&#x2F;" rel="nofollow">https:&#x2F;&#x2F;tmarice.dev&#x2F;blog&#x2F;better-living-through-optimized-dja...</a></div><br/></div></div><div id="42151467" class="c"><input type="checkbox" id="c-42151467" checked=""/><div class="controls bullet"><span class="by">vundercind</span><span>|</span><a href="#42154924">prev</a><span>|</span><a href="#42151364">next</a><span>|</span><label class="collapse" for="c-42151467">[-]</label><label class="expand" for="c-42151467">[8 more]</label></div><br/><div class="children"><div class="content">Probably 80% of notable performance problems I’ve seen in the kinds of systems that things like Django and Ruby get used for have been terrible queries or patterns of use for databases (I’ve seen 1,000x or worse costs for this versus something more-correct) and nearly all of the other 20% has been areas that plainly just needed some pretty straightforward caching.<p>The nice thing about that is that spotting those, and the basic approach to fixing them, if not the exact implementation details, are cross-platform skills that apply basically anywhere.<p>I actually can’t recall any other notable performance problems in those sorts of systems, over the years. Those are so common and the fixes so effective I guess the rest has just never rated attention. I’ve seen different problems in long-lived worker processes though (“make it streaming—everything becomes streaming when scale gets big enough” is the usual platform-agnostic magic bullet in those cases)<p>A bunch of TFA is basically about those things, so I’m not correcting it, more like nodding along.<p>Oh wait I just thought of another I’ve seen: serving large files through a scripting language, as in, reading it in and writing it back out with a scripting language. You run into trouble at even modest scale. There’s a magic response header for that, make Nginx or Apache or whatever serve it for you, it’s a fix that’s typically deleting a bunch of code and replacing it with one or two lines. Or else just use s3 and maybe signed URLs like the rest of the world. Problem solved.</div><br/><div id="42151984" class="c"><input type="checkbox" id="c-42151984" checked=""/><div class="controls bullet"><span class="by">megaman821</span><span>|</span><a href="#42151467">parent</a><span>|</span><a href="#42154568">next</a><span>|</span><label class="collapse" for="c-42151984">[-]</label><label class="expand" for="c-42151984">[4 more]</label></div><br/><div class="children"><div class="content">I have had to combine files into a zipped file on demand before. It is hard to avoid the inherent slowness of that.</div><br/><div id="42153663" class="c"><input type="checkbox" id="c-42153663" checked=""/><div class="controls bullet"><span class="by">vundercind</span><span>|</span><a href="#42151467">root</a><span>|</span><a href="#42151984">parent</a><span>|</span><a href="#42152323">next</a><span>|</span><label class="collapse" for="c-42153663">[-]</label><label class="expand" for="c-42153663">[1 more]</label></div><br/><div class="children"><div class="content">Mmm. If you had the right library, might be able to stream it as it’s being created which might help at least with perceived performance, but yeah, that’s a fun one.</div><br/></div></div><div id="42152323" class="c"><input type="checkbox" id="c-42152323" checked=""/><div class="controls bullet"><span class="by">ch4s3</span><span>|</span><a href="#42151467">root</a><span>|</span><a href="#42151984">parent</a><span>|</span><a href="#42153663">prev</a><span>|</span><a href="#42154568">next</a><span>|</span><label class="collapse" for="c-42152323">[-]</label><label class="expand" for="c-42152323">[2 more]</label></div><br/><div class="children"><div class="content">Interesting, was there a business reason to not do that in the background somewhere?</div><br/><div id="42153403" class="c"><input type="checkbox" id="c-42153403" checked=""/><div class="controls bullet"><span class="by">megaman821</span><span>|</span><a href="#42151467">root</a><span>|</span><a href="#42152323">parent</a><span>|</span><a href="#42154568">next</a><span>|</span><label class="collapse" for="c-42153403">[-]</label><label class="expand" for="c-42153403">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, very non-technical users that won&#x27;t check their email or click on a notification when the zip file is ready for them.</div><br/></div></div></div></div></div></div><div id="42154568" class="c"><input type="checkbox" id="c-42154568" checked=""/><div class="controls bullet"><span class="by">golergka</span><span>|</span><a href="#42151467">parent</a><span>|</span><a href="#42151984">prev</a><span>|</span><a href="#42152017">next</a><span>|</span><label class="collapse" for="c-42154568">[-]</label><label class="expand" for="c-42154568">[1 more]</label></div><br/><div class="children"><div class="content">Knowing SQL and how relational databases actually work is one of the best superpowers a backend developer can have. 
If you want to go deeper than your database manual, the best place is Andy Pavlo&#x27;s db course, freely available at youtube. I don&#x27;t write databases, but after watching it I understand trade-offs and performance considerations much better, and feel much more comfortable reading Postgresql manual.</div><br/></div></div><div id="42152017" class="c"><input type="checkbox" id="c-42152017" checked=""/><div class="controls bullet"><span class="by">jonatron</span><span>|</span><a href="#42151467">parent</a><span>|</span><a href="#42154568">prev</a><span>|</span><a href="#42151364">next</a><span>|</span><label class="collapse" for="c-42152017">[-]</label><label class="expand" for="c-42152017">[2 more]</label></div><br/><div class="children"><div class="content">The magic header is probably X-Accel-Redirect</div><br/><div id="42153650" class="c"><input type="checkbox" id="c-42153650" checked=""/><div class="controls bullet"><span class="by">vundercind</span><span>|</span><a href="#42151467">root</a><span>|</span><a href="#42152017">parent</a><span>|</span><a href="#42151364">next</a><span>|</span><label class="collapse" for="c-42153650">[-]</label><label class="expand" for="c-42153650">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, or the kinda-better-named “x-sendfile” on apache2. Same effect.</div><br/></div></div></div></div></div></div><div id="42151364" class="c"><input type="checkbox" id="c-42151364" checked=""/><div class="controls bullet"><span class="by">vldmrs</span><span>|</span><a href="#42151467">prev</a><span>|</span><a href="#42152914">next</a><span>|</span><label class="collapse" for="c-42151364">[-]</label><label class="expand" for="c-42151364">[2 more]</label></div><br/><div class="children"><div class="content">At first I wanted to criticize the post, buuut after finishing reading it I actually liked it. Very concise and practical<p>ps - I didn’t know about template “cache” directive</div><br/><div id="42154476" class="c"><input type="checkbox" id="c-42154476" checked=""/><div class="controls bullet"><span class="by">danpalmer</span><span>|</span><a href="#42151364">parent</a><span>|</span><a href="#42152914">next</a><span>|</span><label class="collapse" for="c-42154476">[-]</label><label class="expand" for="c-42154476">[1 more]</label></div><br/><div class="children"><div class="content">FWIW, I&#x27;d advise against template caching. It&#x27;s awkward to cache bust, and a network round trip to your cache will almost certainly be more expensive than the Python operations to render the template, even with stock Django templating which is slow.<p>The only place it&#x27;s possible worth it is if you do a lot of database queries from your template rendering, and you&#x27;re therefore caching database results (as rendered text). In that case, it&#x27;s an easy patch. However a much better solution is to fetch all database results up front.<p>In my previous company we had a very significant Django codebase with plenty of templating, and found that using the templating system for (lazy loaded) database queries or caching was more hassle than it was worth and avoided it as much as possible. Treating template rendering as a pure CPU bound function was always better.</div><br/></div></div></div></div><div id="42152914" class="c"><input type="checkbox" id="c-42152914" checked=""/><div class="controls bullet"><span class="by">slashnode</span><span>|</span><a href="#42151364">prev</a><span>|</span><a href="#42152747">next</a><span>|</span><label class="collapse" for="c-42152914">[-]</label><label class="expand" for="c-42152914">[1 more]</label></div><br/><div class="children"><div class="content">The basic outline of this post isn’t bad, the problem is that’s all there is - a basic outline. If you haven’t dealt with these problems before the checklists are meaningless. If you HAVE dealt with these problems before the checklists are redundant</div><br/></div></div><div id="42152747" class="c"><input type="checkbox" id="c-42152747" checked=""/><div class="controls bullet"><span class="by">8organicbits</span><span>|</span><a href="#42152914">prev</a><span>|</span><a href="#42152416">next</a><span>|</span><label class="collapse" for="c-42152747">[-]</label><label class="expand" for="c-42152747">[1 more]</label></div><br/><div class="children"><div class="content">Don&#x27;t store secrets in settings.py. Typically you&#x27;d inject those from secrets management as environment variables.</div><br/></div></div><div id="42152416" class="c"><input type="checkbox" id="c-42152416" checked=""/><div class="controls bullet"><span class="by">almost</span><span>|</span><a href="#42152747">prev</a><span>|</span><a href="#42153454">next</a><span>|</span><label class="collapse" for="c-42152416">[-]</label><label class="expand" for="c-42152416">[2 more]</label></div><br/><div class="children"><div class="content">This sort of article seems perfectly poised to be useless to beginners (no context, doesn&#x27;t tell you how to use the things) and experts (no nuance, just listing basic features) alike. Who is it for? Why does it exist? Why is it posted here?</div><br/><div id="42154306" class="c"><input type="checkbox" id="c-42154306" checked=""/><div class="controls bullet"><span class="by">jerrygenser</span><span>|</span><a href="#42152416">parent</a><span>|</span><a href="#42153454">next</a><span>|</span><label class="collapse" for="c-42154306">[-]</label><label class="expand" for="c-42154306">[1 more]</label></div><br/><div class="children"><div class="content">Seo and marketing to sell their product is the reason it exists.</div><br/></div></div></div></div><div id="42153454" class="c"><input type="checkbox" id="c-42153454" checked=""/><div class="controls bullet"><span class="by">kehrazy</span><span>|</span><a href="#42152416">prev</a><span>|</span><a href="#42154848">next</a><span>|</span><label class="collapse" for="c-42153454">[-]</label><label class="expand" for="c-42153454">[1 more]</label></div><br/><div class="children"><div class="content">An amazing movie.</div><br/></div></div></div></div></div></div></div></body></html>