<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696496489533" as="style"/><link rel="stylesheet" href="styles.css?v=1696496489533"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://chipsandcheese.com/2023/10/04/qualcomms-hexagon-dsp-and-now-npu/">Qualcomm’s Hexagon DSP, and Now, NPU</a> <span class="domain">(<a href="https://chipsandcheese.com">chipsandcheese.com</a>)</span></div><div class="subtext"><span>mfiguiere</span> | <span>21 comments</span></div><br/><div><div id="37773135" class="c"><input type="checkbox" id="c-37773135" checked=""/><div class="controls bullet"><span class="by">Ristovski</span><span>|</span><a href="#37775025">next</a><span>|</span><label class="collapse" for="c-37773135">[-]</label><label class="expand" for="c-37773135">[9 more]</label></div><br/><div class="children"><div class="content">One of the major downsides of the Hexagon DSP is that its near impossible to actually run anything on it unless you somehow get your hands on an unprovisioned&#x2F;unlocked SoC.<p>The HLOS (High-level OS) running on the Hexagon requires every &quot;applet&quot; to be signed by either the Qualcomm root cert or the OEMs cert. Usually, every phone has a set of generic Hexagon applets (or &quot;skeleton libs&quot;) that are provided and signed by the OEM, which seem to be freely usable to offload some computational work to the DSP (mainly FastCV et al - <a href="https:&#x2F;&#x2F;developer.qualcomm.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;docs&#x2F;qualcomm-computer-vision&#x2F;api&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;developer.qualcomm.com&#x2F;sites&#x2F;default&#x2F;files&#x2F;docs&#x2F;qual...</a>).
Those of course come with their own bugs: <a href="https:&#x2F;&#x2F;research.checkpoint.com&#x2F;2021&#x2F;pwn2own-qualcomm-dsp&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;research.checkpoint.com&#x2F;2021&#x2F;pwn2own-qualcomm-dsp&#x2F;</a><p>On some older SoCs, you were able to use a TOCTOU (Time of check to time of use) exploit to bypass the signature check by patching the applet loader shim in-memory, once it itself got authenticated: <a href="https:&#x2F;&#x2F;github.com&#x2F;geohot&#x2F;freethedsp&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;geohot&#x2F;freethedsp&#x2F;</a> (I have personally ported this to the msm8953, and it seems to work)</div><br/><div id="37773575" class="c"><input type="checkbox" id="c-37773575" checked=""/><div class="controls bullet"><span class="by">david-gpu</span><span>|</span><a href="#37773135">parent</a><span>|</span><a href="#37773716">next</a><span>|</span><label class="collapse" for="c-37773575">[-]</label><label class="expand" for="c-37773575">[2 more]</label></div><br/><div class="children"><div class="content">I am not surprised. When I worked at Qualcomm my main gripe was how closed and secretive they were about everything. The tech underneath was pretty cool, although nothing spectacular in my opinion. I don&#x27;t think I ever saw anything that deserved all that secrecy, at least in the GPU.<p>When I switched to NVidia I was surprised to find a much more open ecosystem with good public documentation. NVidia did have some tasty secret sauce stuff that they didn&#x27;t expose outright, but they did what they could to empower developers to make the best use of the underlying hardware. They strike the right balance between openness and maintaining a competitive advantage, in my view.<p>Just my opinion based on working in both companies for a number of years. Thankfully I no longer have a dog in that fight.</div><br/><div id="37774256" class="c"><input type="checkbox" id="c-37774256" checked=""/><div class="controls bullet"><span class="by">verditelabs</span><span>|</span><a href="#37773135">root</a><span>|</span><a href="#37773575">parent</a><span>|</span><a href="#37773716">next</a><span>|</span><label class="collapse" for="c-37774256">[-]</label><label class="expand" for="c-37774256">[1 more]</label></div><br/><div class="children"><div class="content">I am an ex QCOMer and agree with everything here. We always said it was a legal firm with a tech problem. That stranglehold on IP really holds the company back, IMO. Sure the licensing model made $$$ but they lose a lot of good will in the tech community.</div><br/></div></div></div></div><div id="37773716" class="c"><input type="checkbox" id="c-37773716" checked=""/><div class="controls bullet"><span class="by">my123</span><span>|</span><a href="#37773135">parent</a><span>|</span><a href="#37773575">prev</a><span>|</span><a href="#37773689">next</a><span>|</span><label class="collapse" for="c-37773716">[-]</label><label class="expand" for="c-37773716">[3 more]</label></div><br/><div class="children"><div class="content">Hello,<p>&gt; The HLOS (High-level OS) running on the Hexagon requires every &quot;applet&quot; to be signed by either the Qualcomm root cert or the OEMs cert<p>That&#x27;s no longer true since quite some years now :) See the Unsigned PDs, which are allowed for general purpose compute since at least sm8150 (Snapdragon 855).<p>Note that the articles you mention says this about it:<p>&gt; Signature-free dynamic shared objects are run inside an Unsigned PD, which is the user PD limited in its access to underlying DSP drivers and thread priorities. An Unsigned PD is designed to support only general computing applications.</div><br/><div id="37775961" class="c"><input type="checkbox" id="c-37775961" checked=""/><div class="controls bullet"><span class="by">mirsadm</span><span>|</span><a href="#37773135">root</a><span>|</span><a href="#37773716">parent</a><span>|</span><a href="#37773689">next</a><span>|</span><label class="collapse" for="c-37775961">[-]</label><label class="expand" for="c-37775961">[2 more]</label></div><br/><div class="children"><div class="content">I spent way too much time trying to make use of it with Halide and was not successful. Are you saying that this is now possible? I am the developer an app which would greatly benefit from it.</div><br/><div id="37776008" class="c"><input type="checkbox" id="c-37776008" checked=""/><div class="controls bullet"><span class="by">my123</span><span>|</span><a href="#37773135">root</a><span>|</span><a href="#37775961">parent</a><span>|</span><a href="#37773689">next</a><span>|</span><label class="collapse" for="c-37776008">[-]</label><label class="expand" for="c-37776008">[1 more]</label></div><br/><div class="children"><div class="content">Yes. Note however that the Pixel line shipped with Hexagon access restricted for non-platform Android apps however. But on other devices, things should just work.</div><br/></div></div></div></div></div></div><div id="37773689" class="c"><input type="checkbox" id="c-37773689" checked=""/><div class="controls bullet"><span class="by">tenebrisalietum</span><span>|</span><a href="#37773135">parent</a><span>|</span><a href="#37773716">prev</a><span>|</span><a href="#37775025">next</a><span>|</span><label class="collapse" for="c-37773689">[-]</label><label class="expand" for="c-37773689">[3 more]</label></div><br/><div class="children"><div class="content">The new Brew MP?</div><br/><div id="37773809" class="c"><input type="checkbox" id="c-37773809" checked=""/><div class="controls bullet"><span class="by">my123</span><span>|</span><a href="#37773135">root</a><span>|</span><a href="#37773689">parent</a><span>|</span><a href="#37774091">next</a><span>|</span><label class="collapse" for="c-37773809">[-]</label><label class="expand" for="c-37773809">[1 more]</label></div><br/><div class="children"><div class="content">I find this one funny. When I was working at qcom, was surprising to see that BREW was still not gone from the monorepo in the 2020s. (but no longer used by anybody of course)</div><br/></div></div><div id="37774091" class="c"><input type="checkbox" id="c-37774091" checked=""/><div class="controls bullet"><span class="by">girvo</span><span>|</span><a href="#37773135">root</a><span>|</span><a href="#37773689">parent</a><span>|</span><a href="#37773809">prev</a><span>|</span><a href="#37775025">next</a><span>|</span><label class="collapse" for="c-37774091">[-]</label><label class="expand" for="c-37774091">[1 more]</label></div><br/><div class="children"><div class="content">You just gave me PTSD flashbacks. Man I am getting old.</div><br/></div></div></div></div></div></div><div id="37775025" class="c"><input type="checkbox" id="c-37775025" checked=""/><div class="controls bullet"><span class="by">jgr0007</span><span>|</span><a href="#37773135">prev</a><span>|</span><a href="#37774075">next</a><span>|</span><label class="collapse" for="c-37775025">[-]</label><label class="expand" for="c-37775025">[2 more]</label></div><br/><div class="children"><div class="content">&gt; However, the Hexagon DSPs are notoriously hard to program.<p>I disagree the Hexagon is &quot;hard&quot; to program - the HVX intrinsics are fairly straightforward if you&#x27;ve used neon&#x2F;avx&#x2F;etc. The problem is that you don&#x27;t get access to the HMX&#x2F;HTA&#x2F;(whatever they call the NPU currently), just HVX. So for running on DSP your options are (1.) Qualcomm&#x27;s Hexagon SDK which doesn&#x27;t give you access to the tensor hardware, and (2.) their SNPE SDK, which actually has access to HMX&#x2F;HTA&#x2F;etc, but doesn&#x27;t let you program against the hardware directly. Instead, SNPE is <i>supposed</i> to convert your caffe&#x2F;tf&#x2F;onyx&#x2F;torch models to Qualcomm proprietary format so it can map ops to the most appropriate hardware. What actually happens is that their conversion tools fall apart the first time you don&#x27;t use one of their AlexNet&#x2F;ResNet vanilla examples and try to convert a prod-grade model. Combine the brittleness of their conversion tools with the lack of documentation&#x2F;support and it becomes impossible to use the hardware.<p>All that being said, would be interested to hear if anyone has had luck with other means of using their (admittedly impressive) hardware. Maybe a better approach would be to try using Halide for Hexagon and OpenCl for Adreno?  They were also going to release a QNN update this year or next year - not sure if they&#x27;ve allowed anyone access to it.  Its really a shame that the hardware is so good, but the software is so clunky.</div><br/><div id="37775109" class="c"><input type="checkbox" id="c-37775109" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#37775025">parent</a><span>|</span><a href="#37774075">next</a><span>|</span><label class="collapse" for="c-37775109">[-]</label><label class="expand" for="c-37775109">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I disagree the Hexagon is &quot;hard&quot; to program - the HVX intrinsics are fairly straightforward if you&#x27;ve used neon&#x2F;avx&#x2F;etc.<p>The difficulty comes in launching your code on the device from the apps core.  It&#x27;s a bit unlike many other typical conventions for this.<p>I agree that once you&#x27;re executing code there that &quot;HVX intrinsics are fairly straightforward&quot; etc</div><br/></div></div></div></div><div id="37774075" class="c"><input type="checkbox" id="c-37774075" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#37775025">prev</a><span>|</span><a href="#37774293">next</a><span>|</span><label class="collapse" for="c-37774075">[-]</label><label class="expand" for="c-37774075">[6 more]</label></div><br/><div class="children"><div class="content">&gt; However, the Hexagon DSPs are notoriously hard to program. While the Snapdragon CPU and GPU can be targeted using OpenMP and OpenCL, respectively, no such model exists for the DSP.<p>It&#x27;s true, this is a big drawback.  Something like OpenCL would be really nice.  I haven&#x27;t used OpenCL for a while but way back when the design seemed to consider that the memory used by the accelerator device was a separate destination to be copied to.  For the SoCs where Hexagon shows up, that&#x27;s generally not the case.  But hopefully there&#x27;s already some tweaks to OpenCL to enable different SMMU contexts instead of copies.</div><br/><div id="37774776" class="c"><input type="checkbox" id="c-37774776" checked=""/><div class="controls bullet"><span class="by">dsharlet</span><span>|</span><a href="#37774075">parent</a><span>|</span><a href="#37774146">next</a><span>|</span><label class="collapse" for="c-37774776">[-]</label><label class="expand" for="c-37774776">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think it&#x27;s true at all, you can just write C&#x2F;C++ with SIMD intrinsics, just like you can on ARM or x86, and the instruction set is mostly awesome. OpenCL would just be an extra layer to get in the way. If you want to just run some existing OpenCL code, I guess that would be nice, but I doubt any OpenCL code written for a GPU would actually run well on Hexagon anyways.<p>The article also complains about VLIW in the same paragraph, but I don&#x27;t think VLIW makes things harder, it just makes problems more obvious. If you write ARM or x86 code that has dependencies between every instruction, that&#x27;s going to suck too, you just won&#x27;t know it until you run it, but VLIW will make it obvious if you just look at the generated code. For the kinds of programs that make sense to run on a processor like Hexagon, VLIW is fine.<p>The whole Hexagon environment is just so much better than any of the other similar DSPs I&#x27;m aware of: you can use open source LLVM to compile code for it (so you aren&#x27;t stuck with an old version of GCC), and the OS is much closer to standard (e.g. thread synchronization is just pthreads).<p>I did a bunch of work on Hexagon and I like it a lot. It is my favorite in its class.</div><br/></div></div><div id="37774146" class="c"><input type="checkbox" id="c-37774146" checked=""/><div class="controls bullet"><span class="by">my123</span><span>|</span><a href="#37774075">parent</a><span>|</span><a href="#37774776">prev</a><span>|</span><a href="#37774293">next</a><span>|</span><label class="collapse" for="c-37774146">[-]</label><label class="expand" for="c-37774146">[4 more]</label></div><br/><div class="children"><div class="content">It has a quite nice high level programming model tbh. FastRPC is quite nice.<p>And there&#x27;s Halide support too.</div><br/><div id="37774235" class="c"><input type="checkbox" id="c-37774235" checked=""/><div class="controls bullet"><span class="by">verditelabs</span><span>|</span><a href="#37774075">root</a><span>|</span><a href="#37774146">parent</a><span>|</span><a href="#37774293">next</a><span>|</span><label class="collapse" for="c-37774235">[-]</label><label class="expand" for="c-37774235">[3 more]</label></div><br/><div class="children"><div class="content">I used to work with the Halide guys from 2019-2021; I was on the TVM team. The compilers group was very proud of Halide&#x27;s success in the early pixel phones. That was the library behind HDR+ on the Pixel 3.<p>Hexagon is a difficult architecture to write code for but the benefits are worth it: it&#x27;s the secret sauce for why Qualcomm&#x27;s modems are so good. I see people getting all excited over AVX512 and I just think &quot;well we had 2048 bit vectors years ago&quot;</div><br/><div id="37774942" class="c"><input type="checkbox" id="c-37774942" checked=""/><div class="controls bullet"><span class="by">jjtheblunt</span><span>|</span><a href="#37774075">root</a><span>|</span><a href="#37774235">parent</a><span>|</span><a href="#37774824">next</a><span>|</span><label class="collapse" for="c-37774942">[-]</label><label class="expand" for="c-37774942">[1 more]</label></div><br/><div class="children"><div class="content">ex qualcomm qct compiler person here:  qualcomm RF was so good even when Hexagon was being developed.   if they moved their advantage onto Hexagon thereafter, that&#x27;s cool.</div><br/></div></div><div id="37774824" class="c"><input type="checkbox" id="c-37774824" checked=""/><div class="controls bullet"><span class="by">nimish</span><span>|</span><a href="#37774075">root</a><span>|</span><a href="#37774235">parent</a><span>|</span><a href="#37774942">prev</a><span>|</span><a href="#37774293">next</a><span>|</span><label class="collapse" for="c-37774824">[-]</label><label class="expand" for="c-37774824">[1 more]</label></div><br/><div class="children"><div class="content">It is? And not any esoteric analog design? That explains the secrecy.</div><br/></div></div></div></div></div></div></div></div><div id="37774293" class="c"><input type="checkbox" id="c-37774293" checked=""/><div class="controls bullet"><span class="by">verditelabs</span><span>|</span><a href="#37774075">prev</a><span>|</span><label class="collapse" for="c-37774293">[-]</label><label class="expand" for="c-37774293">[3 more]</label></div><br/><div class="children"><div class="content">Qualcomm&#x27;s naming schemes are so confusing: I used to be on the QCOM Hexagon compilers team for a few years and I still don&#x27;t know what hardware unit the NPU is. Is it Hexagon Matrix Extensions(HMX)?</div><br/><div id="37774398" class="c"><input type="checkbox" id="c-37774398" checked=""/><div class="controls bullet"><span class="by">my123</span><span>|</span><a href="#37774293">parent</a><span>|</span><label class="collapse" for="c-37774398">[-]</label><label class="expand" for="c-37774398">[2 more]</label></div><br/><div class="children"><div class="content">Qualcomm has a part in maintaining that confusion sadly.<p>While Hexagon and HVX are publicly documented ISAs, HTA (legacy), HMX and friends are not publicly documented ISA extensions.</div><br/><div id="37774587" class="c"><input type="checkbox" id="c-37774587" checked=""/><div class="controls bullet"><span class="by">verditelabs</span><span>|</span><a href="#37774293">root</a><span>|</span><a href="#37774398">parent</a><span>|</span><label class="collapse" for="c-37774587">[-]</label><label class="expand" for="c-37774587">[1 more]</label></div><br/><div class="children"><div class="content">Oh yeah, I specifically worked on HMX stuff and I don&#x27;t even know. I stopped caring about keeping up with product names when we stopped using names from LOTR for our internal projects. I wish they would reveal _something_,  because currently it&#x27;s a bit of a black hole on my resume</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>