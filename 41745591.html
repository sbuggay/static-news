<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1728205269160" as="style"/><link rel="stylesheet" href="styles.css?v=1728205269160"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.dbreunig.com/2024/10/04/wikidata-is-a-giant-crosswalk-file.html">Wikidata as a Giant Crosswalk File</a> <span class="domain">(<a href="https://www.dbreunig.com">www.dbreunig.com</a>)</span></div><div class="subtext"><span>dbreunig</span> | <span>6 comments</span></div><br/><div><div id="41753527" class="c"><input type="checkbox" id="c-41753527" checked=""/><div class="controls bullet"><span class="by">e12e</span><span>|</span><a href="#41749890">next</a><span>|</span><label class="collapse" for="c-41753527">[-]</label><label class="expand" for="c-41753527">[2 more]</label></div><br/><div class="children"><div class="content">Nice!<p>&gt; However, for reasons unknown to me, they wrap these neatly separated rows with brackets ([ and ]) and add a comma to each line<p>Well, the reason (misguided or not) is as you say, I imagine:<p>&gt; so it’s a valid, JSON array containing 100+ million items.<p>&gt; We are not going to attempt to load a this massive array. Instead, we’re running this command:<p><pre><code>    zcat ..&#x2F;latest-all.json.gz | sed &#x27;s&#x2F;,$&#x2F;&#x2F;&#x27; | split -l 100000 - wd_items_cw --filter=&#x27;gzip &gt; $FILE.gz&#x27;
</code></pre>
That&#x27;s one approach - I&#x27;m always a little wary of treating a rich format like JSON as &lt;something&gt; deliminated text - I&#x27;d be curious if using jq in streaming mode is much different in run-time. I believe this snippet, the core of which we lifted from stack overflow or somewhere does the same thing; split a valid JSON array into ndjson (with tweaks to hopefully generate similar splits:<p><pre><code>    gunzip -c ..&#x2F;latest-all.json.gz \
     | jq -cn --stream \
       &#x27;fromstream(inputs|(.[0]  |= .[1:]) | select(. != [[]]) )&#x27; \
   | split -l 100000 - wd_items_cw --filter=&#x27;gzip &gt; $FILE.gz
</code></pre>
Note on MacOS zcat might not be gunzip, hence the change.</div><br/><div id="41754456" class="c"><input type="checkbox" id="c-41754456" checked=""/><div class="controls bullet"><span class="by">fiddlerwoaroof</span><span>|</span><a href="#41753527">parent</a><span>|</span><a href="#41749890">next</a><span>|</span><label class="collapse" for="c-41754456">[-]</label><label class="expand" for="c-41754456">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s too bad there aren&#x27;t more streaming JSON parsers like oboe.js[1].  It would be nice if parsing libraries always supplied an event-based approach like this in addition to parsers that build up the entire data structure in memory.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;jimhigson&#x2F;oboe.js">https:&#x2F;&#x2F;github.com&#x2F;jimhigson&#x2F;oboe.js</a><p>EDIT: looking around a bit, I found json-stream ( <a href="https:&#x2F;&#x2F;github.com&#x2F;dgraham&#x2F;json-stream">https:&#x2F;&#x2F;github.com&#x2F;dgraham&#x2F;json-stream</a> ) for Ruby.</div><br/></div></div></div></div><div id="41749890" class="c"><input type="checkbox" id="c-41749890" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#41753527">prev</a><span>|</span><a href="#41753422">next</a><span>|</span><label class="collapse" for="c-41749890">[-]</label><label class="expand" for="c-41749890">[2 more]</label></div><br/><div class="children"><div class="content">Interesting article, I think this is the first time I&#x27;ve seen someone pick Ractors over Parallel gem, cool!<p>I love seeing these quick and dirty Ruby scripts used for data processing &#x2F; filtering or whatever, this is what it is good at!</div><br/><div id="41751877" class="c"><input type="checkbox" id="c-41751877" checked=""/><div class="controls bullet"><span class="by">dbreunig</span><span>|</span><a href="#41749890">parent</a><span>|</span><a href="#41753422">next</a><span>|</span><label class="collapse" for="c-41751877">[-]</label><label class="expand" for="c-41751877">[1 more]</label></div><br/><div class="children"><div class="content">Thanks! This is a near perfect use case for Ractors since we chunked all the files and there’s no need for the file processing function to share any context.</div><br/></div></div></div></div><div id="41753422" class="c"><input type="checkbox" id="c-41753422" checked=""/><div class="controls bullet"><span class="by">nighthawk454</span><span>|</span><a href="#41749890">prev</a><span>|</span><label class="collapse" for="c-41753422">[-]</label><label class="expand" for="c-41753422">[1 more]</label></div><br/><div class="children"><div class="content">Hey cool article, thanks! Might be time to finally dive in to DuckDB</div><br/></div></div></div></div></div></div></div></body></html>