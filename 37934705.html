<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1697706062620" as="style"/><link rel="stylesheet" href="styles.css?v=1697706062620"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://akuity.io/argocon/">ArgoCon – Vendor-neutral Argo-focused Event</a> <span class="domain">(<a href="https://akuity.io">akuity.io</a>)</span></div><div class="subtext"><span>donutshop</span> | <span>13 comments</span></div><br/><div><div id="37935400" class="c"><input type="checkbox" id="c-37935400" checked=""/><div class="controls bullet"><span class="by">gouggoug</span><span>|</span><a href="#37935512">next</a><span>|</span><label class="collapse" for="c-37935400">[-]</label><label class="expand" for="c-37935400">[9 more]</label></div><br/><div class="children"><div class="content">Unrelated to ArgoCon but related to ArgoCD:<p>I’ve been working on implementing ArgoCD and I am surprised by some design choices, so I wonder if someone could shed some light as to why they were made:<p>- `Application` resources can only be created in the `argocd` namespace (argocd &gt;=2.5 tries to address this, but it is not a stable feature[0] and has bugs). This is surprising since in Kubernetes resources are generally Namespaced, or, offered in 2 flavors: `ClusterResource` and `Resource`. This is a problem on multi-tenant clusters where you do not want users to have any permissions to the `argocd` namespaces. I would have expected ArgoCD to offer `Application` and `ClusterApplication` resources.<p>- The ArgoCD controller has full admin access to the cluster, and authorization is implemented directly by ArgoCD with its own RBAC system[1]: why didn’t ArgoCD rely on the native Kubernetes RBAC system instead?<p>[0] <a href="https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;app-any-namespace&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;app...</a><p>[1] <a href="https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;rbac&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;rba...</a></div><br/><div id="37936413" class="c"><input type="checkbox" id="c-37936413" checked=""/><div class="controls bullet"><span class="by">zzyzxd</span><span>|</span><a href="#37935400">parent</a><span>|</span><a href="#37936419">next</a><span>|</span><label class="collapse" for="c-37936413">[-]</label><label class="expand" for="c-37936413">[1 more]</label></div><br/><div class="children"><div class="content">Not a maintainer, but in my own opinion:<p>- `Application` is a special CRD. You can define one application to control namespaced resources in more than one namespace, cluster-wide resources, or even resources in another cluster if the controller have access to that cluster. So how to implement secure access to applications is a difficult organization&#x2F;management problem (and not necessarily a technical problem).<p>- I don&#x27;t know why the project decided to implement its own RBAC, but I like that I can give some users limited visibility in some clusters without implementing k8s native RBAC for them. From a pure GitOps perspective, I treat it as an anti-feature because it enables a lot of imperative operations via its own API, bypassing git. But not all organizations are so comfortable to be 100% gitops, I think it&#x27;s an acceptable middle ground. And I think you can deploy ArgoCD with reduced permission just fine. I heard some folks do that, although there might be some gotchas.<p>If it&#x27;s up to me, I would completely lock down its own API&#x27;s access and just do everything from git, leaving the UI as read-only for informational purposes.</div><br/></div></div><div id="37936419" class="c"><input type="checkbox" id="c-37936419" checked=""/><div class="controls bullet"><span class="by">nurple</span><span>|</span><a href="#37935400">parent</a><span>|</span><a href="#37936413">prev</a><span>|</span><a href="#37935649">next</a><span>|</span><label class="collapse" for="c-37936419">[-]</label><label class="expand" for="c-37936419">[1 more]</label></div><br/><div class="children"><div class="content">Argo has a number of deployment and usage models, some which I think were not a part of the original design.<p>I think in the early days Argo was more intended to be interacted with via the UI, they put quite a bit of work into ACLs between their Projects, Applications, Clusters, and Repositories which would let a team pretty easily self-manage their environment. I don&#x27;t think it was as common as today, with the app-of-apps pattern, to use Argo itself to manage Argo; so while the applications themselves were a gitops workflow, the bootstrap into that workflow was UI-based.<p>My favorite install method is per-cluster, run as something that might fit better in kube-system, we use the UI primarily for status info with a few users having permissions to run actions like restart and delete. With autohealing, deleting resources is often a great way to get things &quot;unstuck&quot;.<p>Every other interaction with the cluster is via our gitops repo. We bootstrap a pretty vanilla argo install and then basically `kubectl apply -f clusters&#x2F;primary&#x2F;appofapps.yaml`. Included is an Application that takes ownership of the argo install and manages its configuration from the repo as well.<p>The Argo configuration basically has one cluster(local), one repo, and one project(default), so we don&#x27;t really use Argo&#x27;s ACL system much at all as all config happens through our standard PR approval workflow.<p>Its config is pretty flexible though, it&#x27;s based on kustomize, so it&#x27;s fairly easy to tailor it as you see fit. It doesn&#x27;t need full access to the cluster and in fact even supports a namespaced install that has no cluster access at all (often running many instances on a control cluster with k8s ACLs giving users access to their own).<p>Ultimately, I think what you&#x27;re seeing are some growing pains, but primarily features that make Argo flexible enough to target multiple types of control, ACL, repo, and cluster topologies. Them adding the ability to put Applications in other namespaces feels like a continuation down that path, just adding one more option (which I think will be pretty popular, like you mentioned, in multitenant situations).</div><br/></div></div><div id="37935649" class="c"><input type="checkbox" id="c-37935649" checked=""/><div class="controls bullet"><span class="by">boloust</span><span>|</span><a href="#37935400">parent</a><span>|</span><a href="#37936419">prev</a><span>|</span><a href="#37936268">next</a><span>|</span><label class="collapse" for="c-37935649">[-]</label><label class="expand" for="c-37935649">[1 more]</label></div><br/><div class="children"><div class="content">The permissions model could be a lot better, but ArgoCD is really designed with a git repo as the primary interface.<p>It seems there&#x27;s an expectation that ordinary ArgoCD users don&#x27;t have (write) permissions to the cluster, and handling permissions is delegated to the checks you have on your git repos.<p>It does feel like a shortcut that limits the situations where ArgoCD can be used, but I can see how this could have been justified during the design process.</div><br/></div></div><div id="37936268" class="c"><input type="checkbox" id="c-37936268" checked=""/><div class="controls bullet"><span class="by">nullify88</span><span>|</span><a href="#37935400">parent</a><span>|</span><a href="#37935649">prev</a><span>|</span><a href="#37935639">next</a><span>|</span><label class="collapse" for="c-37936268">[-]</label><label class="expand" for="c-37936268">[1 more]</label></div><br/><div class="children"><div class="content">You can use ApplicationSets which templates Applications based upon &quot;generators&quot; such as the contents of a git repo. You can add allowed destinations and resource whitelists and blacklists.
<a href="https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;applicationset&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;argo-cd.readthedocs.io&#x2F;en&#x2F;stable&#x2F;operator-manual&#x2F;app...</a>
Once something like this is setup then developers do not need access to the argocd name space and can simply deploy to the git repo.</div><br/></div></div><div id="37937825" class="c"><input type="checkbox" id="c-37937825" checked=""/><div class="controls bullet"><span class="by">linuxftw</span><span>|</span><a href="#37935400">parent</a><span>|</span><a href="#37935639">prev</a><span>|</span><a href="#37935512">next</a><span>|</span><label class="collapse" for="c-37937825">[-]</label><label class="expand" for="c-37937825">[3 more]</label></div><br/><div class="children"><div class="content">You might like Flux instead of Argo.  A single controller still reconciles cluster-wide, but it does have the ability to define resources in different namespaces and repositories, as well as dropping privileges to enforce k8s RBAC for resource creation.</div><br/><div id="37938353" class="c"><input type="checkbox" id="c-37938353" checked=""/><div class="controls bullet"><span class="by">aliasxneo</span><span>|</span><a href="#37935400">root</a><span>|</span><a href="#37937825">parent</a><span>|</span><a href="#37935512">next</a><span>|</span><label class="collapse" for="c-37938353">[-]</label><label class="expand" for="c-37938353">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m working through the Argo vs Flux debate right now. Not that they have to be mutually exclusive, just would rather start with one. It&#x27;s a pretty tough decision.</div><br/><div id="37940072" class="c"><input type="checkbox" id="c-37940072" checked=""/><div class="controls bullet"><span class="by">willejs</span><span>|</span><a href="#37935400">root</a><span>|</span><a href="#37938353">parent</a><span>|</span><a href="#37935512">next</a><span>|</span><label class="collapse" for="c-37940072">[-]</label><label class="expand" for="c-37940072">[1 more]</label></div><br/><div class="children"><div class="content">Deploy both and see which patterns you prefer, and what fits into your organisation better.<p>I have used both, but find Argo can be unnecessarily complex, and focuses solely as git as a source of truth for your k8s resources. The image updater can even write back to git to reflect version numbers etc, which is arguably an anti-pattern (git is not a database). However, the UI is excellent and is very powerful, and if your just getting started in the gitops space, its very intuitive.<p>I feel like the weaveworks team (who created flux) have encountered the problem of using git as a source of truth at scale. They let you specify other sources such as S3 and OCI containers, this gives you a lot more power to build custom, powerful workflows.<p>This means that you define your k8s resources (kustomizations definitions defining k8s resources, and flux resources) in git, but build, lint and test them in a CI&#x2F;CD pipeline and publish them as a container. Then you can just tag that container with the cluster name or environment and treat your k8s resources like you would code. You can observe this with the flux ui too.<p>I think people get too hung up on the git part of gitops. All infrastructure should be defined in a version control system, and follow a sane CI process, but the way your cluster pulls that state to enforce it should be any source that is a reflection of that versioned code in SCM.</div><br/></div></div></div></div></div></div></div></div><div id="37935512" class="c"><input type="checkbox" id="c-37935512" checked=""/><div class="controls bullet"><span class="by">hijinks</span><span>|</span><a href="#37935400">prev</a><span>|</span><label class="collapse" for="c-37935512">[-]</label><label class="expand" for="c-37935512">[3 more]</label></div><br/><div class="children"><div class="content">got a laugh that harness is a sponsor.<p>A company there probably trying to trick people that use argo to pay for their overpriced saas service.</div><br/><div id="37936877" class="c"><input type="checkbox" id="c-37936877" checked=""/><div class="controls bullet"><span class="by">zinclozenge</span><span>|</span><a href="#37935512">parent</a><span>|</span><a href="#37938908">next</a><span>|</span><label class="collapse" for="c-37936877">[-]</label><label class="expand" for="c-37936877">[1 more]</label></div><br/><div class="children"><div class="content">Overpriced? Can&#x27;t say I disagree with you, but Harness was by far the best CD solution I&#x27;ve ever used, and to this day I&#x27;m still waiting for an open source solution to replicate the experience, without needing to deploy resource hungry services.</div><br/></div></div><div id="37938908" class="c"><input type="checkbox" id="c-37938908" checked=""/><div class="controls bullet"><span class="by">ofrzeta</span><span>|</span><a href="#37935512">parent</a><span>|</span><a href="#37936877">prev</a><span>|</span><label class="collapse" for="c-37938908">[-]</label><label class="expand" for="c-37938908">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s also an open source version: <a href="https:&#x2F;&#x2F;github.com&#x2F;harness&#x2F;harness-cd-community">https:&#x2F;&#x2F;github.com&#x2F;harness&#x2F;harness-cd-community</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>