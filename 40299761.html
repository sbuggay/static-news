<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1715245271374" as="style"/><link rel="stylesheet" href="styles.css?v=1715245271374"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://neon.tech/blog/bringing-psqls-d-to-your-web-browser">Bringing psql’s \d to your web browser</a> <span class="domain">(<a href="https://neon.tech">neon.tech</a>)</span></div><div class="subtext"><span>gmac</span> | <span>25 comments</span></div><br/><div><div id="40301062" class="c"><input type="checkbox" id="c-40301062" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#40306343">next</a><span>|</span><label class="collapse" for="c-40301062">[-]</label><label class="expand" for="c-40301062">[13 more]</label></div><br/><div class="children"><div class="content">I always thought that most \-commands in psql were just frontends for queries? For example:<p><pre><code>  % psql db_name
  
  (1)=# \set ECHO_HIDDEN
  
  (1)=# \d
  ********* QUERY **********
  SELECT n.nspname as &quot;Schema&quot;,
    c.relname as &quot;Name&quot;,
    CASE c.relkind WHEN &#x27;r&#x27; THEN &#x27;table&#x27; WHEN &#x27;v&#x27; THEN &#x27;view&#x27; WHEN &#x27;m&#x27; THEN &#x27;materialized view&#x27; WHEN &#x27;i&#x27; THEN &#x27;index&#x27; WHEN &#x27;S&#x27; TH
  EN &#x27;sequence&#x27; WHEN &#x27;t&#x27; THEN &#x27;TOAST table&#x27; WHEN &#x27;f&#x27; THEN &#x27;foreign table&#x27; WHEN &#x27;p&#x27; THEN &#x27;partitioned table&#x27; WHEN &#x27;I&#x27; THEN &#x27;partit
  ioned index&#x27; END as &quot;Type&quot;,
    pg_catalog.pg_get_userbyid(c.relowner) as &quot;Owner&quot;
  FROM pg_catalog.pg_class c
       LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
       LEFT JOIN pg_catalog.pg_am am ON am.oid = c.relam
  WHERE c.relkind IN (&#x27;r&#x27;,&#x27;p&#x27;,&#x27;v&#x27;,&#x27;m&#x27;,&#x27;S&#x27;,&#x27;f&#x27;,&#x27;&#x27;)
        AND n.nspname &lt;&gt; &#x27;pg_catalog&#x27;
        AND n.nspname !~ &#x27;^pg_toast&#x27;
        AND n.nspname &lt;&gt; &#x27;information_schema&#x27;
    AND pg_catalog.pg_table_is_visible(c.oid)
  ORDER BY 1,2;
  **************************
  
                            List of relations
   Schema │                  Name                  │   Type   │ Owner
  ────────┼────────────────────────────────────────┼──────────┼────────
  ...
</code></pre>
I re-implemented quite a bit of that in a PostgreSQL management tool I built, based just on the ECHO_HIDDEN queries. Never even had to look at any C code.<p>I&#x27;m not sure if I entirely follow what translating C to JS gives you, other than a bit of (fairly simple) parsing of \cmd and flags? I didn&#x27;t look too carefully at the code, so maybe I&#x27;m missing something.</div><br/><div id="40302023" class="c"><input type="checkbox" id="c-40302023" checked=""/><div class="controls bullet"><span class="by">matharmin</span><span>|</span><a href="#40301062">parent</a><span>|</span><a href="#40301378">next</a><span>|</span><label class="collapse" for="c-40302023">[-]</label><label class="expand" for="c-40302023">[1 more]</label></div><br/><div class="children"><div class="content">If you just need one or two of the commands, just using those queries directly is easy.<p>If you want to support <i>all</i> of them, including handling all the different Postgres versions, it becomes quite a lot to implement.</div><br/></div></div><div id="40301378" class="c"><input type="checkbox" id="c-40301378" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#40301062">parent</a><span>|</span><a href="#40302023">prev</a><span>|</span><a href="#40301138">next</a><span>|</span><label class="collapse" for="c-40301378">[-]</label><label class="expand" for="c-40301378">[3 more]</label></div><br/><div class="children"><div class="content">Some commands issue multiple queries and include logic for stitching the results into a nice table. There’s not a one-to-one mapping from commands to queries by any means.</div><br/><div id="40301428" class="c"><input type="checkbox" id="c-40301428" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#40301062">root</a><span>|</span><a href="#40301378">parent</a><span>|</span><a href="#40301138">next</a><span>|</span><label class="collapse" for="c-40301428">[-]</label><label class="expand" for="c-40301428">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, that&#x27;s right; but the &quot;glue code&quot; I&#x27;ve had to write for this has been really minimal. Certainly less effort than translating C to JavaScript with regexps (that on its own is something of an accomplishment). I didn&#x27;t port everything so maybe I missed some more complex bits.<p>I mean, if this works well for you then that&#x27;s grand; just wanted to point out to others that \-commands are typically very &quot;non-magic&quot; and you don&#x27;t need to go the route of translating C code.</div><br/><div id="40301745" class="c"><input type="checkbox" id="c-40301745" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#40301062">root</a><span>|</span><a href="#40301428">parent</a><span>|</span><a href="#40301138">next</a><span>|</span><label class="collapse" for="c-40301745">[-]</label><label class="expand" for="c-40301745">[1 more]</label></div><br/><div class="children"><div class="content">Certainly there’s a decently long tail of rarely-used commands, obscure features of commands, and multiple code paths supporting multiple server versions.</div><br/></div></div></div></div></div></div><div id="40301138" class="c"><input type="checkbox" id="c-40301138" checked=""/><div class="controls bullet"><span class="by">meepmorp</span><span>|</span><a href="#40301062">parent</a><span>|</span><a href="#40301378">prev</a><span>|</span><a href="#40302089">next</a><span>|</span><label class="collapse" for="c-40301138">[-]</label><label class="expand" for="c-40301138">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I don&#x27;t understand why they&#x27;d translate the C code instead of just writing catalog&#x2F;info schema queries, which seems easier AND more educational.</div><br/></div></div></div></div><div id="40306343" class="c"><input type="checkbox" id="c-40306343" checked=""/><div class="controls bullet"><span class="by">stuaxo</span><span>|</span><a href="#40301062">prev</a><span>|</span><a href="#40300964">next</a><span>|</span><label class="collapse" for="c-40306343">[-]</label><label class="expand" for="c-40306343">[1 more]</label></div><br/><div class="children"><div class="content">Thw convertet is nice, I could imagine it being it&#x27;s own library, with the generator, and a release including the generated code every postures release.</div><br/></div></div><div id="40300964" class="c"><input type="checkbox" id="c-40300964" checked=""/><div class="controls bullet"><span class="by">williamjackson</span><span>|</span><a href="#40306343">prev</a><span>|</span><a href="#40302757">next</a><span>|</span><label class="collapse" for="c-40300964">[-]</label><label class="expand" for="c-40300964">[2 more]</label></div><br/><div class="children"><div class="content">The fact that this is not a manual reimplementation, but a &quot;transpilation&quot; of the psql source from C to JavaScript, makes this super interesting to me.<p><pre><code>    From the Postgres master branch (17devel), we take exec_command_d, exec_command_list and exec_command_sf_sv from command.c, and all of describe.c and sql_help.c, from src&#x2F;bin&#x2F;psql.
    We use plenty of RegExp search-and-replace to turn this C code into valid JS syntax.
    We implement some C library functions, such as strlen and strchr, and some Postgres support functions, such as printTable and printQuery, in JavaScript.
</code></pre>
Read more here: <a href="https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;bringing-psqls-d-to-your-web-browser" rel="nofollow">https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;bringing-psqls-d-to-your-web-browser</a></div><br/><div id="40301781" class="c"><input type="checkbox" id="c-40301781" checked=""/><div class="controls bullet"><span class="by">ivanjermakov</span><span>|</span><a href="#40300964">parent</a><span>|</span><a href="#40302757">next</a><span>|</span><label class="collapse" for="c-40301781">[-]</label><label class="expand" for="c-40301781">[1 more]</label></div><br/><div class="children"><div class="content">When I started my programming journey I thought I could just &quot;translate&quot; Pascal to C++ just with search&#x2F;replace and minor adjustments. Turns out sometimes it&#x27;s the best approach :)</div><br/></div></div></div></div><div id="40302757" class="c"><input type="checkbox" id="c-40302757" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#40300964">prev</a><span>|</span><a href="#40300957">next</a><span>|</span><label class="collapse" for="c-40302757">[-]</label><label class="expand" for="c-40302757">[2 more]</label></div><br/><div class="children"><div class="content">OP and library author here. You’ll find the background to this in this blog post: <a href="https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;bringing-psqls-d-to-your-web-browser" rel="nofollow">https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;bringing-psqls-d-to-your-web-browser</a></div><br/><div id="40305644" class="c"><input type="checkbox" id="c-40305644" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#40302757">parent</a><span>|</span><a href="#40300957">next</a><span>|</span><label class="collapse" for="c-40305644">[-]</label><label class="expand" for="c-40305644">[1 more]</label></div><br/><div class="children"><div class="content">Ok, we&#x27;ve changed the URL to that from <a href="https:&#x2F;&#x2F;github.com&#x2F;neondatabase&#x2F;psql-describe">https:&#x2F;&#x2F;github.com&#x2F;neondatabase&#x2F;psql-describe</a> above. Thanks!</div><br/></div></div></div></div><div id="40300957" class="c"><input type="checkbox" id="c-40300957" checked=""/><div class="controls bullet"><span class="by">darby_eight</span><span>|</span><a href="#40302757">prev</a><span>|</span><a href="#40300994">next</a><span>|</span><label class="collapse" for="c-40300957">[-]</label><label class="expand" for="c-40300957">[3 more]</label></div><br/><div class="children"><div class="content">This seems really cool, but also a nightmare to maintain. What are the plans for keeping this in sync with the upstream codebase?</div><br/><div id="40301349" class="c"><input type="checkbox" id="c-40301349" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#40300957">parent</a><span>|</span><a href="#40301327">next</a><span>|</span><label class="collapse" for="c-40301349">[-]</label><label class="expand" for="c-40301349">[1 more]</label></div><br/><div class="children"><div class="content">OP (and library author) here. This is a fair point, and one I freely admit to in the accompanying blog post. It’s probably not crucial to sync more than once per major Postgres version, but we’re still figuring out how we’ll deal with this.</div><br/></div></div><div id="40301327" class="c"><input type="checkbox" id="c-40301327" checked=""/><div class="controls bullet"><span class="by">sroussey</span><span>|</span><a href="#40300957">parent</a><span>|</span><a href="#40301349">prev</a><span>|</span><a href="#40300994">next</a><span>|</span><label class="collapse" for="c-40301327">[-]</label><label class="expand" for="c-40301327">[1 more]</label></div><br/><div class="children"><div class="content">uses emscripten to compile the C to WASM, so it’s automated.</div><br/></div></div></div></div><div id="40300994" class="c"><input type="checkbox" id="c-40300994" checked=""/><div class="controls bullet"><span class="by">codesnik</span><span>|</span><a href="#40300957">prev</a><span>|</span><label class="collapse" for="c-40300994">[-]</label><label class="expand" for="c-40300994">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure I understand how to use that.</div><br/><div id="40301370" class="c"><input type="checkbox" id="c-40301370" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#40300994">parent</a><span>|</span><a href="#40301091">next</a><span>|</span><label class="collapse" for="c-40301370">[-]</label><label class="expand" for="c-40301370">[1 more]</label></div><br/><div class="children"><div class="content">It’s used in Neon’s web-based console to support \d and friends alongside regular SQL queries.<p>You might well never need to use it, but if you’re building an online query editor it could be very handy!</div><br/></div></div><div id="40301091" class="c"><input type="checkbox" id="c-40301091" checked=""/><div class="controls bullet"><span class="by">theogravity</span><span>|</span><a href="#40300994">parent</a><span>|</span><a href="#40301370">prev</a><span>|</span><label class="collapse" for="c-40301091">[-]</label><label class="expand" for="c-40301091">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I don&#x27;t really get where &#x2F; how I would use this. The documentation is really lacking on outlining the usage &#x2F; use-case.</div><br/></div></div></div></div></div></div></div></div></div></body></html>