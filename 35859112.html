<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683622856911" as="style"/><link rel="stylesheet" href="styles.css?v=1683622856911"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.sommarskog.se/dynamic_sql.html">The curse and blessings of dynamic SQL (2004-2022)</a> <span class="domain">(<a href="https://www.sommarskog.se">www.sommarskog.se</a>)</span></div><div class="subtext"><span>ingve</span> | <span>9 comments</span></div><br/><div><div id="35871334" class="c"><input type="checkbox" id="c-35871334" checked=""/><div class="controls bullet"><span class="by">tragomaskhalos</span><span>|</span><a href="#35870534">next</a><span>|</span><label class="collapse" for="c-35871334">[-]</label><label class="expand" for="c-35871334">[1 more]</label></div><br/><div class="children"><div class="content">Historically at least a common use case for dynamic sql was to build up a predicate based on user-selected filters, where the user can select one or more conditions from a larger set. Handling this with a single static query requires the planner to deal gracefully with constructions like &#x27;where @opt_param is null or some_col = @opt_param&#x27;, particularly where the choice of index depends on which filters have been selected. Having not gone near such cases for a long time, I&#x27;d <i>hope</i> that the major dbs have become rather good at handling such cases these days.<p>Edit: the sanest solution, then and now, is probably to select between a number of alternative static queries based on what index values have been supplied, and to use the &#x27;is null or&#x27; construction for other filters.</div><br/></div></div><div id="35870534" class="c"><input type="checkbox" id="c-35870534" checked=""/><div class="controls bullet"><span class="by">Pxtl</span><span>|</span><a href="#35871334">prev</a><span>|</span><label class="collapse" for="c-35870534">[-]</label><label class="expand" for="c-35870534">[7 more]</label></div><br/><div class="children"><div class="content">Never ask me to review or support any code that&#x27;s using dynamic SQL written in MS T-Sql or Oracle.  Not that dynamic SQL is inherently bad, but the procedural and string-management tools of those languages are appallingly awful and SQL is a bad tool for templating&#x2F;smashing strings together.<p>Which, fundamentally, is what dynamic SQL is.<p>When I realized the article was going to be about that kind of dynamic SQL, I closed the tab.<p>Building SQL queries dynamically is fine.<p>Doing it within the SQL server is an abomination.</div><br/><div id="35870767" class="c"><input type="checkbox" id="c-35870767" checked=""/><div class="controls bullet"><span class="by">wfriesen</span><span>|</span><a href="#35870534">parent</a><span>|</span><a href="#35870802">next</a><span>|</span><label class="collapse" for="c-35870767">[-]</label><label class="expand" for="c-35870767">[4 more]</label></div><br/><div class="children"><div class="content">Coming from an Oracle background, both application and data warehousing, I wholeheartedly agree with the articles first paragraph saying that application based dynamic SQL is horrible, but DBA (and I&#x27;ll include data warehousing) dynamic SQL is great, but it&#x27;s essentially about how complex the thing is.<p>A DBA is likely doing things like looping over metadata tables and running<p><pre><code>  &#x27;grant select on &#x27; || some_table || &#x27; to &#x27; || some_user
</code></pre>
While an app developer with free reign will end up doing something much more complex, and much harder to reason about&#x2F;tune</div><br/><div id="35871330" class="c"><input type="checkbox" id="c-35871330" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#35870534">root</a><span>|</span><a href="#35870767">parent</a><span>|</span><a href="#35870802">next</a><span>|</span><label class="collapse" for="c-35871330">[-]</label><label class="expand" for="c-35871330">[3 more]</label></div><br/><div class="children"><div class="content">What about some_user has characters that need to be escaped?</div><br/><div id="35871598" class="c"><input type="checkbox" id="c-35871598" checked=""/><div class="controls bullet"><span class="by">rickboyce</span><span>|</span><a href="#35870534">root</a><span>|</span><a href="#35871330">parent</a><span>|</span><a href="#35871709">prev</a><span>|</span><a href="#35870802">next</a><span>|</span><label class="collapse" for="c-35871598">[-]</label><label class="expand" for="c-35871598">[1 more]</label></div><br/><div class="children"><div class="content">The parent article touches on this point too - both Oracle and SQL Server (and any other major db) supports parameterising values in dynamic sql. some_user would become @some_user (SQL Server) or :some_user (Oracle).<p>(The characters never actually get escaped with parameterisation - they are not part of the query text when it is parsed so can’t affect it - hence parameterising a value in sql query replaces the need to escape it with something much more robust.)</div><br/></div></div></div></div></div></div><div id="35870802" class="c"><input type="checkbox" id="c-35870802" checked=""/><div class="controls bullet"><span class="by">mrbungie</span><span>|</span><a href="#35870534">parent</a><span>|</span><a href="#35870767">prev</a><span>|</span><label class="collapse" for="c-35870802">[-]</label><label class="expand" for="c-35870802">[2 more]</label></div><br/><div class="children"><div class="content">This, if you want to go the dynamic SQL route, please do it using some decent glue language or templating system that is not SQL itself. Unless you hate yourself that is.</div><br/><div id="35871633" class="c"><input type="checkbox" id="c-35871633" checked=""/><div class="controls bullet"><span class="by">rickboyce</span><span>|</span><a href="#35870534">root</a><span>|</span><a href="#35870802">parent</a><span>|</span><label class="collapse" for="c-35871633">[-]</label><label class="expand" for="c-35871633">[1 more]</label></div><br/><div class="children"><div class="content">For analytics work tools like dbt are really gaining traction for this reason.<p>Most of the OLAP &#x2F; warehousing stuff I used to lean on dynamic sql for can be done more cleanly, with the benefit of easy source control.<p><a href="https:&#x2F;&#x2F;www.getdbt.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.getdbt.com&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>