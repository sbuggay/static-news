<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729328451863" as="style"/><link rel="stylesheet" href="styles.css?v=1729328451863"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://evanhahn.com/set-big-timeout/">setBigTimeout</a> <span class="domain">(<a href="https://evanhahn.com">evanhahn.com</a>)</span></div><div class="subtext"><span>cfj</span> | <span>98 comments</span></div><br/><div><div id="41880898" class="c"><input type="checkbox" id="c-41880898" checked=""/><div class="controls bullet"><span class="by">n2d4</span><span>|</span><a href="#41884139">next</a><span>|</span><label class="collapse" for="c-41880898">[-]</label><label class="expand" for="c-41880898">[25 more]</label></div><br/><div class="children"><div class="content">The default behaviour of setTimeout seems problematic. Could be used for an exploit, because code like this might not work as expected:<p><pre><code>    const attackerControlled = ...;
    if (attackerControlled &lt; 60_000) {
      throw new Error(&quot;Must wait at least 1min!&quot;);
    }

    setTimeout(() =&gt; {
      console.log(&quot;Surely at least 1min has passed!&quot;);
    }, attackerControlled);

</code></pre>
The attacker could set the value to a comically large number and the callback would execute immediately.  This also seems to be true for NaN. The better solution (imo) would be to throw an error, but I assume we can&#x27;t due to backwards compatibility.</div><br/><div id="41881042" class="c"><input type="checkbox" id="c-41881042" checked=""/><div class="controls bullet"><span class="by">arghwhat</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41881774">next</a><span>|</span><label class="collapse" for="c-41881042">[-]</label><label class="expand" for="c-41881042">[8 more]</label></div><br/><div class="children"><div class="content">A scenario where an attacker can control a timeout where having the callback run sooner than one minute later would lead to security failures, but having it set to run days later is perfectly fine and so no upper bound check is required seems… quite a constructed edge case.<p>The problem here is having an attacker control a security sensitive timer in the first place.</div><br/><div id="41881665" class="c"><input type="checkbox" id="c-41881665" checked=""/><div class="controls bullet"><span class="by">a_cardboard_box</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881042">parent</a><span>|</span><a href="#41881774">next</a><span>|</span><label class="collapse" for="c-41881665">[-]</label><label class="expand" for="c-41881665">[7 more]</label></div><br/><div class="children"><div class="content">The exploit could be a DoS attack. I don&#x27;t think it&#x27;s that contrived to have a service that runs an expensive operation at a fixed rate, controlled by the user, limited to 1 operation per minute.</div><br/><div id="41883672" class="c"><input type="checkbox" id="c-41883672" checked=""/><div class="controls bullet"><span class="by">arghwhat</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881665">parent</a><span>|</span><a href="#41882211">next</a><span>|</span><label class="collapse" for="c-41883672">[-]</label><label class="expand" for="c-41883672">[2 more]</label></div><br/><div class="children"><div class="content">A minimum timing of an individual task is not a useful rate limit. I could schedule a bunch of tasks to happen far into the future but all at once for example.<p>Rate limits are implemented with e.g., token buckets which fill to a limit at a fixed rate. Timed tasks would then on run try to take a token, and if none is present wait for one. This would then be dutifully enforced regardless of the current state of scheduled tasks.<p>Only consideration for the timer itself would be to always add random jitter to avoid having peak loads coalesce.</div><br/><div id="41885533" class="c"><input type="checkbox" id="c-41885533" checked=""/><div class="controls bullet"><span class="by">lemagedurage</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41883672">parent</a><span>|</span><a href="#41882211">next</a><span>|</span><label class="collapse" for="c-41885533">[-]</label><label class="expand" for="c-41885533">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think it&#x27;s that far fetched that a developer implements a rate limiter with setTimeout, where a task can only be executed if a timeout is not already running. The behaviour in the article is definitely a footgun in this scenario.</div><br/></div></div></div></div><div id="41882211" class="c"><input type="checkbox" id="c-41882211" checked=""/><div class="controls bullet"><span class="by">lucideer</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881665">parent</a><span>|</span><a href="#41883672">prev</a><span>|</span><a href="#41881774">next</a><span>|</span><label class="collapse" for="c-41882211">[-]</label><label class="expand" for="c-41882211">[4 more]</label></div><br/><div class="children"><div class="content">&gt; <i>I don&#x27;t think it&#x27;s that contrived to have a service that runs an expensive operation at a fixed rate, controlled by the user</i><p>Maybe not contrived but definitely insecure by definition. Allowing user control of rates is definitely useful &amp; a power devs will need to grant but it should never be direct control.</div><br/><div id="41882396" class="c"><input type="checkbox" id="c-41882396" checked=""/><div class="controls bullet"><span class="by">shawnz</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41882211">parent</a><span>|</span><a href="#41881774">next</a><span>|</span><label class="collapse" for="c-41882396">[-]</label><label class="expand" for="c-41882396">[3 more]</label></div><br/><div class="children"><div class="content">Can you elaborate on what <i>indirect</i> control would look like in your opinion?<p>No matter how many layers of abstraction you put in between, you&#x27;re still eventually going to be passing a value to the setTimeout function that was computed based on something the user inputted, right?<p>If you&#x27;re not aware of these caveats about extremely high timeout values, how do any layers of abstraction in between help you prevent this? As far as I can see, the only prevention is knowing about the caveats and specifically adding validation for them.</div><br/><div id="41882973" class="c"><input type="checkbox" id="c-41882973" checked=""/><div class="controls bullet"><span class="by">lucideer</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41882396">parent</a><span>|</span><a href="#41885728">next</a><span>|</span><label class="collapse" for="c-41882973">[-]</label><label class="expand" for="c-41882973">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>that was computed</i><p>Or comes from a set of known values. This stuff isn&#x27;t that difficult.<p>This doesn&#x27;t require prescient knowledge of high timeout edge cases. It&#x27;s generally accepted good security practice to limit business logic execution based on user input parameters. This goes beyond input validation &amp; bounds on user input (both also good practice but most likely to just involve a !NaN check here), but more broadly user input is data &amp; timeout values are code. Data should be treated differently by your app than code.<p>To generalise the case more, another common case of a user submitting a config value that would be used in logic would be string labels for categories. You could validate against a known list of categories (good but potentially expensive) but whether you do or not it&#x27;s still good hygiene to key the user submitted string against a category hashmap or enum - this cleanly avoids using user input directly in your executing business logic.</div><br/></div></div><div id="41885728" class="c"><input type="checkbox" id="c-41885728" checked=""/><div class="controls bullet"><span class="by">bryanrasmussen</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41882396">parent</a><span>|</span><a href="#41882973">prev</a><span>|</span><a href="#41881774">next</a><span>|</span><label class="collapse" for="c-41885728">[-]</label><label class="expand" for="c-41885728">[1 more]</label></div><br/><div class="children"><div class="content">&gt;Can you elaborate on what indirect control would look like in your opinion?<p>although not the OP this is what I would mean by indirect control.<p>pseudo
if userAccountType === &quot;free&quot; then rate = longRate<p>if userAccountType === &quot;base&quot; then rate = infrequentRate<p>if userAccountType === &quot;important&quot; then rate = frequentRate<p>obviously rate determination would probably be more complicated than just userAccountType</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41881774" class="c"><input type="checkbox" id="c-41881774" checked=""/><div class="controls bullet"><span class="by">swatcoder</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41881042">prev</a><span>|</span><a href="#41882110">next</a><span>|</span><label class="collapse" for="c-41881774">[-]</label><label class="expand" for="c-41881774">[8 more]</label></div><br/><div class="children"><div class="content">That&#x27;s just terrible input validation and has nothing to do with setTimeout.<p>If your code would misbehave outside a certain range of values and you&#x27;re input might span a larger range, <i>you should be checking your input against the range that&#x27;s valid</i>. Your sample code simply doesn&#x27;t do that, and that&#x27;s why there&#x27;s a bug.<p>That the bug happens to involve a timer is irrelevant.</div><br/><div id="41885121" class="c"><input type="checkbox" id="c-41885121" checked=""/><div class="controls bullet"><span class="by">ashkankiani</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881774">parent</a><span>|</span><a href="#41881907">next</a><span>|</span><label class="collapse" for="c-41885121">[-]</label><label class="expand" for="c-41885121">[3 more]</label></div><br/><div class="children"><div class="content">You are a bad programmer if you think silently doing the wrong thing is not a bug. The right thing to do with unexpected input as the setTimeout library author is to raise an exception.</div><br/><div id="41885327" class="c"><input type="checkbox" id="c-41885327" checked=""/><div class="controls bullet"><span class="by">log_e</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41885121">parent</a><span>|</span><a href="#41881907">next</a><span>|</span><label class="collapse" for="c-41885327">[-]</label><label class="expand" for="c-41885327">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s in the standard library. You&#x27;re a bad programmer if you don&#x27;t learn the ins and outs of the standard library, or make sweeping generalizations.</div><br/><div id="41885647" class="c"><input type="checkbox" id="c-41885647" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41885327">parent</a><span>|</span><a href="#41881907">next</a><span>|</span><label class="collapse" for="c-41885647">[-]</label><label class="expand" for="c-41885647">[1 more]</label></div><br/><div class="children"><div class="content">Standard library is an API just like any other library. The only thing different about it is backward compatibility (which in JS is paramount and the is reason setTimeout can&#x27;t be fixed directly). It is a bad design still.</div><br/></div></div></div></div></div></div><div id="41881907" class="c"><input type="checkbox" id="c-41881907" checked=""/><div class="controls bullet"><span class="by">tourist2d</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881774">parent</a><span>|</span><a href="#41885121">prev</a><span>|</span><a href="#41882110">next</a><span>|</span><label class="collapse" for="c-41881907">[-]</label><label class="expand" for="c-41881907">[4 more]</label></div><br/><div class="children"><div class="content">&gt; That&#x27;s just terrible input validation and has nothing to do with setTimeout.<p>Except for the fact that this behaviour is surprising.<p>&gt;  you should be checking your input against the range that&#x27;s valid. Your sample code simply doesn&#x27;t do that, and that&#x27;s why there&#x27;s a bug.<p>Indeed, so why doesn&#x27;t setTimeout internally do that?</div><br/><div id="41881963" class="c"><input type="checkbox" id="c-41881963" checked=""/><div class="controls bullet"><span class="by">drdaeman</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881907">parent</a><span>|</span><a href="#41882110">next</a><span>|</span><label class="collapse" for="c-41881963">[-]</label><label class="expand" for="c-41881963">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Indeed, so why doesn&#x27;t setTimeout internally do that?<p>Given that `setTimeout` is a part of JavaScript&#x27;s ancient reptilian brain, I wouldn&#x27;t be surprised it doesn&#x27;t do those checks just because there&#x27;s some silly compatibility requirement still lingering and no one in the committees is brave enough to make a breaking change.<p>(And then, what should setTimeout do if delay is NaN? Do nothing? Call immediately? Throw an exception? Personally I&#x27;d prefer it to throw, but I don&#x27;t think there&#x27;s any single undeniably correct answer.)<p>Given the trend to move away from the callbacks, I wonder why there is no `async function sleep(delay)` in the language, that would be free to sort this out nicely without having to be compatible with stuff from &#x27;90s. Or something like that.</div><br/><div id="41886594" class="c"><input type="checkbox" id="c-41886594" checked=""/><div class="controls bullet"><span class="by">erinaceousjones</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881963">parent</a><span>|</span><a href="#41883936">next</a><span>|</span><label class="collapse" for="c-41886594">[-]</label><label class="expand" for="c-41886594">[1 more]</label></div><br/><div class="children"><div class="content">I think it&#x27;s more likely that it&#x27;s just &quot;undefined behaviour&quot; and up to the implementers of the JavaScript engines.  Given that modern browsers do limit and throttle how much you can do with setTimeout in some situations (try to use setTimeout on a page after you&#x27;ve switched to a VR context!  More than like 120hz and it&#x27;ll just.... Not run the timeout anymore, from experience with Chrome).<p>The browser devs have decided it&#x27;s acceptable to change the behaviour of setTimeout in some situations.<p><a href="https:&#x2F;&#x2F;developer.chrome.com&#x2F;blog&#x2F;timer-throttling-in-chrome-88&#x2F;" rel="nofollow">https:&#x2F;&#x2F;developer.chrome.com&#x2F;blog&#x2F;timer-throttling-in-chrome...</a></div><br/></div></div></div></div></div></div></div></div><div id="41882110" class="c"><input type="checkbox" id="c-41882110" checked=""/><div class="controls bullet"><span class="by">wging</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41881774">prev</a><span>|</span><a href="#41884957">next</a><span>|</span><label class="collapse" for="c-41882110">[-]</label><label class="expand" for="c-41882110">[3 more]</label></div><br/><div class="children"><div class="content">In nodejs you at least get a warning along with the problematic behavior:<p><pre><code>    Welcome to Node.js v22.7.0.
    Type &quot;.help&quot; for more information.
    &gt; setTimeout(() =&gt; console.log(&#x27;reached&#x27;), 3.456e9)
    Timeout { &lt;contents elided&gt; }
    &gt; (node:64799) TimeoutOverflowWarning: 3456000000 does not fit into a 32-bit signed integer.
    Timeout duration was set to 1.
    (Use `node --trace-warnings ...` to show where the warning was created)
    reached
</code></pre>
I&#x27;m surprised to see that setTimeout returns an object - I assume at one point it was an integer identifying the timer, the same way it is on the web. (I think I remember it being so at one point.)</div><br/><div id="41884284" class="c"><input type="checkbox" id="c-41884284" checked=""/><div class="controls bullet"><span class="by">dgoldstein0</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41882110">parent</a><span>|</span><a href="#41882311">next</a><span>|</span><label class="collapse" for="c-41884284">[-]</label><label class="expand" for="c-41884284">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s return your differs between node and in a browser.  If you want to type a variable to hold the return value in typescript and share that across node (eg jest tests where you might include @types&#x2F;node) and the browser you need ReturnType&lt;typeof setTimeout&gt;, otherwise the code won&#x27;t typecheck in all cases.  Similar with setInterval.</div><br/></div></div><div id="41882311" class="c"><input type="checkbox" id="c-41882311" checked=""/><div class="controls bullet"><span class="by">augusto-moura</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41882110">parent</a><span>|</span><a href="#41884284">prev</a><span>|</span><a href="#41884957">next</a><span>|</span><label class="collapse" for="c-41882311">[-]</label><label class="expand" for="c-41882311">[1 more]</label></div><br/><div class="children"><div class="content">It returns an object for a long time now, I might say it was always like this actually. Don&#x27;t know about very old versions</div><br/></div></div></div></div><div id="41884957" class="c"><input type="checkbox" id="c-41884957" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41882110">prev</a><span>|</span><a href="#41884470">next</a><span>|</span><label class="collapse" for="c-41884957">[-]</label><label class="expand" for="c-41884957">[1 more]</label></div><br/><div class="children"><div class="content">I always try to force the timeout to 0 on those really annoying download sites that try to make me wait.<p>Sometimes the wait is over before I find the responsible code, and sometimes it does check server-side, but that&#x27;s just part of the fun...</div><br/></div></div><div id="41884470" class="c"><input type="checkbox" id="c-41884470" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41884957">prev</a><span>|</span><a href="#41881074">next</a><span>|</span><label class="collapse" for="c-41884470">[-]</label><label class="expand" for="c-41884470">[1 more]</label></div><br/><div class="children"><div class="content">One could imagine an app that doubles the wait between each failed authentication attempt could exploit this by doggedly trying until the rate limiter breaks.  Maybe not the most practical attack, but it is a way this behavior could bite you.</div><br/></div></div><div id="41881074" class="c"><input type="checkbox" id="c-41881074" checked=""/><div class="controls bullet"><span class="by">sfvisser</span><span>|</span><a href="#41880898">parent</a><span>|</span><a href="#41884470">prev</a><span>|</span><a href="#41884139">next</a><span>|</span><label class="collapse" for="c-41881074">[-]</label><label class="expand" for="c-41881074">[3 more]</label></div><br/><div class="children"><div class="content">Don’t ever use attacker controlled data directly in your source code without validation. Don’t blame setTimeout for this, it’s impolite!</div><br/><div id="41881265" class="c"><input type="checkbox" id="c-41881265" checked=""/><div class="controls bullet"><span class="by">n2d4</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881074">parent</a><span>|</span><a href="#41884139">next</a><span>|</span><label class="collapse" for="c-41881265">[-]</label><label class="expand" for="c-41881265">[2 more]</label></div><br/><div class="children"><div class="content">The problem is the validation. You&#x27;d expect you just have to validate a lower bound, but you also have to validate an upper bound.</div><br/><div id="41884117" class="c"><input type="checkbox" id="c-41884117" checked=""/><div class="controls bullet"><span class="by">leptons</span><span>|</span><a href="#41880898">root</a><span>|</span><a href="#41881265">parent</a><span>|</span><a href="#41884139">next</a><span>|</span><label class="collapse" for="c-41884117">[-]</label><label class="expand" for="c-41884117">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s user input, you have to validate <i>all the bounds</i>, and filter out whatever else might cause problems. Not doing so is a a problem with the programmer, not setTimeout.</div><br/></div></div></div></div></div></div></div></div><div id="41884139" class="c"><input type="checkbox" id="c-41884139" checked=""/><div class="controls bullet"><span class="by">jackconsidine</span><span>|</span><a href="#41880898">prev</a><span>|</span><a href="#41885880">next</a><span>|</span><label class="collapse" for="c-41884139">[-]</label><label class="expand" for="c-41884139">[3 more]</label></div><br/><div class="children"><div class="content">This type of thing is actually practical. Google Cloud Tasks have a max schedule date of 30 days in the future so the typical workaround is to chain tasks. As other commenters have suggested you can also set a cron check. This has more persistent implications on your database, but chaining tasks can fail in other ways, or explode if there are retries and a failed request does trigger a reschedule (I hate to say I’m speaking from experience)</div><br/><div id="41884159" class="c"><input type="checkbox" id="c-41884159" checked=""/><div class="controls bullet"><span class="by">Waterluvian</span><span>|</span><a href="#41884139">parent</a><span>|</span><a href="#41885880">next</a><span>|</span><label class="collapse" for="c-41884159">[-]</label><label class="expand" for="c-41884159">[2 more]</label></div><br/><div class="children"><div class="content">True. Though if you have a need to trigger something after that much time, you might recognize the need to track that scheduled event more carefully and want a scheduler. Then you’ve just got a loop checking the clock and your scheduled tasks.</div><br/><div id="41884304" class="c"><input type="checkbox" id="c-41884304" checked=""/><div class="controls bullet"><span class="by">jackconsidine</span><span>|</span><a href="#41884139">root</a><span>|</span><a href="#41884159">parent</a><span>|</span><a href="#41885880">next</a><span>|</span><label class="collapse" for="c-41884304">[-]</label><label class="expand" for="c-41884304">[1 more]</label></div><br/><div class="children"><div class="content">Right on. Pretty quickly that&#x27;s the better solution</div><br/></div></div></div></div></div></div><div id="41885880" class="c"><input type="checkbox" id="c-41885880" checked=""/><div class="controls bullet"><span class="by">n_plus_1_acc</span><span>|</span><a href="#41884139">prev</a><span>|</span><a href="#41886499">next</a><span>|</span><label class="collapse" for="c-41885880">[-]</label><label class="expand" for="c-41885880">[2 more]</label></div><br/><div class="children"><div class="content">In response to this, I read the spec of setTimeout, bu I couldn&#x27;t find the part where implementations may have an upper bound. Can someone more familiär with the specs point me in the right direction?</div><br/><div id="41886179" class="c"><input type="checkbox" id="c-41886179" checked=""/><div class="controls bullet"><span class="by">zeven7</span><span>|</span><a href="#41885880">parent</a><span>|</span><a href="#41886499">next</a><span>|</span><label class="collapse" for="c-41886179">[-]</label><label class="expand" for="c-41886179">[1 more]</label></div><br/><div class="children"><div class="content">Adding a comment here to check back later because I&#x27;m curious now if someone has the answer. I thought it would be easy to find the answer, but I can&#x27;t find it either. I figured it would say somewhere a number is converted to an int32, but instead I got to the part where there&#x27;s a map of active timers[1] with the time stored as a double[2] without seeing a clear loss happening anywhere before that.<p>[1] <a href="https:&#x2F;&#x2F;html.spec.whatwg.org&#x2F;multipage&#x2F;timers-and-user-prompts.html#map-of-active-timers" rel="nofollow">https:&#x2F;&#x2F;html.spec.whatwg.org&#x2F;multipage&#x2F;timers-and-user-promp...</a><p>[2] <a href="https:&#x2F;&#x2F;w3c.github.io&#x2F;hr-time&#x2F;#dom-domhighrestimestamp" rel="nofollow">https:&#x2F;&#x2F;w3c.github.io&#x2F;hr-time&#x2F;#dom-domhighrestimestamp</a></div><br/></div></div></div></div><div id="41886499" class="c"><input type="checkbox" id="c-41886499" checked=""/><div class="controls bullet"><span class="by">steve_adams_86</span><span>|</span><a href="#41885880">prev</a><span>|</span><a href="#41880869">next</a><span>|</span><label class="collapse" for="c-41886499">[-]</label><label class="expand" for="c-41886499">[1 more]</label></div><br/><div class="children"><div class="content">This makes me love having Go handy. I find working with signals and time based events so much nicer than other languages I use.<p>This is fun, though. JS is a bucket of weird little details like this.</div><br/></div></div><div id="41880869" class="c"><input type="checkbox" id="c-41880869" checked=""/><div class="controls bullet"><span class="by">yifanl</span><span>|</span><a href="#41886499">prev</a><span>|</span><a href="#41885602">next</a><span>|</span><label class="collapse" for="c-41880869">[-]</label><label class="expand" for="c-41880869">[10 more]</label></div><br/><div class="children"><div class="content">If we&#x27;re pedantic, this doesn&#x27;t actually do what&#x27;s advertised, this would be waiting X timeouts worth of event cycles rather than just the one for a true Big timeout, assuming the precision matters when you&#x27;re stalling a function for 40 days.</div><br/><div id="41880887" class="c"><input type="checkbox" id="c-41880887" checked=""/><div class="controls bullet"><span class="by">keithwhor</span><span>|</span><a href="#41880869">parent</a><span>|</span><a href="#41882515">next</a><span>|</span><label class="collapse" for="c-41880887">[-]</label><label class="expand" for="c-41880887">[7 more]</label></div><br/><div class="children"><div class="content">I haven’t looked at the code but it’s fairly likely the author considered this? eg the new timeout is set based on the delta of Date.now() instead of just subtracting the time from the previous timeout.</div><br/><div id="41880912" class="c"><input type="checkbox" id="c-41880912" checked=""/><div class="controls bullet"><span class="by">yifanl</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41880887">parent</a><span>|</span><a href="#41882760">next</a><span>|</span><label class="collapse" for="c-41880912">[-]</label><label class="expand" for="c-41880912">[4 more]</label></div><br/><div class="children"><div class="content">No, it pretty much just does exactly that.<p><pre><code>    const subtractNextDelay = () =&gt; {
      if (typeof remainingDelay === &quot;number&quot;) {
        remainingDelay -= MAX_REAL_DELAY;
      } else {
        remainingDelay -= BigInt(MAX_REAL_DELAY);
      }
    };</code></pre></div><br/><div id="41882294" class="c"><input type="checkbox" id="c-41882294" checked=""/><div class="controls bullet"><span class="by">keithwhor</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41880912">parent</a><span>|</span><a href="#41882760">next</a><span>|</span><label class="collapse" for="c-41882294">[-]</label><label class="expand" for="c-41882294">[3 more]</label></div><br/><div class="children"><div class="content">Oh yikes. Yeah; not ideal.</div><br/><div id="41883921" class="c"><input type="checkbox" id="c-41883921" checked=""/><div class="controls bullet"><span class="by">Aachen</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41882294">parent</a><span>|</span><a href="#41882760">next</a><span>|</span><label class="collapse" for="c-41883921">[-]</label><label class="expand" for="c-41883921">[2 more]</label></div><br/><div class="children"><div class="content">To be fair, this is what I expect of any delay function. If it needs to be precise to the millisecond, <i>especially</i> when scheduled hours or days ahead, I&#x27;d default to doing a sleep until shortly before (ballpark: 98% of the full time span) and then a smaller sleep for the remaining time, or even a busy wait for the last bit if it needs to be sub-millisecond accurate<p>I&#x27;ve had too many sleep functions not work as they should to still rely on this, especially on mobile devices and webpages where background power consumption is a concern. It doesn&#x27;t excuse new bad implementations but it&#x27;s also not exactly surprising</div><br/><div id="41885524" class="c"><input type="checkbox" id="c-41885524" checked=""/><div class="controls bullet"><span class="by">keepamovin</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41883921">parent</a><span>|</span><a href="#41882760">next</a><span>|</span><label class="collapse" for="c-41885524">[-]</label><label class="expand" for="c-41885524">[1 more]</label></div><br/><div class="children"><div class="content">I guess the dream of programming the next heliopause probe in JavaScript is still a ways off hahaha! :)</div><br/></div></div></div></div></div></div></div></div><div id="41882760" class="c"><input type="checkbox" id="c-41882760" checked=""/><div class="controls bullet"><span class="by">gnachman</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41880887">parent</a><span>|</span><a href="#41880912">prev</a><span>|</span><a href="#41882515">next</a><span>|</span><label class="collapse" for="c-41882760">[-]</label><label class="expand" for="c-41882760">[2 more]</label></div><br/><div class="children"><div class="content">That wouldn&#x27;t very well because Date.now() isn&#x27;t monotonic.</div><br/><div id="41886457" class="c"><input type="checkbox" id="c-41886457" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41882760">parent</a><span>|</span><a href="#41882515">next</a><span>|</span><label class="collapse" for="c-41886457">[-]</label><label class="expand" for="c-41886457">[1 more]</label></div><br/><div class="children"><div class="content">There is a monotonic time source available in JavaScript, though: <a href="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;API&#x2F;Performance_API&#x2F;High_precision_timing" rel="nofollow">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;API&#x2F;Performance...</a><p>As I understand it, the precision of such timers has been limited a bit in browsers to mitigate some Spectre attacks (and maybe others), but I imagine it would still be fine for this purpose.</div><br/></div></div></div></div></div></div><div id="41882515" class="c"><input type="checkbox" id="c-41882515" checked=""/><div class="controls bullet"><span class="by">ballenf</span><span>|</span><a href="#41880869">parent</a><span>|</span><a href="#41880887">prev</a><span>|</span><a href="#41885602">next</a><span>|</span><label class="collapse" for="c-41882515">[-]</label><label class="expand" for="c-41882515">[2 more]</label></div><br/><div class="children"><div class="content">Each subtracted timeout is a 25 day timer, so any accumulated error would be miniscule. In your example there would a total of 2 setTimeouts called, one 25 day timer and one 15 day. I think the room for error with this approach is smaller and much simpler than calculating the date delta and trying to take into account daylight savings, leap days, etc. (but I don&#x27;t know what setTimeout does with those either).<p>Or maybe I&#x27;m missing your point.</div><br/><div id="41885374" class="c"><input type="checkbox" id="c-41885374" checked=""/><div class="controls bullet"><span class="by">zeroonetwothree</span><span>|</span><a href="#41880869">root</a><span>|</span><a href="#41882515">parent</a><span>|</span><a href="#41885602">next</a><span>|</span><label class="collapse" for="c-41885374">[-]</label><label class="expand" for="c-41885374">[1 more]</label></div><br/><div class="children"><div class="content">You don’t need to take into account daylight savings or leap days when dealing with unixtime.</div><br/></div></div></div></div></div></div><div id="41885602" class="c"><input type="checkbox" id="c-41885602" checked=""/><div class="controls bullet"><span class="by">ipython</span><span>|</span><a href="#41880869">prev</a><span>|</span><a href="#41885979">next</a><span>|</span><label class="collapse" for="c-41885602">[-]</label><label class="expand" for="c-41885602">[1 more]</label></div><br/><div class="children"><div class="content">Sounds a lot like the famous windows 95 bug when it would crash after 49.7 days of uptime [1]<p>[1] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28340101">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28340101</a></div><br/></div></div><div id="41885979" class="c"><input type="checkbox" id="c-41885979" checked=""/><div class="controls bullet"><span class="by">bufferoverflow</span><span>|</span><a href="#41885602">prev</a><span>|</span><a href="#41881325">next</a><span>|</span><label class="collapse" for="c-41885979">[-]</label><label class="expand" for="c-41885979">[6 more]</label></div><br/><div class="children"><div class="content">setTimeout is stranger than you think.<p>We recently had a failed unit test because setTimeout(fn, 1000) triggered at 999ms. That test had ran more than a hundred times before just fine. Till one day it didn&#x27;t.</div><br/><div id="41886563" class="c"><input type="checkbox" id="c-41886563" checked=""/><div class="controls bullet"><span class="by">xnorswap</span><span>|</span><a href="#41885979">parent</a><span>|</span><a href="#41886471">next</a><span>|</span><label class="collapse" for="c-41886563">[-]</label><label class="expand" for="c-41886563">[1 more]</label></div><br/><div class="children"><div class="content">setTimeout has no guarantees, and even if it did, your unit tests shouldn&#x27;t depend on it.<p>Flaky unit tests are a scourge. The top causes of flaky unit tests in my experience:<p><pre><code>    - wall clock time ( and timezones )
    - user time ( and timeouts )
    - network calls
    - local I&#x2F;O
</code></pre>
These are also, generally speaking, a cause of unnecessarily slow unit tests. If your unit test is waiting 1000ms, then it&#x27;s taking 1000ms longer than it needs to.<p>If you want to test that your component waits, then mock setTimeout and verify it&#x27;s called with 1000 as a parameter.<p>If you want to test how your component waiting interacts with other components, then schedule, without timers, the interactions of effects as a separate test.<p>Fast reliable unit tests are difficult, but a fast reliable unit test suite is like having a super-power. It&#x27;s like driving along a windy mountainside road and the difference between one with a small gravel trap and one lined with armco barriers. Even though in both cases you can the safe driving speed may be the same, having the barriers there will give you the confidence to actually go at that speed.<p>Doing every you can to improve the reliably and speed of your unit test suite will pay off in developer satisfaction. Every time a test suite fails because of a test failing that had nothing to do with the changes under test, a bit more of a resume gets drafted.</div><br/></div></div><div id="41886471" class="c"><input type="checkbox" id="c-41886471" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#41885979">parent</a><span>|</span><a href="#41886563">prev</a><span>|</span><a href="#41886483">next</a><span>|</span><label class="collapse" for="c-41886471">[-]</label><label class="expand" for="c-41886471">[1 more]</label></div><br/><div class="children"><div class="content">I wonder if your 999ms was measured using wall-clock time or a monotonic time source? I imagine a wee time correction at an inopportune time could make this happen.</div><br/></div></div><div id="41886483" class="c"><input type="checkbox" id="c-41886483" checked=""/><div class="controls bullet"><span class="by">steve_adams_86</span><span>|</span><a href="#41885979">parent</a><span>|</span><a href="#41886471">prev</a><span>|</span><a href="#41886191">next</a><span>|</span><label class="collapse" for="c-41886483">[-]</label><label class="expand" for="c-41886483">[1 more]</label></div><br/><div class="children"><div class="content">Why does your unit test need to wait one second? Or are you controlling the system time, but it still had that error?</div><br/></div></div><div id="41886191" class="c"><input type="checkbox" id="c-41886191" checked=""/><div class="controls bullet"><span class="by">gregoriol</span><span>|</span><a href="#41885979">parent</a><span>|</span><a href="#41886483">prev</a><span>|</span><a href="#41885984">next</a><span>|</span><label class="collapse" for="c-41886191">[-]</label><label class="expand" for="c-41886191">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think there is any guarantee that setTimeout will run at exactly 1000. Though didn&#x27;t expect it to run earlier, it definitely could run later.</div><br/></div></div><div id="41885984" class="c"><input type="checkbox" id="c-41885984" checked=""/><div class="controls bullet"><span class="by">jonathanlydall</span><span>|</span><a href="#41885979">parent</a><span>|</span><a href="#41886191">prev</a><span>|</span><a href="#41881325">next</a><span>|</span><label class="collapse" for="c-41885984">[-]</label><label class="expand" for="c-41885984">[1 more]</label></div><br/><div class="children"><div class="content">Interesting.<p>Maybe the system clock did a network time synchronisation  during the setTimeout window.</div><br/></div></div></div></div><div id="41881325" class="c"><input type="checkbox" id="c-41881325" checked=""/><div class="controls bullet"><span class="by">yesco</span><span>|</span><a href="#41885979">prev</a><span>|</span><a href="#41885529">next</a><span>|</span><label class="collapse" for="c-41881325">[-]</label><label class="expand" for="c-41881325">[12 more]</label></div><br/><div class="children"><div class="content">&gt; In most JavaScript runtimes, this duration is represented as a 32-bit signed integer<p>I thought all numbers in JavaScript were basically some variation of double precision floating points, if so, why is setTimeout limited to a smaller 32bit signed integer?<p>If this is true, then if I pass something like &quot;0.5&quot;, does it round the number when casting it to an integer? Or does it execute the callback after half a millisecond like you would expect it would?</div><br/><div id="41881670" class="c"><input type="checkbox" id="c-41881670" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#41881325">parent</a><span>|</span><a href="#41884172">next</a><span>|</span><label class="collapse" for="c-41881670">[-]</label><label class="expand" for="c-41881670">[7 more]</label></div><br/><div class="children"><div class="content">You&#x27;re correct about JS numbers. It works like this presumably because the implementation is written in C++ or the like and uses an int32 for this, because &quot;25 days ought to be enough for everyone&quot;.</div><br/><div id="41882076" class="c"><input type="checkbox" id="c-41882076" checked=""/><div class="controls bullet"><span class="by">drdaeman</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41881670">parent</a><span>|</span><a href="#41884172">next</a><span>|</span><label class="collapse" for="c-41882076">[-]</label><label class="expand" for="c-41882076">[6 more]</label></div><br/><div class="children"><div class="content">I thought most non-abandoned C&#x2F;C++ projects have long switched to time_t or similar. 2038 is not that far in the future.</div><br/><div id="41884616" class="c"><input type="checkbox" id="c-41884616" checked=""/><div class="controls bullet"><span class="by">asveikau</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41882076">parent</a><span>|</span><a href="#41884079">next</a><span>|</span><label class="collapse" for="c-41884616">[-]</label><label class="expand" for="c-41884616">[2 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a shocking amount of systems that still have 32 bit time_t.<p>Linux and glibc only started supporting it on 32bit systems in the current decade.</div><br/><div id="41885509" class="c"><input type="checkbox" id="c-41885509" checked=""/><div class="controls bullet"><span class="by">kelnos</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41884616">parent</a><span>|</span><a href="#41884079">next</a><span>|</span><label class="collapse" for="c-41885509">[-]</label><label class="expand" for="c-41885509">[1 more]</label></div><br/><div class="children"><div class="content">I mean, we still have 14 years to go.  It&#x27;s not like it&#x27;s 1999 and everyone is freaking out about y2k.  We still have plenty of time.<p>That doesn&#x27;t mean it&#x27;s fine to wait and leave it until the last minute, but we have quite a few last minutes left at this point.</div><br/></div></div></div></div><div id="41884079" class="c"><input type="checkbox" id="c-41884079" checked=""/><div class="controls bullet"><span class="by">afavour</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41882076">parent</a><span>|</span><a href="#41884616">prev</a><span>|</span><a href="#41883127">next</a><span>|</span><label class="collapse" for="c-41884079">[-]</label><label class="expand" for="c-41884079">[1 more]</label></div><br/><div class="children"><div class="content">Yes but JS always has backwards compatibility in mind, even if it wasn’t in the spec. Wouldn’t be surprised if more modern implementations still add an arbitrary restriction.</div><br/></div></div><div id="41883127" class="c"><input type="checkbox" id="c-41883127" checked=""/><div class="controls bullet"><span class="by">andrewmcwatters</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41882076">parent</a><span>|</span><a href="#41884079">prev</a><span>|</span><a href="#41884022">next</a><span>|</span><label class="collapse" for="c-41883127">[-]</label><label class="expand" for="c-41883127">[1 more]</label></div><br/><div class="children"><div class="content">2038 is even &quot;now&quot; if you&#x27;re calculating futures.</div><br/></div></div><div id="41884022" class="c"><input type="checkbox" id="c-41884022" checked=""/><div class="controls bullet"><span class="by">bobmcnamara</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41882076">parent</a><span>|</span><a href="#41883127">prev</a><span>|</span><a href="#41884172">next</a><span>|</span><label class="collapse" for="c-41884022">[-]</label><label class="expand" for="c-41884022">[1 more]</label></div><br/><div class="children"><div class="content">Debian conversion should be done mid2025.</div><br/></div></div></div></div></div></div><div id="41884172" class="c"><input type="checkbox" id="c-41884172" checked=""/><div class="controls bullet"><span class="by">DvdGiessen</span><span>|</span><a href="#41881325">parent</a><span>|</span><a href="#41881670">prev</a><span>|</span><a href="#41881685">next</a><span>|</span><label class="collapse" for="c-41884172">[-]</label><label class="expand" for="c-41884172">[1 more]</label></div><br/><div class="children"><div class="content">When implementing a tiny timing library in JS a few years back I found that most engines indeed seem to cast the value to an integer (effectively flooring it), so in order to get consistent behaviour in all environments I resorted to always calling Math.ceil on the timeout value first [1], thus making it so that the callbacks always fire after <i>at least</i> the given timeout has passed (same as with regular setTimeout, which also cannot guarantee that the engine can run the callback at exactly the given timeout due to scheduling). Also used a very similar timeout chaining technique as described here, it works well!<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;DvdGiessen&#x2F;virtual-clock&#x2F;blob&#x2F;master&#x2F;src&#x2F;virtual-clock.js#L222">https:&#x2F;&#x2F;github.com&#x2F;DvdGiessen&#x2F;virtual-clock&#x2F;blob&#x2F;master&#x2F;src&#x2F;...</a></div><br/></div></div><div id="41881685" class="c"><input type="checkbox" id="c-41881685" checked=""/><div class="controls bullet"><span class="by">blixt</span><span>|</span><a href="#41881325">parent</a><span>|</span><a href="#41884172">prev</a><span>|</span><a href="#41885529">next</a><span>|</span><label class="collapse" for="c-41881685">[-]</label><label class="expand" for="c-41881685">[3 more]</label></div><br/><div class="children"><div class="content">JS numbers technically have 53 bits for integers (mantissa) but all binary operators turns it into a 32-bit signed integer. Maybe this is related somehow to the setTimeout limitation. JavaScript also has the &gt;&gt;&gt; unsigned bit shift operator so you can squeeze that last bit out of it if you only care about positive values: ((2*32-1)&gt;&gt;&gt;0).toString(2).length === 32</div><br/><div id="41882267" class="c"><input type="checkbox" id="c-41882267" checked=""/><div class="controls bullet"><span class="by">tubs</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41881685">parent</a><span>|</span><a href="#41885529">next</a><span>|</span><label class="collapse" for="c-41882267">[-]</label><label class="expand" for="c-41882267">[2 more]</label></div><br/><div class="children"><div class="content">I assume by binary you mean logical? A + b certainly does not treat either side as 32bit.</div><br/><div id="41882779" class="c"><input type="checkbox" id="c-41882779" checked=""/><div class="controls bullet"><span class="by">blixt</span><span>|</span><a href="#41881325">root</a><span>|</span><a href="#41882267">parent</a><span>|</span><a href="#41885529">next</a><span>|</span><label class="collapse" for="c-41882779">[-]</label><label class="expand" for="c-41882779">[1 more]</label></div><br/><div class="children"><div class="content">Sorry, I meant bitwise operators, such as: ~ &gt;&gt; &lt;&lt; &gt;&gt;&gt; | &amp;</div><br/></div></div></div></div></div></div></div></div><div id="41885529" class="c"><input type="checkbox" id="c-41885529" checked=""/><div class="controls bullet"><span class="by">keepamovin</span><span>|</span><a href="#41881325">prev</a><span>|</span><a href="#41881730">next</a><span>|</span><label class="collapse" for="c-41885529">[-]</label><label class="expand" for="c-41885529">[1 more]</label></div><br/><div class="children"><div class="content">This is excellent. But I was hoping for a setTimeout that survived JavaScript environment restarts. Maybe <i>setBigReliableTimeout</i> is in your future? Hahaha! :)</div><br/></div></div><div id="41881730" class="c"><input type="checkbox" id="c-41881730" checked=""/><div class="controls bullet"><span class="by">darepublic</span><span>|</span><a href="#41885529">prev</a><span>|</span><a href="#41881187">next</a><span>|</span><label class="collapse" for="c-41881730">[-]</label><label class="expand" for="c-41881730">[6 more]</label></div><br/><div class="children"><div class="content">instead of chaining together shorter timeouts, why not calculate the datetime of the delay and then invoke via window.requestAnimationFrame (by checking the current date ofc).</div><br/><div id="41881836" class="c"><input type="checkbox" id="c-41881836" checked=""/><div class="controls bullet"><span class="by">augusto-moura</span><span>|</span><a href="#41881730">parent</a><span>|</span><a href="#41883972">next</a><span>|</span><label class="collapse" for="c-41881836">[-]</label><label class="expand" for="c-41881836">[2 more]</label></div><br/><div class="children"><div class="content">Are you suggesting checking the date every frame vs scheduling long task every once in a long while? Can&#x27;t tell if it is ironic or not, I&#x27;m sorry (damn Poe&#x27;s law). But assuming not, it would be a lot more computationaly expensive to do that, timeouts are very optmized and they &quot;give back&quot; on the computer resources while in the meantime</div><br/><div id="41882566" class="c"><input type="checkbox" id="c-41882566" checked=""/><div class="controls bullet"><span class="by">darepublic</span><span>|</span><a href="#41881730">root</a><span>|</span><a href="#41881836">parent</a><span>|</span><a href="#41883972">next</a><span>|</span><label class="collapse" for="c-41882566">[-]</label><label class="expand" for="c-41882566">[1 more]</label></div><br/><div class="children"><div class="content">No irony intended I can be this dumb.  Your point did occur to me as I posted, was just grasping at straws for a &quot;clean&quot; solution</div><br/></div></div></div></div><div id="41883972" class="c"><input type="checkbox" id="c-41883972" checked=""/><div class="controls bullet"><span class="by">jw1224</span><span>|</span><a href="#41881730">parent</a><span>|</span><a href="#41881836">prev</a><span>|</span><a href="#41881800">next</a><span>|</span><label class="collapse" for="c-41883972">[-]</label><label class="expand" for="c-41883972">[2 more]</label></div><br/><div class="children"><div class="content">Unlike setTimeout, requestAnimationFrame callbacks are  automatically skipped if the browser viewport is minimized or no longer visible. You wouldn’t want to miss the frame that matters!</div><br/><div id="41885452" class="c"><input type="checkbox" id="c-41885452" checked=""/><div class="controls bullet"><span class="by">chii</span><span>|</span><a href="#41881730">root</a><span>|</span><a href="#41883972">parent</a><span>|</span><a href="#41881800">next</a><span>|</span><label class="collapse" for="c-41885452">[-]</label><label class="expand" for="c-41885452">[1 more]</label></div><br/><div class="children"><div class="content">also, not to mention that setBigTimeout would still work in serverside js, while requestanimationframe doesn&#x27;t!</div><br/></div></div></div></div></div></div><div id="41881187" class="c"><input type="checkbox" id="c-41881187" checked=""/><div class="controls bullet"><span class="by">issafram</span><span>|</span><a href="#41881730">prev</a><span>|</span><a href="#41880845">next</a><span>|</span><label class="collapse" for="c-41881187">[-]</label><label class="expand" for="c-41881187">[11 more]</label></div><br/><div class="children"><div class="content">I wish that I could actually see the code.  I understand that it&#x27;s chaining timeouts, but the git site is just garbage</div><br/><div id="41881255" class="c"><input type="checkbox" id="c-41881255" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#41881187">parent</a><span>|</span><a href="#41881321">next</a><span>|</span><label class="collapse" for="c-41881255">[-]</label><label class="expand" for="c-41881255">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;ve gotta click &quot;tree&quot;.<p><a href="https:&#x2F;&#x2F;git.sr.ht&#x2F;~evanhahn&#x2F;setBigTimeout&#x2F;tree&#x2F;main&#x2F;item&#x2F;mod.ts" rel="nofollow">https:&#x2F;&#x2F;git.sr.ht&#x2F;~evanhahn&#x2F;setBigTimeout&#x2F;tree&#x2F;main&#x2F;item&#x2F;mod...</a></div><br/></div></div><div id="41881321" class="c"><input type="checkbox" id="c-41881321" checked=""/><div class="controls bullet"><span class="by">adregan</span><span>|</span><a href="#41881187">parent</a><span>|</span><a href="#41881255">prev</a><span>|</span><a href="#41881348">next</a><span>|</span><label class="collapse" for="c-41881321">[-]</label><label class="expand" for="c-41881321">[1 more]</label></div><br/><div class="children"><div class="content">This reminds me of when I am trying to find something in a cabinet, but don’t really look very hard, and my wife will say “did you even try?” and find it in ~1second.<p><a href="https:&#x2F;&#x2F;git.sr.ht&#x2F;~evanhahn&#x2F;setBigTimeout&#x2F;tree&#x2F;main&#x2F;item&#x2F;mod.ts" rel="nofollow">https:&#x2F;&#x2F;git.sr.ht&#x2F;~evanhahn&#x2F;setBigTimeout&#x2F;tree&#x2F;main&#x2F;item&#x2F;mod...</a></div><br/></div></div><div id="41881282" class="c"><input type="checkbox" id="c-41881282" checked=""/><div class="controls bullet"><span class="by">zgk7iqea</span><span>|</span><a href="#41881187">parent</a><span>|</span><a href="#41881348">prev</a><span>|</span><a href="#41883829">next</a><span>|</span><label class="collapse" for="c-41881282">[-]</label><label class="expand" for="c-41881282">[6 more]</label></div><br/><div class="children"><div class="content">yes, sourcehuts interface is just godawful</div><br/><div id="41881332" class="c"><input type="checkbox" id="c-41881332" checked=""/><div class="controls bullet"><span class="by">egwynn</span><span>|</span><a href="#41881187">root</a><span>|</span><a href="#41881282">parent</a><span>|</span><a href="#41883829">next</a><span>|</span><label class="collapse" for="c-41881332">[-]</label><label class="expand" for="c-41881332">[5 more]</label></div><br/><div class="children"><div class="content">I agree it’s not the prettiest, but I had no trouble clicking on “tree” to get to the folder and then “mod.ts” to see the code.</div><br/><div id="41882365" class="c"><input type="checkbox" id="c-41882365" checked=""/><div class="controls bullet"><span class="by">Joker_vD</span><span>|</span><a href="#41881187">root</a><span>|</span><a href="#41881332">parent</a><span>|</span><a href="#41883829">next</a><span>|</span><label class="collapse" for="c-41882365">[-]</label><label class="expand" for="c-41882365">[4 more]</label></div><br/><div class="children"><div class="content">One has still to know that &quot;tree&quot; stands for &quot;source code&quot;.</div><br/><div id="41885519" class="c"><input type="checkbox" id="c-41885519" checked=""/><div class="controls bullet"><span class="by">kelnos</span><span>|</span><a href="#41881187">root</a><span>|</span><a href="#41882365">parent</a><span>|</span><a href="#41884585">next</a><span>|</span><label class="collapse" for="c-41885519">[-]</label><label class="expand" for="c-41885519">[1 more]</label></div><br/><div class="children"><div class="content">That seems like... a normal thing to know?<p>Pre-GitHub, one of the most popular web git viewers (cgit) used &quot;tree&quot; in this way.  Never found that to be confusing.<p>(In git, the listing of the files and directories at a particular commit is called a &quot;tree&quot;.  So it&#x27;s correct.  Just not as intuitive as you, personally, would like.)</div><br/></div></div><div id="41884585" class="c"><input type="checkbox" id="c-41884585" checked=""/><div class="controls bullet"><span class="by">internetter</span><span>|</span><a href="#41881187">root</a><span>|</span><a href="#41882365">parent</a><span>|</span><a href="#41885519">prev</a><span>|</span><a href="#41883829">next</a><span>|</span><label class="collapse" for="c-41884585">[-]</label><label class="expand" for="c-41884585">[2 more]</label></div><br/><div class="children"><div class="content">This is not a sourcehut problem, it is a github problem. &quot;Tree&quot; is semantically correct.</div><br/><div id="41885281" class="c"><input type="checkbox" id="c-41885281" checked=""/><div class="controls bullet"><span class="by">ajkjk</span><span>|</span><a href="#41881187">root</a><span>|</span><a href="#41884585">parent</a><span>|</span><a href="#41883829">next</a><span>|</span><label class="collapse" for="c-41885281">[-]</label><label class="expand" for="c-41885281">[1 more]</label></div><br/><div class="children"><div class="content">What? Of course it&#x27;s a Sourcehut problem. They chose to use that word and could choose to use a better one.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41883829" class="c"><input type="checkbox" id="c-41883829" checked=""/><div class="controls bullet"><span class="by">Minor49er</span><span>|</span><a href="#41881187">parent</a><span>|</span><a href="#41881282">prev</a><span>|</span><a href="#41880845">next</a><span>|</span><label class="collapse" for="c-41883829">[-]</label><label class="expand" for="c-41883829">[1 more]</label></div><br/><div class="children"><div class="content">I clicked on &quot;browse&quot; under the refs: main section and found the code right away</div><br/></div></div></div></div><div id="41880845" class="c"><input type="checkbox" id="c-41880845" checked=""/><div class="controls bullet"><span class="by">sjaak</span><span>|</span><a href="#41881187">prev</a><span>|</span><a href="#41885682">next</a><span>|</span><label class="collapse" for="c-41880845">[-]</label><label class="expand" for="c-41880845">[6 more]</label></div><br/><div class="children"><div class="content">What is the use-case for such a function?</div><br/><div id="41880863" class="c"><input type="checkbox" id="c-41880863" checked=""/><div class="controls bullet"><span class="by">echoangle</span><span>|</span><a href="#41880845">parent</a><span>|</span><a href="#41880877">next</a><span>|</span><label class="collapse" for="c-41880863">[-]</label><label class="expand" for="c-41880863">[1 more]</label></div><br/><div class="children"><div class="content">Make a joke and have something to write a blogpost about, while letting your readers learn something new.</div><br/></div></div><div id="41880877" class="c"><input type="checkbox" id="c-41880877" checked=""/><div class="controls bullet"><span class="by">keithwhor</span><span>|</span><a href="#41880845">parent</a><span>|</span><a href="#41880863">prev</a><span>|</span><a href="#41881064">next</a><span>|</span><label class="collapse" for="c-41880877">[-]</label><label class="expand" for="c-41880877">[3 more]</label></div><br/><div class="children"><div class="content">Off the top of my head, a cron scheduler for a server that reads from a database and sets a timeout upon boot. Every time the server is reboot the timeouts are reinitialized (fail safe in case of downtime). If upon boot there’s a timeout &gt; 25 days it’ll get executed immediately which is not the behavior you want.</div><br/><div id="41882349" class="c"><input type="checkbox" id="c-41882349" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#41880845">root</a><span>|</span><a href="#41880877">parent</a><span>|</span><a href="#41881778">next</a><span>|</span><label class="collapse" for="c-41882349">[-]</label><label class="expand" for="c-41882349">[1 more]</label></div><br/><div class="children"><div class="content">This should be an interval with a lookup.<p>Every five seconds check for due dates sooner than 10 seconds from now and schedule them.<p>The longer a delay the higher the odds the process exits without finishing the work.</div><br/></div></div><div id="41881778" class="c"><input type="checkbox" id="c-41881778" checked=""/><div class="controls bullet"><span class="by">skykooler</span><span>|</span><a href="#41880845">root</a><span>|</span><a href="#41880877">parent</a><span>|</span><a href="#41882349">prev</a><span>|</span><a href="#41881064">next</a><span>|</span><label class="collapse" for="c-41881778">[-]</label><label class="expand" for="c-41881778">[1 more]</label></div><br/><div class="children"><div class="content">Why would you do that in JS rather than just using cron for it?</div><br/></div></div></div></div><div id="41881064" class="c"><input type="checkbox" id="c-41881064" checked=""/><div class="controls bullet"><span class="by">bgirard</span><span>|</span><a href="#41880845">parent</a><span>|</span><a href="#41880877">prev</a><span>|</span><a href="#41885682">next</a><span>|</span><label class="collapse" for="c-41881064">[-]</label><label class="expand" for="c-41881064">[1 more]</label></div><br/><div class="children"><div class="content">Not having your timeout fire unexpectedly instantly is a good use-case IMO.</div><br/></div></div></div></div><div id="41885682" class="c"><input type="checkbox" id="c-41885682" checked=""/><div class="controls bullet"><span class="by">throwaway14356</span><span>|</span><a href="#41880845">prev</a><span>|</span><a href="#41883277">next</a><span>|</span><label class="collapse" for="c-41885682">[-]</label><label class="expand" for="c-41885682">[1 more]</label></div><br/><div class="children"><div class="content">because no one asked. If you need shorter intervals than the minimum you can make a function that calls the other function multiple times in a row.</div><br/></div></div><div id="41883277" class="c"><input type="checkbox" id="c-41883277" checked=""/><div class="controls bullet"><span class="by">hiccuphippo</span><span>|</span><a href="#41885682">prev</a><span>|</span><a href="#41880787">next</a><span>|</span><label class="collapse" for="c-41883277">[-]</label><label class="expand" for="c-41883277">[1 more]</label></div><br/><div class="children"><div class="content">So the js engine converting the javascript number (a double?) To an int and it&#x27;s rolling over?</div><br/></div></div><div id="41880787" class="c"><input type="checkbox" id="c-41880787" checked=""/><div class="controls bullet"><span class="by">miiiiiike</span><span>|</span><a href="#41883277">prev</a><span>|</span><a href="#41884178">next</a><span>|</span><label class="collapse" for="c-41880787">[-]</label><label class="expand" for="c-41880787">[7 more]</label></div><br/><div class="children"><div class="content">Got hit with this one a few months ago.</div><br/><div id="41880846" class="c"><input type="checkbox" id="c-41880846" checked=""/><div class="controls bullet"><span class="by">graypegg</span><span>|</span><a href="#41880787">parent</a><span>|</span><a href="#41880864">next</a><span>|</span><label class="collapse" for="c-41880846">[-]</label><label class="expand" for="c-41880846">[3 more]</label></div><br/><div class="children"><div class="content">Just out of curiosity, what was the use case for a really long timeout? Feels like most if not all long timeouts would be best served with some sort of &quot;job&quot; you could persist, rather than leaving it in the event queue.</div><br/><div id="41881134" class="c"><input type="checkbox" id="c-41881134" checked=""/><div class="controls bullet"><span class="by">cout</span><span>|</span><a href="#41880787">root</a><span>|</span><a href="#41880846">parent</a><span>|</span><a href="#41880864">next</a><span>|</span><label class="collapse" for="c-41881134">[-]</label><label class="expand" for="c-41881134">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;thedailywtf.com&#x2F;articles&#x2F;The_Harbinger_of_the_Epoch_" rel="nofollow">https:&#x2F;&#x2F;thedailywtf.com&#x2F;articles&#x2F;The_Harbinger_of_the_Epoch_</a></div><br/><div id="41881210" class="c"><input type="checkbox" id="c-41881210" checked=""/><div class="controls bullet"><span class="by">graypegg</span><span>|</span><a href="#41880787">root</a><span>|</span><a href="#41881134">parent</a><span>|</span><a href="#41880864">next</a><span>|</span><label class="collapse" for="c-41881210">[-]</label><label class="expand" for="c-41881210">[1 more]</label></div><br/><div class="children"><div class="content">To be fair, this will be fixed by browsers when it&#x27;s within spitting distance of the scale of numbers setTimeout is normally used with. (not huge numbers) Like, if it&#x27;s close enough that setTimeout(() =&gt; {}, 5000) will stop working a month later, that would be a major failure on the browser vendor&#x27;s part. Much too close for comfort.<p>But I totally understand it not being a priority if the situation is: setTimeout(() =&gt; {}, 500000000) not working in X years.</div><br/></div></div></div></div></div></div><div id="41880864" class="c"><input type="checkbox" id="c-41880864" checked=""/><div class="controls bullet"><span class="by">BillyTheKing</span><span>|</span><a href="#41880787">parent</a><span>|</span><a href="#41880846">prev</a><span>|</span><a href="#41884178">next</a><span>|</span><label class="collapse" for="c-41880864">[-]</label><label class="expand" for="c-41880864">[3 more]</label></div><br/><div class="children"><div class="content">this is the thing with JS and TS - the types and stuff, it&#x27;s all good until you realise that all integers are basically int 52 (represented as float 64, with 52 bits for the fraction).<p>Yes, it&#x27;s nice and flexible - but also introduces some dangerous subtle bugs.</div><br/><div id="41881020" class="c"><input type="checkbox" id="c-41881020" checked=""/><div class="controls bullet"><span class="by">8n4vidtmkvmk</span><span>|</span><a href="#41880787">root</a><span>|</span><a href="#41880864">parent</a><span>|</span><a href="#41881048">next</a><span>|</span><label class="collapse" for="c-41881020">[-]</label><label class="expand" for="c-41881020">[1 more]</label></div><br/><div class="children"><div class="content">2^53-1 I thought.<p>And no, they&#x27;re not all that. There&#x27;s a bunch that are 2^32 such as this timeout, apparently, plus all the bit shift operations.</div><br/></div></div><div id="41881048" class="c"><input type="checkbox" id="c-41881048" checked=""/><div class="controls bullet"><span class="by">vhcr</span><span>|</span><a href="#41880787">root</a><span>|</span><a href="#41880864">parent</a><span>|</span><a href="#41881020">prev</a><span>|</span><a href="#41884178">next</a><span>|</span><label class="collapse" for="c-41881048">[-]</label><label class="expand" for="c-41881048">[1 more]</label></div><br/><div class="children"><div class="content">Not ALL integers are 52 bit, BigInts were added on ECMAScript 2020.</div><br/></div></div></div></div></div></div><div id="41884178" class="c"><input type="checkbox" id="c-41884178" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#41880787">prev</a><span>|</span><label class="collapse" for="c-41884178">[-]</label><label class="expand" for="c-41884178">[4 more]</label></div><br/><div class="children"><div class="content">This is great for the folks running serverless compute! You get to start a process and let it hang until your credit card is maxed out. &#x2F;s</div><br/><div id="41884472" class="c"><input type="checkbox" id="c-41884472" checked=""/><div class="controls bullet"><span class="by">hmaxdml</span><span>|</span><a href="#41884178">parent</a><span>|</span><label class="collapse" for="c-41884472">[-]</label><label class="expand" for="c-41884472">[3 more]</label></div><br/><div class="children"><div class="content">That was before DBOS -- the serverless platform that bills you only for CPU time, not wall clock time ;) see <a href="https:&#x2F;&#x2F;www.dbos.dev&#x2F;blog&#x2F;aws-lambda-hidden-wait-costs" rel="nofollow">https:&#x2F;&#x2F;www.dbos.dev&#x2F;blog&#x2F;aws-lambda-hidden-wait-costs</a></div><br/><div id="41884599" class="c"><input type="checkbox" id="c-41884599" checked=""/><div class="controls bullet"><span class="by">internetter</span><span>|</span><a href="#41884178">root</a><span>|</span><a href="#41884472">parent</a><span>|</span><a href="#41885860">next</a><span>|</span><label class="collapse" for="c-41884599">[-]</label><label class="expand" for="c-41884599">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t see how this pricing (or product in general) is any better than cloudflare workers.<p>To be clear, I am not trying to be mean, I&#x27;m just curious to hear why I would pick this over cf.</div><br/></div></div><div id="41885860" class="c"><input type="checkbox" id="c-41885860" checked=""/><div class="controls bullet"><span class="by">leni536</span><span>|</span><a href="#41884178">root</a><span>|</span><a href="#41884472">parent</a><span>|</span><a href="#41884599">prev</a><span>|</span><label class="collapse" for="c-41885860">[-]</label><label class="expand" for="c-41885860">[1 more]</label></div><br/><div class="children"><div class="content">So... do they not charge for sitting idle and consuming memory?</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>