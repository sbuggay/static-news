<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1722243658788" as="style"/><link rel="stylesheet" href="styles.css?v=1722243658788"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/izabera/ps">ps aux written in bash without forking</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>signa11</span> | <span>31 comments</span></div><br/><div><div id="41098574" class="c"><input type="checkbox" id="c-41098574" checked=""/><div class="controls bullet"><span class="by">c0l0</span><span>|</span><a href="#41097821">next</a><span>|</span><label class="collapse" for="c-41098574">[-]</label><label class="expand" for="c-41098574">[3 more]</label></div><br/><div class="children"><div class="content">Back in 2011, I interviewed at a large-ish tech company from the US for an &quot;SRE&quot; role (and never had I hear <i>that</i> term before) that, amongst other things, created an online, browser-based alternative to MS Office. Some rounds in, after the usual phone screening, the task was some sort of supervised programming in a $thatcompany Docs document while talking to the interviewer on speaker phone. Since I had rated &quot;shell scripting&quot; and &quot;Linux&quot; fairly highly in my mandatory self-assessment sheet that I had turned in weeks prior, I was tasked with conjuring a `netstat` replacement in bash.<p>I quickly realized I couldn&#x27;t do it (because I did not, at the time, know where and how exactly socket information was held in &#x2F;proc&#x2F;), but I offered to write trimmed-down replacements of `ps` and `fuser` instead. The interviewer deemed that - and my solutions eventually produced in that wretched, browser-based word processor - acceptable, and a few weeks later, I shipped out to the on-site interview series.<p>Now I wonder if the hypothetical scenario presented as the motivation for this exercise is more grounded in reality than Izabera (thanks for all your help in #bash over years btw!) would care to admit... ;)</div><br/><div id="41098652" class="c"><input type="checkbox" id="c-41098652" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#41098574">parent</a><span>|</span><a href="#41097821">next</a><span>|</span><label class="collapse" for="c-41098652">[-]</label><label class="expand" for="c-41098652">[2 more]</label></div><br/><div class="children"><div class="content">Dollars to donuts you&#x27;ll find some of these system utilities poking at procfs&#x2F;sysfs in the first place.  That&#x27;s where I&#x27;d start anyways.</div><br/><div id="41098670" class="c"><input type="checkbox" id="c-41098670" checked=""/><div class="controls bullet"><span class="by">c0l0</span><span>|</span><a href="#41098574">root</a><span>|</span><a href="#41098652">parent</a><span>|</span><a href="#41097821">next</a><span>|</span><label class="collapse" for="c-41098670">[-]</label><label class="expand" for="c-41098670">[1 more]</label></div><br/><div class="children"><div class="content">Necessarily, as this is <i>the</i> kind of API (a file system with a well-defined structure) that the kernel exposes for querying&#x2F;providing that kind of information :)</div><br/></div></div></div></div></div></div><div id="41097821" class="c"><input type="checkbox" id="c-41097821" checked=""/><div class="controls bullet"><span class="by">oxygen_crisis</span><span>|</span><a href="#41098574">prev</a><span>|</span><a href="#41098052">next</a><span>|</span><label class="collapse" for="c-41097821">[-]</label><label class="expand" for="c-41097821">[15 more]</label></div><br/><div class="children"><div class="content">&gt; An interview question for a position that requires knowledge of bash&#x2F;linux&#x2F;stuff could be:<p>&gt; What if you&#x27;re ssh&#x27;d into a machine, you&#x27;re in your trusty bash shell, but unfortunately you cannot spawn any new processes because literally all other pids are taken. What do you do?<p>I&#x27;d look in the &#x2F;proc&#x2F;[pid]&#x2F; filesystem for visibility into what processes are exhausting the PID space.<p>`kill` is a shell builtin in bash, you don&#x27;t have to rely on forking a new process like &#x2F;bin&#x2F;kill. If you can find out the parent process whose children are exhausting PIDs you&#x27;re well on your way to stopping it and getting a handle on things again.<p>And I&#x27;ll be darned, this script parses &#x2F;proc. No | pipes or $( .. ) substitutions that would need to spawn another bash subshell process either. Pretty clean.</div><br/><div id="41097937" class="c"><input type="checkbox" id="c-41097937" checked=""/><div class="controls bullet"><span class="by">kstrauser</span><span>|</span><a href="#41097821">parent</a><span>|</span><a href="#41098309">next</a><span>|</span><label class="collapse" for="c-41097937">[-]</label><label class="expand" for="c-41097937">[7 more]</label></div><br/><div class="children"><div class="content">My answer in an interview was “exec Python”. Then you can call all the posix functions you need without launching separate commands.<p>This went over quite well.</div><br/><div id="41098955" class="c"><input type="checkbox" id="c-41098955" checked=""/><div class="controls bullet"><span class="by">fuzztester</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41097937">parent</a><span>|</span><a href="#41098217">next</a><span>|</span><label class="collapse" for="c-41098955">[-]</label><label class="expand" for="c-41098955">[2 more]</label></div><br/><div class="children"><div class="content">This made me giggle.<p>And after the exec, if they asked me to parse a Python expression, I&#x27;d type &quot;eval(expr)&quot;.</div><br/><div id="41098959" class="c"><input type="checkbox" id="c-41098959" checked=""/><div class="controls bullet"><span class="by">fuzztester</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098955">parent</a><span>|</span><a href="#41098217">next</a><span>|</span><label class="collapse" for="c-41098959">[-]</label><label class="expand" for="c-41098959">[1 more]</label></div><br/><div class="children"><div class="content">Or even:<p>import code<p>code.interact()<p># <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;code.html" rel="nofollow">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;code.html</a></div><br/></div></div></div></div><div id="41098217" class="c"><input type="checkbox" id="c-41098217" checked=""/><div class="controls bullet"><span class="by">Onavo</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41097937">parent</a><span>|</span><a href="#41098955">prev</a><span>|</span><a href="#41098309">next</a><span>|</span><label class="collapse" for="c-41098217">[-]</label><label class="expand" for="c-41098217">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s interesting that mainstream Unix shells do not have a syscall function. That would be very useful.</div><br/><div id="41098504" class="c"><input type="checkbox" id="c-41098504" checked=""/><div class="controls bullet"><span class="by">layer8</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098217">parent</a><span>|</span><a href="#41098309">next</a><span>|</span><label class="collapse" for="c-41098504">[-]</label><label class="expand" for="c-41098504">[3 more]</label></div><br/><div class="children"><div class="content">Well, you can use <a href="https:&#x2F;&#x2F;github.com&#x2F;taviso&#x2F;ctypes.sh">https:&#x2F;&#x2F;github.com&#x2F;taviso&#x2F;ctypes.sh</a>.</div><br/><div id="41098863" class="c"><input type="checkbox" id="c-41098863" checked=""/><div class="controls bullet"><span class="by">elashri</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098504">parent</a><span>|</span><a href="#41098754">next</a><span>|</span><label class="collapse" for="c-41098863">[-]</label><label class="expand" for="c-41098863">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Here is what people have been saying about ctypes.sh:<p>&quot;that&#x27;s disgusting&quot;<p>&quot;this has got to stop&quot;<p>&quot;you&#x27;ve gone too far with this&quot;<p>&quot;is this a joke?&quot;<p>&quot;I never knew the c could stand for Cthulhu.&quot;</div><br/></div></div><div id="41098754" class="c"><input type="checkbox" id="c-41098754" checked=""/><div class="controls bullet"><span class="by">chx</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098504">parent</a><span>|</span><a href="#41098863">prev</a><span>|</span><a href="#41098309">next</a><span>|</span><label class="collapse" for="c-41098754">[-]</label><label class="expand" for="c-41098754">[1 more]</label></div><br/><div class="children"><div class="content">Install this on production to almost guarantee to hear from the author in his official capacity :P</div><br/></div></div></div></div></div></div></div></div><div id="41098309" class="c"><input type="checkbox" id="c-41098309" checked=""/><div class="controls bullet"><span class="by">hans_castorp</span><span>|</span><a href="#41097821">parent</a><span>|</span><a href="#41097937">prev</a><span>|</span><a href="#41098207">next</a><span>|</span><label class="collapse" for="c-41098309">[-]</label><label class="expand" for="c-41098309">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;d look in the &#x2F;proc&#x2F;[pid]&#x2F; filesystem for visibility into what processes are exhausting the PID space.<p>From the source code:<p><pre><code>    # so initially i was hoping you could get everything from &#x2F;proc&#x2F;&lt;pid&gt;&#x2F;status
    # because it&#x27;s easy to parse (in most cases) but apparently you can&#x27;t get
    # things like the cpu% :(</code></pre></div><br/></div></div><div id="41098207" class="c"><input type="checkbox" id="c-41098207" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41097821">parent</a><span>|</span><a href="#41098309">prev</a><span>|</span><a href="#41098733">next</a><span>|</span><label class="collapse" for="c-41098207">[-]</label><label class="expand" for="c-41098207">[4 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;d look in the &#x2F;proc&#x2F;[pid]&#x2F; filesystem<p><pre><code>    cd &#x2F;proc
    echo *</code></pre></div><br/><div id="41098735" class="c"><input type="checkbox" id="c-41098735" checked=""/><div class="controls bullet"><span class="by">tgv</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098207">parent</a><span>|</span><a href="#41098733">next</a><span>|</span><label class="collapse" for="c-41098735">[-]</label><label class="expand" for="c-41098735">[3 more]</label></div><br/><div class="children"><div class="content">Argument list too long<p>$</div><br/><div id="41098847" class="c"><input type="checkbox" id="c-41098847" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098735">parent</a><span>|</span><a href="#41098878">next</a><span>|</span><label class="collapse" for="c-41098847">[-]</label><label class="expand" for="c-41098847">[1 more]</label></div><br/><div class="children"><div class="content">&#x27;echo&#x27; is a shell builtin.  argv[] length restrictions only apply to exec.  it&#x27;s the same reason the script works,  which uses more or less the same technique,  only in a &#x27;for&#x27; loop,  which,  is also builtin.<p>even if it were an issue..  say on a terminal without working scrollback..  you can just as easily:<p><pre><code>    echo 1*
</code></pre>
and so forth.</div><br/></div></div><div id="41098878" class="c"><input type="checkbox" id="c-41098878" checked=""/><div class="controls bullet"><span class="by">oxygen_crisis</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098735">parent</a><span>|</span><a href="#41098847">prev</a><span>|</span><a href="#41098733">next</a><span>|</span><label class="collapse" for="c-41098878">[-]</label><label class="expand" for="c-41098878">[1 more]</label></div><br/><div class="children"><div class="content">echo 1*; echo 2*; ...<p>Break it into tenths (ninths, maybe, with no leading zeroes?), or finer granularity if necessary.<p>The argument list isn&#x27;t nearly as constrained as it was a decade ago. &quot;echo {00000001..10000000}&quot; works in bash on most modern distros where shells on earlier systems would have choked on a tiny ARG_MAX.</div><br/></div></div></div></div></div></div><div id="41098733" class="c"><input type="checkbox" id="c-41098733" checked=""/><div class="controls bullet"><span class="by">chx</span><span>|</span><a href="#41097821">parent</a><span>|</span><a href="#41098207">prev</a><span>|</span><a href="#41098052">next</a><span>|</span><label class="collapse" for="c-41098733">[-]</label><label class="expand" for="c-41098733">[2 more]</label></div><br/><div class="children"><div class="content">Re sub processes, genuinely curious, how do<p><pre><code>   [[ $cmdline ]] &amp;&amp; exec {cmdline}&gt;&amp;-
</code></pre>
and<p><pre><code>  exec {cmdline}&lt; &quot;$dir&quot;&#x2F;cmdline || continue
</code></pre>
work?</div><br/><div id="41098793" class="c"><input type="checkbox" id="c-41098793" checked=""/><div class="controls bullet"><span class="by">izabera</span><span>|</span><a href="#41097821">root</a><span>|</span><a href="#41098733">parent</a><span>|</span><a href="#41098052">next</a><span>|</span><label class="collapse" for="c-41098793">[-]</label><label class="expand" for="c-41098793">[1 more]</label></div><br/><div class="children"><div class="content">[[ is a keyword, and exec is a builtin. With the {name}&lt; syntax, exec is opening a file descriptor and assigning it&#x27;s numerical value to $name, and {name}&gt;&amp;- closes it</div><br/></div></div></div></div></div></div><div id="41098052" class="c"><input type="checkbox" id="c-41098052" checked=""/><div class="controls bullet"><span class="by">INTPenis</span><span>|</span><a href="#41097821">prev</a><span>|</span><a href="#41098570">next</a><span>|</span><label class="collapse" for="c-41098052">[-]</label><label class="expand" for="c-41098052">[1 more]</label></div><br/><div class="children"><div class="content">Izabera is one of the gurus in #bash@libera (formerly freenode).<p>I love all those gurus. They&#x27;ve taught me so much over the past decade.</div><br/></div></div><div id="41098570" class="c"><input type="checkbox" id="c-41098570" checked=""/><div class="controls bullet"><span class="by">stn_za</span><span>|</span><a href="#41098052">prev</a><span>|</span><a href="#41097688">next</a><span>|</span><label class="collapse" for="c-41098570">[-]</label><label class="expand" for="c-41098570">[1 more]</label></div><br/><div class="children"><div class="content">A better use case would be to list the processes on systems without procps installed.  Nice.</div><br/></div></div><div id="41098061" class="c"><input type="checkbox" id="c-41098061" checked=""/><div class="controls bullet"><span class="by">CGamesPlay</span><span>|</span><a href="#41097688">prev</a><span>|</span><a href="#41097684">next</a><span>|</span><label class="collapse" for="c-41098061">[-]</label><label class="expand" for="c-41098061">[8 more]</label></div><br/><div class="children"><div class="content">License:<p>&gt; You can freely copy and use this in any interview in which you get asked that question.
No other uses are ever allowed.</div><br/><div id="41098289" class="c"><input type="checkbox" id="c-41098289" checked=""/><div class="controls bullet"><span class="by">Arch-TK</span><span>|</span><a href="#41098061">parent</a><span>|</span><a href="#41098103">next</a><span>|</span><label class="collapse" for="c-41098289">[-]</label><label class="expand" for="c-41098289">[6 more]</label></div><br/><div class="children"><div class="content">Yeah it&#x27;s a joke license for a joke project. Do you want me to try to persuade her to dual license it with something more permissive?</div><br/><div id="41098592" class="c"><input type="checkbox" id="c-41098592" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#41098061">root</a><span>|</span><a href="#41098289">parent</a><span>|</span><a href="#41098103">next</a><span>|</span><label class="collapse" for="c-41098592">[-]</label><label class="expand" for="c-41098592">[5 more]</label></div><br/><div class="children"><div class="content">Why would we need you to do that?</div><br/><div id="41098645" class="c"><input type="checkbox" id="c-41098645" checked=""/><div class="controls bullet"><span class="by">izabera</span><span>|</span><a href="#41098061">root</a><span>|</span><a href="#41098592">parent</a><span>|</span><a href="#41098622">next</a><span>|</span><label class="collapse" for="c-41098645">[-]</label><label class="expand" for="c-41098645">[2 more]</label></div><br/><div class="children"><div class="content">He&#x27;s my fiancé :)</div><br/><div id="41098676" class="c"><input type="checkbox" id="c-41098676" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#41098061">root</a><span>|</span><a href="#41098645">parent</a><span>|</span><a href="#41098622">next</a><span>|</span><label class="collapse" for="c-41098676">[-]</label><label class="expand" for="c-41098676">[1 more]</label></div><br/><div class="children"><div class="content">I can still ask myself if I feel I need a different license! ;-)</div><br/></div></div></div></div><div id="41098610" class="c"><input type="checkbox" id="c-41098610" checked=""/><div class="controls bullet"><span class="by">Arch-TK</span><span>|</span><a href="#41098061">root</a><span>|</span><a href="#41098592">parent</a><span>|</span><a href="#41098622">prev</a><span>|</span><a href="#41098103">next</a><span>|</span><label class="collapse" for="c-41098610">[-]</label><label class="expand" for="c-41098610">[1 more]</label></div><br/><div class="children"><div class="content">I live with her :P</div><br/></div></div></div></div></div></div></div></div><div id="41097684" class="c"><input type="checkbox" id="c-41097684" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#41098061">prev</a><span>|</span><label class="collapse" for="c-41097684">[-]</label><label class="expand" for="c-41097684">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s cool, please support `ps axufww`, i miss this a lot on macOS</div><br/></div></div></div></div></div></div></div></body></html>