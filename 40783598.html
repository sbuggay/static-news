<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1719306050237" as="style"/><link rel="stylesheet" href="styles.css?v=1719306050237"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://shraiwi.github.io/read.html?md=blog/simd-fast-esp32s3.md">SIMD-accelerated computer vision on a $2 microcontroller</a> <span class="domain">(<a href="https://shraiwi.github.io">shraiwi.github.io</a>)</span></div><div class="subtext"><span>shraiwi</span> | <span>20 comments</span></div><br/><div><div id="40784465" class="c"><input type="checkbox" id="c-40784465" checked=""/><div class="controls bullet"><span class="by">evanjrowley</span><span>|</span><a href="#40785123">next</a><span>|</span><label class="collapse" for="c-40784465">[-]</label><label class="expand" for="c-40784465">[7 more]</label></div><br/><div class="children"><div class="content">A comparable board is the ESP32-CAM, which is supported by this really practical computer vision project: <a href="https:&#x2F;&#x2F;github.com&#x2F;jomjol&#x2F;AI-on-the-edge-device?tab=readme-ov-file">https:&#x2F;&#x2F;github.com&#x2F;jomjol&#x2F;AI-on-the-edge-device?tab=readme-o...</a></div><br/><div id="40785038" class="c"><input type="checkbox" id="c-40785038" checked=""/><div class="controls bullet"><span class="by">hi-v-rocknroll</span><span>|</span><a href="#40784465">parent</a><span>|</span><a href="#40784851">next</a><span>|</span><label class="collapse" for="c-40785038">[-]</label><label class="expand" for="c-40785038">[4 more]</label></div><br/><div class="children"><div class="content">In the CV department, I recently ordered a cheap FPGA + ARM Cortex-M3 + 64 Mbit SRAM + 32 Mbit flash that does camera input and HDMI output. Like a budget Zynq for CV.<p><a href="https:&#x2F;&#x2F;wiki.sipeed.com&#x2F;hardware&#x2F;en&#x2F;tang&#x2F;Tang-Nano-4K&#x2F;Nano-4K.html" rel="nofollow">https:&#x2F;&#x2F;wiki.sipeed.com&#x2F;hardware&#x2F;en&#x2F;tang&#x2F;Tang-Nano-4K&#x2F;Nano-4...</a><p><a href="https:&#x2F;&#x2F;www.aliexpress.us&#x2F;item&#x2F;3256806880637138.html" rel="nofollow">https:&#x2F;&#x2F;www.aliexpress.us&#x2F;item&#x2F;3256806880637138.html</a></div><br/><div id="40785277" class="c"><input type="checkbox" id="c-40785277" checked=""/><div class="controls bullet"><span class="by">unwind</span><span>|</span><a href="#40784465">root</a><span>|</span><a href="#40785038">parent</a><span>|</span><a href="#40784851">next</a><span>|</span><label class="collapse" for="c-40785277">[-]</label><label class="expand" for="c-40785277">[3 more]</label></div><br/><div class="children"><div class="content">Cool board!<p>Would any of the &quot;retro&quot; game&#x2F;home computer firmwares fit in that FPGA? I find comparing capacity hard for stuff like that.</div><br/><div id="40785375" class="c"><input type="checkbox" id="c-40785375" checked=""/><div class="controls bullet"><span class="by">hi-v-rocknroll</span><span>|</span><a href="#40784465">root</a><span>|</span><a href="#40785277">parent</a><span>|</span><a href="#40785401">next</a><span>|</span><label class="collapse" for="c-40785375">[-]</label><label class="expand" for="c-40785375">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s absolutely no reason ROMs have to waste scarce resources of a hybrid FPGA. Micro SD cards (called TF in China) and eMMC are the usual solutions.<p>Example: <a href="https:&#x2F;&#x2F;www.aliexpress.us&#x2F;item&#x2F;3256806498688867.html" rel="nofollow">https:&#x2F;&#x2F;www.aliexpress.us&#x2F;item&#x2F;3256806498688867.html</a></div><br/></div></div><div id="40785401" class="c"><input type="checkbox" id="c-40785401" checked=""/><div class="controls bullet"><span class="by">londons_explore</span><span>|</span><a href="#40784465">root</a><span>|</span><a href="#40785277">parent</a><span>|</span><a href="#40785375">prev</a><span>|</span><a href="#40784851">next</a><span>|</span><label class="collapse" for="c-40785401">[-]</label><label class="expand" for="c-40785401">[1 more]</label></div><br/><div class="children"><div class="content">Yes, easily, but unless someone has done it already, &#x27;porting&#x27; them to this board would be a lot of work.</div><br/></div></div></div></div></div></div><div id="40784851" class="c"><input type="checkbox" id="c-40784851" checked=""/><div class="controls bullet"><span class="by">maven29</span><span>|</span><a href="#40784465">parent</a><span>|</span><a href="#40785038">prev</a><span>|</span><a href="#40785611">next</a><span>|</span><label class="collapse" for="c-40784851">[-]</label><label class="expand" for="c-40784851">[1 more]</label></div><br/><div class="children"><div class="content">There is an ESP32-S3 version of this camera breakout board, which is presumably what OP might have used for prototyping.<p>The S3 variant easily justifies the slight additional cost, given that it&#x27;s easily faster by an order of magnitude or greater, having SIMD and an FPU.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;espressif&#x2F;esp-dl&#x2F;tree&#x2F;master&#x2F;examples&#x2F;face_recognition">https:&#x2F;&#x2F;github.com&#x2F;espressif&#x2F;esp-dl&#x2F;tree&#x2F;master&#x2F;examples&#x2F;fac...</a></div><br/></div></div><div id="40785611" class="c"><input type="checkbox" id="c-40785611" checked=""/><div class="controls bullet"><span class="by">amelius</span><span>|</span><a href="#40784465">parent</a><span>|</span><a href="#40784851">prev</a><span>|</span><a href="#40785123">next</a><span>|</span><label class="collapse" for="c-40785611">[-]</label><label class="expand" for="c-40785611">[1 more]</label></div><br/><div class="children"><div class="content">How many fps can that project do?</div><br/></div></div></div></div><div id="40785123" class="c"><input type="checkbox" id="c-40785123" checked=""/><div class="controls bullet"><span class="by">picture</span><span>|</span><a href="#40784465">prev</a><span>|</span><a href="#40785541">next</a><span>|</span><label class="collapse" for="c-40785123">[-]</label><label class="expand" for="c-40785123">[1 more]</label></div><br/><div class="children"><div class="content">Also see this short post about SIMD on ESP32-S3, discussed previously. <a href="https:&#x2F;&#x2F;bitbanksoftware.blogspot.com&#x2F;2024&#x2F;01&#x2F;surprise-esp32-s3-has-few-simd.html" rel="nofollow">https:&#x2F;&#x2F;bitbanksoftware.blogspot.com&#x2F;2024&#x2F;01&#x2F;surprise-esp32-...</a></div><br/></div></div><div id="40785541" class="c"><input type="checkbox" id="c-40785541" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#40785123">prev</a><span>|</span><a href="#40784199">next</a><span>|</span><label class="collapse" for="c-40785541">[-]</label><label class="expand" for="c-40785541">[2 more]</label></div><br/><div class="children"><div class="content">&gt;For silicon that&#x27;s cheaper than the average coffee, that&#x27;s pretty cool.<p>Maybe it&#x27;s not the chip that it&#x27;s too cheap. Maybe it&#x27;s the coffee that&#x27;s too expensive.</div><br/></div></div><div id="40784199" class="c"><input type="checkbox" id="c-40784199" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#40785541">prev</a><span>|</span><a href="#40783892">next</a><span>|</span><label class="collapse" for="c-40784199">[-]</label><label class="expand" for="c-40784199">[5 more]</label></div><br/><div class="children"><div class="content">&gt; <i>As I&#x27;ve been really interested in computer vision lately, I decided on writing a SIMD-accelerated implementation of the FAST feature detector for the ESP32-S3</i> [...]<p>&gt; <i>In the end, I was able to improve the throughput of the FAST feature detector by about 220%, from 5.1MP&#x2F;s to 11.2MP&#x2F;s in my testing. This is well within the acceptable range of performance for realtime computer vision tasks, enabling the ESP32-S3 to easily process a 30fps VGA stream.</i><p>What are some use cases for FAST?<p>Features from accelerated segment test: 
<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Features_from_accelerated_segment_test" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Features_from_accelerated_segm...</a><p>Is there TPU-like functionality in anything in this price range of chips yet?<p>Neon is an optional SIMD instruction set extension for ARMv7 and ARMv8; so Pi Zero and larger have SIMD extensions<p>Orrin Nano have 40 TOPS, which is sufficient for Copilot+ AFAIU. &quot;A PCIe Coral TPU Finally Works on Raspberry Pi 5&quot; <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38310063">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38310063</a><p>From 
<a href="https:&#x2F;&#x2F;phys.org&#x2F;news&#x2F;2024-06-infrared-visible-device-2d-material.amp" rel="nofollow">https:&#x2F;&#x2F;phys.org&#x2F;news&#x2F;2024-06-infrared-visible-device-2d-mat...</a> :<p>&gt; <i>Using this method, they were able to up-convert infrared light of wavelength around 1550 nm to 622 nm visible light. The output light wave can be detected using traditional silicon-based cameras.</i><p>&gt; <i>&quot;This process is coherent—the properties of the input beam are preserved at the output. This means that if one imprints a particular pattern in the input infrared frequency, it automatically gets transferred to the new output frequency,&quot; explains Varun Raghunathan, Associate Professor in the Department of Electrical Communication Engineering (ECE) and corresponding author of the study published in Laser &amp; Photonics Reviews.</i><p>&quot;Show HN: PicoVGA Library – VGA&#x2F;TV Display on Raspberry Pi Pico&quot; <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35117847#35120403">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35117847#35120403</a> 
<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40275530">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40275530</a><p>&quot;Designing a SIMD Algorithm from Scratch&quot; <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38450374">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38450374</a></div><br/><div id="40784346" class="c"><input type="checkbox" id="c-40784346" checked=""/><div class="controls bullet"><span class="by">shraiwi</span><span>|</span><a href="#40784199">parent</a><span>|</span><a href="#40785076">next</a><span>|</span><label class="collapse" for="c-40784346">[-]</label><label class="expand" for="c-40784346">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for reading!<p>&gt; What are some use cases for FAST?<p>The FAST feature detector is an algorithm for finding regions of an image that are visually distinctive, which can be used as a first step in motion tracking and SLAM (simultaneous localization and mapping) algorithms typically seen in XR, robotics, etc.<p>&gt; Is there TPU-like functionality in anything in this price range of chips yet?<p>I think that in the case of the ESP32-S3, its SIMD instructions are designed to accelerate the inference of quantized AI models (see: <a href="https:&#x2F;&#x2F;github.com&#x2F;espressif&#x2F;esp-dl">https:&#x2F;&#x2F;github.com&#x2F;espressif&#x2F;esp-dl</a>), and also some signal processing like FFTs. I guess you could call the SIMD instructions TPU-like, in the sense that the chip has specific instructions that facilitates ML inference (EE.VRELU.Sx performs the ReLU operation). Using these instructions will still take away CPU time where TPUs are typically their own processing core, operating asynchronously. I’d say this is closer to ARM NEON.</div><br/><div id="40784498" class="c"><input type="checkbox" id="c-40784498" checked=""/><div class="controls bullet"><span class="by">kylixz</span><span>|</span><a href="#40784199">root</a><span>|</span><a href="#40784346">parent</a><span>|</span><a href="#40785076">next</a><span>|</span><label class="collapse" for="c-40784498">[-]</label><label class="expand" for="c-40784498">[1 more]</label></div><br/><div class="children"><div class="content">Interested in doing more of this type of work optimizing a SLAM&#x2F;factorgraph pipeline?<p>Email in bio and would love to chat!</div><br/></div></div></div></div><div id="40785076" class="c"><input type="checkbox" id="c-40785076" checked=""/><div class="controls bullet"><span class="by">yatopifo</span><span>|</span><a href="#40784199">parent</a><span>|</span><a href="#40784346">prev</a><span>|</span><a href="#40783892">next</a><span>|</span><label class="collapse" for="c-40785076">[-]</label><label class="expand" for="c-40785076">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Is there TPU-like functionality in anything in this price range of chips yet?<p>Kendryte K210 supports 1x1 and 3x3 convolutions on the &quot;TPU&quot;. It was pretty well supported in terms of software &amp; documentation but sadly it hasn&#x27;t become popular.<p>These days, you can easily find cheap RV1103 (&quot;LuckFox&quot;), BL808 (&quot;Ox64&#x2F;Pine64&quot;) and CV1800B&#x2F;SG20002 (&quot;MilkV&quot;) based dev boards, all of which have some sort of basic TPU. Unfortunately, they are designed to be linux boards meaning that all TPU related stuff is extremely abstracted with zero under-the-hood documentation. So it&#x27;s absolutely unclear whether their TPUs are real or faked with clever code optimizations.</div><br/><div id="40785923" class="c"><input type="checkbox" id="c-40785923" checked=""/><div class="controls bullet"><span class="by">koerakoonlane</span><span>|</span><a href="#40784199">root</a><span>|</span><a href="#40785076">parent</a><span>|</span><a href="#40783892">next</a><span>|</span><label class="collapse" for="c-40785923">[-]</label><label class="expand" for="c-40785923">[1 more]</label></div><br/><div class="children"><div class="content">&gt; These days, you can easily find cheap RV1103 (&quot;LuckFox&quot;), BL808 (&quot;Ox64&#x2F;Pine64&quot;) and CV1800B&#x2F;SG20002 (&quot;MilkV&quot;) based dev boards, all of which have some sort of basic TPU. Unfortunately, they are designed to be linux boards meaning that all TPU related stuff is extremely abstracted with zero under-the-hood documentation. So it&#x27;s absolutely unclear whether their TPUs are real or faked with clever code optimizations.<p>They all have TPU in hardware, my team has been verifying and benchmarking them. Documentation is only available for the high-level C APIs to the libraries that a programmer is expected to use, and even that tends to be extremely lacking.</div><br/></div></div></div></div></div></div><div id="40783892" class="c"><input type="checkbox" id="c-40783892" checked=""/><div class="controls bullet"><span class="by">restricted_ptr</span><span>|</span><a href="#40784199">prev</a><span>|</span><a href="#40785268">next</a><span>|</span><label class="collapse" for="c-40783892">[-]</label><label class="expand" for="c-40783892">[3 more]</label></div><br/><div class="children"><div class="content">I wonder if ESP32 has VLIW slots and a tighter instruction packaging is possible?</div><br/><div id="40784565" class="c"><input type="checkbox" id="c-40784565" checked=""/><div class="controls bullet"><span class="by">duskwuff</span><span>|</span><a href="#40783892">parent</a><span>|</span><a href="#40785268">next</a><span>|</span><label class="collapse" for="c-40784565">[-]</label><label class="expand" for="c-40784565">[2 more]</label></div><br/><div class="children"><div class="content">Neither Xtensa nor RISC-V are VLIW architectures.</div><br/><div id="40785169" class="c"><input type="checkbox" id="c-40785169" checked=""/><div class="controls bullet"><span class="by">restricted_ptr</span><span>|</span><a href="#40783892">root</a><span>|</span><a href="#40784565">parent</a><span>|</span><a href="#40785268">next</a><span>|</span><label class="collapse" for="c-40785169">[-]</label><label class="expand" for="c-40785169">[1 more]</label></div><br/><div class="children"><div class="content">Xtensa architecture is flexible and extendable by the user. Ability to define new instructions, hw features and VLIW configurations are some of the key features. You can find more details on the internet <a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Tensilica" rel="nofollow">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Tensilica</a></div><br/></div></div></div></div></div></div><div id="40785268" class="c"><input type="checkbox" id="c-40785268" checked=""/><div class="controls bullet"><span class="by">rurban</span><span>|</span><a href="#40783892">prev</a><span>|</span><label class="collapse" for="c-40785268">[-]</label><label class="expand" for="c-40785268">[1 more]</label></div><br/><div class="children"><div class="content">We prefer something more expensive and better: <a href="https:&#x2F;&#x2F;up-board.org&#x2F;upsquared&#x2F;specifications&#x2F;" rel="nofollow">https:&#x2F;&#x2F;up-board.org&#x2F;upsquared&#x2F;specifications&#x2F;</a><p>Intel UpSquared</div><br/></div></div></div></div></div></div></div></body></html>