<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720947675952" as="style"/><link rel="stylesheet" href="styles.css?v=1720947675952"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://kerkour.com/rust-how-to-organize-large-workspaces">How to organize large Rust codebases</a> <span class="domain">(<a href="https://kerkour.com">kerkour.com</a>)</span></div><div class="subtext"><span>speckx</span> | <span>6 comments</span></div><br/><div><div id="40959495" class="c"><input type="checkbox" id="c-40959495" checked=""/><div class="controls bullet"><span class="by">danpalmer</span><span>|</span><a href="#40959519">next</a><span>|</span><label class="collapse" for="c-40959495">[-]</label><label class="expand" for="c-40959495">[3 more]</label></div><br/><div class="children"><div class="content">While these are nice tips, I&#x27;m not sure that I learnt much about organising <i>large</i> Rust codebases. I&#x27;m not very familiar with Rust, but the tip of not putting things in mod&#x2F;lib seems similar to not putting code (other than visibility&#x2F;aggregation) in `__init__.py` – something I&#x27;d advocate for on any Python codebase of any size. The directory structure tips seem ok.<p>As for versioning dependencies together at the top level, again I&#x27;m unfamiliar with Rust, but this tip seems too specific. I&#x27;ve seen large codebases where having different dependency versions was fairly important or even a core use-case. It&#x27;s nice if it&#x27;s possible, but the bigger the codebase the more this will necessarily come into question.<p>I&#x27;d love to see more detail about things like the design of internal APIs that works well for large Rust codebases, approaches to ownership that help scale the codebase, approaches to testing that work or don&#x27;t work in Rust specifically.</div><br/><div id="40959597" class="c"><input type="checkbox" id="c-40959597" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#40959495">parent</a><span>|</span><a href="#40959546">next</a><span>|</span><label class="collapse" for="c-40959597">[-]</label><label class="expand" for="c-40959597">[1 more]</label></div><br/><div class="children"><div class="content">Not clear why Docker and &quot;make&quot; should be involved, except that he likes them. Cargo and git can do the job. A build usually produces a single executable, so &quot;packaging&quot; isn&#x27;t that much of an issue.<p>There&#x27;s much that could be said on this subject. How much should be made visible via &quot;mod.rs&quot; and &quot;lib.rs&quot; files? How much lock granularity is appropriate? Should projects be composed of loosely coupled crates? How much should be global? Anything?
How do you deal with the problem that if A owns B, B can&#x27;t reference A? 
How do you deal with breaking changes to low-level public crates?<p>The article doesn&#x27;t say much about any of that. A good article on this subject would be helpful.</div><br/></div></div><div id="40959546" class="c"><input type="checkbox" id="c-40959546" checked=""/><div class="controls bullet"><span class="by">trevyn</span><span>|</span><a href="#40959495">parent</a><span>|</span><a href="#40959597">prev</a><span>|</span><a href="#40959519">next</a><span>|</span><label class="collapse" for="c-40959546">[-]</label><label class="expand" for="c-40959546">[1 more]</label></div><br/><div class="children"><div class="content">kerkour is basically a spam blog.</div><br/></div></div></div></div><div id="40959519" class="c"><input type="checkbox" id="c-40959519" checked=""/><div class="controls bullet"><span class="by">aabhay</span><span>|</span><a href="#40959495">prev</a><span>|</span><a href="#40959686">next</a><span>|</span><label class="collapse" for="c-40959519">[-]</label><label class="expand" for="c-40959519">[1 more]</label></div><br/><div class="children"><div class="content">In a future post, I would love to see a discussion of organizing your software abstractions, rather than just organizing files. For example, id love to know some ideas around keeping prior versions of structs around when you are partially upgrading some schema or other. Or about when to use macros to automate in-repo cleanups.<p>Rust is definitely a beast when managing 200K+ LOC codebases and just managing compiler woes becomes a challenge. Not to mention dealing with issues with compiler targets, feature flags, etc. It definitely goes deeper than file structure.</div><br/></div></div><div id="40959686" class="c"><input type="checkbox" id="c-40959686" checked=""/><div class="controls bullet"><span class="by">michaelscott</span><span>|</span><a href="#40959519">prev</a><span>|</span><label class="collapse" for="c-40959686">[-]</label><label class="expand" for="c-40959686">[1 more]</label></div><br/><div class="children"><div class="content">Having multiple Cargo.toml files across workspaces wreaks absolute havoc with editors like VS Code, which perform builds automatically while you work. Makes the debug cycle waaay slower, which is a tradeoff for the faster compile times I suppose?<p>Unless someone has a way of handling workspaces in VS Code, in which case please let me know</div><br/></div></div></div></div></div></div></div></body></html>