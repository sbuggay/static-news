<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1682931674111" as="style"/><link rel="stylesheet" href="styles.css?v=1682931674111"/><link rel="apple-touch-startup-image" href="https://png.pngtree.com/png-clipart/20210309/original/pngtree-a-squatting-tabby-cat-png-image_5803660.jpg"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="http://0x80.pl/notesen/2023-04-30-lookup-in-strings.html">Modern perfect hashing for strings</a>Â <span class="domain">(<a href="http://0x80.pl">0x80.pl</a>)</span></div><div class="subtext"><span>jandrewrogers</span> | <span>8 comments</span></div><br/><div><div id="35768800" class="c"><input type="checkbox" id="c-35768800" checked=""/><div class="controls bullet"><span class="by">benwills</span><span>|</span><a href="#35768086">next</a><span>|</span><label class="collapse" for="c-35768800">[-]</label><label class="expand" for="c-35768800">[1 more]</label></div><br/><div class="children"><div class="content">If the author sees this, there&#x27;s a comment on your HTTP Verb parsing post that says:<p>&quot;The major drawback of gperf is that it generates function &quot;exists&quot;, while we need a &quot;lookup&quot;.&quot;<p>gperf allows for returning actual values. I use it in a whole lot of ways (enough that I&#x27;ve written code that imports data to then generate enums, execute gperf and import generated code, etc), including for generating lookups for HTTP Verbs.<p>Let me know if you want to know how that&#x27;s done and I can give more details.</div><br/></div></div><div id="35768086" class="c"><input type="checkbox" id="c-35768086" checked=""/><div class="controls bullet"><span class="by">drpixie</span><span>|</span><a href="#35768800">prev</a><span>|</span><a href="#35768156">next</a><span>|</span><label class="collapse" for="c-35768086">[-]</label><label class="expand" for="c-35768086">[4 more]</label></div><br/><div class="children"><div class="content">Nice shortcut if you know the input is correct, but seems like it might be prone to failure with carefully constructed input strings. If I can find an input token that produces the same hash as a normal keyword, a program using this might misbehave in &quot;interesting&quot; fashions.</div><br/><div id="35768133" class="c"><input type="checkbox" id="c-35768133" checked=""/><div class="controls bullet"><span class="by">anonymoushn</span><span>|</span><a href="#35768086">parent</a><span>|</span><a href="#35768156">next</a><span>|</span><label class="collapse" for="c-35768133">[-]</label><label class="expand" for="c-35768133">[3 more]</label></div><br/><div class="children"><div class="content">I think all of these techniques check whether the input string is correct. For example see here <a href="https:&#x2F;&#x2F;github.com&#x2F;WojciechMula&#x2F;toys&#x2F;blob&#x2F;master&#x2F;lookup-in-string-set&#x2F;generated&#x2F;pext_ada-pred.cpp">https:&#x2F;&#x2F;github.com&#x2F;WojciechMula&#x2F;toys&#x2F;blob&#x2F;master&#x2F;lookup-in-s...</a></div><br/><div id="35769679" class="c"><input type="checkbox" id="c-35769679" checked=""/><div class="controls bullet"><span class="by">drpixie</span><span>|</span><a href="#35768086">root</a><span>|</span><a href="#35768133">parent</a><span>|</span><a href="#35768156">next</a><span>|</span><label class="collapse" for="c-35769679">[-]</label><label class="expand" for="c-35769679">[2 more]</label></div><br/><div class="children"><div class="content">If I was parsing the input, then parse-time is the time to assign a token-id (I&#x27;d use an enum). Then you have a unique identifier and wouldn&#x27;t need to use the fancy hash function. It&#x27;s a nice function, takes good advantage of the instruction set, but seems brittle or redundant.</div><br/><div id="35770081" class="c"><input type="checkbox" id="c-35770081" checked=""/><div class="controls bullet"><span class="by">deredede</span><span>|</span><a href="#35768086">root</a><span>|</span><a href="#35769679">parent</a><span>|</span><a href="#35768156">next</a><span>|</span><label class="collapse" for="c-35770081">[-]</label><label class="expand" for="c-35770081">[1 more]</label></div><br/><div class="children"><div class="content">When parsing, you probably use a hash table from tokens to token IDs, which is where you&#x27;d use the fancy hash function.</div><br/></div></div></div></div></div></div></div></div><div id="35768156" class="c"><input type="checkbox" id="c-35768156" checked=""/><div class="controls bullet"><span class="by">anonymoushn</span><span>|</span><a href="#35768086">prev</a><span>|</span><a href="#35768381">next</a><span>|</span><label class="collapse" for="c-35768156">[-]</label><label class="expand" for="c-35768156">[1 more]</label></div><br/><div class="children"><div class="content">This looks cool, we&#x27;ll try it out as an alternative to Zig&#x27;s std.meta.stringToEnum</div><br/></div></div><div id="35768381" class="c"><input type="checkbox" id="c-35768381" checked=""/><div class="controls bullet"><span class="by">pstoll</span><span>|</span><a href="#35768156">prev</a><span>|</span><label class="collapse" for="c-35768381">[-]</label><label class="expand" for="c-35768381">[1 more]</label></div><br/><div class="children"><div class="content">Neat. But I suggest moving the summary to the top.<p>There is a reason summaries &#x2F; tldr are at the top. They help your reader understand &#x2F; digest all the details that follow.</div><br/></div></div></div></div></div></div></div></body></html>