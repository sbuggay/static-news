<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1693904466104" as="style"/><link rel="stylesheet" href="styles.css?v=1693904466104"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://ikrima.dev/dev-notes/homelab/zfs-for-dummies/">ZFS for Dummies</a> <span class="domain">(<a href="https://ikrima.dev">ikrima.dev</a>)</span></div><div class="subtext"><span>giis</span> | <span>70 comments</span></div><br/><div><div id="37388853" class="c"><input type="checkbox" id="c-37388853" checked=""/><div class="controls bullet"><span class="by">istjohn</span><span>|</span><a href="#37389044">next</a><span>|</span><label class="collapse" for="c-37388853">[-]</label><label class="expand" for="c-37388853">[13 more]</label></div><br/><div class="children"><div class="content">I&#x27;m getting started with ZFS just now. The learning curve is steeper than I expected. I would love to have a dumbed down wrapper that made the common case dead-simple. For example:<p>- Use sane defaults for pool creation. ashift=12, lz4 compression, xattr=sa, acltype=posixacl, and atime=off. Don&#x27;t even ask me.<p>- Make encryption just on or off instead of offering five or six options<p>- Generate the encryption key for me, set up the systemd service to decrypt the pool at start up, and prompt me to back up the key somewhere<p>- `zfs list` should show if a dataset is mounted or not, if it is encrypted or not, and if the encryption key is loaded or not<p>- No recursive datasets and use {pool}:{dataset} instead of {pool}&#x2F;{dataset} to maintain a clear distinction between pools and datasets.<p>- Don&#x27;t make me name pools or snapshots. Assign pools the name {hostname}-[A-Z]. Name snapshots {pool name}_{datetime created} and give them numerical shortcuts so I never have to type that all out<p>- Don&#x27;t make me type disk IDs when creating pools. Store metadata on the disk so ZFS doesn&#x27;t get confused if I set up a pool with `&#x2F;dev&#x2F;sda` and `&#x2F;dev&#x2F;sdb` references and then shuffle around the drives<p>- Always use `pv` to show progress<p>- Automatically set up weekly scrubs<p>- Automatically set up hourly&#x2F;daily&#x2F;weekly&#x2F;monthly snapshots and snapshot pruning<p>- If I send to a disk without a pool, ask for confirmation and then create a new single disk pool for me with the same settings as on the sending pool<p>- collapse `zpool` and `zfs` into a single command<p>- Automatically use `--raw` when sending encrypted datasets, default to `--replicate` when sending, and use `-I` whenever possible when sending<p>- Provide an obvious way to mount and navigate a snapshot dataset instead of hiding the snapshot filesystem in a hidden directory</div><br/><div id="37389174" class="c"><input type="checkbox" id="c-37389174" checked=""/><div class="controls bullet"><span class="by">rollcat</span><span>|</span><a href="#37388853">parent</a><span>|</span><a href="#37389290">next</a><span>|</span><label class="collapse" for="c-37389174">[-]</label><label class="expand" for="c-37389174">[1 more]</label></div><br/><div class="children"><div class="content">A lot of these suggestions are heavily opinionated. Which is not necessarily bad, but they seem to mess with existing conventions just for the sake of it (why {pool}:{dataset}?).<p>&gt; Don&#x27;t make me name [...] snapshots.<p>You might like this little tool I wrote: <a href="https:&#x2F;&#x2F;github.com&#x2F;rollcat&#x2F;zfs-autosnap">https:&#x2F;&#x2F;github.com&#x2F;rollcat&#x2F;zfs-autosnap</a><p>You put &quot;zfs-autosnap snap&quot; in cron hourly (or however often you want a snapshot), and &quot;zfs-autosnap gc&quot; in cron daily, and it takes care of maintaining a rolling history of snapshots, per the retention policy.<p>It&#x27;s not hard writing simple ZFS command wrappers, feel free to take my code and make your own tools.</div><br/></div></div><div id="37389290" class="c"><input type="checkbox" id="c-37389290" checked=""/><div class="controls bullet"><span class="by">aborsy</span><span>|</span><a href="#37388853">parent</a><span>|</span><a href="#37389174">prev</a><span>|</span><a href="#37389152">next</a><span>|</span><label class="collapse" for="c-37389290">[-]</label><label class="expand" for="c-37389290">[2 more]</label></div><br/><div class="children"><div class="content">— when destroying a dataset, please ask for confirmation before permanently deleting it<p>— please provide support for multiple key slots as in LUKS<p>— please build in the functionality of sanoid and syncoid, so that snapshots and replication don’t need a third party tool<p>— please build a usable deduplication, so that we don’t have to use external tools such as Restic or Borg</div><br/><div id="37389440" class="c"><input type="checkbox" id="c-37389440" checked=""/><div class="controls bullet"><span class="by">istjohn</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37389290">parent</a><span>|</span><a href="#37389152">next</a><span>|</span><label class="collapse" for="c-37389440">[-]</label><label class="expand" for="c-37389440">[1 more]</label></div><br/><div class="children"><div class="content">Do you use Restic or Borg with ZFS? How do you have that set up? Do you use them in lieu of zfs send&#x2F;recv?</div><br/></div></div></div></div><div id="37389152" class="c"><input type="checkbox" id="c-37389152" checked=""/><div class="controls bullet"><span class="by">gigatexal</span><span>|</span><a href="#37388853">parent</a><span>|</span><a href="#37389290">prev</a><span>|</span><a href="#37388984">next</a><span>|</span><label class="collapse" for="c-37389152">[-]</label><label class="expand" for="c-37389152">[1 more]</label></div><br/><div class="children"><div class="content">I’m on the other end of the spectrum. I like knowing the flags and settings I use to create the pools.<p>For snapshots and replication take a look at sanoid (<a href="https:&#x2F;&#x2F;github.com&#x2F;jimsalterjrs&#x2F;sanoid">https:&#x2F;&#x2F;github.com&#x2F;jimsalterjrs&#x2F;sanoid</a>).</div><br/></div></div><div id="37388984" class="c"><input type="checkbox" id="c-37388984" checked=""/><div class="controls bullet"><span class="by">paulmd</span><span>|</span><a href="#37388853">parent</a><span>|</span><a href="#37389152">prev</a><span>|</span><a href="#37388915">next</a><span>|</span><label class="collapse" for="c-37388984">[-]</label><label class="expand" for="c-37388984">[7 more]</label></div><br/><div class="children"><div class="content">this is honestly hard because many of the decisions that matter are not things you type into zfs at all (except incidentally).<p>how many disks per vdev?  how much memory? etc<p>a lot of the things you&#x27;ve outlined are not universal at all, just situational</div><br/><div id="37389118" class="c"><input type="checkbox" id="c-37389118" checked=""/><div class="controls bullet"><span class="by">istjohn</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37388984">parent</a><span>|</span><a href="#37389137">next</a><span>|</span><label class="collapse" for="c-37389118">[-]</label><label class="expand" for="c-37389118">[3 more]</label></div><br/><div class="children"><div class="content">Yes, there is a lot of essential complexity that is unavoidable, but there are a lot of people like me who just want a better desktop file system, and we don&#x27;t need to know about SLOGs and L2ARCs and the half dozen compression algorithms, etc. It&#x27;s situational, but it&#x27;s a common enough situation that a targeted solution would be valuable.</div><br/><div id="37389162" class="c"><input type="checkbox" id="c-37389162" checked=""/><div class="controls bullet"><span class="by">MrDresden</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37389118">parent</a><span>|</span><a href="#37389137">next</a><span>|</span><label class="collapse" for="c-37389162">[-]</label><label class="expand" for="c-37389162">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m one of those who wants a better desktop file system but have stayed away from ZFS (at least for the time being) due to stories about complexity.<p>Would you say that the defaults are sane enough for that kind of person (no real configuration needed)?</div><br/><div id="37389325" class="c"><input type="checkbox" id="c-37389325" checked=""/><div class="controls bullet"><span class="by">istjohn</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37389162">parent</a><span>|</span><a href="#37389137">next</a><span>|</span><label class="collapse" for="c-37389325">[-]</label><label class="expand" for="c-37389325">[1 more]</label></div><br/><div class="children"><div class="content">No, not really. There&#x27;s a lot of unavoidable complexity like needing to understand what ZFS pools, vdevs, and datasets are and how they relate to each other. And then if you want to encrypt your data that adds another bit of functionality you need to configure. And then there are just a lot of things that aren&#x27;t that important for most people, but you won&#x27;t know if it&#x27;s important for you until you understand what they are.<p>I would say the learning curve is similar but perhaps a bit steeper than configuring vim for web development for the first time or configuring nginx and let&#x27;s encrypt on a webserver for the first time.<p>It didn&#x27;t help that I started by trying to setup root on encrypted zfs. I would recommend first using zfs unencrypted, then adding encryption once you&#x27;re comfortable with that, and finally trying &#x2F;home on zfs or even root on zfs.</div><br/></div></div></div></div></div></div><div id="37389137" class="c"><input type="checkbox" id="c-37389137" checked=""/><div class="controls bullet"><span class="by">LanternLight83</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37388984">parent</a><span>|</span><a href="#37389118">prev</a><span>|</span><a href="#37389131">next</a><span>|</span><label class="collapse" for="c-37389137">[-]</label><label class="expand" for="c-37389137">[2 more]</label></div><br/><div class="children"><div class="content">I get that it&#x27;s meant but be wrapper for common use cases, but I use ZFS on root and had to craft a custom initfs. The other nice-ities sound great (some BTRFS inspiration?), but some of these are at distro-devel level.</div><br/><div id="37389419" class="c"><input type="checkbox" id="c-37389419" checked=""/><div class="controls bullet"><span class="by">istjohn</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37389137">parent</a><span>|</span><a href="#37389131">next</a><span>|</span><label class="collapse" for="c-37389419">[-]</label><label class="expand" for="c-37389419">[1 more]</label></div><br/><div class="children"><div class="content">I looked into doing root on ZFS, but I ended up settling for &#x2F;home on ZFS. Maybe I&#x27;ll revisit it next time I build a new system when I&#x27;m more comfortable with ZFS.</div><br/></div></div></div></div><div id="37389131" class="c"><input type="checkbox" id="c-37389131" checked=""/><div class="controls bullet"><span class="by">realusername</span><span>|</span><a href="#37388853">root</a><span>|</span><a href="#37388984">parent</a><span>|</span><a href="#37389137">prev</a><span>|</span><a href="#37388915">next</a><span>|</span><label class="collapse" for="c-37389131">[-]</label><label class="expand" for="c-37389131">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m also firmly on the &quot;convention over configuration&quot; mindset, sensible defaults should be available and anybody else can still tinker if needed. I also admit that setting up zfs wasn&#x27;t easy for me (and I&#x27;m sure I haven&#x27;t done it 100% properly)</div><br/></div></div></div></div></div></div><div id="37389044" class="c"><input type="checkbox" id="c-37389044" checked=""/><div class="controls bullet"><span class="by">vermaden</span><span>|</span><a href="#37388853">prev</a><span>|</span><a href="#37389351">next</a><span>|</span><label class="collapse" for="c-37389044">[-]</label><label class="expand" for="c-37389044">[1 more]</label></div><br/><div class="children"><div class="content">Other useful things about ZFS:<p>- get to know the difference between <i>zpool-attach(8)</i> and <i>zpool-replace(8)</i>.<p>- this one will tell you where your space is used:<p><pre><code>    # zfs list -t all -o space
    NAME                      AVAIL   USED  USEDSNAP  USEDDS  USEDREFRESERV  USEDCHILD
    (...)
</code></pre>
- <i>ZFS Boot Environments</i> is the best feature to protect your OS before major changes&#x2F;upgrades<p>--- this may be useful for a start: <a href="https:&#x2F;&#x2F;is.gd&#x2F;BECTL" rel="nofollow noreferrer">https:&#x2F;&#x2F;is.gd&#x2F;BECTL</a><p>- this command will tell you all history about ZFS pool config and its changes:<p><pre><code>    # zpool history poolname
    History for &#x27;poolname&#x27;:
    2023-06-20.14:03:08 zpool create poolname ada0p1
    2023-06-20.14:03:08 zpool set autotrim=on poolname
    2023-06-20.14:03:08 zfs set atime=off poolname
    2023-06-20.14:03:08 zfs set compression=zstd poolname
    2023-06-20.14:03:08 zfs set recordsize=1m poolname
    (...)
</code></pre>
- the guide misses one important info:<p><pre><code>  --- you can create 3-way mirror - requires 3 disks and 2 may fail - still no data lost

  --- you can create 4-way mirror - requires 4 disks and 3 may fail - still no data lost

  --- you can create N-way mirror - requires N disks and N-1 may fail - still no data lost

  (useful when data is most important and you do not have that many slots&#x2F;disks)</code></pre></div><br/></div></div><div id="37389351" class="c"><input type="checkbox" id="c-37389351" checked=""/><div class="controls bullet"><span class="by">tweetle_beetle</span><span>|</span><a href="#37389044">prev</a><span>|</span><a href="#37388932">next</a><span>|</span><label class="collapse" for="c-37389351">[-]</label><label class="expand" for="c-37389351">[1 more]</label></div><br/><div class="children"><div class="content">Might not remember the details correctly but when I was younger and stupider I read a lot about how great one of the open source NAS OSs (FreeNAS?) and ZFS were from fervent fans. I bought a very low spec second hand HP micro server on eBay and jumped straight in without really knowing what I was doing. I asked a few questions on the community forum but the vast majority of answers were &quot;Have you read the documentation?!&quot; &quot;Do you have enough RAM?!&quot;.<p>The documentation in question was a PowerPoint presentation with difficult to read styling, somewhat evangelical language, lots of assumptions about knowledge and it was not regularly updated. It was vague on how much RAM was required, mainly just focused on having as much as possible. Needless to say I ignored all the red flags about the technology, the hype and my own knowledge and lost a load of data. Lots of lessons learnt.</div><br/></div></div><div id="37388932" class="c"><input type="checkbox" id="c-37388932" checked=""/><div class="controls bullet"><span class="by">customizable</span><span>|</span><a href="#37389351">prev</a><span>|</span><a href="#37388246">next</a><span>|</span><label class="collapse" for="c-37388932">[-]</label><label class="expand" for="c-37388932">[1 more]</label></div><br/><div class="children"><div class="content">We have been running a large multi-TB PostgreSQL database on ZFS for years now. ZFS makes it super easy to do backups, create test environments from past snapshots, and saves a lot of disk space thanks to built-in compression. In case anyone is interested, you can read our experience at <a href="https:&#x2F;&#x2F;lackofimagination.org&#x2F;2022&#x2F;04&#x2F;our-experience-with-postgresql-on-zfs&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;lackofimagination.org&#x2F;2022&#x2F;04&#x2F;our-experience-with-po...</a></div><br/></div></div><div id="37388246" class="c"><input type="checkbox" id="c-37388246" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#37388932">prev</a><span>|</span><a href="#37388280">next</a><span>|</span><label class="collapse" for="c-37388246">[-]</label><label class="expand" for="c-37388246">[1 more]</label></div><br/><div class="children"><div class="content">One of the diagrams under the bit about snapshotting has a typo reading &quot;snapthot&quot; and I immediately thought it was talking about instagram.<p>(I realize now after writing it that maybe snapchat should have occurred to me first, but I have never used it)</div><br/></div></div><div id="37388280" class="c"><input type="checkbox" id="c-37388280" checked=""/><div class="controls bullet"><span class="by">qwertox</span><span>|</span><a href="#37388246">prev</a><span>|</span><a href="#37389435">next</a><span>|</span><label class="collapse" for="c-37388280">[-]</label><label class="expand" for="c-37388280">[2 more]</label></div><br/><div class="children"><div class="content">FreeBSD&#x27;s Handbook on ZFS [0] and Aaron Toponce&#x27;s articles [1] were what helped me the most when getting started with ZFS<p>[0] <a href="https:&#x2F;&#x2F;docs.freebsd.org&#x2F;en&#x2F;books&#x2F;handbook&#x2F;zfs&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.freebsd.org&#x2F;en&#x2F;books&#x2F;handbook&#x2F;zfs&#x2F;</a><p>[1] <a href="https:&#x2F;&#x2F;pthree.org&#x2F;2012&#x2F;04&#x2F;17&#x2F;install-zfs-on-debian-gnulinux&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;pthree.org&#x2F;2012&#x2F;04&#x2F;17&#x2F;install-zfs-on-debian-gnulinux...</a></div><br/><div id="37389405" class="c"><input type="checkbox" id="c-37389405" checked=""/><div class="controls bullet"><span class="by">CTDOCodebases</span><span>|</span><a href="#37388280">parent</a><span>|</span><a href="#37389435">next</a><span>|</span><label class="collapse" for="c-37389405">[-]</label><label class="expand" for="c-37389405">[1 more]</label></div><br/><div class="children"><div class="content">I love FreeBSD&#x27;s docs.<p>I had an old HP Microserver with 1GB of ECC RAM lying around so I installed FreeBSD on it. I had 5 old 500GB hard drives lying around too so I set them up in a 5x mirror with help from the FreeBSD Handbook. First time using FreeBSD and it was a breeze.</div><br/></div></div></div></div><div id="37389435" class="c"><input type="checkbox" id="c-37389435" checked=""/><div class="controls bullet"><span class="by">znpy</span><span>|</span><a href="#37388280">prev</a><span>|</span><a href="#37388130">next</a><span>|</span><label class="collapse" for="c-37389435">[-]</label><label class="expand" for="c-37389435">[1 more]</label></div><br/><div class="children"><div class="content">is there an equivalent &quot;btrfs for dummies&quot; ?</div><br/></div></div><div id="37388130" class="c"><input type="checkbox" id="c-37388130" checked=""/><div class="controls bullet"><span class="by">tomxor</span><span>|</span><a href="#37389435">prev</a><span>|</span><a href="#37388159">next</a><span>|</span><label class="collapse" for="c-37388130">[-]</label><label class="expand" for="c-37388130">[5 more]</label></div><br/><div class="children"><div class="content">I recently rebuilt a load of infrastructure (mainly LAMP servers) and decided to back them all with ZFS on Linux for the benefit of efficient backup replication and encryption.<p>I&#x27;ve been using ZFS in combination with rsync for backups for a long time, so I was fairly comfortable with it... and it all worked out, but it was a way bigger time sink than I expected - because I wanted to do it right - and there is a <i>lot</i> of misleading advice on the web, particularly when it comes to running databases and replication.<p>For databases (you really should at minimum do basic tuning like block size alignment), by far the best resource I found for mariadb&#x2F;innoDB is from the lets encrypt people [0]. They give reasons for everything and cite multiple sources, which is gold. If you search around the web elsewhere you will find endless contradicting advice, anecdotes and myths that are accompanied with incomplete and baseless theories. Ultimately you should also test this stuff and understand everything you tune (it&#x27;s ok to decide to not tune something).<p>For replication, I can only recommend the man pages... yeah, really! ZFS gives you solid replication tools, but they are too agnostic, they are like git pluming, they don&#x27;t assume you&#x27;re going to be doing it over SSH (even though that&#x27;s almost always how it&#x27;s being used)... so you have to plug it together yourself, and this feels scary at first, especially because you probably want it to be automated, which means considering edge cases... which is why everyone runs to something like syncoid, but there&#x27;s something horrible I discovered with replication scripts like syncoid, which is that they don&#x27;t use ZFS&#x27;s send --replication mode! They try to reimplement it in perl, for &quot;greater flexibility&quot;, but incompletely. This is maddening when you are trying to test this stuff for the first time and find that all of the encryption roots break when you do a fresh restore, and not all dataset properties are automatically synced. ZFS takes care of all of this if you simply use the build in recursive &quot;replicate&quot; option. It&#x27;s not that hard to script manually once you commit to it, just keep it simple, don&#x27;t add a bunch of unnecessary crap into the pipeline like syncoid does, (they actually slow it down if you test), just use pv to monitor progress and it will fly.<p>I might publish my replication scripts at some point because I feel like there are no good functional reference scripts for this stuff that deal with the basics without going nuts and reinventing replication badly like so many others.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;letsencrypt&#x2F;openzfs-nvme-databases">https:&#x2F;&#x2F;github.com&#x2F;letsencrypt&#x2F;openzfs-nvme-databases</a></div><br/><div id="37388281" class="c"><input type="checkbox" id="c-37388281" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#37388130">parent</a><span>|</span><a href="#37388159">next</a><span>|</span><label class="collapse" for="c-37388281">[-]</label><label class="expand" for="c-37388281">[4 more]</label></div><br/><div class="children"><div class="content">&gt; For databases (you really should at minimum do basic tuning like block size alignment),<p>One unexpected thing to check (and do check, because your mileage <i>will</i> vary) - the suggestion is usually to align record sizes, which in practice tends to mean reducing the record size on the ZFS filesystem holding the data. I don&#x27;t doubt that this is at some level more efficient, but I can empirically tell you that it kills compression ratios. Now the funny knock-on effect is that it can - and again, I say <i>can</i> because it will vary by your workload - but it <i>can</i> actually result in worse throughput if you&#x27;re bottlenecked on disk bandwidth, because compression lets you read&#x2F;write data faster than the disk is physically capable of, so killing that compression can do bad things to your read&#x2F;write bandwidth.</div><br/><div id="37388372" class="c"><input type="checkbox" id="c-37388372" checked=""/><div class="controls bullet"><span class="by">tomxor</span><span>|</span><a href="#37388130">root</a><span>|</span><a href="#37388281">parent</a><span>|</span><a href="#37388159">next</a><span>|</span><label class="collapse" for="c-37388372">[-]</label><label class="expand" for="c-37388372">[3 more]</label></div><br/><div class="children"><div class="content">I know what you&#x27;re getting at, I wondered the same thing, but my results were the opposite of what I expected for compression.<p>I enabled lz4 compression and set recordsize for database datasets to 16k to match innoDB... turns out even at 16k my databases are extremely compressible 3-4x AFAIR (I didn&#x27;t write the DB schema for the really big DBs, they are not great, and I suspect that there is a lot of redundant data even within 16k of contiguous data)... maybe I could get even more throughput with larger record sizes, but seems unlikely.<p>As you say, mileage will vary, it&#x27;s subjective, but then I wasn&#x27;t using compression before ZFS, so I don&#x27;t have a comparison. I have only done basic performance testing, overall it&#x27;s an improvement over ext4, but I&#x27;ve not been trying to fine tune it, I&#x27;m just happy to not have made it worse so far while gaining ZFS.</div><br/><div id="37388480" class="c"><input type="checkbox" id="c-37388480" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#37388130">root</a><span>|</span><a href="#37388372">parent</a><span>|</span><a href="#37388159">next</a><span>|</span><label class="collapse" for="c-37388480">[-]</label><label class="expand" for="c-37388480">[2 more]</label></div><br/><div class="children"><div class="content">Oh, nice. In my case I sort of forgot to set the record sizes, got great compression, and then realized I&#x27;d missed the record sizes so tried lowering&#x2F;matching them and watched compression ratio drop to... I think all the way to 1.0:( So that was a natural experiment, as it were. But of course it totally depends on the exact size and most of all your data.</div><br/><div id="37388539" class="c"><input type="checkbox" id="c-37388539" checked=""/><div class="controls bullet"><span class="by">tomxor</span><span>|</span><a href="#37388130">root</a><span>|</span><a href="#37388480">parent</a><span>|</span><a href="#37388159">next</a><span>|</span><label class="collapse" for="c-37388539">[-]</label><label class="expand" for="c-37388539">[1 more]</label></div><br/><div class="children"><div class="content">I suppose ultimately the thing to test is application performance, (assuming you don&#x27;t care too much about disk space). Because it depends on the access pattern. If reading and writing contiguously, then large record sizes (even if unaligned) with high compression ratio might be fastest. but if it&#x27;s more weighted to highly randomised, then the larger ZFS record sizes might actually cause read and write amplification and a lower throughput even if the overall on-disk size is smaller (assuming it doesn&#x27;t all fit in memory in which case this is all moot).<p>Another new thing that&#x27;s possible with innoDB these days is that you can actually change the default 16k page size, i.e you could align innoDB to your preferred ZFS recordsize if that makes sense for your application.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37388159" class="c"><input type="checkbox" id="c-37388159" checked=""/><div class="controls bullet"><span class="by">guerby</span><span>|</span><a href="#37388130">prev</a><span>|</span><a href="#37387850">next</a><span>|</span><label class="collapse" for="c-37388159">[-]</label><label class="expand" for="c-37388159">[1 more]</label></div><br/><div class="children"><div class="content">I started to use ZFS (on Linux) a few years ago and it went smoothly.<p>My only surprise was volblocksize default which is pretty bad for most RAIDZ configuration: you need to increase it to avoid loosing 50% of raw disk space...<p>Articles touching this topic :<p><a href="https:&#x2F;&#x2F;jro.io&#x2F;nas&#x2F;#overhead" rel="nofollow noreferrer">https:&#x2F;&#x2F;jro.io&#x2F;nas&#x2F;#overhead</a><p><a href="https:&#x2F;&#x2F;openzfs.github.io&#x2F;openzfs-docs&#x2F;Basic%20Concepts&#x2F;RAIDZ.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;openzfs.github.io&#x2F;openzfs-docs&#x2F;Basic%20Concepts&#x2F;RAID...</a><p><a href="https:&#x2F;&#x2F;www.delphix.com&#x2F;blog&#x2F;zfs-raidz-stripe-width-or-how-i-learned-stop-worrying-and-love-raidz" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.delphix.com&#x2F;blog&#x2F;zfs-raidz-stripe-width-or-how-i...</a><p>And you end up on one of the ZFS &quot;spreadsheet&quot; out there:<p>ZFS overhead calc.xlsx
<a href="https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1tf4qx1aMJp8Lo_R6gpT689wTjHv6CGVElrPqTA0w_ZY" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1tf4qx1aMJp8Lo_R6gpT6...</a><p>RAID-Z parity cost
<a href="https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1pdu_X2tR4ztF6_HLtJ-Dc4ZcwUdt6fkCjpnXxAEFlyA" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;d&#x2F;1pdu_X2tR4ztF6_HLtJ-D...</a></div><br/></div></div><div id="37387850" class="c"><input type="checkbox" id="c-37387850" checked=""/><div class="controls bullet"><span class="by">totetsu</span><span>|</span><a href="#37388159">prev</a><span>|</span><a href="#37388121">next</a><span>|</span><label class="collapse" for="c-37387850">[-]</label><label class="expand" for="c-37387850">[7 more]</label></div><br/><div class="children"><div class="content">Nice. My gotchas form using zfs on my personal laptop with Ubuntu.<p>- if you want to copy files for example and connect your drive to another system and mount your zpool there, it sets some pool membership value on the file system and when you put it back in your system it won’t boot unless you set it back. Which involved chroot<p>- the default settings I had made snapshot every time I apt installed something, because that snap shot included my home drive when I deleted big files thereafter I didn’t get any free space back until i figued out what was going on and arbitrarily deleted some old snapshots<p>- you can’t just make a swap file and use it,</div><br/><div id="37387917" class="c"><input type="checkbox" id="c-37387917" checked=""/><div class="controls bullet"><span class="by">Helmut10001</span><span>|</span><a href="#37387850">parent</a><span>|</span><a href="#37388104">next</a><span>|</span><label class="collapse" for="c-37387917">[-]</label><label class="expand" for="c-37387917">[1 more]</label></div><br/><div class="children"><div class="content">&gt; - if you want to copy files for example and connect your drive to another system and mount your zpool there, it sets some pool membership value on the file system and when you put it back in your system it won’t boot unless you set it back. Which involved chroot<p>Isn&#x27;t this what `zpool export` is for?</div><br/></div></div><div id="37388104" class="c"><input type="checkbox" id="c-37388104" checked=""/><div class="controls bullet"><span class="by">dizhn</span><span>|</span><a href="#37387850">parent</a><span>|</span><a href="#37387917">prev</a><span>|</span><a href="#37388121">next</a><span>|</span><label class="collapse" for="c-37388104">[-]</label><label class="expand" for="c-37388104">[5 more]</label></div><br/><div class="children"><div class="content">Opensuse Tumbleweed comes with snapper which works with btrfs in a similar fashion and &#x2F;home is not included in the snapshot by default. For your use case too you should exclude &#x2F;home from your apt triggered snapshots and set a separate one for it. I had scheduled snapshots for my &#x2F;home at one point but since it&#x27;s a very actively used directory (downloading isos, games then deleting them) I had similar problems to yours. I guess we could both also have a dedicated separate directory for those short lived huge files, which don&#x27;t need a snapshot anyway.</div><br/><div id="37388857" class="c"><input type="checkbox" id="c-37388857" checked=""/><div class="controls bullet"><span class="by">totetsu</span><span>|</span><a href="#37387850">root</a><span>|</span><a href="#37388104">parent</a><span>|</span><a href="#37388160">next</a><span>|</span><label class="collapse" for="c-37388857">[-]</label><label class="expand" for="c-37388857">[2 more]</label></div><br/><div class="children"><div class="content">I found<p><pre><code>  cat &#x2F;etc&#x2F;apt&#x2F;apt.conf.d&#x2F;90_zsys_system_autosnapshot
  &#x2F;&#x2F; Takes a snapshot of the system before package changes.
  DPkg::Pre-Invoke {&quot;[ -x &#x2F;usr&#x2F;libexec&#x2F;zsys-system-autosnapshot ] &amp;&amp; &#x2F;usr&#x2F;libexec&#x2F;zsys-system-autosnapshot snapshot || true&quot;;};

  &#x2F;&#x2F; Update our bootloader to list the new snapshot after the update is done to not block the critical path
  DPkg::Post-Invoke {&quot;[ -x &#x2F;usr&#x2F;libexec&#x2F;zsys-system-autosnapshot ] &amp;&amp; &#x2F;usr&#x2F;libexec&#x2F;zsys-system-autosnapshot update-menu || true&quot;;};

</code></pre>
but how would I get this to not snapshot , say &#x2F;home&#x2F;Downloads ..
make that its own zpool?</div><br/><div id="37389008" class="c"><input type="checkbox" id="c-37389008" checked=""/><div class="controls bullet"><span class="by">dizhn</span><span>|</span><a href="#37387850">root</a><span>|</span><a href="#37388857">parent</a><span>|</span><a href="#37388160">next</a><span>|</span><label class="collapse" for="c-37389008">[-]</label><label class="expand" for="c-37389008">[1 more]</label></div><br/><div class="children"><div class="content">Dataset should be enough I think. Not zpool.<p>Hard to be sure without knowing what that script does.</div><br/></div></div></div></div><div id="37388160" class="c"><input type="checkbox" id="c-37388160" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#37387850">root</a><span>|</span><a href="#37388104">parent</a><span>|</span><a href="#37388857">prev</a><span>|</span><a href="#37388121">next</a><span>|</span><label class="collapse" for="c-37388160">[-]</label><label class="expand" for="c-37388160">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I had scheduled snapshots for my &#x2F;home at one point but since it&#x27;s a very actively used directory (downloading isos, games then deleting them) I had similar problems to yours.<p>What kind of schedule was it?  I feel like the low-impact alternative to no snapshots at all is daily snapshots for half a week to a week, and maybe some n-hourly snapshots that last a day or two.  Which I would not expect to use up very much space.</div><br/><div id="37388577" class="c"><input type="checkbox" id="c-37388577" checked=""/><div class="controls bullet"><span class="by">dizhn</span><span>|</span><a href="#37387850">root</a><span>|</span><a href="#37388160">parent</a><span>|</span><a href="#37388121">next</a><span>|</span><label class="collapse" for="c-37388577">[-]</label><label class="expand" for="c-37388577">[1 more]</label></div><br/><div class="children"><div class="content">It was very frequent (around every 5 minutes) because what I was trying to get was a failsafe in case I delete or otherwise mess up a file I was currently working on. It happened exactly once since I disabled snapshots of &#x2F;home and I was able to recover it from the terminal&#x27;s scrollback buffer of all places. :)<p>As far as I know btrfs does get slower as the number of snapshots increase. Not sure about zfs in that regard. Your plan does sound sensible. I have a feeling you could make the snapshots even more frequent without any ill effects.</div><br/></div></div></div></div></div></div></div></div><div id="37388121" class="c"><input type="checkbox" id="c-37388121" checked=""/><div class="controls bullet"><span class="by">idatum</span><span>|</span><a href="#37387850">prev</a><span>|</span><a href="#37387991">next</a><span>|</span><label class="collapse" for="c-37388121">[-]</label><label class="expand" for="c-37388121">[6 more]</label></div><br/><div class="children"><div class="content">I need 3 stores to feel I&#x27;m keeping safe years of digital family photos. 1) I have a live (local) FreeBSD ZFS server running for backups and snapshots; 2 pairs of mirrored physical drives 2) I have a USB device that takes 2 mirrored drives to recv ZFS snapshots from #1; I store that vdev backup in a safe place 3) I backup entire datasets to cloud storage from off-prem using rclone.<p>It&#x27;s #3 where I need to do some more research&#x2F;work. I need to spend some time sending snapshots&#x2F;diffs to cloud blob storage and make sure I can restore. Yes, I know there is rsync.net.<p>Any experiences to share?</div><br/><div id="37388999" class="c"><input type="checkbox" id="c-37388999" checked=""/><div class="controls bullet"><span class="by">oniony</span><span>|</span><a href="#37388121">parent</a><span>|</span><a href="#37388996">next</a><span>|</span><label class="collapse" for="c-37388999">[-]</label><label class="expand" for="c-37388999">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m using Borg to back up to rysnc.net.<p>Borg spilts your files up into chunks, encrypts them and dedupes them client-side and then syncs them with the server. Because of the deduping, versioning is cheap and you can configure how many daily, weekly, monthly, &amp;c. copies to keep. For example you could keep 7 day&#x27;s worth of copies, 6 monthly copies and 10 yearly copies.<p>Rysnc.net have special pricing for customers using Borg&#x2F;Restic:<p><a href="https:&#x2F;&#x2F;www.rsync.net&#x2F;products&#x2F;borg.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.rsync.net&#x2F;products&#x2F;borg.html</a><p><a href="https:&#x2F;&#x2F;www.rsync.net&#x2F;products&#x2F;restic.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.rsync.net&#x2F;products&#x2F;restic.html</a></div><br/></div></div><div id="37388996" class="c"><input type="checkbox" id="c-37388996" checked=""/><div class="controls bullet"><span class="by">zyberzero</span><span>|</span><a href="#37388121">parent</a><span>|</span><a href="#37388999">prev</a><span>|</span><a href="#37388575">next</a><span>|</span><label class="collapse" for="c-37388996">[-]</label><label class="expand" for="c-37388996">[1 more]</label></div><br/><div class="children"><div class="content">I bought a cheap HP Microserver with four 4 TB spinning disks that I placed at a relatives house ~1000 km from where I live. I do nightly replication to the off-site location, with an account on the receiving end that only has enough permissions to create snapshots and receive data, so even if that ssh key somehow got out in the wild things could not be deleted from the remote store. I hope :)<p>Clarification: Remote end also uses ZFS, so I can use cheap replication with encryption</div><br/></div></div><div id="37388575" class="c"><input type="checkbox" id="c-37388575" checked=""/><div class="controls bullet"><span class="by">havnagiggle</span><span>|</span><a href="#37388121">parent</a><span>|</span><a href="#37388996">prev</a><span>|</span><a href="#37388530">next</a><span>|</span><label class="collapse" for="c-37388575">[-]</label><label class="expand" for="c-37388575">[1 more]</label></div><br/><div class="children"><div class="content">My setup is similar. +1 that Restic is great. My cloud backup was sending blobs to Google workspace, but they have clamped on storage. I will be replacing that with another box at my parents that will be tucked out of the way. I will just have that wireguard tunnel to my home network and send snapshots to it. At some point I&#x27;ll turn down the workspace solution and probably also unsubscribe.</div><br/></div></div><div id="37388264" class="c"><input type="checkbox" id="c-37388264" checked=""/><div class="controls bullet"><span class="by">Maakuth</span><span>|</span><a href="#37388121">parent</a><span>|</span><a href="#37388530">prev</a><span>|</span><a href="#37387991">next</a><span>|</span><label class="collapse" for="c-37388264">[-]</label><label class="expand" for="c-37388264">[1 more]</label></div><br/><div class="children"><div class="content">I have a similar setup, though with Linux. From my experience I can recommend taking a look at restic (<a href="https:&#x2F;&#x2F;restic.readthedocs.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;restic.readthedocs.io&#x2F;</a>). It does encrypted and deduplicated snapshots to local and remote repositories. There&#x27;s a good selection of remote target options available, but you can also use it with rclone to use any weird remote. Just remember to keep a backup of your encryption key somewhere besides the machine you back up ;-)</div><br/></div></div></div></div><div id="37387991" class="c"><input type="checkbox" id="c-37387991" checked=""/><div class="controls bullet"><span class="by">asicsp</span><span>|</span><a href="#37388121">prev</a><span>|</span><a href="#37389000">next</a><span>|</span><label class="collapse" for="c-37387991">[-]</label><label class="expand" for="c-37387991">[1 more]</label></div><br/><div class="children"><div class="content">See also: <a href="https:&#x2F;&#x2F;jro.io&#x2F;truenas&#x2F;openzfs&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;jro.io&#x2F;truenas&#x2F;openzfs&#x2F;</a> (discussed here: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34318734">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34318734</a>)</div><br/></div></div><div id="37387716" class="c"><input type="checkbox" id="c-37387716" checked=""/><div class="controls bullet"><span class="by">dontupvoteme</span><span>|</span><a href="#37389000">prev</a><span>|</span><label class="collapse" for="c-37387716">[-]</label><label class="expand" for="c-37387716">[28 more]</label></div><br/><div class="children"><div class="content">As nice as the technology is as long as there&#x27;s the potential of a Damoclean license issue I&#x27;ll always feel hesitant around ZFS.<p>(Hey looks like it&#x27;s a sore spot!)</div><br/><div id="37387994" class="c"><input type="checkbox" id="c-37387994" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37388655">next</a><span>|</span><label class="collapse" for="c-37387994">[-]</label><label class="expand" for="c-37387994">[4 more]</label></div><br/><div class="children"><div class="content">This is only going to get a shedload of &quot;you do you&quot; responses. BSD licencing is quite content to use ZFS, its pretty much ubiquitous now in widescale deployment and the source would be impossible to re-lock. Worst case is fork.<p>I very much regret the fragmentation of FS design, it has many mothers. &quot;there can only be one&quot; was never going to work, but we seem to have perhaps 4-5 more than we really need. ZFS manages to wrap up a number of behaviours cohesively with good version-dependent signalling so it should always be possible to know you&#x27;re risking a non-reversible change to your flags. And, it keeps improving.<p>But, counter &quot;it keeps improving&quot; so do all the other current, maintained, developed FS and if somebody tells me they prefer to use Hammer, or one of the Linux FS models with a discrete volume-management and encryption layer, I don&#x27;t think thats necessarily wrong.<p>Mainly I regret Apple walking away. That was about Oracle behaviour. It wasn&#x27;t helpful. A lot of Apple&#x27;s FS design ideas persist. I never got resource&#x2F;data forks, it only ever appeared on my radar as .files in the UNIX AUFS backend model of them. Obviously inside Apples code, it was dealt with somehow. It felt like the wrong lessons about meta data had been learned. Maybe an Ex-VMS person went to Apple? Also Apple has a rather &quot;yea maybe or no, dunno&quot; view about case-independent or case-dependent naming. Time machine is good. Feels like it should fit ZFS well. Oh well.</div><br/><div id="37388181" class="c"><input type="checkbox" id="c-37388181" checked=""/><div class="controls bullet"><span class="by">chaxor</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37387994">parent</a><span>|</span><a href="#37388655">next</a><span>|</span><label class="collapse" for="c-37388181">[-]</label><label class="expand" for="c-37388181">[3 more]</label></div><br/><div class="children"><div class="content">I wish zfs had a &#x27;tag&#x27; type of feature like Apple style fs.  I have thought about making an object store to get some of the metadata on the fs level, rather than having to make some cobbles together solution of an SQLite DB of metadata with the files or something, but many of the object store solutions seem to be for fairly large files, rather than a few thousand pictures of family and such.
Unsure what a good solution using zfs would be.</div><br/><div id="37388227" class="c"><input type="checkbox" id="c-37388227" checked=""/><div class="controls bullet"><span class="by">adrian_b</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388181">parent</a><span>|</span><a href="#37388655">next</a><span>|</span><label class="collapse" for="c-37388227">[-]</label><label class="expand" for="c-37388227">[2 more]</label></div><br/><div class="children"><div class="content">I am not sure what kind of &quot;tag&quot; you mean, but in any modern file system which supports extended file attributes you can attach arbitrary metadata to any file.<p>You just have to define whatever kind of tags you want and choose names for the xattrs in which to store them and then you should use them in your scripts or applications.<p>I am using all the time xattrs for things like file checksums and content classification, on XFS and on FreeBSD UFS, but almost all modern file systems support xattrs, except Linux tmpfs (which has only a partial support that is useless for those who use custom xattrs, so a file with xattrs cannot be copied to &#x2F;tmp if tmpfs is used).</div><br/><div id="37389098" class="c"><input type="checkbox" id="c-37389098" checked=""/><div class="controls bullet"><span class="by">vetinari</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388227">parent</a><span>|</span><a href="#37388655">next</a><span>|</span><label class="collapse" for="c-37389098">[-]</label><label class="expand" for="c-37389098">[1 more]</label></div><br/><div class="children"><div class="content">&gt; except Linux tmpfs (which has only a partial support that is useless for those who use custom xattrs, so a file with xattrs cannot be copied to &#x2F;tmp if tmpfs is used).<p>tmpfs is getting user xattrs in kernel 6.6, together with quotas.<p>&gt; You just have to define whatever kind of tags you want and choose names for the xattrs in which to store them and then you should use them in your scripts or applications.<p>It is still just a oob store, you have to traverse the directory hierarchy old-style; the old BeOS did (and Haiku today does) something more: it indexed the selected xattrs and allowed live queries against those indices. This allowed for very interesting uses.</div><br/></div></div></div></div></div></div></div></div><div id="37388655" class="c"><input type="checkbox" id="c-37388655" checked=""/><div class="controls bullet"><span class="by">tomxor</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37387994">prev</a><span>|</span><a href="#37388192">next</a><span>|</span><label class="collapse" for="c-37388655">[-]</label><label class="expand" for="c-37388655">[1 more]</label></div><br/><div class="children"><div class="content">I was concerned about this aspect initially, but ZoL has been going for many years now. At this point even Debian (the most purist in terms of GPL considerations) includes ZoL in it&#x27;s official repository. It doesn&#x27;t distribute binaries, apt just builds the kernel module automatically.<p>Frankly, if even Debian can use it, it&#x27;s a non-issue.</div><br/></div></div><div id="37388192" class="c"><input type="checkbox" id="c-37388192" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37388655">prev</a><span>|</span><a href="#37388396">next</a><span>|</span><label class="collapse" for="c-37388192">[-]</label><label class="expand" for="c-37388192">[2 more]</label></div><br/><div class="children"><div class="content">You might want to consider using FreeBSD then, where there is no licensing issue. I&#x27;ve found it has all the stuff I liked about Linux, and less of the stuff I dislike.</div><br/><div id="37388420" class="c"><input type="checkbox" id="c-37388420" checked=""/><div class="controls bullet"><span class="by">seized</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388192">parent</a><span>|</span><a href="#37388396">next</a><span>|</span><label class="collapse" for="c-37388420">[-]</label><label class="expand" for="c-37388420">[1 more]</label></div><br/><div class="children"><div class="content">There is also Illumos&#x2F;OpenIndiana&#x2F;OmniOS, basically continuations of OpenSolaris. I have used OpenIndiana for many years and it&#x27;s been dead reliable and stable.<p>There&#x27;s quite a few &quot;quality of life&quot; differences like boot environments (boot into a pre upgraded OS state, even years old), built in SMB server with NFS v4 style ACLs, dtrace, built in snapshot scheduling and management, and Napp-It is an available web UI for management a la FreeNAS&#x2F;TrueNAS.<p>It has a few differences, service management is quite different from other things, but overall very underrated as an OS I think.</div><br/></div></div></div></div><div id="37388396" class="c"><input type="checkbox" id="c-37388396" checked=""/><div class="controls bullet"><span class="by">kaba0</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37388192">prev</a><span>|</span><a href="#37387925">next</a><span>|</span><label class="collapse" for="c-37388396">[-]</label><label class="expand" for="c-37388396">[1 more]</label></div><br/><div class="children"><div class="content">The license issue in the very worst case (but even that is quite questionable and I would say that Linus is a bit paranoid here) could only be a problem for a distro that ships it by default, you as the end user can freely use both linux and ZFS, as well as their combination.</div><br/></div></div><div id="37387925" class="c"><input type="checkbox" id="c-37387925" checked=""/><div class="controls bullet"><span class="by">wkat4242</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37388396">prev</a><span>|</span><a href="#37387831">next</a><span>|</span><label class="collapse" for="c-37387925">[-]</label><label class="expand" for="c-37387925">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not really an issue with ZFS itself. It&#x27;s a great filesystem. GPL isn&#x27;t the only way to do open source. It&#x27;s the way Linux has chosen and that has pros and cons. Not integrating so well with other open source licenses is one of the cons.</div><br/><div id="37388027" class="c"><input type="checkbox" id="c-37388027" checked=""/><div class="controls bullet"><span class="by">tylercrompton</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37387925">parent</a><span>|</span><a href="#37387831">next</a><span>|</span><label class="collapse" for="c-37388027">[-]</label><label class="expand" for="c-37388027">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Not integrating so well with other open source licenses is one of the cons.<p>That depends on what you want. If you want a license that will play well with closed source software, then yeah, it&#x27;s a downside. But the GPL family comes from the perspective of a developer who wants to retain their rights while respecting others&#x27; desire for the same. If you care about your rights, then this is an upside.</div><br/><div id="37388437" class="c"><input type="checkbox" id="c-37388437" checked=""/><div class="controls bullet"><span class="by">kaba0</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388027">parent</a><span>|</span><a href="#37387831">next</a><span>|</span><label class="collapse" for="c-37388437">[-]</label><label class="expand" for="c-37388437">[1 more]</label></div><br/><div class="children"><div class="content">CDDL (ZFS’s license) is also like that, the problem is exactly the two “strong” copyleft licenses.</div><br/></div></div></div></div></div></div><div id="37387831" class="c"><input type="checkbox" id="c-37387831" checked=""/><div class="controls bullet"><span class="by">judge2020</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37387925">prev</a><span>|</span><a href="#37388191">next</a><span>|</span><label class="collapse" for="c-37387831">[-]</label><label class="expand" for="c-37387831">[7 more]</label></div><br/><div class="children"><div class="content">Even in such an event, I don’t see how it would affect end users in an extreme way. OpenZFS doesn’t call home to make sure it’s still legal to use, so worst that could happen is that they are forced to stop distribution and you need to stay on old software until you can move to another storage system.</div><br/><div id="37387932" class="c"><input type="checkbox" id="c-37387932" checked=""/><div class="controls bullet"><span class="by">NavinF</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37387831">parent</a><span>|</span><a href="#37388254">next</a><span>|</span><label class="collapse" for="c-37387932">[-]</label><label class="expand" for="c-37387932">[1 more]</label></div><br/><div class="children"><div class="content">Not to mention Ubuntu included ZFS by default since 2016. I still remember all the doomsday predictions people made back then. People on HN and proggit kinda suck at legal</div><br/></div></div><div id="37388254" class="c"><input type="checkbox" id="c-37388254" checked=""/><div class="controls bullet"><span class="by">arjvik</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37387831">parent</a><span>|</span><a href="#37387932">prev</a><span>|</span><a href="#37388191">next</a><span>|</span><label class="collapse" for="c-37388254">[-]</label><label class="expand" for="c-37388254">[5 more]</label></div><br/><div class="children"><div class="content">Playing devil&#x27;s advocate here, but what if Oracle decides to sue you, a company with only a few thousands in revenue, for their multi-million dollar licensing fee?<p>I agree this is unlikely, but so is someone being born with as much litigiousness as Larry Ellison.</div><br/><div id="37388401" class="c"><input type="checkbox" id="c-37388401" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388254">parent</a><span>|</span><a href="#37388421">next</a><span>|</span><label class="collapse" for="c-37388401">[-]</label><label class="expand" for="c-37388401">[3 more]</label></div><br/><div class="children"><div class="content">This is built on a misunderstanding of what the ZFS licensing issue is.<p>ZFS is licensed under the CDDL [0], which is a copyleft license that grants you full rights to use the ZFS source code for basically anything, providing that any derivative works incorporating its source code are also are under the CDDL. There is no &quot;licensing fee&quot; that you can pay Oracle related to this.<p>Linux is licensed under the GPL, which just like the CDDL, is a copyleft license which requires derivative works to be distributed under the GPL.<p>The conflict here is that both require the entire derived work to be distributed under CDDL&#x2F;GPL, but obviously only one license can be picked.... even though realistically, GPL and CDDL are quite similar licenses.<p>The additional fact that is useful to know is that zfs.ko, the zfs kernel module, is distributed under the CDDL by ubuntu, and any other distro distributing it that I know of.<p>So, with that knowledge, who can sue who and why?<p>1. The people that can be sued are people distributing compiled zfs binaries (the &#x27;zfs.ko&#x27; kernel binary). In practice, this means canonical, and anyone else who distributes disk images using ZFS (such as snapshotted EC2 AMIs)<p>2. The people who can sue are the holders of the Linux GPL license, and they can do so by claiming zfs.ko violates their copyright by being a derived work of the linux kernel, but being distributed under the CDDL rather than the GPL.<p>So, first of all, the vast majority of companies using ZFS aren&#x27;t also distributing binary distributions containing zfs.ko and the linux kernel together, therefore this whole thing is moot. Realistically, most companies using ZFS only have the risk of _canonical_ being sued, and that breaking their filesystem, not them running into legal issues themselves.<p>And second, it would require a holder of Linux copyright to file suit, and realistically, no court could find significant damages here.<p>Canonical also has lawyers that claim 2 wouldn&#x27;t legally follow, that &#x27;zfs.ko&#x27; is not in fact a derived work of the linux kernel. There&#x27;s differing opinions there, but pretty much everyone agrees that the people who could sue if this interpretation is wrong is the holders of Linux copyright, not oracle.<p>[0]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Common_Development_and_Distribution_License" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Common_Development_and_Distrib...</a></div><br/><div id="37389428" class="c"><input type="checkbox" id="c-37389428" checked=""/><div class="controls bullet"><span class="by">jclulow</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388401">parent</a><span>|</span><a href="#37388470">next</a><span>|</span><label class="collapse" for="c-37389428">[-]</label><label class="expand" for="c-37389428">[1 more]</label></div><br/><div class="children"><div class="content">Note that unlike the GPL, the CDDL is file-based.  It doesn&#x27;t require your entire body of software to be CDDL, it just requires that you make modifications to CDDL-licenced files available under the CDDL.</div><br/></div></div><div id="37388470" class="c"><input type="checkbox" id="c-37388470" checked=""/><div class="controls bullet"><span class="by">arjvik</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388401">parent</a><span>|</span><a href="#37389428">prev</a><span>|</span><a href="#37388421">next</a><span>|</span><label class="collapse" for="c-37388470">[-]</label><label class="expand" for="c-37388470">[1 more]</label></div><br/><div class="children"><div class="content">I see, thanks for educating me on this with such an in-depth reply! I simply saw &quot;licensing issue&quot; and &quot;Oracle&quot; together and assumed the standard Oracle licensing worry applied.</div><br/></div></div></div></div><div id="37388421" class="c"><input type="checkbox" id="c-37388421" checked=""/><div class="controls bullet"><span class="by">kaba0</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388254">parent</a><span>|</span><a href="#37388401">prev</a><span>|</span><a href="#37388191">next</a><span>|</span><label class="collapse" for="c-37388421">[-]</label><label class="expand" for="c-37388421">[1 more]</label></div><br/><div class="children"><div class="content">On what grounds? ZFS has an open-source license. The only semi-open question related to the topic is packaging it together with another, different open-source license that is viral and mandates more things (GPL). That part is not being “violated” by an enduser, but the distro maintainer.</div><br/></div></div></div></div></div></div><div id="37388191" class="c"><input type="checkbox" id="c-37388191" checked=""/><div class="controls bullet"><span class="by">rodgerd</span><span>|</span><a href="#37387716">parent</a><span>|</span><a href="#37387831">prev</a><span>|</span><label class="collapse" for="c-37388191">[-]</label><label class="expand" for="c-37388191">[9 more]</label></div><br/><div class="children"><div class="content">Do you refuse to use NVidia cards for the same reason?</div><br/><div id="37388305" class="c"><input type="checkbox" id="c-37388305" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388191">parent</a><span>|</span><a href="#37389002">next</a><span>|</span><label class="collapse" for="c-37388305">[-]</label><label class="expand" for="c-37388305">[1 more]</label></div><br/><div class="children"><div class="content">Honestly the nvidia thing was always annoying because it seems like the linux devs are more aggressive about licensing with an actual full-on Open Source project than the very much closed-source nvidia drivers. They even both use the same approach of having a GPL wrapper to talk to the non-GPL code AFAIK:\</div><br/></div></div><div id="37389002" class="c"><input type="checkbox" id="c-37389002" checked=""/><div class="controls bullet"><span class="by">mrweasel</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388191">parent</a><span>|</span><a href="#37388305">prev</a><span>|</span><a href="#37388210">next</a><span>|</span><label class="collapse" for="c-37389002">[-]</label><label class="expand" for="c-37389002">[2 more]</label></div><br/><div class="children"><div class="content">That might be a bad example. I&#x27;d trust ZFS and the CDDL before NVIDIA any day. At least the CDDL is designed with the intention of being open attemps to work with other licenses. NVIDIA seems hellbent on working around the GPL.</div><br/><div id="37389300" class="c"><input type="checkbox" id="c-37389300" checked=""/><div class="controls bullet"><span class="by">teddyh</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37389002">parent</a><span>|</span><a href="#37388210">next</a><span>|</span><label class="collapse" for="c-37389300">[-]</label><label class="expand" for="c-37389300">[1 more]</label></div><br/><div class="children"><div class="content">The original intention of the license doesn’t really matter when its current copyright holder is Oracle.</div><br/></div></div></div></div><div id="37388210" class="c"><input type="checkbox" id="c-37388210" checked=""/><div class="controls bullet"><span class="by">dontupvoteme</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388191">parent</a><span>|</span><a href="#37389002">prev</a><span>|</span><label class="collapse" for="c-37388210">[-]</label><label class="expand" for="c-37388210">[5 more]</label></div><br/><div class="children"><div class="content">No choice on that front.</div><br/><div id="37388993" class="c"><input type="checkbox" id="c-37388993" checked=""/><div class="controls bullet"><span class="by">NavinF</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388210">parent</a><span>|</span><label class="collapse" for="c-37388993">[-]</label><label class="expand" for="c-37388993">[4 more]</label></div><br/><div class="children"><div class="content">New drivers are MIT&#x2F;GPL2 dual-licensed: <a href="https:&#x2F;&#x2F;github.com&#x2F;NVIDIA&#x2F;open-gpu-kernel-modules">https:&#x2F;&#x2F;github.com&#x2F;NVIDIA&#x2F;open-gpu-kernel-modules</a></div><br/><div id="37389024" class="c"><input type="checkbox" id="c-37389024" checked=""/><div class="controls bullet"><span class="by">mrweasel</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37388993">parent</a><span>|</span><label class="collapse" for="c-37389024">[-]</label><label class="expand" for="c-37389024">[3 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t that still require the closed source user space driver to function? I&#x27;d love to be wrong on that one.</div><br/><div id="37389358" class="c"><input type="checkbox" id="c-37389358" checked=""/><div class="controls bullet"><span class="by">vetinari</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37389024">parent</a><span>|</span><label class="collapse" for="c-37389358">[-]</label><label class="expand" for="c-37389358">[2 more]</label></div><br/><div class="children"><div class="content">In the short-term yes, in the long term the user space driver would also get open (or replaced with nouveau, since it will be on equal footing with the closed one, when communicating with kernel; just like the open vs closed amd drivers).<p>However, what will be left is a blob, that runs on the dedicated core on the GPU. The stuff that Nvidia doesn&#x27;t want to open is moved there, and that&#x27;s why the open kernel driver works only on Turing and newer.</div><br/><div id="37389434" class="c"><input type="checkbox" id="c-37389434" checked=""/><div class="controls bullet"><span class="by">mrweasel</span><span>|</span><a href="#37387716">root</a><span>|</span><a href="#37389358">parent</a><span>|</span><label class="collapse" for="c-37389434">[-]</label><label class="expand" for="c-37389434">[1 more]</label></div><br/><div class="children"><div class="content">&gt; However, what will be left is a blob, that runs on the dedicated core on the GPU<p>But that basically firmware, right? So not all that different from the firmware loaded by a NIC?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>