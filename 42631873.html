<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1736326879435" as="style"/><link rel="stylesheet" href="styles.css?v=1736326879435"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://operating-system-in-1000-lines.vercel.app/en">Operating System in 1,000 Lines – Intro</a> <span class="domain">(<a href="https://operating-system-in-1000-lines.vercel.app">operating-system-in-1000-lines.vercel.app</a>)</span></div><div class="subtext"><span>ingve</span> | <span>5 comments</span></div><br/><div><div id="42632294" class="c"><input type="checkbox" id="c-42632294" checked=""/><div class="controls bullet"><span class="by">ramon156</span><span>|</span><a href="#42632062">next</a><span>|</span><label class="collapse" for="c-42632294">[-]</label><label class="expand" for="c-42632294">[1 more]</label></div><br/><div class="children"><div class="content">For any rust enthusiasts, phil-opp&#x27;s guide is such a fun exercise to try out. It was actually the first thing I tried in Rust (very silly idea) and ended up only understanding ~5% of what I had just typed out.<p>I tried it again 2-3 years later and took the time to go over each subject. I even planned in advance to make sure I was going to finish it.</div><br/></div></div><div id="42632062" class="c"><input type="checkbox" id="c-42632062" checked=""/><div class="controls bullet"><span class="by">com</span><span>|</span><a href="#42632294">prev</a><span>|</span><a href="#42632036">next</a><span>|</span><label class="collapse" for="c-42632062">[-]</label><label class="expand" for="c-42632062">[1 more]</label></div><br/><div class="children"><div class="content">I’m interested in the use of things like virtio instead of real hardware.<p>Are there other virtualisation-driven designs for hardware devices out there rather than the qemu stuff?</div><br/></div></div><div id="42632036" class="c"><input type="checkbox" id="c-42632036" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#42632062">prev</a><span>|</span><label class="collapse" for="c-42632036">[-]</label><label class="expand" for="c-42632036">[2 more]</label></div><br/><div class="children"><div class="content">I started a toy OS years ago based on the book <i>Operating System Design</i> by Douglas Comer. Personally I just couldn&#x27;t get excited about anything that didn&#x27;t run on real hardware, so I made mine for Raspberry Pi.<p>Is there any real hardware that this could run on?<p>Looking through this seems to use a lot of assembly. In the above the amount of assembly is kept to a minimum. Pretty much just bootstrapping and context switching. The rest is done in C.</div><br/><div id="42632194" class="c"><input type="checkbox" id="c-42632194" checked=""/><div class="controls bullet"><span class="by">johndoe0815</span><span>|</span><a href="#42632036">parent</a><span>|</span><label class="collapse" for="c-42632194">[-]</label><label class="expand" for="c-42632194">[1 more]</label></div><br/><div class="children"><div class="content">Comer was also my introduction to OS design and I still like the approach used in his Xinu books.<p>I had a quick glance at the OS in the linked article. This seems to be based on a 32-bit RISC-V with MMU. However, AFAIK, all available RISC-V SoCs with MMU are 64-bit. The 32-bit cores are only used for embedded controllers (unless you want to start designing an FPGA-based system).<p>The 32 and 64 bit versions of RISC-V are _not_ binary compatible, but the differences are rather small. Porting the MMU code from 64 to 32 bit or the other way round is not very complex, see my RV32 port of xv6 at
<a href="https:&#x2F;&#x2F;github.com&#x2F;michaelengel&#x2F;xv6-rv32">https:&#x2F;&#x2F;github.com&#x2F;michaelengel&#x2F;xv6-rv32</a> (the regular MIT xv6 version only supports RV64).<p>The major difference is that virtual address translation on RV32, sv32, uses a two-level page table (10 bit index for the first level, 10 bit index for the second and 12 bit offset) whereas there are several modes of translation for RV64. The most common one, sv39, uses 39 bits of the virtual address split into three 9-bit indexes (so you need a three-level page table for 4 kB pages) plus 12 bit offset.<p>If you make the modifications, running the OS on real hardware should not be too difficult. The Allwinner D1 is a relatively simply RV64 single code SoC (boards can be found for $20 upwards from aliexpress) and getting the CPU and a UART to work is not that difficult. You can check out my xv6 port to the D1 as a reference:
<a href="https:&#x2F;&#x2F;github.com&#x2F;michaelengel&#x2F;xv6-d1">https:&#x2F;&#x2F;github.com&#x2F;michaelengel&#x2F;xv6-d1</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>