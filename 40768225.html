<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1719219674315" as="style"/><link rel="stylesheet" href="styles.css?v=1719219674315"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://seclists.org/oss-sec/2024/q2/296">Arbitrary shell command evaluation in Org Mode (GNU Emacs)</a> <span class="domain">(<a href="https://seclists.org">seclists.org</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>24 comments</span></div><br/><div><div id="40769363" class="c"><input type="checkbox" id="c-40769363" checked=""/><div class="controls bullet"><span class="by">metroholografix</span><span>|</span><a href="#40769998">next</a><span>|</span><label class="collapse" for="c-40769363">[-]</label><label class="expand" for="c-40769363">[4 more]</label></div><br/><div class="children"><div class="content">What&#x27;s of greater importance here is not this specific security issue, but the default configuration of MIME handling in Emacs which can turn any unexpected evaluation bug -which we are likely to see more of- into remote code execution. We&#x27;ve had a previous Org security issue in exactly the same vein [1] and the Emacs MIME defaults are still unsafe. Of course, one can change them (non-trivial and related documentation is extremely confusing, see [2] for a possible solution) but really Emacs should not come with these defaults.<p>The loss of on-by-default functionality such as Org fontification in email message buffers is in no way as important as being wide open to trivial remote code execution.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;emacs-mirror&#x2F;emacs&#x2F;commit&#x2F;befa9fcaae29a6c9a283ba371c3c5234c7f644eb">https:&#x2F;&#x2F;github.com&#x2F;emacs-mirror&#x2F;emacs&#x2F;commit&#x2F;befa9fcaae29a6c...</a><p>[2] <a href="https:&#x2F;&#x2F;xristos.sdf.org&#x2F;fix-gnus-mime.el.txt" rel="nofollow">https:&#x2F;&#x2F;xristos.sdf.org&#x2F;fix-gnus-mime.el.txt</a></div><br/><div id="40769983" class="c"><input type="checkbox" id="c-40769983" checked=""/><div class="controls bullet"><span class="by">hsbauauvhabzb</span><span>|</span><a href="#40769363">parent</a><span>|</span><a href="#40769998">next</a><span>|</span><label class="collapse" for="c-40769983">[-]</label><label class="expand" for="c-40769983">[3 more]</label></div><br/><div class="children"><div class="content">I don’t fully understand lisp nor emacs internals. Do you anticipate similar bugs would exist across different major and minor modes, or emacs by default?<p>E.g., is markdown-mode or python-mode likely to have similar bugs? What about web browser modes, or chat modes, etc?<p>I genuinely like emacs but I’m worried for a future where my client cannot be trusted to not evaluate random data it has in files.</div><br/><div id="40770476" class="c"><input type="checkbox" id="c-40770476" checked=""/><div class="controls bullet"><span class="by">metroholografix</span><span>|</span><a href="#40769363">root</a><span>|</span><a href="#40769983">parent</a><span>|</span><a href="#40769998">next</a><span>|</span><label class="collapse" for="c-40770476">[-]</label><label class="expand" for="c-40770476">[2 more]</label></div><br/><div class="children"><div class="content">These bugs can be described as the major or minor mode evaluating code that is provided as part of the buffer that the mode is being enabled for. The two semi-recent examples that come to mind include Org (which offers this code evaluation as a feature) and text&#x2F;enriched (which allowed arbitrary Lisp evaluation through a non-standard extension). In both of these cases, the evaluation was -somewhat- intended and even documented, so these are not bugs in the traditional definition. They become security bugs when one takes into account the exposed attack surface &#x2F; dynamic interaction with parts of Emacs automatically switching on the mode (e.g. through an email in Gnus) on 3rd party untrusted input.<p>I don&#x27;t expect to see code evaluation on untrusted input as intended features in web browser or chat modes.</div><br/><div id="40773161" class="c"><input type="checkbox" id="c-40773161" checked=""/><div class="controls bullet"><span class="by">a1369209993</span><span>|</span><a href="#40769363">root</a><span>|</span><a href="#40770476">parent</a><span>|</span><a href="#40769998">next</a><span>|</span><label class="collapse" for="c-40773161">[-]</label><label class="expand" for="c-40773161">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I don&#x27;t expect to see code evaluation on untrusted input as intended features in web browser<p>I&#x27;m not sure whether to laugh or cry at that. Suffice to say that ship has sailed all the way around the world several times, to the great detriment of everyone who isn&#x27;t a advertising or other malware-development corporation.</div><br/></div></div></div></div></div></div></div></div><div id="40769998" class="c"><input type="checkbox" id="c-40769998" checked=""/><div class="controls bullet"><span class="by">bloopernova</span><span>|</span><a href="#40769363">prev</a><span>|</span><a href="#40769238">next</a><span>|</span><label class="collapse" for="c-40769998">[-]</label><label class="expand" for="c-40769998">[2 more]</label></div><br/><div class="children"><div class="content">The vulnerability is that Emacs evaluates this automatically:<p>#+LINK: shell %(shell-command-to-string)
[[shell:touch ~&#x2F;hacked.txt]]</div><br/></div></div><div id="40769238" class="c"><input type="checkbox" id="c-40769238" checked=""/><div class="controls bullet"><span class="by">ww520</span><span>|</span><a href="#40769998">prev</a><span>|</span><a href="#40772221">next</a><span>|</span><label class="collapse" for="c-40769238">[-]</label><label class="expand" for="c-40769238">[15 more]</label></div><br/><div class="children"><div class="content">I thought it’s feature. Org mode file can be used as a runable document. You have paragraphs of text and then a section containing executable code.</div><br/><div id="40769332" class="c"><input type="checkbox" id="c-40769332" checked=""/><div class="controls bullet"><span class="by">livrem</span><span>|</span><a href="#40769238">parent</a><span>|</span><a href="#40769318">next</a><span>|</span><label class="collapse" for="c-40769332">[-]</label><label class="expand" for="c-40769332">[1 more]</label></div><br/><div class="children"><div class="content">Yes, but that is not what the linked vulnerability is about.<p><a href="https:&#x2F;&#x2F;orgmode.org&#x2F;worg&#x2F;org-contrib&#x2F;babel&#x2F;intro.html" rel="nofollow">https:&#x2F;&#x2F;orgmode.org&#x2F;worg&#x2F;org-contrib&#x2F;babel&#x2F;intro.html</a></div><br/></div></div><div id="40769318" class="c"><input type="checkbox" id="c-40769318" checked=""/><div class="controls bullet"><span class="by">tsujamin</span><span>|</span><a href="#40769238">parent</a><span>|</span><a href="#40769332">prev</a><span>|</span><a href="#40769340">next</a><span>|</span><label class="collapse" for="c-40769318">[-]</label><label class="expand" for="c-40769318">[4 more]</label></div><br/><div class="children"><div class="content">It is, similarly to how Microsoft Office documents can run legitimate&#x2F;malicious executable code.<p>Although, Office (and most other software) will at least warn you before executing code&#x2F;malware in such documents originating from the Internet.</div><br/><div id="40769853" class="c"><input type="checkbox" id="c-40769853" checked=""/><div class="controls bullet"><span class="by">smitty1e</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769318">parent</a><span>|</span><a href="#40769340">next</a><span>|</span><label class="collapse" for="c-40769853">[-]</label><label class="expand" for="c-40769853">[3 more]</label></div><br/><div class="children"><div class="content">Most recent Office configurations don&#x27;t trust any downloaded documents, and most recent email configurations have forced me to send code snippets as .txt or some denuded variation.</div><br/><div id="40771639" class="c"><input type="checkbox" id="c-40771639" checked=""/><div class="controls bullet"><span class="by">hobs</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769853">parent</a><span>|</span><a href="#40769340">next</a><span>|</span><label class="collapse" for="c-40771639">[-]</label><label class="expand" for="c-40771639">[2 more]</label></div><br/><div class="children"><div class="content">Code snippets as text is denuded but word documents are good for code... what universe is this?</div><br/><div id="40772306" class="c"><input type="checkbox" id="c-40772306" checked=""/><div class="controls bullet"><span class="by">smitty1e</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40771639">parent</a><span>|</span><a href="#40769340">next</a><span>|</span><label class="collapse" for="c-40772306">[-]</label><label class="expand" for="c-40772306">[1 more]</label></div><br/><div class="children"><div class="content">Word vs. Outlook</div><br/></div></div></div></div></div></div></div></div><div id="40769340" class="c"><input type="checkbox" id="c-40769340" checked=""/><div class="controls bullet"><span class="by">metroholografix</span><span>|</span><a href="#40769238">parent</a><span>|</span><a href="#40769318">prev</a><span>|</span><a href="#40769319">next</a><span>|</span><label class="collapse" for="c-40769340">[-]</label><label class="expand" for="c-40769340">[8 more]</label></div><br/><div class="children"><div class="content">Unexpected evaluation is never a feature, Emacs should at least warn and prompt before executing code in a file that somebody opens.</div><br/><div id="40769857" class="c"><input type="checkbox" id="c-40769857" checked=""/><div class="controls bullet"><span class="by">bachmeier</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769340">parent</a><span>|</span><a href="#40769454">next</a><span>|</span><label class="collapse" for="c-40769857">[-]</label><label class="expand" for="c-40769857">[5 more]</label></div><br/><div class="children"><div class="content">But expected evaluation is a feature, and not everyone wants to inject a permissions system that gets in the way every time you open a document. Not everything is a web browser that needs to run arbitrary code from arbitrarily bad actors.<p>A warning and a prompt would largely be useless in this case anyway. As soon as you&#x27;d click the prompt, the evil code would run. What you&#x27;d need is an option set in your init file to allow code to execute on opening only if a particular piece of information known only to you is included in the file, like #+runcode: a19ihlkn01nf2n9882n4337974biskjf</div><br/><div id="40771948" class="c"><input type="checkbox" id="c-40771948" checked=""/><div class="controls bullet"><span class="by">cobbal</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769857">parent</a><span>|</span><a href="#40771861">next</a><span>|</span><label class="collapse" for="c-40771948">[-]</label><label class="expand" for="c-40771948">[3 more]</label></div><br/><div class="children"><div class="content">Emacs already restricts what variables can be set as file-local. It will prompt you to ask what to do if you open a file containing:<p><pre><code>  ;; -*- eval: (message &quot;arbitrary code&quot;) -*-
</code></pre>
any mode associated with a file extension should be at least as secure against code execution.</div><br/><div id="40772301" class="c"><input type="checkbox" id="c-40772301" checked=""/><div class="controls bullet"><span class="by">bachmeier</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40771948">parent</a><span>|</span><a href="#40771861">next</a><span>|</span><label class="collapse" for="c-40772301">[-]</label><label class="expand" for="c-40772301">[2 more]</label></div><br/><div class="children"><div class="content">Sure, I agree with that behavior <i>assuming the user wants the security</i>. If the user wants to disable it, they should be able to do so. It&#x27;s awful to assume users can&#x27;t make the decision for themselves.</div><br/><div id="40772371" class="c"><input type="checkbox" id="c-40772371" checked=""/><div class="controls bullet"><span class="by">pama</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40772301">parent</a><span>|</span><a href="#40771861">next</a><span>|</span><label class="collapse" for="c-40772371">[-]</label><label class="expand" for="c-40772371">[1 more]</label></div><br/><div class="children"><div class="content">To be clear, this bug is about arbitrary code execution on another machine as soon as a user on that machine opens an email with Emacs that has a malicious org atrachment. It is not about the user opening one of their own files and the user has no chance to preview the code before executing it. So it is a perfect remote takeover of any machine that happens to use a default Emacs for email.</div><br/></div></div></div></div></div></div><div id="40771861" class="c"><input type="checkbox" id="c-40771861" checked=""/><div class="controls bullet"><span class="by">jlg23</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769857">parent</a><span>|</span><a href="#40771948">prev</a><span>|</span><a href="#40769454">next</a><span>|</span><label class="collapse" for="c-40771861">[-]</label><label class="expand" for="c-40771861">[1 more]</label></div><br/><div class="children"><div class="content">Codewise I&#x27;d prefer a signaled error in elisp and something like your proposed magic&#x2F;back-door as a handler you&#x27;d have to set up in user(-config) space.</div><br/></div></div></div></div><div id="40769454" class="c"><input type="checkbox" id="c-40769454" checked=""/><div class="controls bullet"><span class="by">ykonstant</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769340">parent</a><span>|</span><a href="#40769857">prev</a><span>|</span><a href="#40769319">next</a><span>|</span><label class="collapse" for="c-40769454">[-]</label><label class="expand" for="c-40769454">[2 more]</label></div><br/><div class="children"><div class="content">I am on the camp that agrees with that, but there are many who don&#x27;t :&#x2F;</div><br/><div id="40769932" class="c"><input type="checkbox" id="c-40769932" checked=""/><div class="controls bullet"><span class="by">nequo</span><span>|</span><a href="#40769238">root</a><span>|</span><a href="#40769454">parent</a><span>|</span><a href="#40769319">next</a><span>|</span><label class="collapse" for="c-40769932">[-]</label><label class="expand" for="c-40769932">[1 more]</label></div><br/><div class="children"><div class="content">As far as I can tell, Emacs prompts you every time it evaluates code when opening a file, and so does Org Babel. This can be turned off but you need to do it explicitly.</div><br/></div></div></div></div></div></div><div id="40769319" class="c"><input type="checkbox" id="c-40769319" checked=""/><div class="controls bullet"><span class="by">exe34</span><span>|</span><a href="#40769238">parent</a><span>|</span><a href="#40769340">prev</a><span>|</span><a href="#40772221">next</a><span>|</span><label class="collapse" for="c-40769319">[-]</label><label class="expand" for="c-40769319">[1 more]</label></div><br/><div class="children"><div class="content">might be good if it&#x27;s not &quot;auto run&quot;, but otherwise running code inside org-mode is definitely part of the appeal.</div><br/></div></div></div></div><div id="40772221" class="c"><input type="checkbox" id="c-40772221" checked=""/><div class="controls bullet"><span class="by">SEJeff</span><span>|</span><a href="#40769238">prev</a><span>|</span><a href="#40773680">next</a><span>|</span><label class="collapse" for="c-40772221">[-]</label><label class="expand" for="c-40772221">[1 more]</label></div><br/><div class="children"><div class="content">Clearly, if you care about security here, the best thing is to just use vim.</div><br/></div></div><div id="40773680" class="c"><input type="checkbox" id="c-40773680" checked=""/><div class="controls bullet"><span class="by">ungamedplayer</span><span>|</span><a href="#40772221">prev</a><span>|</span><label class="collapse" for="c-40773680">[-]</label><label class="expand" for="c-40773680">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;orgmode.org&#x2F;manual&#x2F;Code-Evaluation-Security.html" rel="nofollow">https:&#x2F;&#x2F;orgmode.org&#x2F;manual&#x2F;Code-Evaluation-Security.html</a><p>Following ‘shell’ and ‘elisp’ links
Org has two link types that can directly evaluate code (see External Links). Because such code is not visible, these links have a potential risk. Org therefore prompts the user when it encounters such links. The customization variables are:<p>User Option: org-link-shell-confirm-function
Function that prompts the user before executing a shell link.<p>User Option: org-link-elisp-confirm-function
Function that prompts the user before executing an Emacs Lisp link.<p>Non issue. Rtfm.</div><br/></div></div></div></div></div></div></div></body></html>