<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1686214885893" as="style"/><link rel="stylesheet" href="styles.css?v=1686214885893"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://developer.apple.com/videos/play/wwdc2023/10268">Mergeable libraries [video]</a> <span class="domain">(<a href="https://developer.apple.com">developer.apple.com</a>)</span></div><div class="subtext"><span>covector</span> | <span>47 comments</span></div><br/><div><div id="36233697" class="c"><input type="checkbox" id="c-36233697" checked=""/><div class="controls bullet"><span class="by">superkuh</span><span>|</span><a href="#36232862">next</a><span>|</span><label class="collapse" for="c-36233697">[-]</label><label class="expand" for="c-36233697">[18 more]</label></div><br/><div class="children"><div class="content">It&#x27;s really weird to me that they&#x27;re talking about balancing static vs. dynamic in terms of the dev-end build time speed vs running the software load times.<p>To me the dynamic vs static balancing act is about compatibility vs security where dynamic linked applications easily get lib security updates but the binary may or may not work with your system libs and statically compiling is more compatible but doesn&#x27;t automatically get system lib security updates.</div><br/><div id="36234490" class="c"><input type="checkbox" id="c-36234490" checked=""/><div class="controls bullet"><span class="by">hexomancer</span><span>|</span><a href="#36233697">parent</a><span>|</span><a href="#36233751">next</a><span>|</span><label class="collapse" for="c-36234490">[-]</label><label class="expand" for="c-36234490">[7 more]</label></div><br/><div class="children"><div class="content">Frankly, I think dynamic libraries are <i>less</i> secure (at least when talking about a desktop environment, not servers) because sometimes package managers update dynamic library dependencies without actually checking if binary compatibility was preserved in the new version, causing various crashes and bugs (I experienced this first hand with an archlinux package of a software I was developing).</div><br/><div id="36234747" class="c"><input type="checkbox" id="c-36234747" checked=""/><div class="controls bullet"><span class="by">lgg</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234490">parent</a><span>|</span><a href="#36235897">next</a><span>|</span><label class="collapse" for="c-36234747">[-]</label><label class="expand" for="c-36234747">[4 more]</label></div><br/><div class="children"><div class="content">That may true on Linux, but it is not the case on Apple platforms. On Darwin the base system is immutable and the dylibs embedded in an application bundle cannot be changed without invalidating the codesignature. In order to have this sort of issue occur you need to opt out of multiple security settings that are enabled by default (such as the hardened runtime and library validation) AND then be sloppy with your use of relative paths or dlopen() calls.</div><br/><div id="36235182" class="c"><input type="checkbox" id="c-36235182" checked=""/><div class="controls bullet"><span class="by">asveikau</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234747">parent</a><span>|</span><a href="#36234826">next</a><span>|</span><label class="collapse" for="c-36235182">[-]</label><label class="expand" for="c-36235182">[1 more]</label></div><br/><div class="children"><div class="content">I think you totally missed what the issue is here. In that scenario, Apple could still patch a system lib and it can break your application.<p>It&#x27;s not a question of the library updates being untrustworthy and code signing by the vendors fixes it. It&#x27;s the library updates themselves breaking shit, not intentionally.<p>Static linking prevents that, at the cost of disk space and memory and missing out on updates that might not (usually won&#x27;t) break your app.<p>Otoh, if you told me apple is more careful about breaking ABIs with updates to shared libraries, that is believable.</div><br/></div></div><div id="36234826" class="c"><input type="checkbox" id="c-36234826" checked=""/><div class="controls bullet"><span class="by">hexomancer</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234747">parent</a><span>|</span><a href="#36235182">prev</a><span>|</span><a href="#36235744">next</a><span>|</span><label class="collapse" for="c-36234826">[-]</label><label class="expand" for="c-36234826">[1 more]</label></div><br/><div class="children"><div class="content">Yeah this is the right way of doing it. The archlinux (and most other distributions&#x27;) way is profoundly stupid.</div><br/></div></div><div id="36235744" class="c"><input type="checkbox" id="c-36235744" checked=""/><div class="controls bullet"><span class="by">politician</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234747">parent</a><span>|</span><a href="#36234826">prev</a><span>|</span><a href="#36235897">next</a><span>|</span><label class="collapse" for="c-36235744">[-]</label><label class="expand" for="c-36235744">[1 more]</label></div><br/><div class="children"><div class="content">Incidentally, the same strong security measures have to be disabled to change the code templates that start every new Swift code file with a comment block containing the current date and the name of the person that created the file. I will never understand what led to this— it’s as if they created this before source control existed.</div><br/></div></div></div></div><div id="36235897" class="c"><input type="checkbox" id="c-36235897" checked=""/><div class="controls bullet"><span class="by">cpuguy83</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234490">parent</a><span>|</span><a href="#36234747">prev</a><span>|</span><a href="#36235873">next</a><span>|</span><label class="collapse" for="c-36235897">[-]</label><label class="expand" for="c-36235897">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s why distributions like Debian&#x2F;Ubuntu&#x2F;RHEL exist.
They provide a stable toolchain to build on top of _within_ a major release of the distro.</div><br/></div></div><div id="36235873" class="c"><input type="checkbox" id="c-36235873" checked=""/><div class="controls bullet"><span class="by">1letterunixname</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234490">parent</a><span>|</span><a href="#36235897">prev</a><span>|</span><a href="#36233751">next</a><span>|</span><label class="collapse" for="c-36235873">[-]</label><label class="expand" for="c-36235873">[1 more]</label></div><br/><div class="children"><div class="content">This is a 40+ year old problem that&#x27;s been solved but not widely solved.<p>There are no security implications here because it&#x27;s strictly a configuration management problem. If only root can do software updates, then there is no security problem. Don&#x27;t modify software with incompatible versions, and there is also no problem.<p>Package&#x2F;dependency management on single &#x2F;usr&#x2F;lib Linux distros is a disaster because it doesn&#x27;t allow for side-by-side installations of various versions leading to upgrade dependency hell. Nix solves this by isolating and versioning dependencies. GNU stow and habitat also address this.</div><br/></div></div></div></div><div id="36233751" class="c"><input type="checkbox" id="c-36233751" checked=""/><div class="controls bullet"><span class="by">liuliu</span><span>|</span><a href="#36233697">parent</a><span>|</span><a href="#36234490">prev</a><span>|</span><a href="#36234291">next</a><span>|</span><label class="collapse" for="c-36233751">[-]</label><label class="expand" for="c-36233751">[5 more]</label></div><br/><div class="children"><div class="content">They are talking about app-bundled dylibs, which cannot be updated separately due to the whole-bundle signing.</div><br/><div id="36235097" class="c"><input type="checkbox" id="c-36235097" checked=""/><div class="controls bullet"><span class="by">layer8</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36233751">parent</a><span>|</span><a href="#36233798">next</a><span>|</span><label class="collapse" for="c-36235097">[-]</label><label class="expand" for="c-36235097">[1 more]</label></div><br/><div class="children"><div class="content">Whole-bundle signing wouldn’t need to prevent security updates of individual libraries to be loaded when provided on the side, similar to cryptexes.</div><br/></div></div><div id="36233798" class="c"><input type="checkbox" id="c-36233798" checked=""/><div class="controls bullet"><span class="by">notacoward</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36233751">parent</a><span>|</span><a href="#36235097">prev</a><span>|</span><a href="#36234291">next</a><span>|</span><label class="collapse" for="c-36233798">[-]</label><label class="expand" for="c-36233798">[3 more]</label></div><br/><div class="children"><div class="content">In other words it&#x27;s a fix for a somewhat Apple-specific (and in this case Apple-created) problem?</div><br/><div id="36234454" class="c"><input type="checkbox" id="c-36234454" checked=""/><div class="controls bullet"><span class="by">conradev</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36233798">parent</a><span>|</span><a href="#36233812">next</a><span>|</span><label class="collapse" for="c-36234454">[-]</label><label class="expand" for="c-36234454">[1 more]</label></div><br/><div class="children"><div class="content">The problem is not Apple-specific and their solution could be useful elsewhere.<p>The specific optimization this achieves is during build time only: these new files are static libraries that are quicker to link. It is a small shift of some of the linking pipeline into the (parallel) builds of dependent libraries, rather than heaping it all onto the linker at the end of the build. The linker has to essentially re-link from scratch for every small change.<p>Parallelization has long been known as the best way to speed up linking. This Apple change comes in addition to rewriting their linker to be massively parallel. Mold did it first, though: <a href="https:&#x2F;&#x2F;github.com&#x2F;rui314&#x2F;mold">https:&#x2F;&#x2F;github.com&#x2F;rui314&#x2F;mold</a><p>edit: lld did it first, mold improved upon it<p>A faster development cycle is one of the coolest improvements that Zig brings – lightning fast recompiles, bringing the native development cycle closer to web speed. More languages should get this capability, and Apple needs it for Swift to get instantly updating SwiftUI previews.<p>Static linking is required to get the best performance: no linker runtime cost, cross-language LTO and dead code elimination<p>If this optimization is generally applicable and developers find it worthwhile, I could imagine this making its way to GCC-land. At the very least, gold needs replacing&#x2F;rewriting to be competitive now.<p>edited: for clarity</div><br/></div></div><div id="36233812" class="c"><input type="checkbox" id="c-36233812" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36233798">parent</a><span>|</span><a href="#36234454">prev</a><span>|</span><a href="#36234291">next</a><span>|</span><label class="collapse" for="c-36233812">[-]</label><label class="expand" for="c-36233812">[1 more]</label></div><br/><div class="children"><div class="content">iOS definitely isn&#x27;t the only platform where apps ship their own versions of DLLs.</div><br/></div></div></div></div></div></div><div id="36234291" class="c"><input type="checkbox" id="c-36234291" checked=""/><div class="controls bullet"><span class="by">RcouF1uZ4gsC</span><span>|</span><a href="#36233697">parent</a><span>|</span><a href="#36233751">prev</a><span>|</span><a href="#36232862">next</a><span>|</span><label class="collapse" for="c-36234291">[-]</label><label class="expand" for="c-36234291">[5 more]</label></div><br/><div class="children"><div class="content">I think the whole security thing of relying on dynamic linking is a red herring.<p>It is neither necessary nor sufficient. It will miss private dynamic libraries, Docker containers, potentially virtual envs.<p>And it has a huge cost in terms of maintenance and backwards compatibility.<p>In a world where we have regular builds from source, this model really doesn&#x27;t have a place.</div><br/><div id="36234757" class="c"><input type="checkbox" id="c-36234757" checked=""/><div class="controls bullet"><span class="by">JohnFen</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234291">parent</a><span>|</span><a href="#36234360">next</a><span>|</span><label class="collapse" for="c-36234757">[-]</label><label class="expand" for="c-36234757">[2 more]</label></div><br/><div class="children"><div class="content">I disagree, especially for the desktop. I think there&#x27;s great value in being able to update a shared library and get a fix in place for all applications, versus waiting for each application to update.</div><br/><div id="36235956" class="c"><input type="checkbox" id="c-36235956" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234757">parent</a><span>|</span><a href="#36234360">next</a><span>|</span><label class="collapse" for="c-36235956">[-]</label><label class="expand" for="c-36235956">[1 more]</label></div><br/><div class="children"><div class="content">Apps ship with vendored or statically linked dependencies everywhere possible these days because system wide updates of shared libraries have caused too many breakages. It&#x27;s just not a viable technology for todays&#x27; ecosystems.</div><br/></div></div></div></div><div id="36234360" class="c"><input type="checkbox" id="c-36234360" checked=""/><div class="controls bullet"><span class="by">notacoward</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234291">parent</a><span>|</span><a href="#36234757">prev</a><span>|</span><a href="#36232862">next</a><span>|</span><label class="collapse" for="c-36234360">[-]</label><label class="expand" for="c-36234360">[2 more]</label></div><br/><div class="children"><div class="content">&gt; It will miss private dynamic libraries, Docker containers, potentially virtual envs.<p>Yes, it will. Does that make dynamic libraries a red herring, or does it mean these approaches all make the same mistake? Please <i>think</i> before you answer. Just because something&#x27;s common doesn&#x27;t mean it&#x27;s wise or necessary.<p>&gt; it has a huge cost in terms of maintenance and backwards compatibility<p>How much are those &quot;huge costs&quot; unique to that approach? Maintenance and backwards compatibility are <i>still</i> problems even with static linking or embedding into containers or any other alternative. It&#x27;s disingenuous to count common problems against only one approach. The real tradeoff is between problems that are unique to each, and it&#x27;s possible to disagree about which choice is best without stacking the deck for one side.</div><br/><div id="36234501" class="c"><input type="checkbox" id="c-36234501" checked=""/><div class="controls bullet"><span class="by">nicoburns</span><span>|</span><a href="#36233697">root</a><span>|</span><a href="#36234360">parent</a><span>|</span><a href="#36232862">next</a><span>|</span><label class="collapse" for="c-36234501">[-]</label><label class="expand" for="c-36234501">[1 more]</label></div><br/><div class="children"><div class="content">Ultimately if the app is unmaintained, then it&#x27;s likely to have security issues even if it&#x27;s using dynamic libraries. If it is maintained then it shouldn&#x27;t be a big deal to update it.</div><br/></div></div></div></div></div></div></div></div><div id="36232862" class="c"><input type="checkbox" id="c-36232862" checked=""/><div class="controls bullet"><span class="by">covector</span><span>|</span><a href="#36233697">prev</a><span>|</span><a href="#36234165">next</a><span>|</span><label class="collapse" for="c-36232862">[-]</label><label class="expand" for="c-36232862">[1 more]</label></div><br/><div class="children"><div class="content">Documentation at<p><a href="https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;xcode&#x2F;configuring-your-project-to-use-mergeable-libraries" rel="nofollow">https:&#x2F;&#x2F;developer.apple.com&#x2F;documentation&#x2F;xcode&#x2F;configuring-...</a></div><br/></div></div><div id="36234165" class="c"><input type="checkbox" id="c-36234165" checked=""/><div class="controls bullet"><span class="by">jevinskie</span><span>|</span><a href="#36232862">prev</a><span>|</span><a href="#36234895">next</a><span>|</span><label class="collapse" for="c-36234165">[-]</label><label class="expand" for="c-36234165">[1 more]</label></div><br/><div class="children"><div class="content">They better keep the new linker open source like they did for ld64 (despite delays), or it is going to become a private ABI nightmare.</div><br/></div></div><div id="36234895" class="c"><input type="checkbox" id="c-36234895" checked=""/><div class="controls bullet"><span class="by">plorkyeran</span><span>|</span><a href="#36234165">prev</a><span>|</span><a href="#36233737">next</a><span>|</span><label class="collapse" for="c-36234895">[-]</label><label class="expand" for="c-36234895">[3 more]</label></div><br/><div class="children"><div class="content">&gt; That does mean if you rely on bundle lookup support, you should update your minimum deployment version to iOS 12 or later to use mergeable libraries. But if you don&#x27;t rely on these APIs, you can disable this support with the new linker option -no_merged_libraries_hook. Then you won&#x27;t need to update your app&#x27;s deployment version.<p>I guess no one told the linker team that Xcode 15 was going to bump the minimum deployment target to iOS 12? Sort of awkward that no one caught that this bit of the talk isn&#x27;t actually applicable to anyone.</div><br/><div id="36237890" class="c"><input type="checkbox" id="c-36237890" checked=""/><div class="controls bullet"><span class="by">JimDabell</span><span>|</span><a href="#36234895">parent</a><span>|</span><a href="#36237869">prev</a><span>|</span><a href="#36233737">next</a><span>|</span><label class="collapse" for="c-36237890">[-]</label><label class="expand" for="c-36237890">[1 more]</label></div><br/><div class="children"><div class="content">Hardly anybody supports iOS 11 these days anyway. Every device capable of running iOS 11 can be upgraded to iOS 12, which was released almost five years ago.</div><br/></div></div></div></div><div id="36233737" class="c"><input type="checkbox" id="c-36233737" checked=""/><div class="controls bullet"><span class="by">liuliu</span><span>|</span><a href="#36234895">prev</a><span>|</span><a href="#36236161">next</a><span>|</span><label class="collapse" for="c-36233737">[-]</label><label class="expand" for="c-36233737">[3 more]</label></div><br/><div class="children"><div class="content">Weird. Yes, link time is a big issue at development time, but with the new development of ld-prime and sold, seems trading that with dylib is not a big of a deal.<p>On the other hand, the other big use of dylib I saw for apps to embed (other than providing 3rd-party libraries for other people to use), is to share code between main app binary and extensions, which mergeable library doesn&#x27;t seem to support.<p>I guess the biggest use is indeed to deliver 3rd-party close-source libraries?</div><br/><div id="36233831" class="c"><input type="checkbox" id="c-36233831" checked=""/><div class="controls bullet"><span class="by">compiler-guy</span><span>|</span><a href="#36233737">parent</a><span>|</span><a href="#36236161">next</a><span>|</span><label class="collapse" for="c-36233831">[-]</label><label class="expand" for="c-36233831">[2 more]</label></div><br/><div class="children"><div class="content">Many, perhaps most?, dylibs that a Mac app ships with are all within the app bundle itself, and signed as such, so dylib sharing is not a common use case.</div><br/><div id="36233969" class="c"><input type="checkbox" id="c-36233969" checked=""/><div class="controls bullet"><span class="by">liuliu</span><span>|</span><a href="#36233737">root</a><span>|</span><a href="#36233831">parent</a><span>|</span><a href="#36236161">next</a><span>|</span><label class="collapse" for="c-36233969">[-]</label><label class="expand" for="c-36233969">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, and the only reason they don&#x27;t static link is because these dylibs are some 3rd-party closed-source libraries to avoid a lot of version clashes comparing to ship static lib naively.<p>Otherwise you put some code in dylib so your app extension can share some code with the main app, but that is tricky due to different RAM usage restrictions between app extension v.s. main app.</div><br/></div></div></div></div></div></div><div id="36236161" class="c"><input type="checkbox" id="c-36236161" checked=""/><div class="controls bullet"><span class="by">graderjs</span><span>|</span><a href="#36233737">prev</a><span>|</span><a href="#36235085">next</a><span>|</span><label class="collapse" for="c-36236161">[-]</label><label class="expand" for="c-36236161">[6 more]</label></div><br/><div class="children"><div class="content">Will this make it possible to link in standalone libraries as like a single bundle easily and distribute that without having to worry about local installations?<p>E.g., I tried to bundle ffmpeg as a library with my voice memo transcription MacOS app^0, but it was too difficult, so I just went with building a standalone ffmpeg binary (~40MB), and instrumenting it with a bash script that I called from the Objective-C code, ha ha ha! :)<p>0: <a href="https:&#x2F;&#x2F;apps.apple.com&#x2F;us&#x2F;app&#x2F;wisprnote&#x2F;id1671480366?mt=12" rel="nofollow">https:&#x2F;&#x2F;apps.apple.com&#x2F;us&#x2F;app&#x2F;wisprnote&#x2F;id1671480366?mt=12</a></div><br/><div id="36237120" class="c"><input type="checkbox" id="c-36237120" checked=""/><div class="controls bullet"><span class="by">harrisi</span><span>|</span><a href="#36236161">parent</a><span>|</span><a href="#36235085">next</a><span>|</span><label class="collapse" for="c-36237120">[-]</label><label class="expand" for="c-36237120">[5 more]</label></div><br/><div class="children"><div class="content">Just a side note, what you&#x27;re doing sounds like a violation of the FFmpeg license. <a href="https:&#x2F;&#x2F;www.ffmpeg.org&#x2F;legal.html" rel="nofollow">https:&#x2F;&#x2F;www.ffmpeg.org&#x2F;legal.html</a></div><br/><div id="36238181" class="c"><input type="checkbox" id="c-36238181" checked=""/><div class="controls bullet"><span class="by">graderjs</span><span>|</span><a href="#36236161">root</a><span>|</span><a href="#36237120">parent</a><span>|</span><a href="#36238004">next</a><span>|</span><label class="collapse" for="c-36238181">[-]</label><label class="expand" for="c-36238181">[1 more]</label></div><br/><div class="children"><div class="content">Ha ha ha! :) Thanks for the side note, do you have any answer to the <i>actual</i> question? Ha ha ha! :)</div><br/></div></div><div id="36238004" class="c"><input type="checkbox" id="c-36238004" checked=""/><div class="controls bullet"><span class="by">throwaway290</span><span>|</span><a href="#36236161">root</a><span>|</span><a href="#36237120">parent</a><span>|</span><a href="#36238181">prev</a><span>|</span><a href="#36237272">next</a><span>|</span><label class="collapse" for="c-36238004">[-]</label><label class="expand" for="c-36238004">[1 more]</label></div><br/><div class="children"><div class="content">&gt; If you’re using AGPL-licensed software like a database engine or my own AGPL-licensed works, and you haven’t made any changes to the source code, all you have to do is provide a link to the upstream source code somewhere, and if users ask for it, direct them there. If you have modified the software, you simply have to publish your modifications. The easiest way to do this is to send it as a patch upstream, but you could use something as simple as providing a tarball to your users.<p>(AGPL is generally stricter than LGPL)<p><a href="https:&#x2F;&#x2F;drewdevault.com&#x2F;2020&#x2F;07&#x2F;27&#x2F;Anti-AGPL-propaganda.html" rel="nofollow">https:&#x2F;&#x2F;drewdevault.com&#x2F;2020&#x2F;07&#x2F;27&#x2F;Anti-AGPL-propaganda.html</a></div><br/></div></div><div id="36237272" class="c"><input type="checkbox" id="c-36237272" checked=""/><div class="controls bullet"><span class="by">pertymcpert</span><span>|</span><a href="#36236161">root</a><span>|</span><a href="#36237120">parent</a><span>|</span><a href="#36238004">prev</a><span>|</span><a href="#36235085">next</a><span>|</span><label class="collapse" for="c-36237272">[-]</label><label class="expand" for="c-36237272">[2 more]</label></div><br/><div class="children"><div class="content">What exactly are they violating? Isn&#x27;t running a binary with a bash script ok?</div><br/><div id="36237375" class="c"><input type="checkbox" id="c-36237375" checked=""/><div class="controls bullet"><span class="by">harrisi</span><span>|</span><a href="#36236161">root</a><span>|</span><a href="#36237272">parent</a><span>|</span><a href="#36235085">next</a><span>|</span><label class="collapse" for="c-36237375">[-]</label><label class="expand" for="c-36237375">[1 more]</label></div><br/><div class="children"><div class="content">Just based on what the comment says, they&#x27;re distributing a compiled FFmpeg, presumably not with source or attribution. I can&#x27;t check to see if there&#x27;s information in the app but there&#x27;s no mention of it on the store page or anywhere else I can find either.<p>They could be fine, but going through the checklist FFmpeg provides for legal considerations (not legal advice), they seem to be doing the opposite of all of them.</div><br/></div></div></div></div></div></div></div></div><div id="36235085" class="c"><input type="checkbox" id="c-36235085" checked=""/><div class="controls bullet"><span class="by">mkoubaa</span><span>|</span><a href="#36236161">prev</a><span>|</span><a href="#36233776">next</a><span>|</span><label class="collapse" for="c-36235085">[-]</label><label class="expand" for="c-36235085">[1 more]</label></div><br/><div class="children"><div class="content">Really happy to see this and the child in me hopes to see something like this get &quot;up streamed&quot; into the ELF spec.</div><br/></div></div><div id="36233776" class="c"><input type="checkbox" id="c-36233776" checked=""/><div class="controls bullet"><span class="by">notacoward</span><span>|</span><a href="#36235085">prev</a><span>|</span><a href="#36234301">next</a><span>|</span><label class="collapse" for="c-36233776">[-]</label><label class="expand" for="c-36233776">[8 more]</label></div><br/><div class="children"><div class="content">This looks <i>really</i> hype-y. AFAICT a &quot;merged&quot; binary is just a statically linked one. The only problem it solves is a self-inflicted one - failure of the old static linker to prune or de-duplicate stuff in linked libraries (particularly ObjC-specific stuff). It notably does <i>not</i> solve the main problem with static linking - old insecure code which would have been fixed with an updated dynamic library but is instead &quot;stranded&quot; by having already been copied into executables (or bundles and no reasonable person would quibble about that) never to change again. Also: provenance, supply chain, etc.<p>Yes, I&#x27;m aware that superkuh beat me to this last point, and also that updating dynamic libraries can also cause breakage. But I still think it&#x27;s important to note that this isn&#x27;t really advancing the state of the art like Apple would like you to believe. It&#x27;s just a new middle-of-the-road approach with its own possibly-positive tradeoffs <i>and pitfalls</i>. Nothing here that wasn&#x27;t already considered at least thirty years ago, and whether they were right or wrong to choose another path is less relevant than the fact that it&#x27;s <i>not new</i>.</div><br/><div id="36234136" class="c"><input type="checkbox" id="c-36234136" checked=""/><div class="controls bullet"><span class="by">lgg</span><span>|</span><a href="#36233776">parent</a><span>|</span><a href="#36234353">next</a><span>|</span><label class="collapse" for="c-36234136">[-]</label><label class="expand" for="c-36234136">[1 more]</label></div><br/><div class="children"><div class="content">There is a bit more to it than that. Yes, it was always possible to use a mess of build rules and shell scripts to make your debug and release builds swap between fully static and dynamic libraries, but it was a lot of work, and was difficult to maintain. The novelty of mergeable dylibs is that they now make it trivial to switch between the two without all of that work. In particular it solves two large problems people tended to run into:<p>1. Static archives and dynamic libraries have different semantics with respect to symbol lookup. In particular, due to two level namespaces multiple dylibs can exports the same symbol without it being a runtime collision since the binary importing them stores the library a symbol came from in addition to the name. This is different from static archives where you have sets of symbols brought in by .o file. That means it is often non-trivial to switch between dynamic libraries and static archives. Mergeable libraries solve this by allowing you to use the semantics of dynamic libraries and two level namespaces for content that will be statically linked.<p>2. Most people use frameworks, not raw dylibs. They do that for a lot of reasons, but the biggest one is to allow them to distribute non-code resources that are associated with the library. This is a common problem that has been solved in various ways (Windows embeds the resources in the DLL files, classic Mac OS depended on resource forks, etc). Mergeable dylibs are completely supported by the runtime in such a way that enough of the dylib&#x27;s identity is preserved so that things like NSBundle continue to work as a way to find the bundles resources despite the code itself being merged.</div><br/></div></div><div id="36234353" class="c"><input type="checkbox" id="c-36234353" checked=""/><div class="controls bullet"><span class="by">compiler-guy</span><span>|</span><a href="#36233776">parent</a><span>|</span><a href="#36234136">prev</a><span>|</span><a href="#36233944">next</a><span>|</span><label class="collapse" for="c-36234353">[-]</label><label class="expand" for="c-36234353">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not seeing any hype. They have shipped a nice new feature for their build system. I don&#x27;t see any claims of it advancing the state of the art, or life-changing, just that it improves certain work flows in an easy way, and provide a convenient way to use it for their developers.</div><br/></div></div><div id="36233944" class="c"><input type="checkbox" id="c-36233944" checked=""/><div class="controls bullet"><span class="by">ridiculous_fish</span><span>|</span><a href="#36233776">parent</a><span>|</span><a href="#36234353">prev</a><span>|</span><a href="#36233957">next</a><span>|</span><label class="collapse" for="c-36233944">[-]</label><label class="expand" for="c-36233944">[3 more]</label></div><br/><div class="children"><div class="content">The problem being tackled here is link time in debug builds. This affects all platforms.</div><br/><div id="36234005" class="c"><input type="checkbox" id="c-36234005" checked=""/><div class="controls bullet"><span class="by">roqi</span><span>|</span><a href="#36233776">root</a><span>|</span><a href="#36233944">parent</a><span>|</span><a href="#36233957">next</a><span>|</span><label class="collapse" for="c-36234005">[-]</label><label class="expand" for="c-36234005">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The problem being tackled here is link time in debug builds. This affects all platforms.<p>I&#x27;ve worked on many projects, big and small, and the link time of debug builds was never a problem that was worth fixing.<p>In fact, even today I was discussing with a coworker the inefficiencies of the project&#x27;s build process, we literally commented that having to only link a huge subproject is a major blessing.</div><br/><div id="36234332" class="c"><input type="checkbox" id="c-36234332" checked=""/><div class="controls bullet"><span class="by">compiler-guy</span><span>|</span><a href="#36233776">root</a><span>|</span><a href="#36234005">parent</a><span>|</span><a href="#36233957">next</a><span>|</span><label class="collapse" for="c-36234332">[-]</label><label class="expand" for="c-36234332">[1 more]</label></div><br/><div class="children"><div class="content">For Google at least, link times are sufficiently important that the company has rewritten the linker from scratch twice--both open source. The Gnu-Gold linker which ships as part of gnu binutils and subsequently the ELF version of llvm&#x27;s lld.<p>So although you might not encounter issues with link times (debug or otherwise), it is a multi-million dollar problem for big companies like Google and Apple. Both in resources and engineer time.</div><br/></div></div></div></div></div></div><div id="36233957" class="c"><input type="checkbox" id="c-36233957" checked=""/><div class="controls bullet"><span class="by">roqi</span><span>|</span><a href="#36233776">parent</a><span>|</span><a href="#36233944">prev</a><span>|</span><a href="#36234301">next</a><span>|</span><label class="collapse" for="c-36233957">[-]</label><label class="expand" for="c-36233957">[2 more]</label></div><br/><div class="children"><div class="content">&gt; But I still think it&#x27;s important to note that this isn&#x27;t really advancing the state of the art like Apple would like you to believe. It&#x27;s just a new middle-of-the-road approach with its own possibly-positive tradeoffs and pitfalls.<p>It also seems that this new library format barely solves any problem and in the process bumps up the number of library types that developers need to onboard and possibly support.</div><br/><div id="36235071" class="c"><input type="checkbox" id="c-36235071" checked=""/><div class="controls bullet"><span class="by">Reason077</span><span>|</span><a href="#36233776">root</a><span>|</span><a href="#36233957">parent</a><span>|</span><a href="#36234301">next</a><span>|</span><label class="collapse" for="c-36235071">[-]</label><label class="expand" for="c-36235071">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>&quot;It also seems that this new library format ... bumps up the number of library types that developers need to onboard and possibly support.&quot;</i><p>No, a mergeable library is just a special type of dynamic library, which adds some additional features and metadata. I can&#x27;t imagine why you&#x27;d distribute both mergeable and non-mergeable dylibs?<p>In fact, rather than having to support more library types, developers may actually have to support less - because it may eliminate the need to ship both a static lib and a .dylib with your framework?</div><br/></div></div></div></div></div></div><div id="36234301" class="c"><input type="checkbox" id="c-36234301" checked=""/><div class="controls bullet"><span class="by">baybal2</span><span>|</span><a href="#36233776">prev</a><span>|</span><a href="#36233509">next</a><span>|</span><label class="collapse" for="c-36234301">[-]</label><label class="expand" for="c-36234301">[3 more]</label></div><br/><div class="children"><div class="content">This sounds very much like... prelink?</div><br/><div id="36238067" class="c"><input type="checkbox" id="c-36238067" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#36234301">parent</a><span>|</span><a href="#36233509">next</a><span>|</span><label class="collapse" for="c-36238067">[-]</label><label class="expand" for="c-36238067">[2 more]</label></div><br/><div class="children"><div class="content">Not quite, but it&#x27;s closer to statifier <a href="https:&#x2F;&#x2F;statifier.sourceforge.net&#x2F;" rel="nofollow">https:&#x2F;&#x2F;statifier.sourceforge.net&#x2F;</a> or ermine <a href="https:&#x2F;&#x2F;www.magicermine.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.magicermine.com&#x2F;</a><p>You can definitely do most of the same process in hacky ways on Linux already. I don&#x27;t think you can use it for making the merged shared lib to use for compilation later... But it&#x27;s only a few hacks away.</div><br/><div id="36239023" class="c"><input type="checkbox" id="c-36239023" checked=""/><div class="controls bullet"><span class="by">planede</span><span>|</span><a href="#36234301">root</a><span>|</span><a href="#36238067">parent</a><span>|</span><a href="#36233509">next</a><span>|</span><label class="collapse" for="c-36239023">[-]</label><label class="expand" for="c-36239023">[1 more]</label></div><br/><div class="children"><div class="content">From the video:<p>&gt; Mergeable metadata roughly doubles the size of the dylib.<p>I think they just bundle the static lib and dynamic lib together. I think there is a wasted opportunity to do something much smarter here, but maybe that we follow.<p>We already compile static libraries with PIC, and use the same object files to compile dynamic libraries. In theory the two could be bundled in a way that shares most of the data, as the machine code is literally the same. They are both linked from the same object files.</div><br/></div></div></div></div></div></div><div id="36233509" class="c"><input type="checkbox" id="c-36233509" checked=""/><div class="controls bullet"><span class="by">enriquto</span><span>|</span><a href="#36234301">prev</a><span>|</span><a href="#36234613">next</a><span>|</span><label class="collapse" for="c-36233509">[-]</label><label class="expand" for="c-36233509">[1 more]</label></div><br/><div class="children"><div class="content">give me static αpε or give me death!</div><br/></div></div><div id="36234613" class="c"><input type="checkbox" id="c-36234613" checked=""/><div class="controls bullet"><span class="by">ChrisMarshallNY</span><span>|</span><a href="#36233509">prev</a><span>|</span><label class="collapse" for="c-36234613">[-]</label><label class="expand" for="c-36234613">[1 more]</label></div><br/><div class="children"><div class="content">It won&#x27;t make much difference to me, until it&#x27;s supported in SPM (which will probably be soon).</div><br/></div></div></div></div></div></div></div></body></html>