<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704790865241" as="style"/><link rel="stylesheet" href="styles.css?v=1704790865241"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://interjectedfuture.com/trade-offs-between-different-crdts/">Trade-offs between Different CRDTs</a> <span class="domain">(<a href="https://interjectedfuture.com">interjectedfuture.com</a>)</span></div><div class="subtext"><span>iamwil</span> | <span>18 comments</span></div><br/><div><div id="38917534" class="c"><input type="checkbox" id="c-38917534" checked=""/><div class="controls bullet"><span class="by">quartz</span><span>|</span><a href="#38917636">next</a><span>|</span><label class="collapse" for="c-38917534">[-]</label><label class="expand" for="c-38917534">[5 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re just getting started with CRDTs I&#x27;d also recommend Seph&#x27;s &quot;5000x faster CRDTs&quot; post[1] and also his &quot;I was wrong. CRDTs are the future&quot; post[2] for some nice captures of the practical challenges and opportunities in the space.<p>[1] <a href="https:&#x2F;&#x2F;josephg.com&#x2F;blog&#x2F;crdts-go-brrr&#x2F;" rel="nofollow">https:&#x2F;&#x2F;josephg.com&#x2F;blog&#x2F;crdts-go-brrr&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;josephg.com&#x2F;blog&#x2F;crdts-are-the-future&#x2F;" rel="nofollow">https:&#x2F;&#x2F;josephg.com&#x2F;blog&#x2F;crdts-are-the-future&#x2F;</a></div><br/><div id="38921222" class="c"><input type="checkbox" id="c-38921222" checked=""/><div class="controls bullet"><span class="by">josephg</span><span>|</span><a href="#38917534">parent</a><span>|</span><a href="#38920604">next</a><span>|</span><label class="collapse" for="c-38921222">[-]</label><label class="expand" for="c-38921222">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for the plug! I’m happy to answer any questions about this stuff. I’ve been noodling with collaborative editing for awhile now. It’s a fun space!</div><br/><div id="38922715" class="c"><input type="checkbox" id="c-38922715" checked=""/><div class="controls bullet"><span class="by">quartz</span><span>|</span><a href="#38917534">root</a><span>|</span><a href="#38921222">parent</a><span>|</span><a href="#38920604">next</a><span>|</span><label class="collapse" for="c-38922715">[-]</label><label class="expand" for="c-38922715">[1 more]</label></div><br/><div class="children"><div class="content">Very much appreciate your writing on the topic-- it gave me the practical context I was missing while trying to spin up with automerge and CRDTs in general.<p>I ended up using y.js in my personal react native notes app and it works wonderfully.</div><br/></div></div></div></div><div id="38920604" class="c"><input type="checkbox" id="c-38920604" checked=""/><div class="controls bullet"><span class="by">whartung</span><span>|</span><a href="#38917534">parent</a><span>|</span><a href="#38921222">prev</a><span>|</span><a href="#38917636">next</a><span>|</span><label class="collapse" for="c-38920604">[-]</label><label class="expand" for="c-38920604">[2 more]</label></div><br/><div class="children"><div class="content">From the first link:<p><pre><code>  They implemented lots of algorithms - CRDTs and OT algorithms and stuff.
</code></pre>
What’s an “OT” algorithm in this context?</div><br/><div id="38920647" class="c"><input type="checkbox" id="c-38920647" checked=""/><div class="controls bullet"><span class="by">refset</span><span>|</span><a href="#38917534">root</a><span>|</span><a href="#38920604">parent</a><span>|</span><a href="#38917636">next</a><span>|</span><label class="collapse" for="c-38920647">[-]</label><label class="expand" for="c-38920647">[1 more]</label></div><br/><div class="children"><div class="content">Operational Transform (an approach that requires a central server to coordinate edits)</div><br/></div></div></div></div></div></div><div id="38917636" class="c"><input type="checkbox" id="c-38917636" checked=""/><div class="controls bullet"><span class="by">lewisjoe</span><span>|</span><a href="#38917534">prev</a><span>|</span><a href="#38918745">next</a><span>|</span><label class="collapse" for="c-38917636">[-]</label><label class="expand" for="c-38917636">[4 more]</label></div><br/><div class="children"><div class="content">This is a clear and crisp way of differentiating delta based vs state based CRDTs.<p>But I don&#x27;t think it&#x27;s accurate enough. For example, the article claims delta based  CRDTs don&#x27;t use vector clocks. But even to decide if a set of events are concurrent it&#x27;s necessary to attach vector stamps to every event.  Maybe the author meant something else when he says vector clocks are not needed for op based CRDTs.<p>Also as mentioned in article it&#x27;s true evergrowing event log is not such a bad idea with compression techniques and cheaper disks. But the problem with evergrowing datastructures is not just disk space. This data has to be loaded onto main memory to do anything useful with it. This data has to be transmitted across network to power SaaS apps. So  stating that disks are cheaper hence evergrowing datastructures are fine - is an oversimplification.</div><br/><div id="38920573" class="c"><input type="checkbox" id="c-38920573" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#38917636">parent</a><span>|</span><a href="#38918745">next</a><span>|</span><label class="collapse" for="c-38920573">[-]</label><label class="expand" for="c-38920573">[3 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t recall if it was git itself or github that bragged about inverting the storage structure so that it was simplest to read the current state, and HEAD~3 was determined by substracting the last 3 patches rather than fast forwarding from root to length - 3.<p>To do so requires that the patch function is a reversible function, which for git is not hard to achieve. I wonder how many CRDTs that is true for.<p>There are ways to transmit only a partial history for git, there should be ways to do the same for most CRDTs.</div><br/><div id="38921248" class="c"><input type="checkbox" id="c-38921248" checked=""/><div class="controls bullet"><span class="by">josephg</span><span>|</span><a href="#38917636">root</a><span>|</span><a href="#38920573">parent</a><span>|</span><a href="#38918745">next</a><span>|</span><label class="collapse" for="c-38921248">[-]</label><label class="expand" for="c-38921248">[2 more]</label></div><br/><div class="children"><div class="content">There absolutely is. I’m writing a paper at the moment about how we’ve done this in diamond types. The core idea is to store the original operations and the versions. And then reconstruct the crdt state on each peer as needed. Because most editing histories are mostly linear, it usually ends up faster than CRDTs in practice anyway. But you can then just send the latest document state and send historical operations on demand for merging and to access old document states.<p>I’ll post the paper when it’s ready. I think it’s a great approach - file sizes end up smaller. You don’t need the crdt in memory during editing and you can prune old operations.</div><br/><div id="38922302" class="c"><input type="checkbox" id="c-38922302" checked=""/><div class="controls bullet"><span class="by">spencerflem</span><span>|</span><a href="#38917636">root</a><span>|</span><a href="#38921248">parent</a><span>|</span><a href="#38918745">next</a><span>|</span><label class="collapse" for="c-38922302">[-]</label><label class="expand" for="c-38922302">[1 more]</label></div><br/><div class="children"><div class="content">Oh that&#x27;s clever</div><br/></div></div></div></div></div></div></div></div><div id="38918745" class="c"><input type="checkbox" id="c-38918745" checked=""/><div class="controls bullet"><span class="by">wim</span><span>|</span><a href="#38917636">prev</a><span>|</span><a href="#38916856">next</a><span>|</span><label class="collapse" for="c-38918745">[-]</label><label class="expand" for="c-38918745">[1 more]</label></div><br/><div class="children"><div class="content">Nice outline of the various techniques. We&#x27;ve built something in-between the operation-based and delta-based approaches for our offline-first multiplayer &quot;IDE for notes&#x2F;tasks&quot; [1].<p>In our case we have a central server which periodically creates snapshots. Although we don&#x27;t do that right now, if needed, it could delete older operations from the log for space reasons. Except for the fact that replicas encrypt their ops before they send it to the server (e2ee), the server is pretty much like any other replica, so if there is no central server I guess any or multiple replicas could also create snapshots instead.<p>&quot;Normal&quot; replicas which have been offline for a while can then get the last snapshot state S&#x27; with all operations since S&#x27;. Other than that, they simply broadcast operations and only keep their own latest version to which they apply incoming operations.<p>[1] <a href="https:&#x2F;&#x2F;thymer.com" rel="nofollow">https:&#x2F;&#x2F;thymer.com</a></div><br/></div></div><div id="38916856" class="c"><input type="checkbox" id="c-38916856" checked=""/><div class="controls bullet"><span class="by">zachmu</span><span>|</span><a href="#38918745">prev</a><span>|</span><label class="collapse" for="c-38916856">[-]</label><label class="expand" for="c-38916856">[7 more]</label></div><br/><div class="children"><div class="content">Apparently he&#x27;s going to write about Merkle CRDTs next, but if you can&#x27;t wait:<p><a href="https:&#x2F;&#x2F;www.dolthub.com&#x2F;blog&#x2F;2022-06-27-prolly-chunker&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.dolthub.com&#x2F;blog&#x2F;2022-06-27-prolly-chunker&#x2F;</a></div><br/><div id="38921392" class="c"><input type="checkbox" id="c-38921392" checked=""/><div class="controls bullet"><span class="by">jchrisa</span><span>|</span><a href="#38916856">parent</a><span>|</span><a href="#38916964">next</a><span>|</span><label class="collapse" for="c-38921392">[-]</label><label class="expand" for="c-38921392">[1 more]</label></div><br/><div class="children"><div class="content">If you want to read about another implementation using Merkle CRDTs for practical local-first document database storage, I&#x27;ve been building a new database for about a year. I plan to share more but it&#x27;s definitely an example of a Merkle CRDT, inspired by a lot of the same research in the Dolt paper.<p>Architecture - <a href="https:&#x2F;&#x2F;use-fireproof.com&#x2F;docs&#x2F;architecture" rel="nofollow">https:&#x2F;&#x2F;use-fireproof.com&#x2F;docs&#x2F;architecture</a>
CRDT file format - <a href="https:&#x2F;&#x2F;fireproof.storage&#x2F;posts&#x2F;remote-access-crdt-wrapped-multi-writer-enabled-immutable-file-format&#x2F;" rel="nofollow">https:&#x2F;&#x2F;fireproof.storage&#x2F;posts&#x2F;remote-access-crdt-wrapped-m...</a></div><br/></div></div><div id="38916964" class="c"><input type="checkbox" id="c-38916964" checked=""/><div class="controls bullet"><span class="by">iamwil</span><span>|</span><a href="#38916856">parent</a><span>|</span><a href="#38921392">prev</a><span>|</span><a href="#38917878">next</a><span>|</span><label class="collapse" for="c-38916964">[-]</label><label class="expand" for="c-38916964">[4 more]</label></div><br/><div class="children"><div class="content">And if you really can&#x27;t wait, I made the mistake of thinking Prolly Trees weren&#x27;t unicit, but figuring out that they were!<p><a href="https:&#x2F;&#x2F;interjectedfuture.com&#x2F;lab-notes&#x2F;lab-note-030-the-trick-to-unicity-of-prolly-trees&#x2F;" rel="nofollow">https:&#x2F;&#x2F;interjectedfuture.com&#x2F;lab-notes&#x2F;lab-note-030-the-tri...</a></div><br/><div id="38918553" class="c"><input type="checkbox" id="c-38918553" checked=""/><div class="controls bullet"><span class="by">aboodman</span><span>|</span><a href="#38916856">root</a><span>|</span><a href="#38916964">parent</a><span>|</span><a href="#38917878">next</a><span>|</span><label class="collapse" for="c-38918553">[-]</label><label class="expand" for="c-38918553">[3 more]</label></div><br/><div class="children"><div class="content">Wow, I hadn&#x27;t seen this follow-up post! Cool!<p>(btw I really love your masthead graphics)</div><br/><div id="38920410" class="c"><input type="checkbox" id="c-38920410" checked=""/><div class="controls bullet"><span class="by">iamwil</span><span>|</span><a href="#38916856">root</a><span>|</span><a href="#38918553">parent</a><span>|</span><a href="#38917878">next</a><span>|</span><label class="collapse" for="c-38920410">[-]</label><label class="expand" for="c-38920410">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for pointing out the discrepancy! Some people don&#x27;t like generative images, but they&#x27;re pretty fun to generate.</div><br/><div id="38923507" class="c"><input type="checkbox" id="c-38923507" checked=""/><div class="controls bullet"><span class="by">ykonstant</span><span>|</span><a href="#38916856">root</a><span>|</span><a href="#38920410">parent</a><span>|</span><a href="#38917878">next</a><span>|</span><label class="collapse" for="c-38923507">[-]</label><label class="expand" for="c-38923507">[1 more]</label></div><br/><div class="children"><div class="content">The more abstract and stylized the image, the easier it is to avoid uncanny valley effects.  Your images are spectacular; I&#x27;d love it if you divulged a bit of the secret sauce; perhaps in a blog post?</div><br/></div></div></div></div></div></div></div></div><div id="38917878" class="c"><input type="checkbox" id="c-38917878" checked=""/><div class="controls bullet"><span class="by">foota</span><span>|</span><a href="#38916856">parent</a><span>|</span><a href="#38916964">prev</a><span>|</span><label class="collapse" for="c-38917878">[-]</label><label class="expand" for="c-38917878">[1 more]</label></div><br/><div class="children"><div class="content">Will those comment eventually update once the blog is appended? :-)</div><br/></div></div></div></div></div></div></div></div></div></body></html>