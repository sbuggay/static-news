<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735722057169" as="style"/><link rel="stylesheet" href="styles.css?v=1735722057169"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blogsystem5.substack.com/p/netbsd-build-system">Revisiting the NetBSD Build System</a> <span class="domain">(<a href="https://blogsystem5.substack.com">blogsystem5.substack.com</a>)</span></div><div class="subtext"><span>abhi9u</span> | <span>16 comments</span></div><br/><div><div id="42562026" class="c"><input type="checkbox" id="c-42562026" checked=""/><div class="controls bullet"><span class="by">kev009</span><span>|</span><a href="#42562737">next</a><span>|</span><label class="collapse" for="c-42562026">[-]</label><label class="expand" for="c-42562026">[6 more]</label></div><br/><div class="children"><div class="content">It&#x27;s hard to overstate how awesome build.sh is.  If you have some powerful desktop&#x2F;laptop running virtually any modern POSIX OS, you can easily build for an embedded board like an RPi or Beagelboard, obscure retro targets, or standard systems all the same.  The closest thing is maybe Yocto Linux, but a whole lot easier to use and understand.</div><br/><div id="42563019" class="c"><input type="checkbox" id="c-42563019" checked=""/><div class="controls bullet"><span class="by">idatum</span><span>|</span><a href="#42562026">parent</a><span>|</span><a href="#42562345">next</a><span>|</span><label class="collapse" for="c-42563019">[-]</label><label class="expand" for="c-42563019">[3 more]</label></div><br/><div class="children"><div class="content">If you run older hardware you realize quickly how significant it is to be able to do cross builds with build.sh. I came across this post today that highlights this!<p><a href="https:&#x2F;&#x2F;zia.io&#x2F;objects&#x2F;c4b825f9-8c57-4b86-a108-af869dfbcb10" rel="nofollow">https:&#x2F;&#x2F;zia.io&#x2F;objects&#x2F;c4b825f9-8c57-4b86-a108-af869dfbcb10</a><p>&gt; How long would you imagine it might take to compile NetBSD 10 from source on real m68k hardware? Earlier this year I wanted to find out, so I set up a Macintosh to try it.<p>&gt; The toolchain, OS and installation sets started on 16-March and finished on 10-May:<p>&gt; build.sh started:    Sat Mar 16 17:04:20 UTC 2024<p>&gt; build.sh ended:      Fri May 10 00:35:54 UTC 2024<p>&gt; 4692724.22 real   3810544.56 user    700310.18 sys</div><br/><div id="42563291" class="c"><input type="checkbox" id="c-42563291" checked=""/><div class="controls bullet"><span class="by">kstrauser</span><span>|</span><a href="#42562026">root</a><span>|</span><a href="#42563019">parent</a><span>|</span><a href="#42563443">next</a><span>|</span><label class="collapse" for="c-42563291">[-]</label><label class="expand" for="c-42563291">[1 more]</label></div><br/><div class="children"><div class="content">I misread that. It started on Mar 16 and ended on Mar 10? How did that OHHHHhhhh...</div><br/></div></div><div id="42563443" class="c"><input type="checkbox" id="c-42563443" checked=""/><div class="controls bullet"><span class="by">actionfromafar</span><span>|</span><a href="#42562026">root</a><span>|</span><a href="#42563019">parent</a><span>|</span><a href="#42563291">prev</a><span>|</span><a href="#42562345">next</a><span>|</span><label class="collapse" for="c-42563443">[-]</label><label class="expand" for="c-42563443">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not so bad! :-D</div><br/></div></div></div></div><div id="42562345" class="c"><input type="checkbox" id="c-42562345" checked=""/><div class="controls bullet"><span class="by">dgfitz</span><span>|</span><a href="#42562026">parent</a><span>|</span><a href="#42563019">prev</a><span>|</span><a href="#42562737">next</a><span>|</span><label class="collapse" for="c-42562345">[-]</label><label class="expand" for="c-42562345">[2 more]</label></div><br/><div class="children"><div class="content">My yocto linux builds have a single entry point that is a build.sh. And they’re like 20 lines.</div><br/><div id="42562860" class="c"><input type="checkbox" id="c-42562860" checked=""/><div class="controls bullet"><span class="by">johnklos</span><span>|</span><a href="#42562026">root</a><span>|</span><a href="#42562345">parent</a><span>|</span><a href="#42562737">next</a><span>|</span><label class="collapse" for="c-42562860">[-]</label><label class="expand" for="c-42562860">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve heard this about various Linux distros, but every time I&#x27;ve tried it has never been as simple as people say it should be.<p>I assume your twenty lines has customizations. How do you rebuild the OS and kernel the simplest way possible?</div><br/></div></div></div></div></div></div><div id="42562737" class="c"><input type="checkbox" id="c-42562737" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42562026">prev</a><span>|</span><a href="#42562721">next</a><span>|</span><label class="collapse" for="c-42562737">[-]</label><label class="expand" for="c-42562737">[5 more]</label></div><br/><div class="children"><div class="content">&gt; NetBSD build system allows you to build the full OS from scratch, on pretty much any host POSIX platform, while targeting any hardware architecture supported by NetBSD. All without root privileges.<p>That seems fairly standard to me though? Yocto, buldroot, many other embedded-oriented systems provide that and more.</div><br/><div id="42563159" class="c"><input type="checkbox" id="c-42563159" checked=""/><div class="controls bullet"><span class="by">plorkyeran</span><span>|</span><a href="#42562737">parent</a><span>|</span><a href="#42564572">next</a><span>|</span><label class="collapse" for="c-42563159">[-]</label><label class="expand" for="c-42563159">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s definitely what I would consider the basic expectations for a build system (why would you even need root to compile an OS?), but it&#x27;s not something that most non-embedded-focused distributions deliver.</div><br/><div id="42563528" class="c"><input type="checkbox" id="c-42563528" checked=""/><div class="controls bullet"><span class="by">musicale</span><span>|</span><a href="#42562737">root</a><span>|</span><a href="#42563159">parent</a><span>|</span><a href="#42564572">next</a><span>|</span><label class="collapse" for="c-42563528">[-]</label><label class="expand" for="c-42563528">[2 more]</label></div><br/><div class="children"><div class="content">&gt; why would you even need root to compile an OS<p>Usually it&#x27;s to make it easier dealing with file system (&quot;disk&quot;) image files, which may require root privileges to mount and use with regular programs (though FUSE and similar subsystems can help.) In a mounted filesystem, root privileges may be required to set permission bits like setuid.<p>The NetBSD toolchain probably includes utilities to make it easy to copy data in and out of file system images, ideally concurrently and without corruption.</div><br/><div id="42563838" class="c"><input type="checkbox" id="c-42563838" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#42562737">root</a><span>|</span><a href="#42563528">parent</a><span>|</span><a href="#42564572">next</a><span>|</span><label class="collapse" for="c-42563838">[-]</label><label class="expand" for="c-42563838">[1 more]</label></div><br/><div class="children"><div class="content">In addition to building filesystem images, a common use of root for operating system building is to chroot into a &quot;clean&quot; environment to avoid environmental corruption.  (In general, chroot is reserved to uid 0 due to issues with setuid binaries -- on some systems chroot can be made available to non-root users by turning off setuid behaviour.)</div><br/></div></div></div></div></div></div><div id="42564572" class="c"><input type="checkbox" id="c-42564572" checked=""/><div class="controls bullet"><span class="by">jmmv</span><span>|</span><a href="#42562737">parent</a><span>|</span><a href="#42563159">prev</a><span>|</span><a href="#42562721">next</a><span>|</span><label class="collapse" for="c-42564572">[-]</label><label class="expand" for="c-42564572">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t know about Yocto, but reading through its documentation, it looks far more complex than NetBSD&#x27;s build.sh. And then, I read:<p>&gt; If the machine you want to use Yocto Project on to build an image (Build Host) is not a native Linux system, you can still perform these steps by using CROss PlatformS (CROPS) and setting up a Poky container.
...
&gt; With CROPS, which leverages Docker Containers, you can create a Yocto Project development environment that is operating system agnostic. You can set up a container in which you can develop using the Yocto Project on a Windows, Mac, or Linux machine.<p>... which is not close to what NetBSD&#x27;s build system does, like at all.<p>As for buildroot: &quot;Buildroot is designed to run on Linux systems.&quot; (a &quot;red flag&quot;) and the list of host dependencies to install is pretty large, which is also different from NetBSD&#x27;s build.<p>Plus Buildroot and &quot;other embedded-oriented systems&quot; are, well, something specifically designed to build embedded system images with Linux, not a &quot;standard&quot; Unix-like OS that happens to have a build system that works well for embedded. A big plus for BSD is its monorepo style of development: customizing and patching the system is trivial. With buildroot, well, you have Linux&#x27;s hodgepodge style of development, so picking and choosing components is simple, but modifying any of them is hard.<p>So what NetBSD&#x27;s build system offers doesn&#x27;t &quot;seem fairly standard&quot; to me. Definitely not the &quot;run on pretty much any host POSIX platform&quot;, which is not common. And when you involve Docker in the picture, I also say that other systems fail the test of &quot;all without root&quot;.</div><br/></div></div></div></div><div id="42562721" class="c"><input type="checkbox" id="c-42562721" checked=""/><div class="controls bullet"><span class="by">jmclnx</span><span>|</span><a href="#42562737">prev</a><span>|</span><a href="#42564519">next</a><span>|</span><label class="collapse" for="c-42562721">[-]</label><label class="expand" for="c-42562721">[1 more]</label></div><br/><div class="children"><div class="content">I just updated pkgsrc from 2024Q3 to 2024Q4 for amd64 and i386, very easy.<p>I never built NetBSD because I never had the need to do that.  But from what I read its cross-compiling works very well.</div><br/></div></div><div id="42564519" class="c"><input type="checkbox" id="c-42564519" checked=""/><div class="controls bullet"><span class="by">plagiarist</span><span>|</span><a href="#42562721">prev</a><span>|</span><a href="#42562708">next</a><span>|</span><label class="collapse" for="c-42564519">[-]</label><label class="expand" for="c-42564519">[1 more]</label></div><br/><div class="children"><div class="content">I really enjoyed reading this. And it is too relatable that they would detour from the project they want to work on to port the build over to Bazel.</div><br/></div></div></div></div></div></div></div></body></html>