<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1732179670512" as="style"/><link rel="stylesheet" href="styles.css?v=1732179670512"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://catonmat.net/unix-utilities-pipe-viewer">Pipe Viewer – A Unix Utility You Should Know About</a> <span class="domain">(<a href="https://catonmat.net">catonmat.net</a>)</span></div><div class="subtext"><span>lnyan</span> | <span>31 comments</span></div><br/><div><div id="42198147" class="c"><input type="checkbox" id="c-42198147" checked=""/><div class="controls bullet"><span class="by">mort96</span><span>|</span><a href="#42197619">next</a><span>|</span><label class="collapse" for="c-42198147">[-]</label><label class="expand" for="c-42198147">[1 more]</label></div><br/><div class="children"><div class="content">Pipe viewer is excellent. I use it all the time.<p>As of version 1.8.10[1], which includes my merge request[2] to add an &#x27;--output&#x27; option, it has even completely replaced my use of &#x27;dd&#x27; for writing disk images: &#x27;sudo pv -Yo &#x2F;dev&#x2F;mmcblk0 whatever.img&#x27; is nicer, has much better progress indication, automatically selects a more sensible buffer size, <i>and</i> begets fewer groans from UNIX neckbeards, than the old &#x27;sudo dd of=&#x2F;dev&#x2F;mmcblk0 if=whatever.img&#x27;. (The &#x27;-Y&#x27; causes pv to sync after each write, which greatly improves progress indication in Linux.)<p>Though it&#x27;s useful for much more of course. I use it for progress when compressing files (&#x27;pv blah | gzip ...&#x27;), when uploading files to the web (&#x27;pv blah | curl --upload-file - ...&#x27; — curl doesn&#x27;t show progress when uploading for whatever reason), or just when I wanna see that <i>something</i> is happening with an operation which would otherwise take a while (even things like a slow &#x27;du -h &#x2F;some&#x2F;path | sort -h&#x27; benefits from a &#x27;pv&#x27; squeezed in the middle just to indicate that something is happening).<p>[1] <a href="https:&#x2F;&#x2F;codeberg.org&#x2F;a-j-wood&#x2F;pv&#x2F;releases&#x2F;tag&#x2F;v1.8.10" rel="nofollow">https:&#x2F;&#x2F;codeberg.org&#x2F;a-j-wood&#x2F;pv&#x2F;releases&#x2F;tag&#x2F;v1.8.10</a><p>[2] <a href="https:&#x2F;&#x2F;codeberg.org&#x2F;a-j-wood&#x2F;pv&#x2F;pulls&#x2F;90" rel="nofollow">https:&#x2F;&#x2F;codeberg.org&#x2F;a-j-wood&#x2F;pv&#x2F;pulls&#x2F;90</a></div><br/></div></div><div id="42197619" class="c"><input type="checkbox" id="c-42197619" checked=""/><div class="controls bullet"><span class="by">heinrich5991</span><span>|</span><a href="#42198147">prev</a><span>|</span><a href="#42199542">next</a><span>|</span><label class="collapse" for="c-42197619">[-]</label><label class="expand" for="c-42197619">[3 more]</label></div><br/><div class="children"><div class="content">There&#x27;s also `progress` which works for tools mainly operating on a single file, but unlike `pv`, you don&#x27;t have to start the tool differently. It&#x27;d e.g. work nicely for the `gzip` example. Just call `progress` on a different terminal while `gzip` is running.</div><br/><div id="42199327" class="c"><input type="checkbox" id="c-42199327" checked=""/><div class="controls bullet"><span class="by">dividuum</span><span>|</span><a href="#42197619">parent</a><span>|</span><a href="#42200650">next</a><span>|</span><label class="collapse" for="c-42199327">[-]</label><label class="expand" for="c-42199327">[1 more]</label></div><br/><div class="children"><div class="content">I was curious on how that’s supposed to work, so I took a quick look: It scans &#x2F;proc for known commands, then looks up file descriptor information via their fd&#x2F;fdinfo directory to get size&#x2F;seek positions and then shows a percentage of the largest file.</div><br/></div></div><div id="42200650" class="c"><input type="checkbox" id="c-42200650" checked=""/><div class="controls bullet"><span class="by">fwip</span><span>|</span><a href="#42197619">parent</a><span>|</span><a href="#42199327">prev</a><span>|</span><a href="#42199542">next</a><span>|</span><label class="collapse" for="c-42200650">[-]</label><label class="expand" for="c-42200650">[1 more]</label></div><br/><div class="children"><div class="content">pv also allows this, but you have to look up the process id manually, and pass it to the -d flag.</div><br/></div></div></div></div><div id="42199542" class="c"><input type="checkbox" id="c-42199542" checked=""/><div class="controls bullet"><span class="by">jcul</span><span>|</span><a href="#42197619">prev</a><span>|</span><a href="#42198575">next</a><span>|</span><label class="collapse" for="c-42199542">[-]</label><label class="expand" for="c-42199542">[1 more]</label></div><br/><div class="children"><div class="content">pv is great.<p>It has a limit parameter so you can limit the speed.
Great if you don&#x27;t want to saturate some link or have additional costs for uploading above a certain rate per hour&#x2F;day.<p>Also useful for testing behaviour on slow filesystem &#x2F; connections.<p>It can take a pid argument too, -d IIRC, which will get it to display progress info for all the open file descriptors of a running process.<p>Really useful as a quick way to check what a IO process is doing if appears to be stuck.</div><br/></div></div><div id="42198575" class="c"><input type="checkbox" id="c-42198575" checked=""/><div class="controls bullet"><span class="by">darkwater</span><span>|</span><a href="#42199542">prev</a><span>|</span><a href="#42199544">next</a><span>|</span><label class="collapse" for="c-42198575">[-]</label><label class="expand" for="c-42198575">[4 more]</label></div><br/><div class="children"><div class="content">Pipe viewer? What&#x27;s that? Let me check the post...oh, it&#x27;s good old pv! Never noticed it had a full name, damn Unix utilities with their short names!</div><br/><div id="42198740" class="c"><input type="checkbox" id="c-42198740" checked=""/><div class="controls bullet"><span class="by">fuzztester</span><span>|</span><a href="#42198575">parent</a><span>|</span><a href="#42199544">next</a><span>|</span><label class="collapse" for="c-42198740">[-]</label><label class="expand" for="c-42198740">[3 more]</label></div><br/><div class="children"><div class="content">There is a shell built-in called alias.<p>You can use it to map the short name to the long name if you prefer, although people usually do it the other way around, to save on typing.<p>;)</div><br/><div id="42200938" class="c"><input type="checkbox" id="c-42200938" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#42198575">root</a><span>|</span><a href="#42198740">parent</a><span>|</span><a href="#42198804">next</a><span>|</span><label class="collapse" for="c-42200938">[-]</label><label class="expand" for="c-42200938">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t understand, how would that help with discovering the full name of &quot;pv&quot;?</div><br/></div></div></div></div></div></div><div id="42199544" class="c"><input type="checkbox" id="c-42199544" checked=""/><div class="controls bullet"><span class="by">NelsonMinar</span><span>|</span><a href="#42198575">prev</a><span>|</span><a href="#42200017">next</a><span>|</span><label class="collapse" for="c-42199544">[-]</label><label class="expand" for="c-42199544">[1 more]</label></div><br/><div class="children"><div class="content">I love pv but how much does adding the pipe affect overhead? I feel like most of my big jobs I want to measure are on things where you want the program to have direct access to the underlying file or storage. `pv somefile | dd` is going to be slower than `dd somefile`. At least I think so? I have no idea what modern Linux I&#x2F;O can optimize.<p>Also does pv necessitate doing single threaded I&#x2F;O?</div><br/></div></div><div id="42200017" class="c"><input type="checkbox" id="c-42200017" checked=""/><div class="controls bullet"><span class="by">throwaway127482</span><span>|</span><a href="#42199544">prev</a><span>|</span><a href="#42197265">next</a><span>|</span><label class="collapse" for="c-42200017">[-]</label><label class="expand" for="c-42200017">[1 more]</label></div><br/><div class="children"><div class="content">I like to use pv as a quick and dirty operations per second counter. Sometimes I will write a program or script that does a bunch of things in parallel (e.g. RPCs to a service I&#x27;m working on), and prints one line of output for every operation completed. Then I pipe that output to pv using the --lines option to count only lines. It shows how many lines are being printed per second, which roughly counts operations per second. (IIRC, also need to pipe to &#x2F;dev&#x2F;null to prevent pv&#x27;s fancy output from clobbering the tool&#x27;s output).<p>Fun stuff! Especially when combined with GNU parallel, in cases where the thing I&#x27;m measuring isn&#x27;t already parallelized, and I want to be lazy.</div><br/></div></div><div id="42197265" class="c"><input type="checkbox" id="c-42197265" checked=""/><div class="controls bullet"><span class="by">emptiestplace</span><span>|</span><a href="#42200017">prev</a><span>|</span><a href="#42197920">next</a><span>|</span><label class="collapse" for="c-42197265">[-]</label><label class="expand" for="c-42197265">[5 more]</label></div><br/><div class="children"><div class="content">&gt; The obvious way to do it is:<p>&gt; $ gzip -c access.log &gt; access.log.gz<p>Is it?</div><br/><div id="42199308" class="c"><input type="checkbox" id="c-42199308" checked=""/><div class="controls bullet"><span class="by">zoky</span><span>|</span><a href="#42197265">parent</a><span>|</span><a href="#42197920">next</a><span>|</span><label class="collapse" for="c-42199308">[-]</label><label class="expand" for="c-42199308">[4 more]</label></div><br/><div class="children"><div class="content">I mean, if you’re the type of person who considers using <i>tar</i> and <i>nc</i> to be the obvious way to transfer a directory between two computers…</div><br/><div id="42200575" class="c"><input type="checkbox" id="c-42200575" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#42197265">root</a><span>|</span><a href="#42199308">parent</a><span>|</span><a href="#42197920">next</a><span>|</span><label class="collapse" for="c-42200575">[-]</label><label class="expand" for="c-42200575">[3 more]</label></div><br/><div class="children"><div class="content">I might be weird, but for me the most obvious way to transfer a small directory is to do<p><pre><code>    tar -cz dir | base64
</code></pre>
Copy output into clipboard<p><pre><code>    base64 -d | tar -xz
</code></pre>
Paste from clipboard into input<p>Works flawlessly to move configs and stuff between servers.<p>I actually love the blend between terminal and GUI. For this example I&#x27;m using CLI tools to produce text and I&#x27;m using GUI to scroll, select and copy&amp;paste the text between two terminal tabs. I wish developers put more emphasis on empowering terminal with GUI capabilities.</div><br/><div id="42201805" class="c"><input type="checkbox" id="c-42201805" checked=""/><div class="controls bullet"><span class="by">Towaway69</span><span>|</span><a href="#42197265">root</a><span>|</span><a href="#42200575">parent</a><span>|</span><a href="#42201381">next</a><span>|</span><label class="collapse" for="c-42201805">[-]</label><label class="expand" for="c-42201805">[1 more]</label></div><br/><div class="children"><div class="content">On Mac you can use pbcopy to copy something your pasteboard aka clipboard.<p>So the first command becomes:<p><pre><code>   tar -cz dir | base64 | pbcopy</code></pre></div><br/></div></div><div id="42201381" class="c"><input type="checkbox" id="c-42201381" checked=""/><div class="controls bullet"><span class="by">zoky</span><span>|</span><a href="#42197265">root</a><span>|</span><a href="#42200575">parent</a><span>|</span><a href="#42201805">prev</a><span>|</span><a href="#42197920">next</a><span>|</span><label class="collapse" for="c-42201381">[-]</label><label class="expand" for="c-42201381">[1 more]</label></div><br/><div class="children"><div class="content">Under certain circumstances, like where machines are not directly accessible to each other and you’re only able to connect by Remote Desktop or something, that’s not actually bad way to do that. But for machines that are on the same network, using a weird invocation of <i>tar</i> and <i>nc</i> instead of just using, say, <i>rsync</i> is an odd choice. And for machines connected to each other over the Internet, it’s positively insane.</div><br/></div></div></div></div></div></div></div></div><div id="42197920" class="c"><input type="checkbox" id="c-42197920" checked=""/><div class="controls bullet"><span class="by">thanatos519</span><span>|</span><a href="#42197265">prev</a><span>|</span><a href="#42198694">next</a><span>|</span><label class="collapse" for="c-42197920">[-]</label><label class="expand" for="c-42197920">[1 more]</label></div><br/><div class="children"><div class="content">Yes! My `,pv` is approximately: (probably a better way to make the k, but I stop once something is adequate; maybe I just need to make a `,,kof`)<p><pre><code>    tar cpS &quot;$@&quot; --sort=name | pv -bratpes $(du -cks &quot;$@&quot;|sed -n &#x27;&#x2F;.total$&#x2F; s&#x2F;.total$&#x2F;&#x2F;p&#x27;)k
</code></pre>
Which gives me progress bars for big copies like:<p><pre><code>    ,pv files&#x2F; | tar xp -C &#x2F;destination

    ,pv files&#x2F; | ssh overthere tar xp -C &#x2F;destination</code></pre></div><br/></div></div><div id="42198694" class="c"><input type="checkbox" id="c-42198694" checked=""/><div class="controls bullet"><span class="by">ElevenLathe</span><span>|</span><a href="#42197920">prev</a><span>|</span><a href="#42198530">next</a><span>|</span><label class="collapse" for="c-42198694">[-]</label><label class="expand" for="c-42198694">[2 more]</label></div><br/><div class="children"><div class="content">See also vipe(1) from the wonderful moreutils: <a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;stretch&#x2F;moreutils&#x2F;vipe.1.en.html" rel="nofollow">https:&#x2F;&#x2F;manpages.debian.org&#x2F;stretch&#x2F;moreutils&#x2F;vipe.1.en.html</a></div><br/><div id="42202348" class="c"><input type="checkbox" id="c-42202348" checked=""/><div class="controls bullet"><span class="by">edarchis</span><span>|</span><a href="#42198694">parent</a><span>|</span><a href="#42198530">next</a><span>|</span><label class="collapse" for="c-42202348">[-]</label><label class="expand" for="c-42202348">[1 more]</label></div><br/><div class="children"><div class="content">Yes, moreutils has a lot to offer.
vidir to quickly reorganize files and folders (even delete files), 
chronic to run commands silently... unless they fail, 
sponge to be able to pipe from a file and back to that file without a temporary one
ts to add a timestamp to the ouput
...</div><br/></div></div></div></div><div id="42198530" class="c"><input type="checkbox" id="c-42198530" checked=""/><div class="controls bullet"><span class="by">6c696e7578</span><span>|</span><a href="#42198694">prev</a><span>|</span><a href="#42198722">next</a><span>|</span><label class="collapse" for="c-42198530">[-]</label><label class="expand" for="c-42198530">[7 more]</label></div><br/><div class="children"><div class="content">A little more typing, but I find dd present on most systems already, so I tend to do this:<p><pre><code>  tar ... | dd status=progress | ...</code></pre></div><br/><div id="42198684" class="c"><input type="checkbox" id="c-42198684" checked=""/><div class="controls bullet"><span class="by">Aachen</span><span>|</span><a href="#42198530">parent</a><span>|</span><a href="#42200618">next</a><span>|</span><label class="collapse" for="c-42198684">[-]</label><label class="expand" for="c-42198684">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve used pv longer than dd had this option for, but that&#x27;s fair! I also don&#x27;t use find options, for example, since find piped into the tool everyone already knows anyway - grep - is much easier<p>Sadly, dd will not give you an estimated time or allow you to limit the transfer rate, which are two features I use a lot in pv</div><br/></div></div><div id="42200618" class="c"><input type="checkbox" id="c-42200618" checked=""/><div class="controls bullet"><span class="by">flyinghamster</span><span>|</span><a href="#42198530">parent</a><span>|</span><a href="#42198684">prev</a><span>|</span><a href="#42201324">next</a><span>|</span><label class="collapse" for="c-42200618">[-]</label><label class="expand" for="c-42200618">[1 more]</label></div><br/><div class="children"><div class="content">One problem I&#x27;ve noticed with status=progress is that systems can sometimes have gigabytes of buffer space waiting to be filled, so the transfer spends most of its time in a &quot;nearly done&quot; state while (for instance) the SD card gets slowly filled at its real speed.</div><br/></div></div><div id="42201324" class="c"><input type="checkbox" id="c-42201324" checked=""/><div class="controls bullet"><span class="by">fulafel</span><span>|</span><a href="#42198530">parent</a><span>|</span><a href="#42200618">prev</a><span>|</span><a href="#42198757">next</a><span>|</span><label class="collapse" for="c-42201324">[-]</label><label class="expand" for="c-42201324">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s slowish, bottlenecking disk based IO. (yes you can improve it with dd options, if you are versed in the language...)</div><br/></div></div><div id="42198757" class="c"><input type="checkbox" id="c-42198757" checked=""/><div class="controls bullet"><span class="by">fuzztester</span><span>|</span><a href="#42198530">parent</a><span>|</span><a href="#42201324">prev</a><span>|</span><a href="#42198722">next</a><span>|</span><label class="collapse" for="c-42198757">[-]</label><label class="expand" for="c-42198757">[3 more]</label></div><br/><div class="children"><div class="content">dd conv=swab is a cool and useful option. swab stands for swap bytes, iirc. guess what it is used for, those who don&#x27;t already know.</div><br/><div id="42199256" class="c"><input type="checkbox" id="c-42199256" checked=""/><div class="controls bullet"><span class="by">codetrotter</span><span>|</span><a href="#42198530">root</a><span>|</span><a href="#42198757">parent</a><span>|</span><a href="#42198722">next</a><span>|</span><label class="collapse" for="c-42199256">[-]</label><label class="expand" for="c-42199256">[2 more]</label></div><br/><div class="children"><div class="content">&gt; guess what it is used for, those who don&#x27;t already know.<p>Changing the endianness of the data?</div><br/><div id="42200139" class="c"><input type="checkbox" id="c-42200139" checked=""/><div class="controls bullet"><span class="by">fuzztester</span><span>|</span><a href="#42198530">root</a><span>|</span><a href="#42199256">parent</a><span>|</span><a href="#42198722">next</a><span>|</span><label class="collapse" for="c-42200139">[-]</label><label class="expand" for="c-42200139">[1 more]</label></div><br/><div class="children"><div class="content">Exactly!<p>That&#x27;s just what I used it for, early in my career, in a software troubleshooting case.<p>I was a newbie dev, tasked with converting some data from another machine &#x2F; OS format on tape to a Unix machine format.<p>Was fairly new to Unix too.<p>Looked through man pages, found dd, could read and copy the data from tape drive to disk using it. But the data, while in ASCII, and English letters, seemed garbled. Seemed like actual words, but not quite, if you know what I mean. Something seemed off a bit.<p>I puzzled over it for a while, then checked the dd man page again. I saw the conv=swab option and its meaning, which is to <i>swa</i>p adjacent <i>b</i>ytes. (Typical Unix cryptic syntax, and I say that as a long term Unix guy). I probably was new to endianess at that time. This was in a pre-Internet time, so I could not google to check what endianness meant.<p>I added that option to my dd command line, and what was my shock and pleasure to see all the words coming out as proper English words, now, on the screen!<p>Then I knew that the tape contained actual data, not garbage. I saved it to disk under some file name.<p>Job done.</div><br/></div></div></div></div></div></div></div></div><div id="42198722" class="c"><input type="checkbox" id="c-42198722" checked=""/><div class="controls bullet"><span class="by">sirjaz</span><span>|</span><a href="#42198530">prev</a><span>|</span><a href="#42199890">next</a><span>|</span><label class="collapse" for="c-42198722">[-]</label><label class="expand" for="c-42198722">[2 more]</label></div><br/><div class="children"><div class="content">We have that in powershell also show-progress</div><br/><div id="42198895" class="c"><input type="checkbox" id="c-42198895" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42198722">parent</a><span>|</span><a href="#42199890">next</a><span>|</span><label class="collapse" for="c-42198895">[-]</label><label class="expand" for="c-42198895">[1 more]</label></div><br/><div class="children"><div class="content">Ah yes, PowerShell.  Never have so many owed so much to ... tab completion 8)</div><br/></div></div></div></div><div id="42199890" class="c"><input type="checkbox" id="c-42199890" checked=""/><div class="controls bullet"><span class="by">c0deR3D</span><span>|</span><a href="#42198722">prev</a><span>|</span><a href="#42199174">next</a><span>|</span><label class="collapse" for="c-42199890">[-]</label><label class="expand" for="c-42199890">[1 more]</label></div><br/><div class="children"><div class="content">Got me wondering, how does it works?</div><br/></div></div><div id="42199174" class="c"><input type="checkbox" id="c-42199174" checked=""/><div class="controls bullet"><span class="by">mac3n</span><span>|</span><a href="#42199890">prev</a><span>|</span><label class="collapse" for="c-42199174">[-]</label><label class="expand" for="c-42199174">[1 more]</label></div><br/><div class="children"><div class="content">see also<p><a href="https:&#x2F;&#x2F;gitlab.com&#x2F;mac3n&#x2F;pipeleak" rel="nofollow">https:&#x2F;&#x2F;gitlab.com&#x2F;mac3n&#x2F;pipeleak</a></div><br/></div></div></div></div></div></div></div></body></html>