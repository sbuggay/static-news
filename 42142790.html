<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1731661284293" as="style"/><link rel="stylesheet" href="styles.css?v=1731661284293"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://uhoreg.gitlab.io/matrix-tutorial/index.html">Matrix Client Tutorial</a> <span class="domain">(<a href="https://uhoreg.gitlab.io">uhoreg.gitlab.io</a>)</span></div><div class="subtext"><span>whereistimbo</span> | <span>21 comments</span></div><br/><div><div id="42143206" class="c"><input type="checkbox" id="c-42143206" checked=""/><div class="controls bullet"><span class="by">alwayslikethis</span><span>|</span><a href="#42144086">next</a><span>|</span><label class="collapse" for="c-42143206">[-]</label><label class="expand" for="c-42143206">[17 more]</label></div><br/><div class="children"><div class="content">The lack of good clients is really holding Matrix back. Element is rather bloated, and most of the other clients are missing significant amounts of features.</div><br/><div id="42144926" class="c"><input type="checkbox" id="c-42144926" checked=""/><div class="controls bullet"><span class="by">Arathorn</span><span>|</span><a href="#42143206">parent</a><span>|</span><a href="#42144922">next</a><span>|</span><label class="collapse" for="c-42144926">[-]</label><label class="expand" for="c-42144926">[1 more]</label></div><br/><div class="children"><div class="content">Element X (<a href="https:&#x2F;&#x2F;element.io&#x2F;blog&#x2F;deep-dive-into-element-x" rel="nofollow">https:&#x2F;&#x2F;element.io&#x2F;blog&#x2F;deep-dive-into-element-x</a>) is intended to spell out how lightweight and unbloated an Element-style client can be. The only main missing features are threads and spaces which should land in the coming months.</div><br/></div></div><div id="42144922" class="c"><input type="checkbox" id="c-42144922" checked=""/><div class="controls bullet"><span class="by">itsthejb</span><span>|</span><a href="#42143206">parent</a><span>|</span><a href="#42144926">prev</a><span>|</span><a href="#42144766">next</a><span>|</span><label class="collapse" for="c-42144922">[-]</label><label class="expand" for="c-42144922">[1 more]</label></div><br/><div class="children"><div class="content">Very very true. I self host synapse, and generally speaking the ability to bridge my ~3 most used messengers into one app (ElementX) adds value. However, the lacking features and bizarre feature disjoints between Element (supposedly EOL) and ElementX (suppose next gen) are jarring</div><br/></div></div><div id="42144766" class="c"><input type="checkbox" id="c-42144766" checked=""/><div class="controls bullet"><span class="by">heroprotagonist</span><span>|</span><a href="#42143206">parent</a><span>|</span><a href="#42144922">prev</a><span>|</span><a href="#42143606">next</a><span>|</span><label class="collapse" for="c-42144766">[-]</label><label class="expand" for="c-42144766">[1 more]</label></div><br/><div class="children"><div class="content">I _really_ wish that if Element has an update prompt for me almost every single time I open it, that it would just update during the startup sequence on its own.<p>Or at least have an option for it.  Not a &#x27;Oh you loaded, now click this button to load again please&#x27; prompt whenever I launch it.</div><br/></div></div><div id="42143606" class="c"><input type="checkbox" id="c-42143606" checked=""/><div class="controls bullet"><span class="by">ericjmorey</span><span>|</span><a href="#42143206">parent</a><span>|</span><a href="#42144766">prev</a><span>|</span><a href="#42144777">next</a><span>|</span><label class="collapse" for="c-42143606">[-]</label><label class="expand" for="c-42143606">[12 more]</label></div><br/><div class="children"><div class="content">I&#x27;d say that the protocol itself is what&#x27;s doing Matrix in.</div><br/><div id="42144938" class="c"><input type="checkbox" id="c-42144938" checked=""/><div class="controls bullet"><span class="by">Arathorn</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143606">parent</a><span>|</span><a href="#42143674">next</a><span>|</span><label class="collapse" for="c-42144938">[-]</label><label class="expand" for="c-42144938">[1 more]</label></div><br/><div class="children"><div class="content">What are you thinking of in particular? Fwiw, as project lead, i would be first to admit that there were slow bits - eg sync v2, which is why we built sliding sync… and crypto was easy to get wrong, hence shipping a highly polished implementation in matrix-rust-sdk.  But what do you have in mind? Otherwise this doesn’t sound very wellfounded…</div><br/></div></div><div id="42143674" class="c"><input type="checkbox" id="c-42143674" checked=""/><div class="controls bullet"><span class="by">alwayslikethis</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143606">parent</a><span>|</span><a href="#42144938">prev</a><span>|</span><a href="#42143712">next</a><span>|</span><label class="collapse" for="c-42143674">[-]</label><label class="expand" for="c-42143674">[4 more]</label></div><br/><div class="children"><div class="content">In order to support bridges to so many different proprietary platforms Matrix needs to have a superset of their features, so the feature creep is probably intentional. It does make it harder for clients to keep up though.</div><br/><div id="42144006" class="c"><input type="checkbox" id="c-42144006" checked=""/><div class="controls bullet"><span class="by">cmeacham98</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143674">parent</a><span>|</span><a href="#42143712">next</a><span>|</span><label class="collapse" for="c-42144006">[-]</label><label class="expand" for="c-42144006">[3 more]</label></div><br/><div class="children"><div class="content">Matrix is the opposite of feature creep - there are several features entirely missing from major clients that users of modern chat apps expect to have.<p>(Examples include: custom emoji, functional search of encrypted chats, pinned messages or some sort of MOTD, forwarding messages, etc)</div><br/><div id="42144918" class="c"><input type="checkbox" id="c-42144918" checked=""/><div class="controls bullet"><span class="by">Arathorn</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42144006">parent</a><span>|</span><a href="#42144652">next</a><span>|</span><label class="collapse" for="c-42144918">[-]</label><label class="expand" for="c-42144918">[1 more]</label></div><br/><div class="children"><div class="content">As a protocol, Matrix has all of these features (custom emoji is a proposal, but many clients implement it).<p>As a client, Element has all of these (encrypted search only on Desktop for now) other than custom emoji.</div><br/></div></div><div id="42144652" class="c"><input type="checkbox" id="c-42144652" checked=""/><div class="controls bullet"><span class="by">ptman</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42144006">parent</a><span>|</span><a href="#42144918">prev</a><span>|</span><a href="#42143712">next</a><span>|</span><label class="collapse" for="c-42144652">[-]</label><label class="expand" for="c-42144652">[1 more]</label></div><br/><div class="children"><div class="content">The matrix developers are experienced IM developers. They&#x27;ve built systems on XMPP and custom protocols before. Their estimate was that because of matrix being federated, every feature was 5-10x harder to implement than in centralized systems.</div><br/></div></div></div></div></div></div><div id="42143712" class="c"><input type="checkbox" id="c-42143712" checked=""/><div class="controls bullet"><span class="by">isaacaggrey</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143606">parent</a><span>|</span><a href="#42143674">prev</a><span>|</span><a href="#42144777">next</a><span>|</span><label class="collapse" for="c-42143712">[-]</label><label class="expand" for="c-42143712">[6 more]</label></div><br/><div class="children"><div class="content">Could you elaborate?</div><br/><div id="42144087" class="c"><input type="checkbox" id="c-42144087" checked=""/><div class="controls bullet"><span class="by">dzaima</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143712">parent</a><span>|</span><a href="#42143812">next</a><span>|</span><label class="collapse" for="c-42144087">[-]</label><label class="expand" for="c-42144087">[3 more]</label></div><br/><div class="children"><div class="content">There are some hilariously ugly things for even trivial things like editing&#x2F;replies:<p>Edits get a `&quot;m.relates_to&quot;: {&quot;event_id&quot;: ..., &quot;rel_type&quot;: &quot;m.replace&quot;}` field in the body, and `&quot;m.new_content&quot;: {...}`, containing the plain-text and HTML versions of the message (while also keeping a copy of both, typically with a prepended &quot;*&quot;, outside &quot;m.new_content&quot;, for backwards compatibility; yes, that&#x27;s 4 (four) copies of the message text in an edit; for some while Element generated up to 10 (ten) copies IIRC, due to some proposed extension(s), but that seems to be gone thankfully).<p>Reply messages get `&quot;m.relates_to&quot;: {&quot;m.in_reply_to&quot;: {&quot;event_id&quot;: ...}}` - an annoyingly different format from the edits. It might look like that that allows an edit to change which message is being replied to, but nope, last I checked, that&#x27;s not supported. Oh and for backwards compatibility a &lt;mx-reply&gt; HTML element is to be prepended, containing a copy of the replied-to message and its info (and yes, that means that the replied-to message effectively can&#x27;t be deleted as the reply will still contain its text; luckily clients can choose to do not generate such &lt;mx-reply&gt;, but Element still does). And if you want to actually get proper reliable info about the replied-to event, you have to just make an API request for every single one you want to display (unless you happen to already have a cached copy, which luckily for replies is reasonably common).<p>And then there&#x27;s threads - again in the name of crappy backwards-compatibility there&#x27;s a mess - within-thread replies imitate a reply to the last in-thread message, along with `&quot;m.relates_to&quot;: {&quot;event_id&quot;: ..., &quot;rel_type&quot;: &quot;m.thread&quot;, &quot;is_falling_back&quot;: true, ...}`, that &quot;is_falling_back&quot; indicating that this isn&#x27;t actually a reply (being false when you want an actual reply). And clients are &quot;supposed&quot; to also handle replies to in-thread messages without the &quot;m.thread&quot; relation (which&#x27;d come from clients not supporting threads), but as far as I can tell there&#x27;s no way do to it while paginating without making an API request per every single message (and yes Element behaves quite buggily here).<p>And then there are some things that can&#x27;t be reasonably handled - the context&#x2F;message listing&#x2F;pagination APIs don&#x27;t give any reaction info (besides the reaction events themselves in chronological position of their addition), so reaction presence&#x2F;counts in history view must be calculated by clients, and thus won&#x27;t be able to show ones that were posted a while after the messages. (there used to be some aggregation provided, but it&#x27;s since been removed!!!) I think the only way to do this properly is truly just making an API request of &quot;list reactions&quot; for every single message the client wants to show.<p>This may make it seem like Matrix has an extremely firm stance on backwards-compatibility, but nope - recently they deprecated &amp; made non-functional the unauthenticated API retrieval of media, making it impossible for clients not supporting video&#x2F;audio&#x2F;image display to just open those in the browser, instead forcing them to have custom file downloading &amp; saving code, and also making it impossible to link to media within a message. There was a window of 6 (or less?) months between the new API being finalized, and the old one being removed.</div><br/><div id="42144741" class="c"><input type="checkbox" id="c-42144741" checked=""/><div class="controls bullet"><span class="by">ptman</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42144087">parent</a><span>|</span><a href="#42143812">next</a><span>|</span><label class="collapse" for="c-42144741">[-]</label><label class="expand" for="c-42144741">[2 more]</label></div><br/><div class="children"><div class="content">Many of these problems stem from the fact that matrix is federated. And it&#x27;s a protocol, not really even for messaging but for a federated graph database. In federation some messages may be missing and arrive out-of-order. And different clients have different capabilities. There&#x27;s a really simple example client implemented in a couple of lines of bash.</div><br/><div id="42144933" class="c"><input type="checkbox" id="c-42144933" checked=""/><div class="controls bullet"><span class="by">dzaima</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42144741">parent</a><span>|</span><a href="#42143812">next</a><span>|</span><label class="collapse" for="c-42144933">[-]</label><label class="expand" for="c-42144933">[1 more]</label></div><br/><div class="children"><div class="content">No, most of those are just plain and simple bad outcomes due to not having thought out extremely basic things ahead-of-time. And even if there are problems with actually no simple fix, that in no way means the problem ceases to be a problem.<p>Replies to threads from thread-unsupporting clients are the one potentially-hard thing federation-wise, as doing it properly would require the server to trace back the reply and from that handling it as in the thread, but that&#x27;s not far from what servers already have to do with edits. Or you could also just not require&#x2F;suggest that behavior, having replies without thread metadata always be outside of threads; would probably save on confusion too, as the illusion would break anyway when someone on a client without thread support would not do a reply on some message after having used replies on others.<p>There might be some graph core to it, but it&#x27;s still primarily a messaging service. Opening the client spec will show you tons of messaging-specific APIs.<p>I utterly disagree that saving a half-dozen lines in largely-useless toy clients is worth making more feature-complete clients more complex, and doubling the size of every edit event.</div><br/></div></div></div></div></div></div><div id="42143812" class="c"><input type="checkbox" id="c-42143812" checked=""/><div class="controls bullet"><span class="by">ranger_danger</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143712">parent</a><span>|</span><a href="#42144087">prev</a><span>|</span><a href="#42144777">next</a><span>|</span><label class="collapse" for="c-42143812">[-]</label><label class="expand" for="c-42143812">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;0x0.st&#x2F;H8h-.png" rel="nofollow">https:&#x2F;&#x2F;0x0.st&#x2F;H8h-.png</a></div><br/><div id="42144071" class="c"><input type="checkbox" id="c-42144071" checked=""/><div class="controls bullet"><span class="by">Groxx</span><span>|</span><a href="#42143206">root</a><span>|</span><a href="#42143812">parent</a><span>|</span><a href="#42144777">next</a><span>|</span><label class="collapse" for="c-42144071">[-]</label><label class="expand" for="c-42144071">[1 more]</label></div><br/><div class="children"><div class="content">All that really shows is &quot;the project has an active community&quot;. Have you seen how many XMPP has? Or Python[1]? This is just normal open development metadata.<p>[1]: <a href="https:&#x2F;&#x2F;peps.python.org&#x2F;pep-0000&#x2F;#" rel="nofollow">https:&#x2F;&#x2F;peps.python.org&#x2F;pep-0000&#x2F;#</a></div><br/></div></div></div></div></div></div></div></div><div id="42144777" class="c"><input type="checkbox" id="c-42144777" checked=""/><div class="controls bullet"><span class="by">paulcarroty</span><span>|</span><a href="#42143206">parent</a><span>|</span><a href="#42143606">prev</a><span>|</span><a href="#42144086">next</a><span>|</span><label class="collapse" for="c-42144777">[-]</label><label class="expand" for="c-42144777">[1 more]</label></div><br/><div class="children"><div class="content">cinny&#x2F;fluffychat&#x2F;iamb are the greatest.</div><br/></div></div></div></div><div id="42144086" class="c"><input type="checkbox" id="c-42144086" checked=""/><div class="controls bullet"><span class="by">amstan</span><span>|</span><a href="#42143206">prev</a><span>|</span><a href="#42143209">next</a><span>|</span><label class="collapse" for="c-42144086">[-]</label><label class="expand" for="c-42144086">[2 more]</label></div><br/><div class="children"><div class="content">I tried to do something similar. It&#x27;s infuriating how the client must be stateful and have local storage, for both the access_token and even last message recieved. That&#x27;s right you must remember as the client where the last events [1] you&#x27;ve seen (even if you already told the server to mark it as read) was or else the server will happily send you the same messages over and over again.<p>I kind of miss making IRC bots where things were much simpler and ... quicker honestly (latency wise).<p>[1] <a href="https:&#x2F;&#x2F;uhoreg.gitlab.io&#x2F;matrix-tutorial&#x2F;sync.html#:~:text=we%20retrieve%20the-,next_batch,-property%20to%20use" rel="nofollow">https:&#x2F;&#x2F;uhoreg.gitlab.io&#x2F;matrix-tutorial&#x2F;sync.html#:~:text=w...</a></div><br/><div id="42144114" class="c"><input type="checkbox" id="c-42144114" checked=""/><div class="controls bullet"><span class="by">dzaima</span><span>|</span><a href="#42144086">parent</a><span>|</span><a href="#42143209">next</a><span>|</span><label class="collapse" for="c-42144114">[-]</label><label class="expand" for="c-42144114">[1 more]</label></div><br/><div class="children"><div class="content">At least that means that you will never have messages get dropped due to network issues, or even restarts if you persist the token across such. (the API will jump forwards if there are too many unsynced messages, but at least it should then be providing a &quot;limited: true&quot; so that one can paginate in the omitted events if so desired (or not if undesired))</div><br/></div></div></div></div><div id="42143209" class="c"><input type="checkbox" id="c-42143209" checked=""/><div class="controls bullet"><span class="by">ranger_danger</span><span>|</span><a href="#42144086">prev</a><span>|</span><label class="collapse" for="c-42143209">[-]</label><label class="expand" for="c-42143209">[1 more]</label></div><br/><div class="children"><div class="content">Finally something besides the matrix foundation&#x27;s &quot;lol the auto-generated API docs are enough&quot; nonsense. This really helps a whole lot better.</div><br/></div></div></div></div></div></div></div></body></html>