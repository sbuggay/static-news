<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1717405251202" as="style"/><link rel="stylesheet" href="styles.css?v=1717405251202"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://rgoswami.me/posts/lowering-resource-usage-foot-systemd/">Lowering resource usage with foot and systemd</a> <span class="domain">(<a href="https://rgoswami.me">rgoswami.me</a>)</span></div><div class="subtext"><span>HaoZeke</span> | <span>15 comments</span></div><br/><div><div id="40560117" class="c"><input type="checkbox" id="c-40560117" checked=""/><div class="controls bullet"><span class="by">chme</span><span>|</span><a href="#40559329">next</a><span>|</span><label class="collapse" for="c-40560117">[-]</label><label class="expand" for="c-40560117">[1 more]</label></div><br/><div class="children"><div class="content">The title is kinda odd. &quot;Lowering resource usage of foot with systemd&quot; sounds more appropriate.<p>Not knowing that foot is a terminal emulator, I assumed that foot is some kind of improved resource manager that allows for a general lesser resource usage.</div><br/></div></div><div id="40559329" class="c"><input type="checkbox" id="c-40559329" checked=""/><div class="controls bullet"><span class="by">tupolef</span><span>|</span><a href="#40560117">prev</a><span>|</span><a href="#40558479">next</a><span>|</span><label class="collapse" for="c-40559329">[-]</label><label class="expand" for="c-40559329">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t want to switch to Wayland for now, but I will check foot when I do.<p>I do the same thing with URxvt as a systemd daemon, Tmux as a transient service with systemd-run from .bashrc, and a script in i3wm to run URxvtd client or hide&#x2F;get the window.<p>The way I use to run Tmux from a transient service locally and in ssh with the same .bashrc is nice I think. Tmux will survive the terminal and even if I close my session and come back to it:<p><pre><code>  #!&#x2F;usr&#x2F;bin&#x2F;env bash
  # ~&#x2F;.bashrc: sourced by bash(1) for non-login shells.
  
  # If not running interactively, don&#x27;t do anything
  case $- in
    *i*) ;;
    *) return ;;
  esac
  
  chmod 700 ~&#x2F;.bashrc.d
  chmod 600 ~&#x2F;.bashrc ~&#x2F;.bashrc.d&#x2F;*
  
  # check if we are already in a Tmux session and not in ssh then open&#x2F;attach the default one
  if [[ ! &quot;${TERM}&quot; == &quot;tmux&quot;* ]] &amp;&amp; [[ -z &quot;${TMUX}&quot; ]] &amp;&amp; [[ -z &quot;${SSH_CONNECTION}&quot; ]] &amp;&amp; command -v tmux 1&gt; &#x2F;dev&#x2F;null; then
    # attach or start the local default Tmux session
    if systemctl --quiet $([[ $(id -u) != 0 ]]; echo &quot;--user&quot;) is-active tmux-local-$(id -un).scope; then
      tmux -L local-$(id -un) attach-session -t local-$(id -un) ; exit
    fi
    systemd-run -q --unit tmux-local-$(id -un) --scope $([[ $(id -u) != 0 ]] &amp;&amp; echo &quot;--user&quot;) tmux -L local-$(id -un) new-session -s local-$(id -un) ; exit
  elif [[ -z &quot;${TMUX}&quot; ]] &amp;&amp; [[ -n &quot;${SSH_CONNECTION}&quot; ]] &amp;&amp; command -v tmux 1&gt; &#x2F;dev&#x2F;null; then
    # attach or start the ssh default Tmux session
    if systemctl --quiet $([[ $(id -u) != 0 ]]; echo &quot;--user&quot;) is-active tmux-ssh-$(id -un).scope; then
      tmux -L ssh-$(id -un) attach-session -t ssh-$(id -un) ; exit
    fi
    systemd-run -q --unit tmux-ssh-$(id -un) --scope $([[ $(id -u) != 0 ]] &amp;&amp; echo &quot;--user&quot;) tmux -L ssh-$(id -un) new-session -s ssh-$(id -un) &amp;&amp; exit || echo &#x27;Tmux Systemd unit failed&#x2F;exited&#x27;
  
  fi
  
  # if Tmux is not installed or if we are inside a Tmux session continue the sourcing
  for file in ~&#x2F;.bashrc.d&#x2F;*.bashrc;
  do
    source &quot;${file}&quot;
  done</code></pre></div><br/></div></div><div id="40558479" class="c"><input type="checkbox" id="c-40558479" checked=""/><div class="controls bullet"><span class="by">emmanueloga_</span><span>|</span><a href="#40559329">prev</a><span>|</span><a href="#40559838">next</a><span>|</span><label class="collapse" for="c-40558479">[-]</label><label class="expand" for="c-40558479">[3 more]</label></div><br/><div class="children"><div class="content">I never heard about it but foot is a terminal emulator with some server mode [1].<p>—<p>1: <a href="https:&#x2F;&#x2F;wiki.gentoo.org&#x2F;wiki&#x2F;Foot#Server_mode_configuration" rel="nofollow">https:&#x2F;&#x2F;wiki.gentoo.org&#x2F;wiki&#x2F;Foot#Server_mode_configuration</a></div><br/><div id="40558580" class="c"><input type="checkbox" id="c-40558580" checked=""/><div class="controls bullet"><span class="by">HaoZeke</span><span>|</span><a href="#40558479">parent</a><span>|</span><a href="#40558881">next</a><span>|</span><label class="collapse" for="c-40558580">[-]</label><label class="expand" for="c-40558580">[1 more]</label></div><br/><div class="children"><div class="content">Yup, I switched a few years ago from i3 (X11) to sway (Wayland) and use it to replace urxvt.</div><br/></div></div><div id="40558881" class="c"><input type="checkbox" id="c-40558881" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#40558479">parent</a><span>|</span><a href="#40558580">prev</a><span>|</span><a href="#40559838">next</a><span>|</span><label class="collapse" for="c-40558881">[-]</label><label class="expand" for="c-40558881">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!  I was wondering about that one as well.</div><br/></div></div></div></div><div id="40559838" class="c"><input type="checkbox" id="c-40559838" checked=""/><div class="controls bullet"><span class="by">sed3</span><span>|</span><a href="#40558479">prev</a><span>|</span><a href="#40558961">next</a><span>|</span><label class="collapse" for="c-40559838">[-]</label><label class="expand" for="c-40559838">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Since I often work in strong sunlight, I often want to reconfigure my terminal to use a light or a dark scheme depending on the time of day.<p>Konsole can switch color theme with simple dbus message.<p>For the rest, I use tmux sessions and some scripts. When I restart computer, all terminal windows with remote ssh sessions get restored.<p>I do not need any modifications on server (except tmux or screen package).</div><br/></div></div><div id="40558961" class="c"><input type="checkbox" id="c-40558961" checked=""/><div class="controls bullet"><span class="by">FrostKiwi</span><span>|</span><a href="#40559838">prev</a><span>|</span><a href="#40559609">next</a><span>|</span><label class="collapse" for="c-40558961">[-]</label><label class="expand" for="c-40558961">[2 more]</label></div><br/><div class="children"><div class="content">Really enjoyed foot! Runs along the same lines of emacs server and emacsclient.<p>I ended up dropping it for the same reason I dropped emacs server. There are rare edge cases which causes the server to hang and thus taking down not just one instance of your work, but all of it. Losing the resilience of multiple processes is not worth the RAM it saves, not on modern hardware.</div><br/><div id="40559111" class="c"><input type="checkbox" id="c-40559111" checked=""/><div class="controls bullet"><span class="by">HaoZeke</span><span>|</span><a href="#40558961">parent</a><span>|</span><a href="#40559609">next</a><span>|</span><label class="collapse" for="c-40559111">[-]</label><label class="expand" for="c-40559111">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a valid point. It might be more about using the right tool for the task. For example, using tmux for persistent terminal windows can help. A setup where the main compilation terminal (subFloat) and smaller terminal instances for chat&#x2F;irssi&#x2F;nmpc (mS) run within a tmux session ensures persistence even if foot crashes (or is killed for applying configuration updates) as noted in the post ^_^</div><br/></div></div></div></div><div id="40559609" class="c"><input type="checkbox" id="c-40559609" checked=""/><div class="controls bullet"><span class="by">NewJazz</span><span>|</span><a href="#40558961">prev</a><span>|</span><a href="#40558949">next</a><span>|</span><label class="collapse" for="c-40559609">[-]</label><label class="expand" for="c-40559609">[2 more]</label></div><br/><div class="children"><div class="content">IMO the best part of the foot client&#x2F;server setup is not lower memory usage, but faster terminal opening time. Starting alacritty is kinda slow. Maybe not a second, but noticeable. Starting foot standalone is definitely faster. Opening a foot window via an already running server is near instant.</div><br/><div id="40560009" class="c"><input type="checkbox" id="c-40560009" checked=""/><div class="controls bullet"><span class="by">majoe</span><span>|</span><a href="#40559609">parent</a><span>|</span><a href="#40558949">next</a><span>|</span><label class="collapse" for="c-40560009">[-]</label><label class="expand" for="c-40560009">[1 more]</label></div><br/><div class="children"><div class="content">I switched from konsole to foot, when I upgraded to plasma6 (and therefore to wayland). One of the main reasons was actually startup time.
I compared several terminals (konsole, alacritty, kitty, wezterm, foot) and foot had a notably faster startup time than the rest.
For me it starts fast enough without a client&#x2F;server setup, whereas konsole often slightly annoyed me, when I just wanted to execute a single command.</div><br/></div></div></div></div><div id="40558949" class="c"><input type="checkbox" id="c-40558949" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#40559609">prev</a><span>|</span><a href="#40559396">next</a><span>|</span><label class="collapse" for="c-40558949">[-]</label><label class="expand" for="c-40558949">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Right of the bat, it is rather evident that this configuration will spawn two instances of foot, one for each scratchpad.<p>&gt; Figure 1: Snapshot of memory consumption (from btop), clients take around 10x less memory<p>By all means use a server&#x2F;clients approach if it reduces per-process memory, but it&#x27;s probably not as bad as it looks, because AFAIK the actual executable only gets loaded once and then reused. So each process has its own data in RAM, but the executable&#x2F;binary only gets loaded the once.<p>Also, if this is a problem maybe revisit your choice of terminal? It&#x27;s annoyingly hard to get a total (or more likely I just don&#x27;t know how to get it), but every number I can seem to find says alacritty is only using &lt;2MB <i>total</i> on my box, so your 27M max on foot looks... weird. Like, I can run a full standalone terminal in the size of your client; I appreciate that it might have features that make it worthwhile, but consider the tradeoffs?</div><br/><div id="40560075" class="c"><input type="checkbox" id="c-40560075" checked=""/><div class="controls bullet"><span class="by">akho</span><span>|</span><a href="#40558949">parent</a><span>|</span><a href="#40559084">next</a><span>|</span><label class="collapse" for="c-40560075">[-]</label><label class="expand" for="c-40560075">[1 more]</label></div><br/><div class="children"><div class="content">&gt; it&#x27;s probably not as bad as it looks, because AFAIK the actual executable only gets loaded once and then reused<p>The actual foot executable is 427kb. RAM consumption win in the server setup is the shared glyph cache, which is most of the usage at startup.<p>&gt; alacritty is only using &lt;2MB total on my box<p>That would be less than the image it’s drawing on screen, the glyph cache, or alacritty’s 11Mb executable. How are you measuring?</div><br/></div></div><div id="40559084" class="c"><input type="checkbox" id="c-40559084" checked=""/><div class="controls bullet"><span class="by">HaoZeke</span><span>|</span><a href="#40558949">parent</a><span>|</span><a href="#40560075">prev</a><span>|</span><a href="#40559396">next</a><span>|</span><label class="collapse" for="c-40559084">[-]</label><label class="expand" for="c-40559084">[1 more]</label></div><br/><div class="children"><div class="content">btop might be measuring the wrong thing here, but alacritty on my box shows 93M using the same interface. I remember benchmarking foot and alacritty (also kitty) pretty extensively a few years ago, and settled on foot.<p>Though of course, the memory usage on modern machines is really not a major issue, but the configuration update, along with the tmux session death was annoying..<p>EDIT: Some timing metrics..<p><pre><code>  foot -s &amp;
  hyperfine --warmup 8 &#x27;alacritty -e true&#x27; &#x27;foot -e true&#x27; &#x27;footclient -e true&#x27;
  Benchmark 1: alacritty -e true
    Time (mean ± σ):      99.0 ms ±  14.2 ms    [User: 58.5 ms, System: 33.4 ms]
    Range (min … max):    82.7 ms … 148.3 ms    32 runs

  Benchmark 2: foot -e true
    Time (mean ± σ):      37.2 ms ±   2.3 ms    [User: 40.3 ms, System: 9.5 ms]
    Range (min … max):    33.8 ms …  43.7 ms    83 runs

  Benchmark 3: footclient -e true
    Time (mean ± σ):      22.8 ms ±   4.3 ms    [User: 0.9 ms, System: 0.8 ms]
    Range (min … max):    18.2 ms …  63.6 ms    133 runs

  Summary
    footclient -e true ran
      1.63 ± 0.32 times faster than foot -e true
      4.35 ± 1.03 times faster than alacritty -e true</code></pre></div><br/></div></div></div></div><div id="40559396" class="c"><input type="checkbox" id="c-40559396" checked=""/><div class="controls bullet"><span class="by">nurettin</span><span>|</span><a href="#40558949">prev</a><span>|</span><label class="collapse" for="c-40559396">[-]</label><label class="expand" for="c-40559396">[1 more]</label></div><br/><div class="children"><div class="content">This is why I run xvfb in systemd instead of using something like xvfb-run which spawns a new virtual display every time you run it.</div><br/></div></div></div></div></div></div></div></body></html>