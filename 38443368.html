<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701248458725" as="style"/><link rel="stylesheet" href="styles.css?v=1701248458725"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://boston.conman.org/2023/11/27.1">Unit testing on an 8-bit CPU</a> <span class="domain">(<a href="https://boston.conman.org">boston.conman.org</a>)</span></div><div class="subtext"><span>bertman</span> | <span>8 comments</span></div><br/><div><div id="38455359" class="c"><input type="checkbox" id="c-38455359" checked=""/><div class="controls bullet"><span class="by">ajxs</span><span>|</span><a href="#38455271">next</a><span>|</span><label class="collapse" for="c-38455359">[-]</label><label class="expand" for="c-38455359">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been writing a <i>lot</i> of 8-bit assembler for the 6303, which is in the same processor family as the CPU in the TRS-80, which the author is writing code for (for this project in case anyone is wondering: <a href="https:&#x2F;&#x2F;github.com&#x2F;ajxs&#x2F;yamaha_dx97">https:&#x2F;&#x2F;github.com&#x2F;ajxs&#x2F;yamaha_dx97</a>). I ran into the exact same issue. I wrote a MAME driver for the target platform, so I could test my builds on my development machine. Obviously that sped things up <i>a lot</i>. The MAME debugger isn&#x27;t built for unit testing, and it can&#x27;t really be &#x27;instrumented&#x27;, but I was able to write a lot of scripts which could get me pretty close. You can set the debugger to initialise the system RAM from a file when it hits the breakpoint at the start of your function, then test the RAM against the desired output when it when it hits the breakpoint at the end. As clunky as this is, it saved me in a few tricky places!</div><br/><div id="38455779" class="c"><input type="checkbox" id="c-38455779" checked=""/><div class="controls bullet"><span class="by">zellyn</span><span>|</span><a href="#38455359">parent</a><span>|</span><a href="#38455271">next</a><span>|</span><label class="collapse" for="c-38455779">[-]</label><label class="expand" for="c-38455779">[1 more]</label></div><br/><div class="children"><div class="content">Writing your own (even not great) emulator also helps a <i>lot</i> for building quick, convenient change&#x2F;build&#x2F;test cycles…</div><br/></div></div></div></div><div id="38455271" class="c"><input type="checkbox" id="c-38455271" checked=""/><div class="controls bullet"><span class="by">aunwick</span><span>|</span><a href="#38455359">prev</a><span>|</span><a href="#38455166">next</a><span>|</span><label class="collapse" for="c-38455271">[-]</label><label class="expand" for="c-38455271">[1 more]</label></div><br/><div class="children"><div class="content">Um.  History?  Yes we could control autonomous robots with 8bit cpus in 1993 and we were engineers so we did it with acceptable risk, aka some testing.</div><br/></div></div><div id="38455166" class="c"><input type="checkbox" id="c-38455166" checked=""/><div class="controls bullet"><span class="by">readthenotes1</span><span>|</span><a href="#38455271">prev</a><span>|</span><a href="#38455305">next</a><span>|</span><label class="collapse" for="c-38455166">[-]</label><label class="expand" for="c-38455166">[1 more]</label></div><br/><div class="children"><div class="content">Back in 1988, my manager, who is taking graduate School courses at a local college, requested that we start writing test programs instead of walking down stairs, loading and running our assembly code on the local machine.<p>To generate adequate tests, we would have to simulate part of the actual machine.<p>Fortunately, he understood we were more likely to write a bad emulator and let us get our exercise instead</div><br/></div></div><div id="38455305" class="c"><input type="checkbox" id="c-38455305" checked=""/><div class="controls bullet"><span class="by">kragen</span><span>|</span><a href="#38455166">prev</a><span>|</span><label class="collapse" for="c-38455305">[-]</label><label class="expand" for="c-38455305">[3 more]</label></div><br/><div class="children"><div class="content">this stuff about how unit tests aren&#x27;t tests for units but rather tests that are units is nonsense. the term has been used to mean &#x27;tests for units&#x27; for about a century<p>it is certainly true that the optimal amount and kind of testing depends on your development environment. if for some reason you find yourself writing 6809 assembly, here are some ways you can make testing cheaper<p>- don&#x27;t write the tests in assembly. there are c compilers. forth is also a fine option. or you can test manually from a debugger or monitor program<p>- forth makes a decent monitor program and macro assembler and is scriptable for testing. it&#x27;s maybe a lot better at that than it is at being a programming language. there are reportedly very good forths for the 6809<p>- don&#x27;t do the development self-hosted. you can simulate a 6809 on a laptop or cellphone hundreds of times faster than real time, and the author is in fact doing that. if you have a big computer with either a  6809 simulator or a debugging umbilical to your 6809, you can run the test scripts on the big computer instead of the 6809, while running the code under test on the 6809, real or emulated. then you don&#x27;t have to write your tests in c or forth; you can write them in tcl, python, js, lua, squirrel, or whatever you prefer. they can control the 6809 like a marionette, and you can use property testing frameworks like hypothesis, which would be very ambitious to implement on the 6809<p>- maybe non-time-critical parts of your logic can be written in a language that can be compiled to either the 6809 or the big computer, such as c, so you can test it compiled natively on the big computer. cross-compiled to the 6809, this will generate bloated code that uses more memory, so it depends on how tight you are on space, though the 6809 isn&#x27;t quite as unfriendly to c as something like a 6502 or pdp-10<p>- the exception is that if you write the non-time-critical parts in an itc forth instead of c or something, it won&#x27;t use an unreasonable amount of memory, but it will be a lot slower and more bug prone<p>disclaimer, I haven&#x27;t programmed a 6809 since 01985, and then it was in basic, and my forth isn&#x27;t all that hot either</div><br/><div id="38455584" class="c"><input type="checkbox" id="c-38455584" checked=""/><div class="controls bullet"><span class="by">pimlottc</span><span>|</span><a href="#38455305">parent</a><span>|</span><label class="collapse" for="c-38455584">[-]</label><label class="expand" for="c-38455584">[2 more]</label></div><br/><div class="children"><div class="content">&gt; the term has been used to mean &#x27;tests for units&#x27; for about a century<p>I assume you’re being hyperbolic here, unless there’s some pre-modern history to the term I’m not aware of?</div><br/><div id="38455605" class="c"><input type="checkbox" id="c-38455605" checked=""/><div class="controls bullet"><span class="by">kragen</span><span>|</span><a href="#38455305">root</a><span>|</span><a href="#38455584">parent</a><span>|</span><label class="collapse" for="c-38455605">[-]</label><label class="expand" for="c-38455605">[1 more]</label></div><br/><div class="children"><div class="content">no, i am speaking quite precisely. 01923 is hardly medieval, and that&#x27;s when the term came into common use in engineering jargon, with pretty much its current meaning, plus or minus about ten years<p><a href="https:&#x2F;&#x2F;books.google.com&#x2F;ngrams&#x2F;graph?content=unit+tests&amp;year_start=1800&amp;year_end=2019&amp;corpus=en-2019&amp;smoothing=3" rel="nofollow noreferrer">https:&#x2F;&#x2F;books.google.com&#x2F;ngrams&#x2F;graph?content=unit+tests&amp;yea...</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>