<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729328451863" as="style"/><link rel="stylesheet" href="styles.css?v=1729328451863"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.ngs-lang.org/2024/10/06/teaching-old-assert-new-tricks/">Teaching old assert() new Tricks</a>Â <span class="domain">(<a href="https://blog.ngs-lang.org">blog.ngs-lang.org</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>8 comments</span></div><br/><div><div id="41886259" class="c"><input type="checkbox" id="c-41886259" checked=""/><div class="controls bullet"><span class="by">Rygian</span><span>|</span><a href="#41857135">next</a><span>|</span><label class="collapse" for="c-41886259">[-]</label><label class="expand" for="c-41886259">[2 more]</label></div><br/><div class="children"><div class="content">The other day I had a senior developer tell me that he uses assert to perform critical security checks (eg input validation logic, size of input less than size of buffer, ...) and therefore his code is secure.<p>I asked if the compiler preserved the asserts when not compiling in debug mode.</div><br/><div id="41886358" class="c"><input type="checkbox" id="c-41886358" checked=""/><div class="controls bullet"><span class="by">snovv_crash</span><span>|</span><a href="#41886259">parent</a><span>|</span><a href="#41857135">next</a><span>|</span><label class="collapse" for="c-41886358">[-]</label><label class="expand" for="c-41886358">[1 more]</label></div><br/><div class="children"><div class="content">Even if it did, DoS is still a valid security issue that can be exploited.</div><br/></div></div></div></div><div id="41857135" class="c"><input type="checkbox" id="c-41857135" checked=""/><div class="controls bullet"><span class="by">TheNewAndy</span><span>|</span><a href="#41886259">prev</a><span>|</span><label class="collapse" for="c-41857135">[-]</label><label class="expand" for="c-41857135">[5 more]</label></div><br/><div class="children"><div class="content">I used to like having nice strings to go with my asserts and would often do something like: assert(condition &amp;&amp; &quot;explanation of assert&quot;). Now I think that the whole point of an assert is that it is for errors that require a code change (i.e. it is not recoverable at runtime) and so the very first thing that will happen in the investigation will be looking at the code with the assert - so a comment will do just fine if things aren&#x27;t obvious. We also know that the programmer is going to need to understand the code that they are changing, and we also know that whoever wrote the code must have had a wrong assumption, so while their documentation is a good clue, it is also to be treated with some level of suspicion. As a result, I go for a simple assert, occasionally with a comment that explains why the assert should never fail.<p>Being able to use the value asserted is nice sugar though. I will take that :)</div><br/><div id="41885457" class="c"><input type="checkbox" id="c-41885457" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41857135">parent</a><span>|</span><a href="#41885016">next</a><span>|</span><label class="collapse" for="c-41885457">[-]</label><label class="expand" for="c-41885457">[2 more]</label></div><br/><div class="children"><div class="content">&gt; and so the very first thing that will happen in the investigation will be looking at the code with the assert<p>And the very next thing that will happen is me swearing up and down that I wished I captured more context at the point of error so I could understand the corner case much more easily.<p>assert,  on failure,  should dump as much function and stack context as it possibly can generate;  and possibly,  a string tag for _user_ convenience in reporting on and differentiating for themselves the specific error condition.<p>mainframes are great for this.  You get a custom tagged error message that conveys the subsystem, error level,  and error number along with a text error string.  This makes cataloging and classifying errors automatic for everyone who sees and conveys them.  Then you can use the system record store to go get the context information generated at the site of the error itself and build a much clearer idea of why the particular operation failed.</div><br/><div id="41886166" class="c"><input type="checkbox" id="c-41886166" checked=""/><div class="controls bullet"><span class="by">commandersaki</span><span>|</span><a href="#41857135">root</a><span>|</span><a href="#41885457">parent</a><span>|</span><a href="#41885016">next</a><span>|</span><label class="collapse" for="c-41886166">[-]</label><label class="expand" for="c-41886166">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m more with skeeto on this that asserts should make it easy to slip into a debugger to get that further context you&#x27;re looking for: <a href="https:&#x2F;&#x2F;nullprogram.com&#x2F;blog&#x2F;2022&#x2F;06&#x2F;26&#x2F;" rel="nofollow">https:&#x2F;&#x2F;nullprogram.com&#x2F;blog&#x2F;2022&#x2F;06&#x2F;26&#x2F;</a></div><br/></div></div></div></div><div id="41885016" class="c"><input type="checkbox" id="c-41885016" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#41857135">parent</a><span>|</span><a href="#41885457">prev</a><span>|</span><a href="#41885465">next</a><span>|</span><label class="collapse" for="c-41885016">[-]</label><label class="expand" for="c-41885016">[1 more]</label></div><br/><div class="children"><div class="content">One thing that severely hinders assertion strings is that people can&#x27;t seem to decide  whether the string should state the intended case or the failure case.<p>By contrast, being able to dump out the inputs to the failing expression is always useful. This is mostly discussed in the context of test-suite asserts, but should probably be generalized.</div><br/></div></div><div id="41885465" class="c"><input type="checkbox" id="c-41885465" checked=""/><div class="controls bullet"><span class="by">vueko</span><span>|</span><a href="#41857135">parent</a><span>|</span><a href="#41885016">prev</a><span>|</span><label class="collapse" for="c-41885465">[-]</label><label class="expand" for="c-41885465">[1 more]</label></div><br/><div class="children"><div class="content">One reason I like assert strings is that they can assist bug triage in a large organization, assuming that (as in my environment) the string is available outside of the core&#x2F;kernel dump, probably in the kernel ring buffer&#x2F;logs. Often, keying off of line number won&#x27;t work across different branches, maintenance releases, patches and the like, so having a unique-ish string to search known issues&#x2F;chat history&#x2F;etc with is valuable. Sure, you can check out the code corresponding to the build that produced the core and find the code context from there, but that&#x27;s another step that takes time, especially if you have to traverse a bunch of mappings like &quot;oh, the core&#x27;s from a machine on B_FOO_1337, which according to this one service corresponds to commit abcdef123, which is in repo baz, which I don&#x27;t actually have checked out and&#x2F;or fetched recently, oops.&quot; In an environment of this sort, it&#x27;s also frequently not super quick or straightforward to get a debugger set up with the appropriate symbols to open the core and see the context - if a person running through a big list of defects can simply plug the string into a search and go oh, yup, it&#x27;s known issue #12345 vs. having to hunt for the correct symbols, copy the (potentially several gb!) core around, get gdb to happily open it, etc, that eventually adds up to big time savings. Finally, compiler optimizations can make it so that, while a value is present in the core, the debugger can&#x27;t automatically find it and gives you that &lt;value optimized out&gt; thing. While you usually can go digging around in the registers to extract it, that&#x27;s a pain and yet more time. If you put the value(s) of the failed assertion in the string, that&#x27;s one less spot for someone doing triage to get hung up on when trying to tell whether an issue is something new or just frequency of a known issue.<p>For stuff I&#x27;m just writing by and for myself, yeah, I take your approach. For software that will generate failures I may not be the first person in an organization to have to look at, I add friendly strings.</div><br/></div></div></div></div></div></div></div></div></div></body></html>