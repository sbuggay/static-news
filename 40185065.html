<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714294855675" as="style"/><link rel="stylesheet" href="styles.css?v=1714294855675"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://alastairreid.github.io/riscv-spec-issues/">How to improve the RISC-V specification</a> <span class="domain">(<a href="https://alastairreid.github.io">alastairreid.github.io</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>21 comments</span></div><br/><div><div id="40186961" class="c"><input type="checkbox" id="c-40186961" checked=""/><div class="controls bullet"><span class="by">timhh</span><span>|</span><a href="#40185933">next</a><span>|</span><label class="collapse" for="c-40186961">[-]</label><label class="expand" for="c-40186961">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been doing a lot of work with Sail (not SAIL btw) and I&#x27;m not sure I agree with the points about it.<p>There&#x27;s already a way to extract functions into asciidoc as the author noted. I&#x27;ve used it. It works well.<p>The liquid types do take some getting used to but they aren&#x27;t actually used in most of the code; mostly for utility function definitions like `zero_extend`. If you look at the definition for simple instructions they can be very readable and practically pseudocode:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;riscv&#x2F;sail-riscv&#x2F;blob&#x2F;0aae5bc7f57df4ebeddd16d7dd981bde511e2879&#x2F;model&#x2F;riscv_insts_zba.sail#L18">https:&#x2F;&#x2F;github.com&#x2F;riscv&#x2F;sail-riscv&#x2F;blob&#x2F;0aae5bc7f57df4ebedd...</a><p>A lot of instructions are more complex or course but that&#x27;s what you get if you want to precisely define them.<p>Overall Sail is a really fantastic language and the liquid types really help avoid bugs.<p>The biggest <i>actual</i> problems are:<p>1. The RISC-V spec is chock full of undefined &#x2F; implementation defined behaviour. How do you capture that in code, where basically everything is defined. The biggest example is probably WARL fields which can do basically anything. Another example is decomposing misaligned accesses. You can decompose them into any number of atomic memory operations and do them in any order. E.g. Spike decomposes them into single byte accesses. (This problem isn&#x27;t really unique to Sail tbf).<p>2. The RISC-V Sail model doesn&#x27;t do a good job of letting you configure it currently. E.g. you can&#x27;t even set the spec version at the moment. This is just an engineering problem though. We&#x27;re hoping to fix it one day using riscv-config which is a YAML file that&#x27;s supposed to specify all the configurable behaviour about a RISC-V chip.<p>I definitely agree about the often wooly language in the spec though. It doesn&#x27;t even use RFC-style MUST&#x2F;SHOULD&#x2F;MAY terms.</div><br/></div></div><div id="40185933" class="c"><input type="checkbox" id="c-40185933" checked=""/><div class="controls bullet"><span class="by">acuster</span><span>|</span><a href="#40186961">prev</a><span>|</span><a href="#40186246">next</a><span>|</span><label class="collapse" for="c-40185933">[-]</label><label class="expand" for="c-40185933">[3 more]</label></div><br/><div class="children"><div class="content">You are quite right that the document that &#x27;specifies&#x27; RISC-V remains a key weakness in the whole movement.<p>For expediency, the choice was made to not sweat it. So the document is actually called a &#x27;Manual&#x27; but is linked as being the specification. Even so, the document needs a real editor to review it. For example, the preferred bit pattern which is to be processed by an implementation as doing nothing but incrementing the program counter (&#x27;no op&#x27;) is called an &#x27;instruction&#x27; in some sections but is clearly not in others---a dumb discrepency. A review by a good technical editor would be a great first step in improving the document.<p>However, the greater tragedy is that a great &#x27;specification&#x27; for RISC-V would be an invaluable educational document. This would be a <i>very</i> hard document to write. No document that I could find has ever tried to specify an instruction set independent of an actual implementation. So there is no roadmap towards writing a good spec for RISC-V. This is surely one of the reasons the effort has not yet been started.<p>After a couple of months trying to imagine how such an effort could be undertaken, how one could argue that the effort was worth trying, and how I might convince the community of the value and need for a good spec, I gave up. The work would require a team combining very fine technical knowledge with exeedingly accurate control of technical english. The work would be a multi-person-year effort, requiring concomitant funding. It is not clear to me how this work might begin.<p>Also you are entirely right to think about the test suite as a central concern. Specifications are strange documents. Some specifications make requirements which can not be tested; this affects the very nature of what is being &#x27;specified&#x27;. Others have tried to root every injunction in the test suite; that approach leads to its own difficulties. The specification will have to make its choice on the matter and the authors would benefit from being very clear with themselves about what stance they are taking on the matter.<p>So thanks for your argument for a better specification; it would be a wonderful addition to the open instruction set. Hopefully, somehow, such an effort finds its wings.</div><br/><div id="40186261" class="c"><input type="checkbox" id="c-40186261" checked=""/><div class="controls bullet"><span class="by">gchadwick</span><span>|</span><a href="#40185933">parent</a><span>|</span><a href="#40186246">next</a><span>|</span><label class="collapse" for="c-40186261">[-]</label><label class="expand" for="c-40186261">[2 more]</label></div><br/><div class="children"><div class="content">&gt; No document that I could find has ever tried to specify an instruction set independent of an actual implementation.<p>What do you mean by this? I&#x27;d say most ISA specifications do this (e.g. the Arm spec doesn&#x27;t refer to Arm&#x27;s CPU implementations and has well defined ways to discuss things that can be implementation dependent).</div><br/><div id="40186581" class="c"><input type="checkbox" id="c-40186581" checked=""/><div class="controls bullet"><span class="by">acuster</span><span>|</span><a href="#40185933">root</a><span>|</span><a href="#40186261">parent</a><span>|</span><a href="#40186246">next</a><span>|</span><label class="collapse" for="c-40186581">[-]</label><label class="expand" for="c-40186581">[1 more]</label></div><br/><div class="children"><div class="content">Sorry, it&#x27;s three in the (sunday) morning, and I&#x27;ve been hitting the whysky trying to handle the estabilshment journalists having fun, while other journalists are talking about humans struggling to get water while themselves being asked if they will survive the night. ---I&#x27;m not at my best.<p>You&#x27;re right to call me on my statement; I should have all my notes on hand to make that claim and I don&#x27;t. Paah, no, I do:
ARMv7-M Architeture Reference Manual ... 
Part A Application Level Architecture  ... 
...processor in Thread mode (vs. in Handler mode).<p>So ARM already has a <i>lot</i> of detail whereas the RISC-V architecture is trying to (has to?) start even more abstract, where code doesn&#x27;t even have modes (no interrupts).<p>This all started a pandemic saturday morning, cup of coffee in hand, enthusiasm to read the &quot;RISC-V Spec&quot; and see what I could learn. Download. Confusion: it says &quot;manual,&quot; did I get the right thing? ... Ok, yeah, that&#x27;s what&#x27;s on offer. Half an hour later, I&#x27;m actually pissed off, like actively <i>angry</i>. I&#x27;m reading this from the point of view of &quot;what&#x27;s the execution environment that I&#x27;ll be working against?&quot; and I&#x27;m getting hit with &quot;unprivileged&quot; which is just wrong. It turns out they are mixing up &quot;the environment of general purpose programmers&quot; with &quot;the minimal that needs to be implemented&quot;---it&#x27;s a royal mess, they kindda give up on it in the middle. I&#x27;m angry about being asked to read this as &quot;the product&quot;; it&#x27;s not even properly proof-edited. So I took my frustration and tried to figure out &#x27;what would you do to make this better?&#x27;<p>The &#x27;RISC-V&#x27; spec is trying to specify: [instructions], and what they do to the [architecture]. I don&#x27;t know much about the details, but I have a notion that there was push back on writing this up as a &#x27;state machine&#x27; and how each instruction might change that state. I assume Prof. Asanović had his own good reason to avoid framing things that way but he&#x27;s yet to give us a good explantion of why. So probably he&#x27;s right, I just don&#x27;t know why.<p>So how could this be done?<p>I went to look at the history. The original x86 spec was tied to the chip they were trying to sell. PowerPC, MIPS, if I remember right, were not &#x27;specified&#x27; in a clean way--none of them had the same challenge as RISC-V does, starting in pure execution environment mode. I went to read the infamous von Newmann writeup and got side-tracked by his virtural neurons but didn&#x27;t find the right level of abstraction there either.<p>So, I&#x27;m sorry I can&#x27;t really justify myself here, but this is all subtle and hard. From what I have found, I don&#x27;t think anyone has faced the challenge that RISC-V faces, so I don&#x27;t think we have a roadmap for the spec that RISC-V ought to have.<p>cheers</div><br/></div></div></div></div></div></div><div id="40186246" class="c"><input type="checkbox" id="c-40186246" checked=""/><div class="controls bullet"><span class="by">gchadwick</span><span>|</span><a href="#40185933">prev</a><span>|</span><a href="#40185965">next</a><span>|</span><label class="collapse" for="c-40186246">[-]</label><label class="expand" for="c-40186246">[2 more]</label></div><br/><div class="children"><div class="content">Another issue I take with the RISC-V spec is it relies on a common understanding of technical terms without actually defining them precisely anywhere.<p>To take one example it never defines what an interrupt is and more broadly never defines terminology around exceptions. Contrast to the arm ISA which precisely describes what it means by asynchronous Vs synchronous, precise Vs imprecise etc (see section D3-1 in <a href="https:&#x2F;&#x2F;developer.arm.com&#x2F;documentation&#x2F;ddi0487&#x2F;latest&#x2F;" rel="nofollow">https:&#x2F;&#x2F;developer.arm.com&#x2F;documentation&#x2F;ddi0487&#x2F;latest&#x2F;</a>).<p>The original authors may see this as a virtue, the small size of the RISC-V ISA manuals Vs Arm was portrayed as a great benefit but in part that size is because it&#x27;s missing lots of stuff like this that I view as highly important for a specification.</div><br/><div id="40186981" class="c"><input type="checkbox" id="c-40186981" checked=""/><div class="controls bullet"><span class="by">timhh</span><span>|</span><a href="#40186246">parent</a><span>|</span><a href="#40185965">next</a><span>|</span><label class="collapse" for="c-40186981">[-]</label><label class="expand" for="c-40186981">[1 more]</label></div><br/><div class="children"><div class="content">Yeah I completely agree. Especially annoying if RISC-V is the first ISA you&#x27;ve learnt which is probably the case for a lot of people.<p>I don&#x27;t think you meant D3-1 btw.</div><br/></div></div></div></div><div id="40185965" class="c"><input type="checkbox" id="c-40185965" checked=""/><div class="controls bullet"><span class="by">sweetjuly</span><span>|</span><a href="#40186246">prev</a><span>|</span><a href="#40186858">next</a><span>|</span><label class="collapse" for="c-40185965">[-]</label><label class="expand" for="c-40185965">[1 more]</label></div><br/><div class="children"><div class="content">This is one of the things I think is most sorely missing from RISC-V. ARM provides executable (but perfectly legible) pseudocode for every instruction. You don&#x27;t have to rely on natural language to understand what an instruction does, which is really important when dealing with very complex ISA features which have many different (and sometimes contradictory) extensions. SAIL sort of fulfills this purpose if you squint but it doesn&#x27;t feel like a specification like ARM pseudocode so much as a theorem proving language which happens to be the reference for the ISA.</div><br/></div></div><div id="40186858" class="c"><input type="checkbox" id="c-40186858" checked=""/><div class="controls bullet"><span class="by">zyedidia</span><span>|</span><a href="#40185965">prev</a><span>|</span><a href="#40185863">next</a><span>|</span><label class="collapse" for="c-40186858">[-]</label><label class="expand" for="c-40186858">[2 more]</label></div><br/><div class="children"><div class="content">I am excitedly awaiting the full release of ASL1 from Arm. I wonder if anyone with more knowledge might be able to comment on how it compares with Sail and&#x2F;or when we might expect to see a full Arm specification in ASL1 (as opposed to the current spec which is normal ASL and appears to be incompatible with the upcoming version). Perhaps in the future there might also be a RISC-V specification written in ASL1.</div><br/><div id="40186964" class="c"><input type="checkbox" id="c-40186964" checked=""/><div class="controls bullet"><span class="by">Peter_Sewell</span><span>|</span><a href="#40186858">parent</a><span>|</span><a href="#40185863">next</a><span>|</span><label class="collapse" for="c-40186964">[-]</label><label class="expand" for="c-40186964">[1 more]</label></div><br/><div class="children"><div class="content">Sail is pretty similar to ASL (both current ASL and ASL 1.0) except that (1) it has a more expressive type system, so that bitvector lengths can all be statically checked, (2) it has proper tagged unions and pattern matching, and (3) there&#x27;s a wide range of open-source tooling available, for execution, specification coverage, generating emulators, integrating with relaxed concurrency models, generating theorem-prover definitions, etc.  We&#x27;ve recently updated the Sail README, which spells some of this out: <a href="https:&#x2F;&#x2F;github.com&#x2F;rems-project&#x2F;sail">https:&#x2F;&#x2F;github.com&#x2F;rems-project&#x2F;sail</a> .<p>As Alastair Reid says, one of the main things missing in the current RISC-V specification documents is simply that the associated Sail definitions are not yet interspersed with the prose instruction descriptions. The infrastructure to do that has been available for some time, in the Sail AsciiDoc support by Alasdair Armstrong (<a href="https:&#x2F;&#x2F;github.com&#x2F;Alasdair&#x2F;asciidoctor-sail&#x2F;blob&#x2F;master&#x2F;doc&#x2F;built&#x2F;sail_to_asciidoc.pdf">https:&#x2F;&#x2F;github.com&#x2F;Alasdair&#x2F;asciidoctor-sail&#x2F;blob&#x2F;master&#x2F;doc...</a>) and older LaTeX versions by Prashanth Mundkur and Alasdair (<a href="https:&#x2F;&#x2F;github.com&#x2F;rems-project&#x2F;riscv-isa-manual&#x2F;blob&#x2F;sail&#x2F;release&#x2F;riscv-spec-sail-draft.pdf">https:&#x2F;&#x2F;github.com&#x2F;rems-project&#x2F;riscv-isa-manual&#x2F;blob&#x2F;sail&#x2F;r...</a>).</div><br/></div></div></div></div><div id="40185863" class="c"><input type="checkbox" id="c-40185863" checked=""/><div class="controls bullet"><span class="by">photonbucket</span><span>|</span><a href="#40186858">prev</a><span>|</span><a href="#40186260">next</a><span>|</span><label class="collapse" for="c-40185863">[-]</label><label class="expand" for="c-40185863">[2 more]</label></div><br/><div class="children"><div class="content">I once thought it would be nice to write a toy riscv isa simulator, but was also surprised and discouraged by the natural language spec</div><br/><div id="40186180" class="c"><input type="checkbox" id="c-40186180" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#40185863">parent</a><span>|</span><a href="#40186260">next</a><span>|</span><label class="collapse" for="c-40186180">[-]</label><label class="expand" for="c-40186180">[1 more]</label></div><br/><div class="children"><div class="content">If you only want to simulate the core instruction, and perhaps the Multiply extension or so, and only plan to support single threaded operation, then the natural language spec ain&#x27;t so bad.</div><br/></div></div></div></div><div id="40186260" class="c"><input type="checkbox" id="c-40186260" checked=""/><div class="controls bullet"><span class="by">fwsgonzo</span><span>|</span><a href="#40185863">prev</a><span>|</span><a href="#40186085">next</a><span>|</span><label class="collapse" for="c-40186260">[-]</label><label class="expand" for="c-40186260">[2 more]</label></div><br/><div class="children"><div class="content">I honestly think the very readable specification has been a boon for RISC-V and possibly part of the reason why people continue to find it easy to pick up. If you are unsure about something in the spec, there&#x27;s also a multitude of RISC-V emulators out there, probably several in your favorite language already.</div><br/><div id="40186303" class="c"><input type="checkbox" id="c-40186303" checked=""/><div class="controls bullet"><span class="by">gchadwick</span><span>|</span><a href="#40186260">parent</a><span>|</span><a href="#40186085">next</a><span>|</span><label class="collapse" for="c-40186303">[-]</label><label class="expand" for="c-40186303">[1 more]</label></div><br/><div class="children"><div class="content">This is a good point though I&#x27;d argue that the spec isn&#x27;t all that readable for some important things.<p>For example the description of exception handling is sprinkled between the CSR definitions of the CSRs involved. There&#x27;s no section that just lays out the exception model.</div><br/></div></div></div></div><div id="40186085" class="c"><input type="checkbox" id="c-40186085" checked=""/><div class="controls bullet"><span class="by">Reason077</span><span>|</span><a href="#40186260">prev</a><span>|</span><a href="#40185887">next</a><span>|</span><label class="collapse" for="c-40186085">[-]</label><label class="expand" for="c-40186085">[1 more]</label></div><br/><div class="children"><div class="content">Perhaps it&#x27;s time for a RISC-VI specification!</div><br/></div></div><div id="40185887" class="c"><input type="checkbox" id="c-40185887" checked=""/><div class="controls bullet"><span class="by">IAmLiterallyAB</span><span>|</span><a href="#40186085">prev</a><span>|</span><a href="#40185891">next</a><span>|</span><label class="collapse" for="c-40185887">[-]</label><label class="expand" for="c-40185887">[1 more]</label></div><br/><div class="children"><div class="content">SAIL reminds me of SLEIGH, the language Ghidra uses to describe ISA semantics. Cool stuff</div><br/></div></div><div id="40185891" class="c"><input type="checkbox" id="c-40185891" checked=""/><div class="controls bullet"><span class="by">drycabinet</span><span>|</span><a href="#40185887">prev</a><span>|</span><label class="collapse" for="c-40185891">[-]</label><label class="expand" for="c-40185891">[5 more]</label></div><br/><div class="children"><div class="content">Is RISC-V technically superior or is it just about the license?</div><br/><div id="40185971" class="c"><input type="checkbox" id="c-40185971" checked=""/><div class="controls bullet"><span class="by">__s</span><span>|</span><a href="#40185891">parent</a><span>|</span><a href="#40186197">next</a><span>|</span><label class="collapse" for="c-40185971">[-]</label><label class="expand" for="c-40185971">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s simpler than x86&#x2F;arm, while having a couple improvements compared to minimal alternatives like MIPS based on hindsight &amp; modern chips<p>See chapter 2: <a href="https:&#x2F;&#x2F;www2.eecs.berkeley.edu&#x2F;Pubs&#x2F;TechRpts&#x2F;2016&#x2F;EECS-2016-1.pdf" rel="nofollow">https:&#x2F;&#x2F;www2.eecs.berkeley.edu&#x2F;Pubs&#x2F;TechRpts&#x2F;2016&#x2F;EECS-2016-...</a></div><br/></div></div><div id="40186197" class="c"><input type="checkbox" id="c-40186197" checked=""/><div class="controls bullet"><span class="by">gchadwick</span><span>|</span><a href="#40185891">parent</a><span>|</span><a href="#40185971">prev</a><span>|</span><a href="#40186490">next</a><span>|</span><label class="collapse" for="c-40186197">[-]</label><label class="expand" for="c-40186197">[2 more]</label></div><br/><div class="children"><div class="content">ISAs are complex things so you can&#x27;t say one is technically superior to the other.<p>I would say you&#x27;re right though in that RISCV enjoys the success it&#x27;s seeing due to the open specification and licensing model. People generally aren&#x27;t drawn to RISCV because of technical innovation.</div><br/><div id="40186673" class="c"><input type="checkbox" id="c-40186673" checked=""/><div class="controls bullet"><span class="by">brucehoult</span><span>|</span><a href="#40185891">root</a><span>|</span><a href="#40186197">parent</a><span>|</span><a href="#40186490">next</a><span>|</span><label class="collapse" for="c-40186673">[-]</label><label class="expand" for="c-40186673">[1 more]</label></div><br/><div class="children"><div class="content">The base specification (IMAFDC) has little to no innovation, simply avoiding the mistakes of the past. We&#x27;ve got 60 years of experience with RISC-style instruction sets, so that&#x27;s about consolidation not innovation.<p>However RISC-V is an excellent base upon which to innovate. You can see that in things such as the Vector extension, the memory model developed by industry and academic experts world-wide, and CHERI fine-grained memory-protection.</div><br/></div></div></div></div><div id="40186490" class="c"><input type="checkbox" id="c-40186490" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#40185891">parent</a><span>|</span><a href="#40186197">prev</a><span>|</span><label class="collapse" for="c-40186490">[-]</label><label class="expand" for="c-40186490">[1 more]</label></div><br/><div class="children"><div class="content">Superior in what way? Is English superior to French? I think you can have equally good implementations of modern CPUs regardless of the ISA. The end result is trillions of logical gates that working together will store, add, subtract, multiply at a rate of several millions per second. Logical gates don&#x27;t care what language you speak to them as long as they understand.</div><br/></div></div></div></div></div></div></div></div></div></body></html>