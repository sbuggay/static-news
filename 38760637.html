<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1703494858722" as="style"/><link rel="stylesheet" href="styles.css?v=1703494858722"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://valentin.willscher.de/posts/sql-api/">SQL as API</a> <span class="domain">(<a href="https://valentin.willscher.de">valentin.willscher.de</a>)</span></div><div class="subtext"><span>valenterry</span> | <span>16 comments</span></div><br/><div><div id="38760812" class="c"><input type="checkbox" id="c-38760812" checked=""/><div class="controls bullet"><span class="by">xd</span><span>|</span><a href="#38760833">next</a><span>|</span><label class="collapse" for="c-38760812">[-]</label><label class="expand" for="c-38760812">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve a similar way of interacting with the API of my product but instead keep everything prefix notation (lispy) so for example;<p>&quot;and&quot;: [
{
 &quot;property&quot;: &quot;material&quot;,
 &quot;operator&quot;: &quot;equals&quot;,
 &quot;value&quot;: &quot;carbon&quot;
},<p>Would be;<p>[&quot;and&quot;, [&quot;=&quot;, &quot;material&quot;, &quot;carbon&quot;], ...]</div><br/></div></div><div id="38760833" class="c"><input type="checkbox" id="c-38760833" checked=""/><div class="controls bullet"><span class="by">Kwpolska</span><span>|</span><a href="#38760812">prev</a><span>|</span><a href="#38760782">next</a><span>|</span><label class="collapse" for="c-38760833">[-]</label><label class="expand" for="c-38760833">[1 more]</label></div><br/><div class="children"><div class="content">This is asking users to generate SQL code client-side, parses the SQL server-side to make sure it&#x27;s safe, and then generates new SQL for some reason. This seems needlessly complex, requiring more logic on the client side, and putting a lot of trust in the server-side validator. The examples also use non-parametrised SQL, which means the client needs to know how to correctly escape values, and the database might fail to optimise queries. I see no benefits and many disadvantages compared to a simple JSON structure, even if it&#x27;s custom: it&#x27;s trivial to generate and parse, it can be used with an ORM, and the server will probably use parametrised SQL, because that&#x27;s easier than the alternative.</div><br/></div></div><div id="38760782" class="c"><input type="checkbox" id="c-38760782" checked=""/><div class="controls bullet"><span class="by">a-saleh</span><span>|</span><a href="#38760833">prev</a><span>|</span><a href="#38760942">next</a><span>|</span><label class="collapse" for="c-38760782">[-]</label><label class="expand" for="c-38760782">[1 more]</label></div><br/><div class="children"><div class="content">I half expected this to promote Postgrest or one of it&#x27;s alternatives and was surprised it didn&#x27;t do that by the end of the post.<p>I used it for this exact usecase, we had some data in postgress and front-end had limited api, and readonly postgrest was simpler than adding the api I needed to the frontend.</div><br/></div></div><div id="38760942" class="c"><input type="checkbox" id="c-38760942" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#38760782">prev</a><span>|</span><a href="#38760847">next</a><span>|</span><label class="collapse" for="c-38760942">[-]</label><label class="expand" for="c-38760942">[1 more]</label></div><br/><div class="children"><div class="content">Doing this correctly basically reinvents half of Postgrest.<p>So just use postgrest.</div><br/></div></div><div id="38760847" class="c"><input type="checkbox" id="c-38760847" checked=""/><div class="controls bullet"><span class="by">samwillis</span><span>|</span><a href="#38760942">prev</a><span>|</span><a href="#38760927">next</a><span>|</span><label class="collapse" for="c-38760847">[-]</label><label class="expand" for="c-38760847">[1 more]</label></div><br/><div class="children"><div class="content">With SQLite in the browser via WASM, and the sync technology that&#x27;s available for that (ElectricSQL (I work on this), CR-SQLite, Sqlsync), webapps are increasingly using SQL in the UI layer to a local DB. It&#x27;s only one step further to then have a multi-modal app that uses SQL to query the server database for non-synced data.<p>I&#x27;m expecting raw SQL to replace the API for a whole class of apps.<p>Throw in an event sourcing architecture for server side processing and you have a single SQL based API for all operations.</div><br/></div></div><div id="38760927" class="c"><input type="checkbox" id="c-38760927" checked=""/><div class="controls bullet"><span class="by">reliablereason</span><span>|</span><a href="#38760847">prev</a><span>|</span><a href="#38760795">next</a><span>|</span><label class="collapse" for="c-38760927">[-]</label><label class="expand" for="c-38760927">[1 more]</label></div><br/><div class="children"><div class="content">Sanitize...<p>Just create a sql user with the correct access rights. Don&#x27;t reinvent the wheel.</div><br/></div></div><div id="38760795" class="c"><input type="checkbox" id="c-38760795" checked=""/><div class="controls bullet"><span class="by">p4bl0</span><span>|</span><a href="#38760927">prev</a><span>|</span><a href="#38760796">next</a><span>|</span><label class="collapse" for="c-38760795">[-]</label><label class="expand" for="c-38760795">[2 more]</label></div><br/><div class="children"><div class="content">In the end, this is really just about using a well-known syntax to express queries: since you end up parsing it, validating it, and building the actual query anyway, the fact that the query is initially written in SQL or anything else doesn&#x27;t really matter, except that developers know SQL already (which is a good point).</div><br/><div id="38760884" class="c"><input type="checkbox" id="c-38760884" checked=""/><div class="controls bullet"><span class="by">valenterry</span><span>|</span><a href="#38760795">parent</a><span>|</span><a href="#38760796">next</a><span>|</span><label class="collapse" for="c-38760884">[-]</label><label class="expand" for="c-38760884">[1 more]</label></div><br/><div class="children"><div class="content">Yes, but it&#x27;s a little bit more: SQL is a fully fledged language that covers an enormous range of potential tasks and the syntax works mostly seemlessly to enable that.<p>This means, extending the API by allowing more and more parts of SQL is easy and still backwards compatible.<p>It&#x27;s much harder to come up with a custom language &#x2F; structure from the get-go that doesn&#x27;t case backwards-compatibility issues down the road. I guess I should have emphasized this point in the article a bit more, thank you for the comment.</div><br/></div></div></div></div><div id="38760796" class="c"><input type="checkbox" id="c-38760796" checked=""/><div class="controls bullet"><span class="by">Nevin1901</span><span>|</span><a href="#38760795">prev</a><span>|</span><a href="#38760861">next</a><span>|</span><label class="collapse" for="c-38760796">[-]</label><label class="expand" for="c-38760796">[1 more]</label></div><br/><div class="children"><div class="content">I implemented something like this for a log platform I was working on. The user would write queries in Apache lucene, and they would be converted into json, and then a specific sql query.<p>It worked nice, but apart from querying logs, I don’t see a use case where one would do this rather than just creating api endpoints.</div><br/></div></div><div id="38760861" class="c"><input type="checkbox" id="c-38760861" checked=""/><div class="controls bullet"><span class="by">dventimi</span><span>|</span><a href="#38760796">prev</a><span>|</span><a href="#38760849">next</a><span>|</span><label class="collapse" for="c-38760861">[-]</label><label class="expand" for="c-38760861">[1 more]</label></div><br/><div class="children"><div class="content">&gt; We surely don&#x27;t want to have the webshop-frontend send database queries to the backend to get the results.<p>We don&#x27;t? Why not?</div><br/></div></div><div id="38760849" class="c"><input type="checkbox" id="c-38760849" checked=""/><div class="controls bullet"><span class="by">dventimi</span><span>|</span><a href="#38760861">prev</a><span>|</span><a href="#38760809">next</a><span>|</span><label class="collapse" for="c-38760849">[-]</label><label class="expand" for="c-38760849">[1 more]</label></div><br/><div class="children"><div class="content">&gt; using SQL has been despised by people for the longest time, probably for good reasons at the time.<p>Don&#x27;t be too quick to assign rationality where its absence will do. If SQL has been despised it&#x27;s quite possible the reasons have never been any good.</div><br/></div></div><div id="38760809" class="c"><input type="checkbox" id="c-38760809" checked=""/><div class="controls bullet"><span class="by">mg</span><span>|</span><a href="#38760849">prev</a><span>|</span><a href="#38760901">next</a><span>|</span><label class="collapse" for="c-38760809">[-]</label><label class="expand" for="c-38760809">[2 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    But faster than you can imagine, the next requirement comes in: OR filters!

    bicycles that are (made of steel AND weigh from 10 to 20kg) OR
    (made of carbon AND weigh from 5 to 10kg)
</code></pre>
Hmm.. I don&#x27;t know if this is a good example. I have been in the product search space for almost 10 years now and that feature request never came up. And I cataloged thousands of feature requests users had about product search interfaces.<p>In the rare case users do something like this, they usually use two tabs. One, where they compare steel bikes and one where they compare carbon bikes.<p>It makes sense, when you think about the frontend implications. Users are very used to checkboxes and range sliders. The user would check &quot;steel&quot; and set the range slider to &quot;10-20&quot;. Now how do they expect to duplicate the sliders and the checkboxes to construct the alternative configuration? They open the page in a new tab and use the alternative settings in that tab.</div><br/><div id="38760896" class="c"><input type="checkbox" id="c-38760896" checked=""/><div class="controls bullet"><span class="by">valenterry</span><span>|</span><a href="#38760809">parent</a><span>|</span><a href="#38760901">next</a><span>|</span><label class="collapse" for="c-38760896">[-]</label><label class="expand" for="c-38760896">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, maybe the example isn&#x27;t that great, I admit so much. :-)<p>However, it&#x27;s not only about the users as in the visitors of the shop. It can also be a feature such as &quot;show similar bicycles&quot; that will require more complicated queries. And while it&#x27;s of course possible to maybe run multiple queries and combine the results by code, it can be nice to just do it in one query that is easy to understand and debug&#x2F;optimize because it&#x27;s pretty much just SQL.</div><br/></div></div></div></div><div id="38760901" class="c"><input type="checkbox" id="c-38760901" checked=""/><div class="controls bullet"><span class="by">coolgoose</span><span>|</span><a href="#38760809">prev</a><span>|</span><a href="#38760964">next</a><span>|</span><label class="collapse" for="c-38760901">[-]</label><label class="expand" for="c-38760901">[1 more]</label></div><br/><div class="children"><div class="content">Or use graphql? :)</div><br/></div></div></div></div></div></div></div></body></html>