<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1688461260284" as="style"/><link rel="stylesheet" href="styles.css?v=1688461260284"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://labs.hakaioffsec.com/nginx-alias-traversal/">Leaking Bitwarden&#x27;s Vault with a Nginx vulnerability</a> <span class="domain">(<a href="https://labs.hakaioffsec.com">labs.hakaioffsec.com</a>)</span></div><div class="subtext"><span>celesian</span> | <span>114 comments</span></div><br/><div><div id="36581049" class="c"><input type="checkbox" id="c-36581049" checked=""/><div class="controls bullet"><span class="by">evgpbfhnr</span><span>|</span><a href="#36580719">next</a><span>|</span><label class="collapse" for="c-36581049">[-]</label><label class="expand" for="c-36581049">[10 more]</label></div><br/><div class="children"><div class="content">FWIW gixy (nginx configuration checker) catches this:
<a href="https:&#x2F;&#x2F;github.com&#x2F;yandex&#x2F;gixy&#x2F;blob&#x2F;master&#x2F;docs&#x2F;en&#x2F;plugins&#x2F;aliastraversal.md">https:&#x2F;&#x2F;github.com&#x2F;yandex&#x2F;gixy&#x2F;blob&#x2F;master&#x2F;docs&#x2F;en&#x2F;plugins&#x2F;a...</a><p>(and nixos automatically runs gixy on a configuration generated through it, so the system refuses to build &lt;3)</div><br/><div id="36583865" class="c"><input type="checkbox" id="c-36583865" checked=""/><div class="controls bullet"><span class="by">tsak</span><span>|</span><a href="#36581049">parent</a><span>|</span><a href="#36581196">next</a><span>|</span><label class="collapse" for="c-36583865">[-]</label><label class="expand" for="c-36583865">[1 more]</label></div><br/><div class="children"><div class="content">Thank you. I didn&#x27;t know about gixy and ran it on my home server which found a vulnerability ($uri in a 301 redirect)</div><br/></div></div><div id="36581196" class="c"><input type="checkbox" id="c-36581196" checked=""/><div class="controls bullet"><span class="by">wredue</span><span>|</span><a href="#36581049">parent</a><span>|</span><a href="#36583865">prev</a><span>|</span><a href="#36583242">next</a><span>|</span><label class="collapse" for="c-36581196">[-]</label><label class="expand" for="c-36581196">[6 more]</label></div><br/><div class="children"><div class="content">I just gave nix a go and so far it seems great.<p>But do you know, if they’re a nicer options finder? The one I found where you just search all several thousand options kinda sucks. I want to just see my package (say, ssh) and just the ssh options, but the results get littered with irrelevancy.</div><br/><div id="36581290" class="c"><input type="checkbox" id="c-36581290" checked=""/><div class="controls bullet"><span class="by">evgpbfhnr</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36581196">parent</a><span>|</span><a href="#36582331">next</a><span>|</span><label class="collapse" for="c-36581290">[-]</label><label class="expand" for="c-36581290">[1 more]</label></div><br/><div class="children"><div class="content">When I roughly know what I&#x27;m doing I use search.nixos.org; if you give it the full services.foo prefix it&#x27;s usually relevant enough, e.g. for ssh you&#x27;d want &quot;services.openssh&quot;, which you can find skimming through the results of just searching &#x27;ssh&#x27; first:<p><a href="https:&#x2F;&#x2F;search.nixos.org&#x2F;options?channel=unstable&amp;from=0&amp;size=50&amp;sort=relevance&amp;type=packages&amp;query=services.openssh" rel="nofollow noreferrer">https:&#x2F;&#x2F;search.nixos.org&#x2F;options?channel=unstable&amp;from=0&amp;siz...</a><p>For anything I&#x27;m not 100% sure will be obvious I search through a local clone of the nixpkgs repo directly, but I&#x27;ll be honest and say I just never took time to search for a better tool</div><br/></div></div><div id="36582331" class="c"><input type="checkbox" id="c-36582331" checked=""/><div class="controls bullet"><span class="by">licebmi__at__</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36581196">parent</a><span>|</span><a href="#36581290">prev</a><span>|</span><a href="#36581302">next</a><span>|</span><label class="collapse" for="c-36582331">[-]</label><label class="expand" for="c-36582331">[2 more]</label></div><br/><div class="children"><div class="content">I would suggest using man and searching like any piece of documentation. Specifically you are looking for `man configuration.nix`</div><br/><div id="36583482" class="c"><input type="checkbox" id="c-36583482" checked=""/><div class="controls bullet"><span class="by">SuperSandro2000</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36582331">parent</a><span>|</span><a href="#36581302">next</a><span>|</span><label class="collapse" for="c-36583482">[-]</label><label class="expand" for="c-36583482">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s actually worse search experience and slower because less is struggling with the amount of lines.</div><br/></div></div></div></div><div id="36581302" class="c"><input type="checkbox" id="c-36581302" checked=""/><div class="controls bullet"><span class="by">JasonSage</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36581196">parent</a><span>|</span><a href="#36582331">prev</a><span>|</span><a href="#36582152">next</a><span>|</span><label class="collapse" for="c-36581302">[-]</label><label class="expand" for="c-36581302">[1 more]</label></div><br/><div class="children"><div class="content">My main usage of Nix is on non-NixOS machines, and I use Home Manager, and while it has a similar problem, just searching the options in the packages it provides configuration for is a smaller issue.<p>Not sure if this helps you at all or not, it really depends on your usage of Nix, but for managing user configuration I do recommend Home Manager.</div><br/></div></div><div id="36582152" class="c"><input type="checkbox" id="c-36582152" checked=""/><div class="controls bullet"><span class="by">smoldesu</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36581196">parent</a><span>|</span><a href="#36581302">prev</a><span>|</span><a href="#36583242">next</a><span>|</span><label class="collapse" for="c-36582152">[-]</label><label class="expand" for="c-36582152">[1 more]</label></div><br/><div class="children"><div class="content">&gt; if they’re a nicer options finder?<p><a href="https:&#x2F;&#x2F;mynixos.com&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;mynixos.com&#x2F;</a><p>&gt; I want to just see my package (say, ssh) and just the ssh options<p><a href="https:&#x2F;&#x2F;mynixos.com&#x2F;nixpkgs&#x2F;options&#x2F;programs.ssh" rel="nofollow noreferrer">https:&#x2F;&#x2F;mynixos.com&#x2F;nixpkgs&#x2F;options&#x2F;programs.ssh</a></div><br/></div></div></div></div><div id="36583242" class="c"><input type="checkbox" id="c-36583242" checked=""/><div class="controls bullet"><span class="by">GlitchMr</span><span>|</span><a href="#36581049">parent</a><span>|</span><a href="#36581196">prev</a><span>|</span><a href="#36580719">next</a><span>|</span><label class="collapse" for="c-36583242">[-]</label><label class="expand" for="c-36583242">[2 more]</label></div><br/><div class="children"><div class="content">NixOS doesn&#x27;t run Gixy anymore, see <a href="https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;nixpkgs&#x2F;pull&#x2F;209075">https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;nixpkgs&#x2F;pull&#x2F;209075</a>.</div><br/><div id="36583476" class="c"><input type="checkbox" id="c-36583476" checked=""/><div class="controls bullet"><span class="by">SuperSandro2000</span><span>|</span><a href="#36581049">root</a><span>|</span><a href="#36583242">parent</a><span>|</span><a href="#36580719">next</a><span>|</span><label class="collapse" for="c-36583476">[-]</label><label class="expand" for="c-36583476">[1 more]</label></div><br/><div class="children"><div class="content">NixOS core maintainer here.
That&#x27;s about nginx&#x27; own test. Gixy is still run when writing any nginx config file with the writer helper function <a href="https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;nixpkgs&#x2F;blob&#x2F;b6cc06826812247fe54655e0d5e49dcde253a72f&#x2F;pkgs&#x2F;build-support&#x2F;writers&#x2F;default.nix#L230">https:&#x2F;&#x2F;github.com&#x2F;NixOS&#x2F;nixpkgs&#x2F;blob&#x2F;b6cc06826812247fe54655...</a></div><br/></div></div></div></div></div></div><div id="36580719" class="c"><input type="checkbox" id="c-36580719" checked=""/><div class="controls bullet"><span class="by">542458</span><span>|</span><a href="#36581049">prev</a><span>|</span><a href="#36581504">next</a><span>|</span><label class="collapse" for="c-36580719">[-]</label><label class="expand" for="c-36580719">[9 more]</label></div><br/><div class="children"><div class="content">At risk of asking a dumb question, is there any good reason that you’d <i>want</i> nginx to allow traversing into “..” from a URL path? It just seems like problems waiting to happen.<p>Edit: Actually, I’m a bit lost as to what’s happening in the original vuln. <a href="http:&#x2F;&#x2F;localhost&#x2F;foo..&#x2F;secretfile.txt" rel="nofollow noreferrer">http:&#x2F;&#x2F;localhost&#x2F;foo..&#x2F;secretfile.txt</a> gets interpreted as &#x2F;var&#x2F;www&#x2F;foo&#x2F;..&#x2F;secretfile.txt or whatever… but why wouldn’t a server without the vulnerability interpret <a href="http:&#x2F;&#x2F;localhost&#x2F;foo&#x2F;..&#x2F;secretfile.txt" rel="nofollow noreferrer">http:&#x2F;&#x2F;localhost&#x2F;foo&#x2F;..&#x2F;secretfile.txt</a> the same way? Why does “..” in paths only work <i>sometimes</i>?</div><br/><div id="36584002" class="c"><input type="checkbox" id="c-36584002" checked=""/><div class="controls bullet"><span class="by">pravus</span><span>|</span><a href="#36580719">parent</a><span>|</span><a href="#36580826">next</a><span>|</span><label class="collapse" for="c-36584002">[-]</label><label class="expand" for="c-36584002">[1 more]</label></div><br/><div class="children"><div class="content">The problem is that a URL isn&#x27;t actually a path.  It&#x27;s an abstract address to a resource which can be a directory or file (or an executable or stream or ...).<p>In this case part of the URL is being interpreted by nginx as a directory (<a href="http:&#x2F;&#x2F;localhost&#x2F;foo" rel="nofollow noreferrer">http:&#x2F;&#x2F;localhost&#x2F;foo</a>) due to how that URL is mapped in the configuration to the local filesystem.  Apparently it references a directory, so when nginx constructs the full path to the requested resource, it ends up with &quot;${mapped_path}&#x2F;..&#x2F;secretfile.txt&quot; which would be valid on the local filesystem even if it doesn&#x27;t make sense in the URL.  Notice how the location of the slashes doesn&#x27;t matter because URLs don&#x27;t actually have path elements (even if we pretend they do), they are just strings.<p>This is a very common problem that I have noticed with web servers in general since the web took off.  Mapping URLs directly to file paths was popular because it started with simple file servers with indexes.  That rapidly turned into a mixed environment where URLs became application identifiers instead of paths since apps can be targeted by part of the path and the rest is considered parameters or arguments.<p>And no, it generally doesn&#x27;t usually make sense to honor &#x27;.&#x27; or &#x27;..&#x27; in URLs for filesystem objects and my apps sanitize the requested path to ensure a correct mapping.  It&#x27;s also good to be aware that browsers do treat URLs as path-like when building relative links so you have to be careful with how and when you use trailing &#x27;&#x2F;&#x27;s because it can target different resources which have different semantics on the server side.</div><br/></div></div><div id="36580826" class="c"><input type="checkbox" id="c-36580826" checked=""/><div class="controls bullet"><span class="by">lyu07282</span><span>|</span><a href="#36580719">parent</a><span>|</span><a href="#36584002">prev</a><span>|</span><a href="#36580746">next</a><span>|</span><label class="collapse" for="c-36580826">[-]</label><label class="expand" for="c-36580826">[3 more]</label></div><br/><div class="children"><div class="content">That has been a known issue in nginx for a very long time and its a common attack vector at CTFs:<p><a href="https:&#x2F;&#x2F;book.hacktricks.xyz&#x2F;network-services-pentesting&#x2F;pentesting-web&#x2F;nginx" rel="nofollow noreferrer">https:&#x2F;&#x2F;book.hacktricks.xyz&#x2F;network-services-pentesting&#x2F;pent...</a></div><br/><div id="36583520" class="c"><input type="checkbox" id="c-36583520" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#36580719">root</a><span>|</span><a href="#36580826">parent</a><span>|</span><a href="#36580746">next</a><span>|</span><label class="collapse" for="c-36583520">[-]</label><label class="expand" for="c-36583520">[2 more]</label></div><br/><div class="children"><div class="content"><i>There is a LFI vulnerability because:</i><p><pre><code>    &#x2F;imgs..&#x2F;flag.txt
</code></pre>
<i>Transforms to:</i><p><pre><code>    &#x2F;path&#x2F;images&#x2F;..&#x2F;flag.txt
</code></pre>
I&#x27;ve only implemented a handful of HTTP servers for fun, but I&#x27;ve always resolved relative paths and constrained them. So I&#x27;d turn &quot;&#x2F;path&#x2F;images&#x2F;..&#x2F;flag.txt&quot; into &quot;&#x2F;path&#x2F;flag.txt&quot;, which would not start with the root &quot;&#x2F;path&#x2F;images&#x2F;&quot; and hence denied without further checks.<p>Am I wrong, or, why doesn&#x27;t nginx do this?</div><br/><div id="36583978" class="c"><input type="checkbox" id="c-36583978" checked=""/><div class="controls bullet"><span class="by">hanikesn</span><span>|</span><a href="#36580719">root</a><span>|</span><a href="#36583520">parent</a><span>|</span><a href="#36580746">next</a><span>|</span><label class="collapse" for="c-36583978">[-]</label><label class="expand" for="c-36583978">[1 more]</label></div><br/><div class="children"><div class="content">It does when you use the root directive. Alias should hardly be used if possible for those reasons.</div><br/></div></div></div></div></div></div><div id="36580746" class="c"><input type="checkbox" id="c-36580746" checked=""/><div class="controls bullet"><span class="by">SahAssar</span><span>|</span><a href="#36580719">parent</a><span>|</span><a href="#36580826">prev</a><span>|</span><a href="#36580765">next</a><span>|</span><label class="collapse" for="c-36580746">[-]</label><label class="expand" for="c-36580746">[1 more]</label></div><br/><div class="children"><div class="content">Not in any &quot;normal&quot; use-case, no. It&#x27;d make sense to make this behavior opt-in, like having a `allow_parent_traversal on;` flag in the location.</div><br/></div></div><div id="36580765" class="c"><input type="checkbox" id="c-36580765" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#36580719">parent</a><span>|</span><a href="#36580746">prev</a><span>|</span><a href="#36582002">next</a><span>|</span><label class="collapse" for="c-36580765">[-]</label><label class="expand" for="c-36580765">[1 more]</label></div><br/><div class="children"><div class="content">Just guessing, but NginX probably either checks for &quot;&#x2F;foo&#x2F;bar&#x2F;..&quot; and disallows it, or normalizes it to &quot;&#x2F;foo&#x2F;&quot; but &quot;&#x2F;foo&#x2F;bar..&quot; is a perfectly valid file name, so it doesn&#x27;t get caught by the net checking for this.</div><br/></div></div><div id="36582002" class="c"><input type="checkbox" id="c-36582002" checked=""/><div class="controls bullet"><span class="by">dumpsterdiver</span><span>|</span><a href="#36580719">parent</a><span>|</span><a href="#36580765">prev</a><span>|</span><a href="#36581504">next</a><span>|</span><label class="collapse" for="c-36582002">[-]</label><label class="expand" for="c-36582002">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Why does “..” in paths only work sometimes?<p>That fully depends upon the file permissions. In this case, let&#x27;s assume that a user has permissions to read files all the way from the web index directory (..&#x2F;index.html) back to the root directory (&#x2F;). At that point, since they have permission to traverse down to the root directory, they now have permission to view any world viewable file that can be traversed to from the root directory, for instance &#x2F;etc&#x2F;passwd.<p>In other words, imagine a fork with three prongs, and your web server resides on the far right prong. Imagine that the part of the fork where the prongs meet (the &quot;palm&quot; of the fork) is the file system. If your web server residing on the far right prong of that fork allows file permission to files and directories that lead all the way to the palm of the fork, at that point you could continue accessing files on other prongs once you have reached the palm.</div><br/><div id="36582093" class="c"><input type="checkbox" id="c-36582093" checked=""/><div class="controls bullet"><span class="by">komali2</span><span>|</span><a href="#36580719">root</a><span>|</span><a href="#36582002">parent</a><span>|</span><a href="#36581504">next</a><span>|</span><label class="collapse" for="c-36582093">[-]</label><label class="expand" for="c-36582093">[1 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t setting correct permissions for www-data like, the first note in a bunch of &quot;secure your web server&quot; tutorials? I thought if read is only set for the directory with actual public files, and not for the parent directory, there should be no traversal possible like this?</div><br/></div></div></div></div></div></div><div id="36581504" class="c"><input type="checkbox" id="c-36581504" checked=""/><div class="controls bullet"><span class="by">technion</span><span>|</span><a href="#36580719">prev</a><span>|</span><a href="#36580840">next</a><span>|</span><label class="collapse" for="c-36581504">[-]</label><label class="expand" for="c-36581504">[7 more]</label></div><br/><div class="children"><div class="content">OK hear me out: a Linux capability like option that removes the .. option from the kernels file name parser.<p>Like web apps have been seen various bypasses involving somehow smuggling two dots somewhere since we were on dial up modems. It&#x27;s time to look for a way to close this once and for all, as the Linux kernel has done with several other classes of user land bugs.</div><br/><div id="36581565" class="c"><input type="checkbox" id="c-36581565" checked=""/><div class="controls bullet"><span class="by">loeg</span><span>|</span><a href="#36581504">parent</a><span>|</span><a href="#36583714">next</a><span>|</span><label class="collapse" for="c-36581565">[-]</label><label class="expand" for="c-36581565">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;openat2.2.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;openat2.2.html</a> RESOLVE_BENEATH<p>(FreeBSD has this in ordinary openat(2) as O_RESOLVE_BENEATH.)</div><br/></div></div><div id="36583714" class="c"><input type="checkbox" id="c-36583714" checked=""/><div class="controls bullet"><span class="by">junon</span><span>|</span><a href="#36581504">parent</a><span>|</span><a href="#36581565">prev</a><span>|</span><a href="#36582239">next</a><span>|</span><label class="collapse" for="c-36583714">[-]</label><label class="expand" for="c-36583714">[1 more]</label></div><br/><div class="children"><div class="content">That makes no difference. Code often normalizes paths before they ever touch the filesystem API</div><br/></div></div><div id="36582239" class="c"><input type="checkbox" id="c-36582239" checked=""/><div class="controls bullet"><span class="by">m00x</span><span>|</span><a href="#36581504">parent</a><span>|</span><a href="#36583714">prev</a><span>|</span><a href="#36583194">next</a><span>|</span><label class="collapse" for="c-36582239">[-]</label><label class="expand" for="c-36582239">[3 more]</label></div><br/><div class="children"><div class="content">That would break so many things that it would be insane to do.<p>You could just run nginx as a separate user with very limited rights, or just run it on Docker. This, plus updating regularly usually fixes 90% of security issues.</div><br/><div id="36583467" class="c"><input type="checkbox" id="c-36583467" checked=""/><div class="controls bullet"><span class="by">archi42</span><span>|</span><a href="#36581504">root</a><span>|</span><a href="#36582239">parent</a><span>|</span><a href="#36582363">next</a><span>|</span><label class="collapse" for="c-36583467">[-]</label><label class="expand" for="c-36583467">[1 more]</label></div><br/><div class="children"><div class="content">Most (I hope all) distributions already run nginx as a separate user. It&#x27;s best practice.<p>But that won&#x27;t help if you alias to &quot;&#x2F;foo&#x2F;bar&#x2F;www&quot; and the the application has a SQLite database at &quot;&#x2F;foo&#x2F;bar&#x2F;db.db&quot;, which the nginx user has to have access to. Same if you run it in a container (or lock down permissions using systemd).</div><br/></div></div><div id="36582363" class="c"><input type="checkbox" id="c-36582363" checked=""/><div class="controls bullet"><span class="by">martinflack</span><span>|</span><a href="#36581504">root</a><span>|</span><a href="#36582239">parent</a><span>|</span><a href="#36583467">prev</a><span>|</span><a href="#36583194">next</a><span>|</span><label class="collapse" for="c-36582363">[-]</label><label class="expand" for="c-36582363">[1 more]</label></div><br/><div class="children"><div class="content">But the issue is -- would it break the things a web server is doing? It doesn&#x27;t have to be a universal solution.</div><br/></div></div></div></div><div id="36583194" class="c"><input type="checkbox" id="c-36583194" checked=""/><div class="controls bullet"><span class="by">ikekkdcjkfke</span><span>|</span><a href="#36581504">parent</a><span>|</span><a href="#36582239">prev</a><span>|</span><a href="#36580840">next</a><span>|</span><label class="collapse" for="c-36583194">[-]</label><label class="expand" for="c-36583194">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s something else in the kernel, there we have the permission system which we rely on.<p>If you are serving files to web from the folder, the web framework should handle not taversing the public root folder it was tasked to serve. If are rolling your own, well now you have to consider all kinds of stuff, including this.</div><br/></div></div></div></div><div id="36580840" class="c"><input type="checkbox" id="c-36580840" checked=""/><div class="controls bullet"><span class="by">amluto</span><span>|</span><a href="#36581504">prev</a><span>|</span><a href="#36580671">next</a><span>|</span><label class="collapse" for="c-36580840">[-]</label><label class="expand" for="c-36580840">[21 more]</label></div><br/><div class="children"><div class="content">How is this not seen as a vulnerability in nginx?  This behavior is utterly absurd, seems to have no beneficial purpose, and straightforwardly exploitable.</div><br/><div id="36581362" class="c"><input type="checkbox" id="c-36581362" checked=""/><div class="controls bullet"><span class="by">phendrenad2</span><span>|</span><a href="#36580840">parent</a><span>|</span><a href="#36581153">next</a><span>|</span><label class="collapse" for="c-36581362">[-]</label><label class="expand" for="c-36581362">[7 more]</label></div><br/><div class="children"><div class="content">It&#x27;s done for speed. Straightforward text replacement is so much faster than checking to see if a path is properly terminated by a slash. And remember that Nginx <i>became popular</i> due to benchmarks that showed that it was more &quot;web scale&quot; than Apache2.</div><br/><div id="36581698" class="c"><input type="checkbox" id="c-36581698" checked=""/><div class="controls bullet"><span class="by">amluto</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36581362">parent</a><span>|</span><a href="#36582972">next</a><span>|</span><label class="collapse" for="c-36581698">[-]</label><label class="expand" for="c-36581698">[4 more]</label></div><br/><div class="children"><div class="content">I find it hard to believe that searching for “..” would even show up in a benchmark.<p>In any case, it seems that nginx <i>does</i> try to search for .. but has a bug in the corner case where the “location” doesn’t end with a slash. I assume there’s some kind of URL normalization pass that happens before the routing pass, and if the route matches part of a path component, nothing catches the ..<p>If I’m right, this is just an IMO rather embarrassing bug and should he fixed.</div><br/><div id="36581754" class="c"><input type="checkbox" id="c-36581754" checked=""/><div class="controls bullet"><span class="by">D13Fd</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36581698">parent</a><span>|</span><a href="#36582972">next</a><span>|</span><label class="collapse" for="c-36581754">[-]</label><label class="expand" for="c-36581754">[3 more]</label></div><br/><div class="children"><div class="content">Yeah, this whole thing reads to me like a bug in nginx. There is no obvious reason users would need that functionality.</div><br/><div id="36582139" class="c"><input type="checkbox" id="c-36582139" checked=""/><div class="controls bullet"><span class="by">m3affan</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36581754">parent</a><span>|</span><a href="#36582972">next</a><span>|</span><label class="collapse" for="c-36582139">[-]</label><label class="expand" for="c-36582139">[2 more]</label></div><br/><div class="children"><div class="content">What are the alternarives though?</div><br/><div id="36582444" class="c"><input type="checkbox" id="c-36582444" checked=""/><div class="controls bullet"><span class="by">seanw444</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36582139">parent</a><span>|</span><a href="#36582972">next</a><span>|</span><label class="collapse" for="c-36582444">[-]</label><label class="expand" for="c-36582444">[1 more]</label></div><br/><div class="children"><div class="content">To Nginx? HAProxy. Or Caddy if you&#x27;re just doing web stuff.</div><br/></div></div></div></div></div></div></div></div><div id="36582972" class="c"><input type="checkbox" id="c-36582972" checked=""/><div class="controls bullet"><span class="by">sofixa</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36581362">parent</a><span>|</span><a href="#36581698">prev</a><span>|</span><a href="#36581153">next</a><span>|</span><label class="collapse" for="c-36582972">[-]</label><label class="expand" for="c-36582972">[2 more]</label></div><br/><div class="children"><div class="content">&gt; And remember that Nginx became popular due to benchmarks that showed that it was more &quot;web scale&quot; than Apache2.<p>More like because it was much faster out of the box, and came with many batteries included while Apache2 required mods to be separately install.</div><br/><div id="36583916" class="c"><input type="checkbox" id="c-36583916" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#36580840">root</a><span>|</span><a href="#36582972">parent</a><span>|</span><a href="#36581153">next</a><span>|</span><label class="collapse" for="c-36583916">[-]</label><label class="expand" for="c-36583916">[1 more]</label></div><br/><div class="children"><div class="content">And the config was nicer to read and write.</div><br/></div></div></div></div></div></div></div></div><div id="36580671" class="c"><input type="checkbox" id="c-36580671" checked=""/><div class="controls bullet"><span class="by">Decabytes</span><span>|</span><a href="#36580840">prev</a><span>|</span><a href="#36580909">next</a><span>|</span><label class="collapse" for="c-36580671">[-]</label><label class="expand" for="c-36580671">[1 more]</label></div><br/><div class="children"><div class="content">Glad that the leaks are still encrypted. Even companies that specialize in this sort of stuff are not immune to leaks, so this is honestly the best case scenario.</div><br/></div></div><div id="36580909" class="c"><input type="checkbox" id="c-36580909" checked=""/><div class="controls bullet"><span class="by">whiskeymikey</span><span>|</span><a href="#36580671">prev</a><span>|</span><a href="#36580747">next</a><span>|</span><label class="collapse" for="c-36580909">[-]</label><label class="expand" for="c-36580909">[4 more]</label></div><br/><div class="children"><div class="content">This is probably a dumb question but why would Bitwarden allow unauthenticated requests to &#x2F;attachments at all? Even with the Nginx bug, wouldn’t the request have failed if that URL required authentication?</div><br/><div id="36581417" class="c"><input type="checkbox" id="c-36581417" checked=""/><div class="controls bullet"><span class="by">Someone1234</span><span>|</span><a href="#36580909">parent</a><span>|</span><a href="#36580747">next</a><span>|</span><label class="collapse" for="c-36581417">[-]</label><label class="expand" for="c-36581417">[3 more]</label></div><br/><div class="children"><div class="content">This is an exploit against the web server&#x27;s configuration, so never executes Bitwarden&#x27;s authentication code or any Bitwarden code at all. It isn&#x27;t unusual or incorrect for projects to use their own authentication rather than Nginx or a module.<p>It is still Bitwarden&#x27;s responsibility since they shipped a dangerous configuration via Docker. Which they seemingly acknowledge and have since fixed.</div><br/><div id="36582403" class="c"><input type="checkbox" id="c-36582403" checked=""/><div class="controls bullet"><span class="by">autoexec</span><span>|</span><a href="#36580909">root</a><span>|</span><a href="#36581417">parent</a><span>|</span><a href="#36581454">next</a><span>|</span><label class="collapse" for="c-36582403">[-]</label><label class="expand" for="c-36582403">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It is still Bitwarden&#x27;s responsibility since they shipped a dangerous configuration via Docker. Which they seemingly acknowledge and have since fixed.<p>The screenshot makes it look like the docker setup option was still in beta and the page had warnings all over it saying there could be possible issues. I can&#x27;t really judge Bitwarden too harshly here for releasing something in beta that was later found to have a vulnerability in it.</div><br/></div></div><div id="36581454" class="c"><input type="checkbox" id="c-36581454" checked=""/><div class="controls bullet"><span class="by">whiskeymikey</span><span>|</span><a href="#36580909">root</a><span>|</span><a href="#36581417">parent</a><span>|</span><a href="#36582403">prev</a><span>|</span><a href="#36580747">next</a><span>|</span><label class="collapse" for="c-36581454">[-]</label><label class="expand" for="c-36581454">[1 more]</label></div><br/><div class="children"><div class="content">Ahh okay. That explanation makes sense. Thanks!</div><br/></div></div></div></div></div></div><div id="36580747" class="c"><input type="checkbox" id="c-36580747" checked=""/><div class="controls bullet"><span class="by">kibwen</span><span>|</span><a href="#36580909">prev</a><span>|</span><a href="#36582608">next</a><span>|</span><label class="collapse" for="c-36580747">[-]</label><label class="expand" for="c-36580747">[19 more]</label></div><br/><div class="children"><div class="content">If all you need is a simple way to serve static files that minimizes resource consumption and is reliably secure, what is the state of the art these days? In the past I would probably reach for Nginx, but I wonder if a more focused&#x2F;less configurable tool would be preferable from a security standpoint.</div><br/><div id="36580764" class="c"><input type="checkbox" id="c-36580764" checked=""/><div class="controls bullet"><span class="by">francislavoie</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36582010">next</a><span>|</span><label class="collapse" for="c-36580764">[-]</label><label class="expand" for="c-36580764">[6 more]</label></div><br/><div class="children"><div class="content">Shameless plug: Caddy does a great job here. Automatic HTTPS, written in Go so memory safety bugs are not a concern, has a solid file_server module.</div><br/><div id="36581487" class="c"><input type="checkbox" id="c-36581487" checked=""/><div class="controls bullet"><span class="by">princevegeta89</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36580764">parent</a><span>|</span><a href="#36583161">next</a><span>|</span><label class="collapse" for="c-36581487">[-]</label><label class="expand" for="c-36581487">[1 more]</label></div><br/><div class="children"><div class="content">+1 to Caddy. Just tried it recently and I was very happy to forget all the nginx jargon the next moment.</div><br/></div></div><div id="36583161" class="c"><input type="checkbox" id="c-36583161" checked=""/><div class="controls bullet"><span class="by">alexalx666</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36580764">parent</a><span>|</span><a href="#36581487">prev</a><span>|</span><a href="#36581211">next</a><span>|</span><label class="collapse" for="c-36583161">[-]</label><label class="expand" for="c-36583161">[1 more]</label></div><br/><div class="children"><div class="content">Im using caddy, it&#x27;s great!</div><br/></div></div><div id="36581211" class="c"><input type="checkbox" id="c-36581211" checked=""/><div class="controls bullet"><span class="by">username135</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36580764">parent</a><span>|</span><a href="#36583161">prev</a><span>|</span><a href="#36582010">next</a><span>|</span><label class="collapse" for="c-36581211">[-]</label><label class="expand" for="c-36581211">[3 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t everything forced to https now</div><br/><div id="36581292" class="c"><input type="checkbox" id="c-36581292" checked=""/><div class="controls bullet"><span class="by">ehnto</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581211">parent</a><span>|</span><a href="#36581271">next</a><span>|</span><label class="collapse" for="c-36581292">[-]</label><label class="expand" for="c-36581292">[1 more]</label></div><br/><div class="children"><div class="content">Browsers try to navigate you to HTTPS but no, http the protocol is still working as it always has. Both nginx and Apache will require configuration to serve HTTPS.<p>You might still use HTTP on an internal network in a DMZ or other trusted network.</div><br/></div></div><div id="36581271" class="c"><input type="checkbox" id="c-36581271" checked=""/><div class="controls bullet"><span class="by">housemusicfan</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581211">parent</a><span>|</span><a href="#36581292">prev</a><span>|</span><a href="#36582010">next</a><span>|</span><label class="collapse" for="c-36581271">[-]</label><label class="expand" for="c-36581271">[1 more]</label></div><br/><div class="children"><div class="content">No.<p>Some things were never meant to be, like downloading CRLs over HTTPS.</div><br/></div></div></div></div></div></div><div id="36582010" class="c"><input type="checkbox" id="c-36582010" checked=""/><div class="controls bullet"><span class="by">pepa65</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36580764">prev</a><span>|</span><a href="#36582210">next</a><span>|</span><label class="collapse" for="c-36582010">[-]</label><label class="expand" for="c-36582010">[1 more]</label></div><br/><div class="children"><div class="content">I have used Caddy for years, automatic SSL certificates, does file serving, does reverse proxy, very easy and clear to configure. Single-binary (Go) so easy to &quot;install&quot;, single configfile.</div><br/></div></div><div id="36582210" class="c"><input type="checkbox" id="c-36582210" checked=""/><div class="controls bullet"><span class="by">cyrnel</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36582010">prev</a><span>|</span><a href="#36581786">next</a><span>|</span><label class="collapse" for="c-36582210">[-]</label><label class="expand" for="c-36582210">[1 more]</label></div><br/><div class="children"><div class="content">I use <a href="https:&#x2F;&#x2F;static-web-server.net&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;static-web-server.net&#x2F;</a><p>Cross-platform, written in Rust, straightforward configuration, secure defaults, also has a hardened container image and a hardened NixOS module.<p>I wouldn&#x27;t recommend Caddy. Their official docker image runs as root by default [1], and they don&#x27;t provide a properly sandboxed systemd unit file [2].<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;caddy-docker&#x2F;issues&#x2F;104">https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;caddy-docker&#x2F;issues&#x2F;104</a><p>[2]: <a href="https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;dist&#x2F;blob&#x2F;master&#x2F;init&#x2F;caddy.service">https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;dist&#x2F;blob&#x2F;master&#x2F;init&#x2F;caddy.s...</a><p>EDITED: phrasing</div><br/></div></div><div id="36581786" class="c"><input type="checkbox" id="c-36581786" checked=""/><div class="controls bullet"><span class="by">dylan604</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36582210">prev</a><span>|</span><a href="#36580762">next</a><span>|</span><label class="collapse" for="c-36581786">[-]</label><label class="expand" for="c-36581786">[4 more]</label></div><br/><div class="children"><div class="content">how is a static site served from S3 considered in these parts of the interweb? i&#x27;ve never done this, but see it as an option, yet i never really hear others using it either.</div><br/><div id="36582998" class="c"><input type="checkbox" id="c-36582998" checked=""/><div class="controls bullet"><span class="by">sofixa</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581786">parent</a><span>|</span><a href="#36583054">next</a><span>|</span><label class="collapse" for="c-36582998">[-]</label><label class="expand" for="c-36582998">[1 more]</label></div><br/><div class="children"><div class="content">In my view, it&#x27;s perfect (okay, maybe slightly less than perfect, and dedicated platforms taking ot to the next level like Netlify, CloudFlare Pages, Firebase Hosting, etc are for their added related services and tools, as well as their generous free tiers). It&#x27;s pay as you go, scales from zero to infinite, and has zero attack surface or maintenance.<p>I&#x27;ve run a couple of websites (WordPress or Hugo based, including my personal blog) like that and it&#x27;s great.</div><br/></div></div><div id="36583054" class="c"><input type="checkbox" id="c-36583054" checked=""/><div class="controls bullet"><span class="by">crote</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581786">parent</a><span>|</span><a href="#36582998">prev</a><span>|</span><a href="#36582127">next</a><span>|</span><label class="collapse" for="c-36583054">[-]</label><label class="expand" for="c-36583054">[1 more]</label></div><br/><div class="children"><div class="content">You probably want some kind of CDN to avoid a HN frontpage link from making you go bankrupt, but it&#x27;s a pretty decent solution.<p>I personally prefer something like Github Pages, though - it doesn&#x27;t get much more hands-off than that!</div><br/></div></div><div id="36582127" class="c"><input type="checkbox" id="c-36582127" checked=""/><div class="controls bullet"><span class="by">chrisweekly</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581786">parent</a><span>|</span><a href="#36583054">prev</a><span>|</span><a href="#36580762">next</a><span>|</span><label class="collapse" for="c-36582127">[-]</label><label class="expand" for="c-36582127">[1 more]</label></div><br/><div class="children"><div class="content">Good Q. Using S3 as origin behind Cloudfront seems like a pretty standard AWS CDN setup for static assets... but S3 isn&#x27;t a traditional web server.</div><br/></div></div></div></div><div id="36580762" class="c"><input type="checkbox" id="c-36580762" checked=""/><div class="controls bullet"><span class="by">adventured</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36581786">prev</a><span>|</span><a href="#36581133">next</a><span>|</span><label class="collapse" for="c-36580762">[-]</label><label class="expand" for="c-36580762">[1 more]</label></div><br/><div class="children"><div class="content">Caddy is pretty simple to configure and serve static files from.</div><br/></div></div><div id="36581133" class="c"><input type="checkbox" id="c-36581133" checked=""/><div class="controls bullet"><span class="by">housemusicfan</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36580762">prev</a><span>|</span><a href="#36582004">next</a><span>|</span><label class="collapse" for="c-36581133">[-]</label><label class="expand" for="c-36581133">[4 more]</label></div><br/><div class="children"><div class="content">Merecat<p><a href="https:&#x2F;&#x2F;github.com&#x2F;troglobit&#x2F;merecat&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;troglobit&#x2F;merecat&#x2F;</a></div><br/><div id="36582027" class="c"><input type="checkbox" id="c-36582027" checked=""/><div class="controls bullet"><span class="by">pepa65</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36581133">parent</a><span>|</span><a href="#36582004">next</a><span>|</span><label class="collapse" for="c-36582027">[-]</label><label class="expand" for="c-36582027">[3 more]</label></div><br/><div class="children"><div class="content">Last release 2016??</div><br/><div id="36582124" class="c"><input type="checkbox" id="c-36582124" checked=""/><div class="controls bullet"><span class="by">housemusicfan</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36582027">parent</a><span>|</span><a href="#36582004">next</a><span>|</span><label class="collapse" for="c-36582124">[-]</label><label class="expand" for="c-36582124">[2 more]</label></div><br/><div class="children"><div class="content">OP wanted a simple web server for serving static content. Are you aware of open CVEs? No? It&#x27;s possible for software to be done you know. Just because something isn&#x27;t a rolling release of change for the sake of change (like most Google crapware) doesn&#x27;t mean it isn&#x27;t fit for purpose.</div><br/><div id="36583090" class="c"><input type="checkbox" id="c-36583090" checked=""/><div class="controls bullet"><span class="by">crote</span><span>|</span><a href="#36580747">root</a><span>|</span><a href="#36582124">parent</a><span>|</span><a href="#36582004">next</a><span>|</span><label class="collapse" for="c-36583090">[-]</label><label class="expand" for="c-36583090">[1 more]</label></div><br/><div class="children"><div class="content">Considering the vast majority of commit were made <i>after</i> 2016, I don&#x27;t think it is &quot;done&quot;.<p>And a C program, written by a single developer, with only 27 issues <i>ever</i> being filed? With all due respect, that&#x27;s <i>guaranteed</i> to have some nasty bugs in there.</div><br/></div></div></div></div></div></div></div></div><div id="36582004" class="c"><input type="checkbox" id="c-36582004" checked=""/><div class="controls bullet"><span class="by">calvinmorrison</span><span>|</span><a href="#36580747">parent</a><span>|</span><a href="#36581133">prev</a><span>|</span><a href="#36582608">next</a><span>|</span><label class="collapse" for="c-36582004">[-]</label><label class="expand" for="c-36582004">[1 more]</label></div><br/><div class="children"><div class="content">werc, shttpd,  etc.<p>Treat any web request like you would a real user on a Linux system you&#x27;d need to give access to to download files via scp. Chroot, strict permissions, etc. Can&#x27;t escape what you can&#x27;t escape. A ..&#x2F; should return the same as expected in the shell,  permission denied</div><br/></div></div></div></div><div id="36582608" class="c"><input type="checkbox" id="c-36582608" checked=""/><div class="controls bullet"><span class="by">gostsamo</span><span>|</span><a href="#36580747">prev</a><span>|</span><a href="#36581331">next</a><span>|</span><label class="collapse" for="c-36582608">[-]</label><label class="expand" for="c-36582608">[1 more]</label></div><br/><div class="children"><div class="content">The title is significantly editorialized. The post title is:<p>Hunting for Nginx Alias Traversals in the wild<p>and the hn submission highlights the bitwarden vulnerability while there is a google one discussed as well.</div><br/></div></div><div id="36581331" class="c"><input type="checkbox" id="c-36581331" checked=""/><div class="controls bullet"><span class="by">phendrenad2</span><span>|</span><a href="#36582608">prev</a><span>|</span><a href="#36581008">next</a><span>|</span><label class="collapse" for="c-36581331">[-]</label><label class="expand" for="c-36581331">[3 more]</label></div><br/><div class="children"><div class="content">This has nothing to do with bitwarden. This is a generic directory traversal attack (enabled by Nginx&#x27;s configuration language being full of serious gotchas).</div><br/><div id="36581513" class="c"><input type="checkbox" id="c-36581513" checked=""/><div class="controls bullet"><span class="by">ComputerGuru</span><span>|</span><a href="#36581331">parent</a><span>|</span><a href="#36581008">next</a><span>|</span><label class="collapse" for="c-36581513">[-]</label><label class="expand" for="c-36581513">[2 more]</label></div><br/><div class="children"><div class="content">It does have to do with BitWarden: they wrote and shipped the buggy config.</div><br/><div id="36582409" class="c"><input type="checkbox" id="c-36582409" checked=""/><div class="controls bullet"><span class="by">autoexec</span><span>|</span><a href="#36581331">root</a><span>|</span><a href="#36581513">parent</a><span>|</span><a href="#36581008">next</a><span>|</span><label class="collapse" for="c-36582409">[-]</label><label class="expand" for="c-36582409">[1 more]</label></div><br/><div class="children"><div class="content">It looks like they did say it was still beta and warned there could be issues though. I&#x27;ll give them credit for that much.</div><br/></div></div></div></div></div></div><div id="36581008" class="c"><input type="checkbox" id="c-36581008" checked=""/><div class="controls bullet"><span class="by">brigandish</span><span>|</span><a href="#36581331">prev</a><span>|</span><a href="#36581020">next</a><span>|</span><label class="collapse" for="c-36581008">[-]</label><label class="expand" for="c-36581008">[4 more]</label></div><br/><div class="children"><div class="content">The article didn&#x27;t mention permissions, would this still work if the nginx user is denied permissions on things like `&#x2F;var&#x2F;log`? I <i>suspect</i> it wouldn&#x27;t but isn&#x27;t the most common cause of security flaws going to be unchecked assumptions?<p>As an aside, I didn&#x27;t know Github code search accepted regex.</div><br/><div id="36581404" class="c"><input type="checkbox" id="c-36581404" checked=""/><div class="controls bullet"><span class="by">VWWHFSfQ</span><span>|</span><a href="#36581008">parent</a><span>|</span><a href="#36581020">next</a><span>|</span><label class="collapse" for="c-36581404">[-]</label><label class="expand" for="c-36581404">[3 more]</label></div><br/><div class="children"><div class="content">no it wouldn&#x27;t work if the user nginx is running as didn&#x27;t have read access to the directory or files</div><br/><div id="36582111" class="c"><input type="checkbox" id="c-36582111" checked=""/><div class="controls bullet"><span class="by">komali2</span><span>|</span><a href="#36581008">root</a><span>|</span><a href="#36581404">parent</a><span>|</span><a href="#36581020">next</a><span>|</span><label class="collapse" for="c-36582111">[-]</label><label class="expand" for="c-36582111">[2 more]</label></div><br/><div class="children"><div class="content">Ah then I just realized, it probably does have access to all nginx log directories, because nginx needs write permissions to them anyway, right? Now I really want to go double check all my permission setups...</div><br/><div id="36583127" class="c"><input type="checkbox" id="c-36583127" checked=""/><div class="controls bullet"><span class="by">crote</span><span>|</span><a href="#36581008">root</a><span>|</span><a href="#36582111">parent</a><span>|</span><a href="#36581020">next</a><span>|</span><label class="collapse" for="c-36583127">[-]</label><label class="expand" for="c-36583127">[1 more]</label></div><br/><div class="children"><div class="content">It depends on how nginx is designed. <i>In theory</i> you could separate log writing into a different process, and drop those permissions from the worker process.<p>Or just write to stdout and have systemd handle the logging for you, that&#x27;d work too.</div><br/></div></div></div></div></div></div></div></div><div id="36581020" class="c"><input type="checkbox" id="c-36581020" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#36581008">prev</a><span>|</span><a href="#36582425">next</a><span>|</span><label class="collapse" for="c-36581020">[-]</label><label class="expand" for="c-36581020">[3 more]</label></div><br/><div class="children"><div class="content">I dropped nginx because it was really fiddly to configure and misconfiguration has potentially bad consequences.</div><br/><div id="36581790" class="c"><input type="checkbox" id="c-36581790" checked=""/><div class="controls bullet"><span class="by">dylan604</span><span>|</span><a href="#36581020">parent</a><span>|</span><a href="#36582425">next</a><span>|</span><label class="collapse" for="c-36581790">[-]</label><label class="expand" for="c-36581790">[2 more]</label></div><br/><div class="children"><div class="content">what webserver did you not just describe?</div><br/><div id="36582032" class="c"><input type="checkbox" id="c-36582032" checked=""/><div class="controls bullet"><span class="by">pepa65</span><span>|</span><a href="#36581020">root</a><span>|</span><a href="#36581790">parent</a><span>|</span><a href="#36582425">next</a><span>|</span><label class="collapse" for="c-36582032">[-]</label><label class="expand" for="c-36582032">[1 more]</label></div><br/><div class="children"><div class="content">Caddy?</div><br/></div></div></div></div></div></div><div id="36582425" class="c"><input type="checkbox" id="c-36582425" checked=""/><div class="controls bullet"><span class="by">jand</span><span>|</span><a href="#36581020">prev</a><span>|</span><a href="#36581113">next</a><span>|</span><label class="collapse" for="c-36582425">[-]</label><label class="expand" for="c-36582425">[10 more]</label></div><br/><div class="children"><div class="content">Please excuse the silly question: Would proper directory and file ownerships not prevent this traversal?<p>If nginx does not run as root, how can it read other files than the ones explicitly assigned to the nginx user?</div><br/><div id="36583241" class="c"><input type="checkbox" id="c-36583241" checked=""/><div class="controls bullet"><span class="by">PhilipRoman</span><span>|</span><a href="#36582425">parent</a><span>|</span><a href="#36582590">next</a><span>|</span><label class="collapse" for="c-36583241">[-]</label><label class="expand" for="c-36583241">[1 more]</label></div><br/><div class="children"><div class="content">Ah the wonders of 022 umask. Personally I would always recommend making files unreadable to other users. If not for all files then at least significant directories like everything under &#x2F;home, etc.<p>It may require more fiddling with group memberships, but it&#x27;s well worth it.</div><br/></div></div><div id="36582590" class="c"><input type="checkbox" id="c-36582590" checked=""/><div class="controls bullet"><span class="by">oefrha</span><span>|</span><a href="#36582425">parent</a><span>|</span><a href="#36583241">prev</a><span>|</span><a href="#36582512">next</a><span>|</span><label class="collapse" for="c-36582590">[-]</label><label class="expand" for="c-36582590">[2 more]</label></div><br/><div class="children"><div class="content">Typical umask is 022 so most things are readable by nginx workers but not writable, they don’t need to be explicitly assigned (e.g. to www-data). If your application generates sensitive data of course you should probably use a 077 umask.</div><br/><div id="36582947" class="c"><input type="checkbox" id="c-36582947" checked=""/><div class="controls bullet"><span class="by">Jolter</span><span>|</span><a href="#36582425">root</a><span>|</span><a href="#36582590">parent</a><span>|</span><a href="#36582512">next</a><span>|</span><label class="collapse" for="c-36582947">[-]</label><label class="expand" for="c-36582947">[1 more]</label></div><br/><div class="children"><div class="content">You could make an argument that bitwarden vaults constitute sensitive information.</div><br/></div></div></div></div><div id="36582512" class="c"><input type="checkbox" id="c-36582512" checked=""/><div class="controls bullet"><span class="by">frays</span><span>|</span><a href="#36582425">parent</a><span>|</span><a href="#36582590">prev</a><span>|</span><a href="#36582484">next</a><span>|</span><label class="collapse" for="c-36582512">[-]</label><label class="expand" for="c-36582512">[5 more]</label></div><br/><div class="children"><div class="content">You are correct.<p>Unfortunately, nginx (and other web servers) generally need to run as root in normal web applications because they are listening on port 80 or 443. Ports below 1024 can be opened only by root.<p>A more detailed explanation can be found here: <a href="https:&#x2F;&#x2F;unix.stackexchange.com&#x2F;questions&#x2F;134301&#x2F;why-does-nginx-starts-process-as-root" rel="nofollow noreferrer">https:&#x2F;&#x2F;unix.stackexchange.com&#x2F;questions&#x2F;134301&#x2F;why-does-ngi...</a></div><br/><div id="36582656" class="c"><input type="checkbox" id="c-36582656" checked=""/><div class="controls bullet"><span class="by">duijf</span><span>|</span><a href="#36582425">root</a><span>|</span><a href="#36582512">parent</a><span>|</span><a href="#36582557">next</a><span>|</span><label class="collapse" for="c-36582656">[-]</label><label class="expand" for="c-36582656">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Ports below 1024 can be opened only by root.<p>Or processes running with the CAP_NET_BIND_SERVICE capability! [1]<p>Capabilities are a Linux kernel feature. Granting CAP_NET_BIND_SERVICE to nginx means you do not need to start it with full root privileges. This capability gives it the ability to open ports below 1024<p>Using systemd, you can use this feature like this:<p><pre><code>    [Service]
    ExecStart=&#x2F;usr&#x2F;bin&#x2F;nginx -c &#x2F;etc&#x2F;my_nginx.conf
    AmbientCapabilities=CAP_NET_BIND_SERVICE
    CapabilityBoundingSet=CAP_NET_BIND_SERVICE
    User=nginx
    Group=nginx
</code></pre>
(You probably also want to enable a ton of other sandboxing options, see `systemd-analyze security` for tips)<p>[1]: <a href="https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man7&#x2F;capabilities.7.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man7&#x2F;capabilities.7.html</a></div><br/></div></div><div id="36582557" class="c"><input type="checkbox" id="c-36582557" checked=""/><div class="controls bullet"><span class="by">guraf</span><span>|</span><a href="#36582425">root</a><span>|</span><a href="#36582512">parent</a><span>|</span><a href="#36582656">prev</a><span>|</span><a href="#36582577">next</a><span>|</span><label class="collapse" for="c-36582557">[-]</label><label class="expand" for="c-36582557">[2 more]</label></div><br/><div class="children"><div class="content">Nginx is started as root but it does not run as root, it changes its user after opening log files and sockets. (unless you use a lazy docker container and just run everything as root inside it).</div><br/><div id="36582593" class="c"><input type="checkbox" id="c-36582593" checked=""/><div class="controls bullet"><span class="by">jand</span><span>|</span><a href="#36582425">root</a><span>|</span><a href="#36582557">parent</a><span>|</span><a href="#36582577">next</a><span>|</span><label class="collapse" for="c-36582593">[-]</label><label class="expand" for="c-36582593">[1 more]</label></div><br/><div class="children"><div class="content">Even in (the official) docker image, a nginx user is created:
(latest, layer 6)<p>&#x2F;bin&#x2F;sh -c set -x &amp;&amp; groupadd --system --gid 101 nginx &amp;&amp; useradd --system --gid nginx --no-create-home --home &#x2F;nonexistent --comment &quot;nginx user&quot; --shell &#x2F;bin&#x2F;false --uid 101 nginx  .....<p>[1] <a href="https:&#x2F;&#x2F;hub.docker.com&#x2F;layers&#x2F;library&#x2F;nginx&#x2F;latest&#x2F;images&#x2F;sha256-d2b2f2980e9ccc570e5726b56b54580f23a018b7b7314c9eaff7e5e479c78657?context=explore" rel="nofollow noreferrer">https:&#x2F;&#x2F;hub.docker.com&#x2F;layers&#x2F;library&#x2F;nginx&#x2F;latest&#x2F;images&#x2F;sh...</a></div><br/></div></div></div></div><div id="36582577" class="c"><input type="checkbox" id="c-36582577" checked=""/><div class="controls bullet"><span class="by">oefrha</span><span>|</span><a href="#36582425">root</a><span>|</span><a href="#36582512">parent</a><span>|</span><a href="#36582557">prev</a><span>|</span><a href="#36582484">next</a><span>|</span><label class="collapse" for="c-36582577">[-]</label><label class="expand" for="c-36582577">[1 more]</label></div><br/><div class="children"><div class="content">Nginx workers shouldn’t run as root and certainly don’t on any distro I know. Typically you have a www-data user&#x2F;group or equivalent. Dropping privilege is very basic.</div><br/></div></div></div></div><div id="36582484" class="c"><input type="checkbox" id="c-36582484" checked=""/><div class="controls bullet"><span class="by">NoMoreNicksLeft</span><span>|</span><a href="#36582425">parent</a><span>|</span><a href="#36582512">prev</a><span>|</span><a href="#36581113">next</a><span>|</span><label class="collapse" for="c-36582484">[-]</label><label class="expand" for="c-36582484">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know about everyone else, but at this point I&#x27;m no longer doing a proper installation of nginx for personal stuff. I always just spin up a docker image... and I&#x27;m not checking if it runs as root or not, really.<p>Probably really screwing things up. Ouch.</div><br/></div></div></div></div><div id="36581113" class="c"><input type="checkbox" id="c-36581113" checked=""/><div class="controls bullet"><span class="by">kentt</span><span>|</span><a href="#36582425">prev</a><span>|</span><a href="#36580650">next</a><span>|</span><label class="collapse" for="c-36581113">[-]</label><label class="expand" for="c-36581113">[3 more]</label></div><br/><div class="children"><div class="content">If I understand correctly, this is a vulnerability in self-hosted Bitwarden only. Is that correct?</div><br/><div id="36582540" class="c"><input type="checkbox" id="c-36582540" checked=""/><div class="controls bullet"><span class="by">emaciatedslug</span><span>|</span><a href="#36581113">parent</a><span>|</span><a href="#36582875">next</a><span>|</span><label class="collapse" for="c-36582540">[-]</label><label class="expand" for="c-36582540">[1 more]</label></div><br/><div class="children"><div class="content">Yes, per the article: &quot;Bitwarden also offers a self-hosted option for those who want to maintain their own server, which is the one we are going to examine.&quot;</div><br/></div></div><div id="36582875" class="c"><input type="checkbox" id="c-36582875" checked=""/><div class="controls bullet"><span class="by">zeeZ</span><span>|</span><a href="#36581113">parent</a><span>|</span><a href="#36582540">prev</a><span>|</span><a href="#36580650">next</a><span>|</span><label class="collapse" for="c-36582875">[-]</label><label class="expand" for="c-36582875">[1 more]</label></div><br/><div class="children"><div class="content">This is for the single image self-hosted setup method, which is still in beta. The current supported self-hosted setup is a script that creates a bunch of individual containers for the different services.</div><br/></div></div></div></div><div id="36580650" class="c"><input type="checkbox" id="c-36580650" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#36581113">prev</a><span>|</span><a href="#36583617">next</a><span>|</span><label class="collapse" for="c-36580650">[-]</label><label class="expand" for="c-36580650">[17 more]</label></div><br/><div class="children"><div class="content">Note that this leaks the vault with secrets encrypted - a leak of the cyphertext.<p>&gt; <i>This vulnerability has been disclosed to Bitwarden and has since then been fixed. Bitwarden issued a US$6000 bounty, which is the highest bounty they issued on their HackerOne program.</i><p>That&#x27;s a ridiculously low payout.</div><br/><div id="36580800" class="c"><input type="checkbox" id="c-36580800" checked=""/><div class="controls bullet"><span class="by">andersa</span><span>|</span><a href="#36580650">parent</a><span>|</span><a href="#36580683">next</a><span>|</span><label class="collapse" for="c-36580800">[-]</label><label class="expand" for="c-36580800">[3 more]</label></div><br/><div class="children"><div class="content">Small companies can&#x27;t just give out $50k bounties, even if it would be deserved.</div><br/><div id="36580896" class="c"><input type="checkbox" id="c-36580896" checked=""/><div class="controls bullet"><span class="by">lyu07282</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580800">parent</a><span>|</span><a href="#36580683">next</a><span>|</span><label class="collapse" for="c-36580896">[-]</label><label class="expand" for="c-36580896">[2 more]</label></div><br/><div class="children"><div class="content">They raised 100 million $ last year<p><a href="https:&#x2F;&#x2F;siliconangle.com&#x2F;2022&#x2F;09&#x2F;06&#x2F;bitwarden-reels-100m-open-source-password-manager&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;siliconangle.com&#x2F;2022&#x2F;09&#x2F;06&#x2F;bitwarden-reels-100m-ope...</a></div><br/><div id="36582628" class="c"><input type="checkbox" id="c-36582628" checked=""/><div class="controls bullet"><span class="by">andersa</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580896">parent</a><span>|</span><a href="#36580683">next</a><span>|</span><label class="collapse" for="c-36582628">[-]</label><label class="expand" for="c-36582628">[1 more]</label></div><br/><div class="children"><div class="content">Huh. First time hearing about this. No longer a small company then.</div><br/></div></div></div></div></div></div><div id="36580683" class="c"><input type="checkbox" id="c-36580683" checked=""/><div class="controls bullet"><span class="by">dghlsakjg</span><span>|</span><a href="#36580650">parent</a><span>|</span><a href="#36580800">prev</a><span>|</span><a href="#36580704">next</a><span>|</span><label class="collapse" for="c-36580683">[-]</label><label class="expand" for="c-36580683">[11 more]</label></div><br/><div class="children"><div class="content">I don’t know enough about bounty programs to comment on the amount, but my understanding is that leaking encrypted secrets isn’t really dangerous?</div><br/><div id="36580716" class="c"><input type="checkbox" id="c-36580716" checked=""/><div class="controls bullet"><span class="by">NoZebra120vClip</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580683">parent</a><span>|</span><a href="#36581357">next</a><span>|</span><label class="collapse" for="c-36580716">[-]</label><label class="expand" for="c-36580716">[5 more]</label></div><br/><div class="children"><div class="content">It&#x27;s generally a question of time.<p>If you want to play the long game and collect a lot of encrypted data now, you can simply wait until it is possible to trivially decrypt, and&#x2F;or start cracking now and let the years work on it.<p>Most encryption decisions are framed as a tradeoff of the time and resources it would currently take to brute-force your way through it, and how many years before a simple attack becomes feasible, vs. your $5 wrench attacks in the present day.</div><br/><div id="36580812" class="c"><input type="checkbox" id="c-36580812" checked=""/><div class="controls bullet"><span class="by">nyolfen</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580716">parent</a><span>|</span><a href="#36581357">next</a><span>|</span><label class="collapse" for="c-36580812">[-]</label><label class="expand" for="c-36580812">[4 more]</label></div><br/><div class="children"><div class="content">BW uses 100K rounds of PBKDF2 for the master password so I don&#x27;t think that will be any time soon</div><br/><div id="36581094" class="c"><input type="checkbox" id="c-36581094" checked=""/><div class="controls bullet"><span class="by">SV_BubbleTime</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580812">parent</a><span>|</span><a href="#36581357">next</a><span>|</span><label class="collapse" for="c-36581094">[-]</label><label class="expand" for="c-36581094">[3 more]</label></div><br/><div class="children"><div class="content">BW now uses Argon2 over PBKDF.  I can’t remember if that is by default, opt-in, or new accounts. But barring an argon vuln, this is even less of a concern.<p>Also, I think BW has been using more than 100k for some time now. Last I saw 600K was the recommendation.</div><br/><div id="36581320" class="c"><input type="checkbox" id="c-36581320" checked=""/><div class="controls bullet"><span class="by">emaciatedslug</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581094">parent</a><span>|</span><a href="#36581357">next</a><span>|</span><label class="collapse" for="c-36581320">[-]</label><label class="expand" for="c-36581320">[2 more]</label></div><br/><div class="children"><div class="content">The default for new Bitwarden accounts from Feb 2023 on is PDBFK2 HMAC SHA 256 setting at 600,001 iterations on the client and 100,000 on the server with the option to use Argon2id. These settings are above current OWASP recommendations. <a href="https:&#x2F;&#x2F;cheatsheetseries.owasp.org&#x2F;cheatsheets&#x2F;Password_Storage_Cheat_Sheet.html#pbkdf2" rel="nofollow noreferrer">https:&#x2F;&#x2F;cheatsheetseries.owasp.org&#x2F;cheatsheets&#x2F;Password_Stor...</a>
<a href="https:&#x2F;&#x2F;bitwarden.com&#x2F;help&#x2F;kdf-algorithms&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;bitwarden.com&#x2F;help&#x2F;kdf-algorithms&#x2F;</a></div><br/><div id="36581714" class="c"><input type="checkbox" id="c-36581714" checked=""/><div class="controls bullet"><span class="by">NoZebra120vClip</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581320">parent</a><span>|</span><a href="#36581357">next</a><span>|</span><label class="collapse" for="c-36581714">[-]</label><label class="expand" for="c-36581714">[1 more]</label></div><br/><div class="children"><div class="content">All the replies have given random statistics, but these don&#x27;t shed much light on the length of time it may take an attacker to brute-force a password, or find a chink in the armor of the vault&#x27;s encryption algorithm.<p>Now as I said, a significant threat actor with lots of time in their future plans can collect encrypted stuff such as vaults and bide their time. Someday, the decryption may be cost-effectively cheap. Someday, a flaw may be uncovered in the cryptography. Someday, a vault owner&#x27;s secret key(s) may leak and can be correlated.<p>As I said, it&#x27;s just a question of time, and the ability to hold on to your cards for long enough that they can be played in the proper manner. It may take 5 years, 10 or 20, but if the payoff is valuable enough, it&#x27;s worth the wait for the threat actor.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="36581357" class="c"><input type="checkbox" id="c-36581357" checked=""/><div class="controls bullet"><span class="by">rcxdude</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580683">parent</a><span>|</span><a href="#36580716">prev</a><span>|</span><a href="#36580704">next</a><span>|</span><label class="collapse" for="c-36581357">[-]</label><label class="expand" for="c-36581357">[5 more]</label></div><br/><div class="children"><div class="content">a password vault contains a lot of long-lived secrets protected by a human-provided key, so it&#x27;s really not something you want out there, even encrypted.</div><br/><div id="36581760" class="c"><input type="checkbox" id="c-36581760" checked=""/><div class="controls bullet"><span class="by">Bluecobra</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581357">parent</a><span>|</span><a href="#36580704">next</a><span>|</span><label class="collapse" for="c-36581760">[-]</label><label class="expand" for="c-36581760">[4 more]</label></div><br/><div class="children"><div class="content">I would assume most people that are doing self-hosted are securing it behind a VPN like Wireguard instead of opening it to the whole web. (at least I hope so)</div><br/><div id="36583494" class="c"><input type="checkbox" id="c-36583494" checked=""/><div class="controls bullet"><span class="by">berkes</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581760">parent</a><span>|</span><a href="#36582640">next</a><span>|</span><label class="collapse" for="c-36583494">[-]</label><label class="expand" for="c-36583494">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m afraid not. I&#x27;ve seen some really dumb setups of BW when helping selfhosted.<p>I do think that while selfhosting is admirable, in the case of your password vault, it&#x27;s not. It&#x27;s one thing where I&#x27;d always advice against selfhosting or DIY, because the downside risk is just too big.<p>The chance of f<i>ng up may be tiny, bit if you f</i>ck up, it&#x27;s bad. Potentially bankruptcy or jail bad.</div><br/></div></div><div id="36582640" class="c"><input type="checkbox" id="c-36582640" checked=""/><div class="controls bullet"><span class="by">diarrhea</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581760">parent</a><span>|</span><a href="#36583494">prev</a><span>|</span><a href="#36582418">next</a><span>|</span><label class="collapse" for="c-36582640">[-]</label><label class="expand" for="c-36582640">[1 more]</label></div><br/><div class="children"><div class="content">I am not. Working well so far. My instance is behind Caddy, behind a secret URL path. To talk to the instance, this “pre-shares secret” needs to be known first. So far I haven’t seen any abnormal hits. I’m closing in on 3 years of using it in this setup, via Vaultwarden.<p>I’m aware that this is security through obscurity. The instance’s accounts use strong passwords and MFA.</div><br/></div></div><div id="36582418" class="c"><input type="checkbox" id="c-36582418" checked=""/><div class="controls bullet"><span class="by">donutshop</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36581760">parent</a><span>|</span><a href="#36582640">prev</a><span>|</span><a href="#36580704">next</a><span>|</span><label class="collapse" for="c-36582418">[-]</label><label class="expand" for="c-36582418">[1 more]</label></div><br/><div class="children"><div class="content">I thought so too. But then did a quick search on Shodan and found these:<p><a href="https:&#x2F;&#x2F;www.shodan.io&#x2F;search?query=bitwarden" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.shodan.io&#x2F;search?query=bitwarden</a><p><a href="https:&#x2F;&#x2F;www.shodan.io&#x2F;search?query=vaultwarden" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.shodan.io&#x2F;search?query=vaultwarden</a></div><br/></div></div></div></div></div></div></div></div><div id="36580704" class="c"><input type="checkbox" id="c-36580704" checked=""/><div class="controls bullet"><span class="by">dw33b</span><span>|</span><a href="#36580650">parent</a><span>|</span><a href="#36580683">prev</a><span>|</span><a href="#36583617">next</a><span>|</span><label class="collapse" for="c-36580704">[-]</label><label class="expand" for="c-36580704">[2 more]</label></div><br/><div class="children"><div class="content">not compared to the $500 Google gave them</div><br/><div id="36582602" class="c"><input type="checkbox" id="c-36582602" checked=""/><div class="controls bullet"><span class="by">gostsamo</span><span>|</span><a href="#36580650">root</a><span>|</span><a href="#36580704">parent</a><span>|</span><a href="#36583617">next</a><span>|</span><label class="collapse" for="c-36582602">[-]</label><label class="expand" for="c-36582602">[1 more]</label></div><br/><div class="children"><div class="content">Not sure why your comment is last in the page. Google have significantly more resources and the authors looked to disagree with the amount awarded for the google vulnerability.</div><br/></div></div></div></div></div></div><div id="36583617" class="c"><input type="checkbox" id="c-36583617" checked=""/><div class="controls bullet"><span class="by">em1sar</span><span>|</span><a href="#36580650">prev</a><span>|</span><label class="collapse" for="c-36583617">[-]</label><label class="expand" for="c-36583617">[1 more]</label></div><br/><div class="children"><div class="content">Okay so I self-host Vaultwarden, what do I need to do to fix the vulnerability? The article mentions another flavor of the self hosted docker image though.</div><br/></div></div></div></div></div></div></div></body></html>