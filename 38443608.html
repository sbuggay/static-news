<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701248458725" as="style"/><link rel="stylesheet" href="styles.css?v=1701248458725"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://belkadan.com/blog/2023/11/GitMounter/">GitMounter: A FUSE filesystem for Git repositories</a>Â <span class="domain">(<a href="https://belkadan.com">belkadan.com</a>)</span></div><div class="subtext"><span>goranmoomin</span> | <span>25 comments</span></div><br/><div><div id="38455942" class="c"><input type="checkbox" id="c-38455942" checked=""/><div class="controls bullet"><span class="by">dalf</span><span>|</span><a href="#38455975">next</a><span>|</span><label class="collapse" for="c-38455942">[-]</label><label class="expand" for="c-38455942">[1 more]</label></div><br/><div class="children"><div class="content">Seafile (a file sync storage) is inspired by git to store the files (internally there are repositories, branches and commits). However the file are not stored directly:<p>&gt; A file is further divided into blocks with variable lengths. We use Content Defined Chunking algorithm to divide file into blocks.<p>&gt; This mechanism makes it possible to deduplicate data between different versions of frequently updated files, improving storage efficiency. It also enables transferring data to&#x2F;from multiple servers in parallel.<p>I use it on old PC without issue. Drawback: since the files are not stored in clear, in case of data corruption of the Seafile repositories, I need backup (never happened to me).<p>* <a href="https:&#x2F;&#x2F;manual.seafile.com&#x2F;develop&#x2F;data_model&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;manual.seafile.com&#x2F;develop&#x2F;data_model&#x2F;</a><p>* <a href="https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;lbfs:sosp01&#x2F;lbfs.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;lbfs:sosp01&#x2F;lbfs.pdf</a></div><br/></div></div><div id="38455975" class="c"><input type="checkbox" id="c-38455975" checked=""/><div class="controls bullet"><span class="by">computerfriend</span><span>|</span><a href="#38455942">prev</a><span>|</span><a href="#38454216">next</a><span>|</span><label class="collapse" for="c-38455975">[-]</label><label class="expand" for="c-38455975">[6 more]</label></div><br/><div class="children"><div class="content">For all the use cases I can think of, git worktree could be used to simulate this without any fuse dependency.</div><br/><div id="38456574" class="c"><input type="checkbox" id="c-38456574" checked=""/><div class="controls bullet"><span class="by">112233</span><span>|</span><a href="#38455975">parent</a><span>|</span><a href="#38456703">next</a><span>|</span><label class="collapse" for="c-38456574">[-]</label><label class="expand" for="c-38456574">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d like to use specific git tree object as a lowerdir for overlayfs mount, preferrably without requiring root. Do you have anything in mind for that?</div><br/></div></div><div id="38456703" class="c"><input type="checkbox" id="c-38456703" checked=""/><div class="controls bullet"><span class="by">lloydatkinson</span><span>|</span><a href="#38455975">parent</a><span>|</span><a href="#38456574">prev</a><span>|</span><a href="#38456653">next</a><span>|</span><label class="collapse" for="c-38456703">[-]</label><label class="expand" for="c-38456703">[3 more]</label></div><br/><div class="children"><div class="content">Does worktree allow checking out the same branch but at different commits?</div><br/><div id="38456864" class="c"><input type="checkbox" id="c-38456864" checked=""/><div class="controls bullet"><span class="by">SpaceNugget</span><span>|</span><a href="#38455975">root</a><span>|</span><a href="#38456703">parent</a><span>|</span><a href="#38456836">next</a><span>|</span><label class="collapse" for="c-38456864">[-]</label><label class="expand" for="c-38456864">[1 more]</label></div><br/><div class="children"><div class="content">Somewhat pedantic but relevant. A branch is a single commit. There aren&#x27;t different commits _in_ a branch to checkout.<p>Regardless, if you are asking whether you can check out commit that doesn&#x27;t have a branch pointing at it, yes you can.<p>You can have a work tree for every commit in your repository if you like.</div><br/></div></div><div id="38456836" class="c"><input type="checkbox" id="c-38456836" checked=""/><div class="controls bullet"><span class="by">matrss</span><span>|</span><a href="#38455975">root</a><span>|</span><a href="#38456703">parent</a><span>|</span><a href="#38456864">prev</a><span>|</span><a href="#38456653">next</a><span>|</span><label class="collapse" for="c-38456836">[-]</label><label class="expand" for="c-38456836">[1 more]</label></div><br/><div class="children"><div class="content">No, because a branch is a (re-assignable) name for some commit and cannot point at different commits while in the same repository at the same time. A &quot;branch but at different commits&quot; simply makes no sense. You can however create a worktree with a detached HEAD pointing at any commit. By default it seems to create a branch for each worktree.</div><br/></div></div></div></div><div id="38456653" class="c"><input type="checkbox" id="c-38456653" checked=""/><div class="controls bullet"><span class="by">rwbhn</span><span>|</span><a href="#38455975">parent</a><span>|</span><a href="#38456703">prev</a><span>|</span><a href="#38454216">next</a><span>|</span><label class="collapse" for="c-38456653">[-]</label><label class="expand" for="c-38456653">[1 more]</label></div><br/><div class="children"><div class="content">TIL. Thx!</div><br/></div></div></div></div><div id="38454216" class="c"><input type="checkbox" id="c-38454216" checked=""/><div class="controls bullet"><span class="by">turminal</span><span>|</span><a href="#38455975">prev</a><span>|</span><a href="#38455427">next</a><span>|</span><label class="collapse" for="c-38454216">[-]</label><label class="expand" for="c-38454216">[1 more]</label></div><br/><div class="children"><div class="content">A similar thing exists for Plan 9: <a href="https:&#x2F;&#x2F;orib.dev&#x2F;git9.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;orib.dev&#x2F;git9.html</a></div><br/></div></div><div id="38455427" class="c"><input type="checkbox" id="c-38455427" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#38454216">prev</a><span>|</span><a href="#38454870">next</a><span>|</span><label class="collapse" for="c-38455427">[-]</label><label class="expand" for="c-38455427">[5 more]</label></div><br/><div class="children"><div class="content">I wonder why anyone would think it&#x27;s &quot;impractical&quot;.<p>You might have to wait a moment at startup for it to make a list of commits, but after that git is very well designed for this sort of browsing.</div><br/><div id="38456615" class="c"><input type="checkbox" id="c-38456615" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#38455427">parent</a><span>|</span><a href="#38456430">next</a><span>|</span><label class="collapse" for="c-38456615">[-]</label><label class="expand" for="c-38456615">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s impractical to list a directory with millions of entries (e.g., commits) that require a lot of work to find.  One might want to organize such a pile of things in a way that naturally limits the number of items to list -- i.e., one might want to add <i>paging</i>, so you&#x27;d have page 1, page 2, etc., with each page having some small number of items, say, 1000 (e.g., commits).</div><br/><div id="38456652" class="c"><input type="checkbox" id="c-38456652" checked=""/><div class="controls bullet"><span class="by">TeMPOraL</span><span>|</span><a href="#38455427">root</a><span>|</span><a href="#38456615">parent</a><span>|</span><a href="#38456430">next</a><span>|</span><label class="collapse" for="c-38456652">[-]</label><label class="expand" for="c-38456652">[2 more]</label></div><br/><div class="children"><div class="content">&gt; <i>to list a directory with millions of entries</i><p>Fair, it&#x27;ll likely break most tools written in the last 10-15 years.<p>&gt; <i>(e.g., commits) that require a lot of work to find.</i><p>That&#x27;s solvable with a cache. I&#x27;m surprised git doesn&#x27;t seem to have one for those, at least going by how long it takes to generate a full &quot;shorthand log&quot; on a large repo.</div><br/><div id="38456796" class="c"><input type="checkbox" id="c-38456796" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#38455427">root</a><span>|</span><a href="#38456652">parent</a><span>|</span><a href="#38456430">next</a><span>|</span><label class="collapse" for="c-38456796">[-]</label><label class="expand" for="c-38456796">[1 more]</label></div><br/><div class="children"><div class="content">Caching is nice, but if it takes an hour when the cache is cold then it&#x27;s not usable even if a directory with millions of entries posed no problems for any tools.  Now for most projects that&#x27;s not going to happen, but for something like the Linux kernel it just might.  And there might be many caches to warm, and much to cache.  For a large enough project and a computer that one might not think of as small that might just fail to work at all.  This is why as Git grows up it&#x27;s using Bloom filters to optimize things like git blame and git log on one file rather than adopting the fully relational model of Fossil.  (Please read into this all the chagrin I&#x27;m feeling about that, because I&#x27;m quite the fan of Fossil&#x27;s relational model.)<p>PS, the single biggest problem with million-entry directories is the propensity of tools like ls(1) to want to <i>sort</i> the darned things, so one has to remember to use `ls -f`, or to at least use the C locale to get memset() collations instead of much much slower Unicode collations.  Another problem is that the POSIX stat(2) family of functions combine reading metadata that could come from just the directory (e.g., a file&#x27;s inode number) (and which contents has already been read) with reading metadata that requires [possibly much] extra I&#x2F;O to get, so if you&#x27;re doing `ls -l` on a million-entry directory you might as well go on vacation (but make sure to send the output to some file, cause your scrollback buffer just won&#x27;t do).</div><br/></div></div></div></div></div></div><div id="38456430" class="c"><input type="checkbox" id="c-38456430" checked=""/><div class="controls bullet"><span class="by">iforgotpassword</span><span>|</span><a href="#38455427">parent</a><span>|</span><a href="#38456615">prev</a><span>|</span><a href="#38454870">next</a><span>|</span><label class="collapse" for="c-38456430">[-]</label><label class="expand" for="c-38456430">[1 more]</label></div><br/><div class="children"><div class="content">Depends on your personal preferences. I&#x27;ve been using cgit for this for over a decade now, it&#x27;s blazing fast and I just know it inside out. It&#x27;s running on a local server hosting all the repos, so obviously requires a little more setup; don&#x27;t know if I&#x27;d install a web server on my machine just for that.</div><br/></div></div></div></div><div id="38454870" class="c"><input type="checkbox" id="c-38454870" checked=""/><div class="controls bullet"><span class="by">edude03</span><span>|</span><a href="#38455427">prev</a><span>|</span><a href="#38454261">next</a><span>|</span><label class="collapse" for="c-38454870">[-]</label><label class="expand" for="c-38454870">[1 more]</label></div><br/><div class="children"><div class="content">See also: <a href="https:&#x2F;&#x2F;github.com&#x2F;presslabs&#x2F;gitfs">https:&#x2F;&#x2F;github.com&#x2F;presslabs&#x2F;gitfs</a></div><br/></div></div><div id="38454261" class="c"><input type="checkbox" id="c-38454261" checked=""/><div class="controls bullet"><span class="by">compressedgas</span><span>|</span><a href="#38454870">prev</a><span>|</span><a href="#38454119">next</a><span>|</span><label class="collapse" for="c-38454261">[-]</label><label class="expand" for="c-38454261">[1 more]</label></div><br/><div class="children"><div class="content">Perhaps the first back in 2005 was <a href="http:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20100218153353&#x2F;http:&#x2F;&#x2F;www.sfgoth.com&#x2F;~mitch&#x2F;linux&#x2F;gitfs&#x2F;" rel="nofollow noreferrer">http:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20100218153353&#x2F;http:&#x2F;&#x2F;www.sfgoth....</a></div><br/></div></div><div id="38454119" class="c"><input type="checkbox" id="c-38454119" checked=""/><div class="controls bullet"><span class="by">anonacct37</span><span>|</span><a href="#38454261">prev</a><span>|</span><a href="#38454748">next</a><span>|</span><label class="collapse" for="c-38454119">[-]</label><label class="expand" for="c-38454119">[1 more]</label></div><br/><div class="children"><div class="content">I think this is a great idea. In the old days before fuse was so widely used I saw this same idea used in the jvm since it supports custom protocol handlers that you can use for vfs operations.</div><br/></div></div><div id="38454748" class="c"><input type="checkbox" id="c-38454748" checked=""/><div class="controls bullet"><span class="by">armchairhacker</span><span>|</span><a href="#38454119">prev</a><span>|</span><a href="#38455221">next</a><span>|</span><label class="collapse" for="c-38454748">[-]</label><label class="expand" for="c-38454748">[1 more]</label></div><br/><div class="children"><div class="content">You should get this added to the Wikipedia list: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Filesystem_in_Userspace" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Filesystem_in_Userspace</a></div><br/></div></div><div id="38455221" class="c"><input type="checkbox" id="c-38455221" checked=""/><div class="controls bullet"><span class="by">aunwick</span><span>|</span><a href="#38454748">prev</a><span>|</span><a href="#38456156">next</a><span>|</span><label class="collapse" for="c-38455221">[-]</label><label class="expand" for="c-38455221">[6 more]</label></div><br/><div class="children"><div class="content">I think clear case has a patent on this from 1997.</div><br/><div id="38455534" class="c"><input type="checkbox" id="c-38455534" checked=""/><div class="controls bullet"><span class="by">ipaddr</span><span>|</span><a href="#38455221">parent</a><span>|</span><a href="#38455348">next</a><span>|</span><label class="collapse" for="c-38455534">[-]</label><label class="expand" for="c-38455534">[3 more]</label></div><br/><div class="children"><div class="content">Wouldn&#x27;t the patent be expired?</div><br/><div id="38455845" class="c"><input type="checkbox" id="c-38455845" checked=""/><div class="controls bullet"><span class="by">jtwaleson</span><span>|</span><a href="#38455221">root</a><span>|</span><a href="#38455534">parent</a><span>|</span><a href="#38455867">next</a><span>|</span><label class="collapse" for="c-38455845">[-]</label><label class="expand" for="c-38455845">[1 more]</label></div><br/><div class="children"><div class="content">Yes, thereâs a 20 year maximum duration for patents. Depending on some technicalities it could be a year or two longer but definitely under 26. Unless someone created additional patents with improvements.</div><br/></div></div><div id="38455867" class="c"><input type="checkbox" id="c-38455867" checked=""/><div class="controls bullet"><span class="by">virtue3</span><span>|</span><a href="#38455221">root</a><span>|</span><a href="#38455534">parent</a><span>|</span><a href="#38455845">prev</a><span>|</span><a href="#38455348">next</a><span>|</span><label class="collapse" for="c-38455867">[-]</label><label class="expand" for="c-38455867">[1 more]</label></div><br/><div class="children"><div class="content">potentially? but you can also extend a patent by adding to it by patenting an improvement on the patent.  :&#x2F;</div><br/></div></div></div></div><div id="38455348" class="c"><input type="checkbox" id="c-38455348" checked=""/><div class="controls bullet"><span class="by">bezier-curve</span><span>|</span><a href="#38455221">parent</a><span>|</span><a href="#38455534">prev</a><span>|</span><a href="#38456156">next</a><span>|</span><label class="collapse" for="c-38455348">[-]</label><label class="expand" for="c-38455348">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s before git was created. Do you have details about this?</div><br/><div id="38455472" class="c"><input type="checkbox" id="c-38455472" checked=""/><div class="controls bullet"><span class="by">shiroiuma</span><span>|</span><a href="#38455221">root</a><span>|</span><a href="#38455348">parent</a><span>|</span><a href="#38456156">next</a><span>|</span><label class="collapse" for="c-38455472">[-]</label><label class="expand" for="c-38455472">[1 more]</label></div><br/><div class="children"><div class="content">Yes, it is before git was created; that doesn&#x27;t matter for a patent.  In ClearCase, the repository is mounted on the filesystem very much like this; in Linux, it required special kernel drivers to work back when I used it (2000s).</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>