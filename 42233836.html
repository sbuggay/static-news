<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1733043654022" as="style"/><link rel="stylesheet" href="styles.css?v=1733043654022"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://notso.boringsql.com/posts/deletes-are-difficult/">DELETEs Are Difficult</a> <span class="domain">(<a href="https://notso.boringsql.com">notso.boringsql.com</a>)</span></div><div class="subtext"><span>radimm</span> | <span>21 comments</span></div><br/><div><div id="42287189" class="c"><input type="checkbox" id="c-42287189" checked=""/><div class="controls bullet"><span class="by">physicsguy</span><span>|</span><a href="#42287009">next</a><span>|</span><label class="collapse" for="c-42287189">[-]</label><label class="expand" for="c-42287189">[1 more]</label></div><br/><div class="children"><div class="content">They are difficult but it shouldn’t be underestimated the cost of trying to keep consistency with the alternatives either.<p>I sometimes think that people ask the wrong question on this sort of thing - rather than thinking “what technical solution should I come up with” you should be thinking “what is the business requirement here, and what consistency guarantees are needed?”<p>In many cases you want to soft delete anyway and mark rows as stale rather than deleting them wholesale. Cascade deletes need to be very carefully thought about, as while they’re very handy they can be quite destructive if the relationships are not mapped out.<p>Personally having spent some time now in the microservices hole, I miss all the power SQL databases give you for this sort of thing. I think everyone should spend some time reading and digesting ‘Designing Data Intensive Applications’ and evaluating the trade offs in detail.</div><br/></div></div><div id="42287009" class="c"><input type="checkbox" id="c-42287009" checked=""/><div class="controls bullet"><span class="by">jandrewrogers</span><span>|</span><a href="#42287189">prev</a><span>|</span><a href="#42287134">next</a><span>|</span><label class="collapse" for="c-42287009">[-]</label><label class="expand" for="c-42287009">[1 more]</label></div><br/><div class="children"><div class="content">DELETE is expensive at a deep fundamental level that we don’t think about much in computer science because we are more worried about losing data. The article is about Postgres but it generalizes. We don’t actually have any computer science for DELETE optimized databases. I’ve idly looked into delete-optimization in databases as thought experiments, since there isn’t much in the way of literature on it, and it is far more difficult than I think many people intuit. The article is partly a manifestation of this reality.<p>I think the nature of DELETE is one of the more interesting open problems in computer science. It is one of those things that, when we require precision, turns out to be very difficult to define.</div><br/></div></div><div id="42287134" class="c"><input type="checkbox" id="c-42287134" checked=""/><div class="controls bullet"><span class="by">Svip</span><span>|</span><a href="#42287009">prev</a><span>|</span><a href="#42286922">next</a><span>|</span><label class="collapse" for="c-42287134">[-]</label><label class="expand" for="c-42287134">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Unlike DELETEs, UPDATEs don’t trigger cascaded actions - they only involve triggers that are explicitly defined.<p>That&#x27;s not entirely true.  ON UPDATE CASCADE is a thing for foreign keys, at least in PostgreSQL (which this article is talking about), meaning that the foreign row referencing the row gets updated.  Though, personally, I would never use ON UPDATE CASCADE, as it seems kind of funky.</div><br/><div id="42287183" class="c"><input type="checkbox" id="c-42287183" checked=""/><div class="controls bullet"><span class="by">arcanemachiner</span><span>|</span><a href="#42287134">parent</a><span>|</span><a href="#42286922">next</a><span>|</span><label class="collapse" for="c-42287183">[-]</label><label class="expand" for="c-42287183">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Though, personally, I would never use ON UPDATE CASCADE, as it seems kind of funky.<p>As a relative noob in the world of database administration, I&#x27;m glad to hear that someone else feels this way.</div><br/></div></div></div></div><div id="42286922" class="c"><input type="checkbox" id="c-42286922" checked=""/><div class="controls bullet"><span class="by">yen223</span><span>|</span><a href="#42287134">prev</a><span>|</span><a href="#42233859">next</a><span>|</span><label class="collapse" for="c-42286922">[-]</label><label class="expand" for="c-42286922">[1 more]</label></div><br/><div class="children"><div class="content">A big asterisk that should be added to the article is that all that applies to Postgres.<p>Other databases have their own deletion mechanisms (and deletion quirks)<p>It&#x27;s a very good article otherwise.</div><br/></div></div><div id="42233859" class="c"><input type="checkbox" id="c-42233859" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#42286922">prev</a><span>|</span><a href="#42287151">next</a><span>|</span><label class="collapse" for="c-42233859">[-]</label><label class="expand" for="c-42233859">[8 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  DELETE FROM films;
</code></pre>
I&#x27;m surprised databases makes it so easy to just delete an entire table. I think the command should be<p><pre><code>  DELETE FROM films YES-I-KNOW-WHAT-I-AM-DOING;</code></pre></div><br/><div id="42287038" class="c"><input type="checkbox" id="c-42287038" checked=""/><div class="controls bullet"><span class="by">RedShift1</span><span>|</span><a href="#42233859">parent</a><span>|</span><a href="#42233920">next</a><span>|</span><label class="collapse" for="c-42287038">[-]</label><label class="expand" for="c-42287038">[1 more]</label></div><br/><div class="children"><div class="content">There is pg-safeupdate: <a href="https:&#x2F;&#x2F;github.com&#x2F;eradman&#x2F;pg-safeupdate">https:&#x2F;&#x2F;github.com&#x2F;eradman&#x2F;pg-safeupdate</a></div><br/></div></div><div id="42233920" class="c"><input type="checkbox" id="c-42233920" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#42233859">parent</a><span>|</span><a href="#42287038">prev</a><span>|</span><a href="#42286929">next</a><span>|</span><label class="collapse" for="c-42233920">[-]</label><label class="expand" for="c-42233920">[4 more]</label></div><br/><div class="children"><div class="content">Agreed, I&#x27;ve long been thinking that DELETE should require a WHERE clause.<p>If you really want to just delete everything, just do WHERE 1=1.</div><br/><div id="42286853" class="c"><input type="checkbox" id="c-42286853" checked=""/><div class="controls bullet"><span class="by">buro9</span><span>|</span><a href="#42233859">root</a><span>|</span><a href="#42233920">parent</a><span>|</span><a href="#42286929">next</a><span>|</span><label class="collapse" for="c-42286853">[-]</label><label class="expand" for="c-42286853">[3 more]</label></div><br/><div class="children"><div class="content">UPDATEs should require a WHERE clause too.<p>At which point we could just say all SQL should have a WHERE clause.</div><br/><div id="42286970" class="c"><input type="checkbox" id="c-42286970" checked=""/><div class="controls bullet"><span class="by">jaredsohn</span><span>|</span><a href="#42233859">root</a><span>|</span><a href="#42286853">parent</a><span>|</span><a href="#42287110">next</a><span>|</span><label class="collapse" for="c-42286970">[-]</label><label class="expand" for="c-42286970">[1 more]</label></div><br/><div class="children"><div class="content">I think SELECTs without WHERE clauses are fine</div><br/></div></div><div id="42287110" class="c"><input type="checkbox" id="c-42287110" checked=""/><div class="controls bullet"><span class="by">ahoka</span><span>|</span><a href="#42233859">root</a><span>|</span><a href="#42286853">parent</a><span>|</span><a href="#42286970">prev</a><span>|</span><a href="#42286929">next</a><span>|</span><label class="collapse" for="c-42287110">[-]</label><label class="expand" for="c-42287110">[1 more]</label></div><br/><div class="children"><div class="content">And queries should start with WHERE.</div><br/></div></div></div></div></div></div><div id="42286929" class="c"><input type="checkbox" id="c-42286929" checked=""/><div class="controls bullet"><span class="by">jsemrau</span><span>|</span><a href="#42233859">parent</a><span>|</span><a href="#42233920">prev</a><span>|</span><a href="#42287151">next</a><span>|</span><label class="collapse" for="c-42286929">[-]</label><label class="expand" for="c-42286929">[2 more]</label></div><br/><div class="children"><div class="content">MySQL has this as default as far as I recall. But then I never delete, I just set &quot;deleted&quot; to yes.</div><br/><div id="42287194" class="c"><input type="checkbox" id="c-42287194" checked=""/><div class="controls bullet"><span class="by">physicsguy</span><span>|</span><a href="#42233859">root</a><span>|</span><a href="#42286929">parent</a><span>|</span><a href="#42287151">next</a><span>|</span><label class="collapse" for="c-42287194">[-]</label><label class="expand" for="c-42287194">[1 more]</label></div><br/><div class="children"><div class="content">That just wouldn’t fly where you have business customers, many insist on data deletion at the end of contracts. In practice though partitioning or using seperate databases can be a better strategy for dealing with that as otherwise dealing with backups are challenging.</div><br/></div></div></div></div></div></div><div id="42287151" class="c"><input type="checkbox" id="c-42287151" checked=""/><div class="controls bullet"><span class="by">burntcaramel</span><span>|</span><a href="#42233859">prev</a><span>|</span><a href="#42234425">next</a><span>|</span><label class="collapse" for="c-42287151">[-]</label><label class="expand" for="c-42287151">[1 more]</label></div><br/><div class="children"><div class="content">If data isn’t actually removed until vacuuming, then are systems that perform SQL DELETES actually GDPR compliant? Because technically the private data is still there on disk and could be recovered. “Until the autovacuum process or a manual VACUUM operation reclaims the space, the “deleted” data remains.”</div><br/></div></div><div id="42234425" class="c"><input type="checkbox" id="c-42234425" checked=""/><div class="controls bullet"><span class="by">Terr_</span><span>|</span><a href="#42287151">prev</a><span>|</span><a href="#42233869">next</a><span>|</span><label class="collapse" for="c-42234425">[-]</label><label class="expand" for="c-42234425">[3 more]</label></div><br/><div class="children"><div class="content">For many of the most painful deletion questions, the root problem is that when the software was first made the stakeholders&#x2F;product-org didn&#x27;t think about use-cases for deleting things. At best, they assume a &quot;do not show&quot; property can be placed onto things, which falls apart when you get to legal issues that compel actual removal.</div><br/><div id="42286952" class="c"><input type="checkbox" id="c-42286952" checked=""/><div class="controls bullet"><span class="by">tempodox</span><span>|</span><a href="#42234425">parent</a><span>|</span><a href="#42243191">next</a><span>|</span><label class="collapse" for="c-42286952">[-]</label><label class="expand" for="c-42286952">[1 more]</label></div><br/><div class="children"><div class="content">That depends on the context.  In some cases you&#x27;re not allowed to physically delete because you need to provide an audit trail for 10 years or so.  You could move those rows into separate audit tables instead.  However, that requirement should not come as a surprise.</div><br/></div></div><div id="42243191" class="c"><input type="checkbox" id="c-42243191" checked=""/><div class="controls bullet"><span class="by">buildingcrash7</span><span>|</span><a href="#42234425">parent</a><span>|</span><a href="#42286952">prev</a><span>|</span><a href="#42233869">next</a><span>|</span><label class="collapse" for="c-42243191">[-]</label><label class="expand" for="c-42243191">[1 more]</label></div><br/><div class="children"><div class="content">&gt;software was first made the stakeholders&#x2F;product-org<p>Practically all building, physical and software is made for a purpose first, the process is mainly an obstacle that needs to be minimized. A piece of software is trying to solve a problem just like a door is. It&#x27;s driven by economics where the recipients don&#x27;t want to pay any more than they need to and someone is always willing to undercut you by cutting corners.</div><br/></div></div></div></div><div id="42233869" class="c"><input type="checkbox" id="c-42233869" checked=""/><div class="controls bullet"><span class="by">orionblastar</span><span>|</span><a href="#42234425">prev</a><span>|</span><label class="collapse" for="c-42233869">[-]</label><label class="expand" for="c-42233869">[3 more]</label></div><br/><div class="children"><div class="content">Most databases I used have a Status column we could mark as active, inactive, or deleted. That way, you can see what records were marked as deleted and change them back in case of accidental deletion.<p>Keep record retention with the Date_Modified column so you can use SQL delete to remove those deleted records that are older than a year or so.</div><br/><div id="42233998" class="c"><input type="checkbox" id="c-42233998" checked=""/><div class="controls bullet"><span class="by">arielcostas</span><span>|</span><a href="#42233869">parent</a><span>|</span><a href="#42287011">next</a><span>|</span><label class="collapse" for="c-42233998">[-]</label><label class="expand" for="c-42233998">[1 more]</label></div><br/><div class="children"><div class="content">I do something similar, but instead keep a &quot;date_deleted&quot; column null by default, and the &quot;active&quot; column as a boolean.<p>That way, I kill two birds in one stone by having a dedicated column for last deletion (instead of updating a record that is supposedly deleted) and the status just as a boolean instead of some enum, or integer or string.</div><br/></div></div><div id="42287011" class="c"><input type="checkbox" id="c-42287011" checked=""/><div class="controls bullet"><span class="by">alexanderscott</span><span>|</span><a href="#42233869">parent</a><span>|</span><a href="#42233998">prev</a><span>|</span><label class="collapse" for="c-42287011">[-]</label><label class="expand" for="c-42287011">[1 more]</label></div><br/><div class="children"><div class="content">this is a “soft delete”. as the author notes, depending on the nature of the data being stored a soft delete does not meet the requirements of many data privacy laws and compliance regulations (like GDPR’s right to erasure).</div><br/></div></div></div></div></div></div></div></div></div></body></html>