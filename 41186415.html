<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1723107666744" as="style"/><link rel="stylesheet" href="styles.css?v=1723107666744"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cheriot.org/cheri/2024/08/06/how-to-talk-about-CHERI.html">How to talk to your parents about hardware memory safety (CHERI)</a> <span class="domain">(<a href="https://cheriot.org">cheriot.org</a>)</span></div><div class="subtext"><span>miloignis</span> | <span>18 comments</span></div><br/><div><div id="41187982" class="c"><input type="checkbox" id="c-41187982" checked=""/><div class="controls bullet"><span class="by">alberth</span><span>|</span><a href="#41187926">next</a><span>|</span><label class="collapse" for="c-41187982">[-]</label><label class="expand" for="c-41187982">[16 more]</label></div><br/><div class="children"><div class="content">Why has Apple not brought this kind of hardware&#x2F;software memory safety to their platform?<p>They control the entire stack, even down to the silicon.</div><br/><div id="41188065" class="c"><input type="checkbox" id="c-41188065" checked=""/><div class="controls bullet"><span class="by">chc4</span><span>|</span><a href="#41187982">parent</a><span>|</span><a href="#41188104">next</a><span>|</span><label class="collapse" for="c-41188065">[-]</label><label class="expand" for="c-41188065">[7 more]</label></div><br/><div class="children"><div class="content">CHERI is a research project currently. It has a number of large outstanding issues - CHERI essentially needs to do a whole-system stop-the-world garbage collection phase for precise tag revocation in order to avoid non-stochiastic temporal safety, iirc, which is alluded to in the OP as the &quot;revoker&quot; (google &quot;CHERIvoke sweep&quot;) - and is still under active research. It is not something that can just be rolled out to production on one of the highest profile devices in the world. Porting code to run on CHERI, especially if you want to actually use the security features it provides, is also a large undertaking, and would be a massive userspace change. Apple is doing a lot of very good work in similar spaces, between PAC and FireBloom and related security measures, but there&#x27;s a very big difference between that and CHERI.</div><br/><div id="41188117" class="c"><input type="checkbox" id="c-41188117" checked=""/><div class="controls bullet"><span class="by">jrtc27</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188065">parent</a><span>|</span><a href="#41188089">next</a><span>|</span><label class="collapse" for="c-41188117">[-]</label><label class="expand" for="c-41188117">[3 more]</label></div><br/><div class="children"><div class="content">Stop-the-world is only brief, to scan the register file of each thread and any other capabilities held in the kernel (asynchronous I&#x2F;O, signal handlers, etc). Once done the entire memory sweep can be done concurrent with execution.<p>As for porting, it very much depends what you&#x27;re doing. Operating systems and language runtimes, especially those with JITs, have intimate knowledge of the architecture and like to play cute tricks with pointers, so those are disproportionately involved to port. General user code requires very little, if any, porting. In one study, a basic KDE+X11 desktop stack was ported to CHERI, seeing 0.026% LoC changes across 6 million LoC, or 1584 lines. It&#x27;s non-zero, and of course there is a lot of code out there so even a tiny fraction of it isn&#x27;t insignificant, but it is very small as these things go.</div><br/><div id="41188154" class="c"><input type="checkbox" id="c-41188154" checked=""/><div class="controls bullet"><span class="by">comex</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188117">parent</a><span>|</span><a href="#41188089">next</a><span>|</span><label class="collapse" for="c-41188154">[-]</label><label class="expand" for="c-41188154">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Stop-the-world is only brief, to scan the register file of each thread and any other capabilities held in the kernel (asynchronous I&#x2F;O, signal handlers, etc). Once done the entire memory sweep can be done concurrent with execution.<p>Is there documentation of the scheme that allows this?  I did some quick Googling and found CHERIvoke (which is not concurrent at all) and Cornucopia (which requires scanning some user pages while the world is stopped).  Are you referring to something newer?</div><br/><div id="41188186" class="c"><input type="checkbox" id="c-41188186" checked=""/><div class="controls bullet"><span class="by">chc4</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188154">parent</a><span>|</span><a href="#41188089">next</a><span>|</span><label class="collapse" for="c-41188186">[-]</label><label class="expand" for="c-41188186">[1 more]</label></div><br/><div class="children"><div class="content">The Cornucopia Reloaded link in the OP is actually to the paper implementing this, I think, which I hadn&#x27;t seen before.</div><br/></div></div></div></div></div></div><div id="41188089" class="c"><input type="checkbox" id="c-41188089" checked=""/><div class="controls bullet"><span class="by">bitwize</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188065">parent</a><span>|</span><a href="#41188117">prev</a><span>|</span><a href="#41188104">next</a><span>|</span><label class="collapse" for="c-41188089">[-]</label><label class="expand" for="c-41188089">[3 more]</label></div><br/><div class="children"><div class="content">&gt; CHERI essentially needs to do a whole-system stop-the-world garbage collection phase<p>So we really are reinventing the Lisp machine with extra steps.</div><br/><div id="41188204" class="c"><input type="checkbox" id="c-41188204" checked=""/><div class="controls bullet"><span class="by">teleforce</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188089">parent</a><span>|</span><a href="#41188256">next</a><span>|</span><label class="collapse" for="c-41188204">[-]</label><label class="expand" for="c-41188204">[1 more]</label></div><br/><div class="children"><div class="content">Have you read the article, it mentioned Lisp machine in the very first paragraph?</div><br/></div></div><div id="41188256" class="c"><input type="checkbox" id="c-41188256" checked=""/><div class="controls bullet"><span class="by">jazzyjackson</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188089">parent</a><span>|</span><a href="#41188204">prev</a><span>|</span><a href="#41188104">next</a><span>|</span><label class="collapse" for="c-41188256">[-]</label><label class="expand" for="c-41188256">[1 more]</label></div><br/><div class="children"><div class="content">there&#x27;s reinvention and then there&#x27;s innovation, wheels have come a long way since the bronze age</div><br/></div></div></div></div></div></div><div id="41188104" class="c"><input type="checkbox" id="c-41188104" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41187982">parent</a><span>|</span><a href="#41188065">prev</a><span>|</span><a href="#41188013">next</a><span>|</span><label class="collapse" for="c-41188104">[-]</label><label class="expand" for="c-41188104">[4 more]</label></div><br/><div class="children"><div class="content">You really want them to?<p>It&#x27;ll be the end of jailbreaking, and another step towards the dystopian digital totalitarianism Stallman warned us about.<p>[To those who think there will still be alternatives: do you not think they&#x27;ll also follow, under the threat of being called &quot;insecure&quot; and &quot;unsafe&quot;?]</div><br/><div id="41188973" class="c"><input type="checkbox" id="c-41188973" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188104">parent</a><span>|</span><a href="#41188278">next</a><span>|</span><label class="collapse" for="c-41188973">[-]</label><label class="expand" for="c-41188973">[1 more]</label></div><br/><div class="children"><div class="content">You’re talking about a depressing future and all I’m hearing is a depressing present where you think the best way to fight for software freedom is to ensure people get hacked rather than, like, actual policies designed around giving control back to users. I can think of few things less empowering than software that is designed to be intentionally worse for an auxiliary side benefit because we can’t get our act together and figure out a real way to manifest what we actually want.</div><br/></div></div><div id="41188278" class="c"><input type="checkbox" id="c-41188278" checked=""/><div class="controls bullet"><span class="by">jazzyjackson</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188104">parent</a><span>|</span><a href="#41188973">prev</a><span>|</span><a href="#41188013">next</a><span>|</span><label class="collapse" for="c-41188278">[-]</label><label class="expand" for="c-41188278">[2 more]</label></div><br/><div class="children"><div class="content">What does jailbreaking have to do with memory safety? I thought the cpu that will only boot signed binaries was the end of jailbreaking<p>I, for one, would appreciate a device that isn&#x27;t riddled with memory bugs that are exploitable principally by nation states; one might say buggy code <i>is</i> the backdoor free software folk are so paranoid about</div><br/><div id="41189371" class="c"><input type="checkbox" id="c-41189371" checked=""/><div class="controls bullet"><span class="by">supriyo-biswas</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188278">parent</a><span>|</span><a href="#41188013">next</a><span>|</span><label class="collapse" for="c-41189371">[-]</label><label class="expand" for="c-41189371">[1 more]</label></div><br/><div class="children"><div class="content">Most jailbreaks and rooting software rely on some exploitable bugs to gain their initial foothold and install&#x2F;modify files onto the system.</div><br/></div></div></div></div></div></div><div id="41188013" class="c"><input type="checkbox" id="c-41188013" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#41187982">parent</a><span>|</span><a href="#41188104">prev</a><span>|</span><a href="#41187926">next</a><span>|</span><label class="collapse" for="c-41188013">[-]</label><label class="expand" for="c-41188013">[4 more]</label></div><br/><div class="children"><div class="content">The overhead of 128-bit pointers is a pretty big downside, I&#x27;d imagine, especially with only 8 GB of RAM on some models. Also, it confuses any code that assumes you can convert a pointer to a long (or long long) and back.</div><br/><div id="41188271" class="c"><input type="checkbox" id="c-41188271" checked=""/><div class="controls bullet"><span class="by">jazzyjackson</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188013">parent</a><span>|</span><a href="#41187926">next</a><span>|</span><label class="collapse" for="c-41188271">[-]</label><label class="expand" for="c-41188271">[3 more]</label></div><br/><div class="children"><div class="content">this is above my head but just wanted to mention that apple m chips have 128bit registers, tho I don&#x27;t know if that means anything wrt the overhead</div><br/><div id="41188983" class="c"><input type="checkbox" id="c-41188983" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188271">parent</a><span>|</span><a href="#41188329">next</a><span>|</span><label class="collapse" for="c-41188983">[-]</label><label class="expand" for="c-41188983">[1 more]</label></div><br/><div class="children"><div class="content">You will note that they have fewer of those and expose them in much more limited ways.</div><br/></div></div><div id="41188329" class="c"><input type="checkbox" id="c-41188329" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#41187982">root</a><span>|</span><a href="#41188271">parent</a><span>|</span><a href="#41188983">prev</a><span>|</span><a href="#41187926">next</a><span>|</span><label class="collapse" for="c-41188329">[-]</label><label class="expand" for="c-41188329">[1 more]</label></div><br/><div class="children"><div class="content">I mean the extra 8 bytes of RAM per pointer, every time you store an object in memory that refers to another object, or that points to a vtable. No amount of register size will get around that.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>