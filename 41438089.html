<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1725699671405" as="style"/><link rel="stylesheet" href="styles.css?v=1725699671405"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.freedomlayer.org/offset/option-iterator/">Creating an empty iterator of a certain type in Rust (2018)</a> <span class="domain">(<a href="https://www.freedomlayer.org">www.freedomlayer.org</a>)</span></div><div class="subtext"><span>airstrike</span> | <span>8 comments</span></div><br/><div><div id="41471852" class="c"><input type="checkbox" id="c-41471852" checked=""/><div class="controls bullet"><span class="by">kd5bjo</span><span>|</span><a href="#41471990">next</a><span>|</span><label class="collapse" for="c-41471852">[-]</label><label class="expand" for="c-41471852">[1 more]</label></div><br/><div class="children"><div class="content">Because `OptionIterator` implements the `Iterator` trait, the function signature can be simplified to return just `impl Iterator&lt;…&gt;` like the original version did, leaving the additional type as an implementation detail.<p>Also, a similar solution is provided by the `either` crate [1], where the function body can return `Either::Left(std::iter::empty())` in one case and `Either::Right(…)` in the other, also hiding all of this behind an `impl Iterator&lt;…&gt;` return type.<p>[1] <a href="https:&#x2F;&#x2F;docs.rs&#x2F;either&#x2F;latest&#x2F;either&#x2F;enum.Either.html" rel="nofollow">https:&#x2F;&#x2F;docs.rs&#x2F;either&#x2F;latest&#x2F;either&#x2F;enum.Either.html</a></div><br/></div></div><div id="41471990" class="c"><input type="checkbox" id="c-41471990" checked=""/><div class="controls bullet"><span class="by">kawogi</span><span>|</span><a href="#41471852">prev</a><span>|</span><a href="#41472282">next</a><span>|</span><label class="collapse" for="c-41471990">[-]</label><label class="expand" for="c-41471990">[1 more]</label></div><br/><div class="children"><div class="content">&gt; However, this solution is not very ergonomic, as it requires the user of the function to first check if the returned value is Some(iterator) and only then iterate over the iterator.<p>I&#x27;d use `flatten()` to iterate over this nested type.</div><br/></div></div><div id="41472282" class="c"><input type="checkbox" id="c-41472282" checked=""/><div class="controls bullet"><span class="by">sk11001</span><span>|</span><a href="#41471990">prev</a><span>|</span><a href="#41471708">next</a><span>|</span><label class="collapse" for="c-41472282">[-]</label><label class="expand" for="c-41472282">[3 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand the people who look at this and go &quot;yep, we should have more of this language&quot;. It&#x27;s complexity for its own sake.</div><br/><div id="41472408" class="c"><input type="checkbox" id="c-41472408" checked=""/><div class="controls bullet"><span class="by">ryanjshaw</span><span>|</span><a href="#41472282">parent</a><span>|</span><a href="#41471708">next</a><span>|</span><label class="collapse" for="c-41472408">[-]</label><label class="expand" for="c-41472408">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m really confused... Is all of this just the equivalent of `Enumerable.Empty&lt;T&gt;` or `yield return` in C#?</div><br/><div id="41472474" class="c"><input type="checkbox" id="c-41472474" checked=""/><div class="controls bullet"><span class="by">sk11001</span><span>|</span><a href="#41472282">root</a><span>|</span><a href="#41472408">parent</a><span>|</span><a href="#41471708">next</a><span>|</span><label class="collapse" for="c-41472474">[-]</label><label class="expand" for="c-41472474">[1 more]</label></div><br/><div class="children"><div class="content">So you do agree that other languages achieve the same thing with much less complexity?</div><br/></div></div></div></div></div></div><div id="41471708" class="c"><input type="checkbox" id="c-41471708" checked=""/><div class="controls bullet"><span class="by">claytonwramsey</span><span>|</span><a href="#41472282">prev</a><span>|</span><a href="#41472293">next</a><span>|</span><label class="collapse" for="c-41471708">[-]</label><label class="expand" for="c-41471708">[1 more]</label></div><br/><div class="children"><div class="content">Another possible solution for this use case: let each capacity graph store a “dummy” `HashMap&lt;N,(u128, u128)&gt;` for the case where the key is missing. Then, return an iterator over the empty dummy to get an iterator of the same type.<p>I will however note that simply using an option in the return value is probably the best choice both API- and performance-wise. The consumer may want to do different things if the key doesn’t exist versus if the key has no neighbors. Additionally, returning an Option means there’s only one check for whether the retrieval was correct, rather than checking at every call to `next`.</div><br/></div></div><div id="41472293" class="c"><input type="checkbox" id="c-41472293" checked=""/><div class="controls bullet"><span class="by">Patryk27</span><span>|</span><a href="#41471708">prev</a><span>|</span><label class="collapse" for="c-41472293">[-]</label><label class="expand" for="c-41472293">[1 more]</label></div><br/><div class="children"><div class="content">fwiw, Option already implements iterator (well, IntoIterator) - calling .into_iter() on an Option will get you an iterator, no need to create anything custom.</div><br/></div></div></div></div></div></div></div></body></html>