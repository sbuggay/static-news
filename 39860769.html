<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1711702870159" as="style"/><link rel="stylesheet" href="styles.css?v=1711702870159"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://infisical.com/blog/postgresql-migration-technical">The Great Migration from MongoDB to PostgreSQL</a> <span class="domain">(<a href="https://infisical.com">infisical.com</a>)</span></div><div class="subtext"><span>thunderbong</span> | <span>29 comments</span></div><br/><div><div id="39861656" class="c"><input type="checkbox" id="c-39861656" checked=""/><div class="controls bullet"><span class="by">renegade-otter</span><span>|</span><a href="#39861885">next</a><span>|</span><label class="collapse" for="c-39861656">[-]</label><label class="expand" for="c-39861656">[1 more]</label></div><br/><div class="children"><div class="content">The irony of it all is that MongoDB actually matured and you do not have to jump through hoops to have, say, transactions.<p>I am ALL for Postgres, I even wrote a post about the importance of being fluent in relational databases: <a href="https:&#x2F;&#x2F;renegadeotter.com&#x2F;2023&#x2F;11&#x2F;12&#x2F;your-database-skills-are-not-good-to-have.html" rel="nofollow">https:&#x2F;&#x2F;renegadeotter.com&#x2F;2023&#x2F;11&#x2F;12&#x2F;your-database-skills-ar...</a><p>What grinds my gears is the whiplash caused by this frantic stampede from one hype to the next.<p>I am just waiting for the AI hype to blow over and for everyone to rediscover Hadoop, or something.</div><br/></div></div><div id="39861885" class="c"><input type="checkbox" id="c-39861885" checked=""/><div class="controls bullet"><span class="by">namaria</span><span>|</span><a href="#39861656">prev</a><span>|</span><a href="#39861251">next</a><span>|</span><label class="collapse" for="c-39861885">[-]</label><label class="expand" for="c-39861885">[1 more]</label></div><br/><div class="children"><div class="content">&gt; As part of that stack, we chose MongoDB + Mongoose ORM because the combination presented least overhead and allowed us to ship quality features quickly. As Sir Tony Hoare states, “premature optimization is the root of all evil,” and there was certainly no need for further optimization at the time.<p>I find it interesting that one sentence claims they made an optimal choice for feature delivery speed, and the next one that they rationalized it as &quot;non optimal as prescribed by Hoare&quot;. Never mind the fact that three sentences down the original quote Hoare said &quot;It is often a mistake to make a priori judgments about what parts of a program are really critical, since the universal experience of programmers who have been using measurement tools has been that their intuitive guesses fail.&quot;</div><br/></div></div><div id="39861251" class="c"><input type="checkbox" id="c-39861251" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#39861885">prev</a><span>|</span><a href="#39861662">next</a><span>|</span><label class="collapse" for="c-39861251">[-]</label><label class="expand" for="c-39861251">[4 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t doubt there are real benefits for them to switch but BTW this is not true:<p>&gt; Difficulty configuring database transactions: With MongoDB, setting up transactions was not trivial because it required running MongoDB in cluster mode with various configuration overhead; this made it extremely difficult, for instance, for customers to run a simple POC of Infisical because it required a production setup of MongoDB.<p>You can run single instance in clustered mode, just a single-instance replica set. You get the oplog, transactions, etc. No advanced configuration required.</div><br/><div id="39861566" class="c"><input type="checkbox" id="c-39861566" checked=""/><div class="controls bullet"><span class="by">blue_pants</span><span>|</span><a href="#39861251">parent</a><span>|</span><a href="#39861441">next</a><span>|</span><label class="collapse" for="c-39861566">[-]</label><label class="expand" for="c-39861566">[2 more]</label></div><br/><div class="children"><div class="content">Are there any disadvantages to using transactions with a single-instance replica set?</div><br/><div id="39861878" class="c"><input type="checkbox" id="c-39861878" checked=""/><div class="controls bullet"><span class="by">ammo1662</span><span>|</span><a href="#39861251">root</a><span>|</span><a href="#39861566">parent</a><span>|</span><a href="#39861441">next</a><span>|</span><label class="collapse" for="c-39861878">[-]</label><label class="expand" for="c-39861878">[1 more]</label></div><br/><div class="children"><div class="content">We run a single instance replica set for three years in a small application for its transaction function.<p>The only difference we noticed is the additional replica set setting for a new instance. No other disadvantages are found.</div><br/></div></div></div></div><div id="39861441" class="c"><input type="checkbox" id="c-39861441" checked=""/><div class="controls bullet"><span class="by">vasco</span><span>|</span><a href="#39861251">parent</a><span>|</span><a href="#39861566">prev</a><span>|</span><a href="#39861662">next</a><span>|</span><label class="collapse" for="c-39861441">[-]</label><label class="expand" for="c-39861441">[1 more]</label></div><br/><div class="children"><div class="content">And this has been possible for many years.</div><br/></div></div></div></div><div id="39861662" class="c"><input type="checkbox" id="c-39861662" checked=""/><div class="controls bullet"><span class="by">bsaul</span><span>|</span><a href="#39861251">prev</a><span>|</span><a href="#39861387">next</a><span>|</span><label class="collapse" for="c-39861662">[-]</label><label class="expand" for="c-39861662">[2 more]</label></div><br/><div class="children"><div class="content">is it still difficult to create a cluster of pg dbs. either for redundancy or speed ?<p>Last time i advocated for using pg vs mongodb, the person replied that mongodb clustering was super easy.</div><br/><div id="39861801" class="c"><input type="checkbox" id="c-39861801" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#39861662">parent</a><span>|</span><a href="#39861387">next</a><span>|</span><label class="collapse" for="c-39861801">[-]</label><label class="expand" for="c-39861801">[1 more]</label></div><br/><div class="children"><div class="content">Mongo absolutely can be the right answer if you need to horizontally scale to tens or hundreds of TBs. Anything below that I’d rather have a small cluster of big Postgres instances. There’s value in a SQL RDBMS which you just don’t get anywhere else.</div><br/></div></div></div></div><div id="39861387" class="c"><input type="checkbox" id="c-39861387" checked=""/><div class="controls bullet"><span class="by">paulmd</span><span>|</span><a href="#39861662">prev</a><span>|</span><a href="#39861342">next</a><span>|</span><label class="collapse" for="c-39861387">[-]</label><label class="expand" for="c-39861387">[5 more]</label></div><br/><div class="children"><div class="content">In this world you either evolve to Elastic&#x2F;Cassandra&#x2F;etc or return to Postgres :crab:<p>You really gotta search your soul and ask yourself: your cool idea really a database, or just a plugin for Postgres? And the answer is often the latter.</div><br/><div id="39861548" class="c"><input type="checkbox" id="c-39861548" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#39861387">parent</a><span>|</span><a href="#39861342">next</a><span>|</span><label class="collapse" for="c-39861548">[-]</label><label class="expand" for="c-39861548">[4 more]</label></div><br/><div class="children"><div class="content">The problem is that postgres is not a replacement. The JSON operations are not atomic which is terrible. If you wanna use PG that&#x27;s cool, but I&#x27;d suggest just avoiding JSON.</div><br/><div id="39861615" class="c"><input type="checkbox" id="c-39861615" checked=""/><div class="controls bullet"><span class="by">radiospiel</span><span>|</span><a href="#39861387">root</a><span>|</span><a href="#39861548">parent</a><span>|</span><a href="#39861577">next</a><span>|</span><label class="collapse" for="c-39861615">[-]</label><label class="expand" for="c-39861615">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The JSON operations are not atomic<p>I hear this today the first time. What exactly os not atomic, and is there a resource with more details?</div><br/><div id="39861920" class="c"><input type="checkbox" id="c-39861920" checked=""/><div class="controls bullet"><span class="by">adastral</span><span>|</span><a href="#39861387">root</a><span>|</span><a href="#39861615">parent</a><span>|</span><a href="#39861577">next</a><span>|</span><label class="collapse" for="c-39861920">[-]</label><label class="expand" for="c-39861920">[1 more]</label></div><br/><div class="children"><div class="content">Not sure if this is what the above comment means by &quot;atomic&quot;, but a shortcoming of Postgres&#x27; JSON support is that it will have to rewrite an entire JSON object every time a part of it gets updated, no matter how many keys the update really affected. E.g. if I update an integer in a 100MB JSON object, Postgres will write ~100MB (plus WAL, TOAST overhead, etc.), not just a few bytes. I imagine this can be a no-go for certain use cases.</div><br/></div></div></div></div><div id="39861577" class="c"><input type="checkbox" id="c-39861577" checked=""/><div class="controls bullet"><span class="by">mulmboy</span><span>|</span><a href="#39861387">root</a><span>|</span><a href="#39861548">parent</a><span>|</span><a href="#39861615">prev</a><span>|</span><a href="#39861342">next</a><span>|</span><label class="collapse" for="c-39861577">[-]</label><label class="expand" for="c-39861577">[1 more]</label></div><br/><div class="children"><div class="content">How are JSON operations not atomic? Genuinely curious</div><br/></div></div></div></div></div></div><div id="39861342" class="c"><input type="checkbox" id="c-39861342" checked=""/><div class="controls bullet"><span class="by">CoastalCoder</span><span>|</span><a href="#39861387">prev</a><span>|</span><a href="#39860858">next</a><span>|</span><label class="collapse" for="c-39861342">[-]</label><label class="expand" for="c-39861342">[2 more]</label></div><br/><div class="children"><div class="content">Obligatory parody link: <a href="https:&#x2F;&#x2F;youtu.be&#x2F;HdnDXsqiPYo" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;HdnDXsqiPYo</a></div><br/><div id="39861910" class="c"><input type="checkbox" id="c-39861910" checked=""/><div class="controls bullet"><span class="by">anticristi</span><span>|</span><a href="#39861342">parent</a><span>|</span><a href="#39860858">next</a><span>|</span><label class="collapse" for="c-39861910">[-]</label><label class="expand" for="c-39861910">[1 more]</label></div><br/><div class="children"><div class="content">:)))<p>I find the super-plain voice of the annoyed character further amplifies the humor.</div><br/></div></div></div></div><div id="39860858" class="c"><input type="checkbox" id="c-39860858" checked=""/><div class="controls bullet"><span class="by">p-e-w</span><span>|</span><a href="#39861342">prev</a><span>|</span><label class="collapse" for="c-39860858">[-]</label><label class="expand" for="c-39860858">[13 more]</label></div><br/><div class="children"><div class="content">At some point during the past 10 years or so, the world realized that document databases are actually a bad idea, and relational databases can do the same job better with just a few easy-to-implement QoL improvements (such as JSON operators in SQL).<p>Meanwhile MongoDB&#x27;s creators thought this was a great time to make Mongo non-free software, presumably with the goal of making a quick buck from cloud operators.<p>The result is pretty much the landscape we are seeing today, with Postgres reigning supreme, and even SQLite being experimented with in server setups, while Mongo is on life support and MySQL not far behind.</div><br/><div id="39860890" class="c"><input type="checkbox" id="c-39860890" checked=""/><div class="controls bullet"><span class="by">vmatsiiako</span><span>|</span><a href="#39860858">parent</a><span>|</span><a href="#39861502">next</a><span>|</span><label class="collapse" for="c-39860890">[-]</label><label class="expand" for="c-39860890">[11 more]</label></div><br/><div class="children"><div class="content">I wouldn&#x27;t say &quot;Mongo is on life support&quot; – it&#x27;s actually a very successful business growing 30% YoY on a massive scale. Yet, I agree that the license switch has definitely damaged their long-term ecosystem.</div><br/><div id="39860940" class="c"><input type="checkbox" id="c-39860940" checked=""/><div class="controls bullet"><span class="by">smt88</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39860890">parent</a><span>|</span><a href="#39861502">next</a><span>|</span><label class="collapse" for="c-39860940">[-]</label><label class="expand" for="c-39860940">[10 more]</label></div><br/><div class="children"><div class="content">They grew 30% if you look at revenue, but that&#x27;s not how people determine whether a business is healthy.<p>EBITDA is a better metric, and that number was getting dramatically worse every year until 2023.<p>But even in 2023, EBITDA was -$202M. I don&#x27;t see it ever approaching $0.<p>So it&#x27;s still a shit business on top of a shit product that no one ever really needed.</div><br/><div id="39861825" class="c"><input type="checkbox" id="c-39861825" checked=""/><div class="controls bullet"><span class="by">rrr_oh_man</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39860940">parent</a><span>|</span><a href="#39861397">next</a><span>|</span><label class="collapse" for="c-39861825">[-]</label><label class="expand" for="c-39861825">[1 more]</label></div><br/><div class="children"><div class="content">I was totally expecting someone to come up with some vanity metric here, but a negative EBITDA of several HUNDRED MILLION? Jesus. How did that happen. B2B business should be a symphony of ka-chings for them.</div><br/></div></div><div id="39861397" class="c"><input type="checkbox" id="c-39861397" checked=""/><div class="controls bullet"><span class="by">otabdeveloper4</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39860940">parent</a><span>|</span><a href="#39861825">prev</a><span>|</span><a href="#39861645">next</a><span>|</span><label class="collapse" for="c-39861397">[-]</label><label class="expand" for="c-39861397">[1 more]</label></div><br/><div class="children"><div class="content">MongoDB is great if what you need is a replicated log or queue. It&#x27;s what Kafka should have been.</div><br/></div></div><div id="39861645" class="c"><input type="checkbox" id="c-39861645" checked=""/><div class="controls bullet"><span class="by">Joel_Mckay</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39860940">parent</a><span>|</span><a href="#39861397">prev</a><span>|</span><a href="#39861426">next</a><span>|</span><label class="collapse" for="c-39861645">[-]</label><label class="expand" for="c-39861645">[1 more]</label></div><br/><div class="children"><div class="content">I think anyone who administers mongodb would agree it has a list of very dangerous behaviors for novices.<p>Try to upgrade a running instance node between some versions, and one may thrash  object keys or worse. Best to dump and re-load your data every major upgrade to recover all set properties... and there still may be slight differences in the query language later. Wait, your data sets are 1.5TiB per node.... that is a lot of downtime...<p>The cursor, projection, and re-format queries can be very good at reducing reporting traffic.   However, the 3 page long syntax can be unreadable to the uninitiated.  The json essentially jams a bunch of equivalent SQL queries in 1 transaction, but you still have to be careful as there is no real guarantee of ordering without auto-indices in clusters.<p>mongodb is not as clean as SQL, but works for storing constantly changing meta data. i.e. if you find your SQL schema ends up with tuples that have a lot of poorly designed null entries, table edits, and or simply implements an object storage class abstraction in massive meta-data and object-class catch-all tables.<p>And yes, the mongodb new licensing model telegraphs an unfavorable policy posture. However, I do understand not wanting fortune 500 companies exploiting your teams time for free.<p>Profit is not an indication of quality, but rather fiscal utility. ;-)</div><br/></div></div><div id="39861426" class="c"><input type="checkbox" id="c-39861426" checked=""/><div class="controls bullet"><span class="by">basil-rash</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39860940">parent</a><span>|</span><a href="#39861645">prev</a><span>|</span><a href="#39861502">next</a><span>|</span><label class="collapse" for="c-39861426">[-]</label><label class="expand" for="c-39861426">[6 more]</label></div><br/><div class="children"><div class="content">Why do you choose EBITDA? Last I heard it was utter nonsense”, at least according to Warren Buffet.<p><a href="https:&#x2F;&#x2F;m.youtube.com&#x2F;watch?v=tvnKylAyLbQ" rel="nofollow">https:&#x2F;&#x2F;m.youtube.com&#x2F;watch?v=tvnKylAyLbQ</a></div><br/><div id="39861917" class="c"><input type="checkbox" id="c-39861917" checked=""/><div class="controls bullet"><span class="by">blitzar</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39861426">parent</a><span>|</span><a href="#39861486">next</a><span>|</span><label class="collapse" for="c-39861917">[-]</label><label class="expand" for="c-39861917">[1 more]</label></div><br/><div class="children"><div class="content">People who use EBITDA are either trying to con you or they&#x27;re conning themselves.</div><br/></div></div><div id="39861486" class="c"><input type="checkbox" id="c-39861486" checked=""/><div class="controls bullet"><span class="by">roenxi</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39861426">parent</a><span>|</span><a href="#39861917">prev</a><span>|</span><a href="#39861501">next</a><span>|</span><label class="collapse" for="c-39861486">[-]</label><label class="expand" for="c-39861486">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;d probably save time if you directly suggest what income metric you want to use. In the video, Buffet is basically saying he cares about income <i>after</i> interest, tax, depreciation and amortisation. In other words, that he cares about actual income. That&#x27;d be very on-brand for Buffet.<p>That measure won&#x27;t be good for MongoDB Inc. either; they&#x27;ve been millions in the red for years. Losing $100 million in a year would be the best result they&#x27;ve achieved in a while now.</div><br/></div></div><div id="39861501" class="c"><input type="checkbox" id="c-39861501" checked=""/><div class="controls bullet"><span class="by">jpgvm</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39861426">parent</a><span>|</span><a href="#39861486">prev</a><span>|</span><a href="#39861485">next</a><span>|</span><label class="collapse" for="c-39861501">[-]</label><label class="expand" for="c-39861501">[1 more]</label></div><br/><div class="children"><div class="content">Buffets point is that it can be gamed to look good. In this case even if they are gaming it to look better than it is.... well it&#x27;s still awful.</div><br/></div></div><div id="39861485" class="c"><input type="checkbox" id="c-39861485" checked=""/><div class="controls bullet"><span class="by">phonon</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39861426">parent</a><span>|</span><a href="#39861501">prev</a><span>|</span><a href="#39861502">next</a><span>|</span><label class="collapse" for="c-39861485">[-]</label><label class="expand" for="c-39861485">[2 more]</label></div><br/><div class="children"><div class="content">Their &quot;Comprehensive Losses&quot; for the last 3 years are (in thousands)<p>(171,150)<p>(343,375)<p>(309,090)<p>So there you go...</div><br/><div id="39861783" class="c"><input type="checkbox" id="c-39861783" checked=""/><div class="controls bullet"><span class="by">librasteve</span><span>|</span><a href="#39860858">root</a><span>|</span><a href="#39861485">parent</a><span>|</span><a href="#39861502">next</a><span>|</span><label class="collapse" for="c-39861783">[-]</label><label class="expand" for="c-39861783">[1 more]</label></div><br/><div class="children"><div class="content">they lost 300 million in one year?</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39861502" class="c"><input type="checkbox" id="c-39861502" checked=""/><div class="controls bullet"><span class="by">MrBuddyCasino</span><span>|</span><a href="#39860858">parent</a><span>|</span><a href="#39860890">prev</a><span>|</span><label class="collapse" for="c-39861502">[-]</label><label class="expand" for="c-39861502">[1 more]</label></div><br/><div class="children"><div class="content">I‘m not sure that is the case. What I‘m seeing is that people  use the cloud-native document stores such as DynamoDB instead of Mongo. The only thing zoomers hate more than traditional SQL databases is XML.</div><br/></div></div></div></div></div></div></div></div></div></body></html>