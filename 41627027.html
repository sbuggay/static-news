<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727427659444" as="style"/><link rel="stylesheet" href="styles.css?v=1727427659444"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://tonygo.netlify.app//2024/anti-debugging-detection-with-fork/">Implementing and Detecting Anti-Debugging with Fork()</a>Â <span class="domain">(<a href="https://tonygo.netlify.app">tonygo.netlify.app</a>)</span></div><div class="subtext"><span>tonygo</span> | <span>10 comments</span></div><br/><div><div id="41666005" class="c"><input type="checkbox" id="c-41666005" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41665923">next</a><span>|</span><label class="collapse" for="c-41666005">[-]</label><label class="expand" for="c-41666005">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve seen this done on Windows using CreateProcess, although I believe it wasn&#x27;t specifically for anti-debugging purposes but instead a process that wanted to reinitialise itself from the beginning.<p>A far more effective actual anti-debugging technique is to have the parent become the debugger of the child, preventing any other debugger from attaching to it.</div><br/><div id="41666199" class="c"><input type="checkbox" id="c-41666199" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#41666005">parent</a><span>|</span><a href="#41665923">next</a><span>|</span><label class="collapse" for="c-41666199">[-]</label><label class="expand" for="c-41666199">[2 more]</label></div><br/><div class="children"><div class="content">But then you can attach to the parent and cause it to stop debugging the child so you can.  I think you want a process to be its own debugger; idk if ptrace(2) allows that.  Then there&#x27;s things like DTrace and eBPF -- I don&#x27;t think you can prevent them from the target.</div><br/><div id="41667423" class="c"><input type="checkbox" id="c-41667423" checked=""/><div class="controls bullet"><span class="by">tonygo</span><span>|</span><a href="#41666005">root</a><span>|</span><a href="#41666199">parent</a><span>|</span><a href="#41665923">next</a><span>|</span><label class="collapse" for="c-41667423">[-]</label><label class="expand" for="c-41667423">[1 more]</label></div><br/><div class="children"><div class="content">&gt; A far more effective actual anti-debugging technique is to have the parent become the debugger of the child,<p>Do you have example of that? I am really curious, thanks for sharing tho :)</div><br/></div></div></div></div></div></div><div id="41665923" class="c"><input type="checkbox" id="c-41665923" checked=""/><div class="controls bullet"><span class="by">a_t48</span><span>|</span><a href="#41666005">prev</a><span>|</span><a href="#41666948">next</a><span>|</span><label class="collapse" for="c-41665923">[-]</label><label class="expand" for="c-41665923">[4 more]</label></div><br/><div class="children"><div class="content">Does follow-fork-mode in lldb not also defeat this?</div><br/><div id="41667530" class="c"><input type="checkbox" id="c-41667530" checked=""/><div class="controls bullet"><span class="by">tonygo</span><span>|</span><a href="#41665923">parent</a><span>|</span><a href="#41666178">next</a><span>|</span><label class="collapse" for="c-41667530">[-]</label><label class="expand" for="c-41667530">[2 more]</label></div><br/><div class="children"><div class="content">I tried with LLDB using `settings set target.process.follow-fork-mode child` but for some reasons I feel like it still exit from the parent process.<p>I also tried with a long living process: <a href="https:&#x2F;&#x2F;github.com&#x2F;tony-go&#x2F;antidebug-examples&#x2F;tree&#x2F;main&#x2F;swift">https:&#x2F;&#x2F;github.com&#x2F;tony-go&#x2F;antidebug-examples&#x2F;tree&#x2F;main&#x2F;swif...</a><p>And I got this:<p>```
(lldb) run
Process 14345 launched: &#x27;&#x2F;anti-debug&#x2F;swift&#x2F;build&#x2F;anti_debug&#x27; (arm64)
start pid = 14345
exit parent process for child pid = 14348
continue as child process pid = 14348
Process 14345 exited with status = 0 (0x00000000)
```<p>The UI did not even appeared as it should.<p>Maybe I miss something in my LLDB config...</div><br/><div id="41667542" class="c"><input type="checkbox" id="c-41667542" checked=""/><div class="controls bullet"><span class="by">tonygo</span><span>|</span><a href="#41665923">root</a><span>|</span><a href="#41667530">parent</a><span>|</span><a href="#41666178">next</a><span>|</span><label class="collapse" for="c-41667542">[-]</label><label class="expand" for="c-41667542">[1 more]</label></div><br/><div class="children"><div class="content">Also it could come from a messy thing in the code.</div><br/></div></div></div></div><div id="41666178" class="c"><input type="checkbox" id="c-41666178" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#41665923">parent</a><span>|</span><a href="#41667530">prev</a><span>|</span><a href="#41666948">next</a><span>|</span><label class="collapse" for="c-41666178">[-]</label><label class="expand" for="c-41666178">[1 more]</label></div><br/><div class="children"><div class="content">Yes.</div><br/></div></div></div></div><div id="41666948" class="c"><input type="checkbox" id="c-41666948" checked=""/><div class="controls bullet"><span class="by">pterorex</span><span>|</span><a href="#41665923">prev</a><span>|</span><a href="#41666177">next</a><span>|</span><label class="collapse" for="c-41666948">[-]</label><label class="expand" for="c-41666948">[1 more]</label></div><br/><div class="children"><div class="content">The more you  hate, the more you love.</div><br/></div></div></div></div></div></div></div></body></html>