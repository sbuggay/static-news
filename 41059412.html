<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1721898068683" as="style"/><link rel="stylesheet" href="styles.css?v=1721898068683"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://math.andrej.com/2024/01/30/space-filling-curves-constructively/">Space-filling curves, constructively</a> <span class="domain">(<a href="https://math.andrej.com">math.andrej.com</a>)</span></div><div class="subtext"><span>luu</span> | <span>22 comments</span></div><br/><div><div id="41061630" class="c"><input type="checkbox" id="c-41061630" checked=""/><div class="controls bullet"><span class="by">aguynamedben</span><span>|</span><a href="#41062290">next</a><span>|</span><label class="collapse" for="c-41061630">[-]</label><label class="expand" for="c-41061630">[8 more]</label></div><br/><div class="children"><div class="content">An interesting variant of space-filling curves + dimensionality reduction is Geohash (<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Geohash" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Geohash</a>, <a href="http:&#x2F;&#x2F;geohash.org&#x2F;" rel="nofollow">http:&#x2F;&#x2F;geohash.org&#x2F;</a>) which takes a lon&#x2F;lat and uses a Z-curve approach to produce a hash such as `u4pruydqqvj` representing the location. This hash value is basically &quot;how far along the space-filling curve is the lon&#x2F;lat located&quot;. You&#x27;re reducing two dimensions (lon&#x2F;lat) into one dimension (how far along the space-filling curve).<p>There&#x27;s a unique side-effect to Geohashes in that the value (`u4pruydqqvj`) can have it&#x27;s end &quot;lopped off&quot; (i.e. cut down to `u4pru`) and it still represents a less precise, but generally accurate representation of the original lon&#x2F;lat in most cases (when the curve isn&#x27;t near the edge of the 2d map!). This allows you to index locations (lat&#x2F;lon) using a string (&#x27;u4pru&#x27;) which opens you up to doing b-tree, range queries, etc. in traditional database, with one field.<p>Just a rad math quirk! I&#x27;m not an expert, and it&#x27;s a very dense book, but if someone really wants to get into this kind of stuff the &quot;Bible&quot; is &quot;Foundations of Multidimensional and Metric Data Structures&quot; by Hanan Samet.</div><br/><div id="41063131" class="c"><input type="checkbox" id="c-41063131" checked=""/><div class="controls bullet"><span class="by">anitil</span><span>|</span><a href="#41061630">parent</a><span>|</span><a href="#41065281">next</a><span>|</span><label class="collapse" for="c-41063131">[-]</label><label class="expand" for="c-41063131">[1 more]</label></div><br/><div class="children"><div class="content">They&#x27;re also useful for representing IPv4 space. Tom7 had a nice video where he does this after pinging the whole (IPv4) internet [0]<p>[0] <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;JcJSW7Rprio" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;JcJSW7Rprio</a> at about 6 minutes, though I recommend the whole thing.</div><br/></div></div><div id="41065281" class="c"><input type="checkbox" id="c-41065281" checked=""/><div class="controls bullet"><span class="by">xelxebar</span><span>|</span><a href="#41061630">parent</a><span>|</span><a href="#41063131">prev</a><span>|</span><a href="#41062394">next</a><span>|</span><label class="collapse" for="c-41065281">[-]</label><label class="expand" for="c-41065281">[1 more]</label></div><br/><div class="children"><div class="content">&gt; [I]t&#x27;s a very dense book, but if someone really wants to get into this kind of stuff the &quot;Bible&quot; is &quot;Foundations of Multidimensional and Metric Data Structures&quot; by Hanan Samet.<p>You&#x27;re not Kidding! 1022 pages, with a TOC that nests 4 layers deep. In particular, section 2.1.1.2 &quot;Ordering Space&quot; covers space-filling curves, and true to your description it covers every point brought up in the comments so far:<p>- Peano-Hilbert curve of OP<p>- Z-order curve mentioned<p>- &quot;Reverse locality&quot; issues<p>- Performance considerations of the mapping function<p>- Even 11 exercises for this section alone!<p>What a beastly reference. Thank you for sharing.</div><br/></div></div><div id="41062394" class="c"><input type="checkbox" id="c-41062394" checked=""/><div class="controls bullet"><span class="by">Sharlin</span><span>|</span><a href="#41061630">parent</a><span>|</span><a href="#41065281">prev</a><span>|</span><a href="#41064817">next</a><span>|</span><label class="collapse" for="c-41062394">[-]</label><label class="expand" for="c-41062394">[4 more]</label></div><br/><div class="children"><div class="content">The thing about SFC addressing is that two places near each other always share a prefix, and the closer they are, the longer the common prefix. It&#x27;s sort of like Gray coding. Quadtree addressing, for example, also has the property that you mentioned (as do, of course, normal lat&#x2F;long coordinates!) <i>but</i> two adjacent locations may not have similar addresses at all if they happen to straddle a subdivision boundary. (Again, compare to &quot;normal&quot; numbers where, say, |2000-1999| = 1 but there&#x27;s no common prefix at all!)</div><br/><div id="41063063" class="c"><input type="checkbox" id="c-41063063" checked=""/><div class="controls bullet"><span class="by">tomsmeding</span><span>|</span><a href="#41061630">root</a><span>|</span><a href="#41062394">parent</a><span>|</span><a href="#41063428">next</a><span>|</span><label class="collapse" for="c-41063063">[-]</label><label class="expand" for="c-41063063">[2 more]</label></div><br/><div class="children"><div class="content">The same happens, in fact, for space-filling curves. Sure, in _most_ of the area covered by the curve, closeness of points means closeness on the curve. But in this Hilbert curve:<p><a href="https:&#x2F;&#x2F;upload.wikimedia.org&#x2F;wikipedia&#x2F;commons&#x2F;7&#x2F;7c&#x2F;Hilbert-curve_rounded-gradient-animated.gif" rel="nofollow">https:&#x2F;&#x2F;upload.wikimedia.org&#x2F;wikipedia&#x2F;commons&#x2F;7&#x2F;7c&#x2F;Hilbert-...</a><p>Consider the two points on the curve straddling the middle of the top edge of the square. They are very close together, but their 1D addresses on the curve are very far apart (one close-ish to the beginning, and one close-ish to the end)!<p>There ain&#x27;t no free lunch.</div><br/><div id="41064362" class="c"><input type="checkbox" id="c-41064362" checked=""/><div class="controls bullet"><span class="by">Sharlin</span><span>|</span><a href="#41061630">root</a><span>|</span><a href="#41063063">parent</a><span>|</span><a href="#41063428">next</a><span>|</span><label class="collapse" for="c-41064362">[-]</label><label class="expand" for="c-41064362">[1 more]</label></div><br/><div class="children"><div class="content">Yes, you’re right, of course.</div><br/></div></div></div></div><div id="41063428" class="c"><input type="checkbox" id="c-41063428" checked=""/><div class="controls bullet"><span class="by">kittoes</span><span>|</span><a href="#41061630">root</a><span>|</span><a href="#41062394">parent</a><span>|</span><a href="#41063063">prev</a><span>|</span><a href="#41064817">next</a><span>|</span><label class="collapse" for="c-41063428">[-]</label><label class="expand" for="c-41063428">[1 more]</label></div><br/><div class="children"><div class="content">The boustrophedonic version of Rosenberg-Strong function is my favorite because it doesn&#x27;t have any such jumps and has better locality preserving qualities than most alternatives.<p>See <a href="https:&#x2F;&#x2F;hbfs.wordpress.com&#x2F;2018&#x2F;08&#x2F;07&#x2F;moeud-deux&#x2F;" rel="nofollow">https:&#x2F;&#x2F;hbfs.wordpress.com&#x2F;2018&#x2F;08&#x2F;07&#x2F;moeud-deux&#x2F;</a>.</div><br/></div></div></div></div><div id="41064817" class="c"><input type="checkbox" id="c-41064817" checked=""/><div class="controls bullet"><span class="by">mbo</span><span>|</span><a href="#41061630">parent</a><span>|</span><a href="#41062394">prev</a><span>|</span><a href="#41062290">next</a><span>|</span><label class="collapse" for="c-41064817">[-]</label><label class="expand" for="c-41064817">[1 more]</label></div><br/><div class="children"><div class="content">Protomaps (<a href="https:&#x2F;&#x2F;protomaps.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;protomaps.com&#x2F;</a>) uses this for their PMTiles HTTP range request lookups too right (<a href="https:&#x2F;&#x2F;docs.protomaps.com&#x2F;pmtiles&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.protomaps.com&#x2F;pmtiles&#x2F;</a>)?</div><br/></div></div></div></div><div id="41062290" class="c"><input type="checkbox" id="c-41062290" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#41061630">prev</a><span>|</span><a href="#41063185">next</a><span>|</span><label class="collapse" for="c-41062290">[-]</label><label class="expand" for="c-41062290">[2 more]</label></div><br/><div class="children"><div class="content">Space filling curves like Hilbert sound esoteric but they’re actually useful in for high performance database indexing.<p>DuckDB has a Hilbert index.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;rustyconover&#x2F;duckdb-lindel-extension">https:&#x2F;&#x2F;github.com&#x2F;rustyconover&#x2F;duckdb-lindel-extension</a><p>It’s not just DuckDB. SQL server and Postgres support Hilbert too.<p>The big idea is that you can project tuples e.g (lat, long) or just about any other tuple structure (string or floats) in a single integer, ordered in a way that is locality preserving.<p>Because most queries tend to lookup data close to each other, this can lead to performance gains. Parquet statistics can be built to be locality sensitive (locality defined broadly, not just numbers).<p>If you index on Hilbert, you can specific compute a max min of the Hilbert range of your predicate and eliminate looking outside that range, speeding up query performance.</div><br/><div id="41062769" class="c"><input type="checkbox" id="c-41062769" checked=""/><div class="controls bullet"><span class="by">CurtHagenlocher</span><span>|</span><a href="#41062290">parent</a><span>|</span><a href="#41063185">next</a><span>|</span><label class="collapse" for="c-41062769">[-]</label><label class="expand" for="c-41062769">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Liquid Clustering&quot; from Databricks also uses Hilbert curves.</div><br/></div></div></div></div><div id="41063185" class="c"><input type="checkbox" id="c-41063185" checked=""/><div class="controls bullet"><span class="by">j2kun</span><span>|</span><a href="#41062290">prev</a><span>|</span><a href="#41062925">next</a><span>|</span><label class="collapse" for="c-41063185">[-]</label><label class="expand" for="c-41063185">[2 more]</label></div><br/><div class="children"><div class="content">I read an entire book on applications of space filling curves, and none of the applications seemed to actually work as advertised (though perhaps they did at the time the book was written, I am skeptical).<p>All the stuff about database indexing and cache locality seems to have become obsolete with improvements in compilers; the overhead of computing the Hilbert curve indices is just too high. The indexing method that people seem to actually use is the Z-order&#x2F;Morton order, which just interleaves bits and is mathematically less interesting [1].<p>[1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Z-order_curve" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Z-order_curve</a></div><br/><div id="41065030" class="c"><input type="checkbox" id="c-41065030" checked=""/><div class="controls bullet"><span class="by">ashvardanian</span><span>|</span><a href="#41063185">parent</a><span>|</span><a href="#41062925">next</a><span>|</span><label class="collapse" for="c-41065030">[-]</label><label class="expand" for="c-41065030">[1 more]</label></div><br/><div class="children"><div class="content">Agreed. There are few practical applications of Space-Filling Curves, but readers may enjoy implementing Z-like and other curves in higher dimensions. Doing it efficiently can be one of those “weekend projects” that takes much longer in practice.</div><br/></div></div></div></div><div id="41062925" class="c"><input type="checkbox" id="c-41062925" checked=""/><div class="controls bullet"><span class="by">perone</span><span>|</span><a href="#41063185">prev</a><span>|</span><a href="#41063089">next</a><span>|</span><label class="collapse" for="c-41062925">[-]</label><label class="expand" for="c-41062925">[1 more]</label></div><br/><div class="children"><div class="content">I wrote an article about it and S2 some time ago as well for those interested: <a href="https:&#x2F;&#x2F;blog.christianperone.com&#x2F;2015&#x2F;08&#x2F;googles-s2-geometry-on-the-sphere-cells-and-hilbert-curve&#x2F;" rel="nofollow">https:&#x2F;&#x2F;blog.christianperone.com&#x2F;2015&#x2F;08&#x2F;googles-s2-geometry...</a></div><br/></div></div><div id="41063089" class="c"><input type="checkbox" id="c-41063089" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#41062925">prev</a><span>|</span><a href="#41064890">next</a><span>|</span><label class="collapse" for="c-41063089">[-]</label><label class="expand" for="c-41063089">[2 more]</label></div><br/><div class="children"><div class="content">One problem I’ve encountered is the inverse mapping is not necessarily locality preserving.<p>Hilbert maps (x,y) -&gt; h such that nearby h correspond to nearby x,y.<p>But the inverse isn’t true: similar x,y don’t always have similar h.<p>This is a problem for some applications where we are trying to find dense hot spots cheaply by only looking at h’s,  but turns out this doesn’t work out so well.</div><br/><div id="41063669" class="c"><input type="checkbox" id="c-41063669" checked=""/><div class="controls bullet"><span class="by">contravariant</span><span>|</span><a href="#41063089">parent</a><span>|</span><a href="#41064890">next</a><span>|</span><label class="collapse" for="c-41063669">[-]</label><label class="expand" for="c-41063669">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s an even stronger result. Every space filling curve&#x27;s inverse is necessarily not locality preserving.<p>Should an inverse exist that is continuous then 2D space would be homeomorphic to 1D, but they&#x27;re obviously different (if you want a proof, consider that removing a point from a line makes it disconnected while in 2D the space remains connected, now note that &#x27;connectedness&#x27; is preserved by homeomorphisms).</div><br/></div></div></div></div><div id="41064890" class="c"><input type="checkbox" id="c-41064890" checked=""/><div class="controls bullet"><span class="by">zholer</span><span>|</span><a href="#41063089">prev</a><span>|</span><a href="#41062991">next</a><span>|</span><label class="collapse" for="c-41064890">[-]</label><label class="expand" for="c-41064890">[1 more]</label></div><br/><div class="children"><div class="content">Drawing hilbert curves is especially great at evaluating the performance of online whiteboards!</div><br/></div></div><div id="41062991" class="c"><input type="checkbox" id="c-41062991" checked=""/><div class="controls bullet"><span class="by">JKCalhoun</span><span>|</span><a href="#41064890">prev</a><span>|</span><a href="#41063718">next</a><span>|</span><label class="collapse" for="c-41062991">[-]</label><label class="expand" for="c-41062991">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m imagining a physical world analog: shoving a bicycle chain into a shallow box until you can&#x27;t shove any more of the chain in.</div><br/></div></div><div id="41063718" class="c"><input type="checkbox" id="c-41063718" checked=""/><div class="controls bullet"><span class="by">brcmthrowaway</span><span>|</span><a href="#41062991">prev</a><span>|</span><a href="#41063692">next</a><span>|</span><label class="collapse" for="c-41063718">[-]</label><label class="expand" for="c-41063718">[2 more]</label></div><br/><div class="children"><div class="content">David Hilbert myst be the least German German name of all time.</div><br/><div id="41066168" class="c"><input type="checkbox" id="c-41066168" checked=""/><div class="controls bullet"><span class="by">kgwgk</span><span>|</span><a href="#41063718">parent</a><span>|</span><a href="#41063692">next</a><span>|</span><label class="collapse" for="c-41066168">[-]</label><label class="expand" for="c-41066168">[1 more]</label></div><br/><div class="children"><div class="content">How so? There are thousands of Herr and Fräulein Hilbert in Germany. Apparently it&#x27;s more frequent there than anywhere else.</div><br/></div></div></div></div><div id="41063692" class="c"><input type="checkbox" id="c-41063692" checked=""/><div class="controls bullet"><span class="by">brcmthrowaway</span><span>|</span><a href="#41063718">prev</a><span>|</span><label class="collapse" for="c-41063692">[-]</label><label class="expand" for="c-41063692">[2 more]</label></div><br/><div class="children"><div class="content">Has anyone made generative art with SFC?</div><br/><div id="41066364" class="c"><input type="checkbox" id="c-41066364" checked=""/><div class="controls bullet"><span class="by">noelwelsh</span><span>|</span><a href="#41063692">parent</a><span>|</span><label class="collapse" for="c-41066364">[-]</label><label class="expand" for="c-41066364">[1 more]</label></div><br/><div class="children"><div class="content">Closely related is &quot;Opt Art&quot;:<p>* Examples: <a href="https:&#x2F;&#x2F;www2.oberlin.edu&#x2F;math&#x2F;faculty&#x2F;bosch&#x2F;tspart-page.html" rel="nofollow">https:&#x2F;&#x2F;www2.oberlin.edu&#x2F;math&#x2F;faculty&#x2F;bosch&#x2F;tspart-page.html</a><p>* Paper: <a href="https:&#x2F;&#x2F;www.tandfonline.com&#x2F;doi&#x2F;abs&#x2F;10.1080&#x2F;10724117.2006.11974624" rel="nofollow">https:&#x2F;&#x2F;www.tandfonline.com&#x2F;doi&#x2F;abs&#x2F;10.1080&#x2F;10724117.2006.11...</a> (find it online at the usual places)<p>* Book: <a href="https:&#x2F;&#x2F;press.princeton.edu&#x2F;books&#x2F;hardcover&#x2F;9780691164069&#x2F;opt-art" rel="nofollow">https:&#x2F;&#x2F;press.princeton.edu&#x2F;books&#x2F;hardcover&#x2F;9780691164069&#x2F;op...</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>