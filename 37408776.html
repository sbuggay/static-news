<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1694077262812" as="style"/><link rel="stylesheet" href="styles.css?v=1694077262812"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://msrc.microsoft.com/blog/2023/09/results-of-major-technical-investigations-for-storm-0558-key-acquisition/">Results of technical investigations for Storm-0558 key acquisition</a>Â <span class="domain">(<a href="https://msrc.microsoft.com">msrc.microsoft.com</a>)</span></div><div class="subtext"><span>duringmath</span> | <span>142 comments</span></div><br/><div><div id="37414920" class="c"><input type="checkbox" id="c-37414920" checked=""/><div class="controls bullet"><span class="by">nicknow</span><span>|</span><a href="#37409274">next</a><span>|</span><label class="collapse" for="c-37414920">[-]</label><label class="expand" for="c-37414920">[8 more]</label></div><br/><div class="children"><div class="content">There are entire systems engineering courses focused on failure resulting from a series of small problems that eventually in the right succession result in catastrophic failure. And I think we can say this was a catastrophic failure.<p>Think about it, first you need a race condition, and that race condition has to result in the unexpected result. That right there, assuming this code has been tested and is frequently used, is probably a less than 10% chance (if it was frequently happening someone would have noticed.) Then you need an engineer to decide they need this particular crash dump. Then you need your credential scanning software (which again, presumably usually catches stuff) to not be able to detect this particular credential. Now you need an account compromised to get network access and that user has access to this crash dump and the hacker happens to get to it and grabs it.<p>But even then, you should be safe because the key is old and is only good to get into consumer email accounts...except you have a bug that accepts the old key AND a bug that didn&#x27;t reject this signing key for a token accessing corporate email accounts.<p>This is a really good system engineering lesson. Try all you want eventually enough small things will add up to cause a catastrophic result. The lesson is, to the extent you can, engineer things so when they blow-up the blast radius is limited.</div><br/><div id="37415008" class="c"><input type="checkbox" id="c-37415008" checked=""/><div class="controls bullet"><span class="by">rdtsc</span><span>|</span><a href="#37414920">parent</a><span>|</span><a href="#37415762">next</a><span>|</span><label class="collapse" for="c-37415008">[-]</label><label class="expand" for="c-37415008">[4 more]</label></div><br/><div class="children"><div class="content">&gt; that eventually in the right succession result in catastrophic failure.<p>With a caveat that when it comes to security the eventual succession doesn&#x27;t come as a random process but will be actively targeted and exploited. The attackers are not random processes flipping coins, rather they can flip a coin that often lands on &quot;heads&quot;, in their favor.<p>The post-mortem results are presented as if events happened as a random set of unfortunate circumstances: the attacker just happened to work for Microsoft, there just happened to be a race condition, and then a crash randomly happened, and then the attacker just happened to find the crash dump somewhere. We should consider even starting with the initial &quot;race condition&quot; bug, that it might have been inserted deliberately. The crash could have been triggered deliberately. An attacker may have been expecting the crash dump to appear in a particular place to grab it. The attacker may have had accomplices.</div><br/><div id="37416086" class="c"><input type="checkbox" id="c-37416086" checked=""/><div class="controls bullet"><span class="by">cathalc</span><span>|</span><a href="#37414920">root</a><span>|</span><a href="#37415008">parent</a><span>|</span><a href="#37415703">next</a><span>|</span><label class="collapse" for="c-37416086">[-]</label><label class="expand" for="c-37416086">[1 more]</label></div><br/><div class="children"><div class="content">&gt;The post-mortem results are presented as if events happened as a random set of unfortunate circumstances:<p>Public RCAs are nothing more than carefully curated PR stunts to calm customers. You can be sure the internal RCA is a lot more damning.</div><br/></div></div><div id="37415703" class="c"><input type="checkbox" id="c-37415703" checked=""/><div class="controls bullet"><span class="by">ddalex</span><span>|</span><a href="#37414920">root</a><span>|</span><a href="#37415008">parent</a><span>|</span><a href="#37416086">prev</a><span>|</span><a href="#37415762">next</a><span>|</span><label class="collapse" for="c-37415703">[-]</label><label class="expand" for="c-37415703">[2 more]</label></div><br/><div class="children"><div class="content">The other frightening possibility is that the attack surface targeted by persistent threat actors is so large that a breach becomes certain (the law of large numbers): when you have so many accounts owned that one of them will have the right access rights; when you have so many dumps one of them will have the key; etc ...</div><br/><div id="37415775" class="c"><input type="checkbox" id="c-37415775" checked=""/><div class="controls bullet"><span class="by">hulitu</span><span>|</span><a href="#37414920">root</a><span>|</span><a href="#37415703">parent</a><span>|</span><a href="#37415762">next</a><span>|</span><label class="collapse" for="c-37415775">[-]</label><label class="expand" for="c-37415775">[1 more]</label></div><br/><div class="children"><div class="content">&gt; the attack surface targeted by persistent threat actors is so large that a breach becomes certain<p>I thought a good security rule was to reduce the attack surface. But ok, we are talking about ... Microsoft. &#x2F;s</div><br/></div></div></div></div></div></div><div id="37415762" class="c"><input type="checkbox" id="c-37415762" checked=""/><div class="controls bullet"><span class="by">hulitu</span><span>|</span><a href="#37414920">parent</a><span>|</span><a href="#37415008">prev</a><span>|</span><a href="#37416039">next</a><span>|</span><label class="collapse" for="c-37415762">[-]</label><label class="expand" for="c-37415762">[1 more]</label></div><br/><div class="children"><div class="content">You seem to imply that Microsoft employs system engineering and test its products. The reality is far from this.<p>The Microsoft ecosystem looks like a Lego car built by the neighborhoud kids, everybody bringing something from home and smashing it together.</div><br/></div></div><div id="37414995" class="c"><input type="checkbox" id="c-37414995" checked=""/><div class="controls bullet"><span class="by">xwolfi</span><span>|</span><a href="#37414920">parent</a><span>|</span><a href="#37416039">prev</a><span>|</span><a href="#37409274">next</a><span>|</span><label class="collapse" for="c-37414995">[-]</label><label class="expand" for="c-37414995">[1 more]</label></div><br/><div class="children"><div class="content">Race condition is the reason we all use to explain to management why we wrote a stupid bug. Everything is a race condition: &quot;the masker is asynchronous so the writer starts writing dumps before the masker is setup&quot; sounds like a completely moronic thing to do. Say there is a race condition, and people say &quot;a less than 10% chance from happening&quot;, but what do we know, maybe it happens each big crash, and it just doesn&#x27;t crash that often.<p>Why isn&#x27;t it masking before writing to disk ? God only knows.</div><br/></div></div></div></div><div id="37409274" class="c"><input type="checkbox" id="c-37409274" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#37414920">prev</a><span>|</span><a href="#37409245">next</a><span>|</span><label class="collapse" for="c-37409274">[-]</label><label class="expand" for="c-37409274">[34 more]</label></div><br/><div class="children"><div class="content">It feels like there are some missing dots and connections here: I see how a concurrency or memory safety bug can accidentally exfil a private key into a debugging artifact, easily, but presumably the attacker here had to know about the crash, and the layout of the crash dump, and also have been ready and waiting in Microsoft&#x27;s corporate network? Those seem like big questions. &quot;Assume breach&quot; is a good network defense strategy, but you don&#x27;t literally just accept the notion that you&#x27;re breached.</div><br/><div id="37409755" class="c"><input type="checkbox" id="c-37409755" checked=""/><div class="controls bullet"><span class="by">gnfargbl</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37412166">next</a><span>|</span><label class="collapse" for="c-37409755">[-]</label><label class="expand" for="c-37409755">[7 more]</label></div><br/><div class="children"><div class="content">The article says that the employee compromise happened some time after the crash dump had been moved to the corporate network. It says that MS don&#x27;t have evidence of exfil, but my reading is that they do have some evidence of the compromise.<p>The article also says that Microsoft&#x27;s credential scanning tools failed to find the key, and that issue has now been corrected. This makes me think that the key <i>was</i> detectable by scanning.<p>Overall, my reading of this is that the engineer moved the dump containing the key into their account at some point, and it just sat there for a time. At a later point, the attacker compromised the account and pulled all available files. They then scanned for keys (with better tooling than MS had; maybe it needed something more sophisticated than looking for BEGIN PRIVATE KEY), and hit the jackpot.</div><br/><div id="37415486" class="c"><input type="checkbox" id="c-37415486" checked=""/><div class="controls bullet"><span class="by">tgv</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409755">parent</a><span>|</span><a href="#37410788">next</a><span>|</span><label class="collapse" for="c-37415486">[-]</label><label class="expand" for="c-37415486">[3 more]</label></div><br/><div class="children"><div class="content">&gt; and hit the jackpot.<p>And how often do you hit the jackpot? For larger lotteries, it&#x27;s less than once in a million. So that leads to two equally unpleasant alternatives:<p>1. The attacker was informed where to find the key.<p>2. The attackers have compromised a large part of Microsoft engineering and routinely scan all their files.</div><br/><div id="37415602" class="c"><input type="checkbox" id="c-37415602" checked=""/><div class="controls bullet"><span class="by">gnfargbl</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37415486">parent</a><span>|</span><a href="#37416293">next</a><span>|</span><label class="collapse" for="c-37415602">[-]</label><label class="expand" for="c-37415602">[1 more]</label></div><br/><div class="children"><div class="content">Oh, &quot;jackpot&quot; was just a figure of speech, I didn&#x27;t intend to imply any particular probability. Not sure what the chance of finding sensitive information in the private files of an engineer is, but I would guess a lot better than one in a million. One in a hundred, maybe? One in ten?<p>I think the most likely explanation is that this actor routinely attempts to compromise big-tech engineers using low-sophistication means, then grabs whatever they can get. Keep doing that often enough, for long enough, and you get something valuable -- that&#x27;s the &quot;persistent&quot; in APT.</div><br/></div></div><div id="37416293" class="c"><input type="checkbox" id="c-37416293" checked=""/><div class="controls bullet"><span class="by">lucasRW</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37415486">parent</a><span>|</span><a href="#37415602">prev</a><span>|</span><a href="#37410788">next</a><span>|</span><label class="collapse" for="c-37416293">[-]</label><label class="expand" for="c-37416293">[1 more]</label></div><br/><div class="children"><div class="content">Red teams and malicious actors have plenty of tools which automated the looting and look for juicy things. Crash dumps, logs, and many others... The bottom line is that if there is a secret stored on disk somewhere, it won&#x27;t take long for a proper actor to find it.</div><br/></div></div></div></div><div id="37410788" class="c"><input type="checkbox" id="c-37410788" checked=""/><div class="controls bullet"><span class="by">skywhopper</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409755">parent</a><span>|</span><a href="#37415486">prev</a><span>|</span><a href="#37409858">next</a><span>|</span><label class="collapse" for="c-37410788">[-]</label><label class="expand" for="c-37410788">[1 more]</label></div><br/><div class="children"><div class="content">This article says the lack of exfil evidence is &quot;because of log retention policies&quot;, ie, they deleted the logs since the exfil happened.</div><br/></div></div><div id="37409858" class="c"><input type="checkbox" id="c-37409858" checked=""/><div class="controls bullet"><span class="by">mistrial9</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409755">parent</a><span>|</span><a href="#37410788">prev</a><span>|</span><a href="#37412166">next</a><span>|</span><label class="collapse" for="c-37409858">[-]</label><label class="expand" for="c-37409858">[2 more]</label></div><br/><div class="children"><div class="content">it brings a lot of questions to the table about what employee knew what, and when.. A real question is - under a &quot;zero trust&quot; environment, how many motivated insiders have they accumulated with their IT employment and contracting.</div><br/><div id="37414455" class="c"><input type="checkbox" id="c-37414455" checked=""/><div class="controls bullet"><span class="by">roymj88</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409858">parent</a><span>|</span><a href="#37412166">next</a><span>|</span><label class="collapse" for="c-37414455">[-]</label><label class="expand" for="c-37414455">[1 more]</label></div><br/><div class="children"><div class="content">Was having the same thought.. Also anyone know what happened with the employee?</div><br/></div></div></div></div></div></div><div id="37412166" class="c"><input type="checkbox" id="c-37412166" checked=""/><div class="controls bullet"><span class="by">moyix</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37409755">prev</a><span>|</span><a href="#37409886">next</a><span>|</span><label class="collapse" for="c-37412166">[-]</label><label class="expand" for="c-37412166">[1 more]</label></div><br/><div class="children"><div class="content">I believe there are somewhat standard tools for scanning memory dumps for cryptographic material, which have been around since the cold boot attack era. And I can imagine attackers opportunistically looking for crash dumps with that in mind. But it does seem like an awfully lucky (for the attacker) sequence of events...</div><br/></div></div><div id="37409886" class="c"><input type="checkbox" id="c-37409886" checked=""/><div class="controls bullet"><span class="by">stilist</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37412166">prev</a><span>|</span><a href="#37411070">next</a><span>|</span><label class="collapse" for="c-37409886">[-]</label><label class="expand" for="c-37409886">[2 more]</label></div><br/><div class="children"><div class="content">Yeah:<p>&#x27;After April 2021, when the key was leaked to the corporate environment in the crash dump, the Storm-0558 actor was able to successfully compromise a Microsoft engineerâs corporate account. This account had access to the debugging environment containing the crash dump which incorrectly contained the key.&#x27;<p>So either the attacker was already in the network and happened to find the dump while doing some kind of scanning that wasn&#x27;t detected, or they knew to go after this specific person&#x27;s account.</div><br/><div id="37414561" class="c"><input type="checkbox" id="c-37414561" checked=""/><div class="controls bullet"><span class="by">nicknow</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409886">parent</a><span>|</span><a href="#37411070">next</a><span>|</span><label class="collapse" for="c-37414561">[-]</label><label class="expand" for="c-37414561">[1 more]</label></div><br/><div class="children"><div class="content">Or they knew&#x2F;discovered that there was a repository of crash dumps - likely a widely known piece of information - and just grabbed as much as they could. Nothing in the write-up indicates any connection between the compromised engineer and this particular crash dump, other than they had access.</div><br/></div></div></div></div><div id="37411070" class="c"><input type="checkbox" id="c-37411070" checked=""/><div class="controls bullet"><span class="by">tedunangst</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37409886">prev</a><span>|</span><a href="#37415736">next</a><span>|</span><label class="collapse" for="c-37411070">[-]</label><label class="expand" for="c-37411070">[11 more]</label></div><br/><div class="children"><div class="content">If you infiltrate a system and see sshd.core in the filesystem, you&#x27;re not going to snarf that up?</div><br/><div id="37411667" class="c"><input type="checkbox" id="c-37411667" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37411070">parent</a><span>|</span><a href="#37415852">next</a><span>|</span><label class="collapse" for="c-37411667">[-]</label><label class="expand" for="c-37411667">[5 more]</label></div><br/><div class="children"><div class="content">I just checked the source and openssh doesn&#x27;t appear to set madvise(MADV_DONTDUMP) anywhere :-(  That seems like an oversight?  For comparison openssl has a set of &quot;secure malloc&quot; functions (for keys etc) which uses MADV_DONTDUMP amongst other mitigations.</div><br/><div id="37413284" class="c"><input type="checkbox" id="c-37413284" checked=""/><div class="controls bullet"><span class="by">tedunangst</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37411667">parent</a><span>|</span><a href="#37412454">next</a><span>|</span><label class="collapse" for="c-37413284">[-]</label><label class="expand" for="c-37413284">[1 more]</label></div><br/><div class="children"><div class="content">On OpenBSD, you&#x27;d be looking for MAP_CONCEAL, though it&#x27;s not used in many places, either.</div><br/></div></div><div id="37412454" class="c"><input type="checkbox" id="c-37412454" checked=""/><div class="controls bullet"><span class="by">garblegarble</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37411667">parent</a><span>|</span><a href="#37413284">prev</a><span>|</span><a href="#37415852">next</a><span>|</span><label class="collapse" for="c-37412454">[-]</label><label class="expand" for="c-37412454">[3 more]</label></div><br/><div class="children"><div class="content">Interestingly, it looks like ssh-agent disables core dumps[1], but I don&#x27;t see similar usage for sshd<p>1: <a href="https:&#x2F;&#x2F;github.com&#x2F;openssh&#x2F;openssh-portable&#x2F;blob&#x2F;694150ad92765574ff82a18f4e86322bd3231e68&#x2F;ssh-agent.c#L2248">https:&#x2F;&#x2F;github.com&#x2F;openssh&#x2F;openssh-portable&#x2F;blob&#x2F;694150ad927...</a></div><br/><div id="37412597" class="c"><input type="checkbox" id="c-37412597" checked=""/><div class="controls bullet"><span class="by">Lt_Riza_Hawkeye</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37412454">parent</a><span>|</span><a href="#37415852">next</a><span>|</span><label class="collapse" for="c-37412597">[-]</label><label class="expand" for="c-37412597">[2 more]</label></div><br/><div class="children"><div class="content">sshd runs as root, so the core dumps would be readable as root-only, no? If you have root access already you could dump it even while it&#x27;s still running with ptrace anyways</div><br/><div id="37412622" class="c"><input type="checkbox" id="c-37412622" checked=""/><div class="controls bullet"><span class="by">garblegarble</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37412597">parent</a><span>|</span><a href="#37415852">next</a><span>|</span><label class="collapse" for="c-37412622">[-]</label><label class="expand" for="c-37412622">[1 more]</label></div><br/><div class="children"><div class="content">&gt;sshd runs as root, so the core dumps would be readable as root-only, no<p>Yes, although the article we&#x27;re discussing shows that you can&#x27;t rely on that, the dump could be subsequently moved to a developer machine for investigation, and unencrypted key material left in could be compromised that way... defense in depth would make sense here.</div><br/></div></div></div></div></div></div></div></div><div id="37415852" class="c"><input type="checkbox" id="c-37415852" checked=""/><div class="controls bullet"><span class="by">fullspectrumdev</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37411070">parent</a><span>|</span><a href="#37411667">prev</a><span>|</span><a href="#37413649">next</a><span>|</span><label class="collapse" for="c-37415852">[-]</label><label class="expand" for="c-37415852">[1 more]</label></div><br/><div class="children"><div class="content">Key material aside, such a coredump could give some hints towards someone elseâs capabilities, and point you in an interesting direction for finding new and exciting ways to own more shit.</div><br/></div></div><div id="37413649" class="c"><input type="checkbox" id="c-37413649" checked=""/><div class="controls bullet"><span class="by">upon_drumhead</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37411070">parent</a><span>|</span><a href="#37415852">prev</a><span>|</span><a href="#37415736">next</a><span>|</span><label class="collapse" for="c-37413649">[-]</label><label class="expand" for="c-37413649">[4 more]</label></div><br/><div class="children"><div class="content">Secret materials for ssh keys wonât be in sshd. They stay client side. Granted m, host keys could be compromised, so you could impersonate a server, but a sshd key leak wonât give direct access</div><br/><div id="37415832" class="c"><input type="checkbox" id="c-37415832" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37413649">parent</a><span>|</span><a href="#37415753">next</a><span>|</span><label class="collapse" for="c-37415832">[-]</label><label class="expand" for="c-37415832">[1 more]</label></div><br/><div class="children"><div class="content">MADV_DONTDUMP or MAP_CONCEAL don&#x27;t appear anywhere in the source, client or server (with the exception of the seccomp filter where they&#x27;re just used to filter potential system calls).</div><br/></div></div><div id="37415753" class="c"><input type="checkbox" id="c-37415753" checked=""/><div class="controls bullet"><span class="by">tlb</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37413649">parent</a><span>|</span><a href="#37415832">prev</a><span>|</span><a href="#37414131">next</a><span>|</span><label class="collapse" for="c-37415753">[-]</label><label class="expand" for="c-37415753">[1 more]</label></div><br/><div class="children"><div class="content">Yes, though it does have the host key which you could use to do a MITM attack.</div><br/></div></div><div id="37414131" class="c"><input type="checkbox" id="c-37414131" checked=""/><div class="controls bullet"><span class="by">acdha</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37413649">parent</a><span>|</span><a href="#37415753">prev</a><span>|</span><a href="#37415736">next</a><span>|</span><label class="collapse" for="c-37414131">[-]</label><label class="expand" for="c-37414131">[1 more]</label></div><br/><div class="children"><div class="content">It could leak passwords, though, unless youâre very certain your overwriting after validation always works.</div><br/></div></div></div></div></div></div><div id="37415736" class="c"><input type="checkbox" id="c-37415736" checked=""/><div class="controls bullet"><span class="by">tlb</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37411070">prev</a><span>|</span><a href="#37409384">next</a><span>|</span><label class="collapse" for="c-37415736">[-]</label><label class="expand" for="c-37415736">[1 more]</label></div><br/><div class="children"><div class="content">Since they can supposedly redact the key from crash dumps, the key must have some identifiable footprint in memory.<p>The redact_key_from_crash_dump function would be a good place to look for juicy bugs. Any case it misses tells you what to look for.</div><br/></div></div><div id="37409384" class="c"><input type="checkbox" id="c-37409384" checked=""/><div class="controls bullet"><span class="by">shadowgovt</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37415736">prev</a><span>|</span><a href="#37409740">next</a><span>|</span><label class="collapse" for="c-37409384">[-]</label><label class="expand" for="c-37409384">[10 more]</label></div><br/><div class="children"><div class="content">&gt; but presumably the attacker here had to know about the crash, and the layout of the crash dump<p>If I were an advanced persistent threat attacker working for China who had compromised Microsoft&#x27;s internal network via employee credentials (and I&#x27;m not), the first thing I&#x27;d do is figure out where they keep the crash logs and quietly exfil them, alongside the debugging symbols.<p>Often, these are not stored securely enough relative to their actual value. Having spent some time at a FAANG, <i>every single new hire,</i> with the exception of those who have worked in finance or corporate regulation, assumes you can just glue crash data onto the bugtracker (that&#x27;s what bugtrackers are for, tracking bugs, which includes reproducing them, right?). You have to detrain them of that and you have to have a vault for things like crashdumps that is so easy to use that people don&#x27;t get lazy and start circumventing your protections because their job is to fix bugs and you&#x27;ve made their job harder.<p>With a compromised engineer&#x27;s account, we can assume the attacker at least has access to the bugtracker and probably the ability to acquire or generate debug symbols for a binary. All that&#x27;s left then is to wait for one engineer to get sloppy and paste a crashdump as an attachment on a bug, then slurp it before someone notices and deletes it (assuming they do; even at my big scary &quot;We really care about user privacy&quot; corp, individual engineers were loathe to make a bug harder to understand by stripping crashlogs off of it unless someone in security came in and whipped them. Proper internal opsec can <i>really</i> slow down development here).</div><br/><div id="37410515" class="c"><input type="checkbox" id="c-37410515" checked=""/><div class="controls bullet"><span class="by">Eduard</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409384">parent</a><span>|</span><a href="#37409889">next</a><span>|</span><label class="collapse" for="c-37410515">[-]</label><label class="expand" for="c-37410515">[1 more]</label></div><br/><div class="children"><div class="content">your statement:<p>&gt; but presumably the attacker here had to know about the crash, and the layout of the crash dump<p>another statement from the article:<p>&gt; Our credential scanning methods did not detect its presence (this issue has been corrected).<p>The article does not give any timeline when things happened.<p>Imagine the following timeline:<p>- hacker gets coredump in 2021, doesn&#x27;t know that it contains valuable credentials.<p>- For data retention policy reasons, Microsoft deletes their copy of the coredump â but hacker just keeps it.<p>- Microsoft updates its credential scanning methods.<p>- Microsoft runs updated credential software over their reduced archive (retention policy) of coredumps. As that particular coredump doesn&#x27;t exist anymore at Microsoft, they are not aware of the issue.<p>- hacker get scanner update.<p>- hacker runs updated credential scanner software over their archive of coredumps. Jackpot.</div><br/></div></div><div id="37409889" class="c"><input type="checkbox" id="c-37409889" checked=""/><div class="controls bullet"><span class="by">Eduard</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409384">parent</a><span>|</span><a href="#37410515">prev</a><span>|</span><a href="#37410911">next</a><span>|</span><label class="collapse" for="c-37409889">[-]</label><label class="expand" for="c-37409889">[5 more]</label></div><br/><div class="children"><div class="content">&gt;... you have to have a vault for things like crashdumps that is so easy to use that people don&#x27;t get lazy...<p>Let&#x27;s assume a crash dump can be megabytes up to gigabytes big.<p>How could a vault handle this securely?<p>the moment it is copied from the vault to the developer&#x27;s computer, you introduce data remanence (undelete from file system).<p>keeping such coredump purely in RAM makes it accessible on a compromised developer machine (GNU Debugger), and if the developer machine crashes, <i>its coredump</i> contains&#x2F;wraps the sensitive coredump.<p>A vault that doesn&#x27;t allow direct&#x2F;full coredump download, but allows queries (think &quot;SQL queries against a vault REST API&quot;) could still be queried for e.g. &quot;select * from coredump where string like &#x27;%secret_key%&#x27;&quot;.<p>So without more insight, a coredump vault sounds like security theater which tremendously makes it more difficult for intended purposes.</div><br/><div id="37413164" class="c"><input type="checkbox" id="c-37413164" checked=""/><div class="controls bullet"><span class="by">sfink</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409889">parent</a><span>|</span><a href="#37410767">next</a><span>|</span><label class="collapse" for="c-37413164">[-]</label><label class="expand" for="c-37413164">[2 more]</label></div><br/><div class="children"><div class="content">Everything is imperfect, but where I work crashdumps are uploaded straight to a secure vault and then deleted from the origin system. The dumps are processed, and insensitive data is extracted and published with relatively lenient access controls. Sensitive data, such as raw memory dumps, require a higher tier of permissions. In order to be eligible for that higher tier, your developer machine has to be more locked down than that of people who are not in the secure group. (You also need to have a reason to need more access.)<p>Given that stack traces, crash addresses, and most register contents are considered to be security insensitive, most people don&#x27;t really need access to the raw dumps.<p>It&#x27;s far from perfect, but it would be unfair to call it &quot;security theater&quot;. It seems like a pretty decent balance in practice. Admittedly, we have the slight advantage of several hundred millions installs, so the actual bugs that are causing crashes are likely to happen quite a few times and statistical analysis will often provide better clues than diving deep into an individual crash dump.</div><br/><div id="37414929" class="c"><input type="checkbox" id="c-37414929" checked=""/><div class="controls bullet"><span class="by">trifurcate</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37413164">parent</a><span>|</span><a href="#37410767">next</a><span>|</span><label class="collapse" for="c-37414929">[-]</label><label class="expand" for="c-37414929">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  Everything is imperfect, but where I work crashdumps are uploaded straight to a secure vault and then deleted from the origin system. The dumps are processed, and insensitive data is extracted and published with relatively lenient access controls. Sensitive data, such as raw memory dumps, require a higher tier of permissions. In order to be eligible for that higher tier, your developer machine has to be more locked down than that of people who are not in the secure group. (You also need to have a reason to need more access.)<p>From my understanding, this is more or less how the Microsoft system was designed with credential scanning and redaction over coredumps, but a chain of bugs and negligence broke the veil.</div><br/></div></div></div></div><div id="37410767" class="c"><input type="checkbox" id="c-37410767" checked=""/><div class="controls bullet"><span class="by">bri3d</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409889">parent</a><span>|</span><a href="#37413164">prev</a><span>|</span><a href="#37411634">next</a><span>|</span><label class="collapse" for="c-37410767">[-]</label><label class="expand" for="c-37410767">[1 more]</label></div><br/><div class="children"><div class="content">While your points are all valid theoretically, keeping stuff off of developer filesystems can still help a lot practically.<p>This attacker probably (it&#x27;s unclear, since the write-up doesn&#x27;t tell us) scanned compromised machines for key material using some kind of dragnet scanning tool. If the data wasn&#x27;t on the compromised filesystem, they wouldn&#x27;t have found it. Even though perhaps in theory they could have sat on a machine with debug access (depending on the nature of the compromise, this is even a stretch - reading another process&#x27;s RAM usually requires much higher privilege than filesystem access) and obtained a core dump from RAM.<p>Security is always a tension between the theoretical and the practical and I think &quot;putting crash dumps in an easy-to-use place that isn&#x27;t a developer&#x27;s Downloads folder&quot; isn&#x27;t a bad idea.</div><br/></div></div><div id="37411634" class="c"><input type="checkbox" id="c-37411634" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409889">parent</a><span>|</span><a href="#37410767">prev</a><span>|</span><a href="#37410911">next</a><span>|</span><label class="collapse" for="c-37411634">[-]</label><label class="expand" for="c-37411634">[1 more]</label></div><br/><div class="children"><div class="content">Ephemeral compute&#x2F;VM&#x2F;debug environment with restricted access.<p>Tear down the environment after the debugging is done.<p>Keeping the crash dumps in a vault presumably allows more permission&#x2F;control that an internal issue tracker (usually anyone can access the issue tracker). At least a vault can apply RBAC or even time based policies so these things aren&#x27;t laying around forever.</div><br/></div></div></div></div><div id="37410911" class="c"><input type="checkbox" id="c-37410911" checked=""/><div class="controls bullet"><span class="by">Muromec</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409384">parent</a><span>|</span><a href="#37409889">prev</a><span>|</span><a href="#37412535">next</a><span>|</span><label class="collapse" for="c-37410911">[-]</label><label class="expand" for="c-37410911">[1 more]</label></div><br/><div class="children"><div class="content">Oh, yeah, the amount of times I see HAR file with <i>things</i> in it just floating in JIRA is not fun.</div><br/></div></div><div id="37412535" class="c"><input type="checkbox" id="c-37412535" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37409384">parent</a><span>|</span><a href="#37410911">prev</a><span>|</span><a href="#37409740">next</a><span>|</span><label class="collapse" for="c-37412535">[-]</label><label class="expand" for="c-37412535">[2 more]</label></div><br/><div class="children"><div class="content">Why does an attacker need symbols?</div><br/><div id="37413900" class="c"><input type="checkbox" id="c-37413900" checked=""/><div class="controls bullet"><span class="by">shadowgovt</span><span>|</span><a href="#37409274">root</a><span>|</span><a href="#37412535">parent</a><span>|</span><a href="#37409740">next</a><span>|</span><label class="collapse" for="c-37413900">[-]</label><label class="expand" for="c-37413900">[1 more]</label></div><br/><div class="children"><div class="content">They&#x27;re not needed, but they will speed up comprehension of the contents of the program.<p>... but they&#x27;re definitely not strictly necessary.</div><br/></div></div></div></div></div></div><div id="37409740" class="c"><input type="checkbox" id="c-37409740" checked=""/><div class="controls bullet"><span class="by">formerly_proven</span><span>|</span><a href="#37409274">parent</a><span>|</span><a href="#37409384">prev</a><span>|</span><a href="#37409245">next</a><span>|</span><label class="collapse" for="c-37409740">[-]</label><label class="expand" for="c-37409740">[1 more]</label></div><br/><div class="children"><div class="content">Another article from Microsoft in this affair that barely (if indeed) answers more questions than it raises.</div><br/></div></div></div></div><div id="37409245" class="c"><input type="checkbox" id="c-37409245" checked=""/><div class="controls bullet"><span class="by">cobertos</span><span>|</span><a href="#37409274">prev</a><span>|</span><a href="#37409574">next</a><span>|</span><label class="collapse" for="c-37409245">[-]</label><label class="expand" for="c-37409245">[7 more]</label></div><br/><div class="children"><div class="content">Some things were not plainly spelled out:<p>* July 11 2023 this was caught, April 2021 it was suspected to have happened. So, 2+ years they had this credential, and 2 months from detection until disclosure.<p>* How many tokens were forged, how much did they access? I&#x27;m assuming bad if they didn&#x27;t disclose.<p>* No timetable from once detected to fix implemented. Just &quot;this issue has been corrected&quot;. Hope they implemented that quickly...<p>* They&#x27;ve fixed 4 direct problems, but obviously there&#x27;s some systemic issues. What are they doing about those?</div><br/><div id="37412681" class="c"><input type="checkbox" id="c-37412681" checked=""/><div class="controls bullet"><span class="by">ranting-moth</span><span>|</span><a href="#37409245">parent</a><span>|</span><a href="#37413198">next</a><span>|</span><label class="collapse" for="c-37412681">[-]</label><label class="expand" for="c-37412681">[2 more]</label></div><br/><div class="children"><div class="content">Adverse inference is very valid.<p><a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Adverse_inference" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Adverse_inference</a></div><br/><div id="37413225" class="c"><input type="checkbox" id="c-37413225" checked=""/><div class="controls bullet"><span class="by">jeremyjh</span><span>|</span><a href="#37409245">root</a><span>|</span><a href="#37412681">parent</a><span>|</span><a href="#37413198">next</a><span>|</span><label class="collapse" for="c-37413225">[-]</label><label class="expand" for="c-37413225">[1 more]</label></div><br/><div class="children"><div class="content">Its valid in a civil court where discovery processes exist. It doesn&#x27;t really apply to public relations, where information could be withheld for a number of unknowable reasons. Of course everyone is free to speculate, but its not supported by a link to theories of common law in civil torts.</div><br/></div></div></div></div><div id="37413198" class="c"><input type="checkbox" id="c-37413198" checked=""/><div class="controls bullet"><span class="by">tadzikpk</span><span>|</span><a href="#37409245">parent</a><span>|</span><a href="#37412681">prev</a><span>|</span><a href="#37409574">next</a><span>|</span><label class="collapse" for="c-37413198">[-]</label><label class="expand" for="c-37413198">[4 more]</label></div><br/><div class="children"><div class="content">If this credential is still valid 2 years later, what is their credential rotation policy?</div><br/><div id="37414373" class="c"><input type="checkbox" id="c-37414373" checked=""/><div class="controls bullet"><span class="by">Fatnino</span><span>|</span><a href="#37409245">root</a><span>|</span><a href="#37413198">parent</a><span>|</span><a href="#37413610">next</a><span>|</span><label class="collapse" for="c-37414373">[-]</label><label class="expand" for="c-37414373">[2 more]</label></div><br/><div class="children"><div class="content">5 years. The dump is from 2018</div><br/><div id="37414489" class="c"><input type="checkbox" id="c-37414489" checked=""/><div class="controls bullet"><span class="by">roymj88</span><span>|</span><a href="#37409245">root</a><span>|</span><a href="#37414373">parent</a><span>|</span><a href="#37413610">next</a><span>|</span><label class="collapse" for="c-37414489">[-]</label><label class="expand" for="c-37414489">[1 more]</label></div><br/><div class="children"><div class="content">Whoah... Surely this may not be the only news waiting to come out.. They just need to find out what else they&#x27;ve got during this period..</div><br/></div></div></div></div><div id="37413610" class="c"><input type="checkbox" id="c-37413610" checked=""/><div class="controls bullet"><span class="by">roboman</span><span>|</span><a href="#37409245">root</a><span>|</span><a href="#37413198">parent</a><span>|</span><a href="#37414373">prev</a><span>|</span><a href="#37409574">next</a><span>|</span><label class="collapse" for="c-37413610">[-]</label><label class="expand" for="c-37413610">[1 more]</label></div><br/><div class="children"><div class="content">^ agree!  What an easy mitigation this would have been.</div><br/></div></div></div></div></div></div><div id="37409574" class="c"><input type="checkbox" id="c-37409574" checked=""/><div class="controls bullet"><span class="by">dgudkov</span><span>|</span><a href="#37409245">prev</a><span>|</span><a href="#37409636">next</a><span>|</span><label class="collapse" for="c-37409574">[-]</label><label class="expand" for="c-37409574">[7 more]</label></div><br/><div class="children"><div class="content">A breach like that requires a very good understanding of Microsoft&#x27;s internal infrastructure. It&#x27;s safe to assume that the breach was a coordinated effort of a team of hackers. This is not a cheap effort, but the payback is enormous. Hyper-centralization leads to a situation when hackers concentrate their efforts on a few high-value targets because once they are successful, the catch is enormous. I&#x27;m pretty much sure that there are teams of (state-sponsored) hackers that are already doing deep research and analysis of the internal infrastructure of Google, Microsoft, Amazon, etc. The breach gives an idea of how well already the hackers understand it.<p>I would argue, it&#x27;s time to decentralize inside a wider security perimeter.</div><br/><div id="37412196" class="c"><input type="checkbox" id="c-37412196" checked=""/><div class="controls bullet"><span class="by">sargun</span><span>|</span><a href="#37409574">parent</a><span>|</span><a href="#37410119">next</a><span>|</span><label class="collapse" for="c-37412196">[-]</label><label class="expand" for="c-37412196">[4 more]</label></div><br/><div class="children"><div class="content">You have to assume that you have nation state actors working at your organization at sufficient size. Unfortunately, itâs difficult to work around this assumption, because anyone can be compromised at any time.</div><br/><div id="37413477" class="c"><input type="checkbox" id="c-37413477" checked=""/><div class="controls bullet"><span class="by">transcriptase</span><span>|</span><a href="#37409574">root</a><span>|</span><a href="#37412196">parent</a><span>|</span><a href="#37413734">next</a><span>|</span><label class="collapse" for="c-37413477">[-]</label><label class="expand" for="c-37413477">[2 more]</label></div><br/><div class="children"><div class="content">I find it somewhat amusing that companies like Microsoft and Google that have pivoted a large portion of their business model to collecting, keylogging, recording, scanning, exfiltrating, telemetrizing, collating, inferring, and analyzing every last iota of data they can about as many people as possible under the guise of improving their products or personalizing ads...<p>... can&#x27;t identify nation state actors within their own company.<p>I suppose that would be illegal. Whereas using it to improve AdSense CTR or selling it to brokers is perfectly acceptable.</div><br/><div id="37415142" class="c"><input type="checkbox" id="c-37415142" checked=""/><div class="controls bullet"><span class="by">bostik</span><span>|</span><a href="#37409574">root</a><span>|</span><a href="#37413477">parent</a><span>|</span><a href="#37413734">next</a><span>|</span><label class="collapse" for="c-37415142">[-]</label><label class="expand" for="c-37415142">[1 more]</label></div><br/><div class="children"><div class="content">If you are up against an adversary with an unlimited budget and organisational event horizon measured in years, your quarter-to-quarter thinking will always kneecap you.</div><br/></div></div></div></div><div id="37413734" class="c"><input type="checkbox" id="c-37413734" checked=""/><div class="controls bullet"><span class="by">mhh__</span><span>|</span><a href="#37409574">root</a><span>|</span><a href="#37412196">parent</a><span>|</span><a href="#37413477">prev</a><span>|</span><a href="#37410119">next</a><span>|</span><label class="collapse" for="c-37413734">[-]</label><label class="expand" for="c-37413734">[1 more]</label></div><br/><div class="children"><div class="content">At or in? I would assume both</div><br/></div></div></div></div></div></div><div id="37409636" class="c"><input type="checkbox" id="c-37409636" checked=""/><div class="controls bullet"><span class="by">baz00</span><span>|</span><a href="#37409574">prev</a><span>|</span><a href="#37412001">next</a><span>|</span><label class="collapse" for="c-37409636">[-]</label><label class="expand" for="c-37409636">[4 more]</label></div><br/><div class="children"><div class="content">So if we remove the careful wording, someone downloaded a minidump onto a dev workstation from production and then it was probably left rotting in corporate OneDrive until that developer&#x27;s account was compromised. Someone took the dump, found a key in it and hit the jackpot.</div><br/><div id="37414950" class="c"><input type="checkbox" id="c-37414950" checked=""/><div class="controls bullet"><span class="by">trifurcate</span><span>|</span><a href="#37409636">parent</a><span>|</span><a href="#37412001">next</a><span>|</span><label class="collapse" for="c-37414950">[-]</label><label class="expand" for="c-37414950">[3 more]</label></div><br/><div class="children"><div class="content">And, crucial to this exploit actually working to the extent it did, Microsoft&#x27;s own developers failed to implement a secure authentication check on top of their own libraries and infrastructure.</div><br/><div id="37415522" class="c"><input type="checkbox" id="c-37415522" checked=""/><div class="controls bullet"><span class="by">runeks</span><span>|</span><a href="#37409636">root</a><span>|</span><a href="#37414950">parent</a><span>|</span><a href="#37412001">next</a><span>|</span><label class="collapse" for="c-37415522">[-]</label><label class="expand" for="c-37415522">[2 more]</label></div><br/><div class="children"><div class="content">How so?</div><br/><div id="37415997" class="c"><input type="checkbox" id="c-37415997" checked=""/><div class="controls bullet"><span class="by">baz00</span><span>|</span><a href="#37409636">root</a><span>|</span><a href="#37415522">parent</a><span>|</span><a href="#37412001">next</a><span>|</span><label class="collapse" for="c-37415997">[-]</label><label class="expand" for="c-37415997">[1 more]</label></div><br/><div class="children"><div class="content">Leaving credentials and keys in memory.</div><br/></div></div></div></div></div></div></div></div><div id="37412001" class="c"><input type="checkbox" id="c-37412001" checked=""/><div class="controls bullet"><span class="by">noodlesUK</span><span>|</span><a href="#37409636">prev</a><span>|</span><a href="#37410338">next</a><span>|</span><label class="collapse" for="c-37412001">[-]</label><label class="expand" for="c-37412001">[1 more]</label></div><br/><div class="children"><div class="content">I feel like an issue that really got them was that the keys werenât rotated. It sounds like quite some time passed between when the key was moved where it didnât belong and when it got snatched. If keys were rotated frequently, it would not have been possible to use it to forge a token.</div><br/></div></div><div id="37410338" class="c"><input type="checkbox" id="c-37410338" checked=""/><div class="controls bullet"><span class="by">time4tea</span><span>|</span><a href="#37412001">prev</a><span>|</span><a href="#37409751">next</a><span>|</span><label class="collapse" for="c-37410338">[-]</label><label class="expand" for="c-37410338">[1 more]</label></div><br/><div class="children"><div class="content">What this means is that the keys are not stored in non-recoverable hardware, they are available to a regular server process, just some compiled code, running in an elevated-priv environment.
There is no mention that the systems that had access to this key were in any other than the normal production environment, so we may extrapolate that any production machine could get access to it and therefore anyone with access to that environment could potentially exfil the key material.</div><br/></div></div><div id="37409751" class="c"><input type="checkbox" id="c-37409751" checked=""/><div class="controls bullet"><span class="by">mh8h</span><span>|</span><a href="#37410338">prev</a><span>|</span><a href="#37414346">next</a><span>|</span><label class="collapse" for="c-37409751">[-]</label><label class="expand" for="c-37409751">[8 more]</label></div><br/><div class="children"><div class="content">Why don&#x27;t they use HSMs instead? The whole point of those hardwares is to prevent leaking the key materials.</div><br/><div id="37412654" class="c"><input type="checkbox" id="c-37412654" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#37409751">parent</a><span>|</span><a href="#37410965">next</a><span>|</span><label class="collapse" for="c-37412654">[-]</label><label class="expand" for="c-37412654">[4 more]</label></div><br/><div class="children"><div class="content">These guys [1] claim to have &quot;the fastest payment HSM in the world, capable of processing over 20,000 transactions per second.&quot; I imagine the peak load for signing authtokens for Microsoft accounts is <i>way</i> higher than that.<p>[1] <a href="https:&#x2F;&#x2F;www.futurex.com&#x2F;download&#x2F;excrypt-ssp-enterprise-v-2-overview&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.futurex.com&#x2F;download&#x2F;excrypt-ssp-enterprise-v-2-...</a></div><br/><div id="37413082" class="c"><input type="checkbox" id="c-37413082" checked=""/><div class="controls bullet"><span class="by">timmclean</span><span>|</span><a href="#37409751">root</a><span>|</span><a href="#37412654">parent</a><span>|</span><a href="#37410965">next</a><span>|</span><label class="collapse" for="c-37413082">[-]</label><label class="expand" for="c-37413082">[3 more]</label></div><br/><div class="children"><div class="content">Is there a reason why they couldn&#x27;t split the load across multiple HSM? For something so sensitive I would&#x27;ve expected a design where one or more root&#x2F;master keys (held in HSM) are periodically used to sign certificates for temporary keys (which are also held in HSM). The HSMs with the temporary keys would handle the production traffic. As long as the verification process can validate a certificate chain, then this design should allow them to scale to as many HSMs as are needed to handle the load...</div><br/><div id="37413330" class="c"><input type="checkbox" id="c-37413330" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#37409751">root</a><span>|</span><a href="#37413082">parent</a><span>|</span><a href="#37410965">next</a><span>|</span><label class="collapse" for="c-37413330">[-]</label><label class="expand" for="c-37413330">[2 more]</label></div><br/><div class="children"><div class="content">HSM are expensive, the performance is bad, and administration is a pain. They&#x27;re almost certainly running many clusters of their auth servers around the world, and would need significant capacity at all the locations, in case traffic shifts.<p>It&#x27;s probably a better idea to pursue short lived private keys, rather than HSMs. If the timeline is accurate, the key was saved in a crash dump in 2021 and used for evil in 2023, monthly or quarterly rotation would have made the key useless in the two year period.<p>A certificate chain is a little too long to include in access tokens, IMHO, but I don&#x27;t know how Microsoft&#x27;s auth systems work.</div><br/><div id="37413509" class="c"><input type="checkbox" id="c-37413509" checked=""/><div class="controls bullet"><span class="by">twisteriffic</span><span>|</span><a href="#37409751">root</a><span>|</span><a href="#37413330">parent</a><span>|</span><a href="#37410965">next</a><span>|</span><label class="collapse" for="c-37413509">[-]</label><label class="expand" for="c-37413509">[1 more]</label></div><br/><div class="children"><div class="content">According to <a href="https:&#x2F;&#x2F;www.wiz.io&#x2F;blog&#x2F;storm-0558-compromised-microsoft-key-enables-authentication-of-countless-micr" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.wiz.io&#x2F;blog&#x2F;storm-0558-compromised-microsoft-key...</a><p>The key expired in April 2021. Short lived keys only work if you actually check for expiry, which it appears they weren&#x27;t doing.</div><br/></div></div></div></div></div></div></div></div><div id="37410965" class="c"><input type="checkbox" id="c-37410965" checked=""/><div class="controls bullet"><span class="by">olliej</span><span>|</span><a href="#37409751">parent</a><span>|</span><a href="#37412654">prev</a><span>|</span><a href="#37414346">next</a><span>|</span><label class="collapse" for="c-37410965">[-]</label><label class="expand" for="c-37410965">[3 more]</label></div><br/><div class="children"><div class="content">They way they discribed I assumed that the crashlog they got was from an HSM?</div><br/><div id="37413313" class="c"><input type="checkbox" id="c-37413313" checked=""/><div class="controls bullet"><span class="by">SgtBastard</span><span>|</span><a href="#37409751">root</a><span>|</span><a href="#37410965">parent</a><span>|</span><a href="#37412172">next</a><span>|</span><label class="collapse" for="c-37413313">[-]</label><label class="expand" for="c-37413313">[1 more]</label></div><br/><div class="children"><div class="content">As a sibling commenter mentioned - if a HSM dumps its memory where it contains private key material, thatâs a spectacularly bad HSM, which MS wouldnât have been able to fix the race condition of.<p>Reading that MS were able to fix the crashing systemâs race condition that included the key, itâs likely to have been a long-lived intermediate key for which the private key was held in memory (with a HSM backed root key for chain of trust validation, assuming MS arenât completely stupid).<p>The challenge is the sheer scale these servers operate in terms of crypto-OPSâ¦ it would melt most dedicated HSMs.</div><br/></div></div><div id="37412172" class="c"><input type="checkbox" id="c-37412172" checked=""/><div class="controls bullet"><span class="by">agrajag</span><span>|</span><a href="#37409751">root</a><span>|</span><a href="#37410965">parent</a><span>|</span><a href="#37413313">prev</a><span>|</span><a href="#37414346">next</a><span>|</span><label class="collapse" for="c-37412172">[-]</label><label class="expand" for="c-37412172">[1 more]</label></div><br/><div class="children"><div class="content">It would be a gross failure of an HSM to allow private key material to leak in any way.</div><br/></div></div></div></div></div></div><div id="37414346" class="c"><input type="checkbox" id="c-37414346" checked=""/><div class="controls bullet"><span class="by">acdha</span><span>|</span><a href="#37409751">prev</a><span>|</span><a href="#37409244">next</a><span>|</span><label class="collapse" for="c-37414346">[-]</label><label class="expand" for="c-37414346">[2 more]</label></div><br/><div class="children"><div class="content">Looking at the validation section of <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;azure&#x2F;active-directory&#x2F;develop&#x2F;access-tokens" rel="nofollow noreferrer">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;azure&#x2F;active-directory&#x2F;dev...</a> - did I miss something or does that still lack any mention of the importance of checking dates or revocation for the issuer? Since the pseudo code doesnât Iâd bet there are more implementations which trust any key Microsoft has ever published (modulo some kind of cache purge).</div><br/><div id="37414958" class="c"><input type="checkbox" id="c-37414958" checked=""/><div class="controls bullet"><span class="by">trifurcate</span><span>|</span><a href="#37414346">parent</a><span>|</span><a href="#37409244">next</a><span>|</span><label class="collapse" for="c-37414958">[-]</label><label class="expand" for="c-37414958">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Since the pseudo code doesnât Iâd bet there are more implementations which trust any key Microsoft has ever published<p>Bingo, this is the most worrying bit to me. Pasting from a comment I posted earlier:<p>&gt; Microsoft&#x27;s own developers failed to implement a secure authentication check on top of their own libraries and infrastructure.<p>If Microsoft can&#x27;t use its own identity platform correctly in a flagship Microsoft product (Outlook), what chance does anyone else stand?</div><br/></div></div></div></div><div id="37409244" class="c"><input type="checkbox" id="c-37409244" checked=""/><div class="controls bullet"><span class="by">munificent</span><span>|</span><a href="#37414346">prev</a><span>|</span><a href="#37410730">next</a><span>|</span><label class="collapse" for="c-37409244">[-]</label><label class="expand" for="c-37409244">[24 more]</label></div><br/><div class="children"><div class="content">I feel this everytime one of these articles comes out, but it seems totally bizarre to me that we rely on private enterprises to deal with state-level attacks simply because they are digital and not physical.<p>If a Chinese fighter jet shot down a FedEx plane flying over the Pacific, that would be considered an attack on US sovereignty and the government would respond appropriately. Certainly we wouldn&#x27;t expect FedEx to have to own their own private fleet of fighter jets to protect their transport planes. No one would be like, &quot;Well it&#x27;s FedEx&#x27;s fault for not having the right anti-aircraft defenses.&quot;<p>But somehow, once it hits the digital domain we&#x27;re just supposed to accept that Microsoft is required to defend themselves against China and Russia.</div><br/><div id="37409457" class="c"><input type="checkbox" id="c-37409457" checked=""/><div class="controls bullet"><span class="by">miki123211</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37415985">next</a><span>|</span><label class="collapse" for="c-37409457">[-]</label><label class="expand" for="c-37409457">[5 more]</label></div><br/><div class="children"><div class="content">&gt; If a Chinese fighter jet shot down a FedEx plane flying over the Pacific, that would be considered an attack on US sovereignty and the government would respond appropriately<p>But if a bunch of Chinese people robbed a US bank, let&#x27;s say the federal reserve, causing enormous financial damage but not loss of life, the response would be similar. Especially so if their link to the actual Chinese government was suspected couldn&#x27;t reliably be proven.<p>Governments catch foreign agents somewhat regularly, and those captures don&#x27;t lead to an all-out war.</div><br/><div id="37409722" class="c"><input type="checkbox" id="c-37409722" checked=""/><div class="controls bullet"><span class="by">bell-cot</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409457">parent</a><span>|</span><a href="#37415985">next</a><span>|</span><label class="collapse" for="c-37409722">[-]</label><label class="expand" for="c-37409722">[4 more]</label></div><br/><div class="children"><div class="content">Perhaps - but, whether or not people from $ForeignNation are involved, U.S. banks (or other corporations, or ordinary citizens) <i>generally</i> do not need to have their own armed police&#x2F;security forces to deal with armed robberies.  Nor their own DA&#x27;s, courts, etc.<p>Vs. any &quot;cyber&quot; crime?  All that nice stuff about &quot;...establish Justice, insure domestic Tranquility, provide for the common defence, promote the general Welfare...&quot; falls on the floor, and...YOYO.</div><br/><div id="37415107" class="c"><input type="checkbox" id="c-37415107" checked=""/><div class="controls bullet"><span class="by">gostsamo</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409722">parent</a><span>|</span><a href="#37410814">next</a><span>|</span><label class="collapse" for="c-37415107">[-]</label><label class="expand" for="c-37415107">[1 more]</label></div><br/><div class="children"><div class="content">Are you ready to leave your authentication services, acl, patching procedures, tech stack choice, and network monitoring and management in the hands of the government? Because if you are not, you are asking the government to perform duties without the necessary means.</div><br/></div></div><div id="37410814" class="c"><input type="checkbox" id="c-37410814" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409722">parent</a><span>|</span><a href="#37415107">prev</a><span>|</span><a href="#37411675">next</a><span>|</span><label class="collapse" for="c-37410814">[-]</label><label class="expand" for="c-37410814">[1 more]</label></div><br/><div class="children"><div class="content">&gt; generally do not need to have their own armed police&#x2F;security forces to deal with armed robberies.<p>They kind of do, no?<p>Also, <i>preventing</i> crime and carrying out criminal justice are two very different things.</div><br/></div></div><div id="37411675" class="c"><input type="checkbox" id="c-37411675" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409722">parent</a><span>|</span><a href="#37410814">prev</a><span>|</span><a href="#37415985">next</a><span>|</span><label class="collapse" for="c-37411675">[-]</label><label class="expand" for="c-37411675">[1 more]</label></div><br/><div class="children"><div class="content">Not true. Itâs just that it doesnât happen fast. This is just one example, there are many:<p><a href="https:&#x2F;&#x2F;www.justice.gov&#x2F;opa&#x2F;pr&#x2F;four-russian-government-employees-charged-two-historical-hacking-campaigns-targeting-critical" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.justice.gov&#x2F;opa&#x2F;pr&#x2F;four-russian-government-emplo...</a></div><br/></div></div></div></div></div></div><div id="37415985" class="c"><input type="checkbox" id="c-37415985" checked=""/><div class="controls bullet"><span class="by">fullspectrumdev</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37409457">prev</a><span>|</span><a href="#37409851">next</a><span>|</span><label class="collapse" for="c-37415985">[-]</label><label class="expand" for="c-37415985">[1 more]</label></div><br/><div class="children"><div class="content">â¦ and Russian, Chinese, French, whoever private entities have to defend themselves against the NSA, CIA, GCHQâ¦<p>Espionage is a dirty game.<p>What I always find interesting is how the US has taken on a strategy of indicting individual Chinese&#x2F;Russian hackers for acting in the interests of their countries, whenever they can be identified by DoJ.<p>This policy is interesting, because, as we all know, turnabout is fair play.<p>How long before retired NSA operators are advised to never travel outside the US lest they be at risk of being picked up on international arrest warrants from China?</div><br/></div></div><div id="37409851" class="c"><input type="checkbox" id="c-37409851" checked=""/><div class="controls bullet"><span class="by">belltaco</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37415985">prev</a><span>|</span><a href="#37409318">next</a><span>|</span><label class="collapse" for="c-37409851">[-]</label><label class="expand" for="c-37409851">[2 more]</label></div><br/><div class="children"><div class="content">Firstly, no infrastructure was attacked or destroyed, or lives lost, unlike your example of FedEx plane. Some US govt folks had their emails read.<p>Secondly, the US does this all the time, even to friendly countries, so it&#x27;s hard to justify harsher measures.</div><br/><div id="37410110" class="c"><input type="checkbox" id="c-37410110" checked=""/><div class="controls bullet"><span class="by">munificent</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409851">parent</a><span>|</span><a href="#37409318">next</a><span>|</span><label class="collapse" for="c-37410110">[-]</label><label class="expand" for="c-37410110">[1 more]</label></div><br/><div class="children"><div class="content"><i>&gt; no infrastructure was attacked or destroyed</i><p><i>Value</i> was destroyed in both cases. Users having their private data stolen have been harmed, the company&#x27;s brand value is harmed, and they may lose users over this.<p><i>&gt; or lives lost</i><p>Lives can be lost and real people can be harmed if their private information is stolen and used against them. There are dissidents and journalists in repressive countries whose safety depends on information security.</div><br/></div></div></div></div><div id="37409318" class="c"><input type="checkbox" id="c-37409318" checked=""/><div class="controls bullet"><span class="by">tschwimmer</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37409851">prev</a><span>|</span><a href="#37412642">next</a><span>|</span><label class="collapse" for="c-37409318">[-]</label><label class="expand" for="c-37409318">[8 more]</label></div><br/><div class="children"><div class="content">The digital domain is fundamentally lower stakes and harder to protect than the physical one. It is good that we do not respond to cyber attacks like we do physical ones because we would have escalated to nuclear war over a decade ago. The scope and volume of cyberattacks is very high but my understanding is that the US has a correspondingly high volume of outbound attacks as well.</div><br/><div id="37410532" class="c"><input type="checkbox" id="c-37410532" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409318">parent</a><span>|</span><a href="#37412642">next</a><span>|</span><label class="collapse" for="c-37410532">[-]</label><label class="expand" for="c-37410532">[7 more]</label></div><br/><div class="children"><div class="content">Fundamentally? A power plant exploding or dam collapsing would kill way more people and cost far more in property damage than a single FedEx airplane with two crew being shot down.</div><br/><div id="37411753" class="c"><input type="checkbox" id="c-37411753" checked=""/><div class="controls bullet"><span class="by">lazide</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37410532">parent</a><span>|</span><a href="#37413507">next</a><span>|</span><label class="collapse" for="c-37411753">[-]</label><label class="expand" for="c-37411753">[1 more]</label></div><br/><div class="children"><div class="content">Those all (currently) require a lot more than stealing a key from M$.  Maybe stuxnet would be a better example for your point? Those uranium centrifuges Iran had were <i>very</i> expensive.</div><br/></div></div><div id="37413507" class="c"><input type="checkbox" id="c-37413507" checked=""/><div class="controls bullet"><span class="by">gmueckl</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37410532">parent</a><span>|</span><a href="#37411753">prev</a><span>|</span><a href="#37412642">next</a><span>|</span><label class="collapse" for="c-37413507">[-]</label><label class="expand" for="c-37413507">[5 more]</label></div><br/><div class="children"><div class="content">I have no idea how you would get a dam to collapse with only a laptop and a network connection. As for the power plant, the operators would have to be blind and deaf to let a plant get destroyed.<p>The real threat is a cascading power grid failure due to undersupply, e.g. coordinated forced plant shutdowns. A few days without electricity at a large scale means reduced availability of medical and emergency services, no running water, failing refrigeration, no stoves&#x2F;ovens for cooking for most of the population, no working gas pumps, no electronic payment, no banking (no way to get cash) etc.</div><br/><div id="37414581" class="c"><input type="checkbox" id="c-37414581" checked=""/><div class="controls bullet"><span class="by">salawat</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37413507">parent</a><span>|</span><a href="#37413864">next</a><span>|</span><label class="collapse" for="c-37414581">[-]</label><label class="expand" for="c-37414581">[3 more]</label></div><br/><div class="children"><div class="content">&gt;I have no idea how you would get a dam to collapse with only a laptop and a network connection.<p>In a world where Stuxnet took out uranium centrifuges, and we&#x27;ve had actual PoC&#x27;s of exploits that resulted in generators fragging themselves, I find your statement to be of the most shocking form of naivete I&#x27;ve heard in a while.<p>And in point of fact, the network connection would probably be for disabling alarms and control systems in order to mask work done to weaken the integrity of the structure itself. Physical and digital is inextricably linked.</div><br/><div id="37415084" class="c"><input type="checkbox" id="c-37415084" checked=""/><div class="controls bullet"><span class="by">gmueckl</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37414581">parent</a><span>|</span><a href="#37413864">next</a><span>|</span><label class="collapse" for="c-37415084">[-]</label><label class="expand" for="c-37415084">[2 more]</label></div><br/><div class="children"><div class="content">A decently powerful generator is a <i>massive</i> machine. There is simply no way that it can destroy itself without causing abnormal behavior that will be noticed by on site personnel - noise, vibrations etc.</div><br/><div id="37416003" class="c"><input type="checkbox" id="c-37416003" checked=""/><div class="controls bullet"><span class="by">fullspectrumdev</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37415084">parent</a><span>|</span><a href="#37413864">next</a><span>|</span><label class="collapse" for="c-37416003">[-]</label><label class="expand" for="c-37416003">[1 more]</label></div><br/><div class="children"><div class="content">I vaguely recall seeing a video years ago of the demonstrated hack on a generator causing it to suffer a rapid unscheduled disassembly event.<p>It happened <i>very</i> fast, and was <i>very</i> unsubtle. Probably not enough time for site personnel to respond before damage was done.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="37412642" class="c"><input type="checkbox" id="c-37412642" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37409318">prev</a><span>|</span><a href="#37413185">next</a><span>|</span><label class="collapse" for="c-37412642">[-]</label><label class="expand" for="c-37412642">[1 more]</label></div><br/><div class="children"><div class="content">There are multiple cases of nation states blowing passenger jets out of the sky and commandeering ships without it being treated as an act of war.</div><br/></div></div><div id="37413185" class="c"><input type="checkbox" id="c-37413185" checked=""/><div class="controls bullet"><span class="by">jonstewart</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37412642">prev</a><span>|</span><a href="#37409265">next</a><span>|</span><label class="collapse" for="c-37413185">[-]</label><label class="expand" for="c-37413185">[1 more]</label></div><br/><div class="children"><div class="content">Shooting down a commercial airline from the US to Asia with a US Congressman onboard did not actually cause WWIII: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Korean_Air_Lines_Flight_007" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Korean_Air_Lines_Flight_007</a></div><br/></div></div><div id="37409265" class="c"><input type="checkbox" id="c-37409265" checked=""/><div class="controls bullet"><span class="by">eli</span><span>|</span><a href="#37409244">parent</a><span>|</span><a href="#37413185">prev</a><span>|</span><a href="#37410730">next</a><span>|</span><label class="collapse" for="c-37409265">[-]</label><label class="expand" for="c-37409265">[5 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t that the idea behind CISA?</div><br/><div id="37411726" class="c"><input type="checkbox" id="c-37411726" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409265">parent</a><span>|</span><a href="#37409285">next</a><span>|</span><label class="collapse" for="c-37411726">[-]</label><label class="expand" for="c-37411726">[1 more]</label></div><br/><div class="children"><div class="content">Very much no. CISA defends the federal executive branch and advises critical infrastructure. They donât and shouldnât have a proactive role in defending private companies.</div><br/></div></div><div id="37409285" class="c"><input type="checkbox" id="c-37409285" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409265">parent</a><span>|</span><a href="#37411726">prev</a><span>|</span><a href="#37409375">next</a><span>|</span><label class="collapse" for="c-37409285">[-]</label><label class="expand" for="c-37409285">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think so? What makes you think it is?</div><br/></div></div><div id="37409375" class="c"><input type="checkbox" id="c-37409375" checked=""/><div class="controls bullet"><span class="by">dboreham</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409265">parent</a><span>|</span><a href="#37409285">prev</a><span>|</span><a href="#37410730">next</a><span>|</span><label class="collapse" for="c-37409375">[-]</label><label class="expand" for="c-37409375">[2 more]</label></div><br/><div class="children"><div class="content">NSA</div><br/><div id="37411697" class="c"><input type="checkbox" id="c-37411697" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409244">root</a><span>|</span><a href="#37409375">parent</a><span>|</span><a href="#37410730">next</a><span>|</span><label class="collapse" for="c-37411697">[-]</label><label class="expand" for="c-37411697">[1 more]</label></div><br/><div class="children"><div class="content">Theyâre explicitly forbidden from doing things like that. As they should be; do you really want the government to have access to the kind of private corporation data they would need in order to defend them?</div><br/></div></div></div></div></div></div></div></div><div id="37410730" class="c"><input type="checkbox" id="c-37410730" checked=""/><div class="controls bullet"><span class="by">planetjones</span><span>|</span><a href="#37409244">prev</a><span>|</span><a href="#37411471">next</a><span>|</span><label class="collapse" for="c-37410730">[-]</label><label class="expand" for="c-37410730">[4 more]</label></div><br/><div class="children"><div class="content">None of the reports mention if two stage authentication or any other extra factor authentication that enterprise accounts would be secured with were bypassed too. Am I right to assume that because the attacker had the signing key all of the extra authentication mechanisms that would have been enabled on accounts were bypassed by the attacker (because the attacker could create a token that bypassed all the extra authentication methods)?<p>And I presume there has been no known dump of e-mails exfiltrated during this attack?</div><br/><div id="37416377" class="c"><input type="checkbox" id="c-37416377" checked=""/><div class="controls bullet"><span class="by">bobalob_wtf</span><span>|</span><a href="#37410730">parent</a><span>|</span><a href="#37413326">next</a><span>|</span><label class="collapse" for="c-37416377">[-]</label><label class="expand" for="c-37416377">[1 more]</label></div><br/><div class="children"><div class="content">With the signing key they could mint the same type of token you get once you pass all of the authentication steps.</div><br/></div></div><div id="37413326" class="c"><input type="checkbox" id="c-37413326" checked=""/><div class="controls bullet"><span class="by">SgtBastard</span><span>|</span><a href="#37410730">parent</a><span>|</span><a href="#37416377">prev</a><span>|</span><a href="#37412948">next</a><span>|</span><label class="collapse" for="c-37413326">[-]</label><label class="expand" for="c-37413326">[1 more]</label></div><br/><div class="children"><div class="content">Because it was a signing key that was stolen, the attackers could move straight to the post-authentication phase and forge authorization tokens.<p>Those email accounts could have had multiple authentication factors enabled, other conditional access policies applied (geo-location, device trust, time of day etc)â¦ all of which were skipped over.</div><br/></div></div><div id="37412948" class="c"><input type="checkbox" id="c-37412948" checked=""/><div class="controls bullet"><span class="by">ShadowRegent</span><span>|</span><a href="#37410730">parent</a><span>|</span><a href="#37413326">prev</a><span>|</span><a href="#37411471">next</a><span>|</span><label class="collapse" for="c-37412948">[-]</label><label class="expand" for="c-37412948">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Am I right to assume that because the attacker had the signing key all of the extra authentication mechanisms that would have been enabled on accounts were bypassed by the attacker...?<p>That&#x27;s my understanding.</div><br/></div></div></div></div><div id="37411471" class="c"><input type="checkbox" id="c-37411471" checked=""/><div class="controls bullet"><span class="by">drodgers</span><span>|</span><a href="#37410730">prev</a><span>|</span><a href="#37408954">next</a><span>|</span><label class="collapse" for="c-37411471">[-]</label><label class="expand" for="c-37411471">[5 more]</label></div><br/><div class="children"><div class="content">This is not confidence inspiring. These fixes are only surface-level, rather than looking at the underlying systemic failures:<p>- Not storing key data in an HSM.<p>- Exporting crashdumps outside of the production account.<p>Redacting private keys and other sensitive data from these will always be failure-prone. Keys are also only just one problem, there will be personal data, passwords etc. in those dumps depending on what process it was.<p>- Corp environment infiltration not detected at the time (presumably, since this part is pure guesswork)<p>- Not enough log retention in the corp environment to track a 2 year old infiltration.<p>- Not assuring that key validation correctly denied requests with the wrong scope.<p>Fails-with-a-valid-key-with-wrong-(scope&#x2F;date&#x2F;subject etc.) are the kind of cases that always deserve test coverage, especially for a dedicated key-validation endpoint. Also concerning that this wasn&#x27;t found by manual-testing&#x2F;red-teaming&#x2F;pen-testing in the time since it shipped.<p>- Slow detection, slow response, poor communication</div><br/><div id="37411715" class="c"><input type="checkbox" id="c-37411715" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#37411471">parent</a><span>|</span><a href="#37414717">next</a><span>|</span><label class="collapse" for="c-37411715">[-]</label><label class="expand" for="c-37411715">[1 more]</label></div><br/><div class="children"><div class="content">- Lack of timely key rotation<p>The lack of scope checking seems especially egregious. It sounds like any number of keys would have been incorrectly trusted. If it was an RSA key that signed JWTs which it sounds like or similar, Microsoft has an issuer endpoint for all customers and it&#x27;s critical to check the issuer&#x2F;scope for those since any number of things can create a token with a valid signature.</div><br/></div></div><div id="37414717" class="c"><input type="checkbox" id="c-37414717" checked=""/><div class="controls bullet"><span class="by">nicknow</span><span>|</span><a href="#37411471">parent</a><span>|</span><a href="#37411715">prev</a><span>|</span><a href="#37412188">next</a><span>|</span><label class="collapse" for="c-37414717">[-]</label><label class="expand" for="c-37414717">[1 more]</label></div><br/><div class="children"><div class="content">&gt; - Not enough log retention in the corp environment to track a 2 year old infiltration.<p>It didn&#x27;t say that Microsoft couldn&#x27;t identify that infiltration had occurred just that they didn&#x27;t retain the logs to prove to exfiltration. That makes a lot of sense, maintaining access logs is one thing but to retain the detailed logging of every file action by every user on a 100k+ user corporate network long-term would be a massive amount of storage, of fairly limited value.<p>Even in this case, it might be nice to have but it wouldn&#x27;t change any of the major findings you care about if you are Microsoft: that a bug allowed a key to be written to a dump file, that the scanning tools didn&#x27;t detect the key in the dump file, and that the authentication process didn&#x27;t properly check the keys.</div><br/></div></div><div id="37412188" class="c"><input type="checkbox" id="c-37412188" checked=""/><div class="controls bullet"><span class="by">yyyk</span><span>|</span><a href="#37411471">parent</a><span>|</span><a href="#37414717">prev</a><span>|</span><a href="#37411495">next</a><span>|</span><label class="collapse" for="c-37412188">[-]</label><label class="expand" for="c-37412188">[1 more]</label></div><br/><div class="children"><div class="content">&gt;crashdumps.. Redacting private keys and other sensitive data from these will always be failure-prone<p>&gt;Not enough log retention in the corp environment to track a 2 year old infiltration.<p>The two are in conflict. Redaction is a problem for logs as well. A longer retention period implies a more damaging vulnerability.</div><br/></div></div></div></div><div id="37408954" class="c"><input type="checkbox" id="c-37408954" checked=""/><div class="controls bullet"><span class="by">The28thDuck</span><span>|</span><a href="#37411471">prev</a><span>|</span><a href="#37416276">next</a><span>|</span><label class="collapse" for="c-37408954">[-]</label><label class="expand" for="c-37408954">[1 more]</label></div><br/><div class="children"><div class="content">Doesnât seem like an operational issue, seems more like 99.9% design coverage of preventing these issues from arising.<p>I will say, Iâm not very satisfied with just âimproved security tooling.â My gut is telling me that there is a better solution out there to guarding against credential leakage, but I feel wrangling memory dumps to have âexpectedâ data is a fools errand.</div><br/></div></div><div id="37416276" class="c"><input type="checkbox" id="c-37416276" checked=""/><div class="controls bullet"><span class="by">lucasRW</span><span>|</span><a href="#37408954">prev</a><span>|</span><a href="#37416269">next</a><span>|</span><label class="collapse" for="c-37416276">[-]</label><label class="expand" for="c-37416276">[1 more]</label></div><br/><div class="children"><div class="content">I like how the fact that Microsoft&#x27;s normal corporate environment (ie. the one with Internet connection) being compromised is casually considered as a secondary issue here.</div><br/></div></div><div id="37416269" class="c"><input type="checkbox" id="c-37416269" checked=""/><div class="controls bullet"><span class="by">lucasRW</span><span>|</span><a href="#37416276">prev</a><span>|</span><a href="#37412716">next</a><span>|</span><label class="collapse" for="c-37416269">[-]</label><label class="expand" for="c-37416269">[1 more]</label></div><br/><div class="children"><div class="content">I like how this investigation pretty much takes for granted that the normal corporate environment is compromised.</div><br/></div></div><div id="37412716" class="c"><input type="checkbox" id="c-37412716" checked=""/><div class="controls bullet"><span class="by">ranting-moth</span><span>|</span><a href="#37416269">prev</a><span>|</span><a href="#37415282">next</a><span>|</span><label class="collapse" for="c-37412716">[-]</label><label class="expand" for="c-37412716">[2 more]</label></div><br/><div class="children"><div class="content">Microsoft investigating a ginormous breach at Microsoft.<p>Common guys. This requires at least one 3rd party investigation to be credible.</div><br/><div id="37413877" class="c"><input type="checkbox" id="c-37413877" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#37412716">parent</a><span>|</span><a href="#37415282">next</a><span>|</span><label class="collapse" for="c-37413877">[-]</label><label class="expand" for="c-37413877">[1 more]</label></div><br/><div class="children"><div class="content">Then a bunch of Chinese guys show up as the 3rd party.</div><br/></div></div></div></div><div id="37415282" class="c"><input type="checkbox" id="c-37415282" checked=""/><div class="controls bullet"><span class="by">jokoon</span><span>|</span><a href="#37412716">prev</a><span>|</span><a href="#37410284">next</a><span>|</span><label class="collapse" for="c-37415282">[-]</label><label class="expand" for="c-37415282">[1 more]</label></div><br/><div class="children"><div class="content">How did those developers had access to that key, and how did it land in crash dump?<p>I smell like gross negligence here.</div><br/></div></div><div id="37410284" class="c"><input type="checkbox" id="c-37410284" checked=""/><div class="controls bullet"><span class="by">Eduard</span><span>|</span><a href="#37415282">prev</a><span>|</span><a href="#37409032">next</a><span>|</span><label class="collapse" for="c-37410284">[-]</label><label class="expand" for="c-37410284">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The key materialâs presence in the crash dump was not detected by our systems (this issue has been corrected).<p>Now hackers have it even easier to find valuable keys from otherwise opaque core dumps: Microsoft&#x27;s corrected detection software will tell them as soon as it finds one.</div><br/><div id="37412079" class="c"><input type="checkbox" id="c-37412079" checked=""/><div class="controls bullet"><span class="by">Arrath</span><span>|</span><a href="#37410284">parent</a><span>|</span><a href="#37409032">next</a><span>|</span><label class="collapse" for="c-37412079">[-]</label><label class="expand" for="c-37412079">[1 more]</label></div><br/><div class="children"><div class="content">While true that it is easier for malicious actors to find this kind of thing with a tool that goes DONG! after a quick scan, its not as if the previous security through obscurity of &quot;key hidden in megs or gigs of crashdump&quot; was much of a blocker for a suitably motivated adversary.</div><br/></div></div></div></div><div id="37409032" class="c"><input type="checkbox" id="c-37409032" checked=""/><div class="controls bullet"><span class="by">gordian-not</span><span>|</span><a href="#37410284">prev</a><span>|</span><a href="#37409645">next</a><span>|</span><label class="collapse" for="c-37409032">[-]</label><label class="expand" for="c-37409032">[13 more]</label></div><br/><div class="children"><div class="content">Weird they donât have logs saved for something that happened two years ago due to âretention policiesâ.<p>Thatâs something I would fix</div><br/><div id="37409060" class="c"><input type="checkbox" id="c-37409060" checked=""/><div class="controls bullet"><span class="by">paxys</span><span>|</span><a href="#37409032">parent</a><span>|</span><a href="#37409241">next</a><span>|</span><label class="collapse" for="c-37409060">[-]</label><label class="expand" for="c-37409060">[9 more]</label></div><br/><div class="children"><div class="content">It works this way by design. Most companies will retain logs for exactly as much time as legally required (and&#x2F;or operationally necessary), then purge them so they don&#x27;t show up in discovery for some lawsuit years down the line.</div><br/><div id="37411800" class="c"><input type="checkbox" id="c-37411800" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409060">parent</a><span>|</span><a href="#37409255">next</a><span>|</span><label class="collapse" for="c-37411800">[-]</label><label class="expand" for="c-37411800">[3 more]</label></div><br/><div class="children"><div class="content">It has nothing to do with discovery or legal liability and everything to do with cogs. Log size at cloud provider scale is genuinely something you have to see to believe; recall that these are logs for a company with multiple services that see 9-figure daily active users.</div><br/><div id="37412137" class="c"><input type="checkbox" id="c-37412137" checked=""/><div class="controls bullet"><span class="by">tristor</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37411800">parent</a><span>|</span><a href="#37409255">next</a><span>|</span><label class="collapse" for="c-37412137">[-]</label><label class="expand" for="c-37412137">[2 more]</label></div><br/><div class="children"><div class="content">This is the real answer.  The amount of logs generated at cloud provider scale now are massive compared to what they were just a few years ago.  The last time I was involved in these sorts of systems, circa 2014, logging was one of the core functions at a cloud provider that was &#x2F;most&#x2F; demanding of physical hardware, everything from compute, memory, and storage, all the way to networking.  A typical server in the environment in that provider in 2014 would have 2x10GigE connections set up for redundancy, log servers needed a minimum 2x40GigE connections &#x2F;for throughput&#x2F;.<p>These days I wouldn&#x27;t be surprised if they are running 100GigE or 400GigE networks just for managing logs throughput at aggregation points.</div><br/><div id="37414739" class="c"><input type="checkbox" id="c-37414739" checked=""/><div class="controls bullet"><span class="by">gordian-not</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37412137">parent</a><span>|</span><a href="#37409255">next</a><span>|</span><label class="collapse" for="c-37414739">[-]</label><label class="expand" for="c-37414739">[1 more]</label></div><br/><div class="children"><div class="content">weâre talking an intrusion to the corp network not to the prod one (getting the keys from the crash dump)<p>I assume thatâs a way smaller scale. However the document doesnât go into detail which kind of logs exactly they were missing, so maybe these were network logs</div><br/></div></div></div></div></div></div><div id="37409255" class="c"><input type="checkbox" id="c-37409255" checked=""/><div class="controls bullet"><span class="by">gordian-not</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409060">parent</a><span>|</span><a href="#37411800">prev</a><span>|</span><a href="#37409175">next</a><span>|</span><label class="collapse" for="c-37409255">[-]</label><label class="expand" for="c-37409255">[1 more]</label></div><br/><div class="children"><div class="content">Itâs security logs though, presumably these carry less legal risk than chat messages or mails<p>Also when you donât know how a Chinese threat group got into your network thatâs a major issue which will cost more than theoretical legal risk</div><br/></div></div><div id="37409175" class="c"><input type="checkbox" id="c-37409175" checked=""/><div class="controls bullet"><span class="by">eli</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409060">parent</a><span>|</span><a href="#37409255">prev</a><span>|</span><a href="#37412640">next</a><span>|</span><label class="collapse" for="c-37409175">[-]</label><label class="expand" for="c-37409175">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s also a GDPR requirement to minimize the collection of personal data and to purge it as soon as it is no longer needed.</div><br/><div id="37413404" class="c"><input type="checkbox" id="c-37413404" checked=""/><div class="controls bullet"><span class="by">wglb</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409175">parent</a><span>|</span><a href="#37412640">next</a><span>|</span><label class="collapse" for="c-37413404">[-]</label><label class="expand" for="c-37413404">[2 more]</label></div><br/><div class="children"><div class="content">There is a way to keep arbitrarily large logs and be fully compliant with GDPR with a little engineering.</div><br/><div id="37414793" class="c"><input type="checkbox" id="c-37414793" checked=""/><div class="controls bullet"><span class="by">gordian-not</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37413404">parent</a><span>|</span><a href="#37412640">next</a><span>|</span><label class="collapse" for="c-37414793">[-]</label><label class="expand" for="c-37414793">[1 more]</label></div><br/><div class="children"><div class="content">sounds interesting, can you elaborate a bit?</div><br/></div></div></div></div></div></div><div id="37412640" class="c"><input type="checkbox" id="c-37412640" checked=""/><div class="controls bullet"><span class="by">whimsicalism</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409060">parent</a><span>|</span><a href="#37409175">prev</a><span>|</span><a href="#37409241">next</a><span>|</span><label class="collapse" for="c-37412640">[-]</label><label class="expand" for="c-37412640">[1 more]</label></div><br/><div class="children"><div class="content">wrong, it has to do with size of the logs and gdpr</div><br/></div></div></div></div><div id="37409241" class="c"><input type="checkbox" id="c-37409241" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#37409032">parent</a><span>|</span><a href="#37409060">prev</a><span>|</span><a href="#37409102">next</a><span>|</span><label class="collapse" for="c-37409241">[-]</label><label class="expand" for="c-37409241">[1 more]</label></div><br/><div class="children"><div class="content">There are multiple regulatory reasons why logs in general (outside of specific use cases) are hard to retain indefinitely. You can document a security use case that triggers indefinite retention for logs based on some selector, but then you run into the problem that they say happened here: your selector is inexact and misses stuff.</div><br/></div></div><div id="37409102" class="c"><input type="checkbox" id="c-37409102" checked=""/><div class="controls bullet"><span class="by">ses1984</span><span>|</span><a href="#37409032">parent</a><span>|</span><a href="#37409241">prev</a><span>|</span><a href="#37409645">next</a><span>|</span><label class="collapse" for="c-37409102">[-]</label><label class="expand" for="c-37409102">[2 more]</label></div><br/><div class="children"><div class="content">Is it practical to keep logs detailed enough that would capture exfiltration like this from the corporate network?</div><br/><div id="37409199" class="c"><input type="checkbox" id="c-37409199" checked=""/><div class="controls bullet"><span class="by">ratg13</span><span>|</span><a href="#37409032">root</a><span>|</span><a href="#37409102">parent</a><span>|</span><a href="#37409645">next</a><span>|</span><label class="collapse" for="c-37409199">[-]</label><label class="expand" for="c-37409199">[1 more]</label></div><br/><div class="children"><div class="content">If you take the time to do a decent setup.<p>Text compresses extremely well and long-term archive space is generally inexpensive.<p>The hard part is all the work of deciding what is important, what the processes will be, and implementing a proper archive system.<p>Most people just don&#x27;t dedicate the resources to things like this until the need is demonstrated.</div><br/></div></div></div></div></div></div><div id="37409645" class="c"><input type="checkbox" id="c-37409645" checked=""/><div class="controls bullet"><span class="by">rdtsc</span><span>|</span><a href="#37409032">prev</a><span>|</span><a href="#37415327">next</a><span>|</span><label class="collapse" for="c-37409645">[-]</label><label class="expand" for="c-37409645">[1 more]</label></div><br/><div class="children"><div class="content">Wonder if the actor caused the crash of the system in the first place?<p>Or it was crashing so often they didnât have to.<p>Race condition to scrub the crashdump sounds fishy. When the system is crashing itâs hard to make assumptions or have any guarantees any cleanup and scrubbing is going to happen.</div><br/></div></div><div id="37415327" class="c"><input type="checkbox" id="c-37415327" checked=""/><div class="controls bullet"><span class="by">yalok</span><span>|</span><a href="#37409645">prev</a><span>|</span><a href="#37409500">next</a><span>|</span><label class="collapse" for="c-37415327">[-]</label><label class="expand" for="c-37415327">[1 more]</label></div><br/><div class="children"><div class="content">I always hesitate to send the crash dump for this very reason...</div><br/></div></div><div id="37409500" class="c"><input type="checkbox" id="c-37409500" checked=""/><div class="controls bullet"><span class="by">ynniv</span><span>|</span><a href="#37415327">prev</a><span>|</span><a href="#37409573">next</a><span>|</span><label class="collapse" for="c-37409500">[-]</label><label class="expand" for="c-37409500">[1 more]</label></div><br/><div class="children"><div class="content">And that&#x27;s why you should keep your key material in an HSM, kids</div><br/></div></div><div id="37409573" class="c"><input type="checkbox" id="c-37409573" checked=""/><div class="controls bullet"><span class="by">1970-01-01</span><span>|</span><a href="#37409500">prev</a><span>|</span><a href="#37409670">next</a><span>|</span><label class="collapse" for="c-37409573">[-]</label><label class="expand" for="c-37409573">[1 more]</label></div><br/><div class="children"><div class="content">&gt;Our investigation found that a consumer signing system crash in April of 2021 resulted in a snapshot of the crashed process (âcrash dumpâ). The crash dumps, which redact sensitive information, should not include the signing key. In this case, a race condition allowed the key to be present in the crash dump (this issue has been corrected).<p>Correction is good, but why can&#x27;t they go one more step and allow everyone to scan their server minidumps for crash-landed keys?</div><br/></div></div><div id="37409670" class="c"><input type="checkbox" id="c-37409670" checked=""/><div class="controls bullet"><span class="by">natch</span><span>|</span><a href="#37409573">prev</a><span>|</span><a href="#37413374">next</a><span>|</span><label class="collapse" for="c-37409670">[-]</label><label class="expand" for="c-37409670">[5 more]</label></div><br/><div class="children"><div class="content">&gt; Due to log retention policies, we donât have logs with specific evidence<p>No âthis issue has been correctedâ for this one. Are we still budgeting storage like itâs the 1990s for logs?</div><br/><div id="37410423" class="c"><input type="checkbox" id="c-37410423" checked=""/><div class="controls bullet"><span class="by">cesarb</span><span>|</span><a href="#37409670">parent</a><span>|</span><a href="#37413374">next</a><span>|</span><label class="collapse" for="c-37410423">[-]</label><label class="expand" for="c-37410423">[4 more]</label></div><br/><div class="children"><div class="content">&gt; &gt; Due to log retention policies, [...]<p>&gt; Are we still budgeting storage like itâs the 1990s for logs?<p>Retention policies are not necessarily about storage space; sometimes, they are there to avoid being required to provide that old data during lawsuits.</div><br/><div id="37411828" class="c"><input type="checkbox" id="c-37411828" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409670">root</a><span>|</span><a href="#37410423">parent</a><span>|</span><a href="#37413374">next</a><span>|</span><label class="collapse" for="c-37411828">[-]</label><label class="expand" for="c-37411828">[3 more]</label></div><br/><div class="children"><div class="content">Retention policies at cloud providers are 100% about storage space (and accompanying cost). At companies like Microsoft saying âreduced cogsâ is a very reliable way to get bonuses.</div><br/><div id="37414238" class="c"><input type="checkbox" id="c-37414238" checked=""/><div class="controls bullet"><span class="by">lazyasciiart</span><span>|</span><a href="#37409670">root</a><span>|</span><a href="#37411828">parent</a><span>|</span><a href="#37413374">next</a><span>|</span><label class="collapse" for="c-37414238">[-]</label><label class="expand" for="c-37414238">[2 more]</label></div><br/><div class="children"><div class="content">If storage space was 100% of the decision about logs they would not retain logs. The other factors include technical utility and legal considerations.</div><br/><div id="37415220" class="c"><input type="checkbox" id="c-37415220" checked=""/><div class="controls bullet"><span class="by">c0pium</span><span>|</span><a href="#37409670">root</a><span>|</span><a href="#37414238">parent</a><span>|</span><a href="#37413374">next</a><span>|</span><label class="collapse" for="c-37415220">[-]</label><label class="expand" for="c-37415220">[1 more]</label></div><br/><div class="children"><div class="content">Huh? Logs are how you run the service. Cost is what keeps you from retaining more of them. Since you seem not to be familiar with the subject, retention policy is something of a misnomer; it would be more accurate to call it a deletion&#x2F;destruction policy. The default is retain everything forever.<p>There are no legal considerations here. Thatâs what lawyers are for, and big tech has a ton of lawyers.<p>If you work somewhere that people are deleting things to keep them from being discoverable, run away as fast as you can.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37413374" class="c"><input type="checkbox" id="c-37413374" checked=""/><div class="controls bullet"><span class="by">PublicCoconut</span><span>|</span><a href="#37409670">prev</a><span>|</span><a href="#37412817">next</a><span>|</span><label class="collapse" for="c-37413374">[-]</label><label class="expand" for="c-37413374">[1 more]</label></div><br/><div class="children"><div class="content">Regarding: ârequires detailed knowledge of internal infrastructureâ<p>MSFT decided to move their APAC support center for Office365 to China. If there is an issue in APAC engineers usually respond from there. It makes sense regarding time zone and cost.<p>However, people change jobs etc. Hence this setup will result in a number of good engineers with very detailed knowledge of those systems who live in China.<p>On the more tinfoil end of ideas: if the office for this work is in a particular country it brings corresponding risks for physical opsec of the infra.</div><br/></div></div><div id="37412817" class="c"><input type="checkbox" id="c-37412817" checked=""/><div class="controls bullet"><span class="by">aftbit</span><span>|</span><a href="#37413374">prev</a><span>|</span><a href="#37409343">next</a><span>|</span><label class="collapse" for="c-37412817">[-]</label><label class="expand" for="c-37412817">[1 more]</label></div><br/><div class="children"><div class="content">I do not fully understand the nature of the credential used here. Why was it still accepted several years after it was generated?</div><br/></div></div><div id="37409343" class="c"><input type="checkbox" id="c-37409343" checked=""/><div class="controls bullet"><span class="by">_tk_</span><span>|</span><a href="#37412817">prev</a><span>|</span><a href="#37410016">next</a><span>|</span><label class="collapse" for="c-37409343">[-]</label><label class="expand" for="c-37409343">[1 more]</label></div><br/><div class="children"><div class="content">I am very curious why Microsoft is insisting that the key itself was âacquiredâ without having anything to show for it. The wording seems a little odd to me, the constant repetition even more so.</div><br/></div></div><div id="37410016" class="c"><input type="checkbox" id="c-37410016" checked=""/><div class="controls bullet"><span class="by">bananapub</span><span>|</span><a href="#37409343">prev</a><span>|</span><a href="#37411213">next</a><span>|</span><label class="collapse" for="c-37410016">[-]</label><label class="expand" for="c-37410016">[1 more]</label></div><br/><div class="children"><div class="content">as far as I can tell, the only non-bug mistake here was allowing coredumps to leave production ever.  if this is your attacker, you are pretty fucked no matter how good you are.</div><br/></div></div><div id="37411213" class="c"><input type="checkbox" id="c-37411213" checked=""/><div class="controls bullet"><span class="by">65a</span><span>|</span><a href="#37410016">prev</a><span>|</span><a href="#37413117">next</a><span>|</span><label class="collapse" for="c-37411213">[-]</label><label class="expand" for="c-37411213">[1 more]</label></div><br/><div class="children"><div class="content">1. Use HSMs, especially for big important keys with longevity<p>2. Minimize workflows that cross security boundaries<p>Are my takeaways</div><br/></div></div><div id="37413117" class="c"><input type="checkbox" id="c-37413117" checked=""/><div class="controls bullet"><span class="by">AtNightWeCode</span><span>|</span><a href="#37411213">prev</a><span>|</span><label class="collapse" for="c-37413117">[-]</label><label class="expand" for="c-37413117">[1 more]</label></div><br/><div class="children"><div class="content">Is the key a certificate? Then it might be installed on all Service Fabric clusters. There is overall something fishy with X.509 handling in Azure.</div><br/></div></div></div></div></div></div></div></body></html>