<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712307649518" as="style"/><link rel="stylesheet" href="styles.css?v=1712307649518"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://nowotarski.info/http2-continuation-flood-technical-details/">HTTP/2 Continuation Flood: Technical Details</a> <span class="domain">(<a href="https://nowotarski.info">nowotarski.info</a>)</span></div><div class="subtext"><span>campuscodi</span> | <span>30 comments</span></div><br/><div><div id="39933521" class="c"><input type="checkbox" id="c-39933521" checked=""/><div class="controls bullet"><span class="by">mcmatterson</span><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39933521">[-]</label><label class="expand" for="c-39933521">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;d just mitigated this exact thing in Bandit last month!<p><a href="https:&#x2F;&#x2F;github.com&#x2F;mtrudel&#x2F;bandit&#x2F;blob&#x2F;main&#x2F;lib&#x2F;bandit&#x2F;http2&#x2F;connection.ex#L84">https:&#x2F;&#x2F;github.com&#x2F;mtrudel&#x2F;bandit&#x2F;blob&#x2F;main&#x2F;lib&#x2F;bandit&#x2F;http2...</a><p>TBH, from an implementors perspective this is a super obvious thing to cover off. It had long been on my radar and was something that I&#x27;d always figured other implementations had defended against as well.</div><br/><div id="39934526" class="c"><input type="checkbox" id="c-39934526" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#39933521">parent</a><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39934526">[-]</label><label class="expand" for="c-39934526">[5 more]</label></div><br/><div class="children"><div class="content">Well you know what happens when we assume. You make a front page headline out of you and me.</div><br/><div id="39937262" class="c"><input type="checkbox" id="c-39937262" checked=""/><div class="controls bullet"><span class="by">eek2121</span><span>|</span><a href="#39933521">root</a><span>|</span><a href="#39934526">parent</a><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39937262">[-]</label><label class="expand" for="c-39937262">[4 more]</label></div><br/><div class="children"><div class="content">As someone who worked for a terrible startup that &#x27;assumed&#x27; they would have scalability issues, engineered their entire software stack around solving said issues, and ended up with a worthless codebase that nobody could wrap their head around as a result, I feel this comment.<p>Later they began a small refactor which easily handled the loads they were &quot;assuming&quot; could not be handled in the way that the refactor handled, and it was wildly successful and the code was much simpler to work on.<p>To developers: don&#x27;t over engineer. Most languages&#x2F;frameworks&#x2F;libraries can handle scale beyond what you&#x27;ll ever get in your initial implementation. No, you entire website does NOT need to be asynchronous. It is very possible to have too many background jobs. I know this because I&#x27;ve seen the horror. I&#x27;ve also written an entire jobless&#x2F;synchronous platform that serves millions of users without issue. If you run into scaling issues, that is a good problem to have. Tackle it as it happens.<p>Bottom line is focus on secure, quality code above all else. Don&#x27;t make assumptions.</div><br/><div id="39937715" class="c"><input type="checkbox" id="c-39937715" checked=""/><div class="controls bullet"><span class="by">snailscale</span><span>|</span><a href="#39933521">root</a><span>|</span><a href="#39937262">parent</a><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39937715">[-]</label><label class="expand" for="c-39937715">[3 more]</label></div><br/><div class="children"><div class="content">The default way we write applications is actually pretty scalable already.<p>It always hurts to build something that “won’t scale” because it was framed as a negative.<p>Realizing that something “scales” if it meets your current needs is pretty important.<p>Framing scale in terms of how many people can work on it, how fast they can work on it, and how well it meets needs is often a better way of considering the “scale” of what your building.<p>As you said, when request per second becomes a limiting factor you can adjust your scales but doing it from start rarely makes sense (largely because req &#x2F; sec already scales pretty well)</div><br/><div id="39937862" class="c"><input type="checkbox" id="c-39937862" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#39933521">root</a><span>|</span><a href="#39937715">parent</a><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39937862">[-]</label><label class="expand" for="c-39937862">[2 more]</label></div><br/><div class="children"><div class="content">It’s often a fear or trauma response. Nobody wants to spend 6 months out of the year trying to keep the plates spinning, and they definitely don’t want to spend 60 hours a week when things get ahead of them. Everything takes twice as long as we think it will and we don’t trust that we can keep ahead of user demand. Many of us have experienced it or been adjacent, and for a long time after we overreact to that scenario.<p>Because we don’t trust that we can keep the wheels on.<p>Over time the memory fades, and the confidence improves, and we get more comfortable with things being okay instead of unassailable. But it can be a rough road until then.</div><br/><div id="39938804" class="c"><input type="checkbox" id="c-39938804" checked=""/><div class="controls bullet"><span class="by">moqmar</span><span>|</span><a href="#39933521">root</a><span>|</span><a href="#39937862">parent</a><span>|</span><a href="#39937340">next</a><span>|</span><label class="collapse" for="c-39938804">[-]</label><label class="expand" for="c-39938804">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, and out of that fear, people often use stacks that require vast amounts of knowledge to actually keep things working at all, at any scale. Kubernetes is the best example where I don&#x27;t trust me to keep the wheels on <i>because</i> it&#x27;s scalable.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="39937340" class="c"><input type="checkbox" id="c-39937340" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39933521">prev</a><span>|</span><a href="#39932916">next</a><span>|</span><label class="collapse" for="c-39937340">[-]</label><label class="expand" for="c-39937340">[2 more]</label></div><br/><div class="children"><div class="content"><i>In the last couple of months I checked dozens of implementations and, somehow, these protections were not implemented (or implemented incorrectly) even in major HTTP&#x2F;2 servers</i><p>I&#x27;ll speak to the elephant in the room: this is what happens when you have an entire developer culture so used to automatically dynamically expanding everything and not caring how big it is, that they never think about how big something can be.<p>This class of problems isn&#x27;t necessarily restricted to HTTP&#x2F;2, although its gross complexity probably contributes; it&#x27;s just that in HTTP&#x2F;1.x times, more developers would be used to languages like C where managing buffer lengths takes constant attention, and no one would bother to make header allocations expand limitlessly when they should be a few K in total at most for the whole request.</div><br/><div id="39938381" class="c"><input type="checkbox" id="c-39938381" checked=""/><div class="controls bullet"><span class="by">10000truths</span><span>|</span><a href="#39937340">parent</a><span>|</span><a href="#39932916">next</a><span>|</span><label class="collapse" for="c-39938381">[-]</label><label class="expand" for="c-39938381">[1 more]</label></div><br/><div class="children"><div class="content">The issue is that people constantly focus on and optimize for the happy path, but don&#x27;t stop and think about what would happen if an adversary deliberately and repeatedly triggered the worst case scenario. So many denial-of-service attacks (slowloris, query parameter hash collisions, etc.) come into fruition because bounded resource usage is an afterthought.</div><br/></div></div></div></div><div id="39932916" class="c"><input type="checkbox" id="c-39932916" checked=""/><div class="controls bullet"><span class="by">nullindividual</span><span>|</span><a href="#39937340">prev</a><span>|</span><a href="#39933943">next</a><span>|</span><label class="collapse" for="c-39932916">[-]</label><label class="expand" for="c-39932916">[1 more]</label></div><br/><div class="children"><div class="content">Previous article with impacted web servers&#x2F;reverse proxies from the same author.<p><a href="https:&#x2F;&#x2F;nowotarski.info&#x2F;http2-continuation-flood&#x2F;" rel="nofollow">https:&#x2F;&#x2F;nowotarski.info&#x2F;http2-continuation-flood&#x2F;</a></div><br/></div></div><div id="39933943" class="c"><input type="checkbox" id="c-39933943" checked=""/><div class="controls bullet"><span class="by">jagger27</span><span>|</span><a href="#39932916">prev</a><span>|</span><a href="#39936130">next</a><span>|</span><label class="collapse" for="c-39933943">[-]</label><label class="expand" for="c-39933943">[5 more]</label></div><br/><div class="children"><div class="content">&gt; NOT affected: Nginx, Jetty, HAProxy, NetScaler, Varnish. [0]<p>0: <a href="https:&#x2F;&#x2F;nowotarski.info&#x2F;http2-continuation-flood&#x2F;" rel="nofollow">https:&#x2F;&#x2F;nowotarski.info&#x2F;http2-continuation-flood&#x2F;</a></div><br/><div id="39935335" class="c"><input type="checkbox" id="c-39935335" checked=""/><div class="controls bullet"><span class="by">bklyn11201</span><span>|</span><a href="#39933943">parent</a><span>|</span><a href="#39936130">next</a><span>|</span><label class="collapse" for="c-39935335">[-]</label><label class="expand" for="c-39935335">[4 more]</label></div><br/><div class="children"><div class="content">What about Caddy? It&#x27;s a great project that deserves it&#x27;s own line ;)</div><br/><div id="39935465" class="c"><input type="checkbox" id="c-39935465" checked=""/><div class="controls bullet"><span class="by">programd</span><span>|</span><a href="#39933943">root</a><span>|</span><a href="#39935335">parent</a><span>|</span><a href="#39936130">next</a><span>|</span><label class="collapse" for="c-39935465">[-]</label><label class="expand" for="c-39935465">[3 more]</label></div><br/><div class="children"><div class="content">On Ubuntu 22.04 LTS caddy from the Ubuntu apt repo is shown as on version 2.7.6 and built with Go 1.21.5. That version of Go does not have a fix for this issue. Caddy 2.7.6 is also the latest version released on GitHub.<p>So no fix yet, but I think all that&#x27;s needed is a recompile with the latest version of Go 1.22.2</div><br/><div id="39936033" class="c"><input type="checkbox" id="c-39936033" checked=""/><div class="controls bullet"><span class="by">nelse</span><span>|</span><a href="#39933943">root</a><span>|</span><a href="#39935465">parent</a><span>|</span><a href="#39936130">next</a><span>|</span><label class="collapse" for="c-39936033">[-]</label><label class="expand" for="c-39936033">[2 more]</label></div><br/><div class="children"><div class="content">I think that recompiling with upgraded Go will not solve the issue. It seems Caddy imports `golang.org&#x2F;x&#x2F;net&#x2F;http2` and pins it to v0.22.0 which is vulnerable: <a href="https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;caddy&#x2F;issues&#x2F;6219#issuecomment-2038265390">https:&#x2F;&#x2F;github.com&#x2F;caddyserver&#x2F;caddy&#x2F;issues&#x2F;6219#issuecommen...</a>.</div><br/><div id="39936690" class="c"><input type="checkbox" id="c-39936690" checked=""/><div class="controls bullet"><span class="by">thegeekpirate</span><span>|</span><a href="#39933943">root</a><span>|</span><a href="#39936033">parent</a><span>|</span><a href="#39936130">next</a><span>|</span><label class="collapse" for="c-39936690">[-]</label><label class="expand" for="c-39936690">[1 more]</label></div><br/><div class="children"><div class="content">Looks like it&#x27;s been fixed if you recompile from master as of a few minutes ago</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39936130" class="c"><input type="checkbox" id="c-39936130" checked=""/><div class="controls bullet"><span class="by">unethical_ban</span><span>|</span><a href="#39933943">prev</a><span>|</span><a href="#39932705">next</a><span>|</span><label class="collapse" for="c-39936130">[-]</label><label class="expand" for="c-39936130">[9 more]</label></div><br/><div class="children"><div class="content">This has been at the top all day.<p>I wonder: For low-traffic websites, is it possible that running HTTP&#x2F;1.1 is just safer?</div><br/><div id="39938064" class="c"><input type="checkbox" id="c-39938064" checked=""/><div class="controls bullet"><span class="by">nirui</span><span>|</span><a href="#39936130">parent</a><span>|</span><a href="#39936810">next</a><span>|</span><label class="collapse" for="c-39938064">[-]</label><label class="expand" for="c-39938064">[1 more]</label></div><br/><div class="children"><div class="content">HTTP&#x2F;1.1 is far easier to implement, thus it is reasonable to assume it should contain fewer bugs.<p>HTTP&#x2F;2 (and HTTP&#x2F;3) is vastly different in features (added multiplexing, windowing, HPACK etc). All this transforms a largely stateless connection (in the HTTP&#x2F;1.1 case) to a stateful one. And in order to maintain the stateful connection, you need to store some data (state, configuration etc), thus all these problems.<p>Also, in HTTP&#x2F;2, since multiplexing is added, the protection characteristics are different. For example, if the connections were generated by CDN source draws, you may just allow fewer number of connections each with a large pool of multiplex channels, but if the connections were from direct user access, you may then want to allow large number of connections, but each with fewer number of multiplex channels. In HTTP&#x2F;1, protection is much simpler, since everybody looked almost the same.</div><br/></div></div><div id="39936810" class="c"><input type="checkbox" id="c-39936810" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#39936130">parent</a><span>|</span><a href="#39938064">prev</a><span>|</span><a href="#39936630">next</a><span>|</span><label class="collapse" for="c-39936810">[-]</label><label class="expand" for="c-39936810">[4 more]</label></div><br/><div class="children"><div class="content">Upgrading merely to upgrade is not good engineering practice.  If you expect to receive no additional benefits from the upgrade then it is probably not justified.</div><br/><div id="39937277" class="c"><input type="checkbox" id="c-39937277" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39936130">root</a><span>|</span><a href="#39936810">parent</a><span>|</span><a href="#39936630">next</a><span>|</span><label class="collapse" for="c-39937277">[-]</label><label class="expand" for="c-39937277">[3 more]</label></div><br/><div class="children"><div class="content">Unfortunately, there&#x27;s also a lot of parroting that upgrading is a &quot;best&quot; practice.</div><br/><div id="39938979" class="c"><input type="checkbox" id="c-39938979" checked=""/><div class="controls bullet"><span class="by">adra</span><span>|</span><a href="#39936130">root</a><span>|</span><a href="#39937277">parent</a><span>|</span><a href="#39936630">next</a><span>|</span><label class="collapse" for="c-39938979">[-]</label><label class="expand" for="c-39938979">[2 more]</label></div><br/><div class="children"><div class="content">COBOL was great until it wasn&#x27;t.</div><br/><div id="39939163" class="c"><input type="checkbox" id="c-39939163" checked=""/><div class="controls bullet"><span class="by">citrin_ru</span><span>|</span><a href="#39936130">root</a><span>|</span><a href="#39938979">parent</a><span>|</span><a href="#39936630">next</a><span>|</span><label class="collapse" for="c-39939163">[-]</label><label class="expand" for="c-39939163">[1 more]</label></div><br/><div class="children"><div class="content">Would not say that COBOL is still great (never wrote it) but the main problems in COBOL horror stories usually mismanagement and underinvestment, not the technology.</div><br/></div></div></div></div></div></div></div></div><div id="39936630" class="c"><input type="checkbox" id="c-39936630" checked=""/><div class="controls bullet"><span class="by">dexwiz</span><span>|</span><a href="#39936130">parent</a><span>|</span><a href="#39936810">prev</a><span>|</span><a href="#39936875">next</a><span>|</span><label class="collapse" for="c-39936630">[-]</label><label class="expand" for="c-39936630">[1 more]</label></div><br/><div class="children"><div class="content">Probably. HTTP&#x2F;2 is good for streaming, and even that is being replaced by newer protocols.<p>For normal asset serving the only advantage is more assets can be loaded in parallel since HTTP&#x2F;1 is limited on connections per domain. CDNs on different domains usually prevent this from being an issue.<p>In theory you could serve unbundled JS assets via HTTP&#x2F;2, but I have never seen it in production. Likely because you still need a compilation step most of the time.</div><br/></div></div><div id="39936767" class="c"><input type="checkbox" id="c-39936767" checked=""/><div class="controls bullet"><span class="by">graemep</span><span>|</span><a href="#39936130">parent</a><span>|</span><a href="#39936875">prev</a><span>|</span><a href="#39932705">next</a><span>|</span><label class="collapse" for="c-39936767">[-]</label><label class="expand" for="c-39936767">[1 more]</label></div><br/><div class="children"><div class="content">I was wondering about that. It is more mature an less complex so it seems probable it is safer.</div><br/></div></div></div></div><div id="39932705" class="c"><input type="checkbox" id="c-39932705" checked=""/><div class="controls bullet"><span class="by">skywhopper</span><span>|</span><a href="#39936130">prev</a><span>|</span><a href="#39933331">next</a><span>|</span><label class="collapse" for="c-39932705">[-]</label><label class="expand" for="c-39932705">[1 more]</label></div><br/><div class="children"><div class="content">Nice writeup and great find! Kudos to the author for taking such a broad approach and responsibly reporting their findings and finally for sharing the details in such a readable way.</div><br/></div></div><div id="39933331" class="c"><input type="checkbox" id="c-39933331" checked=""/><div class="controls bullet"><span class="by">pmlnr</span><span>|</span><a href="#39932705">prev</a><span>|</span><a href="#39932631">next</a><span>|</span><label class="collapse" for="c-39933331">[-]</label><label class="expand" for="c-39933331">[1 more]</label></div><br/><div class="children"><div class="content">Now do this slowly, and you can call it slowloris v2 :(</div><br/></div></div><div id="39932631" class="c"><input type="checkbox" id="c-39932631" checked=""/><div class="controls bullet"><span class="by">tzot</span><span>|</span><a href="#39933331">prev</a><span>|</span><a href="#39934264">next</a><span>|</span><label class="collapse" for="c-39932631">[-]</label><label class="expand" for="c-39932631">[1 more]</label></div><br/><div class="children"><div class="content">I just love this typo:<p>&gt; After serveral retries</div><br/></div></div><div id="39934264" class="c"><input type="checkbox" id="c-39934264" checked=""/><div class="controls bullet"><span class="by">shuntress</span><span>|</span><a href="#39932631">prev</a><span>|</span><label class="collapse" for="c-39934264">[-]</label><label class="expand" for="c-39934264">[3 more]</label></div><br/><div class="children"><div class="content">HTTP&#x2F;2 or How to Cram a Transport Layer &quot;Upgrade&quot; Into an Application Layer Protocol.</div><br/></div></div></div></div></div></div></div></body></html>