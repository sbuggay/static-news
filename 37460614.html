<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1694422870094" as="style"/><link rel="stylesheet" href="styles.css?v=1694422870094"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://popovicu.com/posts/risc-v-sbi-and-full-boot-process/">RISC-V SBI and the full boot process</a>Â <span class="domain">(<a href="https://popovicu.com">popovicu.com</a>)</span></div><div class="subtext"><span>snvzz</span> | <span>19 comments</span></div><br/><div><div id="37460936" class="c"><input type="checkbox" id="c-37460936" checked=""/><div class="controls bullet"><span class="by">Taniwha</span><span>|</span><a href="#37464372">next</a><span>|</span><label class="collapse" for="c-37460936">[-]</label><label class="expand" for="c-37460936">[15 more]</label></div><br/><div class="children"><div class="content">It&#x27;s worth understanding that the initial hard coded (pre OpenSBI) code on a real CPU (rather than an emulator like QEMU) is likely doing a bunch of things:<p><pre><code>   - Initialising the DRAM controller and sizing memory
   - optionally doing some crypto auth of the OpenSBI&#x2F;etc to make sure they&#x27;re not bogus
   - Copying OpenSBI (and possibly a subsequent U-boot or kernel) into it from ROM</code></pre></div><br/><div id="37460995" class="c"><input type="checkbox" id="c-37460995" checked=""/><div class="controls bullet"><span class="by">Taniwha</span><span>|</span><a href="#37460936">parent</a><span>|</span><a href="#37460977">next</a><span>|</span><label class="collapse" for="c-37460995">[-]</label><label class="expand" for="c-37460995">[7 more]</label></div><br/><div class="children"><div class="content">Also the RISC-V ABI requires that the initial code passes a pointer to a minimal device tree to OpenSBI - this means it can tell it where the UART is, how many CPUs to expect, where the interrupt controllers are (and what type they are) etc etc - this can then be passed on to uboot&#x2F;uefi&#x2F;linux or overridden or edited as they like</div><br/><div id="37463185" class="c"><input type="checkbox" id="c-37463185" checked=""/><div class="controls bullet"><span class="by">codedokode</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37460995">parent</a><span>|</span><a href="#37462567">next</a><span>|</span><label class="collapse" for="c-37463185">[-]</label><label class="expand" for="c-37463185">[3 more]</label></div><br/><div class="children"><div class="content">Why cannot UART address be fixed by a standard? Is there any merit in having UART at different addresses on different machines?</div><br/><div id="37463542" class="c"><input type="checkbox" id="c-37463542" checked=""/><div class="controls bullet"><span class="by">snvzz</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37463185">parent</a><span>|</span><a href="#37463390">next</a><span>|</span><label class="collapse" for="c-37463542">[-]</label><label class="expand" for="c-37463542">[1 more]</label></div><br/><div class="children"><div class="content">&gt;Is there any merit in having UART at different addresses on different machines?<p>Is there any advantage to encumbering the ISA by having a fixed memory address?<p>If what you need is a debug console, use SBI Debug Console Extension[0].<p>Otherwise, get the address from the device tree, or from the pointer you&#x27;ve been passed by the SPL, if you are the SBI or you run without SBI.<p>Note that, in the first place, you will be accessing the UART registers using a register as base + an offset.<p>0. <a href="https:&#x2F;&#x2F;github.com&#x2F;riscv-non-isa&#x2F;riscv-sbi-doc&#x2F;blob&#x2F;master&#x2F;src&#x2F;ext-debug-console.adoc">https:&#x2F;&#x2F;github.com&#x2F;riscv-non-isa&#x2F;riscv-sbi-doc&#x2F;blob&#x2F;master&#x2F;s...</a></div><br/></div></div><div id="37463390" class="c"><input type="checkbox" id="c-37463390" checked=""/><div class="controls bullet"><span class="by">wazzaps</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37463185">parent</a><span>|</span><a href="#37463542">prev</a><span>|</span><a href="#37462567">next</a><span>|</span><label class="collapse" for="c-37463390">[-]</label><label class="expand" for="c-37463390">[1 more]</label></div><br/><div class="children"><div class="content">What if you have no UARTs? Multiple UARTs?</div><br/></div></div></div></div><div id="37462567" class="c"><input type="checkbox" id="c-37462567" checked=""/><div class="controls bullet"><span class="by">xxpor</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37460995">parent</a><span>|</span><a href="#37463185">prev</a><span>|</span><a href="#37460977">next</a><span>|</span><label class="collapse" for="c-37462567">[-]</label><label class="expand" for="c-37462567">[3 more]</label></div><br/><div class="children"><div class="content">Does that mean RISC-V doesn&#x27;t support ACPI at all, even in theory?</div><br/><div id="37464627" class="c"><input type="checkbox" id="c-37464627" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37462567">parent</a><span>|</span><a href="#37462923">next</a><span>|</span><label class="collapse" for="c-37464627">[-]</label><label class="expand" for="c-37464627">[1 more]</label></div><br/><div class="children"><div class="content">Yes there&#x27;s ACPI &amp; UEFI.  Sunil V L from Ventana has been gradually pushing ECRs through the ACPI organization to add features and getting the corresponding stuff into the Linux kernel, eg: <a href="https:&#x2F;&#x2F;lore.kernel.org&#x2F;lkml&#x2F;20230216182043.1946553-4-sunilvl@ventanamicro.com&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;lore.kernel.org&#x2F;lkml&#x2F;20230216182043.1946553-4-sunilv...</a></div><br/></div></div><div id="37462923" class="c"><input type="checkbox" id="c-37462923" checked=""/><div class="controls bullet"><span class="by">snvzz</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37462567">parent</a><span>|</span><a href="#37464627">prev</a><span>|</span><a href="#37460977">next</a><span>|</span><label class="collapse" for="c-37462923">[-]</label><label class="expand" for="c-37462923">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a RISC-V ACPI spec[0].<p>Note anything to do with ACPI would run after, not before, OpenSBI.<p>0. <a href="https:&#x2F;&#x2F;github.com&#x2F;riscv-non-isa&#x2F;riscv-acpi&#x2F;releases">https:&#x2F;&#x2F;github.com&#x2F;riscv-non-isa&#x2F;riscv-acpi&#x2F;releases</a></div><br/></div></div></div></div></div></div><div id="37460977" class="c"><input type="checkbox" id="c-37460977" checked=""/><div class="controls bullet"><span class="by">aappleby</span><span>|</span><a href="#37460936">parent</a><span>|</span><a href="#37460995">prev</a><span>|</span><a href="#37460968">next</a><span>|</span><label class="collapse" for="c-37460977">[-]</label><label class="expand" for="c-37460977">[5 more]</label></div><br/><div class="children"><div class="content">Yep, and if you&#x27;re playing with your own homebrew OS or other non-linux OSes you don&#x27;t really need all of OpenSBI - implementing the equivalent of putchar() and a few timer calls will get you up and running. (Source - did bring up for rv32 simulators running TockOS and seL4).</div><br/><div id="37461356" class="c"><input type="checkbox" id="c-37461356" checked=""/><div class="controls bullet"><span class="by">kaycebasques</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37460977">parent</a><span>|</span><a href="#37461010">next</a><span>|</span><label class="collapse" for="c-37461356">[-]</label><label class="expand" for="c-37461356">[3 more]</label></div><br/><div class="children"><div class="content">Are there any highly regarded bringup docs out there? I.e. docs from an OS, emulator, etc. that do a great job of explaining how to get the OS running on new hardware. Or is it usually just done by studying previous code examples and asking experts for help?</div><br/><div id="37462240" class="c"><input type="checkbox" id="c-37462240" checked=""/><div class="controls bullet"><span class="by">arcbyte</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37461356">parent</a><span>|</span><a href="#37462943">next</a><span>|</span><label class="collapse" for="c-37462240">[-]</label><label class="expand" for="c-37462240">[1 more]</label></div><br/><div class="children"><div class="content">Plugging osdev.org in case its new to you.</div><br/></div></div><div id="37462943" class="c"><input type="checkbox" id="c-37462943" checked=""/><div class="controls bullet"><span class="by">snvzz</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37461356">parent</a><span>|</span><a href="#37462240">prev</a><span>|</span><a href="#37461010">next</a><span>|</span><label class="collapse" for="c-37462943">[-]</label><label class="expand" for="c-37462943">[1 more]</label></div><br/><div class="children"><div class="content">As it applies to RISC-V, you&#x27;ll want to get started by looking at the privileged ISA spec, the SBI spec and the platform spec.</div><br/></div></div></div></div><div id="37461010" class="c"><input type="checkbox" id="c-37461010" checked=""/><div class="controls bullet"><span class="by">Taniwha</span><span>|</span><a href="#37460936">root</a><span>|</span><a href="#37460977">parent</a><span>|</span><a href="#37461356">prev</a><span>|</span><a href="#37460968">next</a><span>|</span><label class="collapse" for="c-37461010">[-]</label><label class="expand" for="c-37461010">[1 more]</label></div><br/><div class="children"><div class="content">you may need the emulation of unaligned memory accesses - which is something else that OpenSBI does for you</div><br/></div></div></div></div><div id="37463181" class="c"><input type="checkbox" id="c-37463181" checked=""/><div class="controls bullet"><span class="by">codedokode</span><span>|</span><a href="#37460936">parent</a><span>|</span><a href="#37460968">prev</a><span>|</span><a href="#37464372">next</a><span>|</span><label class="collapse" for="c-37463181">[-]</label><label class="expand" for="c-37463181">[1 more]</label></div><br/><div class="children"><div class="content">you forgot &quot;adding a backdoor for remote access by manufacturer&quot;</div><br/></div></div></div></div><div id="37464372" class="c"><input type="checkbox" id="c-37464372" checked=""/><div class="controls bullet"><span class="by">ruslan</span><span>|</span><a href="#37460936">prev</a><span>|</span><a href="#37463339">next</a><span>|</span><label class="collapse" for="c-37464372">[-]</label><label class="expand" for="c-37464372">[1 more]</label></div><br/><div class="children"><div class="content">I would like to read a brief review of OpenSBI functions, or a rather minimum required set to get Linux like OS to run. How much Linux kernel depends on supervisor ? Also, worth pointing that there&#x27;s U-Boot which also does some hardware initialization on which kernel relies on.</div><br/></div></div><div id="37463339" class="c"><input type="checkbox" id="c-37463339" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#37464372">prev</a><span>|</span><label class="collapse" for="c-37463339">[-]</label><label class="expand" for="c-37463339">[2 more]</label></div><br/><div class="children"><div class="content">Great info, though <i>very</i> verbose!</div><br/><div id="37464443" class="c"><input type="checkbox" id="c-37464443" checked=""/><div class="controls bullet"><span class="by">j16sdiz</span><span>|</span><a href="#37463339">parent</a><span>|</span><label class="collapse" for="c-37464443">[-]</label><label class="expand" for="c-37464443">[1 more]</label></div><br/><div class="children"><div class="content">It is still not the &quot;full&quot; boot process.<p>Modern hardware need lots of code to initialize from boot to usable.</div><br/></div></div></div></div></div></div></div></div></div></body></html>