<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689066068329" as="style"/><link rel="stylesheet" href="styles.css?v=1689066068329"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://tomverbeure.github.io/2023/07/09/TM4313-GPSDO-Teardown.html">Teardown of the TM4313 GPS Disciplined Oscillator</a> <span class="domain">(<a href="https://tomverbeure.github.io">tomverbeure.github.io</a>)</span></div><div class="subtext"><span>picture</span> | <span>18 comments</span></div><br/><div><div id="36675863" class="c"><input type="checkbox" id="c-36675863" checked=""/><div class="controls bullet"><span class="by">gsmecher</span><span>|</span><a href="#36675311">next</a><span>|</span><label class="collapse" for="c-36675863">[-]</label><label class="expand" for="c-36675863">[3 more]</label></div><br/><div class="children"><div class="content">On the mystery voltage regulator: most OCXOs also provide a regulated reference output on the pin that&#x27;s marked N&#x2F;C on this device. This reference is important because the tuning voltage is scaled relative to some reference voltage, and a modulation in that reference voltage can be seen as an out-of-phase modulation in the tuning voltage. Hence, bringing a pristine reference out of the oven is the cleanest option. Second best is to place an external regulator close to the oven, as they&#x27;ve done here.<p>...at least that&#x27;s my best guess.</div><br/><div id="36676079" class="c"><input type="checkbox" id="c-36676079" checked=""/><div class="controls bullet"><span class="by">wildzzz</span><span>|</span><a href="#36675863">parent</a><span>|</span><a href="#36676933">next</a><span>|</span><label class="collapse" for="c-36676079">[-]</label><label class="expand" for="c-36676079">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s what I use in the GPSDO in one of my projects. The internal voltage reference powers a 10bit DAC that we dither to tune the OCXO. If the microcontroller has a voltage rail just for it&#x27;s internal DAC, that would be the best way to run it. You could drop the opamp and voltage reference from the design and just keep the RC filter.</div><br/></div></div><div id="36676933" class="c"><input type="checkbox" id="c-36676933" checked=""/><div class="controls bullet"><span class="by">tverbeure</span><span>|</span><a href="#36675863">parent</a><span>|</span><a href="#36676079">prev</a><span>|</span><a href="#36675311">next</a><span>|</span><label class="collapse" for="c-36676933">[-]</label><label class="expand" for="c-36676933">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure: I remember seeing comments in the past about crappy Vref outputs of OCXOs (when compared to external Vrefs) and just today, I saw another such comment though I don&#x27;t remember where either.<p>I&#x27;ve studied quite a bit of GPSDO schematics, but none of them are using the internal Vref. Though that maybe because these designs allow for different OCXOs, some of which don&#x27;t have a Vref output.</div><br/></div></div></div></div><div id="36675311" class="c"><input type="checkbox" id="c-36675311" checked=""/><div class="controls bullet"><span class="by">sacnoradhq</span><span>|</span><a href="#36675863">prev</a><span>|</span><a href="#36676553">next</a><span>|</span><label class="collapse" for="c-36675311">[-]</label><label class="expand" for="c-36675311">[2 more]</label></div><br/><div class="children"><div class="content">Neat.<p>In some industrial GPS receivers, there was a FPGA, a very capable ADC, and a PLL. Logic was split between the analog incoming section and the digital processing section. Maxim components were used frequently as it they had excellent engineering support (sampling esp.) from the vendor. IIRC, there were Flash EEPROMs rated for 10k block writes (only!) but were reliable up to low 100k&#x27;s.<p>PS: Alum of Trimble Nav Ltd radio group.</div><br/><div id="36675466" class="c"><input type="checkbox" id="c-36675466" checked=""/><div class="controls bullet"><span class="by">CamperBob2</span><span>|</span><a href="#36675311">parent</a><span>|</span><a href="#36676553">next</a><span>|</span><label class="collapse" for="c-36675466">[-]</label><label class="expand" for="c-36675466">[1 more]</label></div><br/><div class="children"><div class="content">Thunderbolt?</div><br/></div></div></div></div><div id="36676553" class="c"><input type="checkbox" id="c-36676553" checked=""/><div class="controls bullet"><span class="by">fsh</span><span>|</span><a href="#36675311">prev</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36676553">[-]</label><label class="expand" for="c-36676553">[6 more]</label></div><br/><div class="children"><div class="content">&gt; There is no such phase detector or ADC on this PCB, so it’s a good guess to assume that the TM4313 uses frequency locked loop.<p>They almost certainly implemented a digital PLL in the micro that compares the 10 MHz clock signal to the 1 PPS output of the GNSS module. Using a frequency lock would lead to a residual drift with respect to the GNSS time scale.</div><br/><div id="36676971" class="c"><input type="checkbox" id="c-36676971" checked=""/><div class="controls bullet"><span class="by">tverbeure</span><span>|</span><a href="#36676553">parent</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36676971">[-]</label><label class="expand" for="c-36676971">[5 more]</label></div><br/><div class="children"><div class="content">You&#x27;re absolutely right about the drift, but an FLL is sufficient for cases where you case about the frequency and not about the exact position of the 1PPS output.<p>E.g. when using a GPSDO to drive or calibrate frequency counters, spectrum analyzers, signal generators, and similar kind of equipment.<p>There are many GPSDOs out there that are FLL only.<p>I&#x27;m not sure how you&#x27;d implement a pure digital-only phase detector inside an LPC1752. The precision of measuring the phase would be pretty terrible when the internal clock is only, say, 100MHz?<p>Edit: I should be able to check this by putting the GPS module 1PPS and the GPSDO 1PSS output on the scope.</div><br/><div id="36677220" class="c"><input type="checkbox" id="c-36677220" checked=""/><div class="controls bullet"><span class="by">fsh</span><span>|</span><a href="#36676553">root</a><span>|</span><a href="#36676971">parent</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36677220">[-]</label><label class="expand" for="c-36677220">[4 more]</label></div><br/><div class="children"><div class="content">The micro has general purpose counters:<p>&gt; The LPC1759&#x2F;58&#x2F;56&#x2F;54&#x2F;52&#x2F;51 include four 32-bit timer&#x2F;counters. The timer&#x2F;counter is designed to count cycles of the system derived clock or an externally-supplied clock. It can optionally generate interrupts, generate timed DMA requests, or perform other actions at specified timer values, based on four match registers. Each timer&#x2F;counter also includes
two capture inputs to trap the timer value when an input signal transitions, optionally generating an interrupt.<p>Time-tagging the transitions of the 1PPS signal (and subtracting 100000000 at each transition) directly gives the phase difference measured in clock cycles. At 100 MHz clock frequency, the resolution is 10 ns which is well below the timing jitter of a GNSS 1PPS output. The OXCO can then be steered using a very slow feedback loop (in order not to spoil its short-term stability).</div><br/><div id="36677263" class="c"><input type="checkbox" id="c-36677263" checked=""/><div class="controls bullet"><span class="by">tverbeure</span><span>|</span><a href="#36676553">root</a><span>|</span><a href="#36677220">parent</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36677263">[-]</label><label class="expand" for="c-36677263">[3 more]</label></div><br/><div class="children"><div class="content">Ok.<p>I thought that 10ns was too coarse, when most PLL-based GPSDO get much higher accuracy with 8-bit ADCs. But maybe that just doesn&#x27;t matter enough when the input jitter is very high to begin with.</div><br/><div id="36677436" class="c"><input type="checkbox" id="c-36677436" checked=""/><div class="controls bullet"><span class="by">fsh</span><span>|</span><a href="#36676553">root</a><span>|</span><a href="#36677263">parent</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36677436">[-]</label><label class="expand" for="c-36677436">[2 more]</label></div><br/><div class="children"><div class="content">The short-term stability comes from the quartz oscillator, not from the GNSS. This is nicely visible in the Allan deviation plot of the SRS FS740 GPS reference: <a href="https:&#x2F;&#x2F;www.thinksrs.com&#x2F;images&#x2F;instr&#x2F;fs740&#x2F;FS740_lockedLG.gif" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.thinksrs.com&#x2F;images&#x2F;instr&#x2F;fs740&#x2F;FS740_lockedLG.g...</a><p>Even the simplest TCXO is more stable than the GNSS up to a few ten s. The OCXO has the crossover at a few hundred s, and the Rubidium atomic clock at over one thousand s.<p>At these time scales, the jitter of the 1PPS measurement averages out very well and should not be a serious limitation.</div><br/><div id="36677558" class="c"><input type="checkbox" id="c-36677558" checked=""/><div class="controls bullet"><span class="by">tverbeure</span><span>|</span><a href="#36676553">root</a><span>|</span><a href="#36677436">parent</a><span>|</span><a href="#36677411">next</a><span>|</span><label class="collapse" for="c-36677558">[-]</label><label class="expand" for="c-36677558">[1 more]</label></div><br/><div class="children"><div class="content">Ok! I see a blog post errata coming up in the near future.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="36677411" class="c"><input type="checkbox" id="c-36677411" checked=""/><div class="controls bullet"><span class="by">H8crilA</span><span>|</span><a href="#36676553">prev</a><span>|</span><a href="#36677469">next</a><span>|</span><label class="collapse" for="c-36677411">[-]</label><label class="expand" for="c-36677411">[3 more]</label></div><br/><div class="children"><div class="content">Oh, I am so happy someone posted about this topic here.<p>Does anyone know whether I can use a GPSDO with an SDR to have very accurate timestamps of each I&#x2F;Q sample? I don&#x27;t just want the sampling to run at the correct phase,  and without drift, I want a timestamp. Could be any SDR, but I&#x27;d prefer something reasonably priced (under $1000). Most SDRs will happily take the 10MHz reference clock, but are not be able to ingest or output time.</div><br/><div id="36677652" class="c"><input type="checkbox" id="c-36677652" checked=""/><div class="controls bullet"><span class="by">johschmitz</span><span>|</span><a href="#36677411">parent</a><span>|</span><a href="#36677469">next</a><span>|</span><label class="collapse" for="c-36677652">[-]</label><label class="expand" for="c-36677652">[2 more]</label></div><br/><div class="children"><div class="content">I did this back in the day using a ublox LEA-M8F module for my PhD work following the instructions posted here:
<a href="http:&#x2F;&#x2F;www.opendigitalradio.org&#x2F;lea-m8f-gpsdo" rel="nofollow noreferrer">http:&#x2F;&#x2F;www.opendigitalradio.org&#x2F;lea-m8f-gpsdo</a>
I also experimented with RTK which this module is capable of. 
Now there&#x27;s probably a more up to date ublox module available which could provide even better results using multi frequency GNSS etc.</div><br/><div id="36678172" class="c"><input type="checkbox" id="c-36678172" checked=""/><div class="controls bullet"><span class="by">H8crilA</span><span>|</span><a href="#36677411">root</a><span>|</span><a href="#36677652">parent</a><span>|</span><a href="#36677469">next</a><span>|</span><label class="collapse" for="c-36678172">[-]</label><label class="expand" for="c-36678172">[1 more]</label></div><br/><div class="children"><div class="content">Thanks. Does the USRP B200 know how to timestamp individual samples? Or I guess just one sample, the rest is easy.</div><br/></div></div></div></div></div></div><div id="36677469" class="c"><input type="checkbox" id="c-36677469" checked=""/><div class="controls bullet"><span class="by">formerly_proven</span><span>|</span><a href="#36677411">prev</a><span>|</span><a href="#36676417">next</a><span>|</span><label class="collapse" for="c-36677469">[-]</label><label class="expand" for="c-36677469">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It’s a generally accepted truism that once you’ve acquired your first frequency counter, you slowly get sucked into the Cult of the Time Nuts and their never ending quest for increasingly accurate time measurements.<p>I only narrowly managed to escape this fate after acquiring an HP 5345A, a massive fifty pound brick that was the fastest (and thus accuratestest) reciprocal counter for some time. It&#x27;s a pretty strong black hole for money.</div><br/></div></div><div id="36676417" class="c"><input type="checkbox" id="c-36676417" checked=""/><div class="controls bullet"><span class="by">dmitrygr</span><span>|</span><a href="#36677469">prev</a><span>|</span><label class="collapse" for="c-36676417">[-]</label><label class="expand" for="c-36676417">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I couldn’t find the number of bits of the PWM controller<p>On LPC1752, it is actually up to 32 bits, if you are willing to wait that long for the period to tick over</div><br/><div id="36676998" class="c"><input type="checkbox" id="c-36676998" checked=""/><div class="controls bullet"><span class="by">tverbeure</span><span>|</span><a href="#36676417">parent</a><span>|</span><label class="collapse" for="c-36676998">[-]</label><label class="expand" for="c-36676998">[1 more]</label></div><br/><div class="children"><div class="content">The serial port reports a clock of 100MHz inside the LPC1752. If that&#x27;s connected to the PWM generators, you should be able to get away with 16 without any dithering.</div><br/></div></div></div></div></div></div></div></div></div></body></html>