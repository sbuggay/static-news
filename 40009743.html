<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712912459811" as="style"/><link rel="stylesheet" href="styles.css?v=1712912459811"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.greptime.com/blogs/2024-04-09-rust-protobuf-performance">Fivefold Slower Compared to Go? Optimizing Rust&#x27;s Protobuf Decoding Performance</a> <span class="domain">(<a href="https://www.greptime.com">www.greptime.com</a>)</span></div><div class="subtext"><span>signa11</span> | <span>14 comments</span></div><br/><div><div id="40010585" class="c"><input type="checkbox" id="c-40010585" checked=""/><div class="controls bullet"><span class="by">MrBuddyCasino</span><span>|</span><a href="#40010466">next</a><span>|</span><label class="collapse" for="c-40010585">[-]</label><label class="expand" for="c-40010585">[2 more]</label></div><br/><div class="children"><div class="content">So with some modest performance engineering, Golang is surprisingly fast out of the box, and Rust requires more effort and increasingly less idiomatic code to reach the same result.<p>Is this typical?</div><br/><div id="40010652" class="c"><input type="checkbox" id="c-40010652" checked=""/><div class="controls bullet"><span class="by">wokwokwok</span><span>|</span><a href="#40010585">parent</a><span>|</span><a href="#40010466">next</a><span>|</span><label class="collapse" for="c-40010652">[-]</label><label class="expand" for="c-40010652">[1 more]</label></div><br/><div class="children"><div class="content">While it’s a nice bed time story if you like go, the reality is no, it’s not typical.<p>Go has a good perf story, but typically rust or c+c would be faster.<p>Go also has unexpected optimisation hoops to jump through (specifically around channels, see the well documented answer here: <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;47312029&#x2F;when-should-you-use-a-mutex-over-a-channel" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;47312029&#x2F;when-should-you...</a>).<p>…but, naive implementations are generally slower. In almost all situations (even python or Java) you can get great performance if you invest time and effort in it.<p>But idiomatically, and typically? No.</div><br/></div></div></div></div><div id="40010466" class="c"><input type="checkbox" id="c-40010466" checked=""/><div class="controls bullet"><span class="by">secondcoming</span><span>|</span><a href="#40010585">prev</a><span>|</span><a href="#40010436">next</a><span>|</span><label class="collapse" for="c-40010466">[-]</label><label class="expand" for="c-40010466">[2 more]</label></div><br/><div class="children"><div class="content">&gt; In Go, a string is just a simple wrapper around []byte, and deserializing a string field can be done by simply assigning the original buffer&#x27;s pointer and length to the string field. However, Rust&#x27;s PROST, when deserializing String type fields, needs to copy the data from the original buffer into the String<p>It&#x27;s interesting that the protobuf code generator for Go seems to allow this direct access. For C++, you also need a copy (and potentially a heap allocation) since `string` fields are returned via `const std::string&amp;`. Protobuf support for `std::string_view` has been years in the making.<p>Maybe just switch to FlatBuffers?</div><br/><div id="40010495" class="c"><input type="checkbox" id="c-40010495" checked=""/><div class="controls bullet"><span class="by">v0y4g3r</span><span>|</span><a href="#40010466">parent</a><span>|</span><a href="#40010436">next</a><span>|</span><label class="collapse" for="c-40010495">[-]</label><label class="expand" for="c-40010495">[1 more]</label></div><br/><div class="children"><div class="content">FlatBuffers does the trick as a better replacement to ProtoBuf when running in some resource-critical devices. We were working on a project that leverage Arrow IPC (internally FlatBuffers) and shared memory to collect metrics on edge devices with limit CPU and memory, hopefully we can open source it soon.<p>But in this case the format is defined by [Prometheus](<a href="https:&#x2F;&#x2F;github.com&#x2F;prometheus&#x2F;prometheus&#x2F;blob&#x2F;main&#x2F;prompb&#x2F;remote.proto#L22-L28">https:&#x2F;&#x2F;github.com&#x2F;prometheus&#x2F;prometheus&#x2F;blob&#x2F;main&#x2F;prompb&#x2F;re...</a>) and we just adopt that.</div><br/></div></div></div></div><div id="40010436" class="c"><input type="checkbox" id="c-40010436" checked=""/><div class="controls bullet"><span class="by">netprole</span><span>|</span><a href="#40010466">prev</a><span>|</span><label class="collapse" for="c-40010436">[-]</label><label class="expand" for="c-40010436">[9 more]</label></div><br/><div class="children"><div class="content">In the image at the top of the article, why is the Rust crab altered to have &quot;angry&quot; eyes and holding a knife aimed at the Go gopher? Aside from the joke of &quot;don&#x27;t bring a knife to a protobuf fight&quot; the inference of violence sucks and lessens the spirit of friendly competition and &quot;all in good fun.&quot; I don&#x27;t know if Rust has a code-of-conduct or rules for use of their mascot, but I bet this doesn&#x27;t follow it.</div><br/><div id="40010477" class="c"><input type="checkbox" id="c-40010477" checked=""/><div class="controls bullet"><span class="by">reubenmorais</span><span>|</span><a href="#40010436">parent</a><span>|</span><a href="#40010479">next</a><span>|</span><label class="collapse" for="c-40010477">[-]</label><label class="expand" for="c-40010477">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s the logo of CrabLang: <a href="https:&#x2F;&#x2F;crablang.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;crablang.org&#x2F;</a></div><br/></div></div><div id="40010479" class="c"><input type="checkbox" id="c-40010479" checked=""/><div class="controls bullet"><span class="by">signa11</span><span>|</span><a href="#40010436">parent</a><span>|</span><a href="#40010477">prev</a><span>|</span><a href="#40010496">next</a><span>|</span><label class="collapse" for="c-40010479">[-]</label><label class="expand" for="c-40010479">[6 more]</label></div><br/><div class="children"><div class="content">aren’t you reading a bit too much into it?</div><br/><div id="40010513" class="c"><input type="checkbox" id="c-40010513" checked=""/><div class="controls bullet"><span class="by">netprole</span><span>|</span><a href="#40010436">root</a><span>|</span><a href="#40010479">parent</a><span>|</span><a href="#40010496">next</a><span>|</span><label class="collapse" for="c-40010513">[-]</label><label class="expand" for="c-40010513">[5 more]</label></div><br/><div class="children"><div class="content">Maybe you&#x27;re not thinking about it enough? Do you know anyone who has been almost fatally stabbed (attacked by gangs) with knives? I do! It likely violates a code-of-conduct and is unprofessional.</div><br/><div id="40010529" class="c"><input type="checkbox" id="c-40010529" checked=""/><div class="controls bullet"><span class="by">reacharavindh</span><span>|</span><a href="#40010436">root</a><span>|</span><a href="#40010513">parent</a><span>|</span><a href="#40010496">next</a><span>|</span><label class="collapse" for="c-40010529">[-]</label><label class="expand" for="c-40010529">[4 more]</label></div><br/><div class="children"><div class="content">Isn’t it tiring to think about every possible offence in the world and how someone somewhere will be offended by (knives, tires, cars, pens, saws, sharks, planes, needles, ropes, speakers, games, … you get the point) while writing an article about a programming language?<p>At some point one needs to exercise common sense and learn to live in a public society where people speak and not everyone is out to offend you.</div><br/><div id="40010566" class="c"><input type="checkbox" id="c-40010566" checked=""/><div class="controls bullet"><span class="by">netprole</span><span>|</span><a href="#40010436">root</a><span>|</span><a href="#40010529">parent</a><span>|</span><a href="#40010496">next</a><span>|</span><label class="collapse" for="c-40010566">[-]</label><label class="expand" for="c-40010566">[3 more]</label></div><br/><div class="children"><div class="content">What does a weapon (a knife) have to do with an article about a programming language?</div><br/><div id="40010631" class="c"><input type="checkbox" id="c-40010631" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#40010436">root</a><span>|</span><a href="#40010566">parent</a><span>|</span><a href="#40010624">next</a><span>|</span><label class="collapse" for="c-40010631">[-]</label><label class="expand" for="c-40010631">[1 more]</label></div><br/><div class="children"><div class="content">I have no association with any of these communities, but the crab holding a knife was a somewhat well-known meme[1].<p>I guess it can also be viewed as a play on words, given that crablang is a fork.<p>Given that the creators of crablang explicitly say it was a &quot;lighthearted response&quot;[2] to some of Rust&#x27;s changes, it makes sense that they&#x27;d use a meme for a logo.<p>That said, you&#x27;re not alone in wanting a different logo[3].<p>[1]: <a href="https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;you-mess-with-crabo-you-get-a-stabo" rel="nofollow">https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;you-mess-with-crabo-you-get-a...</a><p>[2]: <a href="https:&#x2F;&#x2F;crablang.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;crablang.org&#x2F;</a><p>[3]: <a href="https:&#x2F;&#x2F;github.com&#x2F;crablang&#x2F;crab&#x2F;issues&#x2F;59">https:&#x2F;&#x2F;github.com&#x2F;crablang&#x2F;crab&#x2F;issues&#x2F;59</a></div><br/></div></div><div id="40010624" class="c"><input type="checkbox" id="c-40010624" checked=""/><div class="controls bullet"><span class="by">reacharavindh</span><span>|</span><a href="#40010436">root</a><span>|</span><a href="#40010566">parent</a><span>|</span><a href="#40010631">prev</a><span>|</span><a href="#40010496">next</a><span>|</span><label class="collapse" for="c-40010624">[-]</label><label class="expand" for="c-40010624">[1 more]</label></div><br/><div class="children"><div class="content">Exactly, then why does it matter that the author had anything in their post as a figure of speech or analogy?<p>Is it wrong to post a meme of a dog sitting near fire - <a href="https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;this-is-fine" rel="nofollow">https:&#x2F;&#x2F;knowyourmeme.com&#x2F;memes&#x2F;this-is-fine</a>
As a joke from SREs who handle firefighting calls? 
Does it offend dog lovers, people who are scared of fire?</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40010496" class="c"><input type="checkbox" id="c-40010496" checked=""/><div class="controls bullet"><span class="by">bool3max</span><span>|</span><a href="#40010436">parent</a><span>|</span><a href="#40010479">prev</a><span>|</span><label class="collapse" for="c-40010496">[-]</label><label class="expand" for="c-40010496">[1 more]</label></div><br/><div class="children"><div class="content">Jesus, grow a pair.</div><br/></div></div></div></div></div></div></div></div></div></body></html>