<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1703581254762" as="style"/><link rel="stylesheet" href="styles.css?v=1703581254762"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://baecher.dev/stdout/reproducible-git-bundles/">Reproducible Git Bundles</a> <span class="domain">(<a href="https://baecher.dev">baecher.dev</a>)</span></div><div class="subtext"><span>pbhn</span> | <span>26 comments</span></div><br/><div><div id="38767277" class="c"><input type="checkbox" id="c-38767277" checked=""/><div class="controls bullet"><span class="by">JoshTriplett</span><span>|</span><a href="#38768866">next</a><span>|</span><label class="collapse" for="c-38767277">[-]</label><label class="expand" for="c-38767277">[1 more]</label></div><br/><div class="children"><div class="content">Parallelism doesn&#x27;t inherently have to break reproducibility. If the output depends on the scheduling order of the threads, then it will. But it&#x27;s possible to use threads to farm out work while still doing the same work deterministically.</div><br/></div></div><div id="38768866" class="c"><input type="checkbox" id="c-38768866" checked=""/><div class="controls bullet"><span class="by">chuckwolber</span><span>|</span><a href="#38767277">prev</a><span>|</span><a href="#38766819">next</a><span>|</span><label class="collapse" for="c-38768866">[-]</label><label class="expand" for="c-38768866">[1 more]</label></div><br/><div class="children"><div class="content">Strictly speaking in terms of system backups, this approach misses the git reflog which is a crucial &quot;get out of jail free&quot; card on the (hopefully) rare occasion that you actually need it.</div><br/></div></div><div id="38766819" class="c"><input type="checkbox" id="c-38766819" checked=""/><div class="controls bullet"><span class="by">raimue</span><span>|</span><a href="#38768866">prev</a><span>|</span><a href="#38766158">next</a><span>|</span><label class="collapse" for="c-38766819">[-]</label><label class="expand" for="c-38766819">[5 more]</label></div><br/><div class="children"><div class="content">The question is whether you can expect this format to stay stable and reproducible across git versions. Remember the fallout from git 2.38 when the output of &#x27;git archive&#x27; changed. Although for this backup use case it would just mean the next backup with a new format would make a full copy once.</div><br/><div id="38767023" class="c"><input type="checkbox" id="c-38767023" checked=""/><div class="controls bullet"><span class="by">jacoblambda</span><span>|</span><a href="#38766819">parent</a><span>|</span><a href="#38767664">next</a><span>|</span><label class="collapse" for="c-38767023">[-]</label><label class="expand" for="c-38767023">[3 more]</label></div><br/><div class="children"><div class="content">git bundles have a standardised format (defined in [1]) while git archives did not and continue to not have one. Git can still handle all previous bundle versions and you can specify which version of the bundle standard you want to use when creating bundles.<p>So no the git 2.38 issue should not be a problem for bundles even if the format changes in the future.<p>1. <a href="https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;gitformat-bundle" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;gitformat-bundle</a></div><br/><div id="38767243" class="c"><input type="checkbox" id="c-38767243" checked=""/><div class="controls bullet"><span class="by">avar</span><span>|</span><a href="#38766819">root</a><span>|</span><a href="#38767023">parent</a><span>|</span><a href="#38767664">next</a><span>|</span><label class="collapse" for="c-38767243">[-]</label><label class="expand" for="c-38767243">[2 more]</label></div><br/><div class="children"><div class="content">Standardized format != guaranteed reproducible. Git makes no promises that it&#x27;ll keep PACK contents stable, just that they&#x27;re guaranteed to &quot;deflate&quot; to the same contents.<p>Which is what the linked article discovered. Threading is a trivial way to discover this, but there&#x27;s other ways PACK contents might differ across versions.</div><br/><div id="38768880" class="c"><input type="checkbox" id="c-38768880" checked=""/><div class="controls bullet"><span class="by">wkennington</span><span>|</span><a href="#38766819">root</a><span>|</span><a href="#38767243">parent</a><span>|</span><a href="#38767664">next</a><span>|</span><label class="collapse" for="c-38768880">[-]</label><label class="expand" for="c-38768880">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, even tar is not stable bit for bit across versions.</div><br/></div></div></div></div></div></div><div id="38767664" class="c"><input type="checkbox" id="c-38767664" checked=""/><div class="controls bullet"><span class="by">kzrdude</span><span>|</span><a href="#38766819">parent</a><span>|</span><a href="#38767023">prev</a><span>|</span><a href="#38766158">next</a><span>|</span><label class="collapse" for="c-38767664">[-]</label><label class="expand" for="c-38767664">[1 more]</label></div><br/><div class="children"><div class="content">Absolute stability is not needed for this use case. Just reproducible per git version would be enough, to ensure mostly no redundant backups.</div><br/></div></div></div></div><div id="38766158" class="c"><input type="checkbox" id="c-38766158" checked=""/><div class="controls bullet"><span class="by">stepupmakeup</span><span>|</span><a href="#38766819">prev</a><span>|</span><a href="#38768387">next</a><span>|</span><label class="collapse" for="c-38766158">[-]</label><label class="expand" for="c-38766158">[5 more]</label></div><br/><div class="children"><div class="content">Why not just use tar or any other archive tool on the repository .git folder? Unless your repository is a un-gc&#x27;d mess with millions of unpacked objects...</div><br/><div id="38766447" class="c"><input type="checkbox" id="c-38766447" checked=""/><div class="controls bullet"><span class="by">pbhn</span><span>|</span><a href="#38766158">parent</a><span>|</span><a href="#38768872">next</a><span>|</span><label class="collapse" for="c-38766447">[-]</label><label class="expand" for="c-38766447">[2 more]</label></div><br/><div class="children"><div class="content">I think that is a fair alternative, but restoring the backup means that the repository is in a bit of a weird state. Whereas a bundle can be cloned from nicely. Your way does have the property that it includes hooks and config, though (which could be desired or not).</div><br/><div id="38768194" class="c"><input type="checkbox" id="c-38768194" checked=""/><div class="controls bullet"><span class="by">Ferret7446</span><span>|</span><a href="#38766158">root</a><span>|</span><a href="#38766447">parent</a><span>|</span><a href="#38768872">next</a><span>|</span><label class="collapse" for="c-38768194">[-]</label><label class="expand" for="c-38768194">[1 more]</label></div><br/><div class="children"><div class="content">There are very few&#x2F;no operations that will put a git repository in a &quot;weird&quot; state.<p>Actually, any snapshot of a Git repository is consistent (due to its CAS nature), minus the index which doesn&#x27;t really need backup anyway.</div><br/></div></div></div></div><div id="38768872" class="c"><input type="checkbox" id="c-38768872" checked=""/><div class="controls bullet"><span class="by">wkennington</span><span>|</span><a href="#38766158">parent</a><span>|</span><a href="#38766447">prev</a><span>|</span><a href="#38766559">next</a><span>|</span><label class="collapse" for="c-38768872">[-]</label><label class="expand" for="c-38768872">[1 more]</label></div><br/><div class="children"><div class="content">This is also non-deterministic between versions of tar, but I guess for this usecase that would be fine. It’s just not good for reproducible build systems when trying to recreate tarballs after years.</div><br/></div></div></div></div><div id="38768387" class="c"><input type="checkbox" id="c-38768387" checked=""/><div class="controls bullet"><span class="by">nektro</span><span>|</span><a href="#38766158">prev</a><span>|</span><a href="#38766250">next</a><span>|</span><label class="collapse" for="c-38768387">[-]</label><label class="expand" for="c-38768387">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The naive solution of simply backing up the entire file-system tree is clearly not desirable since that would clutter the backup with useless build artifacts.<p>`git rm -r --cached .`<p>&gt; One solution is to create a fresh clone (with --mirror), but that will typically consist of many small files which isn&#x27;t ideal for backups, either.<p>this is precisely what tar(1) was made for..</div><br/></div></div><div id="38766250" class="c"><input type="checkbox" id="c-38766250" checked=""/><div class="controls bullet"><span class="by">chmaynard</span><span>|</span><a href="#38768387">prev</a><span>|</span><a href="#38765477">next</a><span>|</span><label class="collapse" for="c-38766250">[-]</label><label class="expand" for="c-38766250">[1 more]</label></div><br/><div class="children"><div class="content">An engaging post and a lovely piece of sleuthing. Thanks!</div><br/></div></div></div></div></div></div></div></body></html>