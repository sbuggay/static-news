<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1686819663727" as="style"/><link rel="stylesheet" href="styles.css?v=1686819663727"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="http://blog.andyglassman.com/2023/06/phoenix-liveview-async-assign-pattern.html">Phoenix LiveView: Async Assign Pattern</a> <span class="domain">(<a href="http://blog.andyglassman.com">blog.andyglassman.com</a>)</span></div><div class="subtext"><span>gnutrino</span> | <span>23 comments</span></div><br/><div><div id="36331646" class="c"><input type="checkbox" id="c-36331646" checked=""/><div class="controls bullet"><span class="by">vinnymac</span><span>|</span><a href="#36330542">next</a><span>|</span><label class="collapse" for="c-36331646">[-]</label><label class="expand" for="c-36331646">[8 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t written Elixir professionally the last couple of years, but I was an early user of LiveView when it was first demoed at a conference.<p>As someone who currently writes applications using React Server Components, I am interested to see how concepts like LiveView evolve over time. We are now shipping significantly more HTML than before, and a lot less Javascript, as more has been moved to the server.<p>Makes me wish LiveView was portable to every other platform I work on, rather than having to convince companies to write more Elixir (although that isn&#x27;t a bad thing).</div><br/><div id="36333026" class="c"><input type="checkbox" id="c-36333026" checked=""/><div class="controls bullet"><span class="by">floodfx</span><span>|</span><a href="#36331646">parent</a><span>|</span><a href="#36334766">next</a><span>|</span><label class="collapse" for="c-36333026">[-]</label><label class="expand" for="c-36333026">[3 more]</label></div><br/><div class="children"><div class="content">There is a port of it to JavaScript&#x2F;Typescript. <a href="https:&#x2F;&#x2F;LiveViewJS.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;LiveViewJS.com</a><p>It uses the same front end javascript from Phoenix and speaks the same protocol.<p>Note: am author</div><br/><div id="36333935" class="c"><input type="checkbox" id="c-36333935" checked=""/><div class="controls bullet"><span class="by">jjdeveloper</span><span>|</span><a href="#36331646">root</a><span>|</span><a href="#36333026">parent</a><span>|</span><a href="#36333477">next</a><span>|</span><label class="collapse" for="c-36333935">[-]</label><label class="expand" for="c-36333935">[1 more]</label></div><br/><div class="children"><div class="content">Does this work with Astro (or Next.js)?</div><br/></div></div></div></div><div id="36334766" class="c"><input type="checkbox" id="c-36334766" checked=""/><div class="controls bullet"><span class="by">brightball</span><span>|</span><a href="#36331646">parent</a><span>|</span><a href="#36333026">prev</a><span>|</span><a href="#36331820">next</a><span>|</span><label class="collapse" for="c-36334766">[-]</label><label class="expand" for="c-36334766">[1 more]</label></div><br/><div class="children"><div class="content">The downside to doing this in other languages is that there is a collection of trade offs to do it well that aren’t easy outside of the BEAM.</div><br/></div></div><div id="36331820" class="c"><input type="checkbox" id="c-36331820" checked=""/><div class="controls bullet"><span class="by">nocsi</span><span>|</span><a href="#36331646">parent</a><span>|</span><a href="#36334766">prev</a><span>|</span><a href="#36334078">next</a><span>|</span><label class="collapse" for="c-36331820">[-]</label><label class="expand" for="c-36331820">[2 more]</label></div><br/><div class="children"><div class="content">There&#x27;s <a href="https:&#x2F;&#x2F;native.live" rel="nofollow noreferrer">https:&#x2F;&#x2F;native.live</a> if you want to deploy it as a native app. You can also embed React Components into LiveView if you wanted. Elixir can be anywhere you want it to be.</div><br/><div id="36332055" class="c"><input type="checkbox" id="c-36332055" checked=""/><div class="controls bullet"><span class="by">gnutrino</span><span>|</span><a href="#36331646">root</a><span>|</span><a href="#36331820">parent</a><span>|</span><a href="#36334078">next</a><span>|</span><label class="collapse" for="c-36332055">[-]</label><label class="expand" for="c-36332055">[1 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t looked into this much, but saw someone do a talk on it at ElixirConf maybe two years ago. I bet it&#x27;s much more robust now.</div><br/></div></div></div></div><div id="36334078" class="c"><input type="checkbox" id="c-36334078" checked=""/><div class="controls bullet"><span class="by">nhumrich</span><span>|</span><a href="#36331646">parent</a><span>|</span><a href="#36331820">prev</a><span>|</span><a href="#36330542">next</a><span>|</span><label class="collapse" for="c-36334078">[-]</label><label class="expand" for="c-36334078">[1 more]</label></div><br/><div class="children"><div class="content">You could look into htmx, which is a more language agnostic way to do it.</div><br/></div></div></div></div><div id="36330542" class="c"><input type="checkbox" id="c-36330542" checked=""/><div class="controls bullet"><span class="by">gnutrino</span><span>|</span><a href="#36331646">prev</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36330542">[-]</label><label class="expand" for="c-36330542">[8 more]</label></div><br/><div class="children"><div class="content">I started using this pattern in my LiveView projects, and finally rolled it into a common module for others to use.  I&#x27;ve found it really helps clean up the mount function, which can get pretty messy as your LiveViews grow over time.<p>My apologies for the terrible elixir syntax highlighting in this post. I keep putting off finding a good way to do this on Blogger.</div><br/><div id="36332761" class="c"><input type="checkbox" id="c-36332761" checked=""/><div class="controls bullet"><span class="by">conradfr</span><span>|</span><a href="#36330542">parent</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36332761">[-]</label><label class="expand" for="c-36332761">[7 more]</label></div><br/><div class="children"><div class="content">Are you sure your import should not be:<p><pre><code>  import Phoenix.Socket, only: [assign: 2, assign: 3]</code></pre></div><br/><div id="36333196" class="c"><input type="checkbox" id="c-36333196" checked=""/><div class="controls bullet"><span class="by">sodapopcan</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36332761">parent</a><span>|</span><a href="#36333185">next</a><span>|</span><label class="collapse" for="c-36333196">[-]</label><label class="expand" for="c-36333196">[2 more]</label></div><br/><div class="children"><div class="content">When using LiveView I always use:<p><pre><code>  import Phoenix.Component, only: [assign: 2, assign: 3]
</code></pre>
<a href="https:&#x2F;&#x2F;hexdocs.pm&#x2F;phoenix_live_view&#x2F;Phoenix.Component.html#assign&#x2F;2" rel="nofollow noreferrer">https:&#x2F;&#x2F;hexdocs.pm&#x2F;phoenix_live_view&#x2F;Phoenix.Component.html#...</a><p>Importing from Socket should work, but you&#x27;re right, the code in the post wouldn&#x27;t work.  They use to be in LiveView but got moved to Component.</div><br/><div id="36335348" class="c"><input type="checkbox" id="c-36335348" checked=""/><div class="controls bullet"><span class="by">gnutrino</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36333196">parent</a><span>|</span><a href="#36333185">next</a><span>|</span><label class="collapse" for="c-36335348">[-]</label><label class="expand" for="c-36335348">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m still on 17.X, so that probably explains the discrepancy here.  I think I tried doing a major version bump a while back and things didn&#x27;t compile so I put it on the backlog and forgot about it.  It may be time to revisit before I get too far behind.</div><br/></div></div></div></div><div id="36333185" class="c"><input type="checkbox" id="c-36333185" checked=""/><div class="controls bullet"><span class="by">gnutrino</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36332761">parent</a><span>|</span><a href="#36333196">prev</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36333185">[-]</label><label class="expand" for="c-36333185">[4 more]</label></div><br/><div class="children"><div class="content">I believe you are correct.  I could probably remove the imports altogether, and just prefix those functions with `Phoenix.LiveView`.</div><br/><div id="36333226" class="c"><input type="checkbox" id="c-36333226" checked=""/><div class="controls bullet"><span class="by">sodapopcan</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36333185">parent</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36333226">[-]</label><label class="expand" for="c-36333226">[3 more]</label></div><br/><div class="children"><div class="content">+1 for removing imports!<p>Not that importing is useless but single-use imports drive me a bit nuts.  Even just using it a few times.  It&#x27;s nice to be able to jump to some code and know exactly where everything is coming from without having to jump around the file.</div><br/><div id="36334996" class="c"><input type="checkbox" id="c-36334996" checked=""/><div class="controls bullet"><span class="by">barkerja</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36333226">parent</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36334996">[-]</label><label class="expand" for="c-36334996">[2 more]</label></div><br/><div class="children"><div class="content">Knowing the origin of the function is a huge benefit, but also imports create compile time dependency. In this case, it&#x27;s not an issue, but when you&#x27;re importing a lot of things across your codebase, it can become an issue.</div><br/><div id="36336603" class="c"><input type="checkbox" id="c-36336603" checked=""/><div class="controls bullet"><span class="by">nivertech</span><span>|</span><a href="#36330542">root</a><span>|</span><a href="#36334996">parent</a><span>|</span><a href="#36334627">next</a><span>|</span><label class="collapse" for="c-36336603">[-]</label><label class="expand" for="c-36336603">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll take compile-time dependency over unchecked run-time dependency (almost) every time!</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="36334627" class="c"><input type="checkbox" id="c-36334627" checked=""/><div class="controls bullet"><span class="by">ramchip</span><span>|</span><a href="#36330542">prev</a><span>|</span><a href="#36331876">next</a><span>|</span><label class="collapse" for="c-36334627">[-]</label><label class="expand" for="c-36334627">[2 more]</label></div><br/><div class="children"><div class="content">Does this work well with tests? For instance, if you click a button in a test, do you need to do something special to ensure the async update has happened before checking assertions on the HTML contents?</div><br/><div id="36335285" class="c"><input type="checkbox" id="c-36335285" checked=""/><div class="controls bullet"><span class="by">msmithstubbs</span><span>|</span><a href="#36334627">parent</a><span>|</span><a href="#36331876">next</a><span>|</span><label class="collapse" for="c-36335285">[-]</label><label class="expand" for="c-36335285">[1 more]</label></div><br/><div class="children"><div class="content">Yes, LiveViewTest (a module included in Phoenix LiveView) supports testing connected mounts.<p>You can write a test that just fetches the disconnected state, and then upgrades it to a connected state (see <a href="https:&#x2F;&#x2F;hexdocs.pm&#x2F;phoenix_live_view&#x2F;Phoenix.LiveViewTest.html#live&#x2F;2" rel="nofollow noreferrer">https:&#x2F;&#x2F;hexdocs.pm&#x2F;phoenix_live_view&#x2F;Phoenix.LiveViewTest.ht...</a>).<p>If you want to test the result of a button click there&#x27;s support for that, too, with things like `render_click`.</div><br/></div></div></div></div><div id="36331876" class="c"><input type="checkbox" id="c-36331876" checked=""/><div class="controls bullet"><span class="by">tommica</span><span>|</span><a href="#36334627">prev</a><span>|</span><a href="#36332109">next</a><span>|</span><label class="collapse" for="c-36331876">[-]</label><label class="expand" for="c-36331876">[2 more]</label></div><br/><div class="children"><div class="content">Looks really useful and neat especially the way it chains so fluently for parallerization</div><br/><div id="36332092" class="c"><input type="checkbox" id="c-36332092" checked=""/><div class="controls bullet"><span class="by">gnutrino</span><span>|</span><a href="#36331876">parent</a><span>|</span><a href="#36332109">next</a><span>|</span><label class="collapse" for="c-36332092">[-]</label><label class="expand" for="c-36332092">[1 more]</label></div><br/><div class="children"><div class="content">As I evolved the pattern over time, I found it really did help clean up a lot of code in `mount`.  Once I got it working for one LiveView, it was really easy to rip out a lot of messy code in the other LiveViews.  I&#x27;m definitely happy with the results!  Thanks for reading.</div><br/></div></div></div></div><div id="36332109" class="c"><input type="checkbox" id="c-36332109" checked=""/><div class="controls bullet"><span class="by">wahnfrieden</span><span>|</span><a href="#36331876">prev</a><span>|</span><a href="#36333064">next</a><span>|</span><label class="collapse" for="c-36332109">[-]</label><label class="expand" for="c-36332109">[1 more]</label></div><br/><div class="children"><div class="content">Anyone doing similar with Swift given it also has server continuations?</div><br/></div></div></div></div></div></div></div></body></html>