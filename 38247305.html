<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1699866063396" as="style"/><link rel="stylesheet" href="styles.css?v=1699866063396"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://twitter.com/Vjeux/status/1722733472522142022">10k Bounty for Rewriting Prettier in Rust</a> <span class="domain">(<a href="https://twitter.com">twitter.com</a>)</span></div><div class="subtext"><span>hardwaregeek</span> | <span>31 comments</span></div><br/><div><div id="38248330" class="c"><input type="checkbox" id="c-38248330" checked=""/><div class="controls bullet"><span class="by">sophiabits</span><span>|</span><a href="#38248119">next</a><span>|</span><label class="collapse" for="c-38248330">[-]</label><label class="expand" for="c-38248330">[1 more]</label></div><br/><div class="children"><div class="content">There’s a project called “dprint” which you can use in the interim if Prettier is a bottleneck :) It’s a Rust-based code formatting platform with a Prettier plugin (among others). It’s a lot faster than running Prettier directly [1]<p>The dprint plugin wraps Prettier under the hood so compatibility is good. The perf wins come from formatting files in parallel and incrementally.<p>[1] <a href="https:&#x2F;&#x2F;david.deno.dev&#x2F;posts&#x2F;faster-prettier-with-dprint&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;david.deno.dev&#x2F;posts&#x2F;faster-prettier-with-dprint&#x2F;</a></div><br/></div></div><div id="38248119" class="c"><input type="checkbox" id="c-38248119" checked=""/><div class="controls bullet"><span class="by">lakpan</span><span>|</span><a href="#38248330">prev</a><span>|</span><a href="#38247710">next</a><span>|</span><label class="collapse" for="c-38248119">[-]</label><label class="expand" for="c-38248119">[3 more]</label></div><br/><div class="children"><div class="content">I don’t really get it. Prettier isn’t something that you need to run that often on the entire repo; you’re probably just running it on save in a handful of milliseconds or on a pre-commit on hopefully less than 10 files.<p>There are plenty other tools that often run on the entire repo, like tests, lint, build, type-checking, etc. focus on those. Bun showed that there’s <i>a lot</i> of space for improvement.</div><br/><div id="38248307" class="c"><input type="checkbox" id="c-38248307" checked=""/><div class="controls bullet"><span class="by">sophiabits</span><span>|</span><a href="#38248119">parent</a><span>|</span><a href="#38248204">next</a><span>|</span><label class="collapse" for="c-38248307">[-]</label><label class="expand" for="c-38248307">[1 more]</label></div><br/><div class="children"><div class="content">Adding on to the other comment about CI setups, when I benchmarked removing eslint-plugin-prettier from my work’s ESLint configuration we saw a 37.5% speedup. On our fairly slow CI agents that ended up being pretty significant (~34s per run).<p>I _wanted_ to drop the plugin and have Prettier automatically run on as a pre-commit hook (as you suggested) but in the end I lost :) We wound up keeping the plugin and eating the slower pipeline time.<p>Of course there’s more overhead than just Prettier in this case—the ESLint plugin itself will be contributing towards the added runtime!—but depending on your codebase and CI machines, Prettier can definitely slow things down quite a bit. CI taking over a minute or two is a big drag on developer productivity imo.<p>Ideal world is that everyone is on board with code formatting as a pre-commit task that only touches modified files so it doesn’t bloat CI unnecessarily, but it’s not always possible :(</div><br/></div></div><div id="38248204" class="c"><input type="checkbox" id="c-38248204" checked=""/><div class="controls bullet"><span class="by">biorach</span><span>|</span><a href="#38248119">parent</a><span>|</span><a href="#38248307">prev</a><span>|</span><a href="#38247710">next</a><span>|</span><label class="collapse" for="c-38248204">[-]</label><label class="expand" for="c-38248204">[1 more]</label></div><br/><div class="children"><div class="content">Many organisations have a CI step that runs a linter or formatter on all the code and fails if the tool makes changes.<p>The idea is to catch cases where contributors failed to run the tool on save.<p>On large code bases this can be time consuming.</div><br/></div></div></div></div><div id="38247710" class="c"><input type="checkbox" id="c-38247710" checked=""/><div class="controls bullet"><span class="by">downvotetruth</span><span>|</span><a href="#38248119">prev</a><span>|</span><a href="#38247707">next</a><span>|</span><label class="collapse" for="c-38247710">[-]</label><label class="expand" for="c-38247710">[1 more]</label></div><br/><div class="children"><div class="content">&quot;I care that people can have a faster version of prettier, not how it&#x27;s implemented.&quot; &amp; &quot;... for any project written in Rust&quot; are contradictory.</div><br/></div></div><div id="38247707" class="c"><input type="checkbox" id="c-38247707" checked=""/><div class="controls bullet"><span class="by">lacker</span><span>|</span><a href="#38247710">prev</a><span>|</span><a href="#38247808">next</a><span>|</span><label class="collapse" for="c-38247707">[-]</label><label class="expand" for="c-38247707">[1 more]</label></div><br/><div class="children"><div class="content">Looks like the bounty is at 20k now with contribution from @rauchg <a href="https:&#x2F;&#x2F;twitter.com&#x2F;rauchg&#x2F;status&#x2F;1723400569392656771" rel="nofollow noreferrer">https:&#x2F;&#x2F;twitter.com&#x2F;rauchg&#x2F;status&#x2F;1723400569392656771</a></div><br/></div></div><div id="38247808" class="c"><input type="checkbox" id="c-38247808" checked=""/><div class="controls bullet"><span class="by">maxloh</span><span>|</span><a href="#38247707">prev</a><span>|</span><a href="#38247816">next</a><span>|</span><label class="collapse" for="c-38247808">[-]</label><label class="expand" for="c-38247808">[2 more]</label></div><br/><div class="children"><div class="content">Prettier runs on a single thread only. Running it on each thread could make it significantly faster [0].<p>[0]: <a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;parallel-prettier">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;parallel-prettier</a></div><br/><div id="38248236" class="c"><input type="checkbox" id="c-38248236" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#38247808">parent</a><span>|</span><a href="#38247816">next</a><span>|</span><label class="collapse" for="c-38248236">[-]</label><label class="expand" for="c-38248236">[1 more]</label></div><br/><div class="children"><div class="content">The performance gain is massive!</div><br/></div></div></div></div><div id="38247816" class="c"><input type="checkbox" id="c-38247816" checked=""/><div class="controls bullet"><span class="by">zImPatrick</span><span>|</span><a href="#38247808">prev</a><span>|</span><a href="#38247980">next</a><span>|</span><label class="collapse" for="c-38247816">[-]</label><label class="expand" for="c-38247816">[12 more]</label></div><br/><div class="children"><div class="content">Why does everything need to be written in rust these days?</div><br/><div id="38247965" class="c"><input type="checkbox" id="c-38247965" checked=""/><div class="controls bullet"><span class="by">eyeris</span><span>|</span><a href="#38247816">parent</a><span>|</span><a href="#38248167">next</a><span>|</span><label class="collapse" for="c-38247965">[-]</label><label class="expand" for="c-38247965">[1 more]</label></div><br/><div class="children"><div class="content">The swc project reimplemented some of the js build toolchain in rust which led to some great speed ups.<p>I’d imagine that this call for rewriting prettier is inspired by swc<p>Not sure if updating prettier will benefit as much as transpilation.<p>[0] <a href="https:&#x2F;&#x2F;swc.rs&#x2F;docs&#x2F;benchmarks" rel="nofollow noreferrer">https:&#x2F;&#x2F;swc.rs&#x2F;docs&#x2F;benchmarks</a></div><br/></div></div><div id="38248167" class="c"><input type="checkbox" id="c-38248167" checked=""/><div class="controls bullet"><span class="by">rafaelmn</span><span>|</span><a href="#38247816">parent</a><span>|</span><a href="#38247965">prev</a><span>|</span><a href="#38247845">next</a><span>|</span><label class="collapse" for="c-38248167">[-]</label><label class="expand" for="c-38248167">[2 more]</label></div><br/><div class="children"><div class="content">TBH this sounds like a great candidate for rewrite - likely millions of hours of runtime&#x2F;hour. Prettier is written on a platform with a history of such rewrites getting 10x perf increases. The only alternative that comes to mind is Go but I&#x27;m not that offended by Rust choice - has pros and cons.</div><br/><div id="38248305" class="c"><input type="checkbox" id="c-38248305" checked=""/><div class="controls bullet"><span class="by">tubthumper8</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38248167">parent</a><span>|</span><a href="#38247845">next</a><span>|</span><label class="collapse" for="c-38248305">[-]</label><label class="expand" for="c-38248305">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not just speed, but also correctness. A quick search in the Prettier repo shows plenty of issues for &quot;undefined is not a function&quot;, &quot;cannot read property X of undefined&#x2F;null&quot;, and other such errors that are avoidable in a language with a good type system.</div><br/></div></div></div></div><div id="38247845" class="c"><input type="checkbox" id="c-38247845" checked=""/><div class="controls bullet"><span class="by">ramon156</span><span>|</span><a href="#38247816">parent</a><span>|</span><a href="#38248167">prev</a><span>|</span><a href="#38247892">next</a><span>|</span><label class="collapse" for="c-38247845">[-]</label><label class="expand" for="c-38247845">[7 more]</label></div><br/><div class="children"><div class="content">As a rust dev I&#x27;m just as perplexed. I&#x27;ve seen preprocessors and stuff like tailwind being rewritten in Rust aswell. Why though (</div><br/><div id="38247889" class="c"><input type="checkbox" id="c-38247889" checked=""/><div class="controls bullet"><span class="by">mtsr</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38247845">parent</a><span>|</span><a href="#38248186">next</a><span>|</span><label class="collapse" for="c-38247889">[-]</label><label class="expand" for="c-38247889">[2 more]</label></div><br/><div class="children"><div class="content">Some dev workflow tools really benefit from being very fast. And parsing and ast building and the like are actually things that rust is quite good for.<p>That doesn’t mean it couldn’t be done in other languages, but it’s a weighing of trade-offs. And of course, groups of people, such as developers on socials, are quite sensitive to popularity.</div><br/><div id="38248113" class="c"><input type="checkbox" id="c-38248113" checked=""/><div class="controls bullet"><span class="by">vsnf</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38247889">parent</a><span>|</span><a href="#38248186">next</a><span>|</span><label class="collapse" for="c-38248113">[-]</label><label class="expand" for="c-38248113">[1 more]</label></div><br/><div class="children"><div class="content">&gt; And parsing and ast building and the like are actually things that rust is quite good for.<p>Having built a compiler and typechecker in Rust, I don&#x27;t know if I&#x27;d say that it was &quot;quite good&quot; for it. Going back, I&#x27;d still do it again, but it wasn&#x27;t exactly a cakewalk. Rust&#x27;s lifetime rules and visceral hatred of referential structs did not make my life easy at all. I definitely took the easy way out with a lot of string copies too.</div><br/></div></div></div></div><div id="38248186" class="c"><input type="checkbox" id="c-38248186" checked=""/><div class="controls bullet"><span class="by">Tade0</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38247845">parent</a><span>|</span><a href="#38247889">prev</a><span>|</span><a href="#38248041">next</a><span>|</span><label class="collapse" for="c-38248186">[-]</label><label class="expand" for="c-38248186">[1 more]</label></div><br/><div class="children"><div class="content">As a (nominally) front-end developer the RIIR movement&#x27;s energy is similar to how the front-end community approaches things.<p>Overall Rust and its community have many traits that make them very approachable to people not expected to know anything about systems programming, namely:<p>-Package manager with a familiar philosophy behind it (and not the sort of hell you have to deal with setting up a C++ development environment).<p>-Outputs WASM without much bureaucracy and advertises it.<p>-Friendly compiler messages. I don&#x27;t recall seeing &quot;perhaps&quot; in a compiler error message before.<p>The people designing Rust put much effort into making the language as approachable as possible and that&#x27;s the net effect.<p>That is not to say this is going to be necessarily successful, but so far the enthusiasm is there.</div><br/></div></div><div id="38248041" class="c"><input type="checkbox" id="c-38248041" checked=""/><div class="controls bullet"><span class="by">fullspectrumdev</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38247845">parent</a><span>|</span><a href="#38248186">prev</a><span>|</span><a href="#38248127">next</a><span>|</span><label class="collapse" for="c-38248041">[-]</label><label class="expand" for="c-38248041">[2 more]</label></div><br/><div class="children"><div class="content">If it speeds up a build&#x2F;CI pipeline it’s a worthwhile investment for a lot of folks</div><br/><div id="38248112" class="c"><input type="checkbox" id="c-38248112" checked=""/><div class="controls bullet"><span class="by">RamblingCTO</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38248041">parent</a><span>|</span><a href="#38248127">next</a><span>|</span><label class="collapse" for="c-38248112">[-]</label><label class="expand" for="c-38248112">[1 more]</label></div><br/><div class="children"><div class="content">You can get a big speedbump with go without introducing the overhead of object lifecycle management.</div><br/></div></div></div></div><div id="38248127" class="c"><input type="checkbox" id="c-38248127" checked=""/><div class="controls bullet"><span class="by">biorach</span><span>|</span><a href="#38247816">root</a><span>|</span><a href="#38247845">parent</a><span>|</span><a href="#38248041">prev</a><span>|</span><a href="#38247892">next</a><span>|</span><label class="collapse" for="c-38248127">[-]</label><label class="expand" for="c-38248127">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  I&#x27;ve seen preprocessors and stuff like tailwind being rewritten in Rust aswell. Why though<p>a) speed.
On large codebases each preprocessor (and there may be many) can take a long time<p>b) Rust has several features which make it quite suitable for writing pasrers and suchlike</div><br/></div></div></div></div><div id="38247892" class="c"><input type="checkbox" id="c-38247892" checked=""/><div class="controls bullet"><span class="by">civilitty</span><span>|</span><a href="#38247816">parent</a><span>|</span><a href="#38247845">prev</a><span>|</span><a href="#38247980">next</a><span>|</span><label class="collapse" for="c-38247892">[-]</label><label class="expand" for="c-38247892">[1 more]</label></div><br/><div class="children"><div class="content">Crab people [1]<p>[1] <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Crab_People" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Crab_People</a></div><br/></div></div></div></div><div id="38247980" class="c"><input type="checkbox" id="c-38247980" checked=""/><div class="controls bullet"><span class="by">pyrolistical</span><span>|</span><a href="#38247816">prev</a><span>|</span><a href="#38247652">next</a><span>|</span><label class="collapse" for="c-38247980">[-]</label><label class="expand" for="c-38247980">[1 more]</label></div><br/><div class="children"><div class="content">It would be problem just as fast if rewritten in any compiled language. Maybe I should rewrite all the rust implementation in zig and see if it’s just as fast</div><br/></div></div><div id="38247652" class="c"><input type="checkbox" id="c-38247652" checked=""/><div class="controls bullet"><span class="by">adiabatty</span><span>|</span><a href="#38247980">prev</a><span>|</span><a href="#38247947">next</a><span>|</span><label class="collapse" for="c-38247652">[-]</label><label class="expand" for="c-38247652">[5 more]</label></div><br/><div class="children"><div class="content">This would probably be a good thing on net, but how would plugins for Rust work?<p>I use &lt;<a href="https:&#x2F;&#x2F;github.com&#x2F;NiklasPor&#x2F;prettier-plugin-go-template">https:&#x2F;&#x2F;github.com&#x2F;NiklasPor&#x2F;prettier-plugin-go-template</a>&gt; a bit and I&#x27;m not sure what one would have to do to make a plugin for a Rust binary.</div><br/><div id="38247764" class="c"><input type="checkbox" id="c-38247764" checked=""/><div class="controls bullet"><span class="by">veidr</span><span>|</span><a href="#38247652">parent</a><span>|</span><a href="#38247947">next</a><span>|</span><label class="collapse" for="c-38247764">[-]</label><label class="expand" for="c-38247764">[4 more]</label></div><br/><div class="children"><div class="content">Well they could work any way the author wanted, but if it were me, I&#x27;d make the plugins WASM.<p>That&#x27;s how my favorite code formatter (dprint) does it.<p>For that matter though, it&#x27;s how I would implement just about any plugin, these days, except those that need to exchange large info rapidly (e.g. an editor plugin that needs to operate on every key press).<p>It&#x27;s dead easy to implement on the app side, and plugin authors can use an increasing number of higher-level languages to build plugins.</div><br/><div id="38247898" class="c"><input type="checkbox" id="c-38247898" checked=""/><div class="controls bullet"><span class="by">mtsr</span><span>|</span><a href="#38247652">root</a><span>|</span><a href="#38247764">parent</a><span>|</span><a href="#38248098">next</a><span>|</span><label class="collapse" for="c-38247898">[-]</label><label class="expand" for="c-38247898">[1 more]</label></div><br/><div class="children"><div class="content">And on top of that it’s also easy to mostly guarantee the plug-in can only access the APIs you give it. Which is quite nice for third party code.</div><br/></div></div><div id="38248098" class="c"><input type="checkbox" id="c-38248098" checked=""/><div class="controls bullet"><span class="by">rob74</span><span>|</span><a href="#38247652">root</a><span>|</span><a href="#38247764">parent</a><span>|</span><a href="#38247898">prev</a><span>|</span><a href="#38247983">next</a><span>|</span><label class="collapse" for="c-38248098">[-]</label><label class="expand" for="c-38248098">[1 more]</label></div><br/><div class="children"><div class="content">...which would have the advantage that plugin authors could also use other languages that compile to WASM.</div><br/></div></div><div id="38247983" class="c"><input type="checkbox" id="c-38247983" checked=""/><div class="controls bullet"><span class="by">CWIZO</span><span>|</span><a href="#38247652">root</a><span>|</span><a href="#38247764">parent</a><span>|</span><a href="#38248098">prev</a><span>|</span><a href="#38247947">next</a><span>|</span><label class="collapse" for="c-38247983">[-]</label><label class="expand" for="c-38247983">[1 more]</label></div><br/><div class="children"><div class="content">Would love to learn more if you have any resources available?</div><br/></div></div></div></div></div></div><div id="38248306" class="c"><input type="checkbox" id="c-38248306" checked=""/><div class="controls bullet"><span class="by">cute_boi</span><span>|</span><a href="#38247947">prev</a><span>|</span><a href="#38247981">next</a><span>|</span><label class="collapse" for="c-38248306">[-]</label><label class="expand" for="c-38248306">[1 more]</label></div><br/><div class="children"><div class="content">It is now 22.5k if it can be compiled upto wasm.</div><br/></div></div><div id="38247981" class="c"><input type="checkbox" id="c-38247981" checked=""/><div class="controls bullet"><span class="by">__alexs</span><span>|</span><a href="#38248306">prev</a><span>|</span><a href="#38247605">next</a><span>|</span><label class="collapse" for="c-38247981">[-]</label><label class="expand" for="c-38247981">[1 more]</label></div><br/><div class="children"><div class="content">Biome already gets pretty close.</div><br/></div></div><div id="38247605" class="c"><input type="checkbox" id="c-38247605" checked=""/><div class="controls bullet"><span class="by">sneed_chucker</span><span>|</span><a href="#38247981">prev</a><span>|</span><label class="collapse" for="c-38247605">[-]</label><label class="expand" for="c-38247605">[1 more]</label></div><br/><div class="children"><div class="content">Sick. Hope someone does it.</div><br/></div></div></div></div></div></div></div></body></html>