<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1725613277131" as="style"/><link rel="stylesheet" href="styles.css?v=1725613277131"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/cloudflare/serverless-registry">Serverless-registry: A Docker registry backed by Workers and R2</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>tosh</span> | <span>54 comments</span></div><br/><div><div id="41459288" class="c"><input type="checkbox" id="c-41459288" checked=""/><div class="controls bullet"><span class="by">jacobwg</span><span>|</span><a href="#41460115">next</a><span>|</span><label class="collapse" for="c-41459288">[-]</label><label class="expand" for="c-41459288">[18 more]</label></div><br/><div class="children"><div class="content">The annoying thing about trying to implement a Docker registry on Workers and R2 is that it&#x27;s <i>so close</i> to having everything you need, but the 500MB request body limit means Workers is unable to accept pushes of layers larger than 500MB. The limit is even lower at 100MB on the Pro plan[0].<p>We are running a registry that does store content on R2[1], and today this is implemented as the unholy chimera of Cloudflare Workers, AWS CloudFront, Lambda@edge, regular Lambda, S3, and R2.<p>Pushes go first to CloudFront+Lambda@edge, content is saved in S3 first, then moved to R2 in background jobs. Once it&#x27;s transited to R2, then pulls are served from R2.<p>I would so love for Workers + R2 to actually be able to accept pushes of large layers, unfortunately I have yet to talk to anyone at Cloudflare who believes it&#x27;s possible. Especially in this era of AI&#x2F;ML models, some container images can have single layers in the 10-100GB range!<p>[0] <a href="https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;workers&#x2F;platform&#x2F;limits&#x2F;#request-limits" rel="nofollow">https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;workers&#x2F;platform&#x2F;limits&#x2F;#r...</a><p>[1] <a href="https:&#x2F;&#x2F;depot.dev&#x2F;docs&#x2F;guides&#x2F;ephemeral-registry">https:&#x2F;&#x2F;depot.dev&#x2F;docs&#x2F;guides&#x2F;ephemeral-registry</a></div><br/><div id="41459528" class="c"><input type="checkbox" id="c-41459528" checked=""/><div class="controls bullet"><span class="by">zimbatm</span><span>|</span><a href="#41459288">parent</a><span>|</span><a href="#41461703">next</a><span>|</span><label class="collapse" for="c-41459528">[-]</label><label class="expand" for="c-41459528">[1 more]</label></div><br/><div class="children"><div class="content">Does the worker need to process the body?<p>Sometimes, the worker can return a signed URL and have the client directly upload to R2.</div><br/></div></div><div id="41461703" class="c"><input type="checkbox" id="c-41461703" checked=""/><div class="controls bullet"><span class="by">ljm</span><span>|</span><a href="#41459288">parent</a><span>|</span><a href="#41459528">prev</a><span>|</span><a href="#41459450">next</a><span>|</span><label class="collapse" for="c-41461703">[-]</label><label class="expand" for="c-41461703">[1 more]</label></div><br/><div class="children"><div class="content">Live by the cloud, die by the cloud, right?<p>It’s trivial to set up a self hosted docker registry on your own storage. I’m running the helm version of it on my own k3s cluster, the cluster itself costing 20€&#x2F;mo.<p>Why would you need all of this fancy vendor lockin when a few low cost ARM boxes can get the job done?</div><br/></div></div><div id="41459450" class="c"><input type="checkbox" id="c-41459450" checked=""/><div class="controls bullet"><span class="by">telgareith</span><span>|</span><a href="#41459288">parent</a><span>|</span><a href="#41461703">prev</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41459450">[-]</label><label class="expand" for="c-41459450">[10 more]</label></div><br/><div class="children"><div class="content">What am I missing such that presigned Urls aren&#x27;t the solution to this issue?</div><br/><div id="41460082" class="c"><input type="checkbox" id="c-41460082" checked=""/><div class="controls bullet"><span class="by">andreasmetsala</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41459450">parent</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41460082">[-]</label><label class="expand" for="c-41460082">[9 more]</label></div><br/><div class="children"><div class="content">R2 is ridiculously cheap compared to S3. The price difference was more than 40x when I last looked at it.</div><br/><div id="41460934" class="c"><input type="checkbox" id="c-41460934" checked=""/><div class="controls bullet"><span class="by">compootr</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41460082">parent</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41460934">[-]</label><label class="expand" for="c-41460934">[8 more]</label></div><br/><div class="children"><div class="content">Rediculously cheap until their sales team shows up and says otherwise!</div><br/><div id="41460981" class="c"><input type="checkbox" id="c-41460981" checked=""/><div class="controls bullet"><span class="by">kobalsky</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41460934">parent</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41460981">[-]</label><label class="expand" for="c-41460981">[7 more]</label></div><br/><div class="children"><div class="content">Mind explaining?</div><br/><div id="41461105" class="c"><input type="checkbox" id="c-41461105" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41460981">parent</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41461105">[-]</label><label class="expand" for="c-41461105">[6 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;robindev.substack.com&#x2F;p&#x2F;cloudflare-took-down-our-website" rel="nofollow">https:&#x2F;&#x2F;robindev.substack.com&#x2F;p&#x2F;cloudflare-took-down-our-web...</a></div><br/><div id="41461912" class="c"><input type="checkbox" id="c-41461912" checked=""/><div class="controls bullet"><span class="by">kirubakaran</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41461105">parent</a><span>|</span><a href="#41462741">next</a><span>|</span><label class="collapse" for="c-41461912">[-]</label><label class="expand" for="c-41461912">[1 more]</label></div><br/><div class="children"><div class="content">Discussion with 473 comments: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40481808">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40481808</a></div><br/></div></div><div id="41462741" class="c"><input type="checkbox" id="c-41462741" checked=""/><div class="controls bullet"><span class="by">Summerbud</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41461105">parent</a><span>|</span><a href="#41461912">prev</a><span>|</span><a href="#41461604">next</a><span>|</span><label class="collapse" for="c-41462741">[-]</label><label class="expand" for="c-41462741">[1 more]</label></div><br/><div class="children"><div class="content">Ouch, that is a bad move even this is happening on a gamble site :((</div><br/></div></div><div id="41461604" class="c"><input type="checkbox" id="c-41461604" checked=""/><div class="controls bullet"><span class="by">alemanek</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41461105">parent</a><span>|</span><a href="#41462741">prev</a><span>|</span><a href="#41461191">next</a><span>|</span><label class="collapse" for="c-41461604">[-]</label><label class="expand" for="c-41461604">[2 more]</label></div><br/><div class="children"><div class="content">Yikes,  looks like CF is off my list of things to use.  Super scummy</div><br/><div id="41463465" class="c"><input type="checkbox" id="c-41463465" checked=""/><div class="controls bullet"><span class="by">stingraycharles</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41461604">parent</a><span>|</span><a href="#41461191">next</a><span>|</span><label class="collapse" for="c-41463465">[-]</label><label class="expand" for="c-41463465">[1 more]</label></div><br/><div class="children"><div class="content">If you read the article, the OOP was running a gambling site so it is fairly reasonable for Cloudflare not to want their IP blocks to be associated with that.<p>It’s a communication failure on CF’s end, but it’s not an ordinary situation.</div><br/></div></div></div></div><div id="41461191" class="c"><input type="checkbox" id="c-41461191" checked=""/><div class="controls bullet"><span class="by">judge2020</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41461105">parent</a><span>|</span><a href="#41461604">prev</a><span>|</span><a href="#41459378">next</a><span>|</span><label class="collapse" for="c-41461191">[-]</label><label class="expand" for="c-41461191">[1 more]</label></div><br/><div class="children"><div class="content">Once again i would like eastdakota to respond to this sales tactic. Surely this can&#x27;t be a double-digit driver for revenue to where he must stay silent on it.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="41459378" class="c"><input type="checkbox" id="c-41459378" checked=""/><div class="controls bullet"><span class="by">amenghra</span><span>|</span><a href="#41459288">parent</a><span>|</span><a href="#41459450">prev</a><span>|</span><a href="#41460287">next</a><span>|</span><label class="collapse" for="c-41459378">[-]</label><label class="expand" for="c-41459378">[2 more]</label></div><br/><div class="children"><div class="content">Can you generate a signed url to upload directly to R2? Or perform the upload in chunks?</div><br/><div id="41459680" class="c"><input type="checkbox" id="c-41459680" checked=""/><div class="controls bullet"><span class="by">jacobwg</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41459378">parent</a><span>|</span><a href="#41460287">next</a><span>|</span><label class="collapse" for="c-41459680">[-]</label><label class="expand" for="c-41459680">[1 more]</label></div><br/><div class="children"><div class="content">Uploading in chunks could definitely solve the issue, and the OCI Distribution Specification does actually have some language about an optional chunked push API[0].<p>Unfortunately very few of the registry clients actually support this, critically containerd does not[1], so this means your regular `docker push` and a whole lot of ecosystem tooling does not work.<p>This also means that the single PUT must be able to support very large pushes as a single request, possibly even larger than what R2 or S3 would allow without using multipart upload. This means you actually need a server to accept the PUT, then do its own chunked upload to object storage or otherwise stage the content before it&#x27;s finally saved in object storage.<p>This rules out presigned URLs for push too, since the PUT request made to the presigned URL can be too large for the backing object storage to accept.<p>There&#x27;s also other processing that ideally happens on push (like hash digest verification of the pushed layer) that mean a server somewhere needs to be involved.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;opencontainers&#x2F;distribution-spec&#x2F;blob&#x2F;main&#x2F;spec.md#pushing-a-blob-in-chunks">https:&#x2F;&#x2F;github.com&#x2F;opencontainers&#x2F;distribution-spec&#x2F;blob&#x2F;mai...</a><p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;containerd&#x2F;containerd&#x2F;blob&#x2F;192679b05917b540cebe6282960ebc6e177870df&#x2F;core&#x2F;remotes&#x2F;docker&#x2F;pusher.go#L275-L277">https:&#x2F;&#x2F;github.com&#x2F;containerd&#x2F;containerd&#x2F;blob&#x2F;192679b05917b5...</a></div><br/></div></div></div></div><div id="41460287" class="c"><input type="checkbox" id="c-41460287" checked=""/><div class="controls bullet"><span class="by">koolba</span><span>|</span><a href="#41459288">parent</a><span>|</span><a href="#41459378">prev</a><span>|</span><a href="#41460115">next</a><span>|</span><label class="collapse" for="c-41460287">[-]</label><label class="expand" for="c-41460287">[3 more]</label></div><br/><div class="children"><div class="content">&gt; We are running a registry that does store content on R2[1], and today this is implemented as the unholy chimera of Cloudflare Workers, AWS CloudFront, Lambda@edge, regular Lambda, S3, and R2.<p>What’s the advantage over just using ECR? Cost of storage? Cost of bandwidth to read? Hosting provider genetic diversity?</div><br/><div id="41460773" class="c"><input type="checkbox" id="c-41460773" checked=""/><div class="controls bullet"><span class="by">Shakahs</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41460287">parent</a><span>|</span><a href="#41460547">next</a><span>|</span><label class="collapse" for="c-41460773">[-]</label><label class="expand" for="c-41460773">[1 more]</label></div><br/><div class="children"><div class="content">ECR is <i>slow</i>. Despite being a static datastore presumably backed by S3 it will only serve container image layers at around 150mbps, when dealing with large (10GB) container images this is a problem. R2 will happily serve the same data at multi-gigabit speed.</div><br/></div></div><div id="41460547" class="c"><input type="checkbox" id="c-41460547" checked=""/><div class="controls bullet"><span class="by">gyre007</span><span>|</span><a href="#41459288">root</a><span>|</span><a href="#41460287">parent</a><span>|</span><a href="#41460773">prev</a><span>|</span><a href="#41460115">next</a><span>|</span><label class="collapse" for="c-41460547">[-]</label><label class="expand" for="c-41460547">[1 more]</label></div><br/><div class="children"><div class="content">Cost of storage and egress cost are wildly more expensive on ECR compared to CF+R2</div><br/></div></div></div></div></div></div><div id="41460115" class="c"><input type="checkbox" id="c-41460115" checked=""/><div class="controls bullet"><span class="by">jzelinskie</span><span>|</span><a href="#41459288">prev</a><span>|</span><a href="#41459357">next</a><span>|</span><label class="collapse" for="c-41460115">[-]</label><label class="expand" for="c-41460115">[4 more]</label></div><br/><div class="children"><div class="content">If you are a CloudFlare employee reading this, you should get involved with the OCI Distribution group that develops the standards for the registry: <a href="https:&#x2F;&#x2F;github.com&#x2F;opencontainers&#x2F;distribution-spec">https:&#x2F;&#x2F;github.com&#x2F;opencontainers&#x2F;distribution-spec</a></div><br/><div id="41460602" class="c"><input type="checkbox" id="c-41460602" checked=""/><div class="controls bullet"><span class="by">gyre007</span><span>|</span><a href="#41460115">parent</a><span>|</span><a href="#41462928">next</a><span>|</span><label class="collapse" for="c-41460602">[-]</label><label class="expand" for="c-41460602">[2 more]</label></div><br/><div class="children"><div class="content">OCI is demonstrably broken as a specification body as demonstrated by the referrers API. Distirbution spec as it is at the moment is just a very poorly written technical doc.</div><br/><div id="41460912" class="c"><input type="checkbox" id="c-41460912" checked=""/><div class="controls bullet"><span class="by">beeboobaa3</span><span>|</span><a href="#41460115">root</a><span>|</span><a href="#41460602">parent</a><span>|</span><a href="#41462928">next</a><span>|</span><label class="collapse" for="c-41460912">[-]</label><label class="expand" for="c-41460912">[1 more]</label></div><br/><div class="children"><div class="content">Can you explain a bit more what you mean?</div><br/></div></div></div></div><div id="41462928" class="c"><input type="checkbox" id="c-41462928" checked=""/><div class="controls bullet"><span class="by">re-thc</span><span>|</span><a href="#41460115">parent</a><span>|</span><a href="#41460602">prev</a><span>|</span><a href="#41459357">next</a><span>|</span><label class="collapse" for="c-41462928">[-]</label><label class="expand" for="c-41462928">[1 more]</label></div><br/><div class="children"><div class="content">&gt; you should get involved with the OCI Distribution group<p>This is likely just a sample to showcase workers. Not sure it&#x27;s enough reason for CloudFlare to get involved?</div><br/></div></div></div></div><div id="41459357" class="c"><input type="checkbox" id="c-41459357" checked=""/><div class="controls bullet"><span class="by">champtar</span><span>|</span><a href="#41460115">prev</a><span>|</span><a href="#41459108">next</a><span>|</span><label class="collapse" for="c-41459357">[-]</label><label class="expand" for="c-41459357">[3 more]</label></div><br/><div class="children"><div class="content">I would love if the container pull protocol stopped using custom headers or content-type, so we could use any dumb http server.</div><br/><div id="41460950" class="c"><input type="checkbox" id="c-41460950" checked=""/><div class="controls bullet"><span class="by">mayli</span><span>|</span><a href="#41459357">parent</a><span>|</span><a href="#41459108">next</a><span>|</span><label class="collapse" for="c-41460950">[-]</label><label class="expand" for="c-41460950">[2 more]</label></div><br/><div class="children"><div class="content">this? <a href="https:&#x2F;&#x2F;github.com&#x2F;NicolasT&#x2F;static-container-registry">https:&#x2F;&#x2F;github.com&#x2F;NicolasT&#x2F;static-container-registry</a>
and this? <a href="https:&#x2F;&#x2F;github.com&#x2F;jpetazzo&#x2F;registrish">https:&#x2F;&#x2F;github.com&#x2F;jpetazzo&#x2F;registrish</a></div><br/><div id="41461415" class="c"><input type="checkbox" id="c-41461415" checked=""/><div class="controls bullet"><span class="by">champtar</span><span>|</span><a href="#41459357">root</a><span>|</span><a href="#41460950">parent</a><span>|</span><a href="#41459108">next</a><span>|</span><label class="collapse" for="c-41461415">[-]</label><label class="expand" for="c-41461415">[1 more]</label></div><br/><div class="children"><div class="content">Both exemples generate custom nginx config</div><br/></div></div></div></div></div></div><div id="41459108" class="c"><input type="checkbox" id="c-41459108" checked=""/><div class="controls bullet"><span class="by">thangngoc89</span><span>|</span><a href="#41459357">prev</a><span>|</span><a href="#41458741">next</a><span>|</span><label class="collapse" for="c-41459108">[-]</label><label class="expand" for="c-41459108">[5 more]</label></div><br/><div class="children"><div class="content">I think this is wonderful. I’m running a Gitea instance in one of our dev machine just for private registry. Keeping the instance only had been extra workflow for us.<p>But 500MB limit of layer size is a dealbreaker for AI related workflow.</div><br/><div id="41459210" class="c"><input type="checkbox" id="c-41459210" checked=""/><div class="controls bullet"><span class="by">geek_at</span><span>|</span><a href="#41459108">parent</a><span>|</span><a href="#41458741">next</a><span>|</span><label class="collapse" for="c-41459210">[-]</label><label class="expand" for="c-41459210">[4 more]</label></div><br/><div class="children"><div class="content">gitea does also bring their own registry though. If you self-host you can also use LFS for unlimited filesizes</div><br/><div id="41459861" class="c"><input type="checkbox" id="c-41459861" checked=""/><div class="controls bullet"><span class="by">thangngoc89</span><span>|</span><a href="#41459108">root</a><span>|</span><a href="#41459210">parent</a><span>|</span><a href="#41458741">next</a><span>|</span><label class="collapse" for="c-41459861">[-]</label><label class="expand" for="c-41459861">[3 more]</label></div><br/><div class="children"><div class="content">I’m self-hosting gitea just for their private docker registry. LFS is actually slow for heavy deep learning workflow with millions of small files. I’m using DVC [1] instead.<p>[1]: <a href="https:&#x2F;&#x2F;dvc.org" rel="nofollow">https:&#x2F;&#x2F;dvc.org</a></div><br/><div id="41460352" class="c"><input type="checkbox" id="c-41460352" checked=""/><div class="controls bullet"><span class="by">arjvik</span><span>|</span><a href="#41459108">root</a><span>|</span><a href="#41459861">parent</a><span>|</span><a href="#41458741">next</a><span>|</span><label class="collapse" for="c-41460352">[-]</label><label class="expand" for="c-41460352">[2 more]</label></div><br/><div class="children"><div class="content">Absolutely love DVC for data version control! What storage backend are you using with DVC?</div><br/><div id="41460702" class="c"><input type="checkbox" id="c-41460702" checked=""/><div class="controls bullet"><span class="by">thangngoc89</span><span>|</span><a href="#41459108">root</a><span>|</span><a href="#41460352">parent</a><span>|</span><a href="#41458741">next</a><span>|</span><label class="collapse" for="c-41460702">[-]</label><label class="expand" for="c-41460702">[1 more]</label></div><br/><div class="children"><div class="content">Local (mounted NFS) from our internal NAS</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41458741" class="c"><input type="checkbox" id="c-41458741" checked=""/><div class="controls bullet"><span class="by">Fire-Dragon-DoL</span><span>|</span><a href="#41459108">prev</a><span>|</span><a href="#41461955">next</a><span>|</span><label class="collapse" for="c-41458741">[-]</label><label class="expand" for="c-41458741">[3 more]</label></div><br/><div class="children"><div class="content">How&#x27;s the pricing with low usage? I suspect this is great. I wanted an image registry so that I can use it to deploy with Kamal, but the $5 plan is overpriced, given I push an image maybe once every 3 months. This could solve that</div><br/><div id="41458839" class="c"><input type="checkbox" id="c-41458839" checked=""/><div class="controls bullet"><span class="by">bayesianbot</span><span>|</span><a href="#41458741">parent</a><span>|</span><a href="#41461955">next</a><span>|</span><label class="collapse" for="c-41458839">[-]</label><label class="expand" for="c-41458839">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t use much of CloudFlare services but it seems kinda cheap, $0.015&#x2F;GBmonth for storage (+10GB free), Workers are charged per request and CPU time, both of which would probably be quite low for a registry so free plan would go quite far?<p>I just set up the official registry on a VPS (for similar usage pattern) and it was a bit of work and probably much more expensive, this seems quite attractive unless I&#x27;ve misunderstood something.</div><br/><div id="41459248" class="c"><input type="checkbox" id="c-41459248" checked=""/><div class="controls bullet"><span class="by">Fire-Dragon-DoL</span><span>|</span><a href="#41458741">root</a><span>|</span><a href="#41458839">parent</a><span>|</span><a href="#41461955">next</a><span>|</span><label class="collapse" for="c-41459248">[-]</label><label class="expand" for="c-41459248">[1 more]</label></div><br/><div class="children"><div class="content">Yeah it does sound great.
The alternative for me is to host my own docker registry on my home server. That would cost me 0 essentially (I have good internet at home)</div><br/></div></div></div></div></div></div><div id="41461955" class="c"><input type="checkbox" id="c-41461955" checked=""/><div class="controls bullet"><span class="by">ImJasonH</span><span>|</span><a href="#41458741">prev</a><span>|</span><a href="#41459291">next</a><span>|</span><label class="collapse" for="c-41461955">[-]</label><label class="expand" for="c-41461955">[1 more]</label></div><br/><div class="children"><div class="content">I built a similar PoC using Workers+R2, before Cloudflare released theirs, in case you find it useful: <a href="https:&#x2F;&#x2F;github.com&#x2F;chainguard-dev&#x2F;crow-registry">https:&#x2F;&#x2F;github.com&#x2F;chainguard-dev&#x2F;crow-registry</a><p>We eventually built our own registry in Go running on Cloud Run, which now serves all our images on cgr.dev.<p>Zero egress fees is really a game changer.</div><br/></div></div><div id="41459291" class="c"><input type="checkbox" id="c-41459291" checked=""/><div class="controls bullet"><span class="by">mikeocool</span><span>|</span><a href="#41461955">prev</a><span>|</span><a href="#41460914">next</a><span>|</span><label class="collapse" for="c-41459291">[-]</label><label class="expand" for="c-41459291">[2 more]</label></div><br/><div class="children"><div class="content">Have any container running tools just implemented basic S3 compatibility for pushing&#x2F;pulling images?  If your registry doesnt accept pushes from untrusted sources, it doesn&#x27;t seem like there is a ton of value in having &quot;smarts&quot; in the registry server itself.<p>When you push, the client could just PUT a metadata file and an object for each layer in the object store, and pulling would just read the metadata file, which would tell it where to get each layer.  And could use etags to skip downloaded layers that have already been downloaded.<p>For auth just use the standard S3 auth.<p>Would be compatible with S3&#x2F;r2&#x2F;any other S3-compatible storage.</div><br/><div id="41463719" class="c"><input type="checkbox" id="c-41463719" checked=""/><div class="controls bullet"><span class="by">tfolbrecht</span><span>|</span><a href="#41459291">parent</a><span>|</span><a href="#41460914">next</a><span>|</span><label class="collapse" for="c-41463719">[-]</label><label class="expand" for="c-41463719">[1 more]</label></div><br/><div class="children"><div class="content">The docker registry container supports S3 as a storage backend you could use it locally<p>You can also `docker image save` then write the tarball to S3, then load to use.</div><br/></div></div></div></div><div id="41460914" class="c"><input type="checkbox" id="c-41460914" checked=""/><div class="controls bullet"><span class="by">qudat</span><span>|</span><a href="#41459291">prev</a><span>|</span><a href="#41463243">next</a><span>|</span><label class="collapse" for="c-41460914">[-]</label><label class="expand" for="c-41460914">[1 more]</label></div><br/><div class="children"><div class="content">This is pretty nice.  Does it support an API for deleting images (and having it properly garbage-collected)?  It looks like maybe this does it? <a href="https:&#x2F;&#x2F;github.com&#x2F;cloudflare&#x2F;serverless-registry&#x2F;blob&#x2F;13c4e88737bdadbb4cb65d82934428cfdd67837d&#x2F;src&#x2F;router.ts#L51">https:&#x2F;&#x2F;github.com&#x2F;cloudflare&#x2F;serverless-registry&#x2F;blob&#x2F;13c4e...</a><p>We have a managed docker registry and could have definitely used this project!<p>Slightly unrelated, but we&#x27;ve been experimenting with using SSH for authenticating with a docker registry if anyone is interested: <a href="https:&#x2F;&#x2F;github.com&#x2F;picosh&#x2F;tunkit?tab=readme-ov-file#why">https:&#x2F;&#x2F;github.com&#x2F;picosh&#x2F;tunkit?tab=readme-ov-file#why</a></div><br/></div></div><div id="41463243" class="c"><input type="checkbox" id="c-41463243" checked=""/><div class="controls bullet"><span class="by">ram_rattle</span><span>|</span><a href="#41460914">prev</a><span>|</span><a href="#41459508">next</a><span>|</span><label class="collapse" for="c-41463243">[-]</label><label class="expand" for="c-41463243">[1 more]</label></div><br/><div class="children"><div class="content">Looks like a neat idea, does anyone know any open source version that does just this?</div><br/></div></div><div id="41459508" class="c"><input type="checkbox" id="c-41459508" checked=""/><div class="controls bullet"><span class="by">yecuken</span><span>|</span><a href="#41463243">prev</a><span>|</span><a href="#41460811">next</a><span>|</span><label class="collapse" for="c-41459508">[-]</label><label class="expand" for="c-41459508">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m using this registry with regctl[0] to chunk uploads (to circumvent 100MB limit), works just fine for huge layers with models.
With regctl you will also get &#x27;mount&#x27; query parameter for upload initialization with the proper blob name so you can skip additional R2 copy when multi-part upload finalisation which speeds up the upload (and avoids crashes on larger blobs).
This is not part of docker registry API, so I never got to PR that.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;regclient&#x2F;regclient">https:&#x2F;&#x2F;github.com&#x2F;regclient&#x2F;regclient</a></div><br/></div></div><div id="41460811" class="c"><input type="checkbox" id="c-41460811" checked=""/><div class="controls bullet"><span class="by">airocker</span><span>|</span><a href="#41459508">prev</a><span>|</span><a href="#41459516">next</a><span>|</span><label class="collapse" for="c-41460811">[-]</label><label class="expand" for="c-41460811">[1 more]</label></div><br/><div class="children"><div class="content">Is there a registry that would work on extremely cheap disk storage if the use case if only push and very infrequent pulls?</div><br/></div></div><div id="41459516" class="c"><input type="checkbox" id="c-41459516" checked=""/><div class="controls bullet"><span class="by">miohtama</span><span>|</span><a href="#41460811">prev</a><span>|</span><a href="#41459408">next</a><span>|</span><label class="collapse" for="c-41459516">[-]</label><label class="expand" for="c-41459516">[2 more]</label></div><br/><div class="children"><div class="content">When you switch to private Docker or Github registry to Cloudflare, are you effectively just trading one vendor lock in to another, or is there more into this?</div><br/><div id="41459731" class="c"><input type="checkbox" id="c-41459731" checked=""/><div class="controls bullet"><span class="by">vineyardmike</span><span>|</span><a href="#41459516">parent</a><span>|</span><a href="#41459408">next</a><span>|</span><label class="collapse" for="c-41459731">[-]</label><label class="expand" for="c-41459731">[1 more]</label></div><br/><div class="children"><div class="content">None of these are really vendor lock in. The registry protocol is an open standard, this is just one more source that implements it. So you’re only locked in as far as your data is stored <i>somewhere</i>, but that data is behind an open API, so minimal risk there.</div><br/></div></div></div></div><div id="41459408" class="c"><input type="checkbox" id="c-41459408" checked=""/><div class="controls bullet"><span class="by">RyeCombinator</span><span>|</span><a href="#41459516">prev</a><span>|</span><a href="#41459213">next</a><span>|</span><label class="collapse" for="c-41459408">[-]</label><label class="expand" for="c-41459408">[3 more]</label></div><br/><div class="children"><div class="content">Great feat.<p>However I am ever more confused now on what Cloudflare does and builds. They have everything from CDN, DNS to Orange Meets and this now?</div><br/><div id="41460311" class="c"><input type="checkbox" id="c-41460311" checked=""/><div class="controls bullet"><span class="by">yazaddaruvala</span><span>|</span><a href="#41459408">parent</a><span>|</span><a href="#41459426">next</a><span>|</span><label class="collapse" for="c-41460311">[-]</label><label class="expand" for="c-41460311">[1 more]</label></div><br/><div class="children"><div class="content">My understanding is Cloudflare is a competitor of AWS, Azure, and GCP.</div><br/></div></div><div id="41459426" class="c"><input type="checkbox" id="c-41459426" checked=""/><div class="controls bullet"><span class="by">rozenmd</span><span>|</span><a href="#41459408">parent</a><span>|</span><a href="#41460311">prev</a><span>|</span><a href="#41459213">next</a><span>|</span><label class="collapse" for="c-41459426">[-]</label><label class="expand" for="c-41459426">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a developer platform: <a href="https:&#x2F;&#x2F;workers.cloudflare.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;workers.cloudflare.com&#x2F;</a></div><br/></div></div></div></div><div id="41459213" class="c"><input type="checkbox" id="c-41459213" checked=""/><div class="controls bullet"><span class="by">victorbjorklund</span><span>|</span><a href="#41459408">prev</a><span>|</span><a href="#41460078">next</a><span>|</span><label class="collapse" for="c-41459213">[-]</label><label class="expand" for="c-41459213">[1 more]</label></div><br/><div class="children"><div class="content">Nice. I been seriously thinking about building exactly this (but Im glad someone smarter made it already)</div><br/></div></div><div id="41460078" class="c"><input type="checkbox" id="c-41460078" checked=""/><div class="controls bullet"><span class="by">spikey_sanju</span><span>|</span><a href="#41459213">prev</a><span>|</span><a href="#41460673">next</a><span>|</span><label class="collapse" for="c-41460078">[-]</label><label class="expand" for="c-41460078">[1 more]</label></div><br/><div class="children"><div class="content">Interesting. Just wish it handled larger image layers a bit better!</div><br/></div></div><div id="41460673" class="c"><input type="checkbox" id="c-41460673" checked=""/><div class="controls bullet"><span class="by">fswd</span><span>|</span><a href="#41460078">prev</a><span>|</span><a href="#41461122">next</a><span>|</span><label class="collapse" for="c-41460673">[-]</label><label class="expand" for="c-41460673">[3 more]</label></div><br/><div class="children"><div class="content">using this same architecture, it would be cool to build a serverless-git</div><br/><div id="41461089" class="c"><input type="checkbox" id="c-41461089" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41460673">parent</a><span>|</span><a href="#41461188">next</a><span>|</span><label class="collapse" for="c-41461089">[-]</label><label class="expand" for="c-41461089">[1 more]</label></div><br/><div class="children"><div class="content">I would have thought for sure someone would have already tried that, but regrettably trying to search for &quot;serverless git&quot; coughs up innumerable references to the <i>framework</i> that is hosted on <i>GIThub</i><p>Anyway, I was curious how much work such a stunt would be and based on the git-http-backend docs &lt;<a href="https:&#x2F;&#x2F;git.github.io&#x2F;git-scm.com&#x2F;docs&#x2F;git-http-backend#Documentation&#x2F;git-http-backend.txt-AcceleratedstaticApache2x" rel="nofollow">https:&#x2F;&#x2F;git.github.io&#x2F;git-scm.com&#x2F;docs&#x2F;git-http-backend#Docu...</a>&gt; it seems like there are actually a manageable number of endpoints<p>I actually prefer their second scenario of splitting out access to the objects and pack files but since doing that would still require a function (or, ahem, a web server running) I suspect that optimization is not within the scope of what you had in mind</div><br/></div></div><div id="41461188" class="c"><input type="checkbox" id="c-41461188" checked=""/><div class="controls bullet"><span class="by">jedberg</span><span>|</span><a href="#41460673">parent</a><span>|</span><a href="#41461089">prev</a><span>|</span><a href="#41461122">next</a><span>|</span><label class="collapse" for="c-41461188">[-]</label><label class="expand" for="c-41461188">[1 more]</label></div><br/><div class="children"><div class="content">Isn’t GitHub already serverless git?</div><br/></div></div></div></div><div id="41461122" class="c"><input type="checkbox" id="c-41461122" checked=""/><div class="controls bullet"><span class="by">bravetraveler</span><span>|</span><a href="#41460673">prev</a><span>|</span><a href="#41459060">next</a><span>|</span><label class="collapse" for="c-41461122">[-]</label><label class="expand" for="c-41461122">[1 more]</label></div><br/><div class="children"><div class="content">Interesting approach when running one of these on your &#x27;LAN&#x27; is relatively easy<p>Though, to be fair, the pull-through mechanism in the reference registry been kind of goofy for years. Ask me how I know &#x2F;s</div><br/></div></div><div id="41459060" class="c"><input type="checkbox" id="c-41459060" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#41461122">prev</a><span>|</span><label class="collapse" for="c-41459060">[-]</label><label class="expand" for="c-41459060">[2 more]</label></div><br/><div class="children"><div class="content">&gt; regitry</div><br/><div id="41463932" class="c"><input type="checkbox" id="c-41463932" checked=""/><div class="controls bullet"><span class="by">stpedgwdgfhgdd</span><span>|</span><a href="#41459060">parent</a><span>|</span><label class="collapse" for="c-41463932">[-]</label><label class="expand" for="c-41463932">[1 more]</label></div><br/><div class="children"><div class="content">It is unfortunate that the cloudflare dev eco system is tight into the javascript world (e.g. npm). Wasm is not there yet to be a full replacement.</div><br/></div></div></div></div></div></div></div></div></div></body></html>