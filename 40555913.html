<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1717405251202" as="style"/><link rel="stylesheet" href="styles.css?v=1717405251202"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.downtowndougbrown.com/2024/06/upgrading-my-chumby-8-kernel-part-10-rtc/">Upgrading my Chumby 8 kernel part 10: RTC</a> <span class="domain">(<a href="https://www.downtowndougbrown.com">www.downtowndougbrown.com</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>17 comments</span></div><br/><div><div id="40556576" class="c"><input type="checkbox" id="c-40556576" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#40560209">next</a><span>|</span><label class="collapse" for="c-40556576">[-]</label><label class="expand" for="c-40556576">[5 more]</label></div><br/><div class="children"><div class="content">&gt; If you can solve a problem in userspace, why bother force-fitting it into the kernel? Chumby probably could have figured out a way to make the STM32 show up as an actual &#x2F;dev&#x2F;rtc0 device…but what would the advantage have been over the scripts they wrote? None.<p>For something like the Chumby, where userland is basically fixed and doesn&#x27;t have a half dozen distros building on top of it, I agree. But if this were commodity hardware that Debian, Ubuntu, Arch, Mint, etc wanted to pull in support for, the extra time spent making &#x2F;dev&#x2F;rtc0 would mean the distros don&#x27;t have to implement their own non-standard implementation of setting the clock.</div><br/><div id="40557003" class="c"><input type="checkbox" id="c-40557003" checked=""/><div class="controls bullet"><span class="by">dougg3</span><span>|</span><a href="#40556576">parent</a><span>|</span><a href="#40557133">next</a><span>|</span><label class="collapse" for="c-40557003">[-]</label><label class="expand" for="c-40557003">[1 more]</label></div><br/><div class="children"><div class="content">Author here. That&#x27;s very much a fair point. I was thinking more from the perspective of firmware developers maintaining fixed userlands when I wrote that.<p>It would definitely be an interesting challenge to figure out how to multiplex the UART between being a normal UART and accesses from an RTC driver in order to allow it to be a real RTC!</div><br/></div></div><div id="40557133" class="c"><input type="checkbox" id="c-40557133" checked=""/><div class="controls bullet"><span class="by">kelnos</span><span>|</span><a href="#40556576">parent</a><span>|</span><a href="#40557003">prev</a><span>|</span><a href="#40557466">next</a><span>|</span><label class="collapse" for="c-40557133">[-]</label><label class="expand" for="c-40557133">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I was thinking this too.  The benefit of making the STM32 look like a real RTC to the kernel would mean that userspace would Just Work when it came to saving and restoring the time.  The kernel would restore it on boot using its normal mechanism, and the &#x27;hwclock&#x27; command would actually work properly, like someone unfamiliar with this particular quirk of the hardware would expect.<p>Likely this was a bit easier and faster to implement from the perspective of the Chumby folks who were building the system.  But I&#x27;ve seen enough weird non-standard things done on embedded Linux systems (and have unfortunately been involved in maintaining one or two of them) to believe that this sort of crap is annoying, and wish developers at the manufacturer would do things in ways that the platform expects.</div><br/></div></div><div id="40557466" class="c"><input type="checkbox" id="c-40557466" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#40556576">parent</a><span>|</span><a href="#40557133">prev</a><span>|</span><a href="#40560209">next</a><span>|</span><label class="collapse" for="c-40557466">[-]</label><label class="expand" for="c-40557466">[2 more]</label></div><br/><div class="children"><div class="content">Even still, I&#x27;d love to see more low bandwidth devices use CUSE to expose standard device file interfaces.</div><br/><div id="40557560" class="c"><input type="checkbox" id="c-40557560" checked=""/><div class="controls bullet"><span class="by">dougg3</span><span>|</span><a href="#40556576">root</a><span>|</span><a href="#40557466">parent</a><span>|</span><a href="#40560209">next</a><span>|</span><label class="collapse" for="c-40557560">[-]</label><label class="expand" for="c-40557560">[1 more]</label></div><br/><div class="children"><div class="content">Interesting, thanks for mentioning CUSE. If I’m understanding it correctly, it seems like it would be a perfect solution for this. Allows leaving the logic in userspace which is much easier to deal with (filesystem access, sharing the UART) but would still show up as an RTC device. I may need to play further with this!</div><br/></div></div></div></div></div></div><div id="40560209" class="c"><input type="checkbox" id="c-40560209" checked=""/><div class="controls bullet"><span class="by">bunnie</span><span>|</span><a href="#40556576">prev</a><span>|</span><a href="#40556632">next</a><span>|</span><label class="collapse" for="c-40560209">[-]</label><label class="expand" for="c-40560209">[1 more]</label></div><br/><div class="children"><div class="content">Amazing work, thanks for sharing it! It warms my heart to see someone still hacking on the device after...13 years. It was a crazy idea to open source it back then, but seeing it pop up in the wild long after the company went away is some validation towards the idea that an empowered community has tenacious staying power.<p>We couldn&#x27;t figure out how to monetize it, but that&#x27;s alright with me; not all returns on investment are measurable in dollars.</div><br/></div></div><div id="40556632" class="c"><input type="checkbox" id="c-40556632" checked=""/><div class="controls bullet"><span class="by">traspler</span><span>|</span><a href="#40560209">prev</a><span>|</span><a href="#40557328">next</a><span>|</span><label class="collapse" for="c-40556632">[-]</label><label class="expand" for="c-40556632">[5 more]</label></div><br/><div class="children"><div class="content">I got one of the soft, ball-like chumbys when they came out. Really, really amazing design and packaging :) I tried to love it as much as it radiated good vibes but sadly from the very beginning it was kind of janky and at the time the usefulness was not that clear to me. Too bad the cheerfulness of such hardware got lost along the way.</div><br/><div id="40556985" class="c"><input type="checkbox" id="c-40556985" checked=""/><div class="controls bullet"><span class="by">sircastor</span><span>|</span><a href="#40556632">parent</a><span>|</span><a href="#40556865">next</a><span>|</span><label class="collapse" for="c-40556985">[-]</label><label class="expand" for="c-40556985">[3 more]</label></div><br/><div class="children"><div class="content">I think the Chumby came out just a little too late. Great idea, but like so many things the post-iPhone-smartphone began to fill all the roles that those things filled<p>I was thinking about the brief life of the dedicated flash video cameras. They were more capable than phones of the era, but they couldn’t share on their own.</div><br/><div id="40557090" class="c"><input type="checkbox" id="c-40557090" checked=""/><div class="controls bullet"><span class="by">duskwuff</span><span>|</span><a href="#40556632">root</a><span>|</span><a href="#40556985">parent</a><span>|</span><a href="#40557381">next</a><span>|</span><label class="collapse" for="c-40557090">[-]</label><label class="expand" for="c-40557090">[1 more]</label></div><br/><div class="children"><div class="content">The Chumby also came out early enough that it had to rely on Flash Lite [1] for authoring content. This severely limited the audience that could build content for it; if it had came out a bit later, with better hardware, it could have potentially been used to display HTML content, and things might have gone differently.<p>[1]: <a href="https:&#x2F;&#x2F;www.adobe.com&#x2F;mena_en&#x2F;products&#x2F;flashlite&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.adobe.com&#x2F;mena_en&#x2F;products&#x2F;flashlite&#x2F;</a></div><br/></div></div><div id="40557381" class="c"><input type="checkbox" id="c-40557381" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#40556632">root</a><span>|</span><a href="#40556985">parent</a><span>|</span><a href="#40557090">prev</a><span>|</span><a href="#40556865">next</a><span>|</span><label class="collapse" for="c-40557381">[-]</label><label class="expand" for="c-40557381">[1 more]</label></div><br/><div class="children"><div class="content"><i>I was thinking about the brief life of the dedicated flash video cameras. They were more capable than phones of the era, but they couldn’t share on their own.</i><p>Those are still used in environments where that is a feature, not a bug.</div><br/></div></div></div></div><div id="40556865" class="c"><input type="checkbox" id="c-40556865" checked=""/><div class="controls bullet"><span class="by">RajT88</span><span>|</span><a href="#40556632">parent</a><span>|</span><a href="#40556985">prev</a><span>|</span><a href="#40557328">next</a><span>|</span><label class="collapse" for="c-40556865">[-]</label><label class="expand" for="c-40556865">[1 more]</label></div><br/><div class="children"><div class="content">I had a Chumby 8 for a while.  It was cool - I was able to stream TV shows to it using the TVersity flash interface.<p>It never really got enough software for it to ever get out of the &quot;janky and promising&quot; stage.</div><br/></div></div></div></div><div id="40557328" class="c"><input type="checkbox" id="c-40557328" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#40556632">prev</a><span>|</span><a href="#40558228">next</a><span>|</span><label class="collapse" for="c-40557328">[-]</label><label class="expand" for="c-40557328">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>Upgrading my Chumby 8 kernel part 7: touchscreen</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38136590">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38136590</a> - Nov 2023 (1 comment)<p><i>Upgrading my Chumby 8 kernel part 5: graphics</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36287963">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36287963</a> - June 2023 (13 comments)<p><i>Upgrading my Chumby 8 kernel part 4: reboot&#x2F;poweroff</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35184917">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35184917</a> - March 2023 (10 comments)<p><i>Upgrading my old Chumby 8 Linux kernel</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34063931">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34063931</a> - Dec 2022 (32 comments)</div><br/></div></div><div id="40558228" class="c"><input type="checkbox" id="c-40558228" checked=""/><div class="controls bullet"><span class="by">terinjokes</span><span>|</span><a href="#40557328">prev</a><span>|</span><a href="#40558739">next</a><span>|</span><label class="collapse" for="c-40558228">[-]</label><label class="expand" for="c-40558228">[3 more]</label></div><br/><div class="children"><div class="content">A few years ago I wrote[0] about a similar approach on an RTC-less system (a Raspberry 3B+) by utilising systemd&#x27;s clock-epoch to set time across reboots to be &quot;reasonably close enough&quot; for DNS-over-TLS and chrony&#x27;s NTS to take over, and avoid large time jumps being observed by daemons.<p>To that last point: reading this file is one of the very first things systemd does after being started right in main, so time is set before any services are brought up. Whereas time for the OP isn&#x27;t set until the `500datetime` service is loaded.<p>[0]: <a href="https:&#x2F;&#x2F;terinstock.com&#x2F;post&#x2F;2021&#x2F;12&#x2F;Systemds-clock-epoch-for-RTC-less-systems&#x2F;" rel="nofollow">https:&#x2F;&#x2F;terinstock.com&#x2F;post&#x2F;2021&#x2F;12&#x2F;Systemds-clock-epoch-for...</a></div><br/><div id="40558577" class="c"><input type="checkbox" id="c-40558577" checked=""/><div class="controls bullet"><span class="by">dougg3</span><span>|</span><a href="#40558228">parent</a><span>|</span><a href="#40558739">next</a><span>|</span><label class="collapse" for="c-40558577">[-]</label><label class="expand" for="c-40558577">[2 more]</label></div><br/><div class="children"><div class="content">Nice systemd solution, it seems very elegant!<p>To be clear, my init script is named S00datetime, not 500datetime. It&#x27;s actually the very first one that runs from rcS. So the date is restored very, very early in the boot process before pretty much everything else.</div><br/><div id="40559826" class="c"><input type="checkbox" id="c-40559826" checked=""/><div class="controls bullet"><span class="by">terinjokes</span><span>|</span><a href="#40558228">root</a><span>|</span><a href="#40558577">parent</a><span>|</span><a href="#40558739">next</a><span>|</span><label class="collapse" for="c-40559826">[-]</label><label class="expand" for="c-40559826">[1 more]</label></div><br/><div class="children"><div class="content">Now that you mention it I can&#x27;t see anything other than an &quot;S&quot;. Yes, that certainly makes it less of a problem.</div><br/></div></div></div></div></div></div><div id="40558739" class="c"><input type="checkbox" id="c-40558739" checked=""/><div class="controls bullet"><span class="by">ralphc</span><span>|</span><a href="#40558228">prev</a><span>|</span><label class="collapse" for="c-40558739">[-]</label><label class="expand" for="c-40558739">[1 more]</label></div><br/><div class="children"><div class="content">I have a chumby one, it can be an alarm clock standalone, and you can ssh into it if you put it in developer mode.<p>Someone has bought the chumby domain and runs a service for it, if you subscribe you can get a bunch of apps that run on it.</div><br/></div></div></div></div></div></div></div></body></html>