<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1724144466050" as="style"/><link rel="stylesheet" href="styles.css?v=1724144466050"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://jvns.ca/blog/2024/08/19/migrating-mess-with-dns-to-use-powerdns/">Migrating Mess with DNS to Use PowerDNS</a> <span class="domain">(<a href="https://jvns.ca">jvns.ca</a>)</span></div><div class="subtext"><span>hasheddan</span> | <span>32 comments</span></div><br/><div><div id="41296750" class="c"><input type="checkbox" id="c-41296750" checked=""/><div class="controls bullet"><span class="by">benreesman</span><span>|</span><a href="#41293932">next</a><span>|</span><label class="collapse" for="c-41296750">[-]</label><label class="expand" for="c-41296750">[1 more]</label></div><br/><div class="children"><div class="content">I’ve said similar before but I’m just so impressed with Julia Evans as a technologist and technology writer&#x2F;blogger: from very humble beginnings the scope and sophistication and arc of growing expertise is a masterclass in how to become a legend via putting in the work: and in an age of so many bytes on how to take shortcuts this is exactly the kind of role model we need.<p>In this particular instance I recall the post about DNS some years ago and the callback is amply enriched.<p>Keep it up @jvns. You hold us all to a high standard.</div><br/></div></div><div id="41293932" class="c"><input type="checkbox" id="c-41293932" checked=""/><div class="controls bullet"><span class="by">joeig</span><span>|</span><a href="#41296750">prev</a><span>|</span><a href="#41293869">next</a><span>|</span><label class="collapse" for="c-41293932">[-]</label><label class="expand" for="c-41293932">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Sometimes users will still get errors from PowerDNS directly, but I added some logging of all the errors that users see, so hopefully I can review them and add extra translations if there are other common errors that come up.<p>I noticed that you are using our Go module to access the API. It is wonderful to see our work helping others build great software, especially for education. Thank you for that.<p>Please note that the upstream API sometimes changes slightly between minor releases. For example, prior to v4.9, the error response for a non-existent server was &quot;Not Found&quot;. Starting with v4.9, it changed to &quot;Method Not Allowed&quot;.<p>Unfortunately, error responses aren&#x27;t always part of the API specification. I&#x27;m thinking about adding the most common cases to the module anyway.</div><br/><div id="41295579" class="c"><input type="checkbox" id="c-41295579" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#41293932">parent</a><span>|</span><a href="#41296712">next</a><span>|</span><label class="collapse" for="c-41295579">[-]</label><label class="expand" for="c-41295579">[2 more]</label></div><br/><div class="children"><div class="content">You just said that the message for &quot;non-existent server&quot; is spelled &quot;method not allowed&quot;? Did I read this right?</div><br/><div id="41297618" class="c"><input type="checkbox" id="c-41297618" checked=""/><div class="controls bullet"><span class="by">justinclift</span><span>|</span><a href="#41293932">root</a><span>|</span><a href="#41295579">parent</a><span>|</span><a href="#41296712">next</a><span>|</span><label class="collapse" for="c-41297618">[-]</label><label class="expand" for="c-41297618">[1 more]</label></div><br/><div class="children"><div class="content">Seems like a super confusing response message for a server not being found. :(</div><br/></div></div></div></div><div id="41296712" class="c"><input type="checkbox" id="c-41296712" checked=""/><div class="controls bullet"><span class="by">grantla</span><span>|</span><a href="#41293932">parent</a><span>|</span><a href="#41295579">prev</a><span>|</span><a href="#41293869">next</a><span>|</span><label class="collapse" for="c-41296712">[-]</label><label class="expand" for="c-41296712">[1 more]</label></div><br/><div class="children"><div class="content">Care to expand on the &quot;non-existent server&quot; part? This is probably an oversight (missing tests) in the API impl.</div><br/></div></div></div></div><div id="41293869" class="c"><input type="checkbox" id="c-41293869" checked=""/><div class="controls bullet"><span class="by">e12e</span><span>|</span><a href="#41293932">prev</a><span>|</span><a href="#41293575">next</a><span>|</span><label class="collapse" for="c-41293869">[-]</label><label class="expand" for="c-41293869">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Previously Mess With DNS was using a Postgres database. This was problematic because I only gave the Postgres machine 256MB of RAM, which meant that the database got OOM killed almost every single day. I never really worked out exactly why it got OOM killed every day, but that’s how it was.<p>Found this a little surprising - postgres is internet old - I&#x27;m pretty sure it was around at a time when physical servers might not have 256mb of ram?<p>Seems this should be possible to tune down still? (I mean, maybe not. Postgres 16 isn&#x27;t postgres 6, and maybe I&#x27;m just getting old..)</div><br/><div id="41296732" class="c"><input type="checkbox" id="c-41296732" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#41293869">parent</a><span>|</span><a href="#41295593">next</a><span>|</span><label class="collapse" for="c-41296732">[-]</label><label class="expand" for="c-41296732">[1 more]</label></div><br/><div class="children"><div class="content">Maintenance and vacuum is likely what’s causing this. Can definitely tune it down. 256mb is really not very much these days though.</div><br/></div></div><div id="41295593" class="c"><input type="checkbox" id="c-41295593" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#41293869">parent</a><span>|</span><a href="#41296732">prev</a><span>|</span><a href="#41293575">next</a><span>|</span><label class="collapse" for="c-41295593">[-]</label><label class="expand" for="c-41295593">[2 more]</label></div><br/><div class="children"><div class="content">Postgres can scale down, there are a few settings you can tweak: <a href="https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;runtime-config-resource.html" rel="nofollow">https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;runtime-config-resou...</a></div><br/><div id="41297965" class="c"><input type="checkbox" id="c-41297965" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#41293869">root</a><span>|</span><a href="#41295593">parent</a><span>|</span><a href="#41293575">next</a><span>|</span><label class="collapse" for="c-41297965">[-]</label><label class="expand" for="c-41297965">[1 more]</label></div><br/><div class="children"><div class="content">pgtune can generate config for 256MB server automatically, probably a good starting point: <a href="https:&#x2F;&#x2F;pgtune.leopard.in.ua&#x2F;" rel="nofollow">https:&#x2F;&#x2F;pgtune.leopard.in.ua&#x2F;</a></div><br/></div></div></div></div></div></div><div id="41293575" class="c"><input type="checkbox" id="c-41293575" checked=""/><div class="controls bullet"><span class="by">chriscjcj</span><span>|</span><a href="#41293869">prev</a><span>|</span><a href="#41297623">next</a><span>|</span><label class="collapse" for="c-41293575">[-]</label><label class="expand" for="c-41293575">[2 more]</label></div><br/><div class="children"><div class="content">Thank you very much for this wonderful experimental and educational tool.<p>You mentioned about your previous version:<p>&gt; If there was a CNAME record for a domain name, it allowed you to create other records for that domain name, even if it shouldn’t<p>&gt; you could create 2 different CNAME records for the same domain name, which shouldn’t be allowed<p>One suggestion... If someone makes a mistake and generates an error, it would be terrific if there were a more verbose explanation so the user may better understand why what they&#x27;re trying to do won&#x27;t work. I&#x27;m very much a conceptual learner. If I can understand why an error is an error, it puts me on a better path toward a more comprehensive understanding.<p>Thanks again for all your work.</div><br/><div id="41293642" class="c"><input type="checkbox" id="c-41293642" checked=""/><div class="controls bullet"><span class="by">jvns</span><span>|</span><a href="#41293575">parent</a><span>|</span><a href="#41297623">next</a><span>|</span><label class="collapse" for="c-41293642">[-]</label><label class="expand" for="c-41293642">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a great idea, thanks.</div><br/></div></div></div></div><div id="41297623" class="c"><input type="checkbox" id="c-41297623" checked=""/><div class="controls bullet"><span class="by">zelcon</span><span>|</span><a href="#41293575">prev</a><span>|</span><a href="#41294895">next</a><span>|</span><label class="collapse" for="c-41297623">[-]</label><label class="expand" for="c-41297623">[1 more]</label></div><br/><div class="children"><div class="content">I cringe every time I see someone trying to replace good, purpose-built protocols with some bespoke HTTP crap</div><br/></div></div><div id="41294895" class="c"><input type="checkbox" id="c-41294895" checked=""/><div class="controls bullet"><span class="by">amanzi</span><span>|</span><a href="#41297623">prev</a><span>|</span><a href="#41294930">next</a><span>|</span><label class="collapse" for="c-41294895">[-]</label><label class="expand" for="c-41294895">[2 more]</label></div><br/><div class="children"><div class="content">The section labelled &quot;what I learned: it’s okay for an API to duplicate information&quot; is something I come across often in Django projects. Django views send a Python dictionary of data to the template processor to display the information. Often it&#x27;s easier to massage the data into a more friendly format before sending it to the template, even if it means duplicating the info sent.</div><br/><div id="41295697" class="c"><input type="checkbox" id="c-41295697" checked=""/><div class="controls bullet"><span class="by">cqqxo4zV46cp</span><span>|</span><a href="#41294895">parent</a><span>|</span><a href="#41294930">next</a><span>|</span><label class="collapse" for="c-41295697">[-]</label><label class="expand" for="c-41295697">[1 more]</label></div><br/><div class="children"><div class="content">Yep. There’s certainly a balance to strike, especially on projects with a larger number of people working on them. But I generally find that you want to do at least MOST of your data processing outside of your template.</div><br/></div></div></div></div><div id="41294930" class="c"><input type="checkbox" id="c-41294930" checked=""/><div class="controls bullet"><span class="by">8organicbits</span><span>|</span><a href="#41294895">prev</a><span>|</span><a href="#41296088">next</a><span>|</span><label class="collapse" for="c-41294930">[-]</label><label class="expand" for="c-41294930">[2 more]</label></div><br/><div class="children"><div class="content">Great write up. I&#x27;m using PowerDNS for <a href="https:&#x2F;&#x2F;www.getlocalcert.net&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.getlocalcert.net&#x2F;</a>, which also makes heavy use of PowerDNS&#x27;s HTTP API. I&#x27;ve been really happy with it. I need to check my code, but I remember planning to use the comment field of the records to map between application IDs and records in PowerDNS zones.<p>You may be able to implement the logging by using a customization of the Sqlite backend, although I think PowerDNS caching may get in your way.<p>I&#x27;ll recommend the pipe backend to anyone looking to hack on DNS stuff. It&#x27;s almost like a DNS lookup via a function in any programming language you choose. It takes a while to figure out how incoming queries are translated though.<p><a href="https:&#x2F;&#x2F;doc.powerdns.com&#x2F;authoritative&#x2F;backends&#x2F;pipe.html" rel="nofollow">https:&#x2F;&#x2F;doc.powerdns.com&#x2F;authoritative&#x2F;backends&#x2F;pipe.html</a></div><br/><div id="41296385" class="c"><input type="checkbox" id="c-41296385" checked=""/><div class="controls bullet"><span class="by">apitman</span><span>|</span><a href="#41294930">parent</a><span>|</span><a href="#41296088">next</a><span>|</span><label class="collapse" for="c-41296385">[-]</label><label class="expand" for="c-41296385">[1 more]</label></div><br/><div class="children"><div class="content">getlocalcert looks interesting. For custom domains, what would the value prop be vs using a registrar&#x27;s API? Discloser: I run TakingNames.io which is a domain seller focused on providing a low-friction API.</div><br/></div></div></div></div><div id="41296088" class="c"><input type="checkbox" id="c-41296088" checked=""/><div class="controls bullet"><span class="by">chrisweekly</span><span>|</span><a href="#41294930">prev</a><span>|</span><a href="#41294118">next</a><span>|</span><label class="collapse" for="c-41296088">[-]</label><label class="expand" for="c-41296088">[1 more]</label></div><br/><div class="children"><div class="content">Julia Evans is an absolute treasure. Highly recommend exploring her blog, subscribing, etc. Signal:noise ratio is phenomenal.</div><br/></div></div><div id="41294118" class="c"><input type="checkbox" id="c-41294118" checked=""/><div class="controls bullet"><span class="by">ChocolateGod</span><span>|</span><a href="#41296088">prev</a><span>|</span><a href="#41295664">next</a><span>|</span><label class="collapse" for="c-41294118">[-]</label><label class="expand" for="c-41294118">[4 more]</label></div><br/><div class="children"><div class="content">Been using a PowerDNS cluster in production for about 5 years using a SQL backend for replication, absolutely zero issues, not a single crash, memory leak etc in that time. The only downside is the API has a single key and you can not generate more, but there are open source projects that can put the API behind a proxy with additional keys&#x2F;ACL.<p>Given it can read BIND files, surprised BIND is still the default in many places.</div><br/><div id="41294245" class="c"><input type="checkbox" id="c-41294245" checked=""/><div class="controls bullet"><span class="by">quicksilver03</span><span>|</span><a href="#41294118">parent</a><span>|</span><a href="#41294971">next</a><span>|</span><label class="collapse" for="c-41294245">[-]</label><label class="expand" for="c-41294245">[1 more]</label></div><br/><div class="children"><div class="content">I wrote one such proxy, though mine is not open source: I found relatively easy working with zones and records, and a well-designed test suite helps building confidence that a key for an &quot;account&quot; A cannot read or write into &quot;account&quot; B.<p>I&#x27;m putting &quot;account&quot; between quotes because it isn&#x27;t a PowerDNS concept, there is just a lonely varchar column in the &#x27;domains&#x27; table where one can store some account-related information. To handle TSIG keys I had to extend PowerDNS&#x27;s data model to represent the association between a TSIG key and an &quot;account&quot;.</div><br/></div></div><div id="41294971" class="c"><input type="checkbox" id="c-41294971" checked=""/><div class="controls bullet"><span class="by">8organicbits</span><span>|</span><a href="#41294118">parent</a><span>|</span><a href="#41294245">prev</a><span>|</span><a href="#41295418">next</a><span>|</span><label class="collapse" for="c-41294971">[-]</label><label class="expand" for="c-41294971">[1 more]</label></div><br/><div class="children"><div class="content">I think the limitation is that the API can&#x27;t write BIND files, so databases are preferred.<p><a href="https:&#x2F;&#x2F;doc.powerdns.com&#x2F;authoritative&#x2F;backends&#x2F;bind.html" rel="nofollow">https:&#x2F;&#x2F;doc.powerdns.com&#x2F;authoritative&#x2F;backends&#x2F;bind.html</a></div><br/></div></div><div id="41295418" class="c"><input type="checkbox" id="c-41295418" checked=""/><div class="controls bullet"><span class="by">fanf2</span><span>|</span><a href="#41294118">parent</a><span>|</span><a href="#41294971">prev</a><span>|</span><a href="#41295664">next</a><span>|</span><label class="collapse" for="c-41295418">[-]</label><label class="expand" for="c-41295418">[1 more]</label></div><br/><div class="children"><div class="content">They are RFC 1035 standard zone files, they aren’t specific to BIND.</div><br/></div></div></div></div><div id="41295664" class="c"><input type="checkbox" id="c-41295664" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#41294118">prev</a><span>|</span><a href="#41293523">next</a><span>|</span><label class="collapse" for="c-41295664">[-]</label><label class="expand" for="c-41295664">[4 more]</label></div><br/><div class="children"><div class="content">Does anyone use CoreDNS? Outside of a Kubernetes cluster I mean.</div><br/><div id="41296079" class="c"><input type="checkbox" id="c-41296079" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#41295664">parent</a><span>|</span><a href="#41295698">next</a><span>|</span><label class="collapse" for="c-41296079">[-]</label><label class="expand" for="c-41296079">[1 more]</label></div><br/><div class="children"><div class="content">Yes lots of folks[0]. At Cruise we made use of it to do split dns when were migrating from aws to gcp but dont know if it’s still used<p>[0] - <a href="https:&#x2F;&#x2F;github.com&#x2F;coredns&#x2F;coredns&#x2F;blob&#x2F;master&#x2F;ADOPTERS.md">https:&#x2F;&#x2F;github.com&#x2F;coredns&#x2F;coredns&#x2F;blob&#x2F;master&#x2F;ADOPTERS.md</a></div><br/></div></div><div id="41295698" class="c"><input type="checkbox" id="c-41295698" checked=""/><div class="controls bullet"><span class="by">zrail</span><span>|</span><a href="#41295664">parent</a><span>|</span><a href="#41296079">prev</a><span>|</span><a href="#41293523">next</a><span>|</span><label class="collapse" for="c-41295698">[-]</label><label class="expand" for="c-41295698">[2 more]</label></div><br/><div class="children"><div class="content">I use it as a caching proxy on my homeprod nodes. I want docker containers to be able to query Tailscale&#x27;s MagicDNS without using host-mode networking everywhere. My config is really simple, just forward .ts.net to 100.100.100.100 and otherwise forward to NextDNS.</div><br/><div id="41296744" class="c"><input type="checkbox" id="c-41296744" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#41295664">root</a><span>|</span><a href="#41295698">parent</a><span>|</span><a href="#41293523">next</a><span>|</span><label class="collapse" for="c-41296744">[-]</label><label class="expand" for="c-41296744">[1 more]</label></div><br/><div class="children"><div class="content">How’s Nextdns been? I’ve been using pihole for ages but i’m not too impressed by how much latency I have hitting my home network for dns when far from home. I use Tailscale to vpn on demand when off my home WiFi and route dns thru my pihole vm. Considering relocating it to a VPS but then I started to think maybe nextdns will be less painful to manage and offer better performance. I have decent upload speed (50mbit) but the latency over cellular isn’t the best.</div><br/></div></div></div></div></div></div><div id="41293523" class="c"><input type="checkbox" id="c-41293523" checked=""/><div class="controls bullet"><span class="by">websap</span><span>|</span><a href="#41295664">prev</a><span>|</span><a href="#41294241">next</a><span>|</span><label class="collapse" for="c-41293523">[-]</label><label class="expand" for="c-41293523">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve always enjoyed Julia&#x27;s articles. I know she quit her job to do tech writing full time, but is that still true?</div><br/><div id="41296349" class="c"><input type="checkbox" id="c-41296349" checked=""/><div class="controls bullet"><span class="by">jcagalawan</span><span>|</span><a href="#41293523">parent</a><span>|</span><a href="#41294241">next</a><span>|</span><label class="collapse" for="c-41296349">[-]</label><label class="expand" for="c-41296349">[1 more]</label></div><br/><div class="children"><div class="content">Still true. From her Mastodon today:<p>&gt; i quit my job just over 5 years ago to explain computer things (<a href="https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2019&#x2F;09&#x2F;13&#x2F;a-year-explaining-computer-things&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jvns.ca&#x2F;blog&#x2F;2019&#x2F;09&#x2F;13&#x2F;a-year-explaining-computer-t...</a>). I had no idea if I would like being my own boss but ultimately it&#x27;s been really cool and I&#x27;m happy to have this weird job writing zines about computers.<p><a href="https:&#x2F;&#x2F;social.jvns.ca&#x2F;@b0rk&#x2F;112991897872016086" rel="nofollow">https:&#x2F;&#x2F;social.jvns.ca&#x2F;@b0rk&#x2F;112991897872016086</a></div><br/></div></div></div></div><div id="41294241" class="c"><input type="checkbox" id="c-41294241" checked=""/><div class="controls bullet"><span class="by">tlofreso</span><span>|</span><a href="#41293523">prev</a><span>|</span><a href="#41293462">next</a><span>|</span><label class="collapse" for="c-41294241">[-]</label><label class="expand" for="c-41294241">[2 more]</label></div><br/><div class="children"><div class="content">I came across Bert Hubert during covid because of his incredible work on this article: <a href="https:&#x2F;&#x2F;berthub.eu&#x2F;articles&#x2F;posts&#x2F;reverse-engineering-source-code-of-the-biontech-pfizer-vaccine&#x2F;" rel="nofollow">https:&#x2F;&#x2F;berthub.eu&#x2F;articles&#x2F;posts&#x2F;reverse-engineering-source...</a><p>Long before Bert was writing articles on the source code of mRNA vaccines, he helped build PowerDNS. He talks about that in a three part series starting here: <a href="https:&#x2F;&#x2F;berthub.eu&#x2F;articles&#x2F;posts&#x2F;history-of-powerdns-1999-2003&#x2F;" rel="nofollow">https:&#x2F;&#x2F;berthub.eu&#x2F;articles&#x2F;posts&#x2F;history-of-powerdns-1999-2...</a><p>A fascinating individual...<p><a href="https:&#x2F;&#x2F;fosstodon.org&#x2F;@bert_hubert" rel="nofollow">https:&#x2F;&#x2F;fosstodon.org&#x2F;@bert_hubert</a><p><a href="https:&#x2F;&#x2F;github.com&#x2F;berthubert">https:&#x2F;&#x2F;github.com&#x2F;berthubert</a><p><a href="https:&#x2F;&#x2F;berthub.eu&#x2F;" rel="nofollow">https:&#x2F;&#x2F;berthub.eu&#x2F;</a></div><br/><div id="41298027" class="c"><input type="checkbox" id="c-41298027" checked=""/><div class="controls bullet"><span class="by">ahubert</span><span>|</span><a href="#41294241">parent</a><span>|</span><a href="#41293462">next</a><span>|</span><label class="collapse" for="c-41298027">[-]</label><label class="expand" for="c-41298027">[1 more]</label></div><br/><div class="children"><div class="content"><i>blush</i> :-)</div><br/></div></div></div></div><div id="41294831" class="c"><input type="checkbox" id="c-41294831" checked=""/><div class="controls bullet"><span class="by">LoganDark</span><span>|</span><a href="#41293462">prev</a><span>|</span><label class="collapse" for="c-41294831">[-]</label><label class="expand" for="c-41294831">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I never really worked out exactly why it got OOM killed every day<p>Probably you ran out of memory (and configured the database incorrectly).</div><br/></div></div></div></div></div></div></div></body></html>