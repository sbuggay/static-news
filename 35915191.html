<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683968448910" as="style"/><link rel="stylesheet" href="styles.css?v=1683968448910"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/digital-fabric/polyphony">Polyphony: Fine-Grained Concurrency for Ruby</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>thunderbong</span> | <span>15 comments</span></div><br/><div><div id="35926676" class="c"><input type="checkbox" id="c-35926676" checked=""/><div class="controls bullet"><span class="by">samsquire</span><span>|</span><a href="#35926702">next</a><span>|</span><label class="collapse" for="c-35926676">[-]</label><label class="expand" for="c-35926676">[1 more]</label></div><br/><div class="children"><div class="content">Thank you for this.<p>I am interested in how concurrency can be represented elegantly and efficiently, so I am interested in how libraries can simplify async and make it easier to reason about and write<p>What kind of code do you want to be capable of writing? Any imaginary syntax you can think of?<p>The libev and ioring support is great for IO scalability (<a href="https:&#x2F;&#x2F;github.com&#x2F;enki&#x2F;libev">https:&#x2F;&#x2F;github.com&#x2F;enki&#x2F;libev</a> not sure if this is the official repo)<p>In Python I use the &quot;select&quot; module and use epoll on Linux.<p>I am currently thinking of designing an API that allows the registration of epoll-like listeners to arbitrary objects, including business objects, so you can efficiently register a listener on multiple behaviours of multiple arbitrary objects.<p>I wrote an async&#x2F;await simulation in Java and my scheduler is really simple, it&#x27;s just a for loop that checks to see if there are any tasks that can progress. I notice the switch_fiber in polyphony must do something similar. This is similar to a yield in a coroutine.<p>My async&#x2F;await simulation takes the following program:<p><pre><code>  task1:
  while True:
    handle1 = async task2();
    handle2 = async task3();
    print(await handle1)
    print(await handle2)

  task2:
  n = 0
  while True:
      yield n++

  task3:
  n = 0
  while True:
    yield n++
</code></pre>
I had someone on HN explain to me how async works in Rust, but I&#x27;ve not written enough Rust to truly understand async in rust. <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33592334" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33592334</a></div><br/></div></div><div id="35926702" class="c"><input type="checkbox" id="c-35926702" checked=""/><div class="controls bullet"><span class="by">ciconia</span><span>|</span><a href="#35926676">prev</a><span>|</span><a href="#35922640">next</a><span>|</span><label class="collapse" for="c-35926702">[-]</label><label class="expand" for="c-35926702">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m the author of Polyphony. I&#x27;d be happy to answer any questions you have.</div><br/></div></div><div id="35922640" class="c"><input type="checkbox" id="c-35922640" checked=""/><div class="controls bullet"><span class="by">artyom</span><span>|</span><a href="#35926702">prev</a><span>|</span><a href="#35925073">next</a><span>|</span><label class="collapse" for="c-35922640">[-]</label><label class="expand" for="c-35922640">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d love a performance comparison against concurrent-ruby on the Readme.<p>That&#x27;s assuming Polyphony is aiming to replace most or all of it.</div><br/></div></div><div id="35925073" class="c"><input type="checkbox" id="c-35925073" checked=""/><div class="controls bullet"><span class="by">lukegru</span><span>|</span><a href="#35922640">prev</a><span>|</span><a href="#35926081">next</a><span>|</span><label class="collapse" for="c-35925073">[-]</label><label class="expand" for="c-35925073">[3 more]</label></div><br/><div class="children"><div class="content">Does this use the Fiber Scheduler API to figure out which fibers are blocking? If so, why does this need libev - I&#x27;m guessing it&#x27;s to do with performance?</div><br/><div id="35926715" class="c"><input type="checkbox" id="c-35926715" checked=""/><div class="controls bullet"><span class="by">ciconia</span><span>|</span><a href="#35925073">parent</a><span>|</span><a href="#35925847">next</a><span>|</span><label class="collapse" for="c-35926715">[-]</label><label class="expand" for="c-35926715">[1 more]</label></div><br/><div class="children"><div class="content">No, Polyphony has a design that diverges from the model proposed by the FibeScheduler API. Note that the FiberScheduler API included with Ruby is only an interface, not an implementation. Polyphony uses io_uring on recent Linux kernels, or libev otherwise to perform I&#x2F;O operations and implement timeouts.</div><br/></div></div><div id="35925847" class="c"><input type="checkbox" id="c-35925847" checked=""/><div class="controls bullet"><span class="by">rubiquity</span><span>|</span><a href="#35925073">parent</a><span>|</span><a href="#35926715">prev</a><span>|</span><a href="#35926081">next</a><span>|</span><label class="collapse" for="c-35925847">[-]</label><label class="expand" for="c-35925847">[1 more]</label></div><br/><div class="children"><div class="content">Fiber::Scheduler is only an interface. You still need an IO multiplexer underneath it.</div><br/></div></div></div></div><div id="35926081" class="c"><input type="checkbox" id="c-35926081" checked=""/><div class="controls bullet"><span class="by">jeffreygoesto</span><span>|</span><a href="#35925073">prev</a><span>|</span><a href="#35923754">next</a><span>|</span><label class="collapse" for="c-35926081">[-]</label><label class="expand" for="c-35926081">[1 more]</label></div><br/><div class="children"><div class="content">Excellent explanation and very well thought out. Can we have something similar for C++ and Rust please?</div><br/></div></div><div id="35923754" class="c"><input type="checkbox" id="c-35923754" checked=""/><div class="controls bullet"><span class="by">rgbrgb</span><span>|</span><a href="#35926081">prev</a><span>|</span><a href="#35923046">next</a><span>|</span><label class="collapse" for="c-35923754">[-]</label><label class="expand" for="c-35923754">[2 more]</label></div><br/><div class="children"><div class="content">Very cool! Small rec would be to pull up a few things from the linked docs into the main readme:<p>- code examples<p>- motivation for building<p>- what I should try this for vs the alternatives</div><br/><div id="35926723" class="c"><input type="checkbox" id="c-35926723" checked=""/><div class="controls bullet"><span class="by">ciconia</span><span>|</span><a href="#35923754">parent</a><span>|</span><a href="#35923046">next</a><span>|</span><label class="collapse" for="c-35926723">[-]</label><label class="expand" for="c-35926723">[1 more]</label></div><br/><div class="children"><div class="content">Further work on the Polyphony docs is in the pipeline.</div><br/></div></div></div></div><div id="35923046" class="c"><input type="checkbox" id="c-35923046" checked=""/><div class="controls bullet"><span class="by">jupp0r</span><span>|</span><a href="#35923754">prev</a><span>|</span><label class="collapse" for="c-35923046">[-]</label><label class="expand" for="c-35923046">[5 more]</label></div><br/><div class="children"><div class="content">Without support from Rails, all of these libraries unfortunately can&#x27;t be used by 99% of Ruby code out there and using Ruby in any sort of fan out architecture remains a pain (ie almost impossible in practice).</div><br/><div id="35926734" class="c"><input type="checkbox" id="c-35926734" checked=""/><div class="controls bullet"><span class="by">ciconia</span><span>|</span><a href="#35923046">parent</a><span>|</span><a href="#35923736">next</a><span>|</span><label class="collapse" for="c-35926734">[-]</label><label class="expand" for="c-35926734">[1 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t really had time to explore the usage of Polyphony in Rails apps. Personally, I don&#x27;t use Rails in my work, and instead develop custom Ruby apps. I believe there&#x27;s a place for Ruby development work without any connection to Rails.</div><br/></div></div><div id="35923736" class="c"><input type="checkbox" id="c-35923736" checked=""/><div class="controls bullet"><span class="by">zeckalpha</span><span>|</span><a href="#35923046">parent</a><span>|</span><a href="#35926734">prev</a><span>|</span><label class="collapse" for="c-35923736">[-]</label><label class="expand" for="c-35923736">[3 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t see why you couldn&#x27;t use Polyphony inside a Rails app.</div><br/><div id="35925994" class="c"><input type="checkbox" id="c-35925994" checked=""/><div class="controls bullet"><span class="by">jupp0r</span><span>|</span><a href="#35923046">root</a><span>|</span><a href="#35923736">parent</a><span>|</span><a href="#35924340">next</a><span>|</span><label class="collapse" for="c-35925994">[-]</label><label class="expand" for="c-35925994">[1 more]</label></div><br/><div class="children"><div class="content">This is where the &quot;in practice&quot; part comes in. Ruby culture thinks it&#x27;s a great idea to use global mutable state in lieu of request local state all over the place because the code looks so beautiful if you don&#x27;t have all of these parameters and just grab stuff from the ether. So unless all of your dependency tree (three quarters of which probably had its last release in 2017) fixes their usage of global variables, you won&#x27;t have much fun even if Rails itself got rid of their global variables (to be fair, they&#x27;ve done a great job over the last year or so).</div><br/></div></div><div id="35924340" class="c"><input type="checkbox" id="c-35924340" checked=""/><div class="controls bullet"><span class="by">rafamvc</span><span>|</span><a href="#35923046">root</a><span>|</span><a href="#35923736">parent</a><span>|</span><a href="#35925994">prev</a><span>|</span><label class="collapse" for="c-35924340">[-]</label><label class="expand" for="c-35924340">[1 more]</label></div><br/><div class="children"><div class="content">Because eventually a dependency will make it non concurrent. 
Rails is the driving force for adoption in the ruby ecosystem. If it isn&#x27;t a rails requirement to be concurrent friendly, it will be broadly ignored.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>