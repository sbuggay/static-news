<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1722589273002" as="style"/><link rel="stylesheet" href="styles.css?v=1722589273002"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/koiuo/xdg-override">xdg-override: change default application temporarily on Linux</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>koiueo</span> | <span>12 comments</span></div><br/><div><div id="41134924" class="c"><input type="checkbox" id="c-41134924" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#41137011">next</a><span>|</span><label class="collapse" for="c-41134924">[-]</label><label class="expand" for="c-41134924">[2 more]</label></div><br/><div class="children"><div class="content">I just have a small shell script as &quot;xdg-open&quot;. Writing this was easier than figuring out the magic xdg-* tools use the figure out the default application for something, and then not having that work on random days for reasons of planetary alignments.<p>This is not that different from &quot;xdg-override&quot;; you can add global overrides for specific URLs with a simple match, and matches from a specific application by checking the parent process (e.g. $(readlink &#x2F;proc&#x2F;$PPID&#x2F;exe) = &#x2F;usr&#x2F;bin&#x2F;slack, or some such). It seems easier to me to have everything in one place.<p>I also considered popping up dmenu for unknown filetypes, but I don&#x27;t use it that much and don&#x27;t really need it.<p>At any rate, &quot;to whom it might be useful&quot;:<p><pre><code>  #!&#x2F;bin&#x2F;zsh
  #
  # xdg-open, without suckage.
  [ &quot;${ZSH_VERSION:-}&quot; = &quot;&quot; ] &amp;&amp; echo &gt;&amp;2 &quot;Only works with zsh&quot; &amp;&amp; exit 1
  setopt err_exit no_unset pipefail
  
  (( $+1 )) || { print &gt;&amp;2 &#x27;need a parameter&#x27;; exit 1 }
  
  # Open URL.
  if [[ -z &quot;${1:#*:&#x2F;&#x2F;*}&quot; ]]; then
   proto=${(L)1%%:&#x2F;&#x2F;*}
   case $proto in
    (http|https)   exec firefox $1 ;;
    (file)      
     1=${1##$proto:&#x2F;&#x2F;} # Remove protocol
     1=&#x2F;${1#*&#x2F;}        # Remove hostname
    ;;
    (*)
     print &gt;&amp;2 &quot;xdg-open: no URL handler for protocol &#x27;$proto:&#x2F;&#x2F;&#x27; (for: $1)&quot;
     exit 1
   esac
  fi
  
  # Open file.
  ext=${(L)1:e}
  case $ext in
   (html|htm|pdf)                                  exec firefox   $1 ;;
   (png|webp|jpg|jpeg|heic)                        exec firefox   $1 ;;
   (mp?|ogg|flac|m4v|mkv|avi|mov|wav)              exec mpv       $1 ;;
   (md|markdown|txt|sh|zsh|go|py|rb|js|c|json|xml) exec st -e vim $1 ;;
   (*)
    mime=$(file -b --mime $1 2&gt;&amp;&#x2F;dev&#x2F;null ||:)
    t=${mime%&#x2F;*}
    case $t in
     (text)        exec st -e vim $1 ;;
     (image)       exec firefox   $1 ;;
     (audio|video) exec mpv       $1 ;;
    esac
    print &gt;&amp;2 &quot;xdg-open: don&#x27;t know how to open &#x27;.$ext&#x27; files (mime: &#x27;$mime&#x27;) (for: $1)&quot;
    exit 1
  esac</code></pre></div><br/><div id="41136645" class="c"><input type="checkbox" id="c-41136645" checked=""/><div class="controls bullet"><span class="by">koiueo</span><span>|</span><a href="#41134924">parent</a><span>|</span><a href="#41137011">next</a><span>|</span><label class="collapse" for="c-41136645">[-]</label><label class="expand" for="c-41136645">[1 more]</label></div><br/><div class="children"><div class="content">In a sense, xdg-open does exactly what your script does. Only it reads associations from mimeapps.list.<p>The complexity comes from the integration with various desktop environments. And this I understand. Ideally, everyone would use xdg-utils, but there&#x27;s legacy, backward compatibility, what not.<p>What I don&#x27;t understand is why those DE-specific openers do not always respect xdg settings. For instance, kde-open would respect mineapps.list for almost everything except default browser.<p>For me this is the main source of confusion and I would guess, this is the main driver behind numerous xdg-open alternatives out there.</div><br/></div></div></div></div><div id="41137011" class="c"><input type="checkbox" id="c-41137011" checked=""/><div class="controls bullet"><span class="by">Kudos</span><span>|</span><a href="#41134924">prev</a><span>|</span><a href="#41134351">next</a><span>|</span><label class="collapse" for="c-41137011">[-]</label><label class="expand" for="c-41137011">[1 more]</label></div><br/><div class="children"><div class="content">My work VPN client doesn&#x27;t work in Firefox, so I hacked something much more specific together to deal with that problem<p><pre><code>  #!&#x2F;bin&#x2F;sh
  
  if [ &quot;$@&quot; = &quot;&#x2F;tmp&#x2F;gpauth.html&quot; ]
  then
    flatpak run --filesystem=&#x2F;tmp&#x2F;gpauth.html org.chromium.Chromium &#x2F;tmp&#x2F;gpauth.html
  else
    &#x2F;usr&#x2F;bin&#x2F;xdg-open &quot;$@&quot;
  fi</code></pre></div><br/></div></div><div id="41134351" class="c"><input type="checkbox" id="c-41134351" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#41137011">prev</a><span>|</span><a href="#41135080">next</a><span>|</span><label class="collapse" for="c-41134351">[-]</label><label class="expand" for="c-41134351">[4 more]</label></div><br/><div class="children"><div class="content">On gnome there is a GTK4 app called &quot;Junction&quot;. It pops up a dialog that let&#x27;s you choose what application to open the given content in. I highly recommend just aliasing &#x27;open&#x27; to use that.<p><a href="https:&#x2F;&#x2F;apps.gnome.org&#x2F;Junction&#x2F;" rel="nofollow">https:&#x2F;&#x2F;apps.gnome.org&#x2F;Junction&#x2F;</a></div><br/><div id="41136429" class="c"><input type="checkbox" id="c-41136429" checked=""/><div class="controls bullet"><span class="by">vbernat</span><span>|</span><a href="#41134351">parent</a><span>|</span><a href="#41134490">next</a><span>|</span><label class="collapse" for="c-41136429">[-]</label><label class="expand" for="c-41136429">[1 more]</label></div><br/><div class="children"><div class="content">I have something similar with this short Python script:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;vincentbernat&#x2F;i3wm-configuration&#x2F;blob&#x2F;master&#x2F;bin&#x2F;xdg-app-chooser">https:&#x2F;&#x2F;github.com&#x2F;vincentbernat&#x2F;i3wm-configuration&#x2F;blob&#x2F;mas...</a></div><br/></div></div><div id="41134490" class="c"><input type="checkbox" id="c-41134490" checked=""/><div class="controls bullet"><span class="by">koiueo</span><span>|</span><a href="#41134351">parent</a><span>|</span><a href="#41136429">prev</a><span>|</span><a href="#41135080">next</a><span>|</span><label class="collapse" for="c-41134490">[-]</label><label class="expand" for="c-41134490">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for sharing this.
I&#x27;m not on Gnome and don&#x27;t need the option to choose an application every time I click on a link or a file. Nevertheless, seeing how other people approach a similar problem is interesting.<p>Looking through the source code briefly, it seems like it&#x27;s almost a full re-implementation of `xdg-open`. My solution is in a different league. I didn&#x27;t mean to replace `xdg-open` and aimed to augment `xdg-open` while being as simple as possible.</div><br/><div id="41136589" class="c"><input type="checkbox" id="c-41136589" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#41134351">root</a><span>|</span><a href="#41134490">parent</a><span>|</span><a href="#41135080">next</a><span>|</span><label class="collapse" for="c-41136589">[-]</label><label class="expand" for="c-41136589">[1 more]</label></div><br/><div class="children"><div class="content">Yours is really cool too! I&#x27;ll definitely try it out :).</div><br/></div></div></div></div></div></div><div id="41135080" class="c"><input type="checkbox" id="c-41135080" checked=""/><div class="controls bullet"><span class="by">fossdd</span><span>|</span><a href="#41134351">prev</a><span>|</span><label class="collapse" for="c-41135080">[-]</label><label class="expand" for="c-41135080">[4 more]</label></div><br/><div class="children"><div class="content">That reminds my of a own xdg-open I wrote that sits in &#x2F;usr&#x2F;local&#x2F;bin&#x2F;xdg-open.<p>It&#x27;s a simple python script that checks by looking at the protocol, mime type or extension which URL it is and also asks if there are multiple applications<p><a href="https:&#x2F;&#x2F;paste.sr.ht&#x2F;~fossdd&#x2F;7fa65e10998ebcc03a2bbcc8488f94e91fd29c2d" rel="nofollow">https:&#x2F;&#x2F;paste.sr.ht&#x2F;~fossdd&#x2F;7fa65e10998ebcc03a2bbcc8488f94e9...</a> (CC0)</div><br/><div id="41137006" class="c"><input type="checkbox" id="c-41137006" checked=""/><div class="controls bullet"><span class="by">JNRowe</span><span>|</span><a href="#41135080">parent</a><span>|</span><a href="#41136195">next</a><span>|</span><label class="collapse" for="c-41137006">[-]</label><label class="expand" for="c-41137006">[1 more]</label></div><br/><div class="children"><div class="content">[<i>In the spirit of elucidation, and not general meannessâ¦</i>]<p>Like jojo14 points out Python has the shlex module, and it is definitely useful in these situations even if just for quote().  And, os.system() is basically never safe with external input.  Without proper escaping you&#x27;re one click from code execution, for example with the input &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;issue%3Becho%20whoops&quot; or &quot;<a href="http:&#x2F;&#x2F;example.com&#x2F;&#x27;;echo" rel="nofollow">http:&#x2F;&#x2F;example.com&#x2F;&#x27;;echo</a> whoops&#x27;&quot;.<p>It doesn&#x27;t <i>appear</i> to matter in this instance, but you can feed check_output() with the stdin argument, which removes the need for using shell=True.  shell=True in other paths could easily lead to unwanted code execution without thorough escaping.</div><br/></div></div><div id="41136195" class="c"><input type="checkbox" id="c-41136195" checked=""/><div class="controls bullet"><span class="by">jojo14</span><span>|</span><a href="#41135080">parent</a><span>|</span><a href="#41137006">prev</a><span>|</span><a href="#41136672">next</a><span>|</span><label class="collapse" for="c-41136195">[-]</label><label class="expand" for="c-41136195">[1 more]</label></div><br/><div class="children"><div class="content">Thank you for sharing :-)
Your script is simple, yet effective. If you plan to modify it you might want to check shlex : <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;shlex.html#module-shlex" rel="nofollow">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;shlex.html#module-shlex</a></div><br/></div></div><div id="41136672" class="c"><input type="checkbox" id="c-41136672" checked=""/><div class="controls bullet"><span class="by">koiueo</span><span>|</span><a href="#41135080">parent</a><span>|</span><a href="#41136195">prev</a><span>|</span><label class="collapse" for="c-41136672">[-]</label><label class="expand" for="c-41136672">[1 more]</label></div><br/><div class="children"><div class="content">I like the in_term trick</div><br/></div></div></div></div></div></div></div></div></div></body></html>