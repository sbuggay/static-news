<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1702198857130" as="style"/><link rel="stylesheet" href="styles.css?v=1702198857130"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://tmpout.sh/3/22.html">Cramming a tiny program into a tiny ELF file</a> <span class="domain">(<a href="https://tmpout.sh">tmpout.sh</a>)</span></div><div class="subtext"><span>matt_d</span> | <span>9 comments</span></div><br/><div><div id="38590130" class="c"><input type="checkbox" id="c-38590130" checked=""/><div class="controls bullet"><span class="by">spockz</span><span>|</span><a href="#38588601">next</a><span>|</span><label class="collapse" for="c-38590130">[-]</label><label class="expand" for="c-38590130">[1 more]</label></div><br/><div class="children"><div class="content">Love the content but one snag about the site itself. On iOS by default there is a big black void to the right and the text is constrained to the left 2&#x2F;3 of the screen. That would be okay but somehow the safari feature to double tap on a paragraph and get it fitted to the viewing page is broken as well.</div><br/></div></div><div id="38588601" class="c"><input type="checkbox" id="c-38588601" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#38590130">prev</a><span>|</span><a href="#38589582">next</a><span>|</span><label class="collapse" for="c-38588601">[-]</label><label class="expand" for="c-38588601">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;m surprised to see this little article of mine on the front page! If anyone has any questions about it, feel free to ask.<p>Also, if you&#x27;re interested in more ELF shenanegans, check out the rest of tmp.0ut #3 [0]; the other authors have been working on some really neat stuff!<p>[0] <a href="https:&#x2F;&#x2F;tmpout.sh&#x2F;3&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;tmpout.sh&#x2F;3&#x2F;</a></div><br/><div id="38589063" class="c"><input type="checkbox" id="c-38589063" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#38588601">parent</a><span>|</span><a href="#38589035">next</a><span>|</span><label class="collapse" for="c-38589063">[-]</label><label class="expand" for="c-38589063">[2 more]</label></div><br/><div class="children"><div class="content">Did you consider doing multiple calls to `write` instead reassembling the string?<p>I wonder if that&#x27;s enough bytes that implementing a tiny interpreter would work; certainly it would win for slightly larger sizes (say, 4KiB).</div><br/><div id="38589413" class="c"><input type="checkbox" id="c-38589413" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#38588601">root</a><span>|</span><a href="#38589063">parent</a><span>|</span><a href="#38589035">next</a><span>|</span><label class="collapse" for="c-38589413">[-]</label><label class="expand" for="c-38589413">[1 more]</label></div><br/><div class="children"><div class="content">I did consider that (as well as using writev), but the problem is that every syscall overwrites the number in eax with the return value, so we&#x27;d need more logic to reset it to __NR_write twice before setting it to __NR_exit_group. Also, the two parts have two different lengths that we&#x27;d have to store in rdx. (Unless we split it into 7+7 bytes, I suppose, but that would waste a perfectly good byte at offset 0xb.) Ultimately, more than 1-2 small instructions of extra logic simply aren&#x27;t worth it at this scale, unless we can balance it out with fewer bytes of control flow.<p>Meanwhile, you&#x27;re right that an ad-hoc interpreter will always be the answer for larger sizes. (It&#x27;s very common in regular sizecoding to use a compressed executable with some code to unpack itself.) But since there simply isn&#x27;t enough space here for complex logic, our only remaining avenue is to make the bytes work double and triple duty, whether through &quot;Ouroboros Programming&quot; or through regular subroutines. And of course, these kinds of techniques remain important when golfing the interpreter&#x2F;decompressor itself, which has to be rooted in bare machine code.</div><br/></div></div></div></div><div id="38589035" class="c"><input type="checkbox" id="c-38589035" checked=""/><div class="controls bullet"><span class="by">tomcam</span><span>|</span><a href="#38588601">parent</a><span>|</span><a href="#38589063">prev</a><span>|</span><a href="#38588758">next</a><span>|</span><label class="collapse" for="c-38589035">[-]</label><label class="expand" for="c-38589035">[2 more]</label></div><br/><div class="children"><div class="content">Great article. What is the meaning of code like this? The jmp instruction seems necessary.<p><pre><code>    jmp 0x14
    0x14:</code></pre></div><br/><div id="38589228" class="c"><input type="checkbox" id="c-38589228" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#38588601">root</a><span>|</span><a href="#38589035">parent</a><span>|</span><a href="#38588758">next</a><span>|</span><label class="collapse" for="c-38589228">[-]</label><label class="expand" for="c-38589228">[1 more]</label></div><br/><div class="children"><div class="content">In the instruction listings, I&#x27;ve omitted all the data between the basic blocks, and reordered&#x2F;repeated the blocks to emphasize the control flow. In that particular case, there are actually four bytes, 03 00 3e 00, between the jump and the label. In fact, it&#x27;s not actually necessary to use a 2-byte &#x27;jmp&#x27; to skip past that data, but golfing it further doesn&#x27;t matter, since it&#x27;s already at the minimum size for the 80-byte pattern with an undivided string.</div><br/></div></div></div></div><div id="38588758" class="c"><input type="checkbox" id="c-38588758" checked=""/><div class="controls bullet"><span class="by">upon_drumhead</span><span>|</span><a href="#38588601">parent</a><span>|</span><a href="#38589035">prev</a><span>|</span><a href="#38589582">next</a><span>|</span><label class="collapse" for="c-38588758">[-]</label><label class="expand" for="c-38588758">[1 more]</label></div><br/><div class="children"><div class="content">Amazing work and a very entertaining read. Thank you for sharing!</div><br/></div></div></div></div><div id="38589582" class="c"><input type="checkbox" id="c-38589582" checked=""/><div class="controls bullet"><span class="by">EGreg</span><span>|</span><a href="#38588601">prev</a><span>|</span><label class="collapse" for="c-38589582">[-]</label><label class="expand" for="c-38589582">[1 more]</label></div><br/><div class="children"><div class="content">So… like an ELF on the shelf? :)</div><br/></div></div></div></div></div></div></div></body></html>