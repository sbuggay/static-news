<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1692867663432" as="style"/><link rel="stylesheet" href="styles.css?v=1692867663432"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blogs.oracle.com/javamagazine/post/java-array-objects">Inside the JVM: Arrays</a> <span class="domain">(<a href="https://blogs.oracle.com">blogs.oracle.com</a>)</span></div><div class="subtext"><span>ternaryoperator</span> | <span>26 comments</span></div><br/><div><div id="37246204" class="c"><input type="checkbox" id="c-37246204" checked=""/><div class="controls bullet"><span class="by">SeanLuke</span><span>|</span><a href="#37246256">next</a><span>|</span><label class="collapse" for="c-37246204">[-]</label><label class="expand" for="c-37246204">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Another curiosity of Java arrays is that they can have a size of zero.<p>&gt; This code will not result in an error message. This surprising feature is used primarily by code generators, which might create an array and then discover there are no values to place in it.<p>What? How can someone at Oracle have written this?<p>Zero-length arrays are used all the time when you call a function asking for an array of &quot;the latest stuff&quot; and it needs to be an array, not an ArrayList say (maybe it&#x27;s an array of bytes).  If there&#x27;s no stuff, you get a zero-length array of course.  The myriad foo.toArray(...) functions in Java&#x27;s library do this for example.</div><br/><div id="37246258" class="c"><input type="checkbox" id="c-37246258" checked=""/><div class="controls bullet"><span class="by">adrianmsmith</span><span>|</span><a href="#37246204">parent</a><span>|</span><a href="#37246490">next</a><span>|</span><label class="collapse" for="c-37246258">[-]</label><label class="expand" for="c-37246258">[1 more]</label></div><br/><div class="children"><div class="content">Right, and<p>&gt; create an array and then discover there are no values to place in it.<p>I mean you can&#x27;t change the size of an array after you&#x27;ve created it, so if you create an array with a certain size intending to put values in it, then discover there aren&#x27;t any values, you&#x27;ve still got a non-zero size array...</div><br/></div></div><div id="37246490" class="c"><input type="checkbox" id="c-37246490" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#37246204">parent</a><span>|</span><a href="#37246258">prev</a><span>|</span><a href="#37246256">next</a><span>|</span><label class="collapse" for="c-37246490">[-]</label><label class="expand" for="c-37246490">[1 more]</label></div><br/><div class="children"><div class="content">This choice probably pre-dates Oracle?</div><br/></div></div></div></div><div id="37246256" class="c"><input type="checkbox" id="c-37246256" checked=""/><div class="controls bullet"><span class="by">SeanLuke</span><span>|</span><a href="#37246204">prev</a><span>|</span><a href="#37246185">next</a><span>|</span><label class="collapse" for="c-37246256">[-]</label><label class="expand" for="c-37246256">[5 more]</label></div><br/><div class="children"><div class="content">I was pretty disappointed that, for a blog called &quot;Inside the JVM&quot;, very little in the blog entry discussed goings on inside the JVM.  For example, when does the JVM typically optimize away bounds or null checks?  How are arrays of booleans packed and what is their efficiency compared to arrays of bytes or words?</div><br/><div id="37246553" class="c"><input type="checkbox" id="c-37246553" checked=""/><div class="controls bullet"><span class="by">wolf550e</span><span>|</span><a href="#37246256">parent</a><span>|</span><a href="#37246356">next</a><span>|</span><label class="collapse" for="c-37246553">[-]</label><label class="expand" for="c-37246553">[1 more]</label></div><br/><div class="children"><div class="content">You want something like <a href="https:&#x2F;&#x2F;shipilev.net&#x2F;jvm&#x2F;anatomy-quarks&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;shipilev.net&#x2F;jvm&#x2F;anatomy-quarks&#x2F;</a> (the author is a jvm maintainer, formerly at redhat now at aws).</div><br/></div></div><div id="37246356" class="c"><input type="checkbox" id="c-37246356" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#37246256">parent</a><span>|</span><a href="#37246553">prev</a><span>|</span><a href="#37246185">next</a><span>|</span><label class="collapse" for="c-37246356">[-]</label><label class="expand" for="c-37246356">[3 more]</label></div><br/><div class="children"><div class="content">For that you need an Inside Hotspot, Inside OpenJ9, Inside GraalVM, Inside Azul, Inside ART, Inside microEJ, Inside PTC, Inside JamaicaVM, Inside....<p>Otherwise is like trying to discuss what does a C compiler do, when only looking through the lens of the C abstract machine in ISO C.</div><br/><div id="37246405" class="c"><input type="checkbox" id="c-37246405" checked=""/><div class="controls bullet"><span class="by">SeanLuke</span><span>|</span><a href="#37246256">root</a><span>|</span><a href="#37246356">parent</a><span>|</span><a href="#37246185">next</a><span>|</span><label class="collapse" for="c-37246405">[-]</label><label class="expand" for="c-37246405">[2 more]</label></div><br/><div class="children"><div class="content">This is an Oracle blog, and it&#x27;s called &quot;Inside the JVM&quot;.  What VMs do Oracle build besides Hotspot and its ilk?</div><br/><div id="37246427" class="c"><input type="checkbox" id="c-37246427" checked=""/><div class="controls bullet"><span class="by">stefs</span><span>|</span><a href="#37246256">root</a><span>|</span><a href="#37246405">parent</a><span>|</span><a href="#37246185">next</a><span>|</span><label class="collapse" for="c-37246427">[-]</label><label class="expand" for="c-37246427">[1 more]</label></div><br/><div class="children"><div class="content">as far as i know, graalvm is also an oracle project</div><br/></div></div></div></div></div></div></div></div><div id="37246185" class="c"><input type="checkbox" id="c-37246185" checked=""/><div class="controls bullet"><span class="by">awelxtr</span><span>|</span><a href="#37246256">prev</a><span>|</span><a href="#37246192">next</a><span>|</span><label class="collapse" for="c-37246185">[-]</label><label class="expand" for="c-37246185">[3 more]</label></div><br/><div class="children"><div class="content">&gt; (Note that the comma after the last value is accepted in Java and won’t cause an error.)<p>Why have I been 15 years programming in Java and I discovered this today?<p>On a more serious note, I prefer this kinds of posts to the traditional &quot;Look at this shiny new thing&quot; because without fundamental stuff the next big thing can&#x27;t be built and normally this information makes you a slightly better programmer.</div><br/><div id="37246273" class="c"><input type="checkbox" id="c-37246273" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#37246185">parent</a><span>|</span><a href="#37246192">next</a><span>|</span><label class="collapse" for="c-37246273">[-]</label><label class="expand" for="c-37246273">[2 more]</label></div><br/><div class="children"><div class="content">I believe that comma thing was added recently.</div><br/><div id="37246329" class="c"><input type="checkbox" id="c-37246329" checked=""/><div class="controls bullet"><span class="by">awelxtr</span><span>|</span><a href="#37246185">root</a><span>|</span><a href="#37246273">parent</a><span>|</span><a href="#37246192">next</a><span>|</span><label class="collapse" for="c-37246329">[-]</label><label class="expand" for="c-37246329">[1 more]</label></div><br/><div class="children"><div class="content">Yup, as recent as 1996:<p>&quot;A trailing comma may appear after the last expression in an array initializer and is ignored&quot;<p><a href="https:&#x2F;&#x2F;titanium.cs.berkeley.edu&#x2F;doc&#x2F;java-langspec-1.0&#x2F;10.doc.html#11358" rel="nofollow noreferrer">https:&#x2F;&#x2F;titanium.cs.berkeley.edu&#x2F;doc&#x2F;java-langspec-1.0&#x2F;10.do...</a></div><br/></div></div></div></div></div></div><div id="37246192" class="c"><input type="checkbox" id="c-37246192" checked=""/><div class="controls bullet"><span class="by">alex3305</span><span>|</span><a href="#37246185">prev</a><span>|</span><a href="#37246191">next</a><span>|</span><label class="collapse" for="c-37246192">[-]</label><label class="expand" for="c-37246192">[3 more]</label></div><br/><div class="children"><div class="content">In my experience, just a little bit of insider knowledge goes a long ways to making better code. Arrays are fun things, especially when you do a deep dive into the System.arraycopy() function. But the same goes for all Collections in Java. For instance, most of them have a default size (mostly 10), and growing them is a costly operation. So knowing beforehand how large your collection can or may be, can benefit code. I could use this effectively when working with large document XML parsing.<p>I recommend everyone that uses a managed language (Java, C# or others) to at least get a basic understanding of these fundamentals. And also know which collection type to use when.</div><br/><div id="37246375" class="c"><input type="checkbox" id="c-37246375" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#37246192">parent</a><span>|</span><a href="#37246252">next</a><span>|</span><label class="collapse" for="c-37246375">[-]</label><label class="expand" for="c-37246375">[1 more]</label></div><br/><div class="children"><div class="content">I cringe every single time I see a for loop for what System.arraycopy () has been providing since early days.<p>For better or worse, it shows me that the author isn&#x27;t that into Java.</div><br/></div></div><div id="37246252" class="c"><input type="checkbox" id="c-37246252" checked=""/><div class="controls bullet"><span class="by">dkwr</span><span>|</span><a href="#37246192">parent</a><span>|</span><a href="#37246375">prev</a><span>|</span><a href="#37246191">next</a><span>|</span><label class="collapse" for="c-37246252">[-]</label><label class="expand" for="c-37246252">[1 more]</label></div><br/><div class="children"><div class="content">I agree. Understanding the inner working of languages and their runtimes is IMHO what gets you one step closer to a senior. Luckily, I had in my young career few seniors in the team who knew a lot about Java and shared their knowledge about the behavior.</div><br/></div></div></div></div><div id="37246191" class="c"><input type="checkbox" id="c-37246191" checked=""/><div class="controls bullet"><span class="by">Pannoniae</span><span>|</span><a href="#37246192">prev</a><span>|</span><a href="#37246245">next</a><span>|</span><label class="collapse" for="c-37246191">[-]</label><label class="expand" for="c-37246191">[7 more]</label></div><br/><div class="children"><div class="content">What are the advantages of representing multidimensional arrays with pointers to arrays instead of a &quot;flat&quot; version where everything is stored contiguously and access is simply pointer arithmetic?<p>EDIT: For the JVM, not manually. I&#x27;m asking about the internal representation, not a manual flattening by the user.</div><br/><div id="37246284" class="c"><input type="checkbox" id="c-37246284" checked=""/><div class="controls bullet"><span class="by">SeanLuke</span><span>|</span><a href="#37246191">parent</a><span>|</span><a href="#37246404">next</a><span>|</span><label class="collapse" for="c-37246284">[-]</label><label class="expand" for="c-37246284">[1 more]</label></div><br/><div class="children"><div class="content">Ragged arrays.  You can do this:<p><pre><code>    int[][] x = new int[2][];
    x[0] = new int[] { 1, 2, 3 };
    x[1] = new int[] { 1, 2, 3, 4 };</code></pre></div><br/></div></div><div id="37246404" class="c"><input type="checkbox" id="c-37246404" checked=""/><div class="controls bullet"><span class="by">aardvark179</span><span>|</span><a href="#37246191">parent</a><span>|</span><a href="#37246284">prev</a><span>|</span><a href="#37246248">next</a><span>|</span><label class="collapse" for="c-37246404">[-]</label><label class="expand" for="c-37246404">[1 more]</label></div><br/><div class="children"><div class="content">The JVM doesn’t really have multidirectional arrays, it just has arrays with a type, and that type may itself be an array.<p>Sometimes that can be useful, and sometimes not.</div><br/></div></div><div id="37246248" class="c"><input type="checkbox" id="c-37246248" checked=""/><div class="controls bullet"><span class="by">awelxtr</span><span>|</span><a href="#37246191">parent</a><span>|</span><a href="#37246404">prev</a><span>|</span><a href="#37246245">next</a><span>|</span><label class="collapse" for="c-37246248">[-]</label><label class="expand" for="c-37246248">[4 more]</label></div><br/><div class="children"><div class="content">Maintenance, probably.<p>Puting data in a structure that mirrors the real thing normally helps when trying to understand it</div><br/><div id="37246267" class="c"><input type="checkbox" id="c-37246267" checked=""/><div class="controls bullet"><span class="by">Pannoniae</span><span>|</span><a href="#37246191">root</a><span>|</span><a href="#37246248">parent</a><span>|</span><a href="#37246245">next</a><span>|</span><label class="collapse" for="c-37246267">[-]</label><label class="expand" for="c-37246267">[3 more]</label></div><br/><div class="children"><div class="content">No, I mean for the JVM.... the interface could remain the same but the pointer indirections could be avoided. I don&#x27;t see the downsides, that&#x27;s why I&#x27;m asking.</div><br/><div id="37246550" class="c"><input type="checkbox" id="c-37246550" checked=""/><div class="controls bullet"><span class="by">alkonaut</span><span>|</span><a href="#37246191">root</a><span>|</span><a href="#37246267">parent</a><span>|</span><a href="#37246487">next</a><span>|</span><label class="collapse" for="c-37246550">[-]</label><label class="expand" for="c-37246550">[1 more]</label></div><br/><div class="children"><div class="content">It just means you don&#x27;t have to special case any particular scenario such as array-of-array, it&#x27;s no different than array-of-whatever. Also jagged arrays form a complication.<p>But even for the simple case of large non-jagged arrays: In the situation where you needed this perf gain as a developer you would still need to be able to specify the order e.g. row-major or column-major, since the VM won&#x27;t know your access pattern.<p>So if you make your own matrix class you would be better off storing a flat array yourself and doing the access arithmetic yourself like index = y*cols + x. It would be a pretty cumbersome API in Java if they had this in the declaration api and you declared double[100][100] how would you declare whether that 10k flat array is row major or column major? If the VM gets it wrong for your access pattern then a lot of the perf gain from fewer pointer indirections will be eaten by cache misses from looking in the wrong order.</div><br/></div></div><div id="37246487" class="c"><input type="checkbox" id="c-37246487" checked=""/><div class="controls bullet"><span class="by">tralarpa</span><span>|</span><a href="#37246191">root</a><span>|</span><a href="#37246267">parent</a><span>|</span><a href="#37246550">prev</a><span>|</span><a href="#37246245">next</a><span>|</span><label class="collapse" for="c-37246487">[-]</label><label class="expand" for="c-37246487">[1 more]</label></div><br/><div class="children"><div class="content">I guess it was just to simplify the original specification of the JVM (if two dimensional arrays are just arrays of arrays, you don&#x27;t need special instructions for them). I can also imagine that the original JVM designers did not expect JIT compilers to one day become so good that the performance difference becomes relevant.</div><br/></div></div></div></div></div></div></div></div><div id="37246245" class="c"><input type="checkbox" id="c-37246245" checked=""/><div class="controls bullet"><span class="by">eternalvoyage</span><span>|</span><a href="#37246191">prev</a><span>|</span><label class="collapse" for="c-37246245">[-]</label><label class="expand" for="c-37246245">[4 more]</label></div><br/><div class="children"><div class="content">Things I learned by reading this post<p>* Java arrays can have 0 dimensions<p>* When declaring arrays, trailing comma is allowed after the last element<p>* In multi-dimensional arrays, only the last dimension contains actual values. Other dimensions are just pointers to arrays.<p>Good read.</div><br/><div id="37246279" class="c"><input type="checkbox" id="c-37246279" checked=""/><div class="controls bullet"><span class="by">adrianmsmith</span><span>|</span><a href="#37246245">parent</a><span>|</span><a href="#37246265">next</a><span>|</span><label class="collapse" for="c-37246279">[-]</label><label class="expand" for="c-37246279">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Java arrays can have 0 dimensions<p>The way you&#x27;ve phrased it is a bit ambiguous.<p>Having 0 dimension sounds like<p><pre><code>    x = new int[7][5]; &#x2F;&#x2F; 2 dimensions
    y = new int[9];    &#x2F;&#x2F; 1 dimension
    z = new int;       &#x2F;&#x2F; no dimensions, not an array, not allowed
</code></pre>
The phrasing you mean is &quot;dimensions can have zero size&quot;.</div><br/><div id="37246346" class="c"><input type="checkbox" id="c-37246346" checked=""/><div class="controls bullet"><span class="by">eternalvoyage</span><span>|</span><a href="#37246245">root</a><span>|</span><a href="#37246279">parent</a><span>|</span><a href="#37246265">next</a><span>|</span><label class="collapse" for="c-37246346">[-]</label><label class="expand" for="c-37246346">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the clarification.</div><br/></div></div></div></div><div id="37246265" class="c"><input type="checkbox" id="c-37246265" checked=""/><div class="controls bullet"><span class="by">SeanLuke</span><span>|</span><a href="#37246245">parent</a><span>|</span><a href="#37246279">prev</a><span>|</span><label class="collapse" for="c-37246265">[-]</label><label class="expand" for="c-37246265">[1 more]</label></div><br/><div class="children"><div class="content">Arrays cannot have zero dimensions.  They can have zero-sized dimensions.</div><br/></div></div></div></div></div></div></div></div></div></body></html>