<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1717837263418" as="style"/><link rel="stylesheet" href="styles.css?v=1717837263418"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/rustcoreutils/posixutils-rs/tree/main/calc/src">Memory-safe, clean implementation of classic Posix &quot;BC&quot; calculator</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>jgarzik</span> | <span>25 comments</span></div><br/><div><div id="40615576" class="c"><input type="checkbox" id="c-40615576" checked=""/><div class="controls bullet"><span class="by">teo_zero</span><span>|</span><a href="#40615139">next</a><span>|</span><label class="collapse" for="c-40615576">[-]</label><label class="expand" for="c-40615576">[6 more]</label></div><br/><div class="children"><div class="content">Am I the only one who thinks we need less short-lived tools written in memory-safe languages an more system infrastructure written in said languages?<p>Don&#x27;t take me wrong, I like when someone creates a better version of something existing. For example, ripgrep is fantastic. But seeing the recent trend of rewriting whatever in Rust just because, I can&#x27;t help wondering why I should bother whether bc leaks or not...</div><br/><div id="40615734" class="c"><input type="checkbox" id="c-40615734" checked=""/><div class="controls bullet"><span class="by">uecker</span><span>|</span><a href="#40615576">parent</a><span>|</span><a href="#40615951">next</a><span>|</span><label class="collapse" for="c-40615734">[-]</label><label class="expand" for="c-40615734">[3 more]</label></div><br/><div class="children"><div class="content">Rust does not guarantee absence of memory leaks, does it?<p>I think this is the general &quot;rewriting solves all problems&quot; fallacy, which is rarely true, but who wants to maintain existing code, if there is something new and cool? So we get rewrites which largely just add new projects that then have to be maintained in parallel, because they rarely are to completely replace the old (if at all) and at some point the new is not cool anymore and that it is just another thing. I like some key ideas of Rust, but overall I still like many things about C much more (stability, fast compile times, simplicity), so I would much prefer people improving memory safety in C projects.</div><br/><div id="40616053" class="c"><input type="checkbox" id="c-40616053" checked=""/><div class="controls bullet"><span class="by">ilius2</span><span>|</span><a href="#40615576">root</a><span>|</span><a href="#40615734">parent</a><span>|</span><a href="#40615951">next</a><span>|</span><label class="collapse" for="c-40616053">[-]</label><label class="expand" for="c-40616053">[2 more]</label></div><br/><div class="children"><div class="content">I like Zig&#x27;s approach much more than Rust. When you get fixated on one aspect and sacrifice everything for that, you get things like Perl, Java or Rust.</div><br/><div id="40616164" class="c"><input type="checkbox" id="c-40616164" checked=""/><div class="controls bullet"><span class="by">tialaramex</span><span>|</span><a href="#40615576">root</a><span>|</span><a href="#40616053">parent</a><span>|</span><a href="#40615951">next</a><span>|</span><label class="collapse" for="c-40616164">[-]</label><label class="expand" for="c-40616164">[1 more]</label></div><br/><div class="children"><div class="content">So, massive success ?</div><br/></div></div></div></div></div></div><div id="40615951" class="c"><input type="checkbox" id="c-40615951" checked=""/><div class="controls bullet"><span class="by">nineteen999</span><span>|</span><a href="#40615576">parent</a><span>|</span><a href="#40615734">prev</a><span>|</span><a href="#40615139">next</a><span>|</span><label class="collapse" for="c-40615951">[-]</label><label class="expand" for="c-40615951">[2 more]</label></div><br/><div class="children"><div class="content">Maybe we are not seeing rewrites of large OSS projects in Rust yet (eg. Linux kernel, Blender, LibreOffice) because the language is not (yet) ready for projects of that scale and complexity.</div><br/><div id="40615972" class="c"><input type="checkbox" id="c-40615972" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#40615576">root</a><span>|</span><a href="#40615951">parent</a><span>|</span><a href="#40615139">next</a><span>|</span><label class="collapse" for="c-40615972">[-]</label><label class="expand" for="c-40615972">[1 more]</label></div><br/><div class="children"><div class="content">What is the lack of a Rust equivalent to all those projects is because they already exist and work well, and Rust programmers aren&#x27;t as mad to rewrite things as the stereotype suggests?</div><br/></div></div></div></div></div></div><div id="40615139" class="c"><input type="checkbox" id="c-40615139" checked=""/><div class="controls bullet"><span class="by">downvotetruth</span><span>|</span><a href="#40615576">prev</a><span>|</span><a href="#40615680">next</a><span>|</span><label class="collapse" for="c-40615139">[-]</label><label class="expand" for="c-40615139">[4 more]</label></div><br/><div class="children"><div class="content">Lost as to why there is a tests folder yet the test function marked with the #[test] attribute is being added to &#x2F;src: <a href="https:&#x2F;&#x2F;github.com&#x2F;rustcoreutils&#x2F;posixutils-rs&#x2F;pull&#x2F;132&#x2F;commits&#x2F;dd9f9531b48171f9417685b8a9440180fd39a985#diff-399ef6729038be6ed4b917820c57c591b487d20593f93b70428976bd0072dc67">https:&#x2F;&#x2F;github.com&#x2F;rustcoreutils&#x2F;posixutils-rs&#x2F;pull&#x2F;132&#x2F;comm...</a> edit: Since the change was to the grammar saved in a separate .pest file, which is separated from the procedural code, then would that make the test an integration rather than a unit test as the &quot;parse_program&quot; function is public?</div><br/><div id="40615819" class="c"><input type="checkbox" id="c-40615819" checked=""/><div class="controls bullet"><span class="by">boustrophedon</span><span>|</span><a href="#40615139">parent</a><span>|</span><a href="#40615160">next</a><span>|</span><label class="collapse" for="c-40615819">[-]</label><label class="expand" for="c-40615819">[1 more]</label></div><br/><div class="children"><div class="content">The `parse_program` function is public inside the `bc_util::parser` module, and the parser module is marked public inside `bc_util`, but in the `calc&#x2F;src&#x2F;bc.rs` file the `bc_util` mod isn&#x27;t public, and can&#x27;t be accessed from a test inside the `tests&#x2F;` folder, which only has access to the public API exported by the library.</div><br/></div></div><div id="40615160" class="c"><input type="checkbox" id="c-40615160" checked=""/><div class="controls bullet"><span class="by">Cyph0n</span><span>|</span><a href="#40615139">parent</a><span>|</span><a href="#40615819">prev</a><span>|</span><a href="#40615680">next</a><span>|</span><label class="collapse" for="c-40615160">[-]</label><label class="expand" for="c-40615160">[2 more]</label></div><br/><div class="children"><div class="content">In Rust, unit tests are marked using the #[test] attribute and typically live alongside the code under test.<p>Integration tests live under a top-level “tests” folder - in this case, you’ll see that the “tests” directory contains test that call the CLI command and verify its output.<p>See: <a href="https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;book&#x2F;ch11-03-test-organization.html" rel="nofollow">https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;book&#x2F;ch11-03-test-organization.htm...</a></div><br/></div></div></div></div><div id="40615680" class="c"><input type="checkbox" id="c-40615680" checked=""/><div class="controls bullet"><span class="by">uecker</span><span>|</span><a href="#40615139">prev</a><span>|</span><a href="#40615321">next</a><span>|</span><label class="collapse" for="c-40615680">[-]</label><label class="expand" for="c-40615680">[6 more]</label></div><br/><div class="children"><div class="content">I am still waiting for Rust people to do something new and innovative. I acknowledge that Rust itself is innovative, don&#x27;t get me wrong, But where are the true proof-of-concept projects such as the Linux kernel, qemu, git, postgresql, vim, etc. of the Rust world?  Rewriting code is a waste of time of time, fragments the eco system, and introduces new bugs.  And with a new focus on memory safety and analysis tools and sanitizers evolving, a lot of C code will be made memory safe in the future without needing a rewrite in Rust.</div><br/><div id="40615727" class="c"><input type="checkbox" id="c-40615727" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#40615680">parent</a><span>|</span><a href="#40615691">next</a><span>|</span><label class="collapse" for="c-40615727">[-]</label><label class="expand" for="c-40615727">[3 more]</label></div><br/><div class="children"><div class="content">There&#x27;s tons of stuff of the kind you&#x27;re describing in Rust, more than I care to list but I&#x27;ll offer you some [1-3] that I think would interest you (based on this comment alone). If your perception of what people are doing in Rust is driven by what people post to HN, it may not reflect everything that is going on in that ecosystem.<p>[1] <a href="https:&#x2F;&#x2F;os.phil-opp.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;os.phil-opp.com&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;gitlab.redox-os.org&#x2F;redox-os&#x2F;redox" rel="nofollow">https:&#x2F;&#x2F;gitlab.redox-os.org&#x2F;redox-os&#x2F;redox</a><p>[3] <a href="https:&#x2F;&#x2F;oxide.computer&#x2F;" rel="nofollow">https:&#x2F;&#x2F;oxide.computer&#x2F;</a></div><br/><div id="40615823" class="c"><input type="checkbox" id="c-40615823" checked=""/><div class="controls bullet"><span class="by">uecker</span><span>|</span><a href="#40615680">root</a><span>|</span><a href="#40615727">parent</a><span>|</span><a href="#40615691">next</a><span>|</span><label class="collapse" for="c-40615823">[-]</label><label class="expand" for="c-40615823">[2 more]</label></div><br/><div class="children"><div class="content">Fair enough, I may not have the full picture. But &quot;writing an OS in Rust&quot; sounds also seems the &quot;innovative&quot; part is that something is written in Rust. I do not need a new OS in written in a different language. I could use a good open-source CAD tool, or a good open-source FPGA tool chain (maybe those exist, I need to do some research). A language and projects written in it do not impress me if its own novelty is the selling point, but if the language can be used to solve problem I have. But yes, maybe those projects do exist somewhere...</div><br/><div id="40615903" class="c"><input type="checkbox" id="c-40615903" checked=""/><div class="controls bullet"><span class="by">freeone3000</span><span>|</span><a href="#40615680">root</a><span>|</span><a href="#40615823">parent</a><span>|</span><a href="#40615691">next</a><span>|</span><label class="collapse" for="c-40615903">[-]</label><label class="expand" for="c-40615903">[1 more]</label></div><br/><div class="children"><div class="content">You might be interested in <a href="https:&#x2F;&#x2F;mattferraro.dev&#x2F;posts&#x2F;cadmium" rel="nofollow">https:&#x2F;&#x2F;mattferraro.dev&#x2F;posts&#x2F;cadmium</a><p>People are building cool stuff, and happen to do it in Rust.</div><br/></div></div></div></div></div></div><div id="40615691" class="c"><input type="checkbox" id="c-40615691" checked=""/><div class="controls bullet"><span class="by">jonjojojon</span><span>|</span><a href="#40615680">parent</a><span>|</span><a href="#40615727">prev</a><span>|</span><a href="#40615321">next</a><span>|</span><label class="collapse" for="c-40615691">[-]</label><label class="expand" for="c-40615691">[2 more]</label></div><br/><div class="children"><div class="content">Aren&#x27;t most of the standalone wasm runtimes written in rust?</div><br/><div id="40615871" class="c"><input type="checkbox" id="c-40615871" checked=""/><div class="controls bullet"><span class="by">uecker</span><span>|</span><a href="#40615680">root</a><span>|</span><a href="#40615691">parent</a><span>|</span><a href="#40615321">next</a><span>|</span><label class="collapse" for="c-40615871">[-]</label><label class="expand" for="c-40615871">[1 more]</label></div><br/><div class="children"><div class="content">No idea, but according to this site: <a href="https:&#x2F;&#x2F;github.com&#x2F;appcypher&#x2F;awesome-wasm-runtimes">https:&#x2F;&#x2F;github.com&#x2F;appcypher&#x2F;awesome-wasm-runtimes</a> there a wasm runtimes written in all kinds of languages. This does not appear to be a very challenging thing to do, but I haven&#x27;t look at this closely.</div><br/></div></div></div></div></div></div><div id="40615321" class="c"><input type="checkbox" id="c-40615321" checked=""/><div class="controls bullet"><span class="by">gavinhoward</span><span>|</span><a href="#40615680">prev</a><span>|</span><a href="#40615487">next</a><span>|</span><label class="collapse" for="c-40615321">[-]</label><label class="expand" for="c-40615321">[3 more]</label></div><br/><div class="children"><div class="content">As the author of the default bc in macOS and FreeBSD, good luck.<p>Also, while mine is in C, I have tried very hard to eliminate all memory safety bugs, and I think I have done pretty well.<p><a href="https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;" rel="nofollow">https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;</a></div><br/><div id="40615423" class="c"><input type="checkbox" id="c-40615423" checked=""/><div class="controls bullet"><span class="by">c0wb0yc0d3r</span><span>|</span><a href="#40615321">parent</a><span>|</span><a href="#40615487">next</a><span>|</span><label class="collapse" for="c-40615423">[-]</label><label class="expand" for="c-40615423">[2 more]</label></div><br/><div class="children"><div class="content">&gt; good luck.<p>Do you see this as an unexpectedly challenging task? If so, what do you think makes it challenging?</div><br/><div id="40615435" class="c"><input type="checkbox" id="c-40615435" checked=""/><div class="controls bullet"><span class="by">gavinhoward</span><span>|</span><a href="#40615321">root</a><span>|</span><a href="#40615423">parent</a><span>|</span><a href="#40615487">next</a><span>|</span><label class="collapse" for="c-40615435">[-]</label><label class="expand" for="c-40615435">[1 more]</label></div><br/><div class="children"><div class="content">Not terribly challenging, but harder than expected.<p>The reason: parsing.<p>The bc language is poorly designed for a REPL, which it needs to handle.<p>I got sick of fixing parse bugs, though, and my source code got a sarcastic comment:  <a href="https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;src&#x2F;commit&#x2F;4b83bf07b97f65b53ffa53f37737b1ddce42dcde&#x2F;src&#x2F;bc_parse.c#L49" rel="nofollow">https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;src&#x2F;commit&#x2F;4b83bf07b97f...</a></div><br/></div></div></div></div></div></div><div id="40615487" class="c"><input type="checkbox" id="c-40615487" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#40615321">prev</a><span>|</span><a href="#40615072">next</a><span>|</span><label class="collapse" for="c-40615487">[-]</label><label class="expand" for="c-40615487">[4 more]</label></div><br/><div class="children"><div class="content"><i>bc</i>(1) is nice to have, but —for my purposes— less useful than <i>dc</i>(1), because it doesn&#x27;t generate arbitrary binary output.</div><br/><div id="40615574" class="c"><input type="checkbox" id="c-40615574" checked=""/><div class="controls bullet"><span class="by">gavinhoward</span><span>|</span><a href="#40615487">parent</a><span>|</span><a href="#40615654">next</a><span>|</span><label class="collapse" for="c-40615574">[-]</label><label class="expand" for="c-40615574">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re talking about the `P` command, I added an extension to my bc to do the same thing. It&#x27;s the `stream` statement.<p>But it&#x27;s probably still more convenient in dc.<p><a href="https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;" rel="nofollow">https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;</a></div><br/><div id="40615982" class="c"><input type="checkbox" id="c-40615982" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#40615487">root</a><span>|</span><a href="#40615574">parent</a><span>|</span><a href="#40615654">next</a><span>|</span><label class="collapse" for="c-40615982">[-]</label><label class="expand" for="c-40615982">[1 more]</label></div><br/><div class="children"><div class="content">Exactly; also nice to see <a href="https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;#ai-free" rel="nofollow">https:&#x2F;&#x2F;git.gavinhoward.com&#x2F;gavin&#x2F;bc&#x2F;#ai-free</a> .<p>Lagniappe: <i>6581840dnP</i></div><br/></div></div></div></div><div id="40615654" class="c"><input type="checkbox" id="c-40615654" checked=""/><div class="controls bullet"><span class="by">HobbitJack</span><span>|</span><a href="#40615487">parent</a><span>|</span><a href="#40615574">prev</a><span>|</span><a href="#40615072">next</a><span>|</span><label class="collapse" for="c-40615654">[-]</label><label class="expand" for="c-40615654">[1 more]</label></div><br/><div class="children"><div class="content">I prefer dc because I&#x27;m an HP calculator user... we&#x27;re not the same ^-^</div><br/></div></div></div></div><div id="40615072" class="c"><input type="checkbox" id="c-40615072" checked=""/><div class="controls bullet"><span class="by">scrubs</span><span>|</span><a href="#40615487">prev</a><span>|</span><label class="collapse" for="c-40615072">[-]</label><label class="expand" for="c-40615072">[1 more]</label></div><br/><div class="children"><div class="content">The title reminds me of the adds for &quot;Shen Yun China Before Communism&quot; which begs the question: ok what about life after communism ... where&#x27;s the song and dance show about that?<p>Similarly, if this is the memsafe bc, where&#x27;s the wow it leaks memory like a 1980s rock ballad bc code?<p>Hint: one has an answer, and the other has really never been on the radar safe or no.</div><br/></div></div></div></div></div></div></div></body></html>