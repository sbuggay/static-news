<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1684573246943" as="style"/><link rel="stylesheet" href="styles.css?v=1684573246943"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://axleos.com/writing-axles-gameboy-emulator/">I wrote a GameBoy emulator for my hobby OS (2022)</a> <span class="domain">(<a href="https://axleos.com">axleos.com</a>)</span></div><div class="subtext"><span>codyd51</span> | <span>20 comments</span></div><br/><div><div id="36009454" class="c"><input type="checkbox" id="c-36009454" checked=""/><div class="controls bullet"><span class="by">Andrex</span><span>|</span><a href="#36009446">next</a><span>|</span><label class="collapse" for="c-36009454">[-]</label><label class="expand" for="c-36009454">[1 more]</label></div><br/><div class="children"><div class="content">I always upvote everything GB-related on HN. Keep it coming!<p>GB Studio, upvote.<p>Cool people writing their own emus, upvote.<p>Analogue Pocket, upvote.<p>My sincere wish is that one day Nintendo somehow, someway, open up legitimate Game Boy publishing for third-parties again. Release the patents, allow developers the use of the Nintendo logo in the one very very specific place it&#x27;s necessary to allow GB games to boot, etc. Maybe open sourcing schematics and internal docs.<p>But that&#x27;s as likely as them releasing a (new) Mario game on PC...<p>For me, the GB is that perfect middle ground between too arcane&#x2F;simple and too modern&#x2F;complex (both the design of the games and in the programming required). If the platform were opened, it would be kind of a &quot;forever console.&quot; It would obviously not compete with new systems or anything like that, so it would always be pretty niche.<p>It would be a fantastic educational tool to get kids into programming and game design at various levels.<p>Maybe in another 20-30 years...</div><br/></div></div><div id="36009446" class="c"><input type="checkbox" id="c-36009446" checked=""/><div class="controls bullet"><span class="by">grishka</span><span>|</span><a href="#36009454">prev</a><span>|</span><a href="#36004561">next</a><span>|</span><label class="collapse" for="c-36009446">[-]</label><label class="expand" for="c-36009446">[1 more]</label></div><br/><div class="children"><div class="content">A few months ago I also built a GameBoy emulator with the intent of educating myself. It&#x27;s in Java and uses Swing for the GUI. It also supports sound but its implementation is definitely not ideal.<p>While most of the games I tested are playable, I couldn&#x27;t get SBC and ADC instructions to work correctly for all cases. I especially have no idea whatsoever how they&#x27;re supposed to affect the carry flags. Test ROMs aren&#x27;t very helpful either because the ones I used just ran the instruction with all possible combinations of input parameters, checksummed the results, compared the checksum to the expected value, and said &quot;duh, your thing is wrong&quot;. And Googling around wasn&#x27;t any more helpful. Since most of my childhood games ran fine anyway, I gave up. I&#x27;d still like to fix it eventually though.<p>That said, writing a video game system emulator is a tedious but rewarding experience. You just move bytes around and do an unhealthy amount of bit operations, and a game comes out. IMO every software developer should try writing an emulator at some point.</div><br/></div></div><div id="36004561" class="c"><input type="checkbox" id="c-36004561" checked=""/><div class="controls bullet"><span class="by">codyd51</span><span>|</span><a href="#36009446">prev</a><span>|</span><a href="#36008550">next</a><span>|</span><label class="collapse" for="c-36004561">[-]</label><label class="expand" for="c-36004561">[13 more]</label></div><br/><div class="children"><div class="content">Hi HN, author here! The GameBoy emulator written up in this post runs on axle, which is a message-passing microkernel-based OS I’ve been working on for a very long time. dang suggested that I put together a Show HN for axle, which I’d love to do once I have a bit more time to get things into a working-out-of-the-box state!<p>axle is a really fun project for me, and serves as the testing grounds for all kinds of technical experiments. The bore-you-with-features spiel goes something like: x86_64, SMP, UEFI bootloader, TTF rendering, compositing window manager, TCP&#x2F;IP stack, AHCI driver, custom assembler&#x2F;linker, and, of course, a GameBoy Emulator!<p>When working on axle, the level of yak shaving can get pretty extreme. For example, when I got around to writing axle’s first network card driver, I was puzzled when my driver could transmit packets fine, but failed to receive any packets. I dug around for quite a while before considering that it might be a QEMU bug, and tracked it all the way to macOS’s incomplete implementation of poll(), which QEMU was relying on! I ended up writing a patch for QEMU to work around it, and, several layers up, was finally able to progress on the network card driver and network stack. This was back in 2021, but I wrote up the journey recently here: <a href="https:&#x2F;&#x2F;axleos.com&#x2F;adding-vmnet-support-to-qemu&#x2F;" rel="nofollow">https:&#x2F;&#x2F;axleos.com&#x2F;adding-vmnet-support-to-qemu&#x2F;</a><p>axle was mostly C-based for a lot of its history, which can get pretty gnarly both in kernel-space and when trying to write higher-level productivity software in userspace. Recently, I’ve been writing a lot more of in Rust, but for the past couple of years that’s been confined to userspace only. When adding SMP support to the kernel, though, I added Rust to the kernel too. It’s really nice.<p>One other fun thing I’ve been working on semi-recently is a homegrown IDE with an assembler&#x2F;ELF-linker that runs under axle. I found the linker pretty difficult to get right, because a lot of the ELF data need to know the size and locations of other bits of data in the binary, and it’s tough to shake everything into place in a way that has serial data dependencies! It’s immensely gratifying, though, to write some assembly, generate an ELF at runtime, and execute it. I also added some process-monitoring hooks into the kernel while working on this, so the IDE application can monitor the output of the assembler&#x2F;linker, and show the output of the generated program, all within the GUI. I uploaded a quick demo video of this IDE here: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=YG9XyzSBUNg">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=YG9XyzSBUNg</a>. This whole shebang (IDE + assembler + linker&#x2F;ELF binary-packer) is written in Rust.<p>Thanks for reading — I hope you enjoy the post, and let me know if you have any questions!</div><br/><div id="36008657" class="c"><input type="checkbox" id="c-36008657" checked=""/><div class="controls bullet"><span class="by">qingcharles</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36010354">next</a><span>|</span><label class="collapse" for="c-36008657">[-]</label><label class="expand" for="c-36008657">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s funny - I remember doing pretty much the same thing. I wrote my own GUI OS from scratch in x86 based partially on the following book, in about 1998:
<a href="https:&#x2F;&#x2F;www.amazon.com&#x2F;Developing-32-Bit-Operating-System-Cd-Rom&#x2F;dp&#x2F;0672306557" rel="nofollow">https:&#x2F;&#x2F;www.amazon.com&#x2F;Developing-32-Bit-Operating-System-Cd...</a><p>And then wrote my own Game Gear emulator for it one night, just for shits and giggles, like you did. It was also my first attempt at writing a whole system emulator, and the GG, like the GB, was incredibly well understood even back then.<p>For anyone interested in emulation I think it is a great little project to write a video game emulator. It is enormously fun to watch one of your favorite video games boot up in code that you wrote. And it is fun (for me) to try and debug all the little glitches where you&#x27;ve made errors or omissions in your emulator.</div><br/><div id="36008895" class="c"><input type="checkbox" id="c-36008895" checked=""/><div class="controls bullet"><span class="by">bluedino</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36008657">parent</a><span>|</span><a href="#36010354">next</a><span>|</span><label class="collapse" for="c-36008895">[-]</label><label class="expand" for="c-36008895">[1 more]</label></div><br/><div class="children"><div class="content">SAMS used to come out with some great books.</div><br/></div></div></div></div><div id="36010354" class="c"><input type="checkbox" id="c-36010354" checked=""/><div class="controls bullet"><span class="by">bunnyfoofoo</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36008657">prev</a><span>|</span><a href="#36008905">next</a><span>|</span><label class="collapse" for="c-36010354">[-]</label><label class="expand" for="c-36010354">[1 more]</label></div><br/><div class="children"><div class="content">Great writeup! Any interest in finishing the article on the PPU? I&#x27;d love a good writeup on that.</div><br/></div></div><div id="36008905" class="c"><input type="checkbox" id="c-36008905" checked=""/><div class="controls bullet"><span class="by">RajT88</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36010354">prev</a><span>|</span><a href="#36008137">next</a><span>|</span><label class="collapse" for="c-36008905">[-]</label><label class="expand" for="c-36008905">[1 more]</label></div><br/><div class="children"><div class="content">I see posts like this and wonder: with the amount of coding necessary to write your own OS <i>and then</i> write a retro emulator for it, do you do anything else with your free time?<p>(Implicit question: are the rest of us just slackers?)</div><br/></div></div><div id="36008137" class="c"><input type="checkbox" id="c-36008137" checked=""/><div class="controls bullet"><span class="by">sen</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36008905">prev</a><span>|</span><a href="#36008820">next</a><span>|</span><label class="collapse" for="c-36008137">[-]</label><label class="expand" for="c-36008137">[3 more]</label></div><br/><div class="children"><div class="content">Despite it being so far behind my skill-set it’s not even funny, I absolutely love reading about custom made OSes, so I’m definitely keen to read a write-up on yours.</div><br/><div id="36008209" class="c"><input type="checkbox" id="c-36008209" checked=""/><div class="controls bullet"><span class="by">chucksmash</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36008137">parent</a><span>|</span><a href="#36009044">next</a><span>|</span><label class="collapse" for="c-36008209">[-]</label><label class="expand" for="c-36008209">[1 more]</label></div><br/><div class="children"><div class="content">If you are interested in it, you should dive in. Every OS ever written was written by someone for whom it was beyond their skillset at one point, everybody has to learn.</div><br/></div></div><div id="36009044" class="c"><input type="checkbox" id="c-36009044" checked=""/><div class="controls bullet"><span class="by">p1necone</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36008137">parent</a><span>|</span><a href="#36008209">prev</a><span>|</span><a href="#36008820">next</a><span>|</span><label class="collapse" for="c-36009044">[-]</label><label class="expand" for="c-36009044">[1 more]</label></div><br/><div class="children"><div class="content">Writing an OS <i>sounds</i> like a herculean task, but (depending on feature set) it can actually be a fairly simple thing to get started on.</div><br/></div></div></div></div><div id="36008820" class="c"><input type="checkbox" id="c-36008820" checked=""/><div class="controls bullet"><span class="by">mysterydip</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36008137">prev</a><span>|</span><a href="#36008406">next</a><span>|</span><label class="collapse" for="c-36008820">[-]</label><label class="expand" for="c-36008820">[4 more]</label></div><br/><div class="children"><div class="content">At first I misunderstood the title, thinking that for your hobby OS you targeted gameboy hardware. Makes me wonder what would be the first game console you could really make a usable GUI OS on.</div><br/><div id="36009037" class="c"><input type="checkbox" id="c-36009037" checked=""/><div class="controls bullet"><span class="by">bdw5204</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36008820">parent</a><span>|</span><a href="#36008406">next</a><span>|</span><label class="collapse" for="c-36009037">[-]</label><label class="expand" for="c-36009037">[3 more]</label></div><br/><div class="children"><div class="content">I had guessed 3DO but a Google search turned up an article about one for the NES. I don&#x27;t know if it qualifies as &quot;usable&quot; though because it can only run a word processor that supports 8 files containing a screen each of text.<p><a href="https:&#x2F;&#x2F;hackaday.com&#x2F;2022&#x2F;09&#x2F;28&#x2F;the-nes-gets-its-own-os&#x2F;" rel="nofollow">https:&#x2F;&#x2F;hackaday.com&#x2F;2022&#x2F;09&#x2F;28&#x2F;the-nes-gets-its-own-os&#x2F;</a></div><br/><div id="36009364" class="c"><input type="checkbox" id="c-36009364" checked=""/><div class="controls bullet"><span class="by">glhaynes</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36009037">parent</a><span>|</span><a href="#36008406">next</a><span>|</span><label class="collapse" for="c-36009364">[-]</label><label class="expand" for="c-36009364">[2 more]</label></div><br/><div class="children"><div class="content">The limiting factor for old consoles is largely RAM. The NES only had 2 KiB of RAM, making it pretty infeasible to even run anything CP&#x2F;M-like. Its 6502 CPU also doesn’t have things like privilege levels&#x2F;memory protection.<p>Moving up to the Sega Genesis with its 16-bit 68000 that many old UNIX systems were built around: it still only has 64 KiB. But, hey, that’s a lot better than 2 KiB, and it has memory protection. But the 68000 can’t do virtual memory (unassisted) and I don’t believe the Genesis has a timer interrupt, which seems like it’d complicate multitasking (I guess you could run the scheduler when the graphics system raises the vertical retrace interrupt?) but IMO it’s about the minimum level that could run something like what we tend to think of today when we talk about an operating system.</div><br/><div id="36010163" class="c"><input type="checkbox" id="c-36010163" checked=""/><div class="controls bullet"><span class="by">sciolistse</span><span>|</span><a href="#36004561">root</a><span>|</span><a href="#36009364">parent</a><span>|</span><a href="#36008406">next</a><span>|</span><label class="collapse" for="c-36010163">[-]</label><label class="expand" for="c-36010163">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s true the NES has 2 KiB built-in RAM, but a cartridge can provide its own RAM. Some of the later cartridges (MMC5 for example) supported up to 128 KiB of extended RAM. There&#x27;s not really any limit to how far you could push that with a custom mapper.</div><br/></div></div></div></div></div></div></div></div><div id="36008406" class="c"><input type="checkbox" id="c-36008406" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#36004561">parent</a><span>|</span><a href="#36008820">prev</a><span>|</span><a href="#36008550">next</a><span>|</span><label class="collapse" for="c-36008406">[-]</label><label class="expand" for="c-36008406">[1 more]</label></div><br/><div class="children"><div class="content">A lot to digest there. Awesome stuff. Well done!</div><br/></div></div></div></div><div id="36008550" class="c"><input type="checkbox" id="c-36008550" checked=""/><div class="controls bullet"><span class="by">legendofbrando</span><span>|</span><a href="#36004561">prev</a><span>|</span><a href="#36009864">next</a><span>|</span><label class="collapse" for="c-36008550">[-]</label><label class="expand" for="c-36008550">[1 more]</label></div><br/><div class="children"><div class="content">This is light years beyond any coding ability I have and was deeply enjoyable to read.</div><br/></div></div><div id="36009864" class="c"><input type="checkbox" id="c-36009864" checked=""/><div class="controls bullet"><span class="by">DotaFan</span><span>|</span><a href="#36008550">prev</a><span>|</span><a href="#36008972">next</a><span>|</span><label class="collapse" for="c-36009864">[-]</label><label class="expand" for="c-36009864">[1 more]</label></div><br/><div class="children"><div class="content">Congratz OP, you persistence is admirable.</div><br/></div></div><div id="36008972" class="c"><input type="checkbox" id="c-36008972" checked=""/><div class="controls bullet"><span class="by">Gunax</span><span>|</span><a href="#36009864">prev</a><span>|</span><label class="collapse" for="c-36008972">[-]</label><label class="expand" for="c-36008972">[2 more]</label></div><br/><div class="children"><div class="content">About 10 years ago I tried to write a gameboy emulator based on a pdf document i found on the internet somewhere.<p>I ended up finding the documentation wrong in a handful of places, which made the project tedious. Did you find that document reliable?</div><br/><div id="36009038" class="c"><input type="checkbox" id="c-36009038" checked=""/><div class="controls bullet"><span class="by">throwaway202351</span><span>|</span><a href="#36008972">parent</a><span>|</span><label class="collapse" for="c-36009038">[-]</label><label class="expand" for="c-36009038">[1 more]</label></div><br/><div class="children"><div class="content">Not OP, but if you mean that ~200 page doc, it&#x27;s pretty good but has some issues and inaccuracies some places, but it might just be me. Some things like how carries are supposed to work in some edge cases, for example, but I think it was written under the assumption that the reader would be familiar with a standard Z80 chip.<p>Something else I noticed was that there were some specs that I guess the gameboy follows, but not exactly. For example with swapping pages, it&#x27;s supposed to take up to (I forget the actual numbers) 50 cycles, but the actual gameboy always finishes in exactly 38 cycles, and some games are written for that.<p>In the end, what worked for me was finding a working emulator that would output the registers&#x27; states every operation, and then making sure mine would match up with it.</div><br/></div></div></div></div></div></div></div></div></div></body></html>