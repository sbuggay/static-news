<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1685091693682" as="style"/><link rel="stylesheet" href="styles.css?v=1685091693682"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://dxuuu.xyz/sudo.html">Sudo and signal propagation</a>Â <span class="domain">(<a href="https://dxuuu.xyz">dxuuu.xyz</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>14 comments</span></div><br/><div><div id="36066100" class="c"><input type="checkbox" id="c-36066100" checked=""/><div class="controls bullet"><span class="by">jaybosamiya</span><span>|</span><a href="#36062244">next</a><span>|</span><label class="collapse" for="c-36066100">[-]</label><label class="expand" for="c-36066100">[1 more]</label></div><br/><div class="children"><div class="content">This reminds me of a bugfix [1] I added to nmap almost a decade ago, where runtime interaction was previously broken due to interaction with sudo and signal propagation. Was a fun rabbit-hole to figure out why the issue was happening.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;nmap&#x2F;nmap&#x2F;commit&#x2F;f2e162d2245679f420b40febd1e6da7c23efb166">https:&#x2F;&#x2F;github.com&#x2F;nmap&#x2F;nmap&#x2F;commit&#x2F;f2e162d2245679f420b40feb...</a></div><br/></div></div><div id="36062244" class="c"><input type="checkbox" id="c-36062244" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#36066100">prev</a><span>|</span><a href="#36079334">next</a><span>|</span><label class="collapse" for="c-36062244">[-]</label><label class="expand" for="c-36062244">[10 more]</label></div><br/><div class="children"><div class="content">ELI5, why is there a separate sudo process instead of sudo finishing by calling exec()?</div><br/><div id="36063121" class="c"><input type="checkbox" id="c-36063121" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#36062244">parent</a><span>|</span><a href="#36079334">next</a><span>|</span><label class="collapse" for="c-36063121">[-]</label><label class="expand" for="c-36063121">[9 more]</label></div><br/><div class="children"><div class="content">PAM changed everything, back in the 1990s.<p>* <a href="https:&#x2F;&#x2F;jdebp.uk&#x2F;FGA&#x2F;dont-abuse-su-for-dropping-privileges.html" rel="nofollow">https:&#x2F;&#x2F;jdebp.uk&#x2F;FGA&#x2F;dont-abuse-su-for-dropping-privileges.h...</a></div><br/><div id="36078044" class="c"><input type="checkbox" id="c-36078044" checked=""/><div class="controls bullet"><span class="by">tedunangst</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36063121">parent</a><span>|</span><a href="#36078195">next</a><span>|</span><label class="collapse" for="c-36078044">[-]</label><label class="expand" for="c-36078044">[2 more]</label></div><br/><div class="children"><div class="content">&gt; aside from a few hold-out BSDs and BSD-derived systems<p>One wonders if perhaps these systems weren&#x27;t on to something.</div><br/><div id="36078805" class="c"><input type="checkbox" id="c-36078805" checked=""/><div class="controls bullet"><span class="by">donio</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36078044">parent</a><span>|</span><a href="#36078195">next</a><span>|</span><label class="collapse" for="c-36078805">[-]</label><label class="expand" for="c-36078805">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s quite possible to build and use sudo without PAM support even on Linux, most distributions just tend to build everything in &quot;kitchen sink&quot; mode. If I remember right on Alpine it&#x27;s PAM-free by default so it doesn&#x27;t need to fork. On Gentoo it&#x27;s behind a USE flag.</div><br/></div></div></div></div><div id="36078195" class="c"><input type="checkbox" id="c-36078195" checked=""/><div class="controls bullet"><span class="by">garaetjjte</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36063121">parent</a><span>|</span><a href="#36078044">prev</a><span>|</span><a href="#36079046">next</a><span>|</span><label class="collapse" for="c-36078195">[-]</label><label class="expand" for="c-36078195">[4 more]</label></div><br/><div class="children"><div class="content">Requiring pam_close_session is just bad design - if it needs special cleanup, pam_open_session should grab process pidfd and spawn separate monitor process (or pass pidfd to existing daemon).</div><br/><div id="36080847" class="c"><input type="checkbox" id="c-36080847" checked=""/><div class="controls bullet"><span class="by">formerly_proven</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36078195">parent</a><span>|</span><a href="#36078787">next</a><span>|</span><label class="collapse" for="c-36080847">[-]</label><label class="expand" for="c-36080847">[2 more]</label></div><br/><div class="children"><div class="content">PAM predates pidfd by about 25 years or so, though it&#x27;s really weird how steadfastly unix heritage systems avoided handles for important things, resulting in race conditions and security issues all over the place.</div><br/><div id="36081531" class="c"><input type="checkbox" id="c-36081531" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36080847">parent</a><span>|</span><a href="#36078787">next</a><span>|</span><label class="collapse" for="c-36081531">[-]</label><label class="expand" for="c-36081531">[1 more]</label></div><br/><div class="children"><div class="content">Which is definitely what you want in your authentication subsystem.</div><br/></div></div></div></div><div id="36078787" class="c"><input type="checkbox" id="c-36078787" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36078195">parent</a><span>|</span><a href="#36080847">prev</a><span>|</span><a href="#36079046">next</a><span>|</span><label class="collapse" for="c-36078787">[-]</label><label class="expand" for="c-36078787">[1 more]</label></div><br/><div class="children"><div class="content">sudo is that monitor process, it&#x27;s the same with how containerd and podman work, it&#x27;s much much easier to babysit a process when you&#x27;re its parent.</div><br/></div></div></div></div><div id="36079046" class="c"><input type="checkbox" id="c-36079046" checked=""/><div class="controls bullet"><span class="by">jdiff</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36063121">parent</a><span>|</span><a href="#36078195">prev</a><span>|</span><a href="#36063597">next</a><span>|</span><label class="collapse" for="c-36079046">[-]</label><label class="expand" for="c-36079046">[1 more]</label></div><br/><div class="children"><div class="content">That seems like a disingenuous title, it&#x27;s not abusing su, that&#x27;s just one of the many things that tool was used for. That was never a bad practice, the tool just changed and pulled the rug out from under very many programs.</div><br/></div></div><div id="36063597" class="c"><input type="checkbox" id="c-36063597" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#36062244">root</a><span>|</span><a href="#36063121">parent</a><span>|</span><a href="#36079046">prev</a><span>|</span><a href="#36079334">next</a><span>|</span><label class="collapse" for="c-36063597">[-]</label><label class="expand" for="c-36063597">[1 more]</label></div><br/><div class="children"><div class="content">TL;DR: PAM requires session cleanup, which might require extra privileges.</div><br/></div></div></div></div></div></div><div id="36079334" class="c"><input type="checkbox" id="c-36079334" checked=""/><div class="controls bullet"><span class="by">skinney6</span><span>|</span><a href="#36062244">prev</a><span>|</span><label class="collapse" for="c-36079334">[-]</label><label class="expand" for="c-36079334">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t do a lot of bash scripting but is this common? Using sudo in a script? Seems weird to me. If the process needs root just run the script as root right?</div><br/><div id="36080458" class="c"><input type="checkbox" id="c-36080458" checked=""/><div class="controls bullet"><span class="by">k0k0r0</span><span>|</span><a href="#36079334">parent</a><span>|</span><label class="collapse" for="c-36080458">[-]</label><label class="expand" for="c-36080458">[1 more]</label></div><br/><div class="children"><div class="content">If the whole script is run with sudo, then all parts of the script that wouldn&#x27;t have needed suddenly become dangerous.</div><br/></div></div></div></div></div></div></div></div></div></body></html>