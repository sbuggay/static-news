<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1715072455713" as="style"/><link rel="stylesheet" href="styles.css?v=1715072455713"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.leviathansecurity.com/blog/tunnelvision">Attackers can decloak routing-based VPNs</a> <span class="domain">(<a href="https://www.leviathansecurity.com">www.leviathansecurity.com</a>)</span></div><div class="subtext"><span>dsr_</span> | <span>145 comments</span></div><br/><div><div id="40281267" class="c"><input type="checkbox" id="c-40281267" checked=""/><div class="controls bullet"><span class="by">lathiat</span><span>|</span><a href="#40279798">next</a><span>|</span><label class="collapse" for="c-40281267">[-]</label><label class="expand" for="c-40281267">[12 more]</label></div><br/><div class="children"><div class="content">This is a slight variation on the &quot;Poison Tap&quot; attack from Samy Kamkar in 2016, where you do the same thing but with a USB&#x2F;Thunderbolt network adapter. You plug it into the victim device, advertise two more specific routes of 0.0.0.0&#x2F;1 and 128.0.0.0&#x2F;1 and then you get all the traffic in preference to other system interfaces despite interface ordering:
<a href="https:&#x2F;&#x2F;github.com&#x2F;samyk&#x2F;poisontap">https:&#x2F;&#x2F;github.com&#x2F;samyk&#x2F;poisontap</a><p>I imagine there is also probably some other prior art. But that&#x27;s a very well known one.<p>They also claim that it affects all VPN clients in the headline, yet so many such clients setup firewall rules to block traffic to&#x2F;from the physical interface as they acknowledge in the write-up. Most of the VPNs that are claiming to hide your identity or where such cloaking is important tend to implement that. I&#x27;m sure plenty of setups don&#x27;t have it enabled by default, but I think it would have been productive to document what percentage of leading personal&#x2F;commercial and corporate VPN solutions have this enabled by default.<p>A good write-up and explanation for the lay person, but I think the headline over-sells it a little bit given the number of clients that would prevent most of the data leak with those firewall rules and not acknowledging the prior art in this area.</div><br/><div id="40281438" class="c"><input type="checkbox" id="c-40281438" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40281267">parent</a><span>|</span><a href="#40279798">next</a><span>|</span><label class="collapse" for="c-40281438">[-]</label><label class="expand" for="c-40281438">[11 more]</label></div><br/><div class="children"><div class="content">Well said. This is a nothing-burger for all VPNs except the ones that are likely heavily leaking already due to the absence of basic firewall rules.<p>Their &quot;side channel attack&quot; also made me spit out my drink.<p>EDIT: looks like NordVPN (at least on mac) doesn&#x27;t have those basic firewall rules and so IS vulnerable to this exploit.</div><br/><div id="40282201" class="c"><input type="checkbox" id="c-40282201" checked=""/><div class="controls bullet"><span class="by">foobiekr</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40281438">parent</a><span>|</span><a href="#40282776">next</a><span>|</span><label class="collapse" for="c-40282201">[-]</label><label class="expand" for="c-40282201">[8 more]</label></div><br/><div class="children"><div class="content">A general rule for life is that companies making a big deal about military grade encryption or about how they are affiliated with Nordic countries are scams.</div><br/><div id="40283402" class="c"><input type="checkbox" id="c-40283402" checked=""/><div class="controls bullet"><span class="by">froddd</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40282201">parent</a><span>|</span><a href="#40282554">next</a><span>|</span><label class="collapse" for="c-40283402">[-]</label><label class="expand" for="c-40283402">[4 more]</label></div><br/><div class="children"><div class="content">Can you expand on that? Specifically the affiliation with Nordic countries?<p>I’m a Nord VPN customer, I’d quite like to know more — may help inform any future decision on renewing or even staying with them.</div><br/><div id="40283592" class="c"><input type="checkbox" id="c-40283592" checked=""/><div class="controls bullet"><span class="by">sigmoid10</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40283402">parent</a><span>|</span><a href="#40282554">next</a><span>|</span><label class="collapse" for="c-40283592">[-]</label><label class="expand" for="c-40283592">[3 more]</label></div><br/><div class="children"><div class="content">In general, Nordic countries are known for their extensive privacy laws, which in theory would make it harder for law enforcement to gain access to your traffic (and with a court order it is very easy to decloak your VPN traffic). However, as all Nordic countries are part of the Schengen Area, they are bound by European laws - and their enforcement. When Europol started cracking down on VPN providers that didn&#x27;t comply, NordVPN (and all others who wanted to remain in the European market) were forced to admit [1] that they do comply with law enforcement orders. Today, all VPNs that you can legally buy are worthless in the aspects they advertise to you. You neither get extra security through encryption when browsing the web (https is already good enough for public wifi) nor actual privacy from your own government.<p>[1] <a href="https:&#x2F;&#x2F;www.pcmag.com&#x2F;news&#x2F;nordvpn-actually-we-do-comply-with-law-enforcement-data-requests" rel="nofollow">https:&#x2F;&#x2F;www.pcmag.com&#x2F;news&#x2F;nordvpn-actually-we-do-comply-wit...</a></div><br/><div id="40283599" class="c"><input type="checkbox" id="c-40283599" checked=""/><div class="controls bullet"><span class="by">stavros</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40283592">parent</a><span>|</span><a href="#40282554">next</a><span>|</span><label class="collapse" for="c-40283599">[-]</label><label class="expand" for="c-40283599">[2 more]</label></div><br/><div class="children"><div class="content">Even Mullvad?</div><br/><div id="40283616" class="c"><input type="checkbox" id="c-40283616" checked=""/><div class="controls bullet"><span class="by">sigmoid10</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40283599">parent</a><span>|</span><a href="#40282554">next</a><span>|</span><label class="collapse" for="c-40283616">[-]</label><label class="expand" for="c-40283616">[1 more]</label></div><br/><div class="children"><div class="content">You can answer the question yourself for any provider using this simple test: Can you legally buy access to it from inside the EU? If yes, they will suffer from the same problem as all other providers.</div><br/></div></div></div></div></div></div></div></div><div id="40282554" class="c"><input type="checkbox" id="c-40282554" checked=""/><div class="controls bullet"><span class="by">codetrotter</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40282201">parent</a><span>|</span><a href="#40283402">prev</a><span>|</span><a href="#40282776">next</a><span>|</span><label class="collapse" for="c-40282554">[-]</label><label class="expand" for="c-40282554">[3 more]</label></div><br/><div class="children"><div class="content">Yeah. But Mullvad VPN, based in Sweden, is an actual good one.</div><br/><div id="40282860" class="c"><input type="checkbox" id="c-40282860" checked=""/><div class="controls bullet"><span class="by">pests</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40282554">parent</a><span>|</span><a href="#40282776">next</a><span>|</span><label class="collapse" for="c-40282860">[-]</label><label class="expand" for="c-40282860">[2 more]</label></div><br/><div class="children"><div class="content">Migadu for email hosting is amazing as well, also Sweden I beleive.</div><br/><div id="40283117" class="c"><input type="checkbox" id="c-40283117" checked=""/><div class="controls bullet"><span class="by">ChymeraXYZ</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40282860">parent</a><span>|</span><a href="#40282776">next</a><span>|</span><label class="collapse" for="c-40283117">[-]</label><label class="expand" for="c-40283117">[1 more]</label></div><br/><div class="children"><div class="content">Migadu is Swiss</div><br/></div></div></div></div></div></div></div></div><div id="40282776" class="c"><input type="checkbox" id="c-40282776" checked=""/><div class="controls bullet"><span class="by">ikiris</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40281438">parent</a><span>|</span><a href="#40282201">prev</a><span>|</span><a href="#40279798">next</a><span>|</span><label class="collapse" for="c-40282776">[-]</label><label class="expand" for="c-40282776">[2 more]</label></div><br/><div class="children"><div class="content">What was the side channel attack? There’s no way I’m reading 20 pages of networking for absolute toddlers to try to find it.</div><br/><div id="40282984" class="c"><input type="checkbox" id="c-40282984" checked=""/><div class="controls bullet"><span class="by">josephcsible</span><span>|</span><a href="#40281267">root</a><span>|</span><a href="#40282776">parent</a><span>|</span><a href="#40279798">next</a><span>|</span><label class="collapse" for="c-40282984">[-]</label><label class="expand" for="c-40282984">[1 more]</label></div><br/><div class="children"><div class="content">The side channel attack lets the attacker determine whether or not you&#x27;re trying to connect to certain IP addresses over your VPN. If you properly fix this, then even when the DHCP server is performing the attack, the traffic in question still goes through your VPN. If you just mitigate it, then when the DHCP server is performing the attack, the traffic will be dropped. The side channel is that if you just mitigate it, then the attacker can repeatedly start and stop the attack for specific IP addresses, while monitoring how much VPN traffic you&#x27;re sending and receiving.</div><br/></div></div></div></div></div></div></div></div><div id="40279798" class="c"><input type="checkbox" id="c-40279798" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40281267">prev</a><span>|</span><a href="#40279843">next</a><span>|</span><label class="collapse" for="c-40279798">[-]</label><label class="expand" for="c-40279798">[32 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know why this article is so long.<p>DHCP Option 121 allows the DHCP server to set routing rules for a given CIDR range, which end up having a higher priority than the default 0.0.0.0&#x2F;0 rule due to higher specificity (longer prefix).</div><br/><div id="40279966" class="c"><input type="checkbox" id="c-40279966" checked=""/><div class="controls bullet"><span class="by">morattisec</span><span>|</span><a href="#40279798">parent</a><span>|</span><a href="#40280976">next</a><span>|</span><label class="collapse" for="c-40279966">[-]</label><label class="expand" for="c-40279966">[29 more]</label></div><br/><div class="children"><div class="content">One of the authors here, the intention was to provide a primer of the topics since we figured this would draw people from a nontechnical background too.<p>That and half the information on the internet about VPNs is from VPN providers and is incorrect or not technical enough to describe how they _actually_ work.<p>We had a sentence in the intro that was supposed to be a hyperlink to the “hey if you know this stuff you should skip to the POC section”. I’ll make sure that gets updated&#x2F;more obvious.</div><br/><div id="40280106" class="c"><input type="checkbox" id="c-40280106" checked=""/><div class="controls bullet"><span class="by">wolverine876</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280101">next</a><span>|</span><label class="collapse" for="c-40280106">[-]</label><label class="expand" for="c-40280106">[1 more]</label></div><br/><div class="children"><div class="content">What I read does a great job of explaining the technology; I know it pretty well but it&#x27;s great to have an updated, clear, concise, well-organized, integrated explanation all in one place. I can&#x27;t imagine how long that took to make it that clear!<p>(Everything posted here gets similar complaints about the writing, headline, too short, too long, too hot, too cold, etc. Goldilocks is never pleased here. Welcome to HN! :)</div><br/></div></div><div id="40280101" class="c"><input type="checkbox" id="c-40280101" checked=""/><div class="controls bullet"><span class="by">tgsovlerkhgsel</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280106">prev</a><span>|</span><a href="#40280108">next</a><span>|</span><label class="collapse" for="c-40280101">[-]</label><label class="expand" for="c-40280101">[5 more]</label></div><br/><div class="children"><div class="content">The PoC section doesn&#x27;t explain the issue. I think a one-line TL;DR similar to the summary above would be best, e.g. &quot;A malicious DHCP server can use DHCP Option 121 to set routing rules, which can override the routing rule used by VPNs and cause traffic to be routed outside the VPN&quot;<p>(I like it that you provide the background for people who need it, but also found the actually relevant information extremely annoying to find.)</div><br/><div id="40280110" class="c"><input type="checkbox" id="c-40280110" checked=""/><div class="controls bullet"><span class="by">wolverine876</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280101">parent</a><span>|</span><a href="#40280749">next</a><span>|</span><label class="collapse" for="c-40280110">[-]</label><label class="expand" for="c-40280110">[1 more]</label></div><br/><div class="children"><div class="content">&gt; found the actually relevant information extremely annoying to find<p>Skip down to the DHCP section?</div><br/></div></div><div id="40280749" class="c"><input type="checkbox" id="c-40280749" checked=""/><div class="controls bullet"><span class="by">dylan604</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280101">parent</a><span>|</span><a href="#40280110">prev</a><span>|</span><a href="#40280108">next</a><span>|</span><label class="collapse" for="c-40280749">[-]</label><label class="expand" for="c-40280749">[3 more]</label></div><br/><div class="children"><div class="content">Just accept you were not the target audience and skim like the rest of the world. Not every article is written for you. It&#x27;s available for you to read, but was more than likely not with you in mind. Some of us still like words and the reading of them when they provide details and more in-depth understanding than a tweet.</div><br/><div id="40281969" class="c"><input type="checkbox" id="c-40281969" checked=""/><div class="controls bullet"><span class="by">mindslight</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280749">parent</a><span>|</span><a href="#40280108">next</a><span>|</span><label class="collapse" for="c-40281969">[-]</label><label class="expand" for="c-40281969">[2 more]</label></div><br/><div class="children"><div class="content">I hate tweet culture as much as anybody, but this is not the alternative. This article is so painfully long, I got bored even just trying to skim it. Reading it word for word will turn any noob into a seasoned greybeard through the sheer passage of time. If you really like words and reading them this much, I&#x27;d recommend adding some dictionaries to your reading list.</div><br/><div id="40282637" class="c"><input type="checkbox" id="c-40282637" checked=""/><div class="controls bullet"><span class="by">tgsovlerkhgsel</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281969">parent</a><span>|</span><a href="#40280108">next</a><span>|</span><label class="collapse" for="c-40282637">[-]</label><label class="expand" for="c-40282637">[1 more]</label></div><br/><div class="children"><div class="content">ChatGPT is great for providing endless reading material too!</div><br/></div></div></div></div></div></div></div></div><div id="40280108" class="c"><input type="checkbox" id="c-40280108" checked=""/><div class="controls bullet"><span class="by">nonrandomstring</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280101">prev</a><span>|</span><a href="#40280266">next</a><span>|</span><label class="collapse" for="c-40280108">[-]</label><label class="expand" for="c-40280108">[1 more]</label></div><br/><div class="children"><div class="content">Good call. For a general IT audience you are speaking to, context
building really helps refresh the scene before dropping the exploit.
Well communicated.</div><br/></div></div><div id="40280266" class="c"><input type="checkbox" id="c-40280266" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280108">prev</a><span>|</span><a href="#40280118">next</a><span>|</span><label class="collapse" for="c-40280266">[-]</label><label class="expand" for="c-40280266">[19 more]</label></div><br/><div class="children"><div class="content">I looked at this in detail. This exploit is a nothing-burger for most decent VPNs.<p>A simple &quot;leak protection&quot; (aka Killswitch) firewall rule completely negates this attack.<p>All decent VPNs implement such a rule by default.<p>Dealing with undesirable routes (whether pre existing or pushed by a DHCP server) is nothing new or in the slightest bit hard to defend against.<p>If a VPN does not implement such a firewall rule already then it&#x27;s likely already leaking so all this exploit demonstrates is that &quot;A VPN without leak protection, leaks&quot;.<p>(I won&#x27;t even mention the &quot;side channel&quot; attack as it&#x27;s completely ridiculous)<p>I liked your write-up and option 121 is a little known option, so it&#x27;s good to know about. But let&#x27;s not pretend this thing is bigger than it is.</div><br/><div id="40280351" class="c"><input type="checkbox" id="c-40280351" checked=""/><div class="controls bullet"><span class="by">CommitSyn</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280266">parent</a><span>|</span><a href="#40280289">next</a><span>|</span><label class="collapse" for="c-40280351">[-]</label><label class="expand" for="c-40280351">[16 more]</label></div><br/><div class="children"><div class="content">FTA: Importantly, the VPN control channel is maintained so features such as kill switches are never tripped, and users continue to show as connected to a VPN in all the cases we’ve observed.</div><br/><div id="40280376" class="c"><input type="checkbox" id="c-40280376" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280351">parent</a><span>|</span><a href="#40280532">next</a><span>|</span><label class="collapse" for="c-40280376">[-]</label><label class="expand" for="c-40280376">[14 more]</label></div><br/><div class="children"><div class="content">They don&#x27;t know what they&#x27;re talking about. Kill switches are not &quot;tripped&quot; there is no &quot;control channel&quot;.<p>A kill switch is just a firewall rule that is ALWAYS engaged and all it does is blocks off-VPN traffic.<p>It 100% will defend against this exploit.</div><br/><div id="40280496" class="c"><input type="checkbox" id="c-40280496" checked=""/><div class="controls bullet"><span class="by">jcrawfordor</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280376">parent</a><span>|</span><a href="#40280667">next</a><span>|</span><label class="collapse" for="c-40280496">[-]</label><label class="expand" for="c-40280496">[10 more]</label></div><br/><div class="children"><div class="content">Most practical VPN services don&#x27;t actually implement it this way, it&#x27;s a somewhat difficult and rather OS-specific problem depending on the firewall services offered by the OS. On some popular OS like mobile ones it&#x27;s just not possible at all.<p>So just to grab an example, NordVPN&#x27;s implementation does indeed work as the article presents: it monitors the VPN and disables network access for applications if the VPN connection drops. This is indeed vulnerable to any number of potential problems, and depending on the OS and user savvy you can set up better protection using e.g. the iptables owner module. It&#x27;s very non-portable though, sometimes even between Linux distributions, and hard to support at scale. Actually I&#x27;d say a true &quot;no access except through the VPN&quot; rule is easiest to implement on Windows, but NordVPN doesn&#x27;t seem to do it there either, I&#x27;m not sure why.<p>To be fair, it&#x27;s right in the name: a kill switch is a switch that kills things. It isn&#x27;t proper network policy like per-process routing tables that are, unfortunately, difficult to implement for consumer machines.</div><br/><div id="40280597" class="c"><input type="checkbox" id="c-40280597" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280496">parent</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40280597">[-]</label><label class="expand" for="c-40280597">[8 more]</label></div><br/><div class="children"><div class="content">Mobile is an exception (but they already state android is immune), let&#x27;s stick to desktop for the sake of discussion, the 3 major desktop platforms: mac, win, linux :)<p>On mac - just implement a block everything rule with pf and then just allow traffic on the tunnel and whitelist the VPN endpoint. Boom, a kill switch that defends against this exploit. And there&#x27;s no racey nordvpn-style &quot;control channel&quot; (if nord really works like this i have an even lower opinion of them than i do currently).<p>On linux - iptables (for example) - just implement a general DROP policy then override with a specific ALLOW on the tunnel interface.<p>On Windows - Use WFP to implement a block everything rule, then provide a higher priority rule to allow on the tunnel interface.<p>All three of these techniques are the recommended way to implement a kill switch and it&#x27;s used heavily in the VPN industry by anyone sensible. It completely defends against this TunnelVision exploit too.<p>The way that you suggest kill switch is implemented (reactive and monitoring the connection?) is very fragile, racey and prone to leak, i absolutely would not trust it and it shouldn&#x27;t even be called a kill switch. It&#x27;s an embarrassment. :)</div><br/><div id="40280670" class="c"><input type="checkbox" id="c-40280670" checked=""/><div class="controls bullet"><span class="by">jcrawfordor</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280597">parent</a><span>|</span><a href="#40281083">next</a><span>|</span><label class="collapse" for="c-40280670">[-]</label><label class="expand" for="c-40280670">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not saying how it <i>should</i> be implemented, I&#x27;m saying how it <i>is</i> implemented by a number of popular VPN services. Take up the argument with them. There are VPN providers that do it right on at least some platforms, but unfortunately the way most document it it&#x27;s very hard to tell without experimenting with the client to verify.<p>As far as I know, use of the term &quot;kill switch&quot; closely correlates with an untrustworthy implementation. Consider the case of Mullvad who handle this a lot better and also decline to call it a &quot;kill switch&quot; for that reason. And that&#x27;s not to say that Mullvad is perfect, easy to find forum threads by people who had traffic leakage for various reasons. I wouldn&#x27;t trust anything you didn&#x27;t set up yourself.</div><br/></div></div><div id="40281083" class="c"><input type="checkbox" id="c-40281083" checked=""/><div class="controls bullet"><span class="by">Borealid</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280597">parent</a><span>|</span><a href="#40280670">prev</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40281083">[-]</label><label class="expand" for="c-40281083">[6 more]</label></div><br/><div class="children"><div class="content">You wrote three different ways to end up with all traffic dropped and a broken VPN connection.<p>Traffic sent to the VPN interface gets encapsulated by the VPN client software and then routed to the Internet. If your firewall rule is dropping all traffic not destined for the VPN interface, it will drop the encapsulated traffic.<p>You need two (sets of) rules: one allowing traffic on the VPN interface and one allowing traffic which is already cloaked by the VPN software (or not cloaked, but used to establish&#x2F;maintain the tunnel itself). That second category is a bit complicated, because you need to be able to route to the VPN server regardless of which network you&#x27;re connected to - and the DHCP server tells you how to do that.</div><br/><div id="40281244" class="c"><input type="checkbox" id="c-40281244" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281083">parent</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40281244">[-]</label><label class="expand" for="c-40281244">[5 more]</label></div><br/><div class="children"><div class="content">Yes. I just provided simplified firewall rules in my answer. You also need to whitelist either the VPN endpoint itself (and add a route to that endpoint) or you need to whitelist the process (such as wireguard or openvpn) that hits that endpoint.<p>Not sure how a DHCP server is relevant in the slightest here except for the initial host network config of course. But the host network should already be configured before the VPN comes up.<p>Source: i&#x27;ve implemented this dozens of times (and you probably have too, it sounds like) so let&#x27;s not quibble over the details ;)</div><br/><div id="40281481" class="c"><input type="checkbox" id="c-40281481" checked=""/><div class="controls bullet"><span class="by">Borealid</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281244">parent</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40281481">[-]</label><label class="expand" for="c-40281481">[4 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re connected to a random network, whose configuration you don&#x27;t know in advance, how do you route packets to your VPN server?<p>The usual answer is that the network&#x27;s router tells you how to do that, by supplying DHCP options.<p>The point I&#x27;m making here is that you can&#x27;t just configure a firewall rule and have it work properly. What actually needs to happen is that the VPN client software is using one routing table - let&#x27;s call it &quot;host routing&quot; - and everything else on the system is using a second routing table - let&#x27;s call that &quot;VPN routing&quot;.<p>The DHCP server inserts rules into the host routing table, and the <i>only</i> software using those rules is the VPN client for its management and tunnel traffic.<p>Otherwise, what if the network to which you connect says &quot;the next hop for all internet traffic is 10.10.10.10&quot;? You need to respect that rule when sending traffic to your VPN server, and ignore it for applications whose traffic will be tunneled.</div><br/><div id="40281695" class="c"><input type="checkbox" id="c-40281695" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281481">parent</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40281695">[-]</label><label class="expand" for="c-40281695">[3 more]</label></div><br/><div class="children"><div class="content">Let&#x27;s walk through this step by step because there&#x27;s a lot of confusion on your end.<p>* Step one - You connect your computer to a network - yes you&#x27;ll get a DHCP lease,  and you&#x27;ll get an ip address, and a default gateway. This default route will be added to your routing table.<p>* Step two - If the TunnelVision exploit (DHCP option 121) is at play you&#x27;ll also get a few MORE SPECIFIC routes than the default gateway. These also get added to your routing table<p>* Step three - You connect your VPN. The VPN will bring up a firewall. It will also bring up `128&#x2F;1` and  `0&#x2F;1` routes that point at the VPN tunnel. The VPN tunnel now takes over the default route. This firewall will block all traffic that&#x27;s not on the tun device (the VPN interface). Further, it will whitelist the VPN endpoint IP and create a route for it (it can do this since it already received the default gateway from the DHCP server)<p>* Step four - Your host starts sending traffic - either this traffic will go through the VPN tunnel (the default route) OR it will <i>attempt</i> to go through the more specific option 121 pushed malicious routes added by the compromised DHCP server (depending on the destination ip of the outbound packets).<p>* Step five - All traffic that <i>would</i> go down the malicious option 121 routes are BLOCKED by the firewall rule. Hence nullifying the TunnelVision exploit.<p>That&#x27;s all. Done. Where&#x27;s the complexity in that? As i said before i&#x27;ve done this dozens of times. I&#x27;m talking from experience. I know this works.<p>Further you say:<p>&gt; The point I&#x27;m making here is that you can&#x27;t just configure a firewall rule and have it work properly. What actually needs to happen is that the VPN client software is using one routing table - let&#x27;s call it &quot;host routing&quot; - and everything else on the system is using a second routing table - let&#x27;s call that &quot;VPN routing&quot;.<p>You are aware we&#x27;re talking about consumer VPNs right? The majority of users are on Windows and Mac. Neither of those OSes support multiple routing tables. Only Linux supports multiple routing tables.<p>You&#x27;re also just plain wrong - as i demonstrated above - you <i>CAN</i> just configure a firewall rule and it WILL just work properly. Again, i&#x27;m talking from experience.</div><br/><div id="40282921" class="c"><input type="checkbox" id="c-40282921" checked=""/><div class="controls bullet"><span class="by">pests</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281695">parent</a><span>|</span><a href="#40282657">next</a><span>|</span><label class="collapse" for="c-40282921">[-]</label><label class="expand" for="c-40282921">[1 more]</label></div><br/><div class="children"><div class="content">In your step 4, what happens when the VPN traffic gets routed over option 121 pushed routes?<p>Don&#x27;t you block it - thus blocking your entire VPN?<p>&gt; OR it will attempt to go through the more specific option 121 pushed malicious routes added by the compromised DHCP server (depending on the destination ip of the outbound packets).<p>This right here... we don&#x27;t want our VPN-secued traffic going out over routes broadcast by the malicious DHCP server, so you block it... right?<p>How does that traffic leave the local network and reach the VPN server?</div><br/></div></div><div id="40282657" class="c"><input type="checkbox" id="c-40282657" checked=""/><div class="controls bullet"><span class="by">Borealid</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40281695">parent</a><span>|</span><a href="#40282921">prev</a><span>|</span><a href="#40280563">next</a><span>|</span><label class="collapse" for="c-40282657">[-]</label><label class="expand" for="c-40282657">[1 more]</label></div><br/><div class="children"><div class="content">I think you missed a step in your progression.<p>Step one, you connect to the network and get routes.<p>Step two, you connect your VPN.<p>Step three, your host starts sending traffic. At this point, your firewall rules are now active and dropping any traffic you&#x27;ve told them to.<p>Step four, you renew your DHCP lease and get new routes via option 121. Those routes might be malicious, or they might not.<p>One of three things is true at step four. Either:<p>A. Your firewall rules will block all traffic over the new routes<p>B. Your firewal rules will not block any traffic over the new routes<p>C. Your firewall rules will block some subset of traffic over the new routes<p>If A is true, then your VPN tunnel goes down (undesirable), as the VPN server can no longer be contacted.<p>If B is true, then you are vulnerable to the TunnelVision exploit.<p>If C is true, and the subset of traffic blocked is exactly the subset intended to route over the VPN but maliciously diverted, then the VPN tunnel goes down because the firewall rules are blocking its traffic.<p>If C is true, and somehow the firewall rule is rewriting the traffic that&#x27;s pointed not-over-the-VPN to be instead routed over the VPN (by using NAT?), then the VPN tunnel stays up and there is no problem.<p>I&#x27;d be interested in seeing the set of firewall rules that will let the VPN tunnel stay up, with management traffic going over the added-after-the-tunnel-was-brought-up next-hop, and tunneled traffic continuing to flow ignoring the new route. I haven&#x27;t seen those rules in the past so if you have experience writing them, please show me.<p>Personally I&#x27;ve only used Linux multiple routing tables to plug this leak.<p>EDIT: formatting</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40280563" class="c"><input type="checkbox" id="c-40280563" checked=""/><div class="controls bullet"><span class="by">0x457</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280496">parent</a><span>|</span><a href="#40280597">prev</a><span>|</span><a href="#40280667">next</a><span>|</span><label class="collapse" for="c-40280563">[-]</label><label class="expand" for="c-40280563">[1 more]</label></div><br/><div class="children"><div class="content">Let&#x27;s be honest, there&#x27;re 2 OSs on desktop that matter to VPN providers that provide &quot;all-in-one app&quot; - Windows and macOS. Both have easy to configure from your application.<p>On linux, well, you have to choose:<p>- use iptables style rules regardless of the backend<p>or<p>- use nftables style rules regardless of the backend.<p>So it&#x27;s 3 firewalls that you have to think about.<p>On mobile, well, on mobile you&#x27;re mostly at the mercy of the platform owner and generally can&#x27;t do much. Hence, why connecting phone to &quot;SoftAP&#x2F;ether_g + VPN&quot; device is better than a direct connection.</div><br/></div></div></div></div><div id="40280667" class="c"><input type="checkbox" id="c-40280667" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280376">parent</a><span>|</span><a href="#40280496">prev</a><span>|</span><a href="#40280532">next</a><span>|</span><label class="collapse" for="c-40280667">[-]</label><label class="expand" for="c-40280667">[3 more]</label></div><br/><div class="children"><div class="content">&gt; A kill switch is just<p>Not always.  Some VPNs have a kill switch feature for closing specified programs.  Hopefully in addition to the firewall rule.</div><br/><div id="40280725" class="c"><input type="checkbox" id="c-40280725" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280667">parent</a><span>|</span><a href="#40280532">next</a><span>|</span><label class="collapse" for="c-40280725">[-]</label><label class="expand" for="c-40280725">[2 more]</label></div><br/><div class="children"><div class="content">&quot;closing specified programs&quot; has to be the silliest thing i&#x27;ve ever heard. By the time you close it, it&#x27;s probably already leaked thousands of packets. The leak of a SINGLE packet is already too much.<p>Such an &quot;application killing kill switch&quot; is just marketing fluff, it makes zero sense from a security standpoint.</div><br/><div id="40282417" class="c"><input type="checkbox" id="c-40282417" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280725">parent</a><span>|</span><a href="#40280532">next</a><span>|</span><label class="collapse" for="c-40282417">[-]</label><label class="expand" for="c-40282417">[1 more]</label></div><br/><div class="children"><div class="content">Well to be fair I&#x27;m not sure if they kill the programs before or after disconnecting the VPN interface.<p>I&#x27;d sure hope it&#x27;s before.</div><br/></div></div></div></div></div></div></div></div><div id="40280532" class="c"><input type="checkbox" id="c-40280532" checked=""/><div class="controls bullet"><span class="by">0x457</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280351">parent</a><span>|</span><a href="#40280376">prev</a><span>|</span><a href="#40280289">next</a><span>|</span><label class="collapse" for="c-40280532">[-]</label><label class="expand" for="c-40280532">[1 more]</label></div><br/><div class="children"><div class="content">Let me explain how a _very_ basic setup works: you set up a firewall rules allowing only connection to VPN on all interfaces except your VPN interface.<p>If you&#x27;re running a torrent box, then you can do whatever your OS equivalent of &quot;this process uses this routing table&quot;. My seed box was using interfaces that were set up in dom0 and guests didn&#x27;t even know about a ways to reach outside without a VPN connection being established by the host.<p>The point is - &quot;such&quot; attacks have no legs against anything beyond &quot;OpenVPN: Getting Started&quot; kind of server.</div><br/></div></div></div></div><div id="40280289" class="c"><input type="checkbox" id="c-40280289" checked=""/><div class="controls bullet"><span class="by">barbariangrunge</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280266">parent</a><span>|</span><a href="#40280351">prev</a><span>|</span><a href="#40280118">next</a><span>|</span><label class="collapse" for="c-40280289">[-]</label><label class="expand" for="c-40280289">[2 more]</label></div><br/><div class="children"><div class="content">Looking at mozilla vpn, I can’t tell if there is such a setting, unless it’s just enabled by default. Can anyone clarify?</div><br/><div id="40280417" class="c"><input type="checkbox" id="c-40280417" checked=""/><div class="controls bullet"><span class="by">SushiHippie</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280289">parent</a><span>|</span><a href="#40280118">next</a><span>|</span><label class="collapse" for="c-40280417">[-]</label><label class="expand" for="c-40280417">[1 more]</label></div><br/><div class="children"><div class="content">&gt; A VPN kill switch is a must-have for privacy reasons when using a VPN. If you are actively using the VPN to transfer data and your Internet connection becomes unstable or drops, the entire network connection on your device will be blocked to prevent your local IP address from being exposed to the outside world. The kill switch is on by default on Windows, Android, iOS, macOS and Linux and there is no setting to turn it off.<p><a href="https:&#x2F;&#x2F;support.mozilla.org&#x2F;en-US&#x2F;kb&#x2F;mozilla-vpn-kill-switch" rel="nofollow">https:&#x2F;&#x2F;support.mozilla.org&#x2F;en-US&#x2F;kb&#x2F;mozilla-vpn-kill-switch</a></div><br/></div></div></div></div></div></div><div id="40280118" class="c"><input type="checkbox" id="c-40280118" checked=""/><div class="controls bullet"><span class="by">idkdotcom</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280266">prev</a><span>|</span><a href="#40280046">next</a><span>|</span><label class="collapse" for="c-40280118">[-]</label><label class="expand" for="c-40280118">[1 more]</label></div><br/><div class="children"><div class="content">Have you identified actual VPN vendors that are affected by this? I won&#x27;t disclose which ones I use, but I would love to know if they have been affected.</div><br/></div></div><div id="40280046" class="c"><input type="checkbox" id="c-40280046" checked=""/><div class="controls bullet"><span class="by">bimguy</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40279966">parent</a><span>|</span><a href="#40280118">prev</a><span>|</span><a href="#40280976">next</a><span>|</span><label class="collapse" for="c-40280046">[-]</label><label class="expand" for="c-40280046">[1 more]</label></div><br/><div class="children"><div class="content">Great write up by the way. Even some technical people might not know about this, not all technical people are network experts after all.</div><br/></div></div></div></div><div id="40280976" class="c"><input type="checkbox" id="c-40280976" checked=""/><div class="controls bullet"><span class="by">ajsnigrutin</span><span>|</span><a href="#40279798">parent</a><span>|</span><a href="#40279966">prev</a><span>|</span><a href="#40279843">next</a><span>|</span><label class="collapse" for="c-40280976">[-]</label><label class="expand" for="c-40280976">[2 more]</label></div><br/><div class="children"><div class="content">...and the attacker needs to be in the same L2 network as the victim to trigger the attack.<p>(i guess... didn&#x27;t read the article, just the post above)</div><br/><div id="40283096" class="c"><input type="checkbox" id="c-40283096" checked=""/><div class="controls bullet"><span class="by">sambazi</span><span>|</span><a href="#40279798">root</a><span>|</span><a href="#40280976">parent</a><span>|</span><a href="#40279843">next</a><span>|</span><label class="collapse" for="c-40283096">[-]</label><label class="expand" for="c-40283096">[1 more]</label></div><br/><div class="children"><div class="content">virtual network interfaces are a thing</div><br/></div></div></div></div></div></div><div id="40279843" class="c"><input type="checkbox" id="c-40279843" checked=""/><div class="controls bullet"><span class="by">pushedx</span><span>|</span><a href="#40279798">prev</a><span>|</span><a href="#40280070">next</a><span>|</span><label class="collapse" for="c-40279843">[-]</label><label class="expand" for="c-40279843">[13 more]</label></div><br/><div class="children"><div class="content">The threat model is that an arbitrary attacker can somehow become the DHCP server on your LAN, which is unlikely but not impossible.<p>On the other hand, if you are using an ISP provided gateway device..</div><br/><div id="40280017" class="c"><input type="checkbox" id="c-40280017" checked=""/><div class="controls bullet"><span class="by">smarx007</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280267">next</a><span>|</span><label class="collapse" for="c-40280017">[-]</label><label class="expand" for="c-40280017">[4 more]</label></div><br/><div class="children"><div class="content">&gt; arbitrary attacker can somehow become the DHCP server on your LAN, which is unlikely but not impossible<p>Coffee shop wi-fi? A.k.a merely the no. 1 selling point for most VPN offerings.<p>The proper course of action in this case is to use your 4G&#x2F;5G connection and not to connect to shady networks you don&#x27;t trust.</div><br/><div id="40280231" class="c"><input type="checkbox" id="c-40280231" checked=""/><div class="controls bullet"><span class="by">SahAssar</span><span>|</span><a href="#40279843">root</a><span>|</span><a href="#40280017">parent</a><span>|</span><a href="#40283196">next</a><span>|</span><label class="collapse" for="c-40280231">[-]</label><label class="expand" for="c-40280231">[2 more]</label></div><br/><div class="children"><div class="content">&gt; A.k.a merely the no. 1 selling point for most VPN offerings.<p>I thought the selling point was protection against hackers. No, was it your ISP seeing your (basically always HTTPS encrypted) traffic? Or facebook&#x2F;google harvesting your data? Or russian hackers? Or watching netflix from other countries? Or data-harvesters watching your traffic? Or if you just really like downloading linux ISOs? I also think I heard something about snowden and NSA tracking in a few ads. Something something cheaper airplane tickets?<p>Either way, it&#x27;s all scary and for the low fee of 5$ per month (sign up for 3 years and you get 3 months free with my code!) you don&#x27;t have to worry your pretty little head about it anymore. Don&#x27;t worry about that our company is registered in Bermuda and is just 3 months old.</div><br/><div id="40280812" class="c"><input type="checkbox" id="c-40280812" checked=""/><div class="controls bullet"><span class="by">acdha</span><span>|</span><a href="#40279843">root</a><span>|</span><a href="#40280231">parent</a><span>|</span><a href="#40283196">next</a><span>|</span><label class="collapse" for="c-40280812">[-]</label><label class="expand" for="c-40280812">[1 more]</label></div><br/><div class="children"><div class="content">There are super shady VPN providers but that doesn’t mean local network risks can be ignored. For example, how frequently do you hear about compromised networks of routers and access points? Attackers could be using those for far more stealthy means.<p>Also, remember when Verizon decided to helpfully inject cross-domain tracking cookies into their customers’ traffic? Do you really want to gamble that some MBA wouldn’t start to think about ways to monetize activity collection from VPN users? Some provider won’t sell schools, coffee shops, etc. a service which will block the “wrong” traffic and that just quietly expands to cover, say, women looking for family planning advice or college students in Florida looking for trans support?</div><br/></div></div></div></div><div id="40283196" class="c"><input type="checkbox" id="c-40283196" checked=""/><div class="controls bullet"><span class="by">mschuster91</span><span>|</span><a href="#40279843">root</a><span>|</span><a href="#40280017">parent</a><span>|</span><a href="#40280231">prev</a><span>|</span><a href="#40280267">next</a><span>|</span><label class="collapse" for="c-40283196">[-]</label><label class="expand" for="c-40283196">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The proper course of action in this case is to use your 4G&#x2F;5G connection and not to connect to shady networks you don&#x27;t trust.<p>Sadly, there are carriers on this planet who think it&#x27;s a good idea to charge ridiculous prices for mobile data (Germany) or to block hotspot functionality unless you pay up (US, see [1] for the technical background - both Apple and Google are complicit). In a world where politicians would care about their people, there would be no need for wifi hotspots to exist in the first place.<p>Additionally, there are certain advertising brokers such as utiq that cooperate with major phone networks to provide detailed tracking, so they and advertisers know pretty precisely who you are just because you tethered your laptop to your phone.<p>And finally, you can&#x27;t trust your phone ISP either - Verizon got caught red-handed injecting tracking &quot;supercookies&quot; into their customers&#x27; traffic [2], thank God at least that vector got closed with everyone and their dog going HTTPS.<p>In general: anything involving residential ISPs is rife with scams.<p>[1] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20460438">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20460438</a><p>[2] <a href="http:&#x2F;&#x2F;webpolicy.org&#x2F;2014&#x2F;10&#x2F;24&#x2F;how-verizons-advertising-header-works&#x2F;" rel="nofollow">http:&#x2F;&#x2F;webpolicy.org&#x2F;2014&#x2F;10&#x2F;24&#x2F;how-verizons-advertising-hea...</a></div><br/></div></div></div></div><div id="40280267" class="c"><input type="checkbox" id="c-40280267" checked=""/><div class="controls bullet"><span class="by">threePointFive</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280017">prev</a><span>|</span><a href="#40280073">next</a><span>|</span><label class="collapse" for="c-40280267">[-]</label><label class="expand" for="c-40280267">[3 more]</label></div><br/><div class="children"><div class="content">&quot;the DCHP server&quot; implies it is somehow a special device on your network, which is a flawed assumption. DHCP works on an broadcast protocol and your device will accept the first offer. The fact that the most common residential configuration is for your DHCP to be hosted on your router and thus likely the first to respond is inconsequential to the fact that any hostile device on your network could use this exploit.</div><br/><div id="40280657" class="c"><input type="checkbox" id="c-40280657" checked=""/><div class="controls bullet"><span class="by">pushedx</span><span>|</span><a href="#40279843">root</a><span>|</span><a href="#40280267">parent</a><span>|</span><a href="#40281712">next</a><span>|</span><label class="collapse" for="c-40280657">[-]</label><label class="expand" for="c-40280657">[1 more]</label></div><br/><div class="children"><div class="content">not implying anything in that regard, I can imagine a clever attack which involves a local malicious dhcp implementation</div><br/></div></div><div id="40281712" class="c"><input type="checkbox" id="c-40281712" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#40279843">root</a><span>|</span><a href="#40280267">parent</a><span>|</span><a href="#40280657">prev</a><span>|</span><a href="#40280073">next</a><span>|</span><label class="collapse" for="c-40281712">[-]</label><label class="expand" for="c-40281712">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not at all guaranteed. The residential gateway most likely contains a hardware switch and a CPU, which also does the routing. The CPU is attached to the switch like any other device, though probably with less physical-layer bits, and some of them aren&#x27;t all that fast.</div><br/></div></div></div></div><div id="40280073" class="c"><input type="checkbox" id="c-40280073" checked=""/><div class="controls bullet"><span class="by">flir</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280267">prev</a><span>|</span><a href="#40279992">next</a><span>|</span><label class="collapse" for="c-40280073">[-]</label><label class="expand" for="c-40280073">[1 more]</label></div><br/><div class="children"><div class="content">Surely one of the big use-cases for a VPN is that the network you&#x27;re connected to is untrusted?</div><br/></div></div><div id="40279992" class="c"><input type="checkbox" id="c-40279992" checked=""/><div class="controls bullet"><span class="by">radiowave</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280073">prev</a><span>|</span><a href="#40280066">next</a><span>|</span><label class="collapse" for="c-40279992">[-]</label><label class="expand" for="c-40279992">[1 more]</label></div><br/><div class="children"><div class="content">Or become the DHCP server on whatever third party wifi you&#x27;re connected to.</div><br/></div></div><div id="40280066" class="c"><input type="checkbox" id="c-40280066" checked=""/><div class="controls bullet"><span class="by">tgsovlerkhgsel</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40279992">prev</a><span>|</span><a href="#40280246">next</a><span>|</span><label class="collapse" for="c-40280066">[-]</label><label class="expand" for="c-40280066">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s one of the commonly advertised reasons to use VPNs: protection in untrusted WiFi networks.</div><br/></div></div><div id="40280246" class="c"><input type="checkbox" id="c-40280246" checked=""/><div class="controls bullet"><span class="by">CodeWriter23</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280066">prev</a><span>|</span><a href="#40280056">next</a><span>|</span><label class="collapse" for="c-40280246">[-]</label><label class="expand" for="c-40280246">[1 more]</label></div><br/><div class="children"><div class="content">You mean like a pwned home router?</div><br/></div></div><div id="40280056" class="c"><input type="checkbox" id="c-40280056" checked=""/><div class="controls bullet"><span class="by">Aurornis</span><span>|</span><a href="#40279843">parent</a><span>|</span><a href="#40280246">prev</a><span>|</span><a href="#40280070">next</a><span>|</span><label class="collapse" for="c-40280056">[-]</label><label class="expand" for="c-40280056">[1 more]</label></div><br/><div class="children"><div class="content">The risk is outside the home: Using a VPN at the coffee shop, hotel, office, etc.</div><br/></div></div></div></div><div id="40280070" class="c"><input type="checkbox" id="c-40280070" checked=""/><div class="controls bullet"><span class="by">k0ss_net</span><span>|</span><a href="#40279843">prev</a><span>|</span><a href="#40280243">next</a><span>|</span><label class="collapse" for="c-40280070">[-]</label><label class="expand" for="c-40280070">[4 more]</label></div><br/><div class="children"><div class="content">I swore I had already read about this attack from some other author, so I went searching and after sifting through tons of VPN provider spam in search results I found the prior work [1].<p>This new article goes into some more depth on how to exploit the flaw and has some code to help PoC it though.<p>1: <a href="https:&#x2F;&#x2F;www.usenix.org&#x2F;conference&#x2F;usenixsecurity23&#x2F;presentation&#x2F;xue" rel="nofollow">https:&#x2F;&#x2F;www.usenix.org&#x2F;conference&#x2F;usenixsecurity23&#x2F;presentat...</a></div><br/><div id="40280137" class="c"><input type="checkbox" id="c-40280137" checked=""/><div class="controls bullet"><span class="by">gnabgib</span><span>|</span><a href="#40280070">parent</a><span>|</span><a href="#40283113">next</a><span>|</span><label class="collapse" for="c-40280137">[-]</label><label class="expand" for="c-40280137">[2 more]</label></div><br/><div class="children"><div class="content">That article is referenced in the Appendix:<p><pre><code>  However, neither technique described in the August 2023 paper leveraged DHCP option 121 to push routes. Pushing routes through DHCP has a significantly higher impact from the same attacker vantage point (the ability to hand out IP leases for a non-RFC1918 range or spoofing DNS replies).</code></pre></div><br/><div id="40280769" class="c"><input type="checkbox" id="c-40280769" checked=""/><div class="controls bullet"><span class="by">k0ss_net</span><span>|</span><a href="#40280070">root</a><span>|</span><a href="#40280137">parent</a><span>|</span><a href="#40283113">next</a><span>|</span><label class="collapse" for="c-40280769">[-]</label><label class="expand" for="c-40280769">[1 more]</label></div><br/><div class="children"><div class="content">Ah good find, I totally missed the appendix when reading on mobile.</div><br/></div></div></div></div><div id="40283113" class="c"><input type="checkbox" id="c-40283113" checked=""/><div class="controls bullet"><span class="by">sambazi</span><span>|</span><a href="#40280070">parent</a><span>|</span><a href="#40280137">prev</a><span>|</span><a href="#40280243">next</a><span>|</span><label class="collapse" for="c-40283113">[-]</label><label class="expand" for="c-40283113">[1 more]</label></div><br/><div class="children"><div class="content">the &quot;attack&quot; is widely known and is used as a config option for the openvpn client (redirect-gateway def1)</div><br/></div></div></div></div><div id="40280243" class="c"><input type="checkbox" id="c-40280243" checked=""/><div class="controls bullet"><span class="by">isodude</span><span>|</span><a href="#40280070">prev</a><span>|</span><a href="#40283244">next</a><span>|</span><label class="collapse" for="c-40280243">[-]</label><label class="expand" for="c-40280243">[5 more]</label></div><br/><div class="children"><div class="content">You can also mitigate this by placing the VPN interface in a VRF on Linux. I.e. systemd-networkd have support for doing that out of the box. One thing to watch out or is that when enabling VRF, the ip rule entry for l3mdev is listed as 1000 but rule for local traffic is listed as 0, the local rule should be moved to 1000+.</div><br/><div id="40280280" class="c"><input type="checkbox" id="c-40280280" checked=""/><div class="controls bullet"><span class="by">sargun</span><span>|</span><a href="#40280243">parent</a><span>|</span><a href="#40283244">next</a><span>|</span><label class="collapse" for="c-40280280">[-]</label><label class="expand" for="c-40280280">[4 more]</label></div><br/><div class="children"><div class="content">Is there a way to run an app in a specific VRF nowadays?</div><br/><div id="40280307" class="c"><input type="checkbox" id="c-40280307" checked=""/><div class="controls bullet"><span class="by">isodude</span><span>|</span><a href="#40280243">root</a><span>|</span><a href="#40280280">parent</a><span>|</span><a href="#40280305">next</a><span>|</span><label class="collapse" for="c-40280307">[-]</label><label class="expand" for="c-40280307">[1 more]</label></div><br/><div class="children"><div class="content">Look here: <a href="https:&#x2F;&#x2F;jerryxiao.cc&#x2F;archives&#x2F;1004" rel="nofollow">https:&#x2F;&#x2F;jerryxiao.cc&#x2F;archives&#x2F;1004</a><p>Yes, it&#x27;s eBPF but the solution is quite neat to be honest. And you can integrate it into systemd units.</div><br/></div></div><div id="40280305" class="c"><input type="checkbox" id="c-40280305" checked=""/><div class="controls bullet"><span class="by">tuetuopay</span><span>|</span><a href="#40280243">root</a><span>|</span><a href="#40280280">parent</a><span>|</span><a href="#40280307">prev</a><span>|</span><a href="#40281717">next</a><span>|</span><label class="collapse" for="c-40280305">[-]</label><label class="expand" for="c-40280305">[1 more]</label></div><br/><div class="children"><div class="content">Just like with netns using ip: `ip vrf exec &lt;vrf&gt; &lt;command&gt;`. It’s been available for a while now</div><br/></div></div></div></div></div></div><div id="40283244" class="c"><input type="checkbox" id="c-40283244" checked=""/><div class="controls bullet"><span class="by">dpeckett</span><span>|</span><a href="#40280243">prev</a><span>|</span><a href="#40282947">next</a><span>|</span><label class="collapse" for="c-40283244">[-]</label><label class="expand" for="c-40283244">[1 more]</label></div><br/><div class="children"><div class="content">An interesting (and portable) alternative to network namespaces is to bypass kernel networking entirely and use a userspace network stack.<p>I&#x27;ve got an example of doing just that with my project Noisy Sockets, <a href="https:&#x2F;&#x2F;github.com&#x2F;noisysockets&#x2F;noisysockets&#x2F;blob&#x2F;main&#x2F;examples&#x2F;gateway&#x2F;main.go">https:&#x2F;&#x2F;github.com&#x2F;noisysockets&#x2F;noisysockets&#x2F;blob&#x2F;main&#x2F;examp...</a></div><br/></div></div><div id="40282947" class="c"><input type="checkbox" id="c-40282947" checked=""/><div class="controls bullet"><span class="by">caeruleus</span><span>|</span><a href="#40283244">prev</a><span>|</span><a href="#40281016">next</a><span>|</span><label class="collapse" for="c-40282947">[-]</label><label class="expand" for="c-40282947">[1 more]</label></div><br/><div class="children"><div class="content">This should have been pretty obvious for more technical people, but it&#x27;s a nice introduction into networking and VPNs. I have configured a Linux VPN gateway VM a couple of times now and the reliance on the routing table only always felt brittle, especially when paired with running on the same machine that uses the connection.<p>In addition to network namespaces and physical VPN gateway routers, an architecture based on VMs can thus also solve this. In my homelab, the firewall blocks any unexpected traffic from the VPN gateway VM (devices in the VPN VLAN are not allowed any outgoing connections, the gateway VM has a separate VLAN for outgoing ones). As a personal solution, QubesOS makes configuring a similar setup quite friction-less, but once again requires more technical knowledge than a regular OS.</div><br/></div></div><div id="40281016" class="c"><input type="checkbox" id="c-40281016" checked=""/><div class="controls bullet"><span class="by">Grimeton</span><span>|</span><a href="#40282947">prev</a><span>|</span><a href="#40280348">next</a><span>|</span><label class="collapse" for="c-40281016">[-]</label><label class="expand" for="c-40281016">[1 more]</label></div><br/><div class="children"><div class="content">What else is new?<p>I&#x27;m more worried about people using VPN services that are IP4 only while having IP6 enabled in the system.<p>That can go terribly wrong...</div><br/></div></div><div id="40280348" class="c"><input type="checkbox" id="c-40280348" checked=""/><div class="controls bullet"><span class="by">mrbluecoat</span><span>|</span><a href="#40281016">prev</a><span>|</span><a href="#40280260">next</a><span>|</span><label class="collapse" for="c-40280348">[-]</label><label class="expand" for="c-40280348">[4 more]</label></div><br/><div class="children"><div class="content">&gt; because Android does not implement support for DHCP option 121, it was uniquely unaffected<p>Curious if that was a deliberate decision because Google knew about this or completely coincidental..</div><br/><div id="40280946" class="c"><input type="checkbox" id="c-40280946" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#40280348">parent</a><span>|</span><a href="#40280430">next</a><span>|</span><label class="collapse" for="c-40280946">[-]</label><label class="expand" for="c-40280946">[1 more]</label></div><br/><div class="children"><div class="content">Looking at <a href="https:&#x2F;&#x2F;issuetracker.google.com&#x2F;issues&#x2F;117544989" rel="nofollow">https:&#x2F;&#x2F;issuetracker.google.com&#x2F;issues&#x2F;117544989</a> seems like Google mostly just ignored this feature request without giving any reason. I wonder the same. Perhaps someone who works at Google with access to the internal Buganizer will know more.<p>But if you want me to speculate, my speculation is that the team behind Android networking is highly pro-IPv6. They don&#x27;t really care about missing niche features in IPv4. Even for IPv6 they have a specific vision for how IPv6 should be used, resulting in deliberate non-support of features like stateful DHCPv6.</div><br/></div></div><div id="40280430" class="c"><input type="checkbox" id="c-40280430" checked=""/><div class="controls bullet"><span class="by">skissane</span><span>|</span><a href="#40280348">parent</a><span>|</span><a href="#40280946">prev</a><span>|</span><a href="#40280515">next</a><span>|</span><label class="collapse" for="c-40280430">[-]</label><label class="expand" for="c-40280430">[1 more]</label></div><br/><div class="children"><div class="content">There are so many DHCP options, for something like Android it makes sense to start with only supporting the bare minimum and then only enable support for an additional option if there is a requirement raised for it. Given this DHCP option isn’t commonly used, such a strategy would likely result in it not being supported, irrespective of any security concerns with it.</div><br/></div></div><div id="40280515" class="c"><input type="checkbox" id="c-40280515" checked=""/><div class="controls bullet"><span class="by">megous</span><span>|</span><a href="#40280348">parent</a><span>|</span><a href="#40280430">prev</a><span>|</span><a href="#40280260">next</a><span>|</span><label class="collapse" for="c-40280515">[-]</label><label class="expand" for="c-40280515">[1 more]</label></div><br/><div class="children"><div class="content">Android doesn&#x27;t even implement the new DHCP version defined first 21 years ago:<p><a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc3315" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc3315</a><p>So not really a surprise.</div><br/></div></div></div></div><div id="40280260" class="c"><input type="checkbox" id="c-40280260" checked=""/><div class="controls bullet"><span class="by">EasyMark</span><span>|</span><a href="#40280348">prev</a><span>|</span><a href="#40283355">next</a><span>|</span><label class="collapse" for="c-40280260">[-]</label><label class="expand" for="c-40280260">[8 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t seen anywhere that said there can be a &quot;fix&quot; for this outside of not allowing &quot;option 121&quot; to be in use at all the DHCP server. Is there no way to mitigate this in the VPN client, or is it simply too fundamental to the way the networks work that there is and never can be a &quot;fix&quot; on the VPN client? I wouldn&#x27;t expect a malware laden network&#x27;s  &quot;admin&quot; to ever fix this or even hear about it.</div><br/><div id="40280296" class="c"><input type="checkbox" id="c-40280296" checked=""/><div class="controls bullet"><span class="by">morattisec</span><span>|</span><a href="#40280260">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40280296">[-]</label><label class="expand" for="c-40280296">[6 more]</label></div><br/><div class="children"><div class="content">The only fix we’ve observed in the wild was limited to Linux hosts. WireGuard has documentation about how to implement that properly using network namespaces which can be used to isolate network stacks. <a href="https:&#x2F;&#x2F;www.wireguard.com&#x2F;netns&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.wireguard.com&#x2F;netns&#x2F;</a> however, the VPN provider must implement it this way. In our demo we use WireGuard that is implemented without namespaces.<p>The other operating systems do not support that feature. The mitigations we saw were firewall based rules, which create a side-channel that be used to leak the destination of traffic.</div><br/><div id="40280324" class="c"><input type="checkbox" id="c-40280324" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40280260">root</a><span>|</span><a href="#40280296">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40280324">[-]</label><label class="expand" for="c-40280324">[5 more]</label></div><br/><div class="children"><div class="content">The &quot;side channel&quot; is silly. You assume someone is hitting the same endpoint over and over and over and with significantly high traffic that it rises above the noise.<p>Did u even do any of the math required to demonstrate it can actually work in a reasonable time frame? Did u clearly list the very onerous assumptions required to pull it off?<p>This whole thing is silly.</div><br/><div id="40280470" class="c"><input type="checkbox" id="c-40280470" checked=""/><div class="controls bullet"><span class="by">morattisec</span><span>|</span><a href="#40280260">root</a><span>|</span><a href="#40280324">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40280470">[-]</label><label class="expand" for="c-40280470">[4 more]</label></div><br/><div class="children"><div class="content">So in the example we gave for the side-channel you’d be correct that “it depends”. We also wrote that it was flexible.<p>I do want to point out that you could deny all traffic except allow a single IP address to test the inverse in a low traffic setting. With a low DHCP lease time it’s feasible that could look like a shaky connection. This is only possible because the kill switches don’t actually disconnect the user.<p>There’s also mitigation bypasses that are likely to be discovered, we have a few we’re working on.</div><br/><div id="40280518" class="c"><input type="checkbox" id="c-40280518" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40280260">root</a><span>|</span><a href="#40280470">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40280518">[-]</label><label class="expand" for="c-40280518">[3 more]</label></div><br/><div class="children"><div class="content">The side channel attack is silly and impractical. You know it&#x27;s silly. I know it&#x27;s silly. Let&#x27;s quit pretending.<p>The firewall rule is 100% sufficient to defend against this exploit. All good VPNs already provide it by default. It&#x27;s not deep. They&#x27;re just routes.<p>Please stop the FUD.</div><br/><div id="40281189" class="c"><input type="checkbox" id="c-40281189" checked=""/><div class="controls bullet"><span class="by">StressedDev</span><span>|</span><a href="#40280260">root</a><span>|</span><a href="#40280518">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40281189">[-]</label><label class="expand" for="c-40281189">[2 more]</label></div><br/><div class="children"><div class="content">Side channels are a huge danger.  An example is cryptographic functions have been cracked because of timing differences based on the key or data being encrypted.  This is why cryptographic ciphers are implemented in constant time code (i.e. code that always runs in the same amount of time regardless of its input).</div><br/><div id="40281261" class="c"><input type="checkbox" id="c-40281261" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40280260">root</a><span>|</span><a href="#40281189">parent</a><span>|</span><a href="#40280297">next</a><span>|</span><label class="collapse" for="c-40281261">[-]</label><label class="expand" for="c-40281261">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m talking about the <i>specific side channel attack</i> mentioned in their report. Not side channels generally ;)</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40280297" class="c"><input type="checkbox" id="c-40280297" checked=""/><div class="controls bullet"><span class="by">banister</span><span>|</span><a href="#40280260">parent</a><span>|</span><a href="#40280296">prev</a><span>|</span><a href="#40283355">next</a><span>|</span><label class="collapse" for="c-40280297">[-]</label><label class="expand" for="c-40280297">[1 more]</label></div><br/><div class="children"><div class="content">Most decent VPNs are already protected against it. It&#x27;s a simple firewall rule known as leak protection or a kill switch which blocks all off-VPN traffic including on option 121 routes.<p>This article is 99% FUD IMO.</div><br/></div></div></div></div><div id="40283355" class="c"><input type="checkbox" id="c-40283355" checked=""/><div class="controls bullet"><span class="by">throw156754228</span><span>|</span><a href="#40280260">prev</a><span>|</span><a href="#40280314">next</a><span>|</span><label class="collapse" for="c-40283355">[-]</label><label class="expand" for="c-40283355">[1 more]</label></div><br/><div class="children"><div class="content">Well written, I appreciated the background. Far more enjoyable to read than a good deal of the incoherent articles posted on here.</div><br/></div></div><div id="40280314" class="c"><input type="checkbox" id="c-40280314" checked=""/><div class="controls bullet"><span class="by">jeroenhd</span><span>|</span><a href="#40283355">prev</a><span>|</span><a href="#40279746">next</a><span>|</span><label class="collapse" for="c-40280314">[-]</label><label class="expand" for="c-40280314">[1 more]</label></div><br/><div class="children"><div class="content">&gt; We noted that because Android does not implement support for DHCP option 121, it was uniquely unaffected.<p>Phew, that was my biggest concern. This would&#x27;ve been pretty difficult to work around (as are Android&#x27;s well-known VPN bypasses through system apps, but those need local execution privileges).</div><br/></div></div><div id="40279746" class="c"><input type="checkbox" id="c-40279746" checked=""/><div class="controls bullet"><span class="by">the8472</span><span>|</span><a href="#40280314">prev</a><span>|</span><a href="#40283290">next</a><span>|</span><label class="collapse" for="c-40279746">[-]</label><label class="expand" for="c-40279746">[1 more]</label></div><br/><div class="children"><div class="content">linux not affected <i>if</i> network namespaces are used to separate vpn and physical interfaces.</div><br/></div></div><div id="40283290" class="c"><input type="checkbox" id="c-40283290" checked=""/><div class="controls bullet"><span class="by">throwinway</span><span>|</span><a href="#40279746">prev</a><span>|</span><a href="#40280284">next</a><span>|</span><label class="collapse" for="c-40283290">[-]</label><label class="expand" for="c-40283290">[1 more]</label></div><br/><div class="children"><div class="content">Is disabling DHCP a mitigation?</div><br/></div></div><div id="40280284" class="c"><input type="checkbox" id="c-40280284" checked=""/><div class="controls bullet"><span class="by">isodude</span><span>|</span><a href="#40283290">prev</a><span>|</span><a href="#40282528">next</a><span>|</span><label class="collapse" for="c-40280284">[-]</label><label class="expand" for="c-40280284">[3 more]</label></div><br/><div class="children"><div class="content">I saw a github project that tries to make wireguard+netns more easy to setup: <a href="https:&#x2F;&#x2F;github.com&#x2F;kalken&#x2F;eznetns">https:&#x2F;&#x2F;github.com&#x2F;kalken&#x2F;eznetns</a></div><br/><div id="40280355" class="c"><input type="checkbox" id="c-40280355" checked=""/><div class="controls bullet"><span class="by">rnewme</span><span>|</span><a href="#40280284">parent</a><span>|</span><a href="#40282528">next</a><span>|</span><label class="collapse" for="c-40280355">[-]</label><label class="expand" for="c-40280355">[2 more]</label></div><br/><div class="children"><div class="content">What would be the opposite approach, to make sure all traffic goes through VPN, and only VPN, even if user didn&#x27;t start the VPN connection (default to no connectivity)? Is there better approach then just disabling all other network interfaces?</div><br/><div id="40280413" class="c"><input type="checkbox" id="c-40280413" checked=""/><div class="controls bullet"><span class="by">isodude</span><span>|</span><a href="#40280284">root</a><span>|</span><a href="#40280355">parent</a><span>|</span><a href="#40282528">next</a><span>|</span><label class="collapse" for="c-40280413">[-]</label><label class="expand" for="c-40280413">[1 more]</label></div><br/><div class="children"><div class="content">AFAIK Wireguard will always listen in the default namespace, thus you need to isolate everything else. A fun way of doing it though is to do an ip rule that uses the VRF table, and matches on the user id. That way all traffic from certain users will always end up in the same routing table. You can go further and match on everything except the Wireguard endpoint. With iptables you can MARK the traffic you want to be differently and then catch that traffic with ip rule.</div><br/></div></div></div></div></div></div><div id="40282528" class="c"><input type="checkbox" id="c-40282528" checked=""/><div class="controls bullet"><span class="by">exabrial</span><span>|</span><a href="#40280284">prev</a><span>|</span><a href="#40279995">next</a><span>|</span><label class="collapse" for="c-40282528">[-]</label><label class="expand" for="c-40282528">[1 more]</label></div><br/><div class="children"><div class="content">Same like on device vpns are pretty sketchy.</div><br/></div></div><div id="40279995" class="c"><input type="checkbox" id="c-40279995" checked=""/><div class="controls bullet"><span class="by">tristor</span><span>|</span><a href="#40282528">prev</a><span>|</span><a href="#40282351">next</a><span>|</span><label class="collapse" for="c-40279995">[-]</label><label class="expand" for="c-40279995">[7 more]</label></div><br/><div class="children"><div class="content">There are numerous ways to defeat a VPN on a client device, this is why I prefer to put a router that terminates VPN tunnels with no other available routes between my clients and the Internet when I feel the need for a VPN.  You can trivially set up one of these &quot;travel routers&quot; and carry it with you everywhere, which is exactly what I do.</div><br/><div id="40280138" class="c"><input type="checkbox" id="c-40280138" checked=""/><div class="controls bullet"><span class="by">AnotherGoodName</span><span>|</span><a href="#40279995">parent</a><span>|</span><a href="#40282685">next</a><span>|</span><label class="collapse" for="c-40280138">[-]</label><label class="expand" for="c-40280138">[3 more]</label></div><br/><div class="children"><div class="content">I highly encourage dedicated VPN routers at home with each router having it&#x27;s own wifi network as a way to connect to VPNs. It&#x27;s easier to connect and more reliable than locally running VPN software on each device imho.<p>Eg. I have a router sharing wifi for &#x27;work&#x27; with a permanently maintained vpn connection to the workplace intranet. Another sharing wifi as &#x27;Australia&#x27; that I connect to whenever I want to watch TV from Australia with a VPN to an Australian server and lastly the standard home Internet wifi.<p>It&#x27;s super easy to do if you have a couple of old wifi routers and even cheap home ones seem to have some VPN support these days. A big advantage, aside from centralizing the VPN setup so you don&#x27;t screw it up is that it&#x27;s trivial to connect any device to the VPN. Just join the relevant wifi address! Boom I&#x27;m now in a VPN to Australia from any device without messing around setting up that device specifically because I connected to the &#x27;Australia&#x27; wifi.<p>I do this with multiple old routers but I actually think there&#x27;s probably a market for a single home router that vpns to multiple locations in the world with a different wifi network for each of those just for the sake of easily having your TV&#x2F;Roku&#x2F;iPad appearing to be from somewhere else trivially.</div><br/><div id="40280406" class="c"><input type="checkbox" id="c-40280406" checked=""/><div class="controls bullet"><span class="by">CommitSyn</span><span>|</span><a href="#40279995">root</a><span>|</span><a href="#40280138">parent</a><span>|</span><a href="#40282685">next</a><span>|</span><label class="collapse" for="c-40280406">[-]</label><label class="expand" for="c-40280406">[2 more]</label></div><br/><div class="children"><div class="content">Is there a simple DIY? Is it as simple as running a custom router firmware or software on a small mini PC? Last I looked into this a couple years ago, it basically wasn&#x27;t possible to chain multiple VPN providers on the same machine, even using VPNs, but maybe I&#x27;m misremembering. You could of course just use the built-in VPN connection of your router, but that lacks all the benefits of updated software&#x2F;firewall, and I want my family to be able to watch Netflix, browse the web without running a CAPTCHAthon, etc.</div><br/><div id="40282483" class="c"><input type="checkbox" id="c-40282483" checked=""/><div class="controls bullet"><span class="by">madars</span><span>|</span><a href="#40279995">root</a><span>|</span><a href="#40280406">parent</a><span>|</span><a href="#40282685">next</a><span>|</span><label class="collapse" for="c-40282483">[-]</label><label class="expand" for="c-40282483">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;kiljan.org&#x2F;2021&#x2F;12&#x2F;14&#x2F;vpn-as-wan-for-guest-network-on-openwrt-2021-edition&#x2F;" rel="nofollow">https:&#x2F;&#x2F;kiljan.org&#x2F;2021&#x2F;12&#x2F;14&#x2F;vpn-as-wan-for-guest-network-o...</a> is a great start for how to set up a WiFi network with an always-on VPN</div><br/></div></div></div></div></div></div><div id="40282685" class="c"><input type="checkbox" id="c-40282685" checked=""/><div class="controls bullet"><span class="by">varenc</span><span>|</span><a href="#40279995">parent</a><span>|</span><a href="#40280138">prev</a><span>|</span><a href="#40280139">next</a><span>|</span><label class="collapse" for="c-40282685">[-]</label><label class="expand" for="c-40282685">[1 more]</label></div><br/><div class="children"><div class="content">The attack is only possible when you have untrusted devices on your local LAN. If you’re already bringing your own gateway with a VPN on it then I’m guessing untrusted LAN devices aren’t much of a concern. But if you did have something untrusted on your LAN and you’re using DHCP, then that untrusted device could snoop your unencrypted* traffic with this trick, albeit it couldn’t find your real IP since your gateway is concealing that.<p>The attack seems most feasible in a coffee shop wifi situation, where you’re unlikely to be bringing your own router.<p>*by “unencrypted traffic” I mean traffic that’s not encapsulated for transport to your VPN provider. Most everything is HTTPS nowadays so the contents of that traffic would still be encrypted of course.</div><br/></div></div><div id="40280139" class="c"><input type="checkbox" id="c-40280139" checked=""/><div class="controls bullet"><span class="by">wolverine876</span><span>|</span><a href="#40279995">parent</a><span>|</span><a href="#40282685">prev</a><span>|</span><a href="#40280276">next</a><span>|</span><label class="collapse" for="c-40280139">[-]</label><label class="expand" for="c-40280139">[1 more]</label></div><br/><div class="children"><div class="content">If you could list some hardware and software, it would save us the effort ...</div><br/></div></div><div id="40280276" class="c"><input type="checkbox" id="c-40280276" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40279995">parent</a><span>|</span><a href="#40280139">prev</a><span>|</span><a href="#40282351">next</a><span>|</span><label class="collapse" for="c-40280276">[-]</label><label class="expand" for="c-40280276">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d imagine most travel routers are still vulnerable to this.</div><br/></div></div></div></div><div id="40282351" class="c"><input type="checkbox" id="c-40282351" checked=""/><div class="controls bullet"><span class="by">ranger_danger</span><span>|</span><a href="#40279995">prev</a><span>|</span><a href="#40279924">next</a><span>|</span><label class="collapse" for="c-40282351">[-]</label><label class="expand" for="c-40282351">[1 more]</label></div><br/><div class="children"><div class="content">Good thing I don&#x27;t use DHCP.</div><br/></div></div><div id="40279924" class="c"><input type="checkbox" id="c-40279924" checked=""/><div class="controls bullet"><span class="by">ls612</span><span>|</span><a href="#40282351">prev</a><span>|</span><a href="#40280359">next</a><span>|</span><label class="collapse" for="c-40279924">[-]</label><label class="expand" for="c-40279924">[9 more]</label></div><br/><div class="children"><div class="content">So for this attack does the attacker need to control your internet router? Or does it only need to control ISP infrastructure?</div><br/><div id="40280007" class="c"><input type="checkbox" id="c-40280007" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#40279924">parent</a><span>|</span><a href="#40280359">next</a><span>|</span><label class="collapse" for="c-40280007">[-]</label><label class="expand" for="c-40280007">[8 more]</label></div><br/><div class="children"><div class="content">Pretty sure the attacker has to control your DHCP server, which in ex. a home environment is usually the router.</div><br/><div id="40280094" class="c"><input type="checkbox" id="c-40280094" checked=""/><div class="controls bullet"><span class="by">tinco</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280007">parent</a><span>|</span><a href="#40280133">next</a><span>|</span><label class="collapse" for="c-40280094">[-]</label><label class="expand" for="c-40280094">[3 more]</label></div><br/><div class="children"><div class="content">No, the attacker just has to be on the network. When on the network the attacker can deploy various techniques to become the DHCP server. Since it&#x27;s (relatively) easy to become a DHCP server on a network, it&#x27;s considered a big deal when the DHCP server can trick you into doing something like in this case decloaking your VPN traffic.</div><br/><div id="40280134" class="c"><input type="checkbox" id="c-40280134" checked=""/><div class="controls bullet"><span class="by">ls612</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280094">parent</a><span>|</span><a href="#40280133">next</a><span>|</span><label class="collapse" for="c-40280134">[-]</label><label class="expand" for="c-40280134">[2 more]</label></div><br/><div class="children"><div class="content">What is the fix for this vulnerability? Is it the router that needs to get a software update, the VPN client, the OS, or some&#x2F;all of the above?</div><br/><div id="40280561" class="c"><input type="checkbox" id="c-40280561" checked=""/><div class="controls bullet"><span class="by">tinco</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280134">parent</a><span>|</span><a href="#40280133">next</a><span>|</span><label class="collapse" for="c-40280561">[-]</label><label class="expand" for="c-40280561">[1 more]</label></div><br/><div class="children"><div class="content">The OS needs an extra feature, and then clients need to make use of that feature. There&#x27;s other workarounds listed in the &quot;Mitigations&quot; section of the post. But the problem is basically that everything is working as intended, for example if you disable the &quot;Option 121&quot; feature then under certain circumstances you might not have internet connection. Apparently Android devices don&#x27;t support Option 121 at all, and it makes them unaffected by this vulnerability, but also causes to sometimes not be able to connect to networks.</div><br/></div></div></div></div></div></div><div id="40280133" class="c"><input type="checkbox" id="c-40280133" checked=""/><div class="controls bullet"><span class="by">morattisec</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280007">parent</a><span>|</span><a href="#40280094">prev</a><span>|</span><a href="#40280219">next</a><span>|</span><label class="collapse" for="c-40280133">[-]</label><label class="expand" for="c-40280133">[2 more]</label></div><br/><div class="children"><div class="content">This is mostly correct, in our POC video we showcase a lab where we go from being an adjacent host on the network to being the DHCP server.<p>We did this by DHCP starving the true DHCP server and hoarding all the leases. Then we serve our own and do not have to compete with the true DHCP.<p>There’s network protections against this such as guest network isolation or switches with DHCP snooping protections. However, those are usually on enterprises and relying on those being in place kind of removes the point of “securing an untrusted network” like many VPN providers claim.</div><br/><div id="40281573" class="c"><input type="checkbox" id="c-40281573" checked=""/><div class="controls bullet"><span class="by">champtar</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280133">parent</a><span>|</span><a href="#40280219">next</a><span>|</span><label class="collapse" for="c-40281573">[-]</label><label class="expand" for="c-40281573">[1 more]</label></div><br/><div class="children"><div class="content">You should play with IPv6, you can bypass IPv6 RA Guard on some switches (including Cisco) <a href="https:&#x2F;&#x2F;blog.champtar.fr&#x2F;VLAN0_LLC_SNAP&#x2F;" rel="nofollow">https:&#x2F;&#x2F;blog.champtar.fr&#x2F;VLAN0_LLC_SNAP&#x2F;</a>, allowing attacks in &#x27;trusted&#x27; networks</div><br/></div></div></div></div><div id="40280219" class="c"><input type="checkbox" id="c-40280219" checked=""/><div class="controls bullet"><span class="by">lsllc</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280007">parent</a><span>|</span><a href="#40280133">prev</a><span>|</span><a href="#40280359">next</a><span>|</span><label class="collapse" for="c-40280219">[-]</label><label class="expand" for="c-40280219">[2 more]</label></div><br/><div class="children"><div class="content">Many networking switches&#x2F;systems (e.g. UniFi from Ubiquiti) let you enable DHCP Snooping which drops Layer 2 traffic from rogue DHCP servers to prevent this:<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;DHCP_snooping" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;DHCP_snooping</a></div><br/><div id="40281647" class="c"><input type="checkbox" id="c-40281647" checked=""/><div class="controls bullet"><span class="by">champtar</span><span>|</span><a href="#40279924">root</a><span>|</span><a href="#40280219">parent</a><span>|</span><a href="#40280359">next</a><span>|</span><label class="collapse" for="c-40281647">[-]</label><label class="expand" for="c-40281647">[1 more]</label></div><br/><div class="children"><div class="content">I invite you to not trust blindly L2 security features, anything that use denylist approach can miss some corner cases, have a good read :) <a href="https:&#x2F;&#x2F;blog.champtar.fr&#x2F;VLAN0_LLC_SNAP&#x2F;" rel="nofollow">https:&#x2F;&#x2F;blog.champtar.fr&#x2F;VLAN0_LLC_SNAP&#x2F;</a></div><br/></div></div></div></div></div></div></div></div><div id="40279748" class="c"><input type="checkbox" id="c-40279748" checked=""/><div class="controls bullet"><span class="by">acer4666</span><span>|</span><a href="#40280359">prev</a><span>|</span><a href="#40279804">next</a><span>|</span><label class="collapse" for="c-40279748">[-]</label><label class="expand" for="c-40279748">[8 more]</label></div><br/><div class="children"><div class="content">Is there a tl;dr so we don&#x27;t have to wade through swathes of AI generated text explaining what a network is?</div><br/><div id="40279793" class="c"><input type="checkbox" id="c-40279793" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#40279748">parent</a><span>|</span><a href="#40279971">next</a><span>|</span><label class="collapse" for="c-40279793">[-]</label><label class="expand" for="c-40279793">[3 more]</label></div><br/><div class="children"><div class="content">An attacker who controls the DHCP server can give your device more specific routes and this apparently can cause traffic to go over those routes instead of the VPN. So if your VPN says that it&#x27;s taking traffic for 0.0.0.0&#x2F;0, and the DHCP server says 0.0.0.0&#x2F;1 and 1.0.0.0&#x2F;1 route over 10.1.1.1, then all your traffic gets sent over 10.1.1.1 because those routes are more specific so they &quot;win&quot;.<p>(Please feel free to correct if I&#x27;ve missed something; this was my interpretation of <a href="https:&#x2F;&#x2F;arstechnica.com&#x2F;security&#x2F;2024&#x2F;05&#x2F;novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose&#x2F;" rel="nofollow">https:&#x2F;&#x2F;arstechnica.com&#x2F;security&#x2F;2024&#x2F;05&#x2F;novel-attack-agains...</a> )</div><br/><div id="40280922" class="c"><input type="checkbox" id="c-40280922" checked=""/><div class="controls bullet"><span class="by">rahimnathwani</span><span>|</span><a href="#40279748">root</a><span>|</span><a href="#40279793">parent</a><span>|</span><a href="#40279885">next</a><span>|</span><label class="collapse" for="c-40280922">[-]</label><label class="expand" for="c-40280922">[1 more]</label></div><br/><div class="children"><div class="content">&gt; can cause traffic to go over those routes instead of the VPN<p>AIUI the vulnerability is more about forcing traffic via a specific <i>interface</i> than it is about the setting the <i>route</i>. The host&#x27;s routing table contains at least these fields:<p>A) destination (IP or subnet)<p>B) gateway (aka route, aka next hop)<p>C) interface<p>The article says that when the route is set using DHCP Option 21, the interface field is set to the interface on which the DHCP response was received. So, if I&#x27;ve understood the article correctly, even if the route&#x2F;gateway address is correct and not malicious, the host will send out packets for that destination via the regular (wifi or ethernet) interface, instead of the VPN interface.<p>Imagine a coffee shop scenario: a malicious DHCP server responds to your DHCP request. It includes Option 121, making certain traffic go to the 10.0.0.1 (the coffee shop router address). Now, even though that gateway isn&#x27;t malicious, the fact that the traffic is now going over the wifi interface instead of VPN, means someone can snoop on it.</div><br/></div></div><div id="40279885" class="c"><input type="checkbox" id="c-40279885" checked=""/><div class="controls bullet"><span class="by">sixothree</span><span>|</span><a href="#40279748">root</a><span>|</span><a href="#40279793">parent</a><span>|</span><a href="#40280922">prev</a><span>|</span><a href="#40279971">next</a><span>|</span><label class="collapse" for="c-40279885">[-]</label><label class="expand" for="c-40279885">[1 more]</label></div><br/><div class="children"><div class="content">Will static IP and gateway alleviate this threat? I guess at what level too.</div><br/></div></div></div></div><div id="40279971" class="c"><input type="checkbox" id="c-40279971" checked=""/><div class="controls bullet"><span class="by">krebsonsecurity</span><span>|</span><a href="#40279748">parent</a><span>|</span><a href="#40279793">prev</a><span>|</span><a href="#40279763">next</a><span>|</span><label class="collapse" for="c-40279971">[-]</label><label class="expand" for="c-40279971">[1 more]</label></div><br/><div class="children"><div class="content">I interviewed some smart people about their research in story published today:<p><a href="https:&#x2F;&#x2F;krebsonsecurity.com&#x2F;2024&#x2F;05&#x2F;why-your-vpn-may-not-be-as-secure-as-it-claims&#x2F;" rel="nofollow">https:&#x2F;&#x2F;krebsonsecurity.com&#x2F;2024&#x2F;05&#x2F;why-your-vpn-may-not-be-...</a></div><br/></div></div><div id="40279763" class="c"><input type="checkbox" id="c-40279763" checked=""/><div class="controls bullet"><span class="by">rahimnathwani</span><span>|</span><a href="#40279748">parent</a><span>|</span><a href="#40279971">prev</a><span>|</span><a href="#40280039">next</a><span>|</span><label class="collapse" for="c-40279763">[-]</label><label class="expand" for="c-40279763">[1 more]</label></div><br/><div class="children"><div class="content">Scroll down to &quot;What is DHCP option 121?&quot; and start reading there.</div><br/></div></div><div id="40280039" class="c"><input type="checkbox" id="c-40280039" checked=""/><div class="controls bullet"><span class="by">morattisec</span><span>|</span><a href="#40279748">parent</a><span>|</span><a href="#40279763">prev</a><span>|</span><a href="#40279804">next</a><span>|</span><label class="collapse" for="c-40280039">[-]</label><label class="expand" for="c-40280039">[2 more]</label></div><br/><div class="children"><div class="content">You probably followed the advice to read from the 121 section already but if you’re sharing this others it might be helpful to link our website that serves as a TLDR + FAQ. 
<a href="https:&#x2F;&#x2F;tunnelvisionbug.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;tunnelvisionbug.com&#x2F;</a><p>There’s also a general public advisory there that’s supposed to be for anyone non-technical but who wants to understand the issue. All this content was also written by hand over 8ish months too, no AI was used</div><br/><div id="40280084" class="c"><input type="checkbox" id="c-40280084" checked=""/><div class="controls bullet"><span class="by">wrs</span><span>|</span><a href="#40279748">root</a><span>|</span><a href="#40280039">parent</a><span>|</span><a href="#40279804">next</a><span>|</span><label class="collapse" for="c-40280084">[-]</label><label class="expand" for="c-40280084">[1 more]</label></div><br/><div class="children"><div class="content">This is a great explanation of basic networking mechanisms that most people know almost nothing about. Don’t listen to the haters.<p>I feel that I’m in a high percentile for networking knowledge, but I didn’t know about option 121!</div><br/></div></div></div></div></div></div><div id="40279804" class="c"><input type="checkbox" id="c-40279804" checked=""/><div class="controls bullet"><span class="by">formerly_proven</span><span>|</span><a href="#40279748">prev</a><span>|</span><a href="#40282458">next</a><span>|</span><label class="collapse" for="c-40279804">[-]</label><label class="expand" for="c-40279804">[4 more]</label></div><br/><div class="children"><div class="content">tldr DHCP can add routes, so it can add routes for the internal network of a VPN. It’s not obvious to me why this works, because VPNs set metric 1 on their routes, that’s why traffic goes into them regardless of what IP the  surrounding network used. DHCP option 121 has no metric field, so it should get a high default metric and shouldn’t have any impact on a VPN with specific routes. If you only “set the default gateway” (0.0.0.0&#x2F;0 route), then this probably works. But that also seems particularly amateurish, even for enterprise VPN admins.</div><br/><div id="40279872" class="c"><input type="checkbox" id="c-40279872" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40279804">parent</a><span>|</span><a href="#40279827">next</a><span>|</span><label class="collapse" for="c-40279872">[-]</label><label class="expand" for="c-40279872">[1 more]</label></div><br/><div class="children"><div class="content">More specific routes are higher priority than less specific ones, so 0.0.0.0&#x2F;1 is chosen over one for 0.0.0.0&#x2F;0 even with metric 1.</div><br/></div></div><div id="40279827" class="c"><input type="checkbox" id="c-40279827" checked=""/><div class="controls bullet"><span class="by">ikiris</span><span>|</span><a href="#40279804">parent</a><span>|</span><a href="#40279872">prev</a><span>|</span><a href="#40282458">next</a><span>|</span><label class="collapse" for="c-40279827">[-]</label><label class="expand" for="c-40279827">[2 more]</label></div><br/><div class="children"><div class="content">because unless you have matching routes, most specific wins</div><br/></div></div></div></div><div id="40279907" class="c"><input type="checkbox" id="c-40279907" checked=""/><div class="controls bullet"><span class="by">fargle</span><span>|</span><a href="#40282458">prev</a><span>|</span><a href="#40280982">next</a><span>|</span><label class="collapse" for="c-40279907">[-]</label><label class="expand" for="c-40279907">[6 more]</label></div><br/><div class="children"><div class="content">always the breathless sensationalized vulnerability headlines...<p>it&#x27;s interesting, but of limited usefulness - the device has to accept responses from a dhcp server. if an attacker controls a dhcp server, he&#x27;s either on the network already or has already had to do a lot worse than installing a couple static routes to get there.<p>it&#x27;s not nothing - a compromised home gateway could use this technique to sneak into a corporate VPN via a users&#x27; laptop, but if you have a compromised home gateway, you have a <i>lot</i> of other problems that could lead to the same result.</div><br/><div id="40279994" class="c"><input type="checkbox" id="c-40279994" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40279907">parent</a><span>|</span><a href="#40280982">next</a><span>|</span><label class="collapse" for="c-40279994">[-]</label><label class="expand" for="c-40279994">[5 more]</label></div><br/><div class="children"><div class="content">I think a public wifi network effectively being able to disable someone&#x27;s VPN is pretty bad.</div><br/><div id="40280128" class="c"><input type="checkbox" id="c-40280128" checked=""/><div class="controls bullet"><span class="by">JackSlateur</span><span>|</span><a href="#40279907">root</a><span>|</span><a href="#40279994">parent</a><span>|</span><a href="#40280795">next</a><span>|</span><label class="collapse" for="c-40280128">[-]</label><label class="expand" for="c-40280128">[2 more]</label></div><br/><div class="children"><div class="content">There are lots of ways to disable vpn : basic firewall on the router, if you have access
ARP poisoning if you do not.</div><br/><div id="40280178" class="c"><input type="checkbox" id="c-40280178" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40279907">root</a><span>|</span><a href="#40280128">parent</a><span>|</span><a href="#40280795">next</a><span>|</span><label class="collapse" for="c-40280178">[-]</label><label class="expand" for="c-40280178">[1 more]</label></div><br/><div class="children"><div class="content">Yes, but this disables a user&#x27;s VPN without alerting the user.<p>Firewalling off their VPN service would cause a visible connection failure.</div><br/></div></div></div></div><div id="40280795" class="c"><input type="checkbox" id="c-40280795" checked=""/><div class="controls bullet"><span class="by">fargle</span><span>|</span><a href="#40279907">root</a><span>|</span><a href="#40279994">parent</a><span>|</span><a href="#40280128">prev</a><span>|</span><a href="#40280982">next</a><span>|</span><label class="collapse" for="c-40280795">[-]</label><label class="expand" for="c-40280795">[2 more]</label></div><br/><div class="children"><div class="content">if you are on a public wifi, particularly if you can control an evil dhcp server, there are sooo many other ways to attack someone&#x27;s pc client and network. this is just another. it doesn&#x27;t even seem that unexpected.</div><br/><div id="40281165" class="c"><input type="checkbox" id="c-40281165" checked=""/><div class="controls bullet"><span class="by">vel0city</span><span>|</span><a href="#40279907">root</a><span>|</span><a href="#40280795">parent</a><span>|</span><a href="#40280982">next</a><span>|</span><label class="collapse" for="c-40281165">[-]</label><label class="expand" for="c-40281165">[1 more]</label></div><br/><div class="children"><div class="content">But this heavily undermines one major selling point VPN providers use: safety on public wifi and other untrusted networks.</div><br/></div></div></div></div></div></div></div></div><div id="40280982" class="c"><input type="checkbox" id="c-40280982" checked=""/><div class="controls bullet"><span class="by">betaby</span><span>|</span><a href="#40279907">prev</a><span>|</span><a href="#40279841">next</a><span>|</span><label class="collapse" for="c-40280982">[-]</label><label class="expand" for="c-40280982">[3 more]</label></div><br/><div class="children"><div class="content">This is a perfect example of the CVE mining.<p>There is nothing novel in the attack nor it&#x27;s a security problem.
DHCP environment <i>must</i> be trusted.
We do have IP Source Guard and DHCP Snooping for decades to avoid scenarios from that link ( and many other).</div><br/><div id="40281146" class="c"><input type="checkbox" id="c-40281146" checked=""/><div class="controls bullet"><span class="by">StressedDev</span><span>|</span><a href="#40280982">parent</a><span>|</span><a href="#40279841">next</a><span>|</span><label class="collapse" for="c-40281146">[-]</label><label class="expand" for="c-40281146">[2 more]</label></div><br/><div class="children"><div class="content">I have never heard anyone claim that VPNs only work if DHCP can be trusted.  Note that that means trusting all devices on a network because any device can be a DHCP server.<p>This is a great find and a real security bug.  I cannot believe how many people are downplaying this work.</div><br/><div id="40281924" class="c"><input type="checkbox" id="c-40281924" checked=""/><div class="controls bullet"><span class="by">betaby</span><span>|</span><a href="#40280982">root</a><span>|</span><a href="#40281146">parent</a><span>|</span><a href="#40279841">next</a><span>|</span><label class="collapse" for="c-40281924">[-]</label><label class="expand" for="c-40281924">[1 more]</label></div><br/><div class="children"><div class="content">It has nothing to do with VPN. Attack on the mined CVE is a general type of the malicious DHCP attack described in any CCNA level book since 90s.</div><br/></div></div></div></div></div></div><div id="40279841" class="c"><input type="checkbox" id="c-40279841" checked=""/><div class="controls bullet"><span class="by">bedobi</span><span>|</span><a href="#40280982">prev</a><span>|</span><label class="collapse" for="c-40279841">[-]</label><label class="expand" for="c-40279841">[15 more]</label></div><br/><div class="children"><div class="content">VPN can be trivially defeated any number of ways. I was shocked when I first learned this ten fifteen years ago through a site that showed my internet provider and location despite being on a VPN. I forgot the name of the site.<p>A huge problem that doesn&#x27;t even require defeating is, most OSs and VPN clients, if the connection is shaky, just reverts to the default connection. Even a single packet is enough for your VPN to be worth nothing. In Ubuntu, it required setting up elaborate firewall rules and activate them after you get a stable VPN connection to avoid this. (and even that doesn&#x27;t protect you from DNS and other stuff being able to track you) (let alone cookies which reveal who you are etc etc)</div><br/><div id="40283552" class="c"><input type="checkbox" id="c-40283552" checked=""/><div class="controls bullet"><span class="by">vardump</span><span>|</span><a href="#40279841">parent</a><span>|</span><a href="#40279927">next</a><span>|</span><label class="collapse" for="c-40283552">[-]</label><label class="expand" for="c-40283552">[1 more]</label></div><br/><div class="children"><div class="content">What leaks your location might just be a DNS request. Depends on the configuration.<p>The site can include a completely unique DNS name as a part of a page. Something like &quot;a5afbdeffe.attacker.com&quot;.</div><br/></div></div><div id="40279927" class="c"><input type="checkbox" id="c-40279927" checked=""/><div class="controls bullet"><span class="by">lxgr</span><span>|</span><a href="#40279841">parent</a><span>|</span><a href="#40283552">prev</a><span>|</span><a href="#40279928">next</a><span>|</span><label class="collapse" for="c-40279927">[-]</label><label class="expand" for="c-40279927">[1 more]</label></div><br/><div class="children"><div class="content">What is a trivial way to reveal a VPN-using website visitor’s actual IP these days? Browsers have improved a lot over the last ten years.<p>&gt; A huge problem that doesn&#x27;t even require defeating is, most OSs and VPN clients, if the connection is shaky, just reverts to the default connection.<p>This is mostly a function of the VPN client, not the OS. Some clients will reinstate default routes pretty quickly when they lose connectivity, others are pretty sticky.<p>At least Android even offers a specific “always-on VPN” option to prevent leaks like that.</div><br/></div></div><div id="40279928" class="c"><input type="checkbox" id="c-40279928" checked=""/><div class="controls bullet"><span class="by">dinobones</span><span>|</span><a href="#40279841">parent</a><span>|</span><a href="#40279927">prev</a><span>|</span><a href="#40280092">next</a><span>|</span><label class="collapse" for="c-40279928">[-]</label><label class="expand" for="c-40279928">[9 more]</label></div><br/><div class="children"><div class="content">Are there any router&#x2F;cheap &quot;bridge&quot; devices that can sit between your router and the internet and force outbound communication to go through the VPN, as if it were your ISP?</div><br/><div id="40279985" class="c"><input type="checkbox" id="c-40279985" checked=""/><div class="controls bullet"><span class="by">Hikikomori</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279928">parent</a><span>|</span><a href="#40280156">next</a><span>|</span><label class="collapse" for="c-40279985">[-]</label><label class="expand" for="c-40279985">[3 more]</label></div><br/><div class="children"><div class="content">Just use iptables and only allow the vpn traffic. Or do the same with a small Linux box.</div><br/><div id="40280038" class="c"><input type="checkbox" id="c-40280038" checked=""/><div class="controls bullet"><span class="by">bedobi</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279985">parent</a><span>|</span><a href="#40280156">next</a><span>|</span><label class="collapse" for="c-40280038">[-]</label><label class="expand" for="c-40280038">[2 more]</label></div><br/><div class="children"><div class="content">apparently lots of folks who do this still have problems that a lot of software that promises to do this actually only does it for ipv4, so ipv6 traffic still exposes them, lol</div><br/><div id="40280774" class="c"><input type="checkbox" id="c-40280774" checked=""/><div class="controls bullet"><span class="by">_0ffh</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40280038">parent</a><span>|</span><a href="#40280156">next</a><span>|</span><label class="collapse" for="c-40280774">[-]</label><label class="expand" for="c-40280774">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not unusual to get the recommendation to deactivate ipv6, which isn&#x27;t hard (on Linux at least).</div><br/></div></div></div></div></div></div><div id="40280156" class="c"><input type="checkbox" id="c-40280156" checked=""/><div class="controls bullet"><span class="by">wepple</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279928">parent</a><span>|</span><a href="#40279985">prev</a><span>|</span><a href="#40280010">next</a><span>|</span><label class="collapse" for="c-40280156">[-]</label><label class="expand" for="c-40280156">[2 more]</label></div><br/><div class="children"><div class="content">There have been a bunch of these, although if you’re really that concerned, you might as well go all in with tor<p>A modern version of this: <a href="https:&#x2F;&#x2F;github.com&#x2F;grugq&#x2F;portal">https:&#x2F;&#x2F;github.com&#x2F;grugq&#x2F;portal</a></div><br/><div id="40280536" class="c"><input type="checkbox" id="c-40280536" checked=""/><div class="controls bullet"><span class="by">dpifke</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40280156">parent</a><span>|</span><a href="#40280010">next</a><span>|</span><label class="collapse" for="c-40280536">[-]</label><label class="expand" for="c-40280536">[1 more]</label></div><br/><div class="children"><div class="content">You do not want to mix your non-anonymous and anonymous traffic over the same Tor connection, especially if you don&#x27;t control the bridge (first hop) to which you&#x27;re connecting.</div><br/></div></div></div></div><div id="40280010" class="c"><input type="checkbox" id="c-40280010" checked=""/><div class="controls bullet"><span class="by">GardenLetter27</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279928">parent</a><span>|</span><a href="#40280156">prev</a><span>|</span><a href="#40279963">next</a><span>|</span><label class="collapse" for="c-40280010">[-]</label><label class="expand" for="c-40280010">[1 more]</label></div><br/><div class="children"><div class="content">On Linux this is easy with a network namespace and nftables.</div><br/></div></div><div id="40279963" class="c"><input type="checkbox" id="c-40279963" checked=""/><div class="controls bullet"><span class="by">bedobi</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279928">parent</a><span>|</span><a href="#40280010">prev</a><span>|</span><a href="#40280005">next</a><span>|</span><label class="collapse" for="c-40279963">[-]</label><label class="expand" for="c-40279963">[1 more]</label></div><br/><div class="children"><div class="content">apparently lots of folks use Raspberry Pi&#x27;s for this, which has added benefit of PiHole filtering out of ads etc<p>no personal experience but sounds nifty, maybe there are other options too</div><br/></div></div><div id="40280005" class="c"><input type="checkbox" id="c-40280005" checked=""/><div class="controls bullet"><span class="by">mftrhu</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40279928">parent</a><span>|</span><a href="#40279963">prev</a><span>|</span><a href="#40280092">next</a><span>|</span><label class="collapse" for="c-40280005">[-]</label><label class="expand" for="c-40280005">[1 more]</label></div><br/><div class="children"><div class="content">Pretty much any of the GL.iNet devices should be able to do that.</div><br/></div></div></div></div><div id="40280092" class="c"><input type="checkbox" id="c-40280092" checked=""/><div class="controls bullet"><span class="by">m463</span><span>|</span><a href="#40279841">parent</a><span>|</span><a href="#40279928">prev</a><span>|</span><a href="#40279946">next</a><span>|</span><label class="collapse" for="c-40280092">[-]</label><label class="expand" for="c-40280092">[2 more]</label></div><br/><div class="children"><div class="content">Can just be location services - it uses known bluetooth devices and known wifi networks to deduce your location</div><br/><div id="40280136" class="c"><input type="checkbox" id="c-40280136" checked=""/><div class="controls bullet"><span class="by">bedobi</span><span>|</span><a href="#40279841">root</a><span>|</span><a href="#40280092">parent</a><span>|</span><a href="#40279946">next</a><span>|</span><label class="collapse" for="c-40280136">[-]</label><label class="expand" for="c-40280136">[1 more]</label></div><br/><div class="children"><div class="content">can be but that wasn&#x27;t what i was experiencing</div><br/></div></div></div></div><div id="40279946" class="c"><input type="checkbox" id="c-40279946" checked=""/><div class="controls bullet"><span class="by">whoomp12342</span><span>|</span><a href="#40279841">parent</a><span>|</span><a href="#40280092">prev</a><span>|</span><label class="collapse" for="c-40279946">[-]</label><label class="expand" for="c-40279946">[1 more]</label></div><br/><div class="children"><div class="content">is there reading on this matter?</div><br/></div></div></div></div></div></div></div></div></div></body></html>