<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1705914075868" as="style"/><link rel="stylesheet" href="styles.css?v=1705914075868"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://devblogs.microsoft.com/oldnewthing/20190805-00/?p=102749">The SuperH-3, part 1: Introduction (2019)</a>Â <span class="domain">(<a href="https://devblogs.microsoft.com">devblogs.microsoft.com</a>)</span></div><div class="subtext"><span>ksec</span> | <span>27 comments</span></div><br/><div><div id="39081611" class="c"><input type="checkbox" id="c-39081611" checked=""/><div class="controls bullet"><span class="by">gumby</span><span>|</span><a href="#39082309">next</a><span>|</span><label class="collapse" for="c-39081611">[-]</label><label class="expand" for="c-39081611">[8 more]</label></div><br/><div class="children"><div class="content">Hitachi&#x27;s SH series were supposedly named that because they were &quot;super hot&quot;.  Their marketing department didn&#x27;t manage to propagate that interpretation but I liked the architecture.<p>&gt; The SH-4 is probably most famous for being the processor behind the Sega Dreamcast.<p>It was always amusing to visit Sega HQ back in those days and see how all-in they were on Hitachi: from the Hitachi elevator in the building to the conference rooms with Hitachi OHP, Hitachi wall clock, Hitachi conference table, Hitachi pens, hitachi computers and of course Hitachi chips... Those huge conglomerates (Keiretsu) are <i>crazy!</i></div><br/><div id="39087611" class="c"><input type="checkbox" id="c-39087611" checked=""/><div class="controls bullet"><span class="by">brcmthrowaway</span><span>|</span><a href="#39081611">parent</a><span>|</span><a href="#39083122">next</a><span>|</span><label class="collapse" for="c-39087611">[-]</label><label class="expand" for="c-39087611">[1 more]</label></div><br/><div class="children"><div class="content">What ever happened to them.. why don&#x27;t Fujitsu and Hitachi design chips ?</div><br/></div></div><div id="39083122" class="c"><input type="checkbox" id="c-39083122" checked=""/><div class="controls bullet"><span class="by">meepmorp</span><span>|</span><a href="#39081611">parent</a><span>|</span><a href="#39087611">prev</a><span>|</span><a href="#39082309">next</a><span>|</span><label class="collapse" for="c-39083122">[-]</label><label class="expand" for="c-39083122">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Hitachi&#x27;s SH series were supposedly named that because they were &quot;super hot&quot;.<p>Super hot like they&#x27;re great chips, or super hot like they&#x27;re space heaters that incidentally do math?</div><br/><div id="39087422" class="c"><input type="checkbox" id="c-39087422" checked=""/><div class="controls bullet"><span class="by">numpad0</span><span>|</span><a href="#39081611">root</a><span>|</span><a href="#39083122">parent</a><span>|</span><a href="#39083354">next</a><span>|</span><label class="collapse" for="c-39087422">[-]</label><label class="expand" for="c-39087422">[1 more]</label></div><br/><div class="children"><div class="content">Undoubtedly retronymized from Super Hitachi as in the successor to Hitachi H8... So if it weren&#x27;t supposed to stand for hot, it&#x27;ll still have had to be something with H.</div><br/></div></div><div id="39083354" class="c"><input type="checkbox" id="c-39083354" checked=""/><div class="controls bullet"><span class="by">TapamN</span><span>|</span><a href="#39081611">root</a><span>|</span><a href="#39083122">parent</a><span>|</span><a href="#39087422">prev</a><span>|</span><a href="#39083734">next</a><span>|</span><label class="collapse" for="c-39083354">[-]</label><label class="expand" for="c-39083354">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not because of their temperature. One version of the SH3 (single issue, at 80 MHz) is speced at 260 mW. The SH4 used in the Dreamcast (dual issue at 200 MHz), seems to be 4W.<p>Hitachi apparently had a trademark on &quot;Cool Engine&quot; for the SuperH (<a href="https:&#x2F;&#x2F;www.cpushack.com&#x2F;CIC&#x2F;embed&#x2F;announce&#x2F;HitachiSH7709.html" rel="nofollow">https:&#x2F;&#x2F;www.cpushack.com&#x2F;CIC&#x2F;embed&#x2F;announce&#x2F;HitachiSH7709.ht...</a>).</div><br/></div></div><div id="39083734" class="c"><input type="checkbox" id="c-39083734" checked=""/><div class="controls bullet"><span class="by">gumby</span><span>|</span><a href="#39081611">root</a><span>|</span><a href="#39083122">parent</a><span>|</span><a href="#39083354">prev</a><span>|</span><a href="#39083390">next</a><span>|</span><label class="collapse" for="c-39083734">[-]</label><label class="expand" for="c-39083734">[1 more]</label></div><br/><div class="children"><div class="content">As in the &quot;hot chips&quot; conference -- supposed to mean &quot;amazing and a big hit&quot;.  I mean, would the marketing department promote something negative?</div><br/></div></div><div id="39083390" class="c"><input type="checkbox" id="c-39083390" checked=""/><div class="controls bullet"><span class="by">johnklos</span><span>|</span><a href="#39081611">root</a><span>|</span><a href="#39083122">parent</a><span>|</span><a href="#39083734">prev</a><span>|</span><a href="#39085819">next</a><span>|</span><label class="collapse" for="c-39083390">[-]</label><label class="expand" for="c-39083390">[1 more]</label></div><br/><div class="children"><div class="content">They definitely don&#x27;t run hot. In addition to Dreamcasts, they were used in many appliance type devices like NAS, and I&#x27;ve never seen or heard of any that require cooling.</div><br/></div></div><div id="39085819" class="c"><input type="checkbox" id="c-39085819" checked=""/><div class="controls bullet"><span class="by">Sophistifunk</span><span>|</span><a href="#39081611">root</a><span>|</span><a href="#39083122">parent</a><span>|</span><a href="#39083390">prev</a><span>|</span><a href="#39082309">next</a><span>|</span><label class="collapse" for="c-39085819">[-]</label><label class="expand" for="c-39085819">[1 more]</label></div><br/><div class="children"><div class="content">Super Hot like they were named in Japan in the early 90s</div><br/></div></div></div></div></div></div><div id="39082309" class="c"><input type="checkbox" id="c-39082309" checked=""/><div class="controls bullet"><span class="by">tredre3</span><span>|</span><a href="#39081611">prev</a><span>|</span><a href="#39085109">next</a><span>|</span><label class="collapse" for="c-39082309">[-]</label><label class="expand" for="c-39082309">[6 more]</label></div><br/><div class="children"><div class="content">I worked on SuperH3&#x2F;4 compilers back in the day.<p>One thing I remember was how good Hitachi&#x27;s documentation is! It was clear and concise and any quirk was well explained. The pseudo-code they used to describe each instruction was also good, C-like to the point that I was able to copy-paste the snippets with minor changes to write an emulator.<p>However the architecture itself was a bit annoying to work with because of the small opcodes. Doing something as simple as loading a 32bit immediate to a register ended up being 7-9 instructions. More realistically the compiler would put the values in LTORG and we&#x27;d load them from there in 1 or 2 instructions. Relative jumps were also an issue for the same reasons. It also inherited the infamous delay slots where half the instructions are illegal and the other half is quirky so we just NOPed them but I know that smarter compilers do useful work there.<p>That being said I do admire the elegance of how they fitted their 100 instructions with 16&#x2F;24 registers in a 16bit opcode, it&#x27;s a beautiful application of engineering trade-offs :).</div><br/><div id="39082533" class="c"><input type="checkbox" id="c-39082533" checked=""/><div class="controls bullet"><span class="by">techwiz137</span><span>|</span><a href="#39082309">parent</a><span>|</span><a href="#39083471">next</a><span>|</span><label class="collapse" for="c-39082533">[-]</label><label class="expand" for="c-39082533">[2 more]</label></div><br/><div class="children"><div class="content">Have you seen how terrible SH code generation is? At least code compiled in 2005-2009. Unnecessary moves:<p>mov r0, r3 &lt;-result from a subroutine<p>mov r3, @r4<p>mov @r4, r3<p>do something with value.<p>And many many more examples like this. Wasting cycles and space.</div><br/><div id="39083197" class="c"><input type="checkbox" id="c-39083197" checked=""/><div class="controls bullet"><span class="by">TapamN</span><span>|</span><a href="#39082309">root</a><span>|</span><a href="#39082533">parent</a><span>|</span><a href="#39083471">next</a><span>|</span><label class="collapse" for="c-39083197">[-]</label><label class="expand" for="c-39083197">[1 more]</label></div><br/><div class="children"><div class="content">Yes, I do Dreamcast homebrew, and even with GCC 12.2, the compiler does such stupid, stupid things.<p>The SH has addressing modes for postincrement reads and predecrement writes, so something like<p><pre><code>  var = *ptr++;
</code></pre>
can be compiled down to a single instruction. But GCC almost always does something moronic. I&#x27;ve seen it generate code equivalent to:<p><pre><code>  ptr++; tmp = ptr; tmp -= 16; var = tmp[15];
</code></pre>
Insane.<p>Older versions of GCC (3.x) are generally much better at low level instruction selection, but newer versions are better at big-picture stuff like optimizing across function calls, so speed-wise, across a whole program, they aren&#x27;t too dissimilar. Newer versions are still worth it for the feature set (better warnings, modern standards like C23&#x2F;C++23,  etc).</div><br/></div></div></div></div><div id="39083471" class="c"><input type="checkbox" id="c-39083471" checked=""/><div class="controls bullet"><span class="by">frozenport</span><span>|</span><a href="#39082309">parent</a><span>|</span><a href="#39082533">prev</a><span>|</span><a href="#39085109">next</a><span>|</span><label class="collapse" for="c-39083471">[-]</label><label class="expand" for="c-39083471">[3 more]</label></div><br/><div class="children"><div class="content">&gt;&gt; engineering trade-offs<p>Its not obvious what they trade off and got in return.</div><br/><div id="39083822" class="c"><input type="checkbox" id="c-39083822" checked=""/><div class="controls bullet"><span class="by">ksherlock</span><span>|</span><a href="#39082309">root</a><span>|</span><a href="#39083471">parent</a><span>|</span><a href="#39085109">next</a><span>|</span><label class="collapse" for="c-39083822">[-]</label><label class="expand" for="c-39083822">[2 more]</label></div><br/><div class="children"><div class="content">The article mentions that ARM licensed SuperH patents for their Thumb instruction set, and ARM did that for improved code density, so that seems to be what they got in return.<p>If you read through all 10 parts of the series, Raymond later mentions that it might look like a lot of code but instructions are half as big as other RISC contemporaries so it&#x27;s better than it looks.</div><br/><div id="39083993" class="c"><input type="checkbox" id="c-39083993" checked=""/><div class="controls bullet"><span class="by">zozbot234</span><span>|</span><a href="#39082309">root</a><span>|</span><a href="#39083822">parent</a><span>|</span><a href="#39085109">next</a><span>|</span><label class="collapse" for="c-39083993">[-]</label><label class="expand" for="c-39083993">[1 more]</label></div><br/><div class="children"><div class="content">&gt; instructions are half as big as other RISC contemporaries<p>That&#x27;s a bit of a gimmick, tbh.  Yes you can just about make it work if you have a really barebones insn set, as the early SuperH chips had.  (You do need to start from a 2-register insn format of course.)  But modern chips - even quite small chips nowadays - benefit from having more than that, so you&#x27;re left with a really limited niche.<p>(I do think that the calculus changes if you have a strictly Harvard architecture chip&#x2F;core, since these might be able to afford a &quot;weird&quot; instruction length.  A core with, e.g. 20-bit or 24-bit fixed-length instructions designed along the same lines gains some much needed space for ISA extension.)</div><br/></div></div></div></div></div></div></div></div><div id="39085109" class="c"><input type="checkbox" id="c-39085109" checked=""/><div class="controls bullet"><span class="by">MenhirMike</span><span>|</span><a href="#39082309">prev</a><span>|</span><a href="#39082017">next</a><span>|</span><label class="collapse" for="c-39085109">[-]</label><label class="expand" for="c-39085109">[2 more]</label></div><br/><div class="children"><div class="content">The SH-3 is also the CPU of the Cave CV1000 arcade board, which gave us the best bullet hell games. (Though arguably, Cave&#x27;s developers thought the board was way underpowered. Still, they did an amazing job with the games)</div><br/><div id="39085936" class="c"><input type="checkbox" id="c-39085936" checked=""/><div class="controls bullet"><span class="by">speed_spread</span><span>|</span><a href="#39085109">parent</a><span>|</span><a href="#39082017">next</a><span>|</span><label class="collapse" for="c-39085936">[-]</label><label class="expand" for="c-39085936">[1 more]</label></div><br/><div class="children"><div class="content">SH-3 also powers the Korg Electribe ESX-1 and EMX-1 which are still the best grooveboxes ever made to this day.</div><br/></div></div></div></div><div id="39082017" class="c"><input type="checkbox" id="c-39082017" checked=""/><div class="controls bullet"><span class="by">julian55</span><span>|</span><a href="#39085109">prev</a><span>|</span><a href="#39081659">next</a><span>|</span><label class="collapse" for="c-39082017">[-]</label><label class="expand" for="c-39082017">[1 more]</label></div><br/><div class="children"><div class="content">I did a lot of work for both Hitachi and Renesas over the years and used SH-1, 2, 3 and 4 with various OSes.  I liked the SH architecture, I first learnt assembly programming on PDP-11s and SH felt like an extended RISCified PDP-11.</div><br/></div></div><div id="39081659" class="c"><input type="checkbox" id="c-39081659" checked=""/><div class="controls bullet"><span class="by">techwiz137</span><span>|</span><a href="#39082017">prev</a><span>|</span><a href="#39083741">next</a><span>|</span><label class="collapse" for="c-39081659">[-]</label><label class="expand" for="c-39081659">[2 more]</label></div><br/><div class="children"><div class="content">Please do note how these units do division. I was very stumped why div, rotcl were used in unrolled form until Raymond explained it and this is how I reverse engineered one of many division functions of a SH2 firmware.</div><br/><div id="39082220" class="c"><input type="checkbox" id="c-39082220" checked=""/><div class="controls bullet"><span class="by">gumby</span><span>|</span><a href="#39081659">parent</a><span>|</span><a href="#39083741">next</a><span>|</span><label class="collapse" for="c-39082220">[-]</label><label class="expand" for="c-39082220">[1 more]</label></div><br/><div class="children"><div class="content">You can find many of these in the GCC SH target</div><br/></div></div></div></div><div id="39083741" class="c"><input type="checkbox" id="c-39083741" checked=""/><div class="controls bullet"><span class="by">krylon</span><span>|</span><a href="#39081659">prev</a><span>|</span><a href="#39083898">next</a><span>|</span><label class="collapse" for="c-39083741">[-]</label><label class="expand" for="c-39083741">[1 more]</label></div><br/><div class="children"><div class="content">I thoroughly enjoy these deep dives into CPU architectures. I forget most of it within seconds after reading it, because I have no practical interest in it. But it is fun to get a look underneath the pavement so to speak.</div><br/></div></div><div id="39083898" class="c"><input type="checkbox" id="c-39083898" checked=""/><div class="controls bullet"><span class="by">immolo</span><span>|</span><a href="#39083741">prev</a><span>|</span><a href="#39083782">next</a><span>|</span><label class="collapse" for="c-39083898">[-]</label><label class="expand" for="c-39083898">[2 more]</label></div><br/><div class="children"><div class="content">This was a great read, thanks for sharing.<p>I actually got interested in SH3 again recently as one of my viewers donated me some hardware to see if I could port Gentoo to run on it. It&#x27;s more a passion project however I did manage to get a PoC image to semi boot over a weekend so I do hope I&#x27;ll manage to get this into a state that I can merge this into Gentoo to officially support it again.</div><br/><div id="39087158" class="c"><input type="checkbox" id="c-39087158" checked=""/><div class="controls bullet"><span class="by">cbmuser</span><span>|</span><a href="#39083898">parent</a><span>|</span><a href="#39083782">next</a><span>|</span><label class="collapse" for="c-39087158">[-]</label><label class="expand" for="c-39087158">[1 more]</label></div><br/><div class="children"><div class="content">Please join #linux-sh on Libera IRC if youâre interested in SuperH Linux.<p>Iâm one of the kernel maintainers for SuperH Linux.</div><br/></div></div></div></div><div id="39083782" class="c"><input type="checkbox" id="c-39083782" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#39083898">prev</a><span>|</span><label class="collapse" for="c-39083782">[-]</label><label class="expand" for="c-39083782">[4 more]</label></div><br/><div class="children"><div class="content">Alas that the j-core kind of dried up development. There was a roadmap for this open super-h compatible core up to sh4 then a 64 bit version. Kind of tied to key patents expiring.<p>There&#x27;s a j32 &amp; j32smp core now, but I&#x27;m not sure where-ish that would slot into the old roadmap, and it seems like development isnt active. <a href="https:&#x2F;&#x2F;j-core.org&#x2F;roadmap.html" rel="nofollow">https:&#x2F;&#x2F;j-core.org&#x2F;roadmap.html</a><p>Meanwhile support keeps bitrotting. Someone managed to get a Debian port going in 2015, &amp; it sounded semi adventurous to make go. <a href="https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;647636&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;647636&#x2F;</a><p>Chipmaker Renesas - who kind of <i>was</i> super-h for a while - meanwhile seems to be starting down the RISC-V path, alongside a variety of ARM cores &amp; their own (small microcontrollers) RL78 architecture that I don&#x27;t know much about. <a href="https:&#x2F;&#x2F;www.cnx-software.com&#x2F;news&#x2F;renesas&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.cnx-software.com&#x2F;news&#x2F;renesas&#x2F;</a></div><br/><div id="39087172" class="c"><input type="checkbox" id="c-39087172" checked=""/><div class="controls bullet"><span class="by">cbmuser</span><span>|</span><a href="#39083782">parent</a><span>|</span><a href="#39085908">next</a><span>|</span><label class="collapse" for="c-39087172">[-]</label><label class="expand" for="c-39087172">[1 more]</label></div><br/><div class="children"><div class="content">Iâm maintaining Debian for sh4 and Iâm also the kernel maintainer for SuperH.<p>If youâre interested in SuperH Linux, feel free to join #linux-sh on Libera IRC.</div><br/></div></div><div id="39085908" class="c"><input type="checkbox" id="c-39085908" checked=""/><div class="controls bullet"><span class="by">wolfspider</span><span>|</span><a href="#39083782">parent</a><span>|</span><a href="#39087172">prev</a><span>|</span><a href="#39084096">next</a><span>|</span><label class="collapse" for="c-39085908">[-]</label><label class="expand" for="c-39085908">[1 more]</label></div><br/><div class="children"><div class="content">Was really looking forward to the j-core project and got into SH4 emulating the Dreamcast port of NetBSD which is currently available for the latest version which is 9.3 I believe.<p><a href="http:&#x2F;&#x2F;wiki.netbsd.org&#x2F;ports&#x2F;dreamcast&#x2F;" rel="nofollow">http:&#x2F;&#x2F;wiki.netbsd.org&#x2F;ports&#x2F;dreamcast&#x2F;</a><p>GXemul is what I used at the time.<p><a href="https:&#x2F;&#x2F;gavare.se&#x2F;gxemul&#x2F;gxemul-stable&#x2F;doc&#x2F;machine_dreamcast.html" rel="nofollow">https:&#x2F;&#x2F;gavare.se&#x2F;gxemul&#x2F;gxemul-stable&#x2F;doc&#x2F;machine_dreamcast...</a><p>There are also lots of interesting things going on with NAOMI emulation on the gaming side. All of it is very hackable and j-core would have made a great addition to that.</div><br/></div></div><div id="39084096" class="c"><input type="checkbox" id="c-39084096" checked=""/><div class="controls bullet"><span class="by">kjs3</span><span>|</span><a href="#39083782">parent</a><span>|</span><a href="#39085908">prev</a><span>|</span><label class="collapse" for="c-39084096">[-]</label><label class="expand" for="c-39084096">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, shame J-core didn&#x27;t pan out.  SH4 is such an interesting chip with some minimal vector facilities.</div><br/></div></div></div></div></div></div></div></div></div></body></html>