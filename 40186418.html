<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714381266442" as="style"/><link rel="stylesheet" href="styles.css?v=1714381266442"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://notso.boringsql.com/posts/the-bloat-busters-pg-repack-pg-squeeze/">The Bloat Busters: pg_repack vs. pg_squeeze</a>Â <span class="domain">(<a href="https://notso.boringsql.com">notso.boringsql.com</a>)</span></div><div class="subtext"><span>radimm</span> | <span>7 comments</span></div><br/><div><div id="40195942" class="c"><input type="checkbox" id="c-40195942" checked=""/><div class="controls bullet"><span class="by">Valodim</span><span>|</span><a href="#40195751">next</a><span>|</span><label class="collapse" for="c-40195942">[-]</label><label class="expand" for="c-40195942">[2 more]</label></div><br/><div class="children"><div class="content">Pssst  <a href="https:&#x2F;&#x2F;github.com&#x2F;dataegret&#x2F;pgcompacttable">https:&#x2F;&#x2F;github.com&#x2F;dataegret&#x2F;pgcompacttable</a></div><br/><div id="40196027" class="c"><input type="checkbox" id="c-40196027" checked=""/><div class="controls bullet"><span class="by">radimm</span><span>|</span><a href="#40195942">parent</a><span>|</span><a href="#40195751">next</a><span>|</span><label class="collapse" for="c-40196027">[-]</label><label class="expand" for="c-40196027">[1 more]</label></div><br/><div class="children"><div class="content">Oh thanks. Will definitely try it as well.</div><br/></div></div></div></div><div id="40195751" class="c"><input type="checkbox" id="c-40195751" checked=""/><div class="controls bullet"><span class="by">ksynwa</span><span>|</span><a href="#40195942">prev</a><span>|</span><label class="collapse" for="c-40195751">[-]</label><label class="expand" for="c-40195751">[4 more]</label></div><br/><div class="children"><div class="content">&gt; You migrate one or more column data types over a longer period (and no, using ALTER COLUMN name TYPE new_type is not the best option).<p>What is the best option then? Renaming the existing column to something else, creating a new column with `name` and then dropping the renamed column?</div><br/><div id="40196040" class="c"><input type="checkbox" id="c-40196040" checked=""/><div class="controls bullet"><span class="by">radimm</span><span>|</span><a href="#40195751">parent</a><span>|</span><label class="collapse" for="c-40196040">[-]</label><label class="expand" for="c-40196040">[3 more]</label></div><br/><div class="children"><div class="content">Yes, anytime you have untrivial amount of the data, you go for<p>1. Create new column
2. Backfill new column over time (manual, triggers, etc.)
3. During small downtime drop&#x2F;rename (i.e. swap the columns).</div><br/><div id="40196116" class="c"><input type="checkbox" id="c-40196116" checked=""/><div class="controls bullet"><span class="by">stuaxo</span><span>|</span><a href="#40195751">root</a><span>|</span><a href="#40196040">parent</a><span>|</span><label class="collapse" for="c-40196116">[-]</label><label class="expand" for="c-40196116">[2 more]</label></div><br/><div class="children"><div class="content">How big is an untrivial amount of data ?<p>I feel like there is a whole middle ground of websites I&#x27;ve worked on where I haven&#x27;t neeed this (or maybe it&#x27;s because a lot of them were sites that may be complex but have small amounts of users, e.g. internal tools).</div><br/><div id="40196132" class="c"><input type="checkbox" id="c-40196132" checked=""/><div class="controls bullet"><span class="by">radimm</span><span>|</span><a href="#40195751">root</a><span>|</span><a href="#40196116">parent</a><span>|</span><label class="collapse" for="c-40196132">[-]</label><label class="expand" for="c-40196132">[1 more]</label></div><br/><div class="children"><div class="content">Consider time it takes to rewrite the table, downtime you can afford and the disk space you have. My goal is to write bit more about the cases that go beyond the usual &quot;works on my 100MB&quot; scenario.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>