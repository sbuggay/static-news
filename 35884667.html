<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683795653223" as="style"/><link rel="stylesheet" href="styles.css?v=1683795653223"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.koehntopp.info/2023/05/05/50-years-in-filesystems-1974.html">50 Years in Filesystems: 1974 Unix V7</a>Â <span class="domain">(<a href="https://blog.koehntopp.info">blog.koehntopp.info</a>)</span></div><div class="subtext"><span>fh973</span> | <span>11 comments</span></div><br/><div><div id="35897061" class="c"><input type="checkbox" id="c-35897061" checked=""/><div class="controls bullet"><span class="by">musicale</span><span>|</span><a href="#35898895">next</a><span>|</span><label class="collapse" for="c-35897061">[-]</label><label class="expand" for="c-35897061">[5 more]</label></div><br/><div class="children"><div class="content">&gt; There can be only one writer active per file, which kills concurrency<p>Multiple writers contending over a single resource is what kills concurrency. Single writer is a good design.<p>It&#x27;s also helpful for distributed implementations.</div><br/><div id="35898186" class="c"><input type="checkbox" id="c-35898186" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#35897061">parent</a><span>|</span><a href="#35898895">next</a><span>|</span><label class="collapse" for="c-35898186">[-]</label><label class="expand" for="c-35898186">[4 more]</label></div><br/><div class="children"><div class="content">A file is arguably N resources, where N is the number of granular elements of your file.  Probably pages, but could be blocks or bytes too depending on where in storage it&#x27;s canonical copy lives.</div><br/><div id="35898280" class="c"><input type="checkbox" id="c-35898280" checked=""/><div class="controls bullet"><span class="by">musicale</span><span>|</span><a href="#35897061">root</a><span>|</span><a href="#35898186">parent</a><span>|</span><a href="#35898895">next</a><span>|</span><label class="collapse" for="c-35898280">[-]</label><label class="expand" for="c-35898280">[3 more]</label></div><br/><div class="children"><div class="content">Point taken. In any case, single-writer helps with concurrency and consistency. For V7 Unix, I think one solution could be to split the file into blocks, each with a single writer. Admittedly this makes reads of the whole file more costly, so one has to be careful about the block size.</div><br/><div id="35898636" class="c"><input type="checkbox" id="c-35898636" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#35897061">root</a><span>|</span><a href="#35898280">parent</a><span>|</span><a href="#35898895">next</a><span>|</span><label class="collapse" for="c-35898636">[-]</label><label class="expand" for="c-35898636">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Admittedly this makes reads of the whole file more costly, so one has to be careful about the block size.<p>Maybe?  You&#x27;re probably locking each block at a time in the buffer cache during reads anyway.</div><br/><div id="35899040" class="c"><input type="checkbox" id="c-35899040" checked=""/><div class="controls bullet"><span class="by">jasomill</span><span>|</span><a href="#35897061">root</a><span>|</span><a href="#35898636">parent</a><span>|</span><a href="#35898895">next</a><span>|</span><label class="collapse" for="c-35899040">[-]</label><label class="expand" for="c-35899040">[1 more]</label></div><br/><div class="children"><div class="content">N.B.: in V7 (and 32V), inodes are locked identically for both writes and reads[1],<p><pre><code>    if((ip-&gt;i_mode&amp;(IFCHR&amp;IFBLK)) == 0)
      plock(ip);
    if(mode == FREAD)
      readi(ip);
    else
      writei(ip);
    if((ip-&gt;i_mode&amp;(IFCHR&amp;IFBLK)) == 0)
      prele(ip);
</code></pre>
I imagine a more serious bottleneck to heavy random-access concurrency on files large enough to be worth splitting would be disk performance, as there&#x27;s not likely to be a lot of room in physical RAM on a busy PDP-11 or VAX-11&#x2F;7xx free for buffer caching.<p>And for smaller files able to be serviced entirely from cache, I don&#x27;t imagine lock contention as a serious issue on a single-processor system like the ones that ran V7&#x2F;32V.<p>Average seek time &#x2F; rotational latency (years  estimated by manual copyright):<p>RL02 (1978): 55 ms &#x2F; 12.5 ms<p>RK07 (1978): 36.5 ms &#x2F; 12.5 ms<p>RA81 (1982): 28 ms &#x2F; 8.3 ms<p>RA92 (1989): 16 ms &#x2F; 8.3 ms<p>Note that the RL02 (and V7) and RA92 mentioned in the article are separated by about a decade.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;dspinellis&#x2F;unix-history-repo&#x2F;blob&#x2F;Research-V7&#x2F;usr&#x2F;sys&#x2F;sys&#x2F;sys2.c#L64">https:&#x2F;&#x2F;github.com&#x2F;dspinellis&#x2F;unix-history-repo&#x2F;blob&#x2F;Researc...</a></div><br/></div></div></div></div></div></div></div></div></div></div><div id="35898895" class="c"><input type="checkbox" id="c-35898895" checked=""/><div class="controls bullet"><span class="by">aap_</span><span>|</span><a href="#35897061">prev</a><span>|</span><a href="#35896545">next</a><span>|</span><label class="collapse" for="c-35898895">[-]</label><label class="expand" for="c-35898895">[1 more]</label></div><br/><div class="children"><div class="content">A bit strange to talk about 1974 but look at code from v7 (1979).</div><br/></div></div><div id="35896545" class="c"><input type="checkbox" id="c-35896545" checked=""/><div class="controls bullet"><span class="by">senectus1</span><span>|</span><a href="#35898895">prev</a><span>|</span><label class="collapse" for="c-35896545">[-]</label><label class="expand" for="c-35896545">[4 more]</label></div><br/><div class="children"><div class="content">oi! steady on.. I was born in 1974 and I&#x27;m not 50 YET!</div><br/><div id="35896701" class="c"><input type="checkbox" id="c-35896701" checked=""/><div class="controls bullet"><span class="by">iohead</span><span>|</span><a href="#35896545">parent</a><span>|</span><label class="collapse" for="c-35896701">[-]</label><label class="expand" for="c-35896701">[3 more]</label></div><br/><div class="children"><div class="content">Well, V7 UNIX is rather arbitrary as a reference point for comparison. There was what we now call as V1 UNIX, which would be circa 1971&#x2F;72, so that&#x27;s certainly 50+ years old. Compared to what&#x27;s shown in the article, some of the data structure fields and constants would be different and&#x2F;or missing in the still earlier versions. DIRSIZ would be 8, for example.</div><br/><div id="35898307" class="c"><input type="checkbox" id="c-35898307" checked=""/><div class="controls bullet"><span class="by">musicale</span><span>|</span><a href="#35896545">root</a><span>|</span><a href="#35896701">parent</a><span>|</span><a href="#35898299">next</a><span>|</span><label class="collapse" for="c-35898307">[-]</label><label class="expand" for="c-35898307">[1 more]</label></div><br/><div class="children"><div class="content">Well the author refers to Bach&#x27;s book (though I thought that was System V?) Another option would be V6 with Lions&#x27; commentary.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>