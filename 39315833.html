<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707555659427" as="style"/><link rel="stylesheet" href="styles.css?v=1707555659427"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://leontrolski.github.io/postgres-as-queue.html">Postgres as queue</a> <span class="domain">(<a href="https://leontrolski.github.io">leontrolski.github.io</a>)</span></div><div class="subtext"><span>leontrolski</span> | <span>56 comments</span></div><br/><div><div id="39323542" class="c"><input type="checkbox" id="c-39323542" checked=""/><div class="controls bullet"><span class="by">diek</span><span>|</span><a href="#39323415">next</a><span>|</span><label class="collapse" for="c-39323542">[-]</label><label class="expand" for="c-39323542">[3 more]</label></div><br/><div class="children"><div class="content">Postgres is great as a queue, but this post doesn&#x27;t really get into the features that differentiate it from just polling, say SQL Server for tasks.<p>For me, the best features are:<p><pre><code>  * use LISTEN to be notified of rows that have changed that the backend needs to take action on (so you&#x27;re not actively polling for new work)
  * use NOTIFY from a trigger so all you need to do is INSERT&#x2F;UPDATE a table to send an event to listeners
  * you can select using SKIP LOCKED (as the article points out)
  * you can use partial indexes to efficiently select rows in a particular state
</code></pre>
So when a backend worker wakes up, it can:<p><pre><code>  * LISTEN for changes to the active working set it cares about
  * &quot;select all things in status &#x27;X&#x27;&quot; (using a partial index predicate, so it&#x27;s not churning through low cardinality &#x27;active&#x27; statuses)
  * atomically update the status to &#x27;processing&#x27; (using SKIP LOCKED to avoid contention&#x2F;lock escalation)
  * do the work
  * update to a new status (which another worker may trigger on)
</code></pre>
So you end up with a pretty decent state machine where each worker is responsible for transitioning units of work from status X to status Y, and it&#x27;s getting that from the source of truth.  You also usually want to have some sort of a per-task &#x27;lease_expire&#x27; column so if a worker fails&#x2F;goes away, other workers will pick up their task when they periodically scan for work.<p>This works for millions of units of work an hour with a moderately spec&#x27;d database server, and if the alternative is setting up SQS&#x2F;SNS&#x2F;ActiveMQ&#x2F;etc and then _still_ having to track status in the database&#x2F;manage a dead-letter-queue, etc -- it&#x27;s not a hard choice at all.</div><br/><div id="39323730" class="c"><input type="checkbox" id="c-39323730" checked=""/><div class="controls bullet"><span class="by">eddd-ddde</span><span>|</span><a href="#39323542">parent</a><span>|</span><a href="#39323954">next</a><span>|</span><label class="collapse" for="c-39323730">[-]</label><label class="expand" for="c-39323730">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s actually an extension called &quot;tcn&quot; or trigger change notification that provides such a trigger put of the box.</div><br/></div></div><div id="39323954" class="c"><input type="checkbox" id="c-39323954" checked=""/><div class="controls bullet"><span class="by">foofie</span><span>|</span><a href="#39323542">parent</a><span>|</span><a href="#39323730">prev</a><span>|</span><a href="#39323415">next</a><span>|</span><label class="collapse" for="c-39323954">[-]</label><label class="expand" for="c-39323954">[1 more]</label></div><br/><div class="children"><div class="content">Excellent comment. Thank you for taking the time to write it.</div><br/></div></div></div></div><div id="39323415" class="c"><input type="checkbox" id="c-39323415" checked=""/><div class="controls bullet"><span class="by">tomas789</span><span>|</span><a href="#39323542">prev</a><span>|</span><a href="#39324032">next</a><span>|</span><label class="collapse" for="c-39323415">[-]</label><label class="expand" for="c-39323415">[1 more]</label></div><br/><div class="children"><div class="content">It was used in my previous job and it worked wonders. It was an internal tool which stored lots of data but did not see high traffic. And as such the load was not an issue. In the world of thet large corporate it was almost the only viable solution. DB already existed so it could be used. Other solutions would require an “architecture” documents, security meetings and perhaps even hiring someone to care about new tech in stack.</div><br/></div></div><div id="39324032" class="c"><input type="checkbox" id="c-39324032" checked=""/><div class="controls bullet"><span class="by">brycelarkin</span><span>|</span><a href="#39323415">prev</a><span>|</span><a href="#39323907">next</a><span>|</span><label class="collapse" for="c-39324032">[-]</label><label class="expand" for="c-39324032">[2 more]</label></div><br/><div class="children"><div class="content">Big fan of Graphile Worker to handle this job. <a href="https:&#x2F;&#x2F;github.com&#x2F;graphile&#x2F;worker">https:&#x2F;&#x2F;github.com&#x2F;graphile&#x2F;worker</a></div><br/><div id="39324442" class="c"><input type="checkbox" id="c-39324442" checked=""/><div class="controls bullet"><span class="by">jawngee</span><span>|</span><a href="#39324032">parent</a><span>|</span><a href="#39323907">next</a><span>|</span><label class="collapse" for="c-39324442">[-]</label><label class="expand" for="c-39324442">[1 more]</label></div><br/><div class="children"><div class="content">+1 graphile worker.  we use it to coordinate all of our background tasks and events (use slayQ <a href="https:&#x2F;&#x2F;slayq-docs.vercel.app" rel="nofollow">https:&#x2F;&#x2F;slayq-docs.vercel.app</a> which is kind of a wrapper around it)</div><br/></div></div></div></div><div id="39323907" class="c"><input type="checkbox" id="c-39323907" checked=""/><div class="controls bullet"><span class="by">marcusbuffett</span><span>|</span><a href="#39324032">prev</a><span>|</span><a href="#39323354">next</a><span>|</span><label class="collapse" for="c-39323907">[-]</label><label class="expand" for="c-39323907">[1 more]</label></div><br/><div class="children"><div class="content">I looked at some solutions that were more specifically meant for queues, for my site, but decided to keep the infra simple by using my Postgres DB for the worker queues. There’s 10,000 jobs a day, at that rate theres virtually zero additional load. It runs fast, I know exactly how it works, can extend it easily, local dev doesn’t get any more complicated, and there’s not another point of failure in the form of a new piece of infra.<p>If I get millions of users I’ll swap it out, in the meantime it took like a day to implement and I haven’t looked back.</div><br/></div></div><div id="39323354" class="c"><input type="checkbox" id="c-39323354" checked=""/><div class="controls bullet"><span class="by">jnsaff2</span><span>|</span><a href="#39323907">prev</a><span>|</span><a href="#39322934">next</a><span>|</span><label class="collapse" for="c-39323354">[-]</label><label class="expand" for="c-39323354">[1 more]</label></div><br/><div class="children"><div class="content">In Elixir land Oban[0] uses Postgres as queue and seems to work quite well.<p>[0] - <a href="https:&#x2F;&#x2F;github.com&#x2F;sorentwo&#x2F;oban">https:&#x2F;&#x2F;github.com&#x2F;sorentwo&#x2F;oban</a></div><br/></div></div><div id="39322934" class="c"><input type="checkbox" id="c-39322934" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#39323354">prev</a><span>|</span><a href="#39323219">next</a><span>|</span><label class="collapse" for="c-39322934">[-]</label><label class="expand" for="c-39322934">[6 more]</label></div><br/><div class="children"><div class="content">Postgres isn’t the only way to have fun.<p>Other things just as good at being a queue:<p>SQLite<p>SQL server<p>MySQL<p>Plain old files on the file system</div><br/><div id="39324419" class="c"><input type="checkbox" id="c-39324419" checked=""/><div class="controls bullet"><span class="by">cha42</span><span>|</span><a href="#39322934">parent</a><span>|</span><a href="#39324637">next</a><span>|</span><label class="collapse" for="c-39324419">[-]</label><label class="expand" for="c-39324419">[3 more]</label></div><br/><div class="children"><div class="content">you can certainly encode queue in many ways. mkfifo just work. But integrating the queue in the DB isn&#x27;t a bad idea if you want to have both the queue and the db in a shared state.<p>I am happy that my queue inherit ACID properties.<p>SQLite simply doesn&#x27;t allow concurrent write so it is a no go for a queue.<p>I don&#x27;t know much about SQL Server and MySQL but I wouldn&#x27;t favor a lockin closed source software or anything remotely connected to Oracle.<p>At the end, only Postgresql remains I guess. Also, Postgresql is super solid and the closest to SQL standard.</div><br/><div id="39324695" class="c"><input type="checkbox" id="c-39324695" checked=""/><div class="controls bullet"><span class="by">tarruda</span><span>|</span><a href="#39322934">root</a><span>|</span><a href="#39324419">parent</a><span>|</span><a href="#39324521">next</a><span>|</span><label class="collapse" for="c-39324695">[-]</label><label class="expand" for="c-39324695">[1 more]</label></div><br/><div class="children"><div class="content">&gt; mkfifo just work<p>Are you certain about that?</div><br/></div></div><div id="39324521" class="c"><input type="checkbox" id="c-39324521" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#39322934">root</a><span>|</span><a href="#39324419">parent</a><span>|</span><a href="#39324695">prev</a><span>|</span><a href="#39324637">next</a><span>|</span><label class="collapse" for="c-39324521">[-]</label><label class="expand" for="c-39324521">[1 more]</label></div><br/><div class="children"><div class="content">You’re wrong that I’m wrong.</div><br/></div></div></div></div><div id="39324637" class="c"><input type="checkbox" id="c-39324637" checked=""/><div class="controls bullet"><span class="by">tussa</span><span>|</span><a href="#39322934">parent</a><span>|</span><a href="#39324419">prev</a><span>|</span><a href="#39322965">next</a><span>|</span><label class="collapse" for="c-39324637">[-]</label><label class="expand" for="c-39324637">[1 more]</label></div><br/><div class="children"><div class="content">Don&#x27;t forget the plain old postit notes.</div><br/></div></div><div id="39322965" class="c"><input type="checkbox" id="c-39322965" checked=""/><div class="controls bullet"><span class="by">bhaney</span><span>|</span><a href="#39322934">parent</a><span>|</span><a href="#39324637">prev</a><span>|</span><a href="#39323219">next</a><span>|</span><label class="collapse" for="c-39322965">[-]</label><label class="expand" for="c-39322965">[1 more]</label></div><br/><div class="children"><div class="content">std::queue and a big swap file</div><br/></div></div></div></div><div id="39323219" class="c"><input type="checkbox" id="c-39323219" checked=""/><div class="controls bullet"><span class="by">notnmeyer</span><span>|</span><a href="#39322934">prev</a><span>|</span><a href="#39323405">next</a><span>|</span><label class="collapse" for="c-39323219">[-]</label><label class="expand" for="c-39323219">[3 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;d estimate each line of terraform to be an order of magnitude more risk&#x2F;maintenance&#x2F;faff than each line of Python.<p>ehhhhhhhh, i don’t know about that. different strokes and all of that, but TF describing infrequently changing resources requires next to no maintenance. i’m not sure i under what they mean by “risk” in this context though.<p>if you don’t know $technology well then any thing you do with it is likely to be worse&#x2F;riskier than using the thing that you do know.<p>&gt; The need for expertise in anything beyond Python + Postgres.<p>this should be the first point because it explains 99% of the motivation for all of this.</div><br/><div id="39324445" class="c"><input type="checkbox" id="c-39324445" checked=""/><div class="controls bullet"><span class="by">benlivengood</span><span>|</span><a href="#39323219">parent</a><span>|</span><a href="#39323403">next</a><span>|</span><label class="collapse" for="c-39324445">[-]</label><label class="expand" for="c-39324445">[1 more]</label></div><br/><div class="children"><div class="content">Terraform providers and modules and the cloud resources evolve fairly rapidly (especially anything kubernetes-related).  If you&#x27;re not keeping up with the latest versions you can end up somewhat stranded when a new resource feature needs to be used and you discover unexpected tech debt from the world moving out from under you.</div><br/></div></div><div id="39323403" class="c"><input type="checkbox" id="c-39323403" checked=""/><div class="controls bullet"><span class="by">smashed</span><span>|</span><a href="#39323219">parent</a><span>|</span><a href="#39324445">prev</a><span>|</span><a href="#39323405">next</a><span>|</span><label class="collapse" for="c-39323403">[-]</label><label class="expand" for="c-39323403">[1 more]</label></div><br/><div class="children"><div class="content">Yes, I think the point being made is that the  infrastructure described in terraform is a much more difficult thing to change and evolve over time.<p>Changing a source file line and shipping a new version of the app is much easier.<p>They are not really comparable things at all. Even though we moved to infrastructure as code, that does not mean that the infra code is like functional application code.<p>Come to think of it, I guess it was a damn good lie to sell infrastructure as code as so easy it&#x27;s like shipping a new app version when it&#x27;s everything but..</div><br/></div></div></div></div><div id="39323405" class="c"><input type="checkbox" id="c-39323405" checked=""/><div class="controls bullet"><span class="by">falsandtru</span><span>|</span><a href="#39323219">prev</a><span>|</span><a href="#39323668">next</a><span>|</span><label class="collapse" for="c-39323405">[-]</label><label class="expand" for="c-39323405">[1 more]</label></div><br/><div class="children"><div class="content">FDB, a distributed DB, would be superior if complete order is not required.<p><a href="https:&#x2F;&#x2F;apple.github.io&#x2F;foundationdb&#x2F;queues.html" rel="nofollow">https:&#x2F;&#x2F;apple.github.io&#x2F;foundationdb&#x2F;queues.html</a></div><br/></div></div><div id="39323668" class="c"><input type="checkbox" id="c-39323668" checked=""/><div class="controls bullet"><span class="by">osigurdson</span><span>|</span><a href="#39323405">prev</a><span>|</span><a href="#39322950">next</a><span>|</span><label class="collapse" for="c-39323668">[-]</label><label class="expand" for="c-39323668">[1 more]</label></div><br/><div class="children"><div class="content">It is all about numbers. What latency is acceptable in this hypothetical? How many workers are there? I&#x27;m not sure how long x is &quot;time.sleep(x)&quot; but unless very long this will use one connection per worker. That is probably fine in this situation but it isn&#x27;t fine for all projects.</div><br/></div></div><div id="39322950" class="c"><input type="checkbox" id="c-39322950" checked=""/><div class="controls bullet"><span class="by">adaboese</span><span>|</span><a href="#39323668">prev</a><span>|</span><a href="#39323214">next</a><span>|</span><label class="collapse" for="c-39322950">[-]</label><label class="expand" for="c-39322950">[17 more]</label></div><br/><div class="children"><div class="content">Postgres is extremely expensive to scale. Why on Earth would you try to put queue there.</div><br/><div id="39323021" class="c"><input type="checkbox" id="c-39323021" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39324444">next</a><span>|</span><label class="collapse" for="c-39323021">[-]</label><label class="expand" for="c-39323021">[6 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re running less than a million tasks a day through a queue and you already have PostgreSQL in your stack why add anything else?</div><br/><div id="39323146" class="c"><input type="checkbox" id="c-39323146" checked=""/><div class="controls bullet"><span class="by">adaboese</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323021">parent</a><span>|</span><a href="#39324444">next</a><span>|</span><label class="collapse" for="c-39323146">[-]</label><label class="expand" for="c-39323146">[5 more]</label></div><br/><div class="children"><div class="content">Just use a dedicated tool. It is not that hard. If you want higher level abstraction, you have a whole spectrum of next gen queues, like Temporal, Trigger.dev, Inngest, Defer, etc.</div><br/><div id="39323636" class="c"><input type="checkbox" id="c-39323636" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323146">parent</a><span>|</span><a href="#39323221">next</a><span>|</span><label class="collapse" for="c-39323636">[-]</label><label class="expand" for="c-39323636">[1 more]</label></div><br/><div class="children"><div class="content">Why use a dedicated tool if you have something in your stack that can solve the problem already?<p>The less separate pieces of infrastructure you can run, the less likely something will break that you don&#x27;t know how to easily fix.<p>The article touched on this in the list of things to avoid when it said &quot;I estimate each line of terraform to be an order of magnitude more risk&#x2F;maintenance&#x2F;faff than each line of Python&quot; and &quot;The need for expertise in anything beyond Python + Postgres&quot;</div><br/></div></div><div id="39323221" class="c"><input type="checkbox" id="c-39323221" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323146">parent</a><span>|</span><a href="#39323636">prev</a><span>|</span><a href="#39324444">next</a><span>|</span><label class="collapse" for="c-39323221">[-]</label><label class="expand" for="c-39323221">[3 more]</label></div><br/><div class="children"><div class="content">Personally the next-gen-ness of an infrastructure component is inversely proportional to my trust in it.</div><br/><div id="39324063" class="c"><input type="checkbox" id="c-39324063" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323221">parent</a><span>|</span><a href="#39323303">next</a><span>|</span><label class="collapse" for="c-39324063">[-]</label><label class="expand" for="c-39324063">[1 more]</label></div><br/><div class="children"><div class="content">Right, use boring technology!<p><a href="https:&#x2F;&#x2F;boringtechnology.club&#x2F;" rel="nofollow">https:&#x2F;&#x2F;boringtechnology.club&#x2F;</a></div><br/></div></div><div id="39323303" class="c"><input type="checkbox" id="c-39323303" checked=""/><div class="controls bullet"><span class="by">bakchodi</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323221">parent</a><span>|</span><a href="#39324063">prev</a><span>|</span><a href="#39324444">next</a><span>|</span><label class="collapse" for="c-39323303">[-]</label><label class="expand" for="c-39323303">[1 more]</label></div><br/><div class="children"><div class="content">Especially for something handling data. I want an old, battle tested solution that won&#x27;t disappear when the VC capital dries up</div><br/></div></div></div></div></div></div></div></div><div id="39324444" class="c"><input type="checkbox" id="c-39324444" checked=""/><div class="controls bullet"><span class="by">cha42</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323021">prev</a><span>|</span><a href="#39323017">next</a><span>|</span><label class="collapse" for="c-39324444">[-]</label><label class="expand" for="c-39324444">[1 more]</label></div><br/><div class="children"><div class="content">If you have an infra that need to scale so much then Postgresql isn&#x27;t the right tool indeed. The right tools for your use case probably doesn&#x27;t even exists and you will have to build one.<p>It is not a mystery why all webscale companies endup designing their own DB technology.<p>That being said, most of the DB in the wild are not remotely at those scale. I have seen my share of Postgresql&#x2F;ElasticSearch combo to handle below TB data and just collapsing because of the overeng of administrating two DB in one app.</div><br/></div></div><div id="39323017" class="c"><input type="checkbox" id="c-39323017" checked=""/><div class="controls bullet"><span class="by">valenterry</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39324444">prev</a><span>|</span><a href="#39323162">next</a><span>|</span><label class="collapse" for="c-39323017">[-]</label><label class="expand" for="c-39323017">[1 more]</label></div><br/><div class="children"><div class="content">Maintaining extra infrastructure is expensive. Working around missing ACID is expensive. Depending on how many messages we are talking about, the cost of scaling postgres a bit more might be much lower.</div><br/></div></div><div id="39323162" class="c"><input type="checkbox" id="c-39323162" checked=""/><div class="controls bullet"><span class="by">CubsFan1060</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323017">prev</a><span>|</span><a href="#39322989">next</a><span>|</span><label class="collapse" for="c-39323162">[-]</label><label class="expand" for="c-39323162">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;microservices.io&#x2F;patterns&#x2F;data&#x2F;transactional-outbox.html" rel="nofollow">https:&#x2F;&#x2F;microservices.io&#x2F;patterns&#x2F;data&#x2F;transactional-outbox....</a><p>It allows you to wrap it all in a transaction. If you separate a database update and insertion into a queue, whichever happens second may fail, while the first succeeds.</div><br/><div id="39323321" class="c"><input type="checkbox" id="c-39323321" checked=""/><div class="controls bullet"><span class="by">illusive4080</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323162">parent</a><span>|</span><a href="#39322989">next</a><span>|</span><label class="collapse" for="c-39323321">[-]</label><label class="expand" for="c-39323321">[1 more]</label></div><br/><div class="children"><div class="content">Tell the alternative is a saga pattern to implement a distributed two phase commit.<p>Or actual XA, but that is cursed.</div><br/></div></div></div></div><div id="39322989" class="c"><input type="checkbox" id="c-39322989" checked=""/><div class="controls bullet"><span class="by">kromem</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323162">prev</a><span>|</span><a href="#39323188">next</a><span>|</span><label class="collapse" for="c-39322989">[-]</label><label class="expand" for="c-39322989">[1 more]</label></div><br/><div class="children"><div class="content">The mantra about premature optimization applies to infrastructure too.</div><br/></div></div><div id="39323188" class="c"><input type="checkbox" id="c-39323188" checked=""/><div class="controls bullet"><span class="by">beeboobaa</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39322989">prev</a><span>|</span><a href="#39323350">next</a><span>|</span><label class="collapse" for="c-39323188">[-]</label><label class="expand" for="c-39323188">[1 more]</label></div><br/><div class="children"><div class="content">because you&#x27;re not expecting to have to scale beyond 1 instance for the next few years &amp; are already using postgres &amp; now everything is trivially transactional. KISS</div><br/></div></div><div id="39323350" class="c"><input type="checkbox" id="c-39323350" checked=""/><div class="controls bullet"><span class="by">wavemode</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323188">prev</a><span>|</span><a href="#39323138">next</a><span>|</span><label class="collapse" for="c-39323350">[-]</label><label class="expand" for="c-39323350">[2 more]</label></div><br/><div class="children"><div class="content">If the choice is between using a dedicated queue and postgres for your data vs. using postgres for both, using postgres for both makes perfect sense.<p>The scale at which you would outgrow using postgres for the queue, you would also outgrow using postgres for the data.</div><br/><div id="39323771" class="c"><input type="checkbox" id="c-39323771" checked=""/><div class="controls bullet"><span class="by">halfcat</span><span>|</span><a href="#39322950">root</a><span>|</span><a href="#39323350">parent</a><span>|</span><a href="#39323138">next</a><span>|</span><label class="collapse" for="c-39323771">[-]</label><label class="expand" for="c-39323771">[1 more]</label></div><br/><div class="children"><div class="content">At what point does one outgrow Postgres for the data?</div><br/></div></div></div></div><div id="39323138" class="c"><input type="checkbox" id="c-39323138" checked=""/><div class="controls bullet"><span class="by">cwbriscoe</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323350">prev</a><span>|</span><a href="#39323130">next</a><span>|</span><label class="collapse" for="c-39323138">[-]</label><label class="expand" for="c-39323138">[1 more]</label></div><br/><div class="children"><div class="content">Any DB is fine as a queue depending on requirements, design and usage.</div><br/></div></div><div id="39323130" class="c"><input type="checkbox" id="c-39323130" checked=""/><div class="controls bullet"><span class="by">throwaway2990</span><span>|</span><a href="#39322950">parent</a><span>|</span><a href="#39323138">prev</a><span>|</span><a href="#39323214">next</a><span>|</span><label class="collapse" for="c-39323130">[-]</label><label class="expand" for="c-39323130">[1 more]</label></div><br/><div class="children"><div class="content">lol no it’s not.</div><br/></div></div></div></div><div id="39323214" class="c"><input type="checkbox" id="c-39323214" checked=""/><div class="controls bullet"><span class="by">nomdep</span><span>|</span><a href="#39322950">prev</a><span>|</span><a href="#39323151">next</a><span>|</span><label class="collapse" for="c-39323214">[-]</label><label class="expand" for="c-39323214">[1 more]</label></div><br/><div class="children"><div class="content">Why? Because memory is expensive and disk space is cheap</div><br/></div></div><div id="39323151" class="c"><input type="checkbox" id="c-39323151" checked=""/><div class="controls bullet"><span class="by">dharmab</span><span>|</span><a href="#39323214">prev</a><span>|</span><a href="#39323392">next</a><span>|</span><label class="collapse" for="c-39323151">[-]</label><label class="expand" for="c-39323151">[14 more]</label></div><br/><div class="children"><div class="content">Postgres as a queue is one of the worst decisions I&#x27;ve seen made and I and others I&#x27;ve worked with have spent years of our lives unwinding the consequences.</div><br/><div id="39323320" class="c"><input type="checkbox" id="c-39323320" checked=""/><div class="controls bullet"><span class="by">mikercampbell</span><span>|</span><a href="#39323151">parent</a><span>|</span><a href="#39323257">next</a><span>|</span><label class="collapse" for="c-39323320">[-]</label><label class="expand" for="c-39323320">[1 more]</label></div><br/><div class="children"><div class="content">It’s almost as if we were in an ordered line, all waiting to learn the same thing, and had the lesson delivered no more than once.</div><br/></div></div><div id="39323257" class="c"><input type="checkbox" id="c-39323257" checked=""/><div class="controls bullet"><span class="by">dralley</span><span>|</span><a href="#39323151">parent</a><span>|</span><a href="#39323320">prev</a><span>|</span><a href="#39323355">next</a><span>|</span><label class="collapse" for="c-39323257">[-]</label><label class="expand" for="c-39323257">[6 more]</label></div><br/><div class="children"><div class="content">Completely disagree for our use case.  If your messages aren&#x27;t send-and-forget but rather represent work that needs to be tracked, it is incredibly difficult to manage the state when your database and queue are separate.  Using postgresql as the queue and leveraging the same transactions as your business logic solves many many issues.</div><br/><div id="39323883" class="c"><input type="checkbox" id="c-39323883" checked=""/><div class="controls bullet"><span class="by">nurettin</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323257">parent</a><span>|</span><a href="#39323436">next</a><span>|</span><label class="collapse" for="c-39323883">[-]</label><label class="expand" for="c-39323883">[1 more]</label></div><br/><div class="children"><div class="content">As a person who has implemented worker farms at scale, I don&#x27;t understand which part is &quot;incredibly difficult&quot;, or what having a dedicated queue server prevents you from updating database state within &quot;the same transactions&quot;. If your worker process has to update some kind of task state and calculate some business logic, it can still do so whether if you use rmq, redis or whatever.</div><br/></div></div><div id="39323436" class="c"><input type="checkbox" id="c-39323436" checked=""/><div class="controls bullet"><span class="by">nostrebored</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323257">parent</a><span>|</span><a href="#39323883">prev</a><span>|</span><a href="#39323355">next</a><span>|</span><label class="collapse" for="c-39323436">[-]</label><label class="expand" for="c-39323436">[4 more]</label></div><br/><div class="children"><div class="content">How is it incredibly difficult? I’ve seen this work very well.<p>Is your code handling different varieties of event states stored in your database?<p>Why implement this as a monolithic data source? Was it not possible to separate different states by additional queues?<p>Curious to hear the decision making process here. Maybe I can see it for low volume?</div><br/><div id="39323590" class="c"><input type="checkbox" id="c-39323590" checked=""/><div class="controls bullet"><span class="by">jvans</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323436">parent</a><span>|</span><a href="#39323630">next</a><span>|</span><label class="collapse" for="c-39323590">[-]</label><label class="expand" for="c-39323590">[1 more]</label></div><br/><div class="children"><div class="content">dralley is saying your queue push and database write aren&#x27;t transactional. You have to be ok suffering some small % of message loss or messages sent without a database commit</div><br/></div></div><div id="39323630" class="c"><input type="checkbox" id="c-39323630" checked=""/><div class="controls bullet"><span class="by">arcbyte</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323436">parent</a><span>|</span><a href="#39323590">prev</a><span>|</span><a href="#39323561">next</a><span>|</span><label class="collapse" for="c-39323630">[-]</label><label class="expand" for="c-39323630">[1 more]</label></div><br/><div class="children"><div class="content">At the end of the day, the ONLY way to reliably do this is to hook into the databases native journal&#x2F;log anyway. Postgres gives you better primitives to work with than installing Qlik for example.</div><br/></div></div><div id="39323561" class="c"><input type="checkbox" id="c-39323561" checked=""/><div class="controls bullet"><span class="by">dralley</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323436">parent</a><span>|</span><a href="#39323630">prev</a><span>|</span><a href="#39323355">next</a><span>|</span><label class="collapse" for="c-39323561">[-]</label><label class="expand" for="c-39323561">[1 more]</label></div><br/><div class="children"><div class="content">Admittedly we&#x27;re not using it for anything high volume.</div><br/></div></div></div></div></div></div><div id="39323355" class="c"><input type="checkbox" id="c-39323355" checked=""/><div class="controls bullet"><span class="by">wavemode</span><span>|</span><a href="#39323151">parent</a><span>|</span><a href="#39323257">prev</a><span>|</span><a href="#39323352">next</a><span>|</span><label class="collapse" for="c-39323355">[-]</label><label class="expand" for="c-39323355">[1 more]</label></div><br/><div class="children"><div class="content">Care to elaborate?</div><br/></div></div><div id="39323352" class="c"><input type="checkbox" id="c-39323352" checked=""/><div class="controls bullet"><span class="by">mistrial9</span><span>|</span><a href="#39323151">parent</a><span>|</span><a href="#39323355">prev</a><span>|</span><a href="#39323268">next</a><span>|</span><label class="collapse" for="c-39323352">[-]</label><label class="expand" for="c-39323352">[4 more]</label></div><br/><div class="children"><div class="content">saying so without context or requirements at all reduces the effectiveness of the insight</div><br/><div id="39323492" class="c"><input type="checkbox" id="c-39323492" checked=""/><div class="controls bullet"><span class="by">dharmab</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323352">parent</a><span>|</span><a href="#39323268">next</a><span>|</span><label class="collapse" for="c-39323492">[-]</label><label class="expand" for="c-39323492">[3 more]</label></div><br/><div class="children"><div class="content">Sadly my work is subject to regulatory requirements that prevent me from discussing specific details :(</div><br/><div id="39323577" class="c"><input type="checkbox" id="c-39323577" checked=""/><div class="controls bullet"><span class="by">sbuttgereit</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323492">parent</a><span>|</span><a href="#39324060">next</a><span>|</span><label class="collapse" for="c-39323577">[-]</label><label class="expand" for="c-39323577">[1 more]</label></div><br/><div class="children"><div class="content">Surely if your complaint is general enough to give such advice to everyone here, there must be a way to express generalized technical details of that complaint without disclosing anything more privileged than you already have.  If that kind of abstraction and generalization isn&#x27;t possible, then it sounds  to me like something specific to your work&#x27;s implementation of the ideas and not something that applies broadly.</div><br/></div></div><div id="39324060" class="c"><input type="checkbox" id="c-39324060" checked=""/><div class="controls bullet"><span class="by">cqqxo4zV46cp</span><span>|</span><a href="#39323151">root</a><span>|</span><a href="#39323492">parent</a><span>|</span><a href="#39323577">prev</a><span>|</span><a href="#39323268">next</a><span>|</span><label class="collapse" for="c-39324060">[-]</label><label class="expand" for="c-39324060">[1 more]</label></div><br/><div class="children"><div class="content">Oh, okay. It’s great that you’ve let us all know that you hold The Secret. Thank you.</div><br/></div></div></div></div></div></div><div id="39323268" class="c"><input type="checkbox" id="c-39323268" checked=""/><div class="controls bullet"><span class="by">canadiantim</span><span>|</span><a href="#39323151">parent</a><span>|</span><a href="#39323352">prev</a><span>|</span><a href="#39323392">next</a><span>|</span><label class="collapse" for="c-39323268">[-]</label><label class="expand" for="c-39323268">[1 more]</label></div><br/><div class="children"><div class="content">years seems like hyperbole</div><br/></div></div></div></div><div id="39323392" class="c"><input type="checkbox" id="c-39323392" checked=""/><div class="controls bullet"><span class="by">nemo44x</span><span>|</span><a href="#39323151">prev</a><span>|</span><label class="collapse" for="c-39323392">[-]</label><label class="expand" for="c-39323392">[4 more]</label></div><br/><div class="children"><div class="content">I’m still waiting for the “Postgres as a Web Browser” thread.</div><br/><div id="39323806" class="c"><input type="checkbox" id="c-39323806" checked=""/><div class="controls bullet"><span class="by">nurettin</span><span>|</span><a href="#39323392">parent</a><span>|</span><label class="collapse" for="c-39323806">[-]</label><label class="expand" for="c-39323806">[3 more]</label></div><br/><div class="children"><div class="content">Postgres rust rewrite will be a huge thread.</div><br/><div id="39324223" class="c"><input type="checkbox" id="c-39324223" checked=""/><div class="controls bullet"><span class="by">jesperwe</span><span>|</span><a href="#39323392">root</a><span>|</span><a href="#39323806">parent</a><span>|</span><label class="collapse" for="c-39324223">[-]</label><label class="expand" for="c-39324223">[2 more]</label></div><br/><div class="children"><div class="content">It has already started.
<a href="https:&#x2F;&#x2F;docs.rs&#x2F;pgx&#x2F;latest&#x2F;pgx&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.rs&#x2F;pgx&#x2F;latest&#x2F;pgx&#x2F;</a><p>Not hard to see path ahead of us similar to Linux&#x27;s gradual step towards Rust in the kernel.</div><br/><div id="39324386" class="c"><input type="checkbox" id="c-39324386" checked=""/><div class="controls bullet"><span class="by">tpetry</span><span>|</span><a href="#39323392">root</a><span>|</span><a href="#39324223">parent</a><span>|</span><label class="collapse" for="c-39324386">[-]</label><label class="expand" for="c-39324386">[1 more]</label></div><br/><div class="children"><div class="content">Postgres Rust extensions is a completely different topic than rewriting PG in Rust. The problem is that a crash in any extension will take down the full PG worker. So you can havoc the robustness of your PG database with any extension. But with a memory-safe language like Rust which forces you to handle all error cases this can‘t happen anymore.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>