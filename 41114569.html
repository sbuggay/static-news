<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1722416514608" as="style"/><link rel="stylesheet" href="styles.css?v=1722416514608"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lock.cmpxchg8b.com/slowterm.html">Troubleshooting: Terminal Lag</a> <span class="domain">(<a href="https://lock.cmpxchg8b.com">lock.cmpxchg8b.com</a>)</span></div><div class="subtext"><span>janvdberg</span> | <span>28 comments</span></div><br/><div><div id="41116403" class="c"><input type="checkbox" id="c-41116403" checked=""/><div class="controls bullet"><span class="by">vijucat</span><span>|</span><a href="#41115833">next</a><span>|</span><label class="collapse" for="c-41116403">[-]</label><label class="expand" for="c-41116403">[3 more]</label></div><br/><div class="children"><div class="content">Love such articles where I learn something new. cdb is completely new to me. It&#x27;s apparently the Microsoft Console Debugger. For others like me who were wondering how `eb win32u!NtUserSetLayeredWindowAttributes c3` neutered the window animation:<p>&quot;By executing this command, you are effectively replacing the first byte of the `NtUserSetLayeredWindowAttributes` function with a `ret` instruction. This means that any call to `NtUserSetLayeredWindowAttributes` will immediately return without executing any of its original code. This can be used to bypass or disable the functionality of this function&quot;<p>(Thanks to GitHub Copilot for that)<p>Also see <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows-hardware&#x2F;drivers&#x2F;debuggercmds&#x2F;e--ea--eb--ed--ed--ef--ep--eq--eu--ew--eza--ezu--enter-values-" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows-hardware&#x2F;drivers&#x2F;d...</a></div><br/><div id="41116673" class="c"><input type="checkbox" id="c-41116673" checked=""/><div class="controls bullet"><span class="by">xelxebar</span><span>|</span><a href="#41116403">parent</a><span>|</span><a href="#41115833">next</a><span>|</span><label class="collapse" for="c-41116673">[-]</label><label class="expand" for="c-41116673">[2 more]</label></div><br/><div class="children"><div class="content">Nice. Here&#x27;s a breakdown for anyone interested:<p>- eb[0] &quot;enters bytes&quot; into memory at the specified location;<p>- The RETN[1] instruction is encoded as C3 in x86 opcodes; and<p>- Debuggers will typically load ELF symbols so you can refer to memory locations with their names, i.e. function names refer to their jump target.<p>Putting those three together, we almost get the author&#x27;s command. I&#x27;m not sure about the &quot;win32u!NtUser&quot; name prefix, though. Is it name-munging performed on the compiler side? Maybe some debugger syntax thrown in to select the dll source of the name?<p>[0]:<a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows-hardware&#x2F;drivers&#x2F;debuggercmds&#x2F;e--ea--eb--ed--ed--ef--ep--eq--eu--ew--eza--ezu--enter-values-" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows-hardware&#x2F;drivers&#x2F;d...</a><p>[1]:<a href="http:&#x2F;&#x2F;ref.x86asm.net&#x2F;geek64.html#xC3" rel="nofollow">http:&#x2F;&#x2F;ref.x86asm.net&#x2F;geek64.html#xC3</a></div><br/><div id="41117240" class="c"><input type="checkbox" id="c-41117240" checked=""/><div class="controls bullet"><span class="by">therein</span><span>|</span><a href="#41116403">root</a><span>|</span><a href="#41116673">parent</a><span>|</span><a href="#41115833">next</a><span>|</span><label class="collapse" for="c-41117240">[-]</label><label class="expand" for="c-41117240">[1 more]</label></div><br/><div class="children"><div class="content">Yes, NtUserSetLayeredWindowAttributes is in win32u.dll.<p>And if you are wondering what&#x27;s the difference between win32u.dll and user32.dll.<p>&gt; win32u.dll is a link for System calls between User mode (Ring 3) and Kernel mode (Ring 0) : Ring 3 =&gt; Ring 0 <a href="https:&#x2F;&#x2F;imgbb.com&#x2F;L8FTP2C" rel="nofollow">https:&#x2F;&#x2F;imgbb.com&#x2F;L8FTP2C</a> [0]<p>[0] - <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;answers&#x2F;questions&#x2F;213495&#x2F;win32u-dll-vs-user32-dll" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;answers&#x2F;questions&#x2F;213495&#x2F;w...</a></div><br/></div></div></div></div></div></div><div id="41115833" class="c"><input type="checkbox" id="c-41115833" checked=""/><div class="controls bullet"><span class="by">abraae</span><span>|</span><a href="#41116403">prev</a><span>|</span><a href="#41116711">next</a><span>|</span><label class="collapse" for="c-41115833">[-]</label><label class="expand" for="c-41115833">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m at the tail end of my career, so working on efficiency gains like this doesn&#x27;t usually add up for me.<p>However I was interested in knowing whether it does for the author.<p>Assuming he&#x2F;she does suffer this 1300 ms delay &quot;hundreds&quot; of times a day (let&#x27;s say 200) and for the sake of argument they use their computer 300 days a year and have 20 years of such work ahead of them with this config, then this inefficiency will total 1300 x 200 x 300 x 20 &#x2F; 1000 &#x2F; 60 &#x2F; 60 hours wasted during author&#x27;s lifetime - some 430 hours.<p>So well worth the effort to fix!</div><br/><div id="41115847" class="c"><input type="checkbox" id="c-41115847" checked=""/><div class="controls bullet"><span class="by">anonymoushn</span><span>|</span><a href="#41115833">parent</a><span>|</span><a href="#41116722">next</a><span>|</span><label class="collapse" for="c-41115847">[-]</label><label class="expand" for="c-41115847">[1 more]</label></div><br/><div class="children"><div class="content">I find that annoyances cost me much more than the wall-clock time of the delay. You&#x27;re lucky to disagree :)</div><br/></div></div><div id="41116722" class="c"><input type="checkbox" id="c-41116722" checked=""/><div class="controls bullet"><span class="by">sllabres</span><span>|</span><a href="#41115833">parent</a><span>|</span><a href="#41115847">prev</a><span>|</span><a href="#41116711">next</a><span>|</span><label class="collapse" for="c-41116722">[-]</label><label class="expand" for="c-41116722">[1 more]</label></div><br/><div class="children"><div class="content">I had a printout of [1] at my office.
Of course at is base it is only a simple multiplication table, but nevertheless is reminded me several time that a issue is worth fixing.<p>[1] <a href="https:&#x2F;&#x2F;xkcd.com&#x2F;1205&#x2F;" rel="nofollow">https:&#x2F;&#x2F;xkcd.com&#x2F;1205&#x2F;</a></div><br/></div></div></div></div><div id="41116711" class="c"><input type="checkbox" id="c-41116711" checked=""/><div class="controls bullet"><span class="by">txdv</span><span>|</span><a href="#41115833">prev</a><span>|</span><a href="#41116002">next</a><span>|</span><label class="collapse" for="c-41116711">[-]</label><label class="expand" for="c-41116711">[1 more]</label></div><br/><div class="children"><div class="content">So the root cause of the slowness was not found, it was just circumvented by keeping 3 xterms open and just using hiding&#x2F;showing them?</div><br/></div></div><div id="41116002" class="c"><input type="checkbox" id="c-41116002" checked=""/><div class="controls bullet"><span class="by">aardshark</span><span>|</span><a href="#41116711">prev</a><span>|</span><a href="#41116283">next</a><span>|</span><label class="collapse" for="c-41116002">[-]</label><label class="expand" for="c-41116002">[2 more]</label></div><br/><div class="children"><div class="content">300ms for startup still sounds slow to me.   Not ridiculously so, but it won&#x27;t give that snappy feeling.</div><br/><div id="41116148" class="c"><input type="checkbox" id="c-41116148" checked=""/><div class="controls bullet"><span class="by">jlarocco</span><span>|</span><a href="#41116002">parent</a><span>|</span><a href="#41116283">next</a><span>|</span><label class="collapse" for="c-41116148">[-]</label><label class="expand" for="c-41116148">[1 more]</label></div><br/><div class="children"><div class="content">I thought so, too.  I&#x27;m not interested enough to benchmark it, but for all practical purposes it&#x27;s instantaneous on my machine.  As fast to open a new terminal as it is to switch to the existing one.</div><br/></div></div></div></div><div id="41116283" class="c"><input type="checkbox" id="c-41116283" checked=""/><div class="controls bullet"><span class="by">jd3</span><span>|</span><a href="#41116002">prev</a><span>|</span><a href="#41116698">next</a><span>|</span><label class="collapse" for="c-41116283">[-]</label><label class="expand" for="c-41116283">[7 more]</label></div><br/><div class="children"><div class="content">I&#x27;m so distracted by latency that I run my macOS with vsync disabled 24&#x2F;7 (through Quartz Debug).<p>When I used to use Windows 10+ years ago, I had decent luck using xming + cygwin + Cygwin&#x2F;X + bblean to run xterm in a minimal latency&#x2F;lag environment.<p>I also launch Chrome&#x2F;Spotify&#x2F;Slack desktop using:<p>$ open -a open -a Google\ Chrome --args --disable-gpu-vsync --disable-smooth-scrolling</div><br/><div id="41116404" class="c"><input type="checkbox" id="c-41116404" checked=""/><div class="controls bullet"><span class="by">abhinavk</span><span>|</span><a href="#41116283">parent</a><span>|</span><a href="#41116348">next</a><span>|</span><label class="collapse" for="c-41116404">[-]</label><label class="expand" for="c-41116404">[4 more]</label></div><br/><div class="children"><div class="content">One way to have the cake and eat it too is to upgrade to a high-refresh rate display. No tearing + less latency + smoother display. Although it&#x27;s diminishing returns even 60Hz -&gt; 144Hz+ will make a lot of difference. On a 240Hz display, vsync penalty is just 4ms.<p>Also if you are using a miniLED M-class MBP, its pixel response is abysmal.</div><br/><div id="41117229" class="c"><input type="checkbox" id="c-41117229" checked=""/><div class="controls bullet"><span class="by">fellerts</span><span>|</span><a href="#41116283">root</a><span>|</span><a href="#41116404">parent</a><span>|</span><a href="#41116434">next</a><span>|</span><label class="collapse" for="c-41117229">[-]</label><label class="expand" for="c-41117229">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been running uncomposited X for years to reduce latency, but after getting a dual 120 Hz monitor setup, I might finally consider Wayland! This is good advice.<p>Too bad vscode doesn&#x27;t support higher refresh rates. It&#x27;s locked to 60 for some reason I haven&#x27;t been able to grasp.</div><br/></div></div><div id="41116434" class="c"><input type="checkbox" id="c-41116434" checked=""/><div class="controls bullet"><span class="by">jd3</span><span>|</span><a href="#41116283">root</a><span>|</span><a href="#41116404">parent</a><span>|</span><a href="#41117229">prev</a><span>|</span><a href="#41116484">next</a><span>|</span><label class="collapse" for="c-41116434">[-]</label><label class="expand" for="c-41116434">[1 more]</label></div><br/><div class="children"><div class="content">Yep, have been planning to upgrade to a 240hz+ OLED for awhile! I find the typing input latency on my M1 MacBook Pro to be pretty abysmal when using the built-in retina display and no external monitor — I almost feel like I can only get work done when I have it plugged into my external monitor in clamshell mode and disable vsync.</div><br/></div></div><div id="41116484" class="c"><input type="checkbox" id="c-41116484" checked=""/><div class="controls bullet"><span class="by">bee_rider</span><span>|</span><a href="#41116283">root</a><span>|</span><a href="#41116404">parent</a><span>|</span><a href="#41116434">prev</a><span>|</span><a href="#41116348">next</a><span>|</span><label class="collapse" for="c-41116484">[-]</label><label class="expand" for="c-41116484">[1 more]</label></div><br/><div class="children"><div class="content">It just seems so wasteful to run desktop and office programs at hundreds of hertz…</div><br/></div></div></div></div><div id="41116348" class="c"><input type="checkbox" id="c-41116348" checked=""/><div class="controls bullet"><span class="by">apazzolini</span><span>|</span><a href="#41116283">parent</a><span>|</span><a href="#41116404">prev</a><span>|</span><a href="#41116698">next</a><span>|</span><label class="collapse" for="c-41116348">[-]</label><label class="expand" for="c-41116348">[2 more]</label></div><br/><div class="children"><div class="content">Out of curiosity, have you tried a 144hz monitor on macOS with vsync enabled?</div><br/><div id="41116431" class="c"><input type="checkbox" id="c-41116431" checked=""/><div class="controls bullet"><span class="by">jd3</span><span>|</span><a href="#41116283">root</a><span>|</span><a href="#41116348">parent</a><span>|</span><a href="#41116698">next</a><span>|</span><label class="collapse" for="c-41116431">[-]</label><label class="expand" for="c-41116431">[1 more]</label></div><br/><div class="children"><div class="content">I use a cheap 75hz IPS from my office, though, ideally, I&#x27;d like to upgrade to a 240hz+ OLED w&#x2F; VRR since macOS now supports adaptive sync[0]; i&#x27;ve been waiting because I&#x27;m not satisfied w&#x2F; any of the OLED monitors currently on the market and my monitor upgrade request was denied by my employer.<p>Though I&#x27;ve used the Apple Magic Keyboard w&#x2F; Touch ID exclusively for awhile, I&#x27;m also thinking about upgrading to the new Wooting 80HE keyboard this fall since it has a 8kHz polling rate, analog hall effect switches, and is designed to be ultra low latency w&#x2F; tachyon mode enabled.<p>[0]: <a href="https:&#x2F;&#x2F;support.apple.com&#x2F;guide&#x2F;mac-help&#x2F;use-adaptive-sync-with-your-mac-mchld453162e&#x2F;mac" rel="nofollow">https:&#x2F;&#x2F;support.apple.com&#x2F;guide&#x2F;mac-help&#x2F;use-adaptive-sync-w...</a></div><br/></div></div></div></div></div></div><div id="41116698" class="c"><input type="checkbox" id="c-41116698" checked=""/><div class="controls bullet"><span class="by">pcthrowaway</span><span>|</span><a href="#41116283">prev</a><span>|</span><a href="#41116001">next</a><span>|</span><label class="collapse" for="c-41116698">[-]</label><label class="expand" for="c-41116698">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I’ve been using this configuration for a few days, so far it’s working great. I haven’t noticed any issues running it this way.<p>The journey was <i>very</i> useful, even the destination may be pretty specific to your needs. The process of <i>how to go about debugging</i> minor annoyances like this is really hard to learn about.</div><br/></div></div><div id="41116001" class="c"><input type="checkbox" id="c-41116001" checked=""/><div class="controls bullet"><span class="by">aardshark</span><span>|</span><a href="#41116698">prev</a><span>|</span><a href="#41116053">next</a><span>|</span><label class="collapse" for="c-41116001">[-]</label><label class="expand" for="c-41116001">[1 more]</label></div><br/><div class="children"><div class="content">300ms for startup still sounds slow to me.   Not ridiculously so, but it won&#x27;t give that snappy feeling.</div><br/></div></div><div id="41116053" class="c"><input type="checkbox" id="c-41116053" checked=""/><div class="controls bullet"><span class="by">mberning</span><span>|</span><a href="#41116001">prev</a><span>|</span><a href="#41115046">next</a><span>|</span><label class="collapse" for="c-41116053">[-]</label><label class="expand" for="c-41116053">[1 more]</label></div><br/><div class="children"><div class="content">This is a tour de force on the type of curiosity it takes to be really successful with computers.</div><br/></div></div><div id="41115046" class="c"><input type="checkbox" id="c-41115046" checked=""/><div class="controls bullet"><span class="by">pikseladam</span><span>|</span><a href="#41116053">prev</a><span>|</span><a href="#41115162">next</a><span>|</span><label class="collapse" for="c-41115046">[-]</label><label class="expand" for="c-41115046">[1 more]</label></div><br/><div class="children"><div class="content">it was a fun read</div><br/></div></div><div id="41115162" class="c"><input type="checkbox" id="c-41115162" checked=""/><div class="controls bullet"><span class="by">aftbit</span><span>|</span><a href="#41115046">prev</a><span>|</span><label class="collapse" for="c-41115162">[-]</label><label class="expand" for="c-41115162">[7 more]</label></div><br/><div class="children"><div class="content">Upvote just for teaching me about the existence of `hyperfine`.<p><pre><code>    $ hyperfine &#x27;alacritty -e true&#x27;
    Benchmark 1: alacritty -e true
      Time (mean ± σ):      84.1 ms ±   4.9 ms    [User: 40.1 ms, System: 30.8 ms]
      Range (min … max):    80.5 ms … 104.4 ms    32 runs
    
    $ hyperfine &#x27;xterm -e true&#x27;
    Benchmark 1: xterm -e true
      Time (mean ± σ):      81.9 ms ±   2.6 ms    [User: 21.7 ms, System: 7.9 ms]
      Range (min … max):    74.9 ms …  87.1 ms    37 runs
    
    $ hyperfine &#x27;wezterm -e true&#x27;
    Benchmark 1: wezterm -e true
      Time (mean ± σ):     211.7 ms ±  13.4 ms    [User: 41.4 ms, System: 60.0 ms]
      Range (min … max):   190.5 ms … 240.5 ms    15 runs</code></pre></div><br/><div id="41115633" class="c"><input type="checkbox" id="c-41115633" checked=""/><div class="controls bullet"><span class="by">JNRowe</span><span>|</span><a href="#41115162">parent</a><span>|</span><a href="#41115987">next</a><span>|</span><label class="collapse" for="c-41115633">[-]</label><label class="expand" for="c-41115633">[2 more]</label></div><br/><div class="children"><div class="content"><i>If</i> we&#x27;re handing out tips, then as noted in a few examples from the article hyperfine is even more useful when called with multiple commands directly.  It presents a concise epilogue with the information you&#x27;re probably trying to gleam from a run such as yours:<p><pre><code>    $ hyperfine -L arg &#x27;1,2,3&#x27; &#x27;sleep {arg}&#x27;
    …
    Summary
      sleep 1 ran
        2.00 ± 0.00 times faster than sleep 2
        3.00 ± 0.00 times faster than sleep 3
</code></pre>
If your commands don&#x27;t share enough in common for that approach then you can declare them individually, as in &quot;hyperfine &#x27;blib 1&#x27; &#x27;blob x y&#x27; &#x27;blub --arg&#x27;&quot;, and still get the summary.</div><br/><div id="41115729" class="c"><input type="checkbox" id="c-41115729" checked=""/><div class="controls bullet"><span class="by">LanternLight83</span><span>|</span><a href="#41115162">root</a><span>|</span><a href="#41115633">parent</a><span>|</span><a href="#41115987">next</a><span>|</span><label class="collapse" for="c-41115729">[-]</label><label class="expand" for="c-41115729">[1 more]</label></div><br/><div class="children"><div class="content">i once used hyperfine to micro-bench elisp functions. i se  $SHELL to a script that evaluated it&#x27;s arguments in emacs by talking to a long-running session over a named pipe. Hyperfine runs a few no-ops with $SHELL and factored out the overhead, though it was still helpful to run a nested loop in elisp for finer results.</div><br/></div></div></div></div><div id="41115987" class="c"><input type="checkbox" id="c-41115987" checked=""/><div class="controls bullet"><span class="by">pimlottc</span><span>|</span><a href="#41115162">parent</a><span>|</span><a href="#41115633">prev</a><span>|</span><a href="#41116140">next</a><span>|</span><label class="collapse" for="c-41115987">[-]</label><label class="expand" for="c-41115987">[1 more]</label></div><br/><div class="children"><div class="content">Handy project link:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine">https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine</a></div><br/></div></div><div id="41116140" class="c"><input type="checkbox" id="c-41116140" checked=""/><div class="controls bullet"><span class="by">oguz-ismail</span><span>|</span><a href="#41115162">parent</a><span>|</span><a href="#41115987">prev</a><span>|</span><a href="#41115740">next</a><span>|</span><label class="collapse" for="c-41116140">[-]</label><label class="expand" for="c-41116140">[2 more]</label></div><br/><div class="children"><div class="content">Does it parse commands and call <i>exec*()</i> or spawn a new shell for every run of every command?</div><br/><div id="41116288" class="c"><input type="checkbox" id="c-41116288" checked=""/><div class="controls bullet"><span class="by">JNRowe</span><span>|</span><a href="#41115162">root</a><span>|</span><a href="#41116140">parent</a><span>|</span><a href="#41115740">next</a><span>|</span><label class="collapse" for="c-41116288">[-]</label><label class="expand" for="c-41116288">[1 more]</label></div><br/><div class="children"><div class="content">You can choose the behaviour with the --shell option¹.  The default behaviour is nice because it allows you to benchmark pipelines easily, but if you want to change it you can.<p>¹ <a href="https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine#intermediate-shell">https:&#x2F;&#x2F;github.com&#x2F;sharkdp&#x2F;hyperfine#intermediate-shell</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>