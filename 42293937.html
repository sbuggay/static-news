<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1733648455680" as="style"/><link rel="stylesheet" href="styles.css?v=1733648455680"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.binwang.me/2024-12-02-PostgreSQL-High-Availability-Solutions-Part-1.html">PostgreSQL High Availability Solutions – Part 1: Jepsen Test and Patroni</a> <span class="domain">(<a href="https://www.binwang.me">www.binwang.me</a>)</span></div><div class="subtext"><span>wb14123</span> | <span>10 comments</span></div><br/><div><div id="42355176" class="c"><input type="checkbox" id="c-42355176" checked=""/><div class="controls bullet"><span class="by">emmanueloga_</span><span>|</span><a href="#42354759">next</a><span>|</span><label class="collapse" for="c-42355176">[-]</label><label class="expand" for="c-42355176">[2 more]</label></div><br/><div class="children"><div class="content">Is anyone here using YugabyteDB for high-availability Postgres?<p>It seems like a compelling option:<p>* Much closer to Postgres compatibility than CockroachDB.<p>* A more permissive license.<p>* Built-in connection manager [1], which should simplify deployment.<p>* Supports both high availability and geo-distribution, which is useful if scaling globally becomes necessary later.<p>That said, I don&#x27;t see it mentioned around here often. I wonder if anyone here has tried it and can comment on it.<p>--<p>1: <a href="https:&#x2F;&#x2F;docs.yugabyte.com&#x2F;preview&#x2F;explore&#x2F;going-beyond-sql&#x2F;connection-mgr-ysql&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.yugabyte.com&#x2F;preview&#x2F;explore&#x2F;going-beyond-sql&#x2F;c...</a></div><br/><div id="42355809" class="c"><input type="checkbox" id="c-42355809" checked=""/><div class="controls bullet"><span class="by">anonzzzies</span><span>|</span><a href="#42355176">parent</a><span>|</span><a href="#42354759">next</a><span>|</span><label class="collapse" for="c-42355809">[-]</label><label class="expand" for="c-42355809">[1 more]</label></div><br/><div class="children"><div class="content">It seems cockroach got all the love here indeed. We use Yugabyte and we are happy with it; for our usecases it is a lot faster and easier to work with than cockroach.</div><br/></div></div></div></div><div id="42354759" class="c"><input type="checkbox" id="c-42354759" checked=""/><div class="controls bullet"><span class="by">hitpointdrew</span><span>|</span><a href="#42355176">prev</a><span>|</span><a href="#42355303">next</a><span>|</span><label class="collapse" for="c-42354759">[-]</label><label class="expand" for="c-42354759">[1 more]</label></div><br/><div class="children"><div class="content">The best way I have found is to setup keepalived -&gt; pgbouncer -&gt; Postgres. Use repmgr to manage replication and barman for backups. Setup a VIP with keepalived with a small script that checks if the server is primary. You loose about 7-9 pings during a failover, have keepalived check about every 2 seconds and flip after 3 consecutive failures.</div><br/></div></div><div id="42355303" class="c"><input type="checkbox" id="c-42355303" checked=""/><div class="controls bullet"><span class="by">logifail</span><span>|</span><a href="#42354759">prev</a><span>|</span><a href="#42354543">next</a><span>|</span><label class="collapse" for="c-42355303">[-]</label><label class="expand" for="c-42355303">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m currently looking for similar info but for MySQL&#x2F;MariaDB for an IoT side project ... any suggestions?</div><br/><div id="42355377" class="c"><input type="checkbox" id="c-42355377" checked=""/><div class="controls bullet"><span class="by">raffraffraff</span><span>|</span><a href="#42355303">parent</a><span>|</span><a href="#42355867">next</a><span>|</span><label class="collapse" for="c-42355377">[-]</label><label class="expand" for="c-42355377">[1 more]</label></div><br/><div class="children"><div class="content">MySQL has had first class replication and failover built into it for years. You deploy a server, enable binlogs, clone the server (percona&#x27;s xtranackup can live-clone a server locally or remotely) and start the new instance. Then you point the replica at the master using &#x27;CHANGE MASTER TO &lt;host&gt; ...&#x27; and it starts pulling binlogs and applying them. On the master, you can repeat this last step, making the replica <i>it&#x27;s</i> master. This means that you have multi-master replication. And it just works. There are some other tools you can use to detect failure of the current master and switch to another, that is up to you.<p>There are also solutions like MySQL Cluster and Galera which provide a more cluster-like solution with synchronous replication. If you&#x27;ve got a suitable use case (low writes, high reads and no gigantic transactions) this can work extremely well. You bootstrap a cluster on node 1, and new members automatically take a copy of the cluster data when they join. You can have 3 or 5 mode clusters, and reads are distributed across all nodes since it&#x27;s synchronous. Beware though, operating one of these things requires care. I&#x27;ve seen people suffer read downtime or full cluster outages by doing operations without understanding how they work under the hood. And if you&#x27;re cluster is hard-down, you need to pick the node with &quot;most recent transaction&quot; to re-bootstrap the cluster or you can lose transactions.</div><br/></div></div><div id="42355867" class="c"><input type="checkbox" id="c-42355867" checked=""/><div class="controls bullet"><span class="by">anonzzzies</span><span>|</span><a href="#42355303">parent</a><span>|</span><a href="#42355377">prev</a><span>|</span><a href="#42354543">next</a><span>|</span><label class="collapse" for="c-42355867">[-]</label><label class="expand" for="c-42355867">[1 more]</label></div><br/><div class="children"><div class="content">We use proxysql (<a href="https:&#x2F;&#x2F;proxysql.com" rel="nofollow">https:&#x2F;&#x2F;proxysql.com</a>) which works very well. We have not seen any downtime for years. We wrote our own master promotion code a very long time ago; it has proven to be very robust.</div><br/></div></div></div></div><div id="42354543" class="c"><input type="checkbox" id="c-42354543" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#42355303">prev</a><span>|</span><a href="#42354677">next</a><span>|</span><label class="collapse" for="c-42354543">[-]</label><label class="expand" for="c-42354543">[2 more]</label></div><br/><div class="children"><div class="content">&gt; If the PostgreSQL backend is cancelled while waiting to acknowledge replication (as a result of packet cancellation due to client timeout or backend failure) transaction changes become visible for other backends. Such changes are not yet replicated and may be lost in case of standby promotion.<p>This sounds like the two generals problem, which has no solution. But I may be misunderstanding.</div><br/><div id="42354869" class="c"><input type="checkbox" id="c-42354869" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#42354543">parent</a><span>|</span><a href="#42354677">next</a><span>|</span><label class="collapse" for="c-42354869">[-]</label><label class="expand" for="c-42354869">[1 more]</label></div><br/><div class="children"><div class="content">&quot;[The two generals problem] said that you can&#x27;t achieve consensus (both safety and liveness at the same time), they did not say you have to sacrifice safety under message-losses or asynchrony conditions. So Paxos preserves safety under all conditions and achieves liveness when conditions improve outside the impossibility realm (less message losses, some timing assumptions start to hold).&quot; <a href="http:&#x2F;&#x2F;muratbuffalo.blogspot.com&#x2F;2010&#x2F;10&#x2F;paxos-taught.html" rel="nofollow">http:&#x2F;&#x2F;muratbuffalo.blogspot.com&#x2F;2010&#x2F;10&#x2F;paxos-taught.html</a></div><br/></div></div></div></div><div id="42354677" class="c"><input type="checkbox" id="c-42354677" checked=""/><div class="controls bullet"><span class="by">karlmdavis</span><span>|</span><a href="#42354543">prev</a><span>|</span><label class="collapse" for="c-42354677">[-]</label><label class="expand" for="c-42354677">[1 more]</label></div><br/><div class="children"><div class="content">What an absolutely delightful little project and write up.</div><br/></div></div></div></div></div></div></div></body></html>