<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1718787673584" as="style"/><link rel="stylesheet" href="styles.css?v=1718787673584"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.tylermw.com/posts/rayverse/displacement-mapping.html">Sculpting the moon in R: Subdivision surfaces and displacement mapping</a>Â <span class="domain">(<a href="https://www.tylermw.com">www.tylermw.com</a>)</span></div><div class="subtext"><span>tylermw</span> | <span>29 comments</span></div><br/><div><div id="40722716" class="c"><input type="checkbox" id="c-40722716" checked=""/><div class="controls bullet"><span class="by">CliffStoll</span><span>|</span><a href="#40726243">next</a><span>|</span><label class="collapse" for="c-40722716">[-]</label><label class="expand" for="c-40722716">[2 more]</label></div><br/><div class="children"><div class="content">In the 1970&#x27;s, I had the honor of working with Bill Hartmann, Bob Strom, Gerard Kuiper, Clark Chapman and Ewen Whittaker, at Tucson&#x27;s Lunar &amp; Planetary Labs.  They used large earthbased telescopes to photograph the moon&#x27;s surface at many illumination angles and libation angles.  The images were captured on glass plates.<p>They physically projected these images onto a large plaster sphere; in turn, they rephotographed the images from different angles, to remove foreshortening and show the lunar surface as seen from directly above a crater.<p>One result of this is the Rectified Lunar Atlas -- one of the guiding maps of the Apollo missions: 
  <a href="https:&#x2F;&#x2F;sic.lpl.arizona.edu&#x2F;collection&#x2F;rectified-lunar-atlas" rel="nofollow">https:&#x2F;&#x2F;sic.lpl.arizona.edu&#x2F;collection&#x2F;rectified-lunar-atlas</a></div><br/><div id="40723051" class="c"><input type="checkbox" id="c-40723051" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40722716">parent</a><span>|</span><a href="#40726243">next</a><span>|</span><label class="collapse" for="c-40723051">[-]</label><label class="expand" for="c-40723051">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m always really impressed with the clever techniques and methods to accurately map topographic surfaces (in this case, lunar) before computerization. Really interesting!<p>(and your comment reminded me to finally place my order for a Klein bottle!)</div><br/></div></div></div></div><div id="40726243" class="c"><input type="checkbox" id="c-40726243" checked=""/><div class="controls bullet"><span class="by">condwanaland</span><span>|</span><a href="#40722716">prev</a><span>|</span><a href="#40718651">next</a><span>|</span><label class="collapse" for="c-40726243">[-]</label><label class="expand" for="c-40726243">[1 more]</label></div><br/><div class="children"><div class="content">Tyler, your work in R is always incredible! I love reading about what you&#x27;ve been creating - a lot goes over my head but it&#x27;s always a blast to read</div><br/></div></div><div id="40718651" class="c"><input type="checkbox" id="c-40718651" checked=""/><div class="controls bullet"><span class="by">malshe</span><span>|</span><a href="#40726243">prev</a><span>|</span><a href="#40718860">next</a><span>|</span><label class="collapse" for="c-40718651">[-]</label><label class="expand" for="c-40718651">[2 more]</label></div><br/><div class="children"><div class="content">Looking forward to reading this post but just wanted to say that the work Tyler has done on ray tracing in R is phenomenal. I highly recommend checking out this package website: <a href="https:&#x2F;&#x2F;www.rayshader.com" rel="nofollow">https:&#x2F;&#x2F;www.rayshader.com</a></div><br/><div id="40719326" class="c"><input type="checkbox" id="c-40719326" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40718651">parent</a><span>|</span><a href="#40718860">next</a><span>|</span><label class="collapse" for="c-40719326">[-]</label><label class="expand" for="c-40719326">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the kind words! You can also see the documentation&#x2F;examples for {rayrender}, the pathtracer I wrote for R, here:<p><a href="https:&#x2F;&#x2F;www.rayrender.net" rel="nofollow">https:&#x2F;&#x2F;www.rayrender.net</a><p>And the rasterizer&#x2F;mesh manipulation package {rayvertex} here:<p><a href="https:&#x2F;&#x2F;www.rayvertex.com" rel="nofollow">https:&#x2F;&#x2F;www.rayvertex.com</a></div><br/></div></div></div></div><div id="40718860" class="c"><input type="checkbox" id="c-40718860" checked=""/><div class="controls bullet"><span class="by">pneumic</span><span>|</span><a href="#40718651">prev</a><span>|</span><a href="#40719102">next</a><span>|</span><label class="collapse" for="c-40718860">[-]</label><label class="expand" for="c-40718860">[12 more]</label></div><br/><div class="children"><div class="content">Nice post. R&#x27;s quirks seem to put some people off but I&#x27;ve found that it&#x27;s a relative joy for exploratory analysis and visualization like this, especially within RStudio.<p>Recently I was tasked with grouping a large number of DNA oligonucleotides, and exploring the criteria by which to group them was a lot of fun using various R libraries. In the span of a few days I learned how to use k-means clustering, how to employ an UpSet plot, and how to build a phylogenetic tree.</div><br/><div id="40719609" class="c"><input type="checkbox" id="c-40719609" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40718860">parent</a><span>|</span><a href="#40719102">next</a><span>|</span><label class="collapse" for="c-40719609">[-]</label><label class="expand" for="c-40719609">[11 more]</label></div><br/><div class="children"><div class="content">R is hands-down the best language for data manipulation, analysis, and visualization: it&#x27;s a language truly centered around treating data as a first class citizen. That focus does make some traditional programming workflows more error prone (helpful interactive data analysis features like vector recycling, flexible automatic type conversion, and non-standard evaluation provide lots of footguns), but the last decade of language improvements (stringsAsFactors = FALSE!) and R packaging ecosystem improvements have made the situation much nicer. The flexibility and lispy expressiveness of the language make it really fun to develop in, once you&#x27;ve gotten over the initial quirks.</div><br/><div id="40720155" class="c"><input type="checkbox" id="c-40720155" checked=""/><div class="controls bullet"><span class="by">pneumic</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40719609">parent</a><span>|</span><a href="#40720732">next</a><span>|</span><label class="collapse" for="c-40720155">[-]</label><label class="expand" for="c-40720155">[1 more]</label></div><br/><div class="children"><div class="content">100% agree, especially on the lispy expressiveness. I love that I can build analysis pipelines in a functional style, which has always clicked with me more than other paradigms.<p>Tidyverse is a godsend for at least getting initial data transformations sketched out and for gently introducing new users, but I do believe one should gain an understanding of how to do all of these things in plain R.</div><br/></div></div><div id="40720732" class="c"><input type="checkbox" id="c-40720732" checked=""/><div class="controls bullet"><span class="by">cjk2</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40719609">parent</a><span>|</span><a href="#40720155">prev</a><span>|</span><a href="#40720282">next</a><span>|</span><label class="collapse" for="c-40720732">[-]</label><label class="expand" for="c-40720732">[4 more]</label></div><br/><div class="children"><div class="content">Is there a decent tutorial or book on getting over the hill? I can do some basic stuff in it but it&#x27;s just not catching like other languages do.</div><br/><div id="40726143" class="c"><input type="checkbox" id="c-40726143" checked=""/><div class="controls bullet"><span class="by">Cosi1125</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720732">parent</a><span>|</span><a href="#40721245">next</a><span>|</span><label class="collapse" for="c-40726143">[-]</label><label class="expand" for="c-40726143">[1 more]</label></div><br/><div class="children"><div class="content">[1] will give you a more programming language-focused perspective, as opposed to many other R books.<p>--<p>[1] <a href="https:&#x2F;&#x2F;adv-r.hadley.nz&#x2F;" rel="nofollow">https:&#x2F;&#x2F;adv-r.hadley.nz&#x2F;</a></div><br/></div></div><div id="40721245" class="c"><input type="checkbox" id="c-40721245" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720732">parent</a><span>|</span><a href="#40726143">prev</a><span>|</span><a href="#40721590">next</a><span>|</span><label class="collapse" for="c-40721245">[-]</label><label class="expand" for="c-40721245">[1 more]</label></div><br/><div class="children"><div class="content">My personal favorite resource is &quot;R for Data Science&quot; by Hadley Wickham. It covers lots of nice data manipulation and visualization examples, and provides a good introduction to the tidyverse, which is a particular dialect of R that&#x27;s well-suited for data analysis. It&#x27;s available for free at:<p><a href="https:&#x2F;&#x2F;r4ds.hadley.nz&#x2F;" rel="nofollow">https:&#x2F;&#x2F;r4ds.hadley.nz&#x2F;</a><p>For more specialized analytical methods there are lots of textbooks out there that provide a deep dive into packages for a specific field (e.g. survival analysis, machine learning, time series), but for general data manipulation and visualization it&#x27;s hard to beat R4DS.</div><br/></div></div><div id="40721590" class="c"><input type="checkbox" id="c-40721590" checked=""/><div class="controls bullet"><span class="by">napoleongl</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720732">parent</a><span>|</span><a href="#40721245">prev</a><span>|</span><a href="#40720282">next</a><span>|</span><label class="collapse" for="c-40721590">[-]</label><label class="expand" for="c-40721590">[1 more]</label></div><br/><div class="children"><div class="content">An option to the Hadley book that also covers some nice statistical methods is Statistical Rethinking by McElreath. Not really available for free though but interesting read.</div><br/></div></div></div></div><div id="40720282" class="c"><input type="checkbox" id="c-40720282" checked=""/><div class="controls bullet"><span class="by">steve1977</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40719609">parent</a><span>|</span><a href="#40720732">prev</a><span>|</span><a href="#40719102">next</a><span>|</span><label class="collapse" for="c-40720282">[-]</label><label class="expand" for="c-40720282">[5 more]</label></div><br/><div class="children"><div class="content">Have you used the Wolfram Language and if so, how would you compare the two?</div><br/><div id="40722002" class="c"><input type="checkbox" id="c-40722002" checked=""/><div class="controls bullet"><span class="by">rscho</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720282">parent</a><span>|</span><a href="#40720471">next</a><span>|</span><label class="collapse" for="c-40722002">[-]</label><label class="expand" for="c-40722002">[2 more]</label></div><br/><div class="children"><div class="content">I have. R is far less verbose and maps far better to data analysis. The Wolfram lang is far more expressive and powerful for symbolic computation. So basically, Wolfram for doing math Research, R for applied stats.</div><br/><div id="40725185" class="c"><input type="checkbox" id="c-40725185" checked=""/><div class="controls bullet"><span class="by">steve1977</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40722002">parent</a><span>|</span><a href="#40720471">next</a><span>|</span><label class="collapse" for="c-40725185">[-]</label><label class="expand" for="c-40725185">[1 more]</label></div><br/><div class="children"><div class="content">thx!</div><br/></div></div></div></div><div id="40720471" class="c"><input type="checkbox" id="c-40720471" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720282">parent</a><span>|</span><a href="#40722002">prev</a><span>|</span><a href="#40719102">next</a><span>|</span><label class="collapse" for="c-40720471">[-]</label><label class="expand" for="c-40720471">[2 more]</label></div><br/><div class="children"><div class="content">I have not. I started using R due to its open source codebase and ability to audit and understand exactly what its doing under the hoodâbeing able to see how statistical formulae were implemented in code was invaluable in understanding and interpreting a package&#x27;s analytical output.</div><br/><div id="40725186" class="c"><input type="checkbox" id="c-40725186" checked=""/><div class="controls bullet"><span class="by">steve1977</span><span>|</span><a href="#40718860">root</a><span>|</span><a href="#40720471">parent</a><span>|</span><a href="#40719102">next</a><span>|</span><label class="collapse" for="c-40725186">[-]</label><label class="expand" for="c-40725186">[1 more]</label></div><br/><div class="children"><div class="content">thx!</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40719102" class="c"><input type="checkbox" id="c-40719102" checked=""/><div class="controls bullet"><span class="by">Blahah</span><span>|</span><a href="#40718860">prev</a><span>|</span><a href="#40720018">next</a><span>|</span><label class="collapse" for="c-40719102">[-]</label><label class="expand" for="c-40719102">[1 more]</label></div><br/><div class="children"><div class="content">Absolutely beautiful - both the clear explanation and the idiomatic (tidyverse style) R packages and code walkthrough. The combination of the two allowed me to read through and understand in one go. And I have immediate uses for the packages. Thanks!</div><br/></div></div><div id="40720018" class="c"><input type="checkbox" id="c-40720018" checked=""/><div class="controls bullet"><span class="by">evilturnip</span><span>|</span><a href="#40719102">prev</a><span>|</span><a href="#40720382">next</a><span>|</span><label class="collapse" for="c-40720018">[-]</label><label class="expand" for="c-40720018">[2 more]</label></div><br/><div class="children"><div class="content">In planetary rendering circles, the cubified sphere is a great method and I&#x27;m glad he went over that here.<p>I should say you do get distortion where the cube faces meet at the edges.  May or may not be a problem depending on how your texturing.</div><br/><div id="40720386" class="c"><input type="checkbox" id="c-40720386" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40720018">parent</a><span>|</span><a href="#40720382">next</a><span>|</span><label class="collapse" for="c-40720386">[-]</label><label class="expand" for="c-40720386">[1 more]</label></div><br/><div class="children"><div class="content">I remapped the UV coords based on the spherical projection of the mesh after subdividing, so there should be minimal distortion, especially compared the UV sphere. There is a slightly higher density of vertices where the edges of the cube used to be, but it&#x27;s small compared to the UV sphere&#x27;s extreme convergence at the poles.</div><br/></div></div></div></div><div id="40720382" class="c"><input type="checkbox" id="c-40720382" checked=""/><div class="controls bullet"><span class="by">washedup</span><span>|</span><a href="#40720018">prev</a><span>|</span><a href="#40721608">next</a><span>|</span><label class="collapse" for="c-40720382">[-]</label><label class="expand" for="c-40720382">[1 more]</label></div><br/><div class="children"><div class="content">Amazing work. Simple, easy-to-use code. This must have been quite the effort. It&#x27;s honestly stunning work. Also, good to see R is still alive and well!</div><br/></div></div><div id="40721608" class="c"><input type="checkbox" id="c-40721608" checked=""/><div class="controls bullet"><span class="by">pixelpoet</span><span>|</span><a href="#40720382">prev</a><span>|</span><a href="#40719557">next</a><span>|</span><label class="collapse" for="c-40721608">[-]</label><label class="expand" for="c-40721608">[1 more]</label></div><br/><div class="children"><div class="content">I would just directly ray trace it, no subdivision. Then it becomes something like 100 lines of code total, and is probably still faster than the subdiv approach.<p>BTW I like to call that singularity at the pole god, because I often notice it in env maps as an arsehole in the sky :P</div><br/></div></div><div id="40718383" class="c"><input type="checkbox" id="c-40718383" checked=""/><div class="controls bullet"><span class="by">zippyman55</span><span>|</span><a href="#40719557">prev</a><span>|</span><a href="#40721994">next</a><span>|</span><label class="collapse" for="c-40718383">[-]</label><label class="expand" for="c-40718383">[2 more]</label></div><br/><div class="children"><div class="content">Nice! Love R!</div><br/><div id="40718413" class="c"><input type="checkbox" id="c-40718413" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40718383">parent</a><span>|</span><a href="#40721994">next</a><span>|</span><label class="collapse" for="c-40718413">[-]</label><label class="expand" for="c-40718413">[1 more]</label></div><br/><div class="children"><div class="content">Thanks! Me too (Obviously)!</div><br/></div></div></div></div><div id="40721994" class="c"><input type="checkbox" id="c-40721994" checked=""/><div class="controls bullet"><span class="by">phkahler</span><span>|</span><a href="#40718383">prev</a><span>|</span><a href="#40718900">next</a><span>|</span><label class="collapse" for="c-40721994">[-]</label><label class="expand" for="c-40721994">[2 more]</label></div><br/><div class="children"><div class="content">Opensubdiv should be able to do this too. I wonder how much work it would be to glue that on. Maybe there&#x27;s no benefit at this point? ;-)</div><br/><div id="40722151" class="c"><input type="checkbox" id="c-40722151" checked=""/><div class="controls bullet"><span class="by">tylermw</span><span>|</span><a href="#40721994">parent</a><span>|</span><a href="#40718900">next</a><span>|</span><label class="collapse" for="c-40722151">[-]</label><label class="expand" for="c-40722151">[1 more]</label></div><br/><div class="children"><div class="content">Opensubdiv would definitely be the robust, industry standard solution. However, R packages that are distributed on the CRAN have additional restrictions on required system libraries, so for portability I went with a bespoke implementation.</div><br/></div></div></div></div><div id="40718900" class="c"><input type="checkbox" id="c-40718900" checked=""/><div class="controls bullet"><span class="by">kaeptnkrunch</span><span>|</span><a href="#40721994">prev</a><span>|</span><label class="collapse" for="c-40718900">[-]</label><label class="expand" for="c-40718900">[1 more]</label></div><br/><div class="children"><div class="content">Nice</div><br/></div></div></div></div></div></div></div></body></html>