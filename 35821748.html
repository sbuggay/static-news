<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683277251026" as="style"/><link rel="stylesheet" href="styles.css?v=1683277251026"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/piercefreeman/gpt-json">Show HN: GPT-JSON – Structured and typehinted GPT responses in Python</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>icyfox</span> | <span>29 comments</span></div><br/><div><div id="35825064" class="c"><input type="checkbox" id="c-35825064" checked=""/><div class="controls bullet"><span class="by">crazyedgar</span><span>|</span><a href="#35825300">next</a><span>|</span><label class="collapse" for="c-35825064">[-]</label><label class="expand" for="c-35825064">[6 more]</label></div><br/><div class="children"><div class="content">I like the idea, but I think a library that focuses on producing requests and parsing responses according to schema is better. Sending requests to the server is orthogonal to the purpose.<p>What we&#x27;ve found useful in practice in dealing with similar problems:<p>- Use json5 instead of json when parsing. It allows trailing commas.<p>- Don&#x27;t let it respond in true&#x2F;false. Instead, ask it for a short sentence explaining whether it is true or false. Afterwards, use a small embedding model such as sbert to extract true&#x2F;false from the sentence. We&#x27;ve found that GPT is able to reason better in this case, and it is much more robust.<p>- For numerical scores, do a similar thing by asking GPT for a description, then with the small embedding model write a few examples matching your score scale, and for each response use the score of the best matched example. If you let GPT give you scores directly without explanation, 20% of the time it will give you nonsense.</div><br/><div id="35826593" class="c"><input type="checkbox" id="c-35826593" checked=""/><div class="controls bullet"><span class="by">IanCal</span><span>|</span><a href="#35825064">parent</a><span>|</span><a href="#35825127">next</a><span>|</span><label class="collapse" for="c-35826593">[-]</label><label class="expand" for="c-35826593">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Don&#x27;t let it respond in true&#x2F;false. Instead, ask it for a short sentence explaining whether it is true or false. Afterwards, use a small embedding model such as sbert to extract true&#x2F;false from the sentence. We&#x27;ve found that GPT is able to reason better in this case, and it is much more robust.<p>Have you tried just getting it to do both? It reasons far better given some space to think, so I often have it explain things first then give the answer. You&#x27;re effectively then using gpt for the extraction too.<p>This hugely improved the class hierarchies it was creating for me, significantly improving the reuse of classes and using better classes for fields too.</div><br/></div></div><div id="35825127" class="c"><input type="checkbox" id="c-35825127" checked=""/><div class="controls bullet"><span class="by">icyfox</span><span>|</span><a href="#35825064">parent</a><span>|</span><a href="#35826593">prev</a><span>|</span><a href="#35825364">next</a><span>|</span><label class="collapse" for="c-35825127">[-]</label><label class="expand" for="c-35825127">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the thoughts! I&#x27;ve deployed a few meta models that act like you&#x27;re describing for second stage predictions, but for fuzzy task definitions have actually seen similar luck with having GPT explicitly explain its rational and then force it to choose a true&#x2F;false rating. My payloads often end up looking like:<p><pre><code>  class Payload:
    reasoning: str = Field(description=&quot;Why this value might be true or false),
    answer: bool
</code></pre>
Since it&#x27;s autoregressive I imagine the schema helps to define the universe of what it&#x27;s supposed to do, then the decoder attention when it&#x27;s filling the `answer` can look back on the reasoning and weigh the sentiment internally. I imagine the accuracy specifics depend a lot on the end deployment here.</div><br/></div></div><div id="35825364" class="c"><input type="checkbox" id="c-35825364" checked=""/><div class="controls bullet"><span class="by">iamflimflam1</span><span>|</span><a href="#35825064">parent</a><span>|</span><a href="#35825127">prev</a><span>|</span><a href="#35825587">next</a><span>|</span><label class="collapse" for="c-35825364">[-]</label><label class="expand" for="c-35825364">[1 more]</label></div><br/><div class="children"><div class="content">There’s some really good info along thff we same lines in this course <a href="https:&#x2F;&#x2F;learn.deeplearning.ai&#x2F;chatgpt-prompt-eng" rel="nofollow">https:&#x2F;&#x2F;learn.deeplearning.ai&#x2F;chatgpt-prompt-eng</a></div><br/></div></div><div id="35825587" class="c"><input type="checkbox" id="c-35825587" checked=""/><div class="controls bullet"><span class="by">syntaxing</span><span>|</span><a href="#35825064">parent</a><span>|</span><a href="#35825364">prev</a><span>|</span><a href="#35825300">next</a><span>|</span><label class="collapse" for="c-35825587">[-]</label><label class="expand" for="c-35825587">[2 more]</label></div><br/><div class="children"><div class="content">Is it possible to give an example what a small embedded model would look like? Curious how to make something like this!</div><br/><div id="35825790" class="c"><input type="checkbox" id="c-35825790" checked=""/><div class="controls bullet"><span class="by">crazyedgar</span><span>|</span><a href="#35825064">root</a><span>|</span><a href="#35825587">parent</a><span>|</span><a href="#35825300">next</a><span>|</span><label class="collapse" for="c-35825790">[-]</label><label class="expand" for="c-35825790">[1 more]</label></div><br/><div class="children"><div class="content">We just use <a href="https:&#x2F;&#x2F;www.sbert.net&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.sbert.net&#x2F;</a>. Compare the embedding of the answer with the embeddings of YES versus NO.</div><br/></div></div></div></div></div></div><div id="35825300" class="c"><input type="checkbox" id="c-35825300" checked=""/><div class="controls bullet"><span class="by">wskish</span><span>|</span><a href="#35825064">prev</a><span>|</span><a href="#35826756">next</a><span>|</span><label class="collapse" for="c-35825300">[-]</label><label class="expand" for="c-35825300">[3 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s 40 lines of python code that I&#x27;ve found to be unreasonably effective at accomplishing something similar:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;jiggy-ai&#x2F;pydantic-chatcompletion&#x2F;blob&#x2F;master&#x2F;pydantic_chatcompletion&#x2F;__init__.py">https:&#x2F;&#x2F;github.com&#x2F;jiggy-ai&#x2F;pydantic-chatcompletion&#x2F;blob&#x2F;mas...</a></div><br/><div id="35826566" class="c"><input type="checkbox" id="c-35826566" checked=""/><div class="controls bullet"><span class="by">SeanA208</span><span>|</span><a href="#35825300">parent</a><span>|</span><a href="#35826254">next</a><span>|</span><label class="collapse" for="c-35826566">[-]</label><label class="expand" for="c-35826566">[1 more]</label></div><br/><div class="children"><div class="content">Very cool. Out of curiosity, for the retries why are the errors appended as system messages as opposed to appending to the user message? And in either case, would it help to prepend the error with something like “Be sure to avoid outputting something that would cause this error:”?</div><br/></div></div><div id="35826254" class="c"><input type="checkbox" id="c-35826254" checked=""/><div class="controls bullet"><span class="by">johntash</span><span>|</span><a href="#35825300">parent</a><span>|</span><a href="#35826566">prev</a><span>|</span><a href="#35826756">next</a><span>|</span><label class="collapse" for="c-35826254">[-]</label><label class="expand" for="c-35826254">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!  I have something similar that I&#x27;ve been using and struggling to keep consistent.  I like that this is a relatively small package, I&#x27;ll probably end up using it to play around with.</div><br/></div></div></div></div><div id="35826756" class="c"><input type="checkbox" id="c-35826756" checked=""/><div class="controls bullet"><span class="by">senko</span><span>|</span><a href="#35825300">prev</a><span>|</span><a href="#35826192">next</a><span>|</span><label class="collapse" for="c-35826756">[-]</label><label class="expand" for="c-35826756">[1 more]</label></div><br/><div class="children"><div class="content">I wait for the day someone fine-tunes an open model to always respond in JSON. I suspect it won&#x27;t be long now.</div><br/></div></div><div id="35826192" class="c"><input type="checkbox" id="c-35826192" checked=""/><div class="controls bullet"><span class="by">teleforce</span><span>|</span><a href="#35826756">prev</a><span>|</span><a href="#35825909">next</a><span>|</span><label class="collapse" for="c-35826192">[-]</label><label class="expand" for="c-35826192">[1 more]</label></div><br/><div class="children"><div class="content">I asked ChatGPT (GPT-4) about the idea of integrating GPT-JSON with CUE language (<a href="https:&#x2F;&#x2F;cuelang.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;cuelang.org&#x2F;</a>) for potential improvements and the answers are quite impressive:<p>&quot;Yes, integrating the CUE language with GPT-JSON can potentially lead to improvements in its capability. CUE, short for Configuration, Unification, and Environment, is an open-source data constraint language designed to simplify the definition, generation, and validation of data in structured formats, like JSON, YAML, and others.<p>Integrating CUE with GPT-JSON can bring several benefits:<p>1) Validation: By using CUE, you can define schemas for the input and output JSON, which helps in validating the data structure and ensuring it adheres to the expected format. This can help reduce errors and improve the quality of the interaction with the GPT model.<p>2) Simplification: CUE can help simplify the process of defining and generating JSON inputs and outputs for GPT-JSON. By providing a more concise and expressive syntax, CUE can make it easier to craft structured inputs and outputs, which can be especially helpful when working with complex data structures.<p>3) Interoperability: Integrating CUE can improve the interoperability between GPT-JSON and other systems or applications. With CUE&#x27;s ability to work with multiple data formats (such as JSON, YAML, or HCL), it becomes easier to integrate GPT-JSON with various tools and platforms.<p>To integrate CUE with GPT-JSON, you would need to follow these general steps:<p>1) Define CUE schemas for the input and output JSON structures used by GPT-JSON.<p>2) Use the CUE language to validate and generate input JSON for GPT-JSON.<p>3) Process the output JSON generated by GPT-JSON using CUE to ensure it adheres to the defined schema and transform it as needed.<p>Integrating CUE with GPT-JSON can improve the overall robustness and ease of use of the library, making it more accessible and useful for a wider range of applications.&quot;</div><br/></div></div><div id="35825909" class="c"><input type="checkbox" id="c-35825909" checked=""/><div class="controls bullet"><span class="by">lharries</span><span>|</span><a href="#35826192">prev</a><span>|</span><a href="#35826162">next</a><span>|</span><label class="collapse" for="c-35825909">[-]</label><label class="expand" for="c-35825909">[1 more]</label></div><br/><div class="children"><div class="content">Langchain also has a built in Pydantic output parser <a href="https:&#x2F;&#x2F;python.langchain.com&#x2F;en&#x2F;latest&#x2F;modules&#x2F;prompts&#x2F;output_parsers&#x2F;examples&#x2F;pydantic.html" rel="nofollow">https:&#x2F;&#x2F;python.langchain.com&#x2F;en&#x2F;latest&#x2F;modules&#x2F;prompts&#x2F;outpu...</a><p>However I&#x27;ve found it to be generally unreliable and adds a lot of text to each call.<p>I suspect this can be improved by:
- Only writing the parts of the spec which are needed, rather than the full JSON schema spec
- Including relevant examples rather than arbitrary JSON schema examples</div><br/></div></div><div id="35826162" class="c"><input type="checkbox" id="c-35826162" checked=""/><div class="controls bullet"><span class="by">jumploops</span><span>|</span><a href="#35825909">prev</a><span>|</span><a href="#35826524">next</a><span>|</span><label class="collapse" for="c-35826162">[-]</label><label class="expand" for="c-35826162">[1 more]</label></div><br/><div class="children"><div class="content">I built a toy[0] for Typescript that works similarly to this.<p>It takes the expected return type of a function, translates it into a JSON Schema, queries OpenAI, validates the response, and then magically returns the response as typed output.<p>[0]<a href="https:&#x2F;&#x2F;github.com&#x2F;jumploops&#x2F;magic">https:&#x2F;&#x2F;github.com&#x2F;jumploops&#x2F;magic</a></div><br/></div></div><div id="35826524" class="c"><input type="checkbox" id="c-35826524" checked=""/><div class="controls bullet"><span class="by">AmazingTurtle</span><span>|</span><a href="#35826162">prev</a><span>|</span><a href="#35826241">next</a><span>|</span><label class="collapse" for="c-35826524">[-]</label><label class="expand" for="c-35826524">[1 more]</label></div><br/><div class="children"><div class="content">What about few shot learning, e.g. injecting 1 or 2 examples of JSON in the prompt? That should be fine as well</div><br/></div></div><div id="35826241" class="c"><input type="checkbox" id="c-35826241" checked=""/><div class="controls bullet"><span class="by">BiteCode_dev</span><span>|</span><a href="#35826524">prev</a><span>|</span><a href="#35825482">next</a><span>|</span><label class="collapse" for="c-35826241">[-]</label><label class="expand" for="c-35826241">[1 more]</label></div><br/><div class="children"><div class="content">You can use simpler types. Instead of :<p><pre><code>        messages=[
            GPTMessage(
                role=GPTMessageRole.SYSTEM,
                content=SYSTEM_PROMPT,
            ),
            GPTMessage(
                role=GPTMessageRole.USER,
                content=&quot;Text: I love this product. It&#x27;s the best thing ever!&quot;,
            )
        ]
</code></pre>
Try:<p><pre><code>        messages=(
            (&quot;system&quot;, SYSTEM_PROMPT),
            (&quot;user&quot;, &quot;Text: I love this product. It&#x27;s the best thing ever!&quot;)
        )
</code></pre>
Or:<p><pre><code>        messages=(
            SystemMsg(SYSTEM_PROMPT),
            UserMsg(&quot;Text: I love this product. It&#x27;s the best thing ever!&quot;)
        )
</code></pre>
This is still Python, not Java.</div><br/></div></div><div id="35825482" class="c"><input type="checkbox" id="c-35825482" checked=""/><div class="controls bullet"><span class="by">armcat</span><span>|</span><a href="#35826241">prev</a><span>|</span><a href="#35826130">next</a><span>|</span><label class="collapse" for="c-35825482">[-]</label><label class="expand" for="c-35825482">[1 more]</label></div><br/><div class="children"><div class="content">Have you considered Guardrails, <a href="https:&#x2F;&#x2F;shreyar.github.io&#x2F;guardrails&#x2F;" rel="nofollow">https:&#x2F;&#x2F;shreyar.github.io&#x2F;guardrails&#x2F;</a>, it’s like Pydantic but for LLMs?</div><br/></div></div><div id="35826130" class="c"><input type="checkbox" id="c-35826130" checked=""/><div class="controls bullet"><span class="by">olup</span><span>|</span><a href="#35825482">prev</a><span>|</span><a href="#35825530">next</a><span>|</span><label class="collapse" for="c-35826130">[-]</label><label class="expand" for="c-35826130">[1 more]</label></div><br/><div class="children"><div class="content">I built zod-chatgpt <a href="https:&#x2F;&#x2F;github.com&#x2F;olup&#x2F;zod-chatgpt">https:&#x2F;&#x2F;github.com&#x2F;olup&#x2F;zod-chatgpt</a> a couple of weeks ago to serve same purpose in typescript</div><br/></div></div><div id="35825530" class="c"><input type="checkbox" id="c-35825530" checked=""/><div class="controls bullet"><span class="by">CupofChineseTea</span><span>|</span><a href="#35826130">prev</a><span>|</span><a href="#35825077">next</a><span>|</span><label class="collapse" for="c-35825530">[-]</label><label class="expand" for="c-35825530">[1 more]</label></div><br/><div class="children"><div class="content">I happen to have a very similar idea recently and created this GPT-logic package for node. It basically transforms GPT generated results into JS data types. Check it out if you are interested. <a href="https:&#x2F;&#x2F;github.com&#x2F;wayneshn&#x2F;gpt-logic">https:&#x2F;&#x2F;github.com&#x2F;wayneshn&#x2F;gpt-logic</a></div><br/></div></div><div id="35825077" class="c"><input type="checkbox" id="c-35825077" checked=""/><div class="controls bullet"><span class="by">m3kw9</span><span>|</span><a href="#35825530">prev</a><span>|</span><a href="#35825690">next</a><span>|</span><label class="collapse" for="c-35825077">[-]</label><label class="expand" for="c-35825077">[3 more]</label></div><br/><div class="children"><div class="content">Wasn’t there a yesterday proj that asks gpt to output non json but then it turns it into json after? Thus making it less prone to json errors</div><br/><div id="35825122" class="c"><input type="checkbox" id="c-35825122" checked=""/><div class="controls bullet"><span class="by">m3kw9</span><span>|</span><a href="#35825077">parent</a><span>|</span><a href="#35825413">next</a><span>|</span><label class="collapse" for="c-35825122">[-]</label><label class="expand" for="c-35825122">[1 more]</label></div><br/><div class="children"><div class="content">Ah, this one: <a href="https:&#x2F;&#x2F;github.com&#x2F;1rgs&#x2F;jsonformer">https:&#x2F;&#x2F;github.com&#x2F;1rgs&#x2F;jsonformer</a></div><br/></div></div><div id="35825413" class="c"><input type="checkbox" id="c-35825413" checked=""/><div class="controls bullet"><span class="by">yawnxyz</span><span>|</span><a href="#35825077">parent</a><span>|</span><a href="#35825122">prev</a><span>|</span><a href="#35825690">next</a><span>|</span><label class="collapse" for="c-35825413">[-]</label><label class="expand" for="c-35825413">[1 more]</label></div><br/><div class="children"><div class="content">That one is robust but requires pytorch and huggingface and all kinds of things. I think most of us want something that&#x27;s reasonable few lines of code and can run in places like serverless and replit.</div><br/></div></div></div></div><div id="35825690" class="c"><input type="checkbox" id="c-35825690" checked=""/><div class="controls bullet"><span class="by">KingOfCoders</span><span>|</span><a href="#35825077">prev</a><span>|</span><a href="#35825685">next</a><span>|</span><label class="collapse" for="c-35825690">[-]</label><label class="expand" for="c-35825690">[5 more]</label></div><br/><div class="children"><div class="content">Idiot question, I&#x27;d like to register and pay for the ChatGPT API but can&#x27;t find the link to get an API token :-)</div><br/><div id="35825726" class="c"><input type="checkbox" id="c-35825726" checked=""/><div class="controls bullet"><span class="by">toteno</span><span>|</span><a href="#35825690">parent</a><span>|</span><a href="#35825724">next</a><span>|</span><label class="collapse" for="c-35825726">[-]</label><label class="expand" for="c-35825726">[2 more]</label></div><br/><div class="children"><div class="content">You can get API keys from the page <a href="https:&#x2F;&#x2F;platform.openai.com&#x2F;account&#x2F;api-keys" rel="nofollow">https:&#x2F;&#x2F;platform.openai.com&#x2F;account&#x2F;api-keys</a> (which you can find open by clicking on your avatar and selecting &quot;View API keys&quot;).</div><br/><div id="35825732" class="c"><input type="checkbox" id="c-35825732" checked=""/><div class="controls bullet"><span class="by">KingOfCoders</span><span>|</span><a href="#35825690">root</a><span>|</span><a href="#35825726">parent</a><span>|</span><a href="#35825724">next</a><span>|</span><label class="collapse" for="c-35825732">[-]</label><label class="expand" for="c-35825732">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!</div><br/></div></div></div></div><div id="35825724" class="c"><input type="checkbox" id="c-35825724" checked=""/><div class="controls bullet"><span class="by">vmarkham</span><span>|</span><a href="#35825690">parent</a><span>|</span><a href="#35825726">prev</a><span>|</span><a href="#35825685">next</a><span>|</span><label class="collapse" for="c-35825724">[-]</label><label class="expand" for="c-35825724">[2 more]</label></div><br/><div class="children"><div class="content">If you already have an account with them: <a href="https:&#x2F;&#x2F;platform.openai.com&#x2F;account&#x2F;api-keys" rel="nofollow">https:&#x2F;&#x2F;platform.openai.com&#x2F;account&#x2F;api-keys</a>.</div><br/><div id="35825734" class="c"><input type="checkbox" id="c-35825734" checked=""/><div class="controls bullet"><span class="by">KingOfCoders</span><span>|</span><a href="#35825690">root</a><span>|</span><a href="#35825724">parent</a><span>|</span><a href="#35825685">next</a><span>|</span><label class="collapse" for="c-35825734">[-]</label><label class="expand" for="c-35825734">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!</div><br/></div></div></div></div></div></div><div id="35825685" class="c"><input type="checkbox" id="c-35825685" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#35825690">prev</a><span>|</span><a href="#35822017">next</a><span>|</span><label class="collapse" for="c-35825685">[-]</label><label class="expand" for="c-35825685">[1 more]</label></div><br/><div class="children"><div class="content">Typed ChatGPT.<p>Someone had to come along and spoil the fun.<p>Next it&#x27;ll be ChatGPT&#x2F;XML.</div><br/></div></div></div></div></div></div></div></body></html>