<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704186060864" as="style"/><link rel="stylesheet" href="styles.css?v=1704186060864"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://axleos.com/writing-a-truetype-font-renderer/">Writing a TrueType font renderer</a> <span class="domain">(<a href="https://axleos.com">axleos.com</a>)</span></div><div class="subtext"><span>codyd51</span> | <span>61 comments</span></div><br/><div><div id="38837041" class="c"><input type="checkbox" id="c-38837041" checked=""/><div class="controls bullet"><span class="by">sokoloff</span><span>|</span><a href="#38839154">next</a><span>|</span><label class="collapse" for="c-38837041">[-]</label><label class="expand" for="c-38837041">[1 more]</label></div><br/><div class="children"><div class="content">The first startup I worked at was a TrueType font specialist. We had one of the best auto-hinters and decent manual tooling for improving the auto-hinting.<p>Ultimately, we ran out of traction and money as the CDs full of 100 fonts for $10 came out, but we did some of the original System 7 and Win 3.1 fonts.<p>It is a cool format and stack-based language and was an enjoyable and educational time in my career.</div><br/></div></div><div id="38839154" class="c"><input type="checkbox" id="c-38839154" checked=""/><div class="controls bullet"><span class="by">tomduncalf</span><span>|</span><a href="#38837041">prev</a><span>|</span><a href="#38834873">next</a><span>|</span><label class="collapse" for="c-38839154">[-]</label><label class="expand" for="c-38839154">[2 more]</label></div><br/><div class="children"><div class="content">Fascinating! I created a tool to parse information out of an OTF for uploading new fonts to a font foundry website so already had some idea of how complex they are (even with the help of “fonttools”, which is a great way to explore to the various tables), but I had no idea about some of this - for example, the VM for hinting!</div><br/><div id="38839201" class="c"><input type="checkbox" id="c-38839201" checked=""/><div class="controls bullet"><span class="by">slimsag</span><span>|</span><a href="#38839154">parent</a><span>|</span><a href="#38834873">next</a><span>|</span><label class="collapse" for="c-38839201">[-]</label><label class="expand" for="c-38839201">[1 more]</label></div><br/><div class="children"><div class="content">Modern text shaping can even require executing a WASM binary in the font file[0]<p>[0] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36652569">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36652569</a></div><br/></div></div></div></div><div id="38834873" class="c"><input type="checkbox" id="c-38834873" checked=""/><div class="controls bullet"><span class="by">signaru</span><span>|</span><a href="#38839154">prev</a><span>|</span><a href="#38835659">next</a><span>|</span><label class="collapse" for="c-38834873">[-]</label><label class="expand" for="c-38834873">[1 more]</label></div><br/><div class="children"><div class="content">Great to see more accessible references on font internals! I have dabbled on this a bit last year and managed to have a parser and render the points in a glyph&#x27;s contour (I stopped before Bezier and shape filling stuff). I still have not considered hinting, so it&#x27;s nice that it&#x27;s covered. Besides Apple&#x27;s and Microsoft&#x27;s extensive documentations, what really helped me is an article from the Handmade Network [1] and the source of stb_truetype [2] (also used in Dear ImGUI).<p>[1] <a href="https:&#x2F;&#x2F;handmade.network&#x2F;forums&#x2F;articles&#x2F;t&#x2F;7330-implementing_a_font_reader_and_rasterizer_from_scratch%252C_part_1__ttf_font_reader" rel="nofollow">https:&#x2F;&#x2F;handmade.network&#x2F;forums&#x2F;articles&#x2F;t&#x2F;7330-implementing...</a>.<p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;nothings&#x2F;stb&#x2F;blob&#x2F;master&#x2F;stb_truetype.h">https:&#x2F;&#x2F;github.com&#x2F;nothings&#x2F;stb&#x2F;blob&#x2F;master&#x2F;stb_truetype.h</a></div><br/></div></div><div id="38835659" class="c"><input type="checkbox" id="c-38835659" checked=""/><div class="controls bullet"><span class="by">ianlevesque</span><span>|</span><a href="#38834873">prev</a><span>|</span><a href="#38835428">next</a><span>|</span><label class="collapse" for="c-38835659">[-]</label><label class="expand" for="c-38835659">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Inexplicably, though, the TTF stores all fields in big endian<p>Both the 68k and PPC (as configured for macs) were big endian.</div><br/><div id="38837488" class="c"><input type="checkbox" id="c-38837488" checked=""/><div class="controls bullet"><span class="by">jpgvm</span><span>|</span><a href="#38835659">parent</a><span>|</span><a href="#38839415">next</a><span>|</span><label class="collapse" for="c-38837488">[-]</label><label class="expand" for="c-38837488">[1 more]</label></div><br/><div class="children"><div class="content">Along with MIPS. The significance of which is that it led to a lot of network gear using one of these 3 architectures. Now most network data planes are in ASIC and increasingly these BE ISAs are being supplanted by ARM but for a long time it held out as a bastion for PPC in particular.</div><br/></div></div><div id="38839415" class="c"><input type="checkbox" id="c-38839415" checked=""/><div class="controls bullet"><span class="by">codyd51</span><span>|</span><a href="#38835659">parent</a><span>|</span><a href="#38837488">prev</a><span>|</span><a href="#38835428">next</a><span>|</span><label class="collapse" for="c-38839415">[-]</label><label class="expand" for="c-38839415">[1 more]</label></div><br/><div class="children"><div class="content">Of course, this makes sense - thank you!</div><br/></div></div></div></div><div id="38835428" class="c"><input type="checkbox" id="c-38835428" checked=""/><div class="controls bullet"><span class="by">vardump</span><span>|</span><a href="#38835659">prev</a><span>|</span><a href="#38836508">next</a><span>|</span><label class="collapse" for="c-38835428">[-]</label><label class="expand" for="c-38835428">[2 more]</label></div><br/><div class="children"><div class="content">Wrote a truetype rasterizer about 20 years ago. I took the easy way out and just simply antialised everything, didn&#x27;t even try to support TrueType hinting programs.<p>Sure, things looked blurry, but it didn&#x27;t matter much when everything would be rotated into weird angles and sizes anyways.<p>Bezier and implementing correct and FAST filling rules took a lot of effort.</div><br/><div id="38836370" class="c"><input type="checkbox" id="c-38836370" checked=""/><div class="controls bullet"><span class="by">djmips</span><span>|</span><a href="#38835428">parent</a><span>|</span><a href="#38836508">next</a><span>|</span><label class="collapse" for="c-38836370">[-]</label><label class="expand" for="c-38836370">[1 more]</label></div><br/><div class="children"><div class="content">What was your application? Games?</div><br/></div></div></div></div><div id="38836508" class="c"><input type="checkbox" id="c-38836508" checked=""/><div class="controls bullet"><span class="by">darknavi</span><span>|</span><a href="#38835428">prev</a><span>|</span><a href="#38835494">next</a><span>|</span><label class="collapse" for="c-38836508">[-]</label><label class="expand" for="c-38836508">[7 more]</label></div><br/><div class="children"><div class="content">Working in games, font code is truely the depths of hell that you try to punt to someone else as often as you can.<p>Maybe one day we will support right to left text!</div><br/><div id="38837395" class="c"><input type="checkbox" id="c-38837395" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#38836508">parent</a><span>|</span><a href="#38836633">next</a><span>|</span><label class="collapse" for="c-38837395">[-]</label><label class="expand" for="c-38837395">[1 more]</label></div><br/><div class="children"><div class="content">relevant: <a href="https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;text-hates-you&#x2F;" rel="nofollow">https:&#x2F;&#x2F;faultlore.com&#x2F;blah&#x2F;text-hates-you&#x2F;</a> (&quot;Text Rendering Hates You&quot;; discussed quite a bit but under its old URL <a href="https:&#x2F;&#x2F;hn.algolia.com&#x2F;?query=text%20rendering%20hates%20you&amp;sort=byPopularity&amp;type=story" rel="nofollow">https:&#x2F;&#x2F;hn.algolia.com&#x2F;?query=text%20rendering%20hates%20you...</a> )<p>It&#x27;s not quite one of the &quot;misconceptions programmers have about ...&quot; but in the same vein, IMHO</div><br/></div></div><div id="38836633" class="c"><input type="checkbox" id="c-38836633" checked=""/><div class="controls bullet"><span class="by">rijoja</span><span>|</span><a href="#38836508">parent</a><span>|</span><a href="#38837395">prev</a><span>|</span><a href="#38837890">next</a><span>|</span><label class="collapse" for="c-38836633">[-]</label><label class="expand" for="c-38836633">[3 more]</label></div><br/><div class="children"><div class="content">The other day I saw a comment saying that fonts are made complicated by turning them into programs, which you can legally protect as IP, is there any truth to that?</div><br/><div id="38837755" class="c"><input type="checkbox" id="c-38837755" checked=""/><div class="controls bullet"><span class="by">xyzzy_plugh</span><span>|</span><a href="#38836508">root</a><span>|</span><a href="#38836633">parent</a><span>|</span><a href="#38837708">next</a><span>|</span><label class="collapse" for="c-38837755">[-]</label><label class="expand" for="c-38837755">[1 more]</label></div><br/><div class="children"><div class="content">Roughly true. Rasterized fonts are typically not copyrightable. The font files, or as you suggest, programs, are.<p>If you see a font you think is cool, you can pretty much rip off the style without any real consequences. This is often why font licenses for print media are priced very differently than digital media where the font is redistributed.</div><br/></div></div><div id="38837708" class="c"><input type="checkbox" id="c-38837708" checked=""/><div class="controls bullet"><span class="by">drzaiusx11</span><span>|</span><a href="#38836508">root</a><span>|</span><a href="#38836633">parent</a><span>|</span><a href="#38837755">prev</a><span>|</span><a href="#38837890">next</a><span>|</span><label class="collapse" for="c-38837708">[-]</label><label class="expand" for="c-38837708">[1 more]</label></div><br/><div class="children"><div class="content">PostScript fonts exist and PostScript is a Turing-complete language. Source code is copyrightable, so this tracks</div><br/></div></div></div></div><div id="38837890" class="c"><input type="checkbox" id="c-38837890" checked=""/><div class="controls bullet"><span class="by">dclowd9901</span><span>|</span><a href="#38836508">parent</a><span>|</span><a href="#38836633">prev</a><span>|</span><a href="#38835494">next</a><span>|</span><label class="collapse" for="c-38837890">[-]</label><label class="expand" for="c-38837890">[2 more]</label></div><br/><div class="children"><div class="content">Maybe you know this one: for UI in games, do devs create an entire windowing environment from scratch? It seems like that would be the best way to do it but man what a lot of work.</div><br/><div id="38838302" class="c"><input type="checkbox" id="c-38838302" checked=""/><div class="controls bullet"><span class="by">cardiffspaceman</span><span>|</span><a href="#38836508">root</a><span>|</span><a href="#38837890">parent</a><span>|</span><a href="#38835494">next</a><span>|</span><label class="collapse" for="c-38838302">[-]</label><label class="expand" for="c-38838302">[1 more]</label></div><br/><div class="children"><div class="content">I was part of a team that delivered four SKUs, DOS and Windows versions of two games. We made a fairly complete version of a GUI environment so that the DOS games would look like the Windows versions. We didn’t rasterize the TrueType fonts. We only used one size in Windows, so we used a bitmap font for DOS and it was enough.</div><br/></div></div></div></div></div></div><div id="38835494" class="c"><input type="checkbox" id="c-38835494" checked=""/><div class="controls bullet"><span class="by">cbrpnk</span><span>|</span><a href="#38836508">prev</a><span>|</span><a href="#38835692">next</a><span>|</span><label class="collapse" for="c-38835494">[-]</label><label class="expand" for="c-38835494">[1 more]</label></div><br/><div class="children"><div class="content">&quot;There’s few things in this world I love more than taking an opaque binary and gradually uncovering the organization that was present all along. Dissecting the underlying and general structure of a binary is as gratifying as anything I can imagine.&quot;<p>Yes!</div><br/></div></div><div id="38835692" class="c"><input type="checkbox" id="c-38835692" checked=""/><div class="controls bullet"><span class="by">vitiral</span><span>|</span><a href="#38835494">prev</a><span>|</span><a href="#38834880">next</a><span>|</span><label class="collapse" for="c-38835692">[-]</label><label class="expand" for="c-38835692">[12 more]</label></div><br/><div class="children"><div class="content">I wonder, is there something on the complexity curve between 8x8 bitmap and fullblown ttf with all the complexity as you&#x27;ve outlined?<p>It would be nice if there were a solution which gets 90% of the value in 10% of the code.</div><br/><div id="38836377" class="c"><input type="checkbox" id="c-38836377" checked=""/><div class="controls bullet"><span class="by">djmips</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38837279">next</a><span>|</span><label class="collapse" for="c-38836377">[-]</label><label class="expand" for="c-38836377">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s a link to a Valve paper from 2007 Siggraph but certainly there&#x27;s been a lot of dev since then but this is kind of cool still!<p><a href="https:&#x2F;&#x2F;github.com&#x2F;Michaelangel007&#x2F;game_dev_pdfs&#x2F;blob&#x2F;master&#x2F;graphics&#x2F;signed_distance_field&#x2F;SIGGRAPH2007_AlphaTestedMagnification.pdf">https:&#x2F;&#x2F;github.com&#x2F;Michaelangel007&#x2F;game_dev_pdfs&#x2F;blob&#x2F;master...</a></div><br/></div></div><div id="38837279" class="c"><input type="checkbox" id="c-38837279" checked=""/><div class="controls bullet"><span class="by">mhd</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38836377">prev</a><span>|</span><a href="#38835718">next</a><span>|</span><label class="collapse" for="c-38837279">[-]</label><label class="expand" for="c-38837279">[2 more]</label></div><br/><div class="children"><div class="content">Hershey fonts[0] look a bit odd on high-res pixel screens, but one might be able to cope with that by carefully selecting sizes and fudging with the definitions. Definitely low-code.<p>And once upon a time, X11 had another weird little format besides PS and TTF fonts, namely &quot;Speedo&quot; fonts[1]. Also used in plenty of other software, as PS&#x2F;TTF weren&#x27;t that common and it was made by Bitstream, one of the major font foundry (because no font format helps if there are no legal fonts available for it).<p>Alas, both not really in use these days.<p>[0]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Hershey_fonts" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Hershey_fonts</a><p>[1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Bitstream_Speedo_Fonts" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Bitstream_Speedo_Fonts</a></div><br/><div id="38839288" class="c"><input type="checkbox" id="c-38839288" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#38835692">root</a><span>|</span><a href="#38837279">parent</a><span>|</span><a href="#38835718">next</a><span>|</span><label class="collapse" for="c-38839288">[-]</label><label class="expand" for="c-38839288">[1 more]</label></div><br/><div class="children"><div class="content">Note that Hershey&#x27;s (physical!) pens were about 3 times as large as his coordinate system; rendering them with a suitable thickness gives me reasonable results even at higher resolutions.<p>(like with the pixel grill on CRTs, often older digital formats were subject to some sort of analogue low-pass filtering before being perceived)</div><br/></div></div></div></div><div id="38835718" class="c"><input type="checkbox" id="c-38835718" checked=""/><div class="controls bullet"><span class="by">stravant</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38837279">prev</a><span>|</span><a href="#38838338">next</a><span>|</span><label class="collapse" for="c-38835718">[-]</label><label class="expand" for="c-38835718">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re looking for SDF fonts.<p>Very simple at their core but you can incrementally do more work to increase the fidelity you get out of them.</div><br/></div></div><div id="38838338" class="c"><input type="checkbox" id="c-38838338" checked=""/><div class="controls bullet"><span class="by">pcwalton</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38835718">prev</a><span>|</span><a href="#38838298">next</a><span>|</span><label class="collapse" for="c-38838338">[-]</label><label class="expand" for="c-38838338">[1 more]</label></div><br/><div class="children"><div class="content">Just use a TrueType subset with no hinting. stb_truetype implements one in 5k lines of code and that includes CFF format outlines. You could omit those and get it even smaller.</div><br/></div></div><div id="38838298" class="c"><input type="checkbox" id="c-38838298" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38838338">prev</a><span>|</span><a href="#38836150">next</a><span>|</span><label class="collapse" for="c-38838298">[-]</label><label class="expand" for="c-38838298">[1 more]</label></div><br/><div class="children"><div class="content">I once worked on an almost-bitmap font with its own description language [1] that can be extended to work on subpixel grids. I went as far as combining marks (not in the public repository though).<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;lifthrasiir&#x2F;unison">https:&#x2F;&#x2F;github.com&#x2F;lifthrasiir&#x2F;unison</a></div><br/></div></div><div id="38836150" class="c"><input type="checkbox" id="c-38836150" checked=""/><div class="controls bullet"><span class="by">grishka</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38838298">prev</a><span>|</span><a href="#38835874">next</a><span>|</span><label class="collapse" for="c-38836150">[-]</label><label class="expand" for="c-38836150">[1 more]</label></div><br/><div class="children"><div class="content">Proportional bitmap fonts in several fixed sizes. One place where they were used a lot that comes to mind is those phones from the 00s, but also many other embedded devices that have a screen with text-based menus.</div><br/></div></div><div id="38835874" class="c"><input type="checkbox" id="c-38835874" checked=""/><div class="controls bullet"><span class="by">colonwqbang</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38836150">prev</a><span>|</span><a href="#38837026">next</a><span>|</span><label class="collapse" for="c-38835874">[-]</label><label class="expand" for="c-38835874">[2 more]</label></div><br/><div class="children"><div class="content">Using a better, higher-resolution bitmap font? They don&#x27;t have to look as awful as that<p><a href="https:&#x2F;&#x2F;terminus-font.sourceforge.net&#x2F;img1&#x2F;12x24b.gif" rel="nofollow">https:&#x2F;&#x2F;terminus-font.sourceforge.net&#x2F;img1&#x2F;12x24b.gif</a></div><br/><div id="38836425" class="c"><input type="checkbox" id="c-38836425" checked=""/><div class="controls bullet"><span class="by">vitiral</span><span>|</span><a href="#38835692">root</a><span>|</span><a href="#38835874">parent</a><span>|</span><a href="#38837026">next</a><span>|</span><label class="collapse" for="c-38836425">[-]</label><label class="expand" for="c-38836425">[1 more]</label></div><br/><div class="children"><div class="content">That does look a lot better!</div><br/></div></div></div></div><div id="38837026" class="c"><input type="checkbox" id="c-38837026" checked=""/><div class="controls bullet"><span class="by">kragen</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38835874">prev</a><span>|</span><a href="#38836639">next</a><span>|</span><label class="collapse" for="c-38837026">[-]</label><label class="expand" for="c-38837026">[1 more]</label></div><br/><div class="children"><div class="content">tex&#x27;s metafont format might be simpler or more complex than truetype, depending on your utility function. sdf fonts are clearly in the range you want, as several commenters have said, and likewise for proportional and scalable bitmap (and grayscale, or color) fonts. also worth mentioning are stroke fonts, especially hershey fonts, and polygonal outline fonts without beziers<p>finally, an approach that&#x27;s conceptually simpler that i&#x27;ve never seen used (though metafont comes close) is to represent the font as a subroutine in a turing-complete bytecode that takes a glyph index as input and produces an image with font metrics data as output. something like the universal machine from the cult of the bound variable is only about a page of code. this requires you to put the bezier rasterization and polygon filling code in your font file instead, so it doesn&#x27;t simplify the total system</div><br/></div></div><div id="38836639" class="c"><input type="checkbox" id="c-38836639" checked=""/><div class="controls bullet"><span class="by">rzzzt</span><span>|</span><a href="#38835692">parent</a><span>|</span><a href="#38837026">prev</a><span>|</span><a href="#38834880">next</a><span>|</span><label class="collapse" for="c-38836639">[-]</label><label class="expand" for="c-38836639">[1 more]</label></div><br/><div class="children"><div class="content">I nominate the BGI vector fonts that you could use in Turbo Pascal programs.</div><br/></div></div></div></div><div id="38834880" class="c"><input type="checkbox" id="c-38834880" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#38835692">prev</a><span>|</span><a href="#38835960">next</a><span>|</span><label class="collapse" for="c-38834880">[-]</label><label class="expand" for="c-38834880">[3 more]</label></div><br/><div class="children"><div class="content">For a problem that is theoretically binary (either in, or out?) filling polys can have really fiddly corner (literally!) cases.<p>Thanks for the WIP screenshots; they made me feel much better about my own slicers&#x2F;rasterisers.<p>(there&#x27;s probably a trick I&#x27;m missing*, but so far I&#x27;ve had the most robust results for 3D booleans by chasing fiddly overlaps&#x2F;intersections on lower facets, all the way down to 0-D if necessary)<p>* like working directly with cubics, à la Jim Blinn?</div><br/><div id="38835764" class="c"><input type="checkbox" id="c-38835764" checked=""/><div class="controls bullet"><span class="by">nsajko</span><span>|</span><a href="#38834880">parent</a><span>|</span><a href="#38834889">next</a><span>|</span><label class="collapse" for="c-38835764">[-]</label><label class="expand" for="c-38835764">[1 more]</label></div><br/><div class="children"><div class="content">&gt; For a problem that is theoretically binary (either in, or out?) filling polys can have really fiddly corner (literally!) cases.<p>FTR, in case someone is interested: &quot;predicate&quot; is the name for functions that output booleans, so a more general search term is &quot;geometric predicate&quot;.</div><br/></div></div><div id="38834889" class="c"><input type="checkbox" id="c-38834889" checked=""/><div class="controls bullet"><span class="by">kevingadd</span><span>|</span><a href="#38834880">parent</a><span>|</span><a href="#38835764">prev</a><span>|</span><a href="#38835960">next</a><span>|</span><label class="collapse" for="c-38834889">[-]</label><label class="expand" for="c-38834889">[1 more]</label></div><br/><div class="children"><div class="content">Filling polys is especially hard if you want to run on the GPU where access to denormals is inconsistent&#x2F;nonexistent. Most of the algorithms in CS literature simply won&#x27;t work. It&#x27;s a fun challenge, at least!</div><br/></div></div></div></div><div id="38835960" class="c"><input type="checkbox" id="c-38835960" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#38834880">prev</a><span>|</span><a href="#38836018">next</a><span>|</span><label class="collapse" for="c-38835960">[-]</label><label class="expand" for="c-38835960">[10 more]</label></div><br/><div class="children"><div class="content">I think TTF isn&#x27;t that difficult if you just want the basics; I wrote a TTF viewer that simply dumped the outlines into GDI and let the latter do the rasterisation, without any hinting or other fancy stuff. Less than 400 LoC in total including the UI code, and the binary was 7KB.</div><br/><div id="38836250" class="c"><input type="checkbox" id="c-38836250" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835960">parent</a><span>|</span><a href="#38836245">next</a><span>|</span><label class="collapse" for="c-38836250">[-]</label><label class="expand" for="c-38836250">[6 more]</label></div><br/><div class="children"><div class="content">400 LoC is impressive - my Ruby translation of libschrift is about 680 lines now, and of that 345 lines is parsing the damn TTF files. I might have to revisit it ;)</div><br/><div id="38836490" class="c"><input type="checkbox" id="c-38836490" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38836250">parent</a><span>|</span><a href="#38836245">next</a><span>|</span><label class="collapse" for="c-38836490">[-]</label><label class="expand" for="c-38836490">[5 more]</label></div><br/><div class="children"><div class="content">It&#x27;s ~240 LoC of C to take a glyph from the file and paint it using GDI, including lots of debugging prints. Of course, error checking is minimal, but I think getting to the outline data itself isn&#x27;t that difficult, since all you need to get to is a list of points and contours and whether they&#x27;re on-curve or not.</div><br/><div id="38836505" class="c"><input type="checkbox" id="c-38836505" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38836490">parent</a><span>|</span><a href="#38836245">next</a><span>|</span><label class="collapse" for="c-38836505">[-]</label><label class="expand" for="c-38836505">[4 more]</label></div><br/><div class="children"><div class="content">Is it open source? Would love to see. Doesn&#x27;t matter if it&#x27;s lacking error checks - still impressively small, and doubly so for C.</div><br/><div id="38839114" class="c"><input type="checkbox" id="c-38839114" checked=""/><div class="controls bullet"><span class="by">a_e_k</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38836505">parent</a><span>|</span><a href="#38837128">next</a><span>|</span><label class="collapse" for="c-38839114">[-]</label><label class="expand" for="c-38839114">[2 more]</label></div><br/><div class="children"><div class="content">I have a small TTF implementation in C++ that&#x27;s only a little bigger than that and is open source.  It&#x27;s part of my canvas_ity single-header library [0] that&#x27;s around 2300 LOC &#x2F; 36 KB object size and implements a C++ version of most of the 2D HTML5 canvas spec [1].<p>The core implementation of the TTF parsing and drawing is in L1526-L1846 with another small bit at L3205-L3274 of src&#x2F;canvas_ity.hpp.<p>It&#x27;s something of a toy implementation that only supports western left-to-right text, and doesn&#x27;t do any hinting at all, nor kerning, nor shaping.  But it&#x27;s enough to draw a basic &quot;Hello world!&quot; using any typical TTF file.<p>The test suite in test&#x2F;test.cpp L84-304 embeds a few custom Base64-encoded TTF files.  They&#x27;re small and only have a few glyphs but they do exercise a number of interesting edge cases in the OpenType TTF spec [2].  Have a look at the HTML5 port of the test suite at test&#x2F;test.html in different browsers to see how their canvas implementations render those fonts.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;a-e-k&#x2F;canvas_ity">https:&#x2F;&#x2F;github.com&#x2F;a-e-k&#x2F;canvas_ity</a><p>[1] <a href="https:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;2015&#x2F;REC-2dcontext-20151119&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;2015&#x2F;REC-2dcontext-20151119&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;standards.iso.org&#x2F;ittf&#x2F;PubliclyAvailableStandards&#x2F;c074461_ISO_IEC_14496-22_2019.zip" rel="nofollow">https:&#x2F;&#x2F;standards.iso.org&#x2F;ittf&#x2F;PubliclyAvailableStandards&#x2F;c0...</a></div><br/><div id="38839168" class="c"><input type="checkbox" id="c-38839168" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38839114">parent</a><span>|</span><a href="#38837128">next</a><span>|</span><label class="collapse" for="c-38839168">[-]</label><label class="expand" for="c-38839168">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s great. Thanks. For my use the lack of kerning doesn&#x27;t matter much as I mostly use it for my terminal, and so monospaced, and I haven&#x27;t added hinting either.</div><br/></div></div></div></div><div id="38837128" class="c"><input type="checkbox" id="c-38837128" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38836505">parent</a><span>|</span><a href="#38839114">prev</a><span>|</span><a href="#38836245">next</a><span>|</span><label class="collapse" for="c-38837128">[-]</label><label class="expand" for="c-38837128">[1 more]</label></div><br/><div class="children"><div class="content">Sorry, no. I used part of the code in a commercial product.</div><br/></div></div></div></div></div></div></div></div><div id="38836245" class="c"><input type="checkbox" id="c-38836245" checked=""/><div class="controls bullet"><span class="by">Sharlin</span><span>|</span><a href="#38835960">parent</a><span>|</span><a href="#38836250">prev</a><span>|</span><a href="#38835981">next</a><span>|</span><label class="collapse" for="c-38836245">[-]</label><label class="expand" for="c-38836245">[2 more]</label></div><br/><div class="children"><div class="content">Well, yes, but GDI isn&#x27;t exactly available when you&#x27;re writing <i>your own OS</i> like the author of the article.</div><br/><div id="38836265" class="c"><input type="checkbox" id="c-38836265" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835960">root</a><span>|</span><a href="#38836245">parent</a><span>|</span><a href="#38835981">next</a><span>|</span><label class="collapse" for="c-38836265">[-]</label><label class="expand" for="c-38836265">[1 more]</label></div><br/><div class="children"><div class="content">The rasterisation doesn&#x27;t take much anyway. My libschrift Ruby translation does the rendering in around 100 or so lines. The original libschrift is in C and only takes about twice as much. Parsing the TTF files takes more code.</div><br/></div></div></div></div><div id="38835981" class="c"><input type="checkbox" id="c-38835981" checked=""/><div class="controls bullet"><span class="by">txdv</span><span>|</span><a href="#38835960">parent</a><span>|</span><a href="#38836245">prev</a><span>|</span><a href="#38836018">next</a><span>|</span><label class="collapse" for="c-38835981">[-]</label><label class="expand" for="c-38835981">[1 more]</label></div><br/><div class="children"><div class="content">link please</div><br/></div></div></div></div><div id="38836018" class="c"><input type="checkbox" id="c-38836018" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#38835960">prev</a><span>|</span><a href="#38837079">next</a><span>|</span><label class="collapse" for="c-38836018">[-]</label><label class="expand" for="c-38836018">[5 more]</label></div><br/><div class="children"><div class="content">Great article, I’ve had the fun of implementing TTF rendering and this piece hits all the memorable points.<p>One nit, the comparison to Mach-O is anachronistic as TrueType was developed in the late 1980s, while Apple didn’t acquire NeXT until 1996.</div><br/><div id="38838070" class="c"><input type="checkbox" id="c-38838070" checked=""/><div class="controls bullet"><span class="by">mannyv</span><span>|</span><a href="#38836018">parent</a><span>|</span><a href="#38836392">next</a><span>|</span><label class="collapse" for="c-38838070">[-]</label><label class="expand" for="c-38838070">[1 more]</label></div><br/><div class="children"><div class="content">TT is just a tagged file format, just like WAV, TIFF, MOV, MP4, etc.<p>It&#x27;s probably closer to quicktime, which are the basis of mp4.</div><br/></div></div><div id="38836392" class="c"><input type="checkbox" id="c-38836392" checked=""/><div class="controls bullet"><span class="by">Allybag</span><span>|</span><a href="#38836018">parent</a><span>|</span><a href="#38838070">prev</a><span>|</span><a href="#38837079">next</a><span>|</span><label class="collapse" for="c-38836392">[-]</label><label class="expand" for="c-38836392">[3 more]</label></div><br/><div class="children"><div class="content">That’s not really a fair nit at all, he just commented that the two formats were similar, one of them must necessarily have come before the other, but they both exist right now.</div><br/><div id="38836696" class="c"><input type="checkbox" id="c-38836696" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#38836018">root</a><span>|</span><a href="#38836392">parent</a><span>|</span><a href="#38837079">next</a><span>|</span><label class="collapse" for="c-38836696">[-]</label><label class="expand" for="c-38836696">[2 more]</label></div><br/><div class="children"><div class="content">I don’t agree with that, the quote is:<p>&gt; Both file formats were developed at Apple around the same time</div><br/><div id="38838758" class="c"><input type="checkbox" id="c-38838758" checked=""/><div class="controls bullet"><span class="by">Allybag</span><span>|</span><a href="#38836018">root</a><span>|</span><a href="#38836696">parent</a><span>|</span><a href="#38837079">next</a><span>|</span><label class="collapse" for="c-38838758">[-]</label><label class="expand" for="c-38838758">[1 more]</label></div><br/><div class="children"><div class="content">Ah, indeed, sorry about that. I’d missed that part and just remembered him saying they were similar.</div><br/></div></div></div></div></div></div></div></div><div id="38837079" class="c"><input type="checkbox" id="c-38837079" checked=""/><div class="controls bullet"><span class="by">neontomo</span><span>|</span><a href="#38836018">prev</a><span>|</span><a href="#38835996">next</a><span>|</span><label class="collapse" for="c-38837079">[-]</label><label class="expand" for="c-38837079">[3 more]</label></div><br/><div class="children"><div class="content">Can someone explain how connecting the dots works? How does it know which dot is connected to which? For example, in the curve of an S, the closest dot to the top curve might be under it, instead of beside it.</div><br/><div id="38838582" class="c"><input type="checkbox" id="c-38838582" checked=""/><div class="controls bullet"><span class="by">doubloon</span><span>|</span><a href="#38837079">parent</a><span>|</span><a href="#38838400">next</a><span>|</span><label class="collapse" for="c-38838582">[-]</label><label class="expand" for="c-38838582">[1 more]</label></div><br/><div class="children"><div class="content">The points are a sequence of integer coordinates. The points in the outside contour of the letter are stored in clockwise order, the inner holes in counter clockwise order. There is some kind of marker to indicate where each countiur starts. The points are either on curve or off curve. On curve are touching the visible line, off curve point is a control point of a three-point quadratic Bezier curve. If there are two offcurve points listed one after the other then you create an implied oncurve point halfway between them.</div><br/></div></div><div id="38838400" class="c"><input type="checkbox" id="c-38838400" checked=""/><div class="controls bullet"><span class="by">TheCoreh</span><span>|</span><a href="#38837079">parent</a><span>|</span><a href="#38838582">prev</a><span>|</span><a href="#38835996">next</a><span>|</span><label class="collapse" for="c-38838400">[-]</label><label class="expand" for="c-38838400">[1 more]</label></div><br/><div class="children"><div class="content">The dots are stored in the right order in the font. The curves that connect them are also precisely specified</div><br/></div></div></div></div><div id="38835996" class="c"><input type="checkbox" id="c-38835996" checked=""/><div class="controls bullet"><span class="by">hgs3</span><span>|</span><a href="#38837079">prev</a><span>|</span><a href="#38837427">next</a><span>|</span><label class="collapse" for="c-38835996">[-]</label><label class="expand" for="c-38835996">[7 more]</label></div><br/><div class="children"><div class="content">Correct me if I&#x27;m wrong, but I think font hinting isn&#x27;t needed for high DPI displays? I believe macOS Mojave removed subpixel anti-aliasing because Apple doesn&#x27;t ship anything but high DPI displays anymore.</div><br/><div id="38836146" class="c"><input type="checkbox" id="c-38836146" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#38835996">parent</a><span>|</span><a href="#38836226">next</a><span>|</span><label class="collapse" for="c-38836146">[-]</label><label class="expand" for="c-38836146">[1 more]</label></div><br/><div class="children"><div class="content">Font hinting is still used, as the native resolution of most TTFs is 2048 upem so even at 72pt you’d need a 2048 dpi display to perfectly render a glyph.<p>You’re right that sub-pixel (color) antialiasing has been removed from macOS but regular grayscale antialiasing, and hinting, remain.</div><br/></div></div><div id="38836226" class="c"><input type="checkbox" id="c-38836226" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835996">parent</a><span>|</span><a href="#38836146">prev</a><span>|</span><a href="#38836100">next</a><span>|</span><label class="collapse" for="c-38836226">[-]</label><label class="expand" for="c-38836226">[4 more]</label></div><br/><div class="children"><div class="content">&quot;Needed&quot; is subjective. Libschrift[1] is an example of a TTF renderer that doesn&#x27;t do any. I translated Libscrift to Ruby[2], and I considered whether to add support for it, and decided it wasn&#x27;t worth it for my use (it&#x27;s now the font-renderer for my terminal, and by extension my editor) despite only using it on 1920x1080 on a 27&quot; monitor.<p>My reasoning for not bothering was much what you suggest - if it&#x27;s acceptable to me now on a resolution that low, I&#x27;m not sure I see the point in supporting even worse conditions given how cheap 4K displays are. The need for hinting is only going to go down.<p>Maybe one day, but I&#x27;ll note e.g. FreeType also did a lot of work on auto-hinting because as it turns out the hinting in a lot of TTF files is pure garbage.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;tomolt&#x2F;libschrift">https:&#x2F;&#x2F;github.com&#x2F;tomolt&#x2F;libschrift</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;vidarh&#x2F;skrift">https:&#x2F;&#x2F;github.com&#x2F;vidarh&#x2F;skrift</a> - X11 integration in <a href="https:&#x2F;&#x2F;github.com&#x2F;vidarh&#x2F;skrift-x11">https:&#x2F;&#x2F;github.com&#x2F;vidarh&#x2F;skrift-x11</a></div><br/><div id="38836358" class="c"><input type="checkbox" id="c-38836358" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#38835996">root</a><span>|</span><a href="#38836226">parent</a><span>|</span><a href="#38836100">next</a><span>|</span><label class="collapse" for="c-38836358">[-]</label><label class="expand" for="c-38836358">[3 more]</label></div><br/><div class="children"><div class="content">FreeType did auto-hinting because Microsoft held patents on some of the hinting engine instructions. These finally expired in 2010.</div><br/><div id="38836408" class="c"><input type="checkbox" id="c-38836408" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#38835996">root</a><span>|</span><a href="#38836358">parent</a><span>|</span><a href="#38836100">next</a><span>|</span><label class="collapse" for="c-38836408">[-]</label><label class="expand" for="c-38836408">[2 more]</label></div><br/><div class="children"><div class="content">That might well be the original motivation, but note e.g. ttfautohint development 2011 or so onwards [1] intended to strip hinting programs and replace them with the output of the autohinter because so many fonts have awful hints.<p>[1] Not sure exactly when the ttfautohint work started, but both Microsoft and Google donated money to it in 2011.</div><br/><div id="38836539" class="c"><input type="checkbox" id="c-38836539" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#38835996">root</a><span>|</span><a href="#38836408">parent</a><span>|</span><a href="#38836100">next</a><span>|</span><label class="collapse" for="c-38836539">[-]</label><label class="expand" for="c-38836539">[1 more]</label></div><br/><div class="children"><div class="content">It’s true that autohinting is nowadays the norm but I’d be more generous to those old fonts as they were aggressively hinted for black-and-white rendering. It’s not until ClearType was enabled by default in Windows Vista c. 2007 that those old hints became undesirable.</div><br/></div></div></div></div></div></div></div></div><div id="38836100" class="c"><input type="checkbox" id="c-38836100" checked=""/><div class="controls bullet"><span class="by">grishka</span><span>|</span><a href="#38835996">parent</a><span>|</span><a href="#38836226">prev</a><span>|</span><a href="#38837427">next</a><span>|</span><label class="collapse" for="c-38836100">[-]</label><label class="expand" for="c-38836100">[1 more]</label></div><br/><div class="children"><div class="content">&gt; because Apple doesn&#x27;t ship anything but high DPI displays anymore<p>People still connect their Apple computers to low-DPI monitors all the time. High-DPI monitors are still a rarity. There&#x27;s the LG UltraFine, the Studio Display (too expensive for what it is), the Pro Display XDR (the $1000 stand lmao), and that&#x27;s really it.<p>I&#x27;m writing this comment on a 2K monitor connected to a modern MacBook.</div><br/></div></div></div></div><div id="38837427" class="c"><input type="checkbox" id="c-38837427" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#38835996">prev</a><span>|</span><a href="#38834913">next</a><span>|</span><label class="collapse" for="c-38837427">[-]</label><label class="expand" for="c-38837427">[1 more]</label></div><br/><div class="children"><div class="content">I couldn&#x27;t readily tell if this was related to the recent 37C3 iPhone submission, but in case someone missed the irony: <a href="https:&#x2F;&#x2F;securelist.com&#x2F;operation-triangulation-the-last-hardware-mystery&#x2F;111669&#x2F;" rel="nofollow">https:&#x2F;&#x2F;securelist.com&#x2F;operation-triangulation-the-last-hard...</a> was RCE-ed via a truetype file and it&#x27;s always been just the gift that keeps on giving <a href="https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=truetype" rel="nofollow">https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=truetype</a></div><br/></div></div><div id="38834913" class="c"><input type="checkbox" id="c-38834913" checked=""/><div class="controls bullet"><span class="by">kevingadd</span><span>|</span><a href="#38837427">prev</a><span>|</span><a href="#38833748">next</a><span>|</span><label class="collapse" for="c-38834913">[-]</label><label class="expand" for="c-38834913">[1 more]</label></div><br/><div class="children"><div class="content">I really appreciate that you provided a bunch of screenshots of the in-progress development. Graphics programming is very challenging, and it can be frustrating to feel like you&#x27;ve spent multiple days just rendering glitch art. It&#x27;s always good to show others how much we struggle even if we&#x27;re experts :)<p>Having recently implemented a subset of opentype kerning, I can only imagine how stressful it was to implement the whole core truetype spec...</div><br/></div></div></div></div></div></div></div></body></html>