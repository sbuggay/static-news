<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701162059392" as="style"/><link rel="stylesheet" href="styles.css?v=1701162059392"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://notes.billmill.org/link_blog/2023/11/antirez__tiny_JSON_selector_library.html">Antirez&#x27; tiny JSON selector library</a> <span class="domain">(<a href="https://notes.billmill.org">notes.billmill.org</a>)</span></div><div class="subtext"><span>surprisetalk</span> | <span>18 comments</span></div><br/><div><div id="38442440" class="c"><input type="checkbox" id="c-38442440" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#38442731">next</a><span>|</span><label class="collapse" for="c-38442440">[-]</label><label class="expand" for="c-38442440">[1 more]</label></div><br/><div class="children"><div class="content">Recent and related: <i>Botlib: C Telegram bot framework</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38408873">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38408873</a> - Nov 2023 (85 comments)<p>Btw please let&#x27;s not argue about this program being written in C—it&#x27;s not the spirit of the OP and it&#x27;s mostly a boring digression.</div><br/></div></div><div id="38442731" class="c"><input type="checkbox" id="c-38442731" checked=""/><div class="controls bullet"><span class="by">wood_spirit</span><span>|</span><a href="#38442440">prev</a><span>|</span><a href="#38443126">next</a><span>|</span><label class="collapse" for="c-38442731">[-]</label><label class="expand" for="c-38442731">[1 more]</label></div><br/><div class="children"><div class="content">Good to hear about new Antirez code again after his wander in the wilderness writing the sci fi book.</div><br/></div></div><div id="38443126" class="c"><input type="checkbox" id="c-38443126" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#38442731">prev</a><span>|</span><a href="#38442585">next</a><span>|</span><label class="collapse" for="c-38443126">[-]</label><label class="expand" for="c-38443126">[2 more]</label></div><br/><div class="children"><div class="content">jq has a very simple `jv_getpath()` that is a smaller &quot;language&quot; still (the &quot;language&quot; being an array of string and integer indices).  I believe Jansson and others also have similar get-path functionality.  They don&#x27;t have the asterisk feature that this has (which is not like .[] in jq), and which looks admittedly quite useful (in terms of ease of use but also in terms of heap allocation avoidance).  OTOH this doesn&#x27;t allow access to non-ident-like object fields except via the asterisk feature.  Neat!</div><br/><div id="38443512" class="c"><input type="checkbox" id="c-38443512" checked=""/><div class="controls bullet"><span class="by">sshine</span><span>|</span><a href="#38443126">parent</a><span>|</span><a href="#38442585">next</a><span>|</span><label class="collapse" for="c-38443512">[-]</label><label class="expand" for="c-38443512">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>They don&#x27;t have the asterisk feature that this has</i><p>In jq I believe you can get the asterisk behaviour with ‘map(...)’, but using significantly more characters.</div><br/></div></div></div></div><div id="38442585" class="c"><input type="checkbox" id="c-38442585" checked=""/><div class="controls bullet"><span class="by">ElectricalUnion</span><span>|</span><a href="#38443126">prev</a><span>|</span><a href="#38442414">next</a><span>|</span><label class="collapse" for="c-38442585">[-]</label><label class="expand" for="c-38442585">[5 more]</label></div><br/><div class="children"><div class="content">json1 [1] is basically part of SQLite3 those days and I don&#x27;t see the -DSQLITE_OMIT_JSON flag on this code.<p>I find the choice of building and bundling yet-another-thing that specifically is already &quot;there&quot; (not sure if by mistake or intentionally) on a minimalist system very strange.<p>I also trust things in the SQLite3 codebase way more that my own code.<p>[1] <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;json1.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.sqlite.org&#x2F;json1.html</a></div><br/><div id="38442827" class="c"><input type="checkbox" id="c-38442827" checked=""/><div class="controls bullet"><span class="by">vsnf</span><span>|</span><a href="#38442585">parent</a><span>|</span><a href="#38442792">next</a><span>|</span><label class="collapse" for="c-38442827">[-]</label><label class="expand" for="c-38442827">[3 more]</label></div><br/><div class="children"><div class="content">My knowledge of SQLite features kind of got frozen in time when I stopped doing python work as frequently as I used to a few years ago. I recall lamenting that I couldn&#x27;t use their fancy new features because I was more or less constrained to whatever version Python bundled for its default. Can I now trust modern python installations to have native-json enabled sqlite built in?</div><br/><div id="38442939" class="c"><input type="checkbox" id="c-38442939" checked=""/><div class="controls bullet"><span class="by">dragonwriter</span><span>|</span><a href="#38442585">root</a><span>|</span><a href="#38442827">parent</a><span>|</span><a href="#38443006">next</a><span>|</span><label class="collapse" for="c-38442939">[-]</label><label class="expand" for="c-38442939">[1 more]</label></div><br/><div class="children"><div class="content">&gt; My knowledge of SQLite features kind of got frozen in time when I stopped doing python work as frequently as I used to a few years ago. I recall lamenting that I couldn&#x27;t use their fancy new features because I was more or less constrained to whatever version Python bundled for its default.<p>Python uses an SQLite3 shared library, all you need to do to upgrade the SQLite3 engine is replace the shared library (.DLL on windows, .so.0 or something like that on Linux). You&#x27;ve never been locked into a version of the SQLite engine (well, if SQLite4 came out, you&#x27;d probably have to wait for Python to support that instead of only SQLite3, but...)<p>&gt; Can I now trust modern python installations to have native-json enabled sqlite built in?<p>JSON has been compiled in by default since 3.38, my Python 3.10 installation (3.12 is current python) has 3.40 bundled, so, depending on what you mean by &quot;modern&quot; that seems reasonably safe (but, again, you aren&#x27;t limited by what is bundled.)<p>OTOH, the JSON5 support is only from 3.42 onward, so even reasonably modern Python might not have that built in.</div><br/></div></div><div id="38443006" class="c"><input type="checkbox" id="c-38443006" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38442585">root</a><span>|</span><a href="#38442827">parent</a><span>|</span><a href="#38442939">prev</a><span>|</span><a href="#38442792">next</a><span>|</span><label class="collapse" for="c-38443006">[-]</label><label class="expand" for="c-38443006">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Can I now trust modern python installations to have native-json enabled sqlite built in?<p>There is no absolute guarantee because distros can use any supported SQLite version to build Python (though Debian [1] and thus Ubuntu has long enabled -DSQLITE_ENABLE_JSON1), but you can expect that any Python version released shortly after 2022-03-16 [2] supports JSON functions in the Windows and macOS builds.<p>[1] <a href="https:&#x2F;&#x2F;sources.debian.org&#x2F;src&#x2F;sqlite3&#x2F;3.16.2-5%2Bdeb9u1&#x2F;debian&#x2F;rules&#x2F;#L41" rel="nofollow noreferrer">https:&#x2F;&#x2F;sources.debian.org&#x2F;src&#x2F;sqlite3&#x2F;3.16.2-5%2Bdeb9u1&#x2F;deb...</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;cpython&#x2F;pull&#x2F;31655">https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;cpython&#x2F;pull&#x2F;31655</a></div><br/></div></div></div></div><div id="38442792" class="c"><input type="checkbox" id="c-38442792" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#38442585">parent</a><span>|</span><a href="#38442827">prev</a><span>|</span><a href="#38442414">next</a><span>|</span><label class="collapse" for="c-38442792">[-]</label><label class="expand" for="c-38442792">[1 more]</label></div><br/><div class="children"><div class="content">A fun new feature is that Python 3.12 now includes a command line switch to call SQLite directly: `python -m sqlite3`<p><a href="https:&#x2F;&#x2F;docs.python.org&#x2F;dev&#x2F;library&#x2F;sqlite3.html#sqlite3-cli" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;dev&#x2F;library&#x2F;sqlite3.html#sqlite3-cli</a></div><br/></div></div></div></div><div id="38442414" class="c"><input type="checkbox" id="c-38442414" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38442585">prev</a><span>|</span><a href="#38442766">next</a><span>|</span><label class="collapse" for="c-38442414">[-]</label><label class="expand" for="c-38442414">[1 more]</label></div><br/><div class="children"><div class="content">It can be rather argued that antirez has chosen his language to fit into a small code. Indeed, such mini-languages are not uncommon in C: not only printf and scanf, but for example Python&#x27;s PyArg_ParseTuple and friends [1]. It is also common that they are underdocumented, have unexpected pitfalls (for example, this selector library won&#x27;t tell you that you have a typo in the typecheck string), have strange contortions to keep up with C&#x27;s lack of features (for example, this library reserves * in the keys because C makes string concatenation difficult, so you are forbidden to use that character in verbatim), and tend to be difficult to change because everything is a bare string.<p>[1] <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;c-api&#x2F;arg.html#c.PyArg_ParseTuple" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;c-api&#x2F;arg.html#c.PyArg_ParseTuple</a><p>----<p>ADDED (just in case that the comment sounds like a mindless C bashing): I wanted to highlight the point that this particular design is not general, but stems from the language choice in many ways. Those weaknesses largely overlap with those of DSLs in general, so another way to phrase this is that C kinda fosters a creation of DSLs, which is an interesting observation! By comparison the language choice itself is out of concern for me---I wrote a number of sizable softwares in C after all.</div><br/></div></div><div id="38442766" class="c"><input type="checkbox" id="c-38442766" checked=""/><div class="controls bullet"><span class="by">supportengineer</span><span>|</span><a href="#38442414">prev</a><span>|</span><a href="#38442436">next</a><span>|</span><label class="collapse" for="c-38442766">[-]</label><label class="expand" for="c-38442766">[6 more]</label></div><br/><div class="children"><div class="content">He uses GOTO quite liberally!</div><br/><div id="38443778" class="c"><input type="checkbox" id="c-38443778" checked=""/><div class="controls bullet"><span class="by">Mikhail_Edoshin</span><span>|</span><a href="#38442766">parent</a><span>|</span><a href="#38442881">next</a><span>|</span><label class="collapse" for="c-38443778">[-]</label><label class="expand" for="c-38443778">[1 more]</label></div><br/><div class="children"><div class="content">&#x27;goto&#x27; is more universal and may make cleaner code even in loops. E.g. to loop backwards without &#x27;goto&#x27; one has to resort to an idiom like that:<p><pre><code>    for (i = n; i--; )
</code></pre>
and I wouldn&#x27;t say this idiom is that clear. You can get used to it, of course. Another interesting case is printing a list of items with separators. C loop constructs are biased cases of frequently used loops but they do not cover all the possible cases. &#x27;goto&#x27; is unbiased.<p>A similar case are Python loops. There are “Pythonic” ways:<p><pre><code>    for item in iterable
        ...
</code></pre>
They look sweet but are useful only in some cases. E.g. if you need to modify `iterable`, the Pythonic way won’t work. There are Pythonic workarounds, but they may involve copying a whole iterable, which is hardly a good idea. But there is also a less Pythonic way:<p><pre><code>    i = 0; n = len(iterable)
    while i &lt; n:
        ...
</code></pre>
This works all the time and serves all possible cases.</div><br/></div></div><div id="38442881" class="c"><input type="checkbox" id="c-38442881" checked=""/><div class="controls bullet"><span class="by">pjscott</span><span>|</span><a href="#38442766">parent</a><span>|</span><a href="#38443778">prev</a><span>|</span><a href="#38443415">next</a><span>|</span><label class="collapse" for="c-38442881">[-]</label><label class="expand" for="c-38442881">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s the normal use of goto in C: you run into some exceptional circumstance, you don&#x27;t know how to deal with it, so you goto some code that cleans up any unfinished business you might have, like memory allocations – and then you return some error code as soon as you can, once everything is in a good state.</div><br/><div id="38443515" class="c"><input type="checkbox" id="c-38443515" checked=""/><div class="controls bullet"><span class="by">pcl</span><span>|</span><a href="#38442766">root</a><span>|</span><a href="#38442881">parent</a><span>|</span><a href="#38443415">next</a><span>|</span><label class="collapse" for="c-38443515">[-]</label><label class="expand" for="c-38443515">[1 more]</label></div><br/><div class="children"><div class="content">Interestingly, he also uses it for the happy path, instead of using `break`. I wonder why.</div><br/></div></div></div></div><div id="38443415" class="c"><input type="checkbox" id="c-38443415" checked=""/><div class="controls bullet"><span class="by">flohofwoe</span><span>|</span><a href="#38442766">parent</a><span>|</span><a href="#38442881">prev</a><span>|</span><a href="#38442436">next</a><span>|</span><label class="collapse" for="c-38443415">[-]</label><label class="expand" for="c-38443415">[2 more]</label></div><br/><div class="children"><div class="content">Goto in C is the tamed and civilized structured-programming goto, it has not much to do with the &quot;considered harmful&quot; unstructured goto from days of yore (e.g. you can&#x27;t jump out of a function into a completely unrelated part of the program with C&#x27;s goto like you can in BASIC.</div><br/><div id="38443656" class="c"><input type="checkbox" id="c-38443656" checked=""/><div class="controls bullet"><span class="by">vram22</span><span>|</span><a href="#38442766">root</a><span>|</span><a href="#38443415">parent</a><span>|</span><a href="#38442436">next</a><span>|</span><label class="collapse" for="c-38443656">[-]</label><label class="expand" for="c-38443656">[1 more]</label></div><br/><div class="children"><div class="content">There is also setjmp() and longjmp() in C, or there used to be, earlier. Not been using C intensively for a while.</div><br/></div></div></div></div></div></div><div id="38442436" class="c"><input type="checkbox" id="c-38442436" checked=""/><div class="controls bullet"><span class="by">avmich</span><span>|</span><a href="#38442766">prev</a><span>|</span><label class="collapse" for="c-38442436">[-]</label><label class="expand" for="c-38442436">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s known that many developers implement various flavors of similar simple languages. What would be nice is to have a library of functions which make implementing such languages much simpler than in C. One of benefits of J language - and other APL descendants - is the set of built-in operations which really simplifies working with structures of such kind, even though it&#x27;s not the only their purpose.</div><br/></div></div></div></div></div></div></div></body></html>