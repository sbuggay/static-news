<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1731229252712" as="style"/><link rel="stylesheet" href="styles.css?v=1731229252712"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.outflank.nl/blog/2024/10/15/introducing-early-cascade-injection-from-windows-process-creation-to-stealthy-injection/">Early Cascade Injection: From Windows process creation to stealthy injection</a> <span class="domain">(<a href="https://www.outflank.nl">www.outflank.nl</a>)</span></div><div class="subtext"><span>wsintra2022</span> | <span>15 comments</span></div><br/><div><div id="42096317" class="c"><input type="checkbox" id="c-42096317" checked=""/><div class="controls bullet"><span class="by">wslh</span><span>|</span><a href="#42096488">next</a><span>|</span><label class="collapse" for="c-42096317">[-]</label><label class="expand" for="c-42096317">[1 more]</label></div><br/><div class="children"><div class="content">Great! We have been working on Windows Process (and COM) injection since 2003 [1][2][3]. I need to talk with the current development team about reviewing it with the EDR-Preloading technique. We have a driver also that suspends a new process before hooking it, we also hook existing processes.<p>Business-wise our work on this went down once Microsoft Detours was made FOSS even when our products has other capabilities. A good old thread is here [4].<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;Deviare2">https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;Deviare2</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;Deviare-InProc">https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;Deviare-InProc</a><p>[3] <a href="https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;RemoteBridge">https:&#x2F;&#x2F;github.com&#x2F;nektra&#x2F;RemoteBridge</a><p>[4] <a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;programming&#x2F;comments&#x2F;22crn0&#x2F;gpl_alternative_library_to_microsoft_detours_for&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;programming&#x2F;comments&#x2F;22crn0&#x2F;gpl_alt...</a></div><br/></div></div><div id="42096488" class="c"><input type="checkbox" id="c-42096488" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#42096317">prev</a><span>|</span><a href="#42096390">next</a><span>|</span><label class="collapse" for="c-42096488">[-]</label><label class="expand" for="c-42096488">[4 more]</label></div><br/><div class="children"><div class="content">Not all overriding and detouring is malicious.  For instance, Steam detours Direct3D every time you launch a game in order to set up the steam overlay.</div><br/><div id="42096661" class="c"><input type="checkbox" id="c-42096661" checked=""/><div class="controls bullet"><span class="by">tredre3</span><span>|</span><a href="#42096488">parent</a><span>|</span><a href="#42096390">next</a><span>|</span><label class="collapse" for="c-42096661">[-]</label><label class="expand" for="c-42096661">[3 more]</label></div><br/><div class="children"><div class="content">Windows offers &quot;legal&quot; ways of DLL injection, which is presumably what Steam does, and this article isn&#x27;t about those methods.</div><br/><div id="42097953" class="c"><input type="checkbox" id="c-42097953" checked=""/><div class="controls bullet"><span class="by">therein</span><span>|</span><a href="#42096488">root</a><span>|</span><a href="#42096661">parent</a><span>|</span><a href="#42097069">prev</a><span>|</span><a href="#42096390">next</a><span>|</span><label class="collapse" for="c-42097953">[-]</label><label class="expand" for="c-42097953">[1 more]</label></div><br/><div class="children"><div class="content">As far as I know Steam doesn&#x27;t do anything special like that and they are whitelisted by anti-cheat. Same goes for Discord&#x27;s Direct3D hooks. These are often used for drawing on screen by hacks.</div><br/></div></div></div></div></div></div><div id="42096390" class="c"><input type="checkbox" id="c-42096390" checked=""/><div class="controls bullet"><span class="by">anaisbetts</span><span>|</span><a href="#42096488">prev</a><span>|</span><a href="#42096244">next</a><span>|</span><label class="collapse" for="c-42096390">[-]</label><label class="expand" for="c-42096390">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m surprised the call to WriteProcessMemory or creating suspended processes isn&#x27;t being picked up, it usually gets you a lot of points on the &quot;Detect binary as malware heuristic&quot; detector</div><br/><div id="42096819" class="c"><input type="checkbox" id="c-42096819" checked=""/><div class="controls bullet"><span class="by">seligman99</span><span>|</span><a href="#42096390">parent</a><span>|</span><a href="#42096883">next</a><span>|</span><label class="collapse" for="c-42096819">[-]</label><label class="expand" for="c-42096819">[1 more]</label></div><br/><div class="children"><div class="content">I suspect this is where Windows backwards compatibility bites them a bit.  I&#x27;ve got a very old tool [1] that uses WriteProcessMemory and CreateRemoteThread to create a thread in the command process that launched it to remotely change the directory in that process.<p>It works to this day, despite looking exactly like what malware would do.  My tool is nothing in the grand scheme, but I suspect I&#x27;m not the only one doing these sort of shenanigans, and no doubt some big important app is doing it and can&#x27;t be bothered to fix itself, so MS is stuck supporting it.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;seligman&#x2F;ccd">https:&#x2F;&#x2F;github.com&#x2F;seligman&#x2F;ccd</a></div><br/></div></div><div id="42096883" class="c"><input type="checkbox" id="c-42096883" checked=""/><div class="controls bullet"><span class="by">ale42</span><span>|</span><a href="#42096390">parent</a><span>|</span><a href="#42096819">prev</a><span>|</span><a href="#42096244">next</a><span>|</span><label class="collapse" for="c-42096883">[-]</label><label class="expand" for="c-42096883">[1 more]</label></div><br/><div class="children"><div class="content">If the Windows API provides those functions in the first point, I guess there are good reasons to use them. Of course if you&#x27;re watching out for malware, WriteProcessMemory looks very suspicious, but it&#x27;s not enough to conclude you&#x27;re in presence of malware.</div><br/></div></div></div></div><div id="42096244" class="c"><input type="checkbox" id="c-42096244" checked=""/><div class="controls bullet"><span class="by">purplehat_</span><span>|</span><a href="#42096390">prev</a><span>|</span><a href="#42095982">next</a><span>|</span><label class="collapse" for="c-42096244">[-]</label><label class="expand" for="c-42096244">[4 more]</label></div><br/><div class="children"><div class="content">This is a great writeup, thanks for posting it. The post mentions Early Bird APC is a fairly recent development, around 2018, but process injection has been around for a long time. Is there any theoretical work being done towards locking down processes against injection in more robust ways than simply making sure there is no temporal chance to inject a malicious code? I’m thinking something along the lines of CFI, but for processes instead of subroutines, would be useful if it could be made to work.</div><br/><div id="42096315" class="c"><input type="checkbox" id="c-42096315" checked=""/><div class="controls bullet"><span class="by">haxorudjsk</span><span>|</span><a href="#42096244">parent</a><span>|</span><a href="#42095982">next</a><span>|</span><label class="collapse" for="c-42096315">[-]</label><label class="expand" for="c-42096315">[3 more]</label></div><br/><div class="children"><div class="content">The whole reason this complicated method was researched is exactly because the traditional injection routes are locked down&#x2F;easily monitored.<p>In a previous life where I had to find a way to stealthily inject Chrome (in the presence of good anti-viruses), the solution was to find an obscure type of Windows shell extension which if registered would automatically be loaded by Windows into Chrome without triggering an alert.</div><br/><div id="42097969" class="c"><input type="checkbox" id="c-42097969" checked=""/><div class="controls bullet"><span class="by">yodon</span><span>|</span><a href="#42096244">root</a><span>|</span><a href="#42096315">parent</a><span>|</span><a href="#42095982">next</a><span>|</span><label class="collapse" for="c-42097969">[-]</label><label class="expand" for="c-42097969">[2 more]</label></div><br/><div class="children"><div class="content">I can think of many reasons to do what you describe, none of them good.</div><br/><div id="42098157" class="c"><input type="checkbox" id="c-42098157" checked=""/><div class="controls bullet"><span class="by">richbell</span><span>|</span><a href="#42096244">root</a><span>|</span><a href="#42097969">parent</a><span>|</span><a href="#42095982">next</a><span>|</span><label class="collapse" for="c-42098157">[-]</label><label class="expand" for="c-42098157">[1 more]</label></div><br/><div class="children"><div class="content">Red teaming?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>