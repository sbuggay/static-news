<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1708678853457" as="style"/><link rel="stylesheet" href="styles.css?v=1708678853457"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://resend.com/blog/incident-report-for-february-21-2024">Resend – Incident report for February 21st, 2024</a> <span class="domain">(<a href="https://resend.com">resend.com</a>)</span></div><div class="subtext"><span>RyeCombinator</span> | <span>23 comments</span></div><br/><div><div id="39478088" class="c"><input type="checkbox" id="c-39478088" checked=""/><div class="controls bullet"><span class="by">laborcontract</span><span>|</span><a href="#39478187">next</a><span>|</span><label class="collapse" for="c-39478088">[-]</label><label class="expand" for="c-39478088">[1 more]</label></div><br/><div class="children"><div class="content">Man, I use Resend, I really want to like them and yeah, it is really simple to get started which is great but man, this is, I think they really need to slow down a bit and maybe try to figure out how to put some processes in place to maybe intentionally slow things down.<p>This is the second incident that can be characterized by a very hazy delineation between development and production environments. The first incident had to do with an attacker gaining access to private credentials due to devs leaving keys set in NEXT_PUBLIC environmental variables on their site.</div><br/></div></div><div id="39478187" class="c"><input type="checkbox" id="c-39478187" checked=""/><div class="controls bullet"><span class="by">hw</span><span>|</span><a href="#39478088">prev</a><span>|</span><a href="#39477692">next</a><span>|</span><label class="collapse" for="c-39478187">[-]</label><label class="expand" for="c-39478187">[1 more]</label></div><br/><div class="children"><div class="content">Production database access must always be locked down from external traffic, and only allow traffic from the production application or within the production environment.<p>Aside from mitigating local dev accidentally pointing to the prod db, if you have the db accessible externally means it’s susceptible to network attacks and password attacks</div><br/></div></div><div id="39477692" class="c"><input type="checkbox" id="c-39477692" checked=""/><div class="controls bullet"><span class="by">kgeist</span><span>|</span><a href="#39478187">prev</a><span>|</span><a href="#39477427">next</a><span>|</span><label class="collapse" for="c-39477692">[-]</label><label class="expand" for="c-39477692">[1 more]</label></div><br/><div class="children"><div class="content">Reminds of this classic thread: <a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;cscareerquestions&#x2F;s&#x2F;cqrama0L1z" rel="nofollow">https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;cscareerquestions&#x2F;s&#x2F;cqrama0L1z</a><p>&gt;accidentally destroyed production database on first day of job<p>Same symptoms: while developing a feature locally, they accidentally pointed to the production DB, which was destroyed when running tests.</div><br/></div></div><div id="39477427" class="c"><input type="checkbox" id="c-39477427" checked=""/><div class="controls bullet"><span class="by">anonzzzies</span><span>|</span><a href="#39477692">prev</a><span>|</span><a href="#39477121">next</a><span>|</span><label class="collapse" for="c-39477427">[-]</label><label class="expand" for="c-39477427">[4 more]</label></div><br/><div class="children"><div class="content">This sounds like one of those horrible tools like prisma which drop everything if something is not in sync on dev. We removed this type of stupid in favour of our own which, you know, fixes this actually instead of lazily dropping everything when they cannot resolve some trivial thing, for instance, a new required field without default when there are already rows and other crap which they call ‘opinionated’. No idea why we ever used that stuff as it caused so much grief (never on prod though); after prisma&#x2F;drizzle and some other ‘modern’ horrors, we mistrust everything that’s ’hip and new’ so ‘everyone uses it’. One of those hip and new things I mistrusted was Resend even though ‘suddenly everyone uses it’. I’ll wait a few years before even contemplating it.</div><br/><div id="39477442" class="c"><input type="checkbox" id="c-39477442" checked=""/><div class="controls bullet"><span class="by">satvikpendem</span><span>|</span><a href="#39477427">parent</a><span>|</span><a href="#39477121">next</a><span>|</span><label class="collapse" for="c-39477442">[-]</label><label class="expand" for="c-39477442">[3 more]</label></div><br/><div class="children"><div class="content">I like that Prisma drops the database. Developer databases should be idempotent and easily reseedable with sample data. It&#x27;s the same concept as cattle, not pets, from the devops world but now applied to databases. There should be nothing special about a database in development that cannot be dropped and recreated.</div><br/><div id="39477770" class="c"><input type="checkbox" id="c-39477770" checked=""/><div class="controls bullet"><span class="by">kgeist</span><span>|</span><a href="#39477427">root</a><span>|</span><a href="#39477442">parent</a><span>|</span><a href="#39477450">next</a><span>|</span><label class="collapse" for="c-39477770">[-]</label><label class="expand" for="c-39477770">[1 more]</label></div><br/><div class="children"><div class="content">We have a script which recreates the dev DB, but developers must run the command manually so that there was an understanding what&#x27;s happening.</div><br/></div></div><div id="39477450" class="c"><input type="checkbox" id="c-39477450" checked=""/><div class="controls bullet"><span class="by">anonzzzies</span><span>|</span><a href="#39477427">root</a><span>|</span><a href="#39477442">parent</a><span>|</span><a href="#39477770">prev</a><span>|</span><a href="#39477121">next</a><span>|</span><label class="collapse" for="c-39477450">[-]</label><label class="expand" for="c-39477450">[1 more]</label></div><br/><div class="children"><div class="content">I don’t care about dev databases; I care about why it does it; there is no need for it, at all.<p>&gt; I like that Prisma drops the database.<p>‘Like’ ; so if it didn’t but still worked perfectly, you would complain that it didn’t?</div><br/></div></div></div></div></div></div><div id="39477121" class="c"><input type="checkbox" id="c-39477121" checked=""/><div class="controls bullet"><span class="by">yatish27</span><span>|</span><a href="#39477427">prev</a><span>|</span><a href="#39478301">next</a><span>|</span><label class="collapse" for="c-39477121">[-]</label><label class="expand" for="c-39477121">[10 more]</label></div><br/><div class="children"><div class="content">&quot;While building a feature, we performed a database migration command locally, but it incorrectly pointed to the production environment instead, which dropped all tables in production.&quot;<p>This was scary.</div><br/><div id="39477345" class="c"><input type="checkbox" id="c-39477345" checked=""/><div class="controls bullet"><span class="by">ttul</span><span>|</span><a href="#39477121">parent</a><span>|</span><a href="#39477445">next</a><span>|</span><label class="collapse" for="c-39477345">[-]</label><label class="expand" for="c-39477345">[4 more]</label></div><br/><div class="children"><div class="content">This implies that their production environment is mutable. As in, a command can run and change the production environment. That’s a no no.<p>But I give them a pass because they are a young company. My company was similarly reckless early on, but as we scaled, we had to tighten things up and turning to an immutable deployment approach has saved our asses so many times.</div><br/><div id="39477491" class="c"><input type="checkbox" id="c-39477491" checked=""/><div class="controls bullet"><span class="by">syslog</span><span>|</span><a href="#39477121">root</a><span>|</span><a href="#39477345">parent</a><span>|</span><a href="#39477445">next</a><span>|</span><label class="collapse" for="c-39477491">[-]</label><label class="expand" for="c-39477491">[3 more]</label></div><br/><div class="children"><div class="content">How does immutable work in regard to databases? As in „we need to add a column“?</div><br/><div id="39477588" class="c"><input type="checkbox" id="c-39477588" checked=""/><div class="controls bullet"><span class="by">inopinatus</span><span>|</span><a href="#39477121">root</a><span>|</span><a href="#39477491">parent</a><span>|</span><a href="#39477445">next</a><span>|</span><label class="collapse" for="c-39477588">[-]</label><label class="expand" for="c-39477588">[2 more]</label></div><br/><div class="children"><div class="content">Someone writes the migration, commits it, it passes the build and unit test stages of the pipeline, then the application as currently running passes all function and integration tests with (and this is important) <i>both</i> the prior <i>and</i> the revised schema. Your commit is tagged as release ready! Not long after, the automation tooling confidently executes the now-tested migration under machine control during the next deploy, everyone goes home happy with your shiny new published_at column, and no-one has directly touched prod.<p>Two days later the CTO sends everyone a stroppy email about &quot;column bloat that should&#x27;ve been a table&quot;, ssh&#x27;s into the personal instance that they&#x27;ve been keeping alive† since before you had funding and learned to launch servers as immutable black boxes, and whilst trying to prove a point by rolling it back manually, drops all tables by mistake when a cat treads on the keyboard<p>--<p>† excuse: <i>&quot;it&#x27;s for reporting&quot;</i></div><br/><div id="39477863" class="c"><input type="checkbox" id="c-39477863" checked=""/><div class="controls bullet"><span class="by">RowanH</span><span>|</span><a href="#39477121">root</a><span>|</span><a href="#39477588">parent</a><span>|</span><a href="#39477445">next</a><span>|</span><label class="collapse" for="c-39477863">[-]</label><label class="expand" for="c-39477863">[1 more]</label></div><br/><div class="children"><div class="content">Rookie move having the cat on the desk while ssh&#x27;d into prod...</div><br/></div></div></div></div></div></div></div></div><div id="39477445" class="c"><input type="checkbox" id="c-39477445" checked=""/><div class="controls bullet"><span class="by">disillusioned</span><span>|</span><a href="#39477121">parent</a><span>|</span><a href="#39477345">prev</a><span>|</span><a href="#39477283">next</a><span>|</span><label class="collapse" for="c-39477445">[-]</label><label class="expand" for="c-39477445">[3 more]</label></div><br/><div class="children"><div class="content">That single sentence contains multitudes:<p>* Production should be immutable<p>* No one doing dev in a dev environment should have such trivial access to prod<p>* Are there still good reasons for a migration to drop all tables? I guess it&#x27;s for the dev environment to etch-a-sketch to a known state?<p>Yikes.</div><br/><div id="39477494" class="c"><input type="checkbox" id="c-39477494" checked=""/><div class="controls bullet"><span class="by">anonzzzies</span><span>|</span><a href="#39477121">root</a><span>|</span><a href="#39477445">parent</a><span>|</span><a href="#39477283">next</a><span>|</span><label class="collapse" for="c-39477494">[-]</label><label class="expand" for="c-39477494">[2 more]</label></div><br/><div class="children"><div class="content">&gt; No one doing dev in a dev environment should have such trivial access to prod<p>It’s the new and hip ‘cloud’! Probably using planetscale or something like that, which (last I checked, maybe it changed but wasn’t on), doesn’t even have ip protections outside the mysql user settings (while bad, would’ve protected them).<p>&gt; Are there still good reasons for a migration to drop all tables?<p>We haven’t found any.</div><br/><div id="39477832" class="c"><input type="checkbox" id="c-39477832" checked=""/><div class="controls bullet"><span class="by">willsmith72</span><span>|</span><a href="#39477121">root</a><span>|</span><a href="#39477494">parent</a><span>|</span><a href="#39477283">next</a><span>|</span><label class="collapse" for="c-39477832">[-]</label><label class="expand" for="c-39477832">[1 more]</label></div><br/><div class="children"><div class="content">really? i&#x27;ve definitely done it before on my local as a quicker alternative to cleaning up the docker container&#x2F;volume, doesn&#x27;t seem that bad<p>ofc i&#x27;d think differently if i was also putting write-permission prod credentials into my machine, but luckily i haven&#x27;t been in many places doing that</div><br/></div></div></div></div></div></div><div id="39477283" class="c"><input type="checkbox" id="c-39477283" checked=""/><div class="controls bullet"><span class="by">hn_throwaway_99</span><span>|</span><a href="#39477121">parent</a><span>|</span><a href="#39477445">prev</a><span>|</span><a href="#39477190">next</a><span>|</span><label class="collapse" for="c-39477283">[-]</label><label class="expand" for="c-39477283">[1 more]</label></div><br/><div class="children"><div class="content">Extremely so in my opinion. In this day and age, viewing something like this means this company fundamentally doesn&#x27;t understand security. It should simply be impossible to &quot;incorrectly point to the production environment&quot;, because whoever ran this shouldn&#x27;t even have access to those credentials in the first place.</div><br/></div></div><div id="39477190" class="c"><input type="checkbox" id="c-39477190" checked=""/><div class="controls bullet"><span class="by">Rygian</span><span>|</span><a href="#39477121">parent</a><span>|</span><a href="#39477283">prev</a><span>|</span><a href="#39478301">next</a><span>|</span><label class="collapse" for="c-39477190">[-]</label><label class="expand" for="c-39477190">[1 more]</label></div><br/><div class="children"><div class="content">Separation between office and production should be the norm.</div><br/></div></div></div></div><div id="39478301" class="c"><input type="checkbox" id="c-39478301" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#39477121">prev</a><span>|</span><a href="#39477855">next</a><span>|</span><label class="collapse" for="c-39478301">[-]</label><label class="expand" for="c-39478301">[1 more]</label></div><br/><div class="children"><div class="content">Sometimes I think the infra at the small company I work at isn&#x27;t great, but we&#x27;ve not had direct dev access to prod DBs from day one. They&#x27;re locked down at the IP level. You&#x27;d have to go through some serious hoops to accidentally connect to prod even if you had the keys.<p>I remember as a child thinking adults had everything under control. That they know what they&#x27;re doing. I guess I assumed a day would come when I too would know. That day never came. It&#x27;s easy to think when you look at shiny websites and the first paragraph of this comment that other adults do know. But I&#x27;m often reminded of the truth: nobody knows. Everyone is always operating at least slightly outside their comfort zone or, in the case of the article, wildly.</div><br/></div></div><div id="39477855" class="c"><input type="checkbox" id="c-39477855" checked=""/><div class="controls bullet"><span class="by">doctor_eval</span><span>|</span><a href="#39478301">prev</a><span>|</span><a href="#39477647">next</a><span>|</span><label class="collapse" for="c-39477855">[-]</label><label class="expand" for="c-39477855">[1 more]</label></div><br/><div class="children"><div class="content">If they’re small then you can see it happening where someone was logged into prod using some environment variables to sort out some issue - probably didn’t even update production, just a few queries - and then went back to work.<p>Hours later they run some script that does DROP DATABASE from that same shell they used to troubleshoot, which takes a little longer than usual…<p>Anyway I can totally see it happening to me in my little one man shop, but now i think I might look at removing some privileges from my prod account :)</div><br/></div></div><div id="39477647" class="c"><input type="checkbox" id="c-39477647" checked=""/><div class="controls bullet"><span class="by">walrus01</span><span>|</span><a href="#39477855">prev</a><span>|</span><label class="collapse" for="c-39477647">[-]</label><label class="expand" for="c-39477647">[3 more]</label></div><br/><div class="children"><div class="content">From the company&#x27;s homepage: &quot;deliver marketing emails at scale&quot;<p>Maybe this company doesn&#x27;t need to exist, and shouldn&#x27;t.</div><br/><div id="39478144" class="c"><input type="checkbox" id="c-39478144" checked=""/><div class="controls bullet"><span class="by">vmfunction</span><span>|</span><a href="#39477647">parent</a><span>|</span><a href="#39478189">next</a><span>|</span><label class="collapse" for="c-39478144">[-]</label><label class="expand" for="c-39478144">[1 more]</label></div><br/><div class="children"><div class="content">It is actually very open of them to post that! I&#x27;m sure things like that happens in larger companies, but I&#x27;m sure we won&#x27;t get a incident report like that from them. I would rather work with that kind of company. Then we can also see if they learned from their lesson, and this doesn&#x27;t repeat again.</div><br/></div></div><div id="39478189" class="c"><input type="checkbox" id="c-39478189" checked=""/><div class="controls bullet"><span class="by">heyarviind2</span><span>|</span><a href="#39477647">parent</a><span>|</span><a href="#39478144">prev</a><span>|</span><label class="collapse" for="c-39478189">[-]</label><label class="expand" for="c-39478189">[1 more]</label></div><br/><div class="children"><div class="content">Many companies are already solving the same problem, and then resend comes into the picture with the support of YC. They are doing everything except sending the mails.</div><br/></div></div></div></div></div></div></div></div></div></body></html>