<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707555659427" as="style"/><link rel="stylesheet" href="styles.css?v=1707555659427"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://grafana.com/blog/2024/02/09/how-i-write-http-services-in-go-after-13-years/">How I write HTTP services in Go after 13 years</a>Â <span class="domain">(<a href="https://grafana.com">grafana.com</a>)</span></div><div class="subtext"><span>matryer</span> | <span>164 comments</span></div><br/><div><div id="39320344" class="c"><input type="checkbox" id="c-39320344" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320339">next</a><span>|</span><label class="collapse" for="c-39320344">[-]</label><label class="expand" for="c-39320344">[95 more]</label></div><br/><div class="children"><div class="content">&gt;<i>The Valid method takes a context (which is optional but has been useful for me in the past) and returns a map. If there is a problem with a field, its name is used as the key, and a human-readable explanation of the issue is set as the value.</i><p>I used to do this, but ever since reading Lexi Lambda&#x27;s &quot;Parse, Don&#x27;t Validate,&quot; [0] I&#x27;ve found validators to be much more error-prone than leveraging Go&#x27;s built-in type checker.<p>For example, imagine you wanted to defend against the user picking an illegal username. Like you want to make sure the user can&#x27;t ever specify a username with angle brackets in it.<p>With the Validator approach, you have to remember to call the validator on 100% of code paths where the username value comes from an untrusted source.<p>Instead of using a validator, you can do this:<p><pre><code>    type Username struct {
      value string
    }

    func NewUsername(username string) (Username, error) {
      &#x2F;&#x2F; Validate the username adheres to our schema.
      ...

      return Username{username}
    }
</code></pre>
That guarantees that you can never forget to validate the username through any codepath. If you have a Username object, you know that it was validated because there was no other way to create the object.<p>[0] <a href="https:&#x2F;&#x2F;lexi-lambda.github.io&#x2F;blog&#x2F;2019&#x2F;11&#x2F;05&#x2F;parse-don-t-validate&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lexi-lambda.github.io&#x2F;blog&#x2F;2019&#x2F;11&#x2F;05&#x2F;parse-don-t-va...</a></div><br/><div id="39320719" class="c"><input type="checkbox" id="c-39320719" checked=""/><div class="controls bullet"><span class="by">xboxnolifes</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320881">next</a><span>|</span><label class="collapse" for="c-39320719">[-]</label><label class="expand" for="c-39320719">[20 more]</label></div><br/><div class="children"><div class="content">Crazy that actually using your type system leads to better code. Stop passing everything around as `string`. Parse them, and type them.</div><br/><div id="39321168" class="c"><input type="checkbox" id="c-39321168" checked=""/><div class="controls bullet"><span class="by">stickfigure</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320719">parent</a><span>|</span><a href="#39322113">next</a><span>|</span><label class="collapse" for="c-39321168">[-]</label><label class="expand" for="c-39321168">[16 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a name for this anti-pattern: &quot;Stringly typed&quot;</div><br/><div id="39323071" class="c"><input type="checkbox" id="c-39323071" checked=""/><div class="controls bullet"><span class="by">zeroCalories</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321168">parent</a><span>|</span><a href="#39321558">next</a><span>|</span><label class="collapse" for="c-39323071">[-]</label><label class="expand" for="c-39323071">[7 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve also seen it called primitive obsession, which is also applicable to other primitive types like using an integer in situations where an enum would be better.</div><br/><div id="39323687" class="c"><input type="checkbox" id="c-39323687" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323071">parent</a><span>|</span><a href="#39323275">next</a><span>|</span><label class="collapse" for="c-39323687">[-]</label><label class="expand" for="c-39323687">[4 more]</label></div><br/><div class="children"><div class="content">Definitely use to fall for primitive obsession. It seemed so silly to wrap objects in an intermediary type.<p>After playing with Rust, I changed my tune. The type system just forces you into the correct path, that a lot of code became boring because you no longer had to second guess what-if scenarios.</div><br/><div id="39323752" class="c"><input type="checkbox" id="c-39323752" checked=""/><div class="controls bullet"><span class="by">xboxnolifes</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323687">parent</a><span>|</span><a href="#39324016">next</a><span>|</span><label class="collapse" for="c-39323752">[-]</label><label class="expand" for="c-39323752">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Definitely use to fall for primitive obsession. It seemed so silly to wrap objects in an intermediary type.<p>A lot of languages certainly don&#x27;t make it easy. You shouldn&#x27;t have to make a Username struct&#x2F;class with a string field to have a typed username. You should be able to declare a type Username which is just a string under the hood, but with different associated functions.</div><br/></div></div><div id="39324016" class="c"><input type="checkbox" id="c-39324016" checked=""/><div class="controls bullet"><span class="by">zeroCalories</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323687">parent</a><span>|</span><a href="#39323752">prev</a><span>|</span><a href="#39323275">next</a><span>|</span><label class="collapse" for="c-39324016">[-]</label><label class="expand" for="c-39324016">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, modern type systems are game changers. I&#x27;ve soured on Rust, but if Go had the full Ocaml type system with match statements I think it would be the perfect language.</div><br/></div></div></div></div><div id="39323275" class="c"><input type="checkbox" id="c-39323275" checked=""/><div class="controls bullet"><span class="by">skitter</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323071">parent</a><span>|</span><a href="#39323687">prev</a><span>|</span><a href="#39321558">next</a><span>|</span><label class="collapse" for="c-39323275">[-]</label><label class="expand" for="c-39323275">[2 more]</label></div><br/><div class="children"><div class="content">Sadly enums are too advanced of a concept to be included in Go.</div><br/><div id="39323455" class="c"><input type="checkbox" id="c-39323455" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323275">parent</a><span>|</span><a href="#39321558">next</a><span>|</span><label class="collapse" for="c-39323455">[-]</label><label class="expand" for="c-39323455">[1 more]</label></div><br/><div class="children"><div class="content">See <a href="https:&#x2F;&#x2F;eli.thegreenplace.net&#x2F;2018&#x2F;go-and-algebraic-data-types&#x2F;" rel="nofollow">https:&#x2F;&#x2F;eli.thegreenplace.net&#x2F;2018&#x2F;go-and-algebraic-data-typ...</a> for more background.</div><br/></div></div></div></div></div></div><div id="39321558" class="c"><input type="checkbox" id="c-39321558" checked=""/><div class="controls bullet"><span class="by">timcobb</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321168">parent</a><span>|</span><a href="#39323071">prev</a><span>|</span><a href="#39322688">next</a><span>|</span><label class="collapse" for="c-39321558">[-]</label><label class="expand" for="c-39321558">[3 more]</label></div><br/><div class="children"><div class="content">Bash :(</div><br/><div id="39322251" class="c"><input type="checkbox" id="c-39322251" checked=""/><div class="controls bullet"><span class="by">nsguy</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321558">parent</a><span>|</span><a href="#39322688">next</a><span>|</span><label class="collapse" for="c-39322251">[-]</label><label class="expand" for="c-39322251">[2 more]</label></div><br/><div class="children"><div class="content">JSON</div><br/><div id="39322689" class="c"><input type="checkbox" id="c-39322689" checked=""/><div class="controls bullet"><span class="by">tdeck</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322251">parent</a><span>|</span><a href="#39322688">next</a><span>|</span><label class="collapse" for="c-39322689">[-]</label><label class="expand" for="c-39322689">[1 more]</label></div><br/><div class="children"><div class="content">TCL</div><br/></div></div></div></div></div></div><div id="39322688" class="c"><input type="checkbox" id="c-39322688" checked=""/><div class="controls bullet"><span class="by">tdeck</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321168">parent</a><span>|</span><a href="#39321558">prev</a><span>|</span><a href="#39322113">next</a><span>|</span><label class="collapse" for="c-39322688">[-]</label><label class="expand" for="c-39322688">[5 more]</label></div><br/><div class="children"><div class="content">This term is typically used to refer to things like data structures and numerical values all being passed as strings. I don&#x27;t think a reasonable person would consider storing a username in a string to be &quot;stringly typed&quot;.</div><br/><div id="39323241" class="c"><input type="checkbox" id="c-39323241" checked=""/><div class="controls bullet"><span class="by">antonvs</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322688">parent</a><span>|</span><a href="#39322921">next</a><span>|</span><label class="collapse" for="c-39323241">[-]</label><label class="expand" for="c-39323241">[1 more]</label></div><br/><div class="children"><div class="content">It definitely is stringly typed. It&#x27;s just that it&#x27;s a very normalized example of it, that people don&#x27;t think of as being an antipattern.<p>If you want to implement what Yaron Minsky described as &quot;make illegal states unrepresentable&quot;, then you use a username type, not a string. That rules out multiple entire classes of illegal states.<p>If you do that, then when you compile your program, the typechecker can provide a much stronger correctness proof, for more properties. It allows you to do &quot;static debugging&quot; effectively, where you debug your code before it ever even runs.</div><br/></div></div><div id="39322921" class="c"><input type="checkbox" id="c-39322921" checked=""/><div class="controls bullet"><span class="by">samatman</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322688">parent</a><span>|</span><a href="#39323241">prev</a><span>|</span><a href="#39322113">next</a><span>|</span><label class="collapse" for="c-39322921">[-]</label><label class="expand" for="c-39322921">[3 more]</label></div><br/><div class="children"><div class="content">The One True Wiki[0] says &quot;Used to describe an implementation that needlessly relies on strings when programmer &amp; refactor friendly options are available.&quot;<p>Which is exactly what&#x27;s going on here. A username has a string as a payload, but that payload has restrictions (not every string will do) and methods which expect a username should get a username, not any old string.<p>[0]: <a href="https:&#x2F;&#x2F;wiki.c2.com&#x2F;?StringlyTyped" rel="nofollow">https:&#x2F;&#x2F;wiki.c2.com&#x2F;?StringlyTyped</a></div><br/><div id="39323936" class="c"><input type="checkbox" id="c-39323936" checked=""/><div class="controls bullet"><span class="by">tdeck</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322921">parent</a><span>|</span><a href="#39322113">next</a><span>|</span><label class="collapse" for="c-39323936">[-]</label><label class="expand" for="c-39323936">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t agree that this example is more &quot;programmer friendly&quot;. Anything you want to do with the username other than null check and passing an argument is going to be based directly on the string representation. Insert into a database? String. Display in a UI? String. Compare? String comparison. Sort? String sort. Is it really more &quot;programmer friendly&quot; to create wrapper types for individual strings all over your codebase that need to have passthrough methods for all the common string methods? One could argue that it&#x27;s worth the tradeoff but this C2 definition is far from helpful in setting a clear boundary.<p>Meanwhile the real world usages of this term I&#x27;ve seen in the past have all been things like enums as strings, lists as strings, numbers as strings, etc... Not arbitrary textual inputs from the user.</div><br/><div id="39324033" class="c"><input type="checkbox" id="c-39324033" checked=""/><div class="controls bullet"><span class="by">cwilkes</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323936">parent</a><span>|</span><a href="#39322113">next</a><span>|</span><label class="collapse" for="c-39324033">[-]</label><label class="expand" for="c-39324033">[1 more]</label></div><br/><div class="children"><div class="content">You inherit some code.  Is that string a username or a phone number?  Who knows. Someone accidentally swapped two parameter values.  Now the phone number is a username and youâve got a headache of trying to figure out whatâs wrong.<p>By having stronger types this wonât come up as a problem.  You donât have to rely on having the best programmers in the world that never make mistakes (tm) to be on your team and instead rely on the computer making guard rails for you so you canât screw up minor things like that.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39322113" class="c"><input type="checkbox" id="c-39322113" checked=""/><div class="controls bullet"><span class="by">munk-a</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320719">parent</a><span>|</span><a href="#39321168">prev</a><span>|</span><a href="#39322375">next</a><span>|</span><label class="collapse" for="c-39322113">[-]</label><label class="expand" for="c-39322113">[2 more]</label></div><br/><div class="children"><div class="content">As a PHP developer I am frankly disappointed you think that we only do that with strings.  I&#x27;ve got an array[1] full of other tools.<p>1. Or maybe a map?  Those keys might have significance I didn&#x27;t tell you about.</div><br/><div id="39322152" class="c"><input type="checkbox" id="c-39322152" checked=""/><div class="controls bullet"><span class="by">xboxnolifes</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322113">parent</a><span>|</span><a href="#39322375">next</a><span>|</span><label class="collapse" for="c-39322152">[-]</label><label class="expand" for="c-39322152">[1 more]</label></div><br/><div class="children"><div class="content">I originally typed out `int` and wanted to do more, but I try to keep my comments as targeted as possible to avoid the common reply pattern of derailing a topic by commenting on the smallest and least important part of it. If I type `string`, `int`, `arrays`, `maps`, `enums`... someone will write 3 paragraphs about enums are actually an adequate usage of the type system, and everyone will focus on that instead of the overarching message.</div><br/></div></div></div></div></div></div><div id="39320881" class="c"><input type="checkbox" id="c-39320881" checked=""/><div class="controls bullet"><span class="by">skybrian</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320719">prev</a><span>|</span><a href="#39320395">next</a><span>|</span><label class="collapse" for="c-39320881">[-]</label><label class="expand" for="c-39320881">[3 more]</label></div><br/><div class="children"><div class="content">This is a good design pattern, but be wary of doing validation too early. The design pattern allows you to do it as early or late as you like, but doesn&#x27;t tell you when to do it. Often it&#x27;s best to do it as part of parsing&#x2F;validating some larger object.<p>See Steven Witten&#x27;s &quot;I is for Intent&quot; [1] for some ideas about the use of unvalidated data in a UI context.<p>[1] <a href="https:&#x2F;&#x2F;acko.net&#x2F;blog&#x2F;i-is-for-intent&#x2F;" rel="nofollow">https:&#x2F;&#x2F;acko.net&#x2F;blog&#x2F;i-is-for-intent&#x2F;</a></div><br/><div id="39322707" class="c"><input type="checkbox" id="c-39322707" checked=""/><div class="controls bullet"><span class="by">lolinder</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320881">parent</a><span>|</span><a href="#39320395">next</a><span>|</span><label class="collapse" for="c-39322707">[-]</label><label class="expand" for="c-39322707">[2 more]</label></div><br/><div class="children"><div class="content">I read through that piece and strongly disagree with the premise that their insight is somehow at odds with leaning into the type system for correctness.<p>The legitimate insight that they have is that anchoring the state as close as possible to the user input is valuableâI think that that is a great insight with a lot of good applications.<p>However, there&#x27;s nothing that says you can&#x27;t take that user-centric state and put it in a strongly typed data structure as soon as possible, with a set of clearly defined and well-typed transitions mapping the user-centric state to the derived states.<p>Edit: looks like there was discussion on this the other day, with a number of people making similar observationsâ<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39269886">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39269886</a></div><br/><div id="39323596" class="c"><input type="checkbox" id="c-39323596" checked=""/><div class="controls bullet"><span class="by">skybrian</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322707">parent</a><span>|</span><a href="#39320395">next</a><span>|</span><label class="collapse" for="c-39323596">[-]</label><label class="expand" for="c-39323596">[1 more]</label></div><br/><div class="children"><div class="content">A text file and an abstract syntax tree can both be rigorously represented using types, but one is before parsing and other is after parsing. The question is which one is more suitable for editing?<p>Text has more possible states than the equivalent AST, many of which are useful when you haven&#x27;t typed in all the code yet. Incomplete code usually doesn&#x27;t parse.<p>This suggests that <i>drafts</i> should be represented as text, not an AST.<p>And maybe similarly for drafts of other things? Drafts will have some representation that follows some rules, but maybe they shouldn&#x27;t have to follow all the rules. You may still want to save drafts and collaborate on them even though they break some rules.<p>In a system that&#x27;s <i>not</i> an editor, though, maybe it makes sense to validate early. For a command-line utility, the editor is external, provided by the environment (a shell or the editor for a shell script) so you don&#x27;t need to be concerned with that.</div><br/></div></div></div></div></div></div><div id="39320395" class="c"><input type="checkbox" id="c-39320395" checked=""/><div class="controls bullet"><span class="by">oorza</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320881">prev</a><span>|</span><a href="#39320928">next</a><span>|</span><label class="collapse" for="c-39320395">[-]</label><label class="expand" for="c-39320395">[1 more]</label></div><br/><div class="children"><div class="content">Conceptually equivalent to the ancient arts of private constructors and factory methods.</div><br/></div></div><div id="39320928" class="c"><input type="checkbox" id="c-39320928" checked=""/><div class="controls bullet"><span class="by">andrus</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320395">prev</a><span>|</span><a href="#39320842">next</a><span>|</span><label class="collapse" for="c-39320928">[-]</label><label class="expand" for="c-39320928">[3 more]</label></div><br/><div class="children"><div class="content">Iâve found it hard to apply this pattern in Go since, if Username is embedded in a struct, and you forget to set it, youâll get Usernameâs zero value, which may violate your constraints.</div><br/><div id="39321933" class="c"><input type="checkbox" id="c-39321933" checked=""/><div class="controls bullet"><span class="by">mrklol</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320928">parent</a><span>|</span><a href="#39320842">next</a><span>|</span><label class="collapse" for="c-39321933">[-]</label><label class="expand" for="c-39321933">[2 more]</label></div><br/><div class="children"><div class="content">Why? You can easily call NewUsername inside NewAccount for example, just return the error. Or did I misunderstood?</div><br/><div id="39322778" class="c"><input type="checkbox" id="c-39322778" checked=""/><div class="controls bullet"><span class="by">BreakfastB0b</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321933">parent</a><span>|</span><a href="#39320842">next</a><span>|</span><label class="collapse" for="c-39322778">[-]</label><label class="expand" for="c-39322778">[1 more]</label></div><br/><div class="children"><div class="content">Because go doesnât have exhaustiveness checking when initialising structs. Instead it encourages âmake the zero value meaningfulâ which is not always possible nor desirable. I usually use a linter to catch this kind of problem <a href="https:&#x2F;&#x2F;github.com&#x2F;GaijinEntertainment&#x2F;go-exhaustruct">https:&#x2F;&#x2F;github.com&#x2F;GaijinEntertainment&#x2F;go-exhaustruct</a></div><br/></div></div></div></div></div></div><div id="39320842" class="c"><input type="checkbox" id="c-39320842" checked=""/><div class="controls bullet"><span class="by">cogman10</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320928">prev</a><span>|</span><a href="#39324391">next</a><span>|</span><label class="collapse" for="c-39320842">[-]</label><label class="expand" for="c-39320842">[17 more]</label></div><br/><div class="children"><div class="content">The issue is DRY often comes to wreck this sort of thing.  Some devs will see &quot;Hmm, Username is exactly the same as just a string so let&#x27;s just use a string as Username is just added complexity&quot;.<p>I&#x27;ve tried it with constructs like `Data` and `ValidatedData` and it definitely works, but you do end up with duplicate fields between the two objects or worse an ever growing inheritance tree and fields unrelated to either object shared by both.<p>For example, consider data looking like<p><pre><code>    Data {
      value string
    }
</code></pre>
and ValidatedData looking like<p><pre><code>    ValidatedData {
      value int
    }
</code></pre>
There&#x27;s a mighty temptation for some devs to want to apply DRY and zip these two things together.  Unfortunately, that can really be messy on these sorts of type changes and the where of where validation needs to happen gets muddled.</div><br/><div id="39320873" class="c"><input type="checkbox" id="c-39320873" checked=""/><div class="controls bullet"><span class="by">xboxnolifes</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320842">parent</a><span>|</span><a href="#39321435">next</a><span>|</span><label class="collapse" for="c-39320873">[-]</label><label class="expand" for="c-39320873">[8 more]</label></div><br/><div class="children"><div class="content">Except Username is <i>not</i> exactly the same as string, and that&#x27;s important. Username is a <i>subset</i> of string. If they were equivalent, we wouldn&#x27;t need to parse&#x2F;validate.<p>The often misinterpreted part of DRY is conflating &quot;these are the same words, so they are the same&quot;, with &quot;these are the same concept, so they are the same&quot;. A Username and a String are conceptually different.</div><br/><div id="39320956" class="c"><input type="checkbox" id="c-39320956" checked=""/><div class="controls bullet"><span class="by">cogman10</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320873">parent</a><span>|</span><a href="#39321435">next</a><span>|</span><label class="collapse" for="c-39320956">[-]</label><label class="expand" for="c-39320956">[7 more]</label></div><br/><div class="children"><div class="content">DRY is just &quot;Do not repeat yourself&quot;.  And a LOT of devs take that literally.  It&#x27;s not &quot;Do not repeat concepts&quot; (which is what it SHOULD be but DRC isn&#x27;t a fun acronym).<p>Unfortunately &quot;This is the same character string&quot; is all a DRY purist needs to start messing up the code base.<p>I honestly believe that &quot;DRY&quot; is an anti-pattern because of how often I see this exact behavior trotted out or espoused.  It&#x27;s a cargo cult thing to some devs.</div><br/><div id="39321166" class="c"><input type="checkbox" id="c-39321166" checked=""/><div class="controls bullet"><span class="by">oorza</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320956">parent</a><span>|</span><a href="#39321245">next</a><span>|</span><label class="collapse" for="c-39321166">[-]</label><label class="expand" for="c-39321166">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s why I like to tell people to always remember to stay MOIST - the Most Optimal is Implicitly the Simplest Thing.<p>When you add complexity to DRY out your code, you&#x27;re adding a readability regression.  DRY matters in very few context beyond readability, and simplicity and low cognitive load need to be in charge.  Everything else you do code-style wise should be in service of those two things.</div><br/><div id="39324604" class="c"><input type="checkbox" id="c-39324604" checked=""/><div class="controls bullet"><span class="by">HeavyStorm</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321166">parent</a><span>|</span><a href="#39321245">next</a><span>|</span><label class="collapse" for="c-39324604">[-]</label><label class="expand" for="c-39324604">[1 more]</label></div><br/><div class="children"><div class="content">DRY has nothing to do with readability. The fact that it might help with it is purely coincidental.<p>DRY is about maintainability - if you repeat rules (behavior) around the system and someone comes along and changes it, how can you be sure it affected all the system coherently?<p>I&#x27;ve seen this in practice: we get a demand from the PO, a more recent hire goes to make the change, the use case of interest to the PO gets accepted. A week later we have a bug on production because a different code path is still relying on the old rule.</div><br/></div></div></div></div><div id="39321245" class="c"><input type="checkbox" id="c-39321245" checked=""/><div class="controls bullet"><span class="by">hombre_fatal</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320956">parent</a><span>|</span><a href="#39321166">prev</a><span>|</span><a href="#39321505">next</a><span>|</span><label class="collapse" for="c-39321245">[-]</label><label class="expand" for="c-39321245">[3 more]</label></div><br/><div class="children"><div class="content">This seems less about DRY and more a story about a hypothetical junior dev making a dumb mistake masquerading as commentary about âDRY purismâ.</div><br/><div id="39321328" class="c"><input type="checkbox" id="c-39321328" checked=""/><div class="controls bullet"><span class="by">cogman10</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321245">parent</a><span>|</span><a href="#39321505">next</a><span>|</span><label class="collapse" for="c-39321328">[-]</label><label class="expand" for="c-39321328">[2 more]</label></div><br/><div class="children"><div class="content">Man I wish it was just jr devs.  I cut jrs a ton of slack, they don&#x27;t know any better.  However, it&#x27;s the seniors with the quick quips that are the biggest issue I run into.  Or perhaps senior devs with jr mentalities</div><br/><div id="39321393" class="c"><input type="checkbox" id="c-39321393" checked=""/><div class="controls bullet"><span class="by">ikiris</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321328">parent</a><span>|</span><a href="#39321505">next</a><span>|</span><label class="collapse" for="c-39321393">[-]</label><label class="expand" for="c-39321393">[1 more]</label></div><br/><div class="children"><div class="content">most srs are just jrs with inflated egos and titles</div><br/></div></div></div></div></div></div><div id="39321505" class="c"><input type="checkbox" id="c-39321505" checked=""/><div class="controls bullet"><span class="by">sroussey</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320956">parent</a><span>|</span><a href="#39321245">prev</a><span>|</span><a href="#39321435">next</a><span>|</span><label class="collapse" for="c-39321505">[-]</label><label class="expand" for="c-39321505">[1 more]</label></div><br/><div class="children"><div class="content">Like everything, it depends is the right answer.</div><br/></div></div></div></div></div></div><div id="39321435" class="c"><input type="checkbox" id="c-39321435" checked=""/><div class="controls bullet"><span class="by">devjab</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320842">parent</a><span>|</span><a href="#39320873">prev</a><span>|</span><a href="#39321896">next</a><span>|</span><label class="collapse" for="c-39321435">[-]</label><label class="expand" for="c-39321435">[7 more]</label></div><br/><div class="children"><div class="content">One of the major issues with a lot of the outdated concepts in programming is that we still teach them to young people. I work a side gig as an external examiner for CS students. Especially in the early years they are taught the same OOP content that I was taught some decades ago, stuff that I havenât used (also) for some decades. Because while a lot of the concepts may work well in theory, they never work out in a world where programmers have to write code on a Thursday afternoon after a terrible week.<p>Itâs almost always better to repeat code. Itâs obviously not something that is completely black and white, even if I prefer to never really do any form of inheritance or mutability, itâs not like I wouldnât want you to create a âbaseâ class with âcreated byâ âupdated byâ and so on for your data classes and if you have some functions that do universal stuff for you and never change, then by all means use them in different places. But for the most part, repeating code will keep your code much cleaner. Maybe not today or the next month, but five years down the line nobody is going to want to touch that shared code which is now so complicated you may as well close your business before you let anyone touch it. Again, not because the theoretical concepts that lead to this are necessarily flawed, but because they require too much âcorrectnessâ to be useful.<p>Academia hasnât really caught on though. I still grade first semester students who have the whole âAnimalâ -&gt; âduckâ, âdogâ, âcatâ or whatever they use into their heads as the âcorrect wayâ to do things. Similar to how they are often taught other processes than agile, but are taught that agile is the âonlyâ way, even though weâve seen just how wrong that is.<p>Iâm not sure what we can really do about it. Iâve always championed strongly opinionated dev setups where I work. Some of the things weâve done, and are going to do, arenât going to be great, but what we try to do is to build an environment where itâs as easy as possible for every developer to build code the most maintainable way. We want to help them get there, even when itâs 15:45 on a Thursday that has been full of shit meetings in a week thatâs been full of screaming children and an angry spouse and a car that exploded. And things like DRY just arenât useful.</div><br/><div id="39324657" class="c"><input type="checkbox" id="c-39324657" checked=""/><div class="controls bullet"><span class="by">HeavyStorm</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321435">parent</a><span>|</span><a href="#39322185">next</a><span>|</span><label class="collapse" for="c-39324657">[-]</label><label class="expand" for="c-39324657">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, no. Not at all.
I imagine that you are taking DRY quite literally, as if and critiquing the most stupid use cases of it, like DRYing calls to Split with spaces to SplitBySpace.<p>DRY&#x27;s goal is to avoid defining behaviors in duplicity, resulting in having multiple points in code to change when you need to modify said behavior. Code needs to be coherent to be &quot;good&quot;, for a number of of the different quality indicators.<p>I&#x27;m doing a &quot;side project&quot; right now where I&#x27;m using a newcomer payment gateway. They certainly don&#x27;t DRY stuff. Same field gets serialized with camel case and snake case in different API, and whole structures that represent the same concept are duplicate with slightly different fields. This probably means that Thursday 15.25 the dev checked-in her code happy because the reviewer never cared about DRY, and now I&#x27;m paying the price of maintaining four types of addresses in my code base.</div><br/></div></div><div id="39322185" class="c"><input type="checkbox" id="c-39322185" checked=""/><div class="controls bullet"><span class="by">kcrwfrd_</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321435">parent</a><span>|</span><a href="#39324657">prev</a><span>|</span><a href="#39321491">next</a><span>|</span><label class="collapse" for="c-39322185">[-]</label><label class="expand" for="c-39322185">[1 more]</label></div><br/><div class="children"><div class="content">Itâs a balancing act, but deletable code is often preferable to purely-DRY-for-the-sake-of-DRY, overly abstracted code.</div><br/></div></div><div id="39321491" class="c"><input type="checkbox" id="c-39321491" checked=""/><div class="controls bullet"><span class="by">shrimp_emoji</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321435">parent</a><span>|</span><a href="#39322185">prev</a><span>|</span><a href="#39321896">next</a><span>|</span><label class="collapse" for="c-39321491">[-]</label><label class="expand" for="c-39321491">[4 more]</label></div><br/><div class="children"><div class="content">&gt; <i>Itâs almost always better to repeat code.</i><p>God no. Stop the copy pasta disease! It&#x27;s horrible, mindless programming.<p>When reviewing code, I&#x27;m astonished anything was accomplished by copy pasting so much old code (complete with bugs and comment typos).<p>Incidentally, OOP encourages you to copy a lot. It&#x27;s just an engine for generating code bloat. Want to serialize some objects? Here&#x27;s your Object serializer and your overloaded Car serialize and your overloaded Boat serializer, with only a few different fields to justify the difference!<p>OOP is bad. Copy pasta is bad. DRY is good. All hail DRY, forever, at any cost.</div><br/><div id="39321625" class="c"><input type="checkbox" id="c-39321625" checked=""/><div class="controls bullet"><span class="by">jddj</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321491">parent</a><span>|</span><a href="#39321630">next</a><span>|</span><label class="collapse" for="c-39321625">[-]</label><label class="expand" for="c-39321625">[1 more]</label></div><br/><div class="children"><div class="content">Countless man-centuries have been lost looking for the perfect abstraction to cover two (or an imagined future with two) cases which look deceptively similar, then teasing them apart again.</div><br/></div></div><div id="39321630" class="c"><input type="checkbox" id="c-39321630" checked=""/><div class="controls bullet"><span class="by">zerbinxx</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321491">parent</a><span>|</span><a href="#39321625">prev</a><span>|</span><a href="#39323189">next</a><span>|</span><label class="collapse" for="c-39321630">[-]</label><label class="expand" for="c-39321630">[1 more]</label></div><br/><div class="children"><div class="content">OOP and Dry are compatible! Iâve actually done the thing that the above commenter suggests - create a base object with created on&#x2F;by so that I never have to think about it. Whether or not you actually care about that, if you implement a descended of that object youâre going to get some stuff for free, and youâre gonna like it!</div><br/></div></div><div id="39323189" class="c"><input type="checkbox" id="c-39323189" checked=""/><div class="controls bullet"><span class="by">hooverd</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321491">parent</a><span>|</span><a href="#39321630">prev</a><span>|</span><a href="#39321896">next</a><span>|</span><label class="collapse" for="c-39323189">[-]</label><label class="expand" for="c-39323189">[1 more]</label></div><br/><div class="children"><div class="content">For what it&#x27;s worth, I&#x27;ve always had an easier time combining WET code than untangling the knot than is too DRY code. Too little abstraction and you might have to read some extra code to understand it. Too much abstraction and no one other than the writer, and even then, may ever understand it.</div><br/></div></div></div></div></div></div><div id="39321896" class="c"><input type="checkbox" id="c-39321896" checked=""/><div class="controls bullet"><span class="by">taberiand</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320842">parent</a><span>|</span><a href="#39321435">prev</a><span>|</span><a href="#39324391">next</a><span>|</span><label class="collapse" for="c-39321896">[-]</label><label class="expand" for="c-39321896">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a mistake many junior devs (and sometimes mid and senior devs) make where they confuse hiding complexity with simplicity - using a string instead of a well defined domain type is a good example, there is a certain complexity of the domain expressed by the type that they don&#x27;t want to think about too deeply so they replace with a string which superficially looks simpler but in fact hides all of the inherent complexity and nuance.<p>It causes what I call the lumpy carpet syndrome - sweeping the complexity under the carpet causes bumps to randomly appear that when squashed tend to cause other bumps to pop up rather than actually solving the problem.</div><br/></div></div></div></div><div id="39324391" class="c"><input type="checkbox" id="c-39324391" checked=""/><div class="controls bullet"><span class="by">otabdeveloper4</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320842">prev</a><span>|</span><a href="#39323840">next</a><span>|</span><label class="collapse" for="c-39324391">[-]</label><label class="expand" for="c-39324391">[1 more]</label></div><br/><div class="children"><div class="content">&gt; you have to remember to call the validator on 100% of code paths<p>But copy-pasting the same lines of code in literally <i>every</i> function is the Golang Way.<p>It makes code &quot;simpler&quot;.</div><br/></div></div><div id="39323840" class="c"><input type="checkbox" id="c-39323840" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39324391">prev</a><span>|</span><a href="#39323926">next</a><span>|</span><label class="collapse" for="c-39323840">[-]</label><label class="expand" for="c-39323840">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>Parse, don&#x27;t validate (2019)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35053118">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35053118</a> - March 2023 (219 comments)<p><i>Parse, Don&#x27;t Validate (2019)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=27639890">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=27639890</a> - June 2021 (270 comments)<p><i>Parse, Donât Validate</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=21476261">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=21476261</a> - Nov 2019 (230 comments)<p><i>Parse, Don&#x27;t Validate</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=21471753">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=21471753</a> - Nov 2019 (4 comments)</div><br/></div></div><div id="39323926" class="c"><input type="checkbox" id="c-39323926" checked=""/><div class="controls bullet"><span class="by">kvnhn</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39323840">prev</a><span>|</span><a href="#39324027">next</a><span>|</span><label class="collapse" for="c-39323926">[-]</label><label class="expand" for="c-39323926">[1 more]</label></div><br/><div class="children"><div class="content">This is a variation on one of my favorite software design principles: Make illegal states unrepresentable. I first learned about it through Scott Wlaschin[1].<p>[1]: <a href="https:&#x2F;&#x2F;fsharpforfunandprofit.com&#x2F;posts&#x2F;designing-with-types-making-illegal-states-unrepresentable&#x2F;" rel="nofollow">https:&#x2F;&#x2F;fsharpforfunandprofit.com&#x2F;posts&#x2F;designing-with-types...</a></div><br/></div></div><div id="39324027" class="c"><input type="checkbox" id="c-39324027" checked=""/><div class="controls bullet"><span class="by">WuxiFingerHold</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39323926">prev</a><span>|</span><a href="#39321592">next</a><span>|</span><label class="collapse" for="c-39324027">[-]</label><label class="expand" for="c-39324027">[1 more]</label></div><br/><div class="children"><div class="content">So far I like the commonly used approach in the Typescript community best:<p>1. Create your Schema using <a href="https:&#x2F;&#x2F;zod.dev" rel="nofollow">https:&#x2F;&#x2F;zod.dev</a> or <a href="https:&#x2F;&#x2F;github.com&#x2F;sinclairzx81&#x2F;typebox">https:&#x2F;&#x2F;github.com&#x2F;sinclairzx81&#x2F;typebox</a> or one of the other many libs.<p>2. Generate your types from the schema. It&#x27;s very simple to create partial or composite types, e.g. UpdateModel, InsertModels, Arrays of them, etc.<p>3. Most modern Frameworks have first class support for validation, like Fastify (with typebox). Just reuse your schema definition.<p>That is very easy, obvious and effective.</div><br/></div></div><div id="39321592" class="c"><input type="checkbox" id="c-39321592" checked=""/><div class="controls bullet"><span class="by">the_gipsy</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39324027">prev</a><span>|</span><a href="#39322551">next</a><span>|</span><label class="collapse" for="c-39321592">[-]</label><label class="expand" for="c-39321592">[11 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not guaranteed at all, that&#x27;s where go&#x27;s zero-values come in. E.g. nested structs, un&#x2F;marshaljson magic methods etc. How do you deal with that?</div><br/><div id="39321855" class="c"><input type="checkbox" id="c-39321855" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321592">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39321855">[-]</label><label class="expand" for="c-39321855">[8 more]</label></div><br/><div class="children"><div class="content">Every struct requiring its zero value to be meaningful is probably one of the worst design flaws in the language.</div><br/><div id="39323009" class="c"><input type="checkbox" id="c-39323009" checked=""/><div class="controls bullet"><span class="by">ttymck</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321855">parent</a><span>|</span><a href="#39322262">next</a><span>|</span><label class="collapse" for="c-39323009">[-]</label><label class="expand" for="c-39323009">[1 more]</label></div><br/><div class="children"><div class="content">This is where we arrive at my conclusion that go is not well-suited to implementing business logic!</div><br/></div></div><div id="39322262" class="c"><input type="checkbox" id="c-39322262" checked=""/><div class="controls bullet"><span class="by">randomdata</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321855">parent</a><span>|</span><a href="#39323009">prev</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39322262">[-]</label><label class="expand" for="c-39322262">[6 more]</label></div><br/><div class="children"><div class="content">There is no such requirement. Common wisdom suggests that you should ensure zero values are useful, but that isn&#x27;t about every random struct field â <i>only the values you actually give others</i>. Initialize your struct fields and you won&#x27;t have to consider their zero state. They will never be zero.<p>It&#x27;s funny seeing this beside the DRY thread. Seems programmers taking things a bit too literally is a common theme.</div><br/><div id="39322328" class="c"><input type="checkbox" id="c-39322328" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322262">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39322328">[-]</label><label class="expand" for="c-39322328">[5 more]</label></div><br/><div class="children"><div class="content">&gt; Initialize your struct fields and you won&#x27;t have to consider their zero state.<p>âJust do the right thing everywhere and you donât have to worry!â<p>You canât stop consumers of your libraries from creating zero-valued instances.</div><br/><div id="39322374" class="c"><input type="checkbox" id="c-39322374" checked=""/><div class="controls bullet"><span class="by">randomdata</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322328">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39322374">[-]</label><label class="expand" for="c-39322374">[4 more]</label></div><br/><div class="children"><div class="content">Then the zero value is their problem, not yours. You have no reason to be worried about that any more than you are worried about them not getting enough sleep, or eating unhealthy food. What are you doing to stop them from doing that? Nothing, of course. Not your problem.<p>Coq exists if you really feel you need a complete type system. But there is probably good reason why almost nobody uses it.</div><br/><div id="39322782" class="c"><input type="checkbox" id="c-39322782" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322374">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39322782">[-]</label><label class="expand" for="c-39322782">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Then the zero value is their problem, not yours.<p>Except for all those times <i>you&#x27;re</i> the consumer of someone else&#x27;s library and there&#x27;s no way for them to indicate that creating a zero-valued struct is a bug.<p>Again, it&#x27;s the philosophy of &quot;Just do the right thing everywhere and you donât have to worry!&quot; Sometimes it&#x27;s nice to work with a type system where designers of libraries can actually prevent you from writing bugs.</div><br/><div id="39322951" class="c"><input type="checkbox" id="c-39322951" checked=""/><div class="controls bullet"><span class="by">randomdata</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322782">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39322951">[-]</label><label class="expand" for="c-39322951">[2 more]</label></div><br/><div class="children"><div class="content"><i>&gt; Except for all those times you&#x27;re the consumer of someone else&#x27;s library and there&#x27;s no way for them to indicate that creating a zero-valued struct is a bug.</i><p>Nonsense. Go has a built-in facility for documentation to communicate these things to other developers. Idiomatic Go <i>strongly</i> encourages you to use it. Consumers of the libraries expect it.<p><i>&gt; Sometimes it&#x27;s nice to work with a type system where designers of libraries can actually prevent you from writing bugs.</i><p>Well, sure. But, like I said, almost nobody uses Coq. The vast, vast, vast majority of projects â and I expect 100% of web projects â use languages with incomplete type systems, making what you seek impossible.<p>And there&#x27;s probably a good reason for that. While complete type systems sound nice in theory, practice isn&#x27;t so kind. There are tradeoffs abound. There is no free lunch in life. Sorry.</div><br/><div id="39323443" class="c"><input type="checkbox" id="c-39323443" checked=""/><div class="controls bullet"><span class="by">owl57</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322951">parent</a><span>|</span><a href="#39322632">next</a><span>|</span><label class="collapse" for="c-39323443">[-]</label><label class="expand" for="c-39323443">[1 more]</label></div><br/><div class="children"><div class="content"><i>&gt; The vast, vast, vast majority of projects â and I expect 100% of web projects â use languages with incomplete type systems, making what you seek impossible.</i><p>â¦where, &quot;what GP seeks&quot; isâ¦<p><i>&gt; way for [library authors] to indicate that creating a zero-valued struct is a bug</i><p>I&#x27;d say that&#x27;s a really low and practical bar, you really don&#x27;t need Coq for that. Good old Python is enough, even without linters and type hints.<p>Of course it&#x27;s very easy to create an equivalent of zero struct (object without __init__ called), but do you think it&#x27;s possible to do it while not noticing that you are doing something unusual?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="39322632" class="c"><input type="checkbox" id="c-39322632" checked=""/><div class="controls bullet"><span class="by">bsdpufferfish</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321592">parent</a><span>|</span><a href="#39321855">prev</a><span>|</span><a href="#39322551">next</a><span>|</span><label class="collapse" for="c-39322632">[-]</label><label class="expand" for="c-39322632">[2 more]</label></div><br/><div class="children"><div class="content">C++ constructors actually make the guarantee, but it comes with other pains</div><br/><div id="39324203" class="c"><input type="checkbox" id="c-39324203" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322632">parent</a><span>|</span><a href="#39322551">next</a><span>|</span><label class="collapse" for="c-39324203">[-]</label><label class="expand" for="c-39324203">[1 more]</label></div><br/><div class="children"><div class="content">Lots of languages handle it just fine and donât need the mess of C++ ctors.<p>GP is pointing out that go specifically makes it an issue.</div><br/></div></div></div></div></div></div><div id="39322551" class="c"><input type="checkbox" id="c-39322551" checked=""/><div class="controls bullet"><span class="by">zelphirkalt</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39321592">prev</a><span>|</span><a href="#39324540">next</a><span>|</span><label class="collapse" for="c-39322551">[-]</label><label class="expand" for="c-39322551">[6 more]</label></div><br/><div class="children"><div class="content">I always understood &quot;parse don&#x27;t validate&quot; a bit differently. If you are doing the validation inside of a constructor, you are still doing validation instead of parsing. It is safer to do the validation in one place you know the execution will go through, of course, but not the idea I understand &quot;parse don&#x27;t validate&quot; to mean. I understand it to mean: &quot;write an actual parser, whatever passes the parser can be used in the rest of the program&quot;, where a parser is a set of grammar rules for example, or PEG.</div><br/><div id="39322683" class="c"><input type="checkbox" id="c-39322683" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322551">parent</a><span>|</span><a href="#39324540">next</a><span>|</span><label class="collapse" for="c-39322683">[-]</label><label class="expand" for="c-39322683">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not a Haskell developer, so it&#x27;s possible that I misunderstood the original &quot;Parse, Don&#x27;t Validate&quot; post.<p>&gt;<i>If you are doing the validation inside of a constructor, you are still doing validation instead of parsing.</i><p>Why that would be considered validation rather than parsing?<p>From the original post:<p>&gt;<i>Consider: what is a parser? Really, a parser is just a function that consumes less-structured input and produces more-structured output.</i><p>That&#x27;s the key idea to me.<p>A parser enforces checks on an input and produces an output. And if you define an output type that&#x27;s distinct from the input type, you allow the type system &quot;preserve&quot; the fact that the data passed a parser at some point in its life.<p>But again, I don&#x27;t know Haskell, so I&#x27;m interested to know if I&#x27;m misunderstanding Lexi Lambda&#x27;s post.</div><br/><div id="39323003" class="c"><input type="checkbox" id="c-39323003" checked=""/><div class="controls bullet"><span class="by">kevincox</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322683">parent</a><span>|</span><a href="#39324540">next</a><span>|</span><label class="collapse" for="c-39323003">[-]</label><label class="expand" for="c-39323003">[4 more]</label></div><br/><div class="children"><div class="content">Parse don&#x27;t validate means that if you want a function that converts an IP address string to a struct IpAddress{ address: string } you don&#x27;t validate that the input string is a valid IP address then return a struct with that string inside. Instead you parse that IP into raw integers, then join those back into an IP string.<p>The idea is that your parsed representation and serializer are likely produce a much smaller and more predictable set of values than may pass the validator.<p>As an example there was a network control plane outage in GCP because the Java frontend validated an IP address then stored it (as a string) in the database. The C++ network control plane then crashed because the IP address actually contained non-ASCII &quot;digits&quot; that Java with its Unicode support accepted.<p>If instead the address was parsed into 4 or 8 integers and was reserialized before being written to the DB this outage wouldn&#x27;t have happened. The parsing was still probably more lax than it should have been, but at least the value written to the DB was valid.<p>In this case it was funny Unicode, but it could be as simple as 1.2.3.04 vs 1.2.3.4. By parsing then re-serializing you are going to produce the more canonical and expected form.</div><br/><div id="39323068" class="c"><input type="checkbox" id="c-39323068" checked=""/><div class="controls bullet"><span class="by">xyzzy_plugh</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323003">parent</a><span>|</span><a href="#39323094">next</a><span>|</span><label class="collapse" for="c-39323068">[-]</label><label class="expand" for="c-39323068">[1 more]</label></div><br/><div class="children"><div class="content">Perhaps &quot;normalize&quot; or &quot;canonicalize&quot; is more appropriate. A parser can liberally interpret but I don&#x27;t take it to imply some destructured form necessarily. There are countless scenarios where you want to be able to reproduce the exact input, and often preserving the input is the simplest solution.<p>But yes usually you do want to split something into it&#x27;s elemental components, should it have any.</div><br/></div></div><div id="39323094" class="c"><input type="checkbox" id="c-39323094" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323003">parent</a><span>|</span><a href="#39323068">prev</a><span>|</span><a href="#39324540">next</a><span>|</span><label class="collapse" for="c-39323094">[-]</label><label class="expand" for="c-39323094">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for that explanation! I hadn&#x27;t appreciated that aspect of &quot;parse, don&#x27;t validate,&quot; before.<p>But even with that understanding and from re-reading the post, that seems to be an extra safety measure rather than the essence of the idea.<p>Going back to my original example of parsing a Username and verifying that it doesn&#x27;t contain any illegal characters, how does a parser convert a string into a more direct representation of a username without using a string internally? Or if you&#x27;re parsing an uint8 into a type that logically must be between 1 and 100, what&#x27;s the internal type that you parse it into that isn&#x27;t a uint8?</div><br/><div id="39323480" class="c"><input type="checkbox" id="c-39323480" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323094">parent</a><span>|</span><a href="#39324540">next</a><span>|</span><label class="collapse" for="c-39323480">[-]</label><label class="expand" for="c-39323480">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Or if you&#x27;re parsing an uint8 into a type that logically must be between 1 and 100, what&#x27;s the internal type that you parse it into that isn&#x27;t a uint8?<p>Just for the sake of example, your internal representation might start from 0, and you just add 1 whenever you output it.<p>Your internal type might also not be a uint8.  Eg in Python you would probably just use their default type for integers, which supports arbitrarily big numbers.  (Not because you need arbitrarily big numbers, but just because that&#x27;s the default.)</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39324540" class="c"><input type="checkbox" id="c-39324540" checked=""/><div class="controls bullet"><span class="by">HeavyStorm</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39322551">prev</a><span>|</span><a href="#39322391">next</a><span>|</span><label class="collapse" for="c-39324540">[-]</label><label class="expand" for="c-39324540">[1 more]</label></div><br/><div class="children"><div class="content">Encapsulation saves lives.</div><br/></div></div><div id="39322391" class="c"><input type="checkbox" id="c-39322391" checked=""/><div class="controls bullet"><span class="by">edflsafoiewq</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39324540">prev</a><span>|</span><a href="#39321311">next</a><span>|</span><label class="collapse" for="c-39322391">[-]</label><label class="expand" for="c-39322391">[5 more]</label></div><br/><div class="children"><div class="content">You can use new types with validation too. In fact the approaches seem to be duals.<p>Parse, don&#x27;t validate:<p><pre><code>                    string          ParsedString
  untrusted source -------&gt; parse --------------&gt; rest of system
</code></pre>
Validate, don&#x27;t parse:<p><pre><code>                    UnvalidatedString            string
  untrusted source ------------------&gt; validate -------&gt; rest of system</code></pre></div><br/><div id="39322646" class="c"><input type="checkbox" id="c-39322646" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322391">parent</a><span>|</span><a href="#39321311">next</a><span>|</span><label class="collapse" for="c-39322646">[-]</label><label class="expand" for="c-39322646">[4 more]</label></div><br/><div class="children"><div class="content">The problem is that pattern &quot;fails open.&quot; If anyone on the team forgets to define an untrusted string as UnvalidatedString, the data skips validation.<p>If you default to treating primitive types as untrusted, it&#x27;s hard for someone to accidentally convert an untrusted type to a trusted type without using the correct parse method.</div><br/><div id="39322924" class="c"><input type="checkbox" id="c-39322924" checked=""/><div class="controls bullet"><span class="by">edflsafoiewq</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322646">parent</a><span>|</span><a href="#39321311">next</a><span>|</span><label class="collapse" for="c-39322924">[-]</label><label class="expand" for="c-39322924">[3 more]</label></div><br/><div class="children"><div class="content">The dual problem would be any function which forgets to accept a ParsedString instead of a string can skip parsing.<p>Both cases appear to depend on there being a &quot;checkpoint&quot; all data must go through to cross over to the rest of the system, either at parsing or at UnvalidatedString construction.</div><br/><div id="39323314" class="c"><input type="checkbox" id="c-39323314" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322924">parent</a><span>|</span><a href="#39321311">next</a><span>|</span><label class="collapse" for="c-39323314">[-]</label><label class="expand" for="c-39323314">[2 more]</label></div><br/><div class="children"><div class="content">&gt;<i>The dual problem would be any function which forgets to accept a ParsedString instead of a string can skip parsing.</i><p>&gt;<i>Both cases appear to depend on there being a &quot;checkpoint&quot; all data must go through to cross over to the rest of the system, either at parsing or at UnvalidatedString construction.</i><p>The difference is that if string is the trusted type, then it&#x27;s easy to miss a spot and use the trusted string type for an untrusted value. The mistake will be subtle because the rest of your app uses a string type as well.<p>The converse is not true. If string is an untrusted type and ParsedString is a trusted type, if you miss a spot and forget to convert an untrusted string into a ParsedString, that function can&#x27;t interact with any other part of your codebase that expects a ParsedString. The error would be much more visible and the damage more contained.<p>I think UnvalidatedString -&gt; string also kind of misses the point of the type system in general. To parse a string into some other type, you&#x27;re asserting something about the value it stores. It&#x27;s not just a string with a blessing that says it&#x27;s okay. It&#x27;s a subset of the string type that can contain a more limited set of values than the built-in string type.<p>For example, parsing a string into a Username, I&#x27;m asserting things about the string (e.g., it&#x27;s &lt;10 characters long, it contains only a-z0-9). If I just use the string type, that&#x27;s not an accurate representation of what&#x27;s legal for a Username because the string type implies any legal string is a valid value.</div><br/><div id="39323594" class="c"><input type="checkbox" id="c-39323594" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323314">parent</a><span>|</span><a href="#39321311">next</a><span>|</span><label class="collapse" for="c-39323594">[-]</label><label class="expand" for="c-39323594">[1 more]</label></div><br/><div class="children"><div class="content">The example also assumes that everything is like a &#x27;ParsedString&#x27; that contains a copy of the original untrusted value inside.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39321311" class="c"><input type="checkbox" id="c-39321311" checked=""/><div class="controls bullet"><span class="by">Scarblac</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39322391">prev</a><span>|</span><a href="#39321283">next</a><span>|</span><label class="collapse" for="c-39321311">[-]</label><label class="expand" for="c-39321311">[4 more]</label></div><br/><div class="children"><div class="content">&gt; and a human-readable explanation of the issue is set as the value.<p>This is annoying to translate later. At least also include some error code string that is documented somewhere and isn&#x27;t prone to change randomly.</div><br/><div id="39321346" class="c"><input type="checkbox" id="c-39321346" checked=""/><div class="controls bullet"><span class="by">klodolph</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321311">parent</a><span>|</span><a href="#39321283">next</a><span>|</span><label class="collapse" for="c-39321346">[-]</label><label class="expand" for="c-39321346">[3 more]</label></div><br/><div class="children"><div class="content">I mean, you may end up just wanting something like,<p><pre><code>    type UsernameError struct {
      name   string
      reason string
    }
    func (e *UsernameError) Error() string { 
      return fmt.Errorf(&quot;invalid username %q: %s&quot;, e.name, e.reason)
    }
</code></pre>
And reason can be &quot;username cannot be empty&quot; or &quot;username may not contain &#x27;&lt;&#x27;&quot; or something like that.<p>This is fine for lots of different cases, because itâs likely that your code wants to know how to handle âusername is invalidâ, but only humans care about <i>why</i>.<p>I have personally never seen a Go codebase where you parse error strings. I know that people keep complaining about it so it must be happening out thereâbut every codebase Iâve worked with either has error constants (an exported var set to some errors.New() value) or some kind of custom error type you can check. Or if it doesnât have those things, I had no interest in parsing the errors.</div><br/><div id="39321458" class="c"><input type="checkbox" id="c-39321458" checked=""/><div class="controls bullet"><span class="by">Scarblac</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321346">parent</a><span>|</span><a href="#39321283">next</a><span>|</span><label class="collapse" for="c-39321458">[-]</label><label class="expand" for="c-39321458">[2 more]</label></div><br/><div class="children"><div class="content">I write mostly frontends. Sometimes the APIs I talk to give back beautiful English error messages - that I can&#x27;t just show to the user, because they are using a different language most of the time. And I don&#x27;t want to write logic that depends on that sentence, far too brittle.</div><br/><div id="39321579" class="c"><input type="checkbox" id="c-39321579" checked=""/><div class="controls bullet"><span class="by">klodolph</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321458">parent</a><span>|</span><a href="#39321283">next</a><span>|</span><label class="collapse" for="c-39321579">[-]</label><label class="expand" for="c-39321579">[1 more]</label></div><br/><div class="children"><div class="content">RightâI think the âerror codeâ here is going to be the error type, i.e., UsernameError, or some qualified version of that.<p>Itâs not perfect, but software evolves through many imperfect stages as it gets better, and this is one such imperfect stage that your software may evolve through.<p>Including a human-readable version of the error is useful because the developers &#x2F; operators will want to read through the logs for it. Sometimes that is where you stop, because not all errors from all backends will need to be localized.</div><br/></div></div></div></div></div></div></div></div><div id="39321283" class="c"><input type="checkbox" id="c-39321283" checked=""/><div class="controls bullet"><span class="by">costco</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39321311">prev</a><span>|</span><a href="#39322351">next</a><span>|</span><label class="collapse" for="c-39321283">[-]</label><label class="expand" for="c-39321283">[4 more]</label></div><br/><div class="children"><div class="content">Just do<p><pre><code>    type Username string
</code></pre>
And replace<p><pre><code>      return Username{username}
</code></pre>
with<p><pre><code>      return Username(username)</code></pre></div><br/><div id="39321398" class="c"><input type="checkbox" id="c-39321398" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321283">parent</a><span>|</span><a href="#39321388">next</a><span>|</span><label class="collapse" for="c-39321398">[-]</label><label class="expand" for="c-39321398">[2 more]</label></div><br/><div class="children"><div class="content">The problem there is that you lose the guarantee that the parser validated the string value.<p>A caller can just say:<p><pre><code>    &#x2F;&#x2F; This is returning an error for some reason, so let&#x27;s do it directly.
    &#x2F;&#x2F; username, err := parsers.NewUsername(raw)
    username := parsers.Username(raw)
</code></pre>
You also get implicit conversions in ways you probably don&#x27;t want:<p><pre><code>    var u Username
    u = &quot;&lt;hello&gt;&quot; &#x2F;&#x2F; Implicitly converts from string to Username</code></pre></div><br/><div id="39321449" class="c"><input type="checkbox" id="c-39321449" checked=""/><div class="controls bullet"><span class="by">costco</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321398">parent</a><span>|</span><a href="#39321388">next</a><span>|</span><label class="collapse" for="c-39321449">[-]</label><label class="expand" for="c-39321449">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s true I did not think of that.</div><br/></div></div></div></div><div id="39321388" class="c"><input type="checkbox" id="c-39321388" checked=""/><div class="controls bullet"><span class="by">daveFNbuck</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321283">parent</a><span>|</span><a href="#39321398">prev</a><span>|</span><a href="#39322351">next</a><span>|</span><label class="collapse" for="c-39321388">[-]</label><label class="expand" for="c-39321388">[1 more]</label></div><br/><div class="children"><div class="content">If you do that, people outside the package can also do Username(x) conversions instead of calling NewUsername. Making value package private means that you can only set it from outside the package using provided functionality.</div><br/></div></div></div></div><div id="39322351" class="c"><input type="checkbox" id="c-39322351" checked=""/><div class="controls bullet"><span class="by">whimsicalism</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39321283">prev</a><span>|</span><a href="#39321923">next</a><span>|</span><label class="collapse" for="c-39322351">[-]</label><label class="expand" for="c-39322351">[1 more]</label></div><br/><div class="children"><div class="content">the fact that this is some special âtechniqueâ really shows how far behind Goâs type system &amp; community around typing is</div><br/></div></div><div id="39321923" class="c"><input type="checkbox" id="c-39321923" checked=""/><div class="controls bullet"><span class="by">swah</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39322351">prev</a><span>|</span><a href="#39320947">next</a><span>|</span><label class="collapse" for="c-39321923">[-]</label><label class="expand" for="c-39321923">[2 more]</label></div><br/><div class="children"><div class="content">My Go is rusty, do you mean not exporting the type &quot;Username&quot; (ie username) to avoid default constructor usage?</div><br/><div id="39322626" class="c"><input type="checkbox" id="c-39322626" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321923">parent</a><span>|</span><a href="#39320947">next</a><span>|</span><label class="collapse" for="c-39322626">[-]</label><label class="expand" for="c-39322626">[1 more]</label></div><br/><div class="children"><div class="content">In Go, capitalized identifiers are exported, whereas lowercase identifiers are not.<p>In the example I gave above, clients outside of the package can instantiate Username, but they can&#x27;t access its &quot;value&quot; member, so the only way they could get a populated Username instance is by calling NewUsername.</div><br/></div></div></div></div><div id="39320947" class="c"><input type="checkbox" id="c-39320947" checked=""/><div class="controls bullet"><span class="by">3pm</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39321923">prev</a><span>|</span><a href="#39320781">next</a><span>|</span><label class="collapse" for="c-39320947">[-]</label><label class="expand" for="c-39320947">[1 more]</label></div><br/><div class="children"><div class="content">AKA &#x27;Value Object&#x27; from DDD or a similar &#x27;Quantity&#x27; accounting pattern. Another angle is that this fixes &#x27;Primitive Obsession&#x27; code smell.</div><br/></div></div><div id="39320781" class="c"><input type="checkbox" id="c-39320781" checked=""/><div class="controls bullet"><span class="by">asp_hornet</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320947">prev</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39320781">[-]</label><label class="expand" for="c-39320781">[9 more]</label></div><br/><div class="children"><div class="content">Now what? the username is in an unexported field and unusable? I can kind of see what its going for but it seems like a way just to add another layer of wrapping and indirection.</div><br/><div id="39320839" class="c"><input type="checkbox" id="c-39320839" checked=""/><div class="controls bullet"><span class="by">pants2</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320781">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39320839">[-]</label><label class="expand" for="c-39320839">[8 more]</label></div><br/><div class="children"><div class="content">It would need a getter here. Probably good to keep it immutable, if you want guarantees that it will never be changed to something that violates the username rules.</div><br/><div id="39321419" class="c"><input type="checkbox" id="c-39321419" checked=""/><div class="controls bullet"><span class="by">asp_hornet</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39320839">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39321419">[-]</label><label class="expand" for="c-39321419">[7 more]</label></div><br/><div class="children"><div class="content">&gt; need a getter<p>Yeah, thats what I figured. Im not sure if I want the tradeoff of calling .GetValue in multiple places just to save calling validate in maybe 2 or 3 places.<p>Not to mention I cant easily marshal&#x2F;unmarshal into it and next week valid username is a username that doesnt already exist in the database.<p>Maybe this approach appeals to people and Im hesitant to say âthatâs not how Go is supposed to be writtenâ but for me this feels like âclever over clearâ.</div><br/><div id="39321648" class="c"><input type="checkbox" id="c-39321648" checked=""/><div class="controls bullet"><span class="by">klodolph</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321419">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39321648">[-]</label><label class="expand" for="c-39321648">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Yeah, thats what I figured. Im not sure if I want the tradeoff of calling .GetValue in multiple places just to save calling validate in maybe 2 or 3 places.<p>The tradeoff is not that you save calling validate, itâs that you avoid <i>forgetting</i> to call validate in the first place, because when you forget to validate, you get a type error.<p>IMO itâs a little more clear this way:<p><pre><code>    type Ticket struct {
      requestor Username
      assignee  Username
    }
</code></pre>
It lets you write code that is little more obvious.</div><br/><div id="39321830" class="c"><input type="checkbox" id="c-39321830" checked=""/><div class="controls bullet"><span class="by">asp_hornet</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321648">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39321830">[-]</label><label class="expand" for="c-39321830">[5 more]</label></div><br/><div class="children"><div class="content">Iâm not sure I understand. In your example youâve grouped related data in a struct and validating that it matches your systemâs invariants, that feels good to me.<p>The original example was more âwrap a simple type in an object so itâs always validated when setâ which looks beautiful when you donât have the needed getters in the example nor show all the Get call sites opposed to the 1 or 2 New call sites. All in the name of âwe donât want to set the username without validationâ but without private constructors Username{âinvalidâ} can be invoked, the validation circumvented and Iâm not convinced the overhead we paid was worth it.</div><br/><div id="39322146" class="c"><input type="checkbox" id="c-39322146" checked=""/><div class="controls bullet"><span class="by">Sakos</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39321830">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39322146">[-]</label><label class="expand" for="c-39322146">[4 more]</label></div><br/><div class="children"><div class="content">The countless bugs I&#x27;ve had to deal with and all the time I&#x27;ve lost fixing these bugs caused by people who forgot to validate data in a certain place or didn&#x27;t realize they had to do so proves to me that the overhead of calling a get on a wrapper type is totally worth it.<p>I value the hours wasted on diagnosing a bug far more than the extra keystrokes and couple of seconds required to avoid it in the first place.</div><br/><div id="39323159" class="c"><input type="checkbox" id="c-39323159" checked=""/><div class="controls bullet"><span class="by">asp_hornet</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322146">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39323159">[-]</label><label class="expand" for="c-39323159">[3 more]</label></div><br/><div class="children"><div class="content">No, youâve achieved an illusion of that as now your spending hours wasted on discovering where a developer forgot to call NewUsername and instead called Username{âbrokenâ}. I cant see the value in this abstraction in Go.</div><br/><div id="39323365" class="c"><input type="checkbox" id="c-39323365" checked=""/><div class="controls bullet"><span class="by">iampims</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323159">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39323365">[-]</label><label class="expand" for="c-39323365">[2 more]</label></div><br/><div class="children"><div class="content">They canât because value is not exported. They must use the NewUsername function, which forces the validation.<p>In my opinion, this pattern breaks when the validation must return an error and everything becomes very verbose.</div><br/><div id="39323498" class="c"><input type="checkbox" id="c-39323498" checked=""/><div class="controls bullet"><span class="by">asp_hornet</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39323365">parent</a><span>|</span><a href="#39322671">next</a><span>|</span><label class="collapse" for="c-39323498">[-]</label><label class="expand" for="c-39323498">[1 more]</label></div><br/><div class="children"><div class="content">Oh, thats true about it being unexported. I hadnât considered that.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="39322671" class="c"><input type="checkbox" id="c-39322671" checked=""/><div class="controls bullet"><span class="by">tdeck</span><span>|</span><a href="#39320344">parent</a><span>|</span><a href="#39320781">prev</a><span>|</span><a href="#39320339">next</a><span>|</span><label class="collapse" for="c-39322671">[-]</label><label class="expand" for="c-39322671">[2 more]</label></div><br/><div class="children"><div class="content">But surely this is just another way of doing validation and not fundamentally &quot;parsing&quot;? If at the end you&#x27;ve just stored the input exactly as you got it, the only parsing you&#x27;re potentially doing is in the validation step and then it gets thrown away.</div><br/><div id="39322912" class="c"><input type="checkbox" id="c-39322912" checked=""/><div class="controls bullet"><span class="by">ezrast</span><span>|</span><a href="#39320344">root</a><span>|</span><a href="#39322671">parent</a><span>|</span><a href="#39320339">next</a><span>|</span><label class="collapse" for="c-39322912">[-]</label><label class="expand" for="c-39322912">[1 more]</label></div><br/><div class="children"><div class="content">Implementation-wise, yes, but the interface you&#x27;re exposing is indistinguishable from that of a parser. For all your consumers know, you could be storing the username as a sequence of a 254-valued enum (one for each byte, except the angle brackets) and reconstructing the string on each &quot;get&quot; call. For more complex data you would certainly be storing it piecewise; the only reasons this example gets a pass are 1) because it is so low in surface area that a human can reasonably validate the implementation as bug-free without further aid from the type checker, and 2) because Go&#x27;s type system is so inexpressive that you can&#x27;t encode complex requirements with it anyway.</div><br/></div></div></div></div></div></div><div id="39320339" class="c"><input type="checkbox" id="c-39320339" checked=""/><div class="controls bullet"><span class="by">zemo</span><span>|</span><a href="#39320344">prev</a><span>|</span><a href="#39320170">next</a><span>|</span><label class="collapse" for="c-39320339">[-]</label><label class="expand" for="c-39320339">[8 more]</label></div><br/><div class="children"><div class="content">&gt; func NewServer(... config *Config ...) http.Handler<p>one of my biggest pet peeves is when people take a Config object, which represents the configuration of an entire system, and pass it around mutably. When you do that, you&#x27;re coupling everything together through the config object.  I&#x27;ve worked on systems where you had to configure the parts in a specific order in order for things to work, because someone decided to write back to the config object when it was passed to them. Or another case was where I&#x27;ve seen it such that you couldn&#x27;t disable a portion of the system because it wrote data into the config object that was read by some other subsystem later. The pattern of &quot;your configuration is one big value, which is mutable&quot; is one of the more annoying patterns that I&#x27;ve seen before, both in Go and in other languages.</div><br/><div id="39320441" class="c"><input type="checkbox" id="c-39320441" checked=""/><div class="controls bullet"><span class="by">tejinderss</span><span>|</span><a href="#39320339">parent</a><span>|</span><a href="#39321420">next</a><span>|</span><label class="collapse" for="c-39320441">[-]</label><label class="expand" for="c-39320441">[1 more]</label></div><br/><div class="children"><div class="content">The keyword here is âmutableâ config object and not config data object in general. I use immutable config dataclass liberally in one of my python projects and i pass it around in all modules. Many functions rely on multiple values and instead of passing all of them as function parameters (which requires their own function typings), the dataclass has all variables with typing definitions in one place, its pretty handy design pattern.</div><br/></div></div><div id="39321420" class="c"><input type="checkbox" id="c-39321420" checked=""/><div class="controls bullet"><span class="by">MrDarcy</span><span>|</span><a href="#39320339">parent</a><span>|</span><a href="#39320441">prev</a><span>|</span><a href="#39320932">next</a><span>|</span><label class="collapse" for="c-39321420">[-]</label><label class="expand" for="c-39321420">[1 more]</label></div><br/><div class="children"><div class="content">My favorite way to prevent this is to make the config truly immutable, but still configurable with something like this:<p><pre><code>  package config

  type options struct {
    name string
  }

  type Option func(o *options)

  func Name(name string) Option {
    return func(o *options) {
      o.name = name
    }
  }

  type Config struct {
    opts *options
  }

  func New(opts ...Option) *Config {
    o := &amp;options{}
    for _, option := range opts {
      option(o)
    }
    return &amp;Config{opts: o}
  }

  func (c *Config) Name() string {
    return c.opts.name
  }
</code></pre>
Use it with:<p><pre><code>  cfg := config.New(config.Name(&quot;Emanon&quot;))
  fmt.Println(cfg.Name())</code></pre></div><br/></div></div><div id="39320932" class="c"><input type="checkbox" id="c-39320932" checked=""/><div class="controls bullet"><span class="by">fnordlord</span><span>|</span><a href="#39320339">parent</a><span>|</span><a href="#39321420">prev</a><span>|</span><a href="#39320357">next</a><span>|</span><label class="collapse" for="c-39320932">[-]</label><label class="expand" for="c-39320932">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve tended to create a Config struct for each package and then a configs.Config struct that&#x27;s just made up of each package&#x27;s Config.  It might not be a Go best practice but I like that I can setup the entire system&#x27;s configuration on startup as one entity but then I only pass in the minimally required dependencies for each package.
It also makes testing a little easier because I don&#x27;t have to fake out the entire configuration for testing one package.</div><br/></div></div><div id="39320357" class="c"><input type="checkbox" id="c-39320357" checked=""/><div class="controls bullet"><span class="by">doh</span><span>|</span><a href="#39320339">parent</a><span>|</span><a href="#39320932">prev</a><span>|</span><a href="#39320685">next</a><span>|</span><label class="collapse" for="c-39320357">[-]</label><label class="expand" for="c-39320357">[3 more]</label></div><br/><div class="children"><div class="content">I think that&#x27;s a valid criticism. What do you think would be a more ergonomic pattern?</div><br/><div id="39320425" class="c"><input type="checkbox" id="c-39320425" checked=""/><div class="controls bullet"><span class="by">Raynos</span><span>|</span><a href="#39320339">root</a><span>|</span><a href="#39320357">parent</a><span>|</span><a href="#39320685">next</a><span>|</span><label class="collapse" for="c-39320425">[-]</label><label class="expand" for="c-39320425">[2 more]</label></div><br/><div class="children"><div class="content">I wrote a static config class that reads configuration for the entire app &#x2F; server from a JSON or YAML file ( <a href="https:&#x2F;&#x2F;github.com&#x2F;uber&#x2F;zanzibar&#x2F;blob&#x2F;master&#x2F;runtime&#x2F;static_config.go">https:&#x2F;&#x2F;github.com&#x2F;uber&#x2F;zanzibar&#x2F;blob&#x2F;master&#x2F;runtime&#x2F;static_...</a> ).<p>Once you&#x27;ve loaded it and mutated it for testing purposes or for copying from ENV vars into the config, you can then freeze it before passing it down to all your app level code.<p>Having this wrapper object that can be frozen and has a `get()` method to read JSON like data make it effectively not mutable.</div><br/><div id="39320525" class="c"><input type="checkbox" id="c-39320525" checked=""/><div class="controls bullet"><span class="by">doh</span><span>|</span><a href="#39320339">root</a><span>|</span><a href="#39320425">parent</a><span>|</span><a href="#39320685">next</a><span>|</span><label class="collapse" for="c-39320525">[-]</label><label class="expand" for="c-39320525">[1 more]</label></div><br/><div class="children"><div class="content">I use similar pattern myself. Was curious if the OP is using some other, like for instance splitting the struct into two (im&#x2F;mutable) and then passing them around, or what.<p>BTW kudos on zanzibar. Love the tech and the code).</div><br/></div></div></div></div></div></div><div id="39320685" class="c"><input type="checkbox" id="c-39320685" checked=""/><div class="controls bullet"><span class="by">gloryjulio</span><span>|</span><a href="#39320339">parent</a><span>|</span><a href="#39320357">prev</a><span>|</span><a href="#39320170">next</a><span>|</span><label class="collapse" for="c-39320685">[-]</label><label class="expand" for="c-39320685">[1 more]</label></div><br/><div class="children"><div class="content">I agree. We ran into sev by changing the top level config object before. You DO NOT want to modify it. The wasted man hour is not worth. You will never know where or how it get used. If you make changes it&#x27;s better to derive from it instead.<p>Update:
What&#x27;s funny was, in our design the config object was kinda immutable. You have to use the WARNING_DO_NOT_USE api to make modification. We did mutate the object and we caused a sev</div><br/></div></div></div></div><div id="39320170" class="c"><input type="checkbox" id="c-39320170" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320339">prev</a><span>|</span><a href="#39320885">next</a><span>|</span><label class="collapse" for="c-39320170">[-]</label><label class="expand" for="c-39320170">[12 more]</label></div><br/><div class="children"><div class="content">I really like Mat Ryer&#x27;s work, and I&#x27;ve applied most of the ideas in the 2018 version of this article to all of my Go projects since then.<p>The one weak spot for me is this aspect:<p>&gt;<i>NewServer is a big constructor that takes in all dependencies as arguments... In test cases that donât need all of the dependencies, I pass in nil as a signal that it wonât be used.</i><p>This has always felt wrong to me, but I&#x27;ve never been able to figure out a better solution.<p>It means that a huge chunk of your code has a huge amount of unnecessary shared state.<p>I often end up writing HTTP handlers that only need access to a tiny amount of the shared state. Like the HTTP handler needs to check if the requesting user has access to a resource, and then it needs to call one function on the datastore.<p>I&#x27;d love to write tests where I only mock out those two methods, but I can&#x27;t write simple tests because the handler is part of this giant glob where it has access to <i>all</i> of the datastore and every object the parent server has access to because it&#x27;s all one giant object.<p>Nothing against Mat Ryer, as his pattern is the best I&#x27;ve found, but I still feel like there&#x27;s some better solution out there.</div><br/><div id="39320435" class="c"><input type="checkbox" id="c-39320435" checked=""/><div class="controls bullet"><span class="by">jxramos</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39320659">next</a><span>|</span><label class="collapse" for="c-39320435">[-]</label><label class="expand" for="c-39320435">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve become increasingly sensitive to these high afferent coupling points in the repos I work on, especially the deeper I embed into the world of bazel and how dependency management and physical design influence the code I author.<p>Where possible plugins are a great strategy to lay down these code seam points that don&#x27;t force all possibilities upon some body of code, because fundamentally with plugin architectures you pick and choose what you want. Plugins are opt out by default, you must explicitly opt into a plugin for it to manifest. I&#x27;ve been calling software that has this quality going as being an &quot;a la carte&quot; style.<p>But in general you do what you need to do to avoid &quot;doing everything so you can do anything&quot;.</div><br/></div></div><div id="39320659" class="c"><input type="checkbox" id="c-39320659" checked=""/><div class="controls bullet"><span class="by">vjerancrnjak</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39320435">prev</a><span>|</span><a href="#39324035">next</a><span>|</span><label class="collapse" for="c-39320659">[-]</label><label class="expand" for="c-39320659">[3 more]</label></div><br/><div class="children"><div class="content">It means the object created by NewServer is dealing with too much. Probably has too many data types coupled to it and too much behavior.<p>Simple example is adding a logger. If you add it as a dependency to the constructor, the object starts doing a bit more than initial simple implementation. It&#x27;s fine to do it, but shame to not figure out how to log without editing the implementation of a simple thing.<p>Higher order functions (a logger decorator) get there to allow composition, but even they have their drawbacks.<p>It&#x27;s still some form of structure that you can deal with, not a mistake.</div><br/><div id="39321939" class="c"><input type="checkbox" id="c-39321939" checked=""/><div class="controls bullet"><span class="by">taberiand</span><span>|</span><a href="#39320170">root</a><span>|</span><a href="#39320659">parent</a><span>|</span><a href="#39321137">next</a><span>|</span><label class="collapse" for="c-39321939">[-]</label><label class="expand" for="c-39321939">[1 more]</label></div><br/><div class="children"><div class="content">As you say, having a logger attached is one of those pragmatic and acceptable exceptions to the rule. In a perfect world we&#x27;d have the time to go to the trouble of implementing loggable types and data flows and associated higher order functions, in practice taking the compromise means getting the real business valuable work completed while still having the necessary (but usually &quot;low priority&quot;) non-functional requirements like logging and metrics implemented.</div><br/></div></div><div id="39321137" class="c"><input type="checkbox" id="c-39321137" checked=""/><div class="controls bullet"><span class="by">oogali</span><span>|</span><a href="#39320170">root</a><span>|</span><a href="#39320659">parent</a><span>|</span><a href="#39321939">prev</a><span>|</span><a href="#39324035">next</a><span>|</span><label class="collapse" for="c-39321137">[-]</label><label class="expand" for="c-39321137">[1 more]</label></div><br/><div class="children"><div class="content">I agree that too many arguments to the constructor may have the smell of too much coupling.<p>But if I really feel I can&#x27;t avoid the need to pass a good amount of external context, I create a dedicated &quot;options&quot; struct and pass that into the constructor as a pointer. The purpose of the pointer (rather than pass by value) is if I want default arguments, I can pass nil.<p><pre><code>    type ServerOptions struct {
        logger    *magic.Logger
        secretKey string
    }

    func NewServer(options *ServerOptions) (*Server, error) {
        ...
    }</code></pre></div><br/></div></div></div></div><div id="39324035" class="c"><input type="checkbox" id="c-39324035" checked=""/><div class="controls bullet"><span class="by">qaq</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39320659">prev</a><span>|</span><a href="#39321358">next</a><span>|</span><label class="collapse" for="c-39324035">[-]</label><label class="expand" for="c-39324035">[1 more]</label></div><br/><div class="children"><div class="content">You can use Dependency Injection to solve this issue but in my view the added complexity is not really worth it.</div><br/></div></div><div id="39320552" class="c"><input type="checkbox" id="c-39320552" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39321358">prev</a><span>|</span><a href="#39321609">next</a><span>|</span><label class="collapse" for="c-39320552">[-]</label><label class="expand" for="c-39320552">[1 more]</label></div><br/><div class="children"><div class="content">I tend to write most of my logic in packages... so a &quot;users&quot; package or a &quot;comments&quot; package (if we were building HN). These have NO http interface! They do however each have their own &quot;main&quot; and some sort of CLI interface: &quot;&#x2F;&#x2F;go:build ignore&quot; in the comment of that file is your friend.</div><br/></div></div><div id="39321609" class="c"><input type="checkbox" id="c-39321609" checked=""/><div class="controls bullet"><span class="by">hayst4ck</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39320552">prev</a><span>|</span><a href="#39321448">next</a><span>|</span><label class="collapse" for="c-39321609">[-]</label><label class="expand" for="c-39321609">[2 more]</label></div><br/><div class="children"><div class="content">&gt; It means that a huge chunk of your code has a huge amount of unnecessary shared state.<p>Can you explain that a little more?<p>Which chunk of code has what shared state, and why is it unnecessary?</div><br/><div id="39321766" class="c"><input type="checkbox" id="c-39321766" checked=""/><div class="controls bullet"><span class="by">strawhatguy</span><span>|</span><a href="#39320170">root</a><span>|</span><a href="#39321609">parent</a><span>|</span><a href="#39321448">next</a><span>|</span><label class="collapse" for="c-39321766">[-]</label><label class="expand" for="c-39321766">[1 more]</label></div><br/><div class="children"><div class="content">Basically, not all the handlers will use every dependency the server (which is the entire program in this pattern) has. Not every handler will use a database, for example.<p>While I may prefer a struct for this instead of separate arguments, I do agree it&#x27;s useful to capture &quot;the world&quot; as the set of all dependencies, even if some handlers don&#x27;t use them (<i>yet</i>).</div><br/></div></div></div></div><div id="39321448" class="c"><input type="checkbox" id="c-39321448" checked=""/><div class="controls bullet"><span class="by">j1elo</span><span>|</span><a href="#39320170">parent</a><span>|</span><a href="#39321609">prev</a><span>|</span><a href="#39320401">next</a><span>|</span><label class="collapse" for="c-39321448">[-]</label><label class="expand" for="c-39321448">[1 more]</label></div><br/><div class="children"><div class="content">I think a useful iteration of that pattern is one called <i>Functional Options</i>:<p>* <a href="https:&#x2F;&#x2F;dave.cheney.net&#x2F;2014&#x2F;10&#x2F;17&#x2F;functional-options-for-friendly-apis" rel="nofollow">https:&#x2F;&#x2F;dave.cheney.net&#x2F;2014&#x2F;10&#x2F;17&#x2F;functional-options-for-fr...</a><p>* <a href="https:&#x2F;&#x2F;github.com&#x2F;uber-go&#x2F;guide&#x2F;blob&#x2F;master&#x2F;style.md#functional-options">https:&#x2F;&#x2F;github.com&#x2F;uber-go&#x2F;guide&#x2F;blob&#x2F;master&#x2F;style.md#functi...</a></div><br/></div></div></div></div><div id="39320885" class="c"><input type="checkbox" id="c-39320885" checked=""/><div class="controls bullet"><span class="by">liampulles</span><span>|</span><a href="#39320170">prev</a><span>|</span><a href="#39320841">next</a><span>|</span><label class="collapse" for="c-39320885">[-]</label><label class="expand" for="c-39320885">[1 more]</label></div><br/><div class="children"><div class="content">I agree with a lot of this, I&#x27;ll add my own opinions:<p>* I would pass a waitgroup with the app context to service structs. This way the interrupt can trigger the app shutdown via the context and the main goroutine can wait on the waitgroup before actually killing the app.<p>* If writing a CLI program, then testing stdout, stdin, stderr, args, env, etc. is useful. But for an http server, this is less true. I would pass structured config to the run function to let those tests be more focused.<p>* I disagree with parsing templates using sync.Once in a handler because I don&#x27;t think handlers should do template parsing at all. I would do this when the app starts: if the template cannot be parsed, the app should not become ready to receive any requests and should rather exit with a non-zero exit code.</div><br/></div></div><div id="39320841" class="c"><input type="checkbox" id="c-39320841" checked=""/><div class="controls bullet"><span class="by">jupp0r</span><span>|</span><a href="#39320885">prev</a><span>|</span><a href="#39320329">next</a><span>|</span><label class="collapse" for="c-39320841">[-]</label><label class="expand" for="c-39320841">[4 more]</label></div><br/><div class="children"><div class="content">I found fx(<a href="https:&#x2F;&#x2F;github.com&#x2F;uber-go&#x2F;fx">https:&#x2F;&#x2F;github.com&#x2F;uber-go&#x2F;fx</a>) to be a super simple yet versatile tool to design my application around.<p>All the advice in the article is still helpful, but it takes the &quot;how do I make sure X is initialized when Y needs it&quot; part completely out of the equation and reduces it from an N*M problem to an N problem, ie I only have to worry about how to initialize individual pieces, not about how to synchronize initialization between them.<p>I&#x27;ve used quite a few dependency injection libraries in various languages over the years (and implemented a couple myself) and the simplicity and versatility of fx makes it my favorite so far.</div><br/><div id="39322143" class="c"><input type="checkbox" id="c-39322143" checked=""/><div class="controls bullet"><span class="by">Philip-J-Fry</span><span>|</span><a href="#39320841">parent</a><span>|</span><a href="#39320329">next</a><span>|</span><label class="collapse" for="c-39322143">[-]</label><label class="expand" for="c-39322143">[3 more]</label></div><br/><div class="children"><div class="content">&gt;All the advice in the article is still helpful, but it takes the &quot;how do I make sure X is initialized when Y needs it&quot; part completely out of the equation and reduces it from an N*M problem to an N problem, ie I only have to worry about how to initialize individual pieces, not about how to synchronize initialization between them.<p>I gotta say, I hate these dependency injection frameworks.<p>In a well designed system this should be trivial. Making sure something is initialised when you want to use it is just a matter of it being available to pass in a constructor as a parameter.<p><pre><code>  stockService := NewStockService()
  orderService := NewOrderService()
  orderProcessor := NewOrderProcessor(stockService, orderService)
</code></pre>
There shouldn&#x27;t be any sort of &quot;synchronisation&quot; of initialisation needed because your code won&#x27;t compile if you do something wrong. If you add a cyclic dependency you will clearly see that because you won&#x27;t be able to construct things in the right order without an obvious workaround.</div><br/><div id="39322908" class="c"><input type="checkbox" id="c-39322908" checked=""/><div class="controls bullet"><span class="by">jupp0r</span><span>|</span><a href="#39320841">root</a><span>|</span><a href="#39322143">parent</a><span>|</span><a href="#39320329">next</a><span>|</span><label class="collapse" for="c-39322908">[-]</label><label class="expand" for="c-39322908">[2 more]</label></div><br/><div class="children"><div class="content">If you have ever topologically sorted 100 components connected in a complex graph by hand or found the right spot to insert the 101st, you&#x27;d quickly appreciate more help than a compiler check.</div><br/><div id="39324562" class="c"><input type="checkbox" id="c-39324562" checked=""/><div class="controls bullet"><span class="by">therealdrag0</span><span>|</span><a href="#39320841">root</a><span>|</span><a href="#39322908">parent</a><span>|</span><a href="#39320329">next</a><span>|</span><label class="collapse" for="c-39324562">[-]</label><label class="expand" for="c-39324562">[1 more]</label></div><br/><div class="children"><div class="content">Iâm sure thereâs a place for them.<p>But when micro-services are so common, it seems like people use them (Spring) because everyone else does, not because they actually provide needed value.</div><br/></div></div></div></div></div></div></div></div><div id="39320329" class="c"><input type="checkbox" id="c-39320329" checked=""/><div class="controls bullet"><span class="by">jopsen</span><span>|</span><a href="#39320841">prev</a><span>|</span><a href="#39320255">next</a><span>|</span><label class="collapse" for="c-39320329">[-]</label><label class="expand" for="c-39320329">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve recently been playing with ogen:
<a href="https:&#x2F;&#x2F;github.com&#x2F;ogen-go&#x2F;ogen">https:&#x2F;&#x2F;github.com&#x2F;ogen-go&#x2F;ogen</a><p>Write openapi definition, it&#x27;ll do routing, definition of structs, validation of JSON schemas, etc.<p>All I need to do is implement the service.<p>Validating an integer range for a querystring parameter is just too boring. And too easy to mistype when writing it manually.<p>Anyways, so far only been playing, so haven&#x27;t found the bad parts yet.</div><br/><div id="39321371" class="c"><input type="checkbox" id="c-39321371" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#39320329">parent</a><span>|</span><a href="#39321848">next</a><span>|</span><label class="collapse" for="c-39321371">[-]</label><label class="expand" for="c-39321371">[2 more]</label></div><br/><div class="children"><div class="content">The problem with this approach is writing openapi by hand from scratch is <i>incredibly</i> tedious process. Writing Protobufs, capnproto or any such similar idl feels much more productive</div><br/><div id="39321957" class="c"><input type="checkbox" id="c-39321957" checked=""/><div class="controls bullet"><span class="by">xyzzy123</span><span>|</span><a href="#39320329">root</a><span>|</span><a href="#39321371">parent</a><span>|</span><a href="#39321848">next</a><span>|</span><label class="collapse" for="c-39321957">[-]</label><label class="expand" for="c-39321957">[1 more]</label></div><br/><div class="children"><div class="content">Its a bit icky but LLMs &#x2F; copilot can speed up the creation of openapi specs a lot.<p>Agree it doesn&#x27;t fix the &quot;root&quot; problem that the overall syntax is not  ergonomic.</div><br/></div></div></div></div><div id="39321848" class="c"><input type="checkbox" id="c-39321848" checked=""/><div class="controls bullet"><span class="by">topicseed</span><span>|</span><a href="#39320329">parent</a><span>|</span><a href="#39321371">prev</a><span>|</span><a href="#39320255">next</a><span>|</span><label class="collapse" for="c-39321848">[-]</label><label class="expand" for="c-39321848">[1 more]</label></div><br/><div class="children"><div class="content">Or, if you&#x27;re more into publishing an Openapi spec from your Go code, I do like danielgtaylor&#x2F;huma[1] and swaggest&#x2F;rest[2].<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;danielgtaylor&#x2F;huma">https:&#x2F;&#x2F;github.com&#x2F;danielgtaylor&#x2F;huma</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;swaggest&#x2F;rest">https:&#x2F;&#x2F;github.com&#x2F;swaggest&#x2F;rest</a></div><br/></div></div></div></div><div id="39320255" class="c"><input type="checkbox" id="c-39320255" checked=""/><div class="controls bullet"><span class="by">sethammons</span><span>|</span><a href="#39320329">prev</a><span>|</span><a href="#39319814">next</a><span>|</span><label class="collapse" for="c-39320255">[-]</label><label class="expand" for="c-39320255">[1 more]</label></div><br/><div class="children"><div class="content">I like a lot of what they&#x27;ve done here. My testing looks a bit different however.<p>srv, err := newTestServer()<p>require.NoError(t, err)<p>defer srv.Close()<p>resp, err := http.Post(fmt.Sprintf(&quot;<a href="http:&#x2F;&#x2F;localhost:%d&#x2F;signup&#x2F;json" rel="nofollow">http:&#x2F;&#x2F;localhost:%d&#x2F;signup&#x2F;json</a>&quot;, srv.Port()), &quot;application&#x2F;json&quot;, strings.NewReader(`
  {&quot;email&quot;:&quot;test@example.com&quot;, &quot;password&quot;: &quot;p@55Word&quot;, &quot;password_copy&quot;: &quot;p@55Word&quot;}
 `))<p>In my newTestServer, I spin up a server with fakes for my dependencies. If I want to test a dependency error, I replace that property with a fake that will return an error. I can validate my error paths. I can validate my log entries. I can validate my metric emission. I can validate timeouts and graceful shutdowns.<p>After the server starts, I inspect to determine which port it is running on (default is :0 so I have to wait to see what it got bound to).<p>My &quot;unit&quot; tests can test at the handler level or the http level, making sure that I can fully test the code as the users of my system will see it, exercising all middleware or none. I can spin up N instances and run my tests in parallel.</div><br/></div></div><div id="39319814" class="c"><input type="checkbox" id="c-39319814" checked=""/><div class="controls bullet"><span class="by">romantomjak</span><span>|</span><a href="#39320255">prev</a><span>|</span><a href="#39320129">next</a><span>|</span><label class="collapse" for="c-39319814">[-]</label><label class="expand" for="c-39319814">[1 more]</label></div><br/><div class="children"><div class="content">Great article with lots of interesting ideas. Can&#x27;t believe I didn&#x27;t know about signal.NotifyContext. Finally I&#x27;ll be able to actually rememeber how to respond to signals instead of copy-pasting that between projects.</div><br/></div></div><div id="39320129" class="c"><input type="checkbox" id="c-39320129" checked=""/><div class="controls bullet"><span class="by">jbmsf</span><span>|</span><a href="#39319814">prev</a><span>|</span><a href="#39321436">next</a><span>|</span><label class="collapse" for="c-39320129">[-]</label><label class="expand" for="c-39320129">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t write go, but I like these patterns. Feels fairly universal for testable code.<p>I never want to see another (esp. Python) Quick Start guide that treats dependencies as implicit&#x2F;static&#x2F;untestable.</div><br/></div></div><div id="39321436" class="c"><input type="checkbox" id="c-39321436" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#39320129">prev</a><span>|</span><a href="#39321013">next</a><span>|</span><label class="collapse" for="c-39321436">[-]</label><label class="expand" for="c-39321436">[3 more]</label></div><br/><div class="children"><div class="content">I just run Go servers under fcgi. You get orchestration and crash recovery with a very simple interface. Fcgi will launch server processes as needed, feed them events, and shut it down when there&#x27;s no traffic. Performance is good, and you can run on cheap hosting.</div><br/><div id="39322300" class="c"><input type="checkbox" id="c-39322300" checked=""/><div class="controls bullet"><span class="by">chubot</span><span>|</span><a href="#39321436">parent</a><span>|</span><a href="#39321013">next</a><span>|</span><label class="collapse" for="c-39322300">[-]</label><label class="expand" for="c-39322300">[2 more]</label></div><br/><div class="children"><div class="content">Which hosting do you use?  I use fastcgi with python on Dreamhost and it works fine, but Iâm sorta worried that theyâll turn it off because it seems kind of niche and under-documented</div><br/><div id="39323173" class="c"><input type="checkbox" id="c-39323173" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#39321436">root</a><span>|</span><a href="#39322300">parent</a><span>|</span><a href="#39321013">next</a><span>|</span><label class="collapse" for="c-39323173">[-]</label><label class="expand" for="c-39323173">[1 more]</label></div><br/><div class="children"><div class="content">Dreamhost too. Dreamhost will let you run a continuously running process.<p>The amount of work you can get done on low-end shared hosting is really quite impressive.</div><br/></div></div></div></div></div></div><div id="39321013" class="c"><input type="checkbox" id="c-39321013" checked=""/><div class="controls bullet"><span class="by">earthboundkid</span><span>|</span><a href="#39321436">prev</a><span>|</span><a href="#39319584">next</a><span>|</span><label class="collapse" for="c-39321013">[-]</label><label class="expand" for="c-39321013">[2 more]</label></div><br/><div class="children"><div class="content">The validator should return map[string][]string so that a request can have multiple problems with one field.</div><br/><div id="39321025" class="c"><input type="checkbox" id="c-39321025" checked=""/><div class="controls bullet"><span class="by">earthboundkid</span><span>|</span><a href="#39321013">parent</a><span>|</span><a href="#39319584">next</a><span>|</span><label class="collapse" for="c-39321025">[-]</label><label class="expand" for="c-39321025">[1 more]</label></div><br/><div class="children"><div class="content">The sync.Once should be sync.OnceValues instead.</div><br/></div></div></div></div><div id="39319584" class="c"><input type="checkbox" id="c-39319584" checked=""/><div class="controls bullet"><span class="by">ballresin</span><span>|</span><a href="#39321013">prev</a><span>|</span><a href="#39321281">next</a><span>|</span><label class="collapse" for="c-39319584">[-]</label><label class="expand" for="c-39319584">[11 more]</label></div><br/><div class="children"><div class="content">What is the value making main.go as small as possible?<p>Whose dreams come true in this scenario?</div><br/><div id="39319843" class="c"><input type="checkbox" id="c-39319843" checked=""/><div class="controls bullet"><span class="by">abuani</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319709">next</a><span>|</span><label class="collapse" for="c-39319843">[-]</label><label class="expand" for="c-39319843">[1 more]</label></div><br/><div class="children"><div class="content">The author goes on to explain a few scenarios where the pattern is helpful. It&#x27;s not to keep main.go as small as possible, it&#x27;s so that you can test parts of your main.go file properly. In my experience, if all of my logic is stuffed into `func main() {}`, then I can&#x27;t actually test it. If I have a helper method(like run in this case), I can test out specific scenarios and ensure the application handles it properly. Some of the examples Mat gave were handling context cancellations properly.</div><br/></div></div><div id="39319709" class="c"><input type="checkbox" id="c-39319709" checked=""/><div class="controls bullet"><span class="by">mosselman</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319843">prev</a><span>|</span><a href="#39319653">next</a><span>|</span><label class="collapse" for="c-39319709">[-]</label><label class="expand" for="c-39319709">[1 more]</label></div><br/><div class="children"><div class="content">âWhose dreams come true in this scenario?â<p>I love this! I will use this as well.<p>There are so many situations where I have a feeling that people are solving problems that donât exist. In code I run into at work, code and projects I see online, etc<p>The âwhose dreams are you making come trueâ really applies here, because dreams are exactly what they are.<p>I spent quite some time writing an automatic image resizer and optimiser for my blog. Does it matter? No! Should I have spent that time writing blog posts instead? Yes! Still I was chasing some dream.<p>Thanks for this image</div><br/></div></div><div id="39319653" class="c"><input type="checkbox" id="c-39319653" checked=""/><div class="controls bullet"><span class="by">janosdebugs</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319709">prev</a><span>|</span><a href="#39319846">next</a><span>|</span><label class="collapse" for="c-39319653">[-]</label><label class="expand" for="c-39319653">[1 more]</label></div><br/><div class="children"><div class="content">If you do, you can use the application as a library and most of your code will also be easier to test.</div><br/></div></div><div id="39319846" class="c"><input type="checkbox" id="c-39319846" checked=""/><div class="controls bullet"><span class="by">jrockway</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319653">prev</a><span>|</span><a href="#39319662">next</a><span>|</span><label class="collapse" for="c-39319846">[-]</label><label class="expand" for="c-39319846">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve never been a fan of making main.go one line.  I create the logger, parse the flags, create objects from the flags, and call Run() or something.  In the tests, you aren&#x27;t ever going to do those things in the same way, so there is really no point in putting them in some other file.</div><br/></div></div><div id="39319662" class="c"><input type="checkbox" id="c-39319662" checked=""/><div class="controls bullet"><span class="by">mattboardman</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319846">prev</a><span>|</span><a href="#39319749">next</a><span>|</span><label class="collapse" for="c-39319662">[-]</label><label class="expand" for="c-39319662">[1 more]</label></div><br/><div class="children"><div class="content">Usually your main function can&#x27;t be used by any other part of your program. You should move all component implementations to modules so they can be re-used elsewhere.</div><br/></div></div><div id="39319749" class="c"><input type="checkbox" id="c-39319749" checked=""/><div class="controls bullet"><span class="by">arccy</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319662">prev</a><span>|</span><a href="#39319636">next</a><span>|</span><label class="collapse" for="c-39319749">[-]</label><label class="expand" for="c-39319749">[1 more]</label></div><br/><div class="children"><div class="content">not main.go but func main. This allows your run function to return an error and you only need to deal with the abruptness of using os.Exit once</div><br/></div></div><div id="39319636" class="c"><input type="checkbox" id="c-39319636" checked=""/><div class="controls bullet"><span class="by">sebastianz</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319749">prev</a><span>|</span><a href="#39320230">next</a><span>|</span><label class="collapse" for="c-39319636">[-]</label><label class="expand" for="c-39319636">[1 more]</label></div><br/><div class="children"><div class="content">The initialization has to be done in a separate function that you call from the setup code for your end-to-end tests.</div><br/></div></div><div id="39320230" class="c"><input type="checkbox" id="c-39320230" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39319636">prev</a><span>|</span><a href="#39319773">next</a><span>|</span><label class="collapse" for="c-39320230">[-]</label><label class="expand" for="c-39320230">[1 more]</label></div><br/><div class="children"><div class="content">The idea is to keep the untestable code as small as possible but in practice you just add a layer of indirection and all of your untestable init code is in a different castle.</div><br/></div></div><div id="39319773" class="c"><input type="checkbox" id="c-39319773" checked=""/><div class="controls bullet"><span class="by">pphysch</span><span>|</span><a href="#39319584">parent</a><span>|</span><a href="#39320230">prev</a><span>|</span><a href="#39321281">next</a><span>|</span><label class="collapse" for="c-39319773">[-]</label><label class="expand" for="c-39319773">[2 more]</label></div><br/><div class="children"><div class="content">For bespoke internal services, I like to keep main.go as flat as reasonable, like a &quot;script&quot;. Handlers can have their own files but the bulk of the control flow and moving parts should be apparent from reading the main file.<p>Abstracting things away from main makes it less readable and is general pointless for bespoke services that will be deployed in exactly one configuration.</div><br/><div id="39320027" class="c"><input type="checkbox" id="c-39320027" checked=""/><div class="controls bullet"><span class="by">donio</span><span>|</span><a href="#39319584">root</a><span>|</span><a href="#39319773">parent</a><span>|</span><a href="#39321281">next</a><span>|</span><label class="collapse" for="c-39320027">[-]</label><label class="expand" for="c-39320027">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a nice way of putting it. When exploring a new codebase for the first time it can be very helpful to have main.go give you a high level idea about the overall structure of the program.</div><br/></div></div></div></div></div></div><div id="39321281" class="c"><input type="checkbox" id="c-39321281" checked=""/><div class="controls bullet"><span class="by">bumpa</span><span>|</span><a href="#39319584">prev</a><span>|</span><a href="#39319777">next</a><span>|</span><label class="collapse" for="c-39321281">[-]</label><label class="expand" for="c-39321281">[1 more]</label></div><br/><div class="children"><div class="content">The encode example contains a bug and a lint issue. Firstly, calling w.Header().Set after w.WriteHeader is likely a bug, as the w.WriteHeader method call should occur after setting the headers.<p>The second issue involves passing an unused *http.Request, which will likely cause the linter to flag it.</div><br/></div></div><div id="39319777" class="c"><input type="checkbox" id="c-39319777" checked=""/><div class="controls bullet"><span class="by">arccy</span><span>|</span><a href="#39321281">prev</a><span>|</span><a href="#39320079">next</a><span>|</span><label class="collapse" for="c-39319777">[-]</label><label class="expand" for="c-39319777">[1 more]</label></div><br/><div class="children"><div class="content">i really like the patterns in this post, pretty much what i&#x27;ve also settled on after much experimentation with different styles.</div><br/></div></div><div id="39320079" class="c"><input type="checkbox" id="c-39320079" checked=""/><div class="controls bullet"><span class="by">lelandbatey</span><span>|</span><a href="#39319777">prev</a><span>|</span><a href="#39320138">next</a><span>|</span><label class="collapse" for="c-39320079">[-]</label><label class="expand" for="c-39320079">[4 more]</label></div><br/><div class="children"><div class="content">I want to see a greater acceptance of this idea:<p>&gt; My handlers used to be methods hanging off a server struct, but I no longer do this. If a handler function wants a dependency, it can bloody well ask for it as an argument. No more surprise dependencies when youâre just trying to test a single handler.<p>For HTTP services in any language, your handlers will usually end up with a lot of business logic, logic which probably has many dependencies. I see single handlers using all of the following on a regular basis: DB, cache, blob storage, some kind of special authz thing specific to your endpoints, maybe some fancy licensing checker, a queue or two, a specialized logger, and specialized metrics client. Many of those (metrics, request&#x2F;response logging) can live in middlewares <i>most</i> of the time, but in every code base there will be times where you need to do something custom with one or the other. As time passes, the more I wonder &quot;why aren&#x27;t these all just function parameters?&quot;<p>Yes, that would be a lot of function parameters (9+ for a single handler, before even getting into the request or custom params themselves), and we all have many rules of thumb and linter rules which try to keep us from having lots of function parameters. But it&#x27;s not like we&#x27;re not writing code which depends on all those dependencies, instead we&#x27;re just sticking them on the &quot;server&quot; class&#x2F;struct and pretending that because the method signature is shorter, we have fewer dependencies!<p>As time passes, I find myself wishing more and more for code that takes <i>all</i> its dependencies in the function&#x2F;method signature, even if there&#x27;s 20 of them; at least then we wouldn&#x27;t be lying about how complex the code&#x27;s getting...</div><br/><div id="39321900" class="c"><input type="checkbox" id="c-39321900" checked=""/><div class="controls bullet"><span class="by">topicseed</span><span>|</span><a href="#39320079">parent</a><span>|</span><a href="#39320150">next</a><span>|</span><label class="collapse" for="c-39321900">[-]</label><label class="expand" for="c-39321900">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve always have my handlers individually set as a struct each with a method to handle the route&#x2F;request.<p>type CreateUser struct {<p><pre><code>   store  storage.Store

   cache  caching.Cache

   logger logging.Logger

   pub    events.Publisher

   &#x2F;&#x2F; etc
</code></pre>
}<p>func (op <i>CreateUser) ServeHTTP(ctx, req, rw) {}<p>&#x2F;&#x2F; or if you have custom handlers<p>func (op </i>CreateUser) ServeHTTP(ctx, input) (output, error) {}<p>And in my main.go, or where I set up my dependencies, I create each operation, passing it its specific dependencies. I love that because I can keep all the helper methods for that specific operation&#x2F;handler on that specific struct as private methods.<p>It does get tedious when you have one operation needing another, as you might start passing these around or you extract that into its own package&#x2F;service.</div><br/><div id="39324118" class="c"><input type="checkbox" id="c-39324118" checked=""/><div class="controls bullet"><span class="by">lelandbatey</span><span>|</span><a href="#39320079">root</a><span>|</span><a href="#39321900">parent</a><span>|</span><a href="#39320150">next</a><span>|</span><label class="collapse" for="c-39324118">[-]</label><label class="expand" for="c-39324118">[1 more]</label></div><br/><div class="children"><div class="content">This is kinda missing the point; each handler needs a lot of deps to do it&#x27;s job, and the most obvious place to put them is in the parameters of the function. That is what I want. I do not want more indirection for aesthetics; I want clarity, even if it&#x27;s brutal clarity.<p>Whether all the deps are in the method receiver (the parent struct) or in a struct that&#x27;s a param; it&#x27;s all just more indirection to hide all the &quot;stuff&quot; that we need cause we think it&#x27;s ugly. I dream of a world where we don&#x27;t do that.</div><br/></div></div></div></div><div id="39320150" class="c"><input type="checkbox" id="c-39320150" checked=""/><div class="controls bullet"><span class="by">wereHamster</span><span>|</span><a href="#39320079">parent</a><span>|</span><a href="#39321900">prev</a><span>|</span><a href="#39320138">next</a><span>|</span><label class="collapse" for="c-39320150">[-]</label><label class="expand" for="c-39320150">[1 more]</label></div><br/><div class="children"><div class="content">It doesn&#x27;t have to be 9+ separate arguments, in some languages it can be a single &#x27;context&#x27; or &#x27;env&#x27; object that contains just what the handler needs, something like `handleHello({ db, cache, blobStore, authz }, req, res)`. That way, if two handlers use the exact same context you can reuse, but it&#x27;s also easy enough to declare a per-handler context at the call site.</div><br/></div></div></div></div><div id="39320138" class="c"><input type="checkbox" id="c-39320138" checked=""/><div class="controls bullet"><span class="by">matt_callmann</span><span>|</span><a href="#39320079">prev</a><span>|</span><a href="#39321513">next</a><span>|</span><label class="collapse" for="c-39320138">[-]</label><label class="expand" for="c-39320138">[4 more]</label></div><br/><div class="children"><div class="content">is there a git repo with example code?</div><br/><div id="39320226" class="c"><input type="checkbox" id="c-39320226" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320138">parent</a><span>|</span><a href="#39321513">next</a><span>|</span><label class="collapse" for="c-39320226">[-]</label><label class="expand" for="c-39320226">[3 more]</label></div><br/><div class="children"><div class="content">Not OP, but I design my Go projects with a very similar pattern that I learned from OP&#x27;s 2018 post.<p>I think this is a pretty good example of a real-world implementation:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare">https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare</a><p>Particularly these files:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare&#x2F;blob&#x2F;2cd9979dab084ca781e125f725e48297b6e183c1&#x2F;handlers&#x2F;server.go">https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare&#x2F;blob&#x2F;2cd9979dab084ca781...</a><p><a href="https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare&#x2F;blob&#x2F;2cd9979dab084ca781e125f725e48297b6e183c1&#x2F;handlers&#x2F;routes.go">https:&#x2F;&#x2F;github.com&#x2F;mtlynch&#x2F;picoshare&#x2F;blob&#x2F;2cd9979dab084ca781...</a></div><br/><div id="39321113" class="c"><input type="checkbox" id="c-39321113" checked=""/><div class="controls bullet"><span class="by">karolist</span><span>|</span><a href="#39320138">root</a><span>|</span><a href="#39320226">parent</a><span>|</span><a href="#39321513">next</a><span>|</span><label class="collapse" for="c-39321113">[-]</label><label class="expand" for="c-39321113">[2 more]</label></div><br/><div class="children"><div class="content">out of curiosity, why no sort-of-established pkg and internal dirs? What do you think of <a href="https:&#x2F;&#x2F;github.com&#x2F;photoprism&#x2F;photoprism">https:&#x2F;&#x2F;github.com&#x2F;photoprism&#x2F;photoprism</a> structure?</div><br/><div id="39321218" class="c"><input type="checkbox" id="c-39321218" checked=""/><div class="controls bullet"><span class="by">mtlynch</span><span>|</span><a href="#39320138">root</a><span>|</span><a href="#39321113">parent</a><span>|</span><a href="#39321513">next</a><span>|</span><label class="collapse" for="c-39321218">[-]</label><label class="expand" for="c-39321218">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not familiar with that package structure, unfortunately. It might be good, but I&#x27;m not sure what the reasons are for structuring the project that way.</div><br/></div></div></div></div></div></div></div></div><div id="39321513" class="c"><input type="checkbox" id="c-39321513" checked=""/><div class="controls bullet"><span class="by">sylware</span><span>|</span><a href="#39320138">prev</a><span>|</span><a href="#39322159">next</a><span>|</span><label class="collapse" for="c-39321513">[-]</label><label class="expand" for="c-39321513">[1 more]</label></div><br/><div class="children"><div class="content">I did write my own HTTP stuff in C (and more generally internet stuff), on linux (sometimes without a libc, namely direct syscalls), running on ARM64 and x86_64.<p>And I plan to move to rv64 assembly once I can get reasonably performant hardware (it is already here, but it extremely hard to get some where I am from and how I operate). I dunno if it will be bare metal or with a linux kernel first (coze a minimal TCP stack is already a big thingy).</div><br/></div></div><div id="39319992" class="c"><input type="checkbox" id="c-39319992" checked=""/><div class="controls bullet"><span class="by">sesm</span><span>|</span><a href="#39320984">prev</a><span>|</span><a href="#39320966">next</a><span>|</span><label class="collapse" for="c-39319992">[-]</label><label class="expand" for="c-39319992">[1 more]</label></div><br/><div class="children"><div class="content">TLDR: optimize for unit tests and do DI with explicit function arguments. Looks kind of similar to Dropwizard.</div><br/></div></div></div></div></div></div></div></body></html>