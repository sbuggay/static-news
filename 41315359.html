<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1724317256078" as="style"/><link rel="stylesheet" href="styles.css?v=1724317256078"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://box2d.org/posts/2024/08/simd-matters/">SIMD Matters: Graph Coloring</a> <span class="domain">(<a href="https://box2d.org">box2d.org</a>)</span></div><div class="subtext"><span>matt_d</span> | <span>14 comments</span></div><br/><div><div id="41318144" class="c"><input type="checkbox" id="c-41318144" checked=""/><div class="controls bullet"><span class="by">noelwelsh</span><span>|</span><a href="#41318069">next</a><span>|</span><label class="collapse" for="c-41318144">[-]</label><label class="expand" for="c-41318144">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This is a bit ironic because on x64 all math is SIMD math, it is just inefficient SIMD math.<p>I don&#x27;t understand this statement at the end of the article? Can anyone explain? TIA.</div><br/></div></div><div id="41318069" class="c"><input type="checkbox" id="c-41318069" checked=""/><div class="controls bullet"><span class="by">unwind</span><span>|</span><a href="#41318144">prev</a><span>|</span><a href="#41317888">next</a><span>|</span><label class="collapse" for="c-41318069">[-]</label><label class="expand" for="c-41318069">[1 more]</label></div><br/><div class="children"><div class="content">Very cool and informative article, and I love that Box2d is in C nowadays that really makes it clear. Great job!<p>I saw a small typo:<p><pre><code>    &#x2F;&#x2F; wide float
    typedef b2FloatW __m128;
</code></pre>
The `typedef` is backwards, the alias and the underlying type name are in the wrong order and need to be swapped around.</div><br/></div></div><div id="41317888" class="c"><input type="checkbox" id="c-41317888" checked=""/><div class="controls bullet"><span class="by">mgaunard</span><span>|</span><a href="#41318069">prev</a><span>|</span><a href="#41317605">next</a><span>|</span><label class="collapse" for="c-41317888">[-]</label><label class="expand" for="c-41317888">[2 more]</label></div><br/><div class="children"><div class="content">The main problem of SIMD remains the same: it requires working with structures of arrays rather than arrays of structures, which makes it more difficult to combine and layer objects on top of each other.</div><br/><div id="41317914" class="c"><input type="checkbox" id="c-41317914" checked=""/><div class="controls bullet"><span class="by">machinekob</span><span>|</span><a href="#41317888">parent</a><span>|</span><a href="#41317605">next</a><span>|</span><label class="collapse" for="c-41317914">[-]</label><label class="expand" for="c-41317914">[1 more]</label></div><br/><div class="children"><div class="content">Just wrap array of structures in SIMD it is not that hard at least in 95% of cases</div><br/></div></div></div></div><div id="41317605" class="c"><input type="checkbox" id="c-41317605" checked=""/><div class="controls bullet"><span class="by">vkazanov</span><span>|</span><a href="#41317888">prev</a><span>|</span><a href="#41317405">next</a><span>|</span><label class="collapse" for="c-41317605">[-]</label><label class="expand" for="c-41317605">[7 more]</label></div><br/><div class="children"><div class="content">The other problem with simd is that in modern cpu-centric languages it often requires a rewrite for every vector width.<p>And for 80% of the cases by the point there is enough vectorizable  data for a programmer to look into simd, a gpu can provide 1000%+ of perf AND a certain level of portability.<p>So right now simd is a niche tool for super low-level things: certain decompression algos, bits of math here and there, solvers, etc.<p>And it also takes a lot of space on your cpu die. Like, A LOT.</div><br/><div id="41318151" class="c"><input type="checkbox" id="c-41318151" checked=""/><div class="controls bullet"><span class="by">neonsunset</span><span>|</span><a href="#41317605">parent</a><span>|</span><a href="#41317790">next</a><span>|</span><label class="collapse" for="c-41318151">[-]</label><label class="expand" for="c-41318151">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The other problem with simd is that in modern cpu-centric languages it often requires a rewrite for every vector width.<p>It does not: <a href="https:&#x2F;&#x2F;github.com&#x2F;bepu&#x2F;bepuphysics2&#x2F;blob&#x2F;master&#x2F;BepuUtilities&#x2F;MathHelper.cs#L274">https:&#x2F;&#x2F;github.com&#x2F;bepu&#x2F;bepuphysics2&#x2F;blob&#x2F;master&#x2F;BepuUtiliti...</a><p>Also you can’t go to GPU for most tasks SIMD is used in CPUs today. Good luck parsing HTTP headers with that.</div><br/></div></div><div id="41317790" class="c"><input type="checkbox" id="c-41317790" checked=""/><div class="controls bullet"><span class="by">janwas</span><span>|</span><a href="#41317605">parent</a><span>|</span><a href="#41318151">prev</a><span>|</span><a href="#41317789">next</a><span>|</span><label class="collapse" for="c-41317790">[-]</label><label class="expand" for="c-41317790">[1 more]</label></div><br/><div class="children"><div class="content">I do not understand this take :) The vast majority of our code is vector length agnostic, as is required for SVE and RVV.<p>GPU perf&#x2F;TCO is not always better than CPU, if you can even get enough GPUs, and the latency is also a concern and inducement to do everything on the GPU, which can be limiting.</div><br/></div></div><div id="41317789" class="c"><input type="checkbox" id="c-41317789" checked=""/><div class="controls bullet"><span class="by">adrianN</span><span>|</span><a href="#41317605">parent</a><span>|</span><a href="#41317790">prev</a><span>|</span><a href="#41318123">next</a><span>|</span><label class="collapse" for="c-41317789">[-]</label><label class="expand" for="c-41317789">[2 more]</label></div><br/><div class="children"><div class="content">Compilers are becoming reasonably good at autovectorization if you’re a bit careful how you write your code. I wouldn’t say that simd  is niche. You often don’t get the really great improvements you can achieve by being clever manually, but the improvements are still very measurable in my experience.</div><br/><div id="41318153" class="c"><input type="checkbox" id="c-41318153" checked=""/><div class="controls bullet"><span class="by">secondcoming</span><span>|</span><a href="#41317605">root</a><span>|</span><a href="#41317789">parent</a><span>|</span><a href="#41318123">next</a><span>|</span><label class="collapse" for="c-41318153">[-]</label><label class="expand" for="c-41318153">[1 more]</label></div><br/><div class="children"><div class="content">clang may be getting better, but gcc isn&#x27;t.<p>Being &#x27;careful how you write your code&#x27; is putting it mildly. IME you have to hold the compiler&#x27;s hand at every step. Using &#x27;bool&#x27; instead of &#x27;int&#x27; can make gcc give up on autovectorisation, for example.<p>You need to use intrinsics, or a wrapper lib around them, if you want to be sure that SIMD is being used.</div><br/></div></div></div></div><div id="41318123" class="c"><input type="checkbox" id="c-41318123" checked=""/><div class="controls bullet"><span class="by">secondcoming</span><span>|</span><a href="#41317605">parent</a><span>|</span><a href="#41317789">prev</a><span>|</span><a href="#41317862">next</a><span>|</span><label class="collapse" for="c-41318123">[-]</label><label class="expand" for="c-41318123">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s unlikely everyones cloud machines have GPUs</div><br/></div></div><div id="41317862" class="c"><input type="checkbox" id="c-41317862" checked=""/><div class="controls bullet"><span class="by">mgaunard</span><span>|</span><a href="#41317605">parent</a><span>|</span><a href="#41318123">prev</a><span>|</span><a href="#41317405">next</a><span>|</span><label class="collapse" for="c-41317862">[-]</label><label class="expand" for="c-41317862">[1 more]</label></div><br/><div class="children"><div class="content">You can just use templates or macros to make it length-agnostic.</div><br/></div></div></div></div><div id="41317405" class="c"><input type="checkbox" id="c-41317405" checked=""/><div class="controls bullet"><span class="by">a1o</span><span>|</span><a href="#41317605">prev</a><span>|</span><a href="#41317595">next</a><span>|</span><label class="collapse" for="c-41317405">[-]</label><label class="expand" for="c-41317405">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The conventional wisdom is that it is difficult to achieve real gains from SIMD.<p>This has been my experience often times I misunderstood how much can be gained by using SIMD, and preparing the data to be &quot;eaten&quot; by SIMD instructions is not trivial. I have many times attempted to use just to profile and see it didn&#x27;t improve things at all and made the code really hard to understand.<p>Kudos for Erin here this is really hard work and it&#x27;s great it paid off well and gave good results here!</div><br/></div></div><div id="41317595" class="c"><input type="checkbox" id="c-41317595" checked=""/><div class="controls bullet"><span class="by">CreepGin</span><span>|</span><a href="#41317405">prev</a><span>|</span><label class="collapse" for="c-41317595">[-]</label><label class="expand" for="c-41317595">[1 more]</label></div><br/><div class="children"><div class="content">I really appreciate the write-up and showing the most important code snippets.<p>Intuitively, this feels like a narrower version of using Z-order curve.</div><br/></div></div></div></div></div></div></div></body></html>