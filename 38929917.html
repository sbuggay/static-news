<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704877265414" as="style"/><link rel="stylesheet" href="styles.css?v=1704877265414"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://deepflow.io/">DeepFlow – open-source eBPF Distributed Tracing</a> <span class="domain">(<a href="https://deepflow.io">deepflow.io</a>)</span></div><div class="subtext"><span>shlosky</span> | <span>24 comments</span></div><br/><div><div id="38931050" class="c"><input type="checkbox" id="c-38931050" checked=""/><div class="controls bullet"><span class="by">bigcat12345678</span><span>|</span><a href="#38931614">next</a><span>|</span><label class="collapse" for="c-38931050">[-]</label><label class="expand" for="c-38931050">[7 more]</label></div><br/><div class="children"><div class="content">Nice project, have been following this project casually for a while.
The standout feature is to trace RPC flow across network connections, through packet tracing.</div><br/><div id="38932324" class="c"><input type="checkbox" id="c-38932324" checked=""/><div class="controls bullet"><span class="by">nimrody</span><span>|</span><a href="#38931050">parent</a><span>|</span><a href="#38931614">next</a><span>|</span><label class="collapse" for="c-38932324">[-]</label><label class="expand" for="c-38932324">[6 more]</label></div><br/><div class="children"><div class="content">How can it tie requests arriving at a service and generating additional downstream requests?<p>Distributed tracing needs some common token all requests share to identify all RPCs that should be associated with a specific incoming request.</div><br/><div id="38933916" class="c"><input type="checkbox" id="c-38933916" checked=""/><div class="controls bullet"><span class="by">sharangxy</span><span>|</span><a href="#38931050">root</a><span>|</span><a href="#38932324">parent</a><span>|</span><a href="#38933460">next</a><span>|</span><label class="collapse" for="c-38933916">[-]</label><label class="expand" for="c-38933916">[3 more]</label></div><br/><div class="children"><div class="content">VP of DeepFlow here. Thank you for your interest in DeepFlow!<p>Yes, we have implemented distributed tracing using eBPF. In simple terms, we use thread-id, coroutine-id, and tcp-seq to automatically correlate all spans. Most importantly, we use eBPF to calculate a syscall-trace-id (without the need to propagate it between upstream and downstream), enabling automatic correlation of a service&#x27;s ingress and egress requests. For more details, you can refer to our paper presented at SIGCOMM&#x27;23: <a href="https:&#x2F;&#x2F;dl.acm.org&#x2F;doi&#x2F;10.1145&#x2F;3603269.3604823" rel="nofollow">https:&#x2F;&#x2F;dl.acm.org&#x2F;doi&#x2F;10.1145&#x2F;3603269.3604823</a>.<p>Of course, this kind of Zero Code distributed tracing currently has some limitations. For specific details, please see: <a href="https:&#x2F;&#x2F;deepflow.io&#x2F;docs&#x2F;features&#x2F;distributed-tracing&#x2F;auto-tracing&#x2F;#current-limitations" rel="nofollow">https:&#x2F;&#x2F;deepflow.io&#x2F;docs&#x2F;features&#x2F;distributed-tracing&#x2F;auto-t...</a><p>These limitations are not entirely insurmountable. We are actively working on resolving them and continually making breakthroughs.</div><br/><div id="38934274" class="c"><input type="checkbox" id="c-38934274" checked=""/><div class="controls bullet"><span class="by">inhumantsar</span><span>|</span><a href="#38931050">root</a><span>|</span><a href="#38933916">parent</a><span>|</span><a href="#38933460">next</a><span>|</span><label class="collapse" for="c-38934274">[-]</label><label class="expand" for="c-38934274">[2 more]</label></div><br/><div class="children"><div class="content">would it be reasonable to assume that because this entirely network-based, it would work best with systems which really emphasize the &quot;micro&quot; in microservices?<p>how well does this work if, say, my system has a legacy monolith in addition to microservices?</div><br/><div id="38936619" class="c"><input type="checkbox" id="c-38936619" checked=""/><div class="controls bullet"><span class="by">sharangxy</span><span>|</span><a href="#38931050">root</a><span>|</span><a href="#38934274">parent</a><span>|</span><a href="#38933460">next</a><span>|</span><label class="collapse" for="c-38936619">[-]</label><label class="expand" for="c-38936619">[1 more]</label></div><br/><div class="children"><div class="content">I believe the current situation is like this.<p>The advantage of eBPF lies in *request granularity* (i.e. PRC, API, SQL, etc ...) distributed tracing. To trace the internal functions of an application, instrumentation is still required for coverage. Therefore, the finer the service decomposition, the more effective eBPF&#x27;s distributed tracing becomes.</div><br/></div></div></div></div></div></div><div id="38933460" class="c"><input type="checkbox" id="c-38933460" checked=""/><div class="controls bullet"><span class="by">Eridrus</span><span>|</span><a href="#38931050">root</a><span>|</span><a href="#38932324">parent</a><span>|</span><a href="#38933916">prev</a><span>|</span><a href="#38932933">next</a><span>|</span><label class="collapse" for="c-38933460">[-]</label><label class="expand" for="c-38933460">[1 more]</label></div><br/><div class="children"><div class="content">It looks like it depends on applications either using threads or go routines for concurrency:<p>&gt; When collecting invocation logs through eBPF and cBPF, DeepFlow calculates information such as syscall_trace_id, thread_id, goroutine_id, cap_seq, tcp_seq based on the system call context. This allows for distributed tracing without modifying application code or injecting TraceID and SpanID. Currently, DeepFlow can achieve Zero Code distributed tracing for all cases except for cross-thread communication (through memory queues or channels) and asynchronous invocations.</div><br/></div></div><div id="38932933" class="c"><input type="checkbox" id="c-38932933" checked=""/><div class="controls bullet"><span class="by">archivator</span><span>|</span><a href="#38931050">root</a><span>|</span><a href="#38932324">parent</a><span>|</span><a href="#38933460">prev</a><span>|</span><a href="#38931614">next</a><span>|</span><label class="collapse" for="c-38932933">[-]</label><label class="expand" for="c-38932933">[1 more]</label></div><br/><div class="children"><div class="content">Take a look at Core Feature #2 in this post - <a href="https:&#x2F;&#x2F;deepflow.io&#x2F;ebpf-the-key-technology-to-observability&#x2F;#0x2-Three-Core-Features-of-DeepFlow-Based-on-eBPF" rel="nofollow">https:&#x2F;&#x2F;deepflow.io&#x2F;ebpf-the-key-technology-to-observability...</a><p>It looks like it&#x27;s using tcp flow tuple + tcp_seq to join things.</div><br/></div></div></div></div></div></div><div id="38931614" class="c"><input type="checkbox" id="c-38931614" checked=""/><div class="controls bullet"><span class="by">javierhonduco</span><span>|</span><a href="#38931050">prev</a><span>|</span><a href="#38933838">next</a><span>|</span><label class="collapse" for="c-38931614">[-]</label><label class="expand" for="c-38931614">[3 more]</label></div><br/><div class="children"><div class="content">Haven’t checked the source code yet, wondering if profiling of code without frame pointes is supported. Curious on their approach.</div><br/><div id="38931761" class="c"><input type="checkbox" id="c-38931761" checked=""/><div class="controls bullet"><span class="by">reactordev</span><span>|</span><a href="#38931614">parent</a><span>|</span><a href="#38933838">next</a><span>|</span><label class="collapse" for="c-38931761">[-]</label><label class="expand" for="c-38931761">[2 more]</label></div><br/><div class="children"><div class="content">It uses eBPF to provide instrumentation of the kernel calls up as well as hooking into networking for http2 pgsql etc. Since it’s running the process in eBPF it’s essentially sandboxed and all memory, kernel function calls, and even profiling, is an option. They have an agent that collects this information and sends to the server over RPC (protobuf&#x2F;grpc). You should check it out (however, some of the docs are in Chinese).</div><br/><div id="38933943" class="c"><input type="checkbox" id="c-38933943" checked=""/><div class="controls bullet"><span class="by">sharangxy</span><span>|</span><a href="#38931614">root</a><span>|</span><a href="#38931761">parent</a><span>|</span><a href="#38933838">next</a><span>|</span><label class="collapse" for="c-38933943">[-]</label><label class="expand" for="c-38933943">[1 more]</label></div><br/><div class="children"><div class="content">We are in the process of translating more documents into English, and we also greatly welcome the help of the community!</div><br/></div></div></div></div></div></div><div id="38933838" class="c"><input type="checkbox" id="c-38933838" checked=""/><div class="controls bullet"><span class="by">progbits</span><span>|</span><a href="#38931614">prev</a><span>|</span><a href="#38935155">next</a><span>|</span><label class="collapse" for="c-38933838">[-]</label><label class="expand" for="c-38933838">[2 more]</label></div><br/><div class="children"><div class="content">&gt; DeepFlow can even analyze code performance through network profiling under old version kernels (2.6+).<p>This is an interesting call-out, the last release of 2.6 is from 2011. I wonder who is still running that in production.</div><br/><div id="38934127" class="c"><input type="checkbox" id="c-38934127" checked=""/><div class="controls bullet"><span class="by">sharangxy</span><span>|</span><a href="#38933838">parent</a><span>|</span><a href="#38935155">next</a><span>|</span><label class="collapse" for="c-38934127">[-]</label><label class="expand" for="c-38934127">[1 more]</label></div><br/><div class="children"><div class="content">Some of our users’ ancestral processes are running on kernel 2.6, and the operations staff dare not upgrade the kernel. Indeed, there are many limitations in 2.6, but the simple traffic analysis has brought surprising insights to users. However, this also brings some troubles: even if a problem is known, no one dares to easily modify the code to fix it, unless absolutely necessary :)</div><br/></div></div></div></div><div id="38935155" class="c"><input type="checkbox" id="c-38935155" checked=""/><div class="controls bullet"><span class="by">robertheadley</span><span>|</span><a href="#38933838">prev</a><span>|</span><a href="#38935609">next</a><span>|</span><label class="collapse" for="c-38935155">[-]</label><label class="expand" for="c-38935155">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t have any idea what this is, but the graphs are beautiful.</div><br/></div></div><div id="38935609" class="c"><input type="checkbox" id="c-38935609" checked=""/><div class="controls bullet"><span class="by">bobberkarl</span><span>|</span><a href="#38935155">prev</a><span>|</span><a href="#38936494">next</a><span>|</span><label class="collapse" for="c-38935609">[-]</label><label class="expand" for="c-38935609">[2 more]</label></div><br/><div class="children"><div class="content">How are you different from Pixie?</div><br/><div id="38936655" class="c"><input type="checkbox" id="c-38936655" checked=""/><div class="controls bullet"><span class="by">sharangxy</span><span>|</span><a href="#38935609">parent</a><span>|</span><a href="#38936494">next</a><span>|</span><label class="collapse" for="c-38936655">[-]</label><label class="expand" for="c-38936655">[1 more]</label></div><br/><div class="children"><div class="content">The biggest difference: DeepFlow enables *Distributed* Tracing.<p>In addition, DeepFlow combines the capabilities of eBPF and cBPF to achieve full-stack tracing of syscall + network_forward. You can take a look at our documentation: <a href="https:&#x2F;&#x2F;deepflow.io&#x2F;docs&#x2F;about&#x2F;features&#x2F;" rel="nofollow">https:&#x2F;&#x2F;deepflow.io&#x2F;docs&#x2F;about&#x2F;features&#x2F;</a></div><br/></div></div></div></div><div id="38936494" class="c"><input type="checkbox" id="c-38936494" checked=""/><div class="controls bullet"><span class="by">jinxiao2010</span><span>|</span><a href="#38935609">prev</a><span>|</span><a href="#38934770">next</a><span>|</span><label class="collapse" for="c-38936494">[-]</label><label class="expand" for="c-38936494">[1 more]</label></div><br/><div class="children"><div class="content">good project. I&#x27;ll take a try. ebpf is so popular, but we&#x27;re still using traditional network plugins.</div><br/></div></div><div id="38934770" class="c"><input type="checkbox" id="c-38934770" checked=""/><div class="controls bullet"><span class="by">ilovesnow</span><span>|</span><a href="#38936494">prev</a><span>|</span><a href="#38936437">next</a><span>|</span><label class="collapse" for="c-38934770">[-]</label><label class="expand" for="c-38934770">[1 more]</label></div><br/><div class="children"><div class="content">nice</div><br/></div></div><div id="38931491" class="c"><input type="checkbox" id="c-38931491" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#38936437">prev</a><span>|</span><a href="#38935203">next</a><span>|</span><label class="collapse" for="c-38931491">[-]</label><label class="expand" for="c-38931491">[2 more]</label></div><br/><div class="children"><div class="content">Apache 2, if that interests you: <a href="https:&#x2F;&#x2F;github.com&#x2F;deepflowio&#x2F;deepflow&#x2F;blob&#x2F;v6.4.7&#x2F;LICENSE">https:&#x2F;&#x2F;github.com&#x2F;deepflowio&#x2F;deepflow&#x2F;blob&#x2F;v6.4.7&#x2F;LICENSE</a><p>heh, GitHub also has &quot;symbol navigation&quot; turned on for that license file but I didn&#x27;t dig into it to find out what source language it thinks the file is</div><br/></div></div></div></div></div></div></div></body></html>