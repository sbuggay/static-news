<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735635663378" as="style"/><link rel="stylesheet" href="styles.css?v=1735635663378"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://people.kernel.org/kees/colliding-with-the-sha-prefix-of-linuxs-initial-git-commit">Colliding with the SHA prefix of Linux&#x27;s initial Git commit</a>Â <span class="domain">(<a href="https://people.kernel.org">people.kernel.org</a>)</span></div><div class="subtext"><span>2bluesc</span> | <span>25 comments</span></div><br/><div><div id="42555289" class="c"><input type="checkbox" id="c-42555289" checked=""/><div class="controls bullet"><span class="by">Terr_</span><span>|</span><a href="#42555386">next</a><span>|</span><label class="collapse" for="c-42555289">[-]</label><label class="expand" for="c-42555289">[13 more]</label></div><br/><div class="children"><div class="content">There were some plans to migrate to SHA256, but somehow it still hasn&#x27;t happened.<p>The practical upshot is a git commit hash is <i>not enough l</i> to know you are distributing&#x2F;executing the legitimate code, as opposed to a malicious doppelganger. This is particularly important for tools that rely on it for dependency management, local caches, etc.</div><br/><div id="42556804" class="c"><input type="checkbox" id="c-42556804" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#42555289">parent</a><span>|</span><a href="#42555399">next</a><span>|</span><label class="collapse" for="c-42556804">[-]</label><label class="expand" for="c-42556804">[5 more]</label></div><br/><div class="children"><div class="content">&gt; The practical upshot is a git commit hash is not enough l to know you are distributing&#x2F;executing the legitimate code, as opposed to a malicious doppelganger<p>Really now? Mind if I challenge you?<p>I have on my machine a git repo with commit &#x27;75eb4e3b1369706a4dcd61cc80e49660ac341ea4&#x27;.<p>If you can give me a second git repo with such a commit containing different contents, I&#x27;ll happily send you $10k USD, or donate it to a charity of your choice.</div><br/><div id="42556853" class="c"><input type="checkbox" id="c-42556853" checked=""/><div class="controls bullet"><span class="by">sgjohnson</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42556804">parent</a><span>|</span><a href="#42555399">next</a><span>|</span><label class="collapse" for="c-42556853">[-]</label><label class="expand" for="c-42556853">[4 more]</label></div><br/><div class="children"><div class="content">&gt; If you can give me a second git repo with such a commit containing different contents, I&#x27;ll happily send you $10k USD, or donate it to a charity of your choice.<p>Calculating that SHA1 collision is going to be a bit more expensive than $10k, by a couple of orders of magnitude.<p>Finding it in the wild is improbable, but calculating it is definitely possible, and has been done before. <a href="http:&#x2F;&#x2F;shattered.io&#x2F;" rel="nofollow">http:&#x2F;&#x2F;shattered.io&#x2F;</a></div><br/><div id="42556947" class="c"><input type="checkbox" id="c-42556947" checked=""/><div class="controls bullet"><span class="by">chippiewill</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42556853">parent</a><span>|</span><a href="#42555399">next</a><span>|</span><label class="collapse" for="c-42556947">[-]</label><label class="expand" for="c-42556947">[3 more]</label></div><br/><div class="children"><div class="content">Shattered didn&#x27;t produce a collision for an arbitrary hash, it produced two documents with the same hash (which is a slightly easier problem, about 100,000x faster).<p>SHA1 is certainly insecure at this point, but not even close to trivially so.</div><br/><div id="42557328" class="c"><input type="checkbox" id="c-42557328" checked=""/><div class="controls bullet"><span class="by">codeflo</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42556947">parent</a><span>|</span><a href="#42555399">next</a><span>|</span><label class="collapse" for="c-42557328">[-]</label><label class="expand" for="c-42557328">[2 more]</label></div><br/><div class="children"><div class="content">That is enough to distribute malicious code though, at least in certain scenarios. Someone might create a setup where reviewers check&#x2F;sign one version of the source code, and what gets distributed is another version with the same hash.</div><br/><div id="42557391" class="c"><input type="checkbox" id="c-42557391" checked=""/><div class="controls bullet"><span class="by">ExoticPearTree</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42557328">parent</a><span>|</span><a href="#42555399">next</a><span>|</span><label class="collapse" for="c-42557391">[-]</label><label class="expand" for="c-42557391">[1 more]</label></div><br/><div class="children"><div class="content">Can you create a proof of concept and show it here?</div><br/></div></div></div></div></div></div></div></div></div></div><div id="42555399" class="c"><input type="checkbox" id="c-42555399" checked=""/><div class="controls bullet"><span class="by">onedognight</span><span>|</span><a href="#42555289">parent</a><span>|</span><a href="#42556804">prev</a><span>|</span><a href="#42555552">next</a><span>|</span><label class="collapse" for="c-42555399">[-]</label><label class="expand" for="c-42555399">[1 more]</label></div><br/><div class="children"><div class="content">The is not a full git commit hash collision.  It has to do with a git note which only needs to matche a 12 character prefix of the git commit.</div><br/></div></div><div id="42555552" class="c"><input type="checkbox" id="c-42555552" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42555289">parent</a><span>|</span><a href="#42555399">prev</a><span>|</span><a href="#42555382">next</a><span>|</span><label class="collapse" for="c-42555552">[-]</label><label class="expand" for="c-42555552">[4 more]</label></div><br/><div class="children"><div class="content">people don&#x27;t really care, because current collision methods are mitigated.<p>Git does not actually use &quot;sha1&quot;, despite what all the docs say, it uses &quot;sha1dc&quot;, which is just like sha1 except for inputs which can cause collisions, in which case it either fails with clear error message or returns completely different value.<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17825441">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17825441</a><p>so don&#x27;t worry, git hashes _are_ enough to know you are distributing&#x2F;executing the legitimate code.<p>(not to mention you need a preimage attack to replace known commit, and this is not yet possible with sha1)</div><br/><div id="42555903" class="c"><input type="checkbox" id="c-42555903" checked=""/><div class="controls bullet"><span class="by">akoboldfrying</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42555552">parent</a><span>|</span><a href="#42555382">next</a><span>|</span><label class="collapse" for="c-42555903">[-]</label><label class="expand" for="c-42555903">[3 more]</label></div><br/><div class="children"><div class="content">From your link:<p>&gt;In this case &quot;hash&quot; will be the same as SHA1(input) in all cases, except those where the input is detected to be malicious (as in the SHAttered attack)<p>I don&#x27;t see how this can be more than a fundamentally forward-incompatible sticking plaster over the problem. The problem isn&#x27;t merely that &quot;detecting maliciousness&quot; seems fraught in itself (how does one infer intent reliably?) -- it&#x27;s that today&#x27;s SHA1DC() implementation can only detect and optionally correct <i>today&#x27;s</i> known attacks, so each new attack necessitates a new, incompatible version of SHA1DC().</div><br/><div id="42556294" class="c"><input type="checkbox" id="c-42556294" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42555903">parent</a><span>|</span><a href="#42556277">next</a><span>|</span><label class="collapse" for="c-42556294">[-]</label><label class="expand" for="c-42556294">[1 more]</label></div><br/><div class="children"><div class="content">Each new _unrelated_ SHA1 attack will need an update in SHA1DC. But it has to be truly unrelated, as the collision detection method is fairly robust. I recommend reading the original &quot;Counter-cryptanalysis&quot; paper [0] for details on how attacks work and how they can be mitigated (there is certain internal state in SHA1 that is used in all known attacks). BTW, this paper has an interesting anecdote: apparently Flame malware had exploited MD5 collisions using novel unpublished attack method... and yet it was detected by collision detector  (section 3.2). Another example is that SHA-mbles attack, published 3 years after &quot;Counter-cryptanalysis&quot;, was detected as well, with no required code changes.<p>No, there is nothing &quot;fundamentally incompatible&quot; in the new SHA1DC method. After all, git came out in 2005, 11 years before SHA1 attacks were known, so it used regular SHA1. The collision detector was added in 2017 and nothing broke, because false positive chance is 2^-90 [1].<p>I have not heard of any new SHA1 collision results, but if they are based on no-difference differential paths, git has nothing to worry about. And if they are not, it may be possible to extend DC detector to seamlessly detect and prevent those attacks, and then only upgrade git clients, keeping backward and forward compatibility for data.<p>Of course there is always a chance that someone will come out with all-new SHA1 preimage attack that cannot be detected without high rate of false positive, so it&#x27;s prudent to switch git to sha256. There is a lot of work being done: git&#x27;s sha256 mode went out of beta in 2.42 (2023), but neither github nor gitlab support it.<p>But since the current state of git&#x27;s sha is that there is nothing broken, and git git commit hash _is_ &quot;enough to know you are distributing&#x2F;executing the legitimate code, as opposed to a malicious doppelganger&quot;, there is no real pressure.<p>[0] <a href="https:&#x2F;&#x2F;marc-stevens.nl&#x2F;research&#x2F;papers&#x2F;C13-S.pdf" rel="nofollow">https:&#x2F;&#x2F;marc-stevens.nl&#x2F;research&#x2F;papers&#x2F;C13-S.pdf</a><p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;cr-marcstevens&#x2F;sha1collisiondetection">https:&#x2F;&#x2F;github.com&#x2F;cr-marcstevens&#x2F;sha1collisiondetection</a></div><br/></div></div><div id="42556277" class="c"><input type="checkbox" id="c-42556277" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#42555289">root</a><span>|</span><a href="#42555903">parent</a><span>|</span><a href="#42556294">prev</a><span>|</span><a href="#42555382">next</a><span>|</span><label class="collapse" for="c-42556277">[-]</label><label class="expand" for="c-42556277">[1 more]</label></div><br/><div class="children"><div class="content">Sure it&#x27;s plaster, but plaster can last a good while.  Sufficiently new attacks don&#x27;t come around all that often, and <i>every</i> hash has a risk of new attacks showing up.</div><br/></div></div></div></div></div></div><div id="42555382" class="c"><input type="checkbox" id="c-42555382" checked=""/><div class="controls bullet"><span class="by">shakna</span><span>|</span><a href="#42555289">parent</a><span>|</span><a href="#42555552">prev</a><span>|</span><a href="#42555794">next</a><span>|</span><label class="collapse" for="c-42555382">[-]</label><label class="expand" for="c-42555382">[1 more]</label></div><br/><div class="children"><div class="content">Compatibility between remotes using one or the other hasn&#x27;t arrived yet, and git doesn&#x27;t want to break compatibility. But you can create SHA256 one&#x27;s today. [0]<p>[0] <a href="https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;898522&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;898522&#x2F;</a></div><br/></div></div><div id="42555794" class="c"><input type="checkbox" id="c-42555794" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#42555289">parent</a><span>|</span><a href="#42555382">prev</a><span>|</span><a href="#42555386">next</a><span>|</span><label class="collapse" for="c-42555794">[-]</label><label class="expand" for="c-42555794">[1 more]</label></div><br/><div class="children"><div class="content">The hash space is atoms-in-the-universe range; this is a collision in a much, much smaller subset of that space</div><br/></div></div></div></div><div id="42555386" class="c"><input type="checkbox" id="c-42555386" checked=""/><div class="controls bullet"><span class="by">throw0101d</span><span>|</span><a href="#42555289">prev</a><span>|</span><a href="#42555243">next</a><span>|</span><label class="collapse" for="c-42555386">[-]</label><label class="expand" for="c-42555386">[2 more]</label></div><br/><div class="children"><div class="content">First twelve and last twelve characters are the same:<p><pre><code>    $ echo -n retr0id_662d970782071aa7a038dce6 | sha256sum
    307e0e71a409d2bf67e76c676d81bd0ff87ee228cd8f991714589d0564e6ea9a  -
    
    $ echo -n retr0id_430d19a6c51814d895666635 | sha256sum
    307e0e71a4098e7fb7d72c86cd041a006181c6d8e29882b581d69d0564e6ea9a  -
</code></pre>
* Via: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38668893">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38668893</a></div><br/><div id="42555890" class="c"><input type="checkbox" id="c-42555890" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#42555386">parent</a><span>|</span><a href="#42555243">next</a><span>|</span><label class="collapse" for="c-42555890">[-]</label><label class="expand" for="c-42555890">[1 more]</label></div><br/><div class="children"><div class="content">Oh hey, it&#x27;s me. Shortly after then I did a write-up on how I crafted them, which was discussed here: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38718314">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38718314</a></div><br/></div></div></div></div><div id="42555243" class="c"><input type="checkbox" id="c-42555243" checked=""/><div class="controls bullet"><span class="by">philips</span><span>|</span><a href="#42555386">prev</a><span>|</span><a href="#42556445">next</a><span>|</span><label class="collapse" for="c-42555243">[-]</label><label class="expand" for="c-42555243">[1 more]</label></div><br/><div class="children"><div class="content">Relatedly: Kees&#x27;s keynote on Linux security from a month ago was great: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=orO8czP5Bxw" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=orO8czP5Bxw</a></div><br/></div></div><div id="42556445" class="c"><input type="checkbox" id="c-42556445" checked=""/><div class="controls bullet"><span class="by">timewizard</span><span>|</span><a href="#42555243">prev</a><span>|</span><a href="#42555533">next</a><span>|</span><label class="collapse" for="c-42556445">[-]</label><label class="expand" for="c-42556445">[3 more]</label></div><br/><div class="children"><div class="content">Would tooling break if the radix was changed from 16 to something higher?  You could double your resistance by just changing to base 32 representation in the same length</div><br/><div id="42557063" class="c"><input type="checkbox" id="c-42557063" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#42556445">parent</a><span>|</span><a href="#42555533">next</a><span>|</span><label class="collapse" for="c-42557063">[-]</label><label class="expand" for="c-42557063">[2 more]</label></div><br/><div class="children"><div class="content"><i>So much</i> would break if you changed the character set.  And there would be pretty much no benefit.  Making it a hundred times harder* is not nearly enough to prevent short collisions.<p>* The exact amount would depend on repo and method.  Using base 32 and changing nothing else would slow collisions by 2^length.</div><br/></div></div></div></div><div id="42555533" class="c"><input type="checkbox" id="c-42555533" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#42556445">prev</a><span>|</span><a href="#42556160">next</a><span>|</span><label class="collapse" for="c-42555533">[-]</label><label class="expand" for="c-42555533">[3 more]</label></div><br/><div class="children"><div class="content">In other words, 6 out of 20 bytes match. Good luck colliding the other 112 bits.</div><br/><div id="42555800" class="c"><input type="checkbox" id="c-42555800" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#42555533">parent</a><span>|</span><a href="#42556160">next</a><span>|</span><label class="collapse" for="c-42555800">[-]</label><label class="expand" for="c-42555800">[2 more]</label></div><br/><div class="children"><div class="content">The problem is some (broken and wrong but in the wild) tooling relies on substrings like that</div><br/><div id="42557350" class="c"><input type="checkbox" id="c-42557350" checked=""/><div class="controls bullet"><span class="by">Dilettante_</span><span>|</span><a href="#42555533">root</a><span>|</span><a href="#42555800">parent</a><span>|</span><a href="#42556160">next</a><span>|</span><label class="collapse" for="c-42557350">[-]</label><label class="expand" for="c-42557350">[1 more]</label></div><br/><div class="children"><div class="content">Somebody ought to tell them not to do that! [Spoken in the tone of &#x27;You can&#x27;t park there sir!&#x27;]</div><br/></div></div></div></div></div></div><div id="42556160" class="c"><input type="checkbox" id="c-42556160" checked=""/><div class="controls bullet"><span class="by">cwillu</span><span>|</span><a href="#42555533">prev</a><span>|</span><label class="collapse" for="c-42556160">[-]</label><label class="expand" for="c-42556160">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;people.kernel.org&#x2F;kees&#x2F;colliding-with-the-sha-prefix-of-linuxs-initial-git-commit" rel="nofollow">https:&#x2F;&#x2F;people.kernel.org&#x2F;kees&#x2F;colliding-with-the-sha-prefix...</a> is the actual link; the lwn article is just a link to it with a one sentence summary and a short quote.</div><br/><div id="42556909" class="c"><input type="checkbox" id="c-42556909" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#42556160">parent</a><span>|</span><label class="collapse" for="c-42556909">[-]</label><label class="expand" for="c-42556909">[1 more]</label></div><br/><div class="children"><div class="content">Changed. Thanks!<p>(Submitted URL was <a href="https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;1003797&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;1003797&#x2F;</a>)</div><br/></div></div></div></div></div></div></div></div></div></body></html>