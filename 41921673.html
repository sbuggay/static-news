<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729674074069" as="style"/><link rel="stylesheet" href="styles.css?v=1729674074069"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sqlite.org/forum/forumpost/b7e2d83c0bcfae1e">Migration of the build system to autosetup</a>Â <span class="domain">(<a href="https://sqlite.org">sqlite.org</a>)</span></div><div class="subtext"><span>sgbeal</span> | <span>22 comments</span></div><br/><div><div id="41921674" class="c"><input type="checkbox" id="c-41921674" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921775">next</a><span>|</span><label class="collapse" for="c-41921674">[-]</label><label class="expand" for="c-41921674">[12 more]</label></div><br/><div class="children"><div class="content">OP here!<p>Richard Hipp, of sqlite fame, has announced that the sqlite project plans to reimplement its canonical build process in the 3.48 release cycle. The project will, if all goes as planned, be moving away from the GNU Autotools and towards Steve Bennett&#x27;s Autosetup, which we&#x27;ve used to good effect since 2011 in SQLite&#x27;s sibling project, the Fossil SCM.<p>The primary motivation behind this HN post is to draw eyes to what Richard points out in the linked forum post: this port _will_ break some folks&#x27; build processes and we&#x27;d like to know, in advance, what we&#x27;ll be breaking so that we can make that transition as painless as we can. If you do &quot;unusual&quot; things with the SQLite build, please let us know about it (preferably in the linked-to forum, as that&#x27;s less likely to be overlooked than comments on HN are, but we&#x27;ll be following this thread for at least a few days for those of you who would prefer to voice your thoughts here).</div><br/><div id="41921824" class="c"><input type="checkbox" id="c-41921824" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#41921674">parent</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41921824">[-]</label><label class="expand" for="c-41921824">[7 more]</label></div><br/><div class="children"><div class="content">Conda-forge&#x2F;sqlite-feedstock; recipe&#x2F;meta.yml,<p>recipe&#x2F;build.sh: <a href="https:&#x2F;&#x2F;github.com&#x2F;conda-forge&#x2F;sqlite-feedstock&#x2F;blob&#x2F;main&#x2F;recipe&#x2F;build.sh">https:&#x2F;&#x2F;github.com&#x2F;conda-forge&#x2F;sqlite-feedstock&#x2F;blob&#x2F;main&#x2F;re...</a><p>recipe&#x2F;build.bat: 
<a href="https:&#x2F;&#x2F;github.com&#x2F;conda-forge&#x2F;sqlite-feedstock&#x2F;blob&#x2F;main&#x2F;recipe&#x2F;bld.bat">https:&#x2F;&#x2F;github.com&#x2F;conda-forge&#x2F;sqlite-feedstock&#x2F;blob&#x2F;main&#x2F;re...</a><p>Is there a [multi-stage] Dockerfile to build, install and test SQLite with the new build system?<p>Is there SLSA signing for the SQLite build artifacts? There should be a way to sign OBS Open Build Service packages with sigstore.dev&#x27;s Cosign to Rekor, too IIUC.<p>slsa-framework&#x2F;slsa-github-generator: 
<a href="https:&#x2F;&#x2F;github.com&#x2F;slsa-framework&#x2F;slsa-github-generator">https:&#x2F;&#x2F;github.com&#x2F;slsa-framework&#x2F;slsa-github-generator</a></div><br/><div id="41921861" class="c"><input type="checkbox" id="c-41921861" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921824">parent</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41921861">[-]</label><label class="expand" for="c-41921861">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Conda-forge&#x2F;sqlite-feedstock; recipe&#x2F;meta.yml,<p>Aside from the cross-compilation, which is most definitely part of the process but has not yet been explored in depth[^1], nothing in your build immediately sticks out at as problematic, but i&#x27;ve bookmarked it for future reference during the port.<p>The .bat build (Windows) will not change via this port. Only Unix-like environments will potentially be affected.<p>&gt; Is there a [multi-stage] Dockerfile to build, install and test SQLite with the new build system?<p>Not that the sqlite project maintains, no. None of us use docker in any capacity. We work only from the canonical source tree and we like to think that it&#x27;s easy enough to do that other folks can too.<p>&gt; Is there SLSA signing for the SQLite build artifacts?<p>That&#x27;s out of scope for, and unrelated to, this particular sub-project.<p>&gt; slsa-framework&#x2F;slsa-github-generator: <a href="https:&#x2F;&#x2F;github.com&#x2F;slsa-framework&#x2F;slsa-github-generator">https:&#x2F;&#x2F;github.com&#x2F;slsa-framework&#x2F;slsa-github-generator</a><p>says:<p>&gt; This repository contains free tools to generate and verify SLSA Build Level 3 provenance for native GitHub projects using GitHub Actions.<p>We don&#x27;t use github except to post a read-only mirror of the canonical source tree.<p>[^1]: Autosetup has strong support for cross-compilation, it just hasn&#x27;t yet been tested in the being-ported build process.</div><br/><div id="41921928" class="c"><input type="checkbox" id="c-41921928" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921861">parent</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41921928">[-]</label><label class="expand" for="c-41921928">[5 more]</label></div><br/><div class="children"><div class="content">You can sign built artifacts with cosign without actions or podman[-desktop]&#x2F;docker.<p>It&#x27;s probably possible to trigger gh actions or gl pipelines builds (container, command) with git repo mirroring.<p>datasette-lite depends on a WASM build of SQLite; what about WASM and e.g. <i>emscripten-forge</i> and micromamba?<p>Edit<p>emscripten-forge&#x2F;recipes&#x2F;recipes_emscripten&#x2F;SQLite&#x2F;build.sh: 
<a href="https:&#x2F;&#x2F;github.com&#x2F;emscripten-forge&#x2F;recipes&#x2F;blob&#x2F;main&#x2F;recipes&#x2F;recipes_emscripten&#x2F;sqlite&#x2F;build.sh">https:&#x2F;&#x2F;github.com&#x2F;emscripten-forge&#x2F;recipes&#x2F;blob&#x2F;main&#x2F;recipe...</a> ... recipe.yml says 2022: <a href="https:&#x2F;&#x2F;github.com&#x2F;emscripten-forge&#x2F;recipes&#x2F;blob&#x2F;main&#x2F;recipes&#x2F;recipes_emscripten&#x2F;sqlite&#x2F;recipe.yaml">https:&#x2F;&#x2F;github.com&#x2F;emscripten-forge&#x2F;recipes&#x2F;blob&#x2F;main&#x2F;recipe...</a></div><br/><div id="41921970" class="c"><input type="checkbox" id="c-41921970" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921928">parent</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41921970">[-]</label><label class="expand" for="c-41921970">[4 more]</label></div><br/><div class="children"><div class="content">&gt; You can sign built artifacts with cosign without actions or podman[-desktop]&#x2F;docker.<p>That&#x27;s all out of scope for, and unrelated to, this build port.<p>&gt; It&#x27;s probably possible to trigger gh actions or gl pipelines builds (container, command) with git repo mirroring.<p>We maintain our own SCM, which keeps us far removed from the github ways of doing things.  None of the SQLite project members actively use github beyond posting the read-only project mirror and occasionally cloning other projects and&#x2F;or participating in tickets, and that&#x27;s unlikely to change in any foreseeable future.<p>&gt; emscripten-forge&#x2F;recipes&#x2F;recipes_emscripten&#x2F;SQLite&#x2F;build.sh:<p>Thank you - bookmarked for later perusal and testing.</div><br/><div id="41921992" class="c"><input type="checkbox" id="c-41921992" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921970">parent</a><span>|</span><a href="#41922032">prev</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41921992">[-]</label><label class="expand" for="c-41921992">[2 more]</label></div><br/><div class="children"><div class="content">Same. Thanks<p>What about extensions; does the new build port affect extensions?<p>&#x2F;? hnlog sqlite (190+ mentions)<p>From <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40837610#40842365">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40837610#40842365</a> :<p>- &gt; <i>There are many extensions of SQLite; rqlite</i> (Raft in Go,), <i>cr-sqlite</i> (CRDT in C), <i>postlite</i> (Postgres wire protocol for SQLite)<i>, electricsql</i> (Postgres), <i>sqledge</i> (Postgres), <i>and also WASM: sqlite-wasm, sqlite-wasm-http</i>, dqlite (Raft in Rust),<p>awesome-sqlite</div><br/><div id="41922036" class="c"><input type="checkbox" id="c-41922036" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921992">parent</a><span>|</span><a href="#41922259">next</a><span>|</span><label class="collapse" for="c-41922036">[-]</label><label class="expand" for="c-41922036">[1 more]</label></div><br/><div class="children"><div class="content">&gt; What about extensions; does the new bill port affect extensions?<p>It won&#x27;t, in any way, affect how third parties use the conventional project headers and amalgamated sources. It only has the potential to affect folks who use the &quot;.&#x2F;configure &amp;&amp; make&quot; build process, as differences between the Autotools and Autosetup make it impossible to retain 100% semantic compatibility with the build processes (for reasons described one link removed from the forum post this HN post links to).</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="41921848" class="c"><input type="checkbox" id="c-41921848" checked=""/><div class="controls bullet"><span class="by">fhdsgbbcaA</span><span>|</span><a href="#41921674">parent</a><span>|</span><a href="#41922259">prev</a><span>|</span><a href="#41921775">next</a><span>|</span><label class="collapse" for="c-41921848">[-]</label><label class="expand" for="c-41921848">[3 more]</label></div><br/><div class="children"><div class="content">.</div><br/><div id="41921868" class="c"><input type="checkbox" id="c-41921868" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921848">parent</a><span>|</span><a href="#41921874">next</a><span>|</span><label class="collapse" for="c-41921868">[-]</label><label class="expand" for="c-41921868">[1 more]</label></div><br/><div class="children"><div class="content">&gt; ... you may want to repost again in 12 hours for more eyes.<p>Duplicate threads are a plague ;).<p>Posting a second time will only lead to chaos as i try to juggle multiple threads while continuing work on the posted-about build port.</div><br/></div></div><div id="41921874" class="c"><input type="checkbox" id="c-41921874" checked=""/><div class="controls bullet"><span class="by">billfruit</span><span>|</span><a href="#41921674">root</a><span>|</span><a href="#41921848">parent</a><span>|</span><a href="#41921868">prev</a><span>|</span><a href="#41921775">next</a><span>|</span><label class="collapse" for="c-41921874">[-]</label><label class="expand" for="c-41921874">[1 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t Bangalore as important as California.</div><br/></div></div></div></div></div></div><div id="41921775" class="c"><input type="checkbox" id="c-41921775" checked=""/><div class="controls bullet"><span class="by">markasoftware</span><span>|</span><a href="#41921674">prev</a><span>|</span><label class="collapse" for="c-41921775">[-]</label><label class="expand" for="c-41921775">[9 more]</label></div><br/><div class="children"><div class="content">Why autosetup? Because it&#x27;ll hopefully keep the build commands the same? Or are there more fundamental reasons to prefer it over cmake?</div><br/><div id="41921801" class="c"><input type="checkbox" id="c-41921801" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921775">parent</a><span>|</span><a href="#41921879">next</a><span>|</span><label class="collapse" for="c-41921801">[-]</label><label class="expand" for="c-41921801">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Why autosetup?<p>A link in the original post leads to a description of the motivation for the port. TL;DR: we&#x27;ve used Autosetup since 2011 in SQLite&#x27;s sibling, the Fossil SCM, and we quite like it.<p>&gt; Or are there more fundamental reasons to prefer it over cmake?<p>CMake is an out-of-tree tool, which is something the project tries to avoid at all costs for portability and maintainability reasons.  GNU Autotools lives halfway in-tree and halfway out-of-tree. It&#x27;s ubiquitous but also often problematic to upgrade, and is subject to breakage when project developers have different versions of the Autotools installed on their systems.  Richard very specifically keeps an ancient version of Autotools on his system to reduce that pain, but that&#x27;s not a satisfying situation to be in.<p>Autosetup, on the other hand, lives entirely in the project&#x27;s source tree, meaning we have not only consistency across all developers&#x27; machines, but also complete control over when to upgrade (or not) the tools.  Over the past 13ish years of using Autosetup in the Fossil SCM we have never had any significant upgrade-related pains.</div><br/><div id="41922160" class="c"><input type="checkbox" id="c-41922160" checked=""/><div class="controls bullet"><span class="by">chipdart</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41921801">parent</a><span>|</span><a href="#41921879">next</a><span>|</span><label class="collapse" for="c-41922160">[-]</label><label class="expand" for="c-41922160">[5 more]</label></div><br/><div class="children"><div class="content">&gt; CMake is an out-of-tree tool, which is something the project tries to avoid at all costs for portability and maintainability reasons.<p>Is this relevant though? Portability is not dictated by whether you vend a tool within your project tree, and maintainability is only remotely relevant if you&#x27;re planning on customizing the tool instead of the scripts executed by the tool, which would be silly.<p>I mean, there is no wrong in just coming forward and stating that you&#x27;re already using a build system in another project and you&#x27;re hoping to lower maintenance costs by standardizing on a single build system that you&#x27;re already using. All other arguments sound dubious at best.</div><br/><div id="41922277" class="c"><input type="checkbox" id="c-41922277" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41922160">parent</a><span>|</span><a href="#41921879">next</a><span>|</span><label class="collapse" for="c-41922277">[-]</label><label class="expand" for="c-41922277">[4 more]</label></div><br/><div class="children"><div class="content">&gt; &gt; CMake is an out-of-tree tool, which is something the project tries to avoid at all costs for portability and maintainability reasons.<p>&gt; Is this relevant though?<p>For this project and its day-to-day maintenance, unequivocally.<p>One of Richard&#x27;s philosophies is &quot;freedom means being able to take care of yourself,&quot; and that philosophy permeates all of his software projects, which eschew external dependencies because every single one reduces the project&#x27;s level of freedom.  Every time a third-party tool breaks, or introduces new, incompatible behavior as part of an upgrade, dependents of that tool suffer[^1].  All of Richard&#x27;s projects have a strong culture of avoiding that suffering by avoiding third-party dependencies where at all possible, to the point of sometimes reinventing the wheel to extreme degrees (like implementing his own SCM).<p>That aspect aside, nobody in the SQLite project uses CMake, so it would never occur to us to migrate the build process to it.  We write our own makefiles by hand _and we like it that way_.  (Sidebar: Autosetup neither writes our makefiles nor introduces new syntax for doing so, in contrast to CMake.)<p>&gt; I mean, there is no wrong in just coming forward and stating that you&#x27;re already using a build system in another project and you&#x27;re hoping to lower maintenance costs by standardizing on a single build system that you&#x27;re already using. All other arguments sound dubious at best.<p>This isn&#x27;t about standardizing on one build process, but about simplifying the lives of the developers and future maintenance of the project. We can&#x27;t do that by porting to tools we don&#x27;t otherwise use.  If we weren&#x27;t using Autosetup in other trees, and weren&#x27;t happy with it, we wouldn&#x27;t have even considered undertaking this effort and facing the downstream upheaval it will undoubtedly cause.  We know, however, from 13 years of experience with it, that this tool does what we want, is low friction, and causes us an amount of grief which closely approaches zero[^2]. Without our collective background with Autosetup, we wouldn&#x27;t have even considered porting away from the Autotools because that would be a case of &quot;out of the frying pan and into the oven.&quot;<p>[^1]: As a concrete example: the SQLite project&#x27;s WASM build is 100% dependent on the Emscripten toolchain for the simple reason that there is no feasible alternative. A handful of times over the past two years we have had to accommodate incompatible changes when upgrading Emscripten. That&#x27;s hassle nobody wants. Obviously, software has to evolve, but being able to embed our build tools (Autosetup) directly in the source tree gives us control over the pace of that evolution. No system-wide upgrade is going to pull it out from under us, nor will it behave differently on downstream folks&#x27; machines.<p>[^2]: You won&#x27;t ever hear me say that _any_ software is 100% grief-free, but autosetup is as close to it as, e.g., the bash shell.</div><br/><div id="41922338" class="c"><input type="checkbox" id="c-41922338" checked=""/><div class="controls bullet"><span class="by">chipdart</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41922277">parent</a><span>|</span><a href="#41921879">next</a><span>|</span><label class="collapse" for="c-41922338">[-]</label><label class="expand" for="c-41922338">[3 more]</label></div><br/><div class="children"><div class="content">&gt; For this project and its day-to-day maintenance, unequivocally.<p>Insisting on personal assertions does not pass as a justification, particularly one based on such specious reasoning.<p>&gt; One of Richard&#x27;s philosophies is &quot;freedom means being able to take care of yourself,&quot; (...)<p>That&#x27;s fine. Irrelevant to the discussion, though. If you&#x27;re really really concerned with somehow losing access to a build tool managed by a third-party, nothing prevents you from storing the tool anywhere, including in a separate Git repository.<p>Just say it&#x27;s personal taste and technical merits play no role in the decision. All these wild claims just sound silly.</div><br/><div id="41923166" class="c"><input type="checkbox" id="c-41923166" checked=""/><div class="controls bullet"><span class="by">pjc50</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41922338">parent</a><span>|</span><a href="#41922403">next</a><span>|</span><label class="collapse" for="c-41923166">[-]</label><label class="expand" for="c-41923166">[1 more]</label></div><br/><div class="children"><div class="content">This is such a HN answer, presenting your own personal taste as technical merits and the technical merits of other&#x27;s approaches as wild claims.</div><br/></div></div><div id="41922403" class="c"><input type="checkbox" id="c-41922403" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41922338">parent</a><span>|</span><a href="#41923166">prev</a><span>|</span><a href="#41921879">next</a><span>|</span><label class="collapse" for="c-41922403">[-]</label><label class="expand" for="c-41922403">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  Just say it&#x27;s personal taste and technical merits play no role in the decision.<p>Reducing long-term maintenance burden and simplifying the developers&#x27; work is arguably the best technical merit we could hope for.<p>&gt; All these wild claims just sound silly.<p>And, with that, i&#x27;m stepping out of this sub-thread.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41921879" class="c"><input type="checkbox" id="c-41921879" checked=""/><div class="controls bullet"><span class="by">wolf550e</span><span>|</span><a href="#41921775">parent</a><span>|</span><a href="#41921801">prev</a><span>|</span><label class="collapse" for="c-41921879">[-]</label><label class="expand" for="c-41921879">[2 more]</label></div><br/><div class="children"><div class="content">They prefer tcl as the scripting language and they like the maintainer.</div><br/><div id="41921893" class="c"><input type="checkbox" id="c-41921893" checked=""/><div class="controls bullet"><span class="by">sgbeal</span><span>|</span><a href="#41921775">root</a><span>|</span><a href="#41921879">parent</a><span>|</span><label class="collapse" for="c-41921893">[-]</label><label class="expand" for="c-41921893">[1 more]</label></div><br/><div class="children"><div class="content">&gt; They prefer tcl as the scripting language and they like the maintainer.<p>That&#x27;s most definitely a big part of it, but see my other response in this sub-thread for other aspects which are equally important for the project.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>