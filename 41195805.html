<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1723539678927" as="style"/><link rel="stylesheet" href="styles.css?v=1723539678927"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.enterpriseintegrationpatterns.com/ramblings/queues_flow_control.html">Queues invert control flow but require flow control</a> <span class="domain">(<a href="https://www.enterpriseintegrationpatterns.com">www.enterpriseintegrationpatterns.com</a>)</span></div><div class="subtext"><span>alexzeitler</span> | <span>11 comments</span></div><br/><div><div id="41230749" class="c"><input type="checkbox" id="c-41230749" checked=""/><div class="controls bullet"><span class="by">taeric</span><span>|</span><a href="#41231388">next</a><span>|</span><label class="collapse" for="c-41230749">[-]</label><label class="expand" for="c-41230749">[4 more]</label></div><br/><div class="children"><div class="content">I always wish more metaphors were built using conveyor belts in these discussions.  It helps me mentally underscore that you have to pay attention to what queue&#x2F;belt you load and why you need to give that a lot of thought.<p>Granted, I&#x27;m probably mostly afraid of diving into factorio again. :D</div><br/><div id="41232017" class="c"><input type="checkbox" id="c-41232017" checked=""/><div class="controls bullet"><span class="by">jimbokun</span><span>|</span><a href="#41230749">parent</a><span>|</span><a href="#41232846">next</a><span>|</span><label class="collapse" for="c-41232017">[-]</label><label class="expand" for="c-41232017">[1 more]</label></div><br/><div class="children"><div class="content">Like Lucy in the chocolate factory.</div><br/></div></div><div id="41232846" class="c"><input type="checkbox" id="c-41232846" checked=""/><div class="controls bullet"><span class="by">golergka</span><span>|</span><a href="#41230749">parent</a><span>|</span><a href="#41232017">prev</a><span>|</span><a href="#41231005">next</a><span>|</span><label class="collapse" for="c-41232846">[-]</label><label class="expand" for="c-41232846">[1 more]</label></div><br/><div class="children"><div class="content">Playing Factorio has indeed given me a much better understanding of how congestion works in complex systems.</div><br/></div></div><div id="41231005" class="c"><input type="checkbox" id="c-41231005" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#41230749">parent</a><span>|</span><a href="#41232846">prev</a><span>|</span><a href="#41231388">next</a><span>|</span><label class="collapse" for="c-41231005">[-]</label><label class="expand" for="c-41231005">[1 more]</label></div><br/><div class="children"><div class="content">The Spintronics mechanical circuits game is sort of like conveyor belts.<p>Electrons are not individually identified like things on a conveyor belt.<p>Electrons in conductors, semiconductors, and superconductors do behave like fluids.<p>Turing tapes; <a href="https:&#x2F;&#x2F;hackaday.com&#x2F;2016&#x2F;08&#x2F;18&#x2F;the-turing-tapes&#x2F;" rel="nofollow">https:&#x2F;&#x2F;hackaday.com&#x2F;2016&#x2F;08&#x2F;18&#x2F;the-turing-tapes&#x2F;</a><p>Theory of computation &gt; Models of computation: 
<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Theory_of_computation" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Theory_of_computation</a></div><br/></div></div></div></div><div id="41231388" class="c"><input type="checkbox" id="c-41231388" checked=""/><div class="controls bullet"><span class="by">stickfigure</span><span>|</span><a href="#41230749">prev</a><span>|</span><a href="#41230837">next</a><span>|</span><label class="collapse" for="c-41231388">[-]</label><label class="expand" for="c-41231388">[5 more]</label></div><br/><div class="children"><div class="content">This article is weird because it conflates queues with pub&#x2F;sub systems. Even to the point of comparing Amazon SQS with Google Pub&#x2F;Sub rather than the closer analogue, Cloud Tasks.<p>I&#x27;ve pushed queues from Amazon and Google to thousands of qps and never found their limits. Flow control is unnecessary; the queue either grows or shrinks, and you adjust processing to compensate (ideally by autoscaling). If the queue depth grows continuously and you can&#x27;t keep up, you work on the architecture (or budget) problems.<p>If you&#x27;re storing so much data in queues that you&#x27;re hitting the storage limits of something like SQS, you are using the wrong tool for the job. It&#x27;s not a database.</div><br/><div id="41233339" class="c"><input type="checkbox" id="c-41233339" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41231388">parent</a><span>|</span><a href="#41232555">next</a><span>|</span><label class="collapse" for="c-41233339">[-]</label><label class="expand" for="c-41233339">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Flow control is unnecessary
&gt; compensate (ideally by autoscaling)<p>Isn&#x27;t that flow control of a different form?  It&#x27;s a new form enabled by the cloud moreso than any previous technology,  but it really does seem like a version of &quot;egress based flow control&quot; to me;  except,  we&#x27;re widening the output rather than narrowing it.<p>Queue failures are just a destructive form of back pressure.</div><br/></div></div><div id="41232555" class="c"><input type="checkbox" id="c-41232555" checked=""/><div class="controls bullet"><span class="by">lunatuna</span><span>|</span><a href="#41231388">parent</a><span>|</span><a href="#41233339">prev</a><span>|</span><a href="#41232057">next</a><span>|</span><label class="collapse" for="c-41232555">[-]</label><label class="expand" for="c-41232555">[1 more]</label></div><br/><div class="children"><div class="content">I’ve worked with on prem and now AWS. Even being on AWS I think the first part of the article is great.  Nice visual and description. When on prem, scaling was an issue during event storms. But by then we at least had enough to know what the problem was.<p>Scaling the number of messages is no longer an issue for us using SQS but size is. Basically there are still constraints. We then need to pass references. “Details created etc find it here”. On prem we could dump around 25 MB into message without issue and could go to 50 MB but it wasn’t safe.<p>I get your point on the queue and pub&#x2F;sub not being the same. Just to note we do a lot of hybrid and expect others do to. Publish to a topic and bridge to queues. Fan out is easy and gives choice. I don’t know google’s version, with TIBCO EMS this was easy to manage and was clear to everyone. If you wanted to listen to everything on prod.alerts.* you could or if you want to process prod.alerts.devices.headend you could just queue it and process all.<p>We use queues like storage for long outages so that senders don’t have to change anything. Not a great use but people were sure happy to know we could help by holding all the events while they could deal with their mess. Never got close to any limit when doing this on prem.<p>Never used it but isn’t the idea of Kafka to hold all events like a database? Love the idea. Seems so lazy and useful at the same time.  Now that I write this I can see the danger too. You become a transaction system of record. Ugh. That’s someone else’s problem ;).</div><br/></div></div><div id="41232057" class="c"><input type="checkbox" id="c-41232057" checked=""/><div class="controls bullet"><span class="by">two_handfuls</span><span>|</span><a href="#41231388">parent</a><span>|</span><a href="#41232555">prev</a><span>|</span><a href="#41231566">next</a><span>|</span><label class="collapse" for="c-41232057">[-]</label><label class="expand" for="c-41232057">[1 more]</label></div><br/><div class="children"><div class="content">You make a good point: if we’re always able to scale out the consumer, then we never need flow control to slow down the producer.</div><br/></div></div><div id="41231566" class="c"><input type="checkbox" id="c-41231566" checked=""/><div class="controls bullet"><span class="by">Joel_Mckay</span><span>|</span><a href="#41231388">parent</a><span>|</span><a href="#41232057">prev</a><span>|</span><a href="#41230837">next</a><span>|</span><label class="collapse" for="c-41231566">[-]</label><label class="expand" for="c-41231566">[1 more]</label></div><br/><div class="children"><div class="content">It also assumes the producer and consumer are monolith-bound data streams. Almost all AMQP back-ends include traffic message-pattern smart-message-routing to pre-sort the data as kind of an implicit sharding operation. This pattern is also particularly performant using static route definitions.<p>Unless one is using Elixir&#x2F;Erlang channels, than eventually one must glue on the equivalent queue structure to handle concurrency spikes. Note, this is less to  do bandwidth peaks, but rather the OS ISO&#x2F;OSI limitations will become the bottleneck for concurrency.<p>If your data traffic is truly separable, than it is trivial load-balancing across multiple pattern-matching routing consumers. Thus, you get pre-sharded localized data, and simply avoid the stores state-syncing cost on back-channel links.<p>If one has over 40k users, than they should already have re-discovered this phenomena. Simply repeat the mantra &quot;concurrent consumers should never share state&quot;. =3</div><br/></div></div></div></div><div id="41230837" class="c"><input type="checkbox" id="c-41230837" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#41231388">prev</a><span>|</span><label class="collapse" for="c-41230837">[-]</label><label class="expand" for="c-41230837">[1 more]</label></div><br/><div class="children"><div class="content">Backpressure matters.</div><br/></div></div></div></div></div></div></div></body></html>