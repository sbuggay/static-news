<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707296468241" as="style"/><link rel="stylesheet" href="styles.css?v=1707296468241"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/cztomsik/tokamak">Show HN: Tokamak – Server-side framework for Zig</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>cztomsik</span> | <span>15 comments</span></div><br/><div><div id="39284911" class="c"><input type="checkbox" id="c-39284911" checked=""/><div class="controls bullet"><span class="by">latch</span><span>|</span><a href="#39283839">next</a><span>|</span><label class="collapse" for="c-39284911">[-]</label><label class="expand" for="c-39284911">[4 more]</label></div><br/><div class="children"><div class="content">As a Zig developer with one of the more popular HTTP server libraries around (http.zig), this is impressive and good use of comptime and (good) abuse of Zig&#x27;s anytype. I&#x27;m looking forward to learning from the codebase.<p>But, it&#x27;s very slow. A quick test shows Sinatra is about 2x faster. Maybe I&#x27;m in the minority, but I feel that a primary reason to give up a GC is for performance.</div><br/><div id="39284995" class="c"><input type="checkbox" id="c-39284995" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#39284911">parent</a><span>|</span><a href="#39283839">next</a><span>|</span><label class="collapse" for="c-39284995">[-]</label><label class="expand" for="c-39284995">[3 more]</label></div><br/><div class="children"><div class="content">This is really weird; it&#x27;s not even obvious how to spend so much time in this code. By any chance, have you tried profiling? Just really curious.</div><br/><div id="39285401" class="c"><input type="checkbox" id="c-39285401" checked=""/><div class="controls bullet"><span class="by">latch</span><span>|</span><a href="#39284911">root</a><span>|</span><a href="#39284995">parent</a><span>|</span><a href="#39283839">next</a><span>|</span><label class="collapse" for="c-39285401">[-]</label><label class="expand" for="c-39285401">[2 more]</label></div><br/><div class="children"><div class="content">Like many http server implementations in Zig, this is a wrapper around `std.http.Server`. `std.http.Server` only exists as a mechanism to test the `std.http.Client` (which is needed for things like, downloading packages). So `std.http.Server` isn&#x27;t built to be fast, secure or robust.<p>I believe you _can_ get keepalive working with `std.http.Server`, but it seems like Tokamak isn&#x27;t using it that way. The implementation is a thread-per-connection. Those are the two most obvious issues specific to this implementation.<p>But I believe the bulk of the issues relate to `std.http.Server`. It shouldn&#x27;t be public&#x2F;used.</div><br/><div id="39286127" class="c"><input type="checkbox" id="c-39286127" checked=""/><div class="controls bullet"><span class="by">cztomsik</span><span>|</span><a href="#39284911">root</a><span>|</span><a href="#39285401">parent</a><span>|</span><a href="#39283839">next</a><span>|</span><label class="collapse" for="c-39286127">[-]</label><label class="expand" for="c-39286127">[1 more]</label></div><br/><div class="children"><div class="content">Oh, I didn&#x27;t know std.http.Server is not supposed to be used. I guess I could just use your project and that would fix that perf issue? And do a thread-pool and keep-alive, of course.<p>TBH perf was not my priority yet, I only wanted predictable memory usage and Zig was perfect choice for that (when compared to node.js).</div><br/></div></div></div></div></div></div></div></div><div id="39283839" class="c"><input type="checkbox" id="c-39283839" checked=""/><div class="controls bullet"><span class="by">twarge</span><span>|</span><a href="#39284911">prev</a><span>|</span><a href="#39284958">next</a><span>|</span><label class="collapse" for="c-39283839">[-]</label><label class="expand" for="c-39283839">[1 more]</label></div><br/><div class="children"><div class="content">the name tokamak - funny choice! Will barely achieve fusion with an huge and complex implementation. Surely not the intended implicature.</div><br/></div></div><div id="39284958" class="c"><input type="checkbox" id="c-39284958" checked=""/><div class="controls bullet"><span class="by">apitman</span><span>|</span><a href="#39283839">prev</a><span>|</span><a href="#39271756">next</a><span>|</span><label class="collapse" for="c-39284958">[-]</label><label class="expand" for="c-39284958">[1 more]</label></div><br/><div class="children"><div class="content">Interesting. What mechanism does Zig use to hook up function argument dynamically depending on what is declared in the function (or am I reading that wrong)? Not sure I&#x27;ve ever seen something quite like it.</div><br/></div></div><div id="39271756" class="c"><input type="checkbox" id="c-39271756" checked=""/><div class="controls bullet"><span class="by">mbStavola</span><span>|</span><a href="#39284958">prev</a><span>|</span><a href="#39283865">next</a><span>|</span><label class="collapse" for="c-39271756">[-]</label><label class="expand" for="c-39271756">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not a Zig programmer, but this framework seems pretty nice! Honestly, a lot nicer than I would&#x27;ve expected from a language that explicitly targets lower-level dev[1].<p>[1]: Rust also has a focus on low-level programming, but has many higher level constructs &#x2F; a more complicated type system so I&#x27;m not too surprised when I see nice web frameworks in that ecosystem</div><br/><div id="39272292" class="c"><input type="checkbox" id="c-39272292" checked=""/><div class="controls bullet"><span class="by">cztomsik</span><span>|</span><a href="#39271756">parent</a><span>|</span><a href="#39283865">next</a><span>|</span><label class="collapse" for="c-39272292">[-]</label><label class="expand" for="c-39272292">[3 more]</label></div><br/><div class="children"><div class="content">I think there are multiple reasons why Zig is great fit for this:<p>- zig has powerful meta-programming, it&#x27;s a bit like functional programming with structs. I would consider that high-level concept, at least comparable to traits and constraints<p>- zig has anytype duck-typing. in any function, you can say that some arg is anytype, and then you can pass anything to it. type-checking still works, because it&#x27;s done when you actually instantiate the function with known type. this is great for flat and simple API surface.<p>- server-side code usually have short life-time (request), so you can just use arena for all allocations, and free everything when you finish, this is super-simple to do in zig, because every api accepts allocator if it needs to allocate. rust arenas have lifetimes, which makes them problematic to use&#x2F;embed deep down in the hiearchy. zig is not aiming for 100% safety so this is easy.</div><br/><div id="39284170" class="c"><input type="checkbox" id="c-39284170" checked=""/><div class="controls bullet"><span class="by">saghm</span><span>|</span><a href="#39271756">root</a><span>|</span><a href="#39272292">parent</a><span>|</span><a href="#39283865">next</a><span>|</span><label class="collapse" for="c-39284170">[-]</label><label class="expand" for="c-39284170">[2 more]</label></div><br/><div class="children"><div class="content">&gt; - zig has anytype duck-typing. in any function, you can say that some arg is anytype, and then you can pass anything to it. type-checking still works, because it&#x27;s done when you actually instantiate the function with known type. this is great for flat and simple API surface.<p>Is this any different from generics? Rust lets you define arguments with `impl Trait` as a shorthand for a generic type `T: Trait`, but this sounds pretty similar to just defining a function over a generic type `T`, albeit with different syntax.</div><br/><div id="39286160" class="c"><input type="checkbox" id="c-39286160" checked=""/><div class="controls bullet"><span class="by">cztomsik</span><span>|</span><a href="#39271756">root</a><span>|</span><a href="#39284170">parent</a><span>|</span><a href="#39283865">next</a><span>|</span><label class="collapse" for="c-39286160">[-]</label><label class="expand" for="c-39286160">[1 more]</label></div><br/><div class="children"><div class="content">same thing, done in a different way. the only notable difference (except of writing less code) is that zig does not type-check the code which you don&#x27;t use, so the genericity goes a bit further than what you can do in rust.</div><br/></div></div></div></div></div></div></div></div><div id="39283865" class="c"><input type="checkbox" id="c-39283865" checked=""/><div class="controls bullet"><span class="by">myko</span><span>|</span><a href="#39271756">prev</a><span>|</span><a href="#39260181">next</a><span>|</span><label class="collapse" for="c-39283865">[-]</label><label class="expand" for="c-39283865">[1 more]</label></div><br/><div class="children"><div class="content">Any relation to <a href="https:&#x2F;&#x2F;github.com&#x2F;TokamakUI&#x2F;Tokamak">https:&#x2F;&#x2F;github.com&#x2F;TokamakUI&#x2F;Tokamak</a>?</div><br/></div></div><div id="39260181" class="c"><input type="checkbox" id="c-39260181" checked=""/><div class="controls bullet"><span class="by">jedisct1</span><span>|</span><a href="#39283865">prev</a><span>|</span><label class="collapse" for="c-39260181">[-]</label><label class="expand" for="c-39260181">[3 more]</label></div><br/><div class="children"><div class="content">Looks great! Also TIL about AVA <a href="https:&#x2F;&#x2F;github.com&#x2F;cztomsik&#x2F;ava">https:&#x2F;&#x2F;github.com&#x2F;cztomsik&#x2F;ava</a></div><br/><div id="39264288" class="c"><input type="checkbox" id="c-39264288" checked=""/><div class="controls bullet"><span class="by">cztomsik</span><span>|</span><a href="#39260181">parent</a><span>|</span><label class="collapse" for="c-39264288">[-]</label><label class="expand" for="c-39264288">[2 more]</label></div><br/><div class="children"><div class="content">thanks :) yeah, ava is my pet project, but there was very little activity lately because I was tight on deadline with another project. I hope to get back to it around next week.</div><br/><div id="39273723" class="c"><input type="checkbox" id="c-39273723" checked=""/><div class="controls bullet"><span class="by">jedisct1</span><span>|</span><a href="#39260181">root</a><span>|</span><a href="#39264288">parent</a><span>|</span><label class="collapse" for="c-39273723">[-]</label><label class="expand" for="c-39273723">[1 more]</label></div><br/><div class="children"><div class="content">I love it, especially the Quick Tools tab. Powerful yet easy to use. That&#x27;s the best LLM UI I&#x27;ve seen so far, and it immediately replaced Private LLM (even though I paid for it).</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>