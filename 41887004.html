<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729414851290" as="style"/><link rel="stylesheet" href="styles.css?v=1729414851290"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/awslabs/git-remote-s3">S3 as a Git remote and LFS server</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>kbumsik</span> | <span>26 comments</span></div><br/><div><div id="41889095" class="c"><input type="checkbox" id="c-41889095" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41890917">next</a><span>|</span><label class="collapse" for="c-41889095">[-]</label><label class="expand" for="c-41889095">[11 more]</label></div><br/><div class="children"><div class="content">All this mocking when moto exists is just :-( <a href="https:&#x2F;&#x2F;github.com&#x2F;awslabs&#x2F;git-remote-s3&#x2F;blob&#x2F;v0.1.19&#x2F;test&#x2F;remote_test.py">https:&#x2F;&#x2F;github.com&#x2F;awslabs&#x2F;git-remote-s3&#x2F;blob&#x2F;v0.1.19&#x2F;test&#x2F;r...</a><p>Actually, moto is just one bandaid for that problem - there are SO MANY s3 storage implementations, including the pre-license-switch Apache 2 version of minio (one need not use a bleeding edge for something as relatively stable as the S3 Api)</div><br/><div id="41889525" class="c"><input type="checkbox" id="c-41889525" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41889095">parent</a><span>|</span><a href="#41889194">next</a><span>|</span><label class="collapse" for="c-41889525">[-]</label><label class="expand" for="c-41889525">[4 more]</label></div><br/><div class="children"><div class="content">&gt; there are SO MANY s3 storage implementations<p>I suppose given this is under the AWS Labs org, they don’t really care about non-AWS S3 implementations.</div><br/><div id="41889981" class="c"><input type="checkbox" id="c-41889981" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889525">parent</a><span>|</span><a href="#41889194">next</a><span>|</span><label class="collapse" for="c-41889981">[-]</label><label class="expand" for="c-41889981">[3 more]</label></div><br/><div class="children"><div class="content">Well, I look forward to their `docker run awslabs&#x2F;the-real-s3:latest` implementation then. Until such time, monkeypatching api calls to always give the exact answer the consumer is looking for is damn cheating</div><br/><div id="41890250" class="c"><input type="checkbox" id="c-41890250" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889981">parent</a><span>|</span><a href="#41890151">next</a><span>|</span><label class="collapse" for="c-41890250">[-]</label><label class="expand" for="c-41890250">[1 more]</label></div><br/><div class="children"><div class="content">Agreed, haha. Well, I think it <i>should</i> work with Minio &amp; co. just as well, but be prepared to have your issues closed as unsupported. (Pesonally, I might give it a go with Backblaze B2 just to play around, yeah)</div><br/></div></div><div id="41890151" class="c"><input type="checkbox" id="c-41890151" checked=""/><div class="controls bullet"><span class="by">chrsig</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889981">parent</a><span>|</span><a href="#41890250">prev</a><span>|</span><a href="#41889194">next</a><span>|</span><label class="collapse" for="c-41890151">[-]</label><label class="expand" for="c-41890151">[1 more]</label></div><br/><div class="children"><div class="content">it wouldn&#x27;t be unprecedented.  dynamodb-local exists.</div><br/></div></div></div></div></div></div><div id="41889194" class="c"><input type="checkbox" id="c-41889194" checked=""/><div class="controls bullet"><span class="by">SahAssar</span><span>|</span><a href="#41889095">parent</a><span>|</span><a href="#41889525">prev</a><span>|</span><a href="#41890917">next</a><span>|</span><label class="collapse" for="c-41889194">[-]</label><label class="expand" for="c-41889194">[6 more]</label></div><br/><div class="children"><div class="content">Do you mean boto (the python SDK for AWS)?<p>EDIT: They probably do not, I&#x27;m guessing they mean <a href="https:&#x2F;&#x2F;docs.getmoto.org&#x2F;en&#x2F;latest&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;docs.getmoto.org&#x2F;en&#x2F;latest&#x2F;index.html</a> ?</div><br/><div id="41889381" class="c"><input type="checkbox" id="c-41889381" checked=""/><div class="controls bullet"><span class="by">flakes</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889194">parent</a><span>|</span><a href="#41890011">next</a><span>|</span><label class="collapse" for="c-41889381">[-]</label><label class="expand" for="c-41889381">[2 more]</label></div><br/><div class="children"><div class="content">moto server for testing S3 is pretty great. It’s about the same experience as using a minio container to run integration tests against.<p>I use this, and testing.postgresql for unit testing my api servers with barely any mocks used at all.</div><br/><div id="41890282" class="c"><input type="checkbox" id="c-41890282" checked=""/><div class="controls bullet"><span class="by">neeleshs</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889381">parent</a><span>|</span><a href="#41890011">next</a><span>|</span><label class="collapse" for="c-41890282">[-]</label><label class="expand" for="c-41890282">[1 more]</label></div><br/><div class="children"><div class="content">There is also testcontainers. Supports multiple languages. Uses containers though.<p><a href="https:&#x2F;&#x2F;testcontainers-python.readthedocs.io&#x2F;en&#x2F;latest&#x2F;" rel="nofollow">https:&#x2F;&#x2F;testcontainers-python.readthedocs.io&#x2F;en&#x2F;latest&#x2F;</a></div><br/></div></div></div></div><div id="41890011" class="c"><input type="checkbox" id="c-41890011" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41889194">parent</a><span>|</span><a href="#41889381">prev</a><span>|</span><a href="#41890917">next</a><span>|</span><label class="collapse" for="c-41890011">[-]</label><label class="expand" for="c-41890011">[3 more]</label></div><br/><div class="children"><div class="content">Happy 10,000th Day to you :-D Yes, moto and its friend localstack are just fantastic for being able to play with AWS without spending money, or to reproduce kabooms that only happen once a month with the real API<p>I believe moto has an &quot;embedded&quot; version such that one need not even have in listen on a network port, but I find it much, much less mental gymnastics to just supersede the &quot;endpoint&quot; address in the actual AWS SDKs to point to 127.0.0.1:4566 and off to the races. The AWS SDKs are even so friendly as to not mandate TLS or have allowlists of endpoint addresses, unlike their misguided Azure colleagues</div><br/><div id="41890155" class="c"><input type="checkbox" id="c-41890155" checked=""/><div class="controls bullet"><span class="by">SahAssar</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41890011">parent</a><span>|</span><a href="#41890917">next</a><span>|</span><label class="collapse" for="c-41890155">[-]</label><label class="expand" for="c-41890155">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Happy 10,000th Day to you :-D<p>Sorry, not sure what you mean?</div><br/><div id="41890180" class="c"><input type="checkbox" id="c-41890180" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41889095">root</a><span>|</span><a href="#41890155">parent</a><span>|</span><a href="#41890917">next</a><span>|</span><label class="collapse" for="c-41890180">[-]</label><label class="expand" for="c-41890180">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;xkcd.com&#x2F;1053&#x2F;" rel="nofollow">https:&#x2F;&#x2F;xkcd.com&#x2F;1053&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></div><div id="41890917" class="c"><input type="checkbox" id="c-41890917" checked=""/><div class="controls bullet"><span class="by">Scribbd</span><span>|</span><a href="#41889095">prev</a><span>|</span><a href="#41891680">next</a><span>|</span><label class="collapse" for="c-41890917">[-]</label><label class="expand" for="c-41890917">[2 more]</label></div><br/><div class="children"><div class="content">This is something I was trying to implement myself. I am surprised it can be done with just an s3 bucket. I was messing with API Gateways, Lambda functions and DynamoDB tables to support the s3 bucket. It didn&#x27;t occur to me to implement it client side.
I might have stuck a bit too much to the lfs test server implementation. <a href="https:&#x2F;&#x2F;github.com&#x2F;git-lfs&#x2F;lfs-test-server">https:&#x2F;&#x2F;github.com&#x2F;git-lfs&#x2F;lfs-test-server</a></div><br/><div id="41891514" class="c"><input type="checkbox" id="c-41891514" checked=""/><div class="controls bullet"><span class="by">chx</span><span>|</span><a href="#41890917">parent</a><span>|</span><a href="#41891680">next</a><span>|</span><label class="collapse" for="c-41891514">[-]</label><label class="expand" for="c-41891514">[1 more]</label></div><br/><div class="children"><div class="content">Client side is, while interesting, of limited use as every CI and similar tool won&#x27;t work this. This seems like a sort of automation of wormhole which I guess is neat <a href="https:&#x2F;&#x2F;github.com&#x2F;cxw42&#x2F;git-tools&#x2F;blob&#x2F;master&#x2F;wormhole">https:&#x2F;&#x2F;github.com&#x2F;cxw42&#x2F;git-tools&#x2F;blob&#x2F;master&#x2F;wormhole</a></div><br/></div></div></div></div><div id="41891680" class="c"><input type="checkbox" id="c-41891680" checked=""/><div class="controls bullet"><span class="by">Evidlo</span><span>|</span><a href="#41890917">prev</a><span>|</span><a href="#41892890">next</a><span>|</span><label class="collapse" for="c-41891680">[-]</label><label class="expand" for="c-41891680">[4 more]</label></div><br/><div class="children"><div class="content">For the LFS part there is also dvc which works better than git-lfs and natively supports S3.</div><br/><div id="41892558" class="c"><input type="checkbox" id="c-41892558" checked=""/><div class="controls bullet"><span class="by">bagavi</span><span>|</span><a href="#41891680">parent</a><span>|</span><a href="#41892890">next</a><span>|</span><label class="collapse" for="c-41892558">[-]</label><label class="expand" for="c-41892558">[3 more]</label></div><br/><div class="children"><div class="content">Dvc is great tool!</div><br/><div id="41892610" class="c"><input type="checkbox" id="c-41892610" checked=""/><div class="controls bullet"><span class="by">lenova</span><span>|</span><a href="#41891680">root</a><span>|</span><a href="#41892558">parent</a><span>|</span><a href="#41892890">next</a><span>|</span><label class="collapse" for="c-41892610">[-]</label><label class="expand" for="c-41892610">[2 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t heard of dvc, so I had to google it, which took me to: <a href="https:&#x2F;&#x2F;dvc.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;dvc.org&#x2F;</a><p>But I&#x27;m still confused as to what is dvc is after a cursory glance at their homepage.</div><br/><div id="41892904" class="c"><input type="checkbox" id="c-41892904" checked=""/><div class="controls bullet"><span class="by">chatmasta</span><span>|</span><a href="#41891680">root</a><span>|</span><a href="#41892610">parent</a><span>|</span><a href="#41892890">next</a><span>|</span><label class="collapse" for="c-41892904">[-]</label><label class="expand" for="c-41892904">[1 more]</label></div><br/><div class="children"><div class="content">It was on the front page contemporaneously with this comment that recommended it, so you know it was an unbiased recommendation. :)</div><br/></div></div></div></div></div></div></div></div><div id="41892890" class="c"><input type="checkbox" id="c-41892890" checked=""/><div class="controls bullet"><span class="by">x3n0ph3n3</span><span>|</span><a href="#41891680">prev</a><span>|</span><a href="#41889926">next</a><span>|</span><label class="collapse" for="c-41892890">[-]</label><label class="expand" for="c-41892890">[1 more]</label></div><br/><div class="children"><div class="content">Wow, AWS <i>really</i> wants to get rid of CodeCommit.</div><br/></div></div><div id="41889926" class="c"><input type="checkbox" id="c-41889926" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#41892890">prev</a><span>|</span><a href="#41890687">next</a><span>|</span><label class="collapse" for="c-41889926">[-]</label><label class="expand" for="c-41889926">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;m surprised they just punt on concurrent updates [0] instead of locking with something like dynamodb, like terraform does.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;awslabs&#x2F;git-remote-s3?tab=readme-ov-file#concurrent-writes">https:&#x2F;&#x2F;github.com&#x2F;awslabs&#x2F;git-remote-s3?tab=readme-ov-file#...</a></div><br/><div id="41890916" class="c"><input type="checkbox" id="c-41890916" checked=""/><div class="controls bullet"><span class="by">noctune</span><span>|</span><a href="#41889926">parent</a><span>|</span><a href="#41890892">next</a><span>|</span><label class="collapse" for="c-41890916">[-]</label><label class="expand" for="c-41890916">[1 more]</label></div><br/><div class="children"><div class="content">S3 recently got conditional writes and you can use do locking entirely in S3 - I don&#x27;t think they are using this though. Must be too recent an addition.</div><br/></div></div><div id="41890892" class="c"><input type="checkbox" id="c-41890892" checked=""/><div class="controls bullet"><span class="by">ncruces</span><span>|</span><a href="#41889926">parent</a><span>|</span><a href="#41890916">prev</a><span>|</span><a href="#41890047">next</a><span>|</span><label class="collapse" for="c-41890892">[-]</label><label class="expand" for="c-41890892">[2 more]</label></div><br/><div class="children"><div class="content">Google Cloud Storage is good enough to implement locks all by itself: <a href="https:&#x2F;&#x2F;reddit.com&#x2F;r&#x2F;golang&#x2F;comments&#x2F;t52d4f&#x2F;gmutex_a_global_mutex_using_google_cloud_storage&#x2F;" rel="nofollow">https:&#x2F;&#x2F;reddit.com&#x2F;r&#x2F;golang&#x2F;comments&#x2F;t52d4f&#x2F;gmutex_a_global_...</a><p>Doesn&#x27;t S3 provide primitives to do the same? At least since moving to strong read-after-write consistency?<p>PS: I wrote the above package. Happy to answer questions about it.</div><br/><div id="41892398" class="c"><input type="checkbox" id="c-41892398" checked=""/><div class="controls bullet"><span class="by">kbumsik</span><span>|</span><a href="#41889926">root</a><span>|</span><a href="#41890892">parent</a><span>|</span><a href="#41890047">next</a><span>|</span><label class="collapse" for="c-41892398">[-]</label><label class="expand" for="c-41892398">[1 more]</label></div><br/><div class="children"><div class="content">Conditional write is just added to S3 2 month ago: <a href="https:&#x2F;&#x2F;aws.amazon.com&#x2F;about-aws&#x2F;whats-new&#x2F;2024&#x2F;08&#x2F;amazon-s3-conditional-writes&#x2F;" rel="nofollow">https:&#x2F;&#x2F;aws.amazon.com&#x2F;about-aws&#x2F;whats-new&#x2F;2024&#x2F;08&#x2F;amazon-s3...</a></div><br/></div></div></div></div><div id="41890047" class="c"><input type="checkbox" id="c-41890047" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#41889926">parent</a><span>|</span><a href="#41890892">prev</a><span>|</span><a href="#41890687">next</a><span>|</span><label class="collapse" for="c-41890047">[-]</label><label class="expand" for="c-41890047">[1 more]</label></div><br/><div class="children"><div class="content">I thank goodness I have access to a non-stupid Terraform state provider[1] so I&#x27;ve never tried that S3+dynamodb setup but, if I understand the situation correctly, introducing Yet Another AWS Service &amp;trade; into this mix would mandate that <i>callers</i> also be given a `dynamo:WriteSomething` IAM perm, which is actually different from S3 in that in S3 one can -- at their discretion -- set the policies on the <i>bucket</i> such that it would work without any explicit caller IAM<p>1: <a href="https:&#x2F;&#x2F;docs.gitlab.com&#x2F;ee&#x2F;user&#x2F;infrastructure&#x2F;iac&#x2F;terraform_state.html" rel="nofollow">https:&#x2F;&#x2F;docs.gitlab.com&#x2F;ee&#x2F;user&#x2F;infrastructure&#x2F;iac&#x2F;terraform...</a></div><br/></div></div></div></div><div id="41890687" class="c"><input type="checkbox" id="c-41890687" checked=""/><div class="controls bullet"><span class="by">fortran77</span><span>|</span><a href="#41889926">prev</a><span>|</span><a href="#41891227">next</a><span>|</span><label class="collapse" for="c-41890687">[-]</label><label class="expand" for="c-41890687">[1 more]</label></div><br/><div class="children"><div class="content">Amazon has deprecated Amazon Code Commit, so this may be an interesting alternative.</div><br/></div></div><div id="41891227" class="c"><input type="checkbox" id="c-41891227" checked=""/><div class="controls bullet"><span class="by">tonymet</span><span>|</span><a href="#41890687">prev</a><span>|</span><label class="collapse" for="c-41891227">[-]</label><label class="expand" for="c-41891227">[1 more]</label></div><br/><div class="children"><div class="content">how does it handle incremental changes? If it’s writing your entire repo on a loop, I could see why AWS would promote it.</div><br/></div></div></div></div></div></div></div></body></html>