<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1737709274090" as="style"/><link rel="stylesheet" href="styles.css?v=1737709274090"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://jprx.io/cve-2024-54507/">Susctl CVE-2024-54507: A particularly &#x27;sus&#x27; sysctl in the XNU kernel</a>Â <span class="domain">(<a href="https://jprx.io">jprx.io</a>)</span></div><div class="subtext"><span>jprx</span> | <span>37 comments</span></div><br/><div><div id="42809160" class="c"><input type="checkbox" id="c-42809160" checked=""/><div class="controls bullet"><span class="by">nixpulvis</span><span>|</span><a href="#42808837">next</a><span>|</span><label class="collapse" for="c-42809160">[-]</label><label class="expand" for="c-42809160">[5 more]</label></div><br/><div class="children"><div class="content">Seems like something to be integration tested in the future. Honestly surprised this slipped through.</div><br/><div id="42809563" class="c"><input type="checkbox" id="c-42809563" checked=""/><div class="controls bullet"><span class="by">0x457</span><span>|</span><a href="#42809160">parent</a><span>|</span><a href="#42810465">next</a><span>|</span><label class="collapse" for="c-42809563">[-]</label><label class="expand" for="c-42809563">[1 more]</label></div><br/><div class="children"><div class="content">I saw that types are different, but I was thinking &quot;must be some weird C thing that I don&#x27;t know about&quot;</div><br/></div></div><div id="42810465" class="c"><input type="checkbox" id="c-42810465" checked=""/><div class="controls bullet"><span class="by">StressedDev</span><span>|</span><a href="#42809160">parent</a><span>|</span><a href="#42809563">prev</a><span>|</span><a href="#42808837">next</a><span>|</span><label class="collapse" for="c-42810465">[-]</label><label class="expand" for="c-42810465">[3 more]</label></div><br/><div class="children"><div class="content">I am not surprised.  First, it&#x27;s a subtle bug.  Second, in C&#x2F;C++. a lot of times you get unlucky when reading uninitialized memory.  Basically, the bug does not occur when you test the code on your machine or when you run the automated tests.<p>Another problem is writing good automated tests is hard and often skipped.  Lots of software engineering teams talk about the wonders of automated tests.  Unfortunately, many automated tests are not very good and either do not ensure the major functionality works or just do not test some of the code.  There are also limits to how much time a software engineer has to test.  No one can test everything.<p>Basically, I am not surprised developers make mistakes and I am not surprised the tests either did not catch this mistake or even did not exist.  Software is very hard and software engineers are far from perfect.</div><br/><div id="42810676" class="c"><input type="checkbox" id="c-42810676" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#42809160">root</a><span>|</span><a href="#42810465">parent</a><span>|</span><a href="#42808837">next</a><span>|</span><label class="collapse" for="c-42810676">[-]</label><label class="expand" for="c-42810676">[2 more]</label></div><br/><div class="children"><div class="content">Right, but this was caught basically instantly by Asan.</div><br/><div id="42810877" class="c"><input type="checkbox" id="c-42810877" checked=""/><div class="controls bullet"><span class="by">hulitu</span><span>|</span><a href="#42809160">root</a><span>|</span><a href="#42810676">parent</a><span>|</span><a href="#42808837">next</a><span>|</span><label class="collapse" for="c-42810877">[-]</label><label class="expand" for="c-42810877">[1 more]</label></div><br/><div class="children"><div class="content">He had time to test it. &#x2F;s</div><br/></div></div></div></div></div></div></div></div><div id="42808837" class="c"><input type="checkbox" id="c-42808837" checked=""/><div class="controls bullet"><span class="by">nxobject</span><span>|</span><a href="#42809160">prev</a><span>|</span><a href="#42809072">next</a><span>|</span><label class="collapse" for="c-42808837">[-]</label><label class="expand" for="c-42808837">[7 more]</label></div><br/><div class="children"><div class="content">Did you get a bounty payout for this? I got the impression that Apple wasn&#x27;t particularly on the ball with those.</div><br/><div id="42809098" class="c"><input type="checkbox" id="c-42809098" checked=""/><div class="controls bullet"><span class="by">ChocolateGod</span><span>|</span><a href="#42808837">parent</a><span>|</span><a href="#42808841">next</a><span>|</span><label class="collapse" for="c-42809098">[-]</label><label class="expand" for="c-42809098">[5 more]</label></div><br/><div class="children"><div class="content">Is it even exploitable in the real world?<p>Correct me if I&#x27;m wrong but you get 2 bytes of kernel data (potentially blank padding) and the same two bytes each time?</div><br/><div id="42809213" class="c"><input type="checkbox" id="c-42809213" checked=""/><div class="controls bullet"><span class="by">bean-weevil</span><span>|</span><a href="#42808837">root</a><span>|</span><a href="#42809098">parent</a><span>|</span><a href="#42809450">next</a><span>|</span><label class="collapse" for="c-42809213">[-]</label><label class="expand" for="c-42809213">[2 more]</label></div><br/><div class="children"><div class="content">If the linker puts a pointer there, this would let you leak part of the pointer which could let you bypass kaslr. Not too likely for that to occur. If I were submitting this bug I would feel complete if they bought me a sandwich.</div><br/><div id="42809533" class="c"><input type="checkbox" id="c-42809533" checked=""/><div class="controls bullet"><span class="by">axoltl</span><span>|</span><a href="#42808837">root</a><span>|</span><a href="#42809213">parent</a><span>|</span><a href="#42809450">next</a><span>|</span><label class="collapse" for="c-42809533">[-]</label><label class="expand" for="c-42809533">[1 more]</label></div><br/><div class="children"><div class="content">The bottom 2 bytes of a pointer contain two bits of the slide, assuming it&#x27;s even a pointer into the kernelcache itself.<p>I&#x27;d take half a sandwich.</div><br/></div></div></div></div><div id="42809450" class="c"><input type="checkbox" id="c-42809450" checked=""/><div class="controls bullet"><span class="by">buzzergfxkjkl</span><span>|</span><a href="#42808837">root</a><span>|</span><a href="#42809098">parent</a><span>|</span><a href="#42809213">prev</a><span>|</span><a href="#42810111">next</a><span>|</span><label class="collapse" for="c-42809450">[-]</label><label class="expand" for="c-42809450">[1 more]</label></div><br/><div class="children"><div class="content">Good to find the bug regardless! I appreciated the succinct and not overly dramatic write-up. I don&#x27;t think anything significant was claimed other than the fact that it is a kernel bug (which is significant in itself don&#x27;t get me wrong).</div><br/></div></div><div id="42810111" class="c"><input type="checkbox" id="c-42810111" checked=""/><div class="controls bullet"><span class="by">duskwuff</span><span>|</span><a href="#42808837">root</a><span>|</span><a href="#42809098">parent</a><span>|</span><a href="#42809450">prev</a><span>|</span><a href="#42808841">next</a><span>|</span><label class="collapse" for="c-42810111">[-]</label><label class="expand" for="c-42810111">[1 more]</label></div><br/><div class="children"><div class="content">You are correct. It&#x27;s clearly a bug, but the impact <i>in shipping kernels</i> appears to be limited to &quot;leaking&quot; some non-sensitive data.</div><br/></div></div></div></div></div></div><div id="42809072" class="c"><input type="checkbox" id="c-42809072" checked=""/><div class="controls bullet"><span class="by">inetknght</span><span>|</span><a href="#42808837">prev</a><span>|</span><a href="#42809843">next</a><span>|</span><label class="collapse" for="c-42809072">[-]</label><label class="expand" for="c-42809072">[8 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    -   int new_value = *(int *)oidp-&gt;oid_arg1;
    +   int new_value = *(uint16_t *)oidp-&gt;oid_arg1;
</code></pre>
Why not just have `uint16_t new_value = ...`?<p>Ahh, because `new_value` is being given to `sysctl_handle_int(..., &amp;new_value, ...);` which of course expects an `int`. So then it begs the question: if the value is really a `uint16_t`, then why is it being handled through a plain `int`? It smells like there could easily be tons of other memory-safety and&#x2F;or type confusion problems endemic to the sysctl API.</div><br/><div id="42809417" class="c"><input type="checkbox" id="c-42809417" checked=""/><div class="controls bullet"><span class="by">aritashion</span><span>|</span><a href="#42809072">parent</a><span>|</span><a href="#42809897">next</a><span>|</span><label class="collapse" for="c-42809417">[-]</label><label class="expand" for="c-42809417">[3 more]</label></div><br/><div class="children"><div class="content">&gt; So then it begs the question: if the value is really a `uint16_t`, then why is it being handled through a plain `int`?<p>I don&#x27;t think it begs the question, but it does raise one!</div><br/><div id="42810186" class="c"><input type="checkbox" id="c-42810186" checked=""/><div class="controls bullet"><span class="by">cbarrick</span><span>|</span><a href="#42809072">root</a><span>|</span><a href="#42809417">parent</a><span>|</span><a href="#42811100">next</a><span>|</span><label class="collapse" for="c-42810186">[-]</label><label class="expand" for="c-42810186">[1 more]</label></div><br/><div class="children"><div class="content">Nit: &quot;begs the question&quot; means &quot;raises the question&quot; in many contemporary colloquial contexts. It can _also_ refer to a type of logical fallacy in philosophical contexts.<p>The phrase can be confusing because of its overloaded definitions, so it&#x27;s best to avoid it. But if you understood what someone meant when they used it, then... you understood it&#x27;s meaning.<p>Remember to treat the study of language descriptively rather than prescriptively!<p><a href="https:&#x2F;&#x2F;en.wiktionary.org&#x2F;wiki&#x2F;beg_the_question" rel="nofollow">https:&#x2F;&#x2F;en.wiktionary.org&#x2F;wiki&#x2F;beg_the_question</a></div><br/></div></div><div id="42811100" class="c"><input type="checkbox" id="c-42811100" checked=""/><div class="controls bullet"><span class="by">bmacho</span><span>|</span><a href="#42809072">root</a><span>|</span><a href="#42809417">parent</a><span>|</span><a href="#42810186">prev</a><span>|</span><a href="#42809897">next</a><span>|</span><label class="collapse" for="c-42811100">[-]</label><label class="expand" for="c-42811100">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Begging_the_question" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Begging_the_question</a></div><br/></div></div></div></div><div id="42809897" class="c"><input type="checkbox" id="c-42809897" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#42809072">parent</a><span>|</span><a href="#42809417">prev</a><span>|</span><a href="#42809843">next</a><span>|</span><label class="collapse" for="c-42809897">[-]</label><label class="expand" for="c-42809897">[4 more]</label></div><br/><div class="children"><div class="content">Well there&#x27;s the so-called usual arithmetic conversions that will basically convert every uint16_t to an unsigned int. The C and C++ languages do a silent conversion on your back anyways so you might as well make it explicit.</div><br/><div id="42810579" class="c"><input type="checkbox" id="c-42810579" checked=""/><div class="controls bullet"><span class="by">loeg</span><span>|</span><a href="#42809072">root</a><span>|</span><a href="#42809897">parent</a><span>|</span><a href="#42809920">next</a><span>|</span><label class="collapse" for="c-42810579">[-]</label><label class="expand" for="c-42810579">[1 more]</label></div><br/><div class="children"><div class="content">Usually promotions are to signed int, not unsigned. (With some exceptions.  But every uint16_t value can fit in int.)</div><br/></div></div><div id="42809920" class="c"><input type="checkbox" id="c-42809920" checked=""/><div class="controls bullet"><span class="by">inetknght</span><span>|</span><a href="#42809072">root</a><span>|</span><a href="#42809897">parent</a><span>|</span><a href="#42810579">prev</a><span>|</span><a href="#42809843">next</a><span>|</span><label class="collapse" for="c-42809920">[-]</label><label class="expand" for="c-42809920">[2 more]</label></div><br/><div class="children"><div class="content">A well-configured C++ compiler will error-out on such a silent conversion.</div><br/><div id="42809969" class="c"><input type="checkbox" id="c-42809969" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#42809072">root</a><span>|</span><a href="#42809920">parent</a><span>|</span><a href="#42809843">next</a><span>|</span><label class="collapse" for="c-42809969">[-]</label><label class="expand" for="c-42809969">[1 more]</label></div><br/><div class="children"><div class="content">The C++ compiler is required to perform this silent conversion according to the standard: <a href="https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;language&#x2F;implicit_conversion#Integral_promotion" rel="nofollow">https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;language&#x2F;implicit_conversi...</a></div><br/></div></div></div></div></div></div></div></div><div id="42809843" class="c"><input type="checkbox" id="c-42809843" checked=""/><div class="controls bullet"><span class="by">soheil</span><span>|</span><a href="#42809072">prev</a><span>|</span><a href="#42809438">next</a><span>|</span><label class="collapse" for="c-42809843">[-]</label><label class="expand" for="c-42809843">[6 more]</label></div><br/><div class="children"><div class="content">Leaking two random bytes and in some cases just padding bytes to user space is not the end of the world and I don&#x27;t get why there are so many negative comments blaming Apple for not handing out a handsome bounty for this bug.</div><br/><div id="42810531" class="c"><input type="checkbox" id="c-42810531" checked=""/><div class="controls bullet"><span class="by">StressedDev</span><span>|</span><a href="#42809843">parent</a><span>|</span><a href="#42809855">next</a><span>|</span><label class="collapse" for="c-42810531">[-]</label><label class="expand" for="c-42810531">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s still a security bug.  Often, multiple bugs like this are chained together to create one very nasty exploit.  I agree that this bug probably does not deserve a massive payout, but I think $3,000-5,000$ is appropriate.</div><br/><div id="42810582" class="c"><input type="checkbox" id="c-42810582" checked=""/><div class="controls bullet"><span class="by">loeg</span><span>|</span><a href="#42809843">root</a><span>|</span><a href="#42810531">parent</a><span>|</span><a href="#42809855">next</a><span>|</span><label class="collapse" for="c-42810582">[-]</label><label class="expand" for="c-42810582">[3 more]</label></div><br/><div class="children"><div class="content">You&#x27;re joking.  This is a $10 bug.</div><br/><div id="42810680" class="c"><input type="checkbox" id="c-42810680" checked=""/><div class="controls bullet"><span class="by">dizhn</span><span>|</span><a href="#42809843">root</a><span>|</span><a href="#42810582">parent</a><span>|</span><a href="#42809855">next</a><span>|</span><label class="collapse" for="c-42810680">[-]</label><label class="expand" for="c-42810680">[2 more]</label></div><br/><div class="children"><div class="content">Dammit I gave a kid $20 in amazon books credit for &quot;your site has a phpinfo() page&quot;.</div><br/><div id="42810700" class="c"><input type="checkbox" id="c-42810700" checked=""/><div class="controls bullet"><span class="by">worthless-trash</span><span>|</span><a href="#42809843">root</a><span>|</span><a href="#42810680">parent</a><span>|</span><a href="#42809855">next</a><span>|</span><label class="collapse" for="c-42810700">[-]</label><label class="expand" for="c-42810700">[1 more]</label></div><br/><div class="children"><div class="content">You got had !</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>