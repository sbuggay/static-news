<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1705482060084" as="style"/><link rel="stylesheet" href="styles.css?v=1705482060084"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.trailofbits.com/2024/01/16/leftoverlocals-listening-to-llm-responses-through-leaked-gpu-local-memory/">LeftoverLocals: Listening to LLM responses through leaked GPU local memory</a> <span class="domain">(<a href="https://blog.trailofbits.com">blog.trailofbits.com</a>)</span></div><div class="subtext"><span>ks6g10</span> | <span>33 comments</span></div><br/><div><div id="39019030" class="c"><input type="checkbox" id="c-39019030" checked=""/><div class="controls bullet"><span class="by">ComputerGuru</span><span>|</span><a href="#39019081">next</a><span>|</span><label class="collapse" for="c-39019030">[-]</label><label class="expand" for="c-39019030">[3 more]</label></div><br/><div class="children"><div class="content">At this point, I assume this is the default and don’t expect data recovery to not be provide on the same physical machine (even across virtualization barriers).<p>If your data is that sensitive, run it on dedicated hardware. Papering over this with mitigation over mitigation is a fool’s errand: both a genuine waste of compute resources and guaranteed to be a game of cat and mouse.</div><br/><div id="39022842" class="c"><input type="checkbox" id="c-39022842" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#39019030">parent</a><span>|</span><a href="#39019081">next</a><span>|</span><label class="collapse" for="c-39022842">[-]</label><label class="expand" for="c-39022842">[2 more]</label></div><br/><div class="children"><div class="content">This is certainly the pragmatic approach to GPU memory in 2024, but I don&#x27;t think it&#x27;s a fool&#x27;s errand. It&#x27;s a solved problem on the CPU side of things, and I don&#x27;t see any reason why we can&#x27;t solve it in the GPU domain too.<p>Notably:<p>&gt; NVIDIA: confirmed that their devices are not currently impacted<p>&gt; ARM: also confirmed that their devices are not currently impacted.</div><br/><div id="39023642" class="c"><input type="checkbox" id="c-39023642" checked=""/><div class="controls bullet"><span class="by">htrp</span><span>|</span><a href="#39019030">root</a><span>|</span><a href="#39022842">parent</a><span>|</span><a href="#39019081">next</a><span>|</span><label class="collapse" for="c-39023642">[-]</label><label class="expand" for="c-39023642">[1 more]</label></div><br/><div class="children"><div class="content">TIL that ARM has GPUs</div><br/></div></div></div></div></div></div><div id="39019081" class="c"><input type="checkbox" id="c-39019081" checked=""/><div class="controls bullet"><span class="by">declaredapple</span><span>|</span><a href="#39019030">prev</a><span>|</span><a href="#39018084">next</a><span>|</span><label class="collapse" for="c-39019081">[-]</label><label class="expand" for="c-39019081">[3 more]</label></div><br/><div class="children"><div class="content">GPU memory isolation is generally really bad, from between processes and entire virtual machines.<p>Does anyone know if nvidia&#x27;s virtual gpus improve the isolation at all?</div><br/><div id="39019273" class="c"><input type="checkbox" id="c-39019273" checked=""/><div class="controls bullet"><span class="by">jeroenhd</span><span>|</span><a href="#39019081">parent</a><span>|</span><a href="#39022653">next</a><span>|</span><label class="collapse" for="c-39019273">[-]</label><label class="expand" for="c-39019273">[1 more]</label></div><br/><div class="children"><div class="content">This is one of my main concerns with technologies like WebGPU. Luckily, WebGPU seems to sacrifice some performance to keep attacks like these from working: <a href="https:&#x2F;&#x2F;github.com&#x2F;trailofbits&#x2F;LeftoverLocalsRelease&#x2F;tree&#x2F;main&#x2F;WebGPUListener">https:&#x2F;&#x2F;github.com&#x2F;trailofbits&#x2F;LeftoverLocalsRelease&#x2F;tree&#x2F;ma...</a></div><br/></div></div><div id="39022653" class="c"><input type="checkbox" id="c-39022653" checked=""/><div class="controls bullet"><span class="by">hhh</span><span>|</span><a href="#39019081">parent</a><span>|</span><a href="#39019273">prev</a><span>|</span><a href="#39018084">next</a><span>|</span><label class="collapse" for="c-39022653">[-]</label><label class="expand" for="c-39022653">[1 more]</label></div><br/><div class="children"><div class="content">IIRC it only improves if you use MIG.</div><br/></div></div></div></div><div id="39018084" class="c"><input type="checkbox" id="c-39018084" checked=""/><div class="controls bullet"><span class="by">Kab1r</span><span>|</span><a href="#39019081">prev</a><span>|</span><a href="#39018087">next</a><span>|</span><label class="collapse" for="c-39018084">[-]</label><label class="expand" for="c-39018084">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been told that historically performance has been prioritized over security in the GPU space. Mitigating things like this does incur a performance penalty.</div><br/></div></div><div id="39018087" class="c"><input type="checkbox" id="c-39018087" checked=""/><div class="controls bullet"><span class="by">jiripospisil</span><span>|</span><a href="#39018084">prev</a><span>|</span><a href="#39021796">next</a><span>|</span><label class="collapse" for="c-39018087">[-]</label><label class="expand" for="c-39018087">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Since September 2023, we have been working with CERT (..)<p>&gt; Apple: Despite multiple efforts to establish contact through CERT&#x2F;CC, we only received a response from Apple on January 13, 2024.<p>&gt; Apple did not respond or engage with us regarding the disclosure.<p>Well at least they are consistent at not giving a flying f*ck about working with bug reporters, no matter who you are. I have reported 5+ radars in the past and have never received any response, not even a confirmation.</div><br/><div id="39024097" class="c"><input type="checkbox" id="c-39024097" checked=""/><div class="controls bullet"><span class="by">kridsdale1</span><span>|</span><a href="#39018087">parent</a><span>|</span><a href="#39021951">next</a><span>|</span><label class="collapse" for="c-39024097">[-]</label><label class="expand" for="c-39024097">[1 more]</label></div><br/><div class="children"><div class="content">My first job post college was a Radar triager for specific Apple frameworks. I was 23 or so, probably high the previous evening, and I did not give a FUCK about some external developer and their problems.<p>Sorry. That was a long time ago.</div><br/></div></div><div id="39020469" class="c"><input type="checkbox" id="c-39020469" checked=""/><div class="controls bullet"><span class="by">adr1an</span><span>|</span><a href="#39018087">parent</a><span>|</span><a href="#39021951">prev</a><span>|</span><a href="#39021796">next</a><span>|</span><label class="collapse" for="c-39020469">[-]</label><label class="expand" for="c-39020469">[1 more]</label></div><br/><div class="children"><div class="content">At least you don&#x27;t get sued or incarcerated &#x2F;s</div><br/></div></div></div></div><div id="39021796" class="c"><input type="checkbox" id="c-39021796" checked=""/><div class="controls bullet"><span class="by">geuis</span><span>|</span><a href="#39018087">prev</a><span>|</span><a href="#39018868">next</a><span>|</span><label class="collapse" for="c-39021796">[-]</label><label class="expand" for="c-39021796">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know if this is related, but I reported an issue back in September or October about conversations with ChatGPT 3.5 leaking into new sessions. I noticed that after having a semi long exchange, I could start a new session and ask a question about one of the previous sessions and the LLM would respond with details it could only obtain from one of the prior ones.<p>This was definitely happening with OpenAI&#x27;s web interface. It might have been happening via API calls too but it&#x27;s been a while and I don&#x27;t remember.<p>Nothing ever came of the report as far as I know.</div><br/></div></div><div id="39018868" class="c"><input type="checkbox" id="c-39018868" checked=""/><div class="controls bullet"><span class="by">dmvdoug</span><span>|</span><a href="#39021796">prev</a><span>|</span><a href="#39017602">next</a><span>|</span><label class="collapse" for="c-39018868">[-]</label><label class="expand" for="c-39018868">[3 more]</label></div><br/><div class="children"><div class="content">Is this the Golden Age of hardware vulnerabilities?</div><br/><div id="39019366" class="c"><input type="checkbox" id="c-39019366" checked=""/><div class="controls bullet"><span class="by">ngneer</span><span>|</span><a href="#39018868">parent</a><span>|</span><a href="#39017602">next</a><span>|</span><label class="collapse" for="c-39019366">[-]</label><label class="expand" for="c-39019366">[2 more]</label></div><br/><div class="children"><div class="content">Kind of. However, I would venture most real world attack scenarios do not leverage HW vulnerabilities. But wait, how do we know what is happening invisibly? And what about state actors? The answer is we do not know, but the economics do not change based on whether an attack is made visible or not. Attacks tend to follow and reveal the path of least impedance. If software attacks are working fine for most, why would anyone spend more on weaponizing a HW exploit?</div><br/><div id="39020891" class="c"><input type="checkbox" id="c-39020891" checked=""/><div class="controls bullet"><span class="by">dmvdoug</span><span>|</span><a href="#39018868">root</a><span>|</span><a href="#39019366">parent</a><span>|</span><a href="#39017602">next</a><span>|</span><label class="collapse" for="c-39020891">[-]</label><label class="expand" for="c-39020891">[1 more]</label></div><br/><div class="children"><div class="content">I just feel like maybe 20 years ago people thought the hardware was the hardware and all the security issues were inevitably to be found in software. I mean, I know that people who work with hardware for a living always say that hardware has always been shit, but it really does feel now like everything is a security vulnerability, in a way that people weren’t looking for previously. Then again, maybe they were, and I just wasn’t paying attention. Ah, to be young and carefree again.</div><br/></div></div></div></div></div></div><div id="39017602" class="c"><input type="checkbox" id="c-39017602" checked=""/><div class="controls bullet"><span class="by">Veserv</span><span>|</span><a href="#39018868">prev</a><span>|</span><a href="#39017371">next</a><span>|</span><label class="collapse" for="c-39017602">[-]</label><label class="expand" for="c-39017602">[15 more]</label></div><br/><div class="children"><div class="content">tl;dr GPU drivers made by various vendors do not sanitize compute unit hardware scratch memory between uses, so you can just freely read whatever the last user left laying around when they stopped.<p>Literally too incompetent to follow even basic security 101 practices. A time shared device must be sanitized between users to prevent state leakage. There is no reason to believe that a security culture that clueless when developing a universally shared, high criticality device can be believed if they claim to do better elsewhere. Their process is either so incompetent or so inconsistent that their claims can not be believed without external audits.<p>In this case: Apple, Qualcomm, AMD, Imagination.<p>Edit: Added Imagination as noted by reply.</div><br/><div id="39020068" class="c"><input type="checkbox" id="c-39020068" checked=""/><div class="controls bullet"><span class="by">bee_rider</span><span>|</span><a href="#39017602">parent</a><span>|</span><a href="#39017712">next</a><span>|</span><label class="collapse" for="c-39020068">[-]</label><label class="expand" for="c-39020068">[2 more]</label></div><br/><div class="children"><div class="content">These designs all come out of the consumer and gaming space. They correctly trade security away for performance. Blame whoever started running untrustworthy code on them.<p>These vulnerabilities will continue happening. What I don’t understand is how anybody can be surprised at this point. If anyone out there missed the first dozen instances of this: workloads on modern hardware can’t be isolated.</div><br/><div id="39024114" class="c"><input type="checkbox" id="c-39024114" checked=""/><div class="controls bullet"><span class="by">kridsdale1</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39020068">parent</a><span>|</span><a href="#39017712">next</a><span>|</span><label class="collapse" for="c-39024114">[-]</label><label class="expand" for="c-39024114">[1 more]</label></div><br/><div class="children"><div class="content">Yeah it’s pretty insane that the entire AI hype and crypto hype industry waves are actually just getting really specific pixel shaders to sparkle in extremely specific ways.<p>The gear was made to frag noobs in Counterstrike at 300 FPS.</div><br/></div></div></div></div><div id="39017712" class="c"><input type="checkbox" id="c-39017712" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#39017602">parent</a><span>|</span><a href="#39020068">prev</a><span>|</span><a href="#39021164">next</a><span>|</span><label class="collapse" for="c-39017712">[-]</label><label class="expand" for="c-39017712">[8 more]</label></div><br/><div class="children"><div class="content">And Imagination.<p>Notably Intel and Nvidia were not impacted. I wonder if the security hardening that Google worked on with Nvidia for Stadia helped prevent this</div><br/><div id="39017903" class="c"><input type="checkbox" id="c-39017903" checked=""/><div class="controls bullet"><span class="by">Veserv</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017712">parent</a><span>|</span><a href="#39018779">next</a><span>|</span><label class="collapse" for="c-39017903">[-]</label><label class="expand" for="c-39017903">[2 more]</label></div><br/><div class="children"><div class="content">Jeez, I hope it did not require “security hardening” for Nvidia to do something this basic. If these other vendors missed some tiny corner resulting in state leakage, that would be understandable. But, forgetting to clear local memory is just inexcusable.<p>Imagine a OS forgetting to replace your general purpose registers across context switches. Only a rank incompetent and useless security process would let something like that get all the way through to deployment.</div><br/><div id="39019221" class="c"><input type="checkbox" id="c-39019221" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017903">parent</a><span>|</span><a href="#39018779">next</a><span>|</span><label class="collapse" for="c-39019221">[-]</label><label class="expand" for="c-39019221">[1 more]</label></div><br/><div class="children"><div class="content">Vendors have consistently ignored multi tenant issues when coding because gaming doesn’t need it and cloud traditionally hasn’t used GPUs all that much.<p>You’d be surprised by how many security issues exist in GPU drivers</div><br/></div></div></div></div><div id="39018779" class="c"><input type="checkbox" id="c-39018779" checked=""/><div class="controls bullet"><span class="by">ks6g10</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017712">parent</a><span>|</span><a href="#39017903">prev</a><span>|</span><a href="#39019085">next</a><span>|</span><label class="collapse" for="c-39018779">[-]</label><label class="expand" for="c-39018779">[1 more]</label></div><br/><div class="children"><div class="content">Could probably be that the shared memory (at least in the past) also was used for cache, so the same mechanism that probably sanitizer the cache is&#x2F;was in play here.</div><br/></div></div><div id="39019085" class="c"><input type="checkbox" id="c-39019085" checked=""/><div class="controls bullet"><span class="by">jmgao</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017712">parent</a><span>|</span><a href="#39018779">prev</a><span>|</span><a href="#39017821">next</a><span>|</span><label class="collapse" for="c-39019085">[-]</label><label class="expand" for="c-39019085">[2 more]</label></div><br/><div class="children"><div class="content">Google used AMD GPUs for Stadia, not NVIDIA.</div><br/><div id="39020196" class="c"><input type="checkbox" id="c-39020196" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39019085">parent</a><span>|</span><a href="#39017821">next</a><span>|</span><label class="collapse" for="c-39020196">[-]</label><label class="expand" for="c-39020196">[1 more]</label></div><br/><div class="children"><div class="content">Eventually for the product. My memory may be faulty but I talked with engineers working on it during development and I’m pretty sure the initial development was on Nvidia.</div><br/></div></div></div></div><div id="39017821" class="c"><input type="checkbox" id="c-39017821" checked=""/><div class="controls bullet"><span class="by">kevingadd</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017712">parent</a><span>|</span><a href="#39019085">prev</a><span>|</span><a href="#39021164">next</a><span>|</span><label class="collapse" for="c-39017821">[-]</label><label class="expand" for="c-39017821">[2 more]</label></div><br/><div class="children"><div class="content">Could imagine it being related to CUDA as well. Memory being consistently zero-initialized helps prevent application bugs.</div><br/><div id="39020205" class="c"><input type="checkbox" id="c-39020205" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39017821">parent</a><span>|</span><a href="#39021164">next</a><span>|</span><label class="collapse" for="c-39020205">[-]</label><label class="expand" for="c-39020205">[1 more]</label></div><br/><div class="children"><div class="content">Maybe but multi tenant GPU use cases only really come up for cloud and cloud GPU popularity is only a little more recent.</div><br/></div></div></div></div></div></div><div id="39021164" class="c"><input type="checkbox" id="c-39021164" checked=""/><div class="controls bullet"><span class="by">throwitaway222</span><span>|</span><a href="#39017602">parent</a><span>|</span><a href="#39017712">prev</a><span>|</span><a href="#39017810">next</a><span>|</span><label class="collapse" for="c-39021164">[-]</label><label class="expand" for="c-39021164">[1 more]</label></div><br/><div class="children"><div class="content">Man so this has been an issue for 20 years, we suddenly invent LLMs and you want your money back on Nvidia.</div><br/></div></div><div id="39017810" class="c"><input type="checkbox" id="c-39017810" checked=""/><div class="controls bullet"><span class="by">kevingadd</span><span>|</span><a href="#39017602">parent</a><span>|</span><a href="#39021164">prev</a><span>|</span><a href="#39018281">next</a><span>|</span><label class="collapse" for="c-39017810">[-]</label><label class="expand" for="c-39017810">[1 more]</label></div><br/><div class="children"><div class="content">Wasn&#x27;t too long ago that stray texture data would be left lying around from other processes, too. You could exploit that to read the contents of the user&#x27;s banking tabs and stuff like that.</div><br/></div></div><div id="39018281" class="c"><input type="checkbox" id="c-39018281" checked=""/><div class="controls bullet"><span class="by">dist-epoch</span><span>|</span><a href="#39017602">parent</a><span>|</span><a href="#39017810">prev</a><span>|</span><a href="#39017371">next</a><span>|</span><label class="collapse" for="c-39018281">[-]</label><label class="expand" for="c-39018281">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not so simple.<p>For example Windows takes over GPU memory control, it virtualizes it, and allocates it to various applications, zeros it, etc...</div><br/><div id="39018714" class="c"><input type="checkbox" id="c-39018714" checked=""/><div class="controls bullet"><span class="by">ks6g10</span><span>|</span><a href="#39017602">root</a><span>|</span><a href="#39018281">parent</a><span>|</span><a href="#39017371">next</a><span>|</span><label class="collapse" for="c-39018714">[-]</label><label class="expand" for="c-39018714">[1 more]</label></div><br/><div class="children"><div class="content">This is specific to local&#x2F;scratch memory which is not exposed for allocation in the same way dram is.</div><br/></div></div></div></div></div></div><div id="39019989" class="c"><input type="checkbox" id="c-39019989" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#39017371">prev</a><span>|</span><label class="collapse" for="c-39019989">[-]</label><label class="expand" for="c-39019989">[1 more]</label></div><br/><div class="children"><div class="content">Url changed from <a href="https:&#x2F;&#x2F;leftoverlocals.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;leftoverlocals.com&#x2F;</a>, which points to this and has more information.</div><br/></div></div></div></div></div></div></div></body></html>