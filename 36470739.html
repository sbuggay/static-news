<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687770058094" as="style"/><link rel="stylesheet" href="styles.css?v=1687770058094"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://kevinmahoney.co.uk/articles/immutable-data/">Immutable Data (2015)</a> <span class="domain">(<a href="https://kevinmahoney.co.uk">kevinmahoney.co.uk</a>)</span></div><div class="subtext"><span>akbarnama</span> | <span>9 comments</span></div><br/><div><div id="36476406" class="c"><input type="checkbox" id="c-36476406" checked=""/><div class="controls bullet"><span class="by">pil0u</span><span>|</span><a href="#36477208">next</a><span>|</span><label class="collapse" for="c-36476406">[-]</label><label class="expand" for="c-36476406">[2 more]</label></div><br/><div class="children"><div class="content">From a user&#x27;s perspective, I can see a privacy drawback as well.<p>Suppose that instead of a typical User table, you have a User_Revision table like suggested. Every time a user updates their account settings, you INSERT a new row there. If a user changes their email address, you get a row each time they update it.<p>Not only the company gets an history of email addresses, but also they are tied to each other. If this information gets leaked, the user is exposed to more vectors of attack.</div><br/><div id="36476691" class="c"><input type="checkbox" id="c-36476691" checked=""/><div class="controls bullet"><span class="by">ludston</span><span>|</span><a href="#36476406">parent</a><span>|</span><a href="#36477208">next</a><span>|</span><label class="collapse" for="c-36476691">[-]</label><label class="expand" for="c-36476691">[1 more]</label></div><br/><div class="children"><div class="content">GDPR and the right to having your personal data deleted certainly puts a bit of a stopper on using an immutable database for anything personally identifying.</div><br/></div></div></div></div><div id="36477208" class="c"><input type="checkbox" id="c-36477208" checked=""/><div class="controls bullet"><span class="by">crdrost</span><span>|</span><a href="#36476406">prev</a><span>|</span><a href="#36476365">next</a><span>|</span><label class="collapse" for="c-36477208">[-]</label><label class="expand" for="c-36477208">[1 more]</label></div><br/><div class="children"><div class="content">(1) You will benefit immensely in the applications built from these sorts of structures by keeping the version log for an entity in a separate table from the current value. First because you can just use old-school triggers, “any update over here triggers inserting a new row into the corresponding versions table,” you don&#x27;t need to even care about implementing the versioning in application logic. Second because the sorts of queries that would involve looking at previous versions tend to not be the same as the sorts of queries for general data manipulation.<p>(2) To give an instance of where (1) becomes important, suppose you change some X to X&#x27; and then want to change it back. Suppose that after the change some entity was deleted—X foreign keys to a now-deleted value, X&#x27; does not. Most applications that try to shove both current state and history into one ubertable disable a bunch of constraint checking and other suchness, and permit this dubious feature of partially-rolling-back into an inconsistent state. But if you just DELETED the row when you said you had, then you would have gotten a foreign-key-error and your user would have copy-pasted you on their “unexpected error occurred” error message and you&#x27;d immediately be able to diagnose what foreign key constraint was blocking the undo, rather than mysterious failures several weeks later.<p>(3) Regardless of your stance on (1), once your application supports deletion, your relational integrity usually suffers because the technically correct value for all of the columns in a deleted-row is to make them all null. This is basically the problem that databases do not have sum types. A sum type in a database is not hard to create once you need it, create a row that has 3 columns which foreign-key to other tables, plus constraints that exactly one of these values is non-null. So the very lightweight construction if you are upset about denormalizing your data is for a Cat in your Cats table in your PetStore database to be a nullable pointer to a CatVersion. So that&#x27;s how to proceed if you REALLY want to normalize.<p>(4) All of the above assumes that for every edit to an entity you will save a new row in the versions table, copying all of the other data. The problem is that inevitably some tables get super wide as they have to hold dozens of pieces of business data together, and it&#x27;s never the ones that you initially expected. There is an easy fix for this as well, it is for versions to also be “mutable.” Whaaaaa??? Yes. Snapshots plus deltas. It&#x27;s not really mutable because it&#x27;s append-only.</div><br/></div></div><div id="36476365" class="c"><input type="checkbox" id="c-36476365" checked=""/><div class="controls bullet"><span class="by">pharmakom</span><span>|</span><a href="#36477208">prev</a><span>|</span><a href="#36476851">next</a><span>|</span><label class="collapse" for="c-36476365">[-]</label><label class="expand" for="c-36476365">[2 more]</label></div><br/><div class="children"><div class="content">It’s a mistake to use timestamp for sorting versions instead of revision_id imo</div><br/><div id="36477031" class="c"><input type="checkbox" id="c-36477031" checked=""/><div class="controls bullet"><span class="by">steve_adams_86</span><span>|</span><a href="#36476365">parent</a><span>|</span><a href="#36476851">next</a><span>|</span><label class="collapse" for="c-36477031">[-]</label><label class="expand" for="c-36477031">[1 more]</label></div><br/><div class="children"><div class="content">What case would you make for using revision_id?</div><br/></div></div></div></div><div id="36476851" class="c"><input type="checkbox" id="c-36476851" checked=""/><div class="controls bullet"><span class="by">phrenicfraud</span><span>|</span><a href="#36476365">prev</a><span>|</span><label class="collapse" for="c-36476851">[-]</label><label class="expand" for="c-36476851">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Immutable data in databases has all the same advantages as immutable data in general purpose languages. It is usually much easier to reason about than mutable state. See: Referential Transparency.<p>It&#x27;s only hard to reason about mutable state if you don&#x27;t understand it and if you don&#x27;t understand it you have no business touching it. And yes I know, blah blah legacy software cope words words words... Jump the sinking ship because bailing it with a bucket is worthless and find a company where such things aren&#x27;t allowed.<p>Now let me clarify, it&#x27;s not a fault of languages that &quot;allow&quot; mutable state if previous programmer was allowed to build a god object that manages everything in inexplicable ways just like an actual god would. It&#x27;s a fault of entire company being rotten from all the way to top and using language that &quot;prevents it&quot; (it really doesn&#x27;t) wouldn&#x27;t have changed the position you&#x27;re currently in.<p>We have these things callied &quot;code reviews&quot; where shit code is simply not allowed to be committed, if your company never used it you&#x27;re doing what OceanGate just did last week. If you don&#x27;t get out now you&#x27;re an idiot.</div><br/><div id="36477143" class="c"><input type="checkbox" id="c-36477143" checked=""/><div class="controls bullet"><span class="by">phrenicfraud</span><span>|</span><a href="#36476851">parent</a><span>|</span><label class="collapse" for="c-36477143">[-]</label><label class="expand" for="c-36477143">[2 more]</label></div><br/><div class="children"><div class="content">It seems like all redditors moved here hence the downvotes without elaboration. Well, it&#x27;s not my problem if you want to keep dreaming, I&#x27;ll continue living in reality where if I don&#x27;t want things to change, I simply will not change them, not rely on obscure and irrelevant languages to prevent me from doing so.</div><br/><div id="36477316" class="c"><input type="checkbox" id="c-36477316" checked=""/><div class="controls bullet"><span class="by">smokel</span><span>|</span><a href="#36476851">root</a><span>|</span><a href="#36477143">parent</a><span>|</span><label class="collapse" for="c-36477316">[-]</label><label class="expand" for="c-36477316">[1 more]</label></div><br/><div class="children"><div class="content">I did not downvote your comment, but the downvotes might be because your message was formulated quite strongly.<p>Perhaps if you offer a more nuanced view, people may agree more and upvote it as well.<p>If your stance on mutability is really so strong, then you have to actually persuade people about your views, and that takes quite some effort (mostly from the person to be persuaded, not from you.)  Being friendly instead of dismissive might make people more eager to take on another perspective.<p>Hope this helps a bit for future situations :)</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>