<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716541273151" as="style"/><link rel="stylesheet" href="styles.css?v=1716541273151"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/koute/bytehound">Bytehound: Memory Profiler for Linux</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>klaussilveira</span> | <span>33 comments</span></div><br/><div><div id="40455954" class="c"><input type="checkbox" id="c-40455954" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40455954">[-]</label><label class="expand" for="c-40455954">[27 more]</label></div><br/><div class="children"><div class="content">Didn&#x27;t expect to see this on the front page.<p>Hi, it&#x27;s my project. Feel free to ask me anything.</div><br/><div id="40461058" class="c"><input type="checkbox" id="c-40461058" checked=""/><div class="controls bullet"><span class="by">freedomben</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40462405">next</a><span>|</span><label class="collapse" for="c-40461058">[-]</label><label class="expand" for="c-40461058">[3 more]</label></div><br/><div class="children"><div class="content">Why did you name it Bytehound?<p>(I love the name but am always curious what people&#x27;s inspirations are for naming their project.  I love when a project name is unique, creative, descriptive, and playful, and Bytehound nails all four IMHO)<p>Also, thank you for doing this and sharing it!</div><br/><div id="40463291" class="c"><input type="checkbox" id="c-40463291" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40461058">parent</a><span>|</span><a href="#40462405">next</a><span>|</span><label class="collapse" for="c-40463291">[-]</label><label class="expand" for="c-40463291">[2 more]</label></div><br/><div class="children"><div class="content">I liked how Wireshark was named and wanted a similar name, so I replaced &quot;wire&quot; with &quot;byte&quot; and &quot;shark&quot; with and another animal, in this case &quot;hound&quot; seemed to roll of the tongue pretty nicely.</div><br/></div></div></div></div><div id="40462405" class="c"><input type="checkbox" id="c-40462405" checked=""/><div class="controls bullet"><span class="by">iamcreasy</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40461058">prev</a><span>|</span><a href="#40460562">next</a><span>|</span><label class="collapse" for="c-40462405">[-]</label><label class="expand" for="c-40462405">[2 more]</label></div><br/><div class="children"><div class="content">Very interesting. Is there any book that you can recommend to learn about memory behaviour of a program in Linux? I am aware that the starting point is cache miss, page fault, but not sure where to go from there.</div><br/><div id="40463503" class="c"><input type="checkbox" id="c-40463503" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40462405">parent</a><span>|</span><a href="#40460562">next</a><span>|</span><label class="collapse" for="c-40463503">[-]</label><label class="expand" for="c-40463503">[1 more]</label></div><br/><div class="children"><div class="content">Sorry, everything I know about this comes from experience so there aren&#x27;t any books I can recommend. (:<p>Although I could probably recommend you a hands-on project&#x2F;exercise to do:<p>- Write a simple memory allocator in C&#x2F;C++&#x2F;Rust&#x2F;Zig&#x2F;any similar systems language using raw `mmap` and `munmap` syscalls (run &quot;man 2 mmap&quot; in your terminal for details). This is how fundamentally almost every program allocates memory on the lowest level (with some exceptions, but I&#x27;m not going to get into that).<p>- Allocate a bunch of memory with your allocator without actually reading&#x2F;writing from than memory and check the program&#x27;s RSS, then write to it and check the RSS again. Try allocating more memory than you have RAM and see if it works. Run the program under `perf` and check the page faults counter - see how the page fault number changes if you a) never write to the memory you allocated, b) only write to a single byte per page, c) write to every byte you allocated, d) write twice to every byte you allocated.<p>- Play around with the `madvise` syscall (&quot;man 2 madvise&quot;), in particular with `MADV_DONTNEED`.<p>- Try `mmap`ing on a file on your disk. `mmap` it with multiple processes at the same time.</div><br/></div></div></div></div><div id="40460562" class="c"><input type="checkbox" id="c-40460562" checked=""/><div class="controls bullet"><span class="by">klaussilveira</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40462405">prev</a><span>|</span><a href="#40457969">next</a><span>|</span><label class="collapse" for="c-40460562">[-]</label><label class="expand" for="c-40460562">[2 more]</label></div><br/><div class="children"><div class="content">Thank you for helping me fix a nasty leak! :)</div><br/><div id="40463516" class="c"><input type="checkbox" id="c-40463516" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40460562">parent</a><span>|</span><a href="#40457969">next</a><span>|</span><label class="collapse" for="c-40463516">[-]</label><label class="expand" for="c-40463516">[1 more]</label></div><br/><div class="children"><div class="content">Glad to have helped. (:</div><br/></div></div></div></div><div id="40457969" class="c"><input type="checkbox" id="c-40457969" checked=""/><div class="controls bullet"><span class="by">AymanB</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40460562">prev</a><span>|</span><a href="#40459838">next</a><span>|</span><label class="collapse" for="c-40457969">[-]</label><label class="expand" for="c-40457969">[2 more]</label></div><br/><div class="children"><div class="content">I was wondering, any way to use it with distributed systems for data analytics?<p>Imagine a set of workers that ingest data in parallel, would that work?<p>Currently it&#x27;s pretty simple and i am spawning a process within the worker so it reads some stuff such as memory usage, cpu usage etc... But I would like to improve it.</div><br/><div id="40463358" class="c"><input type="checkbox" id="c-40463358" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40457969">parent</a><span>|</span><a href="#40459838">next</a><span>|</span><label class="collapse" for="c-40463358">[-]</label><label class="expand" for="c-40463358">[1 more]</label></div><br/><div class="children"><div class="content">Not entirely sure what you&#x27;re asking about exactly, but, well, currently the analysis part can only run on a single machine, and it was never designed to run on multiple machines. (Which, for analyzing bigger dumps can be a problem if you don&#x27;t have a lot of RAM.)<p>It could probably be done, but the analyzer would have to be mostly rewritten. (Which I currently have no plans to do.)</div><br/></div></div></div></div><div id="40459838" class="c"><input type="checkbox" id="c-40459838" checked=""/><div class="controls bullet"><span class="by">superleaf</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40457969">prev</a><span>|</span><a href="#40456369">next</a><span>|</span><label class="collapse" for="c-40459838">[-]</label><label class="expand" for="c-40459838">[2 more]</label></div><br/><div class="children"><div class="content">If I am, for example, running a test on an android device connected to my linux machine as the host to send adb commands and what not, can I use this profiler to profile android app memory consumption?</div><br/><div id="40463321" class="c"><input type="checkbox" id="c-40463321" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40459838">parent</a><span>|</span><a href="#40456369">next</a><span>|</span><label class="collapse" for="c-40463321">[-]</label><label class="expand" for="c-40463321">[1 more]</label></div><br/><div class="children"><div class="content">If your program is written in Java, most likely not. I&#x27;ve never tried it, but I imagine it most likely won&#x27;t interact with Java&#x27;s garbage collector too well.<p>If it&#x27;s a native program - possibly, depending on whether it&#x27;s possible to LD_PRELOAD on Android, but you&#x27;d most likely have to connect to it through SSH and launch your program that way.<p>(Sorry, I have very little experience with Android so I can&#x27;t really be of too much help here)</div><br/></div></div></div></div><div id="40456369" class="c"><input type="checkbox" id="c-40456369" checked=""/><div class="controls bullet"><span class="by">vardump</span><span>|</span><a href="#40455954">parent</a><span>|</span><a href="#40459838">prev</a><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40456369">[-]</label><label class="expand" for="c-40456369">[15 more]</label></div><br/><div class="children"><div class="content">Custom fast stack unwinding sounds interesting. How’s the performance on ARMv8?</div><br/><div id="40456693" class="c"><input type="checkbox" id="c-40456693" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456369">parent</a><span>|</span><a href="#40456533">next</a><span>|</span><label class="collapse" for="c-40456693">[-]</label><label class="expand" for="c-40456693">[1 more]</label></div><br/><div class="children"><div class="content">Haven&#x27;t used it on ARM in a very long time, but should work just as well as on AMD64. (As long as you disable pointer authentication&#x2F;CFI&#x2F;whatever it was called on ARM.)</div><br/></div></div><div id="40456533" class="c"><input type="checkbox" id="c-40456533" checked=""/><div class="controls bullet"><span class="by">quotemstr</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456369">parent</a><span>|</span><a href="#40456693">prev</a><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40456533">[-]</label><label class="expand" for="c-40456533">[13 more]</label></div><br/><div class="children"><div class="content">&gt; fast stack unwinding sounds interesting<p>Frame-pointer-based, I imagine?</div><br/><div id="40456666" class="c"><input type="checkbox" id="c-40456666" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456533">parent</a><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40456666">[-]</label><label class="expand" for="c-40456666">[12 more]</label></div><br/><div class="children"><div class="content">No. It&#x27;s DWARF based.<p>The main two tricks are: it preprocesses all of the DWARF info at startup for faster lookups, and it dynamically patches the return addresses of functions on the stack injecting an address to its own trampoline, which allows it to skip going through the whole stack trace every time it needs to dump a backtrace. For example, if you&#x27;re running a function nested 100 stack frames deep and that function calls malloc 100 times then Bytehound will only go through ~300 stack frames in total (~100 times for the first call then only ~2 frames for each successive call, if my math is right), while other similar tools will go through 10000 stack frames (going through all ~100 frames to the very bottom for every call).</div><br/><div id="40458215" class="c"><input type="checkbox" id="c-40458215" checked=""/><div class="controls bullet"><span class="by">felixge</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456666">parent</a><span>|</span><a href="#40457196">next</a><span>|</span><label class="collapse" for="c-40458215">[-]</label><label class="expand" for="c-40458215">[6 more]</label></div><br/><div class="children"><div class="content">Dynamic patching of return addresses is a very cool trick. I don&#x27;t think I&#x27;ve seen this before. Have you run into any situations where this crashes programs or otherwise interferes with their execution?</div><br/><div id="40458959" class="c"><input type="checkbox" id="c-40458959" checked=""/><div class="controls bullet"><span class="by">peterfirefly</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40458215">parent</a><span>|</span><a href="#40463281">next</a><span>|</span><label class="collapse" for="c-40458959">[-]</label><label class="expand" for="c-40458959">[1 more]</label></div><br/><div class="children"><div class="content">Turbo Pascal used it for the overlay implementation (for DOS) -- overlays = virtual memory at home.<p>TP 5.0 from 1988 was the first version that had it.<p>The idea was to make sure the code the CPU returned to would actually be in memory.<p>I&#x27;m pretty sure Windows 1.0 did something very similar.</div><br/></div></div><div id="40463281" class="c"><input type="checkbox" id="c-40463281" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40458215">parent</a><span>|</span><a href="#40458959">prev</a><span>|</span><a href="#40459465">next</a><span>|</span><label class="collapse" for="c-40463281">[-]</label><label class="expand" for="c-40463281">[1 more]</label></div><br/><div class="children"><div class="content">If the program&#x27;s already doing weird stuff with the stack&#x2F;control flow&#x2F;etc., yes, but that should be relatively rare and for the majority of the programs it should work fine.</div><br/></div></div><div id="40459465" class="c"><input type="checkbox" id="c-40459465" checked=""/><div class="controls bullet"><span class="by">tdullien</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40458215">parent</a><span>|</span><a href="#40463281">prev</a><span>|</span><a href="#40457196">next</a><span>|</span><label class="collapse" for="c-40459465">[-]</label><label class="expand" for="c-40459465">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s going to play poorly when C++ exceptions are thrown&#x2F;caught.</div><br/><div id="40463269" class="c"><input type="checkbox" id="c-40463269" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40459465">parent</a><span>|</span><a href="#40459715">next</a><span>|</span><label class="collapse" for="c-40463269">[-]</label><label class="expand" for="c-40463269">[1 more]</label></div><br/><div class="children"><div class="content">It should support C++ exceptions. The trampolines have exception landing pads included to catch and rethrow any exceptions which are thrown through them.</div><br/></div></div><div id="40459715" class="c"><input type="checkbox" id="c-40459715" checked=""/><div class="controls bullet"><span class="by">felixge</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40459465">parent</a><span>|</span><a href="#40463269">prev</a><span>|</span><a href="#40457196">next</a><span>|</span><label class="collapse" for="c-40459715">[-]</label><label class="expand" for="c-40459715">[1 more]</label></div><br/><div class="children"><div class="content">Looking at the code [1] it seems like the library is actively trying to handle this problem.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;koute&#x2F;not-perf&#x2F;blob&#x2F;master&#x2F;nwind&#x2F;src&#x2F;local_unwinding.rs">https:&#x2F;&#x2F;github.com&#x2F;koute&#x2F;not-perf&#x2F;blob&#x2F;master&#x2F;nwind&#x2F;src&#x2F;loca...</a></div><br/></div></div></div></div></div></div><div id="40457196" class="c"><input type="checkbox" id="c-40457196" checked=""/><div class="controls bullet"><span class="by">vlovich123</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456666">parent</a><span>|</span><a href="#40458215">prev</a><span>|</span><a href="#40459629">next</a><span>|</span><label class="collapse" for="c-40457196">[-]</label><label class="expand" for="c-40457196">[2 more]</label></div><br/><div class="children"><div class="content">Any plans to extend this idea into a performance profiler?<p>Also nice use of Gimli - did something similar to make creating stack traces on crash cheaper to symbolicate.</div><br/><div id="40463594" class="c"><input type="checkbox" id="c-40463594" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40457196">parent</a><span>|</span><a href="#40459629">next</a><span>|</span><label class="collapse" for="c-40463594">[-]</label><label class="expand" for="c-40463594">[1 more]</label></div><br/><div class="children"><div class="content">Not currently.<p>For performance profiling I find that `perf`-like sampling profiling works well enough to find the hot spots, and then Valgrind&#x27;s Callgrind is great for micro-optimizing the hot spots code on the assembly level.<p>Of course, it would be cool to have a unified memory + performance analysis tool like this, but I don&#x27;t think I can justify the time investment to write one in my spare time.<p>Yeah, I&#x27;m really happy that Gimli exists, considering the absolute insanity&#x2F;complexity pit of DWARF.</div><br/></div></div></div></div><div id="40459629" class="c"><input type="checkbox" id="c-40459629" checked=""/><div class="controls bullet"><span class="by">tubs</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40456666">parent</a><span>|</span><a href="#40457196">prev</a><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40459629">[-]</label><label class="expand" for="c-40459629">[3 more]</label></div><br/><div class="children"><div class="content">Any way this can work on arm64 without dwarf info at runtime? Would be very interested.</div><br/><div id="40463261" class="c"><input type="checkbox" id="c-40463261" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40459629">parent</a><span>|</span><a href="#40463149">next</a><span>|</span><label class="collapse" for="c-40463261">[-]</label><label class="expand" for="c-40463261">[1 more]</label></div><br/><div class="children"><div class="content">Yes, it should also work without any debugging info. You&#x27;ll still need unwinding tables though (used for handling exceptions in C++&#x2F;panics in Rust&#x2F;etc.), which are technically DWARF too (except on 32-bit ARM, which is special).</div><br/></div></div><div id="40463149" class="c"><input type="checkbox" id="c-40463149" checked=""/><div class="controls bullet"><span class="by">lathiat</span><span>|</span><a href="#40455954">root</a><span>|</span><a href="#40459629">parent</a><span>|</span><a href="#40463261">prev</a><span>|</span><a href="#40459184">next</a><span>|</span><label class="collapse" for="c-40463149">[-]</label><label class="expand" for="c-40463149">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure about this implementation, but the parca implementation only needs the .eh_frame section of the binary (which is part of, but not all of &quot;DWARF&quot;) which still exists even in stripped binaries.<p>However you then still need debug symbols of some kind to convert those to names.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40459184" class="c"><input type="checkbox" id="c-40459184" checked=""/><div class="controls bullet"><span class="by">j1elo</span><span>|</span><a href="#40455954">prev</a><span>|</span><label class="collapse" for="c-40459184">[-]</label><label class="expand" for="c-40459184">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;d like to learn more about the dual license &quot;MIT OR Apache-2.0&quot;: is there any practical advantage of using one over the other? Are there any expected use cases where Apache-2.0 wouldn&#x27;t be appropriate but MIT would?<p>I had always assumed that if the time came to choose a permissive OSS license, I&#x27;d just go with Apache-2.0 for the more complete legal ground that it provides (especially wrt. patents). Didn&#x27;t even occur to me that it would as much as <i>make sense</i> to offer MIT too (like, why not also BSD now that we&#x27;re at it?)</div><br/><div id="40459818" class="c"><input type="checkbox" id="c-40459818" checked=""/><div class="controls bullet"><span class="by">nicbn</span><span>|</span><a href="#40459184">parent</a><span>|</span><a href="#40463244">next</a><span>|</span><label class="collapse" for="c-40459818">[-]</label><label class="expand" for="c-40459818">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s common among Rust projects (the standard library also uses it).<p>Apache 2 has a patent grant 
so it&#x27;s preferred by companies, but is not compatible with GPLv2, and MIT is compatible with GPLv2.<p>Source: <a href="https:&#x2F;&#x2F;prev.rust-lang.org&#x2F;id-ID&#x2F;faq.html#why-a-dual-mit-asl2-license" rel="nofollow">https:&#x2F;&#x2F;prev.rust-lang.org&#x2F;id-ID&#x2F;faq.html#why-a-dual-mit-asl...</a></div><br/><div id="40460823" class="c"><input type="checkbox" id="c-40460823" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#40459184">root</a><span>|</span><a href="#40459818">parent</a><span>|</span><a href="#40463244">next</a><span>|</span><label class="collapse" for="c-40460823">[-]</label><label class="expand" for="c-40460823">[2 more]</label></div><br/><div class="children"><div class="content">For completeness:<p>Apache 2 <i>is</i> compatible with GPL 3, which outside the kernel most of the world uses.</div><br/><div id="40461324" class="c"><input type="checkbox" id="c-40461324" checked=""/><div class="controls bullet"><span class="by">cthalupa</span><span>|</span><a href="#40459184">root</a><span>|</span><a href="#40460823">parent</a><span>|</span><a href="#40463244">next</a><span>|</span><label class="collapse" for="c-40461324">[-]</label><label class="expand" for="c-40461324">[1 more]</label></div><br/><div class="children"><div class="content">&gt; which outside the kernel most of the world uses.<p>I&#x27;m... Not sure that is the case?<p>Some big projects still on (L)GPLv2, off the top of my head:<p>MySQL &amp; MariaDB, QEMU, Busybox, Git, Wireshark, probably many many more.</div><br/></div></div></div></div></div></div><div id="40463244" class="c"><input type="checkbox" id="c-40463244" checked=""/><div class="controls bullet"><span class="by">kouteiheika</span><span>|</span><a href="#40459184">parent</a><span>|</span><a href="#40459818">prev</a><span>|</span><label class="collapse" for="c-40463244">[-]</label><label class="expand" for="c-40463244">[1 more]</label></div><br/><div class="children"><div class="content">Besides the legal reasons that others already explained, I use it because I want people to be able to freely copy-paste code between projects while keeping licensing uniform, and this is essentially the &quot;standard&quot; in the Rust community.</div><br/></div></div></div></div></div></div></div></div></div></body></html>