<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1724058071688" as="style"/><link rel="stylesheet" href="styles.css?v=1724058071688"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.usenix.org/legacy/events/usenix05/tech/general/king/king.pdf">Debugging operating systems with time-traveling virtual machines (2005) [pdf]</a> <span class="domain">(<a href="https://www.usenix.org">www.usenix.org</a>)</span></div><div class="subtext"><span>Intralexical</span> | <span>16 comments</span></div><br/><div><div id="41285518" class="c"><input type="checkbox" id="c-41285518" checked=""/><div class="controls bullet"><span class="by">fatcunt</span><span>|</span><a href="#41285646">next</a><span>|</span><label class="collapse" for="c-41285518">[-]</label><label class="expand" for="c-41285518">[6 more]</label></div><br/><div class="children"><div class="content">Microsoft has, or had, a similar technology they use internally, called TKO: <a href="https:&#x2F;&#x2F;www.microsoft.com&#x2F;security&#x2F;blog&#x2F;2020&#x2F;05&#x2F;04&#x2F;mitigating-vulnerabilities-endpoint-network-stacks" rel="nofollow">https:&#x2F;&#x2F;www.microsoft.com&#x2F;security&#x2F;blog&#x2F;2020&#x2F;05&#x2F;04&#x2F;mitigatin...</a><p>It&#x27;s written in Rust and is based around a version of Bochs modified for deterministic execution. It&#x27;s got time-travel debugging (with WinDbg), which works by replaying forward from the nearest snapshot to the point at which the user is asking to move backwards to.<p>The primary author of this software wanted to open source it, but the higher-ups at MSFT refused. He&#x27;s been working on similar projects in a personal capacity though, e.g. <a href="https:&#x2F;&#x2F;gamozolabs.github.io&#x2F;fuzzing&#x2F;2020&#x2F;12&#x2F;06&#x2F;fuzzos.html" rel="nofollow">https:&#x2F;&#x2F;gamozolabs.github.io&#x2F;fuzzing&#x2F;2020&#x2F;12&#x2F;06&#x2F;fuzzos.html</a></div><br/><div id="41286155" class="c"><input type="checkbox" id="c-41286155" checked=""/><div class="controls bullet"><span class="by">grepfru_it</span><span>|</span><a href="#41285518">parent</a><span>|</span><a href="#41286143">next</a><span>|</span><label class="collapse" for="c-41286155">[-]</label><label class="expand" for="c-41286155">[3 more]</label></div><br/><div class="children"><div class="content">The trick at Microsoft is to start working on your project in your spare time. Then incorporate it into your project at MSFT. You get the clout associated with having an open source project but then you also get to use it internally as a sanctioned tool</div><br/><div id="41287998" class="c"><input type="checkbox" id="c-41287998" checked=""/><div class="controls bullet"><span class="by">DaiPlusPlus</span><span>|</span><a href="#41285518">root</a><span>|</span><a href="#41286155">parent</a><span>|</span><a href="#41286143">next</a><span>|</span><label class="collapse" for="c-41287998">[-]</label><label class="expand" for="c-41287998">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The trick at Microsoft is to start working on your project in your spare time. Then incorporate it into your project at MSFT.<p>(Ex-msftie here)<p>Microsoft is great for being amongst the tiny number of software companies that not only allow their FTEs to have their own software projects without attempting to claim any kind of ownership (compare with Apple where I’m told having even a public GitHub account without manager-approval is grounds for termination…) - but MS even actively encourages it too (though I cynically note that was when the Windows Phone App Store’s app-shortage was thought-of as a serious problem)<p>BUUUUT - they do require you to strictly avoid cross-over with their own products: you can’t just re-use your own code in a company project, or even reimplement it from-memory. Yes, there are ways of doing this properly (involving weeks of meetings with LCA arranging a permanent irrevocable - and possibly exclusive - rights transfer), wasting time better spent on other things) - so your project had better be something special <i>and</i> you’d need to give-up hope of getting rich from it (spare a very modest bonus the year you do the LCA paperwork if your skiplevel sees any value in it).</div><br/><div id="41288454" class="c"><input type="checkbox" id="c-41288454" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#41285518">root</a><span>|</span><a href="#41287998">parent</a><span>|</span><a href="#41286143">next</a><span>|</span><label class="collapse" for="c-41288454">[-]</label><label class="expand" for="c-41288454">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, and that is how stuff like C++&#x2F;CX gets killed, replaced by a side project that was never at the same tooling level in Visual Studio, even though there was a CppCon talk promising otherwise, and currently is in maintenance state because &quot;it achived its goals&quot;, who cares about those paying customers that had to rewrite their code to a lesser capable tool, now abandonend.</div><br/></div></div></div></div></div></div><div id="41286143" class="c"><input type="checkbox" id="c-41286143" checked=""/><div class="controls bullet"><span class="by">Cyph0n</span><span>|</span><a href="#41285518">parent</a><span>|</span><a href="#41286155">prev</a><span>|</span><a href="#41286327">next</a><span>|</span><label class="collapse" for="c-41286143">[-]</label><label class="expand" for="c-41286143">[1 more]</label></div><br/><div class="children"><div class="content">Watched some of his streams a while back. One of the most talented&#x2F;productive devs I have ever seen tbh.</div><br/></div></div><div id="41286327" class="c"><input type="checkbox" id="c-41286327" checked=""/><div class="controls bullet"><span class="by">ttecho2021</span><span>|</span><a href="#41285518">parent</a><span>|</span><a href="#41286143">prev</a><span>|</span><a href="#41285646">next</a><span>|</span><label class="collapse" for="c-41286327">[-]</label><label class="expand" for="c-41286327">[1 more]</label></div><br/><div class="children"><div class="content">Wow I stumbled on Gamozolabs&#x27; youtube when looking into determinism and hypervisors. Didn&#x27;t know he also worked on TKO for MSFT. Glad he is making a similar project!</div><br/></div></div></div></div><div id="41285646" class="c"><input type="checkbox" id="c-41285646" checked=""/><div class="controls bullet"><span class="by">roca</span><span>|</span><a href="#41285518">prev</a><span>|</span><a href="#41285320">next</a><span>|</span><label class="collapse" for="c-41285646">[-]</label><label class="expand" for="c-41285646">[3 more]</label></div><br/><div class="children"><div class="content">I wonder if this inspired the VMWare VM record-and-replay functionality that came out in 2008. They discontinued it in 2011, but it&#x27;s important to me because we used it at Mozilla to great effect and that made it easier for me to get Mozilla to support the development of rr, which started in 2011.</div><br/><div id="41288117" class="c"><input type="checkbox" id="c-41288117" checked=""/><div class="controls bullet"><span class="by">soamv</span><span>|</span><a href="#41285646">parent</a><span>|</span><a href="#41285656">next</a><span>|</span><label class="collapse" for="c-41288117">[-]</label><label class="expand" for="c-41288117">[1 more]</label></div><br/><div class="children"><div class="content">It might have, I remember attending a talk by Peter Chen when I was at VMware around that time, and I know there was some kind of collaboration. (I wasn&#x27;t involved in record-replay at VMware, but I was interested in it due to some ancient work I did with userspace record-replay debugging, <a href="https:&#x2F;&#x2F;lizard.sf.net" rel="nofollow">https:&#x2F;&#x2F;lizard.sf.net</a>).<p>rr is fantastic work, mad props! And the multiprocess stuff in pernosco looks super neat.</div><br/></div></div><div id="41285656" class="c"><input type="checkbox" id="c-41285656" checked=""/><div class="controls bullet"><span class="by">icholy</span><span>|</span><a href="#41285646">parent</a><span>|</span><a href="#41288117">prev</a><span>|</span><a href="#41285320">next</a><span>|</span><label class="collapse" for="c-41285656">[-]</label><label class="expand" for="c-41285656">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t get how rr isn&#x27;t more popular.</div><br/></div></div></div></div><div id="41285320" class="c"><input type="checkbox" id="c-41285320" checked=""/><div class="controls bullet"><span class="by">Veserv</span><span>|</span><a href="#41285646">prev</a><span>|</span><a href="#41285760">next</a><span>|</span><label class="collapse" for="c-41285320">[-]</label><label class="expand" for="c-41285320">[2 more]</label></div><br/><div class="children"><div class="content">A history of other time traveling debugging papers and products (including this one):<p><a href="https:&#x2F;&#x2F;jakob.engbloms.se&#x2F;archives&#x2F;1554" rel="nofollow">https:&#x2F;&#x2F;jakob.engbloms.se&#x2F;archives&#x2F;1554</a><p><a href="https:&#x2F;&#x2F;jakob.engbloms.se&#x2F;archives&#x2F;1564" rel="nofollow">https:&#x2F;&#x2F;jakob.engbloms.se&#x2F;archives&#x2F;1564</a></div><br/></div></div><div id="41285760" class="c"><input type="checkbox" id="c-41285760" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41285320">prev</a><span>|</span><a href="#41284243">next</a><span>|</span><label class="collapse" for="c-41285760">[-]</label><label class="expand" for="c-41285760">[1 more]</label></div><br/><div class="children"><div class="content">Debuggers have had history tracing functionality for a long time, but being extremely slow and consuming a lot of storage meant it was rarely used except for very specific cases. Now that CPUs are faster and the average machine has a lot more RAM, it becomes more feasible to do this.</div><br/></div></div><div id="41284243" class="c"><input type="checkbox" id="c-41284243" checked=""/><div class="controls bullet"><span class="by">Intralexical</span><span>|</span><a href="#41285760">prev</a><span>|</span><a href="#41285086">next</a><span>|</span><label class="collapse" for="c-41284243">[-]</label><label class="expand" for="c-41284243">[2 more]</label></div><br/><div class="children"><div class="content">Abstract:<p><pre><code>   Operating systems are difficult to debug with traditional cyclic debugging. They are non-deterministic; they run for long periods of time; they interact directly with hard-ware devices; and their state is easily perturbed by the act of debugging. This paper describes a time-traveling virtual machine that overcomes many of the difficulties associated with debugging operating systems. Time travel enables a programmer to navigate backward and forward arbitrarily through the execution history of a particular run and to replay arbitrary segments of the past execution. We integrate time travel into a general-purpose debugger to enable a programmer to debug an OS in reverse, implementing commands such as reverse breakpoint, reverse watchpoint, and reverse single step. The space and time overheads needed to support time travel are reasonable for debugging, and movements in time are fast enough to support interactive debugging. We demonstrate the value of our time-traveling virtual machine by using it to understand and fix several OS bugs that are difficult to find with standard debugging tools. Reverse debugging is especially helpful in finding bugs that are fragile due to non-determinism, bugs in device drivers, bugs that require long runs to trigger, bugs that corrupt the stack, and bugs that are detected after the relevant stack frame is popped.

</code></pre>
Related work:<p>&quot;ConSnap: Taking continuous snapshots for running state protection of virtual machines&quot;<p><a href="https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20151014000129id_&#x2F;http:&#x2F;&#x2F;act.buaa.edu.cn:80&#x2F;yangrenyu&#x2F;paper&#x2F;icpads2014-147.pdf" rel="nofollow">https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20151014000129id_&#x2F;http:&#x2F;&#x2F;act.bua...</a><p><pre><code>    …In this paper, we present ConSnap, a system designed to enable taking fine-grained continuous snapshots of virtual machines… decrease the snapshot interval to dozens of milliseconds. We have implemented ConSnap on QEMU&#x2F;KVM…. Compared with the stop-and-copy based incremental snapshots, ConSnap reduces the performance loss by 71.1% ~ 10.2% under Compilation workload, and 14.5% ~ 4.7% for the Ftp workload, when the interval varies from 1s to 60s.

</code></pre>
&quot;ReVirt: Enabling Intrusion Analysis Through Virtual-Machine Logging and Replay&quot;<p><a href="https:&#x2F;&#x2F;www.usenix.org&#x2F;legacy&#x2F;events&#x2F;osdi02&#x2F;tech&#x2F;full_papers&#x2F;dunlap&#x2F;dunlap.pdf" rel="nofollow">https:&#x2F;&#x2F;www.usenix.org&#x2F;legacy&#x2F;events&#x2F;osdi02&#x2F;tech&#x2F;full_papers...</a><p><pre><code>    …ReVirt logs enough information to replay a long-term execution of the virtual machine instruction-by-instruction. This enables it to provide arbitrarily detailed observations about what transpired on the system, even in the presence of non-deterministic attacks and executions. ReVirt adds reasonable time and space overhead. Overheads due to virtualization are imperceptible for interactive use and CPU-bound workloads, and 13-58% for kernel-intensive workloads. Logging adds 0-8% overhead, and logging traffic for our workloads can be stored on a single disk for several months.</code></pre></div><br/><div id="41286667" class="c"><input type="checkbox" id="c-41286667" checked=""/><div class="controls bullet"><span class="by">ForOldHack</span><span>|</span><a href="#41284243">parent</a><span>|</span><a href="#41285086">next</a><span>|</span><label class="collapse" for="c-41286667">[-]</label><label class="expand" for="c-41286667">[1 more]</label></div><br/><div class="children"><div class="content">Related work: IBM first mainframes were so unreliable, that they put a feature in that you could restore the machine to the instruction that crashed, and continue processing, and you could back out of the last few instructions. State of the art for the late 1950s.<p>It was not virtual, that would become standard through on less than a decade.<p>Optimizing çopilers came with source tapes, and a huge expensive.</div><br/></div></div></div></div><div id="41285086" class="c"><input type="checkbox" id="c-41285086" checked=""/><div class="controls bullet"><span class="by">drewg123</span><span>|</span><a href="#41284243">prev</a><span>|</span><label class="collapse" for="c-41285086">[-]</label><label class="expand" for="c-41285086">[1 more]</label></div><br/><div class="children"><div class="content">This needs a [2005] qualifier</div><br/></div></div></div></div></div></div></div></body></html>