<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1730278864118" as="style"/><link rel="stylesheet" href="styles.css?v=1730278864118"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.infoq.com/presentations/1brc/">1BRC Coding Challenge: Nerd Sniping the Java Community</a> <span class="domain">(<a href="https://www.infoq.com">www.infoq.com</a>)</span></div><div class="subtext"><span>saikatsg</span> | <span>15 comments</span></div><br/><div><div id="41992966" class="c"><input type="checkbox" id="c-41992966" checked=""/><div class="controls bullet"><span class="by">gunnarmorling</span><span>|</span><a href="#41992704">next</a><span>|</span><label class="collapse" for="c-41992966">[-]</label><label class="expand" for="c-41992966">[2 more]</label></div><br/><div class="children"><div class="content">Presenter of that talk here, very cool to see it being shared here.<p>Running 1BRC was immensely fun, I learned a ton from it. Had you told me before how far the community would be able to push this, I&#x27;d have not believed you.<p>One main take-away for me was that you could improve performance by one order of magnitude over the baseline basically by just doing a good job and avoiding basic mistakes. The resulting code is still well readable and maintainable. In most scenarios, this is where you should stop.<p>If you want to improve by another order of magnitude (like leaders in the challenge did), code becomes completely non-idiomatic, super-dense, and hard to maintain. You should go there only where it really, really matters, like when building a database kernel for instance. Or well, when trying to win a coding challenge ;)<p>Some more resources for those interested:<p>* Blog post with the results: <a href="https:&#x2F;&#x2F;www.morling.dev&#x2F;blog&#x2F;1brc-results-are-in&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.morling.dev&#x2F;blog&#x2F;1brc-results-are-in&#x2F;</a><p>* Show &amp; Tell, featuring implementations in languages other than Java: <a href="https:&#x2F;&#x2F;github.com&#x2F;gunnarmorling&#x2F;1brc&#x2F;discussions&#x2F;categories&#x2F;show-and-tell">https:&#x2F;&#x2F;github.com&#x2F;gunnarmorling&#x2F;1brc&#x2F;discussions&#x2F;categories...</a><p>* List of many more blog posts discussing 1BRC in different languages: <a href="https:&#x2F;&#x2F;github.com&#x2F;gunnarmorling&#x2F;1brc?tab=readme-ov-file#1brc-on-the-web">https:&#x2F;&#x2F;github.com&#x2F;gunnarmorling&#x2F;1brc?tab=readme-ov-file#1br...</a><p>* 3h deep-dive into the implementation techniques by Thomas Würthinger and Roy van Rijn, two of the top participants of the challenge: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=_w4-BqeeC0k" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=_w4-BqeeC0k</a></div><br/><div id="41993063" class="c"><input type="checkbox" id="c-41993063" checked=""/><div class="controls bullet"><span class="by">adeptima</span><span>|</span><a href="#41992966">parent</a><span>|</span><a href="#41992704">next</a><span>|</span><label class="collapse" for="c-41993063">[-]</label><label class="expand" for="c-41993063">[1 more]</label></div><br/><div class="children"><div class="content">Amazing! I&#x27;ve just asked few secs ago to share more posts discussing 1BRC in different languages, and here we go. Thank you!</div><br/></div></div></div></div><div id="41992704" class="c"><input type="checkbox" id="c-41992704" checked=""/><div class="controls bullet"><span class="by">ww520</span><span>|</span><a href="#41992966">prev</a><span>|</span><a href="#41992873">next</a><span>|</span><label class="collapse" for="c-41992704">[-]</label><label class="expand" for="c-41992704">[3 more]</label></div><br/><div class="children"><div class="content">As part of learning zig I did an implementation in zig. It got under 1 second within the contest rules on a 6 year old desktop machine. I need to write up a blog when I get the chance.</div><br/><div id="41992888" class="c"><input type="checkbox" id="c-41992888" checked=""/><div class="controls bullet"><span class="by">adeptima</span><span>|</span><a href="#41992704">parent</a><span>|</span><a href="#41992873">next</a><span>|</span><label class="collapse" for="c-41992888">[-]</label><label class="expand" for="c-41992888">[2 more]</label></div><br/><div class="children"><div class="content">please share! it&#x27;s such great challenge to map each language internals. here&#x27;s an idea how to write up <a href="https:&#x2F;&#x2F;r2p.dev&#x2F;b&#x2F;2024-03-18-1brc-go&#x2F;" rel="nofollow">https:&#x2F;&#x2F;r2p.dev&#x2F;b&#x2F;2024-03-18-1brc-go&#x2F;</a></div><br/><div id="41993048" class="c"><input type="checkbox" id="c-41993048" checked=""/><div class="controls bullet"><span class="by">ww520</span><span>|</span><a href="#41992704">root</a><span>|</span><a href="#41992888">parent</a><span>|</span><a href="#41992873">next</a><span>|</span><label class="collapse" for="c-41993048">[-]</label><label class="expand" for="c-41993048">[1 more]</label></div><br/><div class="children"><div class="content">Besides the standard tricks to speed up the running time like threads and mmap, the biggest speed up is to use a custom hash table that is tuned for the data. I have implemented 5 different versions of hash tables including the Swiss hash table and more recent researched ones. None of them beats a simple linear probing approach. It’s because there’re so few keys, only couple hundreds of them. Tuning a custom hashing function to minimize key collision helps more than anything.<p>There are also lots of SIMD operations, which Zig has great support in the form of vector programming.<p>The only thing novel I did was to line up the temperature data from the back instead of from the front for the SIMD operations. That is for temperatures 12.3, 4.5, 67.8, 0.1, I line them up by the last digit after the decimal before packing them into a SIMD register. That way I know their exact positions in the register.</div><br/></div></div></div></div></div></div><div id="41992873" class="c"><input type="checkbox" id="c-41992873" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#41992704">prev</a><span>|</span><a href="#41992849">next</a><span>|</span><label class="collapse" for="c-41992873">[-]</label><label class="expand" for="c-41992873">[2 more]</label></div><br/><div class="children"><div class="content">The main takeaway is that 1 billion rows is just not that much nowadays.<p>A corollary is &#x27;postgres is really all you need&#x27; unless you have <i>irrefutable</i> proof it isn&#x27;t.</div><br/><div id="41993051" class="c"><input type="checkbox" id="c-41993051" checked=""/><div class="controls bullet"><span class="by">pkolaczk</span><span>|</span><a href="#41992873">parent</a><span>|</span><a href="#41992849">next</a><span>|</span><label class="collapse" for="c-41993051">[-]</label><label class="expand" for="c-41993051">[1 more]</label></div><br/><div class="children"><div class="content">Modern hardware has really impressive speed. A single core of my not-so-new M2 laptop can decompress data at more than 4 GB&#x2F;s using lz4. Sometimes I wonder where all that performance goes, eg when waiting for Slack to open ;)</div><br/></div></div></div></div><div id="41992849" class="c"><input type="checkbox" id="c-41992849" checked=""/><div class="controls bullet"><span class="by">adeptima</span><span>|</span><a href="#41992873">prev</a><span>|</span><a href="#41992843">next</a><span>|</span><label class="collapse" for="c-41992849">[-]</label><label class="expand" for="c-41992849">[4 more]</label></div><br/><div class="children"><div class="content">@ThePrimeTimeagen trigger ... BRazil mentioned ...<p>New Go Billion Row Challenge w&#x2F; Great Optimizations | Prime Reacts<p>- <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=SZ1PDS7iRU8" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=SZ1PDS7iRU8</a><p>- <a href="https:&#x2F;&#x2F;r2p.dev&#x2F;b&#x2F;2024-03-18-1brc-go&#x2F;" rel="nofollow">https:&#x2F;&#x2F;r2p.dev&#x2F;b&#x2F;2024-03-18-1brc-go&#x2F;</a><p>Spoiler:<p>SwissMap: A smaller, faster Golang Hash Table<p>- <a href="https:&#x2F;&#x2F;www.dolthub.com&#x2F;blog&#x2F;2023-03-28-swiss-map&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.dolthub.com&#x2F;blog&#x2F;2023-03-28-swiss-map&#x2F;</a><p>- <a href="https:&#x2F;&#x2F;github.com&#x2F;dolthub&#x2F;swiss">https:&#x2F;&#x2F;github.com&#x2F;dolthub&#x2F;swiss</a><p>Want to see Paul Allen&#x27;s implementation in Rust, Zig, Mojo ... and even Bun.sh, Deno.com</div><br/><div id="41992997" class="c"><input type="checkbox" id="c-41992997" checked=""/><div class="controls bullet"><span class="by">neonsunset</span><span>|</span><a href="#41992849">parent</a><span>|</span><a href="#41992854">next</a><span>|</span><label class="collapse" for="c-41992997">[-]</label><label class="expand" for="c-41992997">[2 more]</label></div><br/><div class="children"><div class="content">Twice as slow as top submissions in C# and C++ which is still pretty good for Go but a likely indicator that memory here has become the major bottleneck.<p><a href="https:&#x2F;&#x2F;hotforknowledge.com&#x2F;2024&#x2F;01&#x2F;13&#x2F;1brc-in-dotnet-among-fastest-on-linux-my-optimization-journey&#x2F;" rel="nofollow">https:&#x2F;&#x2F;hotforknowledge.com&#x2F;2024&#x2F;01&#x2F;13&#x2F;1brc-in-dotnet-among-...</a></div><br/><div id="41993044" class="c"><input type="checkbox" id="c-41993044" checked=""/><div class="controls bullet"><span class="by">adeptima</span><span>|</span><a href="#41992849">root</a><span>|</span><a href="#41992997">parent</a><span>|</span><a href="#41992854">next</a><span>|</span><label class="collapse" for="c-41993044">[-]</label><label class="expand" for="c-41993044">[1 more]</label></div><br/><div class="children"><div class="content">thanx! 2.9 seconds (4.5 GB&#x2F;s using .NET 8 on my Xeon Mac)</div><br/></div></div></div></div><div id="41992854" class="c"><input type="checkbox" id="c-41992854" checked=""/><div class="controls bullet"><span class="by">adeptima</span><span>|</span><a href="#41992849">parent</a><span>|</span><a href="#41992997">prev</a><span>|</span><a href="#41992843">next</a><span>|</span><label class="collapse" for="c-41992854">[-]</label><label class="expand" for="c-41992854">[1 more]</label></div><br/><div class="children"><div class="content">... previously <a href="https:&#x2F;&#x2F;github.com&#x2F;shraddhaag&#x2F;1brc">https:&#x2F;&#x2F;github.com&#x2F;shraddhaag&#x2F;1brc</a></div><br/></div></div></div></div><div id="41992843" class="c"><input type="checkbox" id="c-41992843" checked=""/><div class="controls bullet"><span class="by">oneeyedpigeon</span><span>|</span><a href="#41992849">prev</a><span>|</span><a href="#41992683">next</a><span>|</span><label class="collapse" for="c-41992843">[-]</label><label class="expand" for="c-41992843">[1 more]</label></div><br/><div class="children"><div class="content">If there must be a cookie popup at all, this site is a great example of how to do it.<p>(Edit: although it kinda then spoils it with the newsletter popup)</div><br/></div></div><div id="41992683" class="c"><input type="checkbox" id="c-41992683" checked=""/><div class="controls bullet"><span class="by">seinecle</span><span>|</span><a href="#41992843">prev</a><span>|</span><a href="#41992339">next</a><span>|</span><label class="collapse" for="c-41992683">[-]</label><label class="expand" for="c-41992683">[1 more]</label></div><br/><div class="children"><div class="content">There should be a book about Java perf &#x2F; hacks derived from this challenge. I&#x27;d buy it fore sure.</div><br/></div></div><div id="41992339" class="c"><input type="checkbox" id="c-41992339" checked=""/><div class="controls bullet"><span class="by">forlornacorn</span><span>|</span><a href="#41992683">prev</a><span>|</span><label class="collapse" for="c-41992339">[-]</label><label class="expand" for="c-41992339">[1 more]</label></div><br/><div class="children"><div class="content">Gunnar is brilliant.</div><br/></div></div></div></div></div></div></div></body></html>