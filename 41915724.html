<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729674074069" as="style"/><link rel="stylesheet" href="styles.css?v=1729674074069"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://planetscale.com/blog/announcing-planetscale-vectors-public-beta">The PlanetScale vectors public beta</a> <span class="domain">(<a href="https://planetscale.com">planetscale.com</a>)</span></div><div class="subtext"><span>ksec</span> | <span>24 comments</span></div><br/><div><div id="41916744" class="c"><input type="checkbox" id="c-41916744" checked=""/><div class="controls bullet"><span class="by">tanoku</span><span>|</span><a href="#41919723">next</a><span>|</span><label class="collapse" for="c-41916744">[-]</label><label class="expand" for="c-41916744">[11 more]</label></div><br/><div class="children"><div class="content">Hi! I&#x27;m one of the authors of this feature. It&#x27;s something quite novel, because it&#x27;s not just a HNSW plug-in for MySQL (like e.g. pgvector is for Postgres). It&#x27;s a fully transactional index, integrated into InnoDB.<p>We based the implementation on two very new papers from Microsoft Research, SPANN and SPFresh. SPANN is a hybrid graph&#x2F;tree algorithm that does a fantastic job of scaling larger-than-RAM indexes (<a href="https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;2111.08566" rel="nofollow">https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;2111.08566</a>) and SPFresh expands upon it by defining a set of background operations that can be performed to maintain the index&#x27;s performance and recall while it&#x27;s continuously updated in-place (<a href="https:&#x2F;&#x2F;arxiv.org&#x2F;html&#x2F;2410.14452v1" rel="nofollow">https:&#x2F;&#x2F;arxiv.org&#x2F;html&#x2F;2410.14452v1</a>). The novel thing here is designing all the SPANN _and_ SPFresh operations to be transactional, and integrating them in MySQL&#x27;s default storage engine.<p>This tight integration fundamentally means that inserting, updating and deleting vector data from MySQL is always reflected immediately in the index as part of committing your transaction. But it also means that the indexes are fully covered by the MySQL binlog; they recover from hard crashes just fine. They&#x27;re also managed by MySQL&#x27;s buffer pool, so they scale to terabytes of data, just like any other table. And also crucially, they&#x27;re fully integrated with the query planner, so they can be used in any query, including JOINs and WHERE clauses (something that many other vector indexes really struggle with).<p>We plan to release a whitepaper on our transactionality extensions to SPFresh, which I think will be super interesting, but meanwhile please feel free to test the beta and ask me any questions (here, or by emailing PlanetScale support). Thanks!</div><br/><div id="41920038" class="c"><input type="checkbox" id="c-41920038" checked=""/><div class="controls bullet"><span class="by">ksec</span><span>|</span><a href="#41916744">parent</a><span>|</span><a href="#41917310">next</a><span>|</span><label class="collapse" for="c-41920038">[-]</label><label class="expand" for="c-41920038">[4 more]</label></div><br/><div class="children"><div class="content">Will this be open sourced and be upstreamed to MySQL? Or will it always be Planetscale specific?</div><br/><div id="41922825" class="c"><input type="checkbox" id="c-41922825" checked=""/><div class="controls bullet"><span class="by">osser</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41920038">parent</a><span>|</span><a href="#41921962">next</a><span>|</span><label class="collapse" for="c-41922825">[-]</label><label class="expand" for="c-41922825">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s already open source, because GPL requires it. It&#x27;s unlikely to be accepted as an upstream contribution given that Oracle has their own Vector type that is only available in their MySQL cloud service. Don&#x27;t expect it to show up in a standard Oracle MySQL community release.</div><br/><div id="41923131" class="c"><input type="checkbox" id="c-41923131" checked=""/><div class="controls bullet"><span class="by">ascorbic</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41922825">parent</a><span>|</span><a href="#41921962">next</a><span>|</span><label class="collapse" for="c-41923131">[-]</label><label class="expand" for="c-41923131">[1 more]</label></div><br/><div class="children"><div class="content">Is that the case when they&#x27;re only providing as a service rather than distributing it? And if it is, where&#x27;s the code?</div><br/></div></div></div></div><div id="41921962" class="c"><input type="checkbox" id="c-41921962" checked=""/><div class="controls bullet"><span class="by">samdung</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41920038">parent</a><span>|</span><a href="#41922825">prev</a><span>|</span><a href="#41917310">next</a><span>|</span><label class="collapse" for="c-41921962">[-]</label><label class="expand" for="c-41921962">[1 more]</label></div><br/><div class="children"><div class="content">I have the same question. I have a small DB on Planetscale and happily pay 39 for it. IMO, Vector DB&#x27;s are the next frontier. I can understand the tough decision for Planetscale, given that the cloud services can just offer it as a service and corner all value of an open source project.</div><br/></div></div></div></div><div id="41917310" class="c"><input type="checkbox" id="c-41917310" checked=""/><div class="controls bullet"><span class="by">sujayakar</span><span>|</span><a href="#41916744">parent</a><span>|</span><a href="#41920038">prev</a><span>|</span><a href="#41919126">next</a><span>|</span><label class="collapse" for="c-41917310">[-]</label><label class="expand" for="c-41917310">[3 more]</label></div><br/><div class="children"><div class="content">very cool stuff! I just read the SPFresh paper a few days ago and was wondering if it&#x27;s been implemented in industry (e.g. Turbopuffer&#x27;s implementation of SPANN).<p>I&#x27;d be curious how y&#x27;all represent the posting lists for each partition in InnoDB:<p>- what IDs are you storing in the posting lists?<p>- how are the posting lists represented on disk? are they using compression and&#x2F;or some form of skip indexing? the paper seemed to use a pretty simple block-based representation, but I&#x27;m curious what works well in practice.<p>- how do the posting list data structures themselves handle incremental updates and MVCC?</div><br/><div id="41917426" class="c"><input type="checkbox" id="c-41917426" checked=""/><div class="controls bullet"><span class="by">tanoku</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41917310">parent</a><span>|</span><a href="#41919126">next</a><span>|</span><label class="collapse" for="c-41917426">[-]</label><label class="expand" for="c-41917426">[2 more]</label></div><br/><div class="children"><div class="content">These are very relevant questions! Thank you!<p>We&#x27;re storing IDs from a ghost column that is created in the table where you&#x27;re inserting vector data. This works very well in practice and allows updating the value of the vectors in the table, because they&#x27;re translated into a delete + insert in the vector index by updating the ghost ID.<p>We have abstracted away the quantization system from the index; for the initial release, vector data is stored in raw blocks, like in the paper. Query performance is good, but disk usage is high. We&#x27;re actively testing different quantization algorithms to see which ones we end up offering on GA. We&#x27;re hoping our beta users will help us guide this choice!<p>Incremental updates and MVCC are _extremely tricky_, for both correctness and performance. As you&#x27;ve surely noticed, the hard thing here is that the original paper is very focused on LSM trees, because it exploits the fact that LSM trees get compacted lazily to perform incremental updates to the posting lists (&#x27;merges&#x27;). MySQL (and Postgres, and all relational databases, really) are B-tree based, and in-place updates for B-trees are expensive! I think we came up with very interesting workarounds for the problem, but it&#x27;s a quite a bit to drill down in a HN comment. Please stay tuned for our whitepaper. :)</div><br/><div id="41917727" class="c"><input type="checkbox" id="c-41917727" checked=""/><div class="controls bullet"><span class="by">sujayakar</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41917426">parent</a><span>|</span><a href="#41919126">next</a><span>|</span><label class="collapse" for="c-41917727">[-]</label><label class="expand" for="c-41917727">[1 more]</label></div><br/><div class="children"><div class="content">looking forward to it!<p>I&#x27;d be curious if y&#x27;all end up supporting adding filter attributes to the inverted index that can then be pushed down into the posting list traversal.<p>for example, a restaurant search app may have (1) an embedding for each restaurant but also (2) a cuisine. then, if a restaurant has `cuisine = Italian`, we&#x27;d also store its ghost ID in a `cuisine:Italian` posting list.<p>at query time, the query planner could take a query like `SELECT * FROM t1 WHERE cuisine = &#x27;Italian&#x27; ORDER BY DISTANCE(..)` and emit a plan that efficiently intersects the `cuisine:Italian` posting list with the union of the partitions&#x27; posting lists.<p>this feels to me like a potential strength of the inverted indexing approach compared to graph-based approaches, which struggle with general filtering (e.g. the Filtered-DiskANN paper).</div><br/></div></div></div></div></div></div><div id="41919126" class="c"><input type="checkbox" id="c-41919126" checked=""/><div class="controls bullet"><span class="by">trollied</span><span>|</span><a href="#41916744">parent</a><span>|</span><a href="#41917310">prev</a><span>|</span><a href="#41919723">next</a><span>|</span><label class="collapse" for="c-41919126">[-]</label><label class="expand" for="c-41919126">[3 more]</label></div><br/><div class="children"><div class="content">Since you&#x27;re here - why decide to write something from scratch for mysql instead of using&#x2F;improving postgres? Seems like a very strange decision. MySQL is a poor RDBMS in comparison.</div><br/><div id="41919833" class="c"><input type="checkbox" id="c-41919833" checked=""/><div class="controls bullet"><span class="by">prng2021</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41919126">parent</a><span>|</span><a href="#41919333">next</a><span>|</span><label class="collapse" for="c-41919833">[-]</label><label class="expand" for="c-41919833">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.uber.com&#x2F;blog&#x2F;postgres-to-mysql-migration&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.uber.com&#x2F;blog&#x2F;postgres-to-mysql-migration&#x2F;</a><p><a href="https:&#x2F;&#x2F;www.mysql.com&#x2F;customers&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.mysql.com&#x2F;customers&#x2F;</a></div><br/></div></div><div id="41919333" class="c"><input type="checkbox" id="c-41919333" checked=""/><div class="controls bullet"><span class="by">estebarb</span><span>|</span><a href="#41916744">root</a><span>|</span><a href="#41919126">parent</a><span>|</span><a href="#41919833">prev</a><span>|</span><a href="#41919723">next</a><span>|</span><label class="collapse" for="c-41919333">[-]</label><label class="expand" for="c-41919333">[1 more]</label></div><br/><div class="children"><div class="content">PlanetScale is built on Vitess. Vitess was created in 2010 to help scaling MySQL at Youtube.</div><br/></div></div></div></div></div></div><div id="41919723" class="c"><input type="checkbox" id="c-41919723" checked=""/><div class="controls bullet"><span class="by">emmanueloga_</span><span>|</span><a href="#41916744">prev</a><span>|</span><a href="#41916372">next</a><span>|</span><label class="collapse" for="c-41919723">[-]</label><label class="expand" for="c-41919723">[1 more]</label></div><br/><div class="children"><div class="content">&quot;... every relational DBMS will have a high-performance implementation of a vector index within the next five years ... &quot; [1]<p>Andy Pavlo, Jan 4, 2024<p>P.S.: R.I.P. Ottertune.<p>---<p>1: <a href="https:&#x2F;&#x2F;archive.is&#x2F;rzMnq#selection-467.69-467.180" rel="nofollow">https:&#x2F;&#x2F;archive.is&#x2F;rzMnq#selection-467.69-467.180</a></div><br/></div></div><div id="41916372" class="c"><input type="checkbox" id="c-41916372" checked=""/><div class="controls bullet"><span class="by">alberth</span><span>|</span><a href="#41919723">prev</a><span>|</span><a href="#41917904">next</a><span>|</span><label class="collapse" for="c-41916372">[-]</label><label class="expand" for="c-41916372">[3 more]</label></div><br/><div class="children"><div class="content">Given that PlanetScale only operates in a handful of AWS and Google regions, isn&#x27;t the latency brutal for any customer not hosting in 1 of the ~12 datacenter PlanetScale is in.</div><br/><div id="41919128" class="c"><input type="checkbox" id="c-41919128" checked=""/><div class="controls bullet"><span class="by">andkenneth</span><span>|</span><a href="#41916372">parent</a><span>|</span><a href="#41917904">next</a><span>|</span><label class="collapse" for="c-41919128">[-]</label><label class="expand" for="c-41919128">[2 more]</label></div><br/><div class="children"><div class="content">At the enterprise level my understanding is that PlanetScale can operate within your environment directly instead of as a pure service.</div><br/><div id="41919142" class="c"><input type="checkbox" id="c-41919142" checked=""/><div class="controls bullet"><span class="by">samlambert</span><span>|</span><a href="#41916372">root</a><span>|</span><a href="#41919128">parent</a><span>|</span><a href="#41917904">next</a><span>|</span><label class="collapse" for="c-41919142">[-]</label><label class="expand" for="c-41919142">[1 more]</label></div><br/><div class="children"><div class="content">this is correct</div><br/></div></div></div></div></div></div><div id="41917904" class="c"><input type="checkbox" id="c-41917904" checked=""/><div class="controls bullet"><span class="by">cholmon</span><span>|</span><a href="#41916372">prev</a><span>|</span><a href="#41917191">next</a><span>|</span><label class="collapse" for="c-41917904">[-]</label><label class="expand" for="c-41917904">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m very interested to see this alongside MySQL 9 (<a href="https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;9.0&#x2F;en&#x2F;vector-functions.html" rel="nofollow">https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;9.0&#x2F;en&#x2F;vector-functions.htm...</a>), and MariaDB (<a href="https:&#x2F;&#x2F;mariadb.com&#x2F;kb&#x2F;en&#x2F;vector-overview&#x2F;" rel="nofollow">https:&#x2F;&#x2F;mariadb.com&#x2F;kb&#x2F;en&#x2F;vector-overview&#x2F;</a>).<p>Will these converge on a common syntax for vector fields, indexes, and comparison functions in the near future? Or will vector implementations just add momentum to the increasing incompatibility in the MySQL-ish ecosystem?</div><br/><div id="41918475" class="c"><input type="checkbox" id="c-41918475" checked=""/><div class="controls bullet"><span class="by">tanoku</span><span>|</span><a href="#41917904">parent</a><span>|</span><a href="#41917191">next</a><span>|</span><label class="collapse" for="c-41918475">[-]</label><label class="expand" for="c-41918475">[1 more]</label></div><br/><div class="children"><div class="content">Our vector implementation is fully compatible with the syntax for vector fields and comparison functions in MySQL 9 -- we have carefully backported all the changes to our version of MySQL 8 to ensure full backwards and forwards compatibility. The index syntax is specific to PlanetScale because the open-source MySQL 9 preview does not yet have support for ANN indexes on vector columns, but we&#x27;re committed to being as compatible as possible in the future and to minimize fragmentation. I do agree that fragmenting the ecosystem is not great!</div><br/></div></div></div></div><div id="41917191" class="c"><input type="checkbox" id="c-41917191" checked=""/><div class="controls bullet"><span class="by">vvladymyrov</span><span>|</span><a href="#41917904">prev</a><span>|</span><a href="#41919492">next</a><span>|</span><label class="collapse" for="c-41917191">[-]</label><label class="expand" for="c-41917191">[2 more]</label></div><br/><div class="children"><div class="content">Awesome. Does planetscale vector support multi node indices (like Milvus) and even further blob store index storage which can be separate from compute, allowing to pay for compute on demand when queries are run?</div><br/><div id="41917269" class="c"><input type="checkbox" id="c-41917269" checked=""/><div class="controls bullet"><span class="by">tanoku</span><span>|</span><a href="#41917191">parent</a><span>|</span><a href="#41919492">next</a><span>|</span><label class="collapse" for="c-41917269">[-]</label><label class="expand" for="c-41917269">[1 more]</label></div><br/><div class="children"><div class="content">Definitely yes to the first: the index implementation is fully integrated with PlanetScale&#x27;s sharding layer, so you can scale horizontally as much as you need. This works very well in practice: the sharding layer, Vitess, is extremely well battle tested with petabyte-sized clusters in production, and our vector indexes are like any other table on the cluster, so it really scales horizontally with very predictable performance.<p>As for separating storage and compute: we don&#x27;t do that. One of our key sells here is that this is vector data fully integrated into your relational database with ACID semantics. Very hard to do separate storage and compute and keep this behavior!</div><br/></div></div></div></div><div id="41919492" class="c"><input type="checkbox" id="c-41919492" checked=""/><div class="controls bullet"><span class="by">Temporary_31337</span><span>|</span><a href="#41917191">prev</a><span>|</span><a href="#41916391">next</a><span>|</span><label class="collapse" for="c-41919492">[-]</label><label class="expand" for="c-41919492">[3 more]</label></div><br/><div class="children"><div class="content">I work for another db vendor and we also have added vectors support. What’s crazy is that customers were not really asking for- just surfing the hype wave like everyone else. Why would someone store vectors in an SQL db rather than a dedicated vector db with support for native graph &#x2F; vector semantics?</div><br/><div id="41920655" class="c"><input type="checkbox" id="c-41920655" checked=""/><div class="controls bullet"><span class="by">twoodfin</span><span>|</span><a href="#41919492">parent</a><span>|</span><a href="#41919518">next</a><span>|</span><label class="collapse" for="c-41920655">[-]</label><label class="expand" for="c-41920655">[1 more]</label></div><br/><div class="children"><div class="content">For one thing, combining vector similarity ranking and traditional WHERE clause conditions in the same query is tremendously useful.<p>“This customer has called our support line 20 times in the past year, pop up the most relevant prior tickets to their current request.”</div><br/></div></div><div id="41919518" class="c"><input type="checkbox" id="c-41919518" checked=""/><div class="controls bullet"><span class="by">herval</span><span>|</span><a href="#41919492">parent</a><span>|</span><a href="#41920655">prev</a><span>|</span><a href="#41916391">next</a><span>|</span><label class="collapse" for="c-41919518">[-]</label><label class="expand" for="c-41919518">[1 more]</label></div><br/><div class="children"><div class="content">Are you asking why you did it?</div><br/></div></div></div></div><div id="41916391" class="c"><input type="checkbox" id="c-41916391" checked=""/><div class="controls bullet"><span class="by">sgammon</span><span>|</span><a href="#41919492">prev</a><span>|</span><label class="collapse" for="c-41916391">[-]</label><label class="expand" for="c-41916391">[1 more]</label></div><br/><div class="children"><div class="content">Awesome! Excited to play with this one.</div><br/></div></div></div></div></div></div></div></body></html>