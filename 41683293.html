<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727600469032" as="style"/><link rel="stylesheet" href="styles.css?v=1727600469032"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://discord.com/blog/how-discord-stores-trillions-of-messages">How Discord stores trillions of messages (2023)</a> <span class="domain">(<a href="https://discord.com">discord.com</a>)</span></div><div class="subtext"><span>jakey_bakey</span> | <span>106 comments</span></div><br/><div><div id="41683776" class="c"><input type="checkbox" id="c-41683776" checked=""/><div class="controls bullet"><span class="by">foobazgt</span><span>|</span><a href="#41685790">next</a><span>|</span><label class="collapse" for="c-41683776">[-]</label><label class="expand" for="c-41683776">[4 more]</label></div><br/><div class="children"><div class="content">This blog post seems to blame GC heavily, but if you look back at their earlier blog post [0], it seems to be more shortcomings in either how they&#x27;re using Cassandra or how Cassandra handles heavy deletes, or some combination:<p>&quot;It was at that moment that it became obvious they deleted millions of messages using our API, leaving only 1 message in the channel. If you have been paying attention you might remember how Cassandra handles deletes using tombstones (mentioned in Eventual Consistency). When a user loaded this channel, even though there was only 1 message, Cassandra had to effectively scan millions of message tombstones (generating garbage faster than the JVM could collect it).&quot;<p>And although the blog post talks about GC tuning, there&#x27;s mention here [1] that they didn&#x27;t do much tuning and were actually running on an old version of Cassandra (and presumably JVM) - having just switched over from CMS (!).<p><pre><code>  0) https:&#x2F;&#x2F;discord.com&#x2F;blog&#x2F;how-discord-stores-billions-of-messages
  1) https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33136453</code></pre></div><br/><div id="41684470" class="c"><input type="checkbox" id="c-41684470" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683776">parent</a><span>|</span><a href="#41685790">next</a><span>|</span><label class="collapse" for="c-41684470">[-]</label><label class="expand" for="c-41684470">[3 more]</label></div><br/><div class="children"><div class="content">But then it’s still nice that they’re using ScyllaDB and now it’s not a concern at all right?<p>Even if they were using their original solution wrong, I think the solution that <i>cannot</i> use wrong is superior.</div><br/><div id="41684959" class="c"><input type="checkbox" id="c-41684959" checked=""/><div class="controls bullet"><span class="by">ericvolp12</span><span>|</span><a href="#41683776">root</a><span>|</span><a href="#41684470">parent</a><span>|</span><a href="#41684984">next</a><span>|</span><label class="collapse" for="c-41684959">[-]</label><label class="expand" for="c-41684959">[1 more]</label></div><br/><div class="children"><div class="content">The funny part is ScyllaDB still uses tombstones for deletions, though they do have configurable compaction strategies and iirc Discord uses Scylla&#x27;s Incremental Compaction Strategy that I suppose solves the specific issue they were dealing with. iirc that compaction strategy will trigger a compaction once a certain threshold of a partition is tombstones and then the table is rebuilt without the tombstoned content (which effectively pauses writes on that specific node and that specific table and partition for the duration of that process). Compacting a massive partition is really expensive. Scylla defaults to warning you that a partition is too large if it has at least 100,000 rows in it. My guess is when they moved to ScyllaDB they also adopted a new strategy for partitioning messages in a channel that keeps partition sizes reasonable so compactions don&#x27;t take a super long time.</div><br/></div></div><div id="41684984" class="c"><input type="checkbox" id="c-41684984" checked=""/><div class="controls bullet"><span class="by">roenxi</span><span>|</span><a href="#41683776">root</a><span>|</span><a href="#41684470">parent</a><span>|</span><a href="#41684959">prev</a><span>|</span><a href="#41685790">next</a><span>|</span><label class="collapse" for="c-41684984">[-]</label><label class="expand" for="c-41684984">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t see anything here that looks untoward. They increased their data storage by 3 orders of magnitude and decided to use a different DB system. Fair enough, maybe they&#x27;ve learned more about the nature of their data.<p>But that logic isn&#x27;t sound. When dealing with huge amounts of data there are going to be trade-offs. Picking a system that makes different trade-offs to an existing system is not automatically helpful. Yes you don&#x27;t have the old problems. However, you are about to discover new problems. There is always something of a gamble around which will be more of a problem to your business.</div><br/></div></div></div></div></div></div><div id="41685790" class="c"><input type="checkbox" id="c-41685790" checked=""/><div class="controls bullet"><span class="by">dorlaor</span><span>|</span><a href="#41683776">prev</a><span>|</span><a href="#41685565">next</a><span>|</span><label class="collapse" for="c-41685790">[-]</label><label class="expand" for="c-41685790">[1 more]</label></div><br/><div class="children"><div class="content">Some additional nuggets by ScyllaDB co-founder:
- Discord couldn&#x27;t complete repair with Cassandra. Not the case with Scylla
- Scylla has a lot in common with Cassandra, from a good reason, like the LSM tree, compaction etc. However, Scylla has a unique CPU&amp;IO schedulers which allows us to prioritize the queries over compaction, and defer compaction to the half milisecond where we have enough idle bandwidth. We have plenty of articles about it
- Scylla has a new (1.5 years) tombstone_gc=repair - a much safer mode
- Scylla&#x27;s new architecture of Raft and tablets was recently launched and is the next big thing for our users. Watch the cool youtube video of those tablet load balancing</div><br/></div></div><div id="41685565" class="c"><input type="checkbox" id="c-41685565" checked=""/><div class="controls bullet"><span class="by">aaptel</span><span>|</span><a href="#41685790">prev</a><span>|</span><a href="#41683525">next</a><span>|</span><label class="collapse" for="c-41685565">[-]</label><label class="expand" for="c-41685565">[8 more]</label></div><br/><div class="children"><div class="content">This whole problem wouldn&#x27;t exist if we used distributed chat protocols which have been around for over 40 years (IRC).
With the added benefit of having an open specification and multiple implementations. No walled gardens.<p>And if you think IRC is too old for the modern world take a look at matrix or xmpp.<p>How did we let discord take over is a mystery to me, or rather a tragedy.</div><br/><div id="41685732" class="c"><input type="checkbox" id="c-41685732" checked=""/><div class="controls bullet"><span class="by">rollcat</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685659">next</a><span>|</span><label class="collapse" for="c-41685732">[-]</label><label class="expand" for="c-41685732">[1 more]</label></div><br/><div class="children"><div class="content">IRC does not store messages, it only relays them to clients. You need an add-on solution to store chat history, something we&#x27;ve been taking for granted for ~30 years.<p>IRC all but requires using a bouncer to follow a conversation from more than a single device.<p>IRC does not encrypt messages, only (optionally) the client&lt;-&gt;server connection. Without E2EE, you have no privacy against the server&#x2F;operator, which is an easily targeted SPOF.<p>Matrix (the protocol) is still in flux, <i>and</i> the implementations are lagging behind the spec. If you&#x27;re not using Element, you&#x27;re behind on features <i>and</i> security.<p>XMPP is (similarly to IRC) relying on optional protocol add-ons for basic things, like E2EE, which clients may or may not support fully or correctly.<p>I recommend reading these breakdowns by soatok: <a href="https:&#x2F;&#x2F;soatok.blog&#x2F;2024&#x2F;08&#x2F;04&#x2F;against-xmppomemo&#x2F;" rel="nofollow">https:&#x2F;&#x2F;soatok.blog&#x2F;2024&#x2F;08&#x2F;04&#x2F;against-xmppomemo&#x2F;</a> <a href="https:&#x2F;&#x2F;soatok.blog&#x2F;2024&#x2F;08&#x2F;14&#x2F;security-issues-in-matrixs-olm-library&#x2F;" rel="nofollow">https:&#x2F;&#x2F;soatok.blog&#x2F;2024&#x2F;08&#x2F;14&#x2F;security-issues-in-matrixs-ol...</a><p>2013&#x2F;Snowden happened 11 years ago. E2EE should by now be considered a basic feature, a commodity, something we should be calling for as relentlessly as we did for HTTPS. (Discord of course does not implement E2EE.)</div><br/></div></div><div id="41685659" class="c"><input type="checkbox" id="c-41685659" checked=""/><div class="controls bullet"><span class="by">dewey</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685732">prev</a><span>|</span><a href="#41685716">next</a><span>|</span><label class="collapse" for="c-41685659">[-]</label><label class="expand" for="c-41685659">[1 more]</label></div><br/><div class="children"><div class="content">I’m a huge IRC fan and I dislike Discord, but all these other services are way too clunky and IRC is really only usable through IRCCloud that has a relatively okay mobile app these days.<p>Recently a very technical group I’m part of migrated from Telegram to Matrix and the user experience is just not very good. The apps are buggy, don’t look good, then in the new “Element” app SSO isn’t supported so I can’t use my account with it. There’s lots of paper cuts that are okay for someone like me who likes to figure it out but I’d never try to convince my friends to use it.</div><br/></div></div><div id="41685716" class="c"><input type="checkbox" id="c-41685716" checked=""/><div class="controls bullet"><span class="by">elcomet</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685659">prev</a><span>|</span><a href="#41685643">next</a><span>|</span><label class="collapse" for="c-41685716">[-]</label><label class="expand" for="c-41685716">[2 more]</label></div><br/><div class="children"><div class="content">IRC and distributed protocols un general had a big issue : you loose history every time you disconnect</div><br/><div id="41685874" class="c"><input type="checkbox" id="c-41685874" checked=""/><div class="controls bullet"><span class="by">menaerus</span><span>|</span><a href="#41685565">root</a><span>|</span><a href="#41685716">parent</a><span>|</span><a href="#41685643">next</a><span>|</span><label class="collapse" for="c-41685874">[-]</label><label class="expand" for="c-41685874">[1 more]</label></div><br/><div class="children"><div class="content">In the age we are living this starts to sound more like a feature to me.</div><br/></div></div></div></div><div id="41685643" class="c"><input type="checkbox" id="c-41685643" checked=""/><div class="controls bullet"><span class="by">maccard</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685716">prev</a><span>|</span><a href="#41685709">next</a><span>|</span><label class="collapse" for="c-41685643">[-]</label><label class="expand" for="c-41685643">[1 more]</label></div><br/><div class="children"><div class="content">If you want to know why, look at the App Store reviews for discord and tea speak and compare them.<p>Discord just works.</div><br/></div></div><div id="41685709" class="c"><input type="checkbox" id="c-41685709" checked=""/><div class="controls bullet"><span class="by">lofaszvanitt</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685643">prev</a><span>|</span><a href="#41685598">next</a><span>|</span><label class="collapse" for="c-41685709">[-]</label><label class="expand" for="c-41685709">[1 more]</label></div><br/><div class="children"><div class="content">Discord wrapped irc in shiny paper.</div><br/></div></div><div id="41685598" class="c"><input type="checkbox" id="c-41685598" checked=""/><div class="controls bullet"><span class="by">Krasnol</span><span>|</span><a href="#41685565">parent</a><span>|</span><a href="#41685709">prev</a><span>|</span><a href="#41683525">next</a><span>|</span><label class="collapse" for="c-41685598">[-]</label><label class="expand" for="c-41685598">[1 more]</label></div><br/><div class="children"><div class="content">Usability did it.<p>You download an exe, install it, make an account and it runs. Just like that. Everybody can do it.<p>There are tons of useful and great software out there. Most of it is not easy for the public. Some (most?) of it doesn&#x27;t even have an GUI. People rather sell their identity and even pay than suffer through too many hops.</div><br/></div></div></div></div><div id="41683525" class="c"><input type="checkbox" id="c-41683525" checked=""/><div class="controls bullet"><span class="by">leetrout</span><span>|</span><a href="#41685565">prev</a><span>|</span><a href="#41685887">next</a><span>|</span><label class="collapse" for="c-41683525">[-]</label><label class="expand" for="c-41683525">[4 more]</label></div><br/><div class="children"><div class="content">Needs (2023)<p>That services layer reminds be of a big, fancy, distributed Varnish Cache... they don&#x27;t mention caching and they chose the word coalesce so I assume it doesn&#x27;t do much actual caching. But made me think of Varnish&#x27;s &quot;grace mode&quot; and it&#x27;s use to prevent the thundering herd problem (which is where I first heard of &#x27;request coalescing&#x27;) <a href="https:&#x2F;&#x2F;varnish-cache.org&#x2F;docs&#x2F;6.1&#x2F;users-guide&#x2F;vcl-grace.html#grace-mode" rel="nofollow">https:&#x2F;&#x2F;varnish-cache.org&#x2F;docs&#x2F;6.1&#x2F;users-guide&#x2F;vcl-grace.htm...</a><p>Also love to see consistent hashing come up again and again. It&#x27;s a great piece of duct tape that has proven useful in many similar situations. If you know where something should be then you know where everything is gonna come look for it!</div><br/><div id="41683543" class="c"><input type="checkbox" id="c-41683543" checked=""/><div class="controls bullet"><span class="by">loloquwowndueo</span><span>|</span><a href="#41683525">parent</a><span>|</span><a href="#41685186">next</a><span>|</span><label class="collapse" for="c-41683543">[-]</label><label class="expand" for="c-41683543">[1 more]</label></div><br/><div class="children"><div class="content">Coalescing and “origin shielding” tend to be more common terms for that - I’ve never heard of “grace” until today :)</div><br/></div></div><div id="41685186" class="c"><input type="checkbox" id="c-41685186" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#41683525">parent</a><span>|</span><a href="#41683543">prev</a><span>|</span><a href="#41684865">next</a><span>|</span><label class="collapse" for="c-41685186">[-]</label><label class="expand" for="c-41685186">[1 more]</label></div><br/><div class="children"><div class="content">Nginx always more businesslike.<p><pre><code>    proxy_cache_use_stale updating;</code></pre></div><br/></div></div><div id="41684865" class="c"><input type="checkbox" id="c-41684865" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#41683525">parent</a><span>|</span><a href="#41685186">prev</a><span>|</span><a href="#41685887">next</a><span>|</span><label class="collapse" for="c-41684865">[-]</label><label class="expand" for="c-41684865">[1 more]</label></div><br/><div class="children"><div class="content">Year added above. Thanks!</div><br/></div></div></div></div><div id="41685887" class="c"><input type="checkbox" id="c-41685887" checked=""/><div class="controls bullet"><span class="by">gigatexal</span><span>|</span><a href="#41683525">prev</a><span>|</span><a href="#41684350">next</a><span>|</span><label class="collapse" for="c-41685887">[-]</label><label class="expand" for="c-41685887">[1 more]</label></div><br/><div class="children"><div class="content">What a fun write up and a huge confidence building post for me in ScyllaDB.</div><br/></div></div><div id="41684350" class="c"><input type="checkbox" id="c-41684350" checked=""/><div class="controls bullet"><span class="by">hiyer</span><span>|</span><a href="#41685887">prev</a><span>|</span><a href="#41685775">next</a><span>|</span><label class="collapse" for="c-41684350">[-]</label><label class="expand" for="c-41684350">[1 more]</label></div><br/><div class="children"><div class="content">Very well-written article. I&#x27;m happy for them that part of the solution was switching from Cassandra to drop-in replacement Scylla, rather than having to deal with something entirely different.</div><br/></div></div><div id="41685775" class="c"><input type="checkbox" id="c-41685775" checked=""/><div class="controls bullet"><span class="by">dean2432</span><span>|</span><a href="#41684350">prev</a><span>|</span><a href="#41683581">next</a><span>|</span><label class="collapse" for="c-41685775">[-]</label><label class="expand" for="c-41685775">[1 more]</label></div><br/><div class="children"><div class="content">They make it literally impossible to delete your old messages. It&#x27;s a privacy nightmare and I wonder why the EU hasn&#x27;t stepped in.</div><br/></div></div><div id="41683581" class="c"><input type="checkbox" id="c-41683581" checked=""/><div class="controls bullet"><span class="by">jimkoen</span><span>|</span><a href="#41685775">prev</a><span>|</span><a href="#41683589">next</a><span>|</span><label class="collapse" for="c-41683581">[-]</label><label class="expand" for="c-41683581">[4 more]</label></div><br/><div class="children"><div class="content">My takeaway from this is maybe somewhat different from what the authors intended:<p>&gt; The last one? Our friend, cassandra-messages. [...] To start with, it’s a big cluster. With trillions of messages and nearly 200 nodes, any migration was going to be an involved effort.<p>To me, that&#x27;s a surprisingly small amount of nodes for message storage, given the size of discord. I had honestly expected a much more intricate architecture, engineered towards quick scalability, involving a lot more moving parts. I&#x27;m sure the complexity is higher than stated in the article, but it makes me wonder, given that I&#x27;ve been partially responsible for more than 200 physical nodes that did less, how much of modern cloud architecture is over engineered.</div><br/><div id="41683708" class="c"><input type="checkbox" id="c-41683708" checked=""/><div class="controls bullet"><span class="by">romanhn</span><span>|</span><a href="#41683581">parent</a><span>|</span><a href="#41683658">next</a><span>|</span><label class="collapse" for="c-41683708">[-]</label><label class="expand" for="c-41683708">[1 more]</label></div><br/><div class="children"><div class="content">They are talking about 177 database nodes, which is not an indicator of architecture complexity. I assume they have dozens&#x2F;hundreds of services consisting of multiple highly available nodes each across various geographies.<p>Having seen a much smaller set of Cassandra nodes used to store billions (rather than trillions) of records, I can say that Cassandra was definitely a total PITA for on-call, and a cause of several major outages.</div><br/></div></div><div id="41683658" class="c"><input type="checkbox" id="c-41683658" checked=""/><div class="controls bullet"><span class="by">nicholasjarnold</span><span>|</span><a href="#41683581">parent</a><span>|</span><a href="#41683708">prev</a><span>|</span><a href="#41684355">next</a><span>|</span><label class="collapse" for="c-41683658">[-]</label><label class="expand" for="c-41683658">[1 more]</label></div><br/><div class="children"><div class="content">&gt; ...how much of modern cloud architecture is over engineered.<p>I would wager a good majority of it is. The Stack Overflow architecture[0] sticks out to me in this regard as an example on the other end of the spectrum.<p>[0] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34950843">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34950843</a></div><br/></div></div><div id="41684355" class="c"><input type="checkbox" id="c-41684355" checked=""/><div class="controls bullet"><span class="by">hiyer</span><span>|</span><a href="#41683581">parent</a><span>|</span><a href="#41683658">prev</a><span>|</span><a href="#41683589">next</a><span>|</span><label class="collapse" for="c-41684355">[-]</label><label class="expand" for="c-41684355">[1 more]</label></div><br/><div class="children"><div class="content">Also bear in mind that they&#x27;re now doing the same with just 72 nodes.</div><br/></div></div></div></div><div id="41683589" class="c"><input type="checkbox" id="c-41683589" checked=""/><div class="controls bullet"><span class="by">tcfhgj</span><span>|</span><a href="#41683581">prev</a><span>|</span><a href="#41684863">next</a><span>|</span><label class="collapse" for="c-41683589">[-]</label><label class="expand" for="c-41683589">[14 more]</label></div><br/><div class="children"><div class="content">Storing is one thing.
Performing data mining on them is another</div><br/><div id="41683603" class="c"><input type="checkbox" id="c-41683603" checked=""/><div class="controls bullet"><span class="by">CamperBob2</span><span>|</span><a href="#41683589">parent</a><span>|</span><a href="#41685481">prev</a><span>|</span><a href="#41684863">next</a><span>|</span><label class="collapse" for="c-41683603">[-]</label><label class="expand" for="c-41683603">[12 more]</label></div><br/><div class="children"><div class="content">Also, people need to keep in mind that those trillions of messages are archived nowhere.  Thanks to the walled gardens we&#x27;re obsessed with building, far-future anthropologists will know more about Pompeii and Machu Picchu than San Francisco.</div><br/><div id="41685291" class="c"><input type="checkbox" id="c-41685291" checked=""/><div class="controls bullet"><span class="by">squigz</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683603">parent</a><span>|</span><a href="#41683721">next</a><span>|</span><label class="collapse" for="c-41685291">[-]</label><label class="expand" for="c-41685291">[1 more]</label></div><br/><div class="children"><div class="content">Firstly, no they won&#x27;t. That&#x27;s silly.<p>Secondly, how would such an archive work? Who would pay for it? How would it be safeguarded in such a way that it can be read by &#x27;far future anthropologists&#x27; but not the people paying for the storage?</div><br/></div></div><div id="41683721" class="c"><input type="checkbox" id="c-41683721" checked=""/><div class="controls bullet"><span class="by">xboxnolifes</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683603">parent</a><span>|</span><a href="#41685291">prev</a><span>|</span><a href="#41685145">next</a><span>|</span><label class="collapse" for="c-41683721">[-]</label><label class="expand" for="c-41683721">[9 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think every single individual message ever needs to be archived. Every text, every email, every post-it, every poke, every emoji, every reaction GIF...</div><br/><div id="41685297" class="c"><input type="checkbox" id="c-41685297" checked=""/><div class="controls bullet"><span class="by">ktosobcy</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683721">parent</a><span>|</span><a href="#41683761">next</a><span>|</span><label class="collapse" for="c-41685297">[-]</label><label class="expand" for="c-41685297">[1 more]</label></div><br/><div class="children"><div class="content">Well, considerting annoying push for &quot;let&#x27;s resolve the issue on discord&quot; it&#x27;s very annoying. With things like github issues you can search for a problem and find a solution. Even ancient mailing lists most of the time have archives. Not so much with all those fancy &quot;realtime&quot; :&#x2F;</div><br/></div></div><div id="41683761" class="c"><input type="checkbox" id="c-41683761" checked=""/><div class="controls bullet"><span class="by">famahar</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683721">parent</a><span>|</span><a href="#41685297">prev</a><span>|</span><a href="#41685145">next</a><span>|</span><label class="collapse" for="c-41683761">[-]</label><label class="expand" for="c-41683761">[7 more]</label></div><br/><div class="children"><div class="content">Definitely not everything, but it&#x27;s still wild to me that so many products and services have all their troubleshooting and customer support in a discord server.</div><br/><div id="41685319" class="c"><input type="checkbox" id="c-41685319" checked=""/><div class="controls bullet"><span class="by">proteal</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683761">parent</a><span>|</span><a href="#41683803">next</a><span>|</span><label class="collapse" for="c-41685319">[-]</label><label class="expand" for="c-41685319">[1 more]</label></div><br/><div class="children"><div class="content">It makes sense to me. The number of people who actually create useful open source software is so vanishingly small compared to the number of people who use OSS, it seems obvious that we should optimize for their time, not the other way around. I agree with you that using mailing lists or GitHub issues or whatnot would be globally more efficient, but if I’m working on a product, I’m going to work in the way that is most efficient for my time. I owe my “customers” nothing because they are not paying for my work. We keep seeing discord as a means to communicate about products because devs see it as the best use of their time. The fact that so many people use it should be an indictment on the alternatives, not the devs who choose to use discord.</div><br/></div></div><div id="41683803" class="c"><input type="checkbox" id="c-41683803" checked=""/><div class="controls bullet"><span class="by">foobazgt</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683761">parent</a><span>|</span><a href="#41685319">prev</a><span>|</span><a href="#41684979">next</a><span>|</span><label class="collapse" for="c-41683803">[-]</label><label class="expand" for="c-41683803">[2 more]</label></div><br/><div class="children"><div class="content">Sadly, I can understand why Discord doesn&#x27;t have a lot of incentive to do this. Maybe the community should popularize an open-source free&#x2F;low-costing bot and hosting solution for exported chat? (I couldn&#x27;t find one in a few minutes of searching).</div><br/><div id="41685264" class="c"><input type="checkbox" id="c-41685264" checked=""/><div class="controls bullet"><span class="by">tbrockman</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683803">parent</a><span>|</span><a href="#41684979">next</a><span>|</span><label class="collapse" for="c-41685264">[-]</label><label class="expand" for="c-41685264">[1 more]</label></div><br/><div class="children"><div class="content">Here ya go: <a href="https:&#x2F;&#x2F;github.com&#x2F;AnswerOverflow&#x2F;AnswerOverflow">https:&#x2F;&#x2F;github.com&#x2F;AnswerOverflow&#x2F;AnswerOverflow</a></div><br/></div></div></div></div><div id="41684979" class="c"><input type="checkbox" id="c-41684979" checked=""/><div class="controls bullet"><span class="by">ekianjo</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683761">parent</a><span>|</span><a href="#41683803">prev</a><span>|</span><a href="#41685145">next</a><span>|</span><label class="collapse" for="c-41684979">[-]</label><label class="expand" for="c-41684979">[3 more]</label></div><br/><div class="children"><div class="content">Even FOSS communities. shame on the devs who decide to do so.</div><br/><div id="41685418" class="c"><input type="checkbox" id="c-41685418" checked=""/><div class="controls bullet"><span class="by">Kiro</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41684979">parent</a><span>|</span><a href="#41685279">next</a><span>|</span><label class="collapse" for="c-41685418">[-]</label><label class="expand" for="c-41685418">[1 more]</label></div><br/><div class="children"><div class="content">It used to be IRC channels on Freenode and I didn&#x27;t see anyone complaining back then.</div><br/></div></div><div id="41685279" class="c"><input type="checkbox" id="c-41685279" checked=""/><div class="controls bullet"><span class="by">squigz</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41684979">parent</a><span>|</span><a href="#41685418">prev</a><span>|</span><a href="#41685145">next</a><span>|</span><label class="collapse" for="c-41685279">[-]</label><label class="expand" for="c-41685279">[1 more]</label></div><br/><div class="children"><div class="content">Why do you and GP think so many FOSS projects choose to use Discord like this?</div><br/></div></div></div></div></div></div></div></div><div id="41685145" class="c"><input type="checkbox" id="c-41685145" checked=""/><div class="controls bullet"><span class="by">daedrdev</span><span>|</span><a href="#41683589">root</a><span>|</span><a href="#41683603">parent</a><span>|</span><a href="#41683721">prev</a><span>|</span><a href="#41684863">next</a><span>|</span><label class="collapse" for="c-41685145">[-]</label><label class="expand" for="c-41685145">[1 more]</label></div><br/><div class="children"><div class="content">For many people the fact that discord is not easily discoverable is a benefit, just like in many other messaging services</div><br/></div></div></div></div></div></div><div id="41684863" class="c"><input type="checkbox" id="c-41684863" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#41683589">prev</a><span>|</span><a href="#41683565">next</a><span>|</span><label class="collapse" for="c-41684863">[-]</label><label class="expand" for="c-41684863">[1 more]</label></div><br/><div class="children"><div class="content">Discussed (a bit) at the time:<p><i>How Discord Stores Trillions of Messages</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35048410">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35048410</a> - March 2023 (10 comments)</div><br/></div></div><div id="41683565" class="c"><input type="checkbox" id="c-41683565" checked=""/><div class="controls bullet"><span class="by">codexon</span><span>|</span><a href="#41684863">prev</a><span>|</span><a href="#41683557">next</a><span>|</span><label class="collapse" for="c-41683565">[-]</label><label class="expand" for="c-41683565">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The ScyllaDB team prioritized improvements and implemented performant reverse queries, removing the last database blocker in our migration plan.<p>I wonder how much they paid ScyllaDB to do this before even using ScyllaDB.</div><br/><div id="41683596" class="c"><input type="checkbox" id="c-41683596" checked=""/><div class="controls bullet"><span class="by">jsnell</span><span>|</span><a href="#41683565">parent</a><span>|</span><a href="#41683557">next</a><span>|</span><label class="collapse" for="c-41683596">[-]</label><label class="expand" for="c-41683596">[1 more]</label></div><br/><div class="children"><div class="content">The article says they were using ScyllaDB for everything except the message store two years before they did the migration for messages.</div><br/></div></div></div></div><div id="41683557" class="c"><input type="checkbox" id="c-41683557" checked=""/><div class="controls bullet"><span class="by">tonetegeatinst</span><span>|</span><a href="#41683565">prev</a><span>|</span><a href="#41684372">next</a><span>|</span><label class="collapse" for="c-41683557">[-]</label><label class="expand" for="c-41683557">[1 more]</label></div><br/><div class="children"><div class="content">My love of embedded stuff is growing. I&#x27;m self teaching C and assembly....to get better at low level programming and interactions with hardware but it all seems much simpler than the big data systems. Granted I&#x27;m sure it call be broken down into steps and issues to solve like any programming issue but I&#x27;m happy focusing on low level stuff for now.</div><br/></div></div><div id="41684372" class="c"><input type="checkbox" id="c-41684372" checked=""/><div class="controls bullet"><span class="by">SupremumLimit</span><span>|</span><a href="#41683557">prev</a><span>|</span><a href="#41683517">next</a><span>|</span><label class="collapse" for="c-41684372">[-]</label><label class="expand" for="c-41684372">[3 more]</label></div><br/><div class="children"><div class="content">I see more people mixing up past and present tense randomly, as in this post. It’s confusing to read. Is the concept of tense starting to disappear entirely in US English, I wonder?</div><br/><div id="41685778" class="c"><input type="checkbox" id="c-41685778" checked=""/><div class="controls bullet"><span class="by">phist_mcgee</span><span>|</span><a href="#41684372">parent</a><span>|</span><a href="#41685486">next</a><span>|</span><label class="collapse" for="c-41685778">[-]</label><label class="expand" for="c-41685778">[1 more]</label></div><br/><div class="children"><div class="content">Your question is rude and I hope you know that.<p>He&#x27;s walking us through the process of designing the solution. Why wouldn&#x27;t present tense work for this? We&#x27;re discovering things with him as he takes us along for the journey.</div><br/></div></div><div id="41685486" class="c"><input type="checkbox" id="c-41685486" checked=""/><div class="controls bullet"><span class="by">nerdponx</span><span>|</span><a href="#41684372">parent</a><span>|</span><a href="#41685778">prev</a><span>|</span><a href="#41683517">next</a><span>|</span><label class="collapse" for="c-41685486">[-]</label><label class="expand" for="c-41685486">[1 more]</label></div><br/><div class="children"><div class="content">No, what a ridiculous thing to say. Storytelling in the present tense is not new.</div><br/></div></div></div></div><div id="41683517" class="c"><input type="checkbox" id="c-41683517" checked=""/><div class="controls bullet"><span class="by">pavel_lishin</span><span>|</span><a href="#41684372">prev</a><span>|</span><a href="#41684436">next</a><span>|</span><label class="collapse" for="c-41683517">[-]</label><label class="expand" for="c-41683517">[22 more]</label></div><br/><div class="children"><div class="content">Anyone else reading this and being quite happy that they&#x27;re not working at this scale?</div><br/><div id="41683889" class="c"><input type="checkbox" id="c-41683889" checked=""/><div class="controls bullet"><span class="by">Twirrim</span><span>|</span><a href="#41683517">parent</a><span>|</span><a href="#41683998">next</a><span>|</span><label class="collapse" for="c-41683889">[-]</label><label class="expand" for="c-41683889">[1 more]</label></div><br/><div class="children"><div class="content">But that&#x27;s where the really fun and complicated problems are.  The ones that really make you stop and think, and not just think, but be creative.<p>95% of the work is still the same &quot;treading in well trod paths&quot;, same old same old tech work, but that 5% is really something.</div><br/></div></div><div id="41683998" class="c"><input type="checkbox" id="c-41683998" checked=""/><div class="controls bullet"><span class="by">wavemode</span><span>|</span><a href="#41683517">parent</a><span>|</span><a href="#41683889">prev</a><span>|</span><a href="#41684406">next</a><span>|</span><label class="collapse" for="c-41683998">[-]</label><label class="expand" for="c-41683998">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t mind scale. I mind the bureaucracy and promotion-driven-development that comes with working in a bloated engineering org.</div><br/><div id="41684022" class="c"><input type="checkbox" id="c-41684022" checked=""/><div class="controls bullet"><span class="by">pm90</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683998">parent</a><span>|</span><a href="#41684406">next</a><span>|</span><label class="collapse" for="c-41684022">[-]</label><label class="expand" for="c-41684022">[1 more]</label></div><br/><div class="children"><div class="content">+100<p>Many companies have products that operate at “scale”. They manage to do so with pretty boring techniques (sharding, autoscaling) and technologies (postgres, cloud storage).<p>Because of the insane blog driven tech culture, many of these teams get questioned by clueless leadership (who read these blogs) and ask why the company isn’t using cassandra &#x2F; some other hot technology. And it always causes much consternation and wastage.</div><br/></div></div></div></div><div id="41684406" class="c"><input type="checkbox" id="c-41684406" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#41683517">parent</a><span>|</span><a href="#41683998">prev</a><span>|</span><a href="#41684443">next</a><span>|</span><label class="collapse" for="c-41684406">[-]</label><label class="expand" for="c-41684406">[1 more]</label></div><br/><div class="children"><div class="content">I am happy that I dont have to deal with this.<p>I am sad that my business aren&#x27;t as big as this scale.</div><br/></div></div><div id="41684476" class="c"><input type="checkbox" id="c-41684476" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683517">parent</a><span>|</span><a href="#41684443">prev</a><span>|</span><a href="#41683539">next</a><span>|</span><label class="collapse" for="c-41684476">[-]</label><label class="expand" for="c-41684476">[1 more]</label></div><br/><div class="children"><div class="content">Honestly, 77 nodes doesn’t sound like a terrific scale? The more I scale things up, the more I realize that the tone of the problems doesn’t really change. You just get more layers to your data structures.</div><br/></div></div><div id="41683539" class="c"><input type="checkbox" id="c-41683539" checked=""/><div class="controls bullet"><span class="by">mystified5016</span><span>|</span><a href="#41683517">parent</a><span>|</span><a href="#41684476">prev</a><span>|</span><a href="#41684436">next</a><span>|</span><label class="collapse" for="c-41683539">[-]</label><label class="expand" for="c-41683539">[15 more]</label></div><br/><div class="children"><div class="content">Any time I read anything about any web-adjacent technology I&#x27;m incredibly thankful that I don&#x27;t work anywhere near that industry.<p>Embedded can be complex, but web stuff is just a Lovecraftian nightmare in comparison</div><br/><div id="41683808" class="c"><input type="checkbox" id="c-41683808" checked=""/><div class="controls bullet"><span class="by">milesvp</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683539">parent</a><span>|</span><a href="#41684436">next</a><span>|</span><label class="collapse" for="c-41683808">[-]</label><label class="expand" for="c-41683808">[14 more]</label></div><br/><div class="children"><div class="content">I have stared into the abyss and seen the eyes of cthulu. I am much happier writing embedded drivers than I was trying to make sense of why previous devs thought it was a good idea to move bounded tunable server side api calls to the client, allowing it to effectively write arbitrary sql calls across multiple databases.</div><br/><div id="41684220" class="c"><input type="checkbox" id="c-41684220" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683808">parent</a><span>|</span><a href="#41683841">next</a><span>|</span><label class="collapse" for="c-41684220">[-]</label><label class="expand" for="c-41684220">[10 more]</label></div><br/><div class="children"><div class="content">Fortunately the web is starting (very slowly) to return to sanity, pushing back towards the simpler server-rendered pattern with Javascript being relegated to specific use cases.</div><br/><div id="41684520" class="c"><input type="checkbox" id="c-41684520" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684220">parent</a><span>|</span><a href="#41683841">next</a><span>|</span><label class="collapse" for="c-41684520">[-]</label><label class="expand" for="c-41684520">[9 more]</label></div><br/><div class="children"><div class="content">I really like the client rendered UI part. It’s a lot more efficient than sending the whole page again every time.</div><br/><div id="41684720" class="c"><input type="checkbox" id="c-41684720" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684520">parent</a><span>|</span><a href="#41684554">next</a><span>|</span><label class="collapse" for="c-41684720">[-]</label><label class="expand" for="c-41684720">[2 more]</label></div><br/><div class="children"><div class="content">Which is precisely what is meant by specific use cases. We don&#x27;t have to throw out the first 25 years of the web and reimplement all of our business logic in a minified JS blob. Even when client side code is necessary, the trend of pushing rendered HTML rather than JSON that must be parsed and rendered keeps us as close to browser primitives as possible.</div><br/><div id="41684890" class="c"><input type="checkbox" id="c-41684890" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684720">parent</a><span>|</span><a href="#41684554">next</a><span>|</span><label class="collapse" for="c-41684890">[-]</label><label class="expand" for="c-41684890">[1 more]</label></div><br/><div class="children"><div class="content">Why would you implement the business logic there? You can still keep (most of) that in the backend.<p>The client just does orchestration.</div><br/></div></div></div></div><div id="41684554" class="c"><input type="checkbox" id="c-41684554" checked=""/><div class="controls bullet"><span class="by">gonzo41</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684520">parent</a><span>|</span><a href="#41684720">prev</a><span>|</span><a href="#41683841">next</a><span>|</span><label class="collapse" for="c-41684554">[-]</label><label class="expand" for="c-41684554">[6 more]</label></div><br/><div class="children"><div class="content">But you can cache the whole server side page and the cost is once. Whereas if you have the client side do the render then every client wears the cost.</div><br/><div id="41684897" class="c"><input type="checkbox" id="c-41684897" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684554">parent</a><span>|</span><a href="#41684740">next</a><span>|</span><label class="collapse" for="c-41684897">[-]</label><label class="expand" for="c-41684897">[1 more]</label></div><br/><div class="children"><div class="content">That’s your generation that happens once. The browser still needs to render it. Sure, rendering it on the client may cost the client a bit more, but the client generally has the computational power to spare.</div><br/></div></div><div id="41684740" class="c"><input type="checkbox" id="c-41684740" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684554">parent</a><span>|</span><a href="#41684897">prev</a><span>|</span><a href="#41684596">next</a><span>|</span><label class="collapse" for="c-41684740">[-]</label><label class="expand" for="c-41684740">[1 more]</label></div><br/><div class="children"><div class="content">Which becomes a far more important issue when dealing with bandwidth or CPU constrained devices, or artificially imposed constraints due to data usage costs.</div><br/></div></div><div id="41684596" class="c"><input type="checkbox" id="c-41684596" checked=""/><div class="controls bullet"><span class="by">iknowstuff</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684554">parent</a><span>|</span><a href="#41684740">prev</a><span>|</span><a href="#41684705">next</a><span>|</span><label class="collapse" for="c-41684596">[-]</label><label class="expand" for="c-41684596">[2 more]</label></div><br/><div class="children"><div class="content">You usually can&#x27;t because of users who are signed in needing slightly different pages etc.</div><br/><div id="41684686" class="c"><input type="checkbox" id="c-41684686" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684596">parent</a><span>|</span><a href="#41684705">next</a><span>|</span><label class="collapse" for="c-41684686">[-]</label><label class="expand" for="c-41684686">[1 more]</label></div><br/><div class="children"><div class="content">While not as fast as a purely client cached page, the server can selectively cache content, even when some bits of the page are dynamic.</div><br/></div></div></div></div><div id="41684705" class="c"><input type="checkbox" id="c-41684705" checked=""/><div class="controls bullet"><span class="by">asynchronous</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41684554">parent</a><span>|</span><a href="#41684596">prev</a><span>|</span><a href="#41683841">next</a><span>|</span><label class="collapse" for="c-41684705">[-]</label><label class="expand" for="c-41684705">[1 more]</label></div><br/><div class="children"><div class="content">We can also cache some of the dynamic JavaScript, depending on the scenario but your point stands.</div><br/></div></div></div></div></div></div></div></div><div id="41683841" class="c"><input type="checkbox" id="c-41683841" checked=""/><div class="controls bullet"><span class="by">qudat</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683808">parent</a><span>|</span><a href="#41684220">prev</a><span>|</span><a href="#41684064">next</a><span>|</span><label class="collapse" for="c-41683841">[-]</label><label class="expand" for="c-41683841">[2 more]</label></div><br/><div class="children"><div class="content">Iteration speed is significantly fast on the client. Perf is an afterthought — for better or worse</div><br/><div id="41684226" class="c"><input type="checkbox" id="c-41684226" checked=""/><div class="controls bullet"><span class="by">swyx</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683841">parent</a><span>|</span><a href="#41684064">next</a><span>|</span><label class="collapse" for="c-41684226">[-]</label><label class="expand" for="c-41684226">[1 more]</label></div><br/><div class="children"><div class="content">spoken like someone who doesnt deploy clients at discord scale?<p>the 200 backend nodes surely update significantly faster than the hundreds of millions of clients.</div><br/></div></div></div></div><div id="41684064" class="c"><input type="checkbox" id="c-41684064" checked=""/><div class="controls bullet"><span class="by">artursapek</span><span>|</span><a href="#41683517">root</a><span>|</span><a href="#41683808">parent</a><span>|</span><a href="#41683841">prev</a><span>|</span><a href="#41684436">next</a><span>|</span><label class="collapse" for="c-41684064">[-]</label><label class="expand" for="c-41684064">[1 more]</label></div><br/><div class="children"><div class="content">Sounds like a fun time lol</div><br/></div></div></div></div></div></div></div></div><div id="41684436" class="c"><input type="checkbox" id="c-41684436" checked=""/><div class="controls bullet"><span class="by">m-hodges</span><span>|</span><a href="#41683517">prev</a><span>|</span><a href="#41683920">next</a><span>|</span><label class="collapse" for="c-41684436">[-]</label><label class="expand" for="c-41684436">[1 more]</label></div><br/><div class="children"><div class="content">Fun article. Also fun to think about how many people have decided to document their crimes in these Cassandra nodes.</div><br/></div></div><div id="41683920" class="c"><input type="checkbox" id="c-41683920" checked=""/><div class="controls bullet"><span class="by">cynicalpeace</span><span>|</span><a href="#41684436">prev</a><span>|</span><a href="#41685399">next</a><span>|</span><label class="collapse" for="c-41683920">[-]</label><label class="expand" for="c-41683920">[12 more]</label></div><br/><div class="children"><div class="content">Is there a fundamental reason you wouldn&#x27;t use postgres for something like this? Scale certainly wouldn&#x27;t be it.</div><br/><div id="41684982" class="c"><input type="checkbox" id="c-41684982" checked=""/><div class="controls bullet"><span class="by">ericvolp12</span><span>|</span><a href="#41683920">parent</a><span>|</span><a href="#41684162">next</a><span>|</span><label class="collapse" for="c-41684982">[-]</label><label class="expand" for="c-41684982">[5 more]</label></div><br/><div class="children"><div class="content">ScyllaDB scales horizontally on a shard-per-core architecture with a ballpark throughput of 12,500 Reads and 12,500 Writes per second per shard. If you&#x27;re running Scylla across a total of 64 cores (maybe on 4 VMs with 16 vCPUs each), you can get up to 800k Reads 800k Writes per sec of throughput with P99 writes of &lt;500us and p99 reads of &lt;2ms.<p>You will not be able to get that performance out of Postgres and the write scaling will also be impossible on a non-sharded DB.<p>If you&#x27;re a company like Discord and are running dozens (70-something?) of ScyllaDB nodes, likely each with 32 or 64 vCPUs, you&#x27;ve got capacity for 50M+ reads&#x2F;writes per second across the cluster assuming your read&#x2F;write workloads are evenly balanced across shards.</div><br/><div id="41685364" class="c"><input type="checkbox" id="c-41685364" checked=""/><div class="controls bullet"><span class="by">jhgg</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41684982">parent</a><span>|</span><a href="#41685311">next</a><span>|</span><label class="collapse" for="c-41685364">[-]</label><label class="expand" for="c-41685364">[1 more]</label></div><br/><div class="children"><div class="content">Fwiw the benchmarked numbers are for writing very small rows. When doing the messages migration, with no read traffic, and the cluster&#x2F;compaction settings tuned for writes we only managed approx 3m inserts&#x2F;sec while fully saturating the Scylla cluster.</div><br/></div></div><div id="41685311" class="c"><input type="checkbox" id="c-41685311" checked=""/><div class="controls bullet"><span class="by">ryanjshaw</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41684982">parent</a><span>|</span><a href="#41685364">prev</a><span>|</span><a href="#41684162">next</a><span>|</span><label class="collapse" for="c-41685311">[-]</label><label class="expand" for="c-41685311">[3 more]</label></div><br/><div class="children"><div class="content">Okay but this is where I get confused. Why does Discord need a single database system when discord servers are independent, right?<p>And the volume of traffic per Discord server must be human-processable or what would the point be? A Discord server doing 800k writes per second makes no sense.<p>So why not a RDBMS per Discord server, and if you want to ship all that out to a warehouse for analytics you do that as a separate problem?<p>Or is it that spinning up a Postgres instance per Discord server ends up being significantly more expensive than these mega distributed database systems?</div><br/><div id="41685376" class="c"><input type="checkbox" id="c-41685376" checked=""/><div class="controls bullet"><span class="by">jhgg</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41685311">parent</a><span>|</span><a href="#41684162">next</a><span>|</span><label class="collapse" for="c-41685376">[-]</label><label class="expand" for="c-41685376">[2 more]</label></div><br/><div class="children"><div class="content">There are ballpark of a few hundred million discord servers... do you really want to run that many Postgres instances? And even so what do you do about DM&#x2F;GDMs?  Easier to just run one big mega cluster for messages.</div><br/><div id="41685426" class="c"><input type="checkbox" id="c-41685426" checked=""/><div class="controls bullet"><span class="by">ryanjshaw</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41685376">parent</a><span>|</span><a href="#41684162">next</a><span>|</span><label class="collapse" for="c-41685426">[-]</label><label class="expand" for="c-41685426">[1 more]</label></div><br/><div class="children"><div class="content">Okay so the latter then - economies of scale. Surprised to hear that few hundred million figure - I thought it&#x27;d be 1&#x2F;10th of that at most! Wow.<p>Although I did expect there&#x27;d be a very long tail, and you might choose to host a bunch of servers on a single RDBMS, at that scale yeah it wouldn&#x27;t solve much.<p>Thanks for coming back to me, appreciate it.</div><br/></div></div></div></div></div></div></div></div><div id="41684162" class="c"><input type="checkbox" id="c-41684162" checked=""/><div class="controls bullet"><span class="by">justnoise</span><span>|</span><a href="#41683920">parent</a><span>|</span><a href="#41684982">prev</a><span>|</span><a href="#41683941">next</a><span>|</span><label class="collapse" for="c-41684162">[-]</label><label class="expand" for="c-41684162">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;d guess that Discord&#x27;s storage systems lean towards processing a lot more writes than reads.  Postgres and other databases that use B-tree indexing are ideally suited for read heavy workloads. LSM based databases like Cassandra&#x2F;Scylla are designed for write intensive workloads and have very good horizontal scaling properties built into the system.</div><br/><div id="41684748" class="c"><input type="checkbox" id="c-41684748" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41684162">parent</a><span>|</span><a href="#41685410">next</a><span>|</span><label class="collapse" for="c-41684748">[-]</label><label class="expand" for="c-41684748">[2 more]</label></div><br/><div class="children"><div class="content">Would you actually have more writes than reads? Are messages read by fewer people than post them?</div><br/><div id="41684820" class="c"><input type="checkbox" id="c-41684820" checked=""/><div class="controls bullet"><span class="by">sadeshmukh</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41684748">parent</a><span>|</span><a href="#41685410">next</a><span>|</span><label class="collapse" for="c-41684820">[-]</label><label class="expand" for="c-41684820">[1 more]</label></div><br/><div class="children"><div class="content">When you send a message, afaik it sends to all people looking at it at the time. So there is no read when in a conversation, and maybe the reads are batched when reading multiple.</div><br/></div></div></div></div><div id="41685410" class="c"><input type="checkbox" id="c-41685410" checked=""/><div class="controls bullet"><span class="by">jhgg</span><span>|</span><a href="#41683920">root</a><span>|</span><a href="#41684162">parent</a><span>|</span><a href="#41684748">prev</a><span>|</span><a href="#41683941">next</a><span>|</span><label class="collapse" for="c-41685410">[-]</label><label class="expand" for="c-41685410">[1 more]</label></div><br/><div class="children"><div class="content">Read traffic is much higher than write traffic due to mobile clients needing to sync chat history more often as their sessions are much shorter lived. Also search queries execute 1 query per result. And don&#x27;t forget people doing GDPR data dump requests. It adds up.</div><br/></div></div></div></div><div id="41683941" class="c"><input type="checkbox" id="c-41683941" checked=""/><div class="controls bullet"><span class="by">cowthulhu</span><span>|</span><a href="#41683920">parent</a><span>|</span><a href="#41684162">prev</a><span>|</span><a href="#41684074">next</a><span>|</span><label class="collapse" for="c-41683941">[-]</label><label class="expand" for="c-41683941">[1 more]</label></div><br/><div class="children"><div class="content">I’m not sure if Postgres would have enough horizontal scaling to accommodate the insane volume of reads and writes.
I would be super interested to be proven wrong though… anyone know of a cluster being run at that scale?</div><br/></div></div><div id="41684074" class="c"><input type="checkbox" id="c-41684074" checked=""/><div class="controls bullet"><span class="by">riku_iki</span><span>|</span><a href="#41683920">parent</a><span>|</span><a href="#41683941">prev</a><span>|</span><a href="#41685399">next</a><span>|</span><label class="collapse" for="c-41684074">[-]</label><label class="expand" for="c-41684074">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Scale certainly wouldn&#x27;t be it.<p>vanilla postgres can&#x27;t scale to such size, you need some sharding solution on top, which likely will be much harder to maintain than ScyllaDB..</div><br/></div></div></div></div><div id="41685399" class="c"><input type="checkbox" id="c-41685399" checked=""/><div class="controls bullet"><span class="by">akimbostrawman</span><span>|</span><a href="#41683920">prev</a><span>|</span><a href="#41684128">next</a><span>|</span><label class="collapse" for="c-41685399">[-]</label><label class="expand" for="c-41685399">[1 more]</label></div><br/><div class="children"><div class="content">in cleartext</div><br/></div></div><div id="41684128" class="c"><input type="checkbox" id="c-41684128" checked=""/><div class="controls bullet"><span class="by">KaoruAoiShiho</span><span>|</span><a href="#41685399">prev</a><span>|</span><a href="#41685521">next</a><span>|</span><label class="collapse" for="c-41684128">[-]</label><label class="expand" for="c-41684128">[4 more]</label></div><br/><div class="children"><div class="content">Did they go with ScyllaDB just because it was compatible with Cassandra? Would it make sense to use a totally different solution altogether if they didn&#x27;t start with that.</div><br/><div id="41684198" class="c"><input type="checkbox" id="c-41684198" checked=""/><div class="controls bullet"><span class="by">jhgg</span><span>|</span><a href="#41684128">parent</a><span>|</span><a href="#41685521">next</a><span>|</span><label class="collapse" for="c-41684198">[-]</label><label class="expand" for="c-41684198">[3 more]</label></div><br/><div class="children"><div class="content">Yes, we wanted to migrate all our data stores away from Cassandra due to stability and performance issues. Moving to something that didn&#x27;t have those issues (or at least had a different set of less severe issues) while also not having to rewrite a bunch of code was a positive.</div><br/><div id="41685003" class="c"><input type="checkbox" id="c-41685003" checked=""/><div class="controls bullet"><span class="by">ericvolp12</span><span>|</span><a href="#41684128">root</a><span>|</span><a href="#41684198">parent</a><span>|</span><a href="#41685521">next</a><span>|</span><label class="collapse" for="c-41685003">[-]</label><label class="expand" for="c-41685003">[2 more]</label></div><br/><div class="children"><div class="content">Did you guys end up redesigning the partitioning scheme to fit within Scylla&#x27;s recommended partition sizes? I assume the tombstone issue didn&#x27;t disappear with a move to Scylla but incremental compaction and&#x2F;or SCTS might have helped a bunch?</div><br/><div id="41685397" class="c"><input type="checkbox" id="c-41685397" checked=""/><div class="controls bullet"><span class="by">jhgg</span><span>|</span><a href="#41684128">root</a><span>|</span><a href="#41685003">parent</a><span>|</span><a href="#41685521">next</a><span>|</span><label class="collapse" for="c-41685397">[-]</label><label class="expand" for="c-41685397">[1 more]</label></div><br/><div class="children"><div class="content">Nope. Didn&#x27;t change the schema, mainly added read coalescing and used ICS. I think the big thing is when Scylla is processing a bunch of tombstones it&#x27;s able to do so in a way that doesn&#x27;t choke the whole server. Latest Scylla version also can send back partial&#x2F;empty pages to the client to limit the amount of work per query that is run.</div><br/></div></div></div></div></div></div></div></div><div id="41685521" class="c"><input type="checkbox" id="c-41685521" checked=""/><div class="controls bullet"><span class="by">7bit</span><span>|</span><a href="#41684128">prev</a><span>|</span><a href="#41685389">next</a><span>|</span><label class="collapse" for="c-41685521">[-]</label><label class="expand" for="c-41685521">[2 more]</label></div><br/><div class="children"><div class="content">The blog posts shows how great the technical expertise is at Discord. I work in IT and in my company devs are so incompetent, they don&#x27;t even know how to create an M365&#x2F;Azure dev tenant and constantly request *.Read write.All to our production tenant. I&#x27;m so envious!<p>On the other hand, the HOME&#x2F;END keys jump to the beginning of the input field rather than the line and the frontend devs are unable to fix this non-default behaviour for years, which makes it a fucking pain in the ass to use the Posts feature within a Discord channel. I believe the budget for the backend geniuses meant that frontend had to be juniors only.</div><br/><div id="41685526" class="c"><input type="checkbox" id="c-41685526" checked=""/><div class="controls bullet"><span class="by">fastball</span><span>|</span><a href="#41685521">parent</a><span>|</span><a href="#41685389">next</a><span>|</span><label class="collapse" for="c-41685526">[-]</label><label class="expand" for="c-41685526">[1 more]</label></div><br/><div class="children"><div class="content">In their defense, Azure is terrible.</div><br/></div></div></div></div><div id="41685389" class="c"><input type="checkbox" id="c-41685389" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#41685521">prev</a><span>|</span><a href="#41683787">next</a><span>|</span><label class="collapse" for="c-41685389">[-]</label><label class="expand" for="c-41685389">[1 more]</label></div><br/><div class="children"><div class="content">When you get to scale like this, I wonder if the access patterns of the application and its data might be best served by a custom data retrieval and storage application.<p>I may be wrong but I just wonder if efficiency is lost to the generalized nature of any data storage system.<p>The other question that comes to mind is, to what extent have the developers made a systematic effort to optimize how data is stored and retrieved? If you’re building a gigantic back end system and simply accepting that the system load is what it is then you might be missing a chance to dramatically impact the size of the task of managing that data.</div><br/></div></div><div id="41683787" class="c"><input type="checkbox" id="c-41683787" checked=""/><div class="controls bullet"><span class="by">jaimehrubiks</span><span>|</span><a href="#41685389">prev</a><span>|</span><a href="#41684024">next</a><span>|</span><label class="collapse" for="c-41683787">[-]</label><label class="expand" for="c-41683787">[1 more]</label></div><br/><div class="children"><div class="content">Until they don&#x27;t, or they can&#x27;t, and they need to start deleting.<p>(Not trying to undermine the engineering efforts, or the welcoming engineering blog posts though! I really think all these is needed)</div><br/></div></div><div id="41684024" class="c"><input type="checkbox" id="c-41684024" checked=""/><div class="controls bullet"><span class="by">pawelduda</span><span>|</span><a href="#41683787">prev</a><span>|</span><a href="#41683930">next</a><span>|</span><label class="collapse" for="c-41684024">[-]</label><label class="expand" for="c-41684024">[1 more]</label></div><br/><div class="children"><div class="content">Pretty fun read, even tho I&#x27;ll never work at such scale lol</div><br/></div></div><div id="41683651" class="c"><input type="checkbox" id="c-41683651" checked=""/><div class="controls bullet"><span class="by">zombiwoof</span><span>|</span><a href="#41683930">prev</a><span>|</span><a href="#41684891">next</a><span>|</span><label class="collapse" for="c-41683651">[-]</label><label class="expand" for="c-41683651">[1 more]</label></div><br/><div class="children"><div class="content">I think it’s annoying they interview engineers like they are Google and reading the blog they made it up and learned some basic “pitfalls” as they went along</div><br/></div></div><div id="41684891" class="c"><input type="checkbox" id="c-41684891" checked=""/><div class="controls bullet"><span class="by">xyst</span><span>|</span><a href="#41683651">prev</a><span>|</span><a href="#41685124">next</a><span>|</span><label class="collapse" for="c-41684891">[-]</label><label class="expand" for="c-41684891">[8 more]</label></div><br/><div class="children"><div class="content">Having used discord in the past. Most of the conversations were just shit posts. Nothing serious. Why even bother storing a trillion messages of garbage in the first place?</div><br/><div id="41684966" class="c"><input type="checkbox" id="c-41684966" checked=""/><div class="controls bullet"><span class="by">huimang</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41684915">next</a><span>|</span><label class="collapse" for="c-41684966">[-]</label><label class="expand" for="c-41684966">[1 more]</label></div><br/><div class="children"><div class="content">Many people within niches have discord servers for researching and discussing specific things. There is a large wealth of information locked away behind them that can be lost pretty much whenever discord decides to start pursuing different monetization strategies.</div><br/></div></div><div id="41684915" class="c"><input type="checkbox" id="c-41684915" checked=""/><div class="controls bullet"><span class="by">adzm</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41684966">prev</a><span>|</span><a href="#41685549">next</a><span>|</span><label class="collapse" for="c-41684915">[-]</label><label class="expand" for="c-41684915">[1 more]</label></div><br/><div class="children"><div class="content">Because that is literally what Discord is for</div><br/></div></div><div id="41685549" class="c"><input type="checkbox" id="c-41685549" checked=""/><div class="controls bullet"><span class="by">jerryspringster</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41684915">prev</a><span>|</span><a href="#41684952">next</a><span>|</span><label class="collapse" for="c-41685549">[-]</label><label class="expand" for="c-41685549">[1 more]</label></div><br/><div class="children"><div class="content">How do you sort the good from the bad? I&#x27;m sure most of my conversations were shit posts aswell but some weren&#x27;t, especially when it figuring out how something new worked or how to fix a problem.</div><br/></div></div><div id="41684952" class="c"><input type="checkbox" id="c-41684952" checked=""/><div class="controls bullet"><span class="by">hypeatei</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41685549">prev</a><span>|</span><a href="#41685281">next</a><span>|</span><label class="collapse" for="c-41684952">[-]</label><label class="expand" for="c-41684952">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s why I laugh when people say discord content needs to be indexed on the web so things are more discoverable. 99% is garbage and the useful messages are scattered across channels.</div><br/><div id="41685810" class="c"><input type="checkbox" id="c-41685810" checked=""/><div class="controls bullet"><span class="by">retsibsi</span><span>|</span><a href="#41684891">root</a><span>|</span><a href="#41684952">parent</a><span>|</span><a href="#41685281">next</a><span>|</span><label class="collapse" for="c-41685810">[-]</label><label class="expand" for="c-41685810">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not trying to be a smartarse but doesn&#x27;t this describe the entire internet? The good stuff is rare and scattered, and that&#x27;s why search is so important.</div><br/></div></div></div></div><div id="41685281" class="c"><input type="checkbox" id="c-41685281" checked=""/><div class="controls bullet"><span class="by">squigz</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41684952">prev</a><span>|</span><a href="#41684896">next</a><span>|</span><label class="collapse" for="c-41685281">[-]</label><label class="expand" for="c-41685281">[1 more]</label></div><br/><div class="children"><div class="content">That sounds like it was a problem with the communities you engaged with.</div><br/></div></div><div id="41684896" class="c"><input type="checkbox" id="c-41684896" checked=""/><div class="controls bullet"><span class="by">aurareturn</span><span>|</span><a href="#41684891">parent</a><span>|</span><a href="#41685281">prev</a><span>|</span><a href="#41685124">next</a><span>|</span><label class="collapse" for="c-41684896">[-]</label><label class="expand" for="c-41684896">[1 more]</label></div><br/><div class="children"><div class="content">How do you differentiate shit posts vs quality ones if you’re Discord?</div><br/></div></div></div></div><div id="41685124" class="c"><input type="checkbox" id="c-41685124" checked=""/><div class="controls bullet"><span class="by">robertclaus</span><span>|</span><a href="#41684891">prev</a><span>|</span><label class="collapse" for="c-41685124">[-]</label><label class="expand" for="c-41685124">[5 more]</label></div><br/><div class="children"><div class="content">Very cool that even at this scale the right vanilla SQL database just works. No fancy document store, map-reduce, or GPU implementations needed.</div><br/><div id="41685247" class="c"><input type="checkbox" id="c-41685247" checked=""/><div class="controls bullet"><span class="by">salomonk_mur</span><span>|</span><a href="#41685124">parent</a><span>|</span><a href="#41685167">next</a><span>|</span><label class="collapse" for="c-41685247">[-]</label><label class="expand" for="c-41685247">[2 more]</label></div><br/><div class="children"><div class="content">How is ScyllaDB (the solution used in the article) a vanilla SQL DB? Its the complete opposite!</div><br/><div id="41685768" class="c"><input type="checkbox" id="c-41685768" checked=""/><div class="controls bullet"><span class="by">melodyogonna</span><span>|</span><a href="#41685124">root</a><span>|</span><a href="#41685247">parent</a><span>|</span><a href="#41685167">next</a><span>|</span><label class="collapse" for="c-41685768">[-]</label><label class="expand" for="c-41685768">[1 more]</label></div><br/><div class="children"><div class="content">The syntax is SQL</div><br/></div></div></div></div><div id="41685167" class="c"><input type="checkbox" id="c-41685167" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#41685124">parent</a><span>|</span><a href="#41685247">prev</a><span>|</span><label class="collapse" for="c-41685167">[-]</label><label class="expand" for="c-41685167">[2 more]</label></div><br/><div class="children"><div class="content">It annoys me sometimes how effective B-trees are.<p>Every decade has some cool breakthrough in compression, and a handful of other disciplines. But OLTP databases are still basically better B-trees.</div><br/><div id="41685417" class="c"><input type="checkbox" id="c-41685417" checked=""/><div class="controls bullet"><span class="by">menaerus</span><span>|</span><a href="#41685124">root</a><span>|</span><a href="#41685167">parent</a><span>|</span><label class="collapse" for="c-41685417">[-]</label><label class="expand" for="c-41685417">[1 more]</label></div><br/><div class="children"><div class="content">LSM trees? ScyllaDB is LSM-based storage engine. RocksDB as well.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>