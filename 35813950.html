<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683363668492" as="style"/><link rel="stylesheet" href="styles.css?v=1683363668492"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lwn.net/SubscriberLink/930173/c1a1f68dc4e20191/">A Linux kernel without struct buffer_head</a> <span class="domain">(<a href="https://lwn.net">lwn.net</a>)</span></div><div class="subtext"><span>rwmj</span> | <span>15 comments</span></div><br/><div><div id="35839089" class="c"><input type="checkbox" id="c-35839089" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#35837306">next</a><span>|</span><label class="collapse" for="c-35839089">[-]</label><label class="expand" for="c-35839089">[1 more]</label></div><br/><div class="children"><div class="content">&gt; On the other hand, it is possible to build a buffer-head-free kernel that supports Btrfs and XFS.<p>So if I build a system that only uses XFS&#x2F;BTRFS, do I get anything by explicitly disabling it, or are those filesystems already getting the performance benefit just by not using it themselves? Is BUFFER_HEAD just a goal to show kernel devs what&#x27;s left, or does it have practical value to end users?</div><br/></div></div><div id="35837306" class="c"><input type="checkbox" id="c-35837306" checked=""/><div class="controls bullet"><span class="by">shreyas-iyer</span><span>|</span><a href="#35839089">prev</a><span>|</span><a href="#35836323">next</a><span>|</span><label class="collapse" for="c-35837306">[-]</label><label class="expand" for="c-35837306">[1 more]</label></div><br/><div class="children"><div class="content">I played a ton with the Linux file system while I was in college, and it&#x27;s filled with code that is obviously a result tech debt. For that reason, it&#x27;s one of the more complex parts of the kernel.<p>This is awesome, but I don&#x27;t see the `buffer_head` getting replaced anytime soon. It&#x27;s so baked into existing filesystems, I can&#x27;t see it going away for at least half a decade.<p>Also, love lwn.net—great find!</div><br/></div></div><div id="35836323" class="c"><input type="checkbox" id="c-35836323" checked=""/><div class="controls bullet"><span class="by">dureuill</span><span>|</span><a href="#35837306">prev</a><span>|</span><a href="#35837367">next</a><span>|</span><label class="collapse" for="c-35836323">[-]</label><label class="expand" for="c-35836323">[5 more]</label></div><br/><div class="children"><div class="content">Another great write-up on lwn.net.<p>Really makes me consider subscribing.<p>More on the topic I&#x27;m wondering how the remaining users of buffer_head could possibly migrate? Especially since we&#x27;re talking filesystems I&#x27;m guessing we don&#x27;t want any change in behaviour as it could result in a loss of data</div><br/><div id="35837928" class="c"><input type="checkbox" id="c-35837928" checked=""/><div class="controls bullet"><span class="by">dannyobrien</span><span>|</span><a href="#35836323">parent</a><span>|</span><a href="#35836386">next</a><span>|</span><label class="collapse" for="c-35837928">[-]</label><label class="expand" for="c-35837928">[2 more]</label></div><br/><div class="children"><div class="content">I no longer work in a very kernel-adjacent area but I keep my LWN subscription because of the quality of the writing, and its general sense of the wider FLOSS ecosystem. It really is a great resource. <a href="https:&#x2F;&#x2F;lwn.net&#x2F;subscribe&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;subscribe&#x2F;</a></div><br/><div id="35839344" class="c"><input type="checkbox" id="c-35839344" checked=""/><div class="controls bullet"><span class="by">dureuill</span><span>|</span><a href="#35836323">root</a><span>|</span><a href="#35837928">parent</a><span>|</span><a href="#35836386">next</a><span>|</span><label class="collapse" for="c-35839344">[-]</label><label class="expand" for="c-35839344">[1 more]</label></div><br/><div class="children"><div class="content">I decided to take the plunge:-)<p>As a systems programmer I believe it will have useful content for me, and I want to support the initiative</div><br/></div></div></div></div><div id="35836386" class="c"><input type="checkbox" id="c-35836386" checked=""/><div class="controls bullet"><span class="by">hvs</span><span>|</span><a href="#35836323">parent</a><span>|</span><a href="#35837928">prev</a><span>|</span><a href="#35836354">next</a><span>|</span><label class="collapse" for="c-35836386">[-]</label><label class="expand" for="c-35836386">[1 more]</label></div><br/><div class="children"><div class="content">LWN.net is one site that has such consistently good writing that I even subscribed to it even though I wasn&#x27;t really in the linux development community because it is just that good. I don&#x27;t have time to read it now which is the only reason I don&#x27;t subscribe currently. I highly recommend it to anyone.</div><br/></div></div><div id="35836354" class="c"><input type="checkbox" id="c-35836354" checked=""/><div class="controls bullet"><span class="by">afr0ck</span><span>|</span><a href="#35836323">parent</a><span>|</span><a href="#35836386">prev</a><span>|</span><a href="#35837367">next</a><span>|</span><label class="collapse" for="c-35836354">[-]</label><label class="expand" for="c-35836354">[1 more]</label></div><br/><div class="children"><div class="content">It will certainly take a couple of years before it&#x27;s completely removed. This is just a first step.</div><br/></div></div></div></div><div id="35837367" class="c"><input type="checkbox" id="c-35837367" checked=""/><div class="controls bullet"><span class="by">eduction</span><span>|</span><a href="#35836323">prev</a><span>|</span><a href="#35837767">next</a><span>|</span><label class="collapse" for="c-35837367">[-]</label><label class="expand" for="c-35837367">[3 more]</label></div><br/><div class="children"><div class="content">Can someone Explain Like I’m Five why someone would design a filesystem to be deeply entangled with a specific struct in memory in a specific kernel design?<p>I’m referring to where the article says ext4 “still makes heavy use of buffer heads,” implies this has been the case since ext2 and says “the buffer cache was deeply wired into both the block subsystem and the filesystem implementations.”<p>Naively I would think the job of the filesystem is to handle reads and writes to disk and that a well designed one would leave caching to other parts of the OS.</div><br/><div id="35837542" class="c"><input type="checkbox" id="c-35837542" checked=""/><div class="controls bullet"><span class="by">thristian</span><span>|</span><a href="#35837367">parent</a><span>|</span><a href="#35837647">next</a><span>|</span><label class="collapse" for="c-35837542">[-]</label><label class="expand" for="c-35837542">[1 more]</label></div><br/><div class="children"><div class="content">The filesystem doesn&#x27;t <i>just</i> read from one part of the disk and write to another part of the disk, it reads from the disk and stores the result in memory, or it takes data from memory and writes it to the disk.<p>The other part of the kernel that deals with data in memory is the cache.<p>Rather than have two separate representations of &quot;data in memory&quot; and have to translate between them all the time, it makes sense to have one representation of &quot;data in memory&quot; that all the affected systems can use to talk to each other.<p>Even though the kernel now has multiple representations of &quot;data in memory&quot; due to advances in other parts of the kernel, it&#x27;s <i>still</i> desirable to have just one representation shared between the cache and the filesystem, which is why people are talking about removing the old ones, and porting old code to use the new ones.</div><br/></div></div><div id="35837647" class="c"><input type="checkbox" id="c-35837647" checked=""/><div class="controls bullet"><span class="by">just_a_quack</span><span>|</span><a href="#35837367">parent</a><span>|</span><a href="#35837542">prev</a><span>|</span><a href="#35837767">next</a><span>|</span><label class="collapse" for="c-35837647">[-]</label><label class="expand" for="c-35837647">[1 more]</label></div><br/><div class="children"><div class="content">I think it&#x27;s because ext2 and ext4 both use block allocation in favor of paging thru bio and uses buffer tricks to write data in a way that reduces fragmentation</div><br/></div></div></div></div><div id="35837767" class="c"><input type="checkbox" id="c-35837767" checked=""/><div class="controls bullet"><span class="by">cratermoon</span><span>|</span><a href="#35837367">prev</a><span>|</span><label class="collapse" for="c-35837767">[-]</label><label class="expand" for="c-35837767">[4 more]</label></div><br/><div class="children"><div class="content">I aspire to one day work for an organization that balances backward compatibility with necessary changes as well as the linux community can. It&#x27;s not just the attention to maintaining it, it&#x27;s the sophistication in how to manage the variant needs.</div><br/><div id="35837826" class="c"><input type="checkbox" id="c-35837826" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#35837767">parent</a><span>|</span><label class="collapse" for="c-35837826">[-]</label><label class="expand" for="c-35837826">[3 more]</label></div><br/><div class="children"><div class="content">Microsoft is hiring. In the past, Microsoft had gone as far as emulating undocumented&#x2F;undefined API behavior for misbehaving&#x2F;buggy applications, to keep them working under new OS releases.<p>Nobody in GNU&#x2F;Linux tests old binaries; only whatever they recompiled for their current distro, and screw the rest.<p>The kernel <i>is</i> pretty good about maintaining syscall compatibility.</div><br/><div id="35838017" class="c"><input type="checkbox" id="c-35838017" checked=""/><div class="controls bullet"><span class="by">NotYourLawyer</span><span>|</span><a href="#35837767">root</a><span>|</span><a href="#35837826">parent</a><span>|</span><label class="collapse" for="c-35838017">[-]</label><label class="expand" for="c-35838017">[2 more]</label></div><br/><div class="children"><div class="content">Raymond Chen has about a million blog posts describing some of these efforts.<p><a href="https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;oldnewthing&#x2F;" rel="nofollow">https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;oldnewthing&#x2F;</a></div><br/><div id="35838541" class="c"><input type="checkbox" id="c-35838541" checked=""/><div class="controls bullet"><span class="by">smegsicle</span><span>|</span><a href="#35837767">root</a><span>|</span><a href="#35838017">parent</a><span>|</span><label class="collapse" for="c-35838541">[-]</label><label class="expand" for="c-35838541">[1 more]</label></div><br/><div class="children"><div class="content">is redmond-chan even a real person ?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>