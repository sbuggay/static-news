<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712653274363" as="style"/><link rel="stylesheet" href="styles.css?v=1712653274363"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://gitlab.com/Screwtapello/isa65xx">The 6502 instruction set as a database</a> <span class="domain">(<a href="https://gitlab.com">gitlab.com</a>)</span></div><div class="subtext"><span>orgonon</span> | <span>27 comments</span></div><br/><div><div id="39973808" class="c"><input type="checkbox" id="c-39973808" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39975258">next</a><span>|</span><label class="collapse" for="c-39973808">[-]</label><label class="expand" for="c-39973808">[1 more]</label></div><br/><div class="children"><div class="content">Since this is SQLite SQL, I copied it into a Gist (to give it CORS headers) and now you can open it directly in Datasette Lite (Datasette in WebAssembly running entirely in the browser):<p><a href="https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simonw&#x2F;60fd6fedb3fd460bcfd1c5263618b0ac#&#x2F;data" rel="nofollow">https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simon...</a><p>Here are the 65 hardcoded opcodes: <a href="https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simonw&#x2F;60fd6fedb3fd460bcfd1c5263618b0ac#&#x2F;data&#x2F;hardcoded_opcodes?_facet=mode&amp;_facet=instruction_kind&amp;_facet=mode_kind" rel="nofollow">https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simon...</a><p>And the 64 instructions: <a href="https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simonw&#x2F;60fd6fedb3fd460bcfd1c5263618b0ac#&#x2F;data&#x2F;instructions?_facet=instruction_kind&amp;_facet=cycles&amp;_sort=mnemonic" rel="nofollow">https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simon...</a></div><br/></div></div><div id="39975258" class="c"><input type="checkbox" id="c-39975258" checked=""/><div class="controls bullet"><span class="by">xpe</span><span>|</span><a href="#39973808">prev</a><span>|</span><a href="#39975519">next</a><span>|</span><label class="collapse" for="c-39975258">[-]</label><label class="expand" for="c-39975258">[3 more]</label></div><br/><div class="children"><div class="content">Inspiring. I would love for the author&#x27;s plan (pasted below) to get applied widely across key information sources:<p><pre><code>    Instead, I hatched a plan:

    1. Collect sources, and encoded the raw data in a machine-readable form
    2. Study those sources, and encode my understanding as assertions, 
       sanity-checks and validations of that data
    3. Synthesise that data according to my understanding, and verify it
       against the sources available</code></pre></div><br/><div id="39976066" class="c"><input type="checkbox" id="c-39976066" checked=""/><div class="controls bullet"><span class="by">kreelman</span><span>|</span><a href="#39975258">parent</a><span>|</span><a href="#39976443">next</a><span>|</span><label class="collapse" for="c-39976066">[-]</label><label class="expand" for="c-39976066">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for reposting this here.
I think I work in a similar way to this, but I&#x27;ve not written it down as a &quot;manifesto&quot; before like Simon has.<p>I&#x27;m going to be thinking about this as the Discovery Manifesto.... or maybe the autodidactaliser.<p>I&#x27;ve found it useful to reexpress foreign knowledge in a familiar setting. The magic is possibly that the learning seems fun because the familiar tool is fairly easy to use and the new information is expressed in the familiar way.<p>It&#x27;s also good because it&#x27;s not cheap dopamine, like looking over Youtube videos.... I watched a video on the 6502... I know how it works now??.. Youtubes do have their place, but not at the expense of doing more in depth thinking.</div><br/></div></div><div id="39976443" class="c"><input type="checkbox" id="c-39976443" checked=""/><div class="controls bullet"><span class="by">gardaani</span><span>|</span><a href="#39975258">parent</a><span>|</span><a href="#39976066">prev</a><span>|</span><a href="#39975519">next</a><span>|</span><label class="collapse" for="c-39976443">[-]</label><label class="expand" for="c-39976443">[1 more]</label></div><br/><div class="children"><div class="content">The last step should be: 4. Get a real 6502 CPU and verify that the data is correct.</div><br/></div></div></div></div><div id="39975519" class="c"><input type="checkbox" id="c-39975519" checked=""/><div class="controls bullet"><span class="by">peterkelly</span><span>|</span><a href="#39975258">prev</a><span>|</span><a href="#39973657">next</a><span>|</span><label class="collapse" for="c-39975519">[-]</label><label class="expand" for="c-39975519">[1 more]</label></div><br/><div class="children"><div class="content">Likely useful: <a href="https:&#x2F;&#x2F;github.com&#x2F;mist64&#x2F;perfect6502">https:&#x2F;&#x2F;github.com&#x2F;mist64&#x2F;perfect6502</a> and <a href="http:&#x2F;&#x2F;www.visual6502.org&#x2F;" rel="nofollow">http:&#x2F;&#x2F;www.visual6502.org&#x2F;</a>. These are transistor-level simulations based on die shots. From these you can derive the cycle times of each instruction with 100% confidence.</div><br/></div></div><div id="39973657" class="c"><input type="checkbox" id="c-39973657" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#39975519">prev</a><span>|</span><a href="#39975337">next</a><span>|</span><label class="collapse" for="c-39973657">[-]</label><label class="expand" for="c-39973657">[2 more]</label></div><br/><div class="children"><div class="content">Up next: 6502 emulator in a single SQL query</div><br/><div id="39976071" class="c"><input type="checkbox" id="c-39976071" checked=""/><div class="controls bullet"><span class="by">kreelman</span><span>|</span><a href="#39973657">parent</a><span>|</span><a href="#39975337">next</a><span>|</span><label class="collapse" for="c-39976071">[-]</label><label class="expand" for="c-39976071">[1 more]</label></div><br/><div class="children"><div class="content">:-)</div><br/></div></div></div></div><div id="39975337" class="c"><input type="checkbox" id="c-39975337" checked=""/><div class="controls bullet"><span class="by">MenhirMike</span><span>|</span><a href="#39973657">prev</a><span>|</span><a href="#39973802">next</a><span>|</span><label class="collapse" for="c-39975337">[-]</label><label class="expand" for="c-39975337">[1 more]</label></div><br/><div class="children"><div class="content">From the comments, it even seems to account for some instructions needing an extra cycle when crossing page boundaries, nice! This seems pretty comprehensive then.</div><br/></div></div><div id="39973802" class="c"><input type="checkbox" id="c-39973802" checked=""/><div class="controls bullet"><span class="by">jll29</span><span>|</span><a href="#39975337">prev</a><span>|</span><a href="#39974232">next</a><span>|</span><label class="collapse" for="c-39973802">[-]</label><label class="expand" for="c-39973802">[3 more]</label></div><br/><div class="children"><div class="content">Great idea, this could be valuable for people who write their own assembler.<p>It&#x27;s the first time I see an instruction set as a relational database, which
I would imagine is a very portable way to describe a machine, perhaps it might
be worth collecting other machine specs in that same format and then create a
portable assembler that uses the specficic DBs.</div><br/><div id="39975497" class="c"><input type="checkbox" id="c-39975497" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39973802">parent</a><span>|</span><a href="#39975530">next</a><span>|</span><label class="collapse" for="c-39975497">[-]</label><label class="expand" for="c-39975497">[1 more]</label></div><br/><div class="children"><div class="content">Table-driven assemblers (and disassemblers) have been a thing for a long time, especially for more obscure&#x2F;embedded architectures. Reverse-engineering&#x2F;analysis tools likewise have traditionally done the same, but with additional semantic information for each instruction. A quick search for table-driven compilers reveals some mid-century papers.</div><br/></div></div><div id="39975530" class="c"><input type="checkbox" id="c-39975530" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#39973802">parent</a><span>|</span><a href="#39975497">prev</a><span>|</span><a href="#39974232">next</a><span>|</span><label class="collapse" for="c-39975530">[-]</label><label class="expand" for="c-39975530">[1 more]</label></div><br/><div class="children"><div class="content">Ghidra uses SLEIGH for this purpose <a href="https:&#x2F;&#x2F;fossies.org&#x2F;linux&#x2F;ghidra&#x2F;GhidraDocs&#x2F;languages&#x2F;html&#x2F;sleigh.html" rel="nofollow">https:&#x2F;&#x2F;fossies.org&#x2F;linux&#x2F;ghidra&#x2F;GhidraDocs&#x2F;languages&#x2F;html&#x2F;s...</a><p>&gt; A Language for Rapid Processor Specification<p>From a SLEIGH description, the assembler, disassembler, and even decompiler can be synthesized.<p>It&#x27;s a DSL not a database schema, but fundamentally it&#x27;s the same idea.<p>Here&#x27;s their definition of the 6502: <a href="https:&#x2F;&#x2F;github.com&#x2F;NationalSecurityAgency&#x2F;ghidra&#x2F;blob&#x2F;cae9190c13709fbd889edbe8f46d28c99df0a588&#x2F;Ghidra&#x2F;Processors&#x2F;6502&#x2F;data&#x2F;languages&#x2F;6502.slaspec">https:&#x2F;&#x2F;github.com&#x2F;NationalSecurityAgency&#x2F;ghidra&#x2F;blob&#x2F;cae919...</a></div><br/></div></div></div></div><div id="39974232" class="c"><input type="checkbox" id="c-39974232" checked=""/><div class="controls bullet"><span class="by">hoten</span><span>|</span><a href="#39973802">prev</a><span>|</span><a href="#39974358">next</a><span>|</span><label class="collapse" for="c-39974232">[-]</label><label class="expand" for="c-39974232">[1 more]</label></div><br/><div class="children"><div class="content">Some other instruction sets in some JSON: <a href="https:&#x2F;&#x2F;github.com&#x2F;asmjit&#x2F;asmjit&#x2F;tree&#x2F;master&#x2F;db">https:&#x2F;&#x2F;github.com&#x2F;asmjit&#x2F;asmjit&#x2F;tree&#x2F;master&#x2F;db</a></div><br/></div></div><div id="39974358" class="c"><input type="checkbox" id="c-39974358" checked=""/><div class="controls bullet"><span class="by">snvzz</span><span>|</span><a href="#39974232">prev</a><span>|</span><a href="#39973553">next</a><span>|</span><label class="collapse" for="c-39974358">[-]</label><label class="expand" for="c-39974358">[5 more]</label></div><br/><div class="children"><div class="content">Not sure what the advantage is, relative to the tables as CSV files.</div><br/><div id="39976158" class="c"><input type="checkbox" id="c-39976158" checked=""/><div class="controls bullet"><span class="by">thristian</span><span>|</span><a href="#39974358">parent</a><span>|</span><a href="#39974556">next</a><span>|</span><label class="collapse" for="c-39976158">[-]</label><label class="expand" for="c-39976158">[1 more]</label></div><br/><div class="children"><div class="content">As far as I know, most information about the 6502 instruction set comes in two forms:<p>- emulators&#x2F;simulators&#x2F;FPGA code<p>- books, data sheets, OCR&#x27;d PDFs of books and data sheets, text files copy&#x2F;pasted from PDFs or retyped from books and data sheets<p>Code is likely to be heavily tested, but it makes extracting high-level information about the instruction set very difficult.<p>Data is easy to analyse and synthesise, but since it&#x27;s described in prose there&#x27;s no easy way to test or validate it - if somebody in 1984 made a typo that a particular instruction took 3 cycles instead of 2, and that error was copy&#x2F;pasted and made its way into half the &quot;6502 instruction set&quot; websites online, how would you know? How would you detect it?<p>Using SQL to enforce constraints and validation gives me confidence that there aren&#x27;t a bunch of typos and copy&#x2F;paste errors in this data. In addition, being able to express special cases like &quot;read-modify-write instructions applying to the accumulator do not pay the three cycle penalty&quot; in code rather than in prose makes it more likely they will be applied correctly. Lastly, since the result is an SQL database, it can be pretty easily formatted to resemble any book or data sheet you like for simplified visual verification against book&#x2F;data sheet sources.</div><br/></div></div><div id="39974556" class="c"><input type="checkbox" id="c-39974556" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39974358">parent</a><span>|</span><a href="#39976158">prev</a><span>|</span><a href="#39973553">next</a><span>|</span><label class="collapse" for="c-39974556">[-]</label><label class="expand" for="c-39974556">[3 more]</label></div><br/><div class="children"><div class="content">The ability to ship SQL views that join multiple tables as part of the schema is pretty cool, and something you can&#x27;t come close to replicating with CSVs.<p><a href="https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simonw&#x2F;60fd6fedb3fd460bcfd1c5263618b0ac#&#x2F;data&#x2F;opcodes?_facet=mode&amp;_facet=base_cycles&amp;_facet=force_cycles&amp;_facet=bytes" rel="nofollow">https:&#x2F;&#x2F;lite.datasette.io&#x2F;?sql=https:&#x2F;&#x2F;gist.github.com&#x2F;simon...</a></div><br/><div id="39974691" class="c"><input type="checkbox" id="c-39974691" checked=""/><div class="controls bullet"><span class="by">maxcoder4</span><span>|</span><a href="#39974358">root</a><span>|</span><a href="#39974556">parent</a><span>|</span><a href="#39973553">next</a><span>|</span><label class="collapse" for="c-39974691">[-]</label><label class="expand" for="c-39974691">[2 more]</label></div><br/><div class="children"><div class="content">I like how it looks, and I appreciate the effort that went into it, but other than using it to export a table in just a right format that you will then embed into your assembler directly, I&#x27;m not sure how to use it.<p>And I use opcode references [1] very often (sometimes daily, depending on the project). I even wrote my own disassemblers. But I mostly use opcode references for manual cross checking, so maybe I&#x27;m not a target of this project?<p>[1] My favorite one for x64 is <a href="https:&#x2F;&#x2F;ref.x86asm.net&#x2F;coder64.html" rel="nofollow">https:&#x2F;&#x2F;ref.x86asm.net&#x2F;coder64.html</a></div><br/><div id="39975129" class="c"><input type="checkbox" id="c-39975129" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39974358">root</a><span>|</span><a href="#39974691">parent</a><span>|</span><a href="#39973553">next</a><span>|</span><label class="collapse" for="c-39975129">[-]</label><label class="expand" for="c-39975129">[1 more]</label></div><br/><div class="children"><div class="content">The ability to export data from a table or query in whatever format you need is one of my favorite things about distributing data using SQLite.</div><br/></div></div></div></div></div></div></div></div><div id="39973553" class="c"><input type="checkbox" id="c-39973553" checked=""/><div class="controls bullet"><span class="by">hedgehog</span><span>|</span><a href="#39974358">prev</a><span>|</span><a href="#39974696">next</a><span>|</span><label class="collapse" for="c-39973553">[-]</label><label class="expand" for="c-39973553">[1 more]</label></div><br/><div class="children"><div class="content">This is a very nice presentation, the .sql file contains a lot of notes about the sourcing for the data. I could imagine adding test vectors to the database as well.</div><br/></div></div><div id="39974696" class="c"><input type="checkbox" id="c-39974696" checked=""/><div class="controls bullet"><span class="by">gabrielsroka</span><span>|</span><a href="#39973553">prev</a><span>|</span><a href="#39975771">next</a><span>|</span><label class="collapse" for="c-39974696">[-]</label><label class="expand" for="c-39974696">[5 more]</label></div><br/><div class="children"><div class="content">The 6502 only has 56 opcodes.<p>The db also includes modern variants of the 6502.</div><br/><div id="39975637" class="c"><input type="checkbox" id="c-39975637" checked=""/><div class="controls bullet"><span class="by">dspillett</span><span>|</span><a href="#39974696">parent</a><span>|</span><a href="#39975906">next</a><span>|</span><label class="collapse" for="c-39975637">[-]</label><label class="expand" for="c-39975637">[3 more]</label></div><br/><div class="children"><div class="content"><i>&gt; The 6502 only has 56 opcodes</i><p>In terms of bytes that the original CPU officially recognised as instructions, it was more like ~150 (working from old memories, I may be off by one or few there). Some of the other ~106 did something unofficially, and a number were valid instructions on later versions of the design.<p>That ~150 <i>were</i> grouped into 56 instructions, many with multiple addressing modes (so &quot;load A immediate&quot;, &quot;load A direct&quot;, &quot;load A indexed&quot;, etc, were different opcodes but considered the same instruction).<p>Because register use was far from orthogonal (one accumulator, two index registers, and a flags register), instructions for them were considered different (LDA, LDX, &amp; LDY, for load for instance) where in other instruction sets (for chips with multiple general purpose registers) they might be considered the same instruction affecting a different register, though considering them the same instruction didn&#x27;t reduce the opcode count just the instruction group count.<p>(Apologies for failing to keep my inner pendant properly inner!)</div><br/><div id="39975993" class="c"><input type="checkbox" id="c-39975993" checked=""/><div class="controls bullet"><span class="by">gabrielsroka</span><span>|</span><a href="#39974696">root</a><span>|</span><a href="#39975637">parent</a><span>|</span><a href="#39975863">next</a><span>|</span><label class="collapse" for="c-39975993">[-]</label><label class="expand" for="c-39975993">[1 more]</label></div><br/><div class="children"><div class="content">&gt; pendant<p>I assume you mean pedant.</div><br/></div></div><div id="39975863" class="c"><input type="checkbox" id="c-39975863" checked=""/><div class="controls bullet"><span class="by">thristian</span><span>|</span><a href="#39974696">root</a><span>|</span><a href="#39975637">parent</a><span>|</span><a href="#39975993">prev</a><span>|</span><a href="#39975906">next</a><span>|</span><label class="collapse" for="c-39975863">[-]</label><label class="expand" for="c-39975863">[1 more]</label></div><br/><div class="children"><div class="content">The original 6502 had exactly 151 opcodes, the same as the number of pokémon in the original <i>Pokémon</i> games.</div><br/></div></div></div></div><div id="39975906" class="c"><input type="checkbox" id="c-39975906" checked=""/><div class="controls bullet"><span class="by">gabrielsroka</span><span>|</span><a href="#39974696">parent</a><span>|</span><a href="#39975637">prev</a><span>|</span><a href="#39975771">next</a><span>|</span><label class="collapse" for="c-39975906">[-]</label><label class="expand" for="c-39975906">[1 more]</label></div><br/><div class="children"><div class="content">I meant instructions&#x2F;mnemonics.<p>I was referencing Simonw&#x27;s post:<p>&gt; Here are the 65 hardcoded opcodes</div><br/></div></div></div></div><div id="39975771" class="c"><input type="checkbox" id="c-39975771" checked=""/><div class="controls bullet"><span class="by">transfire</span><span>|</span><a href="#39974696">prev</a><span>|</span><a href="#39974110">next</a><span>|</span><label class="collapse" for="c-39975771">[-]</label><label class="expand" for="c-39975771">[2 more]</label></div><br/><div class="children"><div class="content">Something I realized years ago, the 6502 instruction set is small enough that it can be (almost) entirely implemented as memory look up — no actual logic computation need occur.</div><br/><div id="39976608" class="c"><input type="checkbox" id="c-39976608" checked=""/><div class="controls bullet"><span class="by">kragen</span><span>|</span><a href="#39975771">parent</a><span>|</span><a href="#39974110">next</a><span>|</span><label class="collapse" for="c-39976608">[-]</label><label class="expand" for="c-39976608">[1 more]</label></div><br/><div class="children"><div class="content">if you allow multiple sequential memory lookups, this is true for any instruction set</div><br/></div></div></div></div><div id="39974110" class="c"><input type="checkbox" id="c-39974110" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#39975771">prev</a><span>|</span><label class="collapse" for="c-39974110">[-]</label><label class="expand" for="c-39974110">[1 more]</label></div><br/><div class="children"><div class="content">In a reductionist sense this is &quot;sql is Turing complete&quot; which is long known, A voyage of discovery aside the joy is the execution and efficiency. I&#x27;d be delighted if I&#x27;d done this.</div><br/></div></div></div></div></div></div></div></body></html>