<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1713862859130" as="style"/><link rel="stylesheet" href="styles.css?v=1713862859130"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://carapace.sh/">Carapace: A multi-shell completion library and binary</a>Â <span class="domain">(<a href="https://carapace.sh">carapace.sh</a>)</span></div><div class="subtext"><span>cab404</span> | <span>11 comments</span></div><br/><div><div id="40129015" class="c"><input type="checkbox" id="c-40129015" checked=""/><div class="controls bullet"><span class="by">sigoden</span><span>|</span><a href="#40129675">next</a><span>|</span><label class="collapse" for="c-40129015">[-]</label><label class="expand" for="c-40129015">[1 more]</label></div><br/><div class="children"><div class="content">Other similar projects:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;sigoden&#x2F;argc-completions">https:&#x2F;&#x2F;github.com&#x2F;sigoden&#x2F;argc-completions</a><p><a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;inshellisense">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;inshellisense</a></div><br/></div></div><div id="40129675" class="c"><input type="checkbox" id="c-40129675" checked=""/><div class="controls bullet"><span class="by">arpowers</span><span>|</span><a href="#40129015">prev</a><span>|</span><a href="#40129018">next</a><span>|</span><label class="collapse" for="c-40129675">[-]</label><label class="expand" for="c-40129675">[2 more]</label></div><br/><div class="children"><div class="content">Reminds of of Project Hail Mary. Never heard the word &quot;carapace&quot; before that book...</div><br/><div id="40129837" class="c"><input type="checkbox" id="c-40129837" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#40129675">parent</a><span>|</span><a href="#40129018">next</a><span>|</span><label class="collapse" for="c-40129837">[-]</label><label class="expand" for="c-40129837">[1 more]</label></div><br/><div class="children"><div class="content">In Romanian &quot;carapace&quot; means shell. It seems to mean the same in English, too, but I presume is seldom used: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Carapace" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Carapace</a></div><br/></div></div></div></div><div id="40129018" class="c"><input type="checkbox" id="c-40129018" checked=""/><div class="controls bullet"><span class="by">jchook</span><span>|</span><a href="#40129675">prev</a><span>|</span><a href="#40128073">next</a><span>|</span><label class="collapse" for="c-40129018">[-]</label><label class="expand" for="c-40129018">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Custom completions can be defined using yaml files.<p>The concept is awesome but it&#x27;s curious to see YAML at the core of this project, rather than a Turing-complete, embeddable language like Lua.</div><br/></div></div><div id="40128073" class="c"><input type="checkbox" id="c-40128073" checked=""/><div class="controls bullet"><span class="by">bbkane</span><span>|</span><a href="#40129018">prev</a><span>|</span><label class="collapse" for="c-40128073">[-]</label><label class="expand" for="c-40128073">[6 more]</label></div><br/><div class="children"><div class="content">I tried this but couldn&#x27;t get the completions to load. I think it&#x27;s a really good idea though (much faster than zsh script completions), so hopefully soon I can retry the install and either get it working or open an issue.<p>One design aspect I do question is that completions are baked into the library. It&#x27;d be neat to have them in SQLite or something that could be updated independently (not sure how feasible that is though. I&#x27;ve never been any good at querying graphs like flag&#x2F;command completions in SQLite).</div><br/><div id="40128606" class="c"><input type="checkbox" id="c-40128606" checked=""/><div class="controls bullet"><span class="by">bPspGiJT8Y</span><span>|</span><a href="#40128073">parent</a><span>|</span><a href="#40128436">next</a><span>|</span><label class="collapse" for="c-40128606">[-]</label><label class="expand" for="c-40128606">[3 more]</label></div><br/><div class="children"><div class="content">&gt; much faster than zsh script completions<p>I&#x27;m curious where did you get that from.<p>Edit: I read the note in your dotfiles repo. Yes calling `compinit` on each shell invocation is going to be really slow. That&#x27;s not how you&#x27;re supposed to do it, you could at least add the `-C` flag to cache the completions. Ideally you&#x27;d also use `zcompile` to compile the cache to ZSH word code. This puts my completions initializing time at ~20ms on a lower&#x2F;mid-end laptop. Additionally you can do the trick `fish` does and defer the initialization of completions until the first hit of Tab key, so the impact on shell startup time is exactly 0.</div><br/><div id="40128826" class="c"><input type="checkbox" id="c-40128826" checked=""/><div class="controls bullet"><span class="by">bongobingo1</span><span>|</span><a href="#40128073">root</a><span>|</span><a href="#40128606">parent</a><span>|</span><a href="#40128436">next</a><span>|</span><label class="collapse" for="c-40128826">[-]</label><label class="expand" for="c-40128826">[2 more]</label></div><br/><div class="children"><div class="content">I have had this snippet in my .zshrc for years,<p><pre><code>    autoload -U compinit &amp;&amp; compinit
    {
      # Compile the completion dump to increase startup speed. Run in background.
      zcompdump=&quot;${ZDOTDIR:-$HOME}&#x2F;.zcompdump&quot;
      if [[ -s &quot;$zcompdump&quot; &amp;&amp; (! -s &quot;${zcompdump}.zwc&quot; || &quot;$zcompdump&quot; -nt &quot;${zcompdump}.zwc&quot;) ]]; then
        # if zcompdump file exists, and we don&#x27;t have a compiled version or the
        # dump file is newer than the compiled file
        zcompile &quot;$zcompdump&quot;
      fi
    } &amp;!
</code></pre>
Using `zmodload zsh&#x2F;zprof`, I can see about 50% (16ms) of my start up is compinit (its about 28ms without the `zcompile`).<p>Do you have any pointers for the &quot;load on tab&quot; idea? I didn&#x27;t turn up any good results in DDG and LLMs were just hallucinating.<p>BTW I believe `-C` will disable some cache checking, caching is enabled by default<p>&gt; To speed up the running of compinit, it can be made to produce a dumped configuration that will be  read  in  on future  invocations;  this  is  the  default, but can be turned off by calling compinit with the option -D.<p>&gt; ...<p>&gt;  ... The check performed to see if there are new functions can be omitted by giving the option -C.  In this case the dump file will only be created if there isn&#x27;t one already.</div><br/><div id="40129047" class="c"><input type="checkbox" id="c-40129047" checked=""/><div class="controls bullet"><span class="by">nikolatt</span><span>|</span><a href="#40128073">root</a><span>|</span><a href="#40128826">parent</a><span>|</span><a href="#40128436">next</a><span>|</span><label class="collapse" for="c-40129047">[-]</label><label class="expand" for="c-40129047">[1 more]</label></div><br/><div class="children"><div class="content">I just want to say - thank you! I&#x27;ve been using ZSH since it became the default on macOS and one thing that started annoying me recently is the slow startup time. Your snippet tangibly improved that.<p>Do you by chance have any good resources on optimising my config further?</div><br/></div></div></div></div></div></div><div id="40128436" class="c"><input type="checkbox" id="c-40128436" checked=""/><div class="controls bullet"><span class="by">FrozenCow</span><span>|</span><a href="#40128073">parent</a><span>|</span><a href="#40128606">prev</a><span>|</span><label class="collapse" for="c-40128436">[-]</label><label class="expand" for="c-40128436">[2 more]</label></div><br/><div class="children"><div class="content">Completions need to do arbitrary computation. A command like `git switch` needs to find what branches are available in the repository.</div><br/><div id="40128486" class="c"><input type="checkbox" id="c-40128486" checked=""/><div class="controls bullet"><span class="by">bbkane</span><span>|</span><a href="#40128073">root</a><span>|</span><a href="#40128436">parent</a><span>|</span><label class="collapse" for="c-40128486">[-]</label><label class="expand" for="c-40128486">[1 more]</label></div><br/><div class="children"><div class="content">True, but you can represent that in the db as a a CLI invocation to run in a subshell.<p>The big gain from something like carapace or my theoretical SQLite-based completion system is faster startup time. I had to remove zsh-completions from my shell setup as it added too much to the startup time (<a href="https:&#x2F;&#x2F;github.com&#x2F;bbkane&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;zsh&#x2F;README_notes.md#install-zsh-completions---replaced-with-carapace-bin">https:&#x2F;&#x2F;github.com&#x2F;bbkane&#x2F;dotfiles&#x2F;blob&#x2F;master&#x2F;zsh&#x2F;README_no...</a>)</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>