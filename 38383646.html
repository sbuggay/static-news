<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1700730064108" as="style"/><link rel="stylesheet" href="styles.css?v=1700730064108"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://callstacking.com/">For RoR, see every method call, parameter and return value in production</a> <span class="domain">(<a href="https://callstacking.com">callstacking.com</a>)</span></div><div class="subtext"><span>puuush</span> | <span>60 comments</span></div><br/><div><div id="38385579" class="c"><input type="checkbox" id="c-38385579" checked=""/><div class="controls bullet"><span class="by">jmholla</span><span>|</span><a href="#38390682">next</a><span>|</span><label class="collapse" for="c-38385579">[-]</label><label class="expand" for="c-38385579">[1 more]</label></div><br/><div class="children"><div class="content">The calculator at the bottom of the page is doing some weird calculations. If you have no incidents a year, it still costs you money. So do incidents that take zero minutes to resolve. I took apart the code, and this seems to be the equation in use:<p><pre><code>    (revenueTarget &#x2F; 8760) * resolutionTimeTarget * numIncidentsTarget * resolutionTimeTarget + numEmployeesTarget * avgEmployeeTargeRate
</code></pre>
This means revenue lost is correlated to the square of the lost time and the cost from employees is a static yearly cost.<p>There are a couple things wrong with it. The third * should be switched with a + and the last term need to be multiplied by the number of incidents.<p><pre><code>    (revenueTarget &#x2F; 8760) * resolutionTimeTarget * numIncidentsTarget + resolutionTimeTarget * numEmployeesTarget * avgEmployeeTargeRate * numIncidentsTarget
</code></pre>
Which if anyone at Call Stacking is here, just means changing<p><pre><code>    o = (n &#x2F; 8760) * e * t * e + i * r;
</code></pre>
to<p><pre><code>    o = (n &#x2F; 8760) * e * t + e * i * r * t;
</code></pre>
or more succinctly<p><pre><code>    o = t * e * (n &#x2F; 8760 + i * r)
</code></pre>
I&#x27;m assuming that&#x27;s minified, so<p><pre><code>    numIncidentsTarget * resolutionTimeTarget * (revenueTarget &#x2F; 8760 + numEmployeesTarget * avgEmployeeRateTarget)
</code></pre>
Edit: With the correct math, the example is wildly different. It should be $37,277.81, not $87,991.23.</div><br/></div></div><div id="38390682" class="c"><input type="checkbox" id="c-38390682" checked=""/><div class="controls bullet"><span class="by">ilamparithi</span><span>|</span><a href="#38385579">prev</a><span>|</span><a href="#38388237">next</a><span>|</span><label class="collapse" for="c-38390682">[-]</label><label class="expand" for="c-38390682">[1 more]</label></div><br/><div class="children"><div class="content">Recently did something similar for a java project using AOP. Basically adding an annotation to each method and logging the parameters before the method call and return values after the method call. Whenever there is an exception, a mail will be sent with the stacktrace along with the entire request path(including method calls, parameters and return values). Extremely useful for debugging and to proactively fix the issues.</div><br/></div></div><div id="38388237" class="c"><input type="checkbox" id="c-38388237" checked=""/><div class="controls bullet"><span class="by">crystaln</span><span>|</span><a href="#38390682">prev</a><span>|</span><a href="#38389731">next</a><span>|</span><label class="collapse" for="c-38388237">[-]</label><label class="expand" for="c-38388237">[4 more]</label></div><br/><div class="children"><div class="content">This is very cool and useful.<p>Also it is only necessary because of the lack of type enforcement which means no code can be relied and on and all code has to be constantly inspected for new bugs. Ugh.</div><br/><div id="38388451" class="c"><input type="checkbox" id="c-38388451" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38388237">parent</a><span>|</span><a href="#38388366">next</a><span>|</span><label class="collapse" for="c-38388451">[-]</label><label class="expand" for="c-38388451">[2 more]</label></div><br/><div class="children"><div class="content">Types do not prove logistical correctness.<p>Imagine a million-line codebase. There are half a dozen suspicious methods with complex sets of if&#x2F;else if&#x2F;else statements. And each of those statements make subsequent method calls.<p>Determining that code path is a nightmare.  Types won&#x27;t save you.</div><br/><div id="38389808" class="c"><input type="checkbox" id="c-38389808" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#38388237">root</a><span>|</span><a href="#38388451">parent</a><span>|</span><a href="#38388366">next</a><span>|</span><label class="collapse" for="c-38389808">[-]</label><label class="expand" for="c-38389808">[1 more]</label></div><br/><div class="children"><div class="content">Do you mean logical?<p>Types absolutely do prove logical correctness. In fact that’s all they do. However they can only prove the correctness of logic that’s type encoded. If your program is a primitive soup, there’s not much logic for them to prove.</div><br/></div></div></div></div><div id="38388366" class="c"><input type="checkbox" id="c-38388366" checked=""/><div class="controls bullet"><span class="by">yen223</span><span>|</span><a href="#38388237">parent</a><span>|</span><a href="#38388451">prev</a><span>|</span><a href="#38389731">next</a><span>|</span><label class="collapse" for="c-38388366">[-]</label><label class="expand" for="c-38388366">[1 more]</label></div><br/><div class="children"><div class="content">I can see this being useful in strongly-typed languages too. There is a massive class of logical bugs that will type-check correctly, that will still result in wrong results being returned.</div><br/></div></div></div></div><div id="38389731" class="c"><input type="checkbox" id="c-38389731" checked=""/><div class="controls bullet"><span class="by">mediumsmart</span><span>|</span><a href="#38388237">prev</a><span>|</span><a href="#38384800">next</a><span>|</span><label class="collapse" for="c-38389731">[-]</label><label class="expand" for="c-38389731">[2 more]</label></div><br/><div class="children"><div class="content">After signup I see a typo in :<p><i>The trace URL will also be outut via the Rails log.</i><p>And the local usage section is hard to read white text on light blue background in this safari browser.</div><br/><div id="38390017" class="c"><input type="checkbox" id="c-38390017" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38389731">parent</a><span>|</span><a href="#38384800">next</a><span>|</span><label class="collapse" for="c-38390017">[-]</label><label class="expand" for="c-38390017">[1 more]</label></div><br/><div class="children"><div class="content">Good catches.  Should be fixed now.</div><br/></div></div></div></div><div id="38384800" class="c"><input type="checkbox" id="c-38384800" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38389731">prev</a><span>|</span><a href="#38388671">next</a><span>|</span><label class="collapse" for="c-38384800">[-]</label><label class="expand" for="c-38384800">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s the client code for those that would like to inspect.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails">https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails</a></div><br/></div></div><div id="38388671" class="c"><input type="checkbox" id="c-38388671" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38384800">prev</a><span>|</span><a href="#38389903">next</a><span>|</span><label class="collapse" for="c-38388671">[-]</label><label class="expand" for="c-38388671">[1 more]</label></div><br/><div class="children"><div class="content">If someone is up for writing a Call Stacking client for the language platform of their choice, please email me.<p>This would be your reference implementation.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails">https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails</a><p>I&#x27;m sure we could work out an arrangement.<p>jim@callstacking.com</div><br/></div></div><div id="38389903" class="c"><input type="checkbox" id="c-38389903" checked=""/><div class="controls bullet"><span class="by">block_dagger</span><span>|</span><a href="#38388671">prev</a><span>|</span><a href="#38386166">next</a><span>|</span><label class="collapse" for="c-38389903">[-]</label><label class="expand" for="c-38389903">[1 more]</label></div><br/><div class="children"><div class="content">Typo on front page: &quot;What&#x27;s does an hour of downtime cost you?&quot;</div><br/></div></div><div id="38386166" class="c"><input type="checkbox" id="c-38386166" checked=""/><div class="controls bullet"><span class="by">theonething</span><span>|</span><a href="#38389903">prev</a><span>|</span><a href="#38389174">next</a><span>|</span><label class="collapse" for="c-38386166">[-]</label><label class="expand" for="c-38386166">[3 more]</label></div><br/><div class="children"><div class="content">This is advertised as a tool for production.  Seems like it would be useful in development too.</div><br/><div id="38386212" class="c"><input type="checkbox" id="c-38386212" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38386166">parent</a><span>|</span><a href="#38389174">next</a><span>|</span><label class="collapse" for="c-38386212">[-]</label><label class="expand" for="c-38386212">[2 more]</label></div><br/><div class="children"><div class="content">And new engineer onboarding.<p>You have a new engineer.  Point them to the Call Stacking dashboard.<p>&quot;Here&#x27;s a list of all of our endpoints for our application.<p>Click on a trace, and you can see the relevant methods for that endpoint and the context in which they are called.&quot;<p>This will get your new engineers up to speed, much quicker.</div><br/><div id="38389411" class="c"><input type="checkbox" id="c-38389411" checked=""/><div class="controls bullet"><span class="by">theonething</span><span>|</span><a href="#38386166">root</a><span>|</span><a href="#38386212">parent</a><span>|</span><a href="#38389174">next</a><span>|</span><label class="collapse" for="c-38389411">[-]</label><label class="expand" for="c-38389411">[1 more]</label></div><br/><div class="children"><div class="content">wow!</div><br/></div></div></div></div></div></div><div id="38389174" class="c"><input type="checkbox" id="c-38389174" checked=""/><div class="controls bullet"><span class="by">maz1b</span><span>|</span><a href="#38386166">prev</a><span>|</span><a href="#38385447">next</a><span>|</span><label class="collapse" for="c-38389174">[-]</label><label class="expand" for="c-38389174">[1 more]</label></div><br/><div class="children"><div class="content">Pretty cool. Not sure what pricing is, seems like it&#x27;s focused for enterprise.</div><br/></div></div><div id="38385447" class="c"><input type="checkbox" id="c-38385447" checked=""/><div class="controls bullet"><span class="by">stevepike</span><span>|</span><a href="#38389174">prev</a><span>|</span><a href="#38389810">next</a><span>|</span><label class="collapse" for="c-38385447">[-]</label><label class="expand" for="c-38385447">[2 more]</label></div><br/><div class="children"><div class="content">How does this work on the backend? Does it only trace method calls when an exception is thrown, or does it profile the call stack of every request?<p>Something I&#x27;ve been interested in is the performance impact of using <a href="https:&#x2F;&#x2F;docs.ruby-lang.org&#x2F;en&#x2F;3.2&#x2F;Coverage.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.ruby-lang.org&#x2F;en&#x2F;3.2&#x2F;Coverage.html</a> to find unused code by profiling production. Particularly using that to figure out any gems that are never called in production. Seems like it could be made fast.</div><br/><div id="38385495" class="c"><input type="checkbox" id="c-38385495" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38385447">parent</a><span>|</span><a href="#38389810">next</a><span>|</span><label class="collapse" for="c-38385495">[-]</label><label class="expand" for="c-38385495">[1 more]</label></div><br/><div class="children"><div class="content">The idea is to turn it on for a given request when needed - via a parameter, feature flag, etc.<p>prepend_around_action :callstacking_setup, if: -&gt; { params[:debug] == &#x27;1&#x27; }<p>Once the request completes, the instrumented methods are removed to remove the performance overhead.</div><br/></div></div></div></div><div id="38389810" class="c"><input type="checkbox" id="c-38389810" checked=""/><div class="controls bullet"><span class="by">n3storm</span><span>|</span><a href="#38385447">prev</a><span>|</span><a href="#38385535">next</a><span>|</span><label class="collapse" for="c-38389810">[-]</label><label class="expand" for="c-38389810">[2 more]</label></div><br/><div class="children"><div class="content">I would love to see this for Laravel.</div><br/><div id="38389954" class="c"><input type="checkbox" id="c-38389954" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38389810">parent</a><span>|</span><a href="#38385535">next</a><span>|</span><label class="collapse" for="c-38389954">[-]</label><label class="expand" for="c-38389954">[1 more]</label></div><br/><div class="children"><div class="content">Let’s write the Laravel client together?<p>jim@callstacking.com</div><br/></div></div></div></div><div id="38385535" class="c"><input type="checkbox" id="c-38385535" checked=""/><div class="controls bullet"><span class="by">ysavir</span><span>|</span><a href="#38389810">prev</a><span>|</span><a href="#38385309">next</a><span>|</span><label class="collapse" for="c-38385535">[-]</label><label class="expand" for="c-38385535">[3 more]</label></div><br/><div class="children"><div class="content">Would this mean that any data I happened to have in memory during the flow now permanently lives in callstacking&#x27;s data stores? How does it handle all the data flowing through from a security perspective?</div><br/><div id="38385676" class="c"><input type="checkbox" id="c-38385676" checked=""/><div class="controls bullet"><span class="by">jxf</span><span>|</span><a href="#38385535">parent</a><span>|</span><a href="#38385635">next</a><span>|</span><label class="collapse" for="c-38385676">[-]</label><label class="expand" for="c-38385676">[1 more]</label></div><br/><div class="children"><div class="content">It respects the normal RoR toolchain parameter filtering, so anything that you say is sensitive (or everything by default, if you&#x27;d like) also doesn&#x27;t get sent to CallStacking.</div><br/></div></div><div id="38385635" class="c"><input type="checkbox" id="c-38385635" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38385535">parent</a><span>|</span><a href="#38385676">prev</a><span>|</span><a href="#38385309">next</a><span>|</span><label class="collapse" for="c-38385635">[-]</label><label class="expand" for="c-38385635">[1 more]</label></div><br/><div class="children"><div class="content">The same filtering mechanism you have in place for your application logs is applied to the argument hash before being sent to the server.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails&#x2F;blob&#x2F;599d4ceeed944a48e69081957d12a653f7d5c669&#x2F;lib&#x2F;callstacking&#x2F;rails&#x2F;instrument&#x2F;base.rb#L16">https:&#x2F;&#x2F;github.com&#x2F;callstacking&#x2F;callstacking-rails&#x2F;blob&#x2F;599d...</a></div><br/></div></div></div></div><div id="38385309" class="c"><input type="checkbox" id="c-38385309" checked=""/><div class="controls bullet"><span class="by">kayodelycaon</span><span>|</span><a href="#38385535">prev</a><span>|</span><a href="#38387251">next</a><span>|</span><label class="collapse" for="c-38385309">[-]</label><label class="expand" for="c-38385309">[2 more]</label></div><br/><div class="children"><div class="content">Some of this already exists to some degree: <a href="https:&#x2F;&#x2F;github.com&#x2F;MiniProfiler&#x2F;rack-mini-profiler">https:&#x2F;&#x2F;github.com&#x2F;MiniProfiler&#x2F;rack-mini-profiler</a></div><br/><div id="38385455" class="c"><input type="checkbox" id="c-38385455" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38385309">parent</a><span>|</span><a href="#38387251">next</a><span>|</span><label class="collapse" for="c-38385455">[-]</label><label class="expand" for="c-38385455">[1 more]</label></div><br/><div class="children"><div class="content">Different emphasis.<p>The goal is to quickly be able to see just the important, executed methods for a given request.<p>E.g. you may have a 2,000-line User model, but Call Stacking allows you to pinpoint, &quot;Oh, only these three methods are actually being called during authentication.  And here are the subsequent calls that those methods make.  And here&#x27;s where the logic change occurred.&quot;</div><br/></div></div></div></div><div id="38387251" class="c"><input type="checkbox" id="c-38387251" checked=""/><div class="controls bullet"><span class="by">mrinterweb</span><span>|</span><a href="#38385309">prev</a><span>|</span><a href="#38389468">next</a><span>|</span><label class="collapse" for="c-38387251">[-]</label><label class="expand" for="c-38387251">[2 more]</label></div><br/><div class="children"><div class="content">How does this product handle sensitive data? I&#x27;m guessing this is not a HIPAA compliant service.</div><br/><div id="38387671" class="c"><input type="checkbox" id="c-38387671" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38387251">parent</a><span>|</span><a href="#38389468">next</a><span>|</span><label class="collapse" for="c-38387671">[-]</label><label class="expand" for="c-38387671">[1 more]</label></div><br/><div class="children"><div class="content">Correct.  The SaaS version is not HIPPAA compliant.<p>On-premise is an option.</div><br/></div></div></div></div><div id="38389468" class="c"><input type="checkbox" id="c-38389468" checked=""/><div class="controls bullet"><span class="by">theonething</span><span>|</span><a href="#38387251">prev</a><span>|</span><a href="#38384984">next</a><span>|</span><label class="collapse" for="c-38389468">[-]</label><label class="expand" for="c-38389468">[1 more]</label></div><br/><div class="children"><div class="content">Does this handle multithreading?</div><br/></div></div><div id="38384984" class="c"><input type="checkbox" id="c-38384984" checked=""/><div class="controls bullet"><span class="by">progne</span><span>|</span><a href="#38389468">prev</a><span>|</span><a href="#38387541">next</a><span>|</span><label class="collapse" for="c-38384984">[-]</label><label class="expand" for="c-38384984">[3 more]</label></div><br/><div class="children"><div class="content">This is a product where the SaaS doesn&#x27;t seem to add much that couldn&#x27;t be done as easily locally, other than monetizing the process.</div><br/><div id="38385124" class="c"><input type="checkbox" id="c-38385124" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38384984">parent</a><span>|</span><a href="#38385830">next</a><span>|</span><label class="collapse" for="c-38385124">[-]</label><label class="expand" for="c-38385124">[1 more]</label></div><br/><div class="children"><div class="content">Disagree.<p>1) In a large-scale production scenario, you typically do not have the data, nor the interaction flow, to reproduce the bug locally.  The idea is that you enable Call Stacking on the fly, when needed.  Turn it off when not needed.<p>2) Having multiple runtime captures of the same endpoint across two different deployments or time periods allows you to quickly compare for logic or data changes (argument values and return values are visible).<p>3) Commenting on individual lines of execution allows for the team to have a specific discussion surrounding logic changes.</div><br/></div></div><div id="38385830" class="c"><input type="checkbox" id="c-38385830" checked=""/><div class="controls bullet"><span class="by">VeejayRampay</span><span>|</span><a href="#38384984">parent</a><span>|</span><a href="#38385124">prev</a><span>|</span><a href="#38387541">next</a><span>|</span><label class="collapse" for="c-38385830">[-]</label><label class="expand" for="c-38385830">[1 more]</label></div><br/><div class="children"><div class="content">local is never really a production environment though</div><br/></div></div></div></div><div id="38387541" class="c"><input type="checkbox" id="c-38387541" checked=""/><div class="controls bullet"><span class="by">saaspirant</span><span>|</span><a href="#38384984">prev</a><span>|</span><a href="#38385047">next</a><span>|</span><label class="collapse" for="c-38387541">[-]</label><label class="expand" for="c-38387541">[3 more]</label></div><br/><div class="children"><div class="content">Does similar tool exist for Django &#x2F; Python?</div><br/><div id="38388675" class="c"><input type="checkbox" id="c-38388675" checked=""/><div class="controls bullet"><span class="by">antod</span><span>|</span><a href="#38387541">parent</a><span>|</span><a href="#38385047">next</a><span>|</span><label class="collapse" for="c-38388675">[-]</label><label class="expand" for="c-38388675">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;werkzeug.palletsprojects.com&#x2F;en&#x2F;3.0.x&#x2F;debug&#x2F;#using-the-debugger" rel="nofollow noreferrer">https:&#x2F;&#x2F;werkzeug.palletsprojects.com&#x2F;en&#x2F;3.0.x&#x2F;debug&#x2F;#using-t...</a> ?<p>Not sure if Django could use it, but used an earlier version in Flask and Pyramid.</div><br/><div id="38388710" class="c"><input type="checkbox" id="c-38388710" checked=""/><div class="controls bullet"><span class="by">antod</span><span>|</span><a href="#38387541">root</a><span>|</span><a href="#38388675">parent</a><span>|</span><a href="#38385047">next</a><span>|</span><label class="collapse" for="c-38388710">[-]</label><label class="expand" for="c-38388710">[1 more]</label></div><br/><div class="children"><div class="content">And by similar to the Rails tool, I mean the functionality, not the intended usecase. Werkzeug is intended for local dev mode only.</div><br/></div></div></div></div></div></div><div id="38384850" class="c"><input type="checkbox" id="c-38384850" checked=""/><div class="controls bullet"><span class="by">CPLX</span><span>|</span><a href="#38385047">prev</a><span>|</span><a href="#38385890">next</a><span>|</span><label class="collapse" for="c-38384850">[-]</label><label class="expand" for="c-38384850">[5 more]</label></div><br/><div class="children"><div class="content">This seems ridiculously useful. What’s the catch?</div><br/><div id="38384927" class="c"><input type="checkbox" id="c-38384927" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38384850">parent</a><span>|</span><a href="#38385158">next</a><span>|</span><label class="collapse" for="c-38384927">[-]</label><label class="expand" for="c-38384927">[2 more]</label></div><br/><div class="children"><div class="content">The instrumentation has a performance overhead.<p>You enable the instrumentation with a prepend_before_action,<p>e.g.<p>prepend_around_action :callstacking_setup, if: -&gt; { params[:debug] == &#x27;1&#x27; }<p>When the request is completed, the instrumented methods are removed (thus removing the overhead).<p>You have to enable it judiciously. But for a problematic request, it will give the entire team a holistic view as to what is really happening for a given request. What methods are called, their calling parameters, and return values, all are given visibility.<p>You no longer have to reconstruct production scenarios piecemeal via the rails console.</div><br/><div id="38389768" class="c"><input type="checkbox" id="c-38389768" checked=""/><div class="controls bullet"><span class="by">dev-ns8</span><span>|</span><a href="#38384850">root</a><span>|</span><a href="#38384927">parent</a><span>|</span><a href="#38385158">next</a><span>|</span><label class="collapse" for="c-38389768">[-]</label><label class="expand" for="c-38389768">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not familiar with rails, so sorry if your reply above inherently answered this.. So you&#x27;re enabling the tracing with a call in your controller method, but how is the tool capturing function params and returned values for sub-calls in the respective controller method?<p>Is it waiting for execution to return to the controller method and polling the stack trace from there?</div><br/></div></div></div></div><div id="38385158" class="c"><input type="checkbox" id="c-38385158" checked=""/><div class="controls bullet"><span class="by">cschneid</span><span>|</span><a href="#38384850">parent</a><span>|</span><a href="#38384927">prev</a><span>|</span><a href="#38384896">next</a><span>|</span><label class="collapse" for="c-38385158">[-]</label><label class="expand" for="c-38385158">[1 more]</label></div><br/><div class="children"><div class="content">as far as I can tell, it only executes the trace when asked. It&#x27;s not an APM like newrelic. Most likely the trace meaningfully slows down the individual request.<p>When I was at ScoutAPM, we built a version of this that was stochastic instead of 100% predictable. We sampled the call stack every 10-50ms. Much lower overhead, and it caught the slower methods, which is quite helpful on its own, especially since slow behavior often isn&#x27;t uniform, it happens on only a small handful of your biggest customers. But it certainly missed many fast executed methods.<p>Different approaches for sure, solve different issues.</div><br/></div></div><div id="38384896" class="c"><input type="checkbox" id="c-38384896" checked=""/><div class="controls bullet"><span class="by">jtokoph</span><span>|</span><a href="#38384850">parent</a><span>|</span><a href="#38385158">prev</a><span>|</span><a href="#38385890">next</a><span>|</span><label class="collapse" for="c-38384896">[-]</label><label class="expand" for="c-38384896">[1 more]</label></div><br/><div class="children"><div class="content">These types of profiling gems usually kill performance</div><br/></div></div></div></div><div id="38385890" class="c"><input type="checkbox" id="c-38385890" checked=""/><div class="controls bullet"><span class="by">berkes</span><span>|</span><a href="#38384850">prev</a><span>|</span><a href="#38385077">next</a><span>|</span><label class="collapse" for="c-38385890">[-]</label><label class="expand" for="c-38385890">[15 more]</label></div><br/><div class="children"><div class="content">The irony is that the issues this helps with <i>could</i> be solved far before production. Compile time, or some local runtime even. Just not in Ruby.<p>Nearly all the issues this shows you quickly are issues that static typing would prevent compile time, or type-hints would show you in dev-time.<p>I&#x27;ve been doing fulltime Rails for 12+ years now, PHP before that, C before that. But always I developed side-gigs in Java, C# and other typed languages and now, finally fulltime over to Rust. They solve this.<p>Before production. You want this solved before production. Really.</div><br/><div id="38386011" class="c"><input type="checkbox" id="c-38386011" checked=""/><div class="controls bullet"><span class="by">aantix</span><span>|</span><a href="#38385890">parent</a><span>|</span><a href="#38386273">next</a><span>|</span><label class="collapse" for="c-38386011">[-]</label><label class="expand" for="c-38386011">[11 more]</label></div><br/><div class="children"><div class="content">Of the bugs that I&#x27;ve experienced in large-scale, Rails production systems, typing is a small subset.<p>Manually reconstructing logistical errors based on a combination of user input and system data, are the most time-consuming issues to diagnose.<p>When your codebase is 500,000+ lines of code, which code paths are relevant for a given endpoint?  What methods were called and under what context?  How do we begin to reconstruct this bug?<p>These are the scenarios for which Call Stacking gives instant visibility to.</div><br/><div id="38386514" class="c"><input type="checkbox" id="c-38386514" checked=""/><div class="controls bullet"><span class="by">philwelch</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386011">parent</a><span>|</span><a href="#38386346">next</a><span>|</span><label class="collapse" for="c-38386514">[-]</label><label class="expand" for="c-38386514">[5 more]</label></div><br/><div class="children"><div class="content">&gt; Of the bugs that I&#x27;ve experienced in large-scale, Rails production systems, typing is a small subset.<p>Really? Are you counting errors where a value turned out to be nil when it wasn’t expected to be? Because that’s a type error. It’s not a type error that many statically typed languages fix (Java is notorious for null pointer exceptions) but it’s a type error that can, in principle, be fixed with static typing.</div><br/><div id="38390699" class="c"><input type="checkbox" id="c-38390699" checked=""/><div class="controls bullet"><span class="by">thih9</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386514">parent</a><span>|</span><a href="#38387532">next</a><span>|</span><label class="collapse" for="c-38390699">[-]</label><label class="expand" for="c-38390699">[1 more]</label></div><br/><div class="children"><div class="content">In this case, I guess you can create some ruby gem&#x2F;library&#x2F;convention&#x2F;dsl&#x2F;architecture that makes it harder to accidentally pass nils - and be more efficient than a popular language that has static typing.<p>I’m writing that to address the “just not in ruby” remark[1] from earlier.<p>[1]: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38385890">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38385890</a></div><br/></div></div><div id="38387532" class="c"><input type="checkbox" id="c-38387532" checked=""/><div class="controls bullet"><span class="by">nicolas_t</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386514">parent</a><span>|</span><a href="#38390699">prev</a><span>|</span><a href="#38386765">next</a><span>|</span><label class="collapse" for="c-38387532">[-]</label><label class="expand" for="c-38387532">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m always surprised by that, I&#x27;ve worked with 10-15 people team on relatively large rails codebase and, yes, the bugs we usually see are not type related bugs (including nil when it&#x27;s not expected). I keep reading people saying that type systems eliminate a huge class of bugs but, it&#x27;s not been my experience with languages that use poor type systems (java, rust... ). Languages that have much better types like OCaml are different and I&#x27;ve had great luck with OCaml in particular (my favorite language to use when I can) but, there&#x27;s also the fact that devs who use ocaml tend to also be much better than average (in the same way that in my experience devs working with php or nodejs exclusively tend to be much worse than average).<p>Note before I&#x27;m downvoted for my last comment, there are exceptions but looking at the average candidate applying for a php, nodejs position compared to one for rails and one for ocaml.</div><br/></div></div><div id="38386765" class="c"><input type="checkbox" id="c-38386765" checked=""/><div class="controls bullet"><span class="by">dlisboa</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386514">parent</a><span>|</span><a href="#38387532">prev</a><span>|</span><a href="#38386346">next</a><span>|</span><label class="collapse" for="c-38386765">[-]</label><label class="expand" for="c-38386765">[2 more]</label></div><br/><div class="children"><div class="content">In the app I work on a huge percentage (60% in the timeframe I analyzed) of the errors are errors a type system would catch. Nil references, long method chains where the middle call returns a different object than expected, bad refactorings changing the return type of methods…<p>It’s staggering really. These could be solved with better programming practices, they’re not errors usually experienced programmers make, but they exist nonetheless.<p>An exception&#x2F;error system, with checked exceptions or handling of errors via result monad&#x2F;errors like in Go, would solve the vast majority of other errors.<p>Type systems also encourage other things like contracts on API endpoints and typed messages, serving as a early warning system when writing those bugs.<p>Purely business logic bugs are actually not common. I guess we haven’t had the opportunity to create those “higher order” bugs while wading through the others.</div><br/><div id="38388260" class="c"><input type="checkbox" id="c-38388260" checked=""/><div class="controls bullet"><span class="by">sethherr</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386765">parent</a><span>|</span><a href="#38386346">next</a><span>|</span><label class="collapse" for="c-38388260">[-]</label><label class="expand" for="c-38388260">[1 more]</label></div><br/><div class="children"><div class="content">Do you have tests?<p>I feel like 60% of the errors I encounter is high for type errors.<p>I also feel like with testing, fixing those errors occupies less than 5% of my debugging time.</div><br/></div></div></div></div></div></div><div id="38386346" class="c"><input type="checkbox" id="c-38386346" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386011">parent</a><span>|</span><a href="#38386514">prev</a><span>|</span><a href="#38386273">next</a><span>|</span><label class="collapse" for="c-38386346">[-]</label><label class="expand" for="c-38386346">[5 more]</label></div><br/><div class="children"><div class="content">Depends on the type system. I would say for Java &#x2F; Python level static types they catch a small but significant fraction of bugs (10-20% according to the only objective measurement I&#x27;ve seen, which is easily worth it). However some languages like Rust, Haskell and OCaml let you express much more in the type system.<p>Subjectively it feels like that catches more like 30-60% of bugs.<p>So this thing is still useful but Berkes is right that you need it a lot less if you use better static types.<p>&gt; which code paths are relevant for a given endpoint?<p>This is exactly the question that static types can answer... statically. You don&#x27;t need a runtime log to find out.<p>You do need a runtime log to see the actual values though. So it&#x27;s not like a debugger is completely useless in Rust. But I definitely reach for it much less than in other languages.</div><br/><div id="38390663" class="c"><input type="checkbox" id="c-38390663" checked=""/><div class="controls bullet"><span class="by">eddtries</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386346">parent</a><span>|</span><a href="#38389405">next</a><span>|</span><label class="collapse" for="c-38390663">[-]</label><label class="expand" for="c-38390663">[1 more]</label></div><br/><div class="children"><div class="content">I worked on a large financial transaction system for up to $7B per day in Haskell that used formal methods like Agda, TLA+, etc, with a lot of logic in the type level (i.e. Liquid Haskell), as a test engineer. The entire system was covered in property based tests, proofs, and then normal tests from unit -&gt; system. We literally had two bugs categorised as P2&#x2F;P1&#x2F;P0 on release, both of which were design related, and both were fixed before users saw them. It was crazy effective (but took years).</div><br/></div></div><div id="38389405" class="c"><input type="checkbox" id="c-38389405" checked=""/><div class="controls bullet"><span class="by">theonething</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38386346">parent</a><span>|</span><a href="#38390663">prev</a><span>|</span><a href="#38386273">next</a><span>|</span><label class="collapse" for="c-38389405">[-]</label><label class="expand" for="c-38389405">[3 more]</label></div><br/><div class="children"><div class="content">&gt; This is exactly the question that static types can answer... statically. You don&#x27;t need a runtime log to find out.<p>This tool seems to be able to display the relevant code paths. That sounds super convenient and useful. Do statically typed languages have tools to do similar?</div><br/><div id="38390381" class="c"><input type="checkbox" id="c-38390381" checked=""/><div class="controls bullet"><span class="by">kikimora</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38389405">parent</a><span>|</span><a href="#38390377">next</a><span>|</span><label class="collapse" for="c-38390381">[-]</label><label class="expand" for="c-38390381">[1 more]</label></div><br/><div class="children"><div class="content">I don’t know if a similar tool exists but in principle Java and .NET has profiling APIs that let you look into method calls. They can be used as a basis for a similar tool.</div><br/></div></div><div id="38390377" class="c"><input type="checkbox" id="c-38390377" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#38385890">root</a><span>|</span><a href="#38389405">parent</a><span>|</span><a href="#38390381">prev</a><span>|</span><a href="#38386273">next</a><span>|</span><label class="collapse" for="c-38390377">[-]</label><label class="expand" for="c-38390377">[1 more]</label></div><br/><div class="children"><div class="content">Yeah &quot;find all references&quot; will show you everything that can call a particular function. As I said it won&#x27;t give you the actual values so this still seems useful.</div><br/></div></div></div></div></div></div></div></div><div id="38386273" class="c"><input type="checkbox" id="c-38386273" checked=""/><div class="controls bullet"><span class="by">rco8786</span><span>|</span><a href="#38385890">parent</a><span>|</span><a href="#38386011">prev</a><span>|</span><a href="#38388000">next</a><span>|</span><label class="collapse" for="c-38386273">[-]</label><label class="expand" for="c-38386273">[1 more]</label></div><br/><div class="children"><div class="content">The number of times I wish I had this tool for my production systems using Java, Kotlin, and Scala is…enormous.<p>Typing is great, I am a fan. But seeing the <i>values</i> that are running through those types is not solved at compile time.</div><br/></div></div><div id="38388000" class="c"><input type="checkbox" id="c-38388000" checked=""/><div class="controls bullet"><span class="by">hartator</span><span>|</span><a href="#38385890">parent</a><span>|</span><a href="#38386273">prev</a><span>|</span><a href="#38388167">next</a><span>|</span><label class="collapse" for="c-38388000">[-]</label><label class="expand" for="c-38388000">[1 more]</label></div><br/><div class="children"><div class="content">I run a large Rails application (<a href="https:&#x2F;&#x2F;serpapi.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;serpapi.com</a>), and the issues that would be solved with the type system would be close to nil.</div><br/></div></div></div></div></div></div></div></div></div></body></html>