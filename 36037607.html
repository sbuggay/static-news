<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1684832454008" as="style"/><link rel="stylesheet" href="styles.css?v=1684832454008"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/ChrisCavs/aimless.js">Show HN: Aimless.js – the missing js randomness library</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>chriscavs</span> | <span>15 comments</span></div><br/><div><div id="36039837" class="c"><input type="checkbox" id="c-36039837" checked=""/><div class="controls bullet"><span class="by">vore</span><span>|</span><a href="#36038985">next</a><span>|</span><label class="collapse" for="c-36039837">[-]</label><label class="expand" for="c-36039837">[2 more]</label></div><br/><div class="children"><div class="content">This is not a uniform distribution:<p><pre><code>  const randIntRange = (i, j, engine = defaultEngine) =&gt; {
    const min = Math.ceil(i)
    const max = Math.floor(j)

    return Math.floor(engine() * (max - min + 1)) + min
  }
</code></pre>
If you assume engine() outputs, say, 64 bits of entropy, any number range that is not an even factor of 2^64 will exhibit intermittent bias where the numbers are rounded.<p>The only correct way to do this is to do rejection sampling: generate an integer x with log2(max - min) bits and if x &gt;= max - min retry until you do:<p><pre><code>  function randBelow(n) {
    const nbits = Math.ceil(Math.log2(n));
    while (true) {
       const x = getRandBits(nbits);
       if (x &lt; n) { return x; }
    }
  }

  function randIntHalfOpenRange(min, max) {
    return min + randBelow(max - min);
  }

  function randIntRange(min, max) {
    return randIntHalfOpenRange(min, max + 1);
  }
</code></pre>
The primitive you want for building distributions on is not to generate a floating point number between 0.0 and 1.0, but to generate an integer of at most x bits.</div><br/><div id="36040539" class="c"><input type="checkbox" id="c-36040539" checked=""/><div class="controls bullet"><span class="by">vore</span><span>|</span><a href="#36039837">parent</a><span>|</span><a href="#36038985">next</a><span>|</span><label class="collapse" for="c-36040539">[-]</label><label class="expand" for="c-36040539">[1 more]</label></div><br/><div class="children"><div class="content">Additionally, the shuffle function (sequence.js) has quadratic complexity due to repeated copying of the input array. You could get a vast performance improvement by copying the input array and running the standard Fisher–Yates shuffle over it: it will both run in linear time and will not thrash cache as much.</div><br/></div></div></div></div><div id="36038985" class="c"><input type="checkbox" id="c-36038985" checked=""/><div class="controls bullet"><span class="by">nonethewiser</span><span>|</span><a href="#36039837">prev</a><span>|</span><a href="#36039410">next</a><span>|</span><label class="collapse" for="c-36038985">[-]</label><label class="expand" for="c-36038985">[1 more]</label></div><br/><div class="children"><div class="content">I was using faker in our codebase at work to generate some random data. I wanted to pick one of a few status codes. I was surprised to see that faker.random was deprecated and the random sample was moved into different datatypes. But the array datatype was deprecated so now there is no random sample from array in faker, seemingly. They say &quot;Use your own function to build complex arrays.&quot; Isn&#x27;t that what faker is all about?<p>Maybe there is good reason for this. I&#x27;m not real familiar with this space. It&#x27;s not so hard to implement something yourself. But I suspect the description of &quot;missing js randomness library&quot; may have some merit.</div><br/></div></div><div id="36039410" class="c"><input type="checkbox" id="c-36039410" checked=""/><div class="controls bullet"><span class="by">EarthLaunch</span><span>|</span><a href="#36038985">prev</a><span>|</span><a href="#36039403">next</a><span>|</span><label class="collapse" for="c-36039410">[-]</label><label class="expand" for="c-36039410">[1 more]</label></div><br/><div class="children"><div class="content">A while back there was a post about a randomness bug in Asheron&#x27;s Call, the &quot;Wi flag&quot; [0].  I posted a comment there and was offered helpful answers about doing weighted randomness [1].<p>This library seems to solve that problem and half a dozen others!  Like: Reading code with functions named for their purpose is better than a string of arithmetic operations in most cases.  Thank you for sharing this!  Will use in my game! [2]<p><pre><code>    const weightedDiceRoll =
    weighted(
        [1,2,3,4,5,6],
        [1,1,1,1,1,10]
    )
    &#x2F;&#x2F; will return 6 much more often than the other options
</code></pre>
0: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34742505" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34742505</a><p>1: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34742985" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34742985</a><p>2: <a href="https:&#x2F;&#x2F;github.com&#x2F;Suncapped&#x2F;babs">https:&#x2F;&#x2F;github.com&#x2F;Suncapped&#x2F;babs</a></div><br/></div></div><div id="36039403" class="c"><input type="checkbox" id="c-36039403" checked=""/><div class="controls bullet"><span class="by">re</span><span>|</span><a href="#36039410">prev</a><span>|</span><a href="#36039035">next</a><span>|</span><label class="collapse" for="c-36039403">[-]</label><label class="expand" for="c-36039403">[3 more]</label></div><br/><div class="children"><div class="content">&quot;The missing JS randomness library&quot; is a provocative subtitle. :) Have you compared your project to Random.js? <a href="https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;random-js" rel="nofollow">https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;random-js</a> There&#x27;s also Rando.js but that project also appears to use a biased algorithm.</div><br/><div id="36039473" class="c"><input type="checkbox" id="c-36039473" checked=""/><div class="controls bullet"><span class="by">EarthLaunch</span><span>|</span><a href="#36039403">parent</a><span>|</span><a href="#36039746">next</a><span>|</span><label class="collapse" for="c-36039473">[-]</label><label class="expand" for="c-36039473">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for mentioning others.  The main thing I love about OP&#x27;s library is the simple, clear naming.  A lot of complexity has been solved for me.<p>Looking at random-js, the barrier to entry is higher. I&#x27;ve looked at randomness libraries and that&#x27;s the feeling they gave me: That I would need to learn how randomness works, rather than just calling a function for what I want; a random int, a weighted random.  Cmd+F &quot;weighted&quot; doesn&#x27;t find anything on both of those projects&#x27; readmes.<p>There&#x27;s a tradeoff for simplicity, but in many cases I&#x27;ll take it.  This is the iPhone of randomness and that&#x27;s what I needed to feel comfortable using it rather than rolling my own.</div><br/></div></div><div id="36039746" class="c"><input type="checkbox" id="c-36039746" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#36039403">parent</a><span>|</span><a href="#36039473">prev</a><span>|</span><a href="#36039035">next</a><span>|</span><label class="collapse" for="c-36039746">[-]</label><label class="expand" for="c-36039746">[1 more]</label></div><br/><div class="children"><div class="content">I was thinking &quot;if there is one feature JS doesn&#x27;t have, it is a missing library&quot;</div><br/></div></div></div></div><div id="36039035" class="c"><input type="checkbox" id="c-36039035" checked=""/><div class="controls bullet"><span class="by">jasonjmcghee</span><span>|</span><a href="#36039403">prev</a><span>|</span><a href="#36041152">next</a><span>|</span><label class="collapse" for="c-36039035">[-]</label><label class="expand" for="c-36039035">[3 more]</label></div><br/><div class="children"><div class="content">I think seeded randomness is wildly underused. It&#x27;s much more often the case I was deterministic randomness rather than based on my system clock.<p>It&#x27;s nice to see aimless.js support it.<p>Crazy to me that `Math.random` doesn&#x27;t accept a seed as an optional param.</div><br/><div id="36040852" class="c"><input type="checkbox" id="c-36040852" checked=""/><div class="controls bullet"><span class="by">gmac</span><span>|</span><a href="#36039035">parent</a><span>|</span><a href="#36039762">next</a><span>|</span><label class="collapse" for="c-36040852">[-]</label><label class="expand" for="c-36040852">[1 more]</label></div><br/><div class="children"><div class="content">Agreed. That’s why I did this (although the Mersenne Twister is probably a rather outdated way to go): <a href="https:&#x2F;&#x2F;github.com&#x2F;jawj&#x2F;mtwist">https:&#x2F;&#x2F;github.com&#x2F;jawj&#x2F;mtwist</a></div><br/></div></div><div id="36039762" class="c"><input type="checkbox" id="c-36039762" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#36039035">parent</a><span>|</span><a href="#36040852">prev</a><span>|</span><a href="#36041152">next</a><span>|</span><label class="collapse" for="c-36039762">[-]</label><label class="expand" for="c-36039762">[1 more]</label></div><br/><div class="children"><div class="content">Yes, the obvious case is machine learning, so that you can make changes and run your program again, and it uses the same batches as so forth.<p>Another case are unit tests with random-generated cases. At a minimum you want to know the seed of the last run and have that reported. On CI system you would want it to be deterministic.<p>Where you want there not to be a seed is in crypto, or possibly a game like poker or even tetris.</div><br/></div></div></div></div><div id="36041152" class="c"><input type="checkbox" id="c-36041152" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36039035">prev</a><span>|</span><a href="#36039357">next</a><span>|</span><label class="collapse" for="c-36041152">[-]</label><label class="expand" for="c-36041152">[1 more]</label></div><br/><div class="children"><div class="content">Whether or not my code will run is all the randomness I need.</div><br/></div></div><div id="36039357" class="c"><input type="checkbox" id="c-36039357" checked=""/><div class="controls bullet"><span class="by">paddw</span><span>|</span><a href="#36041152">prev</a><span>|</span><label class="collapse" for="c-36039357">[-]</label><label class="expand" for="c-36039357">[3 more]</label></div><br/><div class="children"><div class="content">Cool project! Might be nice to include a random permutation method.</div><br/><div id="36039593" class="c"><input type="checkbox" id="c-36039593" checked=""/><div class="controls bullet"><span class="by">shhsshs</span><span>|</span><a href="#36039357">parent</a><span>|</span><a href="#36039377">next</a><span>|</span><label class="collapse" for="c-36039593">[-]</label><label class="expand" for="c-36039593">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    const randomPermutation = arr =&gt; intSequence(0, arr.length - 1).map(i =&gt; arr[i])
    console.log(randomPermutation([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</code></pre></div><br/></div></div><div id="36039377" class="c"><input type="checkbox" id="c-36039377" checked=""/><div class="controls bullet"><span class="by">tantalor</span><span>|</span><a href="#36039357">parent</a><span>|</span><a href="#36039593">prev</a><span>|</span><label class="collapse" for="c-36039377">[-]</label><label class="expand" for="c-36039377">[1 more]</label></div><br/><div class="children"><div class="content">intSequence(min, max, engine)
Returns an array with all integers between min and max in random order.</div><br/></div></div></div></div></div></div></div></div></div></body></html>