<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1738659674228" as="style"/><link rel="stylesheet" href="styles.css?v=1738659674228"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://mill-build.org/blog/7-graal-native-executables.html">Compiling Java into native binaries with Graal and Mill</a> <span class="domain">(<a href="https://mill-build.org">mill-build.org</a>)</span></div><div class="subtext"><span>lihaoyi</span> | <span>35 comments</span></div><br/><div><div id="42929966" class="c"><input type="checkbox" id="c-42929966" checked=""/><div class="controls bullet"><span class="by">dkjaudyeqooe</span><span>|</span><a href="#42906025">next</a><span>|</span><label class="collapse" for="c-42929966">[-]</label><label class="expand" for="c-42929966">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m under the impression that the Community Edition version of GraalVM is neutered by a limited garbage collector and some other limitations when producing native binaries.<p>Anyone know if this true?</div><br/></div></div><div id="42906025" class="c"><input type="checkbox" id="c-42906025" checked=""/><div class="controls bullet"><span class="by">wiradikusuma</span><span>|</span><a href="#42929966">prev</a><span>|</span><a href="#42897464">next</a><span>|</span><label class="collapse" for="c-42906025">[-]</label><label class="expand" for="c-42906025">[9 more]</label></div><br/><div class="children"><div class="content">&quot;Almost every Java program, library, and framework uses some degree of reflection and dynamic classloading, and so you do have to spend the effort to configure Graal appropriately.&quot; -- this is by far the biggest problem with native binary compilation.<p>Imagine spending 15+ minutes building an exe, and it stopping at minute 15 because some things needed to be added in the config. Or, after waiting 30 minutes to have the exe ready, it refused to run because of the same problem.<p>The issue is we don&#x27;t know what we don&#x27;t know. You don&#x27;t &quot;forget to include something&quot; because you don&#x27;t know what to include (and even after seeing the error, you still don&#x27;t lol).<p>I just wished all 3rd party libraries put their &quot;include this config to include my lib in your exe&quot;, just like OSGi manifest (<a href="https:&#x2F;&#x2F;www.ibm.com&#x2F;docs&#x2F;en&#x2F;wasdtfe?topic=overview-osgi-bundles" rel="nofollow">https:&#x2F;&#x2F;www.ibm.com&#x2F;docs&#x2F;en&#x2F;wasdtfe?topic=overview-osgi-bund...</a>).<p>For example, an issue still open for almost 2 years: <a href="https:&#x2F;&#x2F;github.com&#x2F;firebase&#x2F;firebase-admin-java&#x2F;issues&#x2F;800">https:&#x2F;&#x2F;github.com&#x2F;firebase&#x2F;firebase-admin-java&#x2F;issues&#x2F;800</a></div><br/><div id="42929770" class="c"><input type="checkbox" id="c-42929770" checked=""/><div class="controls bullet"><span class="by">tannhaeuser</span><span>|</span><a href="#42906025">parent</a><span>|</span><a href="#42929382">next</a><span>|</span><label class="collapse" for="c-42929770">[-]</label><label class="expand" for="c-42929770">[1 more]</label></div><br/><div class="children"><div class="content">I guess Quarkus and Spring 3 native are meant for bringing existing apps to serverless deployments and fast startup times (plus process-level isolation as an option?), but it&#x27;s true there are also new apps being developed using Quarkus. The investment in tooling, inertia of the ecosystem of third-party libs, and predominance of traditional JIT over AOT deployments must be the reason why they&#x27;re not just doing away with Spring&#x27;s reflection in the first place.</div><br/></div></div><div id="42929382" class="c"><input type="checkbox" id="c-42929382" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#42906025">parent</a><span>|</span><a href="#42929770">prev</a><span>|</span><a href="#42906385">next</a><span>|</span><label class="collapse" for="c-42929382">[-]</label><label class="expand" for="c-42929382">[2 more]</label></div><br/><div class="children"><div class="content">This has been a solved problem since Exclesior JET in the 2000&#x27;s, via agents and PGO, nowadays sadly gone because they no longer can compete with free beer GrallVM and OpenJ9.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Excelsior_JET" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Excelsior_JET</a><p>Also ART takes the best of both worlds, as they quickly learned the best is to have JIT&#x2F;AOT compiler collaborating, thus AOT gets all the reflection related info from the JIT, or Play Store Baseline Profiles and has all it needs to produce a proper AOT binary with the relevant execution flows.<p>To note that Java and .NET to some extent are catching up to Eiffel, Oberon, Smalltalk and Common Lisp toolchains, of a mix JIT&#x2F;AOT, while inovating on their own ways as well.</div><br/><div id="42929880" class="c"><input type="checkbox" id="c-42929880" checked=""/><div class="controls bullet"><span class="by">hn8726</span><span>|</span><a href="#42906025">root</a><span>|</span><a href="#42929382">parent</a><span>|</span><a href="#42906385">next</a><span>|</span><label class="collapse" for="c-42929880">[-]</label><label class="expand" for="c-42929880">[1 more]</label></div><br/><div class="children"><div class="content">I think <a href="https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;8335368" rel="nofollow">https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;8335368</a> and <a href="https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;8325147" rel="nofollow">https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;8325147</a> are two recent JEPs that try to introduce something similar to Google&#x27;s baseline profiles</div><br/></div></div></div></div><div id="42906385" class="c"><input type="checkbox" id="c-42906385" checked=""/><div class="controls bullet"><span class="by">killingtime74</span><span>|</span><a href="#42906025">parent</a><span>|</span><a href="#42929382">prev</a><span>|</span><a href="#42910656">next</a><span>|</span><label class="collapse" for="c-42906385">[-]</label><label class="expand" for="c-42906385">[3 more]</label></div><br/><div class="children"><div class="content">We&#x27;ve been using it at work for a few years. A cli tool, builds in about 6 minutes. We compile it to Linux, Mac ARM and Mac Intel. You&#x27;re correct about configuring libraries but I found those to be the minority. Most work without configuration. I do this because I will not use Golang if given a choice and Rust is not allowed.</div><br/><div id="42907551" class="c"><input type="checkbox" id="c-42907551" checked=""/><div class="controls bullet"><span class="by">Jabihjo</span><span>|</span><a href="#42906025">root</a><span>|</span><a href="#42906385">parent</a><span>|</span><a href="#42910656">next</a><span>|</span><label class="collapse" for="c-42907551">[-]</label><label class="expand" for="c-42907551">[2 more]</label></div><br/><div class="children"><div class="content">What&#x27;s your issue with Golang? (Not hating, just curious)</div><br/><div id="42912487" class="c"><input type="checkbox" id="c-42912487" checked=""/><div class="controls bullet"><span class="by">killingtime74</span><span>|</span><a href="#42906025">root</a><span>|</span><a href="#42907551">parent</a><span>|</span><a href="#42910656">next</a><span>|</span><label class="collapse" for="c-42912487">[-]</label><label class="expand" for="c-42912487">[1 more]</label></div><br/><div class="children"><div class="content">(sorry it&#x27;s probably it an unpopular opinion) the error handling is hard to read, they purposely didn&#x27;t incorporate any syntax sugars and innovations of previous years. They were one of the first popular languages with go routines although Project Loom in Java will soon have preemptive multi threading as well.</div><br/></div></div></div></div></div></div><div id="42910656" class="c"><input type="checkbox" id="c-42910656" checked=""/><div class="controls bullet"><span class="by">jojohohanon</span><span>|</span><a href="#42906025">parent</a><span>|</span><a href="#42906385">prev</a><span>|</span><a href="#42897464">next</a><span>|</span><label class="collapse" for="c-42910656">[-]</label><label class="expand" for="c-42910656">[2 more]</label></div><br/><div class="children"><div class="content">So springboot and injection does a lot of this; searching the list of known classes for a suitable candidate for injection.<p>But it’s dynamic by implementation only; to alleviate what came before which was a tedious manual enumeration in xml of those same discoveries.<p>Presumably we could ask springboot’s discovery to output exactly those finding and the remove the introspection.</div><br/><div id="42929663" class="c"><input type="checkbox" id="c-42929663" checked=""/><div class="controls bullet"><span class="by">mrkeen</span><span>|</span><a href="#42906025">root</a><span>|</span><a href="#42910656">parent</a><span>|</span><a href="#42897464">next</a><span>|</span><label class="collapse" for="c-42929663">[-]</label><label class="expand" for="c-42929663">[1 more]</label></div><br/><div class="children"><div class="content">But to be clear, tedious manual XML configuration was also Spring.  Others may have done it earlier, but Spring still decided it was the way to go, put their name on it, and released it.</div><br/></div></div></div></div></div></div><div id="42897464" class="c"><input type="checkbox" id="c-42897464" checked=""/><div class="controls bullet"><span class="by">p2detar</span><span>|</span><a href="#42906025">prev</a><span>|</span><a href="#42929549">next</a><span>|</span><label class="collapse" for="c-42897464">[-]</label><label class="expand" for="c-42897464">[21 more]</label></div><br/><div class="children"><div class="content">&gt; Graal can only create native binaries targeting the system on which it is running. That means that if you want to create binaries for {Linux,Windows,Mac}x{Intel,ARM}, you need 6 different machines in order to build the 6 binaries and somehow aggregate them together for publication or deployment. This is not a blocker, but can definitely be inconvenient v.s. some other toolchains which allow you to build native binaries for all targets on a single machine.<p>To me this is a huge downside. One of the reasons I like Go so much is that I can build binaries for any platform I want to support on my Mac or with Docker.</div><br/><div id="42928863" class="c"><input type="checkbox" id="c-42928863" checked=""/><div class="controls bullet"><span class="by">rixed</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928464">next</a><span>|</span><label class="collapse" for="c-42928863">[-]</label><label class="expand" for="c-42928863">[3 more]</label></div><br/><div class="children"><div class="content">GCJ could do that, as well as JET I believe, but both are long dead.<p>The history of native compilation for java I find fascinating: Nothing looks like a normal, boring programming language as much as java, yet somehow it resists being treated as a normal, boring programming language, and needs its own galaxy of special idioms and tools, like it was some smalltalk or lisp.</div><br/><div id="42929114" class="c"><input type="checkbox" id="c-42929114" checked=""/><div class="controls bullet"><span class="by">chii</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928863">parent</a><span>|</span><a href="#42928464">next</a><span>|</span><label class="collapse" for="c-42929114">[-]</label><label class="expand" for="c-42929114">[2 more]</label></div><br/><div class="children"><div class="content">because java is not designed for it. It&#x27;s retrofitted in, because of trends.<p>There&#x27;s actually, imho, no need for native compilation for java tbh. Why isn&#x27;t shipping the runtime with the code a more common practise? it&#x27;s how intellij or eclipse worked. People today ship electron apps for god sakes!<p>If you _need_ native, for one reason or another and it&#x27;s non-negotiable, then choose a native compiled language.</div><br/><div id="42929407" class="c"><input type="checkbox" id="c-42929407" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42929114">parent</a><span>|</span><a href="#42928464">next</a><span>|</span><label class="collapse" for="c-42929407">[-]</label><label class="expand" for="c-42929407">[1 more]</label></div><br/><div class="children"><div class="content">Absolutely.<p>&gt; Why isn&#x27;t shipping the runtime with the code a more common practise?<p>Well, Java has jlink which is meant to do exactly that (ship the parts of the JVM you actually need, which is easy to figure out as there are tools to do that), and that&#x27;s the recommended approach today for shipping anything Java.</div><br/></div></div></div></div></div></div><div id="42928464" class="c"><input type="checkbox" id="c-42928464" checked=""/><div class="controls bullet"><span class="by">jeswin</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928863">prev</a><span>|</span><a href="#42928936">next</a><span>|</span><label class="collapse" for="c-42928464">[-]</label><label class="expand" for="c-42928464">[4 more]</label></div><br/><div class="children"><div class="content">&gt; To me this is a huge downside. One of the reasons I like Go<p>C# with NativeAOT might be an easier path for Java developers. Some might like the expressiveness as well over Go.</div><br/><div id="42929424" class="c"><input type="checkbox" id="c-42929424" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928464">parent</a><span>|</span><a href="#42928912">next</a><span>|</span><label class="collapse" for="c-42929424">[-]</label><label class="expand" for="c-42929424">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using Dart instead. Not too far from Java, but can compile to executable without any cerimony.</div><br/></div></div><div id="42928912" class="c"><input type="checkbox" id="c-42928912" checked=""/><div class="controls bullet"><span class="by">pragmatick</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928464">parent</a><span>|</span><a href="#42929424">prev</a><span>|</span><a href="#42928936">next</a><span>|</span><label class="collapse" for="c-42928912">[-]</label><label class="expand" for="c-42928912">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think you&#x27;d be a Java developer anymore.</div><br/><div id="42929542" class="c"><input type="checkbox" id="c-42929542" checked=""/><div class="controls bullet"><span class="by">neonsunset</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928912">parent</a><span>|</span><a href="#42928936">next</a><span>|</span><label class="collapse" for="c-42929542">[-]</label><label class="expand" for="c-42929542">[1 more]</label></div><br/><div class="children"><div class="content">That made me laugh out loud for some reason haha<p>Indeed!</div><br/></div></div></div></div></div></div><div id="42928936" class="c"><input type="checkbox" id="c-42928936" checked=""/><div class="controls bullet"><span class="by">pragmatick</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928464">prev</a><span>|</span><a href="#42928759">next</a><span>|</span><label class="collapse" for="c-42928936">[-]</label><label class="expand" for="c-42928936">[1 more]</label></div><br/><div class="children"><div class="content">While I agree I think most use cases aren&#x27;t for releasing end-user software that needs to run on many architectures and OSes but rather building enterprise software for one certain combination, usually x86 and linux, to deploy on a server or containerized in a hyperscaler.<p>But to contradict myself, I actually use windows, WSL and oracle cloud to build for windows x86, linux x86 and linux ARM64 to build a java desktop application. Of course I&#x27;d prefer it if I could just use my main machine and OS to build all those like Go can.</div><br/></div></div><div id="42928759" class="c"><input type="checkbox" id="c-42928759" checked=""/><div class="controls bullet"><span class="by">flakes</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928936">prev</a><span>|</span><a href="#42928741">next</a><span>|</span><label class="collapse" for="c-42928759">[-]</label><label class="expand" for="c-42928759">[2 more]</label></div><br/><div class="children"><div class="content">I wonder if you could wrap this process in something like qemu for a cross-architecture build setup?</div><br/><div id="42928825" class="c"><input type="checkbox" id="c-42928825" checked=""/><div class="controls bullet"><span class="by">taraparo</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928759">parent</a><span>|</span><a href="#42928741">next</a><span>|</span><label class="collapse" for="c-42928825">[-]</label><label class="expand" for="c-42928825">[1 more]</label></div><br/><div class="children"><div class="content">You can e. g. create ARM builds on x86 using qemu but the compilation takes ages.</div><br/></div></div></div></div><div id="42928741" class="c"><input type="checkbox" id="c-42928741" checked=""/><div class="controls bullet"><span class="by">taurknaut</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928759">prev</a><span>|</span><a href="#42928732">next</a><span>|</span><label class="collapse" for="c-42928741">[-]</label><label class="expand" for="c-42928741">[1 more]</label></div><br/><div class="children"><div class="content">Agreed, this is definitely an odd and very unnecessary constraint on builds.</div><br/></div></div><div id="42928517" class="c"><input type="checkbox" id="c-42928517" checked=""/><div class="controls bullet"><span class="by">cratermoon</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928732">prev</a><span>|</span><a href="#42929620">next</a><span>|</span><label class="collapse" for="c-42928517">[-]</label><label class="expand" for="c-42928517">[7 more]</label></div><br/><div class="children"><div class="content">&gt; this is a huge downside.
Also the compiler can only do static analysis and code generation. I&#x27;d much rather a hotspot VM analyze the running code and identify the optimizations on the fly.</div><br/><div id="42928781" class="c"><input type="checkbox" id="c-42928781" checked=""/><div class="controls bullet"><span class="by">Yasuraka</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928517">parent</a><span>|</span><a href="#42929532">next</a><span>|</span><label class="collapse" for="c-42928781">[-]</label><label class="expand" for="c-42928781">[5 more]</label></div><br/><div class="children"><div class="content">&gt;I&#x27;d much rather a hotspot VM analyze the running code<p>wasting gigabytes of ram and fast startup times<p>&gt;and identify the optimizations on the fly<p>and still get gapped by statically compiled languages.<p>I guess these are a cheap price to pay for the benefit of ... having to install and patch runtimes.</div><br/><div id="42929090" class="c"><input type="checkbox" id="c-42929090" checked=""/><div class="controls bullet"><span class="by">gf000</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928781">parent</a><span>|</span><a href="#42929550">next</a><span>|</span><label class="collapse" for="c-42929090">[-]</label><label class="expand" for="c-42929090">[1 more]</label></div><br/><div class="children"><div class="content">Unused RAM is wasted. If you have plenty available then doing useless memory releases (including dropping&#x2F;destroying objects with RAII, which can end up doing a lot of work in case of a data structure containing other objects that have to be dropped) will just hurt your throughput. Nonetheless, Java has a pretty trivial single flag to set an appropriate heap size if you are not happy with the default.<p>--<p>You are thinking of AOT compiled, but does that AOT language support arbitrary class loading to expand functionality, live observability while taking almost zero overhead for that?<p>--<p>So what do you do if a statically linked library of yours has a vulnerability?</div><br/></div></div><div id="42929550" class="c"><input type="checkbox" id="c-42929550" checked=""/><div class="controls bullet"><span class="by">roncesvalles</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928781">parent</a><span>|</span><a href="#42929090">prev</a><span>|</span><a href="#42928953">next</a><span>|</span><label class="collapse" for="c-42929550">[-]</label><label class="expand" for="c-42929550">[1 more]</label></div><br/><div class="children"><div class="content">There are instances where JVM&#x27;s dynamically optimized code runs faster than equivalent C code compiled to a native binary. The Hotspot JVM is no joke.</div><br/></div></div><div id="42928953" class="c"><input type="checkbox" id="c-42928953" checked=""/><div class="controls bullet"><span class="by">pragmatick</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928781">parent</a><span>|</span><a href="#42929550">prev</a><span>|</span><a href="#42928944">next</a><span>|</span><label class="collapse" for="c-42928953">[-]</label><label class="expand" for="c-42928953">[1 more]</label></div><br/><div class="children"><div class="content">Native Image requires so much more work to have a medium-sized java project properly run when compiled the price gets a lot higher.</div><br/></div></div><div id="42928944" class="c"><input type="checkbox" id="c-42928944" checked=""/><div class="controls bullet"><span class="by">forty</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928781">parent</a><span>|</span><a href="#42928953">prev</a><span>|</span><a href="#42929532">next</a><span>|</span><label class="collapse" for="c-42928944">[-]</label><label class="expand" for="c-42928944">[1 more]</label></div><br/><div class="children"><div class="content">&gt; still get gapped by statically compiled languages.<p>Which statically complicated languages are you referring to? :)</div><br/></div></div></div></div><div id="42929532" class="c"><input type="checkbox" id="c-42929532" checked=""/><div class="controls bullet"><span class="by">tannhaeuser</span><span>|</span><a href="#42897464">root</a><span>|</span><a href="#42928517">parent</a><span>|</span><a href="#42928781">prev</a><span>|</span><a href="#42929620">next</a><span>|</span><label class="collapse" for="c-42929532">[-]</label><label class="expand" for="c-42929532">[1 more]</label></div><br/><div class="children"><div class="content">What&#x27;s your point? This is what the regular JVM&#x2F;HotSpot has been doing for ages (and GraalVM, too). Whereas native-image does AOT, with optional profile-guided optimization to identify hotspots on the fly.</div><br/></div></div></div></div><div id="42929620" class="c"><input type="checkbox" id="c-42929620" checked=""/><div class="controls bullet"><span class="by">ltbarcly3</span><span>|</span><a href="#42897464">parent</a><span>|</span><a href="#42928517">prev</a><span>|</span><a href="#42929549">next</a><span>|</span><label class="collapse" for="c-42929620">[-]</label><label class="expand" for="c-42929620">[1 more]</label></div><br/><div class="children"><div class="content">You realize you can run Linux, Windows, Mac x intel, arm builds on docker right?  Right on your Mac.</div><br/></div></div></div></div><div id="42929549" class="c"><input type="checkbox" id="c-42929549" checked=""/><div class="controls bullet"><span class="by">neonsunset</span><span>|</span><a href="#42897464">prev</a><span>|</span><a href="#42905961">next</a><span>|</span><label class="collapse" for="c-42929549">[-]</label><label class="expand" for="c-42929549">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  dotnet publish &#x2F;p:PublishAot=true
</code></pre>
:)</div><br/></div></div><div id="42905961" class="c"><input type="checkbox" id="c-42905961" checked=""/><div class="controls bullet"><span class="by">theflyinghorse</span><span>|</span><a href="#42929549">prev</a><span>|</span><a href="#42906624">next</a><span>|</span><label class="collapse" for="c-42905961">[-]</label><label class="expand" for="c-42905961">[1 more]</label></div><br/><div class="children"><div class="content">Mill looks like an interesting option to try all around.</div><br/></div></div></div></div></div></div></div></body></html>