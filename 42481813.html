<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1734858060859" as="style"/><link rel="stylesheet" href="styles.css?v=1734858060859"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://openjdk.org/jeps/483">JEP 483: Ahead-of-Time Class Loading and Linking</a> <span class="domain">(<a href="https://openjdk.org">openjdk.org</a>)</span></div><div class="subtext"><span>ptx</span> | <span>13 comments</span></div><br/><div><div id="42485164" class="c"><input type="checkbox" id="c-42485164" checked=""/><div class="controls bullet"><span class="by">fulafel</span><span>|</span><a href="#42484178">next</a><span>|</span><label class="collapse" for="c-42485164">[-]</label><label class="expand" for="c-42485164">[1 more]</label></div><br/><div class="children"><div class="content">What does this mean for Clojure? At least loading the Clojure runtime should benefit, but what about app code loading.</div><br/></div></div><div id="42484178" class="c"><input type="checkbox" id="c-42484178" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#42485164">prev</a><span>|</span><a href="#42483824">next</a><span>|</span><label class="collapse" for="c-42484178">[-]</label><label class="expand" for="c-42484178">[4 more]</label></div><br/><div class="children"><div class="content">The concern that jumps out at me is: what about flags that affect code generation? Some are tied to the subarch (e.g. &quot;does this amd64 have avx2?&quot; - relevant if the cache is backed up and restored to a slightly different machine, or sometimes even if it reboots with a different kernel config), others to java&#x27;s own flags (does compressed pointers affect codegen? disabling intrinsics?).</div><br/><div id="42484220" class="c"><input type="checkbox" id="c-42484220" checked=""/><div class="controls bullet"><span class="by">lxgr</span><span>|</span><a href="#42484178">parent</a><span>|</span><a href="#42483824">next</a><span>|</span><label class="collapse" for="c-42484220">[-]</label><label class="expand" for="c-42484220">[3 more]</label></div><br/><div class="children"><div class="content">I don’t see any mention that code is actually going to be stored in a JITted form, so possibly it’s just architecture-independent loading and linking data being cached?</div><br/><div id="42484385" class="c"><input type="checkbox" id="c-42484385" checked=""/><div class="controls bullet"><span class="by">MBCook</span><span>|</span><a href="#42484178">root</a><span>|</span><a href="#42484220">parent</a><span>|</span><a href="#42483824">next</a><span>|</span><label class="collapse" for="c-42484385">[-]</label><label class="expand" for="c-42484385">[2 more]</label></div><br/><div class="children"><div class="content">My impression from reading this was it was about knowing which classes reference which other classes when and which jars everything is in.<p>So I think you’re right.<p>So a bit more linker style optimization than compiler related caching stuff.</div><br/><div id="42485022" class="c"><input type="checkbox" id="c-42485022" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#42484178">root</a><span>|</span><a href="#42484385">parent</a><span>|</span><a href="#42483824">next</a><span>|</span><label class="collapse" for="c-42485022">[-]</label><label class="expand" for="c-42485022">[1 more]</label></div><br/><div class="children"><div class="content">The JEP explains what this does:<p>&quot;The AOT cache builds upon CDS by not only reading and parsing class files ahead-of-time but also loading and linking them.&quot;<p>While CDS (which has been available for years now) only caches a parsed form of the class files that got loaded by the application, the AOT cache will also &quot;load and link&quot; the classes.<p>The ClassLoader.load method docs explain what loading means: <a href="https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;java&#x2F;javase&#x2F;21&#x2F;docs&#x2F;api&#x2F;java.base&#x2F;java&#x2F;lang&#x2F;ClassLoader.html#loadClass(java.lang.String,boolean)" rel="nofollow">https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;java&#x2F;javase&#x2F;21&#x2F;docs&#x2F;api&#x2F;java.base...</a><p>1. find the class (usually by looking at the file-index of the jar, which is just a zip archive, but ClassLoaders can implement this in many ways).<p>2. link the class, which is done by the resolveClass method: <a href="https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;java&#x2F;javase&#x2F;21&#x2F;docs&#x2F;api&#x2F;java.base&#x2F;java&#x2F;lang&#x2F;ClassLoader.html#resolveClass(java.lang.Class)" rel="nofollow">https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;java&#x2F;javase&#x2F;21&#x2F;docs&#x2F;api&#x2F;java.base...</a> and explained in the Java Language Specification: <a href="https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jls&#x2F;se21&#x2F;html&#x2F;jls-12.html#jls-12.3" rel="nofollow">https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jls&#x2F;se21&#x2F;html&#x2F;jls-12.ht...</a><p>&quot;Three different activities are involved in linking: verification, preparation, and resolution of symbolic references.&quot;<p>Hence, I assume the AOT cache will somehow keep even symbolic references between classes, which is quite interesting.</div><br/></div></div></div></div></div></div></div></div><div id="42483824" class="c"><input type="checkbox" id="c-42483824" checked=""/><div class="controls bullet"><span class="by">petesoper</span><span>|</span><a href="#42484178">prev</a><span>|</span><a href="#42483966">next</a><span>|</span><label class="collapse" for="c-42483824">[-]</label><label class="expand" for="c-42483824">[1 more]</label></div><br/><div class="children"><div class="content">Sweet!</div><br/></div></div><div id="42483966" class="c"><input type="checkbox" id="c-42483966" checked=""/><div class="controls bullet"><span class="by">foolfoolz</span><span>|</span><a href="#42483824">prev</a><span>|</span><a href="#42483977">next</a><span>|</span><label class="collapse" for="c-42483966">[-]</label><label class="expand" for="c-42483966">[2 more]</label></div><br/><div class="children"><div class="content">i’m curious if any of this was inspired from aws lambda snapstart</div><br/><div id="42484010" class="c"><input type="checkbox" id="c-42484010" checked=""/><div class="controls bullet"><span class="by">layer8</span><span>|</span><a href="#42483966">parent</a><span>|</span><a href="#42483977">next</a><span>|</span><label class="collapse" for="c-42484010">[-]</label><label class="expand" for="c-42484010">[1 more]</label></div><br/><div class="children"><div class="content">Maybe read the <i>History</i> section.</div><br/></div></div></div></div><div id="42483977" class="c"><input type="checkbox" id="c-42483977" checked=""/><div class="controls bullet"><span class="by">layer8</span><span>|</span><a href="#42483966">prev</a><span>|</span><label class="collapse" for="c-42483977">[-]</label><label class="expand" for="c-42483977">[4 more]</label></div><br/><div class="children"><div class="content">&gt; [example hello world] program runs in 0.031 seconds on JDK 23. After doing the small amount of additional work required to create an AOT cache it runs in in 0.018 seconds on JDK NN — an improvement of 42%. The AOT cache occupies 11.4 megabytes.<p>That’s not immediately convincing that it will be worth it. It is a start I guess.</div><br/><div id="42484512" class="c"><input type="checkbox" id="c-42484512" checked=""/><div class="controls bullet"><span class="by">dgfitz</span><span>|</span><a href="#42483977">parent</a><span>|</span><label class="collapse" for="c-42484512">[-]</label><label class="expand" for="c-42484512">[3 more]</label></div><br/><div class="children"><div class="content">How so?<p>RAM is almost free if you’re not on embedded, and embedded could run Java sure, but it isn’t common.</div><br/><div id="42484682" class="c"><input type="checkbox" id="c-42484682" checked=""/><div class="controls bullet"><span class="by">pdpi</span><span>|</span><a href="#42483977">root</a><span>|</span><a href="#42484512">parent</a><span>|</span><label class="collapse" for="c-42484682">[-]</label><label class="expand" for="c-42484682">[2 more]</label></div><br/><div class="children"><div class="content">That’s not an in-memory cache either. AIUI it’s storing those artefacts to disk</div><br/><div id="42485148" class="c"><input type="checkbox" id="c-42485148" checked=""/><div class="controls bullet"><span class="by">lmz</span><span>|</span><a href="#42483977">root</a><span>|</span><a href="#42484682">parent</a><span>|</span><label class="collapse" for="c-42485148">[-]</label><label class="expand" for="c-42485148">[1 more]</label></div><br/><div class="children"><div class="content">Container sizes may be affected though.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>