<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1693386064689" as="style"/><link rel="stylesheet" href="styles.css?v=1693386064689"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://flak.tedunangst.com/post/doas">Doas – dedicated OpenBSD application subexecutor</a> <span class="domain">(<a href="https://flak.tedunangst.com">flak.tedunangst.com</a>)</span></div><div class="subtext"><span>osener</span> | <span>34 comments</span></div><br/><div><div id="37314973" class="c"><input type="checkbox" id="c-37314973" checked=""/><div class="controls bullet"><span class="by">1vuio0pswjnm7</span><span>|</span><a href="#37316452">next</a><span>|</span><label class="collapse" for="c-37314973">[-]</label><label class="expand" for="c-37314973">[4 more]</label></div><br/><div class="children"><div class="content">And before there was &quot;doas&quot; there was setuidgid and envuidgid.<p><a href="https:&#x2F;&#x2F;cr.yp.to&#x2F;daemontools&#x2F;setuidgid.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;cr.yp.to&#x2F;daemontools&#x2F;setuidgid.html</a><p><a href="https:&#x2F;&#x2F;cr.yp.to&#x2F;daemontools&#x2F;envuidgid.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;cr.yp.to&#x2F;daemontools&#x2F;envuidgid.html</a></div><br/><div id="37317611" class="c"><input type="checkbox" id="c-37317611" checked=""/><div class="controls bullet"><span class="by">lemper</span><span>|</span><a href="#37314973">parent</a><span>|</span><a href="#37316452">next</a><span>|</span><label class="collapse" for="c-37317611">[-]</label><label class="expand" for="c-37317611">[3 more]</label></div><br/><div class="children"><div class="content">doas is much much nicer to type to, though.</div><br/></div></div></div></div><div id="37316452" class="c"><input type="checkbox" id="c-37316452" checked=""/><div class="controls bullet"><span class="by">e12e</span><span>|</span><a href="#37314973">prev</a><span>|</span><a href="#37314915">next</a><span>|</span><label class="collapse" for="c-37316452">[-]</label><label class="expand" for="c-37316452">[1 more]</label></div><br/><div class="children"><div class="content">(2015)?<p>Ed: previously <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=9914693">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=9914693</a></div><br/></div></div><div id="37314915" class="c"><input type="checkbox" id="c-37314915" checked=""/><div class="controls bullet"><span class="by">irdc</span><span>|</span><a href="#37316452">prev</a><span>|</span><a href="#37317998">next</a><span>|</span><label class="collapse" for="c-37314915">[-]</label><label class="expand" for="c-37314915">[8 more]</label></div><br/><div class="children"><div class="content">For those whose muscle memory is all confused now there&#x27;s OpenDoas: <a href="https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas">https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas</a></div><br/><div id="37317970" class="c"><input type="checkbox" id="c-37317970" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#37314915">parent</a><span>|</span><a href="#37315237">next</a><span>|</span><label class="collapse" for="c-37317970">[-]</label><label class="expand" for="c-37317970">[2 more]</label></div><br/><div class="children"><div class="content">OpenDOAS has actually had the OpenBSD-specific code removed (<a href="https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas&#x2F;commit&#x2F;74449f015ff7a72300be5a27680d2c70af309328">https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas&#x2F;commit&#x2F;74449f015ff7a7230...</a>), and replaces some of the doas mechanisms that rely upon OpenBSD to work with sudo-like flag files and suchlike.<p>There are, moreover, 2 ports of doas to other systems.  OpenDOAS is one.  Jesse Smith&#x27;s <a href="https:&#x2F;&#x2F;github.com&#x2F;slicer69&#x2F;doas">https:&#x2F;&#x2F;github.com&#x2F;slicer69&#x2F;doas</a> is the other.  The latter retains the OpenBSD-specific code, and is the more portable of the two at the expense of only doing everything that the tool is capable of when actually built on OpenBSD.</div><br/><div id="37318415" class="c"><input type="checkbox" id="c-37318415" checked=""/><div class="controls bullet"><span class="by">5e92cb50239222b</span><span>|</span><a href="#37314915">root</a><span>|</span><a href="#37317970">parent</a><span>|</span><a href="#37315237">next</a><span>|</span><label class="collapse" for="c-37318415">[-]</label><label class="expand" for="c-37318415">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;π.duncano.de&#x2F;slicer69-doas.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;xn--1xa.duncano.de&#x2F;slicer69-doas.html</a></div><br/></div></div></div></div><div id="37315237" class="c"><input type="checkbox" id="c-37315237" checked=""/><div class="controls bullet"><span class="by">chungy</span><span>|</span><a href="#37314915">parent</a><span>|</span><a href="#37317970">prev</a><span>|</span><a href="#37314994">next</a><span>|</span><label class="collapse" for="c-37315237">[-]</label><label class="expand" for="c-37315237">[1 more]</label></div><br/><div class="children"><div class="content">Most use cases can be paved over with alias. &quot;alias sudo=doas&quot; or &quot;alias doas=sudo&quot;</div><br/></div></div><div id="37314994" class="c"><input type="checkbox" id="c-37314994" checked=""/><div class="controls bullet"><span class="by">CameronNemo</span><span>|</span><a href="#37314915">parent</a><span>|</span><a href="#37315237">prev</a><span>|</span><a href="#37317998">next</a><span>|</span><label class="collapse" for="c-37314994">[-]</label><label class="expand" for="c-37314994">[4 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand the muscle memory relevance?</div><br/><div id="37315036" class="c"><input type="checkbox" id="c-37315036" checked=""/><div class="controls bullet"><span class="by">irdc</span><span>|</span><a href="#37314915">root</a><span>|</span><a href="#37314994">parent</a><span>|</span><a href="#37317998">next</a><span>|</span><label class="collapse" for="c-37315036">[-]</label><label class="expand" for="c-37315036">[3 more]</label></div><br/><div class="children"><div class="content">I can’t be the only one who started typing ‘doas’ on Linux&#x2F;MacOS and ‘sudo’ on OpenBSD.</div><br/><div id="37317382" class="c"><input type="checkbox" id="c-37317382" checked=""/><div class="controls bullet"><span class="by">nvy</span><span>|</span><a href="#37314915">root</a><span>|</span><a href="#37315036">parent</a><span>|</span><a href="#37317998">next</a><span>|</span><label class="collapse" for="c-37317382">[-]</label><label class="expand" for="c-37317382">[2 more]</label></div><br/><div class="children"><div class="content">I just live dangerously and use `su -`</div><br/><div id="37318647" class="c"><input type="checkbox" id="c-37318647" checked=""/><div class="controls bullet"><span class="by">msh</span><span>|</span><a href="#37314915">root</a><span>|</span><a href="#37317382">parent</a><span>|</span><a href="#37317998">next</a><span>|</span><label class="collapse" for="c-37318647">[-]</label><label class="expand" for="c-37318647">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not living dangerously. Real men login as root (and cry).</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37317998" class="c"><input type="checkbox" id="c-37317998" checked=""/><div class="controls bullet"><span class="by">tiffanyh</span><span>|</span><a href="#37314915">prev</a><span>|</span><a href="#37315776">next</a><span>|</span><label class="collapse" for="c-37317998">[-]</label><label class="expand" for="c-37317998">[1 more]</label></div><br/><div class="children"><div class="content">Off topic:<p>Love OpenBSD.<p>Wish so much Hammer2 comes to it because OpenBSD innovates so much but their file system is lacking.<p>There is an attempt to port DragonflyBDS Hammer2, and hope OpenBSD accepts it.<p>Last updated 3-days ago.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;kusumi&#x2F;openbsd_hammer2">https:&#x2F;&#x2F;github.com&#x2F;kusumi&#x2F;openbsd_hammer2</a></div><br/></div></div><div id="37315776" class="c"><input type="checkbox" id="c-37315776" checked=""/><div class="controls bullet"><span class="by">1attice</span><span>|</span><a href="#37317998">prev</a><span>|</span><a href="#37316172">next</a><span>|</span><label class="collapse" for="c-37315776">[-]</label><label class="expand" for="c-37315776">[5 more]</label></div><br/><div class="children"><div class="content">I was initially skeptical but the superior simplicity and rigor won me over.<p>protip: nixos lets you use doas instead of (or in addition to) sudo. Since i run obsd serverside and nixos on the edge, this works great for me<p>programs.doas.enable = true;</div><br/><div id="37316147" class="c"><input type="checkbox" id="c-37316147" checked=""/><div class="controls bullet"><span class="by">jamal-kumar</span><span>|</span><a href="#37315776">parent</a><span>|</span><a href="#37317991">next</a><span>|</span><label class="collapse" for="c-37316147">[-]</label><label class="expand" for="c-37316147">[3 more]</label></div><br/><div class="children"><div class="content">I have no problem with doas on debian or arch through a package either.<p>Many sudo policies are often kind of horrible (even by default) and often facilitate privilege escalation, and then there was CVE-2019-14287 ( &lt; 1.8.28 ) and CVE-2021-3156 ( &lt; 1.9.5p2 ) which were plenty nasty. It&#x27;s just way too huge for a setuid program, security tools shouldn&#x27;t represent security holes as best as we can get away with it.<p>[1] <a href="https:&#x2F;&#x2F;www.thehacker.recipes&#x2F;infra&#x2F;privilege-escalation&#x2F;unix&#x2F;sudo" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.thehacker.recipes&#x2F;infra&#x2F;privilege-escalation&#x2F;uni...</a></div><br/><div id="37316341" class="c"><input type="checkbox" id="c-37316341" checked=""/><div class="controls bullet"><span class="by">1attice</span><span>|</span><a href="#37315776">root</a><span>|</span><a href="#37316147">parent</a><span>|</span><a href="#37317991">next</a><span>|</span><label class="collapse" for="c-37316341">[-]</label><label class="expand" for="c-37316341">[2 more]</label></div><br/><div class="children"><div class="content">precisely this.</div><br/><div id="37316515" class="c"><input type="checkbox" id="c-37316515" checked=""/><div class="controls bullet"><span class="by">jamal-kumar</span><span>|</span><a href="#37315776">root</a><span>|</span><a href="#37316341">parent</a><span>|</span><a href="#37317991">next</a><span>|</span><label class="collapse" for="c-37316515">[-]</label><label class="expand" for="c-37316515">[1 more]</label></div><br/><div class="children"><div class="content">Opendoas isn&#x27;t immune to security problems, either, [1] but I try to have a policy of trying to use smaller programs and libraries of higher quality and sudo just isn&#x27;t fitting the bill here. In production systems neither really needs to be installed&#x2F;enabled (especially just to faciliate a local user to do whatever root can do), and su does just fine for administration tasks as long as you don&#x27;t do something stupid like leave it logged in on tmux.<p>[1] <a href="https:&#x2F;&#x2F;nvd.nist.gov&#x2F;vuln&#x2F;detail&#x2F;CVE-2019-15901" rel="nofollow noreferrer">https:&#x2F;&#x2F;nvd.nist.gov&#x2F;vuln&#x2F;detail&#x2F;CVE-2019-15901</a></div><br/></div></div></div></div></div></div><div id="37317991" class="c"><input type="checkbox" id="c-37317991" checked=""/><div class="controls bullet"><span class="by">sdeer</span><span>|</span><a href="#37315776">parent</a><span>|</span><a href="#37316147">prev</a><span>|</span><a href="#37316172">next</a><span>|</span><label class="collapse" for="c-37317991">[-]</label><label class="expand" for="c-37317991">[1 more]</label></div><br/><div class="children"><div class="content">Even better, add doas-sudo-shim to your system packages and disable sudo:<p><pre><code>  security = {
    doas.enable = true;
    sudo.enable = false;
  };

  environment.systemPackages = [ pkgs.doas-sudo-shim ];</code></pre></div><br/></div></div></div></div><div id="37316172" class="c"><input type="checkbox" id="c-37316172" checked=""/><div class="controls bullet"><span class="by">ggm</span><span>|</span><a href="#37315776">prev</a><span>|</span><a href="#37316445">next</a><span>|</span><label class="collapse" for="c-37316172">[-]</label><label class="expand" for="c-37316172">[10 more]</label></div><br/><div class="children"><div class="content">is this actually going to wind up stopping Sudo bash or is this &quot;if you use it right you don&#x27;t need to&quot; which is a euphemism for &quot;yea but everyone does&quot;</div><br/><div id="37319275" class="c"><input type="checkbox" id="c-37319275" checked=""/><div class="controls bullet"><span class="by">marcthe12</span><span>|</span><a href="#37316172">parent</a><span>|</span><a href="#37316516">next</a><span>|</span><label class="collapse" for="c-37319275">[-]</label><label class="expand" for="c-37319275">[1 more]</label></div><br/><div class="children"><div class="content">The main thing missing is sudoedit equivalent. That replaces doas vi which is a security whole</div><br/></div></div><div id="37316516" class="c"><input type="checkbox" id="c-37316516" checked=""/><div class="controls bullet"><span class="by">11Spades</span><span>|</span><a href="#37316172">parent</a><span>|</span><a href="#37319275">prev</a><span>|</span><a href="#37316743">next</a><span>|</span><label class="collapse" for="c-37316516">[-]</label><label class="expand" for="c-37316516">[2 more]</label></div><br/><div class="children"><div class="content">Anecdotal, but I&#x27;ve been using the doas in Arch&#x27;s repository since switching to it. So far, I haven&#x27;t come across anything that <i>requires</i> sudo instead of doas.</div><br/><div id="37318017" class="c"><input type="checkbox" id="c-37318017" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37316516">parent</a><span>|</span><a href="#37316743">next</a><span>|</span><label class="collapse" for="c-37318017">[-]</label><label class="expand" for="c-37318017">[1 more]</label></div><br/><div class="children"><div class="content">There are actually 2 Arch doases, note, one in the AUR and one in core.  One is OpenDOAS, the other Smith doas.</div><br/></div></div></div></div><div id="37316743" class="c"><input type="checkbox" id="c-37316743" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#37316172">parent</a><span>|</span><a href="#37316516">prev</a><span>|</span><a href="#37316445">next</a><span>|</span><label class="collapse" for="c-37316743">[-]</label><label class="expand" for="c-37316743">[6 more]</label></div><br/><div class="children"><div class="content">Doubt it.  The one thing doas is missing (from my POV) is caching the authorization.  Sudo will allow you to cache the authorization on every(?) platform, but doas will only allow this on OpenBSD.  If you&#x27;re running &quot;sudo bash&quot; to avoid reentering your password a million times, doas (likely) won&#x27;t help.<p>However if you&#x27;re running &quot;sudo bash&quot;, you should probably consider setting the root shell appropriately and just use &quot;sudo -l&quot;.</div><br/><div id="37317186" class="c"><input type="checkbox" id="c-37317186" checked=""/><div class="controls bullet"><span class="by">somat</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37316743">parent</a><span>|</span><a href="#37317026">next</a><span>|</span><label class="collapse" for="c-37317186">[-]</label><label class="expand" for="c-37317186">[2 more]</label></div><br/><div class="children"><div class="content">This is actually an interesting case. Openbsd implemented timing out the connection by adding it to the tty[1]. this sort of shenanigan would never fly on linux, &quot;what! improve an unrelated established system, I don&#x27;t think so.&quot; So for a long time doas on linux was not able to timeout a session. At some later point the timeout code was re-implemented on linux using a different mechanism[2].<p>If your linux doas does not timeout, try updating it?<p>1. <a href="http:&#x2F;&#x2F;man.openbsd.org&#x2F;tty.4#TIOCSETVERAUTH" rel="nofollow noreferrer">http:&#x2F;&#x2F;man.openbsd.org&#x2F;tty.4#TIOCSETVERAUTH</a><p>2. <a href="https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas&#x2F;blob&#x2F;master&#x2F;timestamp.c">https:&#x2F;&#x2F;github.com&#x2F;Duncaen&#x2F;OpenDoas&#x2F;blob&#x2F;master&#x2F;timestamp.c</a></div><br/><div id="37317809" class="c"><input type="checkbox" id="c-37317809" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37317186">parent</a><span>|</span><a href="#37317026">next</a><span>|</span><label class="collapse" for="c-37317809">[-]</label><label class="expand" for="c-37317809">[1 more]</label></div><br/><div class="children"><div class="content">Well my use case was DragonFly and FreeBSD where there is a version of doas available, but not opendoas.</div><br/></div></div></div></div><div id="37317026" class="c"><input type="checkbox" id="c-37317026" checked=""/><div class="controls bullet"><span class="by">xcdzvyn</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37316743">parent</a><span>|</span><a href="#37317186">prev</a><span>|</span><a href="#37316445">next</a><span>|</span><label class="collapse" for="c-37317026">[-]</label><label class="expand" for="c-37317026">[3 more]</label></div><br/><div class="children"><div class="content">OpenDoas has opt-in persistence via the --with-timestamp build flag. And on NixOS, for example, it&#x27;s built with this flag by default.</div><br/><div id="37317174" class="c"><input type="checkbox" id="c-37317174" checked=""/><div class="controls bullet"><span class="by">toastal</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37317026">parent</a><span>|</span><a href="#37316445">next</a><span>|</span><label class="collapse" for="c-37317174">[-]</label><label class="expand" for="c-37317174">[2 more]</label></div><br/><div class="children"><div class="content">Thanks for providing NixOS commentary. I’d was leery something in Nix would break, so I never tried.</div><br/><div id="37317543" class="c"><input type="checkbox" id="c-37317543" checked=""/><div class="controls bullet"><span class="by">xcdzvyn</span><span>|</span><a href="#37316172">root</a><span>|</span><a href="#37317174">parent</a><span>|</span><a href="#37316445">next</a><span>|</span><label class="collapse" for="c-37317543">[-]</label><label class="expand" for="c-37317543">[1 more]</label></div><br/><div class="children"><div class="content">No problem. FWIW I use doas over sudo on all 3 of my Nix hosts and I&#x27;ve only ever had one issue - VeraCrypt has a hardcoded shell-out to sudo, so I can&#x27;t use it.<p>The proper fix would be VeraCrypt implementing polkit, but I just use  cryptsetup&#x27;s implementation.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37316445" class="c"><input type="checkbox" id="c-37316445" checked=""/><div class="controls bullet"><span class="by">BrotherBisquick</span><span>|</span><a href="#37316172">prev</a><span>|</span><a href="#37315196">next</a><span>|</span><label class="collapse" for="c-37316445">[-]</label><label class="expand" for="c-37316445">[2 more]</label></div><br/><div class="children"><div class="content">Does doas have equivalents to the -i and -E flags in sudo? I use both of those frequently.</div><br/><div id="37319136" class="c"><input type="checkbox" id="c-37319136" checked=""/><div class="controls bullet"><span class="by">tlamponi</span><span>|</span><a href="#37316445">parent</a><span>|</span><a href="#37315196">next</a><span>|</span><label class="collapse" for="c-37319136">[-]</label><label class="expand" for="c-37319136">[1 more]</label></div><br/><div class="children"><div class="content">I switched from sudo to doas when setting up my new laptop ~ two years ago, took some time to get accustomed, but it is really much simpler..<p>For `sudo -i` you can just use `doas -s`.
<a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;opendoas&#x2F;doas.1.en.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;opendoas&#x2F;doas.1.en.html</a><p>Keeping the environment via `sudo -E` is slightly trickier.
If you need that for a fixed set of commands you can enable keeping the environment for those explicitly via the configuration file using the `keepenv` option. You can also set specific variables for specific commands,<p><a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;opendoas&#x2F;doas.conf.5.en.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;opendoas&#x2F;doas.conf.5.en...</a><p>But you would need to use a workaround if you want to keep the environment for a command without always adding that to the configuration, one way would to add a wrapper executable and add a permanent rule for that, e.g. something like the following should work:<p><pre><code>  # reuse the `env` tool, but use an explicit symlink to have clear boundaries
  ln -s &#x2F;bin&#x2F;env &#x2F;bin&#x2F;keep-env
  
  # add rule for keep-env to doas cfg, replace USER with your user name, or prefix with : for a group
  echo &#x27;permit persist keepenv USER cmd &#x2F;bin&#x2F;keep-env&#x27; | tee -a &#x2F;etc&#x2F;doas.conf
  
  # run command
  doas keep-env THE-ACTUAL-COMMAND
</code></pre>
Disclaimer, not deeply tested and there might be even better options, but FWIW, this workaround is at least quite simple in principle.</div><br/></div></div></div></div><div id="37315196" class="c"><input type="checkbox" id="c-37315196" checked=""/><div class="controls bullet"><span class="by">lacoolj</span><span>|</span><a href="#37316445">prev</a><span>|</span><label class="collapse" for="c-37315196">[-]</label><label class="expand" for="c-37315196">[2 more]</label></div><br/><div class="children"><div class="content">Am I seeing the page correctly or someone get hacked?<p>&quot;that&#x27;s some bullshit&quot;<p>I assume someone just doesn&#x27;t like that OpenBSD does something other than sudo (which you can actually use either)?</div><br/><div id="37315984" class="c"><input type="checkbox" id="c-37315984" checked=""/><div class="controls bullet"><span class="by">amatecha</span><span>|</span><a href="#37315196">parent</a><span>|</span><label class="collapse" for="c-37315984">[-]</label><label class="expand" for="c-37315984">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t see that text anywhere on the page??</div><br/></div></div></div></div></div></div></div></div></div></body></html>