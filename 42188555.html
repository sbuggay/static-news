<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1732093259552" as="style"/><link rel="stylesheet" href="styles.css?v=1732093259552"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://docs.astral.sh/uv/guides/integration/pytorch/">Using uv with PyTorch</a> <span class="domain">(<a href="https://docs.astral.sh">docs.astral.sh</a>)</span></div><div class="subtext"><span>charliermarsh</span> | <span>32 comments</span></div><br/><div><div id="42190458" class="c"><input type="checkbox" id="c-42190458" checked=""/><div class="controls bullet"><span class="by">thundergolfer</span><span>|</span><a href="#42191858">next</a><span>|</span><label class="collapse" for="c-42190458">[-]</label><label class="expand" for="c-42190458">[5 more]</label></div><br/><div class="children"><div class="content">Kind of an aside as this doc is about the complexities of installing particular PyTorch versions, but will say that uv is <i>way</i> faster at installing PyTorch than pip.<p>We run internal benchmarks of our custom container image builder and in the &#x27;install torch&#x27; benchmark the p50 time saved when using `uv` is 25 seconds! (71.4s vs. 43.74s)<p>---<p>Aside 2: Seems there&#x27;s a missing &quot;involves&quot; in this sentence:  &quot;As such, installing PyTorch typically often configuring a project to use the PyTorch index.&quot;</div><br/><div id="42191116" class="c"><input type="checkbox" id="c-42191116" checked=""/><div class="controls bullet"><span class="by">cik</span><span>|</span><a href="#42190458">parent</a><span>|</span><a href="#42191858">next</a><span>|</span><label class="collapse" for="c-42191116">[-]</label><label class="expand" for="c-42191116">[4 more]</label></div><br/><div class="children"><div class="content">Joining your aside to tout the benefits of uv. We use uv combined with a simple proxy I wrote, to cache python dependencies, and then install them in parallel. UV also makes it simple to regenerate a requirements file <i>and</i> know who requires the dependencies, which in turn makes it easy to manage the ecosystem, analyze packages, and determine if we can reduce our footprint.<p>Between that latter feature, the proxy, the parallelization we&#x27;ve reduced build times across ~100 engineers by a solid 10 minutes. There are other things we do as well, but uv is a must have nowadays.</div><br/><div id="42191693" class="c"><input type="checkbox" id="c-42191693" checked=""/><div class="controls bullet"><span class="by">campbel</span><span>|</span><a href="#42190458">root</a><span>|</span><a href="#42191116">parent</a><span>|</span><a href="#42191669">next</a><span>|</span><label class="collapse" for="c-42191693">[-]</label><label class="expand" for="c-42191693">[1 more]</label></div><br/><div class="children"><div class="content">working on switching over a lot of our python usage to UV, seeing similar speedups in builds and local environments</div><br/></div></div><div id="42191669" class="c"><input type="checkbox" id="c-42191669" checked=""/><div class="controls bullet"><span class="by">freetonik</span><span>|</span><a href="#42190458">root</a><span>|</span><a href="#42191116">parent</a><span>|</span><a href="#42191693">prev</a><span>|</span><a href="#42191858">next</a><span>|</span><label class="collapse" for="c-42191669">[-]</label><label class="expand" for="c-42191669">[2 more]</label></div><br/><div class="children"><div class="content">Is your caching proxy open source?</div><br/><div id="42191983" class="c"><input type="checkbox" id="c-42191983" checked=""/><div class="controls bullet"><span class="by">cik</span><span>|</span><a href="#42190458">root</a><span>|</span><a href="#42191669">parent</a><span>|</span><a href="#42191858">next</a><span>|</span><label class="collapse" for="c-42191983">[-]</label><label class="expand" for="c-42191983">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s just nginx. Here&#x27;s a link to something someone did. It&#x27;s close enough to be honest, unless you have our specialized needs.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;hauntsaninja&#x2F;nginx_pypi_cache">https:&#x2F;&#x2F;github.com&#x2F;hauntsaninja&#x2F;nginx_pypi_cache</a></div><br/></div></div></div></div></div></div></div></div><div id="42191858" class="c"><input type="checkbox" id="c-42191858" checked=""/><div class="controls bullet"><span class="by">pcwelder</span><span>|</span><a href="#42190458">prev</a><span>|</span><a href="#42191388">next</a><span>|</span><label class="collapse" for="c-42191858">[-]</label><label class="expand" for="c-42191858">[1 more]</label></div><br/><div class="children"><div class="content">I just want to thank people behind uv. The tool is just amazing for development, packaging and running packages. And it&#x27;s blazing fast!</div><br/></div></div><div id="42191388" class="c"><input type="checkbox" id="c-42191388" checked=""/><div class="controls bullet"><span class="by">kolja005</span><span>|</span><a href="#42191858">prev</a><span>|</span><a href="#42189027">next</a><span>|</span><label class="collapse" for="c-42191388">[-]</label><label class="expand" for="c-42191388">[2 more]</label></div><br/><div class="children"><div class="content">I recently watched a talk by the author of uv that was surprisingly fascinating [1]. He goes into a few of the more notable hacks that they had to come up with to make it as fast as it is. The most interesting thing for me was that package resolution in python given constraints defined (eg. in requirements.txt) maps to a boolean satisfiability problem which is NP-complete. So uv uses a custom SAT solver to do this. I totally under-appreciated how much goes into this software and I&#x27;m bummed I have to use Poetry at work after having watched this talk.<p>[1] <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=gSKTfG1GXYQ" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=gSKTfG1GXYQ</a><p>edit: NP-complete not NP-hard</div><br/><div id="42191993" class="c"><input type="checkbox" id="c-42191993" checked=""/><div class="controls bullet"><span class="by">wenc</span><span>|</span><a href="#42191388">parent</a><span>|</span><a href="#42189027">next</a><span>|</span><label class="collapse" for="c-42191993">[-]</label><label class="expand" for="c-42191993">[1 more]</label></div><br/><div class="children"><div class="content">[delayed]</div><br/></div></div></div></div><div id="42189027" class="c"><input type="checkbox" id="c-42189027" checked=""/><div class="controls bullet"><span class="by">gdiamos</span><span>|</span><a href="#42191388">prev</a><span>|</span><a href="#42188914">next</a><span>|</span><label class="collapse" for="c-42189027">[-]</label><label class="expand" for="c-42189027">[9 more]</label></div><br/><div class="children"><div class="content">uv significantly speeds up my pytorch in docker builds<p><pre><code>  # Setup virtual env
  ENV VIRTUAL_ENV=&#x2F;app&#x2F;.venv
  ENV PATH=&quot;$VIRTUAL_ENV&#x2F;bin:$PATH&quot;
  RUN python3 -m venv $VIRTUAL_ENV
  RUN . $VIRTUAL_ENV&#x2F;bin&#x2F;activate

  # install using uv
  RUN pip install uv
  RUN uv pip install torch==${TORCH_VERSION} --index-url https:&#x2F;&#x2F;download.pytorch.org&#x2F;whl&#x2F;cpu
</code></pre>
The index-url makes it really convenient.</div><br/><div id="42189326" class="c"><input type="checkbox" id="c-42189326" checked=""/><div class="controls bullet"><span class="by">orf</span><span>|</span><a href="#42189027">parent</a><span>|</span><a href="#42190557">next</a><span>|</span><label class="collapse" for="c-42189326">[-]</label><label class="expand" for="c-42189326">[2 more]</label></div><br/><div class="children"><div class="content">Use —copy-from to make it even faster, and use a cache mount<p><a href="https:&#x2F;&#x2F;docs.astral.sh&#x2F;uv&#x2F;guides&#x2F;integration&#x2F;docker&#x2F;#installing-uv" rel="nofollow">https:&#x2F;&#x2F;docs.astral.sh&#x2F;uv&#x2F;guides&#x2F;integration&#x2F;docker&#x2F;#install...</a></div><br/><div id="42190399" class="c"><input type="checkbox" id="c-42190399" checked=""/><div class="controls bullet"><span class="by">odie5533</span><span>|</span><a href="#42189027">root</a><span>|</span><a href="#42189326">parent</a><span>|</span><a href="#42190557">next</a><span>|</span><label class="collapse" for="c-42190399">[-]</label><label class="expand" for="c-42190399">[1 more]</label></div><br/><div class="children"><div class="content">Also use pyproject.toml to specify dependencies, not manually installing stuff with uv pip</div><br/></div></div></div></div><div id="42190557" class="c"><input type="checkbox" id="c-42190557" checked=""/><div class="controls bullet"><span class="by">ttyprintk</span><span>|</span><a href="#42189027">parent</a><span>|</span><a href="#42189326">prev</a><span>|</span><a href="#42189506">next</a><span>|</span><label class="collapse" for="c-42190557">[-]</label><label class="expand" for="c-42190557">[4 more]</label></div><br/><div class="children"><div class="content">Apparently, uv respects a key in project.toml:<p><pre><code>    [[tool.uv.index]]
    name = &quot;pytorch-cu124&quot;
    url = &quot;https:&#x2F;&#x2F;download.pytorch.org&#x2F;whl&#x2F;cu124&quot;
    explicit = true</code></pre></div><br/><div id="42190578" class="c"><input type="checkbox" id="c-42190578" checked=""/><div class="controls bullet"><span class="by">gdiamos</span><span>|</span><a href="#42189027">root</a><span>|</span><a href="#42190557">parent</a><span>|</span><a href="#42189506">next</a><span>|</span><label class="collapse" for="c-42190578">[-]</label><label class="expand" for="c-42190578">[3 more]</label></div><br/><div class="children"><div class="content">Nice, I wonder if there is a way to make it conditional, e.g. to pick a different key for a cpu vs cuda build.</div><br/><div id="42190644" class="c"><input type="checkbox" id="c-42190644" checked=""/><div class="controls bullet"><span class="by">kristjansson</span><span>|</span><a href="#42189027">root</a><span>|</span><a href="#42190578">parent</a><span>|</span><a href="#42190631">next</a><span>|</span><label class="collapse" for="c-42190644">[-]</label><label class="expand" for="c-42190644">[1 more]</label></div><br/><div class="children"><div class="content">That’s basically what TFA is about? Set up multiple index urls, and use a bog-standard platform marker on the PyTorch dep to pick between them.</div><br/></div></div><div id="42190631" class="c"><input type="checkbox" id="c-42190631" checked=""/><div class="controls bullet"><span class="by">ttyprintk</span><span>|</span><a href="#42189027">root</a><span>|</span><a href="#42190578">parent</a><span>|</span><a href="#42190644">prev</a><span>|</span><a href="#42189506">next</a><span>|</span><label class="collapse" for="c-42190631">[-]</label><label class="expand" for="c-42190631">[1 more]</label></div><br/><div class="children"><div class="content">Eh, in that case the environment variable is a bit more evident in a Dockerfile.</div><br/></div></div></div></div></div></div><div id="42189506" class="c"><input type="checkbox" id="c-42189506" checked=""/><div class="controls bullet"><span class="by">samtheprogram</span><span>|</span><a href="#42189027">parent</a><span>|</span><a href="#42190557">prev</a><span>|</span><a href="#42188914">next</a><span>|</span><label class="collapse" for="c-42189506">[-]</label><label class="expand" for="c-42189506">[2 more]</label></div><br/><div class="children"><div class="content">Speeds up installation, or speeds up PyTorch in general?</div><br/><div id="42190362" class="c"><input type="checkbox" id="c-42190362" checked=""/><div class="controls bullet"><span class="by">gleenn</span><span>|</span><a href="#42189027">root</a><span>|</span><a href="#42189506">parent</a><span>|</span><a href="#42188914">next</a><span>|</span><label class="collapse" for="c-42190362">[-]</label><label class="expand" for="c-42190362">[1 more]</label></div><br/><div class="children"><div class="content">Almost certainly only the install. Uv is basically a pip tool substitute with a few other bells and whistles too but shouldn&#x27;t affect run time whatsoever.</div><br/></div></div></div></div></div></div><div id="42188914" class="c"><input type="checkbox" id="c-42188914" checked=""/><div class="controls bullet"><span class="by">minimaxir</span><span>|</span><a href="#42189027">prev</a><span>|</span><a href="#42191393">next</a><span>|</span><label class="collapse" for="c-42188914">[-]</label><label class="expand" for="c-42188914">[5 more]</label></div><br/><div class="children"><div class="content">So uv caused a bit of an issue with me installing PyTorch over the weekend.<p>When installed with brew on my MacBook, uv currently has PyTorch 3.13 as a dependency, which is fine. But PyTorch does not currently have a stable wheel that&#x27;s compatable with Python 3.13! This resulted in very confusing errors. (Solution was to point to the Nightly index)<p>That&#x27;s technically PyTorch&#x27;s fault, but it&#x27;s indicitave why a specific page on installing PyTorch is necessary, and it&#x27;s good to know the documentation specifically calls it out.</div><br/><div id="42191635" class="c"><input type="checkbox" id="c-42191635" checked=""/><div class="controls bullet"><span class="by">the_mitsuhiko</span><span>|</span><a href="#42188914">parent</a><span>|</span><a href="#42189345">next</a><span>|</span><label class="collapse" for="c-42191635">[-]</label><label class="expand" for="c-42191635">[1 more]</label></div><br/><div class="children"><div class="content">Fun fact: that&#x27;s called out in the doc you&#x27;re commenting :)</div><br/></div></div><div id="42189345" class="c"><input type="checkbox" id="c-42189345" checked=""/><div class="controls bullet"><span class="by">0cf8612b2e1e</span><span>|</span><a href="#42188914">parent</a><span>|</span><a href="#42191635">prev</a><span>|</span><a href="#42191393">next</a><span>|</span><label class="collapse" for="c-42189345">[-]</label><label class="expand" for="c-42189345">[3 more]</label></div><br/><div class="children"><div class="content">I have run into multiple package problems with 3.13 with a non obvious root cause error message. Thankfully, uv makes it trivial to switch out to 3.12</div><br/><div id="42189386" class="c"><input type="checkbox" id="c-42189386" checked=""/><div class="controls bullet"><span class="by">zanie</span><span>|</span><a href="#42188914">root</a><span>|</span><a href="#42189345">parent</a><span>|</span><a href="#42191393">next</a><span>|</span><label class="collapse" for="c-42189386">[-]</label><label class="expand" for="c-42189386">[2 more]</label></div><br/><div class="children"><div class="content">I work on our error messages, feel free to open an issue and we&#x27;ll do our best to make it clearer</div><br/><div id="42190377" class="c"><input type="checkbox" id="c-42190377" checked=""/><div class="controls bullet"><span class="by">emmanueloga_</span><span>|</span><a href="#42188914">root</a><span>|</span><a href="#42189386">parent</a><span>|</span><a href="#42191393">next</a><span>|</span><label class="collapse" for="c-42190377">[-]</label><label class="expand" for="c-42190377">[1 more]</label></div><br/><div class="children"><div class="content">Hey there, I experienced a hairy error message recently too while trying to install aider-chat from pypi with Python 3.13 and Pixi (but I was told the error was coming from UV).<p>&quot;Solution&quot;: `pixi add python=3.12`, then `pixi add --pypi aider-chat` succeeds without issues.<p>A message like &quot;aider-chat seems to be incompatible with python=3.13, try downgrading to python-3.12&quot; would be great, assuming this is really the case.<p>I can create an issue if it helps, but really quick here&#x27;s the error I was getting and some talk on discord about it:<p><a href="https:&#x2F;&#x2F;pastebin.com&#x2F;UVkFstJH" rel="nofollow">https:&#x2F;&#x2F;pastebin.com&#x2F;UVkFstJH</a><p><a href="https:&#x2F;&#x2F;discord.com&#x2F;channels&#x2F;1082332781146800168&#x2F;1295723793100181555" rel="nofollow">https:&#x2F;&#x2F;discord.com&#x2F;channels&#x2F;1082332781146800168&#x2F;12957237931...</a></div><br/></div></div></div></div></div></div></div></div><div id="42191393" class="c"><input type="checkbox" id="c-42191393" checked=""/><div class="controls bullet"><span class="by">breuleux</span><span>|</span><a href="#42188914">prev</a><span>|</span><a href="#42191360">next</a><span>|</span><label class="collapse" for="c-42191393">[-]</label><label class="expand" for="c-42191393">[1 more]</label></div><br/><div class="children"><div class="content">I was trying to figure out how to set up a pyproject with uv that could support cuda, rocm and other device types this morning, and next thing I knew, there was a new release adding pretty much exactly what I needed.<p>The pace of development on uv is really impressive.</div><br/></div></div><div id="42191360" class="c"><input type="checkbox" id="c-42191360" checked=""/><div class="controls bullet"><span class="by">paradite</span><span>|</span><a href="#42191393">prev</a><span>|</span><a href="#42190760">next</a><span>|</span><label class="collapse" for="c-42191360">[-]</label><label class="expand" for="c-42191360">[4 more]</label></div><br/><div class="children"><div class="content">I was just getting used to pipenv and pyenv combo.<p>Is this worth switching to?</div><br/><div id="42191833" class="c"><input type="checkbox" id="c-42191833" checked=""/><div class="controls bullet"><span class="by">silvester23</span><span>|</span><a href="#42191360">parent</a><span>|</span><a href="#42191442">next</a><span>|</span><label class="collapse" for="c-42191833">[-]</label><label class="expand" for="c-42191833">[1 more]</label></div><br/><div class="children"><div class="content">I would also say absolutely. We&#x27;ve been using pipenv for ~6 years and have managed to build a pretty good workflow around it. But uv is just _so much faster_. So we&#x27;ve started moving everything over to uv and I don&#x27;t think we&#x27;ll ever look back.<p>Migrating is not super hard, we wrote a small script that moves all the information from a Pipfile to a pyproject.toml and it works like a charm.</div><br/></div></div><div id="42191442" class="c"><input type="checkbox" id="c-42191442" checked=""/><div class="controls bullet"><span class="by">jpalomaki</span><span>|</span><a href="#42191360">parent</a><span>|</span><a href="#42191833">prev</a><span>|</span><a href="#42191409">next</a><span>|</span><label class="collapse" for="c-42191442">[-]</label><label class="expand" for="c-42191442">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using a combination of pyenv, venv and Poetry in the past.<p>Now I have switched to uv with new projects. No problems so far. I definitely recommend giving it a go.</div><br/></div></div><div id="42191409" class="c"><input type="checkbox" id="c-42191409" checked=""/><div class="controls bullet"><span class="by">baggiponte</span><span>|</span><a href="#42191360">parent</a><span>|</span><a href="#42191442">prev</a><span>|</span><a href="#42190760">next</a><span>|</span><label class="collapse" for="c-42191409">[-]</label><label class="expand" for="c-42191409">[1 more]</label></div><br/><div class="children"><div class="content">Absolutely. No second thoughts.</div><br/></div></div></div></div><div id="42190760" class="c"><input type="checkbox" id="c-42190760" checked=""/><div class="controls bullet"><span class="by">mrbonner</span><span>|</span><a href="#42191360">prev</a><span>|</span><a href="#42191569">next</a><span>|</span><label class="collapse" for="c-42190760">[-]</label><label class="expand" for="c-42190760">[3 more]</label></div><br/><div class="children"><div class="content">Does uv support global Python install now? I need something like Mise for this.</div><br/><div id="42191001" class="c"><input type="checkbox" id="c-42191001" checked=""/><div class="controls bullet"><span class="by">shlomo_z</span><span>|</span><a href="#42190760">parent</a><span>|</span><a href="#42191569">next</a><span>|</span><label class="collapse" for="c-42191001">[-]</label><label class="expand" for="c-42191001">[2 more]</label></div><br/><div class="children"><div class="content">uv python install 3.xx</div><br/><div id="42191096" class="c"><input type="checkbox" id="c-42191096" checked=""/><div class="controls bullet"><span class="by">imjonse</span><span>|</span><a href="#42190760">root</a><span>|</span><a href="#42191001">parent</a><span>|</span><a href="#42191569">next</a><span>|</span><label class="collapse" for="c-42191096">[-]</label><label class="expand" for="c-42191096">[1 more]</label></div><br/><div class="children"><div class="content">That is not global. From the uv getting started docs:<p>&quot;When Python is installed by uv, it will not be available globally (i.e. via the python command). Support for this feature is planned for a future release. In the meantime, use uv run or create and activate a virtual environment to use python directly.&quot;<p>So yes, one needs mise&#x2F;asdf&#x2F;pyenv or similar for global installs for now.</div><br/></div></div></div></div></div></div><div id="42191569" class="c"><input type="checkbox" id="c-42191569" checked=""/><div class="controls bullet"><span class="by">Mxbonn</span><span>|</span><a href="#42190760">prev</a><span>|</span><label class="collapse" for="c-42191569">[-]</label><label class="expand" for="c-42191569">[1 more]</label></div><br/><div class="children"><div class="content">Now that PyTorch is also ending their anaconda package distribution, I think a lot of ml&#x2F;ds people should give uv a shot.</div><br/></div></div></div></div></div></div></div></body></html>