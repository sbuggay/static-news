<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735462849312" as="style"/><link rel="stylesheet" href="styles.css?v=1735462849312"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://nicolascarpi.github.io/openbsd/2019/04/03/openbsd-mail-server.html">Personal Mail Server on OpenBSD (2019)</a> <span class="domain">(<a href="https://nicolascarpi.github.io">nicolascarpi.github.io</a>)</span></div><div class="subtext"><span>likeabatterycar</span> | <span>38 comments</span></div><br/><div><div id="42538339" class="c"><input type="checkbox" id="c-42538339" checked=""/><div class="controls bullet"><span class="by">kuon</span><span>|</span><a href="#42536884">next</a><span>|</span><label class="collapse" for="c-42538339">[-]</label><label class="expand" for="c-42538339">[2 more]</label></div><br/><div class="children"><div class="content">I run my own email server and get nearly zero spam due to the simple reverse DNS check which catch most of them, rspamd catches the rest. I have about 50 000 emails in daily with about 500 delivered and in those 500 about 20 which are spam.<p>Also, to remove the problem of false positive, refuse spam at the SMTP connection level and do not use a spam folder. This way users will get an MTA email in case of false positive.</div><br/><div id="42538675" class="c"><input type="checkbox" id="c-42538675" checked=""/><div class="controls bullet"><span class="by">sph</span><span>|</span><a href="#42538339">parent</a><span>|</span><a href="#42536884">next</a><span>|</span><label class="collapse" for="c-42538675">[-]</label><label class="expand" for="c-42538675">[1 more]</label></div><br/><div class="children"><div class="content">[delayed]</div><br/></div></div></div></div><div id="42536884" class="c"><input type="checkbox" id="c-42536884" checked=""/><div class="controls bullet"><span class="by">easterncalculus</span><span>|</span><a href="#42538339">prev</a><span>|</span><a href="#42537118">next</a><span>|</span><label class="collapse" for="c-42536884">[-]</label><label class="expand" for="c-42536884">[5 more]</label></div><br/><div class="children"><div class="content">Love the shoutout to openbsd.amsterdam. It is pretty impressive how they&#x27;re running a hosting company while committed to the OpenBSD stack[1].<p>[1]: <a href="https:&#x2F;&#x2F;openbsd.amsterdam&#x2F;setup.html" rel="nofollow">https:&#x2F;&#x2F;openbsd.amsterdam&#x2F;setup.html</a></div><br/><div id="42537005" class="c"><input type="checkbox" id="c-42537005" checked=""/><div class="controls bullet"><span class="by">Coolbeanstoo</span><span>|</span><a href="#42536884">parent</a><span>|</span><a href="#42537735">next</a><span>|</span><label class="collapse" for="c-42537005">[-]</label><label class="expand" for="c-42537005">[2 more]</label></div><br/><div class="children"><div class="content">Its quite a nice service. Host my own mail server quite happily on it. I don&#x27;t have any anti incoming spam setup which is getting a little annoying though.</div><br/><div id="42537386" class="c"><input type="checkbox" id="c-42537386" checked=""/><div class="controls bullet"><span class="by">bbarnett</span><span>|</span><a href="#42536884">root</a><span>|</span><a href="#42537005">parent</a><span>|</span><a href="#42537735">next</a><span>|</span><label class="collapse" for="c-42537386">[-]</label><label class="expand" for="c-42537386">[1 more]</label></div><br/><div class="children"><div class="content">Greylisting helps a lot.</div><br/></div></div></div></div><div id="42537735" class="c"><input type="checkbox" id="c-42537735" checked=""/><div class="controls bullet"><span class="by">SoftTalker</span><span>|</span><a href="#42536884">parent</a><span>|</span><a href="#42537005">prev</a><span>|</span><a href="#42537118">next</a><span>|</span><label class="collapse" for="c-42537735">[-]</label><label class="expand" for="c-42537735">[2 more]</label></div><br/><div class="children"><div class="content">I ran OpenBSD on buyvm.net no issues. Never tried sending email from it so don&#x27;t know what their IP reputation is like.</div><br/><div id="42538611" class="c"><input type="checkbox" id="c-42538611" checked=""/><div class="controls bullet"><span class="by">ElectRabbit</span><span>|</span><a href="#42536884">root</a><span>|</span><a href="#42537735">parent</a><span>|</span><a href="#42537118">next</a><span>|</span><label class="collapse" for="c-42538611">[-]</label><label class="expand" for="c-42538611">[1 more]</label></div><br/><div class="children"><div class="content">I love BuyVM. But they host almost everything (as long it&#x27;s not illegal).<p>Being a neighbor to Tor exit nodes makes mail servers complicated.</div><br/></div></div></div></div></div></div><div id="42537118" class="c"><input type="checkbox" id="c-42537118" checked=""/><div class="controls bullet"><span class="by">alexwasserman</span><span>|</span><a href="#42536884">prev</a><span>|</span><a href="#42537771">next</a><span>|</span><label class="collapse" for="c-42537118">[-]</label><label class="expand" for="c-42537118">[3 more]</label></div><br/><div class="children"><div class="content">Should probably have a [2019] tag, as things do change through time.<p>I always enjoy the self-hosting explanations. Starting with mail is an interesting choice though. It&#x27;s relatable to most people, but also very complex compared with a tougher DNS setup, DKIM, SPF, all that stuff.<p>I&#x27;m not sure what the right approach is to maintain good security, and then open up the right ports for simple services.</div><br/><div id="42537292" class="c"><input type="checkbox" id="c-42537292" checked=""/><div class="controls bullet"><span class="by">stackghost</span><span>|</span><a href="#42537118">parent</a><span>|</span><a href="#42537191">next</a><span>|</span><label class="collapse" for="c-42537292">[-]</label><label class="expand" for="c-42537292">[1 more]</label></div><br/><div class="children"><div class="content">The ISPMail tutorial from workaround.org is the gold standard for &quot;host your own email&quot; and has been for years.</div><br/></div></div><div id="42537191" class="c"><input type="checkbox" id="c-42537191" checked=""/><div class="controls bullet"><span class="by">easterncalculus</span><span>|</span><a href="#42537118">parent</a><span>|</span><a href="#42537292">prev</a><span>|</span><a href="#42537771">next</a><span>|</span><label class="collapse" for="c-42537191">[-]</label><label class="expand" for="c-42537191">[1 more]</label></div><br/><div class="children"><div class="content">I do wish this article had talked about SPF.</div><br/></div></div></div></div><div id="42537771" class="c"><input type="checkbox" id="c-42537771" checked=""/><div class="controls bullet"><span class="by">jamal-kumar</span><span>|</span><a href="#42537118">prev</a><span>|</span><a href="#42536970">next</a><span>|</span><label class="collapse" for="c-42537771">[-]</label><label class="expand" for="c-42537771">[1 more]</label></div><br/><div class="children"><div class="content">I set up an email server quite similar to this a long while ago like a year or so and it gets so much spam it&#x27;s ridiculous haha. Really should have something in there like amavisd&#x2F;spamassassain and scanning with clamd at the very least, because that&#x27;s potentially sending attachment malware to your mail client of choice - unless you&#x27;re happy with 100000 notifications with subject headers like &#x27;BOOM OF SALES&#x27; or &#x27;knock down trees with your hugec0ck&#x27;</div><br/></div></div><div id="42536970" class="c"><input type="checkbox" id="c-42536970" checked=""/><div class="controls bullet"><span class="by">valunord</span><span>|</span><a href="#42537771">prev</a><span>|</span><a href="#42537483">next</a><span>|</span><label class="collapse" for="c-42536970">[-]</label><label class="expand" for="c-42536970">[15 more]</label></div><br/><div class="children"><div class="content">Would love to get Google and all the big companies&#x27; fingers out of my life, but spam is overwhelming today.<p>Would love to see a robust tutorial to show us how to really do spam protection right.</div><br/><div id="42537106" class="c"><input type="checkbox" id="c-42537106" checked=""/><div class="controls bullet"><span class="by">kijiki</span><span>|</span><a href="#42536970">parent</a><span>|</span><a href="#42537176">next</a><span>|</span><label class="collapse" for="c-42537106">[-]</label><label class="expand" for="c-42537106">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m on Debian stable, not OpenBSD, but SpamAssassin + razor + pyzor works really well. Roughly 1 spam per month, and 1-2 false positives a year. This is for an email address that has been used and openly spread widely for 25+ years.<p>The real work is making sure that outbound mail gets delivered, but even that is just making sure you have a clean IP and setting up reverse DNS + DMARC&#x2F;SPF&#x2F;DKIM...</div><br/><div id="42537787" class="c"><input type="checkbox" id="c-42537787" checked=""/><div class="controls bullet"><span class="by">jamal-kumar</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537106">parent</a><span>|</span><a href="#42538396">next</a><span>|</span><label class="collapse" for="c-42537787">[-]</label><label class="expand" for="c-42537787">[1 more]</label></div><br/><div class="children"><div class="content">Nice never heard of those until now. Link for anyone here cause it&#x27;s kinda hard to google razor email filter for some reason. What does that setup have over amavisd?<p><a href="https:&#x2F;&#x2F;notes.sagredo.eu&#x2F;en&#x2F;qmail-notes-185&#x2F;razor2-pyzor-spamcop-and-dcc-setup-251.html" rel="nofollow">https:&#x2F;&#x2F;notes.sagredo.eu&#x2F;en&#x2F;qmail-notes-185&#x2F;razor2-pyzor-spa...</a><p>I investigated further and these don&#x27;t really seem to be incredibly active projects, you sure this is the best solution?<p><a href="https:&#x2F;&#x2F;github.com&#x2F;toddr&#x2F;Razor2-Client-Agent">https:&#x2F;&#x2F;github.com&#x2F;toddr&#x2F;Razor2-Client-Agent</a><p><a href="https:&#x2F;&#x2F;github.com&#x2F;SpamExperts&#x2F;pyzor&#x2F;tree&#x2F;release-1-0-0">https:&#x2F;&#x2F;github.com&#x2F;SpamExperts&#x2F;pyzor&#x2F;tree&#x2F;release-1-0-0</a></div><br/></div></div><div id="42538396" class="c"><input type="checkbox" id="c-42538396" checked=""/><div class="controls bullet"><span class="by">EVa5I7bHFq9mnYK</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537106">parent</a><span>|</span><a href="#42537787">prev</a><span>|</span><a href="#42537176">next</a><span>|</span><label class="collapse" for="c-42538396">[-]</label><label class="expand" for="c-42538396">[1 more]</label></div><br/><div class="children"><div class="content">To send an outbound email today you must have a special skill set and years of carefully built reputation. I just outsource it to smtp2go.</div><br/></div></div></div></div><div id="42537176" class="c"><input type="checkbox" id="c-42537176" checked=""/><div class="controls bullet"><span class="by">theK</span><span>|</span><a href="#42536970">parent</a><span>|</span><a href="#42537106">prev</a><span>|</span><a href="#42537102">next</a><span>|</span><label class="collapse" for="c-42537176">[-]</label><label class="expand" for="c-42537176">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been running a private mail server since the early 00s, spam protection has actually improved drastically in the past ten years or so. For the most parts, SPF and dkim make it very easy for servers to identify scam, for everything else rspamd and clamd seem to take care of the rest.<p>If you don&#x27;t want to run a completely custom setup, there&#x27;s projects like mailcow out there that can do the heavy lifting for you.<p>I really don&#x27;t see a quantitative or qualitative difference between the gmail experience and mine, with the caveat that my setup doesn&#x27;t label ham from other private mail servers as spam (arguably a good thing)</div><br/><div id="42537274" class="c"><input type="checkbox" id="c-42537274" checked=""/><div class="controls bullet"><span class="by">stackghost</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537176">parent</a><span>|</span><a href="#42537102">next</a><span>|</span><label class="collapse" for="c-42537274">[-]</label><label class="expand" for="c-42537274">[5 more]</label></div><br/><div class="children"><div class="content">The big thing is that you&#x27;re presumably already established, which means your IP&#x2F;ASN is clean and &quot;warm&quot;.<p>I self hosted for several years and gave up because even with a clean ASN, I simply wasn&#x27;t sending enough emails to keep my reputation score high enough, and so deliverability into the big players (Microsoft in particular) was very spotty.<p>Email isn&#x27;t that hard it&#x27;s just laborious to administrate.</div><br/><div id="42537378" class="c"><input type="checkbox" id="c-42537378" checked=""/><div class="controls bullet"><span class="by">petee</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537274">parent</a><span>|</span><a href="#42537317">next</a><span>|</span><label class="collapse" for="c-42537378">[-]</label><label class="expand" for="c-42537378">[2 more]</label></div><br/><div class="children"><div class="content">I have no explanation for it, but I also run a tiny mail server and I&#x27;m always fascinated that despite <i>extremely</i> low volume I still manage to get through without being flagged or blocked.<p>Best I can guess is that my host&#x27;s netblock just happens to be sparkling clean, but it sounds like even that may not be enough anymore</div><br/><div id="42537998" class="c"><input type="checkbox" id="c-42537998" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537378">parent</a><span>|</span><a href="#42537317">next</a><span>|</span><label class="collapse" for="c-42537998">[-]</label><label class="expand" for="c-42537998">[1 more]</label></div><br/><div class="children"><div class="content">Similar story here; my only guess (which I don&#x27;t want to verify in case it jinxes it) is that I&#x27;ve been on the same name and netblock for an <i>extremely</i> long time (~20 years) and so I&#x27;m grandfathered in to a lot of undocumented IP rules at the big houses. Long may it continue.</div><br/></div></div></div></div><div id="42537317" class="c"><input type="checkbox" id="c-42537317" checked=""/><div class="controls bullet"><span class="by">alchemist1e9</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537274">parent</a><span>|</span><a href="#42537378">prev</a><span>|</span><a href="#42537102">next</a><span>|</span><label class="collapse" for="c-42537317">[-]</label><label class="expand" for="c-42537317">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I simply wasn&#x27;t sending enough emails to keep my reputation score high enough<p>I’ve used a smaller hosting company for over 25 years run by a competent admin and it’s now dying a slow death I believe exactly because of this reputation problem from infrequent outbound emails from my domain.<p>I don’t know what to do tbh because putting my fate in big tech seems super dangerous.<p>Anyway, everyone is worried about spam but the real problem is sending and having people at outlook.com and gmail.com actually receive your emails!</div><br/><div id="42537349" class="c"><input type="checkbox" id="c-42537349" checked=""/><div class="controls bullet"><span class="by">stackghost</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537317">parent</a><span>|</span><a href="#42537102">next</a><span>|</span><label class="collapse" for="c-42537349">[-]</label><label class="expand" for="c-42537349">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve long been convinced that Big Tech wants email to go away because it&#x27;s neither fashionable nor particularly profitable.  Gmail was famously somebody&#x27;s &quot;10% project&quot;, after all, and not a real product initiative.<p>Now that the era of free money appears to be over I&#x27;d not be surprised if I was reading a blog post about an &quot;incredible journey&quot; at Gmail within the decade.<p>While I think that everyone hosting their own email is the ideal, it&#x27;s not really feasible on today&#x27;s Internet.  I content myself with fastmail.  They&#x27;re big enough I&#x27;m not worried about them dying any time soon.</div><br/></div></div></div></div></div></div></div></div><div id="42537102" class="c"><input type="checkbox" id="c-42537102" checked=""/><div class="controls bullet"><span class="by">simpaticoder</span><span>|</span><a href="#42536970">parent</a><span>|</span><a href="#42537176">prev</a><span>|</span><a href="#42537483">next</a><span>|</span><label class="collapse" for="c-42537102">[-]</label><label class="expand" for="c-42537102">[5 more]</label></div><br/><div class="children"><div class="content">I wonder if anyone has tried training an LLM on known spam and measured it&#x27;s performance? Such an LLM would ideally be run local to the mail server for maximum privacy.</div><br/><div id="42537135" class="c"><input type="checkbox" id="c-42537135" checked=""/><div class="controls bullet"><span class="by">SoftTalker</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537102">parent</a><span>|</span><a href="#42538480">next</a><span>|</span><label class="collapse" for="c-42537135">[-]</label><label class="expand" for="c-42537135">[2 more]</label></div><br/><div class="children"><div class="content">I don’t know why that would be necessary. The vast majority of the spam I get is obviously spam from the subject line alone.</div><br/><div id="42537423" class="c"><input type="checkbox" id="c-42537423" checked=""/><div class="controls bullet"><span class="by">ninjin</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537135">parent</a><span>|</span><a href="#42538480">next</a><span>|</span><label class="collapse" for="c-42537423">[-]</label><label class="expand" for="c-42537423">[1 more]</label></div><br/><div class="children"><div class="content">Ignoring e-mail content and throwing Naive-Bayes on the header alone is pretty much hove we got amazing spam filters about 15 years ago. All of course using a millionth or less of the resources a large language model would use.</div><br/></div></div></div></div><div id="42538480" class="c"><input type="checkbox" id="c-42538480" checked=""/><div class="controls bullet"><span class="by">creshal</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537102">parent</a><span>|</span><a href="#42537135">prev</a><span>|</span><a href="#42537409">next</a><span>|</span><label class="collapse" for="c-42538480">[-]</label><label class="expand" for="c-42538480">[1 more]</label></div><br/><div class="children"><div class="content">rspamd has had an option for it for a while, but the older markov chain based filters tend to work well enough.</div><br/></div></div><div id="42537409" class="c"><input type="checkbox" id="c-42537409" checked=""/><div class="controls bullet"><span class="by">bbarnett</span><span>|</span><a href="#42536970">root</a><span>|</span><a href="#42537102">parent</a><span>|</span><a href="#42538480">prev</a><span>|</span><a href="#42537483">next</a><span>|</span><label class="collapse" for="c-42537409">[-]</label><label class="expand" for="c-42537409">[1 more]</label></div><br/><div class="children"><div class="content">Sir!  The willies you just gave me have no compare.<p>What if said AI gains sentience, but trained on that data?!</div><br/></div></div></div></div></div></div><div id="42537483" class="c"><input type="checkbox" id="c-42537483" checked=""/><div class="controls bullet"><span class="by">lukeh</span><span>|</span><a href="#42536970">prev</a><span>|</span><a href="#42538359">next</a><span>|</span><label class="collapse" for="c-42537483">[-]</label><label class="expand" for="c-42537483">[1 more]</label></div><br/><div class="children"><div class="content">I’ve been running my own mail server since forever on a VPS (so, stable IP address, which helps). Still need a third-party spam filter as the primary MX to avoid the deluge, and my mail doesn’t always land reliably. But it’s kind of a point of pride or stubbornness.</div><br/></div></div><div id="42538359" class="c"><input type="checkbox" id="c-42538359" checked=""/><div class="controls bullet"><span class="by">Uw5ssYPc</span><span>|</span><a href="#42537483">prev</a><span>|</span><a href="#42536932">next</a><span>|</span><label class="collapse" for="c-42538359">[-]</label><label class="expand" for="c-42538359">[1 more]</label></div><br/><div class="children"><div class="content">OpenBSD is unusable as a server. No checksumming filesystem. No even TRIM for SSD.</div><br/></div></div><div id="42536932" class="c"><input type="checkbox" id="c-42536932" checked=""/><div class="controls bullet"><span class="by">m348e912</span><span>|</span><a href="#42538359">prev</a><span>|</span><a href="#42537492">next</a><span>|</span><label class="collapse" for="c-42536932">[-]</label><label class="expand" for="c-42536932">[4 more]</label></div><br/><div class="children"><div class="content">I used to run my own mail server until dealing with spam became unmanageable, even with spam mitigation tools in place.<p>Maybe spamd is sufficient, but I ended up switching to gmail which was initially great but has dropped off in efficacy over the years.<p>I also understand sending email can be difficult with strict SPF rules in place causing many email providers to reject legitimate emails from smaller email servers.</div><br/><div id="42537117" class="c"><input type="checkbox" id="c-42537117" checked=""/><div class="controls bullet"><span class="by">mmooss</span><span>|</span><a href="#42536932">parent</a><span>|</span><a href="#42537492">next</a><span>|</span><label class="collapse" for="c-42537117">[-]</label><label class="expand" for="c-42537117">[3 more]</label></div><br/><div class="children"><div class="content">Aren&#x27;t there third party, for-hire, spam and malware filtering services? Have you tried them?</div><br/><div id="42537795" class="c"><input type="checkbox" id="c-42537795" checked=""/><div class="controls bullet"><span class="by">jamal-kumar</span><span>|</span><a href="#42536932">root</a><span>|</span><a href="#42537117">parent</a><span>|</span><a href="#42537497">next</a><span>|</span><label class="collapse" for="c-42537795">[-]</label><label class="expand" for="c-42537795">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve had quite fine experience with the FOSS solutions, not alot gets through and never seen a false positive which I can&#x27;t even say for gmail</div><br/></div></div><div id="42537497" class="c"><input type="checkbox" id="c-42537497" checked=""/><div class="controls bullet"><span class="by">kstrauser</span><span>|</span><a href="#42536932">root</a><span>|</span><a href="#42537117">parent</a><span>|</span><a href="#42537795">prev</a><span>|</span><a href="#42537492">next</a><span>|</span><label class="collapse" for="c-42537497">[-]</label><label class="expand" for="c-42537497">[1 more]</label></div><br/><div class="children"><div class="content">There are. So many of them have pricing models that become unaffordable quickly for personal users. I hosted email for 6 people in my immediate family and per-user pricing added up quickly. I used SpamHero for quite a while and it did a pretty good job, and $10&#x2F;mo for a whole domain was worth it to me.</div><br/></div></div></div></div></div></div><div id="42537492" class="c"><input type="checkbox" id="c-42537492" checked=""/><div class="controls bullet"><span class="by">alwinaugustin</span><span>|</span><a href="#42536932">prev</a><span>|</span><a href="#42537407">next</a><span>|</span><label class="collapse" for="c-42537492">[-]</label><label class="expand" for="c-42537492">[1 more]</label></div><br/><div class="children"><div class="content">What we need to have is a P2P email system with maximum privacy so that it will be maintained collectively and we don&#x27;t need to use the BigTech systems.</div><br/></div></div><div id="42537407" class="c"><input type="checkbox" id="c-42537407" checked=""/><div class="controls bullet"><span class="by">ninjin</span><span>|</span><a href="#42537492">prev</a><span>|</span><a href="#42537120">next</a><span>|</span><label class="collapse" for="c-42537407">[-]</label><label class="expand" for="c-42537407">[2 more]</label></div><br/><div class="children"><div class="content">Went through the same journey in November and now handle both inbound and outbound e-mail on my Hetzner box (should get a secondary SMTP going at some point for redundancy though). I have delivery to <i>both</i> Google and Microsoft (known to be among the worst of the actors) confirmed working for about a month.<p>My simpler (?) setup based on the same logical flow as Nico&#x27;s:<p>1. Check assigned IP from provider (Hetzner in my case) for issues on black lists (MxToolbox worked great for me).<p>2. Set up reverse DNS with your provider.<p>3. Install OpenBSD: confirm default, confirm default, ..., enter hostname, enter username, enter password, confirm default, confirm default, ..., select mirror, confirm default, confirm default, ...<p>4. Use ssh-copy-id(1) to authorise key logins for the user you set up during the installation.<p>5. Set up DNS records for <i>both</i> the hostname <i>and</i> SPF (confirm propagation&#x2F;settings with say MxToolbox, it will be helpful at pretty much every step, so I will stop repeating it now)<p>6. Enable httpd(8) with `rcctl enable httpd &amp;&amp; rcctl start httpd` and set up acme-client(1) with the examples from: <a href="https:&#x2F;&#x2F;man.openbsd.org&#x2F;acme-client" rel="nofollow">https:&#x2F;&#x2F;man.openbsd.org&#x2F;acme-client</a><p>7. Enable and configure spamd(8) (note that I disable greylisting) and uncomment a few lines in `&#x2F;etc&#x2F;pf.conf` and reload your PF rules:<p><pre><code>    &gt; echo spamd_flags=-b &gt;&gt; &#x2F;etc&#x2F;rc.conf.local
    &gt; rcctl start spamd
    &gt; vi &#x2F;etc&#x2F;pf.conf
    &gt; pfctl -f &#x2F;etc&#x2F;pf.conf
</code></pre>
8. Configure and enable (`rcctl enable smtpd`) OpenSMTPD, which is about as easy as it gets (I am being more explicit about the hostname than I need to, but it is necessary as the box has multiple hostnames and the MX one is not the primary):<p><pre><code>    pki $HOSTNAME cert &quot;&#x2F;etc&#x2F;ssl&#x2F;$HOSTNAME.fullchain.pem&quot;
    pki $HOSTNAME key &quot;&#x2F;etc&#x2F;ssl&#x2F;private&#x2F;$HOSTNAME.key&quot;
    
    table aliases file:&#x2F;etc&#x2F;mail&#x2F;aliases
    table domains file:&#x2F;etc&#x2F;mail&#x2F;domains
    table secrets file:&#x2F;etc&#x2F;mail&#x2F;secrets
    table virtuals file:&#x2F;etc&#x2F;mail&#x2F;virtuals
    
    filter &quot;rdns&quot; phase connect match !rdns \
            disconnect &quot;550 Reverse DNS lookup failed&quot;
    filter &quot;fcrdns&quot; phase connect match !fcrdns \
            disconnect &quot;550 Forward-confirmed reverse DNS failed&quot;
    
    listen on all tls hostname $HOSTNAME pki $HOSTNAME \
            filter { &quot;rdns&quot; &quot;fcrdns&quot; }
    listen on all smtps port smtps hostname $HOSTNAME \
            pki $HOSTNAME auth &lt;secrets&gt; mask-src
    
    action &quot;local&quot; mbox alias &lt;aliases&gt;
    action &quot;relay&quot; relay tls helo $HOSTNAME
    action &quot;virtual&quot; mbox virtual &lt;virtuals&gt;
</code></pre>
9. Fill in `&#x2F;etc&#x2F;mail&#x2F;domains` and `&#x2F;etc&#x2F;mail&#x2F;virtuals` with the domains and virtual inboxes you want to handle.<p>10. `rcctl start smtpd`<p>That is it. DKIM is annoying, as it requires a package from ports and all we just did above was with the OpenBSD base system, but it turns out delivery works just fine without it for a small family server (even for Google and M$). I <i>think</i> there is an argument for DKIM (although it adds next to nothing over SPF) to be in base OpenSMTPD as I believe all the complicated code is already in base, but I am not intimately familiar with the OpenSMTPD code base and trust that it will happen if the e-mail climate becomes even more oppressive.<p>I am cheating somewhat here as I am not doing local delivery&#x2F;retrieval but relaying to an external SMTP server as I have yet to find a more minimal solution for POP3 than Dovecot that I feel comfortable hosting (pop3d gets close (<a href="https:&#x2F;&#x2F;github.com&#x2F;snimmagadda&#x2F;pop3d&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;snimmagadda&#x2F;pop3d&#x2F;</a>), but I would need a code audit and I have lacked the time).<p>This is all from memory (apart from the nearly default `&#x2F;etc&#x2F;mail&#x2F;smtpd.conf`) and I of course take no responsibility for anyone copying and pasting blindly without thinking (this is OpenBSD after all: Use your head).<p>A final word, if you ever have trouble, use MxToolbox or similar and they will lead you in the right direction if you have misunderstood the documentation or in other ways messed up the configuration.</div><br/></div></div><div id="42537120" class="c"><input type="checkbox" id="c-42537120" checked=""/><div class="controls bullet"><span class="by">tonymet</span><span>|</span><a href="#42537407">prev</a><span>|</span><a href="#42537237">next</a><span>|</span><label class="collapse" for="c-42537120">[-]</label><label class="expand" for="c-42537120">[1 more]</label></div><br/><div class="children"><div class="content">What’s the reject rate?</div><br/></div></div></div></div></div></div></div></body></html>