<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1690794075142" as="style"/><link rel="stylesheet" href="styles.css?v=1690794075142"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://macgui.com/news/article.php?t=443">HFS Origins: The Turbo File System (2017)</a> <span class="domain">(<a href="https://macgui.com">macgui.com</a>)</span></div><div class="subtext"><span>Lammy</span> | <span>17 comments</span></div><br/><div><div id="36936038" class="c"><input type="checkbox" id="c-36936038" checked=""/><div class="controls bullet"><span class="by">ksherlock</span><span>|</span><a href="#36937941">next</a><span>|</span><label class="collapse" for="c-36936038">[-]</label><label class="expand" for="c-36936038">[1 more]</label></div><br/><div class="children"><div class="content">&quot;I don&#x27;t have any documentation yet to firmly support this statement, but my impression is that the Macintosh File System was based upon the Lisa file system which in turn was similar to a file system developed by Xerox for its Star workstation.&quot;<p>MFS uses a linked-list for file blocks, similar to MS DOS.  This is not a coincidence according to folklore:<p><a href="https:&#x2F;&#x2F;www.folklore.org&#x2F;StoryView.py?project=Macintosh&amp;story=Mea_Culpa.txt" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.folklore.org&#x2F;StoryView.py?project=Macintosh&amp;stor...</a><p>&quot;Our first file system used a simple data structure that didn&#x27;t scale well to large drives (in fact, it was suggested to us by Bill Gates in July 1981)&quot;</div><br/></div></div><div id="36937941" class="c"><input type="checkbox" id="c-36937941" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#36936038">prev</a><span>|</span><a href="#36936723">next</a><span>|</span><label class="collapse" for="c-36937941">[-]</label><label class="expand" for="c-36937941">[1 more]</label></div><br/><div class="children"><div class="content"><i>The design of HFS was protected by United States Patent number 4,945,475, &quot;Hierarchical file system to provide cataloging and retrieval of data.&quot; The patent was granted at the end of July 1990, meaning that it has since expired after its maximum 20-year lifetime.</i><p>AFAIK unlike Microsoft later on with its FAT LFN patent, Apple doesn&#x27;t seem to have tried to stop third-party implementations using that.</div><br/></div></div><div id="36936723" class="c"><input type="checkbox" id="c-36936723" checked=""/><div class="controls bullet"><span class="by">Aloha</span><span>|</span><a href="#36937941">prev</a><span>|</span><a href="#36936133">next</a><span>|</span><label class="collapse" for="c-36936723">[-]</label><label class="expand" for="c-36936723">[9 more]</label></div><br/><div class="children"><div class="content">Was the classic macOS source put out at some point?</div><br/><div id="36936885" class="c"><input type="checkbox" id="c-36936885" checked=""/><div class="controls bullet"><span class="by">skissane</span><span>|</span><a href="#36936723">parent</a><span>|</span><a href="#36936919">next</a><span>|</span><label class="collapse" for="c-36936885">[-]</label><label class="expand" for="c-36936885">[7 more]</label></div><br/><div class="children"><div class="content">&gt; Was the classic macOS source put out at some point?<p>A large (but apparently incomplete?) chunk of the System 7.1 source code was leaked 10+ years ago, and isn’t hard to find. But AFAIK, there has never been an approved release by Apple. Apple did publicly release the Lisa source code (through the Computer History Museum), so maybe they&#x27;ll do that with Apple source at some point too.<p>Reading the article, my impression is the author <i>may</i> have more source code that isn’t widely available. Probably, they know some ex-Apple engineers who have saved code from their time at Apple, and shared it with them on the condition it isn’t made public. I’ve heard of things like that happening before, for other historically important closed source systems.</div><br/><div id="36937531" class="c"><input type="checkbox" id="c-36937531" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36936885">parent</a><span>|</span><a href="#36936919">next</a><span>|</span><label class="collapse" for="c-36937531">[-]</label><label class="expand" for="c-36937531">[6 more]</label></div><br/><div class="children"><div class="content">HFS is in the open-source Darwin&#x2F;OSX releases. But before that it was well documented in public, and the article links to the patents.</div><br/><div id="36937967" class="c"><input type="checkbox" id="c-36937967" checked=""/><div class="controls bullet"><span class="by">ksherlock</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36937531">parent</a><span>|</span><a href="#36937718">next</a><span>|</span><label class="collapse" for="c-36937967">[-]</label><label class="expand" for="c-36937967">[4 more]</label></div><br/><div class="children"><div class="content">I believe most of the open source HFS code was from NeXT rather than Mac OS. A lot of classic Mac OS was still 68k assembly.<p>eg:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;hfs&#x2F;blob&#x2F;hfs-106&#x2F;hfs_util&#x2F;hfsutil_main.c">https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;hfs&#x2F;blob&#x2F;hfs-106&#x2F;...</a><p>13-Jan-1998 jwc first cut (derived from old NextStep macfs.util code and cdrom.util code).</div><br/><div id="36938161" class="c"><input type="checkbox" id="c-36938161" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36937967">parent</a><span>|</span><a href="#36937718">next</a><span>|</span><label class="collapse" for="c-36938161">[-]</label><label class="expand" for="c-36938161">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s the wrong place (confusingly enough), look in here.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;tree&#x2F;rel&#x2F;xnu-124&#x2F;bsd&#x2F;hfs">https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;tree&#x2F;rel&#x2F;xnu-...</a></div><br/><div id="36938543" class="c"><input type="checkbox" id="c-36938543" checked=""/><div class="controls bullet"><span class="by">ksherlock</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36938161">parent</a><span>|</span><a href="#36937718">next</a><span>|</span><label class="collapse" for="c-36938543">[-]</label><label class="expand" for="c-36938543">[2 more]</label></div><br/><div class="children"><div class="content">ok but still:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;blob&#x2F;rel&#x2F;xnu-124&#x2F;bsd&#x2F;hfs&#x2F;hfs_vnodeops.c">https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;blob&#x2F;rel&#x2F;xnu-...</a><p><pre><code>    (c) 1997-1999 Apple Computer, Inc.  All Rights Reserved
    (c) 1990, 1992 NeXT Computer, Inc.  All Rights Reserved</code></pre></div><br/><div id="36939226" class="c"><input type="checkbox" id="c-36939226" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36938543">parent</a><span>|</span><a href="#36937718">next</a><span>|</span><label class="collapse" for="c-36939226">[-]</label><label class="expand" for="c-36939226">[1 more]</label></div><br/><div class="children"><div class="content">I think NeXT might&#x27;ve written an HFS Standard reader or something, but they used the Apple code for HFS+ so it ended up as a hybrid.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;blob&#x2F;rel&#x2F;xnu-124&#x2F;bsd&#x2F;hfs&#x2F;hfscommon&#x2F;Misc&#x2F;FileExtentMapping.c">https:&#x2F;&#x2F;github.com&#x2F;apple-oss-distributions&#x2F;xnu&#x2F;blob&#x2F;rel&#x2F;xnu-...</a></div><br/></div></div></div></div></div></div></div></div><div id="36937718" class="c"><input type="checkbox" id="c-36937718" checked=""/><div class="controls bullet"><span class="by">Lammy</span><span>|</span><a href="#36936723">root</a><span>|</span><a href="#36937531">parent</a><span>|</span><a href="#36937967">prev</a><span>|</span><a href="#36936919">next</a><span>|</span><label class="collapse" for="c-36937718">[-]</label><label class="expand" for="c-36937718">[1 more]</label></div><br/><div class="children"><div class="content">To me the appeal of the old source code is in the comments and changelogs from the original devs as a way to get inside their heads, not in their actual implementation.</div><br/></div></div></div></div></div></div><div id="36936919" class="c"><input type="checkbox" id="c-36936919" checked=""/><div class="controls bullet"><span class="by">Lammy</span><span>|</span><a href="#36936723">parent</a><span>|</span><a href="#36936885">prev</a><span>|</span><a href="#36936133">next</a><span>|</span><label class="collapse" for="c-36936919">[-]</label><label class="expand" for="c-36936919">[1 more]</label></div><br/><div class="children"><div class="content">Try <a href="http:&#x2F;&#x2F;macintoshgarden.org&#x2F;apps&#x2F;mac-os-71-source-code" rel="nofollow noreferrer">http:&#x2F;&#x2F;macintoshgarden.org&#x2F;apps&#x2F;mac-os-71-source-code</a> in `&#x2F;OS&#x2F;HFS&#x2F;`</div><br/></div></div></div></div><div id="36936133" class="c"><input type="checkbox" id="c-36936133" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#36936723">prev</a><span>|</span><label class="collapse" for="c-36936133">[-]</label><label class="expand" for="c-36936133">[5 more]</label></div><br/><div class="children"><div class="content">&gt; <i>Moreover, the Finder had to maintain the catalog in RAM to keep track of folders, which were illusory. The Macintosh File System was not a true hierarchical system; it only appeared to be in the Finder. Folders in fact were kept as &quot;Finder Objects&quot; in the Desktop file.</i><p>That is so frigging cool. JBOF, just a bunch of files. The data about structure being not the responsibility, it being a flat file store.<p>I&#x27;m curious how something like Ceph bluestore works, what it&#x27;s design is. There&#x27;s metadata nodes here too I think, it&#x27;s some kind of dumb-ish blockstore, for limited size blocks.</div><br/><div id="36938575" class="c"><input type="checkbox" id="c-36938575" checked=""/><div class="controls bullet"><span class="by">buildbot</span><span>|</span><a href="#36936133">parent</a><span>|</span><a href="#36937624">next</a><span>|</span><label class="collapse" for="c-36938575">[-]</label><label class="expand" for="c-36938575">[1 more]</label></div><br/><div class="children"><div class="content">Right? It&#x27;s actually to my mind a more advanced design than HFS - just store stuff, including the imaginary hierarchy of folders that might go with the stuff. Then, you could programmatically make new folders based on a query of a set of file metadata if you wanted. So many nice possibilities open up.</div><br/></div></div><div id="36937624" class="c"><input type="checkbox" id="c-36937624" checked=""/><div class="controls bullet"><span class="by">13of40</span><span>|</span><a href="#36936133">parent</a><span>|</span><a href="#36938575">prev</a><span>|</span><a href="#36937670">next</a><span>|</span><label class="collapse" for="c-36937624">[-]</label><label class="expand" for="c-36937624">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s the way PKZip archives work.  The directory is just stored as part of the filename.  It&#x27;s a little bit of a pain because it uses &#x2F; as the separator character and a lot of Windows zip APIs will &quot;fix&quot; that for you, so there&#x27;s a difference between what you get from the API versus what&#x27;s actually stored in the archive entry record in the file.  On the other end of the spectrum is the Amiga file system, where every file entry has an entire sector of metadata, and  a directory is a linked list of those sectors.</div><br/></div></div><div id="36937670" class="c"><input type="checkbox" id="c-36937670" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#36936133">parent</a><span>|</span><a href="#36937624">prev</a><span>|</span><a href="#36936635">next</a><span>|</span><label class="collapse" for="c-36937670">[-]</label><label class="expand" for="c-36937670">[1 more]</label></div><br/><div class="children"><div class="content">On Apple ][ (&#x2F;e, &#x2F;c, etc.) there was some non-standard DOS version (I don&#x27;t think it was ProDOS, but something else) that was first geared towards using the 80 column mode (PR#3), but then it had the notion of directories.... but it was still storing everything in one big &quot;flat&quot; list, though each &quot;file&#x2F;dir&quot; would have a parent index, so &quot;cd someDir&quot; and then &quot;dir&quot; would (I guess) just allow files that have in their parent_id as that dir.<p>But after all, that&#x27;s how you did any kind of &quot;pointer&quot; programming in language without pointers (like Apple Basic which was my first language) - you&#x27;ll store things in array, and use indices (much like Databases)...<p>Maybe it&#x27;s somewhere in archive.org...</div><br/></div></div><div id="36936635" class="c"><input type="checkbox" id="c-36936635" checked=""/><div class="controls bullet"><span class="by">sillywalk</span><span>|</span><a href="#36936133">parent</a><span>|</span><a href="#36937670">prev</a><span>|</span><label class="collapse" for="c-36936635">[-]</label><label class="expand" for="c-36936635">[1 more]</label></div><br/><div class="children"><div class="content">My 5 minute dunning-kruger level look up:<p>Bluestore is used to directly access raw storage without the overhead of a filesystem. [1][2]<p>&quot;BlueStore uses the RocksDB’ key-value database to manage internal metadata, such as the mapping from object names to block locations on a disk. [0]<p>[0] <a href="https:&#x2F;&#x2F;access.redhat.com&#x2F;documentation&#x2F;en-us&#x2F;red_hat_ceph_storage&#x2F;3&#x2F;html&#x2F;administration_guide&#x2F;osd-bluestore" rel="nofollow noreferrer">https:&#x2F;&#x2F;access.redhat.com&#x2F;documentation&#x2F;en-us&#x2F;red_hat_ceph_s...</a><p>[1] <a href="https:&#x2F;&#x2F;blog.acolyer.org&#x2F;2019&#x2F;11&#x2F;06&#x2F;ceph-evolution&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.acolyer.org&#x2F;2019&#x2F;11&#x2F;06&#x2F;ceph-evolution&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;events.static.linuxfound.org&#x2F;sites&#x2F;events&#x2F;files&#x2F;slides&#x2F;20170323%20bluestore.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;events.static.linuxfound.org&#x2F;sites&#x2F;events&#x2F;files&#x2F;slid...</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>