<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687856459805" as="style"/><link rel="stylesheet" href="styles.css?v=1687856459805"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cubxity.dev/blog/folia-test-june-2023">Testing a 1,000 player Minecraft server with Folia</a>Â <span class="domain">(<a href="https://cubxity.dev">cubxity.dev</a>)</span></div><div class="subtext"><span>creatonez</span> | <span>90 comments</span></div><br/><div><div id="36489697" class="c"><input type="checkbox" id="c-36489697" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#36488707">next</a><span>|</span><label class="collapse" for="c-36489697">[-]</label><label class="expand" for="c-36489697">[22 more]</label></div><br/><div class="children"><div class="content">I know this isn&#x27;t the point of Folia&#x27;s test, but:<p>&gt; During the period when 1,000 players were online, we reached a maximum of ~7.9GB&#x2F;s heap allocation and our GC was hovering around 2-3GB&#x2F;s when averaged over a minute.<p>As someone who dealt with soft-realtime telephony stuff, this makes me want to scream in horror. It seems like the platform really hurts the performance here. In an average second with that many players, most (all?) of them will not do any action apart from changing their position. (Just moving around would ideally only use preallocated per-player space only; extra in-game events, npc AI, etc. could still use some allocs) It&#x27;s great Folia can get more out of the bad situation, but... oofff.<p>(not a criticism of Minecraft by the way, it&#x27;s better to be popular and inefficient than not exist - I just didn&#x27;t realise quite how much overhead there is due to the runtime)</div><br/><div id="36489830" class="c"><input type="checkbox" id="c-36489830" checked=""/><div class="controls bullet"><span class="by">skerit</span><span>|</span><a href="#36489697">parent</a><span>|</span><a href="#36489825">next</a><span>|</span><label class="collapse" for="c-36489830">[-]</label><label class="expand" for="c-36489830">[4 more]</label></div><br/><div class="children"><div class="content">&gt; In an average second with that many players, most (all?) of them will not do any action apart from changing their position<p>The world is not static though. Each player loads in a lot of living entities (monsters&#x2F;animals&#x2F;...) and block entities (furnaces, redstone, ...) that all need to update. There&#x27;s some overlap of course, though in a game like Minecraft where there&#x27;s a near infinite world to explore that overlap is smaller than you would think.</div><br/><div id="36490199" class="c"><input type="checkbox" id="c-36490199" checked=""/><div class="controls bullet"><span class="by">Cthulhu_</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489830">parent</a><span>|</span><a href="#36489825">next</a><span>|</span><label class="collapse" for="c-36490199">[-]</label><label class="expand" for="c-36490199">[3 more]</label></div><br/><div class="children"><div class="content">Well yeah but that&#x27;s a process that can run independently from player movement and (I guess?) can be a highly asynchronous and paralellised process.<p>(note: armchair remark, I honestly haven&#x27;t a clue)</div><br/><div id="36490372" class="c"><input type="checkbox" id="c-36490372" checked=""/><div class="controls bullet"><span class="by">tehbeard</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490199">parent</a><span>|</span><a href="#36490419">next</a><span>|</span><label class="collapse" for="c-36490372">[-]</label><label class="expand" for="c-36490372">[1 more]</label></div><br/><div class="children"><div class="content">Not really.<p>Block entities (those with complex data, like inventories) can be read&#x2F;interacted with by redstone (a regular-ish set of blocks in terms of data), which can then trigger a piston or dispenser (which changes the world), and said piston or dispenser can then interact with the players movement, pushing them, or hitting them with an arrow, or dispensing water that changes their movement.<p>Same again for non player entities, but also factor in their AI having to adjust pathing based on the world changing.</div><br/></div></div><div id="36490419" class="c"><input type="checkbox" id="c-36490419" checked=""/><div class="controls bullet"><span class="by">bakugo</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490199">parent</a><span>|</span><a href="#36490372">prev</a><span>|</span><a href="#36489825">next</a><span>|</span><label class="collapse" for="c-36490419">[-]</label><label class="expand" for="c-36490419">[1 more]</label></div><br/><div class="children"><div class="content">&gt; can be a highly asynchronous and paralellised process<p>It really can&#x27;t, though. Parallelization is the enemy of consistent game mechanics, especially in a complex sandbox game like minecraft. There are tons of things that interact with each other in minecraft&#x27;s world - if you just tick everything at arbitrary times, those interactions cease to be deterministic and might break entirely unless you write a ton of spaghetti code to deal with every edge case. Redstone in particular is the best example of a mechanic that heavily relies on the synchronous nature of the game logic loop.</div><br/></div></div></div></div></div></div><div id="36489825" class="c"><input type="checkbox" id="c-36489825" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#36489697">parent</a><span>|</span><a href="#36489830">prev</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36489825">[-]</label><label class="expand" for="c-36489825">[6 more]</label></div><br/><div class="children"><div class="content">The Minecraft Java version is notorious for thrashing memory.  It allocates and discards objects at an incredible rate, even when the player isn&#x27;t doing anything.  The server has a GUI where you can watch the memory allocation with its distinctive sawtooth pattern.</div><br/><div id="36489955" class="c"><input type="checkbox" id="c-36489955" checked=""/><div class="controls bullet"><span class="by">half-kh-hacker</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489825">parent</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36489955">[-]</label><label class="expand" for="c-36489955">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;m excited for Project Valhalla to affect Minecraft performance; a lot of the temporary allocations are things like BlockPos objects (a Vec3i, basically) and VoxelShapes (a tree of axis aligned bounding boxes; so, like, an array of a struct that&#x27;s six f64s) which seem ripe for becoming value objects that are inlined  by HotSpot instead of living on the heap</div><br/><div id="36490014" class="c"><input type="checkbox" id="c-36490014" checked=""/><div class="controls bullet"><span class="by">grishka</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489955">parent</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36490014">[-]</label><label class="expand" for="c-36490014">[4 more]</label></div><br/><div class="children"><div class="content">Why not pool these objects? I&#x27;m primarily an Android developer and it&#x27;s a well-known easy optimization on Android to avoid short-lived objects as much as possible, but especially during drawing and other actions that run every frame. You <i>just don&#x27;t use the word &quot;new&quot;</i> in onDraw and other related methods. Android Studio would even warn you if you do.<p>But then the new APIs in JDK itself are designed such that you <i>have to</i> allocate loads of short-lived small objects. I was told that HotSpot does deal with them reasonably well to avoid them degrading the performance, but apparently it isn&#x27;t very good at it?</div><br/><div id="36490178" class="c"><input type="checkbox" id="c-36490178" checked=""/><div class="controls bullet"><span class="by">SirYwell</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490014">parent</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36490178">[-]</label><label class="expand" for="c-36490178">[3 more]</label></div><br/><div class="children"><div class="content">Allocation is typically really cheap, maintaining pools for objects would likely have more overhead. And while collecting garbage takes resources too, it&#x27;s heavily concurrently, especially in GCs like Shenandoah and ZGC. So instead of more overhead due to pooling on the thread that uses the objects, you have more overhead on a different thread during garbage collection.<p>So while it makes sense to avoid unnecessary allocations by using different APIs (e.g. not creating Streams in hot paths), pooling brings far more new problems with it. It might make sense for large objects, but generally requires in-depth analysis to make sure it actually helps.<p>Also, when plugins come into the equation, you need to make sure that those can&#x27;t modify objects they aren&#x27;t meant to modify, which involves copying of objects. Additionally, some objects have different representations in the API (what&#x27;s used by plugins) vs the implementation (what&#x27;s used by vanilla minecraft), so converting between those representations is another source of allocations.</div><br/><div id="36490284" class="c"><input type="checkbox" id="c-36490284" checked=""/><div class="controls bullet"><span class="by">tjoff</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490178">parent</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36490284">[-]</label><label class="expand" for="c-36490284">[2 more]</label></div><br/><div class="children"><div class="content">Pooling would have been more overhead than allocation + deallocation? Do you have any relevant readings?<p>No idea how to do it in java but a few pointers ought to be enough. You can also omit clearing the memory area between allocations for things that aren&#x27;t security sensitive, if that is done in java, which I would assume.</div><br/><div id="36490504" class="c"><input type="checkbox" id="c-36490504" checked=""/><div class="controls bullet"><span class="by">SirYwell</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490284">parent</a><span>|</span><a href="#36490071">next</a><span>|</span><label class="collapse" for="c-36490504">[-]</label><label class="expand" for="c-36490504">[1 more]</label></div><br/><div class="children"><div class="content">Allocation + deallocation might have more overhead together. I&#x27;ll try to rephrase: Requesting an object from a pool might have more overhead than allocating a fresh object, and deallocating the object doesn&#x27;t happen on an application thread but on a GC thread (depending on the GC, obviously).
Alexksey Shipilev has good resources how GCs in HotSpot typically allocate objects (<a href="https:&#x2F;&#x2F;shipilev.net&#x2F;jvm&#x2F;anatomy-quarks&#x2F;4-tlab-allocation&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;shipilev.net&#x2F;jvm&#x2F;anatomy-quarks&#x2F;4-tlab-allocation&#x2F;</a>).<p>There definitely are scenarios where pooling might make sense, but basically the low hanging fruits in that area in minecraft are already reaped.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="36490071" class="c"><input type="checkbox" id="c-36490071" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36489697">parent</a><span>|</span><a href="#36489825">prev</a><span>|</span><a href="#36489994">next</a><span>|</span><label class="collapse" for="c-36490071">[-]</label><label class="expand" for="c-36490071">[5 more]</label></div><br/><div class="children"><div class="content">This is not an issue with the runtime. If anything, the JVM is handling this really well.<p>The problem is code like:<p>while(game_running) { position = new Box(x,y,z) }<p>instead of reusing objects:<p>while(game_running) { position.set(x,y,z) }<p>plus, Minecraft is not static! There are many thousands of other things moving and changing state in the world.</div><br/><div id="36490513" class="c"><input type="checkbox" id="c-36490513" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490071">parent</a><span>|</span><a href="#36490159">next</a><span>|</span><label class="collapse" for="c-36490513">[-]</label><label class="expand" for="c-36490513">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This is not an issue with the runtime<p>Yes. But no. But yes.<p>The code couldn&#x27;t been written better to allocate less. <i>But</i> the runtime encourages cheap allocations you don&#x27;t think about. <i>But</i> the runtime could provide&#x2F;encourage tooling that makes it hard to make that mistake. <i>But</i>...<p>It all overlaps. Sure, JVM is cool and handles it, but also what JVM is influenced how people instinctively used it.</div><br/></div></div><div id="36490159" class="c"><input type="checkbox" id="c-36490159" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490071">parent</a><span>|</span><a href="#36490513">prev</a><span>|</span><a href="#36489994">next</a><span>|</span><label class="collapse" for="c-36490159">[-]</label><label class="expand" for="c-36490159">[3 more]</label></div><br/><div class="children"><div class="content">An age old question... Is the code wrong for not being optimal, or is the compiler&#x2F;JIT wrong for not optimizing it? I&#x27;ve seen optimizing compilers like clang, gcc, rust optimize constructs similar to this to the same machine code. Ideally you want your high-level stuff that makes code easier to understand to be completely transparent and not have a performance impact when the code actually runs.</div><br/><div id="36490383" class="c"><input type="checkbox" id="c-36490383" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490159">parent</a><span>|</span><a href="#36490189">next</a><span>|</span><label class="collapse" for="c-36490383">[-]</label><label class="expand" for="c-36490383">[1 more]</label></div><br/><div class="children"><div class="content">Neither is wrong, and there&#x27;s very likely a lot of low hanging JVM performance fruit here still to claim.<p>Right now they&#x27;re in a bit of a transitional period. Since a few weeks ago the most obvious thing to try is using the latest Oracle GraalVM with ZGC. ZGC is a pauseless GC like Shenandoah and the Graal compiler is a lot better at escape analysis and removing allocations than the stock C2 compiler especially now Oracle made the enterprise compiler free to use.<p>The main problem is going to be that ZGC Generational is not quite launched yet. Without generational GC it may not be able to keep up with those very high allocation rates, even with a better compiler reducing them down again. Generational ZGC should be in Java 21 but then you&#x27;d have to wait for GraalVM to catch up. So, probably it&#x27;s worth trying that combination in the next six months or so.<p>Whilst I don&#x27;t know about ZGC vs Shenandoah, the performance improvements from using Graal EE over C2 can be large even for Java (the wins are much bigger still for other higher level&#x2F;more dynamic languages). But the Minecraft community isn&#x27;t really known for adopting the latest JVM tech. They&#x27;re pretty conservative.<p><i>Edit: someone downthread linked to <a href="https:&#x2F;&#x2F;github.com&#x2F;brucethemoose&#x2F;Minecraft-Performance-Flags-Benchmarks">https:&#x2F;&#x2F;github.com&#x2F;brucethemoose&#x2F;Minecraft-Performance-Flags...</a> which talks about all of that so I guess they&#x27;re getting more experimental!</i></div><br/></div></div><div id="36490189" class="c"><input type="checkbox" id="c-36490189" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490159">parent</a><span>|</span><a href="#36490383">prev</a><span>|</span><a href="#36489994">next</a><span>|</span><label class="collapse" for="c-36490189">[-]</label><label class="expand" for="c-36490189">[1 more]</label></div><br/><div class="children"><div class="content">For my simple case, it would. Generally, the code around the allocation is complicated so maybe it&#x27;s not getting optimized for some reason. Or maybe the object is passed through some complicated path... or maybe it&#x27;s added to a list and then cleared at the end of the frame...</div><br/></div></div></div></div></div></div><div id="36489994" class="c"><input type="checkbox" id="c-36489994" checked=""/><div class="controls bullet"><span class="by">ohgodplsno</span><span>|</span><a href="#36489697">parent</a><span>|</span><a href="#36490071">prev</a><span>|</span><a href="#36488707">next</a><span>|</span><label class="collapse" for="c-36489994">[-]</label><label class="expand" for="c-36489994">[6 more]</label></div><br/><div class="children"><div class="content">Minecraft Java used to allocate over 200MB&#x2F;s per player when moving, and just 50MB&#x2F;s when static. A lot of it stems back from Minecraft 1.8, where code was updated to take a BlockPos(float x, float y, float z) class instead of just (float x, float y, float z). Pretty much every single object in the game has to deal with its position. Millions of objects allocated per frame, only to be discarded later. Along with a looooot of other questionable choices. It&#x27;s not even a runtime problem: you&#x27;d have the same issues free()&#x27;ing that memory on your own. Just stop allocating so damn much.<p>But then again, Notch never claimed to be a great programmer.</div><br/><div id="36490397" class="c"><input type="checkbox" id="c-36490397" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489994">parent</a><span>|</span><a href="#36490101">next</a><span>|</span><label class="collapse" for="c-36490397">[-]</label><label class="expand" for="c-36490397">[1 more]</label></div><br/><div class="children"><div class="content">IIRC the introduction of BlockPos post-dates Notch. The style of just passing three floats around was his original style.</div><br/></div></div><div id="36490005" class="c"><input type="checkbox" id="c-36490005" checked=""/><div class="controls bullet"><span class="by">starlevel003</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489994">parent</a><span>|</span><a href="#36490101">prev</a><span>|</span><a href="#36490022">next</a><span>|</span><label class="collapse" for="c-36490005">[-]</label><label class="expand" for="c-36490005">[1 more]</label></div><br/><div class="children"><div class="content">the post-1.8 codebase awfulness has nothing to do with the source programmer. hell, by 1.13, the game had practically been rewritten at least once over.</div><br/></div></div><div id="36490022" class="c"><input type="checkbox" id="c-36490022" checked=""/><div class="controls bullet"><span class="by">phito</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36489994">parent</a><span>|</span><a href="#36490005">prev</a><span>|</span><a href="#36488707">next</a><span>|</span><label class="collapse" for="c-36490022">[-]</label><label class="expand" for="c-36490022">[2 more]</label></div><br/><div class="children"><div class="content">Just use a struct... Oh wait, Java does not have structs....</div><br/><div id="36490067" class="c"><input type="checkbox" id="c-36490067" checked=""/><div class="controls bullet"><span class="by">grishka</span><span>|</span><a href="#36489697">root</a><span>|</span><a href="#36490022">parent</a><span>|</span><a href="#36488707">next</a><span>|</span><label class="collapse" for="c-36490067">[-]</label><label class="expand" for="c-36490067">[1 more]</label></div><br/><div class="children"><div class="content">Yet.</div><br/></div></div></div></div></div></div></div></div><div id="36488707" class="c"><input type="checkbox" id="c-36488707" checked=""/><div class="controls bullet"><span class="by">AgentK20</span><span>|</span><a href="#36489697">prev</a><span>|</span><a href="#36488824">next</a><span>|</span><label class="collapse" for="c-36488707">[-]</label><label class="expand" for="c-36488707">[4 more]</label></div><br/><div class="children"><div class="content">Always fun to continue to see innovation within the Minecraft Java space.<p>At Hypixel we ran (and I believe they still do run) a custom fork of Spigot from 2014-ish, with features from each sequential update to Minecraft being added to our fork via our Spigot fork. This let us diverge greatly and customize the Minecraft protocol to our own needs, saving hugely on internal bandwidth and letting us optimize crap out of the L7 &quot;BungeeCord&quot; reverse-proxy we used.</div><br/><div id="36490176" class="c"><input type="checkbox" id="c-36490176" checked=""/><div class="controls bullet"><span class="by">mooman219</span><span>|</span><a href="#36488707">parent</a><span>|</span><a href="#36490164">next</a><span>|</span><label class="collapse" for="c-36490176">[-]</label><label class="expand" for="c-36490176">[1 more]</label></div><br/><div class="children"><div class="content">Oh god that&#x27;s a throwback. I remember hanging out in the bukket IRC before all the legal debacles. I worked on MCSG and Wynncraft. It honestly was a blast slamming together patches on spigot(craftbukkit(nms))) onion; I remember writing a patch to run entities off main-thread among other things. I hope you&#x27;re doing well and I hope Hytale is doing alright! I feel like everyone I intereacted with back then ended up doing well in tech in some form.</div><br/></div></div><div id="36490164" class="c"><input type="checkbox" id="c-36490164" checked=""/><div class="controls bullet"><span class="by">lyu07282</span><span>|</span><a href="#36488707">parent</a><span>|</span><a href="#36490176">prev</a><span>|</span><a href="#36489098">next</a><span>|</span><label class="collapse" for="c-36490164">[-]</label><label class="expand" for="c-36490164">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Always fun to continue to see innovation within the Minecraft Java space.<p>Just don&#x27;t expect that innovation to come out of Mojang&#x2F;Minecraft</div><br/></div></div><div id="36489098" class="c"><input type="checkbox" id="c-36489098" checked=""/><div class="controls bullet"><span class="by">nabogh</span><span>|</span><a href="#36488707">parent</a><span>|</span><a href="#36490164">prev</a><span>|</span><a href="#36488824">next</a><span>|</span><label class="collapse" for="c-36489098">[-]</label><label class="expand" for="c-36489098">[1 more]</label></div><br/><div class="children"><div class="content">That sounds cool as hell. I was always impressed when I jumped on hypixel just how much custom server work must&#x27;ve gone into it.</div><br/></div></div></div></div><div id="36488824" class="c"><input type="checkbox" id="c-36488824" checked=""/><div class="controls bullet"><span class="by">tehsauce</span><span>|</span><a href="#36488707">prev</a><span>|</span><a href="#36489671">next</a><span>|</span><label class="collapse" for="c-36488824">[-]</label><label class="expand" for="c-36488824">[2 more]</label></div><br/><div class="children"><div class="content">Very excited to see how far minecraft servers can be pushed!<p>If anyone is curious why youâd want to have 1000 players in minecraft, this video documents a pretty amazing example scenario:<p><a href="https:&#x2F;&#x2F;youtu.be&#x2F;zv-TS_mEHE4" rel="nofollow noreferrer">https:&#x2F;&#x2F;youtu.be&#x2F;zv-TS_mEHE4</a></div><br/><div id="36490321" class="c"><input type="checkbox" id="c-36490321" checked=""/><div class="controls bullet"><span class="by">7373737373</span><span>|</span><a href="#36488824">parent</a><span>|</span><a href="#36489671">next</a><span>|</span><label class="collapse" for="c-36490321">[-]</label><label class="expand" for="c-36490321">[1 more]</label></div><br/><div class="children"><div class="content">According to the making of video of this, they are using Multipaper: <a href="https:&#x2F;&#x2F;github.com&#x2F;MultiPaper&#x2F;MultiPaper">https:&#x2F;&#x2F;github.com&#x2F;MultiPaper&#x2F;MultiPaper</a></div><br/></div></div></div></div><div id="36489671" class="c"><input type="checkbox" id="c-36489671" checked=""/><div class="controls bullet"><span class="by">samsquire</span><span>|</span><a href="#36488824">prev</a><span>|</span><a href="#36490411">next</a><span>|</span><label class="collapse" for="c-36489671">[-]</label><label class="expand" for="c-36489671">[1 more]</label></div><br/><div class="children"><div class="content">This is interesting.<p>I am interested in multithreading and parallelism. So I have a journal entry to explore which is about deliberately desynchronizing and resynchronizing game loops for performance.<p>* For the number of clients can use epoll or liburing.<p>* Can multiplex multiple sockets per thread my epoll-server does this.<p>* Can split out recv and send across threads so you can send while receiving and receive while sending<p>* For the game loops can divide the territory covered to a different game loop.<p>My question becomes how do you synchronize game loops across threads, you could latch on each thread for partial causality between game loops.</div><br/></div></div><div id="36490411" class="c"><input type="checkbox" id="c-36490411" checked=""/><div class="controls bullet"><span class="by">josefrichter</span><span>|</span><a href="#36489671">prev</a><span>|</span><a href="#36489109">next</a><span>|</span><label class="collapse" for="c-36490411">[-]</label><label class="expand" for="c-36490411">[1 more]</label></div><br/><div class="children"><div class="content">I know nothing about Minecraft servers, but has anyone tried to build one in Elixir&#x2F;Erlang? Sounds like 1000 players should be a piece of cake.</div><br/></div></div><div id="36489109" class="c"><input type="checkbox" id="c-36489109" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#36490411">prev</a><span>|</span><a href="#36489634">next</a><span>|</span><label class="collapse" for="c-36489109">[-]</label><label class="expand" for="c-36489109">[14 more]</label></div><br/><div class="children"><div class="content">Interesting to see how they scale a multiplayer big world.<p>Not many systems try to do this. Improbable, Minecraft, Second Life, and Roblox are the ones I know about. Almost everybody else shards.<p>Any other examples of really big shared seamless multiplayer worlds?</div><br/><div id="36490393" class="c"><input type="checkbox" id="c-36490393" checked=""/><div class="controls bullet"><span class="by">bibanez</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36489843">next</a><span>|</span><label class="collapse" for="c-36490393">[-]</label><label class="expand" for="c-36490393">[1 more]</label></div><br/><div class="children"><div class="content">In reality, big Minecraft servers like Hypixel that handle 100k+ players also shard. You jump between many different servers seamlessly using something called Bungeecord.</div><br/></div></div><div id="36489843" class="c"><input type="checkbox" id="c-36489843" checked=""/><div class="controls bullet"><span class="by">FeepingCreature</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36490393">prev</a><span>|</span><a href="#36489631">next</a><span>|</span><label class="collapse" for="c-36489843">[-]</label><label class="expand" for="c-36489843">[1 more]</label></div><br/><div class="children"><div class="content">Planetside 2 has hundreds of players on one map and can theoretically scale to thousands, though the networking gets very noticeably worse as you crowd more players into one place.</div><br/></div></div><div id="36489631" class="c"><input type="checkbox" id="c-36489631" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36489843">prev</a><span>|</span><a href="#36489278">next</a><span>|</span><label class="collapse" for="c-36489631">[-]</label><label class="expand" for="c-36489631">[1 more]</label></div><br/><div class="children"><div class="content">Roblox is pretty sharded I think. Lots of little servers.</div><br/></div></div><div id="36489278" class="c"><input type="checkbox" id="c-36489278" checked=""/><div class="controls bullet"><span class="by">gbear605</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36489631">prev</a><span>|</span><a href="#36489587">next</a><span>|</span><label class="collapse" for="c-36489278">[-]</label><label class="expand" for="c-36489278">[1 more]</label></div><br/><div class="children"><div class="content">Runescape has sharded worlds, but the worlds go up to 1500 players, which is decently high.</div><br/></div></div><div id="36489587" class="c"><input type="checkbox" id="c-36489587" checked=""/><div class="controls bullet"><span class="by">simonjgreen</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36489278">prev</a><span>|</span><a href="#36489147">next</a><span>|</span><label class="collapse" for="c-36489587">[-]</label><label class="expand" for="c-36489587">[4 more]</label></div><br/><div class="children"><div class="content">Ultima Online, Star Wars Galaxies, and Planetside</div><br/><div id="36489710" class="c"><input type="checkbox" id="c-36489710" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489587">parent</a><span>|</span><a href="#36489147">next</a><span>|</span><label class="collapse" for="c-36489710">[-]</label><label class="expand" for="c-36489710">[3 more]</label></div><br/><div class="children"><div class="content">Ultima Online is sharded. Biggest shard is ATL, with maybe 150 players.[1]<p>Planetside 2 got up to 2000 or so, and may hold the record for a seamless land world MMO.<p>[1] <a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;ultimaonline&#x2F;comments&#x2F;tr1r6j&#x2F;uo_atlantic_concurrent_players" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;ultimaonline&#x2F;comments&#x2F;tr1r6j&#x2F;uo_atl...</a></div><br/><div id="36490494" class="c"><input type="checkbox" id="c-36490494" checked=""/><div class="controls bullet"><span class="by">Kiro</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489710">parent</a><span>|</span><a href="#36489888">next</a><span>|</span><label class="collapse" for="c-36490494">[-]</label><label class="expand" for="c-36490494">[1 more]</label></div><br/><div class="children"><div class="content">Shards in UO are called that way because of the lore (gem shattered into shards), and each shard is just a regional server completely isolated from other shards. So they are not very different from Minecraft or Planetside servers. Sharding in other games split the user base based on active load. This is not the case with UO.</div><br/></div></div><div id="36489888" class="c"><input type="checkbox" id="c-36489888" checked=""/><div class="controls bullet"><span class="by">progx</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489710">parent</a><span>|</span><a href="#36490494">prev</a><span>|</span><a href="#36489147">next</a><span>|</span><label class="collapse" for="c-36489888">[-]</label><label class="expand" for="c-36489888">[1 more]</label></div><br/><div class="children"><div class="content">Planetside 2 has them on on huge map, but as soon as more player are nearer in one area the system got problems too. Lags, Jumps and wrong running clocks (different speeds an the map). They shard within a server. But PS2 Networking is really good and optimized, better as most current games, and Planetside 1 + 2 (and parts of the Engine) are 20 years old. Most new games are overwhelmed with 64 Players. PS2 can handle 200 on small areas without any problem.</div><br/></div></div></div></div></div></div><div id="36489147" class="c"><input type="checkbox" id="c-36489147" checked=""/><div class="controls bullet"><span class="by">fla</span><span>|</span><a href="#36489109">parent</a><span>|</span><a href="#36489587">prev</a><span>|</span><a href="#36489634">next</a><span>|</span><label class="collapse" for="c-36489147">[-]</label><label class="expand" for="c-36489147">[5 more]</label></div><br/><div class="children"><div class="content">EVE Online</div><br/><div id="36489431" class="c"><input type="checkbox" id="c-36489431" checked=""/><div class="controls bullet"><span class="by">moritonal</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489147">parent</a><span>|</span><a href="#36489634">next</a><span>|</span><label class="collapse" for="c-36489431">[-]</label><label class="expand" for="c-36489431">[4 more]</label></div><br/><div class="children"><div class="content">I believe they shard each sector and their inability to sub-divide their hosting on a sector level has created their infamous timewarped battles?</div><br/><div id="36490390" class="c"><input type="checkbox" id="c-36490390" checked=""/><div class="controls bullet"><span class="by">Cthulhu_</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489431">parent</a><span>|</span><a href="#36489762">next</a><span>|</span><label class="collapse" for="c-36490390">[-]</label><label class="expand" for="c-36490390">[1 more]</label></div><br/><div class="children"><div class="content">Well, at the smallest level (if I recall correctly) it&#x27;s a single solar system; they have a few beefy servers on stand-by, one is always in use for Jita, the main and most active trading hub, and others can be spun up and a whole solar system transferred over if it gets busy. And as someone else pointed out, you can organize a large fight in advance so they can transfer it over.<p>But there&#x27;s the bottleneck, because they can only do the calculations of ship movement &amp; actions on a single node. I&#x27;m sure it&#x27;s been optimized to no end as well. IIRC it&#x27;s written in Python, but that&#x27;s not going to be the main performance bottleneck.<p>I have only the smallest of clues about distributed systems, the only way they could scale it up is to somehow make it so they can run a single solar system or cluster of ships on multiple servers, but for that you get the overhead of inter-server communication or you need an asynchronous, eventually-consistent game instead of something realtime.</div><br/></div></div><div id="36489762" class="c"><input type="checkbox" id="c-36489762" checked=""/><div class="controls bullet"><span class="by">emil0r</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489431">parent</a><span>|</span><a href="#36490390">prev</a><span>|</span><a href="#36489715">next</a><span>|</span><label class="collapse" for="c-36489762">[-]</label><label class="expand" for="c-36489762">[1 more]</label></div><br/><div class="children"><div class="content">Yes, so in that sense it&#x27;s sharded. In another sense it&#x27;s all one server, as you can warp between different systems and meet all the players there in the game. Everything is run on one giant server.<p>Not sure how it is now, but back in 2014-2016 you could inform them of big battles ahead of time for a specific system, at which point they would, in their own words, reinforce the node (moving that particular system to its own allocation of resources). This often was the difference between being able to duke it out in an epic space battle or wait for the system to load while everyone lagged to death.</div><br/></div></div><div id="36489715" class="c"><input type="checkbox" id="c-36489715" checked=""/><div class="controls bullet"><span class="by">Ntrails</span><span>|</span><a href="#36489109">root</a><span>|</span><a href="#36489431">parent</a><span>|</span><a href="#36489762">prev</a><span>|</span><a href="#36489634">next</a><span>|</span><label class="collapse" for="c-36489715">[-]</label><label class="expand" for="c-36489715">[1 more]</label></div><br/><div class="children"><div class="content">Pretty much.  Once you got to 1500+ fleet fights it would originally just drop lots and lots of player actions on the floor as could not cope.<p>Time Dilation came in to run at 1&#x2F;10 game&#x2F;real time ratio, allowing fights to scale better and be a less frustrating experience for participants</div><br/></div></div></div></div></div></div></div></div><div id="36489634" class="c"><input type="checkbox" id="c-36489634" checked=""/><div class="controls bullet"><span class="by">lrem</span><span>|</span><a href="#36489109">prev</a><span>|</span><a href="#36489820">next</a><span>|</span><label class="collapse" for="c-36489634">[-]</label><label class="expand" for="c-36489634">[7 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll just drop this factoid:<p>Mineplex has won the Guinness World Records award on January 28, 2015 for having 34,434 concurrent players, the most on a Minecraft server at the time.</div><br/><div id="36489659" class="c"><input type="checkbox" id="c-36489659" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489634">parent</a><span>|</span><a href="#36490493">next</a><span>|</span><label class="collapse" for="c-36489659">[-]</label><label class="expand" for="c-36489659">[4 more]</label></div><br/><div class="children"><div class="content">This is where things start to get a little fuzzy.<p>Mineplex had the most concurrent players but they weren&#x27;t on a single individual bare metal server or single server jar instance.<p>A lot of large &quot;servers&quot; like Mineplex, Hypixel, etc run a proxy which sits in front of a bunch of other servers. The concept of a &quot;server&quot; can have many meanings in Minecraft so it gets fuzzy quickly.<p>I&#x27;m not sure if this 1,000 person test is a record but I&#x27;m not aware of any other test running so many concurrent players on a single dedicated box with a single instance of Minecraft running. Folia takes advantage of more CPU threads so everyone is in sitting in the same server instance.<p>Hypixel beat out Mineplex later on, BTW.</div><br/><div id="36489706" class="c"><input type="checkbox" id="c-36489706" checked=""/><div class="controls bullet"><span class="by">lrem</span><span>|</span><a href="#36489634">root</a><span>|</span><a href="#36489659">parent</a><span>|</span><a href="#36490493">next</a><span>|</span><label class="collapse" for="c-36489706">[-]</label><label class="expand" for="c-36489706">[3 more]</label></div><br/><div class="children"><div class="content">Ha, nice, thanks. I&#x27;ve never looked into this deeper than accepting the fact that it&#x27;s doable. Now, if only I had the spare time to look into how did they shard the servers...</div><br/><div id="36489765" class="c"><input type="checkbox" id="c-36489765" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489634">root</a><span>|</span><a href="#36489706">parent</a><span>|</span><a href="#36490009">next</a><span>|</span><label class="collapse" for="c-36489765">[-]</label><label class="expand" for="c-36489765">[1 more]</label></div><br/><div class="children"><div class="content">We tend to call those &quot;networks&quot;, when they have a bunch of different gametypes and servers interconnected. At a smaller scale of a few hundred players it&#x27;s pretty easily handled by off the shelf software like Velocity for the proxy and a few server instances running Paper.<p>You generally want good performing (not VPS or &quot;cloud&quot; instances) but you can run a bunch of different worlds and have people with cross server talk, the ability to warp between worlds, etc. Most of the larger networks and nearly all of the smaller networks use a variation of this kind of model.</div><br/></div></div><div id="36490009" class="c"><input type="checkbox" id="c-36490009" checked=""/><div class="controls bullet"><span class="by">AgentK20</span><span>|</span><a href="#36489634">root</a><span>|</span><a href="#36489706">parent</a><span>|</span><a href="#36489765">prev</a><span>|</span><a href="#36490493">next</a><span>|</span><label class="collapse" for="c-36490009">[-]</label><label class="expand" for="c-36490009">[1 more]</label></div><br/><div class="children"><div class="content">ocelotpotpie&#x27;s sibling reply to this has good explanations for the terminology. If you&#x27;re curious to actually see the software:<p>* <a href="https:&#x2F;&#x2F;www.spigotmc.org&#x2F;wiki&#x2F;bungeecord&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.spigotmc.org&#x2F;wiki&#x2F;bungeecord&#x2F;</a> - Older, less-performant but still used by some teams<p>* <a href="https:&#x2F;&#x2F;papermc.io&#x2F;software&#x2F;velocity" rel="nofollow noreferrer">https:&#x2F;&#x2F;papermc.io&#x2F;software&#x2F;velocity</a> - Newer, more performant, maintained by the team that makes Paper, one of the leading performance MC server implementations.<p>For context of scale btw, when Hypixel had 200k+ players online at peak we had something like 2,000+ 1U E3-1271v3&#x27;s each with 32GB RAM, all colo&#x27;d in a single DC in Chicago. Egress is 70-80gbps or so 95th percentile, with most months (at high peak) egressing 10PB&#x2F;mo+ of real-time, uncacheable data.</div><br/></div></div></div></div></div></div><div id="36490493" class="c"><input type="checkbox" id="c-36490493" checked=""/><div class="controls bullet"><span class="by">rasz</span><span>|</span><a href="#36489634">parent</a><span>|</span><a href="#36489659">prev</a><span>|</span><a href="#36489693">next</a><span>|</span><label class="collapse" for="c-36490493">[-]</label><label class="expand" for="c-36490493">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll just drop this factoid:<p>You &quot;win&quot; Guinness World Records by paying for them.</div><br/></div></div></div></div><div id="36489820" class="c"><input type="checkbox" id="c-36489820" checked=""/><div class="controls bullet"><span class="by">haezee</span><span>|</span><a href="#36489634">prev</a><span>|</span><a href="#36488851">next</a><span>|</span><label class="collapse" for="c-36489820">[-]</label><label class="expand" for="c-36489820">[3 more]</label></div><br/><div class="children"><div class="content">While very impressive, something to note:<p>&gt;The server was prepared with a 100k x 100k block pre-generated world. Our custom plugin distributed new players to the least-occupied region.<p>Minecraft chunk generation is notoriously though, and even a few players generating new chunks will bring the TPS down to an unplayable state very fast.</div><br/><div id="36489850" class="c"><input type="checkbox" id="c-36489850" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489820">parent</a><span>|</span><a href="#36489838">next</a><span>|</span><label class="collapse" for="c-36489850">[-]</label><label class="expand" for="c-36489850">[1 more]</label></div><br/><div class="children"><div class="content">(Disclaimer: I&#x27;m on the Paper team, and Paper is the org under which Folia sits.)<p>This is true to an extent, yes. Chunk generation can be real tough. That said, chunk generation has been re-written in Paper, so it&#x27;s substantially faster than vanilla Minecraft.<p>When we did a large scale real player test on a much earlier build of Folia we had ~327 players at peak and we did not generate chunks because we specifically wanted to see how it ran. We didn&#x27;t max out at ~327, we just didn&#x27;t have more joins than that.<p>The project improved a bunch already so that number without chunk generation is very doable to beat if you didn&#x27;t pre-gen any chunks.<p>Generally it&#x27;s free performance to pre-gen your world though. Highly recommended for regular players.</div><br/></div></div><div id="36489838" class="c"><input type="checkbox" id="c-36489838" checked=""/><div class="controls bullet"><span class="by">skerit</span><span>|</span><a href="#36489820">parent</a><span>|</span><a href="#36489850">prev</a><span>|</span><a href="#36488851">next</a><span>|</span><label class="collapse" for="c-36489838">[-]</label><label class="expand" for="c-36489838">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Minecraft chunk generation is notoriously though, and even a few players generating new chunks will bring the TPS down to an unplayable state very fast.<p>And that&#x27;s knowing a big part of the chunk generation already happens off the main thread.</div><br/></div></div></div></div><div id="36488851" class="c"><input type="checkbox" id="c-36488851" checked=""/><div class="controls bullet"><span class="by">dwohnitmok</span><span>|</span><a href="#36489820">prev</a><span>|</span><a href="#36489092">next</a><span>|</span><label class="collapse" for="c-36488851">[-]</label><label class="expand" for="c-36488851">[2 more]</label></div><br/><div class="children"><div class="content">Has anyone made a comparison of Minecraft server performance on ZGC vs Shenandoah vs G1GC on a recent JDK version? I&#x27;m curious whether the amazing GC pause numbers hyped by the latest versions of ZGC hold up (max pause times of 500 <i>micro</i>seconds and averages of 50 microseconds).<p>Also what&#x27;s going on with the generational Shenandoah GC spikes in that graph? There&#x27;s some pretty crazy spikes that completely dominate the pause numbers and make it pretty hard to read the graph. It looks like GC pauses kept increasing up until the server crashed?</div><br/><div id="36488995" class="c"><input type="checkbox" id="c-36488995" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36488851">parent</a><span>|</span><a href="#36489092">next</a><span>|</span><label class="collapse" for="c-36488995">[-]</label><label class="expand" for="c-36488995">[1 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t attest to how valid these benchmarks are, but this explores the topic and is referenced a lot in the community - <a href="https:&#x2F;&#x2F;github.com&#x2F;brucethemoose&#x2F;Minecraft-Performance-Flags-Benchmarks">https:&#x2F;&#x2F;github.com&#x2F;brucethemoose&#x2F;Minecraft-Performance-Flags...</a></div><br/></div></div></div></div><div id="36489092" class="c"><input type="checkbox" id="c-36489092" checked=""/><div class="controls bullet"><span class="by">cjensen</span><span>|</span><a href="#36488851">prev</a><span>|</span><a href="#36489708">next</a><span>|</span><label class="collapse" for="c-36489092">[-]</label><label class="expand" for="c-36489092">[3 more]</label></div><br/><div class="children"><div class="content">Worth mentioning that this requires mods which break many in-game devices. The official in-game behavior was not able to be scaled.<p>That&#x27;s an interesting and legitimate strategy to the scaling problem, but good to know the downsides with the upsides when trying to take lessons from this.</div><br/><div id="36489157" class="c"><input type="checkbox" id="c-36489157" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489092">parent</a><span>|</span><a href="#36489121">next</a><span>|</span><label class="collapse" for="c-36489157">[-]</label><label class="expand" for="c-36489157">[1 more]</label></div><br/><div class="children"><div class="content">(Disclaimer: I&#x27;m on the Paper team, and Paper is the org under which Folia sits.)<p>Paper (and Folia) have differences from &quot;vanilla&quot; (official) Minecraft, which is part of how they improve performance to begin with.<p>So it is true that there are differences from vanilla. Most &quot;in-game devices&quot; - if you mean builds, redstone machines, mob farms, etc - have versions that people have found will work on Paper and Folia. They might require some tweaking but complex redstone and mob farms are definitely very doable.<p>The goal is to have a close-to-vanilla experience while fixing bugs, patching exploits, and improving performance to run more people on a given piece of server hardware.<p>The biggest issue with Folia right now is that it&#x27;s very new so there aren&#x27;t a lot of plugins that support it just yet. That&#x27;s changing every day! And of course it still has some crashing issues because it&#x27;s still in development. :)</div><br/></div></div><div id="36489121" class="c"><input type="checkbox" id="c-36489121" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36489092">parent</a><span>|</span><a href="#36489157">prev</a><span>|</span><a href="#36489708">next</a><span>|</span><label class="collapse" for="c-36489121">[-]</label><label class="expand" for="c-36489121">[1 more]</label></div><br/><div class="children"><div class="content">Do you know any redstone incompatibilities that Folia has that Paper doesn&#x27;t? From what I&#x27;ve heard, the goal is to have very good redstone compatibility, but I haven&#x27;t yet heard much about actual testing with complicated machines.</div><br/></div></div></div></div><div id="36489708" class="c"><input type="checkbox" id="c-36489708" checked=""/><div class="controls bullet"><span class="by">blindriver</span><span>|</span><a href="#36489092">prev</a><span>|</span><a href="#36489817">next</a><span>|</span><label class="collapse" for="c-36489708">[-]</label><label class="expand" for="c-36489708">[8 more]</label></div><br/><div class="children"><div class="content">On a side note, I&#x27;ve been trying to figure out how to write Java mods for server-side vanilla Minecraft server, but there is basically no documentation at all.<p>Is it safe to say that this isn&#x27;t possible? Which flavor of minecraft server is the best documented to write mods for, Spigot?</div><br/><div id="36489779" class="c"><input type="checkbox" id="c-36489779" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36489708">parent</a><span>|</span><a href="#36489727">next</a><span>|</span><label class="collapse" for="c-36489779">[-]</label><label class="expand" for="c-36489779">[3 more]</label></div><br/><div class="children"><div class="content">There are three competing standards right now:<p>- Fabric (and Quilt), which uses a mixins system, a really flexible modding API that can do client and server modification<p>- Paper (and Purpur, Pufferfish, Folia), which is similar to the old-school Bukkit&#x2F;Spigot ecosystem and supports an intuitive API for server-side plugins. If you&#x27;re aiming for &gt;30 concurrent players you really need the sorts of performance patching that Paper comes with out of the box, or some custom-developed equivalent to it.<p>- Forge, which is kinda a general purpose modding API, good for heavy client+server modification like FTB packs<p>I&#x27;d love to green-field everything in Fabric, but the ecosystem is not quite there yet for more serious server setups.</div><br/><div id="36489851" class="c"><input type="checkbox" id="c-36489851" checked=""/><div class="controls bullet"><span class="by">skerit</span><span>|</span><a href="#36489708">root</a><span>|</span><a href="#36489779">parent</a><span>|</span><a href="#36489727">next</a><span>|</span><label class="collapse" for="c-36489851">[-]</label><label class="expand" for="c-36489851">[2 more]</label></div><br/><div class="children"><div class="content">&gt; If you&#x27;re aiming for &gt;30 concurrent players you really need the sorts of performance patching that Paper comes with out of the box, or some custom-developed equivalent to it.<p>Fabric has quite a few performance mods that can achieve the same thing. I launched my new 1.20 map last week, and TPS was hanging on at 40 players without most of them even enabled.</div><br/><div id="36490085" class="c"><input type="checkbox" id="c-36490085" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36489708">root</a><span>|</span><a href="#36489851">parent</a><span>|</span><a href="#36489727">next</a><span>|</span><label class="collapse" for="c-36490085">[-]</label><label class="expand" for="c-36490085">[1 more]</label></div><br/><div class="children"><div class="content">Yep, there are some great performance mods for Fabric. This ecosystem of mods is not quite as thorough as paper, but it is improving over time and there&#x27;s no technical reason Fabric modding can&#x27;t be used to bring about scaled-up Minecraft without hiccups.</div><br/></div></div></div></div></div></div><div id="36489727" class="c"><input type="checkbox" id="c-36489727" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489708">parent</a><span>|</span><a href="#36489779">prev</a><span>|</span><a href="#36489712">next</a><span>|</span><label class="collapse" for="c-36489727">[-]</label><label class="expand" for="c-36489727">[3 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a bit of a distinction in the Minecraft world between &quot;mods&quot; and &quot;plugins&quot;. Even though to the outside perspective they&#x27;re the same thing, the terms are used for two different communities&#x2F;ecosystems, basically.<p>&quot;Plugins&quot; are for bukkit-based compatible servers, like Spigot and Paper (and Folia, with some modifications).<p>&quot;Mods&quot; are more for forge, sponge, etc servers.<p>So you can kinda pick which direction you want to go. But the Paper project has a ton of API documentation and a few Github repos to even get you started writing your own plugins. The Discord server has a dev help channel with people happy to answer any questions.<p>The Sponge team has a similar setup as well if that&#x27;s the route you&#x27;d like to go.</div><br/><div id="36489799" class="c"><input type="checkbox" id="c-36489799" checked=""/><div class="controls bullet"><span class="by">bredren</span><span>|</span><a href="#36489708">root</a><span>|</span><a href="#36489727">parent</a><span>|</span><a href="#36489712">next</a><span>|</span><label class="collapse" for="c-36489799">[-]</label><label class="expand" for="c-36489799">[2 more]</label></div><br/><div class="children"><div class="content">Are any of these choices restricted in their existing or likely future compatibility with where Microsoft is taking the game?<p>My understanding is server admins will spend money on mods &#x2F; plugins.  Are there any server types more likely to garner paid license or plugins?</div><br/><div id="36489875" class="c"><input type="checkbox" id="c-36489875" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489708">root</a><span>|</span><a href="#36489799">parent</a><span>|</span><a href="#36489712">next</a><span>|</span><label class="collapse" for="c-36489875">[-]</label><label class="expand" for="c-36489875">[1 more]</label></div><br/><div class="children"><div class="content">Microsoft has struct rules about the stuff you can sell for the server, and servers need to be EULA compliant. If they aren&#x27;t they can get blacklisted or shutdown.<p>People do buy plugins but the vast majority of the plugins you&#x27;d want to use are free open source plugins. A lot of the paid&#x2F;closed source stuff is kinda crappy or misleading anyway.<p>You can run a great server using free plugins and software. It might not be a money maker, but if your goal is to have people play and have fun and not buy stuff it&#x27;s super easy and doable.<p>People do still donate to projects to support the authors who make the wheels spin.</div><br/></div></div></div></div></div></div><div id="36489712" class="c"><input type="checkbox" id="c-36489712" checked=""/><div class="controls bullet"><span class="by">whatsthatabout</span><span>|</span><a href="#36489708">parent</a><span>|</span><a href="#36489727">prev</a><span>|</span><a href="#36489817">next</a><span>|</span><label class="collapse" for="c-36489712">[-]</label><label class="expand" for="c-36489712">[1 more]</label></div><br/><div class="children"><div class="content">Its paper nowadays :)
<a href="https:&#x2F;&#x2F;papermc.io" rel="nofollow noreferrer">https:&#x2F;&#x2F;papermc.io</a></div><br/></div></div></div></div><div id="36489817" class="c"><input type="checkbox" id="c-36489817" checked=""/><div class="controls bullet"><span class="by">bullen</span><span>|</span><a href="#36489708">prev</a><span>|</span><a href="#36489352">next</a><span>|</span><label class="collapse" for="c-36489817">[-]</label><label class="expand" for="c-36489817">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.twitch.tv&#x2F;videos&#x2F;1849538310" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.twitch.tv&#x2F;videos&#x2F;1849538310</a><p>No comment.</div><br/><div id="36490036" class="c"><input type="checkbox" id="c-36490036" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489817">parent</a><span>|</span><a href="#36489352">next</a><span>|</span><label class="collapse" for="c-36490036">[-]</label><label class="expand" for="c-36490036">[1 more]</label></div><br/><div class="children"><div class="content">(Disclaimer: I&#x27;m on the Paper team, and Paper is the org under which Folia sits)<p>I didn&#x27;t watch the stream because I was offline when it happened, but I just want to note that the test was run by someone not on the Paper team who got tubbo to stream it, which is how they got so many players. It can be tricky to get enough players for such a large test, so it made sense for cubxity to pair up with someone to get more players.<p>Twitch can get pretty funky, especially twitch chat, so hopefully there&#x27;s nothing &quot;bad&quot; in that video, though.</div><br/></div></div></div></div><div id="36489352" class="c"><input type="checkbox" id="c-36489352" checked=""/><div class="controls bullet"><span class="by">Nican</span><span>|</span><a href="#36489817">prev</a><span>|</span><a href="#36489538">next</a><span>|</span><label class="collapse" for="c-36489352">[-]</label><label class="expand" for="c-36489352">[2 more]</label></div><br/><div class="children"><div class="content">It would be interesting to have blog posts about the optimizations that were made.</div><br/><div id="36489434" class="c"><input type="checkbox" id="c-36489434" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36489352">parent</a><span>|</span><a href="#36489538">next</a><span>|</span><label class="collapse" for="c-36489434">[-]</label><label class="expand" for="c-36489434">[1 more]</label></div><br/><div class="children"><div class="content">If you want to read more, some technical details that were previously only covered by scattered blog posts and github gists have been consolidated into the project&#x27;s documentation - <a href="https:&#x2F;&#x2F;docs.papermc.io&#x2F;folia&#x2F;reference&#x2F;overview" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.papermc.io&#x2F;folia&#x2F;reference&#x2F;overview</a></div><br/></div></div></div></div><div id="36489538" class="c"><input type="checkbox" id="c-36489538" checked=""/><div class="controls bullet"><span class="by">d--b</span><span>|</span><a href="#36489352">prev</a><span>|</span><a href="#36488832">next</a><span>|</span><label class="collapse" for="c-36489538">[-]</label><label class="expand" for="c-36489538">[2 more]</label></div><br/><div class="children"><div class="content">Honest question: is that a lot?</div><br/><div id="36489592" class="c"><input type="checkbox" id="c-36489592" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36489538">parent</a><span>|</span><a href="#36488832">next</a><span>|</span><label class="collapse" for="c-36489592">[-]</label><label class="expand" for="c-36489592">[1 more]</label></div><br/><div class="children"><div class="content">Most servers with the latest CPUs can only handle a few hundred players without bogging down, so yeah it&#x27;s a fair bit.</div><br/></div></div></div></div><div id="36488832" class="c"><input type="checkbox" id="c-36488832" checked=""/><div class="controls bullet"><span class="by">rasz</span><span>|</span><a href="#36489538">prev</a><span>|</span><a href="#36489150">next</a><span>|</span><label class="collapse" for="c-36488832">[-]</label><label class="expand" for="c-36488832">[13 more]</label></div><br/><div class="children"><div class="content">&gt;Players were spread into 49 different teams across the map. Each team consisted of around 20 players.<p>How is that different from sharding into mini 20 player servers? I was hoping for 1000 players all in visual range :)<p>Eve Online record is &gt;6000 players all in visual range, but they cheat by lowering server tick from 1Hz down to 0.1Hz <a href="https:&#x2F;&#x2F;wiki.eveuniversity.org&#x2F;Time_dilation" rel="nofollow noreferrer">https:&#x2F;&#x2F;wiki.eveuniversity.org&#x2F;Time_dilation</a></div><br/><div id="36489087" class="c"><input type="checkbox" id="c-36489087" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36488832">parent</a><span>|</span><a href="#36488890">next</a><span>|</span><label class="collapse" for="c-36489087">[-]</label><label class="expand" for="c-36489087">[1 more]</label></div><br/><div class="children"><div class="content">(Disclaimer: I&#x27;m on the Paper team, and Paper is the org under which Folia sits)<p>AgentK20 explained the technical bits along with the other reply to you, but basically the &quot;actually all in one world&quot; is the big part. For sharding you&#x27;re handing players off to different instances. With Folia someone can just walk from one person to another without any issue or lag.<p>Folia dynamically groups people into regions depending on their distance. So it was designed to have people spread out to be able to support many regions across many threads. You <i>can</i> put 1000 people in one spot, it just gets very unhappy and you&#x27;re now not really taking advantage of the whole point of Folia.<p>It&#x27;s not a solution for every server or person but it&#x27;s definitely cool because it&#x27;s another tool in the Minecraft tool box. And the API is very similar to Paper, whereas the sharded options start to get kinda tricky quickly.</div><br/></div></div><div id="36488890" class="c"><input type="checkbox" id="c-36488890" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36488832">parent</a><span>|</span><a href="#36489087">prev</a><span>|</span><a href="#36489063">next</a><span>|</span><label class="collapse" for="c-36488890">[-]</label><label class="expand" for="c-36488890">[3 more]</label></div><br/><div class="children"><div class="content">As I understand, Folia can&#x27;t help you if all your players are bunched together, but unlike having separate servers connected by Velocity or Bungee, it is a seamless experience -- everyone is in the same world and can visit anyone else without having to use commands, go through portals, or even wait for a loading screen. The &quot;bubbles&quot; that make up the world merge and split seamlessly, with special attention paid to avoid breaking vanilla game mechanics.<p>[Speculation, I don&#x27;t have the data and wasn&#x27;t involved in the test] The test placed each &#x27;team&#x27; 10240 blocks apart, which is close enough for a ~30 minute walk to get to another team (~4 minutes if you take the nether), so I assume a lot of bubble merging&#x2F;splitting happened. It&#x27;s also far enough away that, if the regionizing logic allows for it, you&#x27;re split off onto another thread relatively early into your journey to visit another &#x27;team&#x27; spawnpoint. This is a relatively realistic scenario for an SMP, where towns are usually 2,000 to 20,000 blocks apart.</div><br/><div id="36489682" class="c"><input type="checkbox" id="c-36489682" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36488890">parent</a><span>|</span><a href="#36489063">next</a><span>|</span><label class="collapse" for="c-36489682">[-]</label><label class="expand" for="c-36489682">[2 more]</label></div><br/><div class="children"><div class="content">Tbf âa ~30 minute walk to get to another team (~4 minutes if you take the nether)â doesnt seem very seamless to me. Thatâs quite a commute!</div><br/><div id="36490405" class="c"><input type="checkbox" id="c-36490405" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489682">parent</a><span>|</span><a href="#36489063">next</a><span>|</span><label class="collapse" for="c-36490405">[-]</label><label class="expand" for="c-36490405">[1 more]</label></div><br/><div class="children"><div class="content">Hah. On 2b2t, an &quot;anarchy&quot; server where any player can blow up any build and type whatever garbage into chat they want, players often opt to travel out tens of millions of blocks in an effort to make their builds extremely difficult to find. Can take many hours of nether travel to get to where you want to go.<p>And inevitably, people still find them, usually through advanced techniques -- hacks that tell you whether a chunk is newly generated or part of an existing &#x27;chunk trail&#x27; can be used to hunt down players that have taken great effort to hide their location.<p>Anyways, a distance of 10240 is just how this particular test was set up. The regionizing is still useful in a much cozier world. As I understand the only way for it to be guaranteed that everyone is inside the same bubble (and therefore the ticking is all on a single thread) is for everyone to be in the same 768 block radius. It&#x27;s rather atypical for a server to organically develop this way, since people really like to explore for hours before settling in <i>the perfect spot</i>. But some heavily planned&#x2F;curated server are like this.</div><br/></div></div></div></div></div></div><div id="36489063" class="c"><input type="checkbox" id="c-36489063" checked=""/><div class="controls bullet"><span class="by">AgentK20</span><span>|</span><a href="#36488832">parent</a><span>|</span><a href="#36488890">prev</a><span>|</span><a href="#36489212">next</a><span>|</span><label class="collapse" for="c-36489063">[-]</label><label class="expand" for="c-36489063">[6 more]</label></div><br/><div class="children"><div class="content">Keep in mind that the entities-in-viewing-range scales quadratically with players. 10 players in view distance is (at 20 ticks per second) 180 packets per second *per player*, or ~2k pps on the server. 100 players, ~200k pps. 1000 players, ~20m pps. All on a single Java thread, hence why Minecraft typically performs better on high clock-speed low(er) core count CPUs. Folia splits the load for the world into multiple threads, but only on a per-region basis, with each 512x512 being (potentially) on a different thread.<p>EDIT: Correction, as doctor_phil points out that&#x27;s a quadratic scale not an exponential scale. Derp.</div><br/><div id="36489159" class="c"><input type="checkbox" id="c-36489159" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489063">parent</a><span>|</span><a href="#36489254">next</a><span>|</span><label class="collapse" for="c-36489159">[-]</label><label class="expand" for="c-36489159">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Folia splits the load for the world into multiple threads, but only on a per-region basis, with each 512x512 being (potentially) on a different thread.<p>A small correction - Folia regions are not Minecraft regions. They don&#x27;t necessarily align with the 512x512 region grid, and can take different shapes and sizes depending on what the regionizing algorithm is doing. The term &quot;bubble&quot; is used in some of the documentation and may be a more accurate description.</div><br/><div id="36489491" class="c"><input type="checkbox" id="c-36489491" checked=""/><div class="controls bullet"><span class="by">AgentK20</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489159">parent</a><span>|</span><a href="#36489254">next</a><span>|</span><label class="collapse" for="c-36489491">[-]</label><label class="expand" for="c-36489491">[2 more]</label></div><br/><div class="children"><div class="content">Ohhh, very interesting. I&#x27;ll admit I only took a cursory glance at the code when it was first announced on the Paper discord since I&#x27;m not as much involved with MC anymore, but that&#x27;s good to know. I&#x27;ll need to dive in again one of these days.</div><br/><div id="36489602" class="c"><input type="checkbox" id="c-36489602" checked=""/><div class="controls bullet"><span class="by">ocelotpotpie</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489491">parent</a><span>|</span><a href="#36489254">next</a><span>|</span><label class="collapse" for="c-36489602">[-]</label><label class="expand" for="c-36489602">[1 more]</label></div><br/><div class="children"><div class="content">Come back to the Discord and pepper away with questions!</div><br/></div></div></div></div></div></div><div id="36489254" class="c"><input type="checkbox" id="c-36489254" checked=""/><div class="controls bullet"><span class="by">doctor_phil</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489063">parent</a><span>|</span><a href="#36489159">prev</a><span>|</span><a href="#36489494">next</a><span>|</span><label class="collapse" for="c-36489254">[-]</label><label class="expand" for="c-36489254">[1 more]</label></div><br/><div class="children"><div class="content">That scaling sounds quadratic and not exponential.</div><br/></div></div></div></div><div id="36489212" class="c"><input type="checkbox" id="c-36489212" checked=""/><div class="controls bullet"><span class="by">imtringued</span><span>|</span><a href="#36488832">parent</a><span>|</span><a href="#36489063">prev</a><span>|</span><a href="#36489150">next</a><span>|</span><label class="collapse" for="c-36489212">[-]</label><label class="expand" for="c-36489212">[2 more]</label></div><br/><div class="children"><div class="content">That is a completely different problem that is mostly bottlenecked by bandwidth and not CPU time. Every players data has to be sent to every other player. This requires a CDN like architecture to increase bandwidth.</div><br/><div id="36489324" class="c"><input type="checkbox" id="c-36489324" checked=""/><div class="controls bullet"><span class="by">rasz</span><span>|</span><a href="#36488832">root</a><span>|</span><a href="#36489212">parent</a><span>|</span><a href="#36489150">next</a><span>|</span><label class="collapse" for="c-36489324">[-]</label><label class="expand" for="c-36489324">[1 more]</label></div><br/><div class="children"><div class="content">Sure you need fast tick updates for dynamic models right in front of you, but something ~100 virtual meters away? can at least halve it, 500m maybe even 1&#x2F;10 will suffice.</div><br/></div></div></div></div></div></div><div id="36489150" class="c"><input type="checkbox" id="c-36489150" checked=""/><div class="controls bullet"><span class="by">stevefan1999</span><span>|</span><a href="#36488832">prev</a><span>|</span><label class="collapse" for="c-36489150">[-]</label><label class="expand" for="c-36489150">[3 more]</label></div><br/><div class="children"><div class="content">What about ZGC?</div><br/><div id="36489388" class="c"><input type="checkbox" id="c-36489388" checked=""/><div class="controls bullet"><span class="by">tehbeard</span><span>|</span><a href="#36489150">parent</a><span>|</span><label class="collapse" for="c-36489388">[-]</label><label class="expand" for="c-36489388">[2 more]</label></div><br/><div class="children"><div class="content">Somewhat orthogonal to what Folia is doing, and already explored by the community.<p>Folia&#x27;s main trick is to dynamically split the &quot;main game tick loop&quot;, where logic and actions are processed into several threads based on location.<p>Such that processing for say a mob farm in the South of the map does not impede on processing for a hopper based storage system in the North West etc.<p>This doesn&#x27;t solve the everyone&#x27;s at one place problem (or &quot;Jita problem&quot;, in EvE online parlance) but does solve some issues with populated servers where player density isn&#x27;t extreme.</div><br/><div id="36489726" class="c"><input type="checkbox" id="c-36489726" checked=""/><div class="controls bullet"><span class="by">birracerveza</span><span>|</span><a href="#36489150">root</a><span>|</span><a href="#36489388">parent</a><span>|</span><label class="collapse" for="c-36489726">[-]</label><label class="expand" for="c-36489726">[1 more]</label></div><br/><div class="children"><div class="content">Is there a solution for the Jita problem that isn&#x27;t just beefing up the server?</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>