<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1695459660752" as="style"/><link rel="stylesheet" href="styles.css?v=1695459660752"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cloudnative-pg.io/">CloudNativePG – Postgres Operator for Kubernetes</a> <span class="domain">(<a href="https://cloudnative-pg.io">cloudnative-pg.io</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>98 comments</span></div><br/><div><div id="37621510" class="c"><input type="checkbox" id="c-37621510" checked=""/><div class="controls bullet"><span class="by">dmeijboom</span><span>|</span><a href="#37618257">next</a><span>|</span><label class="collapse" for="c-37621510">[-]</label><label class="expand" for="c-37621510">[2 more]</label></div><br/><div class="children"><div class="content">We’ve been using Zalando’s Postgres Operator before in production and we recently switched to cloudnative-pg. We didn’t experience any issues so far and I’m a big fan of their design choices (where you have a single user, single database for each micro-service that requires one).</div><br/><div id="37621647" class="c"><input type="checkbox" id="c-37621647" checked=""/><div class="controls bullet"><span class="by">Already__Taken</span><span>|</span><a href="#37621510">parent</a><span>|</span><a href="#37618257">next</a><span>|</span><label class="collapse" for="c-37621647">[-]</label><label class="expand" for="c-37621647">[1 more]</label></div><br/><div class="children"><div class="content">I used zalando and surprisingly hit a bunch of config issues where the backups won&#x27;t run on an s3 endpoint that isn&#x27;t aws or wal-e now wont run because it&#x27;s got no db credentials but does the seaweed endpoint. 
now my one db-one user-one pod &quot;cluster&quot; is dead because it won&#x27;t elect itself leader. I simply cannot kick it correctly to revive it.</div><br/></div></div></div></div><div id="37618257" class="c"><input type="checkbox" id="c-37618257" checked=""/><div class="controls bullet"><span class="by">out-of-ideas</span><span>|</span><a href="#37621510">prev</a><span>|</span><a href="#37619545">next</a><span>|</span><label class="collapse" for="c-37618257">[-]</label><label class="expand" for="c-37618257">[3 more]</label></div><br/><div class="children"><div class="content">&gt; <i>The Kubernetes way</i>
to me, this translates into: a really complicated mess of manifests of layers-of-layers of fun, but hidden in an attempt to make it <i>easy</i>; but when it does work in the simplest forms, it works great.<p>if any lesson ive learned; let kubernetes manage only things that wont shoot yourself in the foot with; you wont know until you try :)</div><br/><div id="37620224" class="c"><input type="checkbox" id="c-37620224" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37618257">parent</a><span>|</span><a href="#37619545">next</a><span>|</span><label class="collapse" for="c-37620224">[-]</label><label class="expand" for="c-37620224">[2 more]</label></div><br/><div class="children"><div class="content">Marking your data pvc with retention: retain is a good start :)</div><br/><div id="37620498" class="c"><input type="checkbox" id="c-37620498" checked=""/><div class="controls bullet"><span class="by">hardwaresofton</span><span>|</span><a href="#37618257">root</a><span>|</span><a href="#37620224">parent</a><span>|</span><a href="#37619545">next</a><span>|</span><label class="collapse" for="c-37620498">[-]</label><label class="expand" for="c-37620498">[1 more]</label></div><br/><div class="children"><div class="content">Surely you mean making the default for the storage class :)<p>Running out of space &gt; losing data</div><br/></div></div></div></div></div></div><div id="37619545" class="c"><input type="checkbox" id="c-37619545" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#37618257">prev</a><span>|</span><a href="#37619013">next</a><span>|</span><label class="collapse" for="c-37619545">[-]</label><label class="expand" for="c-37619545">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>CloudNativePG: A New Open-Source Kubernetes Operator for Postgres</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31366983">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31366983</a> - May 2022 (11 comments)<p>Related a bit more loosely:<p><i>Why we moved from AWS RDS to Postgres in Kubernetes</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=32986325">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=32986325</a> - Sept 2022 (145 comments)<p><i>Encrypting Postgres Data at Rest in Kubernetes</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=29057505">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=29057505</a> - Oct 2021 (40 comments)<p><i>Show HN: StackGres: open-source Postgres-aaS on Kubernetes with 120 Extensions</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28865432">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28865432</a> - Oct 2021 (3 comments)<p><i>Running Postgres in Kubernetes [pdf]</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=23682450">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=23682450</a> - June 2020 (100 comments)<p><i>Should I Run Postgres on Kubernetes?</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17512496">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=17512496</a> - July 2018 (2 comments)</div><br/></div></div><div id="37619013" class="c"><input type="checkbox" id="c-37619013" checked=""/><div class="controls bullet"><span class="by">master_crab</span><span>|</span><a href="#37619545">prev</a><span>|</span><a href="#37619610">next</a><span>|</span><label class="collapse" for="c-37619013">[-]</label><label class="expand" for="c-37619013">[14 more]</label></div><br/><div class="children"><div class="content">Kubernetes: a complicated orchestration system that runs stateless applications brilliantly (after six months of work from your infra engineers).<p>Postgres: the very definition of a stateful service.<p>Those two sound like perfect stablemates.</div><br/><div id="37619029" class="c"><input type="checkbox" id="c-37619029" checked=""/><div class="controls bullet"><span class="by">figmert</span><span>|</span><a href="#37619013">parent</a><span>|</span><a href="#37619921">next</a><span>|</span><label class="collapse" for="c-37619029">[-]</label><label class="expand" for="c-37619029">[8 more]</label></div><br/><div class="children"><div class="content">Your definition of Kubernetes is accurate for maybe 5 years ago. These days Kubernetes is perfectly capable of running stateful services and supports them as a first class citizen.</div><br/><div id="37621077" class="c"><input type="checkbox" id="c-37621077" checked=""/><div class="controls bullet"><span class="by">rjzzleep</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619029">parent</a><span>|</span><a href="#37619127">next</a><span>|</span><label class="collapse" for="c-37621077">[-]</label><label class="expand" for="c-37621077">[2 more]</label></div><br/><div class="children"><div class="content">Whenever someone runs Kubernetes onprem I tell them to buy a TrueNAS or another cheap SAN. A cheap SAN costs as much as a DevOps expert setting up your Ceph infrastructure and a lot less when you actually run into issues with that software defined storage solution.<p>Once you do that Kubernetes is actually quite nice, because  it gives you a base configuration of postgres that comes with automatic backup setup etc.<p>That advice is rarely taken though ...</div><br/><div id="37621498" class="c"><input type="checkbox" id="c-37621498" checked=""/><div class="controls bullet"><span class="by">ahoka</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37621077">parent</a><span>|</span><a href="#37619127">next</a><span>|</span><label class="collapse" for="c-37621498">[-]</label><label class="expand" for="c-37621498">[1 more]</label></div><br/><div class="children"><div class="content">Solid advice. What driver&#x2F;provisioner works fine for this?</div><br/></div></div></div></div><div id="37619127" class="c"><input type="checkbox" id="c-37619127" checked=""/><div class="controls bullet"><span class="by">crabbone</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619029">parent</a><span>|</span><a href="#37621077">prev</a><span>|</span><a href="#37619921">next</a><span>|</span><label class="collapse" for="c-37619127">[-]</label><label class="expand" for="c-37619127">[5 more]</label></div><br/><div class="children"><div class="content">Nothing can be further from the truth.<p>Kubernetes has nothing to offer to anyone that wants to work with storage (but there&#x27;s a myriad of CSIs).<p>Here, let me give you an example of a system that offers storage in a similar way to how Kubernetes offers... well, it isn&#x27;t really that good at offering compute, but, at least it kind of does it.  So, Ceph -- that&#x27;s something that <i>makes sense</i> to run PostgreSQL on (it&#x27;s a storage provider).  Kubernetes isn&#x27;t a storage provider.  It doesn&#x27;t know how to manage it even...<p>I.e. if you think that you run PosgreSQL on Kubernetes -- you are mistaken.  Something else does it.  Kubernetes is a proxy there, at best (but probably is completely irrelevant).</div><br/><div id="37619405" class="c"><input type="checkbox" id="c-37619405" checked=""/><div class="controls bullet"><span class="by">erulabs</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619127">parent</a><span>|</span><a href="#37619396">next</a><span>|</span><label class="collapse" for="c-37619405">[-]</label><label class="expand" for="c-37619405">[1 more]</label></div><br/><div class="children"><div class="content">To quote you: “nothing could be further from the truth”<p>Ceph itself runs very well on K8s - see the Rook project.<p>Of course you can run psql on k8s. Psql doesn’t need a storage orchestration system - hell it technically doesn’t <i>need</i> any storage at all!</div><br/></div></div><div id="37619396" class="c"><input type="checkbox" id="c-37619396" checked=""/><div class="controls bullet"><span class="by">qaq</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619127">parent</a><span>|</span><a href="#37619405">prev</a><span>|</span><a href="#37619921">next</a><span>|</span><label class="collapse" for="c-37619396">[-]</label><label class="expand" for="c-37619396">[3 more]</label></div><br/><div class="children"><div class="content">Look at benchmarks of Postgres on Ceph</div><br/><div id="37619512" class="c"><input type="checkbox" id="c-37619512" checked=""/><div class="controls bullet"><span class="by">crabbone</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619396">parent</a><span>|</span><a href="#37619921">next</a><span>|</span><label class="collapse" for="c-37619512">[-]</label><label class="expand" for="c-37619512">[2 more]</label></div><br/><div class="children"><div class="content">Part of my job is to measure storage performance...<p>I can tell you at leas this: there cannot be a meaningful &quot;benchmark of Postgres on Ceph&quot;.  Too many things will influence the benchmark way too much.  You need to be a lot more specific when you talk about such benchmarks.  Here are some things you will need to present:<p>* Are OSDs connected to the node being tested through network or are they closer (NVMe &#x2F; SAS &#x2F; SATA?).  If network, what&#x27;s the bandwidth?  What&#x27;s the latency?  What if it&#x27;s stuff like reliable Ethernet that&#x27;s used for iSCSI &#x2F; NVMe over IP or something like that?<p>* How much memory (relative to data at rest) does the node have?<p>* What is the layout of memory buffers in PostgreSQL?<p>* What is the setting used for synchronization in PostgreSQL?<p>* How much replication is going to happen (Ceph pool size)?<p>* Block sizes and frame sizes.<p>* Type of workload.  Surprisingly, some queries can exploit parallelism in I&#x2F;O while other queries cannot.  Surprisingly some queries will need a lot of synchronization while others don&#x27;t.<p>And there&#x27;s more, it would be too tedious to try to give an exhaustive list of things to control for.  And the problem is, at least those mentioned here can influence performance sometimes up to an order of magnitude, sometimes two orders of magnitude...</div><br/><div id="37621087" class="c"><input type="checkbox" id="c-37621087" checked=""/><div class="controls bullet"><span class="by">rjzzleep</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619512">parent</a><span>|</span><a href="#37619921">next</a><span>|</span><label class="collapse" for="c-37621087">[-]</label><label class="expand" for="c-37621087">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve run into all of these issues. In the end it&#x27;s much cheaper to just buy a cheap SAN than it is probably to pay a month of your expertise.<p>I guess that&#x27;s why I struggle making cash-cow consulting gigs, because my clients are never long term dependent on me.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37619921" class="c"><input type="checkbox" id="c-37619921" checked=""/><div class="controls bullet"><span class="by">oooyay</span><span>|</span><a href="#37619013">parent</a><span>|</span><a href="#37619029">prev</a><span>|</span><a href="#37619598">next</a><span>|</span><label class="collapse" for="c-37619921">[-]</label><label class="expand" for="c-37619921">[3 more]</label></div><br/><div class="children"><div class="content">I run a stateful metadata cache on Kubernetes with a StatefulSet and EBS as block storage. It runs SQLite just fine.<p>As for the &quot;setting up Kubernetes&quot; comment, I think that could be true of Kubernetes years ago. Nowadays Platform Engineers generally build on its capabilities continually, and by the time a user is using it to schedule network, compute, and storage the setup for an application maybe takes a day or so without a template. Most of the platform engineering work I&#x27;ve done on Kubernetes had much more to do with lifecycle management than paining myself over initial provisioning.</div><br/><div id="37621399" class="c"><input type="checkbox" id="c-37621399" checked=""/><div class="controls bullet"><span class="by">antonvs</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619921">parent</a><span>|</span><a href="#37621476">next</a><span>|</span><label class="collapse" for="c-37621399">[-]</label><label class="expand" for="c-37621399">[1 more]</label></div><br/><div class="children"><div class="content">&gt; EBS as block storage<p>We do the equivalent on GCP. A lot of the criticism about Kubernetes storage seems to come from people using it onprem.<p>In that context, I can well imagine that it&#x27;s a PITA to set up well. As rjzzleep commented in this thread:<p>&gt; Whenever someone runs Kubernetes onprem I tell them to buy a TrueNAS or another cheap SAN. A cheap SAN costs as much as a DevOps expert setting up your Ceph infrastructure and a lot less when you actually run into issues with that software defined storage solution. Once you do that Kubernetes is actually quite nice</div><br/></div></div><div id="37621476" class="c"><input type="checkbox" id="c-37621476" checked=""/><div class="controls bullet"><span class="by">ahoka</span><span>|</span><a href="#37619013">root</a><span>|</span><a href="#37619921">parent</a><span>|</span><a href="#37621399">prev</a><span>|</span><a href="#37619598">next</a><span>|</span><label class="collapse" for="c-37621476">[-]</label><label class="expand" for="c-37621476">[1 more]</label></div><br/><div class="children"><div class="content">Why do you use a StatefulSet? I assume every instance has it own volume with its own sqlite and that backs the cache. Why not just Deployment? Failover would be easier in that case.</div><br/></div></div></div></div><div id="37619598" class="c"><input type="checkbox" id="c-37619598" checked=""/><div class="controls bullet"><span class="by">getrealyall</span><span>|</span><a href="#37619013">parent</a><span>|</span><a href="#37619921">prev</a><span>|</span><a href="#37619844">next</a><span>|</span><label class="collapse" for="c-37619598">[-]</label><label class="expand" for="c-37619598">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s okay, your managed Kubernetes provider also just happens to sell a managed database service! Isn&#x27;t that convenient?</div><br/></div></div><div id="37619844" class="c"><input type="checkbox" id="c-37619844" checked=""/><div class="controls bullet"><span class="by">spion</span><span>|</span><a href="#37619013">parent</a><span>|</span><a href="#37619598">prev</a><span>|</span><a href="#37619610">next</a><span>|</span><label class="collapse" for="c-37619844">[-]</label><label class="expand" for="c-37619844">[1 more]</label></div><br/><div class="children"><div class="content">More like six days lately.</div><br/></div></div></div></div><div id="37619610" class="c"><input type="checkbox" id="c-37619610" checked=""/><div class="controls bullet"><span class="by">brightball</span><span>|</span><a href="#37619013">prev</a><span>|</span><a href="#37619324">next</a><span>|</span><label class="collapse" for="c-37619610">[-]</label><label class="expand" for="c-37619610">[2 more]</label></div><br/><div class="children"><div class="content">Definitely useful for non-prod environments. I don’t want my production database sharing infrastructure with anything if I can avoid it though.</div><br/><div id="37620254" class="c"><input type="checkbox" id="c-37620254" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#37619610">parent</a><span>|</span><a href="#37619324">next</a><span>|</span><label class="collapse" for="c-37620254">[-]</label><label class="expand" for="c-37620254">[1 more]</label></div><br/><div class="children"><div class="content">If you really care, just taint the workers you want the database to run on.</div><br/></div></div></div></div><div id="37619324" class="c"><input type="checkbox" id="c-37619324" checked=""/><div class="controls bullet"><span class="by">rlex</span><span>|</span><a href="#37619610">prev</a><span>|</span><a href="#37618359">next</a><span>|</span><label class="collapse" for="c-37619324">[-]</label><label class="expand" for="c-37619324">[3 more]</label></div><br/><div class="children"><div class="content">I never ran postgres in prod in k8s, but i used cloudnative-pg for some light, non-critical loads, dev&#x2F;stg stuff. It works and it&#x27;s fast, recovery just works (unlike zalando, which refuses to operate with anything but AWS s3). I also reported few minor bugs to cnpg team and they fixed them in no time.</div><br/><div id="37620902" class="c"><input type="checkbox" id="c-37620902" checked=""/><div class="controls bullet"><span class="by">rubenv</span><span>|</span><a href="#37619324">parent</a><span>|</span><a href="#37620541">next</a><span>|</span><label class="collapse" for="c-37620902">[-]</label><label class="expand" for="c-37620902">[1 more]</label></div><br/><div class="children"><div class="content">Using the Zalando operator to send to Minio over here.<p>No problems at all so perhaps what you ran into has since been fixed?</div><br/></div></div><div id="37620541" class="c"><input type="checkbox" id="c-37620541" checked=""/><div class="controls bullet"><span class="by">nullify88</span><span>|</span><a href="#37619324">parent</a><span>|</span><a href="#37620902">prev</a><span>|</span><a href="#37618359">next</a><span>|</span><label class="collapse" for="c-37620541">[-]</label><label class="expand" for="c-37620541">[1 more]</label></div><br/><div class="children"><div class="content">We&#x27;re using the Zalando operator. We have our wals and base backups shipped to Azure Storage Blob. Not sure where this S3 only thing comes from. Can you exllain further?</div><br/></div></div></div></div><div id="37618359" class="c"><input type="checkbox" id="c-37618359" checked=""/><div class="controls bullet"><span class="by">deathanatos</span><span>|</span><a href="#37619324">prev</a><span>|</span><a href="#37618973">next</a><span>|</span><label class="collapse" for="c-37618359">[-]</label><label class="expand" for="c-37618359">[8 more]</label></div><br/><div class="children"><div class="content">Do I need an operator, though?<p>I&#x27;d definitely take something over the insanity that is managed services and constant ticket filing with the cloud vendors, but my gut says I just need a Helm chart that makes it decently easy to, a.) bring up PG &amp; some replicas that hopefully have a decent consistency story and b.) a backup job that can write to S3 et al.<p>I need a better &quot;seduce to use&quot; for a CRD for Postgres, I guess.<p>&quot;It doesn’t rely on statefulsets [and manages disks itself]&quot; and &quot;The Kubernetes way&quot; (and dark red on blue, yeesh) … just doesn&#x27;t inspire me?</div><br/><div id="37618780" class="c"><input type="checkbox" id="c-37618780" checked=""/><div class="controls bullet"><span class="by">fivre</span><span>|</span><a href="#37618359">parent</a><span>|</span><a href="#37618551">next</a><span>|</span><label class="collapse" for="c-37618780">[-]</label><label class="expand" for="c-37618780">[3 more]</label></div><br/><div class="children"><div class="content">CRs that simply instantiate an instance aren&#x27;t all that useful IMO. they&#x27;re much more useful if you have something like Prometheus&#x27; case where they want to attach configuration to various Kubernetes resources and can&#x27;t easily fit it in annotations.<p>i don&#x27;t know that i would actually recommend Helm for much though, since dealing with templates beyond a basic &quot;sub string into field&quot; use case is pain and misery. once you start dealing with named helper templates that operate at different scopes and all but the simplest control flow, the lack of tooling makes debugging templates a nightmare. the operator ecosystem has its own problems (i still can&#x27;t tell what the extra Red Hat stuff beyond kubebuilder is really helping with and can&#x27;t stand updating it), but having an actual programming language and all the accompanying type checking and testing tools available is a major benefit.<p>if you don&#x27;t need something complex, kustomize feels much less breakage-prone than Helm, though its patches aren&#x27;t as intuitive to write.</div><br/><div id="37618824" class="c"><input type="checkbox" id="c-37618824" checked=""/><div class="controls bullet"><span class="by">withinboredom</span><span>|</span><a href="#37618359">root</a><span>|</span><a href="#37618780">parent</a><span>|</span><a href="#37618551">next</a><span>|</span><label class="collapse" for="c-37618824">[-]</label><label class="expand" for="c-37618824">[2 more]</label></div><br/><div class="children"><div class="content">The limitations of helm chart templates are what I like. If you code review shenanigans, it should be a code smell that you’re doing something wrong.<p>Kustomize is terrible. Trying to build a mental model of the final output while writing is horrible.</div><br/><div id="37619635" class="c"><input type="checkbox" id="c-37619635" checked=""/><div class="controls bullet"><span class="by">getrealyall</span><span>|</span><a href="#37618359">root</a><span>|</span><a href="#37618824">parent</a><span>|</span><a href="#37618551">next</a><span>|</span><label class="collapse" for="c-37619635">[-]</label><label class="expand" for="c-37619635">[1 more]</label></div><br/><div class="children"><div class="content">Let&#x27;s be clear: all of the YAML-cum-DSL K8s deployment options are terrible. It&#x27;s still just templating with extra steps. But Kubernetes is, fundamentally, one big while(1) loop turning YAML into infrastructure, so, eventually, you have to target YAML. It&#x27;s just unfortunate that we got to &quot;spicy regexes with if statements&quot; and then stopped, instead of using something more robust.</div><br/></div></div></div></div></div></div><div id="37618551" class="c"><input type="checkbox" id="c-37618551" checked=""/><div class="controls bullet"><span class="by">cogman10</span><span>|</span><a href="#37618359">parent</a><span>|</span><a href="#37618780">prev</a><span>|</span><a href="#37620505">next</a><span>|</span><label class="collapse" for="c-37618551">[-]</label><label class="expand" for="c-37618551">[2 more]</label></div><br/><div class="children"><div class="content">The place the operator looks to be most useful is updating the db.  It&#x27;ll do &quot;the right thing&quot; updating the secondary pods first, doing a switch over of the primary, then updating the old primary pod.<p>That sort of action is real hard to do with just a plain helm chart (especially if you didn&#x27;t plan for it up front).</div><br/><div id="37620104" class="c"><input type="checkbox" id="c-37620104" checked=""/><div class="controls bullet"><span class="by">lyjackal</span><span>|</span><a href="#37618359">root</a><span>|</span><a href="#37618551">parent</a><span>|</span><a href="#37620505">next</a><span>|</span><label class="collapse" for="c-37620104">[-]</label><label class="expand" for="c-37620104">[1 more]</label></div><br/><div class="children"><div class="content">This. If it’s a database, I’d like the deployment infrastructure to be aware during upgrades and able to execute complex actions</div><br/></div></div></div></div><div id="37620505" class="c"><input type="checkbox" id="c-37620505" checked=""/><div class="controls bullet"><span class="by">cortesoft</span><span>|</span><a href="#37618359">parent</a><span>|</span><a href="#37618551">prev</a><span>|</span><a href="#37618887">next</a><span>|</span><label class="collapse" for="c-37620505">[-]</label><label class="expand" for="c-37620505">[1 more]</label></div><br/><div class="children"><div class="content">The operator also handles when a node fails or is taken down. An operator can handle replicating to a new replica on a new node and making sure everything stays consistent.</div><br/></div></div></div></div><div id="37618973" class="c"><input type="checkbox" id="c-37618973" checked=""/><div class="controls bullet"><span class="by">xyst</span><span>|</span><a href="#37618359">prev</a><span>|</span><a href="#37618513">next</a><span>|</span><label class="collapse" for="c-37618973">[-]</label><label class="expand" for="c-37618973">[1 more]</label></div><br/><div class="children"><div class="content">I look forward to trying this out with a simple app i am creating.<p>Never really liked using managed solutions but for the longest time this was the accepted paradigm&#x2F;sentiment because “containers are ephemeral”</div><br/></div></div><div id="37618513" class="c"><input type="checkbox" id="c-37618513" checked=""/><div class="controls bullet"><span class="by">lucgagan</span><span>|</span><a href="#37618973">prev</a><span>|</span><a href="#37618661">next</a><span>|</span><label class="collapse" for="c-37618513">[-]</label><label class="expand" for="c-37618513">[18 more]</label></div><br/><div class="children"><div class="content">That is very cool and much needed, but I am _paranoid_ about hosting the data myself. I&#x27;ve lost too many databases over the years to the most random mistakes. Granted, technology has matured a lot over the last decode, but still... the cost (the nights spent debugging and troubleshooting) of maintaining the database yourself is just not worth it when managed solutions exist.</div><br/><div id="37618886" class="c"><input type="checkbox" id="c-37618886" checked=""/><div class="controls bullet"><span class="by">smartbit</span><span>|</span><a href="#37618513">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37618886">[-]</label><label class="expand" for="c-37618886">[6 more]</label></div><br/><div class="children"><div class="content">The whole clue of cloudnative-pg is that it makes supporting Postgres so much easier. My DevOps colleague and I had no experience with running PG at all, studied the backup and replication chapters of Simon Riggs book [0], read the excellent cnpg documentation and deployed Postgres clusters on Lab, Dev &amp; Prod k8s clusters. Production started sept 2022. Not a huge use case, 5TB of data, constant stream of IoT type of data. Continuous backup to Minio on TrueNAS Core. Later we added both a hot-standby and a backup replica in a secondary site for disaster recovery. No production issues like you describe.<p>Many EDB &amp; 2nd Quadrant have 10+ years experience as core Postgres commiters. I had the pleasure meeting some at Kubecon EU in Amsterdam, friendly Italian &amp; UK Engineers I felt I can trust to make good software. They saw the issues you describe and took a step forward by engineering a proper Kubernetes Operator, introducing it at Kubecon EU 2022 to the public when it reached version 1.5, <i>after</i> they had been running it on their DBaaS production clusters for some time.<p>Highly recommended. IMHO running Postgres on-prem in most use cases is cheaper than a hosted version. Especially taking into account Schrem 1, 2 &amp; (upcoming) 3 [1].<p>[0] <a href="https:&#x2F;&#x2F;www.packtpub.com&#x2F;product&#x2F;postgresql-14-administration-cookbook&#x2F;9781803248974" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.packtpub.com&#x2F;product&#x2F;postgresql-14-administratio...</a><p>[1] <a href="https:&#x2F;&#x2F;noyb.eu&#x2F;en&#x2F;european-commission-gives-eu-us-data-transfers-third-round-cjeu" rel="nofollow noreferrer">https:&#x2F;&#x2F;noyb.eu&#x2F;en&#x2F;european-commission-gives-eu-us-data-tran...</a></div><br/><div id="37619187" class="c"><input type="checkbox" id="c-37619187" checked=""/><div class="controls bullet"><span class="by">crabbone</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618886">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37619187">[-]</label><label class="expand" for="c-37619187">[5 more]</label></div><br/><div class="children"><div class="content">&gt; supporting Postgres so much easier.<p>Easier in the sense that you don&#x27;t know what it&#x27;s doing... It&#x27;s not hard to deploy PostgreSQL and make it do <i>something</i>.  Making it do what it needs to do well is a completely different thing.  Tools like this one (or any other management tool that comes from outside) aren&#x27;t helping you to make it easier.  To make things easy you need to learn how to do them.  They make it easy to waste a ton of resources on things you don&#x27;t need for the faction of performance you can get.</div><br/><div id="37619449" class="c"><input type="checkbox" id="c-37619449" checked=""/><div class="controls bullet"><span class="by">smartbit</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619187">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37619449">[-]</label><label class="expand" for="c-37619449">[4 more]</label></div><br/><div class="children"><div class="content">The OP was complaining it was difficult to maintain Postgres, with late nights. Expensive in <i>human resource</i> costs. You’re now switching to a different topic, from total cost of ownership to resource cost of ownership, not taking into account human operator costs.<p>EDB argues that <i>human</i> costs of operating an highly available cluster with hot standby etc using cnpg &amp; the abstraction it offers is much lower than without an Kubernetes operator.<p>Of course a highly skilled and experienced Postgres guru with years of experience can run a highly available cluster on less compute resources. But what happens if that person is not available? On holiday leave, with pension? How many of those gurus would a company need to employ? How many of these <i>self maintained</i> pg clusters can a couple of these gurus maintain?</div><br/><div id="37619613" class="c"><input type="checkbox" id="c-37619613" checked=""/><div class="controls bullet"><span class="by">getrealyall</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619449">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37619613">[-]</label><label class="expand" for="c-37619613">[3 more]</label></div><br/><div class="children"><div class="content">Not having DBAs, the people with the actual skills to run the databases you need, available when you need them, certainly sounds like a business staffing problem, and not an engineering problem. Why are inexperienced developers managing databases in the first place? Or is this something people think you can just wing and be okay?</div><br/><div id="37619663" class="c"><input type="checkbox" id="c-37619663" checked=""/><div class="controls bullet"><span class="by">smartbit</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619613">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37619663">[-]</label><label class="expand" for="c-37619663">[2 more]</label></div><br/><div class="children"><div class="content">Who says ‘<i>inexperienced developers are managing databases</i>’? That is not the use case EDB is advocating with cnpg, EDB offers a Postgres DBaaS for developers.<p>The README [0] explains that <i>CloudNativePG has been designed by Postgres experts with Kubernetes administrators in mind. Put simply, it leverages Kubernetes by extending its controller and by defining, in a programmatic way, all the actions that a good DBA would normally do when managing a highly available PostgreSQL database cluster.</i><p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;cloudnative-pg&#x2F;cloudnative-pg&#x2F;blob&#x2F;main&#x2F;README.md#in-scope">https:&#x2F;&#x2F;github.com&#x2F;cloudnative-pg&#x2F;cloudnative-pg&#x2F;blob&#x2F;main&#x2F;R...</a></div><br/><div id="37620890" class="c"><input type="checkbox" id="c-37620890" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619663">parent</a><span>|</span><a href="#37618929">next</a><span>|</span><label class="collapse" for="c-37620890">[-]</label><label class="expand" for="c-37620890">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I like to call these sorta operators &quot;half-managed&quot;. It automates some portion of your playbook.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="37618929" class="c"><input type="checkbox" id="c-37618929" checked=""/><div class="controls bullet"><span class="by">ilyt</span><span>|</span><a href="#37618513">parent</a><span>|</span><a href="#37618886">prev</a><span>|</span><a href="#37618573">next</a><span>|</span><label class="collapse" for="c-37618929">[-]</label><label class="expand" for="c-37618929">[1 more]</label></div><br/><div class="children"><div class="content">If you fuck up backups cloud won&#x27;t save you...<p>&gt; Granted, technology has matured a lot over the last decode,<p>Running PostgreSQL database by yourself was just as easy decade ago as now.<p>Like, I get not <i>wanting</i> to, especially if ops is not your job, but compared to actually programming apps it&#x27;s not that hard job job till you get to TB+ sizes. At least compared to writing the more complex apps using it.</div><br/></div></div><div id="37618573" class="c"><input type="checkbox" id="c-37618573" checked=""/><div class="controls bullet"><span class="by">berkle4455</span><span>|</span><a href="#37618513">parent</a><span>|</span><a href="#37618929">prev</a><span>|</span><a href="#37619814">next</a><span>|</span><label class="collapse" for="c-37618573">[-]</label><label class="expand" for="c-37618573">[7 more]</label></div><br/><div class="children"><div class="content">I think with any database the solution is simply backups no? backups that preferably aren’t tied to the hosted solution at all.</div><br/><div id="37618657" class="c"><input type="checkbox" id="c-37618657" checked=""/><div class="controls bullet"><span class="by">panyam</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618573">parent</a><span>|</span><a href="#37619289">next</a><span>|</span><label class="collapse" for="c-37618657">[-]</label><label class="expand" for="c-37618657">[5 more]</label></div><br/><div class="children"><div class="content">Actually not quite.  Backups (assuming you are doing single node) still needs you to decide on your SLOs - RTO (how long it takes to restore) and RPO (how much data lose you can suffer) numbers.   On the instant snazy end you have streaming backups and recovery and then on the other extreme you have backup once in N hours&#x2F;days and restore taking how ever long it takes to restore (so you have customer outages you need to negotiate.<p>Now let us involve multi node, (both replication and partitioning of shards).   As shards go and up and down ensuring data is in sync etc is a hard consistency problem and needs man years of operational excellence and bug fixing.<p>So when people think databases - they think of the cool stuff - the database engine that does relational algebra and handles SQL queries.   That is (IMO) only 1% of a practical, performant, reliable database (offering).</div><br/><div id="37618890" class="c"><input type="checkbox" id="c-37618890" checked=""/><div class="controls bullet"><span class="by">tetha</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618657">parent</a><span>|</span><a href="#37619832">next</a><span>|</span><label class="collapse" for="c-37618890">[-]</label><label class="expand" for="c-37618890">[2 more]</label></div><br/><div class="children"><div class="content">Also what about the customer that deleted an important thing 6 weeks ago and absolutely needs it recovered? BTW, it&#x27;s just one tentant in that DB, the other shouldn&#x27;t be recovered, naturally.</div><br/><div id="37619017" class="c"><input type="checkbox" id="c-37619017" checked=""/><div class="controls bullet"><span class="by">aprilllll</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618890">parent</a><span>|</span><a href="#37619832">next</a><span>|</span><label class="collapse" for="c-37619017">[-]</label><label class="expand" for="c-37619017">[1 more]</label></div><br/><div class="children"><div class="content">In that case, it’d probably be best to just handle deletions at the application layer (e.g., setting a “deleted_at” timestamp field with scheduled permanent deletions later).<p>And in terms of data compliance, it’s very important to make sure permanent deletions propagate through your backup systems within a reasonable amount of time - Google Cloud[1], for example, is ~180 days.<p>[1] <a href="https:&#x2F;&#x2F;services.google.com&#x2F;fh&#x2F;files&#x2F;misc&#x2F;gcp_data_deletion_nda.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;services.google.com&#x2F;fh&#x2F;files&#x2F;misc&#x2F;gcp_data_deletion_...</a></div><br/></div></div></div></div><div id="37619832" class="c"><input type="checkbox" id="c-37619832" checked=""/><div class="controls bullet"><span class="by">api</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618657">parent</a><span>|</span><a href="#37618890">prev</a><span>|</span><a href="#37619289">next</a><span>|</span><label class="collapse" for="c-37619832">[-]</label><label class="expand" for="c-37619832">[2 more]</label></div><br/><div class="children"><div class="content">Maybe if you are gigantic, but there is a long tail of people with &lt;1TB database needs that don’t really need shards and can be well served by a fail over cluster with a master and one or two replicas that can become masters.<p>These days you don’t really need shards until you hit many terabytes or even more depending on your read and especially write load. NVMe storage is really fast and lots of RAM for caching has become cheap.</div><br/><div id="37620255" class="c"><input type="checkbox" id="c-37620255" checked=""/><div class="controls bullet"><span class="by">panyam</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619832">parent</a><span>|</span><a href="#37619289">next</a><span>|</span><label class="collapse" for="c-37620255">[-]</label><label class="expand" for="c-37620255">[1 more]</label></div><br/><div class="children"><div class="content">So my point was around all things a managed for gives you (eg sharding <i>and</i> replication).  Even by the time I had to setup streaming replication and have to worry about wal drifts it is easier to pay a managed provider no?</div><br/></div></div></div></div></div></div><div id="37619289" class="c"><input type="checkbox" id="c-37619289" checked=""/><div class="controls bullet"><span class="by">crabbone</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37618573">parent</a><span>|</span><a href="#37618657">prev</a><span>|</span><a href="#37619814">next</a><span>|</span><label class="collapse" for="c-37619289">[-]</label><label class="expand" for="c-37619289">[1 more]</label></div><br/><div class="children"><div class="content">Backups? Do you want to share your idea about how you&#x27;d do backups? Especially to a distributed database?<p>Here are some of the questions you&#x27;ll have to answer and some options you will have to consider before you go there:<p>Let&#x27;s start with the heavy stuff: consistency groups.  I.e. groups of bulk storage that underlines your entire infrastructure that ensure that your application and database(s) all recover to the <i>shared</i> state once they crash.  To better explain this concept, consider this: you have an application that works with two databases, let&#x27;s say a document database to store documents uploaded by users (which are later parsed by the application and transformed into records in a relational database).  Now, each database provides best consistency guarantees... but they still can fail independently and subsequently recover to different state, where, for example, the document database can be ahead of the relational one (and lose some data).  Similar problems face sharded databases.<p>How geographically far are you going to send your backups?  You see, the closer to the working server they are, the higher is the chance you&#x27;ll lose them together.  But, here&#x27;s the problem: the further away the backups are, the lower is your ability to keep the backup up-to-date with the database, and, subsequently, more data to lose.<p>Well, backups inherently lose data (for the time between the last backup and the time of the crash).  So, if you don&#x27;t want to lose data at all, you probably want replication rather than backups.  And you probably want online replication (but then the distance between the replicas is even more important than in the case with backups).<p>Also, backups are huge.  If you want to ship them outside of the facilities of the storage vendor... that&#x27;s going to be expensive.<p>Another point to consider: databases provide consistency guarantees, but does <i>your</i> database provide consistency guarantees you want?  Is every relation encoded by using foreign keys, or does the application have some knowledge of how to interpret pieces of data and stitch them together into relationships unknown to your database?  Are you sure that every operation that requires atomicity is implemented in a database rather than application (which doesn&#x27;t enforce atomicity)?  What if you stick a backup (recovery point) in a precise moment when your application was doing something that was meant to be atomic, but the application author didn&#x27;t know how to express in SQL (because in their fear of technology they chose to use Hybernate or SQLAlchemy etc.)?  And if you do so, it spoils your backup...</div><br/></div></div></div></div><div id="37619814" class="c"><input type="checkbox" id="c-37619814" checked=""/><div class="controls bullet"><span class="by">api</span><span>|</span><a href="#37618513">parent</a><span>|</span><a href="#37618573">prev</a><span>|</span><a href="#37618661">next</a><span>|</span><label class="collapse" for="c-37619814">[-]</label><label class="expand" for="c-37619814">[3 more]</label></div><br/><div class="children"><div class="content">This is a strong indictment of most database software. It shouldn’t be this hard.</div><br/><div id="37619858" class="c"><input type="checkbox" id="c-37619858" checked=""/><div class="controls bullet"><span class="by">spion</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619814">parent</a><span>|</span><a href="#37618661">next</a><span>|</span><label class="collapse" for="c-37619858">[-]</label><label class="expand" for="c-37619858">[2 more]</label></div><br/><div class="children"><div class="content">The problem (very reliable storage of large amounts of data) is really hard too.</div><br/><div id="37619876" class="c"><input type="checkbox" id="c-37619876" checked=""/><div class="controls bullet"><span class="by">api</span><span>|</span><a href="#37618513">root</a><span>|</span><a href="#37619858">parent</a><span>|</span><a href="#37618661">next</a><span>|</span><label class="collapse" for="c-37619876">[-]</label><label class="expand" for="c-37619876">[1 more]</label></div><br/><div class="children"><div class="content">So are compilers, virtual networks, and encryption, but I have tools for all those that don’t inspire the kind of nameless terror that databases do. The failure modes are different but the problems are not really easier intellectually speaking.<p>There are databases like CockroachDB that are more modern and a lot more approachable for high availability but for some reason everyone adores Postgres. I’m not sure why. It’s arcane and clunky and feels like 1980s Unix software.</div><br/></div></div></div></div></div></div></div></div><div id="37618661" class="c"><input type="checkbox" id="c-37618661" checked=""/><div class="controls bullet"><span class="by">yheowahwjsbf</span><span>|</span><a href="#37618513">prev</a><span>|</span><a href="#37617573">next</a><span>|</span><label class="collapse" for="c-37618661">[-]</label><label class="expand" for="c-37618661">[1 more]</label></div><br/><div class="children"><div class="content"><i>&gt; CloudNativePG does not use `StatefulSet`s for managing data persistence</i><p>This is awesome. StatefulSets are an endless source of pain.</div><br/></div></div><div id="37617573" class="c"><input type="checkbox" id="c-37617573" checked=""/><div class="controls bullet"><span class="by">uneekname</span><span>|</span><a href="#37618661">prev</a><span>|</span><a href="#37618963">next</a><span>|</span><label class="collapse" for="c-37617573">[-]</label><label class="expand" for="c-37617573">[19 more]</label></div><br/><div class="children"><div class="content">Could anyone speak to how this compares to other Postgres solutions for Kubernetes?</div><br/><div id="37618997" class="c"><input type="checkbox" id="c-37618997" checked=""/><div class="controls bullet"><span class="by">JimBlackwood</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37617725">next</a><span>|</span><label class="collapse" for="c-37618997">[-]</label><label class="expand" for="c-37618997">[4 more]</label></div><br/><div class="children"><div class="content">We are currently moving to CNPG and have tried CrunchyData and Zalando in the process. The other two we abandoned while trying it out.<p>Zalando:
- Relies on WAL-E which is now obsolete
- Documentation all over the place
- Hacky setup that deviates from K8s standards (no easy way to set user through supplying secrets, for instance).<p>In general, it feels like an operator to be used internally at Zalando according to their conventions that they just open sourced. It doesn’t seem like they want (or get time) to support other conventions. I don’t think this is a bad thing, it’s already great Zalando open sourced this. Just important to know when you decide to use it.<p>CrunchyData:
- Incomplete documentation (Certain values settings are missing from their API specs)
- Hacky user setup.
- Doesn’t support running without backups enabled. (Obviously, you’d never want to run without backups setup on prod. But when testing, it’s nice to not need to have a perfect setup from the start. Without backups, it will let the database pods fill up their PVC’s with a WAL. Even when not doing any writes. It fills up at about 10GB&#x2F;day.)
- Backups seem to randomly fail.<p>It looks pretty OK otherwise.<p>CNPG:
- Adheres to K8S standards
- Seem to realise that an Operator will (currently) not fully replace a DBA. Their kubectl plug-in is great to interact with the cluster.<p>Obviously we still need to test rollovers and restoring from backups, but so far it’s been easy to setup.<p>It does suffer from what most operators suffer from; their CRD is a mess. The UID of the Postgres Container is specified on the same indentation level as my switchOverDelay, superuserSecret and bootstrap spec. Would be nice if these would follow a more logical grouping (pod spec, users, switchover).</div><br/><div id="37619158" class="c"><input type="checkbox" id="c-37619158" checked=""/><div class="controls bullet"><span class="by">smartbit</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618997">parent</a><span>|</span><a href="#37619854">next</a><span>|</span><label class="collapse" for="c-37619158">[-]</label><label class="expand" for="c-37619158">[1 more]</label></div><br/><div class="children"><div class="content">Can confirm Zalando &amp; Crunchy are quite a mess, contrary to CNPG. See my other post <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37618886">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37618886</a></div><br/></div></div><div id="37619854" class="c"><input type="checkbox" id="c-37619854" checked=""/><div class="controls bullet"><span class="by">koolba</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618997">parent</a><span>|</span><a href="#37619158">prev</a><span>|</span><a href="#37617725">next</a><span>|</span><label class="collapse" for="c-37619854">[-]</label><label class="expand" for="c-37619854">[2 more]</label></div><br/><div class="children"><div class="content">Why is wal-e obsolete? I’m assuming you mean the golang replacement wal-g.</div><br/><div id="37621042" class="c"><input type="checkbox" id="c-37621042" checked=""/><div class="controls bullet"><span class="by">JimBlackwood</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37619854">parent</a><span>|</span><a href="#37617725">next</a><span>|</span><label class="collapse" for="c-37621042">[-]</label><label class="expand" for="c-37621042">[1 more]</label></div><br/><div class="children"><div class="content">See the GitHub: <a href="https:&#x2F;&#x2F;github.com&#x2F;wal-e&#x2F;wal-e">https:&#x2F;&#x2F;github.com&#x2F;wal-e&#x2F;wal-e</a><p>Unmaintained would’ve made more sense to say, but the maintainer choose the words “obsolete” so I took those. :)<p>Seems to be obsolete due to a lack of interest and contributions.</div><br/></div></div></div></div></div></div><div id="37617725" class="c"><input type="checkbox" id="c-37617725" checked=""/><div class="controls bullet"><span class="by">zinclozenge</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37618997">prev</a><span>|</span><a href="#37618555">next</a><span>|</span><label class="collapse" for="c-37617725">[-]</label><label class="expand" for="c-37617725">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve never used it myself, but while doing research I noticed that it received a lot of praise from users.<p>One thing that did catch my attention is that it doesn&#x27;t use statefulsets for the postgres pods. I mostly agree with their reasons, but I haven&#x27;t taken the time to understand their implementation.</div><br/><div id="37618147" class="c"><input type="checkbox" id="c-37618147" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37617725">parent</a><span>|</span><a href="#37618555">next</a><span>|</span><label class="collapse" for="c-37618147">[-]</label><label class="expand" for="c-37618147">[3 more]</label></div><br/><div class="children"><div class="content">The rationale is here: <a href="https:&#x2F;&#x2F;cloudnative-pg.io&#x2F;documentation&#x2F;1.20&#x2F;controller&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;cloudnative-pg.io&#x2F;documentation&#x2F;1.20&#x2F;controller&#x2F;</a></div><br/><div id="37620825" class="c"><input type="checkbox" id="c-37620825" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618147">parent</a><span>|</span><a href="#37618504">next</a><span>|</span><label class="collapse" for="c-37620825">[-]</label><label class="expand" for="c-37620825">[1 more]</label></div><br/><div class="children"><div class="content">Strimzi (Kafka operator) is moving away from StatefulSets for the same reason.</div><br/></div></div><div id="37618504" class="c"><input type="checkbox" id="c-37618504" checked=""/><div class="controls bullet"><span class="by">uneekname</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618147">parent</a><span>|</span><a href="#37620825">prev</a><span>|</span><a href="#37618555">next</a><span>|</span><label class="collapse" for="c-37618504">[-]</label><label class="expand" for="c-37618504">[1 more]</label></div><br/><div class="children"><div class="content">I found that to be well-written, so another point for CloudNativePG</div><br/></div></div></div></div></div></div><div id="37618555" class="c"><input type="checkbox" id="c-37618555" checked=""/><div class="controls bullet"><span class="by">perrygeo</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37617725">prev</a><span>|</span><a href="#37617957">next</a><span>|</span><label class="collapse" for="c-37618555">[-]</label><label class="expand" for="c-37618555">[2 more]</label></div><br/><div class="children"><div class="content">A good comparison with other operators here [2022]: <a href="https:&#x2F;&#x2F;blog.palark.com&#x2F;cloudnativepg-and-other-kubernetes-operators-for-postgresql&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.palark.com&#x2F;cloudnativepg-and-other-kubernetes-o...</a><p>Personally I&#x27;ve only used Kubegres (<a href="https:&#x2F;&#x2F;www.kubegres.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.kubegres.io&#x2F;</a>), which didn&#x27;t even make the above list. It&#x27;s ok for a personal project.<p>All k8s solutions for postgres take subtly different approaches. It seems that they&#x27;ve all converged on the Operator pattern. The basics are easy: run a database process which persists data to a cloud disk of your choice. The hard parts are how to update, migrate, backup, restore, monitor, failover, replicate, etc. These kubernetes &quot;operators&quot; promise to fulfill the role of a DBA but, just like hiring a DBA, it requires buy-in to their approach.</div><br/><div id="37620836" class="c"><input type="checkbox" id="c-37620836" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618555">parent</a><span>|</span><a href="#37617957">next</a><span>|</span><label class="collapse" for="c-37620836">[-]</label><label class="expand" for="c-37620836">[1 more]</label></div><br/><div class="children"><div class="content">From my experiences with Strimzi, I think of it as &quot;half-managed&quot;, like, it&#x27;ll make doing things like upgrades easy as, but yeah, it&#x27;s just tooling that makes self-management easier.</div><br/></div></div></div></div><div id="37617957" class="c"><input type="checkbox" id="c-37617957" checked=""/><div class="controls bullet"><span class="by">nz_cal</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37618555">prev</a><span>|</span><a href="#37617694">next</a><span>|</span><label class="collapse" for="c-37617957">[-]</label><label class="expand" for="c-37617957">[4 more]</label></div><br/><div class="children"><div class="content">I’ve been using it in prod for a while now, pretty happy with it. Solid, integrated pgbouncer, crd based, good license.<p>I do wish there was a simpler way to handle major version upgrades of pg.<p>When I looked at some alternatives, these were my thoughts (may be out of date by now)<p>- kubegres: maintained by one guy, lots of GitHub issues with no responses<p>- crunchy data pgo: licensing is not obvious, seems to require license in some cases<p>- stackgres: agpl, no thanks<p>- zalando: they know pg extremely well, but it’s not kubernetes native. Doesn’t include pgbouncer. Doesn’t handle automatic failover when a node dies, and during testing it often got confused when killing a node.</div><br/><div id="37619951" class="c"><input type="checkbox" id="c-37619951" checked=""/><div class="controls bullet"><span class="by">samokhvalov</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37617957">parent</a><span>|</span><a href="#37618486">next</a><span>|</span><label class="collapse" for="c-37619951">[-]</label><label class="expand" for="c-37619951">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Doesn’t handle automatic failover when a node dies<p>Patroni, the most popular autofailover solution for Postgres, is developed in Zalando. Of course it&#x27;s included in Zalando operator by default.</div><br/></div></div><div id="37618486" class="c"><input type="checkbox" id="c-37618486" checked=""/><div class="controls bullet"><span class="by">uneekname</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37617957">parent</a><span>|</span><a href="#37619951">prev</a><span>|</span><a href="#37617694">next</a><span>|</span><label class="collapse" for="c-37618486">[-]</label><label class="expand" for="c-37618486">[2 more]</label></div><br/><div class="children"><div class="content">I appreciate your perspective, thanks. Major version bumps do seem to be difficult sometimes with pg in my limited experience.</div><br/><div id="37620888" class="c"><input type="checkbox" id="c-37620888" checked=""/><div class="controls bullet"><span class="by">gbartolini</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618486">parent</a><span>|</span><a href="#37617694">next</a><span>|</span><label class="collapse" for="c-37620888">[-]</label><label class="expand" for="c-37620888">[1 more]</label></div><br/><div class="children"><div class="content">If you are interested, I suggest this article I wrote that covers the current state of major upgrades with CloudNativePG: <a href="https:&#x2F;&#x2F;www.enterprisedb.com&#x2F;blog&#x2F;current-state-major-postgresql-upgrades-cloudnativepg-kubernetes" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.enterprisedb.com&#x2F;blog&#x2F;current-state-major-postgr...</a></div><br/></div></div></div></div></div></div><div id="37617694" class="c"><input type="checkbox" id="c-37617694" checked=""/><div class="controls bullet"><span class="by">rollulus</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37617957">prev</a><span>|</span><a href="#37618347">next</a><span>|</span><label class="collapse" for="c-37617694">[-]</label><label class="expand" for="c-37617694">[1 more]</label></div><br/><div class="children"><div class="content">Exactly what I was wondering about as well. I have no prod experience with it, but e.g. Zalando’s operator has been solid for me.</div><br/></div></div><div id="37618347" class="c"><input type="checkbox" id="c-37618347" checked=""/><div class="controls bullet"><span class="by">fijiaarone</span><span>|</span><a href="#37617573">parent</a><span>|</span><a href="#37617694">prev</a><span>|</span><a href="#37618328">next</a><span>|</span><label class="collapse" for="c-37618347">[-]</label><label class="expand" for="c-37618347">[2 more]</label></div><br/><div class="children"><div class="content">It’s the opposite. 
A Kubernetes solution for Postgres.</div><br/><div id="37618373" class="c"><input type="checkbox" id="c-37618373" checked=""/><div class="controls bullet"><span class="by">uneekname</span><span>|</span><a href="#37617573">root</a><span>|</span><a href="#37618347">parent</a><span>|</span><a href="#37618328">next</a><span>|</span><label class="collapse" for="c-37618373">[-]</label><label class="expand" for="c-37618373">[1 more]</label></div><br/><div class="children"><div class="content">Haha, that might be a better way of putting it. &quot;A solution for running Postgres in Kubernetes&quot;</div><br/></div></div></div></div></div></div><div id="37618963" class="c"><input type="checkbox" id="c-37618963" checked=""/><div class="controls bullet"><span class="by">claytongulick</span><span>|</span><a href="#37617573">prev</a><span>|</span><a href="#37619167">next</a><span>|</span><label class="collapse" for="c-37618963">[-]</label><label class="expand" for="c-37618963">[6 more]</label></div><br/><div class="children"><div class="content">I prefer to run PostgreSQL The Grumpy Greybeard Way.<p>Like, on a (virtual) machine.<p>With a config file.<p>I&#x27;m doing a web app with terabytes of healthcare data with intense computation and geospatial queries with an average 60ms response time including latency.<p>On a modest vm.<p>With a config file.</div><br/><div id="37620263" class="c"><input type="checkbox" id="c-37620263" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#37618963">parent</a><span>|</span><a href="#37619962">next</a><span>|</span><label class="collapse" for="c-37620263">[-]</label><label class="expand" for="c-37620263">[1 more]</label></div><br/><div class="children"><div class="content">Running a database on a VM doesn&#x27;t sound very Greybeard™ of you; don&#x27;t you know that abstracting like that kills performance and takes you away from the hardware? (Only half joking; obviously you totally can make it run fine on a VM, but it also runs fine in a container.)</div><br/></div></div><div id="37619962" class="c"><input type="checkbox" id="c-37619962" checked=""/><div class="controls bullet"><span class="by">samokhvalov</span><span>|</span><a href="#37618963">parent</a><span>|</span><a href="#37620263">prev</a><span>|</span><a href="#37619435">next</a><span>|</span><label class="collapse" for="c-37619962">[-]</label><label class="expand" for="c-37619962">[2 more]</label></div><br/><div class="children"><div class="content">You&#x27;ll probably like this: <a href="https:&#x2F;&#x2F;github.com&#x2F;vitabaks&#x2F;postgresql_cluster">https:&#x2F;&#x2F;github.com&#x2F;vitabaks&#x2F;postgresql_cluster</a></div><br/><div id="37620837" class="c"><input type="checkbox" id="c-37620837" checked=""/><div class="controls bullet"><span class="by">claytongulick</span><span>|</span><a href="#37618963">root</a><span>|</span><a href="#37619962">parent</a><span>|</span><a href="#37619435">next</a><span>|</span><label class="collapse" for="c-37620837">[-]</label><label class="expand" for="c-37620837">[1 more]</label></div><br/><div class="children"><div class="content">I do like it!<p>My current DR&#x2F;HA is basically just hourly block level delta snapshots. It&#x27;s super simple, cheap and easy to do if the business can tolerate up to an hour of potential data loss.</div><br/></div></div></div></div><div id="37619435" class="c"><input type="checkbox" id="c-37619435" checked=""/><div class="controls bullet"><span class="by">ibash</span><span>|</span><a href="#37618963">parent</a><span>|</span><a href="#37619962">prev</a><span>|</span><a href="#37619167">next</a><span>|</span><label class="collapse" for="c-37619435">[-]</label><label class="expand" for="c-37619435">[2 more]</label></div><br/><div class="children"><div class="content">With a WHAT?</div><br/><div id="37620817" class="c"><input type="checkbox" id="c-37620817" checked=""/><div class="controls bullet"><span class="by">claytongulick</span><span>|</span><a href="#37618963">root</a><span>|</span><a href="#37619435">parent</a><span>|</span><a href="#37619167">next</a><span>|</span><label class="collapse" for="c-37620817">[-]</label><label class="expand" for="c-37620817">[1 more]</label></div><br/><div class="children"><div class="content">A config file.<p>:-)</div><br/></div></div></div></div></div></div><div id="37619167" class="c"><input type="checkbox" id="c-37619167" checked=""/><div class="controls bullet"><span class="by">crabbone</span><span>|</span><a href="#37618963">prev</a><span>|</span><a href="#37617843">next</a><span>|</span><label class="collapse" for="c-37619167">[-]</label><label class="expand" for="c-37619167">[6 more]</label></div><br/><div class="children"><div class="content">&gt; CloudNativePG exclusively relies on the Kubernetes API server to maintain the state of a PostgreSQL cluster.<p>This is scary af.  Kubernetes API server is <i>very</i> finicky and unreliable.  It&#x27;s probably the first component that fails in Kubernetes no matter what the problem is (eg. I recently managed to run it into unrecoverable state by accidentally starting 10K jobs instead of 100).<p>This is just outright bad idea... but, really &quot;reliable&quot; and Kubernetes don&#x27;t belong together.  So, if you wanted an unreliable PostgreSQL, which you have no idea how it&#x27;s managed and how to recover... well, that sounds like fun!</div><br/><div id="37619351" class="c"><input type="checkbox" id="c-37619351" checked=""/><div class="controls bullet"><span class="by">hnarn</span><span>|</span><a href="#37619167">parent</a><span>|</span><a href="#37617843">next</a><span>|</span><label class="collapse" for="c-37619351">[-]</label><label class="expand" for="c-37619351">[5 more]</label></div><br/><div class="children"><div class="content">Can someone explain why this is being downvoted?</div><br/><div id="37619419" class="c"><input type="checkbox" id="c-37619419" checked=""/><div class="controls bullet"><span class="by">erulabs</span><span>|</span><a href="#37619167">root</a><span>|</span><a href="#37619351">parent</a><span>|</span><a href="#37617843">next</a><span>|</span><label class="collapse" for="c-37619419">[-]</label><label class="expand" for="c-37619419">[4 more]</label></div><br/><div class="children"><div class="content">Because it’s reactionary and a bit silly, while providing no real value.<p>Yes, orchestration requires the orchestration tool.<p>No, k8s api is not unreliable or “finicky”.<p>This is being downvoted because it’s the equivalent of saying “delivery requires the use of a car? But engines are so unreliable, bad idea!”<p>Saying k8s and “reliable” don’t belong together is just flamebait - k8s runs reliably for tens of thousands of extremely large shops.</div><br/><div id="37619656" class="c"><input type="checkbox" id="c-37619656" checked=""/><div class="controls bullet"><span class="by">getrealyall</span><span>|</span><a href="#37619167">root</a><span>|</span><a href="#37619419">parent</a><span>|</span><a href="#37617843">next</a><span>|</span><label class="collapse" for="c-37619656">[-]</label><label class="expand" for="c-37619656">[3 more]</label></div><br/><div class="children"><div class="content">Are these extremely large shops in some sort of pocket universe? Because I&#x27;ve been around the block enough to regularly experience Kubernetes&#x27;s issues over and over again, and I&#x27;d say that the GP comment you&#x27;re critiquing is actually right on the money. In my experience, people downplaying Kubernetes&#x27;s drawbacks have either never been bitten by them, or make a lot of money by getting people to use Kubernetes.</div><br/><div id="37620386" class="c"><input type="checkbox" id="c-37620386" checked=""/><div class="controls bullet"><span class="by">erulabs</span><span>|</span><a href="#37619167">root</a><span>|</span><a href="#37619656">parent</a><span>|</span><a href="#37620001">next</a><span>|</span><label class="collapse" for="c-37620386">[-]</label><label class="expand" for="c-37620386">[1 more]</label></div><br/><div class="children"><div class="content">Complex systems are complex. If you don’t need it, don’t use it.<p>But you’re absolutely wrong to call it unreliable. I’ve also “been around the block”, and I’ve seen 50k lines of BASH fail in complex ways too.<p>A google search would show you plenty of extremely large shops using k8s, and dozens or hundreds of tech talks by their lead engineers saying how much better it made their lives.</div><br/></div></div><div id="37620001" class="c"><input type="checkbox" id="c-37620001" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#37619167">root</a><span>|</span><a href="#37619656">parent</a><span>|</span><a href="#37620386">prev</a><span>|</span><a href="#37617843">next</a><span>|</span><label class="collapse" for="c-37620001">[-]</label><label class="expand" for="c-37620001">[1 more]</label></div><br/><div class="children"><div class="content">If you think k8s is finicky and unreliable... just don&#x27;t use it at all. That&#x27;s not really specific to CNPG or its architecture.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37617843" class="c"><input type="checkbox" id="c-37617843" checked=""/><div class="controls bullet"><span class="by">rgrieselhuber</span><span>|</span><a href="#37619167">prev</a><span>|</span><a href="#37617716">next</a><span>|</span><label class="collapse" for="c-37617843">[-]</label><label class="expand" for="c-37617843">[5 more]</label></div><br/><div class="children"><div class="content">Is it just me or is the color scheme on this website smoking crack?</div><br/><div id="37618230" class="c"><input type="checkbox" id="c-37618230" checked=""/><div class="controls bullet"><span class="by">susam</span><span>|</span><a href="#37617843">parent</a><span>|</span><a href="#37617980">next</a><span>|</span><label class="collapse" for="c-37618230">[-]</label><label class="expand" for="c-37618230">[1 more]</label></div><br/><div class="children"><div class="content">You are probably viewing the dark colour scheme of the website. The website looks fine in light colour scheme. However in dark colour scheme, while it flips the background and text colour alright, it does not alter the accent colours sufficiently well.<p>To see what I mean, compare <a href="https:&#x2F;&#x2F;i.imgur.com&#x2F;hhL0fZH.png" rel="nofollow noreferrer">https:&#x2F;&#x2F;i.imgur.com&#x2F;hhL0fZH.png</a> (dark colour scheme) with <a href="https:&#x2F;&#x2F;i.imgur.com&#x2F;rr24RkN.png" rel="nofollow noreferrer">https:&#x2F;&#x2F;i.imgur.com&#x2F;rr24RkN.png</a> (light colour scheme).<p>Consider the colour of the text &quot;Try Kubernetes Way&quot; and the background colour. In light mode, we have foreground colour #DC2626 on background colour #FFFFFF. This has a contrast ratio of 4.82. WCAG 2.0 level AA recommends minimum contrast ratio of 3.0 for large text. So a contrast of 4.82 is decent enough. However in dark mode, we see #991B1B on #075985 which has a contrast ratio of only 1.09. This ratio is too low and fails all WCAG contrast requirements.</div><br/></div></div><div id="37617980" class="c"><input type="checkbox" id="c-37617980" checked=""/><div class="controls bullet"><span class="by">osigurdson</span><span>|</span><a href="#37617843">parent</a><span>|</span><a href="#37618230">prev</a><span>|</span><a href="#37618209">next</a><span>|</span><label class="collapse" for="c-37617980">[-]</label><label class="expand" for="c-37617980">[1 more]</label></div><br/><div class="children"><div class="content">It definitely looks different.</div><br/></div></div><div id="37618209" class="c"><input type="checkbox" id="c-37618209" checked=""/><div class="controls bullet"><span class="by">pphysch</span><span>|</span><a href="#37617843">parent</a><span>|</span><a href="#37617980">prev</a><span>|</span><a href="#37617992">next</a><span>|</span><label class="collapse" for="c-37618209">[-]</label><label class="expand" for="c-37618209">[1 more]</label></div><br/><div class="children"><div class="content">They&#x27;re mixing white and black text on the same background. Mixing muddy red with dark blues. Yeah.</div><br/></div></div></div></div><div id="37617716" class="c"><input type="checkbox" id="c-37617716" checked=""/><div class="controls bullet"><span class="by">dvh</span><span>|</span><a href="#37617843">prev</a><span>|</span><label class="collapse" for="c-37617716">[-]</label><label class="expand" for="c-37617716">[8 more]</label></div><br/><div class="children"><div class="content">Was it&#x27;s always spelled kubernetes? In my &quot;Mandela timeline&quot; it was kubernets and just recently switched.</div><br/><div id="37618309" class="c"><input type="checkbox" id="c-37618309" checked=""/><div class="controls bullet"><span class="by">comradesmith</span><span>|</span><a href="#37617716">parent</a><span>|</span><a href="#37618385">next</a><span>|</span><label class="collapse" for="c-37618309">[-]</label><label class="expand" for="c-37618309">[1 more]</label></div><br/><div class="children"><div class="content">Always kubernetes, but I’ve heard some engineers with accents say it in a way that sounds like “kubernets”</div><br/></div></div><div id="37618385" class="c"><input type="checkbox" id="c-37618385" checked=""/><div class="controls bullet"><span class="by">ghshephard</span><span>|</span><a href="#37617716">parent</a><span>|</span><a href="#37618309">prev</a><span>|</span><a href="#37617756">next</a><span>|</span><label class="collapse" for="c-37618385">[-]</label><label class="expand" for="c-37618385">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s been K - 8 letters - S long enough that everyone at work just calls it &quot;Kates&quot; now, which initially annoyed me to no end, but has kind of grown on me.</div><br/></div></div><div id="37617756" class="c"><input type="checkbox" id="c-37617756" checked=""/><div class="controls bullet"><span class="by">martijnvds</span><span>|</span><a href="#37617716">parent</a><span>|</span><a href="#37618385">prev</a><span>|</span><a href="#37617919">next</a><span>|</span><label class="collapse" for="c-37617756">[-]</label><label class="expand" for="c-37617756">[1 more]</label></div><br/><div class="children"><div class="content">K8s was always K-ubernete-s (8 letters)</div><br/></div></div><div id="37617919" class="c"><input type="checkbox" id="c-37617919" checked=""/><div class="controls bullet"><span class="by">osigurdson</span><span>|</span><a href="#37617716">parent</a><span>|</span><a href="#37617756">prev</a><span>|</span><a href="#37617761">next</a><span>|</span><label class="collapse" for="c-37617919">[-]</label><label class="expand" for="c-37617919">[1 more]</label></div><br/><div class="children"><div class="content">It was never called &quot;Kubernets&quot;.</div><br/></div></div><div id="37617761" class="c"><input type="checkbox" id="c-37617761" checked=""/><div class="controls bullet"><span class="by">c0brac0bra</span><span>|</span><a href="#37617716">parent</a><span>|</span><a href="#37617919">prev</a><span>|</span><label class="collapse" for="c-37617761">[-]</label><label class="expand" for="c-37617761">[3 more]</label></div><br/><div class="children"><div class="content">Always AFAIK. It&#x27;s a Greek word.</div><br/><div id="37619057" class="c"><input type="checkbox" id="c-37619057" checked=""/><div class="controls bullet"><span class="by">wrboyce</span><span>|</span><a href="#37617716">root</a><span>|</span><a href="#37617761">parent</a><span>|</span><label class="collapse" for="c-37619057">[-]</label><label class="expand" for="c-37619057">[2 more]</label></div><br/><div class="children"><div class="content">Nitpick, but I think it is from Ancient Greek. A cursory Google tells me the modern Greek descendant is κυβερνήτης&#x2F;kyvernítis and has a slightly different meaning.</div><br/><div id="37619398" class="c"><input type="checkbox" id="c-37619398" checked=""/><div class="controls bullet"><span class="by">cgio</span><span>|</span><a href="#37617716">root</a><span>|</span><a href="#37619057">parent</a><span>|</span><label class="collapse" for="c-37619398">[-]</label><label class="expand" for="c-37619398">[1 more]</label></div><br/><div class="children"><div class="content">κυβερνήτης is the ancient word too. Maybe they were trying to word play with cube, which by the way also comes from κύβος-kyvos and not kuvos. Exactly same meaning as far as I know, wonder what the cursory google came up as the difference in meaning. Also root for cybernetics...</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>