<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1721293263115" as="style"/><link rel="stylesheet" href="styles.css?v=1721293263115"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/seddonm1/sqlite-bench">Show HN: SQLite Transaction Benchmarking Tool</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>seddonm1</span> | <span>4 comments</span></div><br/><div><div id="40993447" class="c"><input type="checkbox" id="c-40993447" checked=""/><div class="controls bullet"><span class="by">leononame</span><span>|</span><label class="collapse" for="c-40993447">[-]</label><label class="expand" for="c-40993447">[3 more]</label></div><br/><div class="children"><div class="content">Thanks for the interesting article. Lots of things seem to happen in SQLite land at the moment and I appreciate that the SQLite team documents their quirks so openly, it gives great confidence.<p>Since I don&#x27;t know where else to ask, maybe this is a good place: How do async wrappers around SQLite (e.g. for node or python) work? SQLite only uses synchronous I&#x2F;O if I&#x27;m not mistaken. Is it just a pretend async function with only synchronous code?<p>And, as a follow-up: If I have a server with say 100 incoming connections that will all read from the database, I&#x27;ve got 100 readers. No problem in WAL mode. However, I still could get congested by file I&#x2F;O, right? Because every time a reader is waiting for data from disk, I can&#x27;t execute the application code of another connection in a different thread since execution is blocked on my current thread. Is there any benefit to having a thread pool with a limit of more than $NUM_CPU readers?<p>And one more: Would you recommend actually pooling connections or just opening&#x2F;closing the database for each request as needed? Could keeping a file handle open prevent SQLite from checkpointing under certain conditions?</div><br/><div id="40993559" class="c"><input type="checkbox" id="c-40993559" checked=""/><div class="controls bullet"><span class="by">seddonm1</span><span>|</span><a href="#40993447">parent</a><span>|</span><label class="collapse" for="c-40993559">[-]</label><label class="expand" for="c-40993559">[2 more]</label></div><br/><div class="children"><div class="content">Thanks.<p>All good and valid questions.<p>1. I work mostly in Rust so I&#x27;ll answer there in terms of async. This library [0] uses queues to manage workload. I run a modified version [1] which creates 1 writer and n reader connections to a WAL backed SQLite and dispatch async transactions against them. The n readers will pull work from a shared common queue.<p>2. Yes there is not much you can do about file IO but SQLite is still a full database engine with caching. You could use this benchmarking tool to help understand where your limits would be (you can do a run against a ramdisk then against your real storage).<p>3. As per #1, I keep connections open and distribute transactions across them myself. Checkpointing will only be a problem under considerable sustained write load but you should be able to simulate your load and observe the behavior. The WAL2 branch of SQLite is intended to prevent sustained load problems.<p>[0]: <a href="https:&#x2F;&#x2F;github.com&#x2F;programatik29&#x2F;tokio-rusqlite">https:&#x2F;&#x2F;github.com&#x2F;programatik29&#x2F;tokio-rusqlite</a>
[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;seddonm1&#x2F;s3ite&#x2F;blob&#x2F;0.5.0&#x2F;src&#x2F;database.rs">https:&#x2F;&#x2F;github.com&#x2F;seddonm1&#x2F;s3ite&#x2F;blob&#x2F;0.5.0&#x2F;src&#x2F;database.rs</a></div><br/><div id="40993730" class="c"><input type="checkbox" id="c-40993730" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#40993447">root</a><span>|</span><a href="#40993559">parent</a><span>|</span><label class="collapse" for="c-40993730">[-]</label><label class="expand" for="c-40993730">[1 more]</label></div><br/><div class="children"><div class="content">Valuable info and links, instant bookmarks, thank you!<p>If you don&#x27;t mind me asking, why did you go with rusqlite + a tokio wrapper for it and not go with sqlx?</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>