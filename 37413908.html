<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1694077262812" as="style"/><link rel="stylesheet" href="styles.css?v=1694077262812"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://joearms.github.io/#2013-11-21%20My%20favorite%20Erlang%20Program">My favorite Erlang program (2013)</a> <span class="domain">(<a href="https://joearms.github.io">joearms.github.io</a>)</span></div><div class="subtext"><span>vector_spaces</span> | <span>62 comments</span></div><br/><div><div id="37414667" class="c"><input type="checkbox" id="c-37414667" checked=""/><div class="controls bullet"><span class="by">rdtsc</span><span>|</span><a href="#37415793">next</a><span>|</span><label class="collapse" for="c-37414667">[-]</label><label class="expand" for="c-37414667">[7 more]</label></div><br/><div class="children"><div class="content">If the server closure F, besides it&#x27;s own messages can also receive a `{become, F}` message, then you can then keep changing the server to something new again and so on.<p>Completely unrelated, but I remember talking to Joe at one of the Erlang conferences. He was always excited about technology and always happy to chat with anyone. He was dismayed how Windows had gotten worse and less usable over the years, and how one day we won&#x27;t be able to browse our own files on it until we sit and watch advertisements for a while to unlock them. Joe was nearly right! Sure enough, years later I hear there are ads in Windows 11 and you have to go out of your way to remove them. Not quite the same yet, but by Windows 13 I am sure we&#x27;ll get there.</div><br/><div id="37415033" class="c"><input type="checkbox" id="c-37415033" checked=""/><div class="controls bullet"><span class="by">vector_spaces</span><span>|</span><a href="#37414667">parent</a><span>|</span><a href="#37415083">next</a><span>|</span><label class="collapse" for="c-37415033">[-]</label><label class="expand" for="c-37415033">[4 more]</label></div><br/><div class="children"><div class="content">I use Linux at home, and use Windows for work. Outside of the ads, I&#x27;ve been most surprised by<p>1. My Windows machine has a lot more of the weird issues I used to see on Linux like 6-7 years ago. Like nothing showstopping. More like quality of life reducing stuff, like the volume in one headphone will be far louder than in the other, despite the mixer showing them the same. Or weird crashes in applications (specifically with Microsoft software). Or Windows documentation pages not resolving in any browser, forcing me to use an archive site to view them. Or my laptop occasionally not detecting my external monitor after detecting it fine for weeks. Or the monitor will flash occasionally<p>2. Less surprising, more dismaying: Office software by default tries to get you to save files to the cloud instead of locally. Yes, having your files everywhere across all devices is nice, I know, but I would rather have my files local first, with cloud backup, rather than have my files in the cloud first. I&#x27;m old fashioned, I guess<p>3. WSL is pretty jank, but it is probably the only reason Windows is usable at all for me<p>More topically: I&#x27;ve always heard that about Joe being a wonderful human being, and it makes a lot of sense. When I was first teaching myself to code, I came across his book on Erlang, and it had a huge impact on me. I loved the playfulness, humility, and imagination that he brought to his work. Even though I hardly ended up writing any Erlang, reading his writing changed the way I think about so many things related to code. It&#x27;s clear he cared a lot about pedagogy. I have a math background, and wish that both math and software engineering and CS culture embraced playfulness and humility more</div><br/><div id="37416160" class="c"><input type="checkbox" id="c-37416160" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#37414667">root</a><span>|</span><a href="#37415033">parent</a><span>|</span><a href="#37416154">next</a><span>|</span><label class="collapse" for="c-37416160">[-]</label><label class="expand" for="c-37416160">[1 more]</label></div><br/><div class="children"><div class="content">Microsoft fired their entire QA team.<p>They also fired their entire technical documentation team.<p>They now treat Windows like freeware&#x2F;shareware, and monetise it the same way -- selling ads, collecting telemetry, bundling, and being pushy.<p>Windows Server is abandonware, Microsoft only cares about Azure now. As far as they are concerned, hosting software yourself on-premises is a strange aberration and will eventually just go away.<p>Entire categories of their products are no longer available for on-prem installation, such as: CosmosDB, Data Factory, Purview, Logic Apps, etc...</div><br/></div></div><div id="37416154" class="c"><input type="checkbox" id="c-37416154" checked=""/><div class="controls bullet"><span class="by">Cthulhu_</span><span>|</span><a href="#37414667">root</a><span>|</span><a href="#37415033">parent</a><span>|</span><a href="#37416160">prev</a><span>|</span><a href="#37416091">next</a><span>|</span><label class="collapse" for="c-37416154">[-]</label><label class="expand" for="c-37416154">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve had a headphone balancing issue on MacOS as well, probably my previous one (intel, 2016 model I believe), ended up installing a tool whose sole purpose was to rebalance the audio every once in a while if it detected it went skewed. I have zero clue how that would happen, I can&#x27;t see any practical purpose for any application or subsystem to be adjusting the audio balance.</div><br/></div></div><div id="37416091" class="c"><input type="checkbox" id="c-37416091" checked=""/><div class="controls bullet"><span class="by">thaumasiotes</span><span>|</span><a href="#37414667">root</a><span>|</span><a href="#37415033">parent</a><span>|</span><a href="#37416154">prev</a><span>|</span><a href="#37415083">next</a><span>|</span><label class="collapse" for="c-37416091">[-]</label><label class="expand" for="c-37416091">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  My Windows machine has a lot more of the weird issues I used to see on Linux like 6-7 years ago. Like nothing showstopping. More like quality of life reducing stuff, like the volume in one headphone will be far louder than in the other<p>A while back I installed a Windows update that permanently prevented my existing Bose headphones from being able to connect to my laptop over bluetooth.</div><br/></div></div></div></div><div id="37415083" class="c"><input type="checkbox" id="c-37415083" checked=""/><div class="controls bullet"><span class="by">nesarkvechnep</span><span>|</span><a href="#37414667">parent</a><span>|</span><a href="#37415033">prev</a><span>|</span><a href="#37416077">next</a><span>|</span><label class="collapse" for="c-37415083">[-]</label><label class="expand" for="c-37415083">[1 more]</label></div><br/><div class="children"><div class="content">Your first paragraph. This is actually a feature of the Actor model. I didn’t realise before that it’s possible on the BEAM.</div><br/></div></div><div id="37416077" class="c"><input type="checkbox" id="c-37416077" checked=""/><div class="controls bullet"><span class="by">thaumasiotes</span><span>|</span><a href="#37414667">parent</a><span>|</span><a href="#37415083">prev</a><span>|</span><a href="#37415793">next</a><span>|</span><label class="collapse" for="c-37416077">[-]</label><label class="expand" for="c-37416077">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Sure enough, years later I hear there are ads in Windows 11 and you have to go out of your way to remove them.<p>The intrusive ads are not new to Windows 11. They&#x27;re already there in Windows 10.</div><br/></div></div></div></div><div id="37415793" class="c"><input type="checkbox" id="c-37415793" checked=""/><div class="controls bullet"><span class="by">s6ro</span><span>|</span><a href="#37414667">prev</a><span>|</span><a href="#37414500">next</a><span>|</span><label class="collapse" for="c-37415793">[-]</label><label class="expand" for="c-37415793">[1 more]</label></div><br/><div class="children"><div class="content">A short (35 min) overview of BEAM and why it is not like other VMs: JVM, Node
<a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=pO4_Wlq8JeI">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=pO4_Wlq8JeI</a></div><br/></div></div><div id="37414500" class="c"><input type="checkbox" id="c-37414500" checked=""/><div class="controls bullet"><span class="by">refactorworks</span><span>|</span><a href="#37415793">prev</a><span>|</span><a href="#37415715">next</a><span>|</span><label class="collapse" for="c-37414500">[-]</label><label class="expand" for="c-37414500">[29 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    universal_server() -&gt;
      receive
       {become, F} -&gt;
         F()
      end.
</code></pre>
Honestly I don&#x27;t fully appreciate the power of this universal server. Can anyone help?</div><br/><div id="37414584" class="c"><input type="checkbox" id="c-37414584" checked=""/><div class="controls bullet"><span class="by">softirq</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414613">next</a><span>|</span><label class="collapse" for="c-37414584">[-]</label><label class="expand" for="c-37414584">[8 more]</label></div><br/><div class="children"><div class="content">If you are familiar with Go, it&#x27;s similar to a goroutine that waits for someone to send it an anonymous function to start executing. In Erlang, you solve problems by spawning lots of processes, and most processes are waiting to accept messages. One critical difference is that in Erlang, processes can run on remote machines, seamlessly. This process accepts a message which is a tuple containing the atom become, which is basically just an enum, and a function. Another process, such as the Erlang shell, can send this tuple message with the function to this process at any time so that it &quot;becomes&quot; that function.<p>What he is saying is that you can swap out the logic of this waiting loop with whatever protocol logic you want. His example was that he had a fleet of machines that were running this loop, and he sent all of them a function that implemented a gossip protocol. But he could easily send them all another message that turns them all into BitTorrent clients.<p>Joe was an absolute genius and an extremely kind person. I had the honor of meeting him once. Erlang is still one of the most beautiful technical creations I&#x27;ve ever encountered. It really does make you see concurrency in a whole new way.</div><br/><div id="37415564" class="c"><input type="checkbox" id="c-37415564" checked=""/><div class="controls bullet"><span class="by">henrik_w</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414584">parent</a><span>|</span><a href="#37414828">next</a><span>|</span><label class="collapse" for="c-37415564">[-]</label><label class="expand" for="c-37415564">[1 more]</label></div><br/><div class="children"><div class="content">On the subject of beauty, I really like this quote from Joe Armstrong:<p>“Make it work, then make it beautiful, then if you really, really have to, make it fast. 90 percent of the time, if you make it beautiful, it will already be fast. So really, just make it beautiful!”</div><br/></div></div><div id="37414828" class="c"><input type="checkbox" id="c-37414828" checked=""/><div class="controls bullet"><span class="by">thakoppno</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414584">parent</a><span>|</span><a href="#37415564">prev</a><span>|</span><a href="#37415052">next</a><span>|</span><label class="collapse" for="c-37414828">[-]</label><label class="expand" for="c-37414828">[5 more]</label></div><br/><div class="children"><div class="content">&gt; One critical difference is that in Erlang, processes can run on remote machines, seamlessly.<p>Is there a concise way to explain how Erlang achieves this property?</div><br/><div id="37414952" class="c"><input type="checkbox" id="c-37414952" checked=""/><div class="controls bullet"><span class="by">querulous</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414828">parent</a><span>|</span><a href="#37415159">next</a><span>|</span><label class="collapse" for="c-37414952">[-]</label><label class="expand" for="c-37414952">[2 more]</label></div><br/><div class="children"><div class="content">it&#x27;s not as mysterious as it sounds. every data structure (including modules and anonymous functions) has a binary serialization and every erlang vm is also an rpc server that can receive arbitrary data -- including whole programs -- and execute them. your vm of course needs to know about the remote vms to do so but that&#x27;s where the rudimentary clustering mechanism in erlang comes into play</div><br/><div id="37414991" class="c"><input type="checkbox" id="c-37414991" checked=""/><div class="controls bullet"><span class="by">thomasfortes</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414952">parent</a><span>|</span><a href="#37415159">next</a><span>|</span><label class="collapse" for="c-37414991">[-]</label><label class="expand" for="c-37414991">[1 more]</label></div><br/><div class="children"><div class="content">Also no shared memory in processes and they all communicate strictly through message passing, so running a piece of code in the local node, in another node in the same machine or in a node on the other side of the planet is a matter of telling which pid you want to send the message to, the BEAM will figure out how to send the message to the correct place in the cluster and your program will be none the wiser.</div><br/></div></div></div></div><div id="37415159" class="c"><input type="checkbox" id="c-37415159" checked=""/><div class="controls bullet"><span class="by">rramadass</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414828">parent</a><span>|</span><a href="#37414952">prev</a><span>|</span><a href="#37414874">next</a><span>|</span><label class="collapse" for="c-37415159">[-]</label><label class="expand" for="c-37415159">[1 more]</label></div><br/><div class="children"><div class="content">You can find all the details about Erlang internals in <i>The BEAM book</i> : <a href="https:&#x2F;&#x2F;blog.stenmans.org&#x2F;theBeamBook&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.stenmans.org&#x2F;theBeamBook&#x2F;</a></div><br/></div></div></div></div><div id="37415052" class="c"><input type="checkbox" id="c-37415052" checked=""/><div class="controls bullet"><span class="by">tombert</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414584">parent</a><span>|</span><a href="#37414828">prev</a><span>|</span><a href="#37414613">next</a><span>|</span><label class="collapse" for="c-37415052">[-]</label><label class="expand" for="c-37415052">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Joe was an absolute genius and an extremely kind person. I had the honor of meeting him once.<p>Completely agree.  Joe was always willing to reply to my emails and answer my questions in detail.  He was an exceptionally talented explainer, and his messages were always interesting and entertaining, while also being informative.<p>I never met him in person but I will always treasure the correspondence I had with him.</div><br/></div></div></div></div><div id="37414613" class="c"><input type="checkbox" id="c-37414613" checked=""/><div class="controls bullet"><span class="by">h0l0cube</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414584">prev</a><span>|</span><a href="#37414556">next</a><span>|</span><label class="collapse" for="c-37414613">[-]</label><label class="expand" for="c-37414613">[1 more]</label></div><br/><div class="children"><div class="content">To explain further, the `receive` keyword is a bit like a switch statement (but actually a pattern matcher) for incoming messages.<p>Here they made a new server that takes an return process (From) and a number (N).  The exclamation point sends the result back to the return process.<p><pre><code>    factorial_server() -&gt;
        receive
           {From, N} -&gt;
               From ! factorial(N),
               factorial_server()
        end.

    factorial(0) -&gt; 1;
    factorial(N) -&gt; N * factorial(N-1).
</code></pre>
This code then spawns the server, sends a message to that server to become a factorial server, then tells that server to send it back a message with the factorial of 50.  It then specifies it&#x27;s own message listener that takes whatever it receives and returns it.<p><pre><code>    test() -&gt;
        Pid = spawn(fun universal_server&#x2F;0),
        Pid ! {become, fun factorial_server&#x2F;0},
        Pid ! {self(), 50},
        receive
            X -&gt; X
        end.
</code></pre>
A couple  of the major advantages of Erlang its distributed parallel nature, and also hot code update. Which happens in `Pid ! {become, fun factorial_server&#x2F;0}` where it overides the receive loop of universal_server with that of the factorial_server.  Though I think proper hot code update doesn&#x27;t work like this</div><br/></div></div><div id="37414556" class="c"><input type="checkbox" id="c-37414556" checked=""/><div class="controls bullet"><span class="by">brokencode</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414613">prev</a><span>|</span><a href="#37414621">next</a><span>|</span><label class="collapse" for="c-37414556">[-]</label><label class="expand" for="c-37414556">[5 more]</label></div><br/><div class="children"><div class="content">Normally you need to know ahead of time what your server is going to be used for and write the code in advance.<p>But with Erlang, you can have a distributed network of Erlang servers where the server is a generic computing resource that can do anything the client wants.<p>The code actually comes from the client. No need to get your system administrators to install some binary on all the machines. You simply pass the function along and the remote machine calls it.</div><br/><div id="37415868" class="c"><input type="checkbox" id="c-37415868" checked=""/><div class="controls bullet"><span class="by">zaphirplane</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414556">parent</a><span>|</span><a href="#37414618">next</a><span>|</span><label class="collapse" for="c-37415868">[-]</label><label class="expand" for="c-37415868">[1 more]</label></div><br/><div class="children"><div class="content">A few people here are liking the idea, isn’t this the exact definition of arbitrary code execution (exploit)<p>It’s possible people are showing the capability of BEAM thou</div><br/></div></div><div id="37414618" class="c"><input type="checkbox" id="c-37414618" checked=""/><div class="controls bullet"><span class="by">refactorworks</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414556">parent</a><span>|</span><a href="#37415868">prev</a><span>|</span><a href="#37414621">next</a><span>|</span><label class="collapse" for="c-37414618">[-]</label><label class="expand" for="c-37414618">[3 more]</label></div><br/><div class="children"><div class="content">Thanks! I get it — no need to install binaries of specific servers.</div><br/><div id="37415606" class="c"><input type="checkbox" id="c-37415606" checked=""/><div class="controls bullet"><span class="by">nesarkvechnep</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414618">parent</a><span>|</span><a href="#37415212">next</a><span>|</span><label class="collapse" for="c-37415606">[-]</label><label class="expand" for="c-37415606">[1 more]</label></div><br/><div class="children"><div class="content">Double check whether you think of the correct abstraction level. The BEAM is more like the JVM than Kubernetes.</div><br/></div></div><div id="37415212" class="c"><input type="checkbox" id="c-37415212" checked=""/><div class="controls bullet"><span class="by">rramadass</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414618">parent</a><span>|</span><a href="#37415606">prev</a><span>|</span><a href="#37414621">next</a><span>|</span><label class="collapse" for="c-37415212">[-]</label><label class="expand" for="c-37415212">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37415159">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37415159</a></div><br/></div></div></div></div></div></div><div id="37414621" class="c"><input type="checkbox" id="c-37414621" checked=""/><div class="controls bullet"><span class="by">jay-barronville</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414556">prev</a><span>|</span><a href="#37414560">next</a><span>|</span><label class="collapse" for="c-37414621">[-]</label><label class="expand" for="c-37414621">[2 more]</label></div><br/><div class="children"><div class="content">Basically, the idea is that it can become any type of server you’d like. The actual function to run the server is passed by the client and the Erlang process effectively morphs into that server after constructing it using the provided function. When you consider Erlang’s hot reloading abilities, this simple architecture becomes even more powerful. Another way to look at it is that the Erlang process is just compute waiting for work to do and the work is to run full-blown servers. Pretty neat.</div><br/><div id="37414627" class="c"><input type="checkbox" id="c-37414627" checked=""/><div class="controls bullet"><span class="by">jay-barronville</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414621">parent</a><span>|</span><a href="#37414560">next</a><span>|</span><label class="collapse" for="c-37414627">[-]</label><label class="expand" for="c-37414627">[1 more]</label></div><br/><div class="children"><div class="content">I was typing this answer on my phone and I didn’t realize several folks already responded. Move along, nothing to see here. Haha.</div><br/></div></div></div></div><div id="37414560" class="c"><input type="checkbox" id="c-37414560" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414621">prev</a><span>|</span><a href="#37414575">next</a><span>|</span><label class="collapse" for="c-37414560">[-]</label><label class="expand" for="c-37414560">[4 more]</label></div><br/><div class="children"><div class="content">I may be answering the wrong question, but I’ll give it a shot.<p>Erlang’s architecture is unusual; both the virtual machine and the language are built around the idea of tiny processes operating concurrently, each process running in an infinite loop waiting for incoming messages to interpret.<p>This allows a process to become whatever code you send it. If you need a process to control a microwave, and then run some quantum computations, and then predict the winner of tomorrow’s football game, you just send it the code it needs for each operation and it happily does so.</div><br/><div id="37414597" class="c"><input type="checkbox" id="c-37414597" checked=""/><div class="controls bullet"><span class="by">notRobot</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414560">parent</a><span>|</span><a href="#37414575">next</a><span>|</span><label class="collapse" for="c-37414597">[-]</label><label class="expand" for="c-37414597">[3 more]</label></div><br/><div class="children"><div class="content">Ah, so TL;DR is that each process evals the supplied code and returns the output to the caller?</div><br/><div id="37414674" class="c"><input type="checkbox" id="c-37414674" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414597">parent</a><span>|</span><a href="#37414610">next</a><span>|</span><label class="collapse" for="c-37414674">[-]</label><label class="expand" for="c-37414674">[1 more]</label></div><br/><div class="children"><div class="content">The universal server may or may not return anything. It just executes whatever is passed to it. In Erlang there are two ways of &quot;calling&quot; (in quotes for a reason). There&#x27;s conventional function calling which is the regular synchronous style that we all know and love:<p><pre><code>  f(10).
</code></pre>
This will produce a result and return it to its caller. The other isn&#x27;t really a call, it&#x27;s &quot;sending&quot;:<p><pre><code>  Pid ! 10.
</code></pre>
Some process id has been sent the value 10. It may be on this same node, it may be on another node, I don&#x27;t have to care (sometimes I do though). This is asynchronous. Once a send is done the sending process will continue on (perhaps even terminating). At the other end of the send is a receive (hopefully, otherwise somebody&#x27;s queue is getting filled up...):<p><pre><code>  receive
    N -&gt; ... % do something with this value
  end.
</code></pre>
In the case of `universal_server` we don&#x27;t know what it will become, it&#x27;s just going to execute whatever 0-ary function is passed. That function may or may not include a &quot;return&quot; (sending a value back to the origin). It could also just terminate the universal server. Or it could temporarily convert the universal server into something else and then become a universal server again.</div><br/></div></div><div id="37414610" class="c"><input type="checkbox" id="c-37414610" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414597">parent</a><span>|</span><a href="#37414674">prev</a><span>|</span><a href="#37414575">next</a><span>|</span><label class="collapse" for="c-37414610">[-]</label><label class="expand" for="c-37414610">[1 more]</label></div><br/><div class="children"><div class="content">Slightly different in the low-level details, but conceptually accurate.</div><br/></div></div></div></div></div></div><div id="37414575" class="c"><input type="checkbox" id="c-37414575" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414560">prev</a><span>|</span><a href="#37416314">next</a><span>|</span><label class="collapse" for="c-37414575">[-]</label><label class="expand" for="c-37414575">[1 more]</label></div><br/><div class="children"><div class="content">You execute that on any node in your system and send it a message `{become, fun some_function&#x2F;0}`. Once it receives that conforming message (a tuple of two items, the atom `become` and a 0-ary function) and that node will stop being a &quot;universal server&quot; and become whatever process &quot;some_function&quot; describes.<p>And in his case he had access to some 9000 computers. If each was running at least one Erlang node and each node was running a universal server, then with a very simple program he could write a function, serialize the function, and distribute the function to his 9k+ running universal servers and turn them into 9k+ specialized servers.</div><br/></div></div><div id="37416314" class="c"><input type="checkbox" id="c-37416314" checked=""/><div class="controls bullet"><span class="by">javajosh</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414575">prev</a><span>|</span><a href="#37414588">next</a><span>|</span><label class="collapse" for="c-37416314">[-]</label><label class="expand" for="c-37416314">[1 more]</label></div><br/><div class="children"><div class="content">You can achieve the same goal, if not so elegantly, if you define a node process that processes HTTP POSTs by evaling the body of the request to replace the previous handling function. In practice you&#x27;d quickly want to post a function that behaves normally. However you could also define a function that does something &quot;normal&quot; but has a code path for continually redefining the function.<p>As exotic as this sounds, this is very similar to what web-browsers do with script src tags, especially from 3rd parties. The page is saying &quot;Hey let me eval a function that can do whatever it wants in this context. I trust you!&quot; Most webdevs don&#x27;t consider this a threat vector!</div><br/></div></div><div id="37414588" class="c"><input type="checkbox" id="c-37414588" checked=""/><div class="controls bullet"><span class="by">agundy</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37416314">prev</a><span>|</span><a href="#37414628">next</a><span>|</span><label class="collapse" for="c-37414588">[-]</label><label class="expand" for="c-37414588">[1 more]</label></div><br/><div class="children"><div class="content">This universal server is a process listening for a message with a function and then it executes that function here the function is just a different infinite server turning a running process into something new. I think it shows off the power of erlang processes and the ability to pass functions to replace running processes with new behavior without changing pids.</div><br/></div></div><div id="37414628" class="c"><input type="checkbox" id="c-37414628" checked=""/><div class="controls bullet"><span class="by">xvilka</span><span>|</span><a href="#37414500">parent</a><span>|</span><a href="#37414588">prev</a><span>|</span><a href="#37415715">next</a><span>|</span><label class="collapse" for="c-37414628">[-]</label><label class="expand" for="c-37414628">[5 more]</label></div><br/><div class="children"><div class="content">Is the same trick possible with other BEAM languages? E.g. Elixir?</div><br/><div id="37414741" class="c"><input type="checkbox" id="c-37414741" checked=""/><div class="controls bullet"><span class="by">qohen</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414628">parent</a><span>|</span><a href="#37414890">next</a><span>|</span><label class="collapse" for="c-37414741">[-]</label><label class="expand" for="c-37414741">[1 more]</label></div><br/><div class="children"><div class="content">Yes. Here[0] is a gist showing it done in Elixir -- as you&#x27;ll see, it looks very similar to the Erlang code:<p>[0] <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;mndvns&#x2F;80b00cf67d418e8359fb5566b80aeb4c" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;mndvns&#x2F;80b00cf67d418e8359fb5566b80ae...</a></div><br/></div></div><div id="37414890" class="c"><input type="checkbox" id="c-37414890" checked=""/><div class="controls bullet"><span class="by">ungamedplayer</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414628">parent</a><span>|</span><a href="#37414741">prev</a><span>|</span><a href="#37415238">next</a><span>|</span><label class="collapse" for="c-37414890">[-]</label><label class="expand" for="c-37414890">[1 more]</label></div><br/><div class="children"><div class="content">Here is an aggressive worm&#x2F;virus that exploits this exact mechanism.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;wmealing&#x2F;Elixir-virus">https:&#x2F;&#x2F;github.com&#x2F;wmealing&#x2F;Elixir-virus</a></div><br/></div></div><div id="37415238" class="c"><input type="checkbox" id="c-37415238" checked=""/><div class="controls bullet"><span class="by">rramadass</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414628">parent</a><span>|</span><a href="#37414890">prev</a><span>|</span><a href="#37414749">next</a><span>|</span><label class="collapse" for="c-37415238">[-]</label><label class="expand" for="c-37415238">[1 more]</label></div><br/><div class="children"><div class="content">Yes; it is a property of the &quot;Erlang Run Time System&quot;(ERTS)&#x2F;&quot;VM&quot;(BEAM) - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37415159">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37415159</a></div><br/></div></div><div id="37414749" class="c"><input type="checkbox" id="c-37414749" checked=""/><div class="controls bullet"><span class="by">hmmokidk</span><span>|</span><a href="#37414500">root</a><span>|</span><a href="#37414628">parent</a><span>|</span><a href="#37415238">prev</a><span>|</span><a href="#37415715">next</a><span>|</span><label class="collapse" for="c-37414749">[-]</label><label class="expand" for="c-37414749">[1 more]</label></div><br/><div class="children"><div class="content">Yeah. I don’t see why not.</div><br/></div></div></div></div></div></div><div id="37415715" class="c"><input type="checkbox" id="c-37415715" checked=""/><div class="controls bullet"><span class="by">daitangio</span><span>|</span><a href="#37414500">prev</a><span>|</span><a href="#37415135">next</a><span>|</span><label class="collapse" for="c-37415715">[-]</label><label class="expand" for="c-37415715">[1 more]</label></div><br/><div class="children"><div class="content">There is also this lesson from Joe, about how to write a basic server in Erlang:<p><a href="https:&#x2F;&#x2F;gioorgi.com&#x2F;2015&#x2F;erlang-lesson1&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;gioorgi.com&#x2F;2015&#x2F;erlang-lesson1&#x2F;</a><p>I transcribed and explained a bit more: it shows the power of an async language like Erlang&#x2F;Elixir compared to other ones.
Sadly, it is little used nowadays</div><br/></div></div><div id="37415135" class="c"><input type="checkbox" id="c-37415135" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#37415715">prev</a><span>|</span><a href="#37415010">next</a><span>|</span><label class="collapse" for="c-37415135">[-]</label><label class="expand" for="c-37415135">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>My favorite Erlang Program (2013)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31639382">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=31639382</a> - June 2022 (19 comments)<p><i>My favorite Erlang program (2013)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=22413029">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=22413029</a> - Feb 2020 (54 comments)<p><i>My favorite Erlang Program (2013)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=12396420">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=12396420</a> - Aug 2016 (38 comments)<p><i>My favorite Erlang program (2013)</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8807660">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8807660</a> - Dec 2014 (2 comments)</div><br/></div></div><div id="37415010" class="c"><input type="checkbox" id="c-37415010" checked=""/><div class="controls bullet"><span class="by">weatherlight</span><span>|</span><a href="#37415135">prev</a><span>|</span><a href="#37415754">next</a><span>|</span><label class="collapse" for="c-37415010">[-]</label><label class="expand" for="c-37415010">[1 more]</label></div><br/><div class="children"><div class="content">I spend a lot of time trying to explain why the BEAM is special and why concurrency in Erlang&#x2F;elixir&#x2F;etc is special when juxtaposed next to Go&#x27;s or Java&#x27;s concurrency story (now that Loom is right around the corner).<p>From now on I&#x27;ll just link them to to Joe&#x27;s favorite Erlang program and this HN thread.</div><br/></div></div><div id="37415754" class="c"><input type="checkbox" id="c-37415754" checked=""/><div class="controls bullet"><span class="by">kitd</span><span>|</span><a href="#37415010">prev</a><span>|</span><a href="#37414589">next</a><span>|</span><label class="collapse" for="c-37415754">[-]</label><label class="expand" for="c-37415754">[3 more]</label></div><br/><div class="children"><div class="content">Excuse a noob question, but what gets transmitted over the wire as `F` in the `become` message? Source, bytecode, function name, etc? ie. does the universal server need F in its &quot;classpath&quot; (or whatever the Erlang equivalent is)? If not, are there platform &amp;| security issues when calling the universal server distributed?<p>Genuine question. It&#x27;s a fantastic attribute of Erlang to be able to do this.</div><br/><div id="37415940" class="c"><input type="checkbox" id="c-37415940" checked=""/><div class="controls bullet"><span class="by">dottedmag</span><span>|</span><a href="#37415754">parent</a><span>|</span><a href="#37415895">next</a><span>|</span><label class="collapse" for="c-37415940">[-]</label><label class="expand" for="c-37415940">[1 more]</label></div><br/><div class="children"><div class="content">It will be a closure &quot;fun () -&gt; ...&quot;, and it&#x27;s serialized bytecode + a copy of captured variables — remember, they all are immutable. For a intra-node call it will be a reference to the bytecode, no need to copy anything.<p>However if this code refers to any functions from modules via syntax &quot;foo:bar&#x2F;1&quot; then these references will be resolved on the target node, and both nodes better have the same versions of modules loaded.</div><br/></div></div><div id="37415895" class="c"><input type="checkbox" id="c-37415895" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#37415754">parent</a><span>|</span><a href="#37415940">prev</a><span>|</span><a href="#37414589">next</a><span>|</span><label class="collapse" for="c-37415895">[-]</label><label class="expand" for="c-37415895">[1 more]</label></div><br/><div class="children"><div class="content">There are no extra security issues, because at this point you already assume that the other side is trustworthy.<p>I think you can assume that they are sending something like bytecode, but might optimize that, if both are eg on the same physical machine.</div><br/></div></div></div></div><div id="37414589" class="c"><input type="checkbox" id="c-37414589" checked=""/><div class="controls bullet"><span class="by">hmmokidk</span><span>|</span><a href="#37415754">prev</a><span>|</span><a href="#37415072">next</a><span>|</span><label class="collapse" for="c-37414589">[-]</label><label class="expand" for="c-37414589">[1 more]</label></div><br/><div class="children"><div class="content">My favorite Erlang programmer.<p>RIP Joe.</div><br/></div></div><div id="37415072" class="c"><input type="checkbox" id="c-37415072" checked=""/><div class="controls bullet"><span class="by">tombert</span><span>|</span><a href="#37414589">prev</a><span>|</span><a href="#37415082">next</a><span>|</span><label class="collapse" for="c-37415072">[-]</label><label class="expand" for="c-37415072">[1 more]</label></div><br/><div class="children"><div class="content">My latest obsession has been the Julia language, which seems to borrow a number of ideas from Erlang in its distributed model.  It&#x27;s reasonably easy to replicate this kind of &quot;instant-server&quot; that magically works across multiple nodes. I don&#x27;t know for sure, but I would be surprised if Julia&#x27;s Distributed module wasn&#x27;t at least a little inspired by Erlang.<p>I absolutely love Erlang, and I wish I had more of an opportunity to use it, but it&#x27;s nice to see that some of its concepts are bleeding into other platforms.</div><br/></div></div><div id="37415082" class="c"><input type="checkbox" id="c-37415082" checked=""/><div class="controls bullet"><span class="by">orangea</span><span>|</span><a href="#37415072">prev</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415082">[-]</label><label class="expand" for="c-37415082">[12 more]</label></div><br/><div class="children"><div class="content">&gt; What I ended up doing was making some scripts to install empty universal Erlang servers on all the Planet lab machines (pretty much like the code in this article) - then I set up a gossip algorithm to flood the network with become messages. Then I had an empty network that in a few seconds would become anything I wanted it to do.<p>But you already had an empty network that in a few seconds would become anything you wanted it to, that&#x27;s how you installed empty universal Erlang servers on all the computers.</div><br/><div id="37415245" class="c"><input type="checkbox" id="c-37415245" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#37415082">parent</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415245">[-]</label><label class="expand" for="c-37415245">[11 more]</label></div><br/><div class="children"><div class="content">The difference is I think that you hand off managing the distribution of the code to the Erlang VM, making it much easier to distribute anything else.<p>Of course security guys are going &quot;Wait, every machine has an open RPC channel that will blindly execute code to every other machine???&quot;</div><br/><div id="37415311" class="c"><input type="checkbox" id="c-37415311" checked=""/><div class="controls bullet"><span class="by">stephenr</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415245">parent</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415311">[-]</label><label class="expand" for="c-37415311">[10 more]</label></div><br/><div class="children"><div class="content">&gt; security guys are going<p>It&#x27;s a bit concerning if it&#x27;s <i>only</i> &quot;security guys&quot; seeing issues with this approach.</div><br/><div id="37415637" class="c"><input type="checkbox" id="c-37415637" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415311">parent</a><span>|</span><a href="#37415725">next</a><span>|</span><label class="collapse" for="c-37415637">[-]</label><label class="expand" for="c-37415637">[3 more]</label></div><br/><div class="children"><div class="content">A cluster of Erlang nodes in distribution don&#x27;t have a security boundary once they&#x27;re connected. Neither do two threads in the same process in a traditional system.<p>If that&#x27;s an issue, and I can see why it might be for some, you&#x27;ll need to use something other than Erlang distribution to connect your cluster.<p>You <i>can</i> patch out the explicit rpc server, but I&#x27;m not sure that you can patch out receiving functions (maybe removing the code that deserializes them from external term format would work?), and you&#x27;d need to audit the whole thing to ensure nothing ever calls a function it receives.</div><br/><div id="37415750" class="c"><input type="checkbox" id="c-37415750" checked=""/><div class="controls bullet"><span class="by">stephenr</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415637">parent</a><span>|</span><a href="#37415725">next</a><span>|</span><label class="collapse" for="c-37415750">[-]</label><label class="expand" for="c-37415750">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m <i>not</i> a security guy, so I can&#x27;t speak for what their concerns would be.<p>I think <i>my</i> concern would be more in the realm of, you&#x27;re inherently relying on whatever peer authentication system BEAM uses (and it being bug&#x2F;exploit-free), to determine whether an RPC call can suddenly inject new code into a running system.<p>In my experience good security is a lot like an onion - there&#x27;s lots of layers and generally some crying.<p>If we consider a &quot;non-BEAM&quot; system that runs on say JVM, or even a &quot;scripting&quot; runtime (e.g. PHP, Python, Ruby, NodeJS) - you typically have a number of elements that (can) contribute to making the code that runs, relatively immutable outside of a deployment event (e.g., restricting access to ssh&#x2F;sftp&#x2F;etc protocols; varying types of filesystem permissions; readonly volumes; container filesystems; etc)<p>Do other systems have similar &quot;run arbitrary code&quot; vulnerabilities? Sure. Allowing uploaded content to be executed by the PHP runtime is a classic example. But there&#x27;s almost no legitimate purpose for this, it&#x27;s almost certainly a configuration error&#x2F;mistake, and it&#x27;s relatively trivial to prevent it completely.</div><br/><div id="37416001" class="c"><input type="checkbox" id="c-37416001" checked=""/><div class="controls bullet"><span class="by">qaq</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415750">parent</a><span>|</span><a href="#37415725">next</a><span>|</span><label class="collapse" for="c-37416001">[-]</label><label class="expand" for="c-37416001">[1 more]</label></div><br/><div class="children"><div class="content">You can lock things down to your hearts content using features of your OS of choice.</div><br/></div></div></div></div></div></div><div id="37415725" class="c"><input type="checkbox" id="c-37415725" checked=""/><div class="controls bullet"><span class="by">sph</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415311">parent</a><span>|</span><a href="#37415637">prev</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415725">[-]</label><label class="expand" for="c-37415725">[6 more]</label></div><br/><div class="children"><div class="content">You&#x27;re not supposed to open the Erlang RPC port to the open Internet, and there is a modicum of security barrier with its cookie if you&#x27;re so inept as to run Erlang on a non-firewalled server on the open Internet.<p>You don&#x27;t need security people for basic sysadmin know how.</div><br/><div id="37415950" class="c"><input type="checkbox" id="c-37415950" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415725">parent</a><span>|</span><a href="#37415766">next</a><span>|</span><label class="collapse" for="c-37415950">[-]</label><label class="expand" for="c-37415950">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, but what happens when your local web browser is tricked into opening a socket to the local Erlang instance by a malicious web page?  That&#x27;s the kind of thing that keeps security professionals up all night.</div><br/><div id="37416202" class="c"><input type="checkbox" id="c-37416202" checked=""/><div class="controls bullet"><span class="by">marksomnian</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415950">parent</a><span>|</span><a href="#37415766">next</a><span>|</span><label class="collapse" for="c-37416202">[-]</label><label class="expand" for="c-37416202">[1 more]</label></div><br/><div class="children"><div class="content">It’s a binary protocol though, which means that this specific scenario isn’t an issue as far as I’m aware (the only ways of making arbitrary JS-controlled network requests are XHR&#x2F;fetch(), which is only HTTP, and WebSockets, which have a handshake mechanism to ensure that the other side is really expecting a WS connection, which Erlang won’t be).</div><br/></div></div></div></div><div id="37415766" class="c"><input type="checkbox" id="c-37415766" checked=""/><div class="controls bullet"><span class="by">stephenr</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415725">parent</a><span>|</span><a href="#37415950">prev</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415766">[-]</label><label class="expand" for="c-37415766">[3 more]</label></div><br/><div class="children"><div class="content">You do apparently need security or basic sysadmin knowhow to understand that not all security threats originate from &quot;the open Internet&quot;</div><br/><div id="37415928" class="c"><input type="checkbox" id="c-37415928" checked=""/><div class="controls bullet"><span class="by">sph</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415766">parent</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415928">[-]</label><label class="expand" for="c-37415928">[2 more]</label></div><br/><div class="children"><div class="content">So? How is this specifically relevant to the topic at hand?<p>If you have someone malicious in your internal network that can connect to your Erlang nodes, you have bigger issues that them connecting to your Erlang nodes.<p>I don&#x27;t see the point of your original comment. Having an out-of-the-box RPC mechanism means you gotta secure it as you secure any other internal service. That&#x27;s sysadmin 101.</div><br/><div id="37415952" class="c"><input type="checkbox" id="c-37415952" checked=""/><div class="controls bullet"><span class="by">stephenr</span><span>|</span><a href="#37415082">root</a><span>|</span><a href="#37415928">parent</a><span>|</span><a href="#37416008">next</a><span>|</span><label class="collapse" for="c-37415952">[-]</label><label class="expand" for="c-37415952">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I don&#x27;t see the point of your original comment. Having an out-of-the-box RPC mechanism means you gotta secure it as you secure any other internal service. That&#x27;s sysadmin 101<p><i>Most</i> RPC systems can&#x27;t inject code into the running system dynamically. That&#x27;s the point of my original post.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="37416008" class="c"><input type="checkbox" id="c-37416008" checked=""/><div class="controls bullet"><span class="by">kaycey2022</span><span>|</span><a href="#37415082">prev</a><span>|</span><a href="#37415480">next</a><span>|</span><label class="collapse" for="c-37416008">[-]</label><label class="expand" for="c-37416008">[1 more]</label></div><br/><div class="children"><div class="content">Do we have any alternative that compares to planet labs today?</div><br/></div></div><div id="37415480" class="c"><input type="checkbox" id="c-37415480" checked=""/><div class="controls bullet"><span class="by">p-e-w</span><span>|</span><a href="#37416008">prev</a><span>|</span><a href="#37414707">next</a><span>|</span><label class="collapse" for="c-37415480">[-]</label><label class="expand" for="c-37415480">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Dean was doing an Erlang project so he asked “What example program would best exemplify Erlang“.<p>I wish such a canonical example was easy to find for every programming language, particularly those on the boundary between mainstream and exotic languages.<p>Most languages present themselves by waxing philosophical about HoTT, zero-cost abstractions, or parametric types. Show me an example where your language is <i>clearly</i> better than Python, Ruby, TypeScript, C#, or Rust, because those are the languages to beat, and they already have the entire infrastructure set up so unless you can demonstrably outperform them in <i>some</i> way, it&#x27;s probably not worth my time to take a deeper look.</div><br/><div id="37416065" class="c"><input type="checkbox" id="c-37416065" checked=""/><div class="controls bullet"><span class="by">almost</span><span>|</span><a href="#37415480">parent</a><span>|</span><a href="#37414707">next</a><span>|</span><label class="collapse" for="c-37416065">[-]</label><label class="expand" for="c-37416065">[1 more]</label></div><br/><div class="children"><div class="content">But what if it’s better for complex tasks or large programs? I also wish language home pages would show examples of what makes the language special right away but it’s not always that easy.</div><br/></div></div></div></div></div></div></div></div></div></body></html>