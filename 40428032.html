<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716368468768" as="style"/><link rel="stylesheet" href="styles.css?v=1716368468768"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://vin01.github.io/piptagole/escape-sequences/iterm2/hyper/url-handlers/code-execution/2024/05/21/arbitrary-url-schemes-terminal-emulators.html">Abusing url handling in iTerm2 and Hyper for code execution</a>Â <span class="domain">(<a href="https://vin01.github.io">vin01.github.io</a>)</span></div><div class="subtext"><span>vin10</span> | <span>20 comments</span></div><br/><div><div id="40437460" class="c"><input type="checkbox" id="c-40437460" checked=""/><div class="controls bullet"><span class="by">leftcenterright</span><span>|</span><a href="#40438498">next</a><span>|</span><label class="collapse" for="c-40437460">[-]</label><label class="expand" for="c-40437460">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This is of course a harmless PoC and you can try it out using docker pull vin01&#x2F;escape-seq-test:latest --platform darwin&#x2F;arm64 or docker run --rm vin01&#x2F;escape-seq-test and you should see the injected link as shown below.<p>Wow, I wouldn&#x27;t have expected `docker pull` in particular to allow arbitrary content injection. Does anyone know of any tools which scan images being pulled before passing them over to `docker` for processing?</div><br/></div></div><div id="40438498" class="c"><input type="checkbox" id="c-40438498" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#40437460">prev</a><span>|</span><a href="#40433742">next</a><span>|</span><label class="collapse" for="c-40438498">[-]</label><label class="expand" for="c-40438498">[4 more]</label></div><br/><div class="children"><div class="content">At the very end of the article,<p>&gt; Upgrade to iTerm2 3.5.0<p>I had just gotten the upgrade notification for 3.5.0 a few minutes ago.  I scrolled through the release notes a bit and got to the &quot;AI&quot; section and I would like very much to get off this ride.  I am grumpy and a terminal should be a terminal.<p>Features of iTerm2 I don&#x27;t use and don&#x27;t think belong in a terminal emulator:<p><pre><code>  - tmux integration
  - shell integration
  - ssh integration
  - password manager integration
  - hooks
  - syntax highlighting *that&#x27;s baked into the terminal*
  - installing its own python runtimes (?!)
  - ~blindly~ opening URLs when rendering a certain escape sequence [0]
</code></pre>
[0] <a href="https:&#x2F;&#x2F;gitlab.com&#x2F;gnachman&#x2F;iterm2&#x2F;-&#x2F;issues&#x2F;10994" rel="nofollow">https:&#x2F;&#x2F;gitlab.com&#x2F;gnachman&#x2F;iterm2&#x2F;-&#x2F;issues&#x2F;10994</a>  the discussion in there makes it seem like it&#x27;s okay because many schemes that aren&#x27;t http[s] cause the browser to open a dialog box<p>Features of iTerm2 I use:<p><pre><code>  - fullscreen without using MacOS&#x27;s spaces implementation of fullscreen

</code></pre>
.... This got away from me and went from grumpy muttering to a snarky rant.  I like iTerm2, it&#x27;s just starting to feel like somebody else&#x27;s terminal, that&#x27;s all.<p><i>Edit: tried to cross out &quot;blindly&quot; above, it does ask you whether you want to open the URL, though it offers to always allow it for that host which seems like it might be iffy, but at least if I never click &quot;always allow&quot;, I&#x27;ll be notified if anything tries to inject this OSC sequence.</i></div><br/><div id="40438513" class="c"><input type="checkbox" id="c-40438513" checked=""/><div class="controls bullet"><span class="by">shzhdbi09gv8ioi</span><span>|</span><a href="#40438498">parent</a><span>|</span><a href="#40438722">next</a><span>|</span><label class="collapse" for="c-40438513">[-]</label><label class="expand" for="c-40438513">[2 more]</label></div><br/><div class="children"><div class="content">Give wezterm a try: <a href="https:&#x2F;&#x2F;wezfurlong.org&#x2F;wezterm&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;wezfurlong.org&#x2F;wezterm&#x2F;index.html</a><p>It is cross OS (learn once and use the same terminal in Windows, macOS and Linux), actively developed and written in rust</div><br/><div id="40438603" class="c"><input type="checkbox" id="c-40438603" checked=""/><div class="controls bullet"><span class="by">leftcenterright</span><span>|</span><a href="#40438498">root</a><span>|</span><a href="#40438513">parent</a><span>|</span><a href="#40438722">next</a><span>|</span><label class="collapse" for="c-40438603">[-]</label><label class="expand" for="c-40438603">[1 more]</label></div><br/><div class="children"><div class="content">While it is nice to have options, I still think iTerm2 is one of the best terminal emulators for OS X out there. It has also most likely been audited more thoroughly than newer options out there. There was a security audit sponsored by Mozilla in 2019 [1].<p>1. <a href="https:&#x2F;&#x2F;blog.mozilla.org&#x2F;security&#x2F;2019&#x2F;10&#x2F;09&#x2F;iterm2-critical-issue-moss-audit&#x2F;" rel="nofollow">https:&#x2F;&#x2F;blog.mozilla.org&#x2F;security&#x2F;2019&#x2F;10&#x2F;09&#x2F;iterm2-critical...</a></div><br/></div></div></div></div><div id="40438722" class="c"><input type="checkbox" id="c-40438722" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#40438498">parent</a><span>|</span><a href="#40438513">prev</a><span>|</span><a href="#40433742">next</a><span>|</span><label class="collapse" for="c-40438722">[-]</label><label class="expand" for="c-40438722">[1 more]</label></div><br/><div class="children"><div class="content">Honestly I never understood the need to replace macOS Terminal. I&#x27;m heavy terminal user, that&#x27;s my most used application by far. But macOS Terminal is absolutely fine for my needs and I never felt the need for any additional features.</div><br/></div></div></div></div><div id="40436288" class="c"><input type="checkbox" id="c-40436288" checked=""/><div class="controls bullet"><span class="by">Groxx</span><span>|</span><a href="#40433742">prev</a><span>|</span><a href="#40438443">next</a><span>|</span><label class="collapse" for="c-40436288">[-]</label><label class="expand" for="c-40436288">[12 more]</label></div><br/><div class="children"><div class="content">&gt;<i>Any links using those schemes when clicked, would open the MacOS terminal to perform the corresponding action.</i><p>I&#x27;m unclear which of these are being described:<p>1: when printed and clicked, they may be handled by the terminal, and the terminal&#x27;s handling allows more behaviors than it should, allowing code execution<p>2: when printed, these urls are <i>automatically</i> executed by the shell, allowing code execution<p>Neither are good of course, but they&#x27;re different levels of badness, and I feel like I must be missing a single critical word somewhere to be able to figure out which it is.<p>---<p>That said, oh boy I do not want this:<p>&gt;<i>Most terminal emulators these days allow using Osc 8 to directly generate hyperlinks from arbitrary text.</i><p>Is there a standard way to disable it? That sounds awful, terminals don&#x27;t have even a small fraction of browsers&#x27; malicious-link-defense mechanisms (as demonstrated).  I <i>always</i> want to see the full url in a terminal.</div><br/><div id="40436331" class="c"><input type="checkbox" id="c-40436331" checked=""/><div class="controls bullet"><span class="by">Repulsion9513</span><span>|</span><a href="#40436288">parent</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40436331">[-]</label><label class="expand" for="c-40436331">[9 more]</label></div><br/><div class="children"><div class="content">You never want to see raw, attacker-supplied text in a terminal, actually.</div><br/><div id="40436410" class="c"><input type="checkbox" id="c-40436410" checked=""/><div class="controls bullet"><span class="by">Groxx</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40436331">parent</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40436410">[-]</label><label class="expand" for="c-40436410">[8 more]</label></div><br/><div class="children"><div class="content">It sure is a good thing we never run anything in our terminals without fully vetting all output.<p><pre><code>     curl -s -L https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Groxx&#x2F;rickrollrc&#x2F;master&#x2F;roll.sh | bash</code></pre></div><br/><div id="40436706" class="c"><input type="checkbox" id="c-40436706" checked=""/><div class="controls bullet"><span class="by">labster</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40436410">parent</a><span>|</span><a href="#40437440">next</a><span>|</span><label class="collapse" for="c-40436706">[-]</label><label class="expand" for="c-40436706">[3 more]</label></div><br/><div class="children"><div class="content">You know the rules, and so do I.</div><br/><div id="40436986" class="c"><input type="checkbox" id="c-40436986" checked=""/><div class="controls bullet"><span class="by">dv_dt</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40436706">parent</a><span>|</span><a href="#40437440">next</a><span>|</span><label class="collapse" for="c-40436986">[-]</label><label class="expand" for="c-40436986">[2 more]</label></div><br/><div class="children"><div class="content">I know I prefer my exploits to come from opaque corners of package formats or docker layers as bofh intended. The more indirect handoffs of trust the merrier.</div><br/><div id="40437124" class="c"><input type="checkbox" id="c-40437124" checked=""/><div class="controls bullet"><span class="by">Timber-6539</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40436986">parent</a><span>|</span><a href="#40437440">next</a><span>|</span><label class="collapse" for="c-40437124">[-]</label><label class="expand" for="c-40437124">[1 more]</label></div><br/><div class="children"><div class="content">Docker is at least sandboxed by default and requires sudo password to run commands.</div><br/></div></div></div></div></div></div><div id="40437440" class="c"><input type="checkbox" id="c-40437440" checked=""/><div class="controls bullet"><span class="by">StableAlkyne</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40436410">parent</a><span>|</span><a href="#40436706">prev</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40437440">[-]</label><label class="expand" for="c-40437440">[4 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t believe curl | sh is <i>still</i> the recommended way to install oh-my-zsh</div><br/><div id="40437611" class="c"><input type="checkbox" id="c-40437611" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40437440">parent</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40437611">[-]</label><label class="expand" for="c-40437611">[3 more]</label></div><br/><div class="children"><div class="content">Getting it out of a repository wouldn&#x27;t make any more vetting appear as if by magic.<p>And if you&#x27;re facing an attacker sophisticated enough to send different contents to a browser and to curl, then you&#x27;re probably not going to find their backdoor in the first place.  And it would be stupid of them to depend on that trick, so this becomes an extremely niche case not worth worrying about.<p>And multiply that sophistication by a hundred times because this is on github servers.<p>The &quot;what if the file is truncated&quot; issue is the only realistic one, and competent installers like this one define functions and don&#x27;t run them until the last line.</div><br/><div id="40437718" class="c"><input type="checkbox" id="c-40437718" checked=""/><div class="controls bullet"><span class="by">Repulsion9513</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40437611">parent</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40437718">[-]</label><label class="expand" for="c-40437718">[2 more]</label></div><br/><div class="children"><div class="content">&gt; sophisticated enough to send different contents to a browser and to curl<p>Checking the Accept header (or User-Agent or a bunch of other things) is very difficult :)</div><br/><div id="40438765" class="c"><input type="checkbox" id="c-40438765" checked=""/><div class="controls bullet"><span class="by">soraminazuki</span><span>|</span><a href="#40436288">root</a><span>|</span><a href="#40437718">parent</a><span>|</span><a href="#40437497">next</a><span>|</span><label class="collapse" for="c-40438765">[-]</label><label class="expand" for="c-40438765">[1 more]</label></div><br/><div class="children"><div class="content">GP likely meant differentiating `curl` and `curl | bash`.<p><a href="https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20240520142212&#x2F;https:&#x2F;&#x2F;www.idontplaydarts.com&#x2F;2016&#x2F;04&#x2F;detecting-curl-pipe-bash-server-side&#x2F;" rel="nofollow">https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20240520142212&#x2F;https:&#x2F;&#x2F;www.idont...</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40437497" class="c"><input type="checkbox" id="c-40437497" checked=""/><div class="controls bullet"><span class="by">vin10</span><span>|</span><a href="#40436288">parent</a><span>|</span><a href="#40436331">prev</a><span>|</span><a href="#40437666">next</a><span>|</span><label class="collapse" for="c-40437497">[-]</label><label class="expand" for="c-40437497">[1 more]</label></div><br/><div class="children"><div class="content">It is the first one, they need to be printed and clicked.</div><br/></div></div><div id="40437666" class="c"><input type="checkbox" id="c-40437666" checked=""/><div class="controls bullet"><span class="by">eviks</span><span>|</span><a href="#40436288">parent</a><span>|</span><a href="#40437497">prev</a><span>|</span><a href="#40438443">next</a><span>|</span><label class="collapse" for="c-40437666">[-]</label><label class="expand" for="c-40437666">[1 more]</label></div><br/><div class="children"><div class="content">Think you can see the full url one mouse over in some terminals (and rebind what clicks do to disable opening)</div><br/></div></div></div></div><div id="40438443" class="c"><input type="checkbox" id="c-40438443" checked=""/><div class="controls bullet"><span class="by">classified</span><span>|</span><a href="#40436288">prev</a><span>|</span><label class="collapse" for="c-40438443">[-]</label><label class="expand" for="c-40438443">[1 more]</label></div><br/><div class="children"><div class="content">I stopped using iTerm2 as soon as I learned it will open arbitrary URLs.</div><br/></div></div></div></div></div></div></div></body></html>