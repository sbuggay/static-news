<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1699434060476" as="style"/><link rel="stylesheet" href="styles.css?v=1699434060476"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://wasmfx.dev/">WasmFX: Effect Handlers for WebAssembly</a> <span class="domain">(<a href="https://wasmfx.dev">wasmfx.dev</a>)</span></div><div class="subtext"><span>BentonE</span> | <span>29 comments</span></div><br/><div><div id="38185279" class="c"><input type="checkbox" id="c-38185279" checked=""/><div class="controls bullet"><span class="by">infogulch</span><span>|</span><a href="#38187185">next</a><span>|</span><label class="collapse" for="c-38185279">[-]</label><label class="expand" for="c-38185279">[11 more]</label></div><br/><div class="children"><div class="content">I first heard of algebraic effects in a presentation about Unison recorded at Strangeloop. Realizing that exceptions, async, generators, and continuations could all be unified and implemented on top of one language feature was mind expanding.<p>It looks like the juicy details are in the Explainer:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;WebAssembly&#x2F;stack-switching&#x2F;blob&#x2F;main&#x2F;proposals&#x2F;continuations&#x2F;Explainer.md">https:&#x2F;&#x2F;github.com&#x2F;WebAssembly&#x2F;stack-switching&#x2F;blob&#x2F;main&#x2F;pro...</a></div><br/><div id="38186344" class="c"><input type="checkbox" id="c-38186344" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#38185279">parent</a><span>|</span><a href="#38187114">next</a><span>|</span><label class="collapse" for="c-38186344">[-]</label><label class="expand" for="c-38186344">[6 more]</label></div><br/><div class="children"><div class="content">The problem with abstracting control flow has always been the ease of composition within a program. I&#x27;m not sure if algebraic effects make that better, although I like the simplest form (exceptions with resume) for error handling.<p>It&#x27;s kind of like abelian groups and hyper graphs. They generalize many domains very nicely, and are an attractive abstraction. But it turns out they&#x27;re too abstract for any individual domain, and don&#x27;t make life easier. The PL world seems to have learned that lesson from call&#x2F;cc, but I don&#x27;t know if they&#x27;ve reached it yet with algebraic effects - although it seems looming.<p>Control flow is sexy for PL researchers, so it makes sense why it&#x27;s hot right now. Faster matrix multiplications are much more boring, no matter how much better they make society than weird control flow.<p>Just personally, I can count on one hand the number of algorithms I&#x27;ve written where weird control flow was necessary to make the algorithm easier, and they were all weird shit that I expect other people to use libraries for in most cases.</div><br/><div id="38186598" class="c"><input type="checkbox" id="c-38186598" checked=""/><div class="controls bullet"><span class="by">lolinder</span><span>|</span><a href="#38185279">root</a><span>|</span><a href="#38186344">parent</a><span>|</span><a href="#38187357">next</a><span>|</span><label class="collapse" for="c-38186598">[-]</label><label class="expand" for="c-38186598">[3 more]</label></div><br/><div class="children"><div class="content">&gt; they were all weird shit that I expect other people to use libraries for in most cases.<p>The theory with algebraic effects is that you&#x27;d use them to <i>implement</i> those libraries. Most application code won&#x27;t be implementing new types of effects, but exceptions, generators, async, and who knows what else can be implemented at the library level instead of the language level.<p>In theory it&#x27;s a single abstraction that can be implemented once in the language and then all the more complicated abstractions can be swapped out as desired, rather than the current status quo where everyone has to use whatever patterns the language designers chose (which are often rather contentious).</div><br/><div id="38186924" class="c"><input type="checkbox" id="c-38186924" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#38185279">root</a><span>|</span><a href="#38186598">parent</a><span>|</span><a href="#38187357">next</a><span>|</span><label class="collapse" for="c-38186924">[-]</label><label class="expand" for="c-38186924">[2 more]</label></div><br/><div class="children"><div class="content">My point is that it&#x27;s incredibly rare to actually need such abstractions.</div><br/><div id="38187124" class="c"><input type="checkbox" id="c-38187124" checked=""/><div class="controls bullet"><span class="by">infogulch</span><span>|</span><a href="#38185279">root</a><span>|</span><a href="#38186924">parent</a><span>|</span><a href="#38187357">next</a><span>|</span><label class="collapse" for="c-38187124">[-]</label><label class="expand" for="c-38187124">[1 more]</label></div><br/><div class="children"><div class="content">Maybe it&#x27;s worth investing into foundational research, instead of charging anyone who tries to do something new as frivolously chasing their own boredom.</div><br/></div></div></div></div></div></div><div id="38187357" class="c"><input type="checkbox" id="c-38187357" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#38185279">root</a><span>|</span><a href="#38186344">parent</a><span>|</span><a href="#38186598">prev</a><span>|</span><a href="#38187272">next</a><span>|</span><label class="collapse" for="c-38187357">[-]</label><label class="expand" for="c-38187357">[1 more]</label></div><br/><div class="children"><div class="content">But that’s the point…? it’s webassembly not JavaScript or Python. You aren’t really expected to write any of this by hand, even if it’s basically what async functions do under the hood when you type await whatever.</div><br/></div></div><div id="38187272" class="c"><input type="checkbox" id="c-38187272" checked=""/><div class="controls bullet"><span class="by">spankalee</span><span>|</span><a href="#38185279">root</a><span>|</span><a href="#38186344">parent</a><span>|</span><a href="#38187357">prev</a><span>|</span><a href="#38187114">next</a><span>|</span><label class="collapse" for="c-38187272">[-]</label><label class="expand" for="c-38187272">[1 more]</label></div><br/><div class="children"><div class="content">WASM is used to implement all kinds of control flow in other languages, so here it makes a lot of sense to have a lower level abstraction.<p>The languages on top of WASM will still have exceptions, generators, etc.</div><br/></div></div></div></div><div id="38187114" class="c"><input type="checkbox" id="c-38187114" checked=""/><div class="controls bullet"><span class="by">phplovesong</span><span>|</span><a href="#38185279">parent</a><span>|</span><a href="#38186344">prev</a><span>|</span><a href="#38185878">next</a><span>|</span><label class="collapse" for="c-38187114">[-]</label><label class="expand" for="c-38187114">[1 more]</label></div><br/><div class="children"><div class="content">Yes! This is why im super exited about Ocaml 5.0. The ongoing work is now to add typed effects to the typesystem.</div><br/></div></div><div id="38185878" class="c"><input type="checkbox" id="c-38185878" checked=""/><div class="controls bullet"><span class="by">fiddlerwoaroof</span><span>|</span><a href="#38185279">parent</a><span>|</span><a href="#38187114">prev</a><span>|</span><a href="#38187394">next</a><span>|</span><label class="collapse" for="c-38185878">[-]</label><label class="expand" for="c-38185878">[1 more]</label></div><br/><div class="children"><div class="content">Algebraic effect and delimited continuations have equivalent power. I think, for example, GHC added delimited continuations, in part, because they made it easier to implement algebraic effects efficiently.</div><br/></div></div><div id="38187394" class="c"><input type="checkbox" id="c-38187394" checked=""/><div class="controls bullet"><span class="by">singularity2001</span><span>|</span><a href="#38185279">parent</a><span>|</span><a href="#38185878">prev</a><span>|</span><a href="#38187646">next</a><span>|</span><label class="collapse" for="c-38187394">[-]</label><label class="expand" for="c-38187394">[1 more]</label></div><br/><div class="children"><div class="content">Does this approach avoid function coloring? That is: do legacy calls of functions containing yield instructions just treat these as nop?</div><br/></div></div><div id="38187646" class="c"><input type="checkbox" id="c-38187646" checked=""/><div class="controls bullet"><span class="by">JaggerJo</span><span>|</span><a href="#38185279">parent</a><span>|</span><a href="#38187394">prev</a><span>|</span><a href="#38187185">next</a><span>|</span><label class="collapse" for="c-38187646">[-]</label><label class="expand" for="c-38187646">[1 more]</label></div><br/><div class="children"><div class="content">Any chance you still know the title of the strangeloop presentation?</div><br/></div></div></div></div><div id="38187185" class="c"><input type="checkbox" id="c-38187185" checked=""/><div class="controls bullet"><span class="by">asplake</span><span>|</span><a href="#38185279">prev</a><span>|</span><a href="#38186730">next</a><span>|</span><label class="collapse" for="c-38187185">[-]</label><label class="expand" for="c-38187185">[1 more]</label></div><br/><div class="children"><div class="content">Enjoyed the linked (more detailed) explainer: <a href="https:&#x2F;&#x2F;github.com&#x2F;WebAssembly&#x2F;stack-switching&#x2F;blob&#x2F;main&#x2F;proposals&#x2F;continuations&#x2F;Explainer.md">https:&#x2F;&#x2F;github.com&#x2F;WebAssembly&#x2F;stack-switching&#x2F;blob&#x2F;main&#x2F;pro...</a></div><br/></div></div><div id="38186730" class="c"><input type="checkbox" id="c-38186730" checked=""/><div class="controls bullet"><span class="by">qudat</span><span>|</span><a href="#38187185">prev</a><span>|</span><a href="#38186498">next</a><span>|</span><label class="collapse" for="c-38186730">[-]</label><label class="expand" for="c-38186730">[1 more]</label></div><br/><div class="children"><div class="content">I recently gave a talk on delimited continuations for anyone curious <a href="https:&#x2F;&#x2F;youtu.be&#x2F;uRbqLGj_6mI?si=cOqlJighLJE42c-Q" rel="nofollow noreferrer">https:&#x2F;&#x2F;youtu.be&#x2F;uRbqLGj_6mI?si=cOqlJighLJE42c-Q</a></div><br/></div></div><div id="38186498" class="c"><input type="checkbox" id="c-38186498" checked=""/><div class="controls bullet"><span class="by">chii</span><span>|</span><a href="#38186730">prev</a><span>|</span><a href="#38187436">next</a><span>|</span><label class="collapse" for="c-38186498">[-]</label><label class="expand" for="c-38186498">[4 more]</label></div><br/><div class="children"><div class="content">the monika &#x27;fx&#x27; is often used by graphics pipelines or rendering to mean special effects, and thus often take on the connotation of being related to graphics or rendering (e.g., javaFX).<p>I dont think wasmfx should use this monika, as it makes it sound more graphics related than it really is. Naming and connotation of a name is important, as it frames the way people think about things.</div><br/><div id="38187565" class="c"><input type="checkbox" id="c-38187565" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#38186498">parent</a><span>|</span><a href="#38187173">next</a><span>|</span><label class="collapse" for="c-38187565">[-]</label><label class="expand" for="c-38187565">[2 more]</label></div><br/><div class="children"><div class="content">Do you mean &#x27;moniker&#x27;?</div><br/></div></div><div id="38187173" class="c"><input type="checkbox" id="c-38187173" checked=""/><div class="controls bullet"><span class="by">PaulDavisThe1st</span><span>|</span><a href="#38186498">parent</a><span>|</span><a href="#38187565">prev</a><span>|</span><a href="#38187436">next</a><span>|</span><label class="collapse" for="c-38187173">[-]</label><label class="expand" for="c-38187173">[1 more]</label></div><br/><div class="children"><div class="content">Audio, too.</div><br/></div></div></div></div><div id="38187436" class="c"><input type="checkbox" id="c-38187436" checked=""/><div class="controls bullet"><span class="by">singularity2001</span><span>|</span><a href="#38186498">prev</a><span>|</span><a href="#38185289">next</a><span>|</span><label class="collapse" for="c-38187436">[-]</label><label class="expand" for="c-38187436">[2 more]</label></div><br/><div class="children"><div class="content">could exception handling be implemented with this? if so would that make the exception handling proposal superfluous?</div><br/><div id="38187988" class="c"><input type="checkbox" id="c-38187988" checked=""/><div class="controls bullet"><span class="by">4ad</span><span>|</span><a href="#38187436">parent</a><span>|</span><a href="#38185289">next</a><span>|</span><label class="collapse" for="c-38187988">[-]</label><label class="expand" for="c-38187988">[1 more]</label></div><br/><div class="children"><div class="content">&gt; could exception handling be implemented with this?<p>Yes.<p>&gt; if so would that make the exception handling proposal superfluous?<p>The exception handling proposal is a subset of this proposal. This proposal doesn&#x27;t replace it, it completes it.</div><br/></div></div></div></div><div id="38185289" class="c"><input type="checkbox" id="c-38185289" checked=""/><div class="controls bullet"><span class="by">meindnoch</span><span>|</span><a href="#38187436">prev</a><span>|</span><a href="#38185194">next</a><span>|</span><label class="collapse" for="c-38185289">[-]</label><label class="expand" for="c-38185289">[8 more]</label></div><br/><div class="children"><div class="content">WebAssembly is getting more complex bit by bit...</div><br/><div id="38185308" class="c"><input type="checkbox" id="c-38185308" checked=""/><div class="controls bullet"><span class="by">jeffparsons</span><span>|</span><a href="#38185289">parent</a><span>|</span><a href="#38185764">next</a><span>|</span><label class="collapse" for="c-38185308">[-]</label><label class="expand" for="c-38185308">[5 more]</label></div><br/><div class="children"><div class="content">That&#x27;s okay; _using_ WebAssembly is getting easier bit by bit. Features like this one allow the high level programming language features you know and love to be implemented efficiently behind the scenes.</div><br/><div id="38186121" class="c"><input type="checkbox" id="c-38186121" checked=""/><div class="controls bullet"><span class="by">charcircuit</span><span>|</span><a href="#38185289">root</a><span>|</span><a href="#38185308">parent</a><span>|</span><a href="#38185764">next</a><span>|</span><label class="collapse" for="c-38186121">[-]</label><label class="expand" for="c-38186121">[4 more]</label></div><br/><div class="children"><div class="content">But they make making WASM implementations harder to make.</div><br/><div id="38187802" class="c"><input type="checkbox" id="c-38187802" checked=""/><div class="controls bullet"><span class="by">kaliqt</span><span>|</span><a href="#38185289">root</a><span>|</span><a href="#38186121">parent</a><span>|</span><a href="#38187994">next</a><span>|</span><label class="collapse" for="c-38187802">[-]</label><label class="expand" for="c-38187802">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s how the core has to be, like Vulkan, making the core harder allows for more control, a better foundation. Then we load up those core libraries with easy APIs that are super powerful and can do what was never thought possible.<p>Same for WebGPU.<p>So I think WASM is doing this exactly the right way as long as it stays powerful and flexible at the core.</div><br/></div></div><div id="38187994" class="c"><input type="checkbox" id="c-38187994" checked=""/><div class="controls bullet"><span class="by">4ad</span><span>|</span><a href="#38185289">root</a><span>|</span><a href="#38186121">parent</a><span>|</span><a href="#38187802">prev</a><span>|</span><a href="#38187195">next</a><span>|</span><label class="collapse" for="c-38187994">[-]</label><label class="expand" for="c-38187994">[1 more]</label></div><br/><div class="children"><div class="content">If you are talking about things like the garbage collection, yes, but this proposal is trivial to implement.</div><br/></div></div><div id="38187195" class="c"><input type="checkbox" id="c-38187195" checked=""/><div class="controls bullet"><span class="by">phickey</span><span>|</span><a href="#38185289">root</a><span>|</span><a href="#38186121">parent</a><span>|</span><a href="#38187994">prev</a><span>|</span><a href="#38185764">next</a><span>|</span><label class="collapse" for="c-38187195">[-]</label><label class="expand" for="c-38187195">[1 more]</label></div><br/><div class="children"><div class="content">Useful things are hard to make.</div><br/></div></div></div></div></div></div><div id="38185764" class="c"><input type="checkbox" id="c-38185764" checked=""/><div class="controls bullet"><span class="by">titzer</span><span>|</span><a href="#38185289">parent</a><span>|</span><a href="#38185308">prev</a><span>|</span><a href="#38185538">next</a><span>|</span><label class="collapse" for="c-38185764">[-]</label><label class="expand" for="c-38185764">[1 more]</label></div><br/><div class="children"><div class="content">Along with exception handling, I think a stack switching feature like WasmFX will complete WebAssembly&#x27;s set of control abstractions, so at least that part won&#x27;t keep growing without bound.</div><br/></div></div><div id="38185538" class="c"><input type="checkbox" id="c-38185538" checked=""/><div class="controls bullet"><span class="by">pests</span><span>|</span><a href="#38185289">parent</a><span>|</span><a href="#38185764">prev</a><span>|</span><a href="#38185194">next</a><span>|</span><label class="collapse" for="c-38185538">[-]</label><label class="expand" for="c-38185538">[1 more]</label></div><br/><div class="children"><div class="content">This is just a proposed extension.</div><br/></div></div></div></div></div></div></div></div></div></body></html>