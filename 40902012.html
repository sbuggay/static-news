<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720429276708" as="style"/><link rel="stylesheet" href="styles.css?v=1720429276708"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://dgerrells.com/blog/how-fast-is-javascript-simulating-20-000-000-particles">Show HN: Simulating 20M Particles in JavaScript</a>Â <span class="domain">(<a href="https://dgerrells.com">dgerrells.com</a>)</span></div><div class="subtext"><span>rustystump</span> | <span>27 comments</span></div><br/><div><div id="40902161" class="c"><input type="checkbox" id="c-40902161" checked=""/><div class="controls bullet"><span class="by">andai</span><span>|</span><a href="#40902453">next</a><span>|</span><label class="collapse" for="c-40902161">[-]</label><label class="expand" for="c-40902161">[7 more]</label></div><br/><div class="children"><div class="content">Nice! I&#x27;d suggest embedding the simulation in the blog. I had to scroll up and down for a while before finding a link to the actual simulation.<p>(You might want to pick a value that runs reasonably well on old phones, or have it adjust based on frame rate. Alternatively just put a some links at the top of the article.)<p>See <a href="https:&#x2F;&#x2F;ciechanow.ski&#x2F;" rel="nofollow">https:&#x2F;&#x2F;ciechanow.ski&#x2F;</a> (very popular on this website) for a world-class example of just how cool it is to embed simulations right in the article.<p>(Obligatory: <i>back in my day, every</i> website used to embed cool interactive stuff!)<p>--<p>Also, I think you can run a particle sim on GPU without WebGPU.<p>e.g. <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=19963640">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=19963640</a></div><br/><div id="40902513" class="c"><input type="checkbox" id="c-40902513" checked=""/><div class="controls bullet"><span class="by">w_for_wumbo</span><span>|</span><a href="#40902161">parent</a><span>|</span><a href="#40902295">next</a><span>|</span><label class="collapse" for="c-40902513">[-]</label><label class="expand" for="c-40902513">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s one of the best examples of an explanatory blog that I&#x27;ve ever seen.
I wish that this would become the standard of which information was shared - if it&#x27;s worth sharing, it&#x27;s worth making it easy to understand.</div><br/><div id="40902753" class="c"><input type="checkbox" id="c-40902753" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#40902161">root</a><span>|</span><a href="#40902513">parent</a><span>|</span><a href="#40902295">next</a><span>|</span><label class="collapse" for="c-40902753">[-]</label><label class="expand" for="c-40902753">[2 more]</label></div><br/><div class="children"><div class="content">I have done a few blog posts with interactive doodads like this.  It takes a lot (like really a _lot_) more time to do, but I think it&#x27;s the right way to go.  There is so much noise on the internet caused by people casting their 2 cents into the void.<p>Interactive thingywotsits may slow down individuals making posts, but there are a lot of individuals out there.</div><br/><div id="40903733" class="c"><input type="checkbox" id="c-40903733" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#40902161">root</a><span>|</span><a href="#40902753">parent</a><span>|</span><a href="#40902295">next</a><span>|</span><label class="collapse" for="c-40903733">[-]</label><label class="expand" for="c-40903733">[1 more]</label></div><br/><div class="children"><div class="content">Not being a frontend dev, I have no idea how to even start making something like that.<p>Are there some frameworks that make interactive simulations like that easier to make, or do you just do it the hard way?</div><br/></div></div></div></div></div></div><div id="40902295" class="c"><input type="checkbox" id="c-40902295" checked=""/><div class="controls bullet"><span class="by">rustystump</span><span>|</span><a href="#40902161">parent</a><span>|</span><a href="#40902513">prev</a><span>|</span><a href="#40902999">next</a><span>|</span><label class="collapse" for="c-40902295">[-]</label><label class="expand" for="c-40902295">[2 more]</label></div><br/><div class="children"><div class="content">I do agree about embedding. I thought about embedding each version but was worried about having too many workers all going at once. I&#x27;ll update the article to include the final version embedded at the end. Thanks for the feedback.<p>That blog is amazing. Each example is so polished. I love it.<p>edit: I tried adding an embedded version but the required headers didn&#x27;t play well with other embeds. The older versions are all still stuck in codesandboxes.</div><br/><div id="40902681" class="c"><input type="checkbox" id="c-40902681" checked=""/><div class="controls bullet"><span class="by">tlarkworthy</span><span>|</span><a href="#40902161">root</a><span>|</span><a href="#40902295">parent</a><span>|</span><a href="#40902999">next</a><span>|</span><label class="collapse" for="c-40902681">[-]</label><label class="expand" for="c-40902681">[1 more]</label></div><br/><div class="children"><div class="content">An intersection observer can be used to turn the non visible parts off when out of view.
<a href="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;API&#x2F;Intersection_Observer_API" rel="nofollow">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;API&#x2F;Intersectio...</a></div><br/></div></div></div></div><div id="40902999" class="c"><input type="checkbox" id="c-40902999" checked=""/><div class="controls bullet"><span class="by">bahmboo</span><span>|</span><a href="#40902161">parent</a><span>|</span><a href="#40902295">prev</a><span>|</span><a href="#40902453">next</a><span>|</span><label class="collapse" for="c-40902999">[-]</label><label class="expand" for="c-40902999">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Skip to the end to play around with the final app.&quot;</div><br/></div></div></div></div><div id="40902453" class="c"><input type="checkbox" id="c-40902453" checked=""/><div class="controls bullet"><span class="by">franciscop</span><span>|</span><a href="#40902161">prev</a><span>|</span><a href="#40902272">next</a><span>|</span><label class="collapse" for="c-40902453">[-]</label><label class="expand" for="c-40902453">[2 more]</label></div><br/><div class="children"><div class="content">Random question (genuine, I do not know if it&#x27;s possible):<p>&gt; I decided to have each particle be represented by 4 numbers an x, y, dx, and dy. These will each be 32-bit floating point numbers.<p>Would it be possible to encode this data into a single JS number (53-bit number, given that MAX_SAFE_INTEGER is 2^53 - 1 = 9,007,199,254,740,991). Or -3.4e38 to 3.4e38, which is the range of the Float32Array used in the blog.<p>For example, I understand for the screen position you might have a 1000x1000 canvas, which can be represented with 0-1,000,000 numbers. Even if we add 10 sub-pixel divisions, that&#x27;s still 100,000,000, which still fits very comfortably within JS.<p>Similar for speed (dx, dy), I see you are doing &quot;(Math.random()*2-1)*10&quot; for calculating the speed, which should go from -10,+10 with arbitrary decimal accuracy, but I wonder if limiting it to 1 decimal would be enough for the simulation, which would be [-10.0, +10.0] and can also be converted to the -100,+100 range in integers. Which needs 10,000 numbers to represent all of the possible values.<p>If you put both of those together, that gives 10,000 * 100,000,000 = 1,000,000,000,000 (1T) numbers needed to represent the particles, which still fits within JS&#x27; MAX_SAFE_INTEGER. So it seems you might be able to fit all of the data for a single particle within a single MAX_SAFE_INTEGER or a single Float32Array element? Then you don&#x27;t need the stride and can be a lot more sure about data consistency.<p>It might be that the encoding&#x2F;decoding of the data into a single number is slower than the savings in memory and so it&#x27;s totally not worth it though, which I don&#x27;t know.</div><br/><div id="40902507" class="c"><input type="checkbox" id="c-40902507" checked=""/><div class="controls bullet"><span class="by">DrMiaow</span><span>|</span><a href="#40902453">parent</a><span>|</span><a href="#40902272">next</a><span>|</span><label class="collapse" for="c-40902507">[-]</label><label class="expand" for="c-40902507">[1 more]</label></div><br/><div class="children"><div class="content">As you stated, Encoding&#x2F;decoding would kill your performance.<p>Float16Array would immediately halve your memory requirements<p>Another possibility would be to have separate precision arrays.<p>eg. Float16Array for x,y and even Int8Array for dx&#x2F;dy, but, in both cases you will would get some motion artifacts, especially for Int8 from the clamping and aliasing of dx&#x2F;dy.</div><br/></div></div></div></div><div id="40902272" class="c"><input type="checkbox" id="c-40902272" checked=""/><div class="controls bullet"><span class="by">jekude</span><span>|</span><a href="#40902453">prev</a><span>|</span><a href="#40902701">next</a><span>|</span><label class="collapse" for="c-40902272">[-]</label><label class="expand" for="c-40902272">[2 more]</label></div><br/><div class="children"><div class="content">Demo on mobile [0], pretty incredible to play with.<p>[0] <a href="https:&#x2F;&#x2F;dgerrells.com&#x2F;sabby" rel="nofollow">https:&#x2F;&#x2F;dgerrells.com&#x2F;sabby</a></div><br/><div id="40902297" class="c"><input type="checkbox" id="c-40902297" checked=""/><div class="controls bullet"><span class="by">jerbear4328</span><span>|</span><a href="#40902272">parent</a><span>|</span><a href="#40902701">next</a><span>|</span><label class="collapse" for="c-40902297">[-]</label><label class="expand" for="c-40902297">[1 more]</label></div><br/><div class="children"><div class="content">Woah, it works with multiple fingers! This is wild for pure JS. Interestingly, more fingers means more lag, I guess more stuff being sent between threads.</div><br/></div></div></div></div><div id="40902701" class="c"><input type="checkbox" id="c-40902701" checked=""/><div class="controls bullet"><span class="by">morphle</span><span>|</span><a href="#40902272">prev</a><span>|</span><a href="#40902889">next</a><span>|</span><label class="collapse" for="c-40902701">[-]</label><label class="expand" for="c-40902701">[1 more]</label></div><br/><div class="children"><div class="content">Almost 20 million particles:<p>run and program the simulations <a href="https:&#x2F;&#x2F;tinlizzie.org&#x2F;~ohshima&#x2F;shadama2&#x2F;" rel="nofollow">https:&#x2F;&#x2F;tinlizzie.org&#x2F;~ohshima&#x2F;shadama2&#x2F;</a><p><a href="https:&#x2F;&#x2F;tinlizzie.org&#x2F;~ohshima&#x2F;shadama2&#x2F;live2017&#x2F;" rel="nofollow">https:&#x2F;&#x2F;tinlizzie.org&#x2F;~ohshima&#x2F;shadama2&#x2F;live2017&#x2F;</a><p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=tqBO_5GMfWw" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=tqBO_5GMfWw</a></div><br/></div></div><div id="40902889" class="c"><input type="checkbox" id="c-40902889" checked=""/><div class="controls bullet"><span class="by">tired_and_awake</span><span>|</span><a href="#40902701">prev</a><span>|</span><a href="#40902243">next</a><span>|</span><label class="collapse" for="c-40902889">[-]</label><label class="expand" for="c-40902889">[1 more]</label></div><br/><div class="children"><div class="content">Seriously impressive engineering OP, thanks for the awesome writeup too. Looks like you&#x27;ve got a ton of fans now, well earned!</div><br/></div></div><div id="40902243" class="c"><input type="checkbox" id="c-40902243" checked=""/><div class="controls bullet"><span class="by">dado3212</span><span>|</span><a href="#40902889">prev</a><span>|</span><a href="#40902581">next</a><span>|</span><label class="collapse" for="c-40902243">[-]</label><label class="expand" for="c-40902243">[3 more]</label></div><br/><div class="children"><div class="content">The videos look awesome but the &quot;try it out here&quot; codesandbox links don&#x27;t work for me on MacOS Chrome desktop. I get &#x27;Uncaught ReferenceError: SharedArrayBuffer is not defined&#x27; and some CORS errors: &#x27;ERR_BLOCKED_BY_RESPONSE.NotSameOriginAfterDefaultedToSameOriginByCoep&#x27;.</div><br/><div id="40902286" class="c"><input type="checkbox" id="c-40902286" checked=""/><div class="controls bullet"><span class="by">rustystump</span><span>|</span><a href="#40902243">parent</a><span>|</span><a href="#40902581">next</a><span>|</span><label class="collapse" for="c-40902286">[-]</label><label class="expand" for="c-40902286">[2 more]</label></div><br/><div class="children"><div class="content">You have to open the previews in a dedicated tab as codesandbox&#x27;s inline editor blocks the header from being set. It also may get blocked if you are using a privacy focused browser.<p>I&#x27;ll try to include embedded examples in the future.<p>You can try out the final version here <a href="https:&#x2F;&#x2F;dgerrells.com&#x2F;sabby" rel="nofollow">https:&#x2F;&#x2F;dgerrells.com&#x2F;sabby</a></div><br/><div id="40902665" class="c"><input type="checkbox" id="c-40902665" checked=""/><div class="controls bullet"><span class="by">shash7</span><span>|</span><a href="#40902243">root</a><span>|</span><a href="#40902286">parent</a><span>|</span><a href="#40902581">next</a><span>|</span><label class="collapse" for="c-40902665">[-]</label><label class="expand" for="c-40902665">[1 more]</label></div><br/><div class="children"><div class="content">Whoa this is like fine sand. Amazing!</div><br/></div></div></div></div></div></div><div id="40902581" class="c"><input type="checkbox" id="c-40902581" checked=""/><div class="controls bullet"><span class="by">int0x29</span><span>|</span><a href="#40902243">prev</a><span>|</span><a href="#40902420">next</a><span>|</span><label class="collapse" for="c-40902581">[-]</label><label class="expand" for="c-40902581">[3 more]</label></div><br/><div class="children"><div class="content">Might want a strobe warning.  At least for Firefox and Chromium in Linux on a desktop it strobes heavily in the starting state.</div><br/><div id="40902657" class="c"><input type="checkbox" id="c-40902657" checked=""/><div class="controls bullet"><span class="by">rustystump</span><span>|</span><a href="#40902581">parent</a><span>|</span><a href="#40902420">next</a><span>|</span><label class="collapse" for="c-40902657">[-]</label><label class="expand" for="c-40902657">[2 more]</label></div><br/><div class="children"><div class="content">It depends on the display type. When run on something with low per pixel lighting it can flicker a bit due to how quickly the average light changes frame to frame. Anything with local dim zones may struggle. I looked at ways to fix this but could not come up anything other than running a blur filter which ends up looking terrible.</div><br/><div id="40903699" class="c"><input type="checkbox" id="c-40903699" checked=""/><div class="controls bullet"><span class="by">lukan</span><span>|</span><a href="#40902581">root</a><span>|</span><a href="#40902657">parent</a><span>|</span><a href="#40902420">next</a><span>|</span><label class="collapse" for="c-40903699">[-]</label><label class="expand" for="c-40903699">[1 more]</label></div><br/><div class="children"><div class="content">&quot;When run on something with low per pixel lighting it can flicker a bit due to how quickly the average light changes frame to frame&quot;<p>Not sure I understand. The flicker is not due to sometimes the screen drawn with white(like I assumed) and just because of my mobiles light settings?<p>Other simulations similar to this, don&#x27;t have this flicker on my devive.<p>(still impressive work, genuine question to avoid this effect in my experiements)<p>And no matter the technical reasons, for some people this might be a serious health issue, so a warming might make sense in the current state.</div><br/></div></div></div></div></div></div><div id="40902420" class="c"><input type="checkbox" id="c-40902420" checked=""/><div class="controls bullet"><span class="by">pdsouza</span><span>|</span><a href="#40902581">prev</a><span>|</span><a href="#40902712">next</a><span>|</span><label class="collapse" for="c-40902420">[-]</label><label class="expand" for="c-40902420">[1 more]</label></div><br/><div class="children"><div class="content">Love this. Enjoyed riding your train of thought from challenge conception through each performance pass to the final form. Surprisingly fun to play around with this sim too. Looking forward to more posts!</div><br/></div></div><div id="40902712" class="c"><input type="checkbox" id="c-40902712" checked=""/><div class="controls bullet"><span class="by">thomasfromcdnjs</span><span>|</span><a href="#40902420">prev</a><span>|</span><a href="#40902319">next</a><span>|</span><label class="collapse" for="c-40902712">[-]</label><label class="expand" for="c-40902712">[2 more]</label></div><br/><div class="children"><div class="content">Inspiring tutorial!<p>Does anyone know why&#x2F;how it maintains state if you tab out? Does Chrome eventually try to clean up the cache or is it locked in?</div><br/><div id="40903707" class="c"><input type="checkbox" id="c-40903707" checked=""/><div class="controls bullet"><span class="by">lukan</span><span>|</span><a href="#40902712">parent</a><span>|</span><a href="#40902319">next</a><span>|</span><label class="collapse" for="c-40903707">[-]</label><label class="expand" for="c-40903707">[1 more]</label></div><br/><div class="children"><div class="content">Usually inactive tabs are just paused and their state saved.</div><br/></div></div></div></div><div id="40902319" class="c"><input type="checkbox" id="c-40902319" checked=""/><div class="controls bullet"><span class="by">a-dub</span><span>|</span><a href="#40902712">prev</a><span>|</span><a href="#40902946">next</a><span>|</span><label class="collapse" for="c-40902319">[-]</label><label class="expand" for="c-40902319">[3 more]</label></div><br/><div class="children"><div class="content">so when do we get WebBLAS and WebFORTRAN?<p>kinda joking, kinda not.</div><br/><div id="40902791" class="c"><input type="checkbox" id="c-40902791" checked=""/><div class="controls bullet"><span class="by">shakna</span><span>|</span><a href="#40902319">parent</a><span>|</span><a href="#40902946">next</a><span>|</span><label class="collapse" for="c-40902791">[-]</label><label class="expand" for="c-40902791">[2 more]</label></div><br/><div class="children"><div class="content">Actively in-progress, actually. [0] Since about 2016.<p>[0] <a href="https:&#x2F;&#x2F;gws.phd&#x2F;posts&#x2F;fortran_wasm&#x2F;" rel="nofollow">https:&#x2F;&#x2F;gws.phd&#x2F;posts&#x2F;fortran_wasm&#x2F;</a></div><br/><div id="40902871" class="c"><input type="checkbox" id="c-40902871" checked=""/><div class="controls bullet"><span class="by">a-dub</span><span>|</span><a href="#40902319">root</a><span>|</span><a href="#40902791">parent</a><span>|</span><a href="#40902946">next</a><span>|</span><label class="collapse" for="c-40902871">[-]</label><label class="expand" for="c-40902871">[1 more]</label></div><br/><div class="children"><div class="content">there&#x27;s also numpy and scipy in the webassembly python distro (pyodide). but the &quot;kinda not&quot; part more refers to first class scientific&#x2F;numerical computing support. it&#x27;s possible, but the libraries are all disjoint or are webassembly ports, etc.</div><br/></div></div></div></div></div></div><div id="40902946" class="c"><input type="checkbox" id="c-40902946" checked=""/><div class="controls bullet"><span class="by">lbj</span><span>|</span><a href="#40902319">prev</a><span>|</span><label class="collapse" for="c-40902946">[-]</label><label class="expand" for="c-40902946">[1 more]</label></div><br/><div class="children"><div class="content">Anyone else having trouble with that web vscode he&#x27;s using?</div><br/></div></div></div></div></div></div></div></body></html>