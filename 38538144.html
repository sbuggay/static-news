<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701939658803" as="style"/><link rel="stylesheet" href="styles.css?v=1701939658803"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://docs.syncthing.net/specs/untrusted.html">Untrusted Device Encryption</a> <span class="domain">(<a href="https://docs.syncthing.net">docs.syncthing.net</a>)</span></div><div class="subtext"><span>tosh</span> | <span>26 comments</span></div><br/><div><div id="38554258" class="c"><input type="checkbox" id="c-38554258" checked=""/><div class="controls bullet"><span class="by">comex</span><span>|</span><a href="#38553236">next</a><span>|</span><label class="collapse" for="c-38554258">[-]</label><label class="expand" for="c-38554258">[1 more]</label></div><br/><div class="children"><div class="content">&gt; In addition the untrusted device must not be able to modify, remove or introduce data by itself without detection.<p>It sounds like that property is satisfied on a file-by-file level.  But what about between files?  Can the untrusted device delete some files without it being detected?  Or un-delete deleted files?  Or selectively revert files to older versions?  The documentation describes how each file gets a signed blob containing the file’s metadata and hashes of its contents, but there’s no mention of any signed structure containing the state of the directory tree as a whole.  So judging (only) by the documentation, it sounds like the answer to all of those questions is yes.<p>YMMV on how big of an issue that is.  It helps that the attacker theoretically shouldn’t know which file is which.  But imagine, say, a Git checkout of an open-source codebase being stored in a Syncthing folder.  The attacker can guess which file is which based on file sizes and modification patterns.  At that point, selectively reverting files might be able to mess up the code being stored, or associated configuration, in a way that creates some sort of vulnerability.<p>Apologies if I’m misunderstanding the security guarantees; again, I’m only going off of what the linked page says.</div><br/></div></div><div id="38553236" class="c"><input type="checkbox" id="c-38553236" checked=""/><div class="controls bullet"><span class="by">Sprite_tm</span><span>|</span><a href="#38554258">prev</a><span>|</span><a href="#38554047">next</a><span>|</span><label class="collapse" for="c-38553236">[-]</label><label class="expand" for="c-38553236">[4 more]</label></div><br/><div class="children"><div class="content">Am I the only one a bit worried about them using a fixed string as a salt? A salt is intended to make it hard to create a rainbow table. I don&#x27;t know how much entropy is in their &#x27;folderID&#x27; variable, but given that it&#x27;s a &#x27;short string&#x27;, it seems low-entropy and not random. If so, the current implementation makes it trivial to make a rainbow table. That means that if you can get the passwordtoken and know a folderID, you can create a rainbow table that maps all possible passwordtokens to valid passwords.<p>BTW: &#x27;worried&#x27; as in &#x27;code smell&#x27;, not &#x27;worried&#x27; as in &#x27;the encryption can be easily broken&#x27;.</div><br/><div id="38553607" class="c"><input type="checkbox" id="c-38553607" checked=""/><div class="controls bullet"><span class="by">h4kor</span><span>|</span><a href="#38553236">parent</a><span>|</span><a href="#38553457">next</a><span>|</span><label class="collapse" for="c-38553607">[-]</label><label class="expand" for="c-38553607">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The string “syncthing” with the folder ID concatenated make up the salt<p>Meaning its not fixed but every folder has its own salt</div><br/></div></div><div id="38553457" class="c"><input type="checkbox" id="c-38553457" checked=""/><div class="controls bullet"><span class="by">dpc_01234</span><span>|</span><a href="#38553236">parent</a><span>|</span><a href="#38553607">prev</a><span>|</span><a href="#38554149">next</a><span>|</span><label class="collapse" for="c-38553457">[-]</label><label class="expand" for="c-38553457">[1 more]</label></div><br/><div class="children"><div class="content">I think you&#x27;re right. Reported on Syncthing forum. <a href="https:&#x2F;&#x2F;forum.syncthing.net&#x2F;t&#x2F;entropy-of-untrusted-device-scrypt-salt&#x2F;21221" rel="nofollow noreferrer">https:&#x2F;&#x2F;forum.syncthing.net&#x2F;t&#x2F;entropy-of-untrusted-device-sc...</a></div><br/></div></div><div id="38554149" class="c"><input type="checkbox" id="c-38554149" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#38553236">parent</a><span>|</span><a href="#38553457">prev</a><span>|</span><a href="#38554047">next</a><span>|</span><label class="collapse" for="c-38554149">[-]</label><label class="expand" for="c-38554149">[1 more]</label></div><br/><div class="children"><div class="content">the folder ID is a (from memory) 6 character random alnum string.<p>this is more than adequate for a salt.</div><br/></div></div></div></div><div id="38554047" class="c"><input type="checkbox" id="c-38554047" checked=""/><div class="controls bullet"><span class="by">tarruda</span><span>|</span><a href="#38553236">prev</a><span>|</span><a href="#38553388">next</a><span>|</span><label class="collapse" for="c-38554047">[-]</label><label class="expand" for="c-38554047">[2 more]</label></div><br/><div class="children"><div class="content">My biggest problem with how this feature is implemented is that the encryption passphrase is stored in plain text in the syncthing config file.<p>I wish there was a way to lock the passphrase in the session keyring, with syncthing only sending files to untrusted devices if the keyring is unlocked.</div><br/><div id="38554279" class="c"><input type="checkbox" id="c-38554279" checked=""/><div class="controls bullet"><span class="by">sdeframond</span><span>|</span><a href="#38554047">parent</a><span>|</span><a href="#38553388">next</a><span>|</span><label class="collapse" for="c-38554279">[-]</label><label class="expand" for="c-38554279">[1 more]</label></div><br/><div class="children"><div class="content">Is it a problem if the disk is encrypted ?</div><br/></div></div></div></div><div id="38553388" class="c"><input type="checkbox" id="c-38553388" checked=""/><div class="controls bullet"><span class="by">zshrc</span><span>|</span><a href="#38554047">prev</a><span>|</span><a href="#38553907">next</a><span>|</span><label class="collapse" for="c-38553388">[-]</label><label class="expand" for="c-38553388">[11 more]</label></div><br/><div class="children"><div class="content">Would work great on a VPS endpoint to guarantee “always-on” syncing (plus a VPN tunnel). I won’t touch it until it stabilizes though.</div><br/><div id="38553616" class="c"><input type="checkbox" id="c-38553616" checked=""/><div class="controls bullet"><span class="by">tarruda</span><span>|</span><a href="#38553388">parent</a><span>|</span><a href="#38553443">next</a><span>|</span><label class="collapse" for="c-38553616">[-]</label><label class="expand" for="c-38553616">[9 more]</label></div><br/><div class="children"><div class="content">A cheap and nice self hosted alternative way to have an &quot;always on&quot; sync endpoint is with a raspberry pi 4 with SSD (don&#x27;t try this with an SD card).<p>My current setup is running a wireguard server, syncthing and DuckDNS on the pi. I also port forward the wireguard port from my ISP&#x27;s router.<p>With this, my devices are always connected to the VPN, and sync always works (and is fast!) like everything is on a LAN.</div><br/><div id="38554158" class="c"><input type="checkbox" id="c-38554158" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553616">parent</a><span>|</span><a href="#38553800">next</a><span>|</span><label class="collapse" for="c-38554158">[-]</label><label class="expand" for="c-38554158">[1 more]</label></div><br/><div class="children"><div class="content">There’s nothing wrong with using an SD card. I use Syncthing on rpi with a 1TB SD card and it works great.</div><br/></div></div><div id="38553800" class="c"><input type="checkbox" id="c-38553800" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553616">parent</a><span>|</span><a href="#38554158">prev</a><span>|</span><a href="#38553443">next</a><span>|</span><label class="collapse" for="c-38553800">[-]</label><label class="expand" for="c-38553800">[7 more]</label></div><br/><div class="children"><div class="content">I think you are missing the point. If you fully control the hardware, then you probably don&#x27;t need Untrusted Device Encryption.</div><br/><div id="38553997" class="c"><input type="checkbox" id="c-38553997" checked=""/><div class="controls bullet"><span class="by">tarruda</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553800">parent</a><span>|</span><a href="#38553908">next</a><span>|</span><label class="collapse" for="c-38553997">[-]</label><label class="expand" for="c-38553997">[1 more]</label></div><br/><div class="children"><div class="content">I understood that point. The raspberry pi would still serve as an always on endpoint regardless of the untrusted device encryption feature.<p>In my case I don&#x27;t use this feature on the pi, but I do use it on my phone which has 256gb storage. I have configured syncthing to only run when charging the phone, so it is not always on.</div><br/></div></div><div id="38553908" class="c"><input type="checkbox" id="c-38553908" checked=""/><div class="controls bullet"><span class="by">jsiepkes</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553800">parent</a><span>|</span><a href="#38553997">prev</a><span>|</span><a href="#38554079">next</a><span>|</span><label class="collapse" for="c-38553908">[-]</label><label class="expand" for="c-38553908">[4 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not entirely true. For example your Raspberry PI can get stolen.<p>I would definitely encrypt the stuff on my NAS if it was sitting in my garage.</div><br/><div id="38554114" class="c"><input type="checkbox" id="c-38554114" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553908">parent</a><span>|</span><a href="#38554049">next</a><span>|</span><label class="collapse" for="c-38554114">[-]</label><label class="expand" for="c-38554114">[2 more]</label></div><br/><div class="children"><div class="content">Sure, but the tried and true way to encrypt your NAS would probably be using full-disk-encryption, not something specific only to syncthing.</div><br/><div id="38554215" class="c"><input type="checkbox" id="c-38554215" checked=""/><div class="controls bullet"><span class="by">ephbit</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38554114">parent</a><span>|</span><a href="#38554049">next</a><span>|</span><label class="collapse" for="c-38554215">[-]</label><label class="expand" for="c-38554215">[1 more]</label></div><br/><div class="children"><div class="content">If someone manages to access the running raspberry pi though, FDE doesn&#x27;t protect against that, while the Syncthing&#x27;s untrusted device encryption does.</div><br/></div></div></div></div><div id="38554049" class="c"><input type="checkbox" id="c-38554049" checked=""/><div class="controls bullet"><span class="by">xzjis</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553908">parent</a><span>|</span><a href="#38554114">prev</a><span>|</span><a href="#38554079">next</a><span>|</span><label class="collapse" for="c-38554049">[-]</label><label class="expand" for="c-38554049">[1 more]</label></div><br/><div class="children"><div class="content">You could also have a Raspberry to backup in another place, such as a friend&#x27;s house.</div><br/></div></div></div></div><div id="38554079" class="c"><input type="checkbox" id="c-38554079" checked=""/><div class="controls bullet"><span class="by">Hamuko</span><span>|</span><a href="#38553388">root</a><span>|</span><a href="#38553800">parent</a><span>|</span><a href="#38553908">prev</a><span>|</span><a href="#38553443">next</a><span>|</span><label class="collapse" for="c-38554079">[-]</label><label class="expand" for="c-38554079">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s also a poor solution for an &quot;always on&quot; solution since it&#x27;s dependent on your home Internet&#x2F;VPN&#x2F;power working, which is probably true for your other clients too.<p>If I&#x27;m running Syncthing on a desktop computer at home and a laptop with me on the go, adding a Raspberry Pi to the same home network doesn&#x27;t really improve resiliency of the sync service. But if I have a server in a completely different location, it actually will.</div><br/></div></div></div></div></div></div></div></div><div id="38553907" class="c"><input type="checkbox" id="c-38553907" checked=""/><div class="controls bullet"><span class="by">aborsy</span><span>|</span><a href="#38553388">prev</a><span>|</span><a href="#38553358">next</a><span>|</span><label class="collapse" for="c-38553907">[-]</label><label class="expand" for="c-38553907">[1 more]</label></div><br/><div class="children"><div class="content">How does it play with versioning? Like, if I edit a file gradually, there are going to be ever growing number of frequent versions. There is no deduplication in the encrypted node (I’m not sure if there is deduplication between versions in plaintext either). The storage could rapidly increase.</div><br/></div></div><div id="38553358" class="c"><input type="checkbox" id="c-38553358" checked=""/><div class="controls bullet"><span class="by">hardwaresofton</span><span>|</span><a href="#38553907">prev</a><span>|</span><a href="#38553742">next</a><span>|</span><label class="collapse" for="c-38553358">[-]</label><label class="expand" for="c-38553358">[3 more]</label></div><br/><div class="children"><div class="content">This feature is really awesome, can&#x27;t wait for it to stabilize because it makes it possible to offer a sort of syncthing-based backups&#x27; backup by making available untrusted storage servers.<p>Who knows if I&#x27;ll ever build it but if someone else wants to I&#x27;d love to see that happen</div><br/><div id="38553543" class="c"><input type="checkbox" id="c-38553543" checked=""/><div class="controls bullet"><span class="by">LeoPanthera</span><span>|</span><a href="#38553358">parent</a><span>|</span><a href="#38553525">next</a><span>|</span><label class="collapse" for="c-38553543">[-]</label><label class="expand" for="c-38553543">[1 more]</label></div><br/><div class="children"><div class="content">For backups, I don&#x27;t see what this offers that borg doesn&#x27;t. And borg also offers multiple snapshots, which this doesn&#x27;t.<p>The only advantage I can think of I suppose is that this is &quot;real time&quot;. But it&#x27;s a pretty small perk.</div><br/></div></div><div id="38553525" class="c"><input type="checkbox" id="c-38553525" checked=""/><div class="controls bullet"><span class="by">sourcegrift</span><span>|</span><a href="#38553358">parent</a><span>|</span><a href="#38553543">prev</a><span>|</span><a href="#38553742">next</a><span>|</span><label class="collapse" for="c-38553525">[-]</label><label class="expand" for="c-38553525">[1 more]</label></div><br/><div class="children"><div class="content">i&#x27;ve been using it forever ... I think it&#x27;s just the untrusted device thing that needs a password, just go to settings -&gt; sharing ..</div><br/></div></div></div></div><div id="38553742" class="c"><input type="checkbox" id="c-38553742" checked=""/><div class="controls bullet"><span class="by">janzer</span><span>|</span><a href="#38553358">prev</a><span>|</span><a href="#38553486">next</a><span>|</span><label class="collapse" for="c-38553742">[-]</label><label class="expand" for="c-38553742">[1 more]</label></div><br/><div class="children"><div class="content">It seems that this has been in syncthing about 2.5 years[1], is there something that changed recently to make this notable now?<p>[1] Initial release behind a feature flag in 1.15 on April 6, 2021 and without the feature flag in 1.16 on May 4, 2021.</div><br/></div></div><div id="38553486" class="c"><input type="checkbox" id="c-38553486" checked=""/><div class="controls bullet"><span class="by">brunoqc</span><span>|</span><a href="#38553742">prev</a><span>|</span><label class="collapse" for="c-38553486">[-]</label><label class="expand" for="c-38553486">[2 more]</label></div><br/><div class="children"><div class="content">Is this the same &quot;untrusted device&quot; feature that syncthing already had for years?</div><br/><div id="38553884" class="c"><input type="checkbox" id="c-38553884" checked=""/><div class="controls bullet"><span class="by">Yodel0914</span><span>|</span><a href="#38553486">parent</a><span>|</span><label class="collapse" for="c-38553884">[-]</label><label class="expand" for="c-38553884">[1 more]</label></div><br/><div class="children"><div class="content">Seems to be. I&#x27;ve been happily using it for ages.</div><br/></div></div></div></div></div></div></div></div></div></body></html>