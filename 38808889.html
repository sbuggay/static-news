<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1703926864451" as="style"/><link rel="stylesheet" href="styles.css?v=1703926864451"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.vivekpanyam.com/parsing-an-undocumented-file-format">Parsing an Undocumented File Format</a> <span class="domain">(<a href="https://blog.vivekpanyam.com">blog.vivekpanyam.com</a>)</span></div><div class="subtext"><span>vpanyam</span> | <span>30 comments</span></div><br/><div><div id="38812262" class="c"><input type="checkbox" id="c-38812262" checked=""/><div class="controls bullet"><span class="by">danielvaughn</span><span>|</span><a href="#38813691">next</a><span>|</span><label class="collapse" for="c-38812262">[-]</label><label class="expand" for="c-38812262">[2 more]</label></div><br/><div class="children"><div class="content">Reminds me of a situation I ran into years ago. I worked at a fintech startup where we were reverse engineering the mobile APIs of retail stock brokerages. Eventually we ran out of brokers in the US and began looking overseas. The first one we looked at was a large broker in Singapore.<p>Their API responses were in some absolutely insane markup language that I&#x27;d never seen before. I actually had to spend a good deal of time reading up on the history of markup languages, carefully going through each one to see if the syntax matched.<p>Eventually I gave up and just had to write a parser myself. The worst bit was that the attributes didn&#x27;t use quotation marks around the values. So you&#x27;d literally have markup like:<p><pre><code>  &lt;something name=Hello world &#x2F;&gt;
</code></pre>
It was...fun times.</div><br/><div id="38812558" class="c"><input type="checkbox" id="c-38812558" checked=""/><div class="controls bullet"><span class="by">icsa</span><span>|</span><a href="#38812262">parent</a><span>|</span><a href="#38813691">next</a><span>|</span><label class="collapse" for="c-38812558">[-]</label><label class="expand" for="c-38812558">[1 more]</label></div><br/><div class="children"><div class="content">You are not alone. I did a project to upgrade &quot;sort of XML&quot; to standard XML.
Your example content gave me flashback shivers.</div><br/></div></div></div></div><div id="38813691" class="c"><input type="checkbox" id="c-38813691" checked=""/><div class="controls bullet"><span class="by">vg_head</span><span>|</span><a href="#38812262">prev</a><span>|</span><a href="#38812174">next</a><span>|</span><label class="collapse" for="c-38813691">[-]</label><label class="expand" for="c-38813691">[1 more]</label></div><br/><div class="children"><div class="content">My experience with parsing undocumented binary formats is with Skia&#x27;s skp files. Unfortunately they don’t publish any docs regarding the format. Instead I relied on their source code (which is very convoluted), and in that process I discovered two tools which proved pretty useful:<p>- Kaitai [1], which takes as input a YAML file and can parse binary files based on it (and even generate parsers).<p>- ImHex [2], which has a pattern language [3] which allows parsing, and it seems more powerful than what Kaitai offers. I stumbled upon some limitations with it but it was still useful.<p>[1]: <a href="https:&#x2F;&#x2F;kaitai.io&#x2F;" rel="nofollow">https:&#x2F;&#x2F;kaitai.io&#x2F;</a><p>[2]: <a href="https:&#x2F;&#x2F;github.com&#x2F;WerWolv&#x2F;ImHex">https:&#x2F;&#x2F;github.com&#x2F;WerWolv&#x2F;ImHex</a><p>[3]: <a href="https:&#x2F;&#x2F;docs.werwolv.net&#x2F;pattern-language&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.werwolv.net&#x2F;pattern-language&#x2F;</a></div><br/></div></div><div id="38812174" class="c"><input type="checkbox" id="c-38812174" checked=""/><div class="controls bullet"><span class="by">LASR</span><span>|</span><a href="#38813691">prev</a><span>|</span><a href="#38813604">next</a><span>|</span><label class="collapse" for="c-38812174">[-]</label><label class="expand" for="c-38812174">[1 more]</label></div><br/><div class="children"><div class="content">More than a decade ago, I wrote a parser for Google Sketchup object files. It was part of some computer graphics assignment. We were not supposed to write parsers, but instead manually write out a 3D model vertex by vertex and then texture map them. I instead decided to write a parser and build my model in Sketchup.<p>It was a TON of fun doing that. And I learned a lot from that exercise.<p>Fast forward to a few weeks ago I &quot;wrote&quot; a parser &#x2F; serializer for handling knowledge-graphs as input&#x2F;output between my app and LLMs.<p>I used ChatGPT to walk me through the whole thing. It did very good job of converting between mermaidjs and an object type I defined in typescript. It wrote the code, the unit tests - the whole thing.<p>I don&#x27;t understand how it works. The code is great. But not as satisfying.</div><br/></div></div><div id="38813604" class="c"><input type="checkbox" id="c-38813604" checked=""/><div class="controls bullet"><span class="by">darekkay</span><span>|</span><a href="#38812174">prev</a><span>|</span><a href="#38811903">next</a><span>|</span><label class="collapse" for="c-38813604">[-]</label><label class="expand" for="c-38813604">[1 more]</label></div><br/><div class="children"><div class="content">As everyone mentions their stories: I&#x27;ve once reverse-engineered the Foobar2000 index file format to sync my playlists with Plex.<p><a href="https:&#x2F;&#x2F;darekkay.com&#x2F;blog&#x2F;foobar2000-playlist-index-format&#x2F;" rel="nofollow">https:&#x2F;&#x2F;darekkay.com&#x2F;blog&#x2F;foobar2000-playlist-index-format&#x2F;</a></div><br/></div></div><div id="38811903" class="c"><input type="checkbox" id="c-38811903" checked=""/><div class="controls bullet"><span class="by">fjfaase</span><span>|</span><a href="#38813604">prev</a><span>|</span><a href="#38811928">next</a><span>|</span><label class="collapse" for="c-38811903">[-]</label><label class="expand" for="c-38811903">[1 more]</label></div><br/><div class="children"><div class="content">I did some reverse engineering of binary file formats myself in the past, wrote some beginner notes and a collected some links. No idea if any of the links are still working.<p><a href="https:&#x2F;&#x2F;www.iwriteiam.nl&#x2F;Ha_HTCABFF.html" rel="nofollow">https:&#x2F;&#x2F;www.iwriteiam.nl&#x2F;Ha_HTCABFF.html</a></div><br/></div></div><div id="38811928" class="c"><input type="checkbox" id="c-38811928" checked=""/><div class="controls bullet"><span class="by">kaetemi</span><span>|</span><a href="#38811903">prev</a><span>|</span><a href="#38813202">next</a><span>|</span><label class="collapse" for="c-38811928">[-]</label><label class="expand" for="c-38811928">[1 more]</label></div><br/><div class="children"><div class="content">Reverse engineering data formats is one of the most fun  and satisfying things to do in programming.</div><br/></div></div><div id="38813202" class="c"><input type="checkbox" id="c-38813202" checked=""/><div class="controls bullet"><span class="by">true_pk</span><span>|</span><a href="#38811928">prev</a><span>|</span><a href="#38813192">next</a><span>|</span><label class="collapse" for="c-38813202">[-]</label><label class="expand" for="c-38813202">[1 more]</label></div><br/><div class="children"><div class="content">Great job! Good to know I wasn’t alone parsing some weird binary formats. Back at the time I created this helper module in python to make my days a bit more bearable:
<a href="https:&#x2F;&#x2F;github.com&#x2F;sergeyshilin&#x2F;byter">https:&#x2F;&#x2F;github.com&#x2F;sergeyshilin&#x2F;byter</a></div><br/></div></div><div id="38813192" class="c"><input type="checkbox" id="c-38813192" checked=""/><div class="controls bullet"><span class="by">zubairq</span><span>|</span><a href="#38813202">prev</a><span>|</span><a href="#38812474">next</a><span>|</span><label class="collapse" for="c-38813192">[-]</label><label class="expand" for="c-38813192">[1 more]</label></div><br/><div class="children"><div class="content">Brings back memories of a similar task I have with importing MS Access files (the MS Access file format is undocumented).<p>I am trying to parse the MS Access files using NodeJS&#x2F;Javascript. I last tried about 3 years ago and it was really tough going, so there is a lot of trial and error. I am able to parse some basic MS Access files, but need to figure out a way to get the whole database more reliably. My effort was here:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;yazz&#x2F;noaccess">https:&#x2F;&#x2F;github.com&#x2F;yazz&#x2F;noaccess</a></div><br/></div></div><div id="38812474" class="c"><input type="checkbox" id="c-38812474" checked=""/><div class="controls bullet"><span class="by">mabster</span><span>|</span><a href="#38813192">prev</a><span>|</span><a href="#38812096">next</a><span>|</span><label class="collapse" for="c-38812474">[-]</label><label class="expand" for="c-38812474">[1 more]</label></div><br/><div class="children"><div class="content">Back in the day I had a dual boot machine and was using a corner skin of Winamp on the Windows side and missed this on the Linux side.<p>So I started reverse engineering the Winamp skinning engine with the intention of making an engine that can run it on one of the Linux media apps. I did this by writing short programs and looking at the generated binary.<p>I had about 95% of it figured out when we had a robbery and the thief took the laptop I was using. By the time I got a new machine I had completely lost interest!<p>I wouldn&#x27;t be surprised if it was using a well known VM that I just didn&#x27;t know about at the time!</div><br/></div></div><div id="38812096" class="c"><input type="checkbox" id="c-38812096" checked=""/><div class="controls bullet"><span class="by">cjbprime</span><span>|</span><a href="#38812474">prev</a><span>|</span><a href="#38811197">next</a><span>|</span><label class="collapse" for="c-38812096">[-]</label><label class="expand" for="c-38812096">[1 more]</label></div><br/><div class="children"><div class="content">Once you think you&#x27;re at parity, it would also be instructive to try to use differential fuzzing with a compiler (where the fuzzer is synthesizing valid programs to compile) to look for inconsistencies.</div><br/></div></div><div id="38811197" class="c"><input type="checkbox" id="c-38811197" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#38812096">prev</a><span>|</span><a href="#38811783">next</a><span>|</span><label class="collapse" for="c-38811197">[-]</label><label class="expand" for="c-38811197">[9 more]</label></div><br/><div class="children"><div class="content">Reverse engineering a file format or protocol is almost a rite of passage for programmers, it is incredibly fun and rewarding, something I&#x27;d recommend for all medium&#x2F;senior programmers get into at least once.<p>A few years ago I was using LiDAR scanners from a manufacturer that didn&#x27;t provide a linux driver, only windows - the way it worked is that you programmed the firmware to fire UDP packets at a specified IP and port and then when the device powered up it would push this continuous stream of data to you. 300,000 points a second.<p>So I started capturing these UDP packets and then decoding them with python, eventually I had to write a plugin in C to do the high performance parsing and bit packing, but nothing beats that feeling when you&#x27;re stumped on what a bit of data means and then a eurika moment hits you in the shower, and the project advances!</div><br/><div id="38811663" class="c"><input type="checkbox" id="c-38811663" checked=""/><div class="controls bullet"><span class="by">ikari_pl</span><span>|</span><a href="#38811197">parent</a><span>|</span><a href="#38811683">next</a><span>|</span><label class="collapse" for="c-38811663">[-]</label><label class="expand" for="c-38811663">[2 more]</label></div><br/><div class="children"><div class="content">Some of the worst code of my life, created 20 years ago when I was a teenager, today posted openly on my GitHub, was reverse engineered custom chat server protocol, as I wrote my own client to replace the Java applet. And to have logs.<p>The catch is... I didn&#x27;t have any Internet connection. I was going to an internet cafe, logging onto the chat server, and chatting, while recording the connection with Wireshark.<p>At home, I&#x27;d print the hex + ASCII connection dump on my dot matrix printer, and used a highlighter and ballpoint pen to mark the fields of the message packet.<p>Then I&#x27;d code something around it, planned new tests, compiled a new version of the app and.... took it with me on a hard drive to the internet cafe to test next day, or next weekend.<p>I think I was way smarter and goal oriented than I am today.</div><br/><div id="38812447" class="c"><input type="checkbox" id="c-38812447" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#38811197">root</a><span>|</span><a href="#38811663">parent</a><span>|</span><a href="#38811683">next</a><span>|</span><label class="collapse" for="c-38812447">[-]</label><label class="expand" for="c-38812447">[1 more]</label></div><br/><div class="children"><div class="content">I did this too!  Having no interenet at home I would take a box of floppy disks to the library every day and save articles on C programming, OpenGL programming, and the raw weather satellite images from the NOAA - I was trying to re-create the 3D weather fly-over I saw in Jurassic Park when I was 7. I agree - having that disconnection was ultimatly good because it made me think a lot for myself rather than just google a solution, it developed my fundimentals a lot.</div><br/></div></div></div></div><div id="38811683" class="c"><input type="checkbox" id="c-38811683" checked=""/><div class="controls bullet"><span class="by">sedatk</span><span>|</span><a href="#38811197">parent</a><span>|</span><a href="#38811663">prev</a><span>|</span><a href="#38811705">next</a><span>|</span><label class="collapse" for="c-38811683">[-]</label><label class="expand" for="c-38811683">[1 more]</label></div><br/><div class="children"><div class="content">That’s what I was gonna say. Reverse engineering was the only way in the 90’s as documentation was scarce. I had to reverse anything if I wanted to understand how it worked.<p>Here is an extractor I wrote for Westwood PAK and Lucasarts LFD files when I was 16: <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;ssg&#x2F;e3e9654612be916336c01e104b10ddc7" rel="nofollow">https:&#x2F;&#x2F;gist.github.com&#x2F;ssg&#x2F;e3e9654612be916336c01e104b10ddc7</a></div><br/></div></div><div id="38811705" class="c"><input type="checkbox" id="c-38811705" checked=""/><div class="controls bullet"><span class="by">nemothekid</span><span>|</span><a href="#38811197">parent</a><span>|</span><a href="#38811683">prev</a><span>|</span><a href="#38811281">next</a><span>|</span><label class="collapse" for="c-38811705">[-]</label><label class="expand" for="c-38811705">[3 more]</label></div><br/><div class="children"><div class="content">&gt;<i>is almost a rite of passage for programmers, it is incredibly fun and rewarding,</i><p>Only when you are doing it for yourself or when it&#x27;s a known undertaking. It can be very frustrating when you are integrating with some hardware and you are 99% complete and you&#x27;ve told everyone you are ready to ship and the last 1% is a surprise reverse protocol engineering project.</div><br/><div id="38811943" class="c"><input type="checkbox" id="c-38811943" checked=""/><div class="controls bullet"><span class="by">mungoman2</span><span>|</span><a href="#38811197">root</a><span>|</span><a href="#38811705">parent</a><span>|</span><a href="#38812788">next</a><span>|</span><label class="collapse" for="c-38811943">[-]</label><label class="expand" for="c-38811943">[1 more]</label></div><br/><div class="children"><div class="content">Well tbh, failing to deliver after over committing is also a good experience.</div><br/></div></div><div id="38812788" class="c"><input type="checkbox" id="c-38812788" checked=""/><div class="controls bullet"><span class="by">marginalia_nu</span><span>|</span><a href="#38811197">root</a><span>|</span><a href="#38811705">parent</a><span>|</span><a href="#38811943">prev</a><span>|</span><a href="#38811281">next</a><span>|</span><label class="collapse" for="c-38812788">[-]</label><label class="expand" for="c-38812788">[1 more]</label></div><br/><div class="children"><div class="content">Lesson is to not say it&#x27;s ready before it&#x27;s ready.</div><br/></div></div></div></div><div id="38811281" class="c"><input type="checkbox" id="c-38811281" checked=""/><div class="controls bullet"><span class="by">mattpallissard</span><span>|</span><a href="#38811197">parent</a><span>|</span><a href="#38811705">prev</a><span>|</span><a href="#38811783">next</a><span>|</span><label class="collapse" for="c-38811281">[-]</label><label class="expand" for="c-38811281">[2 more]</label></div><br/><div class="children"><div class="content">Agreed, reverse engineering a job submission and validation protocol that ran over a Unix socket was some of the most fun I ever had on the clock.<p>I wound up basically re-implementing the software that was listening to create a test suite by the time it was all said and done.</div><br/><div id="38811569" class="c"><input type="checkbox" id="c-38811569" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#38811197">root</a><span>|</span><a href="#38811281">parent</a><span>|</span><a href="#38811783">next</a><span>|</span><label class="collapse" for="c-38811569">[-]</label><label class="expand" for="c-38811569">[1 more]</label></div><br/><div class="children"><div class="content">Even the less challenging stuff can be fun.  After seeing that SimCity themed Chicago zoning map I got to thinking about if it would be possible to do the same for the Bay Area.  Turns out the cities I&#x27;ve looked at so far publish all sorts of machine readable information, the fun part is in finding and exfiltrating it.</div><br/></div></div></div></div></div></div><div id="38811783" class="c"><input type="checkbox" id="c-38811783" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#38811197">prev</a><span>|</span><a href="#38812829">next</a><span>|</span><label class="collapse" for="c-38811783">[-]</label><label class="expand" for="c-38811783">[3 more]</label></div><br/><div class="children"><div class="content">Just watch out for the encrypted file formats.  Need a debugger to figure out what it&#x27;s doing.</div><br/><div id="38812429" class="c"><input type="checkbox" id="c-38812429" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38811783">parent</a><span>|</span><a href="#38812829">next</a><span>|</span><label class="collapse" for="c-38812429">[-]</label><label class="expand" for="c-38812429">[2 more]</label></div><br/><div class="children"><div class="content">They are relatively easier to detect though. Compressed file formats or virtual machine codes in disguise tend to be more annoying, especially since they can look like somehow structured and waste your time.</div><br/><div id="38812616" class="c"><input type="checkbox" id="c-38812616" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#38811783">root</a><span>|</span><a href="#38812429">parent</a><span>|</span><a href="#38812829">next</a><span>|</span><label class="collapse" for="c-38812616">[-]</label><label class="expand" for="c-38812616">[1 more]</label></div><br/><div class="children"><div class="content">Meanwhile for ZLIB compressed files, just look for the &#x27;x&#x27; after headers.</div><br/></div></div></div></div></div></div><div id="38812255" class="c"><input type="checkbox" id="c-38812255" checked=""/><div class="controls bullet"><span class="by">SubiculumCode</span><span>|</span><a href="#38812829">prev</a><span>|</span><a href="#38812202">next</a><span>|</span><label class="collapse" for="c-38812255">[-]</label><label class="expand" for="c-38812255">[1 more]</label></div><br/><div class="children"><div class="content">I have some 3d binary image files from long lost propietary application and was trying to recover the data, and because I have little experience, ran into a wall.<p>I was wondering whether chatgpt can be used to read in the byte sequences and umm, do something.</div><br/></div></div><div id="38812202" class="c"><input type="checkbox" id="c-38812202" checked=""/><div class="controls bullet"><span class="by">SuperNinKenDo</span><span>|</span><a href="#38812255">prev</a><span>|</span><a href="#38812663">next</a><span>|</span><label class="collapse" for="c-38812202">[-]</label><label class="expand" for="c-38812202">[3 more]</label></div><br/><div class="children"><div class="content">This is something I&#x27;ve been interested in for a while.<p>I&#x27;ve collected a few links people have already posted to their own projects or write-ups here and elsewhere, but is there any single excellent resource for learning how to do this?<p>I&#x27;ve a number of dead and&#x2F;or proprietary formats that I&#x27;ve always wanted to crack open, but I&#x27;m totally overwhelmed with where to start.</div><br/><div id="38812522" class="c"><input type="checkbox" id="c-38812522" checked=""/><div class="controls bullet"><span class="by">signaru</span><span>|</span><a href="#38812202">parent</a><span>|</span><a href="#38812402">next</a><span>|</span><label class="collapse" for="c-38812522">[-]</label><label class="expand" for="c-38812522">[1 more]</label></div><br/><div class="children"><div class="content">I had reversed engineered some ASCII file formats. While probably overkill, my background parsing simple programming languages (for which there are many good educational resources) was really helpful (in the approach I use). I tokenize, and try figuring out syntax structures from the order of token types, then from there, extract the information I need into my program&#x27;s data representation. I&#x27;m not sure if this is the approach used by everyone else, but it seems plausible for someone with a CS&#x2F;PL implementation background.<p>But first, it helps to have sample files to see recurring structures. Ideally, you also have access to software that generates these files. This allows you to deal with simpler files containing less information to reason about, make small changes within the program and compare the corresponding change(s) in the file.</div><br/></div></div><div id="38812402" class="c"><input type="checkbox" id="c-38812402" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38812202">parent</a><span>|</span><a href="#38812522">prev</a><span>|</span><a href="#38812663">next</a><span>|</span><label class="collapse" for="c-38812402">[-]</label><label class="expand" for="c-38812402">[1 more]</label></div><br/><div class="children"><div class="content">While I don&#x27;t have any handy link, I did reverse-engineered several file formats without any further information and I can give some points.<p>First, make sure that you know what the format is actually supposed to encode. For example, if some file weighs (say) 40 KB then it is unlikely to be a raster image. The file name, if any, helps a lot to narrow the scope.<p>Second, you should have some understanding of similar file formats. I generally recommend to study PNG first because it gives an example of typical structured file formats and raster image formats. (Don&#x27;t delve into the compression though---bitwise analysis is much harder.) This is also why you needed to know what the format is for, many formats with the same goal tend to have similar structures.<p>Third, collect as many examples as possible. You can line them up to see commonalities and differences and spot patterns. Even better if you can actively generate different files. This is generally the last hope when you are run out of reasonable hypotheses.<p>Fourth, optimize the feedback loop. You will have to do a lot of hypothesization, validation and automation. You can&#x27;t really optimize the number of iterations, but you can optimize the time for a single iteration. Use a comfortable scripting language with good binary operation. I tend to use a vanilla Python with struct and make everything else by my own, but there are several libraries that greatly help you if you don&#x27;t feel like doing so.</div><br/></div></div></div></div><div id="38812663" class="c"><input type="checkbox" id="c-38812663" checked=""/><div class="controls bullet"><span class="by">msla</span><span>|</span><a href="#38812202">prev</a><span>|</span><label class="collapse" for="c-38812663">[-]</label><label class="expand" for="c-38812663">[1 more]</label></div><br/><div class="children"><div class="content">Doing this with text files used to be a big part of my job. I had to write Java (well, mainly Java... ) (cf. the ingredients of scumble on Discworld) programs to parse the files school districts had that described bus stops, from depot to school in the AM and from school to depot in the PM among other arrangements, and, often, the best you could say about some files is that someone had likely worked fairly hard to make them look like they were software-generated. They had just enough structure that parsing them with a program was the correct option, but they had enough irregularities that the program was never going to be pretty, because there&#x27;s no pretty way to parse an ugly file.<p>It&#x27;s a wonderful example of inductive reasoning, or generating general rules from a collection of specific examples.</div><br/></div></div></div></div></div></div></div></body></html>