<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1728810068115" as="style"/><link rel="stylesheet" href="styles.css?v=1728810068115"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.ryanliptak.com/blog/every-rc-exe-bug-quirk-probably/">Every bug/quirk of the Windows resource compiler (rc.exe), probably</a> <span class="domain">(<a href="https://www.ryanliptak.com">www.ryanliptak.com</a>)</span></div><div class="subtext"><span>nektro</span> | <span>14 comments</span></div><br/><div><div id="41826269" class="c"><input type="checkbox" id="c-41826269" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#41826202">next</a><span>|</span><label class="collapse" for="c-41826269">[-]</label><label class="expand" for="c-41826269">[1 more]</label></div><br/><div class="children"><div class="content">Very brave author.  I have contributed a few patches to WINDRES to fix some bugs and it&#x27;s a strange tool &#x2F; concept.<p>I&#x27;m going to guess that Microsoft won&#x27;t wish to fix any bugs in RC.EXE, since that would break some existing resource scripts, and at this point backwards compatibility is much more important than dealing with quirks.</div><br/></div></div><div id="41826202" class="c"><input type="checkbox" id="c-41826202" checked=""/><div class="controls bullet"><span class="by">urbandw311er</span><span>|</span><a href="#41826269">prev</a><span>|</span><a href="#41825266">next</a><span>|</span><label class="collapse" for="c-41826202">[-]</label><label class="expand" for="c-41826202">[1 more]</label></div><br/><div class="children"><div class="content">I liked this article. I would suggest having a new category of ”validation” for some of these. It’s not particularly fair to call something a bug, for example, when it’s just that rc.exe doesn’t play nicely with things it never expected to receive, like non-numeric characters etc.</div><br/></div></div><div id="41825266" class="c"><input type="checkbox" id="c-41825266" checked=""/><div class="controls bullet"><span class="by">pilif</span><span>|</span><a href="#41826202">prev</a><span>|</span><a href="#41823467">next</a><span>|</span><label class="collapse" for="c-41825266">[-]</label><label class="expand" for="c-41825266">[2 more]</label></div><br/><div class="children"><div class="content">What an amazing article. And what amazing analysis of this 30 years old blob. This was super enjoyable to read.<p>My only tiny gripe is that with the first quirk the author who insists that his implementation is bug for bug compatible lists the other implementations behavior and explains that they are very different from the original.<p>And then they proceed with additional quirks where the supposedly bug-for-bug compatible implementation <i>also</i> is different in the same way as the first example in that it produces an error message rather than the quirky output.<p>Don’t get me wrong: errors rather than quirks is much better behavior, but then don’t claim to be bug-for-bug compatible, nor roast other implementations for doing the same thing.</div><br/><div id="41825351" class="c"><input type="checkbox" id="c-41825351" checked=""/><div class="controls bullet"><span class="by">squeek502</span><span>|</span><a href="#41825266">parent</a><span>|</span><a href="#41823467">next</a><span>|</span><label class="collapse" for="c-41825351">[-]</label><label class="expand" for="c-41825351">[1 more]</label></div><br/><div class="children"><div class="content">Apologies if I got the tone wrong there, I definitely wasn&#x27;t trying to roast the other projects.<p>In terms of what I prioritized bug-for-bug compatibility on, I tailored it to getting <a href="https:&#x2F;&#x2F;github.com&#x2F;squeek502&#x2F;win32-samples-rc-tests">https:&#x2F;&#x2F;github.com&#x2F;squeek502&#x2F;win32-samples-rc-tests</a> passing 100%, and then also tried to take into account how likely a bug&#x2F;quirk was to be used in a real .rc file (ultimately this is just a judgement call, though). The results of that test suite (provided in the readme) is also a better indication of how rc.exe-compatible the various resource compilers are in practice (i.e. on &#x27;real&#x27; .rc files).</div><br/></div></div></div></div><div id="41823467" class="c"><input type="checkbox" id="c-41823467" checked=""/><div class="controls bullet"><span class="by">Arnavion</span><span>|</span><a href="#41825266">prev</a><span>|</span><a href="#41823024">next</a><span>|</span><label class="collapse" for="c-41823467">[-]</label><label class="expand" for="c-41823467">[1 more]</label></div><br/><div class="children"><div class="content">I was thinking `NOT (1|2)` and `NOT () 2` could make sense if the parser just has a `not_in_effect` flag that gets set to true when a `NOT` is encountered and then applies to the next integer as soon as one is parsed. So `NOT (1|2)` sets the flag, then starts parsing `(1|2)`. Once it&#x27;s parsed the `1`, it notices a NOT is in effect so it applies it to the 1 as if it had just parsed `NOT 1` (which leaves 0 unchanged), then parses `| 2`, so the result is 2.<p>`NOT () 2` would be the same logic. `)` signifies the end of an expression and thus evaluates to the current integral result, which is 0 (for the same reason that unary - is zero), and a NOT is in effect so it&#x27;s treated as `NOT 0` which is a no-op (&quot;unset no bits&quot;). Then the next `2` makes the result `2`. This assumes that `x y` is parsed the same as `x | y` (maybe only if a `NOT` has been parsed at any point first) or as `y` (the same stack-like &quot;the last number that was parsed becomes the result&quot; behavior described in other items).<p>This doesn&#x27;t explain the `7 NOT NOT 4 NOT 2 NOT NOT 1 = 2` case though. If the parser just *sets* the `not_in_effect` flag when it encounters a `NOT` (instead of *toggling* it), then this would be `7 | NOT 4 | NOT 2 | NOT 1` which would be 0. If the parser does toggle the flag, this would be `7 | 4 | NOT 2 | 1` which would be 1 or 5. If the parser treats a `NOT` as ending the previous expression (if any), this would be `7 | NOT 0 | NOT 4 | NOT 2 | NOT 0 | NOT 1` which would be 0.</div><br/></div></div><div id="41823024" class="c"><input type="checkbox" id="c-41823024" checked=""/><div class="controls bullet"><span class="by">squeek502</span><span>|</span><a href="#41823467">prev</a><span>|</span><a href="#41823725">next</a><span>|</span><label class="collapse" for="c-41823024">[-]</label><label class="expand" for="c-41823024">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;m the author if anyone has questions</div><br/><div id="41825117" class="c"><input type="checkbox" id="c-41825117" checked=""/><div class="controls bullet"><span class="by">kcbanner</span><span>|</span><a href="#41823024">parent</a><span>|</span><a href="#41825552">next</a><span>|</span><label class="collapse" for="c-41825117">[-]</label><label class="expand" for="c-41825117">[1 more]</label></div><br/><div class="children"><div class="content">Thanks again for resinator! I recently used it to ship a small win32 utility (<a href="https:&#x2F;&#x2F;github.com&#x2F;kcbanner&#x2F;multi-mouse">https:&#x2F;&#x2F;github.com&#x2F;kcbanner&#x2F;multi-mouse</a>) and it worked perfectly.</div><br/></div></div><div id="41825552" class="c"><input type="checkbox" id="c-41825552" checked=""/><div class="controls bullet"><span class="by">InvisibleUp</span><span>|</span><a href="#41823024">parent</a><span>|</span><a href="#41825117">prev</a><span>|</span><a href="#41823626">next</a><span>|</span><label class="collapse" for="c-41825552">[-]</label><label class="expand" for="c-41825552">[1 more]</label></div><br/><div class="children"><div class="content">The quote escaping seems to be identical to that of Visual Basic 6 (and likely QBASIC as well, although I haven’t tested that.)</div><br/></div></div><div id="41823626" class="c"><input type="checkbox" id="c-41823626" checked=""/><div class="controls bullet"><span class="by">1f60c</span><span>|</span><a href="#41823024">parent</a><span>|</span><a href="#41825552">prev</a><span>|</span><a href="#41823293">next</a><span>|</span><label class="collapse" for="c-41823626">[-]</label><label class="expand" for="c-41823626">[2 more]</label></div><br/><div class="children"><div class="content">Resinator&#x27;s error messages look amazing! I also feel like I’ve gained a lot of cursed but useless (to me) knowledge, so thanks for that. :-)<p>I don&#x27;t have a horse in this race, but regarding FONT resources, I would like to humbly suggest not supporting them at all. Radical, but from what you wrote, they do seem pretty weird and ripe for accidental misuse. Plus, they are obsolete and it seems like Resinator already intentionally diverges from rc.exe in a few cases anyway.</div><br/><div id="41823756" class="c"><input type="checkbox" id="c-41823756" checked=""/><div class="controls bullet"><span class="by">squeek502</span><span>|</span><a href="#41823024">root</a><span>|</span><a href="#41823626">parent</a><span>|</span><a href="#41823293">next</a><span>|</span><label class="collapse" for="c-41823756">[-]</label><label class="expand" for="c-41823756">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!<p>I&#x27;m actually pretty okay with where I&#x27;ve landed with FONT resources. The legwork has already been done in figuring things out, and with the strategy I&#x27;ve chosen, resinator doesn&#x27;t even need to parse .fnt files at all, so the implementation is pretty simple (I wrote a .fnt parser, but it&#x27;s now unused[1]).<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;squeek502&#x2F;resinator&#x2F;blob&#x2F;master&#x2F;src&#x2F;fnt.zig">https:&#x2F;&#x2F;github.com&#x2F;squeek502&#x2F;resinator&#x2F;blob&#x2F;master&#x2F;src&#x2F;fnt.z...</a></div><br/></div></div></div></div></div></div><div id="41823725" class="c"><input type="checkbox" id="c-41823725" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#41823024">prev</a><span>|</span><label class="collapse" for="c-41823725">[-]</label><label class="expand" for="c-41823725">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a crazy amount of work and a crazy amount of quirks indeed. Very much illustrates a mindset where the user is at fault if they provide bad input - and development effort for everything was multiplied compared to today. In 1985, of course, nobody cared about things like security from untrusted inputs, and reproducible builds.<p>My favourite bug from this list is that the compiler expands tabs to spaces in string literals and puts them at tab stops based on the string literal&#x27;s horizontal position in the source file.<p>I think that being able to directly define resource type 6 is not a bug. You got exactly what you asked for - an invalid resource. Crashing when loading it isn&#x27;t a bug, either.<p>I suppose that style flag arguments are parsed as |-separated lists of numeric or NOT expressions, rather than single expressions where | serves as bitwise-or.<p>&gt; If the truncated value is &gt;= 0x80, add 0xFF00 and write the result as a little-endian u32. If the truncated value is &lt; 0x80 but not zero, write the value as a little-endian u32.<p>This is sign-extension: s8 -&gt; s16 -&gt; u16 -&gt; u32. The examples below this also seem to have reversed the order of the input byte and the FF.<p>Visual C++ 6, at least, includes a toolbar resource editor. IIRC it shows the toolbar metadata and the bitmap together in one editor, and you edit each button&#x27;s image individually even though they are concatenated into one bitmap in the resource file.<p>&quot;GROUPBOX can only be used in DIALOGEX&quot; might refer to some limitation other than the resource compiler. For example, perhaps Windows versions that don&#x27;t support DIALOGEX also don&#x27;t support GROUPBOX.<p>A lot of them could be caused by memory safety errors. For example the fact that &quot;1 ICON {&quot; treats &quot;ICON&quot; as the filename is probably because the tokenizer doesn&#x27;t set the Microsoft equivalent of yytext for tokens where it&#x27;s not supposed to be relevant. Maybe it would even crash (null pointer) if { could be the first token (which it can&#x27;t).</div><br/><div id="41823845" class="c"><input type="checkbox" id="c-41823845" checked=""/><div class="controls bullet"><span class="by">squeek502</span><span>|</span><a href="#41823725">parent</a><span>|</span><label class="collapse" for="c-41823845">[-]</label><label class="expand" for="c-41823845">[1 more]</label></div><br/><div class="children"><div class="content">Appreciate the added context!<p>&gt; |-separated lists of numeric or NOT<p>Note that | is not the only operator that can be used in style parameters, &amp; + and - are all allowed too.<p>&gt; perhaps Windows versions that don&#x27;t support DIALOGEX also don&#x27;t support GROUPBOX<p>Seems possible for sure. From [1]:<p>&gt; The 16-bit extended dialog template is purely historical. The only operating systems to support it were the Windows 95&#x2F;98&#x2F;Me series.<p>[1] <a href="https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;oldnewthing&#x2F;20040622-00&#x2F;?p=38773" rel="nofollow">https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;oldnewthing&#x2F;20040622-00&#x2F;?p=38...</a><p>&gt; The examples below this also seem to have reversed the order of the input byte and the FF.<p>Good catch, fixed</div><br/></div></div></div></div></div></div></div></div></div></body></html>