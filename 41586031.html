<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1726736465026" as="style"/><link rel="stylesheet" href="styles.css?v=1726736465026"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://ssoready.com/blog/engineering/ruby-saml-pwned-by-xml-signature-wrapping-attacks/">Ruby-SAML pwned by XML signature wrapping attacks</a> <span class="domain">(<a href="https://ssoready.com">ssoready.com</a>)</span></div><div class="subtext"><span>ucarion</span> | <span>53 comments</span></div><br/><div><div id="41586913" class="c"><input type="checkbox" id="c-41586913" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#41589463">next</a><span>|</span><label class="collapse" for="c-41586913">[-]</label><label class="expand" for="c-41586913">[12 more]</label></div><br/><div class="children"><div class="content">SAML is absolutely insane. It’s <i>three</i> separate specs: one that defines what every XML element means semantically, one that defines multiple document models that you might want to combine those to use, and one that talks about network protocols you might want to use those documents in.<p>It’s insane and inscrutable.<p>I previously worked at the company that first created this gem. It was not written based off actually reading the spec. It was based off a loose examination of what other legitimate docs in the wild looked like, and built to parse those.<p>Which of course meant that early on it was vulnerable to <i>everything</i> since it was built to fit positive results and not negative ones. This isn’t even the first XML signature issue: early released versions didn’t even bother to check that the part being used was the part that was signed. If <i>any</i> part of the doc was signed and valid it was good to go.<p>Fun times.</div><br/><div id="41587795" class="c"><input type="checkbox" id="c-41587795" checked=""/><div class="controls bullet"><span class="by">bradly</span><span>|</span><a href="#41586913">parent</a><span>|</span><a href="#41587792">next</a><span>|</span><label class="collapse" for="c-41587795">[-]</label><label class="expand" for="c-41587795">[1 more]</label></div><br/><div class="children"><div class="content">I was jamming this gem rails back in 2009-2010 and will tell you we had no idea what we were doing on our side either. We were a couple a Rails devs at a tiny start up implement Qualcomm&#x27;s SSO and tbh I&#x27;m surprised it actually worked.<p>There wasn&#x27;t a two-legged oauth gem at the time so I remember writing one and being blowing away at how much I actually understood the OAuth 1.0 2-legged spec.</div><br/></div></div><div id="41587792" class="c"><input type="checkbox" id="c-41587792" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41586913">parent</a><span>|</span><a href="#41587795">prev</a><span>|</span><a href="#41586981">next</a><span>|</span><label class="collapse" for="c-41587792">[-]</label><label class="expand" for="c-41587792">[6 more]</label></div><br/><div class="children"><div class="content">In my experience, anything XML-related seems to be the product of simplicity-hating architecture astronauts with zero consideration for efficiency, possibly as a way of justifying their existence and continued employment.<p>Standards based on ASN.1 get a lot of hate (X.509 etc.) but I&#x27;d rather work with that than XML.</div><br/><div id="41589821" class="c"><input type="checkbox" id="c-41589821" checked=""/><div class="controls bullet"><span class="by">zaik</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587792">parent</a><span>|</span><a href="#41587969">next</a><span>|</span><label class="collapse" for="c-41589821">[-]</label><label class="expand" for="c-41589821">[1 more]</label></div><br/><div class="children"><div class="content">XMPP is still a simple and efficient chat protocol. But it makes sure to only allow a sane subset of XML.</div><br/></div></div><div id="41587969" class="c"><input type="checkbox" id="c-41587969" checked=""/><div class="controls bullet"><span class="by">amluto</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587792">parent</a><span>|</span><a href="#41589821">prev</a><span>|</span><a href="#41589290">next</a><span>|</span><label class="collapse" for="c-41587969">[-]</label><label class="expand" for="c-41587969">[3 more]</label></div><br/><div class="children"><div class="content">I find XML to be perfectly fine as a markup language. I once set up a system to generate logs as XML elements and display them prettily with XSLT. It was delightful!<p>Using XML as an interchange format for things intended to be read by a machine is not so great.  Don’t use it where you actually want something more like protobuf.</div><br/><div id="41588507" class="c"><input type="checkbox" id="c-41588507" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587969">parent</a><span>|</span><a href="#41588527">next</a><span>|</span><label class="collapse" for="c-41588507">[-]</label><label class="expand" for="c-41588507">[1 more]</label></div><br/><div class="children"><div class="content">XML isnt great for that, but the xml part is the least of the concerns. XSignature and SAML are insane specs, and would still be insane if the underlying presentation language wasnt xml (i mean, then you wouldnt be using xsignature, but if you made sone xsignature like thing for a different presentation language, it would still be crazy)</div><br/></div></div><div id="41588527" class="c"><input type="checkbox" id="c-41588527" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587969">parent</a><span>|</span><a href="#41588507">prev</a><span>|</span><a href="#41589290">next</a><span>|</span><label class="collapse" for="c-41588527">[-]</label><label class="expand" for="c-41588527">[1 more]</label></div><br/><div class="children"><div class="content">I like your take and I think it is demonstrated by the fact that JSX is nice and YAML is awful.</div><br/></div></div></div></div><div id="41589290" class="c"><input type="checkbox" id="c-41589290" checked=""/><div class="controls bullet"><span class="by">tannhaeuser</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587792">parent</a><span>|</span><a href="#41587969">prev</a><span>|</span><a href="#41586981">next</a><span>|</span><label class="collapse" for="c-41589290">[-]</label><label class="expand" for="c-41589290">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re not wrong. The amount of fields of use where XML is used bogusly which have nothing to do with markup is truly staggering. XML signing and relying on canonical XML serialization for it is just peak and something else.<p>The sad thing is that XML was meant as a simplification over full SGML for delivery of markup on the web. Specifically, XML is always fully tagged (doesn&#x27;t make use of tag inference), and does neither have empty (&quot;void&quot;) elements nor short forms for attributes such as in &lt;option selected&gt;. Thus XML never <i>needs</i> markup declarations for special per-element or per-attribute parsing rules. This was done to facilitate newer vocabularies next to HTML like SVG and MathML.<p>But soon enough, folks took the XML specification as an invitation for complexity and a self-serving spec circus: namespaces, XInclude (as a bogus replacement for entity expansion), XQuery, XSLT, XML Schema as a super-verbose replacement for DTDs using XML itself, etc. XHTML 2 was the largest failure and turning point, introducing not just a new vocabulary, but trying to reinvent how browsers work in a design-by-comittee fashion. It could be said that XHTML took W3C down along with it.<p>For message payloads in large and long-term multi-party projects (governments, finance&#x2F;payments, healthcare, etc.), I&#x27;m however not sure the alternatives (JSON-over-HTTP and the idiotic quasi-religious apeal to misunderstood &quot;REST&quot; semantics) is really helping. XML Schema, while in part overkill and unused (substitution groups), certainly has facilitated separating service interface from service implementation, multiple generations and multiple implementations, test cases bases, and other long-term maintenance goals.</div><br/></div></div></div></div><div id="41586981" class="c"><input type="checkbox" id="c-41586981" checked=""/><div class="controls bullet"><span class="by">ucarion</span><span>|</span><a href="#41586913">parent</a><span>|</span><a href="#41587792">prev</a><span>|</span><a href="#41587439">next</a><span>|</span><label class="collapse" for="c-41586981">[-]</label><label class="expand" for="c-41586981">[2 more]</label></div><br/><div class="children"><div class="content">You&#x27;ll be pleased to know that we&#x27;re not making a ton of progress on the &quot;split things over N docs&quot; front.<p>In recent years IETF has given us SCIM (which is sort of like &quot;offline SAML&quot;) which is 3 RFCs (goals, schemas, http stuff), and of course JWT is actually part of a series of like 9 RFCs (including JWT, of course, but also JWK, JWS, JWE, JWA, ...).<p>I think there&#x27;s this phenomenon where people who are like &quot;dude, nobody cares, just do the dumbest possible thing we can get away with&quot; aren&#x27;t the people who decide to get involved in writing security specs.</div><br/><div id="41587421" class="c"><input type="checkbox" id="c-41587421" checked=""/><div class="controls bullet"><span class="by">victor106</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41586981">parent</a><span>|</span><a href="#41587439">next</a><span>|</span><label class="collapse" for="c-41587421">[-]</label><label class="expand" for="c-41587421">[1 more]</label></div><br/><div class="children"><div class="content">&gt; SCIM (which is sort of like &quot;offline SAML&quot;)<p>If you are talking about SCIM (System for Cross Domain Identity Management) then it’s very different from what SAML is. SCIM Is used for user provisioning where as SAML is used for SSO.</div><br/></div></div></div></div><div id="41587439" class="c"><input type="checkbox" id="c-41587439" checked=""/><div class="controls bullet"><span class="by">paradox460</span><span>|</span><a href="#41586913">parent</a><span>|</span><a href="#41586981">prev</a><span>|</span><a href="#41589463">next</a><span>|</span><label class="collapse" for="c-41587439">[-]</label><label class="expand" for="c-41587439">[2 more]</label></div><br/><div class="children"><div class="content">Hey a fellow ol alum. Boy I have dark memories of what that gem cost</div><br/><div id="41587580" class="c"><input type="checkbox" id="c-41587580" checked=""/><div class="controls bullet"><span class="by">jrozner</span><span>|</span><a href="#41586913">root</a><span>|</span><a href="#41587439">parent</a><span>|</span><a href="#41589463">next</a><span>|</span><label class="collapse" for="c-41587580">[-]</label><label class="expand" for="c-41587580">[1 more]</label></div><br/><div class="children"><div class="content">Also an alum from WAY back (pre-A). One of the first things I did when I started was look at a different wrapping vuln.</div><br/></div></div></div></div></div></div><div id="41589463" class="c"><input type="checkbox" id="c-41589463" checked=""/><div class="controls bullet"><span class="by">lifeisstillgood</span><span>|</span><a href="#41586913">prev</a><span>|</span><a href="#41587332">next</a><span>|</span><label class="collapse" for="c-41589463">[-]</label><label class="expand" for="c-41589463">[1 more]</label></div><br/><div class="children"><div class="content">This article actually reads like a dev who understands the problem and has an opinion.<p>Where else can one find such writing about security issues ?</div><br/></div></div><div id="41587332" class="c"><input type="checkbox" id="c-41587332" checked=""/><div class="controls bullet"><span class="by">bfrog</span><span>|</span><a href="#41589463">prev</a><span>|</span><a href="#41588521">next</a><span>|</span><label class="collapse" for="c-41587332">[-]</label><label class="expand" for="c-41587332">[5 more]</label></div><br/><div class="children"><div class="content">Signed xml alone is a wildly confusing idea, as the signatures get embedded as elements in the document being signed. There’s a wild set of rules on how to make xml canonical, sign, add the signature, etc. It’s nontrivial.</div><br/><div id="41587573" class="c"><input type="checkbox" id="c-41587573" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#41587332">parent</a><span>|</span><a href="#41588521">next</a><span>|</span><label class="collapse" for="c-41587573">[-]</label><label class="expand" for="c-41587573">[4 more]</label></div><br/><div class="children"><div class="content">What&#x27;s confusing about it? Everything seems pretty obvious to me.</div><br/><div id="41587633" class="c"><input type="checkbox" id="c-41587633" checked=""/><div class="controls bullet"><span class="by">captn3m0</span><span>|</span><a href="#41587332">root</a><span>|</span><a href="#41587573">parent</a><span>|</span><a href="#41588521">next</a><span>|</span><label class="collapse" for="c-41587633">[-]</label><label class="expand" for="c-41587633">[3 more]</label></div><br/><div class="children"><div class="content">Adding Signatures to an existing document, no matter the format is just a whole bunch of trouble.</div><br/><div id="41587935" class="c"><input type="checkbox" id="c-41587935" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#41587332">root</a><span>|</span><a href="#41587633">parent</a><span>|</span><a href="#41588521">next</a><span>|</span><label class="collapse" for="c-41587935">[-]</label><label class="expand" for="c-41587935">[2 more]</label></div><br/><div class="children"><div class="content">To expand, generally you wouldn&#x27;t want to <i>change the identity of the document</i> by signing it (eg change it&#x27;s hash). That&#x27;s bananas. If the signature was external to the document, you wouldn&#x27;t need any complex and error prone rules to canonicalize. You&#x27;d just generate an HMAC tag and send it alongside (or, better yet, use an authenticated encryption like AES-GCM).</div><br/><div id="41588574" class="c"><input type="checkbox" id="c-41588574" checked=""/><div class="controls bullet"><span class="by">jahewson</span><span>|</span><a href="#41587332">root</a><span>|</span><a href="#41587935">parent</a><span>|</span><a href="#41588521">next</a><span>|</span><label class="collapse" for="c-41588574">[-]</label><label class="expand" for="c-41588574">[1 more]</label></div><br/><div class="children"><div class="content">The sane thing is to sign bytes, as you suggest. But OP is right that it needs to preclude adding signatures to a document.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41588521" class="c"><input type="checkbox" id="c-41588521" checked=""/><div class="controls bullet"><span class="by">quickgist</span><span>|</span><a href="#41587332">prev</a><span>|</span><a href="#41586381">next</a><span>|</span><label class="collapse" for="c-41588521">[-]</label><label class="expand" for="c-41588521">[1 more]</label></div><br/><div class="children"><div class="content">I love this quote from the blog:<p>&gt; Why are we making chandeliers out of swords of Damocles?<p>Amazing description of proliferating footguns.</div><br/></div></div><div id="41586381" class="c"><input type="checkbox" id="c-41586381" checked=""/><div class="controls bullet"><span class="by">caust1c</span><span>|</span><a href="#41588521">prev</a><span>|</span><a href="#41586756">next</a><span>|</span><label class="collapse" for="c-41586381">[-]</label><label class="expand" for="c-41586381">[13 more]</label></div><br/><div class="children"><div class="content">I know very little about XML and SAML, but from what little I do know it shocks me that it&#x27;s still the de-facto standard for SSO.<p>Great analysis and thanks for sharing!</div><br/><div id="41586434" class="c"><input type="checkbox" id="c-41586434" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41586381">parent</a><span>|</span><a href="#41586756">next</a><span>|</span><label class="collapse" for="c-41586434">[-]</label><label class="expand" for="c-41586434">[12 more]</label></div><br/><div class="children"><div class="content">It should not be, and people should use OIDC in preference to it wherever they can.</div><br/><div id="41586778" class="c"><input type="checkbox" id="c-41586778" checked=""/><div class="controls bullet"><span class="by">Roguelazer</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586434">parent</a><span>|</span><a href="#41586756">next</a><span>|</span><label class="collapse" for="c-41586778">[-]</label><label class="expand" for="c-41586778">[11 more]</label></div><br/><div class="children"><div class="content">I&#x27;m optimistic SAML will be dead soon. ActiveDirectory&#x2F;EntraID&#x2F;whatever Microsoft wants to call it now supports OpenID Connect. Okta, OneLogin, Google, and all the other post-turn-of-the-millenium IdPs support OIDC. Shibboleth is the last major IdP I know if that is SAML-only, and I haven&#x27;t seen anyone using it in like 10  years. When I built enterprise SSO for my current company, we went OIDC-only and we haven&#x27;t had a single customer who needed SAML.</div><br/><div id="41587760" class="c"><input type="checkbox" id="c-41587760" checked=""/><div class="controls bullet"><span class="by">jrochkind1</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41587287">next</a><span>|</span><label class="collapse" for="c-41587760">[-]</label><label class="expand" for="c-41587760">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Shibboleth is the last major IdP I know if that is SAML-only, and I haven&#x27;t seen anyone using it in like 10 years<p>Most universities are still using Shibboleth. And probably will be forever. I think Shibboleth influenced SAML, probably to it&#x27;s detriment.</div><br/><div id="41588469" class="c"><input type="checkbox" id="c-41588469" checked=""/><div class="controls bullet"><span class="by">Griever</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41587760">parent</a><span>|</span><a href="#41587287">next</a><span>|</span><label class="collapse" for="c-41588469">[-]</label><label class="expand" for="c-41588469">[1 more]</label></div><br/><div class="children"><div class="content">Yup, thankfully most federate through InCommon so it’s less painful than it used to be, but that’s not saying much.</div><br/></div></div></div></div><div id="41587287" class="c"><input type="checkbox" id="c-41587287" checked=""/><div class="controls bullet"><span class="by">zdragnar</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41587760">prev</a><span>|</span><a href="#41589161">next</a><span>|</span><label class="collapse" for="c-41587287">[-]</label><label class="expand" for="c-41587287">[3 more]</label></div><br/><div class="children"><div class="content">Working in the health market, pretty much the only thing our customers support is SAML, and that&#x27;s only among customers who have anything at all that can integrate with us.</div><br/><div id="41587338" class="c"><input type="checkbox" id="c-41587338" checked=""/><div class="controls bullet"><span class="by">koito17</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41587287">parent</a><span>|</span><a href="#41589161">next</a><span>|</span><label class="collapse" for="c-41587338">[-]</label><label class="expand" for="c-41587338">[2 more]</label></div><br/><div class="children"><div class="content">Anecdotally, many American universities and academic journal sites still use Shibboleth. Thus, in the United States, SAML is far from dead, whether we like it or not.</div><br/><div id="41588835" class="c"><input type="checkbox" id="c-41588835" checked=""/><div class="controls bullet"><span class="by">GoblinSlayer</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41587338">parent</a><span>|</span><a href="#41589161">next</a><span>|</span><label class="collapse" for="c-41588835">[-]</label><label class="expand" for="c-41588835">[1 more]</label></div><br/><div class="children"><div class="content">Shibboleth supports CAS.</div><br/></div></div></div></div></div></div><div id="41589161" class="c"><input type="checkbox" id="c-41589161" checked=""/><div class="controls bullet"><span class="by">Johnnynator</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41587287">prev</a><span>|</span><a href="#41587678">next</a><span>|</span><label class="collapse" for="c-41589161">[-]</label><label class="expand" for="c-41589161">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Shibboleth is the last major IdP I know if that is SAML-only<p>Shibboleth has officially supported Plugins for OIDC for some time now.<p>As others said, Shiboleth is still rather pupular at Universities and higher Education, OIDC will have a hard time to set foot there without the OpenID Connect Federation Draft beeing finished and then Implemented by the different Metadata Federation that exist (most National Research Networks manage one)</div><br/></div></div><div id="41587678" class="c"><input type="checkbox" id="c-41587678" checked=""/><div class="controls bullet"><span class="by">hirsin</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41589161">prev</a><span>|</span><a href="#41588630">next</a><span>|</span><label class="collapse" for="c-41587678">[-]</label><label class="expand" for="c-41587678">[2 more]</label></div><br/><div class="children"><div class="content">Okta barely supports OIDC I&#x27;m afraid. We have to use SAML with them because they don&#x27;t support a reusable app model for OIDC (a &quot;marketplace app&quot; that multiple customers can use).<p>I&#x27;d love to add FastFed support for OIDC and be done with it but SAML still rules the world.</div><br/><div id="41587899" class="c"><input type="checkbox" id="c-41587899" checked=""/><div class="controls bullet"><span class="by">pquerna</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41587678">parent</a><span>|</span><a href="#41588630">next</a><span>|</span><label class="collapse" for="c-41587899">[-]</label><label class="expand" for="c-41587899">[1 more]</label></div><br/><div class="children"><div class="content">Our app &lt;<a href="https:&#x2F;&#x2F;www.okta.com&#x2F;integrations&#x2F;conductorone&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.okta.com&#x2F;integrations&#x2F;conductorone&#x2F;</a>&gt; is in the Okta OIN (&quot;marketplace&quot;) using OIDC?  So not sure what you mean by that?</div><br/></div></div></div></div><div id="41588630" class="c"><input type="checkbox" id="c-41588630" checked=""/><div class="controls bullet"><span class="by">riffraff</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41587678">prev</a><span>|</span><a href="#41587356">next</a><span>|</span><label class="collapse" for="c-41588630">[-]</label><label class="expand" for="c-41588630">[1 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t the shared identity login thingy (eIDAS) in the EU SAML based?</div><br/></div></div><div id="41587356" class="c"><input type="checkbox" id="c-41587356" checked=""/><div class="controls bullet"><span class="by">sk5t</span><span>|</span><a href="#41586381">root</a><span>|</span><a href="#41586778">parent</a><span>|</span><a href="#41588630">prev</a><span>|</span><a href="#41586756">next</a><span>|</span><label class="collapse" for="c-41587356">[-]</label><label class="expand" for="c-41587356">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;m optimistic SAML will be dead soon<p>Get used to disappointment.</div><br/></div></div></div></div></div></div></div></div><div id="41586756" class="c"><input type="checkbox" id="c-41586756" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#41586381">prev</a><span>|</span><a href="#41587357">next</a><span>|</span><label class="collapse" for="c-41586756">[-]</label><label class="expand" for="c-41586756">[10 more]</label></div><br/><div class="children"><div class="content">SAML has to be one of the worst security specs ever</div><br/><div id="41586890" class="c"><input type="checkbox" id="c-41586890" checked=""/><div class="controls bullet"><span class="by">hsbauauvhabzb</span><span>|</span><a href="#41586756">parent</a><span>|</span><a href="#41587357">next</a><span>|</span><label class="collapse" for="c-41586890">[-]</label><label class="expand" for="c-41586890">[9 more]</label></div><br/><div class="children"><div class="content">Why do you say that? I think it’s ugly, but it’s substantially simpler to understand than oidc. What parts of the spec (read: not just shitty implementations by developers) are bad?<p>I’m genuinely curious here, I’m not attempting to bait an argument.</div><br/><div id="41587946" class="c"><input type="checkbox" id="c-41587946" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41586890">parent</a><span>|</span><a href="#41587154">next</a><span>|</span><label class="collapse" for="c-41587946">[-]</label><label class="expand" for="c-41587946">[3 more]</label></div><br/><div class="children"><div class="content">Two things<p>Saml itself is sort of a kitchen sink. It includes everything you could possibly ever want, but nobody implements all of it so you need to figure out common subset, which defeats the point of a standard.<p>Second, XMLSignature sucks... like badly. Only part of the response is signed, but which part there is no standard on. It is way too complicated. Why have multiple overlapping signatures is crazy. Comments arent signed but change meaning of document. A billion signature types. Etc.</div><br/><div id="41589258" class="c"><input type="checkbox" id="c-41589258" checked=""/><div class="controls bullet"><span class="by">Freak_NL</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41587946">parent</a><span>|</span><a href="#41589662">next</a><span>|</span><label class="collapse" for="c-41589258">[-]</label><label class="expand" for="c-41589258">[1 more]</label></div><br/><div class="children"><div class="content">XML signatures in SAML suck so much they deserve to be your point one. For functionality at least it&#x27;s possible to just poke around and see what works with whatever party your connecting, but debugging broken signing? With XML signatures it is possible to have it all working with one provider (perhaps a Windows machine running ADFS) and then be unable to verify the signatures from another, <i>and you&#x27;ll never know where the fault lies</i>.<p>At least with modern stuff like JWT&#x27;s the ways to encrypt and sign are well-understood.</div><br/></div></div><div id="41589662" class="c"><input type="checkbox" id="c-41589662" checked=""/><div class="controls bullet"><span class="by">silon42</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41587946">parent</a><span>|</span><a href="#41589258">prev</a><span>|</span><a href="#41587154">next</a><span>|</span><label class="collapse" for="c-41589662">[-]</label><label class="expand" for="c-41589662">[1 more]</label></div><br/><div class="children"><div class="content">Personally I&#x27;ve found one of the few sane uses of XMLSignature is just to use only enveloped-signature, where the signature is then removed from message before processing... also it can be composed by nesting them (carefully).</div><br/></div></div></div></div><div id="41587154" class="c"><input type="checkbox" id="c-41587154" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41586890">parent</a><span>|</span><a href="#41587946">prev</a><span>|</span><a href="#41587944">next</a><span>|</span><label class="collapse" for="c-41587154">[-]</label><label class="expand" for="c-41587154">[1 more]</label></div><br/><div class="children"><div class="content">It is drastically harder to understand than OIDC, in large part due to XML signatures, which are a demented format, mostly for the reasons stated in this blog post (but also for some reasons it shares with JWT, and also for some sui generis reasons having to do with how complicated xmldsig is and how few implementations there are of it). You really couldn&#x27;t find a worse format to do cryptography with than XML.</div><br/></div></div><div id="41587944" class="c"><input type="checkbox" id="c-41587944" checked=""/><div class="controls bullet"><span class="by">unscaled</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41586890">parent</a><span>|</span><a href="#41587154">prev</a><span>|</span><a href="#41587720">next</a><span>|</span><label class="collapse" for="c-41587944">[-]</label><label class="expand" for="c-41587944">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not just shitty implementations here. The designers of SAML and XMLDSig cannot just blame the developers for implementing their &quot;perfect&quot; spec incorrectly.<p>The blog post above details exactly why XMLDSig can only be implemented securely, if you explicitly make an effort to <i>ignore</i> the spec. When following the specification leads to insecure implementations it&#x27;s the spec that&#x27;s shitty, and the spec authors should carry the blame.<p>The Open ID spec isn&#x27;t great either and has its own share of issues, but in most scenarios, it doesn&#x27;t rely on signature validation. If you only use the authorization code flow, breaking the ID token signature becomes ineffective, since the attacker still needs a valid authorization code from the IdP for this attack. If you restrict your implementation to what is allowed in OAuth 2.1 [1] or follow OAuth Best Practices [2], you can implement Open ID Connect pretty safely, as they eliminate the implicit grant and introduce PKCE.<p>I sure wish the OpenID foundation would cut all the unnecessary bloat in their spec(namely the ID Token, Implicit and Hybrid Flow and unnecessarily client-side token validation rules) and leave it as just a simple extension to OAuth 2.1 that specifies a few extra parameters and a User Info Endpoint. But if we have to leave with this over-engineered spec, I can still trust that implementations of OIDC would fail less horribly than SAML.<p>[1] <a href="https:&#x2F;&#x2F;oauth.net&#x2F;2.1&#x2F;" rel="nofollow">https:&#x2F;&#x2F;oauth.net&#x2F;2.1&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;oauth.net&#x2F;2&#x2F;oauth-best-practice&#x2F;" rel="nofollow">https:&#x2F;&#x2F;oauth.net&#x2F;2&#x2F;oauth-best-practice&#x2F;</a></div><br/><div id="41588481" class="c"><input type="checkbox" id="c-41588481" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41587944">parent</a><span>|</span><a href="#41587720">next</a><span>|</span><label class="collapse" for="c-41588481">[-]</label><label class="expand" for="c-41588481">[2 more]</label></div><br/><div class="children"><div class="content">&gt; It&#x27;s not just shitty implementations here<p>I agree 100% the spec is shitty, but on top of it,some of the implementations are really weird beyond the spec. there was a prominent c library for it that (last i checked) in the default config added a custom hmac signature version where the hmac key is embedded in the attacker control document, and also hooked into the the system web pki, so if the provided key doesnt match, it will test if the doc was signed by a tls key from any website in the world.</div><br/><div id="41589387" class="c"><input type="checkbox" id="c-41589387" checked=""/><div class="controls bullet"><span class="by">tux3</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41588481">parent</a><span>|</span><a href="#41587720">next</a><span>|</span><label class="collapse" for="c-41589387">[-]</label><label class="expand" for="c-41589387">[1 more]</label></div><br/><div class="children"><div class="content">Outstanding. That&#x27;s just lovely.</div><br/></div></div></div></div></div></div><div id="41587720" class="c"><input type="checkbox" id="c-41587720" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#41586756">root</a><span>|</span><a href="#41586890">parent</a><span>|</span><a href="#41587944">prev</a><span>|</span><a href="#41587357">next</a><span>|</span><label class="collapse" for="c-41587720">[-]</label><label class="expand" for="c-41587720">[1 more]</label></div><br/><div class="children"><div class="content">It’s also a nested meta protocol with an extensible markup language (XML) used to express extensible fields but using SAML encoding for them instead of just XML. It’s the inner-platform effect, which is common in over engineered monstrosities like SAML.</div><br/></div></div></div></div></div></div><div id="41587357" class="c"><input type="checkbox" id="c-41587357" checked=""/><div class="controls bullet"><span class="by">zb3</span><span>|</span><a href="#41586756">prev</a><span>|</span><a href="#41587486">next</a><span>|</span><label class="collapse" for="c-41587357">[-]</label><label class="expand" for="c-41587357">[4 more]</label></div><br/><div class="children"><div class="content">Unfortunately XML signatures are also widely used in Polish government APIs which citizens&#x2F;companies are required to use :(</div><br/><div id="41587591" class="c"><input type="checkbox" id="c-41587591" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#41587357">parent</a><span>|</span><a href="#41587563">next</a><span>|</span><label class="collapse" for="c-41587591">[-]</label><label class="expand" for="c-41587591">[1 more]</label></div><br/><div class="children"><div class="content">Same here in Kazakhstan. And we also use our home-made crypto algorithms (derived from USSR GOST), which are not present in popular open source libraries.</div><br/></div></div><div id="41587563" class="c"><input type="checkbox" id="c-41587563" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#41587357">parent</a><span>|</span><a href="#41587591">prev</a><span>|</span><a href="#41588823">next</a><span>|</span><label class="collapse" for="c-41587563">[-]</label><label class="expand" for="c-41587563">[1 more]</label></div><br/><div class="children"><div class="content">Same in Sweden and Denmark, several gov&#x27;t systems requiring signed XMLs. And before you think legacy systems, no, these are the new systems, with rollout starting a few years ago and still ongoing.</div><br/></div></div><div id="41588823" class="c"><input type="checkbox" id="c-41588823" checked=""/><div class="controls bullet"><span class="by">jpnc</span><span>|</span><a href="#41587357">parent</a><span>|</span><a href="#41587563">prev</a><span>|</span><a href="#41587486">next</a><span>|</span><label class="collapse" for="c-41588823">[-]</label><label class="expand" for="c-41588823">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s essentially true for all of EU. If you&#x27;ve ever done integration with EU central services you know what I&#x27;m talking about.</div><br/></div></div></div></div><div id="41587486" class="c"><input type="checkbox" id="c-41587486" checked=""/><div class="controls bullet"><span class="by">dudeinjapan</span><span>|</span><a href="#41587357">prev</a><span>|</span><a href="#41586887">next</a><span>|</span><label class="collapse" for="c-41587486">[-]</label><label class="expand" for="c-41587486">[2 more]</label></div><br/><div class="children"><div class="content">Recent RubySaml contributor here. The problem in this issue is not only RubySaml, but actually much older code in a module called XmlSecurity.<p>Some major problems with SAML are 1) the user’s browser acts as a MITM between the SP and IdP on all requests (vector for this attack), and 2) it requires the IdP and SP to maintain their own certs, which is fine in theory, but humans at big corps are lazy, and the complexity causes people to be lax on security.</div><br/><div id="41587995" class="c"><input type="checkbox" id="c-41587995" checked=""/><div class="controls bullet"><span class="by">SigmundA</span><span>|</span><a href="#41587486">parent</a><span>|</span><a href="#41586887">next</a><span>|</span><label class="collapse" for="c-41587995">[-]</label><label class="expand" for="c-41587995">[1 more]</label></div><br/><div class="children"><div class="content">&gt;1) the user’s browser acts as a MITM between the SP and IdP on all requests (vector for this attack)<p>This is exactly how OIDC implicit flow works. The basic difference is using JWT instead of signed XML otherwise it&#x27;s nearly identical, I mean public&#x2F;private key signing is the basis for JWT and XML sig.<p>SAML also supports artifact binding which would use a back channel similar to other ODIC flows, but I haven&#x27;t seen it used much because its make things more complicated and requires the SP to be able to communicate with the IdP.</div><br/></div></div></div></div><div id="41586887" class="c"><input type="checkbox" id="c-41586887" checked=""/><div class="controls bullet"><span class="by">SigmundA</span><span>|</span><a href="#41587486">prev</a><span>|</span><label class="collapse" for="c-41586887">[-]</label><label class="expand" for="c-41586887">[4 more]</label></div><br/><div class="children"><div class="content">Microsoft&#x27;s SignedXml implementation in the .Net framework fixed this 8 years ago so long as you are correctly using the GetIdElement which makes sure there are no duplicates.<p><a href="https:&#x2F;&#x2F;coding.abel.nu&#x2F;2016&#x2F;03&#x2F;vulnerability-in-net-signedxml&#x2F;" rel="nofollow">https:&#x2F;&#x2F;coding.abel.nu&#x2F;2016&#x2F;03&#x2F;vulnerability-in-net-signedxm...</a></div><br/><div id="41589654" class="c"><input type="checkbox" id="c-41589654" checked=""/><div class="controls bullet"><span class="by">silon42</span><span>|</span><a href="#41586887">parent</a><span>|</span><a href="#41587328">next</a><span>|</span><label class="collapse" for="c-41589654">[-]</label><label class="expand" for="c-41589654">[1 more]</label></div><br/><div class="children"><div class="content">And they &quot;forgot&quot; to tell people that if doing this properly, they need to use a schema&#x2F;DTD where Id is defined as ID and then guaranteed unique by XML parser.<p>I&#x27;ve seen invalid schemas&#x2F;signatures where Id was just defined as string in the schema (fails when verifying using libxml&#x2F;xmlsec for example)</div><br/></div></div><div id="41587328" class="c"><input type="checkbox" id="c-41587328" checked=""/><div class="controls bullet"><span class="by">jrpelkonen</span><span>|</span><a href="#41586887">parent</a><span>|</span><a href="#41589654">prev</a><span>|</span><label class="collapse" for="c-41587328">[-]</label><label class="expand" for="c-41587328">[2 more]</label></div><br/><div class="children"><div class="content">I know next to nothing about .net, but this seems like the classic “you’re holding it wrong” excuse to me. If there’s a way to call an api the wrong way and the right way, and both appear to work, large number of developers will implement the insecure api. Why can’t the incorrect api be removed? I understand there’s pressure to support old client code but vulnerabilities should trump backwards compatibility.</div><br/><div id="41587513" class="c"><input type="checkbox" id="c-41587513" checked=""/><div class="controls bullet"><span class="by">SigmundA</span><span>|</span><a href="#41586887">root</a><span>|</span><a href="#41587328">parent</a><span>|</span><label class="collapse" for="c-41587513">[-]</label><label class="expand" for="c-41587513">[1 more]</label></div><br/><div class="children"><div class="content">The incorrect api would be using GetXml and looking at the raw XmlElement and using select nodes or something vs using the GetIdElement on the SignedXML object itself, its not going to prevent you from looking at the xml document directly and do something incorrect but it gives you a correct helper method right next to CheckSignature to do the right thing.<p>I mean at some point you do have to understand the difference between xml and a specific schema of it and how its used in SAML, its not like xml elements are required to have a unique id attribute.<p>This isn&#x27;t something you would call directly anyway unless you were writing your own SAML client, which isn&#x27;t that hard but there are existing ones, here is a simple one that works well:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;jitbit&#x2F;AspNetSaml">https:&#x2F;&#x2F;github.com&#x2F;jitbit&#x2F;AspNetSaml</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>