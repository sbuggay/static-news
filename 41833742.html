<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1728896464040" as="style"/><link rel="stylesheet" href="styles.css?v=1728896464040"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.cppstories.com/2018/12/fromchars/">C++ String Conversion: Exploring std:from_chars in C++17 to C++26</a> <span class="domain">(<a href="https://www.cppstories.com">www.cppstories.com</a>)</span></div><div class="subtext"><span>jandeboevrie</span> | <span>15 comments</span></div><br/><div><div id="41835024" class="c"><input type="checkbox" id="c-41835024" checked=""/><div class="controls bullet"><span class="by">dgrunwald</span><span>|</span><a href="#41835189">next</a><span>|</span><label class="collapse" for="c-41835024">[-]</label><label class="expand" for="c-41835024">[1 more]</label></div><br/><div class="children"><div class="content">Caution with these functions: in most cases you need to check not only the error code, but also the `ptr` in the result.
Otherwise you end up with `to_int(&quot;0x1234&quot;) == 0` instead of the expected `std::nullopt`, because these functions return success if they matched a number at the beginning of the string.</div><br/></div></div><div id="41835189" class="c"><input type="checkbox" id="c-41835189" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41835024">prev</a><span>|</span><a href="#41835176">next</a><span>|</span><label class="collapse" for="c-41835189">[-]</label><label class="expand" for="c-41835189">[4 more]</label></div><br/><div class="children"><div class="content"><i>Wasn’t the old stuff good enough? Why do we need new methods? In short: because from_chars is low-level, and offers the best possible performance.</i><p>That sounds like marketing BS, especially when most likely these functions just call into or are implemented nearly identically to the old C functions which are already going to &quot;offers the best possible performance&quot;.<p><i>I did some benchmarks, and the new routines are blazing fast![...]around 4.5x faster than stoi, 2.2x faster than atoi and almost 50x faster than istringstream</i><p>Are you sure that wasn&#x27;t because the compiler decided to optimise away the function directly? I can believe it being faster than istringstream, since that has a ton of additional overhead.<p>After all, the source is here if you want to look into the horse&#x27;s mouth:<p><a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;gcc-mirror&#x2F;gcc&#x2F;master&#x2F;libstdc%2B%2B-v3&#x2F;include&#x2F;std&#x2F;charconv" rel="nofollow">https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;gcc-mirror&#x2F;gcc&#x2F;master&#x2F;libs...</a><p>Not surprisingly, under all those layers of abstraction-hell, there&#x27;s just a regular accumulation loop.</div><br/><div id="41835327" class="c"><input type="checkbox" id="c-41835327" checked=""/><div class="controls bullet"><span class="by">OvbiousError</span><span>|</span><a href="#41835189">parent</a><span>|</span><a href="#41835571">next</a><span>|</span><label class="collapse" for="c-41835327">[-]</label><label class="expand" for="c-41835327">[1 more]</label></div><br/><div class="children"><div class="content">I agree with some of this, and the author could&#x27;ve made a better case for from&#x2F;to_chars:<p>- Afaik stoi and friends depend on the locale, so it&#x27;s not hard to believe this introduced additional overhead. The implicit locale dependency is also often very surprising.<p>- std::stoi only accepts std::string as input, so you&#x27;re forced to allocate a string to use it. std::from_chars does not.<p>- from&#x2F;to_chars don&#x27;t throw. As far as I know this won&#x27;t affect performance if it doesn&#x27;t happen, it does mean you can use these functions in environments where exceptions are disabled.</div><br/></div></div><div id="41835571" class="c"><input type="checkbox" id="c-41835571" checked=""/><div class="controls bullet"><span class="by">blux</span><span>|</span><a href="#41835189">parent</a><span>|</span><a href="#41835327">prev</a><span>|</span><a href="#41835321">next</a><span>|</span><label class="collapse" for="c-41835571">[-]</label><label class="expand" for="c-41835571">[1 more]</label></div><br/><div class="children"><div class="content">Did you verify their claims or are you just calling BS and that&#x27;s it? The new functions are in fact much faster than their C equivalent (and yes, I <i>did</i> verify that).</div><br/></div></div><div id="41835321" class="c"><input type="checkbox" id="c-41835321" checked=""/><div class="controls bullet"><span class="by">j16sdiz</span><span>|</span><a href="#41835189">parent</a><span>|</span><a href="#41835571">prev</a><span>|</span><a href="#41835176">next</a><span>|</span><label class="collapse" for="c-41835321">[-]</label><label class="expand" for="c-41835321">[1 more]</label></div><br/><div class="children"><div class="content">Enabling new static optimization is  a good,  no?</div><br/></div></div></div></div><div id="41835176" class="c"><input type="checkbox" id="c-41835176" checked=""/><div class="controls bullet"><span class="by">cherryteastain</span><span>|</span><a href="#41835189">prev</a><span>|</span><a href="#41835203">next</a><span>|</span><label class="collapse" for="c-41835176">[-]</label><label class="expand" for="c-41835176">[3 more]</label></div><br/><div class="children"><div class="content">Wish they returned std::expected&lt;T, std::errc&gt; instead of the weird from_chars_result struct</div><br/><div id="41835569" class="c"><input type="checkbox" id="c-41835569" checked=""/><div class="controls bullet"><span class="by">eMSF</span><span>|</span><a href="#41835176">parent</a><span>|</span><a href="#41835409">next</a><span>|</span><label class="collapse" for="c-41835569">[-]</label><label class="expand" for="c-41835569">[1 more]</label></div><br/><div class="children"><div class="content">from_chars_result closely matches the strtol line of functions we&#x27;ve had for decades. Not returning the end position would be weird here!</div><br/></div></div><div id="41835409" class="c"><input type="checkbox" id="c-41835409" checked=""/><div class="controls bullet"><span class="by">Longhanks</span><span>|</span><a href="#41835176">parent</a><span>|</span><a href="#41835569">prev</a><span>|</span><a href="#41835203">next</a><span>|</span><label class="collapse" for="c-41835409">[-]</label><label class="expand" for="c-41835409">[1 more]</label></div><br/><div class="children"><div class="content">std::expected is new in C++23, std::from_chars was introduces in C++17. Obviously, 2023 features were not available in 2017. Changing the return type now would break everybody&#x27;s code, with very little benefit, you can easily wrap std::from_chars.</div><br/></div></div></div></div><div id="41835203" class="c"><input type="checkbox" id="c-41835203" checked=""/><div class="controls bullet"><span class="by">captainmuon</span><span>|</span><a href="#41835176">prev</a><span>|</span><a href="#41834671">next</a><span>|</span><label class="collapse" for="c-41835203">[-]</label><label class="expand" for="c-41835203">[1 more]</label></div><br/><div class="children"><div class="content">I wonder why it is called `from_chars` and not `to_number` or similar. It&#x27;s obvious what you are converting from, because you have to write down the argument `from_chars(someString)`, but you don&#x27;t see what is coming out.</div><br/></div></div><div id="41834671" class="c"><input type="checkbox" id="c-41834671" checked=""/><div class="controls bullet"><span class="by">lynx23</span><span>|</span><a href="#41835203">prev</a><span>|</span><a href="#41835137">next</a><span>|</span><label class="collapse" for="c-41834671">[-]</label><label class="expand" for="c-41834671">[3 more]</label></div><br/><div class="children"><div class="content">Whoever introduced the rule to automatically delete :: in titles on a hacker site should be made to rethink their decisions.  Its a silly rule.  It should go.</div><br/><div id="41834735" class="c"><input type="checkbox" id="c-41834735" checked=""/><div class="controls bullet"><span class="by">MathMonkeyMan</span><span>|</span><a href="#41834671">parent</a><span>|</span><a href="#41835137">next</a><span>|</span><label class="collapse" for="c-41834735">[-]</label><label class="expand" for="c-41834735">[2 more]</label></div><br/><div class="children"><div class="content">It would be an interesting piece to learn why.<p>Maybe it was for ::reasons::.</div><br/><div id="41834937" class="c"><input type="checkbox" id="c-41834937" checked=""/><div class="controls bullet"><span class="by">lynx23</span><span>|</span><a href="#41834671">root</a><span>|</span><a href="#41834735">parent</a><span>|</span><a href="#41835137">next</a><span>|</span><label class="collapse" for="c-41834937">[-]</label><label class="expand" for="c-41834937">[1 more]</label></div><br/><div class="children"><div class="content">I am sure the intern who wrote a rule for the Apple VoiceOver speech synthesizer to special case the number 18 being pronounced english while the synth voice is set to german imagined to have a good reason at the time as well.  However, that desn&#x27;t make ther decision less stupid.  &quot;Vierzehn Uhr&quot;, &quot;Fünfzehn Uhr&quot;, &quot;Sechzehn Uhr&quot;, &quot;Siebzehn Uhr&quot;, &quot;Eighteen Uhr&quot;.</div><br/></div></div></div></div></div></div><div id="41835137" class="c"><input type="checkbox" id="c-41835137" checked=""/><div class="controls bullet"><span class="by">einpoklum</span><span>|</span><a href="#41834671">prev</a><span>|</span><label class="collapse" for="c-41835137">[-]</label><label class="expand" for="c-41835137">[2 more]</label></div><br/><div class="children"><div class="content">Note that this won&#x27;t work (AFAICT) with Unicode strings and non-western-arabic digits, e.g.:<p><pre><code>    std::u8string_view chars{ u8&quot;۱۲۳٤&quot; };
    int value;
    enum { digit_base = 10 };
    auto [ptr, ec] = std::from_chars(
       chars.data(), chars.data() + chars.size(), value, digit_base);
    return (ec == std::errc{}) ? value : -1;
</code></pre>
will fail to compile due to pointer incompatibility.</div><br/><div id="41835191" class="c"><input type="checkbox" id="c-41835191" checked=""/><div class="controls bullet"><span class="by">cout</span><span>|</span><a href="#41835137">parent</a><span>|</span><label class="collapse" for="c-41835191">[-]</label><label class="expand" for="c-41835191">[1 more]</label></div><br/><div class="children"><div class="content">What would you suggest instead?</div><br/></div></div></div></div></div></div></div></div></div></body></html>