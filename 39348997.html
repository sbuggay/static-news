<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707814871947" as="style"/><link rel="stylesheet" href="styles.css?v=1707814871947"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://stefano-garzarella.github.io/posts/2024-02-12-vdpa-blk/">vDPA: Support for block devices in Linux and QEMU</a> <span class="domain">(<a href="https://stefano-garzarella.github.io">stefano-garzarella.github.io</a>)</span></div><div class="subtext"><span>ingve</span> | <span>15 comments</span></div><br/><div><div id="39355644" class="c"><input type="checkbox" id="c-39355644" checked=""/><div class="controls bullet"><span class="by">jm1337</span><span>|</span><a href="#39350798">next</a><span>|</span><label class="collapse" for="c-39355644">[-]</label><label class="expand" for="c-39355644">[1 more]</label></div><br/><div class="children"><div class="content">RH has a blog series which motivates and introduces vDPA.<p>For a start, read their post on virtio-networking and vhost-net [0], continue with virtio-networking and DPDK [1] and finally read &quot;Achieving network wirespeed in an open standard manner: introducing vDPA&quot; [2].<p>In particular the last link has a lot of diagrams, recaps a lot of the virtio-networking topics and finally has a table which compares the other solutions to vDPA.<p>[0] <a href="https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;introduction-virtio-networking-and-vhost-net" rel="nofollow">https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;introduction-virtio-networkin...</a>
[1] <a href="https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;how-vhost-user-came-being-virtio-networking-and-dpdk" rel="nofollow">https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;how-vhost-user-came-being-vir...</a>
[2] <a href="https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;achieving-network-wirespeed-open-standard-manner-introducing-vdpa" rel="nofollow">https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;blog&#x2F;achieving-network-wirespeed-o...</a></div><br/></div></div><div id="39350798" class="c"><input type="checkbox" id="c-39350798" checked=""/><div class="controls bullet"><span class="by">gonzaloalvarez</span><span>|</span><a href="#39355644">prev</a><span>|</span><a href="#39355565">next</a><span>|</span><label class="collapse" for="c-39350798">[-]</label><label class="expand" for="c-39350798">[4 more]</label></div><br/><div class="children"><div class="content">&gt; One of the significant benefits of vDPA is its strong abstraction, enabling the implementation of virtio devices in both hardware and software—whether in the kernel or user space. This unification under a single framework, where devices appear identical for QEMU facilitates the seamless integration of hardware and software components.<p>I honestly don’t know what this means. Is it faster? Is it more secure? Why would I use this vDPA thing instead of the good’ol virtio blk driver? Looking at the examples it certainly looks more cumbersome to setup…</div><br/><div id="39352103" class="c"><input type="checkbox" id="c-39352103" checked=""/><div class="controls bullet"><span class="by">benlwalker</span><span>|</span><a href="#39350798">parent</a><span>|</span><a href="#39350974">next</a><span>|</span><label class="collapse" for="c-39352103">[-]</label><label class="expand" for="c-39352103">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t get it either, and I&#x27;m a maintainer of SPDK which provides multiple implementations of virtualized devices and is frequently used inside DPUs to present storage devices.<p>If I&#x27;m implementing a hardware device anyway, why would I not just use NVMe as the interface? NVMe is superior to virtio-blk in every way that I can think of.<p>Even for a software device in userspace, why not use a technology like vfio-user to present an NVMe device, or just use vhost-user to present the virtio-blk device?<p>I&#x27;ve never really been able to get a clear value proposition for vDPA for storage laid out for me. Maybe I&#x27;m missing something critical - it&#x27;s certainly possible.</div><br/></div></div><div id="39350974" class="c"><input type="checkbox" id="c-39350974" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#39350798">parent</a><span>|</span><a href="#39352103">prev</a><span>|</span><a href="#39352462">next</a><span>|</span><label class="collapse" for="c-39350974">[-]</label><label class="expand" for="c-39350974">[1 more]</label></div><br/><div class="children"><div class="content">Software block devices let you do all implement all sorts of disk-like things in userspace.  nbdkit is a more flexible version of this (also compatible with qemu), so to get a flavour of the types of things you can do just peruse the list of nbdkit plugins: <a href="https:&#x2F;&#x2F;libguestfs.org&#x2F;nbdkit.1.html#Plugins" rel="nofollow">https:&#x2F;&#x2F;libguestfs.org&#x2F;nbdkit.1.html#Plugins</a></div><br/></div></div><div id="39352462" class="c"><input type="checkbox" id="c-39352462" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#39350798">parent</a><span>|</span><a href="#39350974">prev</a><span>|</span><a href="#39355565">next</a><span>|</span><label class="collapse" for="c-39352462">[-]</label><label class="expand" for="c-39352462">[1 more]</label></div><br/><div class="children"><div class="content">Ceph Block Device 3rd Party Integrations: <a href="https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;rbd&#x2F;rbd-integrations&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;rbd&#x2F;rbd-integrations&#x2F;</a> : 
<i>Kernel Modules, QEMU, libvirt, Kubernetes, Nomad, OpenStack, CloudStack, LIO iSCSI Gateway, Windows,</i> qemu: <a href="https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;rbd&#x2F;qemu-rbd&#x2F;#qemu-and-block-devices" rel="nofollow">https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;rbd&#x2F;qemu-rbd&#x2F;#qemu-and-block...</a><p>`cephadm bootstrap` requires docker or podman and ssh: 
<a href="https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;cephadm&#x2F;install&#x2F;#bootstrap-a-new-cluster" rel="nofollow">https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;cephadm&#x2F;install&#x2F;#bootstrap-a...</a><p>Ceph Object Gateway: radosgw: <a href="https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;radosgw&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.ceph.com&#x2F;en&#x2F;latest&#x2F;radosgw&#x2F;</a> :<p>&gt; <i>The Ceph Object Gateway provides interfaces that are compatible with both Amazon S3 and OpenStack Swift, and it has its own user management. Ceph Object Gateway can use a single Ceph Storage cluster to store data from Ceph File System and from Ceph Block device clients. The S3 API and the Swift API share a common namespace, which means that it is possible to write data to a Ceph Storage Cluster with one API and then retrieve that data with the other API.</i><p>virtio-blk is probably faster, but then do HA redundancy with physically separate nodes and network io anyway; or LocalPersistentVolumes</div><br/></div></div></div></div><div id="39355565" class="c"><input type="checkbox" id="c-39355565" checked=""/><div class="controls bullet"><span class="by">transpute</span><span>|</span><a href="#39350798">prev</a><span>|</span><a href="#39351096">next</a><span>|</span><label class="collapse" for="c-39355565">[-]</label><label class="expand" for="c-39355565">[1 more]</label></div><br/><div class="children"><div class="content">Is vDPA a standardization of the storage interfaces used by AWS Nitro?<p><a href="https:&#x2F;&#x2F;www.allthingsdistributed.com&#x2F;2020&#x2F;09&#x2F;reinventing-virtualization-with-nitro.html" rel="nofollow">https:&#x2F;&#x2F;www.allthingsdistributed.com&#x2F;2020&#x2F;09&#x2F;reinventing-vir...</a><p><i>&gt; The Nitro System is comprised of three main parts: the Nitro Cards, the Nitro Security Chip, and the Nitro Hypervisor. The Nitro Cards are a family of cards that offloads and accelerates IO for functions ... The Nitro architecture also enabled us to make the hypervisor layer optional and offer bare metal instances. Bare metal instances provide applications with direct access to the processor and memory resources of the underlying server.</i></div><br/></div></div><div id="39351096" class="c"><input type="checkbox" id="c-39351096" checked=""/><div class="controls bullet"><span class="by">roomey</span><span>|</span><a href="#39355565">prev</a><span>|</span><a href="#39353480">next</a><span>|</span><label class="collapse" for="c-39351096">[-]</label><label class="expand" for="c-39351096">[7 more]</label></div><br/><div class="children"><div class="content">Good timing considering the esxi news <a href="https:&#x2F;&#x2F;kb.vmware.com&#x2F;s&#x2F;article&#x2F;2107518?lang=en_US" rel="nofollow">https:&#x2F;&#x2F;kb.vmware.com&#x2F;s&#x2F;article&#x2F;2107518?lang=en_US</a></div><br/><div id="39355417" class="c"><input type="checkbox" id="c-39355417" checked=""/><div class="controls bullet"><span class="by">m463</span><span>|</span><a href="#39351096">parent</a><span>|</span><a href="#39353449">next</a><span>|</span><label class="collapse" for="c-39355417">[-]</label><label class="expand" for="c-39355417">[1 more]</label></div><br/><div class="children"><div class="content">I think they will give up mindshare.<p>I use proxmox, which is hard to use but open.  It is powerful, but you sort of have to be a sysadmin to climb the learning curve with it.<p>But I have lots of friends who are busy at home, but use vmware there.  To them it is the same sort of &quot;free&quot; as proxmox.<p>They create an abstract model of vmware in their heads.<p>And when they&#x27;re at work, they think of virtualization kinds of problems in terms of vmware.  So at work, that&#x27;s the tool they frequently reach for.</div><br/></div></div><div id="39353449" class="c"><input type="checkbox" id="c-39353449" checked=""/><div class="controls bullet"><span class="by">stephen_g</span><span>|</span><a href="#39351096">parent</a><span>|</span><a href="#39355417">prev</a><span>|</span><a href="#39351387">next</a><span>|</span><label class="collapse" for="c-39353449">[-]</label><label class="expand" for="c-39353449">[2 more]</label></div><br/><div class="children"><div class="content">Wow, I knew things were getting really bad with VMWare, but I didn’t know they had got <i>that</i> bad… I liked ESXi, the free hypervisor was a good stepping stone to get people into the ecosystem and probably sold a lot of vSphere and vCenter licences down the line.<p>Very glad I decided to use Proxmox (as the Broadcom acquisition had been announced) for the small cluster we set up at our business a year ago, it’s been super stable, pretty easy to use but can do way more than I need (we’re not doing much that is that complicated yet)</div><br/><div id="39354995" class="c"><input type="checkbox" id="c-39354995" checked=""/><div class="controls bullet"><span class="by">bbarnett</span><span>|</span><a href="#39351096">root</a><span>|</span><a href="#39353449">parent</a><span>|</span><a href="#39351387">next</a><span>|</span><label class="collapse" for="c-39354995">[-]</label><label class="expand" for="c-39354995">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m really worried who is going to handle network and raid going forward.<p>LSI was the standard for hardware raid, 3com and others big network names.  Now they are Broadcom, which basically means:<p>* do as little as possible<p>* axe most support<p>* screw the little guy<p>* milk milk milk<p>* no real heavy R&amp;D<p>This means, to me, that lots of hardware and software is being handled far less diligently than Boeing.<p>And that scares me.</div><br/></div></div></div></div><div id="39351387" class="c"><input type="checkbox" id="c-39351387" checked=""/><div class="controls bullet"><span class="by">bpye</span><span>|</span><a href="#39351096">parent</a><span>|</span><a href="#39353449">prev</a><span>|</span><a href="#39353009">next</a><span>|</span><label class="collapse" for="c-39351387">[-]</label><label class="expand" for="c-39351387">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Along with the termination of perpetual licensing, Broadcom has also decided to discontinue the Free ESXi Hypervisor, marking it as EOGA (End of General Availability).<p>So it’s subscription or bust? Owch.</div><br/></div></div><div id="39353009" class="c"><input type="checkbox" id="c-39353009" checked=""/><div class="controls bullet"><span class="by">floating-io</span><span>|</span><a href="#39351096">parent</a><span>|</span><a href="#39351387">prev</a><span>|</span><a href="#39351327">next</a><span>|</span><label class="collapse" for="c-39353009">[-]</label><label class="expand" for="c-39353009">[1 more]</label></div><br/><div class="children"><div class="content">I really wonder how much longer the VMUG licensing is going to be around...</div><br/></div></div><div id="39351327" class="c"><input type="checkbox" id="c-39351327" checked=""/><div class="controls bullet"><span class="by">swozey</span><span>|</span><a href="#39351096">parent</a><span>|</span><a href="#39353009">prev</a><span>|</span><a href="#39353480">next</a><span>|</span><label class="collapse" for="c-39351327">[-]</label><label class="expand" for="c-39351327">[1 more]</label></div><br/><div class="children"><div class="content">No more free at all? I learned virtualization w&#x2F; vmware gsx long before I ever had a company to use it at.. Oh well, vmwares irrelevant to me nowadays.</div><br/></div></div></div></div></div></div></div></div></div></body></html>