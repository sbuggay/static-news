<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1721034065349" as="style"/><link rel="stylesheet" href="styles.css?v=1721034065349"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.notion.so/de-de/blog/building-and-scaling-notions-data-lake">Building and scaling Notion&#x27;s data lake</a> <span class="domain">(<a href="https://www.notion.so">www.notion.so</a>)</span></div><div class="subtext"><span>alexzeitler</span> | <span>75 comments</span></div><br/><div><div id="40964695" class="c"><input type="checkbox" id="c-40964695" checked=""/><div class="controls bullet"><span class="by">crux</span><span>|</span><a href="#40966080">next</a><span>|</span><label class="collapse" for="c-40964695">[-]</label><label class="expand" for="c-40964695">[2 more]</label></div><br/><div class="children"><div class="content">Hi all—I&#x27;m the EM for the Search team at Notion, and I want to chime in to clear up one unfortunate misconception I&#x27;ve seen a few times in this thread.<p>Notion does not sell its users&#x27; data.<p>Instead, I want to expand on one of the first use-cases for the Notion data lake, which was by my team. This is an elaboration of the description in TFA under the heading &quot;Use case support&quot;.<p>As is described there, Notion&#x27;s block permissions are highly normalized at the source of truth. This is usually quite efficient and generally brings along all the benefits of normalization in application databases. However, we need to _denormalize_ all the permissions that relate to a specific document when we index it into our search index.<p>When we transactionally reindex a document &quot;online&quot;, this is no problem. However, when we need to reindex an entire search cluster from scratch, loading every ancestor of each page in order to collect all of its permissions is far too expensive.<p>Thus, one of the primary needs that my team had from the new data lake is &quot;tree traversal and permission data construction for each block&quot;. We rewrote our &quot;offline&quot; reindexer to read from the data lake instead of reading from RDS instances serving database snapshots. This allowed us to dramatically reduce the impact of iterating through every page when spinning up a new cluster (not to mention save a boatload in spinning up those ad-hoc RDS instances).<p>I hope this miniature deep dive gives a little bit more color on the uses of this data store—as it is emphatically _not_ to sell our users&#x27; data!</div><br/><div id="40965450" class="c"><input type="checkbox" id="c-40965450" checked=""/><div class="controls bullet"><span class="by">jzelinskie</span><span>|</span><a href="#40964695">parent</a><span>|</span><a href="#40966080">next</a><span>|</span><label class="collapse" for="c-40965450">[-]</label><label class="expand" for="c-40965450">[1 more]</label></div><br/><div class="children"><div class="content">This is a fantastic post that explains a lot of the end product, but I&#x27;d love to hear more about the journey specifically on denormalizing permissions at Notion. Scaling out authorization logic like this is actually very under-documented in industry. Mind if I email you to chat?<p>Full disclosure: I&#x27;m a founder of authzed (W21), the company building SpiceDB, an open source project inspired by Google&#x27;s internal scalable authorization system. We offer a product that streams changes to fully denormalized permissions for search engines to consume, but I&#x27;m not trying to pitch; you just don&#x27;t often hear about other solutions built in this space!</div><br/></div></div></div></div><div id="40966080" class="c"><input type="checkbox" id="c-40966080" checked=""/><div class="controls bullet"><span class="by">HermitX</span><span>|</span><a href="#40964695">prev</a><span>|</span><a href="#40960991">next</a><span>|</span><label class="collapse" for="c-40966080">[-]</label><label class="expand" for="c-40966080">[1 more]</label></div><br/><div class="children"><div class="content">Great article, thank you for sharing! I have a question I’d like to discuss with the author. Spark SQL is a great product and works perfectly for batch processing tasks. However, for handling ad hoc query tasks or more interactive data analysis tasks, Spark SQL might have some performance issues. If you have such workloads, I suggest trying data lake query engines like Trino or StarRocks, which offer faster speeds and a better query experience.</div><br/></div></div><div id="40960991" class="c"><input type="checkbox" id="c-40960991" checked=""/><div class="controls bullet"><span class="by">SOLAR_FIELDS</span><span>|</span><a href="#40966080">prev</a><span>|</span><a href="#40964769">next</a><span>|</span><label class="collapse" for="c-40960991">[-]</label><label class="expand" for="c-40960991">[15 more]</label></div><br/><div class="children"><div class="content">They didn’t say the quiet part out loud, which is almost certainly that the Fivetran and Snowflake bills for what they were doing were probably enormous and those were undoubtedly what got management’s attention about fixing this.</div><br/><div id="40961531" class="c"><input type="checkbox" id="c-40961531" checked=""/><div class="controls bullet"><span class="by">rorymalcolm</span><span>|</span><a href="#40960991">parent</a><span>|</span><a href="#40962465">next</a><span>|</span><label class="collapse" for="c-40961531">[-]</label><label class="expand" for="c-40961531">[2 more]</label></div><br/><div class="children"><div class="content">Found this comment (from Fivetran&#x27;s CEO, so, with that in mind) regarding this article enlightening regarding the costs they were facing here <a href="https:&#x2F;&#x2F;twitter.com&#x2F;frasergeorgew&#x2F;status&#x2F;1808326803796512865" rel="nofollow">https:&#x2F;&#x2F;twitter.com&#x2F;frasergeorgew&#x2F;status&#x2F;1808326803796512865</a></div><br/><div id="40965061" class="c"><input type="checkbox" id="c-40965061" checked=""/><div class="controls bullet"><span class="by">pbd</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40961531">parent</a><span>|</span><a href="#40962465">next</a><span>|</span><label class="collapse" for="c-40965061">[-]</label><label class="expand" for="c-40965061">[1 more]</label></div><br/><div class="children"><div class="content">Snowflake as destination is very very easy to work with on fivetran. Fivetran didn&#x27;t have S3 as destination till late 2022. So it literally forces you to use one of BQ, Snowflake, redshift as destination.
So fivetran CEO&#x27;s defence is pretty stupid.</div><br/></div></div></div></div><div id="40962465" class="c"><input type="checkbox" id="c-40962465" checked=""/><div class="controls bullet"><span class="by">mritchie712</span><span>|</span><a href="#40960991">parent</a><span>|</span><a href="#40961531">prev</a><span>|</span><a href="#40961944">next</a><span>|</span><label class="collapse" for="c-40962465">[-]</label><label class="expand" for="c-40962465">[7 more]</label></div><br/><div class="children"><div class="content">They weren&#x27;t that quiet about it:<p>&gt; Moving several large, crucial Postgres datasets (some of them tens of TB large) to data lake gave us a net savings of over a million dollars for 2022 and proportionally higher savings in 2023 and 2024.</div><br/><div id="40963040" class="c"><input type="checkbox" id="c-40963040" checked=""/><div class="controls bullet"><span class="by">patrickmay</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40962465">parent</a><span>|</span><a href="#40961944">next</a><span>|</span><label class="collapse" for="c-40963040">[-]</label><label class="expand" for="c-40963040">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;d like to see more details.  10s of TB isn&#x27;t that large -- why so expensive?</div><br/><div id="40966039" class="c"><input type="checkbox" id="c-40966039" checked=""/><div class="controls bullet"><span class="by">shrikant</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40963040">parent</a><span>|</span><a href="#40963963">next</a><span>|</span><label class="collapse" for="c-40966039">[-]</label><label class="expand" for="c-40966039">[1 more]</label></div><br/><div class="children"><div class="content">Fivetran charges by &quot;monthly active rows&quot;, which quickly adds up when you have hundreds of millions to billions of rows that are constantly changing.<p><a href="https:&#x2F;&#x2F;fivetran.com&#x2F;docs&#x2F;usage-based-pricing" rel="nofollow">https:&#x2F;&#x2F;fivetran.com&#x2F;docs&#x2F;usage-based-pricing</a></div><br/></div></div><div id="40965137" class="c"><input type="checkbox" id="c-40965137" checked=""/><div class="controls bullet"><span class="by">aabhay</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40963040">parent</a><span>|</span><a href="#40963963">prev</a><span>|</span><a href="#40965341">next</a><span>|</span><label class="collapse" for="c-40965137">[-]</label><label class="expand" for="c-40965137">[1 more]</label></div><br/><div class="children"><div class="content">They’re likely paying for egress from the databases as well.</div><br/></div></div><div id="40965341" class="c"><input type="checkbox" id="c-40965341" checked=""/><div class="controls bullet"><span class="by">tomrod</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40963040">parent</a><span>|</span><a href="#40965137">prev</a><span>|</span><a href="#40963764">next</a><span>|</span><label class="collapse" for="c-40965341">[-]</label><label class="expand" for="c-40965341">[1 more]</label></div><br/><div class="children"><div class="content">DBA salaries, maybe?</div><br/></div></div><div id="40963764" class="c"><input type="checkbox" id="c-40963764" checked=""/><div class="controls bullet"><span class="by">riku_iki</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40963040">parent</a><span>|</span><a href="#40965341">prev</a><span>|</span><a href="#40961944">next</a><span>|</span><label class="collapse" for="c-40963764">[-]</label><label class="expand" for="c-40963764">[1 more]</label></div><br/><div class="children"><div class="content">Maybe cloud hosted</div><br/></div></div></div></div></div></div><div id="40961944" class="c"><input type="checkbox" id="c-40961944" checked=""/><div class="controls bullet"><span class="by">sneak</span><span>|</span><a href="#40960991">parent</a><span>|</span><a href="#40962465">prev</a><span>|</span><a href="#40963001">next</a><span>|</span><label class="collapse" for="c-40961944">[-]</label><label class="expand" for="c-40961944">[4 more]</label></div><br/><div class="children"><div class="content">I thought the quiet part was that they are data mining their customer data (and disclosing it to multiple third parties) because it’s not E2EE and they can read everyone’s private and proprietary notes.<p>Otherwise, this is the perfect app for sharding&#x2F;horizontal scalability.  Your notes don’t need to be queried or joined with anyone else’s notes.</div><br/><div id="40963019" class="c"><input type="checkbox" id="c-40963019" checked=""/><div class="controls bullet"><span class="by">altdataseller</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40961944">parent</a><span>|</span><a href="#40964707">next</a><span>|</span><label class="collapse" for="c-40963019">[-]</label><label class="expand" for="c-40963019">[1 more]</label></div><br/><div class="children"><div class="content">Also whether this data lake is worth the costs&#x2F;effort. How does this data lake add value to the user experience? What is this “AI” stuff that this data lake enables?<p>For example, they mention search. But i imagine it is just searching only within your own docs. Which i presume should be fast and efficient if everything is sharded by user in Postgres.<p>The tech stuff is all fine and good, but if it adds no value, its just playing with technology for technology sakes</div><br/></div></div><div id="40964707" class="c"><input type="checkbox" id="c-40964707" checked=""/><div class="controls bullet"><span class="by">wearhere</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40961944">parent</a><span>|</span><a href="#40963019">prev</a><span>|</span><a href="#40961985">next</a><span>|</span><label class="collapse" for="c-40964707">[-]</label><label class="expand" for="c-40964707">[1 more]</label></div><br/><div class="children"><div class="content">I too was surprised to read that they were syncing what reads, at a glance, to be their entire database into the data lake. IIUC the reason that Snowflake prioritizes inserts over updates is because you&#x27;re supposed to stream events derived from your data, not the data itself.</div><br/></div></div><div id="40961985" class="c"><input type="checkbox" id="c-40961985" checked=""/><div class="controls bullet"><span class="by">redpoint</span><span>|</span><a href="#40960991">root</a><span>|</span><a href="#40961944">parent</a><span>|</span><a href="#40964707">prev</a><span>|</span><a href="#40963001">next</a><span>|</span><label class="collapse" for="c-40961985">[-]</label><label class="expand" for="c-40961985">[1 more]</label></div><br/><div class="children"><div class="content">This ^. This switch from managed to in house is a good example of only building when necessary.</div><br/></div></div></div></div></div></div><div id="40964769" class="c"><input type="checkbox" id="c-40964769" checked=""/><div class="controls bullet"><span class="by">hobobaggins</span><span>|</span><a href="#40960991">prev</a><span>|</span><a href="#40961078">next</a><span>|</span><label class="collapse" for="c-40964769">[-]</label><label class="expand" for="c-40964769">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Managing this rapid growth while meeting the ever-increasing data demands of critical product and analytics use cases, especially our recent Notion AI features, meant building and scaling Notion’s data lake.<p>Are they using this new data lake to train new AI models on?<p>Or has Notion signed a deal with another LLM provider to provide customer data as a source for training data?</div><br/><div id="40965760" class="c"><input type="checkbox" id="c-40965760" checked=""/><div class="controls bullet"><span class="by">gorgoiler</span><span>|</span><a href="#40964769">parent</a><span>|</span><a href="#40961078">next</a><span>|</span><label class="collapse" for="c-40965760">[-]</label><label class="expand" for="c-40965760">[1 more]</label></div><br/><div class="children"><div class="content">It’s not a direct answer but from what Notion tell us about their own business:<p>* The team are based in the US, specifically California, and Notion Labs, Inc is a Delaware corporation.<p>* Their investment comes from Venture Capital and individual wealth.  The investors are listed on Notion’s about page and are open about how they themselves became rich through VC funded tech companies.<p>There is a very open sense of panic in tech right now to climb to the top of the AI pile and not get crushed underneath.  I would be <i>amazed</i> if there were any companies <i>not</i> enthralled by — and either already embracing or planning to embrace — the data-mining AI gold rush.<p>Notion is a great product but one would be naive to use it while also harboring concerns about data privacy.</div><br/></div></div></div></div><div id="40961078" class="c"><input type="checkbox" id="c-40961078" checked=""/><div class="controls bullet"><span class="by">methou</span><span>|</span><a href="#40964769">prev</a><span>|</span><a href="#40962304">next</a><span>|</span><label class="collapse" for="c-40961078">[-]</label><label class="expand" for="c-40961078">[21 more]</label></div><br/><div class="children"><div class="content">&gt; Data lake
&gt; Data warehouse<p>These aren&#x27;t something I would like to hear if I&#x27;m still using Notion.  It&#x27;s very bold to publish something like this on their own website.</div><br/><div id="40961594" class="c"><input type="checkbox" id="c-40961594" checked=""/><div class="controls bullet"><span class="by">bastawhiz</span><span>|</span><a href="#40961078">parent</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40961594">[-]</label><label class="expand" for="c-40961594">[12 more]</label></div><br/><div class="children"><div class="content">Those are just different words for &quot;database&quot;. What do you care what kind of database your Notion data is sitting in?</div><br/><div id="40961899" class="c"><input type="checkbox" id="c-40961899" checked=""/><div class="controls bullet"><span class="by">TeMPOraL</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961594">parent</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40961899">[-]</label><label class="expand" for="c-40961899">[11 more]</label></div><br/><div class="children"><div class="content">A &quot;data lake&quot; strongly suggests there&#x27;s lot of information the company needs to aggregate and process globally, which should very much <i>not</i> be the case with a semi-private rich notebook product.</div><br/><div id="40962648" class="c"><input type="checkbox" id="c-40962648" checked=""/><div class="controls bullet"><span class="by">bastawhiz</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961899">parent</a><span>|</span><a href="#40964903">prev</a><span>|</span><a href="#40962441">next</a><span>|</span><label class="collapse" for="c-40962648">[-]</label><label class="expand" for="c-40962648">[2 more]</label></div><br/><div class="children"><div class="content">They literally explained in the article why they have a data lake instead of just a data warehouse: their data model means it&#x27;s slow and expensive to ingest that data into the warehouse from Postgres. The data lake is serving the same functions that the data warehouse did, but now that the volume of data has exceeded what the warehouse can handle, the data lake fills that gap.<p>I wrote another comment about why you&#x27;d need this in the first place:<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40961622">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40961622</a><p>Frankly the argument &quot;they shouldn&#x27;t need to query the data in their system&quot; is kind of silly. If you don&#x27;t want your data processed for the features and services the company offers, don&#x27;t use them.</div><br/><div id="40963143" class="c"><input type="checkbox" id="c-40963143" checked=""/><div class="controls bullet"><span class="by">anoncareer0212</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40962648">parent</a><span>|</span><a href="#40962441">next</a><span>|</span><label class="collapse" for="c-40963143">[-]</label><label class="expand" for="c-40963143">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Frankly the argument &quot;they shouldn&#x27;t need to query the data in their system&quot; is kind of silly.<p>Neutral party here: that&#x27;s not what they said.<p>A) Quotes shouldn&#x27;t be there.<p>B) Heuristic I&#x27;ve started applying to my comments: if I&#x27;m tempted to &quot;quote&quot; something that <i>isn&#x27;t a quote</i>, it means I don&#x27;t fully understand what they mean and should ask a question. This dovetails nicely with the spirit of HN&#x27;s &quot;come with curiosity&quot;<p>It is disquieting because:<p>A) This are very much ill-defined terms (what, exactly, is data lake, vs. data warehouse, vs. database?), and as far as I&#x27;ve had to understand this stuff, and a quick spot check of Google shows, it&#x27;s about making it so you&#x27;re accumulating more data in one place.<p>B) This is antithetical to a consumer&#x27;s desired approach to data, which will described parodically as: stored individually, on one computer, behind 3 locked doors and 20 layers of encryption.</div><br/></div></div></div></div><div id="40962833" class="c"><input type="checkbox" id="c-40962833" checked=""/><div class="controls bullet"><span class="by">nojvek</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961899">parent</a><span>|</span><a href="#40962441">prev</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40962833">[-]</label><label class="expand" for="c-40962833">[6 more]</label></div><br/><div class="children"><div class="content">At the scale of Notion, with millions of users, they’d have that much data.<p>I’ve seen 100TB+ workloads at smaller companies. Not unusual.</div><br/><div id="40963249" class="c"><input type="checkbox" id="c-40963249" checked=""/><div class="controls bullet"><span class="by">iLoveOncall</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40962833">parent</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40963249">[-]</label><label class="expand" for="c-40963249">[5 more]</label></div><br/><div class="children"><div class="content">The concern isn&#x27;t the scale, it&#x27;s the use. What is there to _process_ when they&#x27;re supposed to only store and retrieve to show to users?</div><br/><div id="40964608" class="c"><input type="checkbox" id="c-40964608" checked=""/><div class="controls bullet"><span class="by">ctippett</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40963249">parent</a><span>|</span><a href="#40964899">next</a><span>|</span><label class="collapse" for="c-40964608">[-]</label><label class="expand" for="c-40964608">[2 more]</label></div><br/><div class="children"><div class="content">The data doesn&#x27;t have to be the content of user&#x27;s notes. Think of all the metadata they&#x27;re likely collecting per user&#x2F;notebook&#x2F;interaction – the data&#x27;s likely useful for things like flagging security events, calculating the graph of interconnected notes, indexing hashed content for search (or AI embeddings?) ... these are just a few use-cases that come to mind from the top of my head.</div><br/><div id="40965694" class="c"><input type="checkbox" id="c-40965694" checked=""/><div class="controls bullet"><span class="by">TeMPOraL</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40964608">parent</a><span>|</span><a href="#40964899">next</a><span>|</span><label class="collapse" for="c-40965694">[-]</label><label class="expand" for="c-40965694">[1 more]</label></div><br/><div class="children"><div class="content">Of which security and stability seems like the only reasonable use cases. Indexing content for search <i>globally</i>? Embeddings? They just can&#x27;t help themselves, can they? All that juicy data, can&#x27;t possibly leave it alone.</div><br/></div></div></div></div><div id="40964899" class="c"><input type="checkbox" id="c-40964899" checked=""/><div class="controls bullet"><span class="by">bastawhiz</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40963249">parent</a><span>|</span><a href="#40964608">prev</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40964899">[-]</label><label class="expand" for="c-40964899">[2 more]</label></div><br/><div class="children"><div class="content">Great, you build only store and retrieve functionality. How:<p>1. Do you identify which types of content your users use the most?<p>2. Do you find users who are abusing your system?<p>3. Do you load and process data (even on a customer by customer basis) to fine tune models for the QA service that you offer as an optional upgrade? Especially when there could be gigabytes of data for a single customer<p>4. Identify corrupt data caused by a bug in your code that saves data to the db? You&#x27;re not doing a full table scan over hundreds of billions of records across almost 500 logical shares in your production fleet<p>These are just the examples I came up with off the dome. The job of the business is to operate on the data. If you can&#x27;t even query it, you can&#x27;t operate on it. Running a business is far more than just being a dumb CRUD API.</div><br/><div id="40965002" class="c"><input type="checkbox" id="c-40965002" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40964899">parent</a><span>|</span><a href="#40965297">next</a><span>|</span><label class="collapse" for="c-40965002">[-]</label><label class="expand" for="c-40965002">[1 more]</label></div><br/><div class="children"><div class="content">Fwiw, you should able to answer #1 and #2 without hitting the main db if you&#x27;ve got good observability into your system.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40965297" class="c"><input type="checkbox" id="c-40965297" checked=""/><div class="controls bullet"><span class="by">wodenokoto</span><span>|</span><a href="#40961078">parent</a><span>|</span><a href="#40961594">prev</a><span>|</span><a href="#40961201">next</a><span>|</span><label class="collapse" for="c-40965297">[-]</label><label class="expand" for="c-40965297">[1 more]</label></div><br/><div class="children"><div class="content">That’s definitely something you want to do. Datalake can be home for raw and lightly refined data in an “analytics” database such as big query or just raw parquets. This is fast for large queries but slow for small queries. So you want refined data in a “regular” database like Postgres or mssql to serve all the dashboards.</div><br/></div></div><div id="40961201" class="c"><input type="checkbox" id="c-40961201" checked=""/><div class="controls bullet"><span class="by">bnj</span><span>|</span><a href="#40961078">parent</a><span>|</span><a href="#40965297">prev</a><span>|</span><a href="#40962569">next</a><span>|</span><label class="collapse" for="c-40961201">[-]</label><label class="expand" for="c-40961201">[6 more]</label></div><br/><div class="children"><div class="content">Could you expand on this?</div><br/><div id="40961908" class="c"><input type="checkbox" id="c-40961908" checked=""/><div class="controls bullet"><span class="by">lopkeny12ko</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961201">parent</a><span>|</span><a href="#40962569">next</a><span>|</span><label class="collapse" for="c-40961908">[-]</label><label class="expand" for="c-40961908">[5 more]</label></div><br/><div class="children"><div class="content">What&#x27;s there to expand on? Do you not realize how bad of a look it is for a company to publicly admit, <i>on their own blog</i>, the amount of time and engineering effort they spent to package up, move, analyze, and sell all their customer&#x27;s private data?<p>This is why laws like CCPA &quot;do not sell my personal information&quot; exist, which I certainly hope Notion is abiding by, otherwise they&#x27;ll have lawyers knocking on their door soon.</div><br/><div id="40962034" class="c"><input type="checkbox" id="c-40962034" checked=""/><div class="controls bullet"><span class="by">Cthulhu_</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961908">parent</a><span>|</span><a href="#40962299">next</a><span>|</span><label class="collapse" for="c-40962034">[-]</label><label class="expand" for="c-40962034">[3 more]</label></div><br/><div class="children"><div class="content">Where do they say they sell it? Citation needed; that&#x27;s a legal and reputational minefield that I don&#x27;t think they would admit to, like you said.</div><br/><div id="40962230" class="c"><input type="checkbox" id="c-40962230" checked=""/><div class="controls bullet"><span class="by">lopkeny12ko</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40962034">parent</a><span>|</span><a href="#40962299">next</a><span>|</span><label class="collapse" for="c-40962230">[-]</label><label class="expand" for="c-40962230">[2 more]</label></div><br/><div class="children"><div class="content">I would challenge you to find any broker who sells data (like the T-Mobile location data scandal) who says plainly and clearly they sell user data.</div><br/><div id="40962247" class="c"><input type="checkbox" id="c-40962247" checked=""/><div class="controls bullet"><span class="by">quest88</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40962230">parent</a><span>|</span><a href="#40962299">next</a><span>|</span><label class="collapse" for="c-40962247">[-]</label><label class="expand" for="c-40962247">[1 more]</label></div><br/><div class="children"><div class="content">This is not answering the question.</div><br/></div></div></div></div></div></div><div id="40962299" class="c"><input type="checkbox" id="c-40962299" checked=""/><div class="controls bullet"><span class="by">bnj</span><span>|</span><a href="#40961078">root</a><span>|</span><a href="#40961908">parent</a><span>|</span><a href="#40962034">prev</a><span>|</span><a href="#40962569">next</a><span>|</span><label class="collapse" for="c-40962299">[-]</label><label class="expand" for="c-40962299">[1 more]</label></div><br/><div class="children"><div class="content">Right, yes, tone aside that’s very helpful- at first I didn’t understand the implication of the blog post for implementing customer hostile solutions, but you’ve helped me understand it now.</div><br/></div></div></div></div></div></div><div id="40962569" class="c"><input type="checkbox" id="c-40962569" checked=""/><div class="controls bullet"><span class="by">zarmin</span><span>|</span><a href="#40961078">parent</a><span>|</span><a href="#40961201">prev</a><span>|</span><a href="#40962304">next</a><span>|</span><label class="collapse" for="c-40962569">[-]</label><label class="expand" for="c-40962569">[1 more]</label></div><br/><div class="children"><div class="content">Given how infuriating their implementation is of an in-app database, perhaps it&#x27;s not that surprising.</div><br/></div></div></div></div><div id="40962304" class="c"><input type="checkbox" id="c-40962304" checked=""/><div class="controls bullet"><span class="by">wejick</span><span>|</span><a href="#40961078">prev</a><span>|</span><a href="#40965672">next</a><span>|</span><label class="collapse" for="c-40962304">[-]</label><label class="expand" for="c-40962304">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not familiar with S3 on datalake setup. When replicating a db table to S3, what format will be used?<p>And I&#x27;m wondering if it&#x27;s possible to update the S3 files to reflect latest incoming changes on the db table?</div><br/><div id="40962436" class="c"><input type="checkbox" id="c-40962436" checked=""/><div class="controls bullet"><span class="by">mritchie712</span><span>|</span><a href="#40962304">parent</a><span>|</span><a href="#40965672">next</a><span>|</span><label class="collapse" for="c-40962436">[-]</label><label class="expand" for="c-40962436">[1 more]</label></div><br/><div class="children"><div class="content">The file format is often Parquet. The &quot;table format&quot; depend on what data lake you&#x27;re using (e.g. Iceberg, Delta, etc.).<p>If you know Python, here&#x27;s[0] a practical example of how Iceberg works.<p>0 - <a href="https:&#x2F;&#x2F;www.definite.app&#x2F;blog&#x2F;iceberg-query-engine" rel="nofollow">https:&#x2F;&#x2F;www.definite.app&#x2F;blog&#x2F;iceberg-query-engine</a></div><br/></div></div></div></div><div id="40965672" class="c"><input type="checkbox" id="c-40965672" checked=""/><div class="controls bullet"><span class="by">alexliu518</span><span>|</span><a href="#40962304">prev</a><span>|</span><a href="#40960358">next</a><span>|</span><label class="collapse" for="c-40965672">[-]</label><label class="expand" for="c-40965672">[1 more]</label></div><br/><div class="children"><div class="content">Thank you for the clarification! It&#x27;s great to hear more about the efficient data management practices at Notion. Your team&#x27;s innovative use of the data lake to streamline the reindexing process while ensuring user data privacy is impressive. Keep up the excellent work!</div><br/></div></div><div id="40960358" class="c"><input type="checkbox" id="c-40960358" checked=""/><div class="controls bullet"><span class="by">whinvik</span><span>|</span><a href="#40965672">prev</a><span>|</span><a href="#40960767">next</a><span>|</span><label class="collapse" for="c-40960358">[-]</label><label class="expand" for="c-40960358">[4 more]</label></div><br/><div class="children"><div class="content">Is there any advantage to having both a Data Lake setup as well as Snowflake. Why would one also want Snowflake after doing such an extensive data lake setup?</div><br/><div id="40960677" class="c"><input type="checkbox" id="c-40960677" checked=""/><div class="controls bullet"><span class="by">mritchie712</span><span>|</span><a href="#40960358">parent</a><span>|</span><a href="#40960427">next</a><span>|</span><label class="collapse" for="c-40960677">[-]</label><label class="expand" for="c-40960677">[2 more]</label></div><br/><div class="children"><div class="content">Many BI &#x2F; analytics tools don&#x27;t have great support for Data Lakes, so part of the reason could be supporting those tools (e.g. they still load some of their data to snowflake to power BI &#x2F; dashboards)</div><br/><div id="40961000" class="c"><input type="checkbox" id="c-40961000" checked=""/><div class="controls bullet"><span class="by">Lucasoato</span><span>|</span><a href="#40960358">root</a><span>|</span><a href="#40960677">parent</a><span>|</span><a href="#40960427">next</a><span>|</span><label class="collapse" for="c-40961000">[-]</label><label class="expand" for="c-40961000">[1 more]</label></div><br/><div class="children"><div class="content">We&#x27;ve solved that issue with Trino. Superset and a lot of other BI tools support connection to it and it&#x27;s a very cost efficient engine (compared to DWH solutions). Another way to go even cheaper is using Athena, if you&#x27;re on AWS.</div><br/></div></div></div></div><div id="40960427" class="c"><input type="checkbox" id="c-40960427" checked=""/><div class="controls bullet"><span class="by">luizfwolf</span><span>|</span><a href="#40960358">parent</a><span>|</span><a href="#40960677">prev</a><span>|</span><a href="#40960767">next</a><span>|</span><label class="collapse" for="c-40960427">[-]</label><label class="expand" for="c-40960427">[1 more]</label></div><br/><div class="children"><div class="content">Saving money  100% also lower latency on distributed access. Accessing file partitioned S3 doesn’t require to spin a warehouse and wait for your query to go on a queue, so if every job runs in like k8s you don’t have to manage resources and auto scale in snowflake is a “paid feature”<p>I believe just not having to handle a query queue system is already.</div><br/></div></div></div></div><div id="40960767" class="c"><input type="checkbox" id="c-40960767" checked=""/><div class="controls bullet"><span class="by">adolph</span><span>|</span><a href="#40960358">prev</a><span>|</span><a href="#40964601">next</a><span>|</span><label class="collapse" for="c-40960767">[-]</label><label class="expand" for="c-40960767">[11 more]</label></div><br/><div class="children"><div class="content">They seem to be doing lots of work but I don’t understand what customer value this creates.<p>What does a backing data lake afford a Notion user that can’t be done in a similar product, like Obsidian?</div><br/><div id="40961622" class="c"><input type="checkbox" id="c-40961622" checked=""/><div class="controls bullet"><span class="by">bastawhiz</span><span>|</span><a href="#40960767">parent</a><span>|</span><a href="#40960993">next</a><span>|</span><label class="collapse" for="c-40961622">[-]</label><label class="expand" for="c-40961622">[1 more]</label></div><br/><div class="children"><div class="content">The whole point of a data warehouse is that you can rapidly query a huge amount of data with ad hoc queries.<p>When your data is in Postgres, running an arbitrary query might take hours or days (or longer). Postgres does very poorly for queries that read huge amounts of data when there&#x27;s no preexisting index (and you&#x27;re not going to be building one-off indexes for ad hoc queries—that defeats the point). A data warehouse is slower for basic queries but substantially faster for queries that run against terabytes or petabytes of data.<p>I can imagine some use cases at Notion:<p>- You want to know the most popular syntax highlighting languages<p>- You&#x27;re searching for data corruption, where blocks form a cycle<p>- You&#x27;re looking for users who are committing fraud or abuse (like using bots in violation of your tos)</div><br/></div></div><div id="40960993" class="c"><input type="checkbox" id="c-40960993" checked=""/><div class="controls bullet"><span class="by">jpalomaki</span><span>|</span><a href="#40960767">parent</a><span>|</span><a href="#40961622">prev</a><span>|</span><a href="#40961001">next</a><span>|</span><label class="collapse" for="c-40960993">[-]</label><label class="expand" for="c-40960993">[1 more]</label></div><br/><div class="children"><div class="content">From the article:
&quot;Unlock AI, Search, and other product use cases that require denormalized data&quot;</div><br/></div></div><div id="40961001" class="c"><input type="checkbox" id="c-40961001" checked=""/><div class="controls bullet"><span class="by">SOLAR_FIELDS</span><span>|</span><a href="#40960767">parent</a><span>|</span><a href="#40960993">prev</a><span>|</span><a href="#40961559">next</a><span>|</span><label class="collapse" for="c-40961001">[-]</label><label class="expand" for="c-40961001">[7 more]</label></div><br/><div class="children"><div class="content">Beyond the features that the sibling comment mentioned, this kind of data isn’t really for end users. It’s a way that you can package it up, “anonymize” it, and sell the data to interested parties.</div><br/><div id="40961443" class="c"><input type="checkbox" id="c-40961443" checked=""/><div class="controls bullet"><span class="by">Ozzie_osman</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40961001">parent</a><span>|</span><a href="#40961263">next</a><span>|</span><label class="collapse" for="c-40961443">[-]</label><label class="expand" for="c-40961443">[3 more]</label></div><br/><div class="children"><div class="content">For someone like Notion, they probably aren&#x27;t selling this data. The primary use case is internally for analysis (eg product usage, business analysis, etc).<p>It can also be used to train AI models, of course.</div><br/><div id="40962029" class="c"><input type="checkbox" id="c-40962029" checked=""/><div class="controls bullet"><span class="by">Cthulhu_</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40961443">parent</a><span>|</span><a href="#40961263">next</a><span>|</span><label class="collapse" for="c-40962029">[-]</label><label class="expand" for="c-40962029">[2 more]</label></div><br/><div class="children"><div class="content">That &quot;probably&quot; is doing a lot of heavy lifting. That said, whether they sell it or not, it&#x27;s all that data that is their primary value store at the moment. They will either go public or sell, eventually. If they go public, it&#x27;ll likely be similar to Dropbox; a single fairly successful product, but failing attempts to diversify.</div><br/><div id="40962653" class="c"><input type="checkbox" id="c-40962653" checked=""/><div class="controls bullet"><span class="by">TeMPOraL</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40962029">parent</a><span>|</span><a href="#40961263">next</a><span>|</span><label class="collapse" for="c-40962653">[-]</label><label class="expand" for="c-40962653">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Selling&quot; is a load-bearing word, too. They&#x27;re probably not literally selling SQL dumps for hard cash. But there are many ways of indirectly selling data, that are almost equivalent to trading database dumps, but indirect enough that the company can say they&#x27;re not selling data, and be technically correct.</div><br/></div></div></div></div></div></div><div id="40961263" class="c"><input type="checkbox" id="c-40961263" checked=""/><div class="controls bullet"><span class="by">sghiassy</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40961001">parent</a><span>|</span><a href="#40961443">prev</a><span>|</span><a href="#40961559">next</a><span>|</span><label class="collapse" for="c-40961263">[-]</label><label class="expand" for="c-40961263">[3 more]</label></div><br/><div class="children"><div class="content">Is that why they’re putting images in Postgres? I don’t understand that design decision yet.</div><br/><div id="40961687" class="c"><input type="checkbox" id="c-40961687" checked=""/><div class="controls bullet"><span class="by">benaubin</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40961263">parent</a><span>|</span><a href="#40961649">next</a><span>|</span><label class="collapse" for="c-40961687">[-]</label><label class="expand" for="c-40961687">[1 more]</label></div><br/><div class="children"><div class="content">Notion employee here. We don&#x27;t put images themselves in Postgres- we use s3 to store them. The article is referring to image blocks, which are effectively pointers to the image.</div><br/></div></div><div id="40961649" class="c"><input type="checkbox" id="c-40961649" checked=""/><div class="controls bullet"><span class="by">bastawhiz</span><span>|</span><a href="#40960767">root</a><span>|</span><a href="#40961263">parent</a><span>|</span><a href="#40961687">prev</a><span>|</span><a href="#40961559">next</a><span>|</span><label class="collapse" for="c-40961649">[-]</label><label class="expand" for="c-40961649">[1 more]</label></div><br/><div class="children"><div class="content">I... Don&#x27;t think they are? If you look at the URL for images in notion, you can see the S3 hostname.</div><br/></div></div></div></div></div></div><div id="40961559" class="c"><input type="checkbox" id="c-40961559" checked=""/><div class="controls bullet"><span class="by">ambicapter</span><span>|</span><a href="#40960767">parent</a><span>|</span><a href="#40961001">prev</a><span>|</span><a href="#40964601">next</a><span>|</span><label class="collapse" for="c-40961559">[-]</label><label class="expand" for="c-40961559">[1 more]</label></div><br/><div class="children"><div class="content">1st paragraph: &quot;Managing this rapid growth while meeting the ever-increasing data demands of critical product and analytics use cases, especially our recent Notion AI features, meant building and scaling Notion’s data lake.&quot;</div><br/></div></div></div></div><div id="40964601" class="c"><input type="checkbox" id="c-40964601" checked=""/><div class="controls bullet"><span class="by">CyberDildonics</span><span>|</span><a href="#40960767">prev</a><span>|</span><a href="#40961304">next</a><span>|</span><label class="collapse" for="c-40964601">[-]</label><label class="expand" for="c-40964601">[4 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the difference between a data lake and a database with a filesystem?</div><br/><div id="40964698" class="c"><input type="checkbox" id="c-40964698" checked=""/><div class="controls bullet"><span class="by">anthomtb</span><span>|</span><a href="#40964601">parent</a><span>|</span><a href="#40964815">next</a><span>|</span><label class="collapse" for="c-40964698">[-]</label><label class="expand" for="c-40964698">[1 more]</label></div><br/><div class="children"><div class="content">Add data warehouse to this list too.</div><br/></div></div><div id="40964815" class="c"><input type="checkbox" id="c-40964815" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40964601">parent</a><span>|</span><a href="#40964698">prev</a><span>|</span><a href="#40961304">next</a><span>|</span><label class="collapse" for="c-40964815">[-]</label><label class="expand" for="c-40964815">[2 more]</label></div><br/><div class="children"><div class="content">Normalisation, relations, the filesystem, ..? I&#x27;m more curious about your view of a &#x27;data lake&#x27; which is met by adding a filesystem to a db?</div><br/><div id="40965149" class="c"><input type="checkbox" id="c-40965149" checked=""/><div class="controls bullet"><span class="by">CyberDildonics</span><span>|</span><a href="#40964601">root</a><span>|</span><a href="#40964815">parent</a><span>|</span><a href="#40961304">next</a><span>|</span><label class="collapse" for="c-40965149">[-]</label><label class="expand" for="c-40965149">[1 more]</label></div><br/><div class="children"><div class="content"><i>Normalisation, relations,</i><p>What does that mean?</div><br/></div></div></div></div></div></div><div id="40965357" class="c"><input type="checkbox" id="c-40965357" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#40961304">prev</a><span>|</span><a href="#40960594">next</a><span>|</span><label class="collapse" for="c-40965357">[-]</label><label class="expand" for="c-40965357">[1 more]</label></div><br/><div class="children"><div class="content">Side-ish note, I really enjoyed a submission on Bufstream recently, a Kafka mq replacement. One of the things they mentioned is that they are working on building in Iceberg materialization, so Bufstream can automatically handle building a big analytics data lake out of incoming data. It feels like that could potentially tackle a bunch of the stack here. <a href="https:&#x2F;&#x2F;buf.build&#x2F;blog&#x2F;bufstream-kafka-lower-cost" rel="nofollow">https:&#x2F;&#x2F;buf.build&#x2F;blog&#x2F;bufstream-kafka-lower-cost</a> <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40919279">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=40919279</a><p>Versus what Notion is doing:<p>&gt; <i>We ingest incrementally updated data from Postgres to Kafka using Debezium CDC connectors, then use Apache Hudi, an open-source data processing and storage framework, to write these updates from Kafka to S3.</i><p>Feels like it would work about the same with Bufstream, replacing both Kafka &amp; Hudi. I&#x27;ve heard great things about Hudi but it does seem to have significantly less adoption so far.</div><br/></div></div><div id="40961485" class="c"><input type="checkbox" id="c-40961485" checked=""/><div class="controls bullet"><span class="by">j45</span><span>|</span><a href="#40960594">prev</a><span>|</span><a href="#40961159">next</a><span>|</span><label class="collapse" for="c-40961485">[-]</label><label class="expand" for="c-40961485">[1 more]</label></div><br/><div class="children"><div class="content">This was a nice read, interesting to see how far Postgres (largely alone) can get you.<p>Also we see how at self hosting within a startup can make perfect sense. :)<p>Devops that abstract away things in some cases to the cloud might just add to architectural and technical debt later, without the history of learning from working through the challenges<p>Still, it might have been a great opportunity to figure out offline first use of notion.<p>I have been forced to use anytype instead of notion for the offline first reason. Time to checkout to learn how they handle storage from the source code.</div><br/></div></div><div id="40961159" class="c"><input type="checkbox" id="c-40961159" checked=""/><div class="controls bullet"><span class="by">DataDaemon</span><span>|</span><a href="#40961485">prev</a><span>|</span><a href="#40960234">next</a><span>|</span><label class="collapse" for="c-40961159">[-]</label><label class="expand" for="c-40961159">[1 more]</label></div><br/><div class="children"><div class="content">OK, thanks, when E2EE ?</div><br/></div></div><div id="40960234" class="c"><input type="checkbox" id="c-40960234" checked=""/><div class="controls bullet"><span class="by">mritchie712</span><span>|</span><a href="#40961159">prev</a><span>|</span><a href="#40964145">next</a><span>|</span><label class="collapse" for="c-40960234">[-]</label><label class="expand" for="c-40960234">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Iceberg and Delta Lake, on the other hand, weren’t optimized for our update-heavy workload when we considered them in 2022<p>&quot;when we considered them in 2022&quot; is significant here because both Iceberg and Delta Lake have made rapid progress since then. I talk to a lot of companies making this decision and the consensus is swinging towards Iceberg. If they&#x27;re already heavy Databricks users, then Delta is the obvious choice.<p>For anyone that missed it, Databricks acquired Tabular[0] (which was founded by the creators of Iceberg). The public facing story is that both projects will continue independently and I really hope that&#x27;s true.<p>Shameless plug: this is the same infrastructure we&#x27;re using at Definite[1] and we&#x27;re betting a lot of companies want a setup like this, but can&#x27;t afford to build it themselves. It&#x27;s radically cheaper then the standard Snowflake + Fivetran + Looker stack and works day one. A lot of companies just want dashboards and it&#x27;s pretty ridiculous the hoops you need to jump thru to get them running.<p>We use iceberg for storage, duckdb as a query engine, a few open source projects for ETL and built a frontend to manage it all and create dashboards.<p>0 - <a href="https:&#x2F;&#x2F;www.definite.app&#x2F;blog&#x2F;databricks-tabular-acquisition" rel="nofollow">https:&#x2F;&#x2F;www.definite.app&#x2F;blog&#x2F;databricks-tabular-acquisition</a><p>1 - <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=7FAJLc3k2Fo" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=7FAJLc3k2Fo</a></div><br/></div></div></div></div></div></div></div></body></html>