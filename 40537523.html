<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1717232452301" as="style"/><link rel="stylesheet" href="styles.css?v=1717232452301"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/apache/datafusion-comet">DataFusion Comet: Apache Spark Accelerator</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>andygrove</span> | <span>25 comments</span></div><br/><div><div id="40538740" class="c"><input type="checkbox" id="c-40538740" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#40541690">next</a><span>|</span><label class="collapse" for="c-40538740">[-]</label><label class="expand" for="c-40538740">[19 more]</label></div><br/><div class="children"><div class="content">But why. Unless you need to use low-level map&#x2F;reduce, just ditch Spark and use <a href="https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;datafusion-ballista">https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;datafusion-ballista</a> directly. It supports Python too.</div><br/><div id="40539356" class="c"><input type="checkbox" id="c-40539356" checked=""/><div class="controls bullet"><span class="by">simicd</span><span>|</span><a href="#40538740">parent</a><span>|</span><a href="#40539029">next</a><span>|</span><label class="collapse" for="c-40539356">[-]</label><label class="expand" for="c-40539356">[1 more]</label></div><br/><div class="children"><div class="content">In short: Compatible with existing Spark jobs but executing them much faster. Benchmarks in the README file and docs [1] show improvements up to 3x while not even all operations are implemented yet (i.e. if an operation is not available in Comet it falls back to Spark), so there is room for further improvements. Across all TPC-H queries the total speedup is currently 1.5x, the docs state that based on datafusion&#x27;s standalone performance 2x-4x is a realistic goal [1]<p>Haven&#x27;t seen any memory consumption benchmarks but suspect that it&#x27;s lower than Spark for same jobs since datafusion is designsd from the ground up to be columnar-first.<p>For companies spending 100s of thousands if not millions on compute this would mean substantial savings with little effort.<p>[1] <a href="https:&#x2F;&#x2F;datafusion.apache.org&#x2F;comet&#x2F;contributor-guide&#x2F;benchmarking.html" rel="nofollow">https:&#x2F;&#x2F;datafusion.apache.org&#x2F;comet&#x2F;contributor-guide&#x2F;benchm...</a></div><br/></div></div><div id="40539029" class="c"><input type="checkbox" id="c-40539029" checked=""/><div class="controls bullet"><span class="by">MrPowers</span><span>|</span><a href="#40538740">parent</a><span>|</span><a href="#40539356">prev</a><span>|</span><a href="#40539256">next</a><span>|</span><label class="collapse" for="c-40539029">[-]</label><label class="expand" for="c-40539029">[8 more]</label></div><br/><div class="children"><div class="content">The OP is the original creator of Ballista, so he&#x27;s well aware of the project.<p>Ballista is much less mature than Spark and needs a lot of work.  It&#x27;s awesome they&#x27;re making Spark faster with Comet.</div><br/><div id="40539788" class="c"><input type="checkbox" id="c-40539788" checked=""/><div class="controls bullet"><span class="by">andygrove</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539029">parent</a><span>|</span><a href="#40539256">next</a><span>|</span><label class="collapse" for="c-40539788">[-]</label><label class="expand" for="c-40539788">[7 more]</label></div><br/><div class="children"><div class="content">Yes, Ballista failed to gain traction. I think that one of the challenges was that it only supported a small subset of Spark, and there was too much work involved to try and get to parity with Spark.<p>The Comet approach is much more pragmatic because we just add support for more operators and expressions over time and fall back to Spark for anything that is not supported yet.</div><br/><div id="40540849" class="c"><input type="checkbox" id="c-40540849" checked=""/><div class="controls bullet"><span class="by">threeseed</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539788">parent</a><span>|</span><a href="#40539949">next</a><span>|</span><label class="collapse" for="c-40540849">[-]</label><label class="expand" for="c-40540849">[1 more]</label></div><br/><div class="children"><div class="content">One of the challenges is that most Spark users don&#x27;t care if you 2x performance.<p>We are in the enterprise with large cloud budgets and can simply change instance types. If you&#x27;re 20x then that is a different story but then (a) you need to have feature parity and (b) need support from cloud vendors which Spark has.</div><br/></div></div><div id="40539949" class="c"><input type="checkbox" id="c-40539949" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539788">parent</a><span>|</span><a href="#40540849">prev</a><span>|</span><a href="#40541092">next</a><span>|</span><label class="collapse" for="c-40539949">[-]</label><label class="expand" for="c-40539949">[4 more]</label></div><br/><div class="children"><div class="content">For the longest time, searching for Ballista linked to its old archived repo that didn&#x27;t even have a link to the new repo. There was no search result for the new repo. This misled people into thinking that Ballista is a dead project but it wasn&#x27;t. It wasted so much opportunity.<p>I don&#x27;t think it&#x27;s a fair criticism of Ballista to say that it failed in any way. It just looks to need substantial effort to bring it on par with Spark. The performance benefits are meaningful. Ballista can then not only take the crown from Spark, but also revalidate Rust as a language.</div><br/><div id="40540166" class="c"><input type="checkbox" id="c-40540166" checked=""/><div class="controls bullet"><span class="by">andygrove</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539949">parent</a><span>|</span><a href="#40541092">next</a><span>|</span><label class="collapse" for="c-40540166">[-]</label><label class="expand" for="c-40540166">[3 more]</label></div><br/><div class="children"><div class="content">I wish I&#x27;d known about the search issue.<p>I do see a new opportunity for Ballista. By leveraging all of the Spark-compatible operators and expressions being built in Comet, it would be able to support a wider range of queries much more quickly.<p>Ballista already uses protobuf for sending plans to executors and Comet accepts protobuf plans (in a similar, but different format).</div><br/><div id="40540977" class="c"><input type="checkbox" id="c-40540977" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40540166">parent</a><span>|</span><a href="#40541092">next</a><span>|</span><label class="collapse" for="c-40540977">[-]</label><label class="expand" for="c-40540977">[2 more]</label></div><br/><div class="children"><div class="content">Did Databricks sponsor Comet?</div><br/><div id="40542501" class="c"><input type="checkbox" id="c-40542501" checked=""/><div class="controls bullet"><span class="by">andygrove</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40540977">parent</a><span>|</span><a href="#40541092">next</a><span>|</span><label class="collapse" for="c-40542501">[-]</label><label class="expand" for="c-40542501">[1 more]</label></div><br/><div class="children"><div class="content">No.</div><br/></div></div></div></div></div></div></div></div><div id="40541092" class="c"><input type="checkbox" id="c-40541092" checked=""/><div class="controls bullet"><span class="by">spenczar5</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539788">parent</a><span>|</span><a href="#40539949">prev</a><span>|</span><a href="#40539256">next</a><span>|</span><label class="collapse" for="c-40541092">[-]</label><label class="expand" for="c-40541092">[1 more]</label></div><br/><div class="children"><div class="content">There seems to be a history of data technologies requiring a serious corporate sponsor. Arrow gets so much dev and marketing effort from Voltron, Spark from Databricks, etc. Did Ballista have anything’s similar? I loved the project but it never seemed to move very fast on integrating with other tools and platforms.</div><br/></div></div></div></div></div></div><div id="40539256" class="c"><input type="checkbox" id="c-40539256" checked=""/><div class="controls bullet"><span class="by">orthoxerox</span><span>|</span><a href="#40538740">parent</a><span>|</span><a href="#40539029">prev</a><span>|</span><a href="#40538909">next</a><span>|</span><label class="collapse" for="c-40539256">[-]</label><label class="expand" for="c-40539256">[2 more]</label></div><br/><div class="children"><div class="content">Because it&#x27;s a drop-in replacement that lets you (theoretically) spend O(1) development effort on speeding up your Spark jobs instead of O(N).<p>I say theoretically, because I have no idea how Comet works with the memory limits on Spark executors. If you have to rebalance the memory between regular memory and memory overhead or provision some off-heap memory for Comet, then the migration won&#x27;t be so simple.</div><br/><div id="40542923" class="c"><input type="checkbox" id="c-40542923" checked=""/><div class="controls bullet"><span class="by">nicornk</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539256">parent</a><span>|</span><a href="#40538909">next</a><span>|</span><label class="collapse" for="c-40542923">[-]</label><label class="expand" for="c-40542923">[1 more]</label></div><br/><div class="children"><div class="content">and this is unfortunately the case for Velox.</div><br/></div></div></div></div><div id="40538909" class="c"><input type="checkbox" id="c-40538909" checked=""/><div class="controls bullet"><span class="by">necubi</span><span>|</span><a href="#40538740">parent</a><span>|</span><a href="#40539256">prev</a><span>|</span><a href="#40540821">next</a><span>|</span><label class="collapse" for="c-40538909">[-]</label><label class="expand" for="c-40538909">[6 more]</label></div><br/><div class="children"><div class="content">Many companies have 100k+ of lines of Spark code. It&#x27;s not trivial to rewrite all of that in another query framework.</div><br/><div id="40538958" class="c"><input type="checkbox" id="c-40538958" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40538909">parent</a><span>|</span><a href="#40540821">next</a><span>|</span><label class="collapse" for="c-40538958">[-]</label><label class="expand" for="c-40538958">[5 more]</label></div><br/><div class="children"><div class="content">Following that logic, we should have stuck with C&#x2F;C++ for everything. &#x2F;s</div><br/><div id="40539052" class="c"><input type="checkbox" id="c-40539052" checked=""/><div class="controls bullet"><span class="by">MrPowers</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40538958">parent</a><span>|</span><a href="#40540821">next</a><span>|</span><label class="collapse" for="c-40539052">[-]</label><label class="expand" for="c-40539052">[4 more]</label></div><br/><div class="children"><div class="content">Lots of Spark workloads are executed with the C++ Photon engine on the Databricks platform, so we ironically have partially moved back to C++.  Disclosure: I work for Databricks.</div><br/><div id="40539211" class="c"><input type="checkbox" id="c-40539211" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539052">parent</a><span>|</span><a href="#40540821">next</a><span>|</span><label class="collapse" for="c-40539211">[-]</label><label class="expand" for="c-40539211">[3 more]</label></div><br/><div class="children"><div class="content">The continued use of C++ is <i>not</i> exactly something to be proud of, although in this case at least it presumably is for short-running jobs, not for long-running services that accumulate leaks.</div><br/><div id="40540226" class="c"><input type="checkbox" id="c-40540226" checked=""/><div class="controls bullet"><span class="by">_bohm</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539211">parent</a><span>|</span><a href="#40540867">next</a><span>|</span><label class="collapse" for="c-40540226">[-]</label><label class="expand" for="c-40540226">[1 more]</label></div><br/><div class="children"><div class="content">There is a ton of reliable load-bearing software out there written in C++. I don&#x27;t think the fact that a piece of software is written in C++ is enough to presume that it has memory leaks.</div><br/></div></div><div id="40540867" class="c"><input type="checkbox" id="c-40540867" checked=""/><div class="controls bullet"><span class="by">threeseed</span><span>|</span><a href="#40538740">root</a><span>|</span><a href="#40539211">parent</a><span>|</span><a href="#40540226">prev</a><span>|</span><a href="#40540821">next</a><span>|</span><label class="collapse" for="c-40540867">[-]</label><label class="expand" for="c-40540867">[1 more]</label></div><br/><div class="children"><div class="content">Python would be just another PHP level language if it wasn&#x27;t for C++.<p>It&#x27;s what powers all of the DE&#x2F;ML&#x2F;AI libraries.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40540821" class="c"><input type="checkbox" id="c-40540821" checked=""/><div class="controls bullet"><span class="by">threeseed</span><span>|</span><a href="#40538740">parent</a><span>|</span><a href="#40538909">prev</a><span>|</span><a href="#40541690">next</a><span>|</span><label class="collapse" for="c-40540821">[-]</label><label class="expand" for="c-40540821">[1 more]</label></div><br/><div class="children"><div class="content">There is an entire ecosystem of libraries for Spark built up over years.<p>I want to be able to connect to interact with the full services from GCS, Azure, AWS, OpenAI etc none of which DataFusion supports.<p>As well as use libraries such as SynapseML, SparkNLP etc.<p>And do all of this with full support from my cloud provider.</div><br/></div></div></div></div><div id="40541690" class="c"><input type="checkbox" id="c-40541690" checked=""/><div class="controls bullet"><span class="by">pitah1</span><span>|</span><a href="#40538740">prev</a><span>|</span><a href="#40539911">next</a><span>|</span><label class="collapse" for="c-40541690">[-]</label><label class="expand" for="c-40541690">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been keeping an eye on these kinds of Spark accelerator libraries for a while now.<p>How does it compare to Blaze[1] and Gluten[2]?<p>I&#x27;m interested in running some benchmarks soon against all three for my project to see how they all go.<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;kwai&#x2F;blaze">https:&#x2F;&#x2F;github.com&#x2F;kwai&#x2F;blaze</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;incubator-gluten">https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;incubator-gluten</a></div><br/><div id="40543701" class="c"><input type="checkbox" id="c-40543701" checked=""/><div class="controls bullet"><span class="by">ed_elliott_asc</span><span>|</span><a href="#40541690">parent</a><span>|</span><a href="#40539911">next</a><span>|</span><label class="collapse" for="c-40543701">[-]</label><label class="expand" for="c-40543701">[1 more]</label></div><br/><div class="children"><div class="content">Apparently blaze is also datafusion</div><br/></div></div></div></div><div id="40539911" class="c"><input type="checkbox" id="c-40539911" checked=""/><div class="controls bullet"><span class="by">scirob</span><span>|</span><a href="#40541690">prev</a><span>|</span><label class="collapse" for="c-40539911">[-]</label><label class="expand" for="c-40539911">[3 more]</label></div><br/><div class="children"><div class="content">Imagine if data bricks switched and just started to contribute to this.<p>I live in a dream world :)</div><br/><div id="40540139" class="c"><input type="checkbox" id="c-40540139" checked=""/><div class="controls bullet"><span class="by">nevi-me</span><span>|</span><a href="#40539911">parent</a><span>|</span><label class="collapse" for="c-40540139">[-]</label><label class="expand" for="c-40540139">[2 more]</label></div><br/><div class="children"><div class="content">They have their own implementation that is closed source (last time I checked), Photon [1], which is written with a C++ engine.<p>Databricks&#x27; terms prevent(ed?) publishing benchmarks, it would be interesting to see how Comet performs relative to it over time.<p>Photon comes at a higher cost, so one big advantage of Comet is being able to deploy it on a standard Databricks cluster that doesn&#x27;t have Photon, at a lower running cost.<p>[1] <a href="https:&#x2F;&#x2F;www.databricks.com&#x2F;product&#x2F;photon" rel="nofollow">https:&#x2F;&#x2F;www.databricks.com&#x2F;product&#x2F;photon</a></div><br/><div id="40540886" class="c"><input type="checkbox" id="c-40540886" checked=""/><div class="controls bullet"><span class="by">slt2021</span><span>|</span><a href="#40539911">root</a><span>|</span><a href="#40540139">parent</a><span>|</span><label class="collapse" for="c-40540886">[-]</label><label class="expand" for="c-40540886">[1 more]</label></div><br/><div class="children"><div class="content">nice word play for two competing spark execution engines: Photon and Comet.
C++ vs Rust, closed-source vs open-source</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>