<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712826053866" as="style"/><link rel="stylesheet" href="styles.css?v=1712826053866"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/wouterken/crystalruby">Embed Crystal code directly in Ruby</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>FrancoisBosun</span> | <span>26 comments</span></div><br/><div><div id="39998208" class="c"><input type="checkbox" id="c-39998208" checked=""/><div class="controls bullet"><span class="by">compumike</span><span>|</span><a href="#39997840">next</a><span>|</span><label class="collapse" for="c-39998208">[-]</label><label class="expand" for="c-39998208">[1 more]</label></div><br/><div class="children"><div class="content">Beautiful, thank you. Consider posting this on the Crystal community forum <a href="https:&#x2F;&#x2F;forum.crystal-lang.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;forum.crystal-lang.org&#x2F;</a> as well!</div><br/></div></div><div id="39997840" class="c"><input type="checkbox" id="c-39997840" checked=""/><div class="controls bullet"><span class="by">MatmaRex</span><span>|</span><a href="#39998208">prev</a><span>|</span><a href="#39997772">next</a><span>|</span><label class="collapse" for="c-39997840">[-]</label><label class="expand" for="c-39997840">[3 more]</label></div><br/><div class="children"><div class="content">Everything old is new again… <a href="https:&#x2F;&#x2F;github.com&#x2F;seattlerb&#x2F;rubyinline">https:&#x2F;&#x2F;github.com&#x2F;seattlerb&#x2F;rubyinline</a> (2002)</div><br/><div id="39997903" class="c"><input type="checkbox" id="c-39997903" checked=""/><div class="controls bullet"><span class="by">freedomben</span><span>|</span><a href="#39997840">parent</a><span>|</span><a href="#39999652">next</a><span>|</span><label class="collapse" for="c-39997903">[-]</label><label class="expand" for="c-39997903">[1 more]</label></div><br/><div class="children"><div class="content">Yes the idea isn&#x27;t terribly new, but this implementation is significantly more elegant (and ruby-ish) thanks to what looks to be a great design and the capabilities of Crystal.  rubyinline is neat but honestly not something I&#x27;d seriously consider using in a production project.  I need to try out crystalruby before I have an opinion on that, but it looks very promising!</div><br/></div></div><div id="39999652" class="c"><input type="checkbox" id="c-39999652" checked=""/><div class="controls bullet"><span class="by">boongeheYOE</span><span>|</span><a href="#39997840">parent</a><span>|</span><a href="#39997903">prev</a><span>|</span><a href="#39997772">next</a><span>|</span><label class="collapse" for="c-39999652">[-]</label><label class="expand" for="c-39999652">[1 more]</label></div><br/><div class="children"><div class="content">Crystal existed in 2002?<p>This seems way more verbose than the project in the post.</div><br/></div></div></div></div><div id="39997772" class="c"><input type="checkbox" id="c-39997772" checked=""/><div class="controls bullet"><span class="by">edvinbesic</span><span>|</span><a href="#39997840">prev</a><span>|</span><a href="#39998680">next</a><span>|</span><label class="collapse" for="c-39997772">[-]</label><label class="expand" for="c-39997772">[11 more]</label></div><br/><div class="children"><div class="content">What is the current state of crystal toolchain? Last time I used it I really enjoyed the language but the compilation times were a bit of a turn off.</div><br/><div id="39998226" class="c"><input type="checkbox" id="c-39998226" checked=""/><div class="controls bullet"><span class="by">Nuzzerino</span><span>|</span><a href="#39997772">parent</a><span>|</span><a href="#39998389">next</a><span>|</span><label class="collapse" for="c-39998226">[-]</label><label class="expand" for="c-39998226">[9 more]</label></div><br/><div class="children"><div class="content">You won&#x27;t ever see fast compilation times with it, and here&#x27;s why:<p>&gt; type annotations are rarely necessary, thanks to powerful type inference. This keeps the code clean and feels like a dynamic language.[1]<p>I prefer Sorbet[2] for Ruby, which is pretty fast and a reasonable compromise. People complain about the verbosity, but you can&#x27;t have both speed and type inference. Pick one.<p>Some of the verbosity in Sorbet, however, comes as an indirect result of an underdeveloped Generic type system (the rest of the parts work great though). Some of the verbosity comes from lack of fluency with the tool, which gets better with practice, and doing research. The bottom line is I often think its a skill issue when people say it leads to code that is too verbose.<p>1. <a href="https:&#x2F;&#x2F;crystal-lang.org&#x2F;#type_system" rel="nofollow">https:&#x2F;&#x2F;crystal-lang.org&#x2F;#type_system</a>
2. <a href="https:&#x2F;&#x2F;sorbet.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;sorbet.org&#x2F;</a></div><br/><div id="39999307" class="c"><input type="checkbox" id="c-39999307" checked=""/><div class="controls bullet"><span class="by">jpgvm</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998226">parent</a><span>|</span><a href="#39998885">next</a><span>|</span><label class="collapse" for="c-39999307">[-]</label><label class="expand" for="c-39999307">[1 more]</label></div><br/><div class="children"><div class="content">Kotlin strikes a good middle ground on the fast compilation &lt;-&gt; inference continuum IMO. within function bodies you rarely need to think about the typing system. Function return types can be inferred for expression bodies and star projections can make some of the more tricky parts of generics more tractable.<p>Inference is a big part of what increases Kotlin ergo over Java and while it does compile slower you are going from a very fast base so it doesn&#x27;t feel slow relative to other options.</div><br/></div></div><div id="39998885" class="c"><input type="checkbox" id="c-39998885" checked=""/><div class="controls bullet"><span class="by">virtualwhys</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998226">parent</a><span>|</span><a href="#39999307">prev</a><span>|</span><a href="#39999074">next</a><span>|</span><label class="collapse" for="c-39998885">[-]</label><label class="expand" for="c-39998885">[2 more]</label></div><br/><div class="children"><div class="content">&gt; but you can&#x27;t have both speed and type inference. Pick one.<p>With OCaml you can pick two :)</div><br/><div id="39999915" class="c"><input type="checkbox" id="c-39999915" checked=""/><div class="controls bullet"><span class="by">freilanzer</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998885">parent</a><span>|</span><a href="#39999074">next</a><span>|</span><label class="collapse" for="c-39999915">[-]</label><label class="expand" for="c-39999915">[1 more]</label></div><br/><div class="children"><div class="content">But then Id have to use Ocaml. ;)</div><br/></div></div></div></div><div id="39999074" class="c"><input type="checkbox" id="c-39999074" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998226">parent</a><span>|</span><a href="#39998885">prev</a><span>|</span><a href="#39999190">next</a><span>|</span><label class="collapse" for="c-39999074">[-]</label><label class="expand" for="c-39999074">[2 more]</label></div><br/><div class="children"><div class="content">&gt; You won&#x27;t ever see fast compilation times with it, and here&#x27;s why:<p>&gt; &gt; type annotations are rarely necessary, thanks to powerful type inference. This keeps the code clean and feels like a dynamic language.[1]<p>There are fast type inference implementations. For example, the OCaml compiler is pretty fast<p>No reason Crystal couldn&#x27;t improve this part of compile time in future</div><br/><div id="39999653" class="c"><input type="checkbox" id="c-39999653" checked=""/><div class="controls bullet"><span class="by">Nuzzerino</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39999074">parent</a><span>|</span><a href="#39999190">next</a><span>|</span><label class="collapse" for="c-39999653">[-]</label><label class="expand" for="c-39999653">[1 more]</label></div><br/><div class="children"><div class="content">I suspect that doesn&#x27;t hold true for some larger projects (10K+ LOC) with no annotations but point taken.<p>My experience with F# (which was way back in version 2.0, but based on OCaml which does type inference very similarly), was that the inference would become slower as the size of the project increased, eventually taking multiple seconds. I eventually adopted a habit of adding type annotations to commonly-used functions because it mitigated the problem. These projects were not huge by any means (5-10K LOC).<p>There is probably a good compromise to be found here. It should be possible for a tool to suggest areas to add annotations where it would do the most good for performance. But maybe those are non issues with modern implementations.</div><br/></div></div></div></div><div id="39999190" class="c"><input type="checkbox" id="c-39999190" checked=""/><div class="controls bullet"><span class="by">mathverse</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998226">parent</a><span>|</span><a href="#39999074">prev</a><span>|</span><a href="#39998443">next</a><span>|</span><label class="collapse" for="c-39999190">[-]</label><label class="expand" for="c-39999190">[1 more]</label></div><br/><div class="children"><div class="content">Could not in theory the stdlib and most used libraries be heavily type annotated to assist the compiler?</div><br/></div></div><div id="39998443" class="c"><input type="checkbox" id="c-39998443" checked=""/><div class="controls bullet"><span class="by">jez</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998226">parent</a><span>|</span><a href="#39999190">prev</a><span>|</span><a href="#39998389">next</a><span>|</span><label class="collapse" for="c-39998443">[-]</label><label class="expand" for="c-39998443">[2 more]</label></div><br/><div class="children"><div class="content">Do you have some examples of programs using generics in Sorbet you would prefer worked better or differently?</div><br/><div id="39998631" class="c"><input type="checkbox" id="c-39998631" checked=""/><div class="controls bullet"><span class="by">Nuzzerino</span><span>|</span><a href="#39997772">root</a><span>|</span><a href="#39998443">parent</a><span>|</span><a href="#39998389">next</a><span>|</span><label class="collapse" for="c-39998631">[-]</label><label class="expand" for="c-39998631">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll have to dig deeper into it to put together some sorbet.run code and identify which issues are the most serious. I&#x27;ll share with the community group whenever I have things worth posting.<p>That said, in general, I often end up rewriting things a different way if something doesn&#x27;t work, and the vast majority of the time that is good enough for me. But it takes time to find the one solution that doesn&#x27;t create unacceptable bloat or complexity, and even then it is not as simple as I think it could be if there was another layer of polish to the Sorbet ergonomics (don&#x27;t get me wrong, it&#x27;s already in a good spot considering where Ruby was before that). Though someone actually complained to my boss that I spend too much time getting things working with Sorbet instead of &quot;just shipping it&quot;, even though one of my main areas of responsibility is with architecture.<p>This is where having redundant features (multiple ways to accomplish the same thing) could be of some benefit, but I&#x27;ll have to think about it some more with specifics. And I understand from looking through the repository that it&#x27;s not an easy task to add features at all, so I&#x27;m thankful enough for what it is there as it has made my job much easier overall.<p>The main thing I struggle with regarding generics is the scenario where you must have separate type_template and type_member for class methods vs instance methods, and there are many use cases where these values are equal. But there is no way to tell sorbet that they are equal, requiring casts which makes the code less readable and often frustrating to write.<p>I also think that on a broader level, based on my searches, that the ruby community criticizes the idea of Sorbet for the reasons I mentioned in my previous comment. Adding more polish to the ergonomics, even when difficult or seemingly unreasonable, could do more for the branding of the project, which would lead to more community adoption, which would lead to better &quot;just-works&quot; type support with many common ruby libraries that are currently untyped. That could be a massive improvement to the status quo IMO. But it&#x27;s hard to say because it could also end up not really moving the needle...<p>Appreciate all the work you&#x27;ve done! C++ isn&#x27;t my strong point but someday I hope to find time to do a deep dive on the internals of the project.</div><br/></div></div></div></div></div></div><div id="39998389" class="c"><input type="checkbox" id="c-39998389" checked=""/><div class="controls bullet"><span class="by">LVB</span><span>|</span><a href="#39997772">parent</a><span>|</span><a href="#39998226">prev</a><span>|</span><a href="#39998680">next</a><span>|</span><label class="collapse" for="c-39998389">[-]</label><label class="expand" for="c-39998389">[1 more]</label></div><br/><div class="children"><div class="content">Mega thread that has been discussing this for a year: <a href="https:&#x2F;&#x2F;forum.crystal-lang.org&#x2F;t&#x2F;incremental-compilation-exploration&#x2F;5224" rel="nofollow">https:&#x2F;&#x2F;forum.crystal-lang.org&#x2F;t&#x2F;incremental-compilation-exp...</a></div><br/></div></div></div></div><div id="39998680" class="c"><input type="checkbox" id="c-39998680" checked=""/><div class="controls bullet"><span class="by">yxhuvud</span><span>|</span><a href="#39997772">prev</a><span>|</span><a href="#39997792">next</a><span>|</span><label class="collapse" for="c-39998680">[-]</label><label class="expand" for="c-39998680">[2 more]</label></div><br/><div class="children"><div class="content">Very, very impressive. It will be very interesting to see how much of crystal is supported, of IO and fibers and gc etc.</div><br/><div id="39999572" class="c"><input type="checkbox" id="c-39999572" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#39998680">parent</a><span>|</span><a href="#39997792">next</a><span>|</span><label class="collapse" for="c-39999572">[-]</label><label class="expand" for="c-39999572">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I was wondering the same here. How much of Crystals feature can I use here? If it is everything then this is a game changer.</div><br/></div></div></div></div><div id="39997792" class="c"><input type="checkbox" id="c-39997792" checked=""/><div class="controls bullet"><span class="by">bhaney</span><span>|</span><a href="#39998680">prev</a><span>|</span><a href="#39997734">next</a><span>|</span><label class="collapse" for="c-39997792">[-]</label><label class="expand" for="c-39997792">[6 more]</label></div><br/><div class="children"><div class="content">Wonder if it would be possible&#x2F;useful to have the Ruby interpreter itself identify eligible functions and &quot;crystalize&quot; them automatically</div><br/><div id="39998874" class="c"><input type="checkbox" id="c-39998874" checked=""/><div class="controls bullet"><span class="by">Lio</span><span>|</span><a href="#39997792">parent</a><span>|</span><a href="#39997915">next</a><span>|</span><label class="collapse" for="c-39998874">[-]</label><label class="expand" for="c-39998874">[1 more]</label></div><br/><div class="children"><div class="content">Conceptually, isn’t that what a JIT compiler does?<p>Crystalruby ia really interesting though. This has got me wondering:<p>1. How this compares to Sorbet Compiler in terms of performance?<p>2. If you could use Sorbet or RBS type annotations to drive crystalruby?<p>3. How would YJIT perform if it was fed with type annotations?<p>4. Could crystalruby type signatures be used by Sorbet-lsp, ruby-lsp, etc in to improve developer experience?<p>I really wish we had a single standard for inline types in ruby. I wish that was an inline RBS type annotation but I guess I’d take anything that works.</div><br/></div></div><div id="39997915" class="c"><input type="checkbox" id="c-39997915" checked=""/><div class="controls bullet"><span class="by">freedomben</span><span>|</span><a href="#39997792">parent</a><span>|</span><a href="#39998874">prev</a><span>|</span><a href="#39997734">next</a><span>|</span><label class="collapse" for="c-39997915">[-]</label><label class="expand" for="c-39997915">[4 more]</label></div><br/><div class="children"><div class="content">It would definitely be possible, but I would really hate to see coupling like that added to ruby.  I also worry that it would make it too magical and difficult to figure out what code is running, where and when.  Debugging an issue deep in the bowels of that is a scary thought.</div><br/><div id="39998120" class="c"><input type="checkbox" id="c-39998120" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#39997792">root</a><span>|</span><a href="#39997915">parent</a><span>|</span><a href="#39997734">next</a><span>|</span><label class="collapse" for="c-39998120">[-]</label><label class="expand" for="c-39998120">[3 more]</label></div><br/><div class="children"><div class="content">&gt; to ruby. I also worry that it would make it too magical and difficult to figure out what code is running, where and when<p>Coming from both python and statically-typed languages, your description 100% squares up with every experience I&#x27;ve had with ruby<p>Folks are free to throw stones at the Spring Framework similarly, it&#x27;s not out of bounds, but ruby seems to <i>embrace</i> the monkeypatch</div><br/><div id="39998271" class="c"><input type="checkbox" id="c-39998271" checked=""/><div class="controls bullet"><span class="by">Nuzzerino</span><span>|</span><a href="#39997792">root</a><span>|</span><a href="#39998120">parent</a><span>|</span><a href="#39998410">next</a><span>|</span><label class="collapse" for="c-39998271">[-]</label><label class="expand" for="c-39998271">[1 more]</label></div><br/><div class="children"><div class="content">&gt; ruby seems to embrace the monkeypatch<p>How recent were your experiences with this? In recent years I&#x27;ve seen monkeypatching treated as more of an antipattern. If you are on a project where people are doing that without very good reasons, that says more about the team than the language.</div><br/></div></div><div id="39998410" class="c"><input type="checkbox" id="c-39998410" checked=""/><div class="controls bullet"><span class="by">jbverschoor</span><span>|</span><a href="#39997792">root</a><span>|</span><a href="#39998120">parent</a><span>|</span><a href="#39998271">prev</a><span>|</span><a href="#39997734">next</a><span>|</span><label class="collapse" for="c-39998410">[-]</label><label class="expand" for="c-39998410">[1 more]</label></div><br/><div class="children"><div class="content">I think that’s a misconception of people who don’t understand the underlying language&#x2F;framework (yet).<p>How much magic is really going on, especially compared to for example JPA&#x2F;Hiberbate, or any of the aspect orient projects?</div><br/></div></div></div></div></div></div></div></div><div id="39997734" class="c"><input type="checkbox" id="c-39997734" checked=""/><div class="controls bullet"><span class="by">deedubaya</span><span>|</span><a href="#39997792">prev</a><span>|</span><a href="#39997796">next</a><span>|</span><label class="collapse" for="c-39997734">[-]</label><label class="expand" for="c-39997734">[1 more]</label></div><br/><div class="children"><div class="content">Neat!</div><br/></div></div></div></div></div></div></div></body></html>