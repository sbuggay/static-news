<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707296468241" as="style"/><link rel="stylesheet" href="styles.css?v=1707296468241"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.dzombak.com/blog/2024/02/Setting-up-a-secondary-Pi-Hole-on-my-home-network.html">Setting up a secondary Pi-Hole on my home network</a> <span class="domain">(<a href="https://www.dzombak.com">www.dzombak.com</a>)</span></div><div class="subtext"><span>ingve</span> | <span>45 comments</span></div><br/><div><div id="39283386" class="c"><input type="checkbox" id="c-39283386" checked=""/><div class="controls bullet"><span class="by">PenguinCoder</span><span>|</span><a href="#39283766">next</a><span>|</span><label class="collapse" for="c-39283386">[-]</label><label class="expand" for="c-39283386">[2 more]</label></div><br/><div class="children"><div class="content">This line&#x2F;&#x27;service&#x27;; Really?! Why?<p><pre><code>  Finally, since 32GB is a relatively small disk, I installed a daily cron job to clean the apt cache[0]:
</code></pre>
Which is a <i>Debian package</i> to run `apt-get clean` that the author of the blog created.<p>Here you go, no package required:<p><pre><code>  # printf &#x27;apt-get clean\n\n&#x27; &gt; &#x2F;etc&#x2F;cron.daily&#x2F;daily-apt-clean &amp;&amp; chmod +x &#x2F;etc&#x2F;cron.daily&#x2F;daily-apt-clean`
</code></pre>
[0] - <a href="https:&#x2F;&#x2F;github.com&#x2F;cdzombak&#x2F;apt-daily-clean">https:&#x2F;&#x2F;github.com&#x2F;cdzombak&#x2F;apt-daily-clean</a></div><br/><div id="39283542" class="c"><input type="checkbox" id="c-39283542" checked=""/><div class="controls bullet"><span class="by">colechristensen</span><span>|</span><a href="#39283386">parent</a><span>|</span><a href="#39283766">next</a><span>|</span><label class="collapse" for="c-39283542">[-]</label><label class="expand" for="c-39283542">[1 more]</label></div><br/><div class="children"><div class="content">Way back this was a solid way of systems management, write a collection of packages that did things and then system config would be a matter of installing a list of packages.</div><br/></div></div></div></div><div id="39283766" class="c"><input type="checkbox" id="c-39283766" checked=""/><div class="controls bullet"><span class="by">nunez</span><span>|</span><a href="#39283386">prev</a><span>|</span><a href="#39283741">next</a><span>|</span><label class="collapse" for="c-39283766">[-]</label><label class="expand" for="c-39283766">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I have never used macvlan (or ipvlan) networking with Docker, I don’t know how to set it up, and I’ve read conflicting and confusing reports about how easy it is to use with Pi-Hole<p>macvlan is cool in theory. it lets you broadcast a  &quot;real&quot; MAC address through your container&#x27;s veth. this allows it to get a real IP from your router. you can even use VLAN trunking to assign the MAC to a VLAN on your physical NIC.<p>that said, i only learned about it to discuss it in my course. my dockerized Adguard Home instance uses host-mode networking since that binds the physical ifaces into the container and is just as fast as any other networked process. it&#x27;s also WAY WAY WAY easier than trying to get pi-hole working in bridge mode, I&#x27;ve found.<p>(I used to use pi.hole for a long time but AdGuard Home is nicer and updates itself automatically out of the box.)<p>macvlan can help get you slightly better networking performance by avoiding internal SNAT but it&#x27;s marginal at best in most cases compared to the work required to maintain macvlan&#x2F;ipvlan containers. it&#x27;s also, as you pointed out, not very well documented (because it&#x27;s not used very often).<p>This feature along with storage drivers are relics from a time when Docker was poised to own the container orchestration space with Swarm. All of the third-party contributions to Docker Engine basically died once Kubernetes reached critical mass, which was somewhere between 2018 and 2020. Weaveworks was probably the only company with an actively maintained networking driver for Docker Engine, but they are gone now :(</div><br/></div></div><div id="39283741" class="c"><input type="checkbox" id="c-39283741" checked=""/><div class="controls bullet"><span class="by">firecall</span><span>|</span><a href="#39283766">prev</a><span>|</span><a href="#39283019">next</a><span>|</span><label class="collapse" for="c-39283741">[-]</label><label class="expand" for="c-39283741">[2 more]</label></div><br/><div class="children"><div class="content">If anyone wants a redundant system and is happy not to self-host, then I can recommend NextDNS.<p>Works great, but not free over a certain number of requests.<p>Can’t speak to its privacy levels though - as with anything, assume records will be supplied to authorities when required.<p>But overall it has been great - provides network wide DNS filtering and has clients for mobile and desktop devices!<p>With a good dashboard, reporting and setting too.<p>Cost is minimal and I’ve been happy to pay for it.<p>A local PiHole is probably faster, but NDNS is set and forget.</div><br/><div id="39283962" class="c"><input type="checkbox" id="c-39283962" checked=""/><div class="controls bullet"><span class="by">UberFly</span><span>|</span><a href="#39283741">parent</a><span>|</span><a href="#39283019">next</a><span>|</span><label class="collapse" for="c-39283962">[-]</label><label class="expand" for="c-39283962">[1 more]</label></div><br/><div class="children"><div class="content">I agree. I use Pi for inside my network, and NextDNS as the upstream&#x2F;failover and the in-the-wild DNS for my phones. For like $10 a year is good stuff.</div><br/></div></div></div></div><div id="39283019" class="c"><input type="checkbox" id="c-39283019" checked=""/><div class="controls bullet"><span class="by">troad</span><span>|</span><a href="#39283741">prev</a><span>|</span><a href="#39283270">next</a><span>|</span><label class="collapse" for="c-39283019">[-]</label><label class="expand" for="c-39283019">[9 more]</label></div><br/><div class="children"><div class="content">I recently set up a Pi-Hole for the first time, but I spun it down pretty quickly. On desktop &#x2F; mobile I already have client-side ad-blocking, and it&#x27;s not like the Pi-Hole can block embedded ads in adware apps like YouTube on iOS, so I just couldn&#x27;t really justify keeping it powered.<p>I suppose if you have a house full of Samsung &#x2F; Huawei &#x2F; etc. IoTs that you really need to keep connected to the Internet for whatever reason, I could sort of see it, but I don&#x27;t and I genuinely can&#x27;t figure out other use cases for it. I&#x27;m far from a networking whiz though. Am I missing something?</div><br/><div id="39283353" class="c"><input type="checkbox" id="c-39283353" checked=""/><div class="controls bullet"><span class="by">arrakeenrevived</span><span>|</span><a href="#39283019">parent</a><span>|</span><a href="#39283072">next</a><span>|</span><label class="collapse" for="c-39283353">[-]</label><label class="expand" for="c-39283353">[3 more]</label></div><br/><div class="children"><div class="content">There&#x27;s a lot of advertising activity that ublock doesn&#x27;t catch, but Pi-Hole does. Usually it&#x27;s tracking APIs rather than ads themselves.<p>It&#x27;s also useful for clients where I can&#x27;t install client-side adblocking, ie smart TVs (which try to phone home a _ton_ of advertising&#x2F;analytics information). I also don&#x27;t use client-side adblock on my work laptop (can&#x27;t install unapproved extensions) nor my iPhone, so Pi-Hole still lets me browse ad-free on those.</div><br/><div id="39283943" class="c"><input type="checkbox" id="c-39283943" checked=""/><div class="controls bullet"><span class="by">illusive4080</span><span>|</span><a href="#39283019">root</a><span>|</span><a href="#39283353">parent</a><span>|</span><a href="#39283977">next</a><span>|</span><label class="collapse" for="c-39283943">[-]</label><label class="expand" for="c-39283943">[1 more]</label></div><br/><div class="children"><div class="content">Your work laptop allows use of local DNS? Lucky you! My work laptop gets to hit all the trackers.</div><br/></div></div><div id="39283977" class="c"><input type="checkbox" id="c-39283977" checked=""/><div class="controls bullet"><span class="by">UberFly</span><span>|</span><a href="#39283019">root</a><span>|</span><a href="#39283353">parent</a><span>|</span><a href="#39283943">prev</a><span>|</span><a href="#39283072">next</a><span>|</span><label class="collapse" for="c-39283977">[-]</label><label class="expand" for="c-39283977">[1 more]</label></div><br/><div class="children"><div class="content">Yes. So much chatting from non-browser stuff. SO MUCH.</div><br/></div></div></div></div><div id="39283072" class="c"><input type="checkbox" id="c-39283072" checked=""/><div class="controls bullet"><span class="by">vizzier</span><span>|</span><a href="#39283019">parent</a><span>|</span><a href="#39283353">prev</a><span>|</span><a href="#39283468">next</a><span>|</span><label class="collapse" for="c-39283072">[-]</label><label class="expand" for="c-39283072">[1 more]</label></div><br/><div class="children"><div class="content">I run a pair as my DNS. For me they&#x27;re mostly there to block tracking over ads. Approx 10% of my DNS lookups get eaten by it using the standard ad list. Ublock &#x2F; privacy badger grabs a bunch, the piholes still kill a bunch more.</div><br/></div></div><div id="39283468" class="c"><input type="checkbox" id="c-39283468" checked=""/><div class="controls bullet"><span class="by">rdli</span><span>|</span><a href="#39283019">parent</a><span>|</span><a href="#39283072">prev</a><span>|</span><a href="#39283477">next</a><span>|</span><label class="collapse" for="c-39283468">[-]</label><label class="expand" for="c-39283468">[1 more]</label></div><br/><div class="children"><div class="content">My kids have school-issued devices, and there is a ton of tracking on them.<p>I set up my Pi-Hole on a Raspberry Pi Zero W. I have some brief notes here on my setup: <a href="https:&#x2F;&#x2F;www.thelis.org&#x2F;blog&#x2F;pi-hole" rel="nofollow">https:&#x2F;&#x2F;www.thelis.org&#x2F;blog&#x2F;pi-hole</a>. It works well.</div><br/></div></div><div id="39283477" class="c"><input type="checkbox" id="c-39283477" checked=""/><div class="controls bullet"><span class="by">yreg</span><span>|</span><a href="#39283019">parent</a><span>|</span><a href="#39283468">prev</a><span>|</span><a href="#39283270">next</a><span>|</span><label class="collapse" for="c-39283477">[-]</label><label class="expand" for="c-39283477">[3 more]</label></div><br/><div class="children"><div class="content">&gt; it&#x27;s not like the Pi-Hole can block embedded ads in adware apps like YouTube on the iOS<p>Thanks for the info. I thought this was possible and it was the sole reason why I considered setting one up. Now I procrastinated on that project long enough to learn I can cancel it.</div><br/><div id="39283952" class="c"><input type="checkbox" id="c-39283952" checked=""/><div class="controls bullet"><span class="by">illusive4080</span><span>|</span><a href="#39283019">root</a><span>|</span><a href="#39283477">parent</a><span>|</span><a href="#39283270">next</a><span>|</span><label class="collapse" for="c-39283952">[-]</label><label class="expand" for="c-39283952">[2 more]</label></div><br/><div class="children"><div class="content">Use YT on the web. If you have an iPhone, get Stop the Madness, which can make the ads very short and easily skippable. It also removes a lot of annoying web behaviors and is highly customizable.</div><br/><div id="39286150" class="c"><input type="checkbox" id="c-39286150" checked=""/><div class="controls bullet"><span class="by">donkeyd</span><span>|</span><a href="#39283019">root</a><span>|</span><a href="#39283952">parent</a><span>|</span><a href="#39283270">next</a><span>|</span><label class="collapse" for="c-39286150">[-]</label><label class="expand" for="c-39286150">[1 more]</label></div><br/><div class="children"><div class="content">Or, you know, pay for the content you consume.</div><br/></div></div></div></div></div></div></div></div><div id="39283270" class="c"><input type="checkbox" id="c-39283270" checked=""/><div class="controls bullet"><span class="by">reboot81</span><span>|</span><a href="#39283019">prev</a><span>|</span><a href="#39283387">next</a><span>|</span><label class="collapse" for="c-39283270">[-]</label><label class="expand" for="c-39283270">[5 more]</label></div><br/><div class="children"><div class="content">Having two main servers hosting Pi-Home works great - until both of them are offline for any random reason.
So I added a third Pi-Hole following Techno Tims easy to follow guide.
By using keepalived and VIP I can update, restart and tinker with the two servers as much as I want.
 <a href="https:&#x2F;&#x2F;youtu.be&#x2F;hPfk0qd4xEY" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;hPfk0qd4xEY</a></div><br/><div id="39283314" class="c"><input type="checkbox" id="c-39283314" checked=""/><div class="controls bullet"><span class="by">arrakeenrevived</span><span>|</span><a href="#39283270">parent</a><span>|</span><a href="#39284029">next</a><span>|</span><label class="collapse" for="c-39283314">[-]</label><label class="expand" for="c-39283314">[3 more]</label></div><br/><div class="children"><div class="content">But what if all three go offline for any random reason? Are you planning to add a fourth?</div><br/><div id="39283379" class="c"><input type="checkbox" id="c-39283379" checked=""/><div class="controls bullet"><span class="by">liquidpele</span><span>|</span><a href="#39283270">root</a><span>|</span><a href="#39283314">parent</a><span>|</span><a href="#39283589">next</a><span>|</span><label class="collapse" for="c-39283379">[-]</label><label class="expand" for="c-39283379">[1 more]</label></div><br/><div class="children"><div class="content">It’s pi holes all the way down.</div><br/></div></div><div id="39283589" class="c"><input type="checkbox" id="c-39283589" checked=""/><div class="controls bullet"><span class="by">karlshea</span><span>|</span><a href="#39283270">root</a><span>|</span><a href="#39283314">parent</a><span>|</span><a href="#39283379">prev</a><span>|</span><a href="#39284029">next</a><span>|</span><label class="collapse" for="c-39283589">[-]</label><label class="expand" for="c-39283589">[1 more]</label></div><br/><div class="children"><div class="content">Obviously the fourth instance should be hosted on AWS connected to your local Tailnet.</div><br/></div></div></div></div><div id="39284029" class="c"><input type="checkbox" id="c-39284029" checked=""/><div class="controls bullet"><span class="by">nirav72</span><span>|</span><a href="#39283270">parent</a><span>|</span><a href="#39283314">prev</a><span>|</span><a href="#39283387">next</a><span>|</span><label class="collapse" for="c-39284029">[-]</label><label class="expand" for="c-39284029">[1 more]</label></div><br/><div class="children"><div class="content">Alternatively - if someone want to deal with setting up Keepalived and VIP - they can use GravitySync.  It&#x27;s a easy setup.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;vmstan&#x2F;gravity-sync">https:&#x2F;&#x2F;github.com&#x2F;vmstan&#x2F;gravity-sync</a></div><br/></div></div></div></div><div id="39283387" class="c"><input type="checkbox" id="c-39283387" checked=""/><div class="controls bullet"><span class="by">Narkov</span><span>|</span><a href="#39283270">prev</a><span>|</span><a href="#39282777">next</a><span>|</span><label class="collapse" for="c-39283387">[-]</label><label class="expand" for="c-39283387">[10 more]</label></div><br/><div class="children"><div class="content">A simpler solution: Deploy one Pi-Hole instance and then set clients to use Pi-Hole as the primary resolver and your ISP&#x2F;router as the secondary. In the rare circumstance that the Pi-Hole device is down, you fallback and get the &quot;normal&quot; ISP DNS service.</div><br/><div id="39283622" class="c"><input type="checkbox" id="c-39283622" checked=""/><div class="controls bullet"><span class="by">josho</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39283583">next</a><span>|</span><label class="collapse" for="c-39283622">[-]</label><label class="expand" for="c-39283622">[2 more]</label></div><br/><div class="children"><div class="content">I did that. Then saw that filtering was inconsistent. It turns out that some systems treat the DNS list as alternatives, not as primary and failover.<p>The spec only says the dns IPs <i>should</i> be specified in preference order. Nothing says to treat it as primary and failover.</div><br/><div id="39284171" class="c"><input type="checkbox" id="c-39284171" checked=""/><div class="controls bullet"><span class="by">geerlingguy</span><span>|</span><a href="#39283387">root</a><span>|</span><a href="#39283622">parent</a><span>|</span><a href="#39283583">next</a><span>|</span><label class="collapse" for="c-39284171">[-]</label><label class="expand" for="c-39284171">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, far too many devices and apps seem to use DNS in a more round robin fashion. Too inconsistent for my liking.</div><br/></div></div></div></div><div id="39283583" class="c"><input type="checkbox" id="c-39283583" checked=""/><div class="controls bullet"><span class="by">karlshea</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39283622">prev</a><span>|</span><a href="#39283541">next</a><span>|</span><label class="collapse" for="c-39283583">[-]</label><label class="expand" for="c-39283583">[2 more]</label></div><br/><div class="children"><div class="content">Quite a few DNS clients don&#x27;t make any distinction between &quot;primary&quot; and &quot;secondary&quot;. You may enter them in order when configuring them but that has no bearing on which ends up being the server queries are sent to.</div><br/><div id="39284044" class="c"><input type="checkbox" id="c-39284044" checked=""/><div class="controls bullet"><span class="by">nirav72</span><span>|</span><a href="#39283387">root</a><span>|</span><a href="#39283583">parent</a><span>|</span><a href="#39283541">next</a><span>|</span><label class="collapse" for="c-39284044">[-]</label><label class="expand" for="c-39284044">[1 more]</label></div><br/><div class="children"><div class="content">I found windows to be like this.  It has no specific order on primary or secondary. However, occasionally it will latch on to one of them and continue sending several lookups to that one.</div><br/></div></div></div></div><div id="39283541" class="c"><input type="checkbox" id="c-39283541" checked=""/><div class="controls bullet"><span class="by">g96alqdm0x</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39283583">prev</a><span>|</span><a href="#39283808">next</a><span>|</span><label class="collapse" for="c-39283541">[-]</label><label class="expand" for="c-39283541">[2 more]</label></div><br/><div class="children"><div class="content">The problem is that many devices instantly spill over to the secondary Pi-Hole. And rogue devices bypass the primary altogether once they begin to get blocked for a short period of time. Having a secondary without blocking nearly negates the benefit of having the primary pi-hole, for the devices that it matters for most.</div><br/><div id="39284187" class="c"><input type="checkbox" id="c-39284187" checked=""/><div class="controls bullet"><span class="by">master_crab</span><span>|</span><a href="#39283387">root</a><span>|</span><a href="#39283541">parent</a><span>|</span><a href="#39283808">next</a><span>|</span><label class="collapse" for="c-39284187">[-]</label><label class="expand" for="c-39284187">[1 more]</label></div><br/><div class="children"><div class="content">This is why you need a port 53 ban on your network that blocks all traffic except to your piholes ips. Keeps rogue machines from reaching the internet for queries</div><br/></div></div></div></div><div id="39283808" class="c"><input type="checkbox" id="c-39283808" checked=""/><div class="controls bullet"><span class="by">nunez</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39283541">prev</a><span>|</span><a href="#39284193">next</a><span>|</span><label class="collapse" for="c-39283808">[-]</label><label class="expand" for="c-39283808">[1 more]</label></div><br/><div class="children"><div class="content">def don&#x27;t do this unless you want dns leaks all over the place. the pi-hole should be the only dns server in its networks. you can also use it as a dhcp server to work around ISP routers blocking DNS modification.</div><br/></div></div><div id="39284193" class="c"><input type="checkbox" id="c-39284193" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39283808">prev</a><span>|</span><a href="#39283457">next</a><span>|</span><label class="collapse" for="c-39284193">[-]</label><label class="expand" for="c-39284193">[1 more]</label></div><br/><div class="children"><div class="content">Depends on what you&#x27;re using it for. If you&#x27;re trying to block privacy threats like SuperHuman pixels you don&#x27;t want it to fall back to ISP.</div><br/></div></div><div id="39283457" class="c"><input type="checkbox" id="c-39283457" checked=""/><div class="controls bullet"><span class="by">malfist</span><span>|</span><a href="#39283387">parent</a><span>|</span><a href="#39284193">prev</a><span>|</span><a href="#39282777">next</a><span>|</span><label class="collapse" for="c-39283457">[-]</label><label class="expand" for="c-39283457">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s exactly what I do. Never been concerned about downtime with my pihole, except the odd smart TV is something that won&#x27;t using the secondary dns</div><br/></div></div></div></div><div id="39282777" class="c"><input type="checkbox" id="c-39282777" checked=""/><div class="controls bullet"><span class="by">Humphrey</span><span>|</span><a href="#39283387">prev</a><span>|</span><a href="#39282780">next</a><span>|</span><label class="collapse" for="c-39282777">[-]</label><label class="expand" for="c-39282777">[12 more]</label></div><br/><div class="children"><div class="content">I am also running a Pi-Hole and have wondered about what happens when&#x2F;if the Pi-Hole goes down.<p>Is there a simple way to have a failover&#x2F;fallback DNS configured rather than requiring two Pi&#x27;s?  On failure, I&#x27;d like my DNS to just fallback to my routers default DNS - yes I&#x27;d get ad&#x27;s but I think that&#x27;s acceptable.</div><br/><div id="39282800" class="c"><input type="checkbox" id="c-39282800" checked=""/><div class="controls bullet"><span class="by">leipert</span><span>|</span><a href="#39282777">parent</a><span>|</span><a href="#39284436">next</a><span>|</span><label class="collapse" for="c-39282800">[-]</label><label class="expand" for="c-39282800">[8 more]</label></div><br/><div class="children"><div class="content">Usually in your router&#x2F;DHCP you can configure two DNS servers. Define the PiHole as the first, and whatever upstream fallback IP you want as the second.</div><br/><div id="39282876" class="c"><input type="checkbox" id="c-39282876" checked=""/><div class="controls bullet"><span class="by">Fb24k</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39282800">parent</a><span>|</span><a href="#39284436">next</a><span>|</span><label class="collapse" for="c-39282876">[-]</label><label class="expand" for="c-39282876">[7 more]</label></div><br/><div class="children"><div class="content">Note that this quite often results in round robin between the two DNS servers, not a primary and fallback as intended.</div><br/><div id="39283200" class="c"><input type="checkbox" id="c-39283200" checked=""/><div class="controls bullet"><span class="by">rahimnathwani</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39282876">parent</a><span>|</span><a href="#39284436">next</a><span>|</span><label class="collapse" for="c-39283200">[-]</label><label class="expand" for="c-39283200">[6 more]</label></div><br/><div class="children"><div class="content">There are two ways a home router can control your DNS:<p>A) Each client has one DNS server: the router&#x27;s local IP address. The router runs dnsmasq or whatever to proxy the DNS requests.<p>B) Each client has one or more DNS servers, with the router&#x27;s IP address not listed, or listed last.<p>If you set up B, I <i>think</i> most operating systems will usually use the servers in order, i.e. only fall back to the second (ISP) server if the primary (pi-hole) doesn&#x27;t respond.</div><br/><div id="39283360" class="c"><input type="checkbox" id="c-39283360" checked=""/><div class="controls bullet"><span class="by">aconfer</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39283200">parent</a><span>|</span><a href="#39283363">next</a><span>|</span><label class="collapse" for="c-39283360">[-]</label><label class="expand" for="c-39283360">[3 more]</label></div><br/><div class="children"><div class="content">At least on macOS I found that if:<p>DNS Server 1 = Pi-Hole<p>DNS Server 2 = ISP DNS Service, OpenDNS, your router whatever<p>when pi-hole blocks the ad&#x27;s DNS query, macOS will treat that as a DNS failure and use DNS Server 2 as a fallback. Resulting in the ad being shown.<p>Doing (A) was my first attempt and at least using a Ubiquiti router, if Pi-hole blocked a DNS query it would always fallback to the secondary DNS server. In my environment, the only way I was able to get pi-hole to work consistently was to set the pi-hole server as the only DNS server in the DHCP server.</div><br/><div id="39283405" class="c"><input type="checkbox" id="c-39283405" checked=""/><div class="controls bullet"><span class="by">Narkov</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39283360">parent</a><span>|</span><a href="#39283363">next</a><span>|</span><label class="collapse" for="c-39283405">[-]</label><label class="expand" for="c-39283405">[2 more]</label></div><br/><div class="children"><div class="content">&gt; when pi-hole blocks the ad&#x27;s DNS query, macOS will treat that as a DNS failure and use DNS Server 2 as a fallback. Resulting in the ad being shown.<p>My experience with OSX and Pi-Hole doesn&#x27;t match your experience. There&#x27;s a difference between appearing to be in a failure mode (i.e. timing out) and returning blocked (null&#x2F;0.0.0.0) results.</div><br/><div id="39284830" class="c"><input type="checkbox" id="c-39284830" checked=""/><div class="controls bullet"><span class="by">aconfer</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39283405">parent</a><span>|</span><a href="#39283363">next</a><span>|</span><label class="collapse" for="c-39284830">[-]</label><label class="expand" for="c-39284830">[1 more]</label></div><br/><div class="children"><div class="content">I set this up a few years ago and now that time has passed I&#x27;m not confident enough to claim what exactly led me to that conclusion. I never got around to setting up a second pi-hole server which is what led me to click on the article above. 3 years in and I&#x27;ve never had a blip in service so I just haven&#x27;t prioritized it.<p>I did go and test this now, and agree with you. On macOS I set my primary DNS to pi-hole and secondary to 8.8.8.8. running dig on api.segment.io (blocked on pi-hole by default), it resolved to 0.0.0.0 via pi-hole and did not try 8.8.8.8 on any attempt. So my earlier comment is incorrect above and setting a secondary DNS server as a back-up may work.</div><br/></div></div></div></div></div></div><div id="39283363" class="c"><input type="checkbox" id="c-39283363" checked=""/><div class="controls bullet"><span class="by">deberon</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39283200">parent</a><span>|</span><a href="#39283360">prev</a><span>|</span><a href="#39283304">next</a><span>|</span><label class="collapse" for="c-39283363">[-]</label><label class="expand" for="c-39283363">[1 more]</label></div><br/><div class="children"><div class="content">FWIW I had to undo B) just yesterday. I thought the same thing about resolving records in order but it does not. I didn’t dive too far in, but my proxy server would occasionally query my router instead of the pihole for DNS requests. Maybe I just did it wrong :)<p>For the record I was assigning these DNS server IPs via docker compose. So perhaps that makes a difference.</div><br/></div></div><div id="39283304" class="c"><input type="checkbox" id="c-39283304" checked=""/><div class="controls bullet"><span class="by">Humphrey</span><span>|</span><a href="#39282777">root</a><span>|</span><a href="#39283200">parent</a><span>|</span><a href="#39283363">prev</a><span>|</span><a href="#39284436">next</a><span>|</span><label class="collapse" for="c-39283304">[-]</label><label class="expand" for="c-39283304">[1 more]</label></div><br/><div class="children"><div class="content">Nice.  I&#x27;m using method B, but I cannot remember if I added a second IP or not.  I&#x27;ll need to try this when nobody else is at home.</div><br/></div></div></div></div></div></div></div></div><div id="39284436" class="c"><input type="checkbox" id="c-39284436" checked=""/><div class="controls bullet"><span class="by">jaredhallen</span><span>|</span><a href="#39282777">parent</a><span>|</span><a href="#39282800">prev</a><span>|</span><a href="#39283124">next</a><span>|</span><label class="collapse" for="c-39284436">[-]</label><label class="expand" for="c-39284436">[1 more]</label></div><br/><div class="children"><div class="content">It seems like concern over reliability of the PiHole is a common concern (between the original post and the comments). I guess I&#x27;m just not sure why. I just run one, and have for quite a while. I&#x27;ve never had any issues, which suggests to me that the probability of failure is pretty low. But more importantly, the impact of failure is (in my opinion) almost zero. It&#x27;s a home network. If the PiHole has a problem, either fix it, or change your DHCP server to hand out a different DNS server and renew a few leases.</div><br/></div></div><div id="39283124" class="c"><input type="checkbox" id="c-39283124" checked=""/><div class="controls bullet"><span class="by">willis936</span><span>|</span><a href="#39282777">parent</a><span>|</span><a href="#39284436">prev</a><span>|</span><a href="#39283681">next</a><span>|</span><label class="collapse" for="c-39283124">[-]</label><label class="expand" for="c-39283124">[1 more]</label></div><br/><div class="children"><div class="content">Even better than failover is reliability.  I fought with pi-holes for years.  Now I have a pfsense firewall and I&#x27;m no longer hacking together half solutions to networking challenges or rerolling an OS on a new SD card once a year.</div><br/></div></div><div id="39283681" class="c"><input type="checkbox" id="c-39283681" checked=""/><div class="controls bullet"><span class="by">outworlder</span><span>|</span><a href="#39282777">parent</a><span>|</span><a href="#39283124">prev</a><span>|</span><a href="#39282780">next</a><span>|</span><label class="collapse" for="c-39283681">[-]</label><label class="expand" for="c-39283681">[1 more]</label></div><br/><div class="children"><div class="content">DNS isn&#x27;t really suitable for an active&#x2F;backup solution. Generally, you can&#x27;t do that without some automation or some explicit support from the device, which is basically non-existent.<p>In my mikrotik device I do have a small script to replace my DNS entry with Cloudflare in case it becomes unresponsive (and then back again once it&#x27;s up). That is not very transparent though and devices will get errors until the switch happens.</div><br/></div></div></div></div><div id="39282780" class="c"><input type="checkbox" id="c-39282780" checked=""/><div class="controls bullet"><span class="by">Havoc</span><span>|</span><a href="#39282777">prev</a><span>|</span><a href="#39284516">next</a><span>|</span><label class="collapse" for="c-39282780">[-]</label><label class="expand" for="c-39282780">[2 more]</label></div><br/><div class="children"><div class="content">Recently did similar except set it up on a VPS. With IP filtering so that it’s not an open resolver. (Easy in my case given static ip)<p>Theory being that it’ll provide a bit more resilience than dual locals</div><br/><div id="39282823" class="c"><input type="checkbox" id="c-39282823" checked=""/><div class="controls bullet"><span class="by">oakwhiz</span><span>|</span><a href="#39282780">parent</a><span>|</span><a href="#39284516">next</a><span>|</span><label class="collapse" for="c-39282823">[-]</label><label class="expand" for="c-39282823">[1 more]</label></div><br/><div class="children"><div class="content">Why not use a tunnel like Wireguard so that you don&#x27;t need an IP filter on the rental box side? That way if your home public IP is reassigned you don&#x27;t have so much work to do. Bonus encryption for DNS traffic, too.</div><br/></div></div></div></div><div id="39284516" class="c"><input type="checkbox" id="c-39284516" checked=""/><div class="controls bullet"><span class="by">senectus1</span><span>|</span><a href="#39282780">prev</a><span>|</span><label class="collapse" for="c-39284516">[-]</label><label class="expand" for="c-39284516">[1 more]</label></div><br/><div class="children"><div class="content">I run a pihole but I&#x27;ve also got a OPNSense router. I was thinking of turning on the AdGuard Home thats fully supported in OPNSense as a secondary.<p>in fact I think this is just prompted me to do that.</div><br/></div></div></div></div></div></div></div></body></html>