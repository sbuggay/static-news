<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1711530068056" as="style"/><link rel="stylesheet" href="styles.css?v=1711530068056"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://fractaledmind.github.io/2023/12/23/rubyconftw/">How (and why) to run SQLite in production</a> <span class="domain">(<a href="https://fractaledmind.github.io">fractaledmind.github.io</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>34 comments</span></div><br/><div><div id="39836831" class="c"><input type="checkbox" id="c-39836831" checked=""/><div class="controls bullet"><span class="by">mythz</span><span>|</span><a href="#39835936">next</a><span>|</span><label class="collapse" for="c-39836831">[-]</label><label class="expand" for="c-39836831">[1 more]</label></div><br/><div class="children"><div class="content">We&#x27;re also defaulting to using SQLite first for our new Apps with Simplicity, Speed, Cost and flexibility being the motivating factors.<p>Not needing a managed database also allows us to move away from AWS onto much better value Hetzner servers, much love to Litestream [1] which makes replication to R2&#x2F;S3 effortless.<p>[1] <a href="https:&#x2F;&#x2F;docs.servicestack.net&#x2F;ormlite&#x2F;litestream" rel="nofollow">https:&#x2F;&#x2F;docs.servicestack.net&#x2F;ormlite&#x2F;litestream</a></div><br/></div></div><div id="39835936" class="c"><input type="checkbox" id="c-39835936" checked=""/><div class="controls bullet"><span class="by">skybrian</span><span>|</span><a href="#39836831">prev</a><span>|</span><a href="#39836789">next</a><span>|</span><label class="collapse" for="c-39835936">[-]</label><label class="expand" for="c-39835936">[4 more]</label></div><br/><div class="children"><div class="content">I went through this presentation looking for &quot;how do you do backups&quot; and it glosses over it. But the author blogged about that separately [1].<p>It seems he uses Litestream with DigitalOcean Spaces for this. Looks like they start at $5 per month for 250 GB [2]. Would that be the best way for a hobbyist to get started?<p>[1] <a href="https:&#x2F;&#x2F;fractaledmind.github.io&#x2F;2023&#x2F;09&#x2F;09&#x2F;enhancing-rails-sqlite-setting-up-litestream&#x2F;" rel="nofollow">https:&#x2F;&#x2F;fractaledmind.github.io&#x2F;2023&#x2F;09&#x2F;09&#x2F;enhancing-rails-s...</a>
[2] <a href="https:&#x2F;&#x2F;www.digitalocean.com&#x2F;pricing&#x2F;spaces-object-storage" rel="nofollow">https:&#x2F;&#x2F;www.digitalocean.com&#x2F;pricing&#x2F;spaces-object-storage</a></div><br/><div id="39836551" class="c"><input type="checkbox" id="c-39836551" checked=""/><div class="controls bullet"><span class="by">yread</span><span>|</span><a href="#39835936">parent</a><span>|</span><a href="#39835988">next</a><span>|</span><label class="collapse" for="c-39836551">[-]</label><label class="expand" for="c-39836551">[1 more]</label></div><br/><div class="children"><div class="content">Maybe I&#x27;m crazy but I just have a cron job that does .backup during a time with little activity. My db is only 40GB or so and stored on an NVMe so it finishes quickly.</div><br/></div></div><div id="39835988" class="c"><input type="checkbox" id="c-39835988" checked=""/><div class="controls bullet"><span class="by">stpn</span><span>|</span><a href="#39835936">parent</a><span>|</span><a href="#39836551">prev</a><span>|</span><a href="#39836150">next</a><span>|</span><label class="collapse" for="c-39835988">[-]</label><label class="expand" for="c-39835988">[1 more]</label></div><br/><div class="children"><div class="content">Fwiw, I&#x27;ve been using hosted LiteFS Cloud[0] (written by the same person who wrote litestream) on fly.io. The pricing starts at $5&#x2F;mo for the first 10GB (kind of steep) but it&#x27;s been working out so far.<p>(no affiliation to fly&#x2F;litefs, just a fan)<p>[0]: <a href="https:&#x2F;&#x2F;fly.io&#x2F;blog&#x2F;litefs-cloud&#x2F;">https:&#x2F;&#x2F;fly.io&#x2F;blog&#x2F;litefs-cloud&#x2F;</a></div><br/></div></div><div id="39836150" class="c"><input type="checkbox" id="c-39836150" checked=""/><div class="controls bullet"><span class="by">begueradj</span><span>|</span><a href="#39835936">parent</a><span>|</span><a href="#39835988">prev</a><span>|</span><a href="#39836789">next</a><span>|</span><label class="collapse" for="c-39836150">[-]</label><label class="expand" for="c-39836150">[1 more]</label></div><br/><div class="children"><div class="content">I checked your blog and I am impressed you are still very curious to learn things which didn&#x27;t exist before you retired (generative AI).</div><br/></div></div></div></div><div id="39836789" class="c"><input type="checkbox" id="c-39836789" checked=""/><div class="controls bullet"><span class="by">ojosilva</span><span>|</span><a href="#39835936">prev</a><span>|</span><a href="#39835773">next</a><span>|</span><label class="collapse" for="c-39836789">[-]</label><label class="expand" for="c-39836789">[2 more]</label></div><br/><div class="children"><div class="content">&gt; First is that SQLite is simple. The database is a literal file on disk. The engine is a single executable.<p>No, it&#x27;s not a single executable. There&#x27;s no database executable as far as your app goes. There&#x27;s no engine. The &quot;engine&quot; is a library, meant to be embedded into other code and may be concurrent and have many &quot;executables&quot; if you implement it that way or have different apps access the database.<p>Think of SQLite as an intricate file format for which your app will use an API (ie sqlite.c) to access.</div><br/><div id="39836849" class="c"><input type="checkbox" id="c-39836849" checked=""/><div class="controls bullet"><span class="by">klabb3</span><span>|</span><a href="#39836789">parent</a><span>|</span><a href="#39835773">next</a><span>|</span><label class="collapse" for="c-39836849">[-]</label><label class="expand" for="c-39836849">[1 more]</label></div><br/><div class="children"><div class="content">Yes. If you write your server in eg Go or Rust, you can have a “single executable deployment” so to say. But the main limitation is no horizontal scalability. So if you want web scale, you have to use something faster, like &#x2F;dev&#x2F;null.</div><br/></div></div></div></div><div id="39835773" class="c"><input type="checkbox" id="c-39835773" checked=""/><div class="controls bullet"><span class="by">aaviator42</span><span>|</span><a href="#39836789">prev</a><span>|</span><a href="#39835818">next</a><span>|</span><label class="collapse" for="c-39835773">[-]</label><label class="expand" for="c-39835773">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using SQLite in production for years and am very happy with it. I believe it&#x27;s sufficient for the vast majority of web use cases.<p>I have a bit of battle-tested code that gives me a nice key-value interface to SQLite files, perhaps others will find it useful: <a href="https:&#x2F;&#x2F;github.com&#x2F;aaviator42&#x2F;StorX">https:&#x2F;&#x2F;github.com&#x2F;aaviator42&#x2F;StorX</a></div><br/></div></div><div id="39835818" class="c"><input type="checkbox" id="c-39835818" checked=""/><div class="controls bullet"><span class="by">abbbi</span><span>|</span><a href="#39835773">prev</a><span>|</span><a href="#39835699">next</a><span>|</span><label class="collapse" for="c-39835818">[-]</label><label class="expand" for="c-39835818">[11 more]</label></div><br/><div class="children"><div class="content">another article praising sqlite in production and working around a known sqlite limitation: concurrent writes.
As they link in the article:<p>&gt; But, my favorite feature of the gem is its improved concurrency support.<p>&gt; [..] <a href="https:&#x2F;&#x2F;fractaledmind.github.io&#x2F;2023&#x2F;12&#x2F;11&#x2F;sqlite-on-rails-improving-concurrency&#x2F;" rel="nofollow">https:&#x2F;&#x2F;fractaledmind.github.io&#x2F;2023&#x2F;12&#x2F;11&#x2F;sqlite-on-rails-i...</a><p>Really. At the point you are experiencing database locked in your <i>productive</i> app that uses sqlite as backend, i would strongly suggest to use another database backend that was designed with concurrent writes in mind.<p>Nothing against sqlite in production, its nice, as long as your workload meets its feature set.</div><br/><div id="39835853" class="c"><input type="checkbox" id="c-39835853" checked=""/><div class="controls bullet"><span class="by">duped</span><span>|</span><a href="#39835818">parent</a><span>|</span><a href="#39836154">next</a><span>|</span><label class="collapse" for="c-39835853">[-]</label><label class="expand" for="c-39835853">[4 more]</label></div><br/><div class="children"><div class="content">What&#x27;s wrong with PRAGMA journal_mode=WAL? It enables concurrent writes, at the expense of disk. Which to my understanding is the same as any other database backend with write ahead logging to enable concurrent writers.<p>Anecdotally, I&#x27;ve seen the WAL file grow way too large even after all writes have finished and should shrink, but that&#x27;s manageable.</div><br/><div id="39835951" class="c"><input type="checkbox" id="c-39835951" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#39835818">root</a><span>|</span><a href="#39835853">parent</a><span>|</span><a href="#39835880">next</a><span>|</span><label class="collapse" for="c-39835951">[-]</label><label class="expand" for="c-39835951">[1 more]</label></div><br/><div class="children"><div class="content">WAL allows one writer concurrent with any number of readers. It does not allow two concurrent writers.</div><br/></div></div><div id="39835880" class="c"><input type="checkbox" id="c-39835880" checked=""/><div class="controls bullet"><span class="by">abbbi</span><span>|</span><a href="#39835818">root</a><span>|</span><a href="#39835853">parent</a><span>|</span><a href="#39835951">prev</a><span>|</span><a href="#39836154">next</a><span>|</span><label class="collapse" for="c-39835880">[-]</label><label class="expand" for="c-39835880">[2 more]</label></div><br/><div class="children"><div class="content">WAL does not help with &quot;database locked&quot; situations. At some point you will see them even with WAL enabled, and your application frontend code has to deal with the timeout and retry or whatever.</div><br/></div></div></div></div><div id="39836154" class="c"><input type="checkbox" id="c-39836154" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39835818">parent</a><span>|</span><a href="#39835853">prev</a><span>|</span><a href="#39835891">next</a><span>|</span><label class="collapse" for="c-39836154">[-]</label><label class="expand" for="c-39836154">[3 more]</label></div><br/><div class="children"><div class="content">In my experience most SQLite writes take less than 1ms.<p>Do your writes really need to be concurrent if they run that fast?<p>Hard to get upset about waiting for the current write to complete before you get your turn when we are talking delays measured in thousandths of a second.<p>If you have more than 1000 writes per second then maybe this is something to worry about. The solution there is probably to run a slightly more powerful server!</div><br/><div id="39836371" class="c"><input type="checkbox" id="c-39836371" checked=""/><div class="controls bullet"><span class="by">nikisweeting</span><span>|</span><a href="#39835818">root</a><span>|</span><a href="#39836154">parent</a><span>|</span><a href="#39836404">next</a><span>|</span><label class="collapse" for="c-39836371">[-]</label><label class="expand" for="c-39836371">[1 more]</label></div><br/><div class="children"><div class="content">Sure the actual write might only take 1s but the transaction might lock for 10ms.<p>Does SQLite support overlapping write transactions with locks on different rows?<p>Also do you know if WAL2 mode changes anything? <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;cgi&#x2F;src&#x2F;timeline?r=wal2" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;cgi&#x2F;src&#x2F;timeline?r=wal2</a></div><br/></div></div><div id="39836404" class="c"><input type="checkbox" id="c-39836404" checked=""/><div class="controls bullet"><span class="by">abbbi</span><span>|</span><a href="#39835818">root</a><span>|</span><a href="#39836154">parent</a><span>|</span><a href="#39836371">prev</a><span>|</span><a href="#39835891">next</a><span>|</span><label class="collapse" for="c-39836404">[-]</label><label class="expand" for="c-39836404">[1 more]</label></div><br/><div class="children"><div class="content">back in the days where we hit this issue (mostly on windows systems) i used to create a little stress tool, you would be surprised how fast you reach the database-locked state.<p>ive just put it here:
 <a href="https:&#x2F;&#x2F;github.com&#x2F;abbbi&#x2F;sqlitestress">https:&#x2F;&#x2F;github.com&#x2F;abbbi&#x2F;sqlitestress</a><p>maybe its useful for some people to simulate their workloads.</div><br/></div></div></div></div><div id="39835891" class="c"><input type="checkbox" id="c-39835891" checked=""/><div class="controls bullet"><span class="by">wokwokwok</span><span>|</span><a href="#39835818">parent</a><span>|</span><a href="#39836154">prev</a><span>|</span><a href="#39836450">next</a><span>|</span><label class="collapse" for="c-39835891">[-]</label><label class="expand" for="c-39835891">[1 more]</label></div><br/><div class="children"><div class="content">What both articles are saying is that concurrent writes under a certain threshold or heavy read-only activity is perfectly acceptable usage pattern for sqlite in production.<p>...the problem here is that historically rails (and others) use deferred transactions and that causes sqlite to fail <i>even under trivial load conditions</i> without simply waiting for the db to free for the next write, because people who&#x27;ve written the drivers don&#x27;t understand how to use sqlite.<p>If you use sqlite <i>correctly</i> under heavy load it&#x27;s <i>slow</i> not <i>unreliable</i>.<p>&gt; as long as your workload meets its feature set.<p>Sure... but to be fair that probably covers a lot of microservices and probably a lot of apps too.<p>Obviously as you scale, it won&#x27;t, so sure, it&#x27;s a limited use case... but, heck, I&#x27;ve seen dozens of microservices each with their &#x27;own database&#x27; (ie. read same RDS, with different database instances) that all fail at once when that instance goes down. Woops.<p>Better? Worse?<p>Hm. Sqlite is insanely reliable. I like isolated reliable services.<p>It&#x27;s not for everything, but nothing is... I think it&#x27;s suitable for more use cases than you&#x27;re giving it credit for.</div><br/></div></div><div id="39836450" class="c"><input type="checkbox" id="c-39836450" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#39835818">parent</a><span>|</span><a href="#39835891">prev</a><span>|</span><a href="#39835699">next</a><span>|</span><label class="collapse" for="c-39836450">[-]</label><label class="expand" for="c-39836450">[2 more]</label></div><br/><div class="children"><div class="content">Before you even need to consider postgres, you can batch your writes to sqlite!<p>I am no sqlite fanboy, although I might be, but I found the industry seems to run to postgres for just about anything. I prefer simplicity first.</div><br/><div id="39836477" class="c"><input type="checkbox" id="c-39836477" checked=""/><div class="controls bullet"><span class="by">mattmanser</span><span>|</span><a href="#39835818">root</a><span>|</span><a href="#39836450">parent</a><span>|</span><a href="#39835699">next</a><span>|</span><label class="collapse" for="c-39836477">[-]</label><label class="expand" for="c-39836477">[1 more]</label></div><br/><div class="children"><div class="content">How it that simplicity?<p>To batch updates makes the code far more complex.<p>To install any full strength DB is trivial.<p>I don&#x27;t get the &#x27;simplicity&#x27;?</div><br/></div></div></div></div></div></div><div id="39835699" class="c"><input type="checkbox" id="c-39835699" checked=""/><div class="controls bullet"><span class="by">abhiyerra</span><span>|</span><a href="#39835818">prev</a><span>|</span><a href="#39835810">next</a><span>|</span><label class="collapse" for="c-39835699">[-]</label><label class="expand" for="c-39835699">[1 more]</label></div><br/><div class="children"><div class="content">We recently moved some of our cron jobs that needed a database backend to GitHub Actions + Cloudflare D1 which is SQLite in the Cloud and couldn’t be happier.</div><br/></div></div><div id="39835810" class="c"><input type="checkbox" id="c-39835810" checked=""/><div class="controls bullet"><span class="by">begueradj</span><span>|</span><a href="#39835699">prev</a><span>|</span><a href="#39835934">next</a><span>|</span><label class="collapse" for="c-39835810">[-]</label><label class="expand" for="c-39835810">[1 more]</label></div><br/><div class="children"><div class="content">Laravel switched its default database to SQLite since the current version (11).</div><br/></div></div><div id="39835934" class="c"><input type="checkbox" id="c-39835934" checked=""/><div class="controls bullet"><span class="by">stpn</span><span>|</span><a href="#39835810">prev</a><span>|</span><a href="#39836460">next</a><span>|</span><label class="collapse" for="c-39835934">[-]</label><label class="expand" for="c-39835934">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been running sqlite and litefs in production for my side project over the last year or so now.<p>It really is quite nice how much database you get for the cost and maintenance overhead required when litefs is thrown in the mix.</div><br/></div></div><div id="39836460" class="c"><input type="checkbox" id="c-39836460" checked=""/><div class="controls bullet"><span class="by">account-5</span><span>|</span><a href="#39835934">prev</a><span>|</span><a href="#39835953">next</a><span>|</span><label class="collapse" for="c-39836460">[-]</label><label class="expand" for="c-39836460">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m creating a flutter app, I need a database but don&#x27;t need online storage, local only. SQLite really is the only option for this.</div><br/></div></div><div id="39835953" class="c"><input type="checkbox" id="c-39835953" checked=""/><div class="controls bullet"><span class="by">aitchnyu</span><span>|</span><a href="#39836460">prev</a><span>|</span><a href="#39835690">next</a><span>|</span><label class="collapse" for="c-39835953">[-]</label><label class="expand" for="c-39835953">[2 more]</label></div><br/><div class="children"><div class="content">Is there a similar effort for Django? Django Sqlite driver is slow and not tested for production.</div><br/><div id="39836087" class="c"><input type="checkbox" id="c-39836087" checked=""/><div class="controls bullet"><span class="by">frodowtf</span><span>|</span><a href="#39835953">parent</a><span>|</span><a href="#39835690">next</a><span>|</span><label class="collapse" for="c-39836087">[-]</label><label class="expand" for="c-39836087">[1 more]</label></div><br/><div class="children"><div class="content">It also seems to have the same concurrency issues as described in the article. At least from my experience the &quot;database is locked&quot; error appears quite often.</div><br/></div></div></div></div><div id="39835690" class="c"><input type="checkbox" id="c-39835690" checked=""/><div class="controls bullet"><span class="by">thrdbndndn</span><span>|</span><a href="#39835953">prev</a><span>|</span><a href="#39835758">next</a><span>|</span><label class="collapse" for="c-39835690">[-]</label><label class="expand" for="c-39835690">[5 more]</label></div><br/><div class="children"><div class="content">Might want to proofread it. There are a few paragraphs that are repeating and out of place:<p>&gt; Why? So, let’s explore that together. Who here is running or has run an application in production with SQLite? Who has experimented with SQLite for an app, but not shipped it to production? There are a couple hands up, but not many. So, let’s turn this question around.</div><br/><div id="39835718" class="c"><input type="checkbox" id="c-39835718" checked=""/><div class="controls bullet"><span class="by">lxgr</span><span>|</span><a href="#39835690">parent</a><span>|</span><a href="#39835709">next</a><span>|</span><label class="collapse" for="c-39835718">[-]</label><label class="expand" for="c-39835718">[2 more]</label></div><br/><div class="children"><div class="content">This pretty clearly seems to be a transcript of a conference talk, and redundancy and repetition are quite useful for getting a point across in spoken language.<p>Maybe it could be more accessible when rewritten as a blog post, but if it’s a useful talk I’d much rather have an official transcript than only a video link and maybe Youtube’s auto-transcript.<p>So much good content is buried in video form for me (I really don’t like watching technical videos and prefer reading that content).</div><br/><div id="39835972" class="c"><input type="checkbox" id="c-39835972" checked=""/><div class="controls bullet"><span class="by">thrdbndndn</span><span>|</span><a href="#39835690">root</a><span>|</span><a href="#39835718">parent</a><span>|</span><a href="#39835709">next</a><span>|</span><label class="collapse" for="c-39835972">[-]</label><label class="expand" for="c-39835972">[1 more]</label></div><br/><div class="children"><div class="content">This paragraph appears twice in the article at different places.<p>I don&#x27;t think the speaker said it twice word by word in the talk.</div><br/></div></div></div></div><div id="39835709" class="c"><input type="checkbox" id="c-39835709" checked=""/><div class="controls bullet"><span class="by">hyperadvanced</span><span>|</span><a href="#39835690">parent</a><span>|</span><a href="#39835718">prev</a><span>|</span><a href="#39835758">next</a><span>|</span><label class="collapse" for="c-39835709">[-]</label><label class="expand" for="c-39835709">[2 more]</label></div><br/><div class="children"><div class="content">I think this is paraphrased or exact copy from a conference talk. Not that I love the rhetorical question mode of communication, but it’s more understandable.</div><br/><div id="39835964" class="c"><input type="checkbox" id="c-39835964" checked=""/><div class="controls bullet"><span class="by">thrdbndndn</span><span>|</span><a href="#39835690">root</a><span>|</span><a href="#39835709">parent</a><span>|</span><a href="#39835758">next</a><span>|</span><label class="collapse" for="c-39835964">[-]</label><label class="expand" for="c-39835964">[1 more]</label></div><br/><div class="children"><div class="content">I was not saying this particular paragraph itself is repeating.<p>It literally appears twice in the article at different places.</div><br/></div></div></div></div></div></div><div id="39836064" class="c"><input type="checkbox" id="c-39836064" checked=""/><div class="controls bullet"><span class="by">nprateem</span><span>|</span><a href="#39835758">prev</a><span>|</span><label class="collapse" for="c-39836064">[-]</label><label class="expand" for="c-39836064">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not immediately clear. How does this work over the network for multiple app servers (or does it)?<p>Is the DB hosted on something like nfs, or are writes synced to all app servers or something else?</div><br/><div id="39836268" class="c"><input type="checkbox" id="c-39836268" checked=""/><div class="controls bullet"><span class="by">vander_elst</span><span>|</span><a href="#39836064">parent</a><span>|</span><label class="collapse" for="c-39836268">[-]</label><label class="expand" for="c-39836268">[1 more]</label></div><br/><div class="children"><div class="content">IIUC it does not work, the assumption here is that you can serve all your traffic with a single instance</div><br/></div></div></div></div></div></div></div></div></div></body></html>