<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1709974863926" as="style"/><link rel="stylesheet" href="styles.css?v=1709974863926"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.dolthub.com/blog/2024-03-03-prolly-trees/">Prolly Trees</a>Â <span class="domain">(<a href="https://www.dolthub.com">www.dolthub.com</a>)</span></div><div class="subtext"><span>ingve</span> | <span>5 comments</span></div><br/><div><div id="39649047" class="c"><input type="checkbox" id="c-39649047" checked=""/><div class="controls bullet"><span class="by">iamwil</span><span>|</span><a href="#39650339">next</a><span>|</span><label class="collapse" for="c-39649047">[-]</label><label class="expand" for="c-39649047">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been looking at Prolly Trees in-depth and they&#x27;re pretty neat! They have nice properties like:<p>- self-balancing (probabilistically!)<p>- unicit (the same data in the tree results in the same tree)<p>- fast comparisons (they&#x27;re a Merkle tree, so just comparing root hashes is enough)<p>The original formulation for Prolly Trees had an expected node size of the target node size, but its standard deviation was geometric. That meant there was a long tail of node sizes far beyond the target node size.<p>The Dolt formulation is pretty neat. Chef&#x27;s kiss. It uses the current chunk size thus-far as input into a cumulative distribution function to shape the node size into a normal distribution. So now the standard deviation is under control. But now, the decision to split a node is no longer independent. It now depends on the chunk size so far, which means a decision to rebalance nodes after an insert could potentially cascade to the entire right side of the tree with decreasing probability.<p>But good news! This can be mitigated by increasing the target node size or by relaxing the target std dev of the node sizes. I detail the investigation here:<p><a href="https:&#x2F;&#x2F;interjectedfuture.com&#x2F;lab-notes&#x2F;lab-note-033-cascading-boundary-changes-in-prolly-trees&#x2F;" rel="nofollow">https:&#x2F;&#x2F;interjectedfuture.com&#x2F;lab-notes&#x2F;lab-note-033-cascadi...</a></div><br/><div id="39650422" class="c"><input type="checkbox" id="c-39650422" checked=""/><div class="controls bullet"><span class="by">j-pb</span><span>|</span><a href="#39649047">parent</a><span>|</span><a href="#39650339">next</a><span>|</span><label class="collapse" for="c-39650422">[-]</label><label class="expand" for="c-39650422">[1 more]</label></div><br/><div class="children"><div class="content">Can you share any insight on latency? I feel that, while a prolly tree has the same big O bounds as a BTree, there are extremely large constant factors involved.<p>In the benchmark of their new storage engine that they published on their blog they had read operations take 3us and write operations take 96 us for in-memory workloads.<p>That&#x27;s an order of magnitude slower than what I get from a persistent trie implementation that uses unicity to achieve node hashability (instead of the other way around as in a prolly tree).[1]<p>I could imagine that this becomes less pronounced in the durable on-disk case, as storage bandwidth and latency become the dominating factors?<p>1: <a href="https:&#x2F;&#x2F;github.com&#x2F;triblesspace&#x2F;tribles-rust&#x2F;blob&#x2F;master&#x2F;src&#x2F;patch.rs">https:&#x2F;&#x2F;github.com&#x2F;triblesspace&#x2F;tribles-rust&#x2F;blob&#x2F;master&#x2F;src...</a></div><br/></div></div></div></div><div id="39650339" class="c"><input type="checkbox" id="c-39650339" checked=""/><div class="controls bullet"><span class="by">aappleby</span><span>|</span><a href="#39649047">prev</a><span>|</span><a href="#39649402">next</a><span>|</span><label class="collapse" for="c-39650339">[-]</label><label class="expand" for="c-39650339">[1 more]</label></div><br/><div class="children"><div class="content">nice!</div><br/></div></div><div id="39649402" class="c"><input type="checkbox" id="c-39649402" checked=""/><div class="controls bullet"><span class="by">ternaryoperator</span><span>|</span><a href="#39650339">prev</a><span>|</span><label class="collapse" for="c-39649402">[-]</label><label class="expand" for="c-39649402">[1 more]</label></div><br/><div class="children"><div class="content">Excellent article! Very well written, good explanations, useful graphics.</div><br/></div></div></div></div></div></div></div></body></html>