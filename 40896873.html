<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720429276708" as="style"/><link rel="stylesheet" href="styles.css?v=1720429276708"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/sebastianwessel/quickjs">Show HN: Execute JavaScript in a WebAssembly QuickJS sandbox</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>sebastianwessel</span> | <span>51 comments</span></div><br/><div><div id="40897658" class="c"><input type="checkbox" id="c-40897658" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40898641">next</a><span>|</span><label class="collapse" for="c-40897658">[-]</label><label class="expand" for="c-40897658">[2 more]</label></div><br/><div class="children"><div class="content">Hi, I’m the author of the underlying quickjs-emscripten runtime library. I like your ergonomic kind of “standard library” for quickjs-emscripten :)<p>Did you try running in the browser or with a bundler? I think accepting the variant name as a string you pass to import(variantName) dynamically may not play well with Webpack et al.<p>EDIT: SECURITY WARNING: this library exposes the ability for the guest (untrusted) code to `fetch` with the same cookies as the host `fetch` function. You must not run untrusted code if enabling `fetch`. Library should come with a big blinking warning about what is safe and unsafe to enable when running untrusted code. It’s not a “sandbox” if the sandboxed code can call arbitrary HTTP APIs authenticated as the host context!<p>The reason quickjs-emscripten  is low-level and avoids magic is so I can confidently claim that the APIs it does provide <i>are</i> secure. I generally reject feature requests for magical serialization or easy network&#x2F;filesystem access because that kind of code is a rich area for security mistakes. When you run untrusted code, you should carefully audit the sandbox itself, but also audit all the code you write to expose APIs to the sandbox.<p>In this case a comment from an other HN user asking about Fetch cookies tipped me off to the potential security issue.<p>More reading:<p>Figma blog posts on plugin sandbox security:<p>- <a href="https:&#x2F;&#x2F;www.figma.com&#x2F;blog&#x2F;how-we-built-the-figma-plugin-system&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.figma.com&#x2F;blog&#x2F;how-we-built-the-figma-plugin-sys...</a><p>- <a href="https:&#x2F;&#x2F;www.figma.com&#x2F;blog&#x2F;an-update-on-plugin-security&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.figma.com&#x2F;blog&#x2F;an-update-on-plugin-security&#x2F;</a><p>Quickjs-emscripten README: <a href="https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten">https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten</a></div><br/><div id="40901914" class="c"><input type="checkbox" id="c-40901914" checked=""/><div class="controls bullet"><span class="by">silenced_trope</span><span>|</span><a href="#40897658">parent</a><span>|</span><a href="#40898641">next</a><span>|</span><label class="collapse" for="c-40901914">[-]</label><label class="expand" for="c-40901914">[1 more]</label></div><br/><div class="children"><div class="content">Would using an iframe (with&#x2F;without this lib) prevent the fetch issue or is that still a problem there?</div><br/></div></div></div></div><div id="40898641" class="c"><input type="checkbox" id="c-40898641" checked=""/><div class="controls bullet"><span class="by">AlexErrant</span><span>|</span><a href="#40897658">prev</a><span>|</span><a href="#40901496">next</a><span>|</span><label class="collapse" for="c-40898641">[-]</label><label class="expand" for="c-40898641">[8 more]</label></div><br/><div class="children"><div class="content">There are many ways to sandbox Javascript, both serverside and browser-side.<p>Are there any ways to &quot;sandbox&quot; DOM access? I.e. give untrusted 3rd parties access to a DOM element in a predefined spot? AFAIK the only tech that allows for this is iframes, which are unfortunately heavy and slow. I&#x27;m writing an app that can host plugins, and unfortunately, I think giving plugins DOM access means they can now literally do literally _anything_.</div><br/><div id="40898985" class="c"><input type="checkbox" id="c-40898985" checked=""/><div class="controls bullet"><span class="by">spankalee</span><span>|</span><a href="#40898641">parent</a><span>|</span><a href="#40898718">next</a><span>|</span><label class="collapse" for="c-40898985">[-]</label><label class="expand" for="c-40898985">[4 more]</label></div><br/><div class="children"><div class="content">Salesforce does this with a combination of web components, with a patched up ShadowRoot so that code with a reference to the shadow root can&#x27;t walk into the rest of the document, and a secure evaluator function related to SES (Secure EcmaScript) to limit the globals the untrusted script has access too.<p>The secure evaluator is wild. I think this is the heart of it: <a href="https:&#x2F;&#x2F;github.com&#x2F;Agoric&#x2F;realms-shim&#x2F;blob&#x2F;v1.1.0&#x2F;src&#x2F;evaluators.js#L60-L69">https:&#x2F;&#x2F;github.com&#x2F;Agoric&#x2F;realms-shim&#x2F;blob&#x2F;v1.1.0&#x2F;src&#x2F;evalua...</a><p>There&#x27;s also an idea for isolated web components to solve this in the platform: <a href="https:&#x2F;&#x2F;github.com&#x2F;WICG&#x2F;webcomponents&#x2F;issues&#x2F;1002">https:&#x2F;&#x2F;github.com&#x2F;WICG&#x2F;webcomponents&#x2F;issues&#x2F;1002</a></div><br/><div id="40899922" class="c"><input type="checkbox" id="c-40899922" checked=""/><div class="controls bullet"><span class="by">m1el</span><span>|</span><a href="#40898641">root</a><span>|</span><a href="#40898985">parent</a><span>|</span><a href="#40899157">next</a><span>|</span><label class="collapse" for="c-40899922">[-]</label><label class="expand" for="c-40899922">[2 more]</label></div><br/><div class="children"><div class="content">Salesforce sandboxing is too easy to escape. Last time I needed to implement some feature for Salesforce, I&#x27;ve encountered 4 different escapes. It was also horrible dev experience.</div><br/><div id="40902261" class="c"><input type="checkbox" id="c-40902261" checked=""/><div class="controls bullet"><span class="by">spankalee</span><span>|</span><a href="#40898641">root</a><span>|</span><a href="#40899922">parent</a><span>|</span><a href="#40899157">next</a><span>|</span><label class="collapse" for="c-40902261">[-]</label><label class="expand" for="c-40902261">[1 more]</label></div><br/><div class="children"><div class="content">I would love to hear more about that. I&#x27;m looking into their approach for a plug-in system myself.</div><br/></div></div></div></div><div id="40899157" class="c"><input type="checkbox" id="c-40899157" checked=""/><div class="controls bullet"><span class="by">cxr</span><span>|</span><a href="#40898641">root</a><span>|</span><a href="#40898985">parent</a><span>|</span><a href="#40899922">prev</a><span>|</span><a href="#40898718">next</a><span>|</span><label class="collapse" for="c-40899157">[-]</label><label class="expand" for="c-40899157">[1 more]</label></div><br/><div class="children"><div class="content">You can also check out the discussion for Figma&#x27;s earlier work on their plugin system, which is what inspired jitl (above) to create quickjs-emscripten.  Previously:<p><i>How to build a plugin system on the web and also sleep well at night</i>. &lt;<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20770105">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20770105</a>&gt; 2019 August 22.  89 comments.</div><br/></div></div></div></div><div id="40898718" class="c"><input type="checkbox" id="c-40898718" checked=""/><div class="controls bullet"><span class="by">cxr</span><span>|</span><a href="#40898641">parent</a><span>|</span><a href="#40898985">prev</a><span>|</span><a href="#40901718">next</a><span>|</span><label class="collapse" for="c-40898718">[-]</label><label class="expand" for="c-40898718">[1 more]</label></div><br/><div class="children"><div class="content">The closest thing I know of is Allen Wirfs-Brock&#x27;s jsmirrors prototype, but he never got to speccing out anything for DOM (and never really intended to as far as I know).  Just capabilities for JS-the-programming-system.<p>You could look at jsmirrors for inspiration and take a crack at some sort of &quot;dommirrors&quot; yourself, but it&#x27;s big undertaking.  (There&#x27;s a roundabout way to go about using jsmirrors as-is to kind of achieve what you want, but it&#x27;s not ergonomic.)<p>That being said, giving access to the DOM, even mediated&#x2F;simulated, is almost certainly not what you really want.  Figure out what you _actually_ want to allow the other side to do, and then just give them a capability that lets them do it.  (For example, to let them add a button somewhere, you might think you need to give them an anchor point (parent element) where they can insert it and let them use `document.createElement` to make the DOM node that they&#x27;re going to put there.  But you don&#x27;t actually want that—for them to have access to `document.createElement`, etc.  What you want is for them to have an add-button capability.  So give them <i>that</i>—go implement `addButton`.)<p>Moar: &lt;<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30703531#30706060">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30703531#30706060</a>&gt;<p>PS: don&#x27;t listen to anyone who comes along and says that this is what CSP is for.  It&#x27;s not.  (If we&#x27;re being accurate, even for what CSP really is for, it&#x27;s poorly designed, user-hostile junk and should never have been implemented or extended as far as it has been.)  It&#x27;s dangerous to depend on it.</div><br/></div></div><div id="40901718" class="c"><input type="checkbox" id="c-40901718" checked=""/><div class="controls bullet"><span class="by">austin-cheney</span><span>|</span><a href="#40898641">parent</a><span>|</span><a href="#40898718">prev</a><span>|</span><a href="#40901496">next</a><span>|</span><label class="collapse" for="c-40901718">[-]</label><label class="expand" for="c-40901718">[2 more]</label></div><br/><div class="children"><div class="content">Off the top of my head the way I would this:<p>* On the back end request the third party code and then associate that code with a hash sequence.<p>+ On the backend dynamically modify the html such that there is a div tag with an id whose value is the hash sequence. Also modify the html such that there is a script tag that requests the third party code from your domain. For tracking purposes you add the hash value to a data attribute on that script tag.<p>* On the back end modify that third party code such that all instances of <i>document.</i> and <i>window.</i> are replaced by <i>document.getElementById(hash_value).</i> and all query selectors begin with <i>#hash_value</i>.<p>* You would to replace <i>.parentNode</i> in the Element prototype with a custom property that checks for and drops escape from the providdd container.<p>Then send the html document to the browser. If the third party code breaks that is ok. The constraints should be communicated to the third party and it’s up to them to test their own code before sending it to your server. All you care about is that their code does not escape the dynamically provided container. Test this regularly on your side to look for security violations.<p>Also, this may not work, but it would be fun to experiment with.</div><br/><div id="40903420" class="c"><input type="checkbox" id="c-40903420" checked=""/><div class="controls bullet"><span class="by">dawnerd</span><span>|</span><a href="#40898641">root</a><span>|</span><a href="#40901718">parent</a><span>|</span><a href="#40901496">next</a><span>|</span><label class="collapse" for="c-40903420">[-]</label><label class="expand" for="c-40903420">[1 more]</label></div><br/><div class="children"><div class="content">That seems like it’s pretty fragile though. I’d be really worried about all the weird edge cases</div><br/></div></div></div></div></div></div><div id="40901496" class="c"><input type="checkbox" id="c-40901496" checked=""/><div class="controls bullet"><span class="by">frabjoused</span><span>|</span><a href="#40898641">prev</a><span>|</span><a href="#40902145">next</a><span>|</span><label class="collapse" for="c-40901496">[-]</label><label class="expand" for="c-40901496">[1 more]</label></div><br/><div class="children"><div class="content">Coincidentally I was trying out quickjs last week and ultimately ended up settling on isolated-vm instead as both met our security contrasts, however isolated-vm ended up being far more performant in terms of setup, teardown and eval execution overhead.</div><br/></div></div><div id="40902145" class="c"><input type="checkbox" id="c-40902145" checked=""/><div class="controls bullet"><span class="by">leohart</span><span>|</span><a href="#40901496">prev</a><span>|</span><a href="#40898029">next</a><span>|</span><label class="collapse" for="c-40902145">[-]</label><label class="expand" for="c-40902145">[2 more]</label></div><br/><div class="children"><div class="content">This is awesome. With this, I would be able to run JS code that my user provides. I have been looking for a way to bundle my user Typescript code using a bundler in a sandbox environment. Any recommendation on ways to run a bundler (webpack&#x2F;...) in QuickJS?</div><br/><div id="40903030" class="c"><input type="checkbox" id="c-40903030" checked=""/><div class="controls bullet"><span class="by">idle_zealot</span><span>|</span><a href="#40902145">parent</a><span>|</span><a href="#40898029">next</a><span>|</span><label class="collapse" for="c-40903030">[-]</label><label class="expand" for="c-40903030">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know about using QJS, but if you want to run a bundler in the browser that sounds like the sort of thing that WebContainers[1] were built for.<p>[1]: <a href="https:&#x2F;&#x2F;webcontainers.io&#x2F;" rel="nofollow">https:&#x2F;&#x2F;webcontainers.io&#x2F;</a></div><br/></div></div></div></div><div id="40898029" class="c"><input type="checkbox" id="c-40898029" checked=""/><div class="controls bullet"><span class="by">emurlin</span><span>|</span><a href="#40902145">prev</a><span>|</span><a href="#40897810">next</a><span>|</span><label class="collapse" for="c-40898029">[-]</label><label class="expand" for="c-40898029">[4 more]</label></div><br/><div class="children"><div class="content">Interesting approach! As an author of another JS sandbox library[1] that uses workers for isolation plus some JS environment sanitisation techniques, I think that interpreting JS (so, JS-in-JS, or as in this case, JS-in-WASM) gives you the highest level of isolation, and also doesn&#x27;t directly expose you to bugs in the host JS virtual machine itself. Since you&#x27;re targeting Node, this is perhaps even more important because (some newer developments notwithstanding) Node.js doesn&#x27;t really seem to have been designed with isolation and sandboxing in mind (unlike, say, Deno).<p>From the API, I don&#x27;t see if `createRuntime` allows you to define calls to the host environment (other than for `fetch`). This would be quite a useful feature, especially because you could use it to restrict communication with the outside world in a controlled way, without it being an all-or-nothing proposition.<p>Likewise, it doesn&#x27;t seem to support the browser (at least, running a quick check with esm.sh). I think that that could be a useful feature too.<p>I&#x27;ll run some tests as I&#x27;m curious what the overhead is in this case, but like I said, this sounds like a pretty solid approach.<p>[1] @exact-realty&#x2F;lot</div><br/><div id="40898050" class="c"><input type="checkbox" id="c-40898050" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40898029">parent</a><span>|</span><a href="#40897810">next</a><span>|</span><label class="collapse" for="c-40898050">[-]</label><label class="expand" for="c-40898050">[3 more]</label></div><br/><div class="children"><div class="content">I’m the author of the underlying quickjs-emscripten library. It supports the browser (specifically tested with ESM.sh), as well as Cloudflare Workers, NodeJS, Deno: <a href="https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten?tab=readme-ov-file#supported-platforms">https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten?tab=readme-ov...</a><p>It has APIs for exposing host functions, calling guest functions, custom module loaders, etc: <a href="https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten?tab=readme-ov-file#exposing-apis">https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten?tab=readme-ov...</a><p>API docs for newFunction: <a href="https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten&#x2F;blob&#x2F;main&#x2F;doc&#x2F;quickjs-emscripten&#x2F;classes&#x2F;QuickJSContext.md#newfunction">https:&#x2F;&#x2F;github.com&#x2F;justjake&#x2F;quickjs-emscripten&#x2F;blob&#x2F;main&#x2F;doc...</a></div><br/><div id="40898822" class="c"><input type="checkbox" id="c-40898822" checked=""/><div class="controls bullet"><span class="by">brigadier132</span><span>|</span><a href="#40898029">root</a><span>|</span><a href="#40898050">parent</a><span>|</span><a href="#40897810">next</a><span>|</span><label class="collapse" for="c-40898822">[-]</label><label class="expand" for="c-40898822">[2 more]</label></div><br/><div class="children"><div class="content">Wow cloudflare workers support is actually super cool. How does it limit memory usage?</div><br/><div id="40898886" class="c"><input type="checkbox" id="c-40898886" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40898029">root</a><span>|</span><a href="#40898822">parent</a><span>|</span><a href="#40897810">next</a><span>|</span><label class="collapse" for="c-40898886">[-]</label><label class="expand" for="c-40898886">[1 more]</label></div><br/><div class="children"><div class="content">The quickjs interpreter C code counts the bytes it&#x27;s allocated, and refuses to allocate more if over the limit. It decrements by the allocation size when freed. This malloc function is used everywhere the interpreter allocates memory:<p><pre><code>    static void *js_def_malloc(JSMallocState *s, size_t size)
    {
        void *ptr;
    
        &#x2F;* Do not allocate zero bytes: behavior is platform dependent *&#x2F;
        assert(size != 0);
    
        if (unlikely(s-&gt;malloc_size + size &gt; s-&gt;malloc_limit))
            return NULL;
    
        ptr = malloc(size);
        if (!ptr)
            return NULL;
    
        s-&gt;malloc_count++;
        s-&gt;malloc_size += js_def_malloc_usable_size(ptr) + MALLOC_OVERHEAD;
        return ptr;
    }</code></pre></div><br/></div></div></div></div></div></div></div></div><div id="40897810" class="c"><input type="checkbox" id="c-40897810" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40898029">prev</a><span>|</span><a href="#40902188">next</a><span>|</span><label class="collapse" for="c-40897810">[-]</label><label class="expand" for="c-40897810">[6 more]</label></div><br/><div class="children"><div class="content">i wouldn’t say  “performance” as an advantage of running JS in QuickJS. QuickJS isn’t competitive at all with the host JS VM, although I guess it’s faster than older C interpreters, or an interpreter implemented in JavaScript.</div><br/><div id="40898486" class="c"><input type="checkbox" id="c-40898486" checked=""/><div class="controls bullet"><span class="by">math_dandy</span><span>|</span><a href="#40897810">parent</a><span>|</span><a href="#40902188">next</a><span>|</span><label class="collapse" for="c-40898486">[-]</label><label class="expand" for="c-40898486">[5 more]</label></div><br/><div class="children"><div class="content">I suppose you get performance benefits if the the time it takes to start up a nodejs process dominates the execution time of the script. This is probably the case for a decent proportion of “serverless function” type scripts.</div><br/><div id="40902007" class="c"><input type="checkbox" id="c-40902007" checked=""/><div class="controls bullet"><span class="by">throwitaway1123</span><span>|</span><a href="#40897810">root</a><span>|</span><a href="#40898486">parent</a><span>|</span><a href="#40898839">next</a><span>|</span><label class="collapse" for="c-40902007">[-]</label><label class="expand" for="c-40902007">[1 more]</label></div><br/><div class="children"><div class="content">Yup, AWS actually created a JS runtime called LLRT (Low Latency Runtime) based on QuickJS exactly for this purpose (reducing Lambda function cold start time). The Syntax podcast just released an episode with one of the developers behind LLRT.</div><br/></div></div><div id="40898839" class="c"><input type="checkbox" id="c-40898839" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40897810">root</a><span>|</span><a href="#40898486">parent</a><span>|</span><a href="#40902007">prev</a><span>|</span><a href="#40902188">next</a><span>|</span><label class="collapse" for="c-40898839">[-]</label><label class="expand" for="c-40898839">[3 more]</label></div><br/><div class="children"><div class="content">This library expects to run inside a Javascript runtime like NodeJS, so you&#x27;re always going to pay for the enclosing Javascript runtime to start.</div><br/><div id="40899743" class="c"><input type="checkbox" id="c-40899743" checked=""/><div class="controls bullet"><span class="by">ijustlovemath</span><span>|</span><a href="#40897810">root</a><span>|</span><a href="#40898839">parent</a><span>|</span><a href="#40902188">next</a><span>|</span><label class="collapse" for="c-40899743">[-]</label><label class="expand" for="c-40899743">[2 more]</label></div><br/><div class="children"><div class="content">Not true, QuickJS works completely standalone. I&#x27;ve used it to compile NodeJS libraries into standalone libraries that other C libraries can call, even on a system without a NodeJS install.</div><br/><div id="40902114" class="c"><input type="checkbox" id="c-40902114" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#40897810">root</a><span>|</span><a href="#40899743">parent</a><span>|</span><a href="#40902188">next</a><span>|</span><label class="collapse" for="c-40902114">[-]</label><label class="expand" for="c-40902114">[1 more]</label></div><br/><div class="children"><div class="content">This post is about a quickjs-in-node library that wraps the quickjs C library, not quickjs itself. My original comment is responding to a comment by the author of the library.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40902188" class="c"><input type="checkbox" id="c-40902188" checked=""/><div class="controls bullet"><span class="by">WatchDog</span><span>|</span><a href="#40897810">prev</a><span>|</span><a href="#40901415">next</a><span>|</span><label class="collapse" for="c-40902188">[-]</label><label class="expand" for="c-40902188">[1 more]</label></div><br/><div class="children"><div class="content">I had started working on something very similar to this, a higher level wrapper for quickjs-emscripten.<p>quickjs-emscripten is great, but it&#x27;s API is deliberately very close to quickjs&#x27;s C API.  
It can be quite difficult to use directly, and implementing support for loading libraries is non-trivial, especially if any of those libraries depend on certain nodejs or browser APIs.<p>Implementing support for `require()` is tricky, because it&#x27;s a blocking API, so doing any async IO to fetch module code is not possible unless you either:<p>- Use the asyncifyed version of quickjs-emscripten(slower and more difficult to use)
- Use blocking IO to load modules(not ideal).
- Pre-load all module files into an in-memory filesystem(which is what is sounds like this lib is doing).<p>I haven&#x27;t looked much into how the quickjs-emscripten-sync library works exactly, but automatic syncronization of host and guest functions, seems like it could be a big attack surface, and I worry that it might be possible to escape the sandbox with it somehow.</div><br/></div></div><div id="40901415" class="c"><input type="checkbox" id="c-40901415" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#40902188">prev</a><span>|</span><a href="#40897341">next</a><span>|</span><label class="collapse" for="c-40901415">[-]</label><label class="expand" for="c-40901415">[3 more]</label></div><br/><div class="children"><div class="content">I thought you could safely sandbox code via an iframe, though I&#x27;m not certain. Of course using your own interpreter might allow for more features, like tighter timeouts, custom APIs, etc.</div><br/><div id="40902118" class="c"><input type="checkbox" id="c-40902118" checked=""/><div class="controls bullet"><span class="by">firtoz</span><span>|</span><a href="#40901415">parent</a><span>|</span><a href="#40902125">next</a><span>|</span><label class="collapse" for="c-40902118">[-]</label><label class="expand" for="c-40902118">[1 more]</label></div><br/><div class="children"><div class="content">I would like to know more about this too, especially when you add service workers into the mix.<p>I am currently using an iframe that accepts code with a window message and it can evaluate the input code and respond with a window message back, which works quite well, but I am unsure if there may be holes out of the sandbox<p>For more complicated things for example package dependencies I tried parsing them with Babel then producing an import map with cdns (esm.sh) but in some cases the cdnified versions don&#x27;t work well<p>So I used stackblitz which kinda works well but has some issues in non secure contexts<p>So I ended up coding a little web server that takes in the code and dependencies (package.json) and does a vite build inside a docker container and sends the output back, it&#x27;s working decently but can be slow sometimes<p>Doing a build completely on the client would be great, which is kinda what stackblitz does</div><br/></div></div><div id="40902125" class="c"><input type="checkbox" id="c-40902125" checked=""/><div class="controls bullet"><span class="by">hackcasual</span><span>|</span><a href="#40901415">parent</a><span>|</span><a href="#40902118">prev</a><span>|</span><a href="#40897341">next</a><span>|</span><label class="collapse" for="c-40902125">[-]</label><label class="expand" for="c-40902125">[1 more]</label></div><br/><div class="children"><div class="content">IFrames are over-permissioned. For example an iFrame can exfiltrate data to a 3rd party</div><br/></div></div></div></div><div id="40897341" class="c"><input type="checkbox" id="c-40897341" checked=""/><div class="controls bullet"><span class="by">brigadier132</span><span>|</span><a href="#40901415">prev</a><span>|</span><a href="#40897986">next</a><span>|</span><label class="collapse" for="c-40897341">[-]</label><label class="expand" for="c-40897341">[1 more]</label></div><br/><div class="children"><div class="content">Very cool. Since this is compiled to wasm can this run in the browser? It would be interesting if it could and still make fetch requests without attaching cookies to the request.</div><br/></div></div><div id="40897986" class="c"><input type="checkbox" id="c-40897986" checked=""/><div class="controls bullet"><span class="by">anonymousd3vil</span><span>|</span><a href="#40897341">prev</a><span>|</span><a href="#40899513">next</a><span>|</span><label class="collapse" for="c-40897986">[-]</label><label class="expand" for="c-40897986">[3 more]</label></div><br/><div class="children"><div class="content">so we come to a full circle</div><br/><div id="40898369" class="c"><input type="checkbox" id="c-40898369" checked=""/><div class="controls bullet"><span class="by">degurechaff</span><span>|</span><a href="#40897986">parent</a><span>|</span><a href="#40898133">next</a><span>|</span><label class="collapse" for="c-40898369">[-]</label><label class="expand" for="c-40898369">[1 more]</label></div><br/><div class="children"><div class="content">now we just need wasm intepreter in js. so we can run this package to run javascript to run wasm intepreter and so on..</div><br/></div></div><div id="40898133" class="c"><input type="checkbox" id="c-40898133" checked=""/><div class="controls bullet"><span class="by">TheRealPomax</span><span>|</span><a href="#40897986">parent</a><span>|</span><a href="#40898369">prev</a><span>|</span><a href="#40899513">next</a><span>|</span><label class="collapse" for="c-40898133">[-]</label><label class="expand" for="c-40898133">[1 more]</label></div><br/><div class="children"><div class="content">Spiral. Not circle. Having something run in itself is as old as the need to safely run something in order to see if it&#x27;s going to blow up or not, though. If people aren&#x27;t trying to write things so your general use programming environment can virtualize itself, it&#x27;s basically not used seriously enough yet.</div><br/></div></div></div></div><div id="40899513" class="c"><input type="checkbox" id="c-40899513" checked=""/><div class="controls bullet"><span class="by">FpUser</span><span>|</span><a href="#40897986">prev</a><span>|</span><a href="#40898064">next</a><span>|</span><label class="collapse" for="c-40899513">[-]</label><label class="expand" for="c-40899513">[1 more]</label></div><br/><div class="children"><div class="content">CPU got too fast so let&#x27;s run interpreter inside interpreter.</div><br/></div></div><div id="40898064" class="c"><input type="checkbox" id="c-40898064" checked=""/><div class="controls bullet"><span class="by">jiripospisil</span><span>|</span><a href="#40899513">prev</a><span>|</span><a href="#40898977">next</a><span>|</span><label class="collapse" for="c-40898064">[-]</label><label class="expand" for="c-40898064">[1 more]</label></div><br/><div class="children"><div class="content">See also <a href="https:&#x2F;&#x2F;bytecodealliance.org&#x2F;articles&#x2F;javy-hosted-project" rel="nofollow">https:&#x2F;&#x2F;bytecodealliance.org&#x2F;articles&#x2F;javy-hosted-project</a></div><br/></div></div><div id="40898977" class="c"><input type="checkbox" id="c-40898977" checked=""/><div class="controls bullet"><span class="by">waldrews</span><span>|</span><a href="#40898064">prev</a><span>|</span><a href="#40897306">next</a><span>|</span><label class="collapse" for="c-40898977">[-]</label><label class="expand" for="c-40898977">[1 more]</label></div><br/><div class="children"><div class="content">Yes!  Now, we just have to run this inside a browser, which will run inside a container, which will run inside a VM, which will run on an emulation layer...</div><br/></div></div><div id="40897306" class="c"><input type="checkbox" id="c-40897306" checked=""/><div class="controls bullet"><span class="by">bluelightning2k</span><span>|</span><a href="#40898977">prev</a><span>|</span><a href="#40902027">next</a><span>|</span><label class="collapse" for="c-40897306">[-]</label><label class="expand" for="c-40897306">[2 more]</label></div><br/><div class="children"><div class="content">Oh very nice! Guessing there isn&#x27;t support for node modules but still very cool.</div><br/></div></div><div id="40902027" class="c"><input type="checkbox" id="c-40902027" checked=""/><div class="controls bullet"><span class="by">EGreg</span><span>|</span><a href="#40897306">prev</a><span>|</span><a href="#40899374">next</a><span>|</span><label class="collapse" for="c-40902027">[-]</label><label class="expand" for="c-40902027">[1 more]</label></div><br/><div class="children"><div class="content">How can I make sure the iframe cannot make any requests to any servers, including WebSockets?<p>Also what happens if the code has infinite loops? Is there an ability to pause execution? That woukd be helpful</div><br/></div></div><div id="40899374" class="c"><input type="checkbox" id="c-40899374" checked=""/><div class="controls bullet"><span class="by">djaouen</span><span>|</span><a href="#40902027">prev</a><span>|</span><a href="#40899600">next</a><span>|</span><label class="collapse" for="c-40899374">[-]</label><label class="expand" for="c-40899374">[1 more]</label></div><br/><div class="children"><div class="content">If you’re on wasm, why not just use Elixir and be done with it?</div><br/></div></div><div id="40899600" class="c"><input type="checkbox" id="c-40899600" checked=""/><div class="controls bullet"><span class="by">owenpalmer</span><span>|</span><a href="#40899374">prev</a><span>|</span><a href="#40897614">next</a><span>|</span><label class="collapse" for="c-40899600">[-]</label><label class="expand" for="c-40899600">[1 more]</label></div><br/><div class="children"><div class="content">This is an xkcd waiting to happen</div><br/></div></div><div id="40897614" class="c"><input type="checkbox" id="c-40897614" checked=""/><div class="controls bullet"><span class="by">revskill</span><span>|</span><a href="#40899600">prev</a><span>|</span><a href="#40899518">next</a><span>|</span><label class="collapse" for="c-40897614">[-]</label><label class="expand" for="c-40897614">[2 more]</label></div><br/><div class="children"><div class="content">Does it support browser ?</div><br/><div id="40897983" class="c"><input type="checkbox" id="c-40897983" checked=""/><div class="controls bullet"><span class="by">dualogy</span><span>|</span><a href="#40897614">parent</a><span>|</span><a href="#40899518">next</a><span>|</span><label class="collapse" for="c-40897983">[-]</label><label class="expand" for="c-40897983">[1 more]</label></div><br/><div class="children"><div class="content">Pick one of the wasm runtimes written in JS listed at <a href="https:&#x2F;&#x2F;github.com&#x2F;appcypher&#x2F;awesome-wasm-runtimes">https:&#x2F;&#x2F;github.com&#x2F;appcypher&#x2F;awesome-wasm-runtimes</a> and find out  =)</div><br/></div></div></div></div><div id="40899518" class="c"><input type="checkbox" id="c-40899518" checked=""/><div class="controls bullet"><span class="by">devwastaken</span><span>|</span><a href="#40897614">prev</a><span>|</span><a href="#40896874">next</a><span>|</span><label class="collapse" for="c-40899518">[-]</label><label class="expand" for="c-40899518">[2 more]</label></div><br/><div class="children"><div class="content">You cannot throw things into wasm and call it safe. It is wholly irresponsible. You need to do the work to ensure it&#x27;s safe to a theory and in practice.</div><br/><div id="40899524" class="c"><input type="checkbox" id="c-40899524" checked=""/><div class="controls bullet"><span class="by">brigadier132</span><span>|</span><a href="#40899518">parent</a><span>|</span><a href="#40896874">next</a><span>|</span><label class="collapse" for="c-40899524">[-]</label><label class="expand" for="c-40899524">[1 more]</label></div><br/><div class="children"><div class="content">quickjs with wasm can be considered secure before different system apis are introduced</div><br/></div></div></div></div><div id="40897632" class="c"><input type="checkbox" id="c-40897632" checked=""/><div class="controls bullet"><span class="by">jojobas</span><span>|</span><a href="#40896874">prev</a><span>|</span><label class="collapse" for="c-40897632">[-]</label><label class="expand" for="c-40897632">[6 more]</label></div><br/><div class="children"><div class="content">I thought the whole purpose of WebAssembly was <i>not</i> to execute any JavaScript.</div><br/><div id="40897657" class="c"><input type="checkbox" id="c-40897657" checked=""/><div class="controls bullet"><span class="by">brigadier132</span><span>|</span><a href="#40897632">parent</a><span>|</span><a href="#40898378">next</a><span>|</span><label class="collapse" for="c-40897657">[-]</label><label class="expand" for="c-40897657">[1 more]</label></div><br/><div class="children"><div class="content">Well you&#x27;d be mistaken. The point of WebAssembly is to run any language that compiles to WebAssembly in a secure sandbox.</div><br/></div></div><div id="40898378" class="c"><input type="checkbox" id="c-40898378" checked=""/><div class="controls bullet"><span class="by">anon115</span><span>|</span><a href="#40897632">parent</a><span>|</span><a href="#40897657">prev</a><span>|</span><a href="#40897837">next</a><span>|</span><label class="collapse" for="c-40898378">[-]</label><label class="expand" for="c-40898378">[1 more]</label></div><br/><div class="children"><div class="content">moew meoew moewm meow moew meow XDD 
the point of wasm is to play video games on the browser.</div><br/></div></div><div id="40897647" class="c"><input type="checkbox" id="c-40897647" checked=""/><div class="controls bullet"><span class="by">mirekrusin</span><span>|</span><a href="#40897632">parent</a><span>|</span><a href="#40897837">prev</a><span>|</span><label class="collapse" for="c-40897647">[-]</label><label class="expand" for="c-40897647">[1 more]</label></div><br/><div class="children"><div class="content">Too late, he didn&#x27;t know.</div><br/></div></div></div></div></div></div></div></div></div></body></html>