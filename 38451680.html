<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1701334879169" as="style"/><link rel="stylesheet" href="styles.css?v=1701334879169"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://herbie.uwplse.org/">Herbie: Find and fix floating-point accuracy problems</a> <span class="domain">(<a href="https://herbie.uwplse.org">herbie.uwplse.org</a>)</span></div><div class="subtext"><span>PaulHoule</span> | <span>10 comments</span></div><br/><div><div id="38470276" class="c"><input type="checkbox" id="c-38470276" checked=""/><div class="controls bullet"><span class="by">bee_rider</span><span>|</span><a href="#38469416">next</a><span>|</span><label class="collapse" for="c-38470276">[-]</label><label class="expand" for="c-38470276">[3 more]</label></div><br/><div class="children"><div class="content">I tried 1&#x2F;sqrt(9x-6) from .7 to 1e308, and got as one alternative<p>sqrt(-.16666…)<p>It did correctly mark this as 0% accurate, but I’m kinda curious as to where it came from.<p>It does have a 1.1x speedup apparently. None of the other (more accurate) options provide a speedup. Maybe there aren’t any value options that provide a speedup, but the tool allows increasingly reduced accuracy (down to zero) until it finds a speedup?</div><br/><div id="38470486" class="c"><input type="checkbox" id="c-38470486" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#38470276">parent</a><span>|</span><a href="#38470527">next</a><span>|</span><label class="collapse" for="c-38470486">[-]</label><label class="expand" for="c-38470486">[1 more]</label></div><br/><div class="children"><div class="content">You can click &quot;derivation&quot; to see the exact process it was derived. It&#x27;s the first term of a taylor series expansion around x = 0, which is indeed f(0) = 1&#x2F;sqrt(9*0-6) = sqrt(-1&#x2F;6). I&#x27;m not sure why x was chosen outside of its input domain though.<p>----<p>ADDED LATER: I think I have the answer. Herbie seems to always assume x = 0, but there are a fixed set of transformations to get around that fact. Currently it only tries f(x), 1&#x2F;f(x) and 1&#x2F;-f(x) [1].<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;herbie-fp&#x2F;herbie&#x2F;blob&#x2F;b4a4bb4c61749912a64362f254d4eb69a075e50f&#x2F;src&#x2F;patch.rkt#L57-L64">https:&#x2F;&#x2F;github.com&#x2F;herbie-fp&#x2F;herbie&#x2F;blob&#x2F;b4a4bb4c61749912a64...</a><p>&gt; Maybe there aren’t any value options that provide a speedup, but the tool allows increasingly reduced accuracy (down to zero) until it finds a speedup?<p>AFAIK Herbie works by trying a bunch of transformations to get candidate expressions and evaluate them to get the pareto frontier. So if there is a single constant expression generated, it will always be available as the worst alternative.</div><br/></div></div><div id="38470527" class="c"><input type="checkbox" id="c-38470527" checked=""/><div class="controls bullet"><span class="by">AlotOfReading</span><span>|</span><a href="#38470276">parent</a><span>|</span><a href="#38470486">prev</a><span>|</span><a href="#38469416">next</a><span>|</span><label class="collapse" for="c-38470527">[-]</label><label class="expand" for="c-38470527">[1 more]</label></div><br/><div class="children"><div class="content">Aside from the alternative, there&#x27;s not much room to optimize that function. 1&#x2F;sqrt(x) has pretty good approximations (e.g. fast inverse sqrt, reciprocal sqrt instructions) and 9x-6 is just FMA. A quick test with compiler explorer [1] shows 4 instructions, and you could probably do 3 with judicious instruction set choice and&#x2F;or no regard for performance. Even a lookup table could be slower in practice, depending on what the rest of the program looks like.<p>[1] <a href="https:&#x2F;&#x2F;godbolt.org&#x2F;z&#x2F;86P86xTvx" rel="nofollow noreferrer">https:&#x2F;&#x2F;godbolt.org&#x2F;z&#x2F;86P86xTvx</a></div><br/></div></div></div></div><div id="38469416" class="c"><input type="checkbox" id="c-38469416" checked=""/><div class="controls bullet"><span class="by">RevEng</span><span>|</span><a href="#38470276">prev</a><span>|</span><a href="#38469081">next</a><span>|</span><label class="collapse" for="c-38469416">[-]</label><label class="expand" for="c-38469416">[3 more]</label></div><br/><div class="children"><div class="content">Very cool! I&#x27;ve run into some of these kinds of issues myself in my daily work and it took a long time to both discover the other and a solution. I&#x27;ll definitely try this out to see if it can help me find and fix these kinds of issues faster.</div><br/><div id="38470213" class="c"><input type="checkbox" id="c-38470213" checked=""/><div class="controls bullet"><span class="by">ashton314</span><span>|</span><a href="#38469416">parent</a><span>|</span><a href="#38469081">next</a><span>|</span><label class="collapse" for="c-38470213">[-]</label><label class="expand" for="c-38470213">[2 more]</label></div><br/><div class="children"><div class="content">Where do you work? Not many people run into fp accuracy issues.</div><br/><div id="38470959" class="c"><input type="checkbox" id="c-38470959" checked=""/><div class="controls bullet"><span class="by">ReleaseCandidat</span><span>|</span><a href="#38469416">root</a><span>|</span><a href="#38470213">parent</a><span>|</span><a href="#38469081">next</a><span>|</span><label class="collapse" for="c-38470959">[-]</label><label class="expand" for="c-38470959">[1 more]</label></div><br/><div class="children"><div class="content">Well, chances are if you think you don&#x27;t, you already do.<p>There is a reason a big part of numerics (the mathematical disciplíne) is about dealing with it.</div><br/></div></div></div></div></div></div><div id="38469081" class="c"><input type="checkbox" id="c-38469081" checked=""/><div class="controls bullet"><span class="by">ashton314</span><span>|</span><a href="#38469416">prev</a><span>|</span><a href="#38470176">next</a><span>|</span><label class="collapse" for="c-38469081">[-]</label><label class="expand" for="c-38469081">[1 more]</label></div><br/><div class="children"><div class="content">Hey! Some people in my lab work on that! I also did some work on analyzing floating point exceptions, so I learned a bit about this stuff. AMA, and I’ll do my best to answer. :)<p>(For clarification, I work at the University of Utah, so Pavel is the head honcho over Herbie here.)</div><br/></div></div><div id="38470176" class="c"><input type="checkbox" id="c-38470176" checked=""/><div class="controls bullet"><span class="by">YoshiRulz</span><span>|</span><a href="#38469081">prev</a><span>|</span><a href="#38469835">next</a><span>|</span><label class="collapse" for="c-38470176">[-]</label><label class="expand" for="c-38470176">[1 more]</label></div><br/><div class="children"><div class="content">This is cool! I&#x27;m now wondering if it&#x27;s possible to shell out to it from a Roslyn Analyzer (= C# compiler plugin). At the very least I&#x27;m sure I could automatically generate FPCore expressions from C# ASTs.</div><br/></div></div><div id="38469835" class="c"><input type="checkbox" id="c-38469835" checked=""/><div class="controls bullet"><span class="by">mcint</span><span>|</span><a href="#38470176">prev</a><span>|</span><label class="collapse" for="c-38469835">[-]</label><label class="expand" for="c-38469835">[1 more]</label></div><br/><div class="children"><div class="content">Excellent demo! It cool to see egraph transforms supported in producing alternative equations with different numerical stability properties. Nice end to end work!</div><br/></div></div></div></div></div></div></div></body></html>