<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1737363652207" as="style"/><link rel="stylesheet" href="styles.css?v=1737363652207"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://smallstep.com/blog/build-a-tiny-ca-with-raspberry-pi-yubikey/">Build a tiny CA for your homelab with a Raspberry Pi</a> <span class="domain">(<a href="https://smallstep.com">smallstep.com</a>)</span></div><div class="subtext"><span>timkq</span> | <span>48 comments</span></div><br/><div><div id="42761403" class="c"><input type="checkbox" id="c-42761403" checked=""/><div class="controls bullet"><span class="by">ostensible</span><span>|</span><a href="#42763945">next</a><span>|</span><label class="collapse" for="c-42761403">[-]</label><label class="expand" for="c-42761403">[14 more]</label></div><br/><div class="children"><div class="content">This being raspberry pi absolves you from needing to buy a separate hardware noise generator: it has plenty of GPIO. For example, one can obtain entropy by sampling random noise generated by reverse-biasing a junction in a cheap pn transistor. Here is an example: <a href="http:&#x2F;&#x2F;holdenc.altervista.org&#x2F;avalanche&#x2F;" rel="nofollow">http:&#x2F;&#x2F;holdenc.altervista.org&#x2F;avalanche&#x2F;</a>. Bonus — maybe it will get you hooked on electrical engineering!<p>Btw, some versions of raspberry pi already have hardware random number number generator accessible at 
&#x2F;dev&#x2F;hwrng.</div><br/><div id="42761770" class="c"><input type="checkbox" id="c-42761770" checked=""/><div class="controls bullet"><span class="by">myself248</span><span>|</span><a href="#42761403">parent</a><span>|</span><a href="#42764809">next</a><span>|</span><label class="collapse" for="c-42761770">[-]</label><label class="expand" for="c-42761770">[8 more]</label></div><br/><div class="children"><div class="content">How does the disconnected audio input of any random PC or thinclient compare?<p>I continue to find it a bit silly to see &quot;with a raspberry pi&quot; when people just mean &quot;with any random linux box that doesn&#x27;t need to be very powerful&quot;.<p>It&#x27;s like listening to NPR, where every smartphone is an iPhone even if it&#x27;s an Android, you know?</div><br/><div id="42762591" class="c"><input type="checkbox" id="c-42762591" checked=""/><div class="controls bullet"><span class="by">juliangoldsmith</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42761770">parent</a><span>|</span><a href="#42764809">next</a><span>|</span><label class="collapse" for="c-42762591">[-]</label><label class="expand" for="c-42762591">[7 more]</label></div><br/><div class="children"><div class="content">&gt;How does the disconnected audio input of any random PC or thinclient compare?<p>That will give you RF noise, which isn&#x27;t really random.</div><br/><div id="42763497" class="c"><input type="checkbox" id="c-42763497" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42762591">parent</a><span>|</span><a href="#42763323">next</a><span>|</span><label class="collapse" for="c-42763497">[-]</label><label class="expand" for="c-42763497">[3 more]</label></div><br/><div class="children"><div class="content">Electrical noise (including RF noise) is really random, as in it is impossible to predict exact value.<p>It does have non-flat spectrum, meaning some values are more probable than others, but that only means you need to whiten it.  (A rough analogy might be a 6-sided die labeled with 1,1,1,2,3,4 - yes, number 1 is much more likely to come out. No, this does not make it &quot;not really random&quot;, and some trivial math can produce ideal random stream out of it)<p>The only problem with audio input is that you may end up with non-random value - like all-zero output. But properly implemented whitener should detect this and stop outputting any value at all.</div><br/><div id="42764771" class="c"><input type="checkbox" id="c-42764771" checked=""/><div class="controls bullet"><span class="by">Keyframe</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42763497">parent</a><span>|</span><a href="#42763323">next</a><span>|</span><label class="collapse" for="c-42764771">[-]</label><label class="expand" for="c-42764771">[2 more]</label></div><br/><div class="children"><div class="content">it&#x27;s an often-made mistake where random generation &#x2F; randomness is confused with probability distribution. Having said that, I don&#x27;t know (as is in really don&#x27;t know) if RF noise is unbiased; doesn&#x27;t sound like it?</div><br/><div id="42764848" class="c"><input type="checkbox" id="c-42764848" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42764771">parent</a><span>|</span><a href="#42763323">next</a><span>|</span><label class="collapse" for="c-42764848">[-]</label><label class="expand" for="c-42764848">[1 more]</label></div><br/><div class="children"><div class="content">If you are talking about DC bias (as in, long term average of raw readings), then &quot;unconnected audio input&quot; is pretty likely to have it - it&#x27;s easy to introduce via component tolerances, and there is no real reason to keep it exactly zero for audio purposes. But it&#x27;s also pretty trivial to fix in software.<p>If you are talking bias in more general sense, then audio input noise is non-uniform in the frequency space, for example there is low-pass filter which filters out high input frequency, and it will affect noise values too. Good whitening algorithm is essential.<p>The good news however is there are many noise sources which are actually caused by quantum effects in electronic parts, and therefore completely unpredictable. Even if NSA recorded all RF noise, they still could not predict what the ADC will capture. (But they might be able to capture digital bits as they travel over the bus...)</div><br/></div></div></div></div></div></div><div id="42763323" class="c"><input type="checkbox" id="c-42763323" checked=""/><div class="controls bullet"><span class="by">evil-olive</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42762591">parent</a><span>|</span><a href="#42763497">prev</a><span>|</span><a href="#42764809">next</a><span>|</span><label class="collapse" for="c-42763323">[-]</label><label class="expand" for="c-42763323">[3 more]</label></div><br/><div class="children"><div class="content">&gt; That will give you RF noise, which isn&#x27;t really random.<p>what does &quot;really&quot; random even mean in this context? does it actually matter?<p>given 3 hypothetical devices in a homelab:<p>a) does no specialized hardware entropy collection, and instead relies entirely on the standard Linux kernel mechanisms<p>b) does entropy collection based on the RF noise that you&#x27;re saying isn&#x27;t &quot;really&quot; random<p>c) does entropy collection based on whatever mechanism you have in mind that generates &quot;real&quot; randomness (hand-carving bits of entropy out of quantum foam, or whatever)<p>even if your threat model includes &quot;the NSA tries to break into my homelab&quot;...device A will almost certainly be fine, they&#x27;ll have ways of getting access that are much simpler than compromising the entropy pool.<p>I suppose device B has a theoretical vulnerability that if the NSA had physical access to your homelab, they could monitor the RF environment, and then use that to predict what its inputs to the entropy pool were. but...that&#x27;s assuming they have physical access, and can plant arbitrary equipment of their own design. at that point, they don&#x27;t need to care about your entropy pool, you&#x27;re already compromised.</div><br/><div id="42764149" class="c"><input type="checkbox" id="c-42764149" checked=""/><div class="controls bullet"><span class="by">XorNot</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42763323">parent</a><span>|</span><a href="#42764809">next</a><span>|</span><label class="collapse" for="c-42764149">[-]</label><label class="expand" for="c-42764149">[2 more]</label></div><br/><div class="children"><div class="content">Suitably similar RSA keys well compromise each other.<p><a href="https:&#x2F;&#x2F;www.infoq.com&#x2F;news&#x2F;2019&#x2F;12&#x2F;rsa-iot-vulnerability&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.infoq.com&#x2F;news&#x2F;2019&#x2F;12&#x2F;rsa-iot-vulnerability&#x2F;</a><p>So bad randomness can let a remote attacker break them much more easily.</div><br/><div id="42764693" class="c"><input type="checkbox" id="c-42764693" checked=""/><div class="controls bullet"><span class="by">theamk</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42764149">parent</a><span>|</span><a href="#42764809">next</a><span>|</span><label class="collapse" for="c-42764693">[-]</label><label class="expand" for="c-42764693">[1 more]</label></div><br/><div class="children"><div class="content">No one puts raw bit source directly into private key, they always whiten it via some method (often entropy pool setup using strong hash&#x2F;encryption functions).<p>That means that even if you &quot;random inputs&quot; are totally predictable, the random values which come out of whitener are completely distinct, and generated RSA keys  have virtually zero chances of being similar.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="42764809" class="c"><input type="checkbox" id="c-42764809" checked=""/><div class="controls bullet"><span class="by">8xeh</span><span>|</span><a href="#42761403">parent</a><span>|</span><a href="#42761770">prev</a><span>|</span><a href="#42762821">next</a><span>|</span><label class="collapse" for="c-42764809">[-]</label><label class="expand" for="c-42764809">[1 more]</label></div><br/><div class="children"><div class="content">I was not aware of this! That&#x27;s kinda fun.<p>I did an entropy test on my Pi5 (according to <a href="https:&#x2F;&#x2F;rob-turner.net&#x2F;post&#x2F;raspberrypi-hwrng" rel="nofollow">https:&#x2F;&#x2F;rob-turner.net&#x2F;post&#x2F;raspberrypi-hwrng</a>), and it (7.999832 bits per byte) has about the same entropy as &#x2F;dev&#x2F;urandom (7.999831 bits per byte).<p>However, when using it directly, it&#x27;s pretty slow. &#x2F;dev&#x2F;hwrng is 200 KB&#x2F;s, &#x2F;dev&#x2F;urandom is 40 MB&#x2F;s.<p>Though, maybe that doesn&#x27;t matter if it&#x27;s just intended to be used to add entropy to the system entropy pool.</div><br/></div></div><div id="42762821" class="c"><input type="checkbox" id="c-42762821" checked=""/><div class="controls bullet"><span class="by">jcims</span><span>|</span><a href="#42761403">parent</a><span>|</span><a href="#42764809">prev</a><span>|</span><a href="#42761457">next</a><span>|</span><label class="collapse" for="c-42762821">[-]</label><label class="expand" for="c-42762821">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;d do this then three years later realize that something broke and it&#x27;s just been feeding zeroes for the last 18 months.</div><br/><div id="42762876" class="c"><input type="checkbox" id="c-42762876" checked=""/><div class="controls bullet"><span class="by">kevindamm</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42762821">parent</a><span>|</span><a href="#42763050">next</a><span>|</span><label class="collapse" for="c-42762876">[-]</label><label class="expand" for="c-42762876">[1 more]</label></div><br/><div class="children"><div class="content">good point, the project immediately after building the CA is to build a decent monitoring&#x2F;alerting setup.</div><br/></div></div><div id="42763050" class="c"><input type="checkbox" id="c-42763050" checked=""/><div class="controls bullet"><span class="by">FredPret</span><span>|</span><a href="#42761403">root</a><span>|</span><a href="#42762821">parent</a><span>|</span><a href="#42762876">prev</a><span>|</span><a href="#42761457">next</a><span>|</span><label class="collapse" for="c-42763050">[-]</label><label class="expand" for="c-42763050">[1 more]</label></div><br/><div class="children"><div class="content">Could still have been random<p><a href="https:&#x2F;&#x2F;xkcd.com&#x2F;221&#x2F;" rel="nofollow">https:&#x2F;&#x2F;xkcd.com&#x2F;221&#x2F;</a><p><a href="https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20011027002011&#x2F;http:&#x2F;&#x2F;dilbert.com&#x2F;comics&#x2F;dilbert&#x2F;archive&#x2F;images&#x2F;dilbert2001182781025.gif" rel="nofollow">https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20011027002011&#x2F;http:&#x2F;&#x2F;dilbert.co...</a></div><br/></div></div></div></div><div id="42761457" class="c"><input type="checkbox" id="c-42761457" checked=""/><div class="controls bullet"><span class="by">tashian</span><span>|</span><a href="#42761403">parent</a><span>|</span><a href="#42762821">prev</a><span>|</span><a href="#42763945">next</a><span>|</span><label class="collapse" for="c-42761457">[-]</label><label class="expand" for="c-42761457">[1 more]</label></div><br/><div class="children"><div class="content">I love this idea!</div><br/></div></div></div></div><div id="42763945" class="c"><input type="checkbox" id="c-42763945" checked=""/><div class="controls bullet"><span class="by">talkingtab</span><span>|</span><a href="#42761403">prev</a><span>|</span><a href="#42761373">next</a><span>|</span><label class="collapse" for="c-42763945">[-]</label><label class="expand" for="c-42763945">[2 more]</label></div><br/><div class="children"><div class="content">&quot;with a Yubikey&quot; is probably a better title. The yubikey thingy costs more than the PI (and there is a helpful link if you want to buy one).<p>Very little of this has to do with a PI, it seems like almost any kind of home server would work (especially linux). And it is unclear to me what value is added by the yubikey? And would any FIDO device work, or is this yubikey brand only?</div><br/><div id="42764050" class="c"><input type="checkbox" id="c-42764050" checked=""/><div class="controls bullet"><span class="by">tashian</span><span>|</span><a href="#42763945">parent</a><span>|</span><a href="#42761373">next</a><span>|</span><label class="collapse" for="c-42764050">[-]</label><label class="expand" for="c-42764050">[1 more]</label></div><br/><div class="children"><div class="content">Good point.<p>Primarily, the YubiKey is there to lock away the private key while making it available to the running CA. Certificate signing happens inside the YubiKey, and the CA private key is not exportable.<p>This uses the YubiKey PIV application, not FIDO.<p>As an aside, step-ca supports several approaches for key protection, but the YubiKey is relatively inexpensive.<p>Another fun approach is to use systemd-creds to help encrypt the CA&#x27;s private key password inside a TPM 2.0 module and tie it to PCR values, similar to what LUKS or BitLocker can do for auto disk unlocking based on system integrity. The Raspberry Pi doesn&#x27;t have TPM 2.0 but there are HATs available.</div><br/></div></div></div></div><div id="42761373" class="c"><input type="checkbox" id="c-42761373" checked=""/><div class="controls bullet"><span class="by">rmoriz</span><span>|</span><a href="#42763945">prev</a><span>|</span><a href="#42761668">next</a><span>|</span><label class="collapse" for="c-42761373">[-]</label><label class="expand" for="c-42761373">[7 more]</label></div><br/><div class="children"><div class="content">I&#x27;m running smallstep CA in my homelab. While it&#x27;s nicely done and clearly focuses to the containerized enterprise market, its defaults are very harsh.<p>Take for example the maximum certificate duration. While from a production&#x2F;security perspective short-lived certificates are great, you don&#x27;t want to renew certs in your homelab every 24-48hrs. Also, many things just don&#x27;t support ACME but still benefit from a valid certificate, e.g. router&#x2F;firewall&#x2F;appliance web interfaces. Out of the box, the limit for traditionally issued certificates using the CLI is very low, too.<p>The default prevents expired certificates to be renewed. If your homelab does not offer a couple of nines behind the comma, you&#x27;ll pretty much have to intervene on a regular basis UNLESS you adjust the defaults. You can&#x27;t set the max duration to years, months or days but only hours:<p><pre><code>  &quot;claims&quot;: {
     &quot;minTLSCertDuration&quot;: &quot;24h&quot;,
     &quot;maxTLSCertDuration&quot;: &quot;26400h&quot;,
     &quot;defaultTLSCertDuration&quot;: &quot;9000h&quot;
    },
</code></pre>
If the goal of hour homelab is to design&#x2F;test&#x2F;experiment with a fault-tolerant high availability k8s infra, e.g. for your job, it&#x27;s great.<p>CAVE: macOS enforces duration limits even for trusted enterprise CAs, e.g. Safari won&#x27;t accept your 1000 days certificate anymore.</div><br/><div id="42764789" class="c"><input type="checkbox" id="c-42764789" checked=""/><div class="controls bullet"><span class="by">akerl_</span><span>|</span><a href="#42761373">parent</a><span>|</span><a href="#42761570">next</a><span>|</span><label class="collapse" for="c-42764789">[-]</label><label class="expand" for="c-42764789">[2 more]</label></div><br/><div class="children"><div class="content">For what it&#x27;s worth, I&#x27;ve had quite a bit of success using ACME for devices that don&#x27;t natively support it by using a sidecar service.<p>Basically, running the ACME flow on a Linux system and then having it programmatically update the cert&#x2F;key for the service that needs it. Have done this for my NAS, printer, router, etc.</div><br/><div id="42765906" class="c"><input type="checkbox" id="c-42765906" checked=""/><div class="controls bullet"><span class="by">johntash</span><span>|</span><a href="#42761373">root</a><span>|</span><a href="#42764789">parent</a><span>|</span><a href="#42761570">next</a><span>|</span><label class="collapse" for="c-42765906">[-]</label><label class="expand" for="c-42765906">[1 more]</label></div><br/><div class="children"><div class="content">This is what I do as well.  I use acme.sh on one linux server to generate a cert with a few SANs on it, then copy that cert to things like opnsense&#x2F;truenas&#x2F;etc either using ssh or their api if there is one.</div><br/></div></div></div></div><div id="42761570" class="c"><input type="checkbox" id="c-42761570" checked=""/><div class="controls bullet"><span class="by">tashian</span><span>|</span><a href="#42761373">parent</a><span>|</span><a href="#42764789">prev</a><span>|</span><a href="#42764269">next</a><span>|</span><label class="collapse" for="c-42761570">[-]</label><label class="expand" for="c-42761570">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s true, the defaults are quite strict.<p>As for the &quot;hours&quot; max interval, this is the result of a design decision in Go&#x27;s time duration library, dealing with the quirks of our calendaring system.</div><br/><div id="42764476" class="c"><input type="checkbox" id="c-42764476" checked=""/><div class="controls bullet"><span class="by">NewJazz</span><span>|</span><a href="#42761373">root</a><span>|</span><a href="#42761570">parent</a><span>|</span><a href="#42764269">next</a><span>|</span><label class="collapse" for="c-42764476">[-]</label><label class="expand" for="c-42764476">[2 more]</label></div><br/><div class="children"><div class="content">This is the api presumably. Not sure about what would prevent days, wasn&#x27;t familiar with the lore.<p><a href="https:&#x2F;&#x2F;pkg.go.dev&#x2F;time#ParseDuration" rel="nofollow">https:&#x2F;&#x2F;pkg.go.dev&#x2F;time#ParseDuration</a></div><br/><div id="42765169" class="c"><input type="checkbox" id="c-42765169" checked=""/><div class="controls bullet"><span class="by">dsymonds</span><span>|</span><a href="#42761373">root</a><span>|</span><a href="#42764476">parent</a><span>|</span><a href="#42764269">next</a><span>|</span><label class="collapse" for="c-42765169">[-]</label><label class="expand" for="c-42765169">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s because units up to hours are of a fixed size, but days in most places are only 24h for ~363&#x2F;365 days of the year, with some being 23h and some being 25h.<p>(This is ignoring leap seconds, since the trend is to smear those rather than surface them to userspace.)</div><br/></div></div></div></div></div></div><div id="42764269" class="c"><input type="checkbox" id="c-42764269" checked=""/><div class="controls bullet"><span class="by">justin_oaks</span><span>|</span><a href="#42761373">parent</a><span>|</span><a href="#42761570">prev</a><span>|</span><a href="#42761668">next</a><span>|</span><label class="collapse" for="c-42764269">[-]</label><label class="expand" for="c-42764269">[1 more]</label></div><br/><div class="children"><div class="content">Yes the default certificate duration is so small as to be useless as a default. It&#x27;s a pain to set the expiration in hours, but it does still allow you to set months or years of duration. You just have to calculate out how many hours those months or years are.</div><br/></div></div></div></div><div id="42761668" class="c"><input type="checkbox" id="c-42761668" checked=""/><div class="controls bullet"><span class="by">nimbius</span><span>|</span><a href="#42761373">prev</a><span>|</span><a href="#42761619">next</a><span>|</span><label class="collapse" for="c-42761668">[-]</label><label class="expand" for="c-42761668">[1 more]</label></div><br/><div class="children"><div class="content">For those interested in an hsm pi, theres picohsm <a href="https:&#x2F;&#x2F;github.com&#x2F;polhenarejos&#x2F;pico-hsm">https:&#x2F;&#x2F;github.com&#x2F;polhenarejos&#x2F;pico-hsm</a></div><br/></div></div><div id="42761619" class="c"><input type="checkbox" id="c-42761619" checked=""/><div class="controls bullet"><span class="by">bpye</span><span>|</span><a href="#42761668">prev</a><span>|</span><a href="#42765446">next</a><span>|</span><label class="collapse" for="c-42761619">[-]</label><label class="expand" for="c-42761619">[1 more]</label></div><br/><div class="children"><div class="content">Is there any way to replace the dedicated RNG with the YubiKey RNG? The OpenPGP applet allows you to query its internal RNG [0].<p>[0] - <a href="https:&#x2F;&#x2F;developers.yubico.com&#x2F;PGP&#x2F;YubiKey_5.2.3_Enhancements_to_OpenPGP_3.4.html" rel="nofollow">https:&#x2F;&#x2F;developers.yubico.com&#x2F;PGP&#x2F;YubiKey_5.2.3_Enhancements...</a></div><br/></div></div><div id="42765446" class="c"><input type="checkbox" id="c-42765446" checked=""/><div class="controls bullet"><span class="by">fweimer</span><span>|</span><a href="#42761619">prev</a><span>|</span><a href="#42762581">next</a><span>|</span><label class="collapse" for="c-42765446">[-]</label><label class="expand" for="c-42765446">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s odd that they don&#x27;t include a real-time clock. Signatures include timestamps, and those better be trustworthy.</div><br/><div id="42765467" class="c"><input type="checkbox" id="c-42765467" checked=""/><div class="controls bullet"><span class="by">NewJazz</span><span>|</span><a href="#42765446">parent</a><span>|</span><a href="#42762581">next</a><span>|</span><label class="collapse" for="c-42765467">[-]</label><label class="expand" for="c-42765467">[1 more]</label></div><br/><div class="children"><div class="content">They mention NTP.</div><br/></div></div></div></div><div id="42762581" class="c"><input type="checkbox" id="c-42762581" checked=""/><div class="controls bullet"><span class="by">drpixie</span><span>|</span><a href="#42765446">prev</a><span>|</span><a href="#42761708">next</a><span>|</span><label class="collapse" for="c-42762581">[-]</label><label class="expand" for="c-42762581">[1 more]</label></div><br/><div class="children"><div class="content">Bit of an aside, but the &quot;Infinite Noise TRNG&quot; seems to generate not very random &quot;raw&quot; data, which it hashes to make it appear as random bits.<p>Am I missing something, or wouldn&#x27;t it be better to start with highly random raw data, and hash that to get more bits-per-second?</div><br/></div></div><div id="42761708" class="c"><input type="checkbox" id="c-42761708" checked=""/><div class="controls bullet"><span class="by">pandemic_region</span><span>|</span><a href="#42762581">prev</a><span>|</span><a href="#42760269">next</a><span>|</span><label class="collapse" for="c-42761708">[-]</label><label class="expand" for="c-42761708">[1 more]</label></div><br/><div class="children"><div class="content">Not appreciating the hijacking of the back button until the cookie form is dismissed.</div><br/></div></div><div id="42760269" class="c"><input type="checkbox" id="c-42760269" checked=""/><div class="controls bullet"><span class="by">zikduruqe</span><span>|</span><a href="#42761708">prev</a><span>|</span><a href="#42763603">next</a><span>|</span><label class="collapse" for="c-42760269">[-]</label><label class="expand" for="c-42760269">[2 more]</label></div><br/><div class="children"><div class="content">That isn&#x27;t so tiny.<p>This is tiny.  <a href="https:&#x2F;&#x2F;github.com&#x2F;FiloSottile&#x2F;mkcert">https:&#x2F;&#x2F;github.com&#x2F;FiloSottile&#x2F;mkcert</a></div><br/><div id="42760375" class="c"><input type="checkbox" id="c-42760375" checked=""/><div class="controls bullet"><span class="by">pkaye</span><span>|</span><a href="#42760269">parent</a><span>|</span><a href="#42763603">next</a><span>|</span><label class="collapse" for="c-42760375">[-]</label><label class="expand" for="c-42760375">[1 more]</label></div><br/><div class="children"><div class="content">Does that provide an ACME server?</div><br/></div></div></div></div><div id="42763603" class="c"><input type="checkbox" id="c-42763603" checked=""/><div class="controls bullet"><span class="by">kayson</span><span>|</span><a href="#42760269">prev</a><span>|</span><a href="#42762795">next</a><span>|</span><label class="collapse" for="c-42763603">[-]</label><label class="expand" for="c-42763603">[2 more]</label></div><br/><div class="children"><div class="content">This has been on my list to implement for a while. It&#x27;s a really great idea for things like proxmox and pfsense that you probably don&#x27;t want to use LetsEncrypt for, but support ACME.</div><br/><div id="42764615" class="c"><input type="checkbox" id="c-42764615" checked=""/><div class="controls bullet"><span class="by">gmoot</span><span>|</span><a href="#42763603">parent</a><span>|</span><a href="#42762795">next</a><span>|</span><label class="collapse" for="c-42764615">[-]</label><label class="expand" for="c-42764615">[1 more]</label></div><br/><div class="children"><div class="content">Why wouldn&#x27;t you want to use Lets Encrypt for proxmox, etc. ?</div><br/></div></div></div></div><div id="42762795" class="c"><input type="checkbox" id="c-42762795" checked=""/><div class="controls bullet"><span class="by">throw0101c</span><span>|</span><a href="#42763603">prev</a><span>|</span><a href="#42762952">next</a><span>|</span><label class="collapse" for="c-42762795">[-]</label><label class="expand" for="c-42762795">[1 more]</label></div><br/><div class="children"><div class="content">See also perhaps &quot;Running one’s own root Certificate Authority in 2023&quot; from a little while ago:<p>* <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37537689">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37537689</a></div><br/></div></div><div id="42762952" class="c"><input type="checkbox" id="c-42762952" checked=""/><div class="controls bullet"><span class="by">packetlost</span><span>|</span><a href="#42762795">prev</a><span>|</span><a href="#42762850">next</a><span>|</span><label class="collapse" for="c-42762952">[-]</label><label class="expand" for="c-42762952">[1 more]</label></div><br/><div class="children"><div class="content">I use MiniCA for this. It&#x27;s really nice</div><br/></div></div><div id="42762850" class="c"><input type="checkbox" id="c-42762850" checked=""/><div class="controls bullet"><span class="by">jcims</span><span>|</span><a href="#42762952">prev</a><span>|</span><a href="#42760521">next</a><span>|</span><label class="collapse" for="c-42762850">[-]</label><label class="expand" for="c-42762850">[1 more]</label></div><br/><div class="children"><div class="content">I think a nanosat running a CA that you can directly via some kind of low cost RF channel would be a fun experiment.</div><br/></div></div><div id="42760521" class="c"><input type="checkbox" id="c-42760521" checked=""/><div class="controls bullet"><span class="by">likeabatterycar</span><span>|</span><a href="#42762850">prev</a><span>|</span><a href="#42762366">next</a><span>|</span><label class="collapse" for="c-42760521">[-]</label><label class="expand" for="c-42760521">[9 more]</label></div><br/><div class="children"><div class="content">This is littered with so many missteps I don&#x27;t know where to start.<p>-Complete overkill requiring the use of a YubiKey for key storage and external RNG source - what problems does this solve? For a Yubikey to act as a poor man&#x27;s HSM you have to store the PIN in plaintext on the disk. So if the device is compromised, they can just issue their own certs. If it&#x27;s to protect against physical theft of the keys, they&#x27;ll just put the entire Raspberry Pi in their pocket. You could choose to enter the PIN manually but this precludes any automation including CRL generation. It&#x27;s also a waste of a good YubiKey.<p>-Creates a two-tier PKI... on the same device. This completely defeats the purpose so you can&#x27;t revoke anything in case of key compromise. You could make it a 100-tier PKI and it would make no difference if they&#x27;re on the same device. Though they would need a whole lot of YubiKeys and USB hubs for that.<p>-They&#x27;re generating the private key on disk then importing into the YubiKey. Which defeats having an external key storage device because you have left traces of the key on disk.<p>-All this digital duct taping the windows and doors yet the article instructs you to download and run random binaries off GitHub with no verification whatsoever.<p>-Why do you need ACME in a homelab and can&#x27;t just hand issue long lived certificates?<p>-OpenSC and the crypto libraries are notoriously difficult to set up and working properly. A tiny CA this is not.<p>An instance of openssl or xca covers 99.9% of &quot;homelab&quot; use cases. This is like using a battery operated drill to open a can of soup.</div><br/><div id="42761003" class="c"><input type="checkbox" id="c-42761003" checked=""/><div class="controls bullet"><span class="by">cwalv</span><span>|</span><a href="#42760521">parent</a><span>|</span><a href="#42765934">next</a><span>|</span><label class="collapse" for="c-42761003">[-]</label><label class="expand" for="c-42761003">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Complete overkill requiring the use of a YubiKey for key storage and external RNG source - what problems does solve? For a Yubikey to act as a poor man&#x27;s HSM you have to store the PIN in plaintext on the disk<p>You still can&#x27;t exfiltrate the key material.<p>&gt; If it&#x27;s to protect against physical theft of the keys, they&#x27;ll just put the entire Raspberry Pi in their pocket.<p>Just because someone has compromised your device doesn&#x27;t mean they have physical access. That&#x27;s the point.<p>&gt; They&#x27;re generating the private key on disk then importing into the YubiKey. Which defeats having an external key storage device because you have left traces of the key on disk.<p>The traces don&#x27;t have to be left behind. Is this excessive &#x27;overkill&#x27;, or is the &#x27;digital duct taping the windows and doors&#x27; insufficient?<p>&gt; An instance of openssl or xca covers 99.9% of &quot;homelab&quot; use cases<p>The interesting thing about this article is that it adds a few 9&#x27;s that are covered, and it&#x27;s both easy and cheap.</div><br/><div id="42761155" class="c"><input type="checkbox" id="c-42761155" checked=""/><div class="controls bullet"><span class="by">likeabatterycar</span><span>|</span><a href="#42760521">root</a><span>|</span><a href="#42761003">parent</a><span>|</span><a href="#42765934">next</a><span>|</span><label class="collapse" for="c-42761155">[-]</label><label class="expand" for="c-42761155">[2 more]</label></div><br/><div class="children"><div class="content">&gt; You still can&#x27;t exfiltrate the key material<p>And? What actual problem does this solve or realistic threat does this prevent? They are not decryption keys they are used to digitally sign certificates.<p>What the DigiNotar hack taught us years ago is if your CA is compromised you are already 0wned doesn&#x27;t matter if the key is stored in an HSM or not.<p>All they can do with a stolen key is issue more certificates. Which they can do anyway if they have root access to the CA.<p>You can put 12 locks on your door but if they&#x27;re all keyed to the same key you&#x27;ve stored under the plant on the porch, it doesn&#x27;t really matter.<p>&gt; The interesting thing about this article is that it adds a few 9&#x27;s that are covered, and it&#x27;s both easy and cheap.<p>Hard to say if those extra 9&#x27;s need an external RNG for extra entropy.</div><br/><div id="42761289" class="c"><input type="checkbox" id="c-42761289" checked=""/><div class="controls bullet"><span class="by">cwalv</span><span>|</span><a href="#42760521">root</a><span>|</span><a href="#42761155">parent</a><span>|</span><a href="#42765934">next</a><span>|</span><label class="collapse" for="c-42761289">[-]</label><label class="expand" for="c-42761289">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Which they can do anyway if they have root access to the CA.<p>Until you turn it off. If they exfiltrate the keys, it&#x27;s more complicated.<p>This goes back to your comment:<p>&gt; Creates a two-tier PKI... on the same device. This completely defeats the purpose so you can&#x27;t revoke anything in case of key compromise<p>But the root key is just created; it doesn&#x27;t stay on the device and can&#x27;t be used to sign anything.<p>&gt; What actual problem does this solve or realistic threat does this prevent?<p>The problem is exfiltrating the key without physical access. Whether or not that&#x27;s &quot;realistic&quot; enough to matter isn&#x27;t a question that can be answered generally.<p>&gt; Hard to say if those extra 9&#x27;s need an external RNG for extra entropy.<p>IMO it&#x27;s not. In the author&#x27;s words: Optional, but fire</div><br/></div></div></div></div></div></div><div id="42765934" class="c"><input type="checkbox" id="c-42765934" checked=""/><div class="controls bullet"><span class="by">johntash</span><span>|</span><a href="#42760521">parent</a><span>|</span><a href="#42761003">prev</a><span>|</span><a href="#42761145">next</a><span>|</span><label class="collapse" for="c-42765934">[-]</label><label class="expand" for="c-42765934">[1 more]</label></div><br/><div class="children"><div class="content">&gt; ... For a Yubikey to act as a poor man&#x27;s HSM you have to store the PIN in plaintext on the disk. ...<p>I haven&#x27;t read the article fully yet, but it&#x27;s not a bad idea to store the Root CA on the yubikey, and then generate a separate intermediate CA that is not stored on the yubikey.  This way, all your day-to-day certs are issued using the intermediate and you only need to touch the root ca if you need to re-issue&#x2F;revoke&#x2F;etc the intermediate.</div><br/></div></div><div id="42761145" class="c"><input type="checkbox" id="c-42761145" checked=""/><div class="controls bullet"><span class="by">tashian</span><span>|</span><a href="#42760521">parent</a><span>|</span><a href="#42765934">prev</a><span>|</span><a href="#42761004">next</a><span>|</span><label class="collapse" for="c-42761145">[-]</label><label class="expand" for="c-42761145">[2 more]</label></div><br/><div class="children"><div class="content">Hi, I&#x27;m the author of the post. Thanks for your questions here.<p>&gt; -Complete overkill requiring the use of a YubiKey for key storage and external RNG source - what problems does this solve? For a Yubikey to act as a poor man&#x27;s HSM you have to store the PIN in plaintext on the disk. So if the device is compromised, they can just issue their own certs. If it&#x27;s to protect against physical theft of the keys, they&#x27;ll just put the entire Raspberry Pi in their pocket.<p>Yep, it&#x27;s overkill. Homelabs are learning environments. People want tutorials when trying new things. It&#x27;s a poor man&#x27;s HSM because not many people will buy an HSM for their homelab, but almost everyone already has a YubiKey they can play with.<p>The project solves the problem of people wanting to learn and play with new technology.<p>And it&#x27;s a way to kickstart a decently solid local PKI, if that&#x27;s something you&#x27;re interested in.<p>The RNG is completely unnecessary flair that just adds to the fun.<p>&gt; -Creates a two-tier PKI... on the same device. This completely defeats the purpose so you can&#x27;t revoke anything in case of key compromise.
&gt; -They&#x27;re generating the private key on disk then importing into the YubiKey. Which defeats having an external key storage device because you have left traces of the key on disk.<p>The tutorial shows how to generate and store the private key offline on a USB stick, not on the device or the YubiKey. The key material never touches the disk of the Raspberry Pi.<p>Why store a copy of the CA keys offline? Because YubiKeys don&#x27;t have the key-wrapped backup and restore feature of HSMs. So, if the YubiKey ever fails, you need a way to restore your CA. Storing the root on a USB stick is the backup. Put the USB stick in a safe.<p>If you want active revocation, you can set it up so that the intermediate is revocable—in case physical theft of the key is important to you. (We have instructions to do that in our docs.)<p>&gt; -All this digital duct taping the windows and doors yet the article instructs you to download and run random binaries off GitHub with no verification whatsoever.<p>It&#x27;s open source software downloaded from GitHub. The only non-smallstep code is the RNG driver (GitHub is the distribution point for that project). Was there a kind of verification that you expected to see?<p>&gt; -Why do you need ACME in a homelab and can&#x27;t just hand issue long lived certificates?
-OpenSC and the crypto libraries are notoriously difficult to set up and working properly. A tiny CA this is not.<p>Most people don&#x27;t need ACME in their homelab, they just want to learn stuff. That said, we have homelabbers in our community issuing certs to dozens of endpoints in their homelab.<p>Whether you issue long-lived or short-lived certs is a philosophical issue. If a short-lived cert is compromised, it&#x27;s simply less valuable to the attacker. Short-lived certs encourage automation. Long-lived certs can be easier to manage and you can just manually renew them. But unplanned expiry of long-lived certs has caused a lot of multi-million dollar outages.<p>I hope this helps clarify things.</div><br/><div id="42764558" class="c"><input type="checkbox" id="c-42764558" checked=""/><div class="controls bullet"><span class="by">000ooo000</span><span>|</span><a href="#42760521">root</a><span>|</span><a href="#42761145">parent</a><span>|</span><a href="#42761004">next</a><span>|</span><label class="collapse" for="c-42764558">[-]</label><label class="expand" for="c-42764558">[1 more]</label></div><br/><div class="children"><div class="content">Despite the critical feedback you&#x27;ve received above, I found the article interesting, and having a homelab with several spare Pi&#x27;s, it&#x27;s got me considering setting a CA up. Thank you.</div><br/></div></div></div></div><div id="42761004" class="c"><input type="checkbox" id="c-42761004" checked=""/><div class="controls bullet"><span class="by">mschuster91</span><span>|</span><a href="#42760521">parent</a><span>|</span><a href="#42761145">prev</a><span>|</span><a href="#42762366">next</a><span>|</span><label class="collapse" for="c-42761004">[-]</label><label class="expand" for="c-42761004">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Why do you need ACME in a homelab and can&#x27;t just hand issue long lived certificates?<p>If there is one thing I <i>hate</i> it is hand issuing certificates. Even for a homelab.<p>SSL just plain sucks and OpenSSLs incantation and especially config files make an already bad problem even worse.</div><br/><div id="42762441" class="c"><input type="checkbox" id="c-42762441" checked=""/><div class="controls bullet"><span class="by">bigiain</span><span>|</span><a href="#42760521">root</a><span>|</span><a href="#42761004">parent</a><span>|</span><a href="#42762366">next</a><span>|</span><label class="collapse" for="c-42762441">[-]</label><label class="expand" for="c-42762441">[1 more]</label></div><br/><div class="children"><div class="content">Also, a lot of homelab people are experimenting and gaining experience with stuff they run in production or at work.<p>Those people are extremely likely to be using ACME in the wild.<p>Running it in your homelab makes a lot of sense to me.</div><br/></div></div></div></div></div></div><div id="42762366" class="c"><input type="checkbox" id="c-42762366" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#42760521">prev</a><span>|</span><a href="#42764377">next</a><span>|</span><label class="collapse" for="c-42762366">[-]</label><label class="expand" for="c-42762366">[1 more]</label></div><br/><div class="children"><div class="content">I wish it was easier to get your CA installed in trust stores. Even for devices you control it&#x27;s annoying but even worse if you want to share your services with mates at your house or over VPN etc. In the end it&#x27;s just easier to go with LE certs for all practical cases.</div><br/></div></div><div id="42764377" class="c"><input type="checkbox" id="c-42764377" checked=""/><div class="controls bullet"><span class="by">bongodongobob</span><span>|</span><a href="#42762366">prev</a><span>|</span><label class="collapse" for="c-42764377">[-]</label><label class="expand" for="c-42764377">[1 more]</label></div><br/><div class="children"><div class="content">I guess I&#x27;m not the intended audience, but the last thing I want in my homelab is a CA. One more thing I&#x27;d set up, forget how it works, then spend an entire weekend trying to fix when it breaks a year from now.</div><br/></div></div></div></div></div></div></div></body></html>