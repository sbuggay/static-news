<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1690707650275" as="style"/><link rel="stylesheet" href="styles.css?v=1690707650275"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://benhoyt.com/writings/gogit/">Show HN: Gogit – Just enough Git (in Go) to push itself to GitHub</a> <span class="domain">(<a href="https://benhoyt.com">benhoyt.com</a>)</span></div><div class="subtext"><span>benhoyt</span> | <span>63 comments</span></div><br/><div><div id="36924751" class="c"><input type="checkbox" id="c-36924751" checked=""/><div class="controls bullet"><span class="by">diarrhea</span><span>|</span><a href="#36924713">next</a><span>|</span><label class="collapse" for="c-36924751">[-]</label><label class="expand" for="c-36924751">[25 more]</label></div><br/><div class="children"><div class="content">The other day I was trying to work with git LFS. I was very surprised to find out git-lfs, as in the binary, CLI application is the <i>only</i> (open) implementation in existence. There is nothing else. And even it itself does not offer itself up as a library; so even native Go code (the implementation language) has to fall back to shelling out to the CLI git extension! Not even bindings are possible. Such a painful loss of interoperability: IPC via return codes and parsing stdout&#x2F;stderr.<p>It seems a similar story with the rest of git. I have hopes for gitoxide aka gix, and think the approach of library-first is correct going into the future. A CLI is then simply a thin wrapper around it, mapping argv to library operations basically.</div><br/><div id="36928939" class="c"><input type="checkbox" id="c-36928939" checked=""/><div class="controls bullet"><span class="by">adrianmsmith</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36928114">next</a><span>|</span><label class="collapse" for="c-36928939">[-]</label><label class="expand" for="c-36928939">[1 more]</label></div><br/><div class="children"><div class="content">I always respected the fact that the authors of Subversion, right from the start, structured their software as a library, with the CLI being a user of that library.<p>The way IDEs and GUIs interacted with CVS was to shell out to the CLI, which inevitably had problems with filenames with spaces, parsing of error messages, etc. Subversion understood in 2000 that the things were changing, and that the CLI was only one way you&#x27;d use a VCS. People were more and more interacting with the VCS via IDEs, or via right-click menus in Windows Explorer, etc.<p>I felt happy knowing I&#x27;d never again have to deal VCSs via tools just shelling out to their CLI ever again. How wrong I was...</div><br/></div></div><div id="36928114" class="c"><input type="checkbox" id="c-36928114" checked=""/><div class="controls bullet"><span class="by">jacoblambda</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36928939">prev</a><span>|</span><a href="#36926109">next</a><span>|</span><label class="collapse" for="c-36928114">[-]</label><label class="expand" for="c-36928114">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It seems a similar story with the rest of git. I have hopes for gitoxide aka gix, and think the approach of library-first is correct going into the future. A CLI is then simply a thin wrapper around it, mapping argv to library operations basically.<p>It&#x27;s worth noting that there is currently a push to &quot;lib-ify` git internals and it&#x27;s a gradual process. I&#x27;m not actually sure how much of this work has actually made it into the tree yet but I&#x27;ve been seeing patchsets towards that goal on the mailing list since at least January.</div><br/></div></div><div id="36926109" class="c"><input type="checkbox" id="c-36926109" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36928114">prev</a><span>|</span><a href="#36928871">next</a><span>|</span><label class="collapse" for="c-36926109">[-]</label><label class="expand" for="c-36926109">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It seems a similar story with the rest of git.<p>Dulwich[1] is a pure-python Git implementation that&#x27;s been around for many years, meant to be used as a library. I used it a long time ago to make a git-backed wiki. There&#x27;s also libgit2 which is exactly what it sounds like and it has mature Go bindings[2]. I&#x27;m sure there are more implementations.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;jelmer&#x2F;dulwich">https:&#x2F;&#x2F;github.com&#x2F;jelmer&#x2F;dulwich</a>
[2]: <a href="https:&#x2F;&#x2F;github.com&#x2F;libgit2&#x2F;git2go">https:&#x2F;&#x2F;github.com&#x2F;libgit2&#x2F;git2go</a></div><br/></div></div><div id="36928871" class="c"><input type="checkbox" id="c-36928871" checked=""/><div class="controls bullet"><span class="by">strogonoff</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36926109">prev</a><span>|</span><a href="#36926516">next</a><span>|</span><label class="collapse" for="c-36928871">[-]</label><label class="expand" for="c-36928871">[1 more]</label></div><br/><div class="children"><div class="content">Isomorphic Git is a Git implementation purely in JS (no WASM). I wrote a minimal library to handle LFS with it, it’s not that hard, the spec is pretty small.</div><br/></div></div><div id="36926516" class="c"><input type="checkbox" id="c-36926516" checked=""/><div class="controls bullet"><span class="by">coryrc</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36928871">prev</a><span>|</span><a href="#36924788">next</a><span>|</span><label class="collapse" for="c-36926516">[-]</label><label class="expand" for="c-36926516">[9 more]</label></div><br/><div class="children"><div class="content">&gt; IPC via return codes and parsing stdout&#x2F;stderr<p>That&#x27;s wildly different from Go&#x27;s method of != nil and error strings.</div><br/><div id="36926904" class="c"><input type="checkbox" id="c-36926904" checked=""/><div class="controls bullet"><span class="by">benhoyt</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36926516">parent</a><span>|</span><a href="#36924788">next</a><span>|</span><label class="collapse" for="c-36926904">[-]</label><label class="expand" for="c-36926904">[8 more]</label></div><br/><div class="children"><div class="content">I&#x27;m guessing you&#x27;re being sarcastic. If so, it&#x27;s not really a fair criticism. Go has properly-typed return values (not just parsing text from stdout) and any type can implement the error interface, allowing for error types with any custom, properly-typed attributes. You use Go&#x27;s type assertion or errors.Is &#x2F; errors.As to handle the latter.</div><br/><div id="36927273" class="c"><input type="checkbox" id="c-36927273" checked=""/><div class="controls bullet"><span class="by">coryrc</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36926904">parent</a><span>|</span><a href="#36924788">next</a><span>|</span><label class="collapse" for="c-36927273">[-]</label><label class="expand" for="c-36927273">[7 more]</label></div><br/><div class="children"><div class="content">Maybe it&#x27;s my job, but I don&#x27;t see a lot of Go code treating errors as anything but strings. Errors I get from Go programs are similarly vague and redundant and lacking context. (&quot;error from RPC: failure making from call: couldn&#x27;t complete operation: 7 is not a valid flag&quot; ah thanks, so much better than stack trace)<p>Also it&#x27;s the weekend and I&#x27;m just bitching.</div><br/><div id="36929213" class="c"><input type="checkbox" id="c-36929213" checked=""/><div class="controls bullet"><span class="by">maccard</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36927273">parent</a><span>|</span><a href="#36927432">next</a><span>|</span><label class="collapse" for="c-36929213">[-]</label><label class="expand" for="c-36929213">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d like to join the weekend bitching. I do think go&#x27;s errors are often shitty. Stacktraces are easy to get with [0] and you can always do fmt.Errorf(&quot;%s&quot;, string(debug.Stack()) to get them in an error. I&#x27;ve not profiled them in go, but in native code they&#x27;re horribly inefficient to gather so you don&#x27;t want to be using them unless you really want to I&#x27;d bet<p>That said, other applications have exceptions and people still manage to write functions that return a Boolean to indicate success, and log an equally unhelpful message rather than returning anything I can work with. Maybe we need new programmers.<p>[0] <a href="https:&#x2F;&#x2F;pkg.go.dev&#x2F;runtime&#x2F;debug#Stack" rel="nofollow noreferrer">https:&#x2F;&#x2F;pkg.go.dev&#x2F;runtime&#x2F;debug#Stack</a></div><br/></div></div><div id="36927432" class="c"><input type="checkbox" id="c-36927432" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36927273">parent</a><span>|</span><a href="#36929213">prev</a><span>|</span><a href="#36927741">next</a><span>|</span><label class="collapse" for="c-36927432">[-]</label><label class="expand" for="c-36927432">[1 more]</label></div><br/><div class="children"><div class="content">Yes, but don’t you value the fact that this error message was painstakingly crafted by hand under the care of skilled golang artisans instead of being mass-produced by an automated exception handler?</div><br/></div></div><div id="36927741" class="c"><input type="checkbox" id="c-36927741" checked=""/><div class="controls bullet"><span class="by">ttymck</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36927273">parent</a><span>|</span><a href="#36927432">prev</a><span>|</span><a href="#36927813">next</a><span>|</span><label class="collapse" for="c-36927741">[-]</label><label class="expand" for="c-36927741">[1 more]</label></div><br/><div class="children"><div class="content">Yeah because that&#x27;s the error interface? It&#x27;s literally a method that returns string.<p>Unfortunately, I guess after the fact they decided pattern matching was useful, so they did it via reflection (errors.As). But they don&#x27;t warn you that errors.Is might return false for a true errors.As, it is certainly a mess, but the pedagogy could be improved.</div><br/></div></div><div id="36927813" class="c"><input type="checkbox" id="c-36927813" checked=""/><div class="controls bullet"><span class="by">zaphirplane</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36927273">parent</a><span>|</span><a href="#36927741">prev</a><span>|</span><a href="#36928887">next</a><span>|</span><label class="collapse" for="c-36927813">[-]</label><label class="expand" for="c-36927813">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Also it&#x27;s the weekend and I&#x27;m just bitching<p>You prefer and in a better mood during the working week ? Interesting</div><br/></div></div><div id="36927346" class="c"><input type="checkbox" id="c-36927346" checked=""/><div class="controls bullet"><span class="by">benhoyt</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36927273">parent</a><span>|</span><a href="#36928887">prev</a><span>|</span><a href="#36924788">next</a><span>|</span><label class="collapse" for="c-36927346">[-]</label><label class="expand" for="c-36927346">[1 more]</label></div><br/><div class="children"><div class="content">I think that&#x27;s a fair critique. You have to really put thought into good error messages and error handling. When you do, they&#x27;re nicer and more informative than an ugly stack trace. But a poor error message chain like the one you&#x27;ve shown is significantly <i>less helpful</i> than a stack trace.</div><br/></div></div></div></div></div></div></div></div><div id="36924788" class="c"><input type="checkbox" id="c-36924788" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924751">parent</a><span>|</span><a href="#36926516">prev</a><span>|</span><a href="#36924713">next</a><span>|</span><label class="collapse" for="c-36924788">[-]</label><label class="expand" for="c-36924788">[11 more]</label></div><br/><div class="children"><div class="content">&gt; it itself does not offer itself up as a library<p>yeah, it does:<p><a href="https:&#x2F;&#x2F;godocs.io&#x2F;github.com&#x2F;git-lfs&#x2F;git-lfs&#x2F;v3" rel="nofollow noreferrer">https:&#x2F;&#x2F;godocs.io&#x2F;github.com&#x2F;git-lfs&#x2F;git-lfs&#x2F;v3</a></div><br/><div id="36924899" class="c"><input type="checkbox" id="c-36924899" checked=""/><div class="controls bullet"><span class="by">diarrhea</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36924788">parent</a><span>|</span><a href="#36924713">next</a><span>|</span><label class="collapse" for="c-36924899">[-]</label><label class="expand" for="c-36924899">[10 more]</label></div><br/><div class="children"><div class="content">I don’t know what that is, but their docs very prominently and strongly say this:<p>&gt; However, we do not maintain a stable Go language API or ABI, as Git LFS is intended to be used solely as a compiled binary utility. Please do not import the git-lfs module into other Go code and do not rely on it as a source code dependency.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;git-lfs&#x2F;git-lfs#limitations">https:&#x2F;&#x2F;github.com&#x2F;git-lfs&#x2F;git-lfs#limitations</a></div><br/><div id="36926912" class="c"><input type="checkbox" id="c-36926912" checked=""/><div class="controls bullet"><span class="by">dmoy</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36924899">parent</a><span>|</span><a href="#36925108">next</a><span>|</span><label class="collapse" for="c-36926912">[-]</label><label class="expand" for="c-36926912">[2 more]</label></div><br/><div class="children"><div class="content">Anything&#x27;s a library if you&#x27;re sufficiently motivated<p>- Hyrum Wright, probably</div><br/><div id="36928116" class="c"><input type="checkbox" id="c-36928116" checked=""/><div class="controls bullet"><span class="by">jrockway</span><span>|</span><a href="#36924751">root</a><span>|</span><a href="#36926912">parent</a><span>|</span><a href="#36925108">next</a><span>|</span><label class="collapse" for="c-36928116">[-]</label><label class="expand" for="c-36928116">[1 more]</label></div><br/><div class="children"><div class="content">I made Kubernetes into a library once.  Like the apiserver and default controllers, running in-process.  Copying and pasting were involved.  I was not expecting support.<p>If code is out there under a compatible license, you can do whatever you want with it.  If it breaks, you get to keep both pieces.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="36924713" class="c"><input type="checkbox" id="c-36924713" checked=""/><div class="controls bullet"><span class="by">Smaug123</span><span>|</span><a href="#36924751">prev</a><span>|</span><a href="#36929222">next</a><span>|</span><label class="collapse" for="c-36924713">[-]</label><label class="expand" for="c-36924713">[1 more]</label></div><br/><div class="children"><div class="content">Personally I soldiered on to to the point of being able to extract objects from packfiles, before I realised just how monstrously and tediously complex `git rev-parse` is, and gave up. It&#x27;s foundational to pretty much every porcelain command, so it&#x27;s not really something you can leave out if you want a semi-functioning `git`. See <a href="https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-rev-parse#_specifying_revisions" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-rev-parse#_specifying_revisions</a> and <a href="https:&#x2F;&#x2F;github.com&#x2F;git&#x2F;git&#x2F;blob&#x2F;ee48e70a829d1fa2da82f14787051ad8e7c45b71&#x2F;refs.c#L732">https:&#x2F;&#x2F;github.com&#x2F;git&#x2F;git&#x2F;blob&#x2F;ee48e70a829d1fa2da82f1478705...</a> ; `git` really is an edifice.</div><br/></div></div><div id="36929222" class="c"><input type="checkbox" id="c-36929222" checked=""/><div class="controls bullet"><span class="by">amedvednikov</span><span>|</span><a href="#36924713">prev</a><span>|</span><a href="#36925109">next</a><span>|</span><label class="collapse" for="c-36929222">[-]</label><label class="expand" for="c-36929222">[1 more]</label></div><br/><div class="children"><div class="content">Looks really cool!<p>Any chance you could add `git pull` support as well?</div><br/></div></div><div id="36925109" class="c"><input type="checkbox" id="c-36925109" checked=""/><div class="controls bullet"><span class="by">c7DJTLrn</span><span>|</span><a href="#36929222">prev</a><span>|</span><a href="#36924638">next</a><span>|</span><label class="collapse" for="c-36925109">[-]</label><label class="expand" for="c-36925109">[12 more]</label></div><br/><div class="children"><div class="content">&gt;The verbosity of Go’s error handling has been much-maligned. It’s simple and explicit, but every call to a function that may fail takes an additional three lines of code to handle the error<p>Putting error nil checks into a function is an anti-pattern in Go. There is no need to worry about the LOC count of your error checking code.<p>inb4 this ends up on pcj</div><br/><div id="36926964" class="c"><input type="checkbox" id="c-36926964" checked=""/><div class="controls bullet"><span class="by">benhoyt</span><span>|</span><a href="#36925109">parent</a><span>|</span><a href="#36928965">next</a><span>|</span><label class="collapse" for="c-36926964">[-]</label><label class="expand" for="c-36926964">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Putting error nil checks into a function is an anti-pattern in Go.<p>I assume you mean into a helper function like I&#x27;ve done with check()? If so, I agree with you for normal &quot;production&quot; Go code. But for simple throw-away scripts you don&#x27;t want half your code littered with error handling, when you could just throw a stack trace.<p>&gt; There is no need to worry about the LOC count of your error checking code.<p>Well, it means some functions are more than half error handling, obscuring the guts of what a function actually does. Even the Go language designers agree that Go&#x27;s error handling is too verbose, hence proposals like this from Russ Cox: <a href="https:&#x2F;&#x2F;go.googlesource.com&#x2F;proposal&#x2F;+&#x2F;master&#x2F;design&#x2F;go2draft-error-handling-overview.md" rel="nofollow noreferrer">https:&#x2F;&#x2F;go.googlesource.com&#x2F;proposal&#x2F;+&#x2F;master&#x2F;design&#x2F;go2draf...</a> (there are many other proposals, some from the Go team)<p>&gt; inb4 this ends up on pcj<p>im not shur wut pcj meenz</div><br/><div id="36928634" class="c"><input type="checkbox" id="c-36928634" checked=""/><div class="controls bullet"><span class="by">dgb23</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36926964">parent</a><span>|</span><a href="#36928965">next</a><span>|</span><label class="collapse" for="c-36928634">[-]</label><label class="expand" for="c-36928634">[1 more]</label></div><br/><div class="children"><div class="content">After they introduced generics I immediately wrote a generic Must function that returns the thing or panics.<p>There’s plenty of (pre generics) Must functions in the std lib that fo this.</div><br/></div></div></div></div><div id="36928965" class="c"><input type="checkbox" id="c-36928965" checked=""/><div class="controls bullet"><span class="by">adrianmsmith</span><span>|</span><a href="#36925109">parent</a><span>|</span><a href="#36926964">prev</a><span>|</span><a href="#36925152">next</a><span>|</span><label class="collapse" for="c-36928965">[-]</label><label class="expand" for="c-36928965">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Putting error nil checks into a function is an anti-pattern in Go.<p>What should you do instead?</div><br/><div id="36928978" class="c"><input type="checkbox" id="c-36928978" checked=""/><div class="controls bullet"><span class="by">Smaug123</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36928965">parent</a><span>|</span><a href="#36925152">next</a><span>|</span><label class="collapse" for="c-36928978">[-]</label><label class="expand" for="c-36928978">[1 more]</label></div><br/><div class="children"><div class="content">You may have misread this. The OP means &quot;extracting error nil checks into a function is an anti-pattern&quot;, not &quot;your functions should not contain error handling&quot;.</div><br/></div></div></div></div><div id="36925152" class="c"><input type="checkbox" id="c-36925152" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36925109">parent</a><span>|</span><a href="#36928965">prev</a><span>|</span><a href="#36924638">next</a><span>|</span><label class="collapse" for="c-36925152">[-]</label><label class="expand" for="c-36925152">[7 more]</label></div><br/><div class="children"><div class="content">agreed. when I see people talking about LOC my eyes roll. its verbose for a reason, the language designers WANT YOU to pay attention to the errors, not ignore them.</div><br/><div id="36928905" class="c"><input type="checkbox" id="c-36928905" checked=""/><div class="controls bullet"><span class="by">lawn</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925152">parent</a><span>|</span><a href="#36929043">next</a><span>|</span><label class="collapse" for="c-36928905">[-]</label><label class="expand" for="c-36928905">[1 more]</label></div><br/><div class="children"><div class="content">Being verbose and needlessly repetitive is indeed something they wanted, but it doesn&#x27;t mean it&#x27;s a good solution.<p>If something is too verbose and repetitive your brain will learn to skim over it, making it lose effectiveness while increasing the risk for bugs.</div><br/></div></div><div id="36929043" class="c"><input type="checkbox" id="c-36929043" checked=""/><div class="controls bullet"><span class="by">jstanley</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925152">parent</a><span>|</span><a href="#36928905">prev</a><span>|</span><a href="#36927315">next</a><span>|</span><label class="collapse" for="c-36929043">[-]</label><label class="expand" for="c-36929043">[1 more]</label></div><br/><div class="children"><div class="content">The language designers aren&#x27;t the boss of you. Just because they want something doesn&#x27;t mean you have to do it.</div><br/></div></div><div id="36927315" class="c"><input type="checkbox" id="c-36927315" checked=""/><div class="controls bullet"><span class="by">alex_lav</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925152">parent</a><span>|</span><a href="#36929043">prev</a><span>|</span><a href="#36925597">next</a><span>|</span><label class="collapse" for="c-36927315">[-]</label><label class="expand" for="c-36927315">[1 more]</label></div><br/><div class="children"><div class="content">I think the ultimate question for me is, does increased tedium demand&#x2F;imply&#x2F;require &quot;attention&quot;, or does it just create a new opportunity for mistake? If devs are so frequently writing these &quot;check()&quot; style functions, are they paying attention to or ignoring errors?</div><br/></div></div><div id="36925597" class="c"><input type="checkbox" id="c-36925597" checked=""/><div class="controls bullet"><span class="by">pmarreck</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925152">parent</a><span>|</span><a href="#36927315">prev</a><span>|</span><a href="#36924638">next</a><span>|</span><label class="collapse" for="c-36925597">[-]</label><label class="expand" for="c-36925597">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s exactly why every other language took the wiser decision of actually having runtime errors.<p>To force you to pay attention to them before your application state went into an unknown configuration, thus making it nearly impossible to troubleshoot or even pretend to be deterministic.<p>I still have no idea how any programmer thinks this is OK. Nondeterminism and unknown&#x2F;un-considered application state are <i>literally the source of all bugs</i>. I much prefer (and honestly believe it makes a ton more sense) to do what Erlang&#x2F;Elixir does, which is to fail, log, and immediately restart the process (which only takes a few cycles due to the immutability-all-the-way-down design).<p>If you hit my Phoenix application with a million requests in 2 seconds and each throws a 500 error, my webserver will keep chugging along, while every other technology&#x27;s webserver will quickly exhaust its pool of ready-to-go webserver processes and fall over like a nun on a bender.</div><br/><div id="36928677" class="c"><input type="checkbox" id="c-36928677" checked=""/><div class="controls bullet"><span class="by">Kwpolska</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925597">parent</a><span>|</span><a href="#36928698">next</a><span>|</span><label class="collapse" for="c-36928677">[-]</label><label class="expand" for="c-36928677">[1 more]</label></div><br/><div class="children"><div class="content">&gt; every other technology&#x27;s webserver will quickly exhaust its pool of ready-to-go webserver processes and fall over like a nun on a bender<p>Most other technologies don&#x27;t use one process per request, but instead have a single server process which handles all exceptions that come out of a request by returning 500 without crashing the server.</div><br/></div></div><div id="36928698" class="c"><input type="checkbox" id="c-36928698" checked=""/><div class="controls bullet"><span class="by">dgb23</span><span>|</span><a href="#36925109">root</a><span>|</span><a href="#36925597">parent</a><span>|</span><a href="#36928677">prev</a><span>|</span><a href="#36924638">next</a><span>|</span><label class="collapse" for="c-36928698">[-]</label><label class="expand" for="c-36928698">[1 more]</label></div><br/><div class="children"><div class="content">You can absolutely do this in Go. In a webserver you panic and recover your goroutines for 500’s or other failures that you deem invalid states.<p>There’s a qualitative difference between what we call 500 errors or 400 errors and it’s a good thing to handle the former by throwing exceptions or panicing and the latter with normal program flow and error values.<p>Errors that you can sensibility handle and display are part of your domain logic, just values and functions. They should be handled and contextualised right there at the site they come up.<p>Errors that represent invalid program states should be thrown as far as possible and handled at the edge.</div><br/></div></div></div></div></div></div></div></div><div id="36924638" class="c"><input type="checkbox" id="c-36924638" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36925109">prev</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36924638">[-]</label><label class="expand" for="c-36924638">[14 more]</label></div><br/><div class="children"><div class="content">I have been wanting something like this, but with a few more features such as &quot;git diff&quot;. I took a crack at it, but the popular (and maybe only) Go Git implementation has some issues:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;go-git&#x2F;go-git&#x2F;issues&#x2F;700">https:&#x2F;&#x2F;github.com&#x2F;go-git&#x2F;go-git&#x2F;issues&#x2F;700</a></div><br/><div id="36925363" class="c"><input type="checkbox" id="c-36925363" checked=""/><div class="controls bullet"><span class="by">anacrolix</span><span>|</span><a href="#36924638">parent</a><span>|</span><a href="#36925813">next</a><span>|</span><label class="collapse" for="c-36925363">[-]</label><label class="expand" for="c-36925363">[2 more]</label></div><br/><div class="children"><div class="content">Are you 1268? Are you creating identities on platforms by bruteforcing the lowest available cardinal? Because that is a great idea</div><br/><div id="36926548" class="c"><input type="checkbox" id="c-36926548" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36925363">parent</a><span>|</span><a href="#36925813">next</a><span>|</span><label class="collapse" for="c-36926548">[-]</label><label class="expand" for="c-36926548">[1 more]</label></div><br/><div class="children"><div class="content">yes and yes :)</div><br/></div></div></div></div><div id="36925813" class="c"><input type="checkbox" id="c-36925813" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">parent</a><span>|</span><a href="#36925363">prev</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36925813">[-]</label><label class="expand" for="c-36925813">[11 more]</label></div><br/><div class="children"><div class="content">In my opinion github.com&#x2F;go-git&#x2F;go-git is a very high-quality project. Just because it doesn&#x27;t solve some super-specific use-case that you have, doesn&#x27;t mean the project isn&#x27;t good. It&#x27;s open source, have you tried opening a pull request to solve your own issue?</div><br/><div id="36926834" class="c"><input type="checkbox" id="c-36926834" checked=""/><div class="controls bullet"><span class="by">xyzzy_plugh</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36925813">parent</a><span>|</span><a href="#36927262">next</a><span>|</span><label class="collapse" for="c-36926834">[-]</label><label class="expand" for="c-36926834">[2 more]</label></div><br/><div class="children"><div class="content">In truth it&#x27;s a bit of a tire fire. You&#x27;re better off shelling out to git in almost all cases.<p>I tried using it to automate some simple git workflows and found pitfalls everywhere.</div><br/><div id="36927165" class="c"><input type="checkbox" id="c-36927165" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36926834">parent</a><span>|</span><a href="#36927262">next</a><span>|</span><label class="collapse" for="c-36927165">[-]</label><label class="expand" for="c-36927165">[1 more]</label></div><br/><div class="children"><div class="content">Sorry to hear that, but go-git is good enough to be useful to Vault, Pulumi, kubernetes&#x2F;test-infra, and many other projects which directly import it.<p>Some folks seem to expect it to be a feature-complete library-usable Go re-implementation of the entirety of Git, despite it being (afaik) largely unfunded &#x2F; volunteer-driven in recent years. I don&#x27;t think that&#x27;s realistic. And yes in many use-cases it may indeed make more sense to shell out to `git`, there&#x27;s nothing wrong with that.<p>In any case, in my direct experience, the go-git maintainers do happily accept helpful PRs.<p>It just seems really weird to me to see folks trash go-git, while simultaneously cheering this new gogit project which is just 400 lines and intentionally by design&#x2F;scope contains only a tiny fraction of go-git&#x27;s functionality.</div><br/></div></div></div></div><div id="36927262" class="c"><input type="checkbox" id="c-36927262" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36925813">parent</a><span>|</span><a href="#36926834">prev</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927262">[-]</label><label class="expand" for="c-36927262">[8 more]</label></div><br/><div class="children"><div class="content">not really. its littered with interfaces, in some cases many levels deep, which in Go is an anti pattern. original author clearly came from Java or some other deeply OOP language. also:<p>&gt; super-specific use-case<p>uh, &quot;git diff&quot; is specific?</div><br/><div id="36927392" class="c"><input type="checkbox" id="c-36927392" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927262">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927392">[-]</label><label class="expand" for="c-36927392">[7 more]</label></div><br/><div class="children"><div class="content">If I understand your issue correctly, it&#x27;s `git diff --cached` that you&#x27;re specifically looking for, not just `git diff` in general?<p>Your expectation seems to be that someone has already implemented this in Go for you, for free, but this is not the case. Why is this your expectation, and what does complaining about it accomplish?</div><br/><div id="36927485" class="c"><input type="checkbox" id="c-36927485" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927392">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927485">[-]</label><label class="expand" for="c-36927485">[6 more]</label></div><br/><div class="children"><div class="content">&gt; If I understand your issue correctly, it&#x27;s `git diff --cached` that you&#x27;re specifically looking for, not just `git diff` in general?<p>incorrect. I am simply looking for a normal &quot;git diff&quot;, which compares the index with the working directory. shocking this is not available out of the box, hence my issue.</div><br/><div id="36927704" class="c"><input type="checkbox" id="c-36927704" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927485">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927704">[-]</label><label class="expand" for="c-36927704">[5 more]</label></div><br/><div class="children"><div class="content">object.Tree has a Diff() method. You can get an object.Tree of any commit hash from a Repository with its TreeObject() method. I don&#x27;t recall offhand how to get an object.Tree of the working directory or index (perhaps from the Repository.Storer?) but worst-case you could just create a new commit in order to get a hash and then run the diff.<p>The package is more read-oriented than write-oriented; the docs specifically say  it &quot;covers the majority of the plumbing read operations and some of the main write operations&quot;. If you&#x27;re trying to diff <i>working directory</i> modifications, that&#x27;s a write-path use-case since it implies files are being changed &#x2F; you&#x27;re not trying to diff two <i>pre-existing</i> commits.<p>(edit: removed some text based on an initial misreading of your statement.)</div><br/><div id="36927750" class="c"><input type="checkbox" id="c-36927750" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927704">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927750">[-]</label><label class="expand" for="c-36927750">[4 more]</label></div><br/><div class="children"><div class="content">&gt; You can get an object.Tree of any commit hash from a Repository with its TreeObject() method.<p>OK, but I am not dealing with a commit, as mentioned in the issue and my previous comment, I am dealing with THE INDEX and working directory, not a commit.<p>&gt; I don&#x27;t recall offhand how to get an object.Tree of the working directory or index (perhaps from the Repository.Storer?)<p>right, so you can see how its not as easy to hand wave away the problem as you initially thought.<p>&gt; worst-case you could just create a new commit in order to get a hash and then run the diff.<p>no, I am not making a commit just to diff the working directory. would you tell someone to do that with the command line tool as well?<p>&gt; The package is more read-oriented than write-oriented; the docs specifically say it &quot;covers the majority of the plumbing read operations and some of the main write operations&quot;.<p>cool, we are talking about a read operation, no writing is being done.<p>&gt; If you&#x27;re trying to diff working directory modifications, that&#x27;s a write-path use-case since it implies files are being changed &#x2F; you&#x27;re not trying to diff two pre-existing commits.<p>no its not. I am not writing to anything, only reading.</div><br/><div id="36927811" class="c"><input type="checkbox" id="c-36927811" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927750">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927811">[-]</label><label class="expand" for="c-36927811">[3 more]</label></div><br/><div class="children"><div class="content">&gt; no, I am not making a commit just to diff the working directory.<p>OK, you do you. I say it depends on the situation: if this is a throwaway clone (especially an in-memory one), creating a commit is harmless. I mean it&#x27;s certainly not an ideal solution, but at the end of the day it solves the problem at hand.<p>&gt; would you tell someone to do that with the command line tool as well?<p>It&#x27;s not my library, I didn&#x27;t design it, I&#x27;m just trying to provide a solution to the problem you posed. If you don&#x27;t like that solution then, well, OK? Shell out to `git` and call it a day, or write your own `git` implementation for scratch, or send go-git a PR. Any of these would be more productive than complaining about how a free open source library doesn&#x27;t provide a solution to <i>your</i> use-case.<p>&gt; I am not writing to anything<p>Clearly you&#x27;ve written to the files in the working directory, otherwise your diff would be blank.<p>Again, it&#x27;s a read-path oriented library. If you&#x27;re writing to working directory files, your use-case may not be aligned with that of the package authors.</div><br/><div id="36927857" class="c"><input type="checkbox" id="c-36927857" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927811">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927857">[-]</label><label class="expand" for="c-36927857">[2 more]</label></div><br/><div class="children"><div class="content">&gt; creating a commit is harmless. I mean it&#x27;s certainly not an ideal solution, but at the end of the day it solves the problem at hand.<p>youre making my arguments for me here. youre essentially saying the library is so poorly designed that the &quot;easiest&quot; solution is to create a commit, rather than actually just diffing the worktree directly.<p>&gt; Shell out to `git` and call it a day, or write your own `git` implementation for scratch<p>again, making my arguments for me. youre essentially saying the library is so poor, that is cant support simple use cases and it would be easier to shell out to Git than to write a program that diffs the worktree.<p>&gt; a solution to your use-case.<p>I would say its a solution to essentially every command line user. how many people DONT use git diff?<p>&gt; Clearly you&#x27;ve written to the files in the working directory, otherwise your diff would be blank.<p>the diff it not writing anything. the issue is not &quot;how do I write to a file&quot;, that can already be done with the standard library.<p>&gt; If you&#x27;re writing to working directory files<p>writing to files it done outside the scope of the Git package. the Git package is only needed to handle diffs that were done with some other tool.<p>&gt; your use-case may not be aligned with that of the package authors.<p>git diff?</div><br/><div id="36927981" class="c"><input type="checkbox" id="c-36927981" checked=""/><div class="controls bullet"><span class="by">evanelias</span><span>|</span><a href="#36924638">root</a><span>|</span><a href="#36927857">parent</a><span>|</span><a href="#36924569">next</a><span>|</span><label class="collapse" for="c-36927981">[-]</label><label class="expand" for="c-36927981">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t say that was the &quot;easiest&quot; solution, or ever imply it. Don&#x27;t put quotes around words I didn&#x27;t say. That&#x27;s really not cool.<p>The library is designed for use-cases like getting git metadata or contents from git repos. IIRC, the previous main sponsor (creator?) was a product that let you run SQL SELECT queries against git repos. There&#x27;s no need to interact with the working tree <i>at all</i> in that type of use-case, so why would they spend a bunch of time implementing diffs for it?<p>If you&#x27;re trying to use this library for an IDE, or something else like that where arbitrary modifications are made to working dir files, you&#x27;re going to have a bad time. <i>The library simply wasn&#x27;t created to do what you want it to do.</i> That doesn&#x27;t mean it&#x27;s bad or useless. It&#x27;s directly imported by Vault, Pulumi, k8s test-infra, etc because its use-case <i>is</i> aligned with what these projects need.<p>Personally I think it&#x27;s cool that I can use go-git to clone a git repo to memory and then perform programmatic read operations on the repo&#x27;s contents. That&#x27;s useful to me. It&#x27;s not useful to you, and that&#x27;s fine, but clearly we have different opinions and expectations around community-driven FOSS software projects.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="36924569" class="c"><input type="checkbox" id="c-36924569" checked=""/><div class="controls bullet"><span class="by">zdgeier</span><span>|</span><a href="#36924638">prev</a><span>|</span><a href="#36924878">next</a><span>|</span><label class="collapse" for="c-36924569">[-]</label><label class="expand" for="c-36924569">[1 more]</label></div><br/><div class="children"><div class="content">Nice work!</div><br/></div></div></div></div></div></div></div></body></html>