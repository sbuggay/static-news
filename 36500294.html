<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687942852557" as="style"/><link rel="stylesheet" href="styles.css?v=1687942852557"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://vermaden.wordpress.com/2023/06/28/freebsd-jails-containers/">FreeBSD Jails Containers</a> <span class="domain">(<a href="https://vermaden.wordpress.com">vermaden.wordpress.com</a>)</span></div><div class="subtext"><span>vermaden</span> | <span>40 comments</span></div><br/><div><div id="36501075" class="c"><input type="checkbox" id="c-36501075" checked=""/><div class="controls bullet"><span class="by">lambda_foo</span><span>|</span><a href="#36500916">next</a><span>|</span><label class="collapse" for="c-36501075">[-]</label><label class="expand" for="c-36501075">[4 more]</label></div><br/><div class="children"><div class="content">Shout out to <a href="https:&#x2F;&#x2F;github.com&#x2F;samuelkarp&#x2F;runj">https:&#x2F;&#x2F;github.com&#x2F;samuelkarp&#x2F;runj</a> which aims to provide OCI compatible runtime for FreeBSD jails. We are working on a Jails based sandbox implementation for running OCaml builds on FreeBSD, <a href="https:&#x2F;&#x2F;github.com&#x2F;ocurrent&#x2F;obuilder">https:&#x2F;&#x2F;github.com&#x2F;ocurrent&#x2F;obuilder</a>. If runj gets more support then it would be a good alternative to the various iocage&#x2F;ezjail&#x2F;etc solutions or the raw Jails implementation we have right now.</div><br/><div id="36503052" class="c"><input type="checkbox" id="c-36503052" checked=""/><div class="controls bullet"><span class="by">amtamt</span><span>|</span><a href="#36501075">parent</a><span>|</span><a href="#36500916">next</a><span>|</span><label class="collapse" for="c-36503052">[-]</label><label class="expand" for="c-36503052">[3 more]</label></div><br/><div class="children"><div class="content">Does this OCI compatibility also translate to be able to run kubernetes on FreeBSD?</div><br/><div id="36503079" class="c"><input type="checkbox" id="c-36503079" checked=""/><div class="controls bullet"><span class="by">sofixa</span><span>|</span><a href="#36501075">root</a><span>|</span><a href="#36503052">parent</a><span>|</span><a href="#36500916">next</a><span>|</span><label class="collapse" for="c-36503079">[-]</label><label class="expand" for="c-36503079">[2 more]</label></div><br/><div class="children"><div class="content">Not necessarily, Kubernetes also needs a ton of other things which are Linux kernel specific, like cgroups.<p>If you&#x27;re just looking for an orchestrator capable of running FreeBSD jails, take a look at Nomad (Disclaimer: I work at HashiCorp, opinions my own, etc.)</div><br/><div id="36503666" class="c"><input type="checkbox" id="c-36503666" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36501075">root</a><span>|</span><a href="#36503079">parent</a><span>|</span><a href="#36500916">next</a><span>|</span><label class="collapse" for="c-36503666">[-]</label><label class="expand" for="c-36503666">[1 more]</label></div><br/><div class="children"><div class="content">cgroups are mapped into Jobs on Windows.<p>There could be a similar kind of mapping on FreeBSD.</div><br/></div></div></div></div></div></div></div></div><div id="36500916" class="c"><input type="checkbox" id="c-36500916" checked=""/><div class="controls bullet"><span class="by">jonhohle</span><span>|</span><a href="#36501075">prev</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36500916">[-]</label><label class="expand" for="c-36500916">[14 more]</label></div><br/><div class="children"><div class="content">The issue I have with Jails, over something like docker, is that the kernel ABI changes between major releases so jails need to migrate with base systems upgrades. It also means a container registry would need to store container versions per release.<p>I like the isolation for my own bespoke home network, but does it work well in production set up’s?</div><br/><div id="36501135" class="c"><input type="checkbox" id="c-36501135" checked=""/><div class="controls bullet"><span class="by">throw0101a</span><span>|</span><a href="#36500916">parent</a><span>|</span><a href="#36501011">next</a><span>|</span><label class="collapse" for="c-36501135">[-]</label><label class="expand" for="c-36501135">[3 more]</label></div><br/><div class="children"><div class="content">There are compat libraries that are available, so if you are running 13.x (the most current major release) but want to run binaries originally compiled under 12.x, you install:<p>* <a href="https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat12x&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat12x&#x2F;</a><p>See further:<p>* <a href="https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat11x&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat11x&#x2F;</a><p>* <a href="https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat10x&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat10x&#x2F;</a><p>[…]<p>* <a href="https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat4x&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.freshports.org&#x2F;misc&#x2F;compat4x&#x2F;</a></div><br/><div id="36501644" class="c"><input type="checkbox" id="c-36501644" checked=""/><div class="controls bullet"><span class="by">nucleardog</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501135">parent</a><span>|</span><a href="#36501011">next</a><span>|</span><label class="collapse" for="c-36501644">[-]</label><label class="expand" for="c-36501644">[2 more]</label></div><br/><div class="children"><div class="content">And for anyone that isn&#x27;t intimately familiar with FreeBSD&#x27;s release history or anything, I feel like it&#x27;s worth pointing out that the 4.x major release dates from over 23 years ago. You can run binaries from before people were inhabiting the ISS and&#x2F;or right around the time AOL was big enough to purchase Time Warner.</div><br/><div id="36501914" class="c"><input type="checkbox" id="c-36501914" checked=""/><div class="controls bullet"><span class="by">johnea</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501644">parent</a><span>|</span><a href="#36501011">next</a><span>|</span><label class="collapse" for="c-36501914">[-]</label><label class="expand" for="c-36501914">[1 more]</label></div><br/><div class="children"><div class="content">Thank you! I was going to point this out...</div><br/></div></div></div></div></div></div><div id="36501011" class="c"><input type="checkbox" id="c-36501011" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500916">parent</a><span>|</span><a href="#36501135">prev</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36501011">[-]</label><label class="expand" for="c-36501011">[10 more]</label></div><br/><div class="children"><div class="content">Kernels are generally backwards compatible and major versions are explicitly supported for five (5) years.  Over in Linux land you&#x27;ll see builds for the different libcs and it seems to work just fine.</div><br/><div id="36501324" class="c"><input type="checkbox" id="c-36501324" checked=""/><div class="controls bullet"><span class="by">johncolanduoni</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501011">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36501324">[-]</label><label class="expand" for="c-36501324">[9 more]</label></div><br/><div class="children"><div class="content">The difference is that the container libc version and kernel version don&#x27;t have to correspond to each other in any way on Linux (unless your kernel is like 20 years older, in which case it wouldn&#x27;t support Docker anyway).</div><br/><div id="36502347" class="c"><input type="checkbox" id="c-36502347" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501324">parent</a><span>|</span><a href="#36501568">next</a><span>|</span><label class="collapse" for="c-36502347">[-]</label><label class="expand" for="c-36502347">[1 more]</label></div><br/><div class="children"><div class="content">I thought that too, until the syscall semantics changed between RHEL 6 and RHEL 7. Spent way more time debugging that than I wanted to.</div><br/></div></div><div id="36501568" class="c"><input type="checkbox" id="c-36501568" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501324">parent</a><span>|</span><a href="#36502347">prev</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36501568">[-]</label><label class="expand" for="c-36501568">[7 more]</label></div><br/><div class="children"><div class="content">The end result is that you&#x27;re matching the executable to the libc variant instead of to the kernel.  In practice it&#x27;s not much of a difference, if at all.  If you need to use older binaries, install the compatibility shims (or use a base jail based on the older version of FreeBSD).  In terms of a support matrix there are two major versions of FreeBSD that are given active support, which is less than over in Linux land.<p>All in all of all the concerns I&#x27;d have about using jails in a production environment, dealing with different major versions is not on that list.</div><br/><div id="36501635" class="c"><input type="checkbox" id="c-36501635" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501568">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36501635">[-]</label><label class="expand" for="c-36501635">[6 more]</label></div><br/><div class="children"><div class="content">But the half the point of the container is per application libcs&#x2F;userlands, so the kernel ABI is the only required constant.</div><br/><div id="36501815" class="c"><input type="checkbox" id="c-36501815" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501635">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36501815">[-]</label><label class="expand" for="c-36501815">[5 more]</label></div><br/><div class="children"><div class="content">In FreeBSD the userland and kernel move in unison, and with the backwards compatibility there&#x27;s nothing stopping you from running a jail based on a previous version of FreeBSD.  The compatX packages are only there to provide the older libraries if you want to run an older application on a newer jail&#x2F;install.<p>As was pointed out, you can run binaries from a FreeBSD version  (4) that&#x27;s probably older than most posters here.  Still not seeing what the big fuss is about.</div><br/><div id="36502306" class="c"><input type="checkbox" id="c-36502306" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36501815">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36502306">[-]</label><label class="expand" for="c-36502306">[4 more]</label></div><br/><div class="children"><div class="content">the hangup is because half the point is to be able to take a random userland and run it on your current system without changing it.  As soon as your userland bitrots because the kernel ABI changed, you&#x27;ve lost a lot of the benefit.<p>And to be clear, you can not take a complete userland from 4.x.  You have to reinstall your application on a newer userland with compat shims when you change the kernel.<p>Ironically enough, the Linux syscall compat layer in FreeBSD may give you more stability here.</div><br/><div id="36502477" class="c"><input type="checkbox" id="c-36502477" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36502306">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36502477">[-]</label><label class="expand" for="c-36502477">[3 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  You have to reinstall your application on a newer userland with compat
  shims when you change the kernel.
</code></pre>
No, you don&#x27;t.  You can absolutely take a jail based on a previous version of FreeBSD and run it on a newer version.  I&#x27;ve not tried going as far back as 4.x, but I&#x27;ve done jail images of 9 and 10 on 11 and 12 hosts as part of a CI system.<p>The shims you&#x27;re talking about are <i>not shims</i> at all, just packages of the older libraries that a program built for an older version of FreeBSD would expect.  You can go ahead and look at the package manifests if you don&#x27;t believe me.  They&#x27;re literally just a handful of older shared libraries.<p>Honestly, I can&#x27;t remember a time when the syscall table changed in a backwards incompatible manner.  The compat packages are only needed if you&#x27;re trying to run an older program with a newer userland.  If you&#x27;re running an older jail in a newer freebsd host, you can run your program as-is because those libraries have already been installed.</div><br/><div id="36503072" class="c"><input type="checkbox" id="c-36503072" checked=""/><div class="controls bullet"><span class="by">monocasa</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36502477">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36503072">[-]</label><label class="expand" for="c-36503072">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The kernel works, but ps(1) does not<p>&gt; If the kernel version differs from the one that the system utilities have been built with, for example, a kernel built from -CURRENT sources is installed on a -RELEASE system, many system status commands like ps(1) and vmstat(8) will not work. To fix this, recompile and install a world built with the same version of the source tree as the kernel. It is never a good idea to use a different version of the kernel than the rest of the operating system.<p><a href="https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20180602150408&#x2F;https:&#x2F;&#x2F;www.freebsd.org&#x2F;doc&#x2F;handbook&#x2F;kernelconfig-trouble.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20180602150408&#x2F;https:&#x2F;&#x2F;www.freeb...</a><p>It certainly seems like the freebsd userland and kernel are fairly tightly coupled where even basic utilities won&#x27;t work anymore on a version change.</div><br/><div id="36503283" class="c"><input type="checkbox" id="c-36503283" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500916">root</a><span>|</span><a href="#36503072">parent</a><span>|</span><a href="#36500735">next</a><span>|</span><label class="collapse" for="c-36503283">[-]</label><label class="expand" for="c-36503283">[1 more]</label></div><br/><div class="children"><div class="content">Just stop already, you don&#x27;t know what you&#x27;re talking about.  ps works just fine. The jail itself picks up the version of the host <i>because it&#x27;s calling the newer kernel</i>, but otherwise works as one would expect.  In fact it&#x27;s probably worth noting that between 10 and 12 the libc major version wasn&#x27;t even bumped.  For all the bellyaching you&#x27;re missing that each major version is supported for five years, and that unlike RHEL you&#x27;ll get up-to-date ports with that (instead of the half-assed cobbled together ancient versions that linger with the RHEL model) so there&#x27;s less incentive to upgrade until you&#x27;re ready.  That&#x27;s a lot of hand waving over a non fucking issue.<p>If you were making a more earnest argument you&#x27;d probably have looked at the current version of the documentation and noted that it doesn&#x27;t have the warning you quoted.<p><a href="https:&#x2F;&#x2F;docs.freebsd.org&#x2F;en&#x2F;books&#x2F;handbook&#x2F;kernelconfig&#x2F;#kernelconfig-trouble" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.freebsd.org&#x2F;en&#x2F;books&#x2F;handbook&#x2F;kernelconfig&#x2F;#ker...</a><p>Note that FreeBSD 10.0 was released in January 2014, over nine years ago.  10.4, which is the oldest base jail image I have kicking around, was released in 2017.  So the userland-kernel interfaces you&#x27;re wringing your hands over have remained stable for nearly a decade across three or four different major releases.<p>Of all the concerns I&#x27;d have about running FreeBSD and&#x2F;or jails in a prod environment, dealing with binary compatibility across different major versions is not even on my radar and not even remotely an advantage for docker.<p><pre><code>  # uname -rv
  12.4-RELEASE-p1 FreeBSD 12.4-RELEASE-p1 GENERIC
  # ldd &#x2F;bin&#x2F;ps
  &#x2F;bin&#x2F;ps:
          libm.so.5 =&gt; &#x2F;lib&#x2F;libm.so.5 (0x800254000)
          libkvm.so.7 =&gt; &#x2F;lib&#x2F;libkvm.so.7 (0x80028b000)
          libjail.so.1 =&gt; &#x2F;lib&#x2F;libjail.so.1 (0x80029e000)
          libxo.so.0 =&gt; &#x2F;lib&#x2F;libxo.so.0 (0x8002a6000)
          libc.so.7 =&gt; &#x2F;lib&#x2F;libc.so.7 (0x8002c5000)
          libelf.so.2 =&gt; &#x2F;lib&#x2F;libelf.so.2 (0x8006b9000)
          libutil.so.9 =&gt; &#x2F;lib&#x2F;libutil.so.9 (0x8006d4000)
  # md5sum &#x2F;bin&#x2F;ps
  ad8b5c8966c71e31cdc9603967860fa7  &#x2F;bin&#x2F;ps
  # objdump -p &#x2F;lib&#x2F;libc.so.7 | tail -12
  
  Version definitions:
  1 0x01 0x0865f4e7 libc.so.7
  2 0x00 0x077a28b0 FBSD_1.0
  3 0x00 0x077a28b1 FBSD_1.1
  4 0x00 0x077a28b2 FBSD_1.2
  5 0x00 0x077a28b3 FBSD_1.3
  6 0x00 0x077a28b4 FBSD_1.4
  7 0x00 0x077a28b5 FBSD_1.5
  8 0x00 0x077a28b6 FBSD_1.6
  9 0x00 0x0f1efaa0 FBSDprivate_1.0
  
  # iocage create -r 10.4-RELEASE
  e950694e-6182-410d-bc70-1a8f6e340516 successfully created!
  # iocage start e950694e-6182-410d-bc70-1a8f6e340516
  * Starting e950694e-6182-410d-bc70-1a8f6e340516
    + Started OK
    + Using devfs_ruleset: 1007 (iocage generated default)
    + Using IP options: ip4.saddrsel=1 ip4=new ip6.saddrsel=1 ip6=new
    + Starting services OK
    + Executing poststart OK
  # iocage console e950694e-6182-410d-bc70-1a8f6e340516
  FreeBSD 12.4-RELEASE-p1 GENERIC
  
  Welcome to FreeBSD!
  
  Release Notes, Errata: https:&#x2F;&#x2F;www.FreeBSD.org&#x2F;releases&#x2F;
  Security Advisories:   https:&#x2F;&#x2F;www.FreeBSD.org&#x2F;security&#x2F;
  FreeBSD Handbook:      https:&#x2F;&#x2F;www.FreeBSD.org&#x2F;handbook&#x2F;
  FreeBSD FAQ:           https:&#x2F;&#x2F;www.FreeBSD.org&#x2F;faq&#x2F;
  Questions List: https:&#x2F;&#x2F;lists.FreeBSD.org&#x2F;mailman&#x2F;listinfo&#x2F;freebsd-questions&#x2F;
  FreeBSD Forums:        https:&#x2F;&#x2F;forums.FreeBSD.org&#x2F;

  Documents installed with the system are in the &#x2F;usr&#x2F;local&#x2F;share&#x2F;doc&#x2F;freebsd&#x2F;
  directory, or can be installed later with:  pkg install en-freebsd-doc
  For other languages, replace &quot;en&quot; with a language code like de or fr.

  Show the version of FreeBSD installed:  freebsd-version ; uname -a
  Please include that output and any error messages when posting questions.
  Introduction to manual pages:  man man
  FreeBSD directory layout:      man hier
  
  Edit &#x2F;etc&#x2F;motd to change this login announcement.
  # ldd &#x2F;bin&#x2F;ps
  &#x2F;bin&#x2F;ps:
          libm.so.5 =&gt; &#x2F;lib&#x2F;libm.so.5 (0x800827000)
          libkvm.so.6 =&gt; &#x2F;lib&#x2F;libkvm.so.6 (0x800a50000)
          libjail.so.1 =&gt; &#x2F;lib&#x2F;libjail.so.1 (0x800c59000)
          libc.so.7 =&gt; &#x2F;lib&#x2F;libc.so.7 (0x800e5e000)
  # objdump -p &#x2F;lib&#x2F;libc.so.7 | tail -16
  Version definitions:
  1 0x01 0x0865f4e7 libc.so.7
  2 0x00 0x077a28b0 FBSD_1.0
  3 0x00 0x077a28b1 FBSD_1.1
          FBSD_1.0
  4 0x00 0x077a28b2 FBSD_1.2
          FBSD_1.1
  5 0x00 0x077a28b3 FBSD_1.3
          FBSD_1.2
  6 0x00 0x077a28b4 FBSD_1.4
          FBSD_1.3
  7 0x00 0x077a28b5 FBSD_1.5
          FBSD_1.4
  8 0x00 0x0f1efaa0 FBSDprivate_1.0
          FBSD_1.5
  
  # md5 &#x2F;bin&#x2F;ps
  MD5 (&#x2F;bin&#x2F;ps) = 8a9c364705d29beb98503415428067cc
  # ps
    PID TT  STAT    TIME COMMAND
  80454 39  IJ   0:00.01 login [pam] (login)
  80455 39  SJ   0:00.03 -csh (csh)
  80593 39  R+J  0:00.00 ps</code></pre></div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="36500735" class="c"><input type="checkbox" id="c-36500735" checked=""/><div class="controls bullet"><span class="by">idatum</span><span>|</span><a href="#36500916">prev</a><span>|</span><a href="#36501483">next</a><span>|</span><label class="collapse" for="c-36500735">[-]</label><label class="expand" for="c-36500735">[6 more]</label></div><br/><div class="children"><div class="content">I have a VNET jail for remote access to my home lab. This takes an extra NIC I wasn&#x27;t using anyway. It has been solid running on FreeBSD 13.2.<p>This jail allows me to lock things down to minimal access to other services I need remotely, such as an SSH tunnel to Home Assistant.<p>I run my FreeBSD server mainly for ZFS. Adding a jail for remote access adds to the usefulness that hardware.</div><br/><div id="36502652" class="c"><input type="checkbox" id="c-36502652" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#36500735">parent</a><span>|</span><a href="#36501933">next</a><span>|</span><label class="collapse" for="c-36502652">[-]</label><label class="expand" for="c-36502652">[2 more]</label></div><br/><div class="children"><div class="content">An extra NIC is fine if you&#x27;ve got slots, but you can also do an if_bridge in the main host, add the real nic and half of an if_epair; then move the other half to the vnet jail.<p>Potentially a non-vnet jail with the ipv4&#x2F;ipv6 options set may also be an option. I used to use jails with those settings to squeeze multiple environments into a single host at Yahoo.</div><br/><div id="36503996" class="c"><input type="checkbox" id="c-36503996" checked=""/><div class="controls bullet"><span class="by">yakubin</span><span>|</span><a href="#36500735">root</a><span>|</span><a href="#36502652">parent</a><span>|</span><a href="#36501933">next</a><span>|</span><label class="collapse" for="c-36503996">[-]</label><label class="expand" for="c-36503996">[1 more]</label></div><br/><div class="children"><div class="content">I use only if_epair and then pf to NAT it to the external world. I’ve only had issues with if_bridge, where I would either be able to make connections between jail and the external world, but not between host and jail or vice versa (between host and jail fine, but not between jail and external world). And it would act really flaky, like getting one ping response, followed by silence. pf is a lot simpler and more reliable.</div><br/></div></div></div></div><div id="36501933" class="c"><input type="checkbox" id="c-36501933" checked=""/><div class="controls bullet"><span class="by">appleflaxen</span><span>|</span><a href="#36500735">parent</a><span>|</span><a href="#36502652">prev</a><span>|</span><a href="#36501483">next</a><span>|</span><label class="collapse" for="c-36501933">[-]</label><label class="expand" for="c-36501933">[3 more]</label></div><br/><div class="children"><div class="content">Can you elaborate on what this looks like?</div><br/><div id="36502091" class="c"><input type="checkbox" id="c-36502091" checked=""/><div class="controls bullet"><span class="by">idatum</span><span>|</span><a href="#36500735">root</a><span>|</span><a href="#36501933">parent</a><span>|</span><a href="#36501483">next</a><span>|</span><label class="collapse" for="c-36502091">[-]</label><label class="expand" for="c-36502091">[2 more]</label></div><br/><div class="children"><div class="content">jail.conf:<p>ssh {
    exec.start = &quot;&#x2F;bin&#x2F;sh &#x2F;etc&#x2F;rc&quot;;
    exec.stop = &quot;&#x2F;bin&#x2F;sh &#x2F;etc&#x2F;rc.shutdown&quot;;
    exec.clean;
    mount.devfs;
    path = &quot;&#x2F;var&#x2F;jail&#x2F;ssh&quot;;
    host.hostname = &quot;ssh&quot;;
    vnet;
    vnet.interface += &quot;em0&quot;;
}<p>It&#x27;s IPv6 only, so this is key in rc.conf:
rtsold_enable=&quot;YES&quot;<p>OpenBSD PF based router does the rest. IPv6 simplifies things here.<p>PF on FreeBSD isn&#x27;t the most ideal, sure, but I can limit local access on inet6.<p>For SSH tunnel, it&#x27;s straight forward.</div><br/><div id="36502505" class="c"><input type="checkbox" id="c-36502505" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500735">root</a><span>|</span><a href="#36502091">parent</a><span>|</span><a href="#36501483">next</a><span>|</span><label class="collapse" for="c-36502505">[-]</label><label class="expand" for="c-36502505">[1 more]</label></div><br/><div class="children"><div class="content">FWIW VNET is not inherently IPv6 only.  I&#x27;m using it in an IPv4 only context just fine.</div><br/></div></div></div></div></div></div></div></div><div id="36501483" class="c"><input type="checkbox" id="c-36501483" checked=""/><div class="controls bullet"><span class="by">efortis</span><span>|</span><a href="#36500735">prev</a><span>|</span><a href="#36500921">next</a><span>|</span><label class="collapse" for="c-36501483">[-]</label><label class="expand" for="c-36501483">[1 more]</label></div><br/><div class="children"><div class="content">Related: A two-server three-jail network setup (firewall, vlan, tunnels)<p><a href="https:&#x2F;&#x2F;blog.uidrafter.com&#x2F;freebsd-jails-network-setup" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.uidrafter.com&#x2F;freebsd-jails-network-setup</a></div><br/></div></div><div id="36500921" class="c"><input type="checkbox" id="c-36500921" checked=""/><div class="controls bullet"><span class="by">Lammy</span><span>|</span><a href="#36501483">prev</a><span>|</span><a href="#36500679">next</a><span>|</span><label class="collapse" for="c-36500921">[-]</label><label class="expand" for="c-36500921">[2 more]</label></div><br/><div class="children"><div class="content">Props for using the base-system jail management tools instead of iocage&#x2F;ezjail&#x2F;etc.</div><br/><div id="36501859" class="c"><input type="checkbox" id="c-36501859" checked=""/><div class="controls bullet"><span class="by">wyager</span><span>|</span><a href="#36500921">parent</a><span>|</span><a href="#36500679">next</a><span>|</span><label class="collapse" for="c-36501859">[-]</label><label class="expand" for="c-36501859">[1 more]</label></div><br/><div class="children"><div class="content">IME, the base-system jail stuff is super easy to understand, use, and customize. When you start using &quot;easy&quot; tools on top of that, it rapidly becomes more complicated and opaque for non-trivial stuff.<p>It&#x27;s <i>awesome</i> that you can do everything you would want with a jail with only 3 config files: rc.conf (for networking and start-up), pf.conf (for firewalling&#x2F;routing), and jail.conf (for specifying jail params like mount points, network if setup, etc.).<p>Super clean, super easy.</div><br/></div></div></div></div><div id="36500679" class="c"><input type="checkbox" id="c-36500679" checked=""/><div class="controls bullet"><span class="by">wyager</span><span>|</span><a href="#36500921">prev</a><span>|</span><a href="#36500983">next</a><span>|</span><label class="collapse" for="c-36500679">[-]</label><label class="expand" for="c-36500679">[1 more]</label></div><br/><div class="children"><div class="content">Vnet jails are awesome. Totally changed the way I do networking and application hosting. Makes it pretty trivial to do things like set up a jail that can only talk to the internet through a VPN.</div><br/></div></div><div id="36500983" class="c"><input type="checkbox" id="c-36500983" checked=""/><div class="controls bullet"><span class="by">inferiorhuman</span><span>|</span><a href="#36500679">prev</a><span>|</span><a href="#36500625">next</a><span>|</span><label class="collapse" for="c-36500983">[-]</label><label class="expand" for="c-36500983">[1 more]</label></div><br/><div class="children"><div class="content">VNET jails <i>are</i> great, especially now that they&#x27;re stable, but I&#x27;d strongly recommend using a higher level tool.  I&#x27;ve settled on iocage, but there are a few other tools out there that seem to have gained traction.  Nobody sets up cgroups by hand, right?</div><br/></div></div><div id="36500625" class="c"><input type="checkbox" id="c-36500625" checked=""/><div class="controls bullet"><span class="by">baggy_trough</span><span>|</span><a href="#36500983">prev</a><span>|</span><a href="#36500788">next</a><span>|</span><label class="collapse" for="c-36500625">[-]</label><label class="expand" for="c-36500625">[3 more]</label></div><br/><div class="children"><div class="content">Also check out systemd-nspawn on linux. Another nice container solution, built in, that seems to be relatively little known.</div><br/><div id="36501325" class="c"><input type="checkbox" id="c-36501325" checked=""/><div class="controls bullet"><span class="by">packetlost</span><span>|</span><a href="#36500625">parent</a><span>|</span><a href="#36500788">next</a><span>|</span><label class="collapse" for="c-36501325">[-]</label><label class="expand" for="c-36501325">[2 more]</label></div><br/><div class="children"><div class="content">I made a very serious attempt at using  this awhile back on Arch and it high-key sucks. Like, it&#x27;s not really meant as a general purpose container runtime solution, it&#x27;s meant for developing systemd and related software. The ergonomics, particularly around networking are quite bad and it literally requires that you&#x27;re all in on systemd-networkd and resolved to get any networking at all.</div><br/><div id="36501432" class="c"><input type="checkbox" id="c-36501432" checked=""/><div class="controls bullet"><span class="by">baggy_trough</span><span>|</span><a href="#36500625">root</a><span>|</span><a href="#36501325">parent</a><span>|</span><a href="#36500788">next</a><span>|</span><label class="collapse" for="c-36501432">[-]</label><label class="expand" for="c-36501432">[1 more]</label></div><br/><div class="children"><div class="content">I’ve used it as a general purpose container runtime and been very pleased.  Ymmv.</div><br/></div></div></div></div></div></div><div id="36500788" class="c"><input type="checkbox" id="c-36500788" checked=""/><div class="controls bullet"><span class="by">wwarner</span><span>|</span><a href="#36500625">prev</a><span>|</span><label class="collapse" for="c-36500788">[-]</label><label class="expand" for="c-36500788">[7 more]</label></div><br/><div class="children"><div class="content">&quot;The FreeBSD host can run any other FreeBSD as long as its not newer then the host system version.&quot;<p>Docker does not have this limitation. You can run a container that is based on a newer version of Linux than the host.</div><br/><div id="36500834" class="c"><input type="checkbox" id="c-36500834" checked=""/><div class="controls bullet"><span class="by">kstrauser</span><span>|</span><a href="#36500788">parent</a><span>|</span><a href="#36500865">next</a><span>|</span><label class="collapse" for="c-36500834">[-]</label><label class="expand" for="c-36500834">[1 more]</label></div><br/><div class="children"><div class="content">Depends what you mean by &quot;Linux&quot;. You can possibly use a newer userland, but containers share the kernel with the host. That&#x27;s kind of the whole point of containers: they&#x27;re just a set of processes that are grouped together and configured with certain restrictions.</div><br/></div></div><div id="36500865" class="c"><input type="checkbox" id="c-36500865" checked=""/><div class="controls bullet"><span class="by">chungy</span><span>|</span><a href="#36500788">parent</a><span>|</span><a href="#36500834">prev</a><span>|</span><a href="#36501248">next</a><span>|</span><label class="collapse" for="c-36500865">[-]</label><label class="expand" for="c-36500865">[3 more]</label></div><br/><div class="children"><div class="content">They have that limitation, but it doesn&#x27;t manifest in quite a simple way. If the container&#x27;s glibc and all other binaries require Linux 6.3, you&#x27;re not running it on a 5.18 host.<p>FreeBSD is developed as a whole unit. It makes it easier to reason that a 13.2 userland doesn&#x27;t run on a 12.4 kernel.</div><br/><div id="36502546" class="c"><input type="checkbox" id="c-36502546" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#36500788">root</a><span>|</span><a href="#36500865">parent</a><span>|</span><a href="#36501248">next</a><span>|</span><label class="collapse" for="c-36502546">[-]</label><label class="expand" for="c-36502546">[2 more]</label></div><br/><div class="children"><div class="content">&gt; If the container&#x27;s glibc and all other binaries require Linux 6.3, you&#x27;re not running it on a 5.18 host.<p>FWIW, it would take quite a long time for glibc itself to start requiring Linux 6.3 on its current targets. Since glibc 2.24 (Aug. 2016), the minimum supported kernel has been at most Linux 3.2 (Jan. 2012), on every target that has existed that long. And that&#x27;s the smallest that the gap between the glibc and Linux releases has ever gotten (except for new targets). Extrapolating, we&#x27;d have to wait for glibc 2.47 (Feb. 2028) to require Linux 6.3 (Apr. 2023), if that gap were to be repeated, something which I don&#x27;t find particularly likely.<p>That is to say, with the exception of new targets, you&#x27;ll rarely see a userland that absolutely requires the latest Linux kernel, even possibly if it suggests that kernel for the best support.</div><br/><div id="36503015" class="c"><input type="checkbox" id="c-36503015" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#36500788">root</a><span>|</span><a href="#36502546">parent</a><span>|</span><a href="#36501248">next</a><span>|</span><label class="collapse" for="c-36503015">[-]</label><label class="expand" for="c-36503015">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s the &quot;all other binaries&quot; part that will catch you.  You&#x27;ve completely overlooked that part.<p>For example: Per its own README, systemd requires Linux 3.15 at absolute minimum, recommends Linux 4.15 for baseline functionality to at least work, and specifies Linux 5.7 for full BPF functionality.</div><br/></div></div></div></div></div></div><div id="36501248" class="c"><input type="checkbox" id="c-36501248" checked=""/><div class="controls bullet"><span class="by">ori_b</span><span>|</span><a href="#36500788">parent</a><span>|</span><a href="#36500865">prev</a><span>|</span><a href="#36502359">next</a><span>|</span><label class="collapse" for="c-36501248">[-]</label><label class="expand" for="c-36501248">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s incorrect.<p>(Well. Technically it&#x27;s kind of true. You can <i>run</i> a container based on a newer kernel, it&#x27;ll just crash when you use any new features)</div><br/></div></div><div id="36502359" class="c"><input type="checkbox" id="c-36502359" checked=""/><div class="controls bullet"><span class="by">bandrami</span><span>|</span><a href="#36500788">parent</a><span>|</span><a href="#36501248">prev</a><span>|</span><label class="collapse" for="c-36502359">[-]</label><label class="expand" for="c-36502359">[1 more]</label></div><br/><div class="children"><div class="content">Unless that container uses kernel semantics that changed between kernel versions, or a feature that was added in the new version. Which invariably happens. See the RHEL 6&#x2F;7 upgrade and the changes to syscall.</div><br/></div></div></div></div></div></div></div></div></div></body></html>