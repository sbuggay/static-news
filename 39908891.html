<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712134865344" as="style"/><link rel="stylesheet" href="styles.css?v=1712134865344"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://alt-romes.github.io/posts/2024-04-02-calling-haskell-from-swift.html">Calling Haskell from Swift</a> <span class="domain">(<a href="https://alt-romes.github.io">alt-romes.github.io</a>)</span></div><div class="subtext"><span>romes</span> | <span>14 comments</span></div><br/><div><div id="39912207" class="c"><input type="checkbox" id="c-39912207" checked=""/><div class="controls bullet"><span class="by">bradrn</span><span>|</span><a href="#39909606">next</a><span>|</span><label class="collapse" for="c-39912207">[-]</label><label class="expand" for="c-39912207">[1 more]</label></div><br/><div class="children"><div class="content">I’ve done something like this before to call Haskell from C++ (in [0]), so that I could build my GUI using Qt. It worked pretty well, except that I ran into various difficult-to-resolve linking problems on both Windows and Linux. After a year or two of trying to maintain it, I gave up and switched to a protocol where both sides pass JSON over stdin&#x2F;stdout. This particular piece of software doesn’t require a huge amount of communication or shared data, so it works well enough.<p>The really nice thing about the original interop code, though, is that GHC’s new WASM backend uses essentially the same foreign function interface to export functions to JavaScript. So with only some minor modifications, I was able to get the same program working on a webpage [1], which I think is pretty cool.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;bradrn&#x2F;brassica">https:&#x2F;&#x2F;github.com&#x2F;bradrn&#x2F;brassica</a>, and see in particular the old version of <a href="https:&#x2F;&#x2F;github.com&#x2F;bradrn&#x2F;brassica&#x2F;blob&#x2F;93d4353c5736018ec0944433d044ce6c4dc3ba3b&#x2F;ARCHITECTURE.md">https:&#x2F;&#x2F;github.com&#x2F;bradrn&#x2F;brassica&#x2F;blob&#x2F;93d4353c5736018ec094...</a><p>[1] At the risk of DDOS’ing my poor little home server: <a href="https:&#x2F;&#x2F;bradrn.com&#x2F;brassica&#x2F;" rel="nofollow">https:&#x2F;&#x2F;bradrn.com&#x2F;brassica&#x2F;</a></div><br/></div></div><div id="39909606" class="c"><input type="checkbox" id="c-39909606" checked=""/><div class="controls bullet"><span class="by">wk_end</span><span>|</span><a href="#39912207">prev</a><span>|</span><a href="#39913936">next</a><span>|</span><label class="collapse" for="c-39909606">[-]</label><label class="expand" for="c-39909606">[1 more]</label></div><br/><div class="children"><div class="content">This is pretty cool. In FP there&#x27;s a pattern called &quot;functional core, imperative shell&quot; [0]; here, you can build your &quot;functional core&quot; in Haskell and your imperative shell in a language which - depending on your preferences, some might say - is a little more suitable for building an imperative shell. Because it uses JSON as the &quot;wire format&quot; between the two languages, you can then easily build out a different imperative shell for whichever platforms you want to support.<p>[0] <a href="https:&#x2F;&#x2F;www.destroyallsoftware.com&#x2F;screencasts&#x2F;catalog&#x2F;functional-core-imperative-shell" rel="nofollow">https:&#x2F;&#x2F;www.destroyallsoftware.com&#x2F;screencasts&#x2F;catalog&#x2F;funct...</a></div><br/></div></div><div id="39913936" class="c"><input type="checkbox" id="c-39913936" checked=""/><div class="controls bullet"><span class="by">Bogdanp</span><span>|</span><a href="#39909606">prev</a><span>|</span><a href="#39909597">next</a><span>|</span><label class="collapse" for="c-39913936">[-]</label><label class="expand" for="c-39913936">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been doing similar things with Swift and Racket:<p>* <a href="https:&#x2F;&#x2F;defn.io&#x2F;2023&#x2F;03&#x2F;19&#x2F;racketfest-talk-2023&#x2F;" rel="nofollow">https:&#x2F;&#x2F;defn.io&#x2F;2023&#x2F;03&#x2F;19&#x2F;racketfest-talk-2023&#x2F;</a><p>* <a href="https:&#x2F;&#x2F;defn.io&#x2F;2023&#x2F;02&#x2F;04&#x2F;racket-foreign-callouts-to-swift&#x2F;" rel="nofollow">https:&#x2F;&#x2F;defn.io&#x2F;2023&#x2F;02&#x2F;04&#x2F;racket-foreign-callouts-to-swift&#x2F;</a><p>I also started out using JSON to exchange data between the languages, but eventually wiring everything manually became an annoyance so I came up with a little Racket DSL[1] that automatically serializes and deserializes between the two languages (at runtime in Racket &amp; using code generation in Swift). So far, I&#x27;ve built two apps with this approach, and I think it&#x27;s great:<p>* <a href="https:&#x2F;&#x2F;github.com&#x2F;Bogdanp&#x2F;Franz">https:&#x2F;&#x2F;github.com&#x2F;Bogdanp&#x2F;Franz</a> (macOS, Windows, Linux)<p>* <a href="https:&#x2F;&#x2F;github.com&#x2F;Bogdanp&#x2F;remember">https:&#x2F;&#x2F;github.com&#x2F;Bogdanp&#x2F;remember</a> (macOS, iOS)<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;bogdanp&#x2F;noise">https:&#x2F;&#x2F;github.com&#x2F;bogdanp&#x2F;noise</a></div><br/></div></div><div id="39909597" class="c"><input type="checkbox" id="c-39909597" checked=""/><div class="controls bullet"><span class="by">arulpugazh</span><span>|</span><a href="#39913936">prev</a><span>|</span><a href="#39910307">next</a><span>|</span><label class="collapse" for="c-39909597">[-]</label><label class="expand" for="c-39909597">[1 more]</label></div><br/><div class="children"><div class="content">The blog is so neat and pretty!</div><br/></div></div><div id="39910307" class="c"><input type="checkbox" id="c-39910307" checked=""/><div class="controls bullet"><span class="by">frizlab</span><span>|</span><a href="#39909597">prev</a><span>|</span><a href="#39911445">next</a><span>|</span><label class="collapse" for="c-39910307">[-]</label><label class="expand" for="c-39910307">[4 more]</label></div><br/><div class="children"><div class="content">I always flinch when I see Xcode written with a capital C!<p>The post is interesting otherwise.</div><br/><div id="39911227" class="c"><input type="checkbox" id="c-39911227" checked=""/><div class="controls bullet"><span class="by">newZWhoDis</span><span>|</span><a href="#39910307">parent</a><span>|</span><a href="#39911445">next</a><span>|</span><label class="collapse" for="c-39911227">[-]</label><label class="expand" for="c-39911227">[3 more]</label></div><br/><div class="children"><div class="content">Makes sense, if I was Apple I wouldn’t want to emphasize the “code” part of Xcode either.<p>I’ve used a lot of IDEs in my day, and it was hands down the worst.</div><br/><div id="39911913" class="c"><input type="checkbox" id="c-39911913" checked=""/><div class="controls bullet"><span class="by">t888</span><span>|</span><a href="#39910307">root</a><span>|</span><a href="#39911227">parent</a><span>|</span><a href="#39911521">next</a><span>|</span><label class="collapse" for="c-39911913">[-]</label><label class="expand" for="c-39911913">[1 more]</label></div><br/><div class="children"><div class="content">If you haven’t used it recently, you really need to update your view.</div><br/></div></div><div id="39911521" class="c"><input type="checkbox" id="c-39911521" checked=""/><div class="controls bullet"><span class="by">adamnemecek</span><span>|</span><a href="#39910307">root</a><span>|</span><a href="#39911227">parent</a><span>|</span><a href="#39911913">prev</a><span>|</span><a href="#39911445">next</a><span>|</span><label class="collapse" for="c-39911521">[-]</label><label class="expand" for="c-39911521">[1 more]</label></div><br/><div class="children"><div class="content">Xcode is pretty good these days.</div><br/></div></div></div></div></div></div><div id="39911445" class="c"><input type="checkbox" id="c-39911445" checked=""/><div class="controls bullet"><span class="by">bsaul</span><span>|</span><a href="#39910307">prev</a><span>|</span><a href="#39909054">next</a><span>|</span><label class="collapse" for="c-39911445">[-]</label><label class="expand" for="c-39911445">[4 more]</label></div><br/><div class="children"><div class="content">That’s nice, except for swift’s abysmal json encoding &#x2F; decoding performance.</div><br/><div id="39911820" class="c"><input type="checkbox" id="c-39911820" checked=""/><div class="controls bullet"><span class="by">Kon-Peki</span><span>|</span><a href="#39911445">parent</a><span>|</span><a href="#39909054">next</a><span>|</span><label class="collapse" for="c-39911820">[-]</label><label class="expand" for="c-39911820">[3 more]</label></div><br/><div class="children"><div class="content">Is that an up-to-date critique?  Because iOS 17&#x2F;MacOS Sonoma have the rewritten JSON decoder:<p>&gt; The code in our GitHub repository 20 has indeed shipped as part of iOS 17 and macOS Sonoma. That includes our new, dramatically faster implementations of JSONDecoder and Calendar.<p><a href="https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;any-updates-on-the-new-foundation&#x2F;68532&#x2F;11" rel="nofollow">https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;any-updates-on-the-new-foundation...</a><p>That comment was from Nov 2023, and if you look at the GitHub repo, you’ll see that the JSON part of Foundation has commits within even the last month (perhaps getting ready for Swift 6.0?).</div><br/><div id="39914438" class="c"><input type="checkbox" id="c-39914438" checked=""/><div class="controls bullet"><span class="by">bsaul</span><span>|</span><a href="#39911445">root</a><span>|</span><a href="#39911820">parent</a><span>|</span><a href="#39912381">next</a><span>|</span><label class="collapse" for="c-39914438">[-]</label><label class="expand" for="c-39914438">[1 more]</label></div><br/><div class="children"><div class="content">Didn&#x27;t know this shipped in ios 17. 
The comment mentions &quot;JSONDecoder&quot;, do you know if it&#x27;s only the decoder, or the encoder too ?<p>Problem with iOS is this constant need for objc compatibility and transparent bridging, which really messes things up a lot..</div><br/></div></div><div id="39912381" class="c"><input type="checkbox" id="c-39912381" checked=""/><div class="controls bullet"><span class="by">favorited</span><span>|</span><a href="#39911445">root</a><span>|</span><a href="#39911820">parent</a><span>|</span><a href="#39914438">prev</a><span>|</span><a href="#39909054">next</a><span>|</span><label class="collapse" for="c-39912381">[-]</label><label class="expand" for="c-39912381">[1 more]</label></div><br/><div class="children"><div class="content">Correct. Swift doesn&#x27;t have any concept of JSON in its standard library; JSON[Encoder|Decoder] are provided by the Foundation framework, which (until Sonoma&#x2F;iOS 17) used an Objective-C implementation of NSJSONSerialization.</div><br/></div></div></div></div></div></div><div id="39909054" class="c"><input type="checkbox" id="c-39909054" checked=""/><div class="controls bullet"><span class="by">veryrealsid</span><span>|</span><a href="#39911445">prev</a><span>|</span><label class="collapse" for="c-39909054">[-]</label><label class="expand" for="c-39909054">[1 more]</label></div><br/><div class="children"><div class="content">My CS professor would be proud</div><br/></div></div></div></div></div></div></div></body></html>