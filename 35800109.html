<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683277251026" as="style"/><link rel="stylesheet" href="styles.css?v=1683277251026"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cstack.github.io/db_tutorial/">Writing a SQLite Clone from Scratch in C</a>Â <span class="domain">(<a href="https://cstack.github.io">cstack.github.io</a>)</span></div><div class="subtext"><span>pgayed</span> | <span>32 comments</span></div><br/><div><div id="35826671" class="c"><input type="checkbox" id="c-35826671" checked=""/><div class="controls bullet"><span class="by">unwind</span><span>|</span><a href="#35825047">next</a><span>|</span><label class="collapse" for="c-35826671">[-]</label><label class="expand" for="c-35826671">[1 more]</label></div><br/><div class="children"><div class="content">This seems serious, and a very nice introduction&#x2F;primer on how databases work under the hood, thanks for sharing!<p>One minor nitpick after glancing quickly at the code: there&#x27;s pointer arithmetic with &#x27;void *&#x27; pointers [1], which is a GCC extension and not portable [2]. It should be rewritten using the proper casts, in my opinion.<p>[1]: <a href="https:&#x2F;&#x2F;cstack.github.io&#x2F;db_tutorial&#x2F;parts&#x2F;part8.html#accessing-leaf-node-fields" rel="nofollow">https:&#x2F;&#x2F;cstack.github.io&#x2F;db_tutorial&#x2F;parts&#x2F;part8.html#access...</a><p>[2]:<a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;3523145&#x2F;pointer-arithmetic-for-void-pointer-in-c" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;3523145&#x2F;pointer-arithmet...</a></div><br/></div></div><div id="35825047" class="c"><input type="checkbox" id="c-35825047" checked=""/><div class="controls bullet"><span class="by">bruce511</span><span>|</span><a href="#35826671">prev</a><span>|</span><a href="#35824390">next</a><span>|</span><label class="collapse" for="c-35825047">[-]</label><label class="expand" for="c-35825047">[8 more]</label></div><br/><div class="children"><div class="content">In software, as in most things, most of learning is done by doing. Creating a clone of something from scratch is a really useful learning technique and has the benefit of a defined specification.<p>It doesn&#x27;t even really matter if the job is even completed  or if the program is ever used. The important part is the doing, not the result.<p>I confess we did similar things at uni 30 years ago, although we mostly re-implemented arcade games, not sql databases. Databases are likely more useful to understand.<p>All programmers have to go through 3 stages;<p>A) I program to prove to myself I can<p>B) I program to prove to others I can<p>C) I know I can write this, you know I can write this, but its cheaper and easier to use this existing, available, code to do the job.<p>I like c) programmers in business because they understand that the goal of the business is making money  not generating code. A guy who -could- write SQLite, but then understands why -using- SQLite would be better, is enormously valuable.<p>(Not to mention his SQL chops are probably pretty good by then)</div><br/><div id="35825281" class="c"><input type="checkbox" id="c-35825281" checked=""/><div class="controls bullet"><span class="by">asveikau</span><span>|</span><a href="#35825047">parent</a><span>|</span><a href="#35825547">next</a><span>|</span><label class="collapse" for="c-35825281">[-]</label><label class="expand" for="c-35825281">[3 more]</label></div><br/><div class="children"><div class="content">Regarding C), I think it actually gets tough.<p>&gt; but its cheaper and easier to use this existing, available, code to do the job.<p>What often happens is that the existing, available, sometimes even popular and well regarded code has lots of issues that you may only find after you deploy the thing.  Then, you need to decide what tack to take.  Can you engage upstream?  Do you end up maintaining third party code yourself to fix the issues?  Working around quirky bugs?  You may even find yourself so frustrated with all of the above that you wind up abandoning the dependency and writing something new in-house.<p>But honestly, getting back to the topic, sqlite is not one of those things.  Sqlite is a very solid library.</div><br/><div id="35825431" class="c"><input type="checkbox" id="c-35825431" checked=""/><div class="controls bullet"><span class="by">bruce511</span><span>|</span><a href="#35825047">root</a><span>|</span><a href="#35825281">parent</a><span>|</span><a href="#35825547">next</a><span>|</span><label class="collapse" for="c-35825431">[-]</label><label class="expand" for="c-35825431">[2 more]</label></div><br/><div class="children"><div class="content">Yes, I agree  not every bit of available code is perfect. A lot of it is crap. Choosing an existing library is worth taking dome time and research over.<p>Inevitably some libraries will need replacing. In some cases we&#x27;ve ended up rolling our own. But in these cases the time spent with the discarded library is not wasted. Rather it gives us a chance to understand the domain better, to understand our needs better, and ultimately to have better criteria for making our choices.<p>Things like documentation, support, bug fixing, source code, and so on have all become important parts of the evaluation process.<p>Interestingly our internal libraries are often less-well documented (if at all)  the author is sometimes no longer around, and it usually has all kinds of quirks we work around. This after taking longer, and costing more, written from an unclear spec by people not terribly familiar with the domain.<p>And yes, we&#x27;ve hone the nuclear route of ripping out and rewriting, and that is expensive , but no more expensive than defaulting to &quot;write ourselves &quot;, and indeed usually cheaper because we have a better idea of what we want.</div><br/><div id="35826425" class="c"><input type="checkbox" id="c-35826425" checked=""/><div class="controls bullet"><span class="by">fps_doug</span><span>|</span><a href="#35825047">root</a><span>|</span><a href="#35825431">parent</a><span>|</span><a href="#35825547">next</a><span>|</span><label class="collapse" for="c-35826425">[-]</label><label class="expand" for="c-35826425">[1 more]</label></div><br/><div class="children"><div class="content">I think one of the things you learn on your way to C) is when it makes sense to roll your own. It is difficult, and maybe something that actually happens after c.<p>It seems to be very hard to make that call in time, and in the past I feel like every time we chose to implement something on our own, the existing solution would have been better in hindsight, and every time we said &quot;ok, that existing solution looks fine&quot; it turned out to be a dumpster fire a year down the line. But obviously the times where you made the right call just don&#x27;t stick out that much because stuff &quot;just worked&quot;, and also, in case you think you made the wrong decision, the alternative could&#x27;ve been ever worse. But still, I guess everybody knows that feeling? :-)</div><br/></div></div></div></div></div></div><div id="35825547" class="c"><input type="checkbox" id="c-35825547" checked=""/><div class="controls bullet"><span class="by">lelanthran</span><span>|</span><a href="#35825047">parent</a><span>|</span><a href="#35825281">prev</a><span>|</span><a href="#35826588">next</a><span>|</span><label class="collapse" for="c-35825547">[-]</label><label class="expand" for="c-35825547">[3 more]</label></div><br/><div class="children"><div class="content">The problem is that a lot of the existing code that will be chosen by type C is written by type A.<p>Type B is writing code for money, so it almost never gets reused outside an organisation.</div><br/><div id="35826159" class="c"><input type="checkbox" id="c-35826159" checked=""/><div class="controls bullet"><span class="by">andai</span><span>|</span><a href="#35825047">root</a><span>|</span><a href="#35825547">parent</a><span>|</span><a href="#35825725">next</a><span>|</span><label class="collapse" for="c-35826159">[-]</label><label class="expand" for="c-35826159">[1 more]</label></div><br/><div class="children"><div class="content">The kind of people who write code to prove to themselves that they can, may be exactly the kind of programmers whose code we should be using.<p>They love programming, which means they do it a lot (beyond the bare minimum), which means they&#x27;re probably pretty good!</div><br/></div></div><div id="35825725" class="c"><input type="checkbox" id="c-35825725" checked=""/><div class="controls bullet"><span class="by">chaxor</span><span>|</span><a href="#35825047">root</a><span>|</span><a href="#35825547">parent</a><span>|</span><a href="#35826159">prev</a><span>|</span><a href="#35826588">next</a><span>|</span><label class="collapse" for="c-35825725">[-]</label><label class="expand" for="c-35825725">[1 more]</label></div><br/><div class="children"><div class="content">Found the js programmer</div><br/></div></div></div></div><div id="35826588" class="c"><input type="checkbox" id="c-35826588" checked=""/><div class="controls bullet"><span class="by">throwawawy0623x</span><span>|</span><a href="#35825047">parent</a><span>|</span><a href="#35825547">prev</a><span>|</span><a href="#35824390">next</a><span>|</span><label class="collapse" for="c-35826588">[-]</label><label class="expand" for="c-35826588">[1 more]</label></div><br/><div class="children"><div class="content">An extension of C) is that this not only applies to open source. I was in a startup where the new employees decided to throw away working stable services to write their own version and they wasted a lot of time for little benefit. In the meantime the startup failed to deliver the necessary NEW functionality and we lost a lot of potential customers and sales people who were tired of waiting.<p>Working with other people&#x27;s code is one of the most valuable skills. Be willing to live with existing code for a while and understand why it was implemented that way. Only then can you know what you should change.</div><br/></div></div></div></div><div id="35824390" class="c"><input type="checkbox" id="c-35824390" checked=""/><div class="controls bullet"><span class="by">skripp</span><span>|</span><a href="#35825047">prev</a><span>|</span><a href="#35825422">next</a><span>|</span><label class="collapse" for="c-35824390">[-]</label><label class="expand" for="c-35824390">[7 more]</label></div><br/><div class="children"><div class="content">I love these type of projects. This is definitely on the top of my reading list now.<p>Another wonderful âfrom scratchâ resource is âCrafting interpretersâ [0] that I was recommended here on hn.<p>[0] <a href="https:&#x2F;&#x2F;craftinginterpreters.com&#x2F;introduction.html" rel="nofollow">https:&#x2F;&#x2F;craftinginterpreters.com&#x2F;introduction.html</a></div><br/><div id="35824621" class="c"><input type="checkbox" id="c-35824621" checked=""/><div class="controls bullet"><span class="by">tmountain</span><span>|</span><a href="#35824390">parent</a><span>|</span><a href="#35825915">next</a><span>|</span><label class="collapse" for="c-35824621">[-]</label><label class="expand" for="c-35824621">[4 more]</label></div><br/><div class="children"><div class="content">Another good one is handmade hero for creating a game from the absolute beginning. Itâs extremely lengthy, but very information dense, and itâs only $15 USD.<p><a href="https:&#x2F;&#x2F;handmadehero.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;handmadehero.org&#x2F;</a></div><br/><div id="35826609" class="c"><input type="checkbox" id="c-35826609" checked=""/><div class="controls bullet"><span class="by">detrites</span><span>|</span><a href="#35824390">root</a><span>|</span><a href="#35824621">parent</a><span>|</span><a href="#35825121">next</a><span>|</span><label class="collapse" for="c-35826609">[-]</label><label class="expand" for="c-35826609">[1 more]</label></div><br/><div class="children"><div class="content">I clicked around, read the FAQ and skimmed some videos, but I could find no description, nor images of the actual game. The best I could find was in a 2hr episode numbered in the 600&#x27;s, about 20 wireframe boxes being moved around.<p>Is there any description of the game you&#x27;re going to invest all this time to build?<p>And, if those wireframe boxes really are the result of 1200 hrs of coding - count me out.</div><br/></div></div><div id="35825121" class="c"><input type="checkbox" id="c-35825121" checked=""/><div class="controls bullet"><span class="by">AlchemistCamp</span><span>|</span><a href="#35824390">root</a><span>|</span><a href="#35824621">parent</a><span>|</span><a href="#35826609">prev</a><span>|</span><a href="#35825915">next</a><span>|</span><label class="collapse" for="c-35825121">[-]</label><label class="expand" for="c-35825121">[2 more]</label></div><br/><div class="children"><div class="content">Wow, you werenât kidding. I canât imagine how anyone could join in and get caught up to the present day state of the code.<p>&gt; <i>âHow long is the series expected to last?â</i><p>&gt; <i>âThe series started on November 17th, 2014. Sessions are limited to two hours or less per day so it remains manageable for people who practice coding along with the series at home. There is no prescribed length for the series. It will continue until all the game and engine code is complete.â</i></div><br/><div id="35825187" class="c"><input type="checkbox" id="c-35825187" checked=""/><div class="controls bullet"><span class="by">smaddox</span><span>|</span><a href="#35824390">root</a><span>|</span><a href="#35825121">parent</a><span>|</span><a href="#35825915">next</a><span>|</span><label class="collapse" for="c-35825187">[-]</label><label class="expand" for="c-35825187">[1 more]</label></div><br/><div class="children"><div class="content">Even just watching the first ~20 episodes dramatically altered how I approach coding, for the better. At least, when combined with his blog posts, e.g. <a href="https:&#x2F;&#x2F;caseymuratori.com&#x2F;blog_0015" rel="nofollow">https:&#x2F;&#x2F;caseymuratori.com&#x2F;blog_0015</a> (you can skip the snarky intro)</div><br/></div></div></div></div></div></div><div id="35825915" class="c"><input type="checkbox" id="c-35825915" checked=""/><div class="controls bullet"><span class="by">teleforce</span><span>|</span><a href="#35824390">parent</a><span>|</span><a href="#35824621">prev</a><span>|</span><a href="#35825152">next</a><span>|</span><label class="collapse" for="c-35825915">[-]</label><label class="expand" for="c-35825915">[1 more]</label></div><br/><div class="children"><div class="content">This is a book on Building Git clone:<p><a href="https:&#x2F;&#x2F;shop.jcoglan.com&#x2F;building-git&#x2F;" rel="nofollow">https:&#x2F;&#x2F;shop.jcoglan.com&#x2F;building-git&#x2F;</a><p>HN post on the review of James Coglanâs Building Git:<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35626698" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35626698</a></div><br/></div></div><div id="35825152" class="c"><input type="checkbox" id="c-35825152" checked=""/><div class="controls bullet"><span class="by">ternaryoperator</span><span>|</span><a href="#35824390">parent</a><span>|</span><a href="#35825915">prev</a><span>|</span><a href="#35825422">next</a><span>|</span><label class="collapse" for="c-35825152">[-]</label><label class="expand" for="c-35825152">[1 more]</label></div><br/><div class="children"><div class="content">Another good one is Jacobin[0], a JVM being written in go.<p>[0] <a href="http:&#x2F;&#x2F;jacobin.org" rel="nofollow">http:&#x2F;&#x2F;jacobin.org</a></div><br/></div></div></div></div><div id="35825422" class="c"><input type="checkbox" id="c-35825422" checked=""/><div class="controls bullet"><span class="by">pyrolistical</span><span>|</span><a href="#35824390">prev</a><span>|</span><a href="#35826479">next</a><span>|</span><label class="collapse" for="c-35825422">[-]</label><label class="expand" for="c-35825422">[2 more]</label></div><br/><div class="children"><div class="content">Since SQLite is already written in C, it would be interesting to do a rewrite in a different system language like zig</div><br/><div id="35825692" class="c"><input type="checkbox" id="c-35825692" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#35825422">parent</a><span>|</span><a href="#35826479">next</a><span>|</span><label class="collapse" for="c-35825692">[-]</label><label class="expand" for="c-35825692">[1 more]</label></div><br/><div class="children"><div class="content">Indeed: Zig, Rust, Ada&#x2F;spark, Nim, ATS â anything would be more interesting to see than C.<p>OTOH two different C implementations would be more interesting to compare for a C connoisseur.</div><br/></div></div></div></div><div id="35826479" class="c"><input type="checkbox" id="c-35826479" checked=""/><div class="controls bullet"><span class="by">detrites</span><span>|</span><a href="#35825422">prev</a><span>|</span><a href="#35825020">next</a><span>|</span><label class="collapse" for="c-35826479">[-]</label><label class="expand" for="c-35826479">[1 more]</label></div><br/><div class="children"><div class="content">Looks like this is from 2017-2019, incomplete, and hasn&#x27;t been active much since then.<p>Unanswered issue about the likelihood of continuation:
<a href="https:&#x2F;&#x2F;github.com&#x2F;cstack&#x2F;db_tutorial&#x2F;issues&#x2F;94">https:&#x2F;&#x2F;github.com&#x2F;cstack&#x2F;db_tutorial&#x2F;issues&#x2F;94</a></div><br/></div></div><div id="35825020" class="c"><input type="checkbox" id="c-35825020" checked=""/><div class="controls bullet"><span class="by">fooker</span><span>|</span><a href="#35826479">prev</a><span>|</span><a href="#35824499">next</a><span>|</span><label class="collapse" for="c-35825020">[-]</label><label class="expand" for="c-35825020">[1 more]</label></div><br/><div class="children"><div class="content">Sqlite has a fairly exhaustive test suite.<p>I wonder how far we are from auto-generating code which manages to pass these tests and maybe produce same results on random queries compared to SQLite3.<p>Two years ago, Iâd have said 50 years. That estimate is now blown.</div><br/></div></div><div id="35824499" class="c"><input type="checkbox" id="c-35824499" checked=""/><div class="controls bullet"><span class="by">comfypotato</span><span>|</span><a href="#35825020">prev</a><span>|</span><a href="#35824669">next</a><span>|</span><label class="collapse" for="c-35824499">[-]</label><label class="expand" for="c-35824499">[6 more]</label></div><br/><div class="children"><div class="content">Doesnât SQL have decades worth of optimizations? I remember something from my databases class where the professor was mentioning how itâs to the point now where nobody really understands every aspect of what goes on between the query and the machine instructions.<p>Still cool as a hobby project.</div><br/><div id="35825003" class="c"><input type="checkbox" id="c-35825003" checked=""/><div class="controls bullet"><span class="by">klabb3</span><span>|</span><a href="#35824499">parent</a><span>|</span><a href="#35824517">next</a><span>|</span><label class="collapse" for="c-35825003">[-]</label><label class="expand" for="c-35825003">[1 more]</label></div><br/><div class="children"><div class="content">Thatâs probably true but building a clone that people understand, even if slower, is extremely valuable. Understanding an existing technology deeply is a gateway to innovation.<p>That said, SQLite is so remarkably stable, lightweight like a feather, and incredibly battletested, that even a hypothetically superior alternative would have an immense uphill battle to reach the same value prop.</div><br/></div></div><div id="35824517" class="c"><input type="checkbox" id="c-35824517" checked=""/><div class="controls bullet"><span class="by">valleyer</span><span>|</span><a href="#35824499">parent</a><span>|</span><a href="#35825003">prev</a><span>|</span><a href="#35824669">next</a><span>|</span><label class="collapse" for="c-35824517">[-]</label><label class="expand" for="c-35824517">[4 more]</label></div><br/><div class="children"><div class="content">SQL is not the name of a piece of software, and SQLite is developed by a single person.</div><br/><div id="35824544" class="c"><input type="checkbox" id="c-35824544" checked=""/><div class="controls bullet"><span class="by">scblock</span><span>|</span><a href="#35824499">root</a><span>|</span><a href="#35824517">parent</a><span>|</span><a href="#35824697">next</a><span>|</span><label class="collapse" for="c-35824544">[-]</label><label class="expand" for="c-35824544">[2 more]</label></div><br/><div class="children"><div class="content">While SQLite is developed by a very small team[1] and does not openly accept patches[2], it is not developed by a single person.<p>1: <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;crew.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;crew.html</a>
2: <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;copyright.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;copyright.html</a></div><br/><div id="35824949" class="c"><input type="checkbox" id="c-35824949" checked=""/><div class="controls bullet"><span class="by">valray</span><span>|</span><a href="#35824499">root</a><span>|</span><a href="#35824544">parent</a><span>|</span><a href="#35824697">next</a><span>|</span><label class="collapse" for="c-35824949">[-]</label><label class="expand" for="c-35824949">[1 more]</label></div><br/><div class="children"><div class="content">From the link, it appears that it was developed by a single person in 2000, who then brought on board 2 other people as contributors in 2002 and after.</div><br/></div></div></div></div></div></div></div></div><div id="35824669" class="c"><input type="checkbox" id="c-35824669" checked=""/><div class="controls bullet"><span class="by">nickpeterson</span><span>|</span><a href="#35824499">prev</a><span>|</span><a href="#35825363">next</a><span>|</span><label class="collapse" for="c-35824669">[-]</label><label class="expand" for="c-35824669">[1 more]</label></div><br/><div class="children"><div class="content">How about a C clone in SQLite?</div><br/></div></div><div id="35825363" class="c"><input type="checkbox" id="c-35825363" checked=""/><div class="controls bullet"><span class="by">simula67</span><span>|</span><a href="#35824669">prev</a><span>|</span><a href="#35825729">next</a><span>|</span><label class="collapse" for="c-35825363">[-]</label><label class="expand" for="c-35825363">[1 more]</label></div><br/><div class="children"><div class="content">How unfortunate that Sqlite Virtual Machine has opcodes to directly manipulate B-Trees. The opcode documentation[1] is even written in terms of B-Trees. This means that it would be too complicated to replace the storage engine with something else, necessitating the need for seperate products such as duckdb.<p>[1] <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;opcode.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;opcode.html</a></div><br/></div></div><div id="35825729" class="c"><input type="checkbox" id="c-35825729" checked=""/><div class="controls bullet"><span class="by">emrah</span><span>|</span><a href="#35825363">prev</a><span>|</span><a href="#35826380">next</a><span>|</span><label class="collapse" for="c-35825729">[-]</label><label class="expand" for="c-35825729">[1 more]</label></div><br/><div class="children"><div class="content">Building is a great way to learn for sure but exact cloning gets boring for me. I always end up needing to introduce some kind of twist to the original idea to keep the project interesting beyond a certain point</div><br/></div></div><div id="35826380" class="c"><input type="checkbox" id="c-35826380" checked=""/><div class="controls bullet"><span class="by">Shorel</span><span>|</span><a href="#35825729">prev</a><span>|</span><a href="#35825451">next</a><span>|</span><label class="collapse" for="c-35826380">[-]</label><label class="expand" for="c-35826380">[1 more]</label></div><br/><div class="children"><div class="content">Good, hopefully this will be the second implementation that the W3C standards committee will accept, so SQLite is an approved web standard instead of the disappointing thing we got.</div><br/></div></div><div id="35825451" class="c"><input type="checkbox" id="c-35825451" checked=""/><div class="controls bullet"><span class="by">rurban</span><span>|</span><a href="#35826380">prev</a><span>|</span><label class="collapse" for="c-35825451">[-]</label><label class="expand" for="c-35825451">[1 more]</label></div><br/><div class="children"><div class="content">This would be a good chance to outline and fix some of the worst design decisions of the various sqlite hacks and security issues.<p>No stack, so no proper subfunction model, such as triggers or functions calling other functions. 
Simple remote queries can be made destructive, due to the extremely hackish design.
The horrible, insecure by default text search engine.<p>Unfortunately this guy treats sqlite as a role model of a good design. Maybe he will find out when it&#x27;s too late.
<a href="https:&#x2F;&#x2F;github.com&#x2F;rurban&#x2F;hardsqlite">https:&#x2F;&#x2F;github.com&#x2F;rurban&#x2F;hardsqlite</a></div><br/></div></div></div></div></div></div></div></body></html>