<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729587670586" as="style"/><link rel="stylesheet" href="styles.css?v=1729587670586"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/nh2/internal-contstrained-pki">Just want simple TLS for your .internal network?</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>nh2</span> | <span>13 comments</span></div><br/><div><div id="41912342" class="c"><input type="checkbox" id="c-41912342" checked=""/><div class="controls bullet"><span class="by">ndsipa_pomu</span><span>|</span><a href="#41877202">next</a><span>|</span><label class="collapse" for="c-41912342">[-]</label><label class="expand" for="c-41912342">[3 more]</label></div><br/><div class="children"><div class="content">I prefer to assign an external name to an internal device and grab a free SSL cert from LetsEncrypt, but using DNS challenge instead as internal IP addresses aren&#x27;t reachable by their servers.</div><br/><div id="41912368" class="c"><input type="checkbox" id="c-41912368" checked=""/><div class="controls bullet"><span class="by">DandyDev</span><span>|</span><a href="#41912342">parent</a><span>|</span><a href="#41877202">next</a><span>|</span><label class="collapse" for="c-41912368">[-]</label><label class="expand" for="c-41912368">[2 more]</label></div><br/><div class="children"><div class="content">I do this as well, but be aware that these external names you&#x27;re using for internal devices become a matter of public record this way. If that&#x27;s okay for you (it is for me), then this is a good solution. The advantage is also that you run no risk of name clashes because you actually own the domain</div><br/><div id="41912424" class="c"><input type="checkbox" id="c-41912424" checked=""/><div class="controls bullet"><span class="by">xfer</span><span>|</span><a href="#41912342">root</a><span>|</span><a href="#41912368">parent</a><span>|</span><a href="#41877202">next</a><span>|</span><label class="collapse" for="c-41912424">[-]</label><label class="expand" for="c-41912424">[1 more]</label></div><br/><div class="children"><div class="content">Or use a wildcard cert for all internal certs.</div><br/></div></div></div></div></div></div><div id="41877202" class="c"><input type="checkbox" id="c-41877202" checked=""/><div class="controls bullet"><span class="by">kassner</span><span>|</span><a href="#41912342">prev</a><span>|</span><a href="#41912427">next</a><span>|</span><label class="collapse" for="c-41877202">[-]</label><label class="expand" for="c-41877202">[3 more]</label></div><br/><div class="children"><div class="content">From the linked Netflix article:<p>&gt; The Trouble with Name Constraints<p>&gt; The Name Constraints extension lives on the certificate of a CA but can’t actually constrain what a bad actor does with that CA’s private key<p>&gt; Therefore, it is up to the TLS _client_ to verify that all constraints are satisfied<p>&gt; However, as we extended our test suite beyond basic tests we rapidly began to lose confidence. We created a battery of test certificates which moved the subject name between the certificate’s subject common name and Subject Alternate Name extension, which mixed the use of Name Constraint whitelisting and blacklisting, and which used both DNS names and IP names in the constraint. The result was that every browser (except for Firefox, which showed a 100% pass rate) and every HTTPS client (such as Java, Node.JS, and Python) allowed some sort of Name Constraint bypass.<p>That’s the danger of any solution that requires trusting a self-signed CA. Better just trust the leaf certificate, maybe make it wildcard, so you only have to go through the trust-invalid-cert once?</div><br/><div id="41878947" class="c"><input type="checkbox" id="c-41878947" checked=""/><div class="controls bullet"><span class="by">nh2</span><span>|</span><a href="#41877202">parent</a><span>|</span><a href="#41912268">next</a><span>|</span><label class="collapse" for="c-41878947">[-]</label><label class="expand" for="c-41878947">[1 more]</label></div><br/><div class="children"><div class="content">Note that statement is 7 years old, it prompted Netflix to make bettertls.com.<p>The situation has improved since then, see the linked <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37544094">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37544094</a></div><br/></div></div><div id="41912268" class="c"><input type="checkbox" id="c-41912268" checked=""/><div class="controls bullet"><span class="by">chgs</span><span>|</span><a href="#41877202">parent</a><span>|</span><a href="#41878947">prev</a><span>|</span><a href="#41912427">next</a><span>|</span><label class="collapse" for="c-41912268">[-]</label><label class="expand" for="c-41912268">[1 more]</label></div><br/><div class="children"><div class="content">I wa t ti be able to import a cert into by browser and specify what to trust it for myself. “Only trust this cert for domain.com” did example.<p>The name constraints can give me a hint what it’s designed for, but if I import a cert to MITM devsite.org, I don’t want that cert working for mybank.com.</div><br/></div></div></div></div><div id="41912427" class="c"><input type="checkbox" id="c-41912427" checked=""/><div class="controls bullet"><span class="by">dveeden2</span><span>|</span><a href="#41877202">prev</a><span>|</span><a href="#41876742">next</a><span>|</span><label class="collapse" for="c-41912427">[-]</label><label class="expand" for="c-41912427">[1 more]</label></div><br/><div class="children"><div class="content">VALIDITY_DAYS=&quot;3650&quot;<p>I&#x27;d rather see something with 90 days and ACME. Note sure why there isn&#x27;t a simple certificate management tool that does this and maybe even brings a simple UI?</div><br/></div></div><div id="41876742" class="c"><input type="checkbox" id="c-41876742" checked=""/><div class="controls bullet"><span class="by">nh2</span><span>|</span><a href="#41912427">prev</a><span>|</span><a href="#41912164">next</a><span>|</span><label class="collapse" for="c-41876742">[-]</label><label class="expand" for="c-41876742">[4 more]</label></div><br/><div class="children"><div class="content">I did some research, write-up and scripting about the state of X.509 Name Constraints, so that people you give your CA cert to don&#x27;t need to trust you not to MitM them on other domains.<p>Packaged into a convenient one-liner to create a wildcard cert under for the new .internal TLD.<p>Please scrutinize!<p>I use this to provide e.g. at home:<p><pre><code>    https:&#x2F;&#x2F;octoprint.myhome.internal
    https:&#x2F;&#x2F;paperless.myhome.internal
</code></pre>
to provide transport encryption of these services in the local WiFi.<p>Friends and family can add the CA root to their devices without having to worry about me MitM&#x27;ing their other connections.</div><br/><div id="41912340" class="c"><input type="checkbox" id="c-41912340" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#41876742">parent</a><span>|</span><a href="#41912265">next</a><span>|</span><label class="collapse" for="c-41912340">[-]</label><label class="expand" for="c-41912340">[2 more]</label></div><br/><div class="children"><div class="content">Is it possible to constrain existing CA?<p>For example my government uses non-standard CA and some websites rely on it. But importing CA obviously makes them able to issue google.com and MITM me if they want to. And they already tried, so trust is broken.<p>I imagine something like generating separate name-constrained certificate, sign existing CA with this name-constrained certificate (I think it&#x27;s called cross-sign or something like that) and import things into OS, expecting that browser will use name-constraints of the &quot;Root-Root&quot; certificate. Could it work?</div><br/></div></div><div id="41912265" class="c"><input type="checkbox" id="c-41912265" checked=""/><div class="controls bullet"><span class="by">ulfbert_inc</span><span>|</span><a href="#41876742">parent</a><span>|</span><a href="#41912340">prev</a><span>|</span><a href="#41912164">next</a><span>|</span><label class="collapse" for="c-41912265">[-]</label><label class="expand" for="c-41912265">[1 more]</label></div><br/><div class="children"><div class="content">Niklas, if you are reading this - it was a pleasure to interview with you some 6 (or so) years ago :) thanks for the script and the research, I will make use of it.</div><br/></div></div></div></div><div id="41912164" class="c"><input type="checkbox" id="c-41912164" checked=""/><div class="controls bullet"><span class="by">Havoc</span><span>|</span><a href="#41876742">prev</a><span>|</span><label class="collapse" for="c-41912164">[-]</label><label class="expand" for="c-41912164">[1 more]</label></div><br/><div class="children"><div class="content">tbh the skill level require for a valid wildcard cert isn’t all that high either.</div><br/></div></div></div></div></div></div></div></body></html>