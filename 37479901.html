<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1694682063342" as="style"/><link rel="stylesheet" href="styles.css?v=1694682063342"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/codazoda/hub-ctrl.c">Control USB power on a port by port basis on some USB hubs</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>codazoda</span> | <span>28 comments</span></div><br/><div><div id="37501944" class="c"><input type="checkbox" id="c-37501944" checked=""/><div class="controls bullet"><span class="by">TheRealPomax</span><span>|</span><a href="#37502112">next</a><span>|</span><label class="collapse" for="c-37501944">[-]</label><label class="expand" for="c-37501944">[3 more]</label></div><br/><div class="children"><div class="content">This is what I have a ykush[1] hub for, with an iLok dongle plugged in and VirtualHere sharing that USB device over the network. Only one machine can use the dongle at a time (so it&#x27;s basically just a way to not have to constantly walk a dongle from a laptop to a workstation to a bedroom computer and back) the iLok binds the machine id of whatever computer&#x27;s using it and the only way to clear it is to unplug the iLok. Or cut its power. A simple LAN-only server that accepts a &quot;GET &#x2F;reset-usb&quot; call that cycles the power on each of the ports on the hub solves that problem<p>[1] <a href="https:&#x2F;&#x2F;www.yepkit.com&#x2F;products&#x2F;ykush" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.yepkit.com&#x2F;products&#x2F;ykush</a></div><br/><div id="37503465" class="c"><input type="checkbox" id="c-37503465" checked=""/><div class="controls bullet"><span class="by">bombcar</span><span>|</span><a href="#37501944">parent</a><span>|</span><a href="#37503454">next</a><span>|</span><label class="collapse" for="c-37503465">[-]</label><label class="expand" for="c-37503465">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.virtualhere.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.virtualhere.com</a> - VirtualHere might be exactly what I&#x27;ve been looking for ...</div><br/></div></div><div id="37503454" class="c"><input type="checkbox" id="c-37503454" checked=""/><div class="controls bullet"><span class="by">TheSpiceIsLife</span><span>|</span><a href="#37501944">parent</a><span>|</span><a href="#37503465">prev</a><span>|</span><a href="#37502112">next</a><span>|</span><label class="collapse" for="c-37503454">[-]</label><label class="expand" for="c-37503454">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d forgotten about VirtualHere, thanks for the reminder.</div><br/></div></div></div></div><div id="37502112" class="c"><input type="checkbox" id="c-37502112" checked=""/><div class="controls bullet"><span class="by">tpolzer</span><span>|</span><a href="#37501944">prev</a><span>|</span><a href="#37500975">next</a><span>|</span><label class="collapse" for="c-37502112">[-]</label><label class="expand" for="c-37502112">[7 more]</label></div><br/><div class="children"><div class="content">Is this just a less polished&#x2F;active version of <a href="https:&#x2F;&#x2F;github.com&#x2F;mvp&#x2F;uhubctl">https:&#x2F;&#x2F;github.com&#x2F;mvp&#x2F;uhubctl</a>?</div><br/><div id="37502255" class="c"><input type="checkbox" id="c-37502255" checked=""/><div class="controls bullet"><span class="by">RaoulP</span><span>|</span><a href="#37502112">parent</a><span>|</span><a href="#37500975">next</a><span>|</span><label class="collapse" for="c-37502255">[-]</label><label class="expand" for="c-37502255">[6 more]</label></div><br/><div class="children"><div class="content">Thanks for linking! This one is way more up to date with regards to compatible USB hubs. It credits the project in the OP:<p>&gt;Original idea for this code was inspired by hub-ctrl.c by Niibe Yutaka: <a href="https:&#x2F;&#x2F;www.gniibe.org&#x2F;development&#x2F;ac-power-control-by-USB-hub" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.gniibe.org&#x2F;development&#x2F;ac-power-control-by-USB-h...</a></div><br/><div id="37502427" class="c"><input type="checkbox" id="c-37502427" checked=""/><div class="controls bullet"><span class="by">teakie</span><span>|</span><a href="#37502112">root</a><span>|</span><a href="#37502255">parent</a><span>|</span><a href="#37500975">next</a><span>|</span><label class="collapse" for="c-37502427">[-]</label><label class="expand" for="c-37502427">[5 more]</label></div><br/><div class="children"><div class="content">I want power only USB Cables. The USB-C protcoll was allready a security thread resulting in unlocking fde and successfull boot up</div><br/><div id="37503158" class="c"><input type="checkbox" id="c-37503158" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37502112">root</a><span>|</span><a href="#37502427">parent</a><span>|</span><a href="#37500975">next</a><span>|</span><label class="collapse" for="c-37503158">[-]</label><label class="expand" for="c-37503158">[4 more]</label></div><br/><div class="children"><div class="content">amazon has them, or you can get &quot;usb condoms&quot;.</div><br/><div id="37503323" class="c"><input type="checkbox" id="c-37503323" checked=""/><div class="controls bullet"><span class="by">nikau</span><span>|</span><a href="#37502112">root</a><span>|</span><a href="#37503158">parent</a><span>|</span><a href="#37503286">next</a><span>|</span><label class="collapse" for="c-37503323">[-]</label><label class="expand" for="c-37503323">[2 more]</label></div><br/><div class="children"><div class="content">Make sure to get the ones with active circuitry on them to negotiate charging speed, otherwise you will be stuck at 5v and under an amp.<p>I got some ti chip ones from aliexpress for around 4 bucks each that have worked flawlessly on laptops and phones.</div><br/><div id="37506350" class="c"><input type="checkbox" id="c-37506350" checked=""/><div class="controls bullet"><span class="by">teakie</span><span>|</span><a href="#37502112">root</a><span>|</span><a href="#37503323">parent</a><span>|</span><a href="#37503286">next</a><span>|</span><label class="collapse" for="c-37506350">[-]</label><label class="expand" for="c-37506350">[1 more]</label></div><br/><div class="children"><div class="content">yes that negotion is a specific protocoll of USB-C and was used to unlock fde encryption through the USB-C port connected secure enclave, that was happy to decrypt fed as if you had entered the password. the next generation had magsafe again :)</div><br/></div></div></div></div><div id="37503286" class="c"><input type="checkbox" id="c-37503286" checked=""/><div class="controls bullet"><span class="by">tmpX7dMeXU</span><span>|</span><a href="#37502112">root</a><span>|</span><a href="#37503158">parent</a><span>|</span><a href="#37503323">prev</a><span>|</span><a href="#37500975">next</a><span>|</span><label class="collapse" for="c-37503286">[-]</label><label class="expand" for="c-37503286">[1 more]</label></div><br/><div class="children"><div class="content">I’m more a fan of the unsafe ejection method.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37500975" class="c"><input type="checkbox" id="c-37500975" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37502112">prev</a><span>|</span><a href="#37506169">next</a><span>|</span><label class="collapse" for="c-37500975">[-]</label><label class="expand" for="c-37500975">[1 more]</label></div><br/><div class="children"><div class="content">We used something like this for one of the high resolution depth cameras we had that had some buggy driver&#x2F;firmware issue. IT needed to be power cycled every once in a while...</div><br/></div></div><div id="37506169" class="c"><input type="checkbox" id="c-37506169" checked=""/><div class="controls bullet"><span class="by">londons_explore</span><span>|</span><a href="#37500975">prev</a><span>|</span><a href="#37502028">next</a><span>|</span><label class="collapse" for="c-37506169">[-]</label><label class="expand" for="c-37506169">[1 more]</label></div><br/><div class="children"><div class="content">Note that this works with most hubs <i>inside</i> laptops.<p>I use it to turn a USB desk lamp on and off.</div><br/></div></div><div id="37502028" class="c"><input type="checkbox" id="c-37502028" checked=""/><div class="controls bullet"><span class="by">gertlex</span><span>|</span><a href="#37506169">prev</a><span>|</span><a href="#37504226">next</a><span>|</span><label class="collapse" for="c-37502028">[-]</label><label class="expand" for="c-37502028">[5 more]</label></div><br/><div class="children"><div class="content">Hmmm. Readme unfortunately fails to note what the required hardware is (that apparently has a common&#x2F;shared control interface) which makes these USB hubs controllable.</div><br/><div id="37502423" class="c"><input type="checkbox" id="c-37502423" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#37502028">parent</a><span>|</span><a href="#37504226">next</a><span>|</span><label class="collapse" for="c-37502423">[-]</label><label class="expand" for="c-37502423">[4 more]</label></div><br/><div class="children"><div class="content">What? They list several hubs that work, I guess you could buy any of these.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;codazoda&#x2F;hub-ctrl.c#hubs-known-to-work">https:&#x2F;&#x2F;github.com&#x2F;codazoda&#x2F;hub-ctrl.c#hubs-known-to-work</a></div><br/><div id="37503380" class="c"><input type="checkbox" id="c-37503380" checked=""/><div class="controls bullet"><span class="by">jws</span><span>|</span><a href="#37502028">root</a><span>|</span><a href="#37502423">parent</a><span>|</span><a href="#37504226">next</a><span>|</span><label class="collapse" for="c-37503380">[-]</label><label class="expand" for="c-37503380">[3 more]</label></div><br/><div class="children"><div class="content">In my experience, the hubs listed tend to be obsolete. For instance, that LinkSys one I just looked up and its manual is copyright 15 years ago.<p>Someone on Amazon is boldly offering to sell you one, a 4 port USB 2.0 hub, for $72, but whether they actually have it or are a robot planning to order one from another robot that doesn’t have it but thinks it can get it for $60 is anyone’s guess.<p>Last time I went through hubctl’s list, none were available new, and lots of the ones listed have “issues” where later buyers can’t make them work (probably because the manufacturer changed the design but kept the model number). But that’s been a few years.<p>I just like to tell the manufacturers that I’m a niche, but I will happily pay double for them to put the current sense shunts and power switching transistors from the IC reference design on their board.</div><br/><div id="37503556" class="c"><input type="checkbox" id="c-37503556" checked=""/><div class="controls bullet"><span class="by">codazoda</span><span>|</span><a href="#37502028">root</a><span>|</span><a href="#37503380">parent</a><span>|</span><a href="#37503495">next</a><span>|</span><label class="collapse" for="c-37503556">[-]</label><label class="expand" for="c-37503556">[1 more]</label></div><br/><div class="children"><div class="content">Also listed elsewhere, this repo has a much more up to date list. Maybe I should make an edit to the repo after all these years!<p>I also had trouble finding the original author online when I created the GitHub repo, but the other repo links him. I’m sure this didn’t exist back in the day. I did reach out to Niibe Yutaka way back and get his permission to post on GitHub.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;mvp&#x2F;uhubctl">https:&#x2F;&#x2F;github.com&#x2F;mvp&#x2F;uhubctl</a></div><br/></div></div><div id="37503495" class="c"><input type="checkbox" id="c-37503495" checked=""/><div class="controls bullet"><span class="by">bombcar</span><span>|</span><a href="#37502028">root</a><span>|</span><a href="#37503380">parent</a><span>|</span><a href="#37503556">prev</a><span>|</span><a href="#37504226">next</a><span>|</span><label class="collapse" for="c-37503495">[-]</label><label class="expand" for="c-37503495">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.yepkit.com&#x2F;products&#x2F;ykush" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.yepkit.com&#x2F;products&#x2F;ykush</a> linked elsewhere seems available.</div><br/></div></div></div></div></div></div></div></div><div id="37504226" class="c"><input type="checkbox" id="c-37504226" checked=""/><div class="controls bullet"><span class="by">jonthorpe</span><span>|</span><a href="#37502028">prev</a><span>|</span><a href="#37501961">next</a><span>|</span><label class="collapse" for="c-37504226">[-]</label><label class="expand" for="c-37504226">[2 more]</label></div><br/><div class="children"><div class="content">Has anyone come across a way to do this in Windows?</div><br/><div id="37505930" class="c"><input type="checkbox" id="c-37505930" checked=""/><div class="controls bullet"><span class="by">rpc_was_taken</span><span>|</span><a href="#37504226">parent</a><span>|</span><a href="#37501961">next</a><span>|</span><label class="collapse" for="c-37505930">[-]</label><label class="expand" for="c-37505930">[1 more]</label></div><br/><div class="children"><div class="content">Not really, we needed that on windows and ended up buying a Pegasus Astro USB Control Hub (<a href="https:&#x2F;&#x2F;pegasusastro.com&#x2F;products&#x2F;usb-control-hub&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;pegasusastro.com&#x2F;products&#x2F;usb-control-hub&#x2F;</a>).<p>We needed to reset a plugged high-speed webcam, and we needed high-speed USB3, and the ability to cut the data lines too.<p>The Windows driver (usbctl.sys?) does not support the USB power control commands, the solution that Pegasus or Yepkit use is to add a HID&#x2F;COM USB device to control the power rail.
[edit] We used Pegasus instead of yepkit due to it going to a customer setup, and the bare-board yepkit was a no-go.</div><br/></div></div></div></div><div id="37501961" class="c"><input type="checkbox" id="c-37501961" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#37504226">prev</a><span>|</span><label class="collapse" for="c-37501961">[-]</label><label class="expand" for="c-37501961">[8 more]</label></div><br/><div class="children"><div class="content">Would be nice if someone could intergrate this with the OS itself so that if some USB device stops responding, the OS &quot;unplugs and plugs&quot; it automatically until it works.<p>USB was always a shitty standard to begin with, nothing should ever require unplugging and plugging to get it to work, yet I have to do that to my webcam every day.</div><br/><div id="37502070" class="c"><input type="checkbox" id="c-37502070" checked=""/><div class="controls bullet"><span class="by">tcas</span><span>|</span><a href="#37501961">parent</a><span>|</span><a href="#37502097">next</a><span>|</span><label class="collapse" for="c-37502070">[-]</label><label class="expand" for="c-37502070">[5 more]</label></div><br/><div class="children"><div class="content">USB has a built in protocol level reset that should achieve the same thing. The only change is 5V power is not cut. It&#x27;s basically the same as doing an OS reboot from the peripheral&#x27;s perspective.<p>If the USB device still doesn&#x27;t respond then it means that they have some buggy firmware that requires a hard reboot to work.<p>Example for a USB reset in linux: <a href="https:&#x2F;&#x2F;marc.info&#x2F;?l=linux-usb&amp;m=121459435621262&amp;w=2" rel="nofollow noreferrer">https:&#x2F;&#x2F;marc.info&#x2F;?l=linux-usb&amp;m=121459435621262&amp;w=2</a></div><br/><div id="37502662" class="c"><input type="checkbox" id="c-37502662" checked=""/><div class="controls bullet"><span class="by">TheRealPomax</span><span>|</span><a href="#37501961">root</a><span>|</span><a href="#37502070">parent</a><span>|</span><a href="#37503020">next</a><span>|</span><label class="collapse" for="c-37502662">[-]</label><label class="expand" for="c-37502662">[1 more]</label></div><br/><div class="children"><div class="content">You need to cut the power for certain USB devices to actually reset their in-device memory though (like an iLok dongle). Just &quot;disconnecting and reconnecting&quot; via software without a power cycle won&#x27;t do anything for those. And that&#x27;s not a bug, in dongles that&#x27;s literally an anti-piracy feature.</div><br/></div></div><div id="37503020" class="c"><input type="checkbox" id="c-37503020" checked=""/><div class="controls bullet"><span class="by">gorkish</span><span>|</span><a href="#37501961">root</a><span>|</span><a href="#37502070">parent</a><span>|</span><a href="#37502662">prev</a><span>|</span><a href="#37502375">next</a><span>|</span><label class="collapse" for="c-37503020">[-]</label><label class="expand" for="c-37503020">[1 more]</label></div><br/><div class="children"><div class="content">Some devices (mostly security devices) trigger things based on the physical connection state, cycle count, etc. and it&#x27;s useful to have a means to test these.<p>I&#x27;ve never seen a device so far that has a physical switch to make sure it&#x27;s really been unplugged, but I&#x27;d imagine someone could find a use case.</div><br/></div></div><div id="37502375" class="c"><input type="checkbox" id="c-37502375" checked=""/><div class="controls bullet"><span class="by">dheera</span><span>|</span><a href="#37501961">root</a><span>|</span><a href="#37502070">parent</a><span>|</span><a href="#37503020">prev</a><span>|</span><a href="#37503575">next</a><span>|</span><label class="collapse" for="c-37502375">[-]</label><label class="expand" for="c-37502375">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve tried that, my RealSense camera and several other USB devices I&#x27;ve used require physically unplugging and plugging after every reboot or it refuses to work.<p>That Linux USB reset does not work.</div><br/></div></div><div id="37503575" class="c"><input type="checkbox" id="c-37503575" checked=""/><div class="controls bullet"><span class="by">XorNot</span><span>|</span><a href="#37501961">root</a><span>|</span><a href="#37502070">parent</a><span>|</span><a href="#37502375">prev</a><span>|</span><a href="#37502097">next</a><span>|</span><label class="collapse" for="c-37503575">[-]</label><label class="expand" for="c-37503575">[1 more]</label></div><br/><div class="children"><div class="content">That doesn&#x27;t solve the problem that I still need to do it though. I&#x27;ve got this problem right now with my Blue microphone: it hates being rebooted without being power-cycled for some reason.</div><br/></div></div></div></div><div id="37503772" class="c"><input type="checkbox" id="c-37503772" checked=""/><div class="controls bullet"><span class="by">Nursie</span><span>|</span><a href="#37501961">parent</a><span>|</span><a href="#37502097">prev</a><span>|</span><label class="collapse" for="c-37503772">[-]</label><label class="expand" for="c-37503772">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, this would be really useful for my RP2040Zero project.<p>I don&#x27;t know if it&#x27;s the board or if it&#x27;s down to circuitpython, but being able to software powercycle the USB ports on my motherboard would be really useful, particularly as the RP2040 is mounted inside the PC.</div><br/></div></div></div></div></div></div></div></div></div></body></html>