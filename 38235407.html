<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1699779654698" as="style"/><link rel="stylesheet" href="styles.css?v=1699779654698"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/namin/llm-verified-with-monte-carlo-tree-search">Show HN: LLM Verified with Monte Carlo Tree Search</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>namin</span> | <span>10 comments</span></div><br/><div><div id="38237883" class="c"><input type="checkbox" id="c-38237883" checked=""/><div class="controls bullet"><span class="by">ianbutler</span><span>|</span><a href="#38238019">next</a><span>|</span><label class="collapse" for="c-38237883">[-]</label><label class="expand" for="c-38237883">[5 more]</label></div><br/><div class="children"><div class="content">Nice! I had a similar idea to use MCTS to explore various AST generations through an incremental AST parser[0], so I could generate runnable code via LLM at a higher success rate than what we were seeing initially with them. I never got around to it, but this makes me curious to circle back around.<p>[0] There are few parsers that consider &quot;failed, but could run if the next symbol is valid&quot; and &quot;failed and no way to continue&quot; as separate statuses so you can make progress by enumerating (hopefully intelligently so) the space of valid states. Surprisingly TreeSitter wasn&#x27;t one of them though, for that it&#x27;s just &quot;fail&quot;.</div><br/><div id="38238151" class="c"><input type="checkbox" id="c-38238151" checked=""/><div class="controls bullet"><span class="by">morgante</span><span>|</span><a href="#38237883">parent</a><span>|</span><a href="#38238118">next</a><span>|</span><label class="collapse" for="c-38238151">[-]</label><label class="expand" for="c-38238151">[2 more]</label></div><br/><div class="children"><div class="content">&gt; [0] There are few parsers that consider &quot;failed, but could run if the next symbol is valid&quot; and &quot;failed and no way to continue&quot; as separate statuses so you can make progress by enumerating (hopefully intelligently so) the space of valid states. Surprisingly TreeSitter wasn&#x27;t one of them though, for that it&#x27;s just &quot;fail&quot;.<p>I&#x27;m not quite sure I follow how this differs from Tree Sitter&#x27;s error recovery. Do you have an example of a parser that implements this?</div><br/><div id="38238336" class="c"><input type="checkbox" id="c-38238336" checked=""/><div class="controls bullet"><span class="by">ianbutler</span><span>|</span><a href="#38237883">root</a><span>|</span><a href="#38238151">parent</a><span>|</span><a href="#38238118">next</a><span>|</span><label class="collapse" for="c-38238336">[-]</label><label class="expand" for="c-38238336">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;parso&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;parso&#x2F;</a> is what I settled on when digging into this.<p>It&#x27;s been something like 8 months, but iirc tree-sitter would not emit anything I was able to discern as recoverable. I recognize they do implement a pretty robust error recovery, but the returned error wasn&#x27;t clearly differentiable from a strict failure in a way I could program against where as for the same partially incomplete code parso would return something different than if it was unrecoverable.<p>I can&#x27;t remember much more than that and it&#x27;s entirely possible I was missing some type of configuration to make tree-sitter do the same. Unfortunately it looks like I never pushed my playground code for this idea off of my server which is currently packed up as part of a cross country move I&#x27;m on the tail end of otherwise I&#x27;d get you the code verbatim.</div><br/></div></div></div></div><div id="38238118" class="c"><input type="checkbox" id="c-38238118" checked=""/><div class="controls bullet"><span class="by">namin</span><span>|</span><a href="#38237883">parent</a><span>|</span><a href="#38238151">prev</a><span>|</span><a href="#38238019">next</a><span>|</span><label class="collapse" for="c-38238118">[-]</label><label class="expand" for="c-38238118">[2 more]</label></div><br/><div class="children"><div class="content">Interesting! Is the end goal similar to the outlines library:
<a href="https:&#x2F;&#x2F;github.com&#x2F;outlines-dev&#x2F;outlines">https:&#x2F;&#x2F;github.com&#x2F;outlines-dev&#x2F;outlines</a>
?</div><br/><div id="38238349" class="c"><input type="checkbox" id="c-38238349" checked=""/><div class="controls bullet"><span class="by">ianbutler</span><span>|</span><a href="#38237883">root</a><span>|</span><a href="#38238118">parent</a><span>|</span><a href="#38238019">next</a><span>|</span><label class="collapse" for="c-38238349">[-]</label><label class="expand" for="c-38238349">[1 more]</label></div><br/><div class="children"><div class="content">Yes basically to create some level control for guided program generation.</div><br/></div></div></div></div></div></div><div id="38238019" class="c"><input type="checkbox" id="c-38238019" checked=""/><div class="controls bullet"><span class="by">wokwokwok</span><span>|</span><a href="#38237883">prev</a><span>|</span><a href="#38237713">next</a><span>|</span><label class="collapse" for="c-38238019">[-]</label><label class="expand" for="c-38238019">[2 more]</label></div><br/><div class="children"><div class="content">Anyone who&#x27;s game able to explain what this actually does?<p>The main loop looks simple:<p><pre><code>    def generate_complete(text, montecarlo):
        text = llm.generate(text, 1)[0]
       score = score_func(text)
        if score is not None:
            if score &lt; 0:
                return None
            else:
                if can_be_solution(text, min_lines, check_fun):
                    montecarlo.solution = text
                return text
        else:
            return generate_complete(text, montecarlo)
</code></pre>
...but, the heart of it (1) just basically checks if the dafny syntax is valid by posting to <a href="https:&#x2F;&#x2F;dafny.livecode.ch&#x2F;check" rel="nofollow noreferrer">https:&#x2F;&#x2F;dafny.livecode.ch&#x2F;check</a><p>How is &#x27;syntax is valid&#x27; a valid scoring mechanism here?<p>If you look at the output examples (2), all I can see if generating functions and lemmas; this is equivalent to generating a function a bunch of tests for it.<p>I&#x27;m not sure I see what value the MCTS is bringing here.<p>Anyone get this and care to explain?<p>[1] - <a href="https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-search&#x2F;blob&#x2F;main&#x2F;dafny.py">https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-...</a><p>[2] - <a href="https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-search&#x2F;blob&#x2F;main&#x2F;log&#x2F;fact.txt">https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-...</a></div><br/><div id="38238101" class="c"><input type="checkbox" id="c-38238101" checked=""/><div class="controls bullet"><span class="by">namin</span><span>|</span><a href="#38238019">parent</a><span>|</span><a href="#38237713">next</a><span>|</span><label class="collapse" for="c-38238101">[-]</label><label class="expand" for="c-38238101">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for taking a look!<p>This is not the main loop. This just generates one completion that succeeds (or gives up) deferring to the Dafny checker to decide.<p>The main loop is the simulate function of the MCTS library.
<a href="https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-search&#x2F;blob&#x2F;main&#x2F;montecarlo&#x2F;montecarlo.py#L38">https:&#x2F;&#x2F;github.com&#x2F;namin&#x2F;llm-verified-with-monte-carlo-tree-...</a><p>The main advantage of MCTS is that it takes care of the exploitation&#x2F;exploration trade off based on the scores propagated by the child finder.<p>I hope this helps. Let me know if this addresses your question.</div><br/></div></div></div></div><div id="38237713" class="c"><input type="checkbox" id="c-38237713" checked=""/><div class="controls bullet"><span class="by">will_byrd</span><span>|</span><a href="#38238019">prev</a><span>|</span><label class="collapse" for="c-38237713">[-]</label><label class="expand" for="c-38237713">[2 more]</label></div><br/><div class="children"><div class="content">I love that the code is so short and understandable.  Could be turned into a Pearl.</div><br/><div id="38238112" class="c"><input type="checkbox" id="c-38238112" checked=""/><div class="controls bullet"><span class="by">namin</span><span>|</span><a href="#38237713">parent</a><span>|</span><label class="collapse" for="c-38238112">[-]</label><label class="expand" for="c-38238112">[1 more]</label></div><br/><div class="children"><div class="content">Thanks. I adapted this old MCTS library:
<a href="https:&#x2F;&#x2F;github.com&#x2F;ImparaAI&#x2F;monte-carlo-tree-search">https:&#x2F;&#x2F;github.com&#x2F;ImparaAI&#x2F;monte-carlo-tree-search</a>
which is also very short and understandable.</div><br/></div></div></div></div></div></div></div></div></div></body></html>