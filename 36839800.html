<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1690189249069" as="style"/><link rel="stylesheet" href="styles.css?v=1690189249069"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://catonmat.net/ldd-arbitrary-code-execution">ldd arbitrary code execution (2009)</a> <span class="domain">(<a href="https://catonmat.net">catonmat.net</a>)</span></div><div class="subtext"><span>xk3</span> | <span>68 comments</span></div><br/><div><div id="36840717" class="c"><input type="checkbox" id="c-36840717" checked=""/><div class="controls bullet"><span class="by">dwheeler</span><span>|</span><a href="#36840376">next</a><span>|</span><label class="collapse" for="c-36840717">[-]</label><label class="expand" for="c-36840717">[1 more]</label></div><br/><div class="children"><div class="content">This not new info, but it&#x27;s good to tell others.<p>My &quot;Program Librarues HOWTO&quot; says this:<p>&quot;Beware: do not run ldd on a program you don&#x27;t trust. As is clearly stated in the ldd(1) manual, ldd works by (in certain cases) by setting a special environment variable (for ELF objects, LD_TRACE_LOADED_OBJECTS) and then executing the program. It may be possible for an untrusted program to force the ldd user to run arbitrary code (instead of simply showing the ldd information). So, for safety&#x27;s sake, don&#x27;t use ldd on programs you don&#x27;t trust to execute.&quot;<p><a href="https:&#x2F;&#x2F;dwheeler.com&#x2F;program-library&#x2F;Program-Library-HOWTO&#x2F;x36.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;dwheeler.com&#x2F;program-library&#x2F;Program-Library-HOWTO&#x2F;x...</a><p>I believe that doc dates from 2000. This info wasn&#x27;t new then either, it was specifically documented in its man page.</div><br/></div></div><div id="36840376" class="c"><input type="checkbox" id="c-36840376" checked=""/><div class="controls bullet"><span class="by">1vuio0pswjnm7</span><span>|</span><a href="#36840717">prev</a><span>|</span><a href="#36840938">next</a><span>|</span><label class="collapse" for="c-36840376">[-]</label><label class="expand" for="c-36840376">[8 more]</label></div><br/><div class="children"><div class="content">None of the previous discussions on HN mentioned using readelf instead of ldd.<p>Whenever I want to quickly check for dynamically linked libraries in a program, I use<p><pre><code>   readelf -d program
</code></pre>
The use case I have is that I want to know what are the dependencies the program needs from the host system.<p>If I wanted to know what are the dependencies of a particular shared library I can use<p><pre><code>   readelf -d library</code></pre></div><br/><div id="36841706" class="c"><input type="checkbox" id="c-36841706" checked=""/><div class="controls bullet"><span class="by">1vuio0pswjnm7</span><span>|</span><a href="#36840376">parent</a><span>|</span><a href="#36840467">next</a><span>|</span><label class="collapse" for="c-36841706">[-]</label><label class="expand" for="c-36841706">[2 more]</label></div><br/><div class="children"><div class="content">Note lddtree from pax-utils requires python and the elftools module, even though one can use readelf and objdump instead of python.
 <a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;ncopa&#x2F;lddtree&#x2F;main&#x2F;lddtree.sh" rel="nofollow noreferrer">https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;ncopa&#x2F;lddtree&#x2F;main&#x2F;lddtree...</a><p>If I wanted a recursive listing I would use libtree, a 56k .c file.<p><a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;haampie&#x2F;libtree&#x2F;master&#x2F;libtree.c" rel="nofollow noreferrer">https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;haampie&#x2F;libtree&#x2F;master&#x2F;lib...</a></div><br/><div id="36844137" class="c"><input type="checkbox" id="c-36844137" checked=""/><div class="controls bullet"><span class="by">stabbles</span><span>|</span><a href="#36840376">root</a><span>|</span><a href="#36841706">parent</a><span>|</span><a href="#36840467">next</a><span>|</span><label class="collapse" for="c-36844137">[-]</label><label class="expand" for="c-36844137">[1 more]</label></div><br/><div class="children"><div class="content">(author of libtree): I believe that downloading, compiling and running libtree is faster than the startup overhead of pax-utils lddtree ;) maybe C is the better scripting language?<p><pre><code>    $ alias latest_libtree=&#x27;curl -Lfs https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;haampie&#x2F;libtree&#x2F;master&#x2F;libtree.c | cc -o &#x2F;tmp&#x2F;libtree -x c - -std=c99 -D_FILE_OFFSET_BITS=64; &#x2F;tmp&#x2F;libtree&#x27;

    $ time latest_libtree &#x2F;usr&#x2F;bin&#x2F;vim

    real 0m0.179s
    user 0m0.119s
    sys 0m0.019s
    &#x2F;usr&#x2F;bin&#x2F;vim 
    ├── libpython3.11.so.1.0 [ld.so.conf]
    │   ├── libexpat.so.1 [ld.so.conf]
    │   └── libz.so.1 [ld.so.conf]
    ├── libgpm.so.2 [ld.so.conf]
    ├── libacl.so.1 [ld.so.conf]
    ├── libsodium.so.23 [ld.so.conf]
    ├── libselinux.so.1 [ld.so.conf]
    │   └── libpcre2-8.so.0 [ld.so.conf]
    └── libtinfo.so.6 [ld.so.conf]</code></pre></div><br/></div></div></div></div><div id="36840467" class="c"><input type="checkbox" id="c-36840467" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#36840376">parent</a><span>|</span><a href="#36841706">prev</a><span>|</span><a href="#36840938">next</a><span>|</span><label class="collapse" for="c-36840467">[-]</label><label class="expand" for="c-36840467">[5 more]</label></div><br/><div class="children"><div class="content">That&#x27;s great, but unlike ldd, readelf won&#x27;t walk the list of dependencies recursively.</div><br/><div id="36842511" class="c"><input type="checkbox" id="c-36842511" checked=""/><div class="controls bullet"><span class="by">mycall</span><span>|</span><a href="#36840376">root</a><span>|</span><a href="#36840467">parent</a><span>|</span><a href="#36841032">next</a><span>|</span><label class="collapse" for="c-36842511">[-]</label><label class="expand" for="c-36842511">[3 more]</label></div><br/><div class="children"><div class="content">never fear, recursive and concat unix piping to the rescue</div><br/><div id="36843922" class="c"><input type="checkbox" id="c-36843922" checked=""/><div class="controls bullet"><span class="by">stingraycharles</span><span>|</span><a href="#36840376">root</a><span>|</span><a href="#36842511">parent</a><span>|</span><a href="#36841032">next</a><span>|</span><label class="collapse" for="c-36843922">[-]</label><label class="expand" for="c-36843922">[2 more]</label></div><br/><div class="children"><div class="content">At that point, why not just use ldd?</div><br/><div id="36844325" class="c"><input type="checkbox" id="c-36844325" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#36840376">root</a><span>|</span><a href="#36843922">parent</a><span>|</span><a href="#36841032">next</a><span>|</span><label class="collapse" for="c-36844325">[-]</label><label class="expand" for="c-36844325">[1 more]</label></div><br/><div class="children"><div class="content">Because it executes the binary</div><br/></div></div></div></div></div></div></div></div></div></div><div id="36840938" class="c"><input type="checkbox" id="c-36840938" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#36840376">prev</a><span>|</span><a href="#36840384">next</a><span>|</span><label class="collapse" for="c-36840938">[-]</label><label class="expand" for="c-36840938">[13 more]</label></div><br/><div class="children"><div class="content"><i>One particular case when a program won&#x27;t be handled by ld-linux.so is when it has a different loader than the system&#x27;s default specified in it&#x27;s .interp ELF section. That&#x27;s the whole idea in executing arbitrary code with ldd -- load the executable via a different loader that does not handle LD_TRACE_LOADED_OBJECTS environment variable but instead executes the program.</i><p>The way dynamic linking is done on UNIX-like systems has always seemed odd and a bit of an afterthought to me, and that explains why --- the actual loader in the OS kernel itself knows nearly nothing about dynamic linking. Instead it &quot;redirects&quot; execution to a loader (which is itself not that different from any other static binary) to do that.</div><br/><div id="36842750" class="c"><input type="checkbox" id="c-36842750" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#36840938">parent</a><span>|</span><a href="#36841633">next</a><span>|</span><label class="collapse" for="c-36842750">[-]</label><label class="expand" for="c-36842750">[3 more]</label></div><br/><div class="children"><div class="content">&gt; The way dynamic linking is done on UNIX-like systems has always seemed odd and a bit of an afterthought to me, and that explains why --- the actual loader in the OS kernel itself knows nearly nothing about dynamic linking. Instead it &quot;redirects&quot; execution to a loader (which is itself not that different from any other static binary) to do that.<p>This makes it much easier to evolve the system because kernel-land programming is harder than user-land programming.  The trade-off is that the user-land run-time loader has its own bootstrapping complexity to deal with.</div><br/><div id="36843008" class="c"><input type="checkbox" id="c-36843008" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842750">parent</a><span>|</span><a href="#36841633">next</a><span>|</span><label class="collapse" for="c-36843008">[-]</label><label class="expand" for="c-36843008">[2 more]</label></div><br/><div class="children"><div class="content">On Windows, the loader for usermode runs in usermode too; but every executable, by design, doesn&#x27;t get to choose what to use for its loader.</div><br/><div id="36843170" class="c"><input type="checkbox" id="c-36843170" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36843008">parent</a><span>|</span><a href="#36841633">next</a><span>|</span><label class="collapse" for="c-36843170">[-]</label><label class="expand" for="c-36843170">[1 more]</label></div><br/><div class="children"><div class="content">&gt; but every executable, by design, doesn&#x27;t get to choose what to use for its loader.<p>Sure it does: it can load whatever it wants however it wants once main() gets to run.</div><br/></div></div></div></div></div></div><div id="36841633" class="c"><input type="checkbox" id="c-36841633" checked=""/><div class="controls bullet"><span class="by">throwawaylinux</span><span>|</span><a href="#36840938">parent</a><span>|</span><a href="#36842750">prev</a><span>|</span><a href="#36840384">next</a><span>|</span><label class="collapse" for="c-36841633">[-]</label><label class="expand" for="c-36841633">[9 more]</label></div><br/><div class="children"><div class="content">Well dynamic linking and most things in unix is an afterthought by definition because the first unix system did not have them.<p>That doesn&#x27;t seem to be what you mean though in context, but I&#x27;m not sure what you do mean. You don&#x27;t like it or don&#x27;t think it was designed well because dynamic linking is done in userspace?</div><br/><div id="36842106" class="c"><input type="checkbox" id="c-36842106" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36841633">parent</a><span>|</span><a href="#36842754">next</a><span>|</span><label class="collapse" for="c-36842106">[-]</label><label class="expand" for="c-36842106">[5 more]</label></div><br/><div class="children"><div class="content">The fact that an executable needs to explicitly specify the &quot;interpreter&quot;, instead of that being something under control of the OS loader, doesn&#x27;t seem like a good way of doing it; and then the implementation of ldd discussed here just takes it in an even weirder direction.</div><br/><div id="36842558" class="c"><input type="checkbox" id="c-36842558" checked=""/><div class="controls bullet"><span class="by">dap</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842106">parent</a><span>|</span><a href="#36842797">next</a><span>|</span><label class="collapse" for="c-36842558">[-]</label><label class="expand" for="c-36842558">[3 more]</label></div><br/><div class="children"><div class="content">What distinction are you making? Do you think it should be part of the kernel? I ask because ld.so (the runtime linker&#x2F;loader) <i>is</i> part of the OS on many systems.</div><br/><div id="36842986" class="c"><input type="checkbox" id="c-36842986" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842558">parent</a><span>|</span><a href="#36842797">next</a><span>|</span><label class="collapse" for="c-36842986">[-]</label><label class="expand" for="c-36842986">[2 more]</label></div><br/><div class="children"><div class="content">I mean not explicitly <i>hardcoding the path to the interpreter</i> inside every binary. If the dynamic linker is part of the OS, then surely the OS should already know where it is?</div><br/><div id="36843754" class="c"><input type="checkbox" id="c-36843754" checked=""/><div class="controls bullet"><span class="by">throwawaylinux</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842986">parent</a><span>|</span><a href="#36842797">next</a><span>|</span><label class="collapse" for="c-36843754">[-]</label><label class="expand" for="c-36843754">[1 more]</label></div><br/><div class="children"><div class="content">How much do you actually know about this? Have you read the ELF spec or written anything with libelf, hacked on a loader, a linker? Considered the actual problems with having this hard coded vs alternatives?<p>I ask because ELF and unix dynamic linking is a pretty well thought out set of specifications and processes and it&#x27;s a huge body of work. It can certainly be criticized, but calling it an afterthought because of .interp doesn&#x27;t seem very charitable, just trying to understand if that&#x27;s an informed opinion and if so it would be interesting to hear more.</div><br/></div></div></div></div></div></div><div id="36842797" class="c"><input type="checkbox" id="c-36842797" checked=""/><div class="controls bullet"><span class="by">throwawaylinux</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842106">parent</a><span>|</span><a href="#36842558">prev</a><span>|</span><a href="#36842754">next</a><span>|</span><label class="collapse" for="c-36842797">[-]</label><label class="expand" for="c-36842797">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The fact that an executable needs to explicitly specify the &quot;interpreter&quot;, instead of that being something under control of the OS loader, doesn&#x27;t seem like a good way of doing it;<p>The OS loader does control the permissions of what can be read and executed. And the user can execute a file. Why would it be better if you had to execute the loader explicitly to run a program? The same security problem would apply if you convinced somebody else to execute your malicious code. Seems like pretty harmless syntactic convenience.<p>The issue of ldd executing the program I guess is a thing that could be tightened to avoid foot shooting. Lots of unix programs traditionally were happy to give you lots of rope though.</div><br/></div></div></div></div><div id="36842754" class="c"><input type="checkbox" id="c-36842754" checked=""/><div class="controls bullet"><span class="by">cryptonector</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36841633">parent</a><span>|</span><a href="#36842106">prev</a><span>|</span><a href="#36840384">next</a><span>|</span><label class="collapse" for="c-36842754">[-]</label><label class="expand" for="c-36842754">[3 more]</label></div><br/><div class="children"><div class="content">It fits perfectly in the Unix philosophy.</div><br/><div id="36843740" class="c"><input type="checkbox" id="c-36843740" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842754">parent</a><span>|</span><a href="#36844184">next</a><span>|</span><label class="collapse" for="c-36843740">[-]</label><label class="expand" for="c-36843740">[1 more]</label></div><br/><div class="children"><div class="content">Sucky working code is better than code that doesn&#x27;t exist, yes.<p>But isn&#x27;t it silly that every Linux system needs to place this exact file at this exact path or else no program for another system will possibly be able to run on it?</div><br/></div></div><div id="36844184" class="c"><input type="checkbox" id="c-36844184" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36840938">root</a><span>|</span><a href="#36842754">parent</a><span>|</span><a href="#36843740">prev</a><span>|</span><a href="#36840384">next</a><span>|</span><label class="collapse" for="c-36844184">[-]</label><label class="expand" for="c-36844184">[1 more]</label></div><br/><div class="children"><div class="content">Translation, worse is better philosophy.</div><br/></div></div></div></div></div></div></div></div><div id="36840384" class="c"><input type="checkbox" id="c-36840384" checked=""/><div class="controls bullet"><span class="by">evgpbfhnr</span><span>|</span><a href="#36840938">prev</a><span>|</span><a href="#36842902">next</a><span>|</span><label class="collapse" for="c-36840384">[-]</label><label class="expand" for="c-36840384">[2 more]</label></div><br/><div class="children"><div class="content">(the various implementations of) lddtree also don&#x27;t have this &quot;feature&quot; as they all use readelf or similar
(EDIT: and unlike readelf -d, will recurse through dependencies like ldd does)<p>I considered that rather well known though...</div><br/><div id="36840748" class="c"><input type="checkbox" id="c-36840748" checked=""/><div class="controls bullet"><span class="by">djbusby</span><span>|</span><a href="#36840384">parent</a><span>|</span><a href="#36842902">next</a><span>|</span><label class="collapse" for="c-36840748">[-]</label><label class="expand" for="c-36840748">[1 more]</label></div><br/><div class="children"><div class="content">I just learned today! Thanks.</div><br/></div></div></div></div><div id="36842902" class="c"><input type="checkbox" id="c-36842902" checked=""/><div class="controls bullet"><span class="by">jameshart</span><span>|</span><a href="#36840384">prev</a><span>|</span><a href="#36839951">next</a><span>|</span><label class="collapse" for="c-36842902">[-]</label><label class="expand" for="c-36842902">[5 more]</label></div><br/><div class="children"><div class="content">Am I the only one who read this and thought &#x27;wow, if I can get LD_TRACE_LOADED_OBJECTS to be set I can block anything from being executed&#x27;?<p>That seems like a scary powerful environment variable.</div><br/><div id="36843744" class="c"><input type="checkbox" id="c-36843744" checked=""/><div class="controls bullet"><span class="by">immibis</span><span>|</span><a href="#36842902">parent</a><span>|</span><a href="#36843082">next</a><span>|</span><label class="collapse" for="c-36843744">[-]</label><label class="expand" for="c-36843744">[1 more]</label></div><br/><div class="children"><div class="content">You can also set LD_PRELOAD to the path of a shared library whose constructor segfaults, or set LD_LIBRARY_PATH to the path of a directory containing a libc that doesn&#x27;t work.</div><br/></div></div><div id="36843082" class="c"><input type="checkbox" id="c-36843082" checked=""/><div class="controls bullet"><span class="by">sp1rit</span><span>|</span><a href="#36842902">parent</a><span>|</span><a href="#36843744">prev</a><span>|</span><a href="#36839951">next</a><span>|</span><label class="collapse" for="c-36843082">[-]</label><label class="expand" for="c-36843082">[3 more]</label></div><br/><div class="children"><div class="content">Not really. Realistically you can set PATH to an empty string, and block execution everything that isn&#x27;t invoked using a hardcoded path.</div><br/><div id="36843169" class="c"><input type="checkbox" id="c-36843169" checked=""/><div class="controls bullet"><span class="by">jameshart</span><span>|</span><a href="#36842902">root</a><span>|</span><a href="#36843082">parent</a><span>|</span><a href="#36839951">next</a><span>|</span><label class="collapse" for="c-36843169">[-]</label><label class="expand" for="c-36843169">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, I thought about that, but this would kill even directly invoked executables, right?</div><br/><div id="36844223" class="c"><input type="checkbox" id="c-36844223" checked=""/><div class="controls bullet"><span class="by">sp1rit</span><span>|</span><a href="#36842902">root</a><span>|</span><a href="#36843169">parent</a><span>|</span><a href="#36839951">next</a><span>|</span><label class="collapse" for="c-36844223">[-]</label><label class="expand" for="c-36844223">[1 more]</label></div><br/><div class="children"><div class="content">Yes, this is certainly more &quot;far-reaching&quot; than other env vars. But If you have the ability to wreak havoc even if ld-linux wouldn&#x27;t check for this (obv. PATH being the prime example, but unsetting HOME will almost certainly break some software written by novices (not falling back to the home specified in &#x2F;etc&#x2F;passwd)).<p>And I also could imagine that tools that allow setting arbitrary env vars might filter common troublemakers like PATH, but almost certainly not niche env vars that change the bahviour of ld-linux.</div><br/></div></div></div></div></div></div></div></div><div id="36839951" class="c"><input type="checkbox" id="c-36839951" checked=""/><div class="controls bullet"><span class="by">KolmogorovComp</span><span>|</span><a href="#36842902">prev</a><span>|</span><a href="#36840697">next</a><span>|</span><label class="collapse" for="c-36839951">[-]</label><label class="expand" for="c-36839951">[6 more]</label></div><br/><div class="children"><div class="content">Article is dated 2009.<p>Previous discussions:<p>- [2009] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=902958">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=902958</a><p>- [2015] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=9629667">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=9629667</a><p>- [2022] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30033807">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30033807</a><p>Also formatting inside code-block is broken</div><br/><div id="36840284" class="c"><input type="checkbox" id="c-36840284" checked=""/><div class="controls bullet"><span class="by">a1o</span><span>|</span><a href="#36839951">parent</a><span>|</span><a href="#36840697">next</a><span>|</span><label class="collapse" for="c-36840284">[-]</label><label class="expand" for="c-36840284">[5 more]</label></div><br/><div class="children"><div class="content">Is the mentioned issue in the article still true today?</div><br/><div id="36841029" class="c"><input type="checkbox" id="c-36841029" checked=""/><div class="controls bullet"><span class="by">eqvinox</span><span>|</span><a href="#36839951">root</a><span>|</span><a href="#36840284">parent</a><span>|</span><a href="#36841645">next</a><span>|</span><label class="collapse" for="c-36841029">[-]</label><label class="expand" for="c-36841029">[3 more]</label></div><br/><div class="children"><div class="content">Yes.  So is the (IMHO) best workaround of using lddtree (pax-utils) instead.  Available on pretty much all distros, though probably not installed by default.</div><br/><div id="36841959" class="c"><input type="checkbox" id="c-36841959" checked=""/><div class="controls bullet"><span class="by">anthk</span><span>|</span><a href="#36839951">root</a><span>|</span><a href="#36841029">parent</a><span>|</span><a href="#36841645">next</a><span>|</span><label class="collapse" for="c-36841959">[-]</label><label class="expand" for="c-36841959">[2 more]</label></div><br/><div class="children"><div class="content">objdump -x &#x2F;path&#x2F;to&#x2F;bin | grep NEEDED</div><br/><div id="36842297" class="c"><input type="checkbox" id="c-36842297" checked=""/><div class="controls bullet"><span class="by">eqvinox</span><span>|</span><a href="#36839951">root</a><span>|</span><a href="#36841959">parent</a><span>|</span><a href="#36841645">next</a><span>|</span><label class="collapse" for="c-36842297">[-]</label><label class="expand" for="c-36842297">[1 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t tell you if&#x2F;where the library is found on your system.</div><br/></div></div></div></div></div></div><div id="36841645" class="c"><input type="checkbox" id="c-36841645" checked=""/><div class="controls bullet"><span class="by">mid-kid</span><span>|</span><a href="#36839951">root</a><span>|</span><a href="#36840284">parent</a><span>|</span><a href="#36841029">prev</a><span>|</span><a href="#36840697">next</a><span>|</span><label class="collapse" for="c-36841645">[-]</label><label class="expand" for="c-36841645">[1 more]</label></div><br/><div class="children"><div class="content">Not in glibc at least[1], and I reckon many other implementations don&#x27;t have this problem either.<p>[1]: <a href="https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;manpages&#x2F;ldd.1.en.html#Security" rel="nofollow noreferrer">https:&#x2F;&#x2F;manpages.debian.org&#x2F;bookworm&#x2F;manpages&#x2F;ldd.1.en.html#...</a></div><br/></div></div></div></div></div></div><div id="36840697" class="c"><input type="checkbox" id="c-36840697" checked=""/><div class="controls bullet"><span class="by">throwawaaarrgh</span><span>|</span><a href="#36839951">prev</a><span>|</span><a href="#36841047">next</a><span>|</span><label class="collapse" for="c-36840697">[-]</label><label class="expand" for="c-36840697">[8 more]</label></div><br/><div class="children"><div class="content">I get that it&#x27;s important that we call out exploitable situations like this, but it&#x27;s also kind of moot. There are so many ways to exploit modern systems you can just rustle around in a bag of exploits and one will work. Known executable, unknown, doesn&#x27;t matter. Not even using a VM will keep you safe. Not even RBAC.<p>What&#x27;s easier and more reliable is to work in terms of risks. It&#x27;s fine if you get exploited, as long as the access you have to sensitive systems is limited, and those sensitive systems have backups, and you can&#x27;t delete those backups, you can re-deploy systems from scratch using automation if you get compromised, automatically rotate credentials, etc.<p>Lower the overall risk by setting everything up so the worst case scenario isn&#x27;t that bad. Then you don&#x27;t have to worry so much about an &quot;unknown executable&quot; because even if it gets exploited the attacker can&#x27;t cause too much damage.</div><br/><div id="36841861" class="c"><input type="checkbox" id="c-36841861" checked=""/><div class="controls bullet"><span class="by">cjbprime</span><span>|</span><a href="#36840697">parent</a><span>|</span><a href="#36842679">next</a><span>|</span><label class="collapse" for="c-36841861">[-]</label><label class="expand" for="c-36841861">[1 more]</label></div><br/><div class="children"><div class="content">This (&quot;so many ways to exploit modern systems&quot;) is not actually true.<p>Yes, plenty of memory-unsafety vulnerabilities exist, but modern mitigations like stack cookies, ASLR, (and sometimes) sandboxing and PAC make it unlikely that e.g. a buffer overflow is exploitable without other factors such as an information leak from your machine back to the attacker.  (This might be the case on publicly-accessible servers, but probably not on your laptop.)<p>The vulnerability being discussed here is unusually dangerous because it&#x27;s more like command injection, and mitigations aren&#x27;t going to help.</div><br/></div></div><div id="36841500" class="c"><input type="checkbox" id="c-36841500" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#36840697">parent</a><span>|</span><a href="#36842679">prev</a><span>|</span><a href="#36840741">next</a><span>|</span><label class="collapse" for="c-36841500">[-]</label><label class="expand" for="c-36841500">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Not even using a VM will keep you safe.<p>Do you browse the Internet? Ever visited an unknown website? Whatever the browser uses to run JS and wasm code on the web ought to be enough.</div><br/><div id="36841713" class="c"><input type="checkbox" id="c-36841713" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#36840697">root</a><span>|</span><a href="#36841500">parent</a><span>|</span><a href="#36840741">next</a><span>|</span><label class="collapse" for="c-36841713">[-]</label><label class="expand" for="c-36841713">[3 more]</label></div><br/><div class="children"><div class="content">Browsers do in fact get exploited; I would have called that an example of it <i>not</i> being a solved problem.</div><br/><div id="36841779" class="c"><input type="checkbox" id="c-36841779" checked=""/><div class="controls bullet"><span class="by">nextaccountic</span><span>|</span><a href="#36840697">root</a><span>|</span><a href="#36841713">parent</a><span>|</span><a href="#36840741">next</a><span>|</span><label class="collapse" for="c-36841779">[-]</label><label class="expand" for="c-36841779">[2 more]</label></div><br/><div class="children"><div class="content">They get exploited (and then the exploit is patched), but we&#x27;re still using a browser to talk about this, right?</div><br/><div id="36842481" class="c"><input type="checkbox" id="c-36842481" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#36840697">root</a><span>|</span><a href="#36841779">parent</a><span>|</span><a href="#36840741">next</a><span>|</span><label class="collapse" for="c-36842481">[-]</label><label class="expand" for="c-36842481">[1 more]</label></div><br/><div class="children"><div class="content">People <i>used</i> IE6; I wouldn&#x27;t call that an endorsement of it as a secure system, only useful enough to justify the risk.</div><br/></div></div></div></div></div></div></div></div><div id="36840741" class="c"><input type="checkbox" id="c-36840741" checked=""/><div class="controls bullet"><span class="by">causality0</span><span>|</span><a href="#36840697">parent</a><span>|</span><a href="#36841500">prev</a><span>|</span><a href="#36841047">next</a><span>|</span><label class="collapse" for="c-36840741">[-]</label><label class="expand" for="c-36840741">[1 more]</label></div><br/><div class="children"><div class="content">The number one method of security, at least for power users, is user behavior. Look at URLs you might visit critically. Don&#x27;t run random-ass code. Keep an eye out for being taken advantage of.</div><br/></div></div></div></div><div id="36841047" class="c"><input type="checkbox" id="c-36841047" checked=""/><div class="controls bullet"><span class="by">eqvinox</span><span>|</span><a href="#36840697">prev</a><span>|</span><a href="#36840926">next</a><span>|</span><label class="collapse" for="c-36841047">[-]</label><label class="expand" for="c-36841047">[3 more]</label></div><br/><div class="children"><div class="content">recommended workaround:  use lddtree (part of pax-utils)<p>The output is actually more informative too:<p><pre><code>  $ lddtree `which ssh`
  &#x2F;usr&#x2F;bin&#x2F;ssh (interpreter =&gt; &#x2F;lib64&#x2F;ld-linux-x86-64.so.2)
      libselinux.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libselinux.so.1
          libpcre2-8.so.0 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpcre2-8.so.0
      libgssapi_krb5.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgssapi_krb5.so.2
          libkrb5.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkrb5.so.3
              libkeyutils.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkeyutils.so.1
              libresolv.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libresolv.so.2
          libk5crypto.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libk5crypto.so.3
          libcom_err.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libcom_err.so.2
          libkrb5support.so.0 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkrb5support.so.0
      libcrypto.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libcrypto.so.3
      libz.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libz.so.1
      libc.so.6 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
</code></pre>
vs.<p><pre><code>  $ ldd `which ssh`    
          linux-vdso.so.1 (0x00007fff7972e000)
          libselinux.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libselinux.so.1 (0x00007f1a0030c000)
          libgssapi_krb5.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libgssapi_krb5.so.2 (0x00007f1a002ba000)
          libcrypto.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libcrypto.so.3 (0x00007f19ffe00000)
          libz.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libz.so.1 (0x00007f1a0029b000)
          libc.so.6 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 (0x00007f19ffc1e000)
          libpcre2-8.so.0 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libpcre2-8.so.0 (0x00007f19ffb84000)
          &#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x00007f1a00499000)
          libkrb5.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkrb5.so.3 (0x00007f19ffaaa000)
          libk5crypto.so.3 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libk5crypto.so.3 (0x00007f19ffa7d000)
          libcom_err.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libcom_err.so.2 (0x00007f1a00293000)
          libkrb5support.so.0 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkrb5support.so.0 (0x00007f1a00285000)
          libkeyutils.so.1 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libkeyutils.so.1 (0x00007f19ffa76000)
          libresolv.so.2 =&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libresolv.so.2 (0x00007f19ffa65000)

</code></pre>
(lddtree opens the files as plain binaries and reads the ELF linking data, it does not execute any code from the files being inspected.)</div><br/><div id="36841956" class="c"><input type="checkbox" id="c-36841956" checked=""/><div class="controls bullet"><span class="by">QuantumG</span><span>|</span><a href="#36841047">parent</a><span>|</span><a href="#36840926">next</a><span>|</span><label class="collapse" for="c-36841956">[-]</label><label class="expand" for="c-36841956">[2 more]</label></div><br/><div class="children"><div class="content">These days I tend to use $() over backticks, anyone wanna fight me on it?</div><br/><div id="36842339" class="c"><input type="checkbox" id="c-36842339" checked=""/><div class="controls bullet"><span class="by">casey2</span><span>|</span><a href="#36841047">root</a><span>|</span><a href="#36841956">parent</a><span>|</span><a href="#36840926">next</a><span>|</span><label class="collapse" for="c-36842339">[-]</label><label class="expand" for="c-36842339">[1 more]</label></div><br/><div class="children"><div class="content">For me, it&#x27;s `{} 
Directly giving `cmd for free.</div><br/></div></div></div></div></div></div><div id="36840926" class="c"><input type="checkbox" id="c-36840926" checked=""/><div class="controls bullet"><span class="by">Joker_vD</span><span>|</span><a href="#36841047">prev</a><span>|</span><a href="#36842412">next</a><span>|</span><label class="collapse" for="c-36840926">[-]</label><label class="expand" for="c-36840926">[4 more]</label></div><br/><div class="children"><div class="content">Maybe combining the linker and the loader into a single program is a bad idea. I guess they kinda do similar job, if you look from the kernel point of view...</div><br/><div id="36841388" class="c"><input type="checkbox" id="c-36841388" checked=""/><div class="controls bullet"><span class="by">raggi</span><span>|</span><a href="#36840926">parent</a><span>|</span><a href="#36842412">next</a><span>|</span><label class="collapse" for="c-36841388">[-]</label><label class="expand" for="c-36841388">[3 more]</label></div><br/><div class="children"><div class="content">besides being slower, splitting them into two would mean they’d need to agree on abi and evolution. Having them ship in the same binary skips over those concerns</div><br/><div id="36841930" class="c"><input type="checkbox" id="c-36841930" checked=""/><div class="controls bullet"><span class="by">Joker_vD</span><span>|</span><a href="#36840926">root</a><span>|</span><a href="#36841388">parent</a><span>|</span><a href="#36842412">next</a><span>|</span><label class="collapse" for="c-36841930">[-]</label><label class="expand" for="c-36841930">[2 more]</label></div><br/><div class="children"><div class="content">Okay, I&#x27;ve just checked, and apparently the ld and ld.so are two <i>completely</i> different executables: the loader, ld.so, is 236K large and statically linked while ld is 1.7M large and dynamically linked. And now that I think of it, I believe that alternative linkers such as gold, or mold, or lld, don&#x27;t come with alternative loaders so... they have to manually follow the GNU&#x27;s ld.so ABI and evolution?</div><br/><div id="36842764" class="c"><input type="checkbox" id="c-36842764" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#36840926">root</a><span>|</span><a href="#36841930">parent</a><span>|</span><a href="#36842412">next</a><span>|</span><label class="collapse" for="c-36842764">[-]</label><label class="expand" for="c-36842764">[1 more]</label></div><br/><div class="children"><div class="content">The terminology is a bit confusing: the ordinary linker used at compile time is gold, or mold, or lld, that outputs an ELF executable. Then, the dynamic linker, or dynamic loader, is provided by the libc and usually called ld-whatever.so. It takes the loaded ELF program as input when you start it, and processes relocations and whatnot before yielding control to the program&#x27;s entry point.<p>The interface between the compile-time linker and the dynamic linker is mostly defined by the ELF file format, System V ABI, and processor-specific ABI: many of the details can be found in the elf(5) man page. So in principle, there isn&#x27;t really a bespoke &quot;ld.so ABI&quot;. However, in practice, this can break down a bit on the consumer&#x27;s side; there was a ruckus a while back when glibc started only including the undocumented DT_GNU_HASH and not the documented DT_HASH for its shared libraries, under the premise that only libc should be concerned with interpreting ELF headers.<p>At least from the producer&#x27;s side, the story is better, since dynamic linkers will generally at least accept the standard headers, and ignore any nonstandard headers they don&#x27;t understand.</div><br/></div></div></div></div></div></div></div></div><div id="36842412" class="c"><input type="checkbox" id="c-36842412" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#36840926">prev</a><span>|</span><a href="#36841144">next</a><span>|</span><label class="collapse" for="c-36842412">[-]</label><label class="expand" for="c-36842412">[1 more]</label></div><br/><div class="children"><div class="content">Wouldn&#x27;t have thought of &#x27;ldd&#x27;, would have gone straight to objdump.</div><br/></div></div><div id="36841144" class="c"><input type="checkbox" id="c-36841144" checked=""/><div class="controls bullet"><span class="by">umanwizard</span><span>|</span><a href="#36842412">prev</a><span>|</span><a href="#36842440">next</a><span>|</span><label class="collapse" for="c-36841144">[-]</label><label class="expand" for="c-36841144">[6 more]</label></div><br/><div class="children"><div class="content">That’s incredible. Is there any reason not to fix ldd to just fail if the program is using a different loader?</div><br/><div id="36841858" class="c"><input type="checkbox" id="c-36841858" checked=""/><div class="controls bullet"><span class="by">xelxebar</span><span>|</span><a href="#36841144">parent</a><span>|</span><a href="#36841475">next</a><span>|</span><label class="collapse" for="c-36841858">[-]</label><label class="expand" for="c-36841858">[1 more]</label></div><br/><div class="children"><div class="content">If you take a look at the the ldd shell script, current versions no longer run the raw executable, always executing like the author&#x27;s 3rd command example.</div><br/></div></div><div id="36841475" class="c"><input type="checkbox" id="c-36841475" checked=""/><div class="controls bullet"><span class="by">GuB-42</span><span>|</span><a href="#36841144">parent</a><span>|</span><a href="#36841858">prev</a><span>|</span><a href="#36841366">next</a><span>|</span><label class="collapse" for="c-36841475">[-]</label><label class="expand" for="c-36841475">[2 more]</label></div><br/><div class="children"><div class="content">Because you may want ldd to work when the program is using a different loader. Not all nonstandard loaders are malicious.<p>If you want to avoid this risk, use something else, like readelf or lddtree.</div><br/><div id="36841603" class="c"><input type="checkbox" id="c-36841603" checked=""/><div class="controls bullet"><span class="by">eek2121</span><span>|</span><a href="#36841144">root</a><span>|</span><a href="#36841475">parent</a><span>|</span><a href="#36841366">next</a><span>|</span><label class="collapse" for="c-36841603">[-]</label><label class="expand" for="c-36841603">[1 more]</label></div><br/><div class="children"><div class="content">This attitude is why this issue exists in the first place.</div><br/></div></div></div></div><div id="36841366" class="c"><input type="checkbox" id="c-36841366" checked=""/><div class="controls bullet"><span class="by">raggi</span><span>|</span><a href="#36841144">parent</a><span>|</span><a href="#36841475">prev</a><span>|</span><a href="#36842440">next</a><span>|</span><label class="collapse" for="c-36841366">[-]</label><label class="expand" for="c-36841366">[2 more]</label></div><br/><div class="children"><div class="content">Different than what loader?</div><br/><div id="36841385" class="c"><input type="checkbox" id="c-36841385" checked=""/><div class="controls bullet"><span class="by">umanwizard</span><span>|</span><a href="#36841144">root</a><span>|</span><a href="#36841366">parent</a><span>|</span><a href="#36842440">next</a><span>|</span><label class="collapse" for="c-36841385">[-]</label><label class="expand" for="c-36841385">[1 more]</label></div><br/><div class="children"><div class="content">The GNU one.</div><br/></div></div></div></div></div></div><div id="36842440" class="c"><input type="checkbox" id="c-36842440" checked=""/><div class="controls bullet"><span class="by">rapi</span><span>|</span><a href="#36841144">prev</a><span>|</span><a href="#36840232">next</a><span>|</span><label class="collapse" for="c-36842440">[-]</label><label class="expand" for="c-36842440">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36840748">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36840748</a></div><br/></div></div><div id="36840232" class="c"><input type="checkbox" id="c-36840232" checked=""/><div class="controls bullet"><span class="by">thriftwy</span><span>|</span><a href="#36842440">prev</a><span>|</span><a href="#36843908">next</a><span>|</span><label class="collapse" for="c-36840232">[-]</label><label class="expand" for="c-36840232">[4 more]</label></div><br/><div class="children"><div class="content">I believe I saw a simple shell script based on nm or binutils which could do a safe ldd on any executable, including executables for different platforms.<p>Update: Here seems to be one example: <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;jerome-pouiller&#x2F;c403786c1394f53f44a3b61214489e6f" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;jerome-pouiller&#x2F;c403786c1394f53f44a3...</a></div><br/><div id="36840374" class="c"><input type="checkbox" id="c-36840374" checked=""/><div class="controls bullet"><span class="by">yakubin</span><span>|</span><a href="#36840232">parent</a><span>|</span><a href="#36840345">next</a><span>|</span><label class="collapse" for="c-36840374">[-]</label><label class="expand" for="c-36840374">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s <i>readelf</i>, but it will only list libs which are declared in the ELF of the executable. It won&#x27;t list libraries loaded at startup with <i>dlopen(3)</i>, unlike <i>ldd</i>. I&#x27;m also not sure, if this script will recurse, but I suspect not. <i>ldd</i> will print libraries loaded recursively.</div><br/><div id="36840935" class="c"><input type="checkbox" id="c-36840935" checked=""/><div class="controls bullet"><span class="by">Joker_vD</span><span>|</span><a href="#36840232">root</a><span>|</span><a href="#36840374">parent</a><span>|</span><a href="#36840345">next</a><span>|</span><label class="collapse" for="c-36840935">[-]</label><label class="expand" for="c-36840935">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It won&#x27;t list libraries loaded at startup with dlopen(3)<p>Well, that&#x27;d require actually executing the startup code.</div><br/></div></div></div></div><div id="36840345" class="c"><input type="checkbox" id="c-36840345" checked=""/><div class="controls bullet"><span class="by">nwellnhof</span><span>|</span><a href="#36840232">parent</a><span>|</span><a href="#36840374">prev</a><span>|</span><a href="#36843908">next</a><span>|</span><label class="collapse" for="c-36840345">[-]</label><label class="expand" for="c-36840345">[1 more]</label></div><br/><div class="children"><div class="content">This seems to be based on readelf.</div><br/></div></div></div></div><div id="36843908" class="c"><input type="checkbox" id="c-36843908" checked=""/><div class="controls bullet"><span class="by">niggerrape1488</span><span>|</span><a href="#36840232">prev</a><span>|</span><a href="#36842083">next</a><span>|</span><label class="collapse" for="c-36843908">[-]</label><label class="expand" for="c-36843908">[1 more]</label></div><br/><div class="children"><div class="content">uh oh</div><br/></div></div><div id="36842083" class="c"><input type="checkbox" id="c-36842083" checked=""/><div class="controls bullet"><span class="by">Etrnl_President</span><span>|</span><a href="#36843908">prev</a><span>|</span><a href="#36842742">next</a><span>|</span><label class="collapse" for="c-36842083">[-]</label><label class="expand" for="c-36842083">[1 more]</label></div><br/><div class="children"><div class="content">Never run IDD without also running QD, which enables a state that prevents damage or death, aka. &quot;God Mode&quot;.</div><br/></div></div></div></div></div></div></div></body></html>