<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687770058094" as="style"/><link rel="stylesheet" href="styles.css?v=1687770058094"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.microsoft.com/en-us/research/uploads/prod/2023/05/fbip.pdf">FP2: Fully In-Place Functional Programming [pdf]</a> <span class="domain">(<a href="https://www.microsoft.com">www.microsoft.com</a>)</span></div><div class="subtext"><span>chriscbr</span> | <span>19 comments</span></div><br/><div><div id="36472383" class="c"><input type="checkbox" id="c-36472383" checked=""/><div class="controls bullet"><span class="by">fweimer</span><span>|</span><a href="#36474182">next</a><span>|</span><label class="collapse" for="c-36472383">[-]</label><label class="expand" for="c-36472383">[4 more]</label></div><br/><div class="children"><div class="content">This research is related to the Koka programming language: <a href="https:&#x2F;&#x2F;koka-lang.github.io&#x2F;koka&#x2F;doc&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;koka-lang.github.io&#x2F;koka&#x2F;doc&#x2F;</a></div><br/><div id="36475694" class="c"><input type="checkbox" id="c-36475694" checked=""/><div class="controls bullet"><span class="by">vosper</span><span>|</span><a href="#36472383">parent</a><span>|</span><a href="#36474182">next</a><span>|</span><label class="collapse" for="c-36475694">[-]</label><label class="expand" for="c-36475694">[3 more]</label></div><br/><div class="children"><div class="content">This paper was published in May, but it doesn&#x27;t look like Koka&#x27;s had much acitivity for about a year now (based on Github). Any idea if Koka&#x27;s still in development?</div><br/><div id="36476562" class="c"><input type="checkbox" id="c-36476562" checked=""/><div class="controls bullet"><span class="by">GrygrFlzr</span><span>|</span><a href="#36472383">root</a><span>|</span><a href="#36475694">parent</a><span>|</span><a href="#36476541">next</a><span>|</span><label class="collapse" for="c-36476562">[-]</label><label class="expand" for="c-36476562">[1 more]</label></div><br/><div class="children"><div class="content">Looks like most of the work is on other branches, the most up to date dev-fbip branch had a commit from 2 weeks ago.</div><br/></div></div><div id="36476541" class="c"><input type="checkbox" id="c-36476541" checked=""/><div class="controls bullet"><span class="by">adultSwim</span><span>|</span><a href="#36472383">root</a><span>|</span><a href="#36475694">parent</a><span>|</span><a href="#36476562">prev</a><span>|</span><a href="#36474182">next</a><span>|</span><label class="collapse" for="c-36476541">[-]</label><label class="expand" for="c-36476541">[1 more]</label></div><br/><div class="children"><div class="content">The dev branch was updated earlier this year.</div><br/></div></div></div></div></div></div><div id="36474182" class="c"><input type="checkbox" id="c-36474182" checked=""/><div class="controls bullet"><span class="by">francasso</span><span>|</span><a href="#36472383">prev</a><span>|</span><a href="#36476786">next</a><span>|</span><label class="collapse" for="c-36474182">[-]</label><label class="expand" for="c-36474182">[2 more]</label></div><br/><div class="children"><div class="content">This is also used in Lean 4, which as it turns out is not just great for math proofs, but is also becoming a great general purpose programming language</div><br/><div id="36476873" class="c"><input type="checkbox" id="c-36476873" checked=""/><div class="controls bullet"><span class="by">kmill</span><span>|</span><a href="#36474182">parent</a><span>|</span><a href="#36476786">next</a><span>|</span><label class="collapse" for="c-36476873">[-]</label><label class="expand" for="c-36476873">[1 more]</label></div><br/><div class="children"><div class="content">Lean 4 uses FBIP, but it looks like this paper is about something called FIP, which is related but about <i>guaranteeing</i> there are no allocations or deallocations. FBIP as I understand it is more about being able write functional code in a natural away while avoiding allocations or deallocations.<p>(I agree about Lean 4 as becoming a great general purpose language though!)</div><br/></div></div></div></div><div id="36476786" class="c"><input type="checkbox" id="c-36476786" checked=""/><div class="controls bullet"><span class="by">malf</span><span>|</span><a href="#36474182">prev</a><span>|</span><a href="#36472372">next</a><span>|</span><label class="collapse" for="c-36476786">[-]</label><label class="expand" for="c-36476786">[1 more]</label></div><br/><div class="children"><div class="content">Noob question: the Top type here is exactly the Node constructor of the stree type. It seems useful to declare a type that is “this ADT, but limited to these constructors”, but even Haskell seems to avoid it. Why?</div><br/></div></div><div id="36472372" class="c"><input type="checkbox" id="c-36472372" checked=""/><div class="controls bullet"><span class="by">zellyn</span><span>|</span><a href="#36476786">prev</a><span>|</span><a href="#36472679">next</a><span>|</span><label class="collapse" for="c-36472372">[-]</label><label class="expand" for="c-36472372">[4 more]</label></div><br/><div class="children"><div class="content">I was hoping it would reference roc-lang.org, which is actually doing in-place mutation for efficiency, but I didn’t see any mentions :-(</div><br/><div id="36472752" class="c"><input type="checkbox" id="c-36472752" checked=""/><div class="controls bullet"><span class="by">zogrodea</span><span>|</span><a href="#36472372">parent</a><span>|</span><a href="#36472531">next</a><span>|</span><label class="collapse" for="c-36472752">[-]</label><label class="expand" for="c-36472752">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t really mind Roc-lang not being mentioned since Koka is referenced with its novel idea of functional-but-in-place and Perceus Reference Counting which are the theoretical basis of Roc&#x27;s implementation[0]. So it doesn&#x27;t really bring anything theoretically unique to the table in comparison, although I&#x27;m interested in Roc as a practical language because of this too.<p>[0] Ctrl-f &quot;Perceus&quot; on the following page and you will see a paper about Koka mentioned. <a href="https:&#x2F;&#x2F;www.roc-lang.org&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.roc-lang.org&#x2F;</a></div><br/><div id="36474736" class="c"><input type="checkbox" id="c-36474736" checked=""/><div class="controls bullet"><span class="by">ghayes</span><span>|</span><a href="#36472372">root</a><span>|</span><a href="#36472752">parent</a><span>|</span><a href="#36472531">next</a><span>|</span><label class="collapse" for="c-36474736">[-]</label><label class="expand" for="c-36474736">[1 more]</label></div><br/><div class="children"><div class="content">Surprised there hasn’t been a well-received HN post on Roc-lang. It looks really interesting.</div><br/></div></div></div></div><div id="36472531" class="c"><input type="checkbox" id="c-36472531" checked=""/><div class="controls bullet"><span class="by">agumonkey</span><span>|</span><a href="#36472372">parent</a><span>|</span><a href="#36472752">prev</a><span>|</span><a href="#36472679">next</a><span>|</span><label class="collapse" for="c-36472531">[-]</label><label class="expand" for="c-36472531">[1 more]</label></div><br/><div class="children"><div class="content">I stopped monitoring roc after feldman&#x27;s early youtube chats, but it seems evolving in term of team size.</div><br/></div></div></div></div><div id="36472679" class="c"><input type="checkbox" id="c-36472679" checked=""/><div class="controls bullet"><span class="by">foota</span><span>|</span><a href="#36472372">prev</a><span>|</span><a href="#36475298">next</a><span>|</span><label class="collapse" for="c-36472679">[-]</label><label class="expand" for="c-36472679">[1 more]</label></div><br/><div class="children"><div class="content">Interesting article, I wonder if FIP procedures could be useful even in non functional oriented languages as a safer means of reusing allocations (in languages that support reference counting or ownership?).</div><br/></div></div><div id="36475298" class="c"><input type="checkbox" id="c-36475298" checked=""/><div class="controls bullet"><span class="by">e-dant</span><span>|</span><a href="#36472679">prev</a><span>|</span><label class="collapse" for="c-36475298">[-]</label><label class="expand" for="c-36475298">[6 more]</label></div><br/><div class="children"><div class="content">Looks like constant folding to me. What’s the difference exactly?</div><br/><div id="36475964" class="c"><input type="checkbox" id="c-36475964" checked=""/><div class="controls bullet"><span class="by">tuukkah</span><span>|</span><a href="#36475298">parent</a><span>|</span><label class="collapse" for="c-36475964">[-]</label><label class="expand" for="c-36475964">[5 more]</label></div><br/><div class="children"><div class="content">Constant folding means you calculate the result of an expression at compile time.<p>In-place updating means you re-use the memory location of an earlier variable that&#x27;s not needed anymore. Simple example in pseudo-C:<p><pre><code>  BigInt increment_twice(const BigInt x) {
      const BigInt y = x + 1;
      const BigInt z = y + 1;
      return z;
  }
</code></pre>
There are no compile-time constant expressions that could be folded here. But since y is not used after z is assigned, we can re-use the memory location of y for the memory location of z.<p>And if the caller is not using the argument after the function returns, the memory location of the argument can be used to store the return value. This means the function call does not need to allocate memory at all, not even on the stack.</div><br/><div id="36476577" class="c"><input type="checkbox" id="c-36476577" checked=""/><div class="controls bullet"><span class="by">GrygrFlzr</span><span>|</span><a href="#36475298">root</a><span>|</span><a href="#36475964">parent</a><span>|</span><a href="#36476222">next</a><span>|</span><label class="collapse" for="c-36476577">[-]</label><label class="expand" for="c-36476577">[3 more]</label></div><br/><div class="children"><div class="content">Does this make it more difficult to reason about the program memory usage over its lifetime, or can all potential cases be statically analyzed?</div><br/><div id="36476887" class="c"><input type="checkbox" id="c-36476887" checked=""/><div class="controls bullet"><span class="by">kmill</span><span>|</span><a href="#36475298">root</a><span>|</span><a href="#36476577">parent</a><span>|</span><a href="#36476899">next</a><span>|</span><label class="collapse" for="c-36476887">[-]</label><label class="expand" for="c-36476887">[1 more]</label></div><br/><div class="children"><div class="content">The paper is about trying to statically analyze this. As I understand it, fip-annotated functions are ones that are checked to neither allocate nor deallocate.</div><br/></div></div><div id="36476899" class="c"><input type="checkbox" id="c-36476899" checked=""/><div class="controls bullet"><span class="by">tuukkah</span><span>|</span><a href="#36475298">root</a><span>|</span><a href="#36476577">parent</a><span>|</span><a href="#36476887">prev</a><span>|</span><a href="#36476222">next</a><span>|</span><label class="collapse" for="c-36476899">[-]</label><label class="expand" for="c-36476899">[1 more]</label></div><br/><div class="children"><div class="content">Seems easy and clear: they introduce a keyword &quot;fip&quot; that you use to mark a function as being fully in-place, and they statically check it.</div><br/></div></div></div></div><div id="36476222" class="c"><input type="checkbox" id="c-36476222" checked=""/><div class="controls bullet"><span class="by">jimsimmons</span><span>|</span><a href="#36475298">root</a><span>|</span><a href="#36475964">parent</a><span>|</span><a href="#36476577">prev</a><span>|</span><label class="collapse" for="c-36476222">[-]</label><label class="expand" for="c-36476222">[1 more]</label></div><br/><div class="children"><div class="content">One is for stack allocated objects and the other for heap</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>