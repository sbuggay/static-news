<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712221254621" as="style"/><link rel="stylesheet" href="styles.css?v=1712221254621"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sixcolors.com/post/2024/03/a-disk-so-full-it-couldnt-be-restored/">A disk so full, it couldn&#x27;t be restored</a> <span class="domain">(<a href="https://sixcolors.com">sixcolors.com</a>)</span></div><div class="subtext"><span>goranmoomin</span> | <span>105 comments</span></div><br/><div><div id="39925941" class="c"><input type="checkbox" id="c-39925941" checked=""/><div class="controls bullet"><span class="by">miles</span><span>|</span><a href="#39925907">next</a><span>|</span><label class="collapse" for="c-39925941">[-]</label><label class="expand" for="c-39925941">[27 more]</label></div><br/><div class="children"><div class="content">The author might have had better luck by using an external storage device to boot the Mac and delete unneeded files on the internal disk from there:<p><i>Use an external storage device as a Mac startup disk</i> <a href="https:&#x2F;&#x2F;support.apple.com&#x2F;en-us&#x2F;111336" rel="nofollow">https:&#x2F;&#x2F;support.apple.com&#x2F;en-us&#x2F;111336</a><p>Was surprised to learn that with Apple silicon-based Macs, not all ports are equal when it comes to external booting:<p>If you&#x27;re using a Mac computer with Apple silicon, your Mac has one or more USB or Thunderbolt ports that have a type USB-C connector. While you&#x27;re installing macOS on your storage device, it matters which of these ports you use. After installation is complete, you can connect your storage device to any of them.<p>* Mac laptop computer: Use any USB-C port except the leftmost USB-C port when facing the ports on the left side of the Mac.<p>* iMac: Use any USB-C port except the rightmost USB-C port when facing the back of the Mac.<p>* Mac mini: Use any USB-C port except the leftmost USB-C port when facing the back of the Mac.<p>* Mac Studio: Use any USB-C port except the rightmost USB-C port when facing the back of the Mac.<p>* Mac Pro with desktop enclosure: Use any USB-C port except the one on the top of the Mac that is farthest from the power button.<p>* Mac Pro with rack enclosure: Use any USB-C port except the one on the front of the Mac that&#x27;s closest to the power button.</div><br/><div id="39926012" class="c"><input type="checkbox" id="c-39926012" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39925941">parent</a><span>|</span><a href="#39926756">next</a><span>|</span><label class="collapse" for="c-39926012">[-]</label><label class="expand" for="c-39926012">[16 more]</label></div><br/><div class="children"><div class="content">If the filesystem itself got into a deadlocked state, booting from anything and going through the FS driver to delete files from it won&#x27;t work.</div><br/><div id="39926068" class="c"><input type="checkbox" id="c-39926068" checked=""/><div class="controls bullet"><span class="by">HumanOstrich</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926012">parent</a><span>|</span><a href="#39926756">next</a><span>|</span><label class="collapse" for="c-39926068">[-]</label><label class="expand" for="c-39926068">[15 more]</label></div><br/><div class="children"><div class="content">What do you mean by &quot;deadlocked state&quot; for a filesystem?</div><br/><div id="39926193" class="c"><input type="checkbox" id="c-39926193" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926068">parent</a><span>|</span><a href="#39926203">next</a><span>|</span><label class="collapse" for="c-39926193">[-]</label><label class="expand" for="c-39926193">[7 more]</label></div><br/><div class="children"><div class="content">Some filesystems may require allocating metadata to delete a file.  AFIK it&#x27;s a non issue with traditional Berkeley-style systems, since metadata and data come from a separate pools.  Notably ZFS has this problem.</div><br/><div id="39926618" class="c"><input type="checkbox" id="c-39926618" checked=""/><div class="controls bullet"><span class="by">em-bee</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926193">parent</a><span>|</span><a href="#39926203">next</a><span>|</span><label class="collapse" for="c-39926618">[-]</label><label class="expand" for="c-39926618">[6 more]</label></div><br/><div class="children"><div class="content">btrfs has this problem too it seems. but there it is usually easy to add a usb stick to extend the filesystem and fix the problem.<p>i find it really frustrating though. why not just reserve some space?</div><br/><div id="39927367" class="c"><input type="checkbox" id="c-39927367" checked=""/><div class="controls bullet"><span class="by">steve_rambo</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926618">parent</a><span>|</span><a href="#39926923">next</a><span>|</span><label class="collapse" for="c-39927367">[-]</label><label class="expand" for="c-39927367">[1 more]</label></div><br/><div class="children"><div class="content">btrfs does reserve some space for exactly this issue, although it might not always be enough.<p><a href="https:&#x2F;&#x2F;btrfs.readthedocs.io&#x2F;en&#x2F;latest&#x2F;btrfs-filesystem.html" rel="nofollow">https:&#x2F;&#x2F;btrfs.readthedocs.io&#x2F;en&#x2F;latest&#x2F;btrfs-filesystem.html</a><p>&gt; GlobalReserve is an artificial and internal emergency space. It is used e.g. when the filesystem is full. Its total size is dynamic based on the filesystem size, usually not larger than 512MiB, used may fluctuate.</div><br/></div></div><div id="39926923" class="c"><input type="checkbox" id="c-39926923" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926618">parent</a><span>|</span><a href="#39927367">prev</a><span>|</span><a href="#39926203">next</a><span>|</span><label class="collapse" for="c-39926923">[-]</label><label class="expand" for="c-39926923">[4 more]</label></div><br/><div class="children"><div class="content">Yeah, with ZFS some will make an unused dataset with a small reservation (say 1G) that you can then shrink to delete files if the disk is full.</div><br/><div id="39927723" class="c"><input type="checkbox" id="c-39927723" checked=""/><div class="controls bullet"><span class="by">rincebrain</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926923">parent</a><span>|</span><a href="#39927805">next</a><span>|</span><label class="collapse" for="c-39927723">[-]</label><label class="expand" for="c-39927723">[2 more]</label></div><br/><div class="children"><div class="content">This hasn&#x27;t been a problem you should be able to hit in ZFS in a long time.<p>It reserves a percent of your pool&#x27;s total space precisely to avoid having 0 actual free space and only allows using space from that amount if the operation is a net gain on free space.</div><br/><div id="39927801" class="c"><input type="checkbox" id="c-39927801" checked=""/><div class="controls bullet"><span class="by">p_l</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39927723">parent</a><span>|</span><a href="#39927805">next</a><span>|</span><label class="collapse" for="c-39927801">[-]</label><label class="expand" for="c-39927801">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, a situation where you pool gets suspended due to no space and you can&#x27;t delete files is considered a bug by OpenZFS.</div><br/></div></div></div></div><div id="39927805" class="c"><input type="checkbox" id="c-39927805" checked=""/><div class="controls bullet"><span class="by">p_l</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926923">parent</a><span>|</span><a href="#39927723">prev</a><span>|</span><a href="#39926203">next</a><span>|</span><label class="collapse" for="c-39927805">[-]</label><label class="expand" for="c-39927805">[1 more]</label></div><br/><div class="children"><div class="content">The recommended solution is to apply a quota on top-level dataset, but that&#x27;s mainly for preventing fragmentation or runaway writes.</div><br/></div></div></div></div></div></div></div></div><div id="39926203" class="c"><input type="checkbox" id="c-39926203" checked=""/><div class="controls bullet"><span class="by">syncsynchalt</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926068">parent</a><span>|</span><a href="#39926193">prev</a><span>|</span><a href="#39926185">next</a><span>|</span><label class="collapse" for="c-39926203">[-]</label><label class="expand" for="c-39926203">[6 more]</label></div><br/><div class="children"><div class="content">Modern (well, post-ZFS) filesystems operate by moving the filesystem through state changes where data is not (immediately) destroyed, but older versions of the data are still available for various purposes. Similar to an ACID-compliant database, something like a backup or recovery process can still access older snapshots of the filesystem, for various values of &quot;older&quot; that might range from milliseconds to seconds to years.<p>With that in mind, you can see how we get in a scenario where deleting a file will require a minor bit of storage for recordkeeping the old and new states, before it can actually free up the storage by releasing the old state. There is supposed to be an escape hatch for getting yourself out of a situation where there isn&#x27;t even enough storage for this little bit of record keeping, but either the author didn&#x27;t know whatever trick is needed or the filesystem code wasn&#x27;t well-behaved in this area (it&#x27;s a corner-case that isn&#x27;t often tested).</div><br/><div id="39926886" class="c"><input type="checkbox" id="c-39926886" checked=""/><div class="controls bullet"><span class="by">jrockway</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926203">parent</a><span>|</span><a href="#39926884">next</a><span>|</span><label class="collapse" for="c-39926886">[-]</label><label class="expand" for="c-39926886">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m most surprised by the lack of testing.  Macs tend to ship with much smaller SSDs than other computers because that&#x27;s how Apple makes money ($600 for 1.5TB of flash vs. $100&#x2F;2TB if you buy an NVMe SSD), so I&#x27;d expect that people run out of space pretty frequently.</div><br/></div></div><div id="39926884" class="c"><input type="checkbox" id="c-39926884" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926203">parent</a><span>|</span><a href="#39926886">prev</a><span>|</span><a href="#39927886">next</a><span>|</span><label class="collapse" for="c-39926884">[-]</label><label class="expand" for="c-39926884">[3 more]</label></div><br/><div class="children"><div class="content">It feels like insanity that the <i>default configuration</i> of any filesystem intended for laymen can fail to delete a file due to anything other than an I&#x2F;O error. If you want to keep a snapshot, at least bypass it when disk space runs out? How many customers do the vendors think would prefer the alternative?!</div><br/><div id="39927713" class="c"><input type="checkbox" id="c-39927713" checked=""/><div class="controls bullet"><span class="by">kamray23</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926884">parent</a><span>|</span><a href="#39927792">next</a><span>|</span><label class="collapse" for="c-39927713">[-]</label><label class="expand" for="c-39927713">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not really just keeping snapshots that is the issue, usually. It&#x27;s just normal FS operation, meant to prevent data corruption if any of these actions is interrupted, as well as various space-saving measures. Some FSs link files together when saving mass data so that identical blocks between them are only stored once, which means any of those files can only be fully deleted when all of them are. Some FSs log actions onto disk before and after doing them so that they can be restarted if interrupted. Some FSs do genuinely keep files on disk if they&#x27;re already referenced in a snapshot even if you delete them – this is one instance where a modal about the issue should probably pop up if disk space is low. And some OSes really really really want to move things to .Trash1000 or something else stupid instead of deleting them.</div><br/></div></div><div id="39927792" class="c"><input type="checkbox" id="c-39927792" checked=""/><div class="controls bullet"><span class="by">p_l</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926884">parent</a><span>|</span><a href="#39927713">prev</a><span>|</span><a href="#39927886">next</a><span>|</span><label class="collapse" for="c-39927792">[-]</label><label class="expand" for="c-39927792">[1 more]</label></div><br/><div class="children"><div class="content">Pretty much by the time you get to 100% full on ZFS, the latency is going to get atrocious anyway, but from my understanding there are multiple steps (from simplest to worst case) that ZFS permits in case you do hit the error:<p>1. Just remove some files - ZFS will attempt to do the right thing<p>2. Remove old snapshots<p>3. Mount the drive from another system (so nothing tries writing to it), then remove some files, reboot back to normal<p>4. Use `zfs send` to copy the data you want to keep to another bigger drive temporarily, then either prune the data or if you already filtered out any old snapshots, zero the original pool and reload it by `zfs send` from before.</div><br/></div></div></div></div><div id="39927886" class="c"><input type="checkbox" id="c-39927886" checked=""/><div class="controls bullet"><span class="by">werid</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926203">parent</a><span>|</span><a href="#39926884">prev</a><span>|</span><a href="#39926185">next</a><span>|</span><label class="collapse" for="c-39927886">[-]</label><label class="expand" for="c-39927886">[1 more]</label></div><br/><div class="children"><div class="content">i&#x27;ve filled up an zfs array to the point where i could not delete files.<p>the trick is to truncate a large enough files, or enough small files, to zero.<p>not sure if this is a universal shell trick, but worked on those i tried: &quot;&gt; filename&quot;</div><br/></div></div></div></div><div id="39926185" class="c"><input type="checkbox" id="c-39926185" checked=""/><div class="controls bullet"><span class="by">pxx</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926068">parent</a><span>|</span><a href="#39926203">prev</a><span>|</span><a href="#39926756">next</a><span>|</span><label class="collapse" for="c-39926185">[-]</label><label class="expand" for="c-39926185">[1 more]</label></div><br/><div class="children"><div class="content">Where `rm`, or more technically unlink(2), fails due to ENOSPC, like in the article...<p>Hilariously this failure case doesn&#x27;t seem to be listed in the docs. <a href="https:&#x2F;&#x2F;developer.apple.com&#x2F;library&#x2F;archive&#x2F;documentation&#x2F;System&#x2F;Conceptual&#x2F;ManPages_iPhoneOS&#x2F;man2&#x2F;unlink.2.html" rel="nofollow">https:&#x2F;&#x2F;developer.apple.com&#x2F;library&#x2F;archive&#x2F;documentation&#x2F;Sy...</a></div><br/></div></div></div></div></div></div><div id="39926756" class="c"><input type="checkbox" id="c-39926756" checked=""/><div class="controls bullet"><span class="by">appplication</span><span>|</span><a href="#39925941">parent</a><span>|</span><a href="#39926012">prev</a><span>|</span><a href="#39926375">next</a><span>|</span><label class="collapse" for="c-39926756">[-]</label><label class="expand" for="c-39926756">[1 more]</label></div><br/><div class="children"><div class="content">This is the kind of comment someone is going to be very happy to read in 8 years when they’re looking for answers for their (then) ancient Mac.</div><br/></div></div><div id="39926375" class="c"><input type="checkbox" id="c-39926375" checked=""/><div class="controls bullet"><span class="by">klausa</span><span>|</span><a href="#39925941">parent</a><span>|</span><a href="#39926756">prev</a><span>|</span><a href="#39926636">next</a><span>|</span><label class="collapse" for="c-39926375">[-]</label><label class="expand" for="c-39926375">[1 more]</label></div><br/><div class="children"><div class="content">Why do you think that would work; if using recoveryOS or starting the Mac Share Disk&#x2F;Target Disk mode didn&#x27;t?</div><br/></div></div><div id="39926636" class="c"><input type="checkbox" id="c-39926636" checked=""/><div class="controls bullet"><span class="by">deeth_starr_v</span><span>|</span><a href="#39925941">parent</a><span>|</span><a href="#39926375">prev</a><span>|</span><a href="#39926154">next</a><span>|</span><label class="collapse" for="c-39926636">[-]</label><label class="expand" for="c-39926636">[6 more]</label></div><br/><div class="children"><div class="content">Anyone know why you can’t use the first usb-c port on a Mac laptop to make the bootable os?</div><br/><div id="39927027" class="c"><input type="checkbox" id="c-39927027" checked=""/><div class="controls bullet"><span class="by">Tsiklon</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926636">parent</a><span>|</span><a href="#39926671">next</a><span>|</span><label class="collapse" for="c-39927027">[-]</label><label class="expand" for="c-39927027">[4 more]</label></div><br/><div class="children"><div class="content">The ports mentioned expose the serial interface that can be used to restore&#x2F;revive the machine in DFU mode<p><a href="https:&#x2F;&#x2F;support.apple.com&#x2F;en-us&#x2F;108900" rel="nofollow">https:&#x2F;&#x2F;support.apple.com&#x2F;en-us&#x2F;108900</a><p>That said, no idea why they can’t be used in this case</div><br/><div id="39927181" class="c"><input type="checkbox" id="c-39927181" checked=""/><div class="controls bullet"><span class="by">nottorp</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39927027">parent</a><span>|</span><a href="#39927061">next</a><span>|</span><label class="collapse" for="c-39927181">[-]</label><label class="expand" for="c-39927181">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Mac laptop computer: Use any USB-C port except the leftmost USB-C port when facing the ports on the left side of the Mac.<p>Also on my mbpro at least the mentioned port is the one closest to the magsafe connector and may have funny electrical connections to it, perhaps.</div><br/></div></div><div id="39927061" class="c"><input type="checkbox" id="c-39927061" checked=""/><div class="controls bullet"><span class="by">joecool1029</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39927027">parent</a><span>|</span><a href="#39927181">prev</a><span>|</span><a href="#39926671">next</a><span>|</span><label class="collapse" for="c-39927061">[-]</label><label class="expand" for="c-39927061">[2 more]</label></div><br/><div class="children"><div class="content">&gt; That said, no idea why they can’t be used in this case<p>My intuitive guess here is how the ports are connected to the T2 security chip. One port is as you said a console port that allows access to perform commands to flash&#x2F;recover&#x2F;re-provision the T2 chip. Same as an OOB serial port on networking equip.<p>The rest of the ports the T2 chip has read&#x2F;write access to devices connected to it. Since this is an OS drive, I&#x27;m guessing it needs to be encrypted and the T2 chip handles this function.</div><br/><div id="39927862" class="c"><input type="checkbox" id="c-39927862" checked=""/><div class="controls bullet"><span class="by">amelius</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39927061">parent</a><span>|</span><a href="#39926671">next</a><span>|</span><label class="collapse" for="c-39927862">[-]</label><label class="expand" for="c-39927862">[1 more]</label></div><br/><div class="children"><div class="content">That doesn&#x27;t make it technically impossible to boot from that port.</div><br/></div></div></div></div></div></div><div id="39926671" class="c"><input type="checkbox" id="c-39926671" checked=""/><div class="controls bullet"><span class="by">plussed_reader</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926636">parent</a><span>|</span><a href="#39927027">prev</a><span>|</span><a href="#39926154">next</a><span>|</span><label class="collapse" for="c-39926671">[-]</label><label class="expand" for="c-39926671">[1 more]</label></div><br/><div class="children"><div class="content">What if it&#x27;s through a USB c adapter to a usbA thumbstick?</div><br/></div></div></div></div><div id="39926154" class="c"><input type="checkbox" id="c-39926154" checked=""/><div class="controls bullet"><span class="by">timcederman</span><span>|</span><a href="#39925941">parent</a><span>|</span><a href="#39926636">prev</a><span>|</span><a href="#39925907">next</a><span>|</span><label class="collapse" for="c-39926154">[-]</label><label class="expand" for="c-39926154">[2 more]</label></div><br/><div class="children"><div class="content">Or boot it into Target Disk Mode using another machine.</div><br/><div id="39927099" class="c"><input type="checkbox" id="c-39927099" checked=""/><div class="controls bullet"><span class="by">olliej</span><span>|</span><a href="#39925941">root</a><span>|</span><a href="#39926154">parent</a><span>|</span><a href="#39925907">next</a><span>|</span><label class="collapse" for="c-39927099">[-]</label><label class="expand" for="c-39927099">[1 more]</label></div><br/><div class="children"><div class="content">you can&#x27;t boot the arm Macs into target disk mode, you can only boot to the recovery os and share the drive - it shows up as a network share iirc. I was super annoyed by this a few weeks ago because you can, for example, use spotlight to search for &quot;target disk mode&quot; and it will show up, and looks like it will take you to the reboot in target disk mode option, but once you&#x27;re there it&#x27;s just the standard &quot;choose a boot drive&quot; selector.</div><br/></div></div></div></div></div></div><div id="39925907" class="c"><input type="checkbox" id="c-39925907" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39925941">prev</a><span>|</span><a href="#39926222">next</a><span>|</span><label class="collapse" for="c-39925907">[-]</label><label class="expand" for="c-39925907">[5 more]</label></div><br/><div class="children"><div class="content">My best guess at what happened (based on a little knowledge of HFS+ disk structures, but not APFS) is that the journal file also filled up, and since deletion requires writing to it and possibly expanding it, you get into the unusual situation where deletion requires, at least temporarily, more space.<p><i>macOS continued to write files until there was just 41K free on the drive.</i><p>I&#x27;ve (accidentally) ran both NTFS and FAT32 to <i>0</i> bytes free, and it was always possible to delete something even in that situation.<p><i>Digging around in forums, I found that Sonoma has broken the SMB&#x2F;Samba-based networking mount procedure for Time Machine restores, and no one had found a solution. This appears to still be the case in 14.4.</i><p>In my experience SMB became unreliable and just unacceptably buggy many years ago, starting around the 10.12-10.13 timeframe; and now it looks like Apple doesn&#x27;t care about whether it works at all anymore.<p><i>I hate to think what people without decades of Mac experience do when confronted with systemic, cascading failures like this when I felt helpless despite what I thought I knew and all the answers I searched for and found on forums.</i><p>I don&#x27;t have &quot;decades of Mac experience&quot;, but the first thing I&#x27;d try is a fsck --- odd not to see that mentioned here.<p>If I were asked to recover from this situation, and couldn&#x27;t just copy the necessary contents of the disk to another one before formatting it and then copying back, I&#x27;d get the APFS documentation (<a href="https:&#x2F;&#x2F;developer.apple.com&#x2F;support&#x2F;downloads&#x2F;Apple-File-System-Reference.pdf" rel="nofollow">https:&#x2F;&#x2F;developer.apple.com&#x2F;support&#x2F;downloads&#x2F;Apple-File-Sys...</a>) and figure out what to edit (with dd and a hex editor) to get some free space.</div><br/><div id="39926803" class="c"><input type="checkbox" id="c-39926803" checked=""/><div class="controls bullet"><span class="by">Lammy</span><span>|</span><a href="#39925907">parent</a><span>|</span><a href="#39927702">next</a><span>|</span><label class="collapse" for="c-39926803">[-]</label><label class="expand" for="c-39926803">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Sonoma has broken the SMB&#x2F;Samba-based networking<p>Apple dropped Samba in favor of their own implementation a long time ago after Samba adopted GPLv3:<p><a href="https:&#x2F;&#x2F;lists.samba.org&#x2F;archive&#x2F;samba-announce&#x2F;2007&#x2F;000122.html" rel="nofollow">https:&#x2F;&#x2F;lists.samba.org&#x2F;archive&#x2F;samba-announce&#x2F;2007&#x2F;000122.h...</a><p><a href="https:&#x2F;&#x2F;www.engadget.com&#x2F;2011-03-24-apple-to-drop-samba-networking-tools-from-lion.html" rel="nofollow">https:&#x2F;&#x2F;www.engadget.com&#x2F;2011-03-24-apple-to-drop-samba-netw...</a></div><br/></div></div><div id="39927702" class="c"><input type="checkbox" id="c-39927702" checked=""/><div class="controls bullet"><span class="by">arghwhat</span><span>|</span><a href="#39925907">parent</a><span>|</span><a href="#39926803">prev</a><span>|</span><a href="#39927092">next</a><span>|</span><label class="collapse" for="c-39927702">[-]</label><label class="expand" for="c-39927702">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s for a journalling filesystem. For CoW filesystems, the issue is that any change to the filesystem is done by making a new file tree containing your change, and then updating the root to point the new tree. Later, garbage collection finds files that are no longer part of an active tree and returns their storage to the pool.<p>Changes are usually batched to reduce the amount of tree changes to a manageable amount. A bonus of this design is that a filesystem snapshot is just another reference to a particular tree.<p>This requires space, but CoW filesystems also usually reserve an amount of emergency storage for this reason.</div><br/></div></div><div id="39927092" class="c"><input type="checkbox" id="c-39927092" checked=""/><div class="controls bullet"><span class="by">begueradj</span><span>|</span><a href="#39925907">parent</a><span>|</span><a href="#39927702">prev</a><span>|</span><a href="#39927085">next</a><span>|</span><label class="collapse" for="c-39927092">[-]</label><label class="expand" for="c-39927092">[1 more]</label></div><br/><div class="children"><div class="content">So far, you&#x27;re the only one who provided a technical explanation for this.</div><br/></div></div><div id="39927085" class="c"><input type="checkbox" id="c-39927085" checked=""/><div class="controls bullet"><span class="by">greenicon</span><span>|</span><a href="#39925907">parent</a><span>|</span><a href="#39927092">prev</a><span>|</span><a href="#39926222">next</a><span>|</span><label class="collapse" for="c-39927085">[-]</label><label class="expand" for="c-39927085">[1 more]</label></div><br/><div class="children"><div class="content">For a networked Time Machine restore you can reinstall MacOS without restoring first and then use the migration utility to restore from a remote Time Machine. That seems to use a different smb binary which works. Still, I find it infuriating that restoring, one of the most important things you do on a machine, is broken and was not caught by QA.</div><br/></div></div></div></div><div id="39926222" class="c"><input type="checkbox" id="c-39926222" checked=""/><div class="controls bullet"><span class="by">staticfloat</span><span>|</span><a href="#39925907">prev</a><span>|</span><a href="#39926619">next</a><span>|</span><label class="collapse" for="c-39926222">[-]</label><label class="expand" for="c-39926222">[7 more]</label></div><br/><div class="children"><div class="content">I ran into an issue like this in my first ever job! I accidentally filled up a cluster with junk files and the sysadmin started sending me emails saying I needed to fix it ASAP but rm wouldn’t work. He taught me that file truncation usually works when deletion doesn’t, so you can usually do “cat &#x2F;dev&#x2F;null &gt; foo” when “rm foo” doesn’t work.</div><br/><div id="39926434" class="c"><input type="checkbox" id="c-39926434" checked=""/><div class="controls bullet"><span class="by">mjevans</span><span>|</span><a href="#39926222">parent</a><span>|</span><a href="#39927177">next</a><span>|</span><label class="collapse" for="c-39926434">[-]</label><label class="expand" for="c-39926434">[1 more]</label></div><br/><div class="children"><div class="content">In shell :&gt;filepath often works...<p>However sometimes filesystems can&#x27;t do that.  For those cases, hopefully the filesystem supports: resize-grow, resize-shrink, and either additional temporary storage or is on top of an underlying system which can add&#x2F;remove backing storage.  You may also need to use custom commands to restore the filesystem&#x27;s structure to one intended for a single block device (btrfs comes to mind here).</div><br/></div></div><div id="39927177" class="c"><input type="checkbox" id="c-39927177" checked=""/><div class="controls bullet"><span class="by">JohnMakin</span><span>|</span><a href="#39926222">parent</a><span>|</span><a href="#39926434">prev</a><span>|</span><a href="#39926234">next</a><span>|</span><label class="collapse" for="c-39927177">[-]</label><label class="expand" for="c-39927177">[1 more]</label></div><br/><div class="children"><div class="content">I was once in a situation years ago where a critical piece of infrastructure could brick itself irreparably with a deadlock unless it was always able to write to the file system, so I had a backup process just periodically send garbage directly to dev null and as far as I know that dirty hack is still running years later.<p>&#x2F;dev&#x2F;null is magical and worth reading into</div><br/></div></div><div id="39926234" class="c"><input type="checkbox" id="c-39926234" checked=""/><div class="controls bullet"><span class="by">pram</span><span>|</span><a href="#39926222">parent</a><span>|</span><a href="#39927177">prev</a><span>|</span><a href="#39926312">next</a><span>|</span><label class="collapse" for="c-39926234">[-]</label><label class="expand" for="c-39926234">[1 more]</label></div><br/><div class="children"><div class="content">You can actually just do &gt;file</div><br/></div></div><div id="39926312" class="c"><input type="checkbox" id="c-39926312" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#39926222">parent</a><span>|</span><a href="#39926234">prev</a><span>|</span><a href="#39926228">next</a><span>|</span><label class="collapse" for="c-39926312">[-]</label><label class="expand" for="c-39926312">[2 more]</label></div><br/><div class="children"><div class="content">Although note that several comments here report situations where truncation doesn&#x27;t work either.  21st century filesystem formats are a lot more complex than UFS, and with things like snapshotting and journalling there are new ways for a filesystem to deadlock itself.</div><br/></div></div><div id="39926228" class="c"><input type="checkbox" id="c-39926228" checked=""/><div class="controls bullet"><span class="by">jaimehrubiks</span><span>|</span><a href="#39926222">parent</a><span>|</span><a href="#39926312">prev</a><span>|</span><a href="#39926619">next</a><span>|</span><label class="collapse" for="c-39926228">[-]</label><label class="expand" for="c-39926228">[1 more]</label></div><br/><div class="children"><div class="content">Great to know</div><br/></div></div></div></div><div id="39926619" class="c"><input type="checkbox" id="c-39926619" checked=""/><div class="controls bullet"><span class="by">thenickdude</span><span>|</span><a href="#39926222">prev</a><span>|</span><a href="#39927816">next</a><span>|</span><label class="collapse" for="c-39926619">[-]</label><label class="expand" for="c-39926619">[3 more]</label></div><br/><div class="children"><div class="content">By contrast, ZFS has &quot;slop space&quot; to avoid this very problem (wedging the filesystem by running out of space during a large operation). By default it reserves 3.2% of your volume&#x27;s space for this, up to 128GB.<p>So by adjusting the Linux kernel tunable &quot;spa_slop_shift&quot; to shrink the slop space, you can regain up to 128GB of bonus space to successfully complete your file deletion operations:<p><a href="https:&#x2F;&#x2F;openzfs.github.io&#x2F;openzfs-docs&#x2F;Performance%20and%20Tuning&#x2F;Module%20Parameters.html#spa-slop-shift" rel="nofollow">https:&#x2F;&#x2F;openzfs.github.io&#x2F;openzfs-docs&#x2F;Performance%20and%20T...</a></div><br/><div id="39926959" class="c"><input type="checkbox" id="c-39926959" checked=""/><div class="controls bullet"><span class="by">nobody9999</span><span>|</span><a href="#39926619">parent</a><span>|</span><a href="#39927816">next</a><span>|</span><label class="collapse" for="c-39926959">[-]</label><label class="expand" for="c-39926959">[2 more]</label></div><br/><div class="children"><div class="content">&gt;By contrast, ZFS has &quot;slop space&quot; to avoid this very problem<p>As does ext4 (although they call the space &quot;reserved blocks&quot;).  &#x27;man tune2fs&#x27; for details.  As well as most other modern (and not so modern[0]) filesystems.<p>[0] As I recall, the same was true for SunOS&#x27;[1] UFS back in the 1980s.<p>[1] <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SunOS" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SunOS</a></div><br/><div id="39927251" class="c"><input type="checkbox" id="c-39927251" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#39926619">root</a><span>|</span><a href="#39926959">parent</a><span>|</span><a href="#39927816">next</a><span>|</span><label class="collapse" for="c-39927251">[-]</label><label class="expand" for="c-39927251">[1 more]</label></div><br/><div class="children"><div class="content">In ext[234]fs the reserved blocks is something else though: they are reserved to a specific user, by default root. So if normal users fill out the filesystem, the root user still has some space to write. Sort of a simple quota system.<p>I believe this problem in is only relevant to CoW filesystems. With ext[234]fs you can set the reserved blocks to 0, fill the fs, and always remove files to fix the situation.</div><br/></div></div></div></div></div></div><div id="39927816" class="c"><input type="checkbox" id="c-39927816" checked=""/><div class="controls bullet"><span class="by">TazeTSchnitzel</span><span>|</span><a href="#39926619">prev</a><span>|</span><a href="#39927898">next</a><span>|</span><label class="collapse" for="c-39927816">[-]</label><label class="expand" for="c-39927816">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve had a similar experience on my iPhone. The disk became so full that deleting things was seemingly no longer actually doing anything. Rebooting, the phone couldn&#x27;t be logged into. Rebooting again, it boot-looped. Rebooting once more, it booted into an inconsistent state where app icons still existed on the home screen, but the actual app was missing, so the icon was blank and the app could not be launched. I became concerned about data integrity and ultimately restored from a backup.<p>I am certain this was a result of APFS being copy-on-write and supporting snapshotting. If no change is immediately permanent, but instead old versions of files stay around in a snapshot, then if you don&#x27;t have enough space for more snapshot metadata you&#x27;re in trouble. Maybe they skip the snapshot in low disk space situations, but they still have the copy-on-write metadata problem.</div><br/></div></div><div id="39927898" class="c"><input type="checkbox" id="c-39927898" checked=""/><div class="controls bullet"><span class="by">protoman3000</span><span>|</span><a href="#39927816">prev</a><span>|</span><a href="#39925734">next</a><span>|</span><label class="collapse" for="c-39927898">[-]</label><label class="expand" for="c-39927898">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I found that Sonoma has broken...<p>All too familiar. I have two Macs. I upgraded one of them to Sonoma and ever since then it has been nothing but headache and disappointment. Starting from the upgrade having failed (meaning I had to completely wipe the disk and install Sonoma from scratch, luckily I still had data), to problems with Handoff, the firewall seems to not work, Excel very slow etc etc.<p>I don&#x27;t recommend using Sonoma.</div><br/></div></div><div id="39925734" class="c"><input type="checkbox" id="c-39925734" checked=""/><div class="controls bullet"><span class="by">voidwtf</span><span>|</span><a href="#39927898">prev</a><span>|</span><a href="#39927520">next</a><span>|</span><label class="collapse" for="c-39925734">[-]</label><label class="expand" for="c-39925734">[12 more]</label></div><br/><div class="children"><div class="content">It seems like Time Machine has been steadily declining. I&#x27;m not sure why there is no impetus to get it reliable and functioning well. Between sparse bundles becoming corrupt and having to start a new backup and failing functionality I haven&#x27;t felt like Time Machine is worth setting up anymore. This is in stark contrast to the iOS&#x2F;iPadOS backups which have worked every time.</div><br/><div id="39925869" class="c"><input type="checkbox" id="c-39925869" checked=""/><div class="controls bullet"><span class="by">ksec</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39926573">next</a><span>|</span><label class="collapse" for="c-39925869">[-]</label><label class="expand" for="c-39925869">[5 more]</label></div><br/><div class="children"><div class="content">&gt;It seems like Time Machine has been steadily declining.<p>Because they dont sell Time Capsule anymore. And they want you to backup everything to iCloud to grow their Services Revenue.</div><br/><div id="39926281" class="c"><input type="checkbox" id="c-39926281" checked=""/><div class="controls bullet"><span class="by">firecall</span><span>|</span><a href="#39925734">root</a><span>|</span><a href="#39925869">parent</a><span>|</span><a href="#39926158">next</a><span>|</span><label class="collapse" for="c-39926281">[-]</label><label class="expand" for="c-39926281">[2 more]</label></div><br/><div class="children"><div class="content">Totally.<p>But iCloud isn’t a backup.<p>Its sync.<p>And it will happily sync corrupt files and does not provide any versioning.<p>The best TimeMachine is an SSD connected locally to the Mac.<p>The second best is an SSD running on a Mac setup with TomeMachine Server.<p>Then you are lucky if backups continue to work. And even luckier if you can sensibly restore anything via the hellscape that is the interstellar wormhole travel interface! ;-)<p>BackBlaze is very reliable at least! 
Not cheap with a house full of computers to backup though :-&#x2F;</div><br/><div id="39927265" class="c"><input type="checkbox" id="c-39927265" checked=""/><div class="controls bullet"><span class="by">realusername</span><span>|</span><a href="#39925734">root</a><span>|</span><a href="#39926281">parent</a><span>|</span><a href="#39926158">next</a><span>|</span><label class="collapse" for="c-39927265">[-]</label><label class="expand" for="c-39927265">[1 more]</label></div><br/><div class="children"><div class="content">&gt; And it will happily sync corrupt files and does not provide any versioning.<p>It does not even provide a basic progress bar when used on the phone.</div><br/></div></div></div></div><div id="39926158" class="c"><input type="checkbox" id="c-39926158" checked=""/><div class="controls bullet"><span class="by">philistine</span><span>|</span><a href="#39925734">root</a><span>|</span><a href="#39925869">parent</a><span>|</span><a href="#39926281">prev</a><span>|</span><a href="#39926573">next</a><span>|</span><label class="collapse" for="c-39926158">[-]</label><label class="expand" for="c-39926158">[2 more]</label></div><br/><div class="children"><div class="content">Extrapolate it one more step: Apple is clearly working on an iCloud backup for Macs, cause then that&#x27;s more services revenue. While they&#x27;re doing that, why would they fix bugs in Time Machine. People can&#x27;t surely be using this old thing while we&#x27;re working on the spiffy new thing!</div><br/><div id="39926289" class="c"><input type="checkbox" id="c-39926289" checked=""/><div class="controls bullet"><span class="by">firecall</span><span>|</span><a href="#39925734">root</a><span>|</span><a href="#39926158">parent</a><span>|</span><a href="#39926573">next</a><span>|</span><label class="collapse" for="c-39926289">[-]</label><label class="expand" for="c-39926289">[1 more]</label></div><br/><div class="children"><div class="content">The problem though is that it is likely to be complete environment backup and restore, like iOS.<p>But we shall see!<p>Hopefully they will provide the ability to backup and restore file versions!</div><br/></div></div></div></div></div></div><div id="39926573" class="c"><input type="checkbox" id="c-39926573" checked=""/><div class="controls bullet"><span class="by">ryukoposting</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39925869">prev</a><span>|</span><a href="#39925784">next</a><span>|</span><label class="collapse" for="c-39926573">[-]</label><label class="expand" for="c-39926573">[2 more]</label></div><br/><div class="children"><div class="content">As a non-Mac user, this sounds like a catastrophic and inexcusable bug the likes of which would inspire a dogpile of hatred against desktop operating systems with penguin mascots and&#x2F;or headquarters in Washington.</div><br/><div id="39927836" class="c"><input type="checkbox" id="c-39927836" checked=""/><div class="controls bullet"><span class="by">folbec</span><span>|</span><a href="#39925734">root</a><span>|</span><a href="#39926573">parent</a><span>|</span><a href="#39925784">next</a><span>|</span><label class="collapse" for="c-39927836">[-]</label><label class="expand" for="c-39927836">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s the magic of genius marketing</div><br/></div></div></div></div><div id="39925784" class="c"><input type="checkbox" id="c-39925784" checked=""/><div class="controls bullet"><span class="by">wlesieutre</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39926573">prev</a><span>|</span><a href="#39927505">next</a><span>|</span><label class="collapse" for="c-39925784">[-]</label><label class="expand" for="c-39925784">[1 more]</label></div><br/><div class="children"><div class="content">I don’t know how many times I’ve had Time Machine decide it didn’t want to work anymore and I had to wipe the backups and start fresh to make it work again, but it’s a <i>much</i> larger number than it should be.</div><br/></div></div><div id="39927505" class="c"><input type="checkbox" id="c-39927505" checked=""/><div class="controls bullet"><span class="by">aequitas</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39925784">prev</a><span>|</span><a href="#39927362">next</a><span>|</span><label class="collapse" for="c-39927505">[-]</label><label class="expand" for="c-39927505">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t share this experience. I&#x27;ve been running Time Machine for years now on a Samba share for multiple Macs and if anything I&#x27;ve only seen an improvement. Years back I would regularly get a corrupted Time Machine sparse bundle that had to be recreated (or I would restore a previous ZFS snapshot and it would continue of off that), but it also ran over AFP back then I think, not SMB. Lately I&#x27;ve not have had any of these issues on any of the machines. I do have specific flags enabled in the smb.conf file that are recommended for Time Machine backups.</div><br/></div></div><div id="39927362" class="c"><input type="checkbox" id="c-39927362" checked=""/><div class="controls bullet"><span class="by">fmajid</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39927505">prev</a><span>|</span><a href="#39926696">next</a><span>|</span><label class="collapse" for="c-39927362">[-]</label><label class="expand" for="c-39927362">[1 more]</label></div><br/><div class="children"><div class="content">Mac OS quality control has been declining since they fired Scott Forstall, and it wasn’t amazing under his tenure to begin with.</div><br/></div></div><div id="39926696" class="c"><input type="checkbox" id="c-39926696" checked=""/><div class="controls bullet"><span class="by">steve1977</span><span>|</span><a href="#39925734">parent</a><span>|</span><a href="#39927362">prev</a><span>|</span><a href="#39927520">next</a><span>|</span><label class="collapse" for="c-39926696">[-]</label><label class="expand" for="c-39926696">[1 more]</label></div><br/><div class="children"><div class="content">The whole of desktop macOS has been steadily declining, so I‘m not surprised by this story in the slightest.<p>But hey, we get new emojis and moving desktop wallpapers…</div><br/></div></div></div></div><div id="39927520" class="c"><input type="checkbox" id="c-39927520" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#39925734">prev</a><span>|</span><a href="#39926797">next</a><span>|</span><label class="collapse" for="c-39927520">[-]</label><label class="expand" for="c-39927520">[1 more]</label></div><br/><div class="children"><div class="content">Reminds me of when a customer&#x27;s database kept crashing with an error code indicating the disk was full. Except Windows Explorer showed the disk having hundreds of gigs free...<p>Took us a little while to figure out that the problem was the database file was so fragmented NTFS couldn&#x27;t store more fragments for the file[1].<p>What had happened was they had been running the database in a VM with very low disk space for a long time, several times actually running out of space, before increasing the virtual disk and resizing the partition to match. Hence all the now-available disk space.<p>Just copying the main database file and deleting the old solved it.<p>[1]: <a href="https:&#x2F;&#x2F;superuser.com&#x2F;questions&#x2F;1315108&#x2F;ntfs-limitations-max-fragments-per-file" rel="nofollow">https:&#x2F;&#x2F;superuser.com&#x2F;questions&#x2F;1315108&#x2F;ntfs-limitations-max...</a></div><br/></div></div><div id="39926797" class="c"><input type="checkbox" id="c-39926797" checked=""/><div class="controls bullet"><span class="by">entropicgravity</span><span>|</span><a href="#39927520">prev</a><span>|</span><a href="#39926430">next</a><span>|</span><label class="collapse" for="c-39926797">[-]</label><label class="expand" for="c-39926797">[2 more]</label></div><br/><div class="children"><div class="content">I ran into a similar situation not long ago on the system partition of a linux installation.  The partition was too small to begin with and as new updates piled up there was almost no space left to start deleting stuff. It took me about half an hour to find a subdirectory with a tiny bit of stuff that could be deleted. It was like being in a room so plugged up with junk that you couldn&#x27;t open the (inward swinging) door to let yourself out.<p>From the tiny beginning I started being able to delete bigger and bigger spaces until finally it was clear and then of course I resized the partition so that wouldn&#x27;t happen again. The End.</div><br/><div id="39926842" class="c"><input type="checkbox" id="c-39926842" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#39926797">parent</a><span>|</span><a href="#39926430">next</a><span>|</span><label class="collapse" for="c-39926842">[-]</label><label class="expand" for="c-39926842">[1 more]</label></div><br/><div class="children"><div class="content">Confused, why didn&#x27;t you just expand the partition to begin with?<p>And I feel like that ought to be the lesson for power users: always leave a bit of slack space after your partition.</div><br/></div></div></div></div><div id="39926430" class="c"><input type="checkbox" id="c-39926430" checked=""/><div class="controls bullet"><span class="by">JdeBP</span><span>|</span><a href="#39926797">prev</a><span>|</span><a href="#39925820">next</a><span>|</span><label class="collapse" for="c-39926430">[-]</label><label class="expand" for="c-39926430">[1 more]</label></div><br/><div class="children"><div class="content">People find it a confusing idea to grasp that deleting things actually requires <i>more</i> space, either temporarily or permanently.  Other comments here have gone into the details of why some modern filesystems with snapshotting and journalling and so forth actually end up needing to allocate from free space in order to delete stuff.<p>In a different field: In the early decade of Wikipedia it often had to be explained to people that (at least from roughly 2004 onwards) deleting pages with the intention of saving space on the Wikipedia servers actually did the opposite, since deletion <i>added</i> records to the underlying database.<p>Related situations:<p>* In Rahul Dhesi&#x27;s ZOO archive file format, deleting an archive entry just sets a flag on the entry&#x27;s header record.  ZOO also did VMS-like file versioning, where adding a new version of a file to an archive did not overwrite the old one.<p>* Back in the days of MS&#x2F;DR&#x2F;PC-DOS and FAT, with (sometimes) add-on undeletion utilities installed, deleting a file would need more space to store a new entry into the database that held the restore information for the undeletion utility.<p>* Back in the days of MS&#x2F;DR&#x2F;PC-DOS and FAT, some of the old disc compression utilities compressed metadata as well, leading to (rare but possible) situations where metadata changes could affect compressibility and actually increase the (from the outside point of view) volume size.<p>&quot;I delete XYZ in order to free space.&quot; is a pervasive concept, but it isn&#x27;t strictly a correct one.</div><br/></div></div><div id="39925820" class="c"><input type="checkbox" id="c-39925820" checked=""/><div class="controls bullet"><span class="by">jen729w</span><span>|</span><a href="#39926430">prev</a><span>|</span><a href="#39926191">next</a><span>|</span><label class="collapse" for="c-39925820">[-]</label><label class="expand" for="c-39925820">[4 more]</label></div><br/><div class="children"><div class="content">I had this issue in October 2018 as documented in this Stack Overflow question, whose text I’ll paste below.<p>I was lucky: I had an additional APFS partition that I could remove, thus freeing up disk space. Took me a while to figure out, during which time I was in a proper panic.<p>---<p><a href="https:&#x2F;&#x2F;apple.stackexchange.com&#x2F;questions&#x2F;338721&#x2F;disk-full-terminal-in-recovery-mode-won-t-delete-files-boot-kernel-panics" rel="nofollow">https:&#x2F;&#x2F;apple.stackexchange.com&#x2F;questions&#x2F;338721&#x2F;disk-full-t...</a><p>I’m in a pickle here. macOS Mojave, just updated the other day. I managed to fill my disk up while creating a .dmg, and the system froze. I rebooted. Kernel panic.<p>Boot to Recovery mode. Mount the disk. Open Terminal.<p>–bash–3.2# rm &#x2F;path&#x2F;to&#x2F;large&#x2F;file<p>rm: &#x2F;path&#x2F;to&#x2F;large&#x2F;file: No space left on device<p>Essentially the same issue as this Unix thread from ‘08! <a href="https:&#x2F;&#x2F;www.unix.com&#x2F;linux&#x2F;69889-unable-remove-file-using-rm-disk-space-full.html" rel="nofollow">https:&#x2F;&#x2F;www.unix.com&#x2F;linux&#x2F;69889-unable-remove-file-using-rm...</a><p>I’ve tried echo x &gt; &#x2F;path&#x2F;to&#x2F;large&#x2F;file, no good.<p>It’s borked. Does anyone have any suggestions that aren’t “wipe the drive and restore from your backup”?</div><br/><div id="39926066" class="c"><input type="checkbox" id="c-39926066" checked=""/><div class="controls bullet"><span class="by">bombcar</span><span>|</span><a href="#39925820">parent</a><span>|</span><a href="#39926793">next</a><span>|</span><label class="collapse" for="c-39926066">[-]</label><label class="expand" for="c-39926066">[2 more]</label></div><br/><div class="children"><div class="content">Sounds like creating a sliver of an extra partition of a gig or so might be valuable insurance.<p>Kind of like the old Unix file systems that would reserve 5% for root.</div><br/><div id="39927843" class="c"><input type="checkbox" id="c-39927843" checked=""/><div class="controls bullet"><span class="by">pixelfarmer</span><span>|</span><a href="#39925820">root</a><span>|</span><a href="#39926066">parent</a><span>|</span><a href="#39926793">next</a><span>|</span><label class="collapse" for="c-39927843">[-]</label><label class="expand" for="c-39927843">[1 more]</label></div><br/><div class="children"><div class="content">Since the SSD days (I started like 15 years ago with that) I keep a bit of space empty for two reasons: Emergency situations where you may need some extra space and to give SSDs a bit more room to relocate blocks to (they have a certain amount internally reserved already).</div><br/></div></div></div></div><div id="39926793" class="c"><input type="checkbox" id="c-39926793" checked=""/><div class="controls bullet"><span class="by">bouke</span><span>|</span><a href="#39925820">parent</a><span>|</span><a href="#39926066">prev</a><span>|</span><a href="#39926191">next</a><span>|</span><label class="collapse" for="c-39926793">[-]</label><label class="expand" for="c-39926793">[1 more]</label></div><br/><div class="children"><div class="content">With APFS this is not as straightforward though, as containers are only allocated when written too.</div><br/></div></div></div></div><div id="39926191" class="c"><input type="checkbox" id="c-39926191" checked=""/><div class="controls bullet"><span class="by">desro</span><span>|</span><a href="#39925820">prev</a><span>|</span><a href="#39927381">next</a><span>|</span><label class="collapse" for="c-39926191">[-]</label><label class="expand" for="c-39926191">[4 more]</label></div><br/><div class="children"><div class="content">Impressive. I&#x27;ve never dealt with a situation where even `rm` failed, but I have had the displeasure of using and managing modern Macs with 256 GB (or less) of internal storage. I like to keep a &quot;spaceholder&quot; file of around 16GB so when things inevitably fill up and prevent an update or something else, I can nuke the placeholder without having to surgically prune things with `ncdu`</div><br/><div id="39926782" class="c"><input type="checkbox" id="c-39926782" checked=""/><div class="controls bullet"><span class="by">timenova</span><span>|</span><a href="#39926191">parent</a><span>|</span><a href="#39926321">next</a><span>|</span><label class="collapse" for="c-39926782">[-]</label><label class="expand" for="c-39926782">[1 more]</label></div><br/><div class="children"><div class="content">I noticed CockroachDB does the same thing too, on node startup [0].<p>[0] <a href="https:&#x2F;&#x2F;www.cockroachlabs.com&#x2F;docs&#x2F;v23.2&#x2F;cluster-setup-troubleshooting#automatic-ballast-files" rel="nofollow">https:&#x2F;&#x2F;www.cockroachlabs.com&#x2F;docs&#x2F;v23.2&#x2F;cluster-setup-troub...</a></div><br/></div></div><div id="39926321" class="c"><input type="checkbox" id="c-39926321" checked=""/><div class="controls bullet"><span class="by">LeifCarrotson</span><span>|</span><a href="#39926191">parent</a><span>|</span><a href="#39926782">prev</a><span>|</span><a href="#39927381">next</a><span>|</span><label class="collapse" for="c-39926321">[-]</label><label class="expand" for="c-39926321">[2 more]</label></div><br/><div class="children"><div class="content">I find that one of the main benefits of a space holding file is that when it&#x27;s needed, freeing up that space  provides a window of time where you can implement a long-term solution (like buying a new drive with quadruple the storage space of the original for the cost of an hour of that employee&#x2F;machine&#x27;s time).</div><br/><div id="39926391" class="c"><input type="checkbox" id="c-39926391" checked=""/><div class="controls bullet"><span class="by">derekp7</span><span>|</span><a href="#39926191">root</a><span>|</span><a href="#39926321">parent</a><span>|</span><a href="#39927381">next</a><span>|</span><label class="collapse" for="c-39926391">[-]</label><label class="expand" for="c-39926391">[1 more]</label></div><br/><div class="children"><div class="content">Had an ex Navy Submariner for a manager many years ago.  On some problem systems, he created several such files.  He called them ballast files.</div><br/></div></div></div></div></div></div><div id="39927381" class="c"><input type="checkbox" id="c-39927381" checked=""/><div class="controls bullet"><span class="by">albertzeyer</span><span>|</span><a href="#39926191">prev</a><span>|</span><a href="#39926239">next</a><span>|</span><label class="collapse" for="c-39927381">[-]</label><label class="expand" for="c-39927381">[1 more]</label></div><br/><div class="children"><div class="content">When `rm file` gives you &quot;No space left on device&quot;, a trick you can do:<p><pre><code>    echo &gt; file  # delete content of file first
    rm file  # now it should work</code></pre></div><br/></div></div><div id="39926239" class="c"><input type="checkbox" id="c-39926239" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#39927381">prev</a><span>|</span><a href="#39925979">next</a><span>|</span><label class="collapse" for="c-39926239">[-]</label><label class="expand" for="c-39926239">[2 more]</label></div><br/><div class="children"><div class="content">If you can truncate() an existing file (via &#x27;echo &gt; big_file.img&#x27; or similar), I would hope the filesystem could deallocate the relevant extents without requiring more space. Seems a bit like a filesystem defect not to reserve enough space to recover from this condition with unlink().</div><br/><div id="39926749" class="c"><input type="checkbox" id="c-39926749" checked=""/><div class="controls bullet"><span class="by">anticensor</span><span>|</span><a href="#39926239">parent</a><span>|</span><a href="#39925979">next</a><span>|</span><label class="collapse" for="c-39926749">[-]</label><label class="expand" for="c-39926749">[1 more]</label></div><br/><div class="children"><div class="content">you need delete_and_dealloc(), not unlink()</div><br/></div></div></div></div><div id="39925979" class="c"><input type="checkbox" id="c-39925979" checked=""/><div class="controls bullet"><span class="by">whartung</span><span>|</span><a href="#39926239">prev</a><span>|</span><a href="#39927174">next</a><span>|</span><label class="collapse" for="c-39925979">[-]</label><label class="expand" for="c-39925979">[4 more]</label></div><br/><div class="children"><div class="content">I had this happen to me, though I can’t recall how I fixed it.<p>In general I’ve had good success with Time Machine. I, too, have lost TM volumes. I just erased them and started again. Annoying to be sure but 99.99% of the time don’t need a years worth of backups.<p>The author mentioned copying the Time Machine drive. I have never been able to successfully do that. Last time I tried I quit after 3 days. As I understand it, only Finder can copy a Time Machine drive. Terrible experience.<p>That said, I’d rather cope with TM. It’s saved me more than it’s hurt me, and even an idiot like me can get it to work.<p>I did have my machine just complain about one of my partitions being irreparable, but it mounted read only so I was able to copy it, and am currently copying it back.<p>I don’t know if this is random bit rot, or if something is going wrong with the drive. That would be Bad, it’s a 3TB spinning drive. Backed up with BackBlaze (knock on wood), but I’d rather not have to go through the recovery process if I could avoid it.<p>Problem is I don’t know how to prevent it. It’s been suggested that SSDs are potentially less susceptible to bit rot, so maybe switching to one of those is a wise plan. But I don’t know.</div><br/><div id="39926271" class="c"><input type="checkbox" id="c-39926271" checked=""/><div class="controls bullet"><span class="by">skhr0680</span><span>|</span><a href="#39925979">parent</a><span>|</span><a href="#39926410">next</a><span>|</span><label class="collapse" for="c-39926271">[-]</label><label class="expand" for="c-39926271">[1 more]</label></div><br/><div class="children"><div class="content">&gt; The author mentioned copying the Time Machine drive. I have never been able to successfully do that. Last time I tried I quit after 3 days. As I understand it, only Finder can copy a Time Machine drive. Terrible experience.<p>rsync -av $SOURCE $DEST has never let me down. Copy or delete on Time Machine files using Finder never worked for me.<p>&gt; Problem is I don’t know how to prevent it. It’s been suggested that SSDs are potentially less susceptible to bit rot, so maybe switching to one of those is a wise plan. But I don’t know.<p>OpenZFS with two drives should protect you from bit rot. ZFS <i>almost</i> became the Mac file system in Snow Leopard.</div><br/></div></div><div id="39926410" class="c"><input type="checkbox" id="c-39926410" checked=""/><div class="controls bullet"><span class="by">pronoiac</span><span>|</span><a href="#39925979">parent</a><span>|</span><a href="#39926271">prev</a><span>|</span><a href="#39927174">next</a><span>|</span><label class="collapse" for="c-39926410">[-]</label><label class="expand" for="c-39926410">[2 more]</label></div><br/><div class="children"><div class="content">I have notes somewhere on roundtripping Time Machine backups between USB drives and network shares. (It&#x27;s non-trivial, and it&#x27;s not <i>supported,</i> but it worked.) It was with HFS+ backups, and there were various bits that were &quot;Here Be Dragons&quot;, so I never posted them.</div><br/><div id="39926679" class="c"><input type="checkbox" id="c-39926679" checked=""/><div class="controls bullet"><span class="by">desro</span><span>|</span><a href="#39925979">root</a><span>|</span><a href="#39926410">parent</a><span>|</span><a href="#39927174">next</a><span>|</span><label class="collapse" for="c-39926679">[-]</label><label class="expand" for="c-39926679">[1 more]</label></div><br/><div class="children"><div class="content">would be interested in a write-up of this if you ever get a chance</div><br/></div></div></div></div></div></div><div id="39927174" class="c"><input type="checkbox" id="c-39927174" checked=""/><div class="controls bullet"><span class="by">_wire_</span><span>|</span><a href="#39925979">prev</a><span>|</span><a href="#39927185">next</a><span>|</span><label class="collapse" for="c-39927174">[-]</label><label class="expand" for="c-39927174">[1 more]</label></div><br/><div class="children"><div class="content">Ran into precisely this problem with a friend&#x27;s Ventura Mini last year.<p>The solution was to boot into recovery and mount the Data partition using Disk Utility.<p>I don&#x27;t recall where the Data partition gets mounted but I think it is:<p>&quot;&#x2F;System&#x2F;Volumes&#x2F;Macintosh HD - Data&quot;<p>Or just Data, since Sonoma. It will be clear from Disk Utility.<p>Then close Disk Utility and go into Terminal and run rm on a big unseeded file.<p>You can find one using:<p>find &lt;data-mnt&gt; -size +100m<p>Using rm will fail.<p>Unmount the Data partition and run fsck on it.<p>This completes the deletion.<p>From there enough more space can be freed in recovery to have a healthy buffer, then reboot normally and finish cleaning.<p>It seems that when the volume gets so full that rm doesn&#x27;t work anymore the filesystem also gets corrupted.<p>HTH and that I didn&#x27;t forget anything.</div><br/></div></div><div id="39927185" class="c"><input type="checkbox" id="c-39927185" checked=""/><div class="controls bullet"><span class="by">delta_p_delta_x</span><span>|</span><a href="#39927174">prev</a><span>|</span><a href="#39925892">next</a><span>|</span><label class="collapse" for="c-39927185">[-]</label><label class="expand" for="c-39927185">[1 more]</label></div><br/><div class="children"><div class="content">Huh, something like this happened to my mother&#x27;s iPhone, too. She kept taking photos until the storage was filled to the brim.<p>One day she had discharged the battery completely, shutting down the phone; after recharging, she tried to restart it, only to be sent into a boot-loop. There is no (official) way to resolve this except repeatedly reboot and hope that at least once, Springboard loads and you can immediately jump into Photos and start mass-deleting, or at least connect to a computer and transfer the media out of the phone.</div><br/></div></div><div id="39925892" class="c"><input type="checkbox" id="c-39925892" checked=""/><div class="controls bullet"><span class="by">armchairhacker</span><span>|</span><a href="#39927185">prev</a><span>|</span><a href="#39926569">next</a><span>|</span><label class="collapse" for="c-39925892">[-]</label><label class="expand" for="c-39925892">[3 more]</label></div><br/><div class="children"><div class="content">btrfs used to have this issue, the problem being that the filesystem has to append metadata to do any operation including (ironically) deletion: <a href="https:&#x2F;&#x2F;serverfault.com&#x2F;a&#x2F;478742" rel="nofollow">https:&#x2F;&#x2F;serverfault.com&#x2F;a&#x2F;478742</a>.<p>AFAIK it&#x27;s fixed now, because btrfs reserves some space and reports &quot;disk full&quot; before it&#x27;s reached. macOS probably does the same (I&#x27;d hope), but it seems in this case the boundary wasn&#x27;t enforced properly and the background snapshot caused it to write beyond.</div><br/><div id="39925987" class="c"><input type="checkbox" id="c-39925987" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39925892">parent</a><span>|</span><a href="#39926569">next</a><span>|</span><label class="collapse" for="c-39925987">[-]</label><label class="expand" for="c-39925987">[2 more]</label></div><br/><div class="children"><div class="content">It looks like ZFS also suffers(ed?) the same problem:<p><a href="https:&#x2F;&#x2F;zfs-discuss.opensolaris.narkive.com&#x2F;BQ7RMcjo&#x2F;cannot-delete-file-when-fs-100-full" rel="nofollow">https:&#x2F;&#x2F;zfs-discuss.opensolaris.narkive.com&#x2F;BQ7RMcjo&#x2F;cannot-...</a></div><br/><div id="39926224" class="c"><input type="checkbox" id="c-39926224" checked=""/><div class="controls bullet"><span class="by">jclulow</span><span>|</span><a href="#39925892">root</a><span>|</span><a href="#39925987">parent</a><span>|</span><a href="#39926569">next</a><span>|</span><label class="collapse" for="c-39926224">[-]</label><label class="expand" for="c-39926224">[1 more]</label></div><br/><div class="children"><div class="content">Yes, ZFS has the same fundamental issue that all COW file systems have here.  We have a reserved pool of space that you can&#x27;t use except for operations like removing stuff.<p>The new problem with that reserved pool mechanism is that in 2024 it&#x27;s probably way too big, because it&#x27;s essentially a small but fixed percentage of the storage size.  Don&#x27;t let people use thresholds of total size without some kind of absolute cap!</div><br/></div></div></div></div></div></div><div id="39926569" class="c"><input type="checkbox" id="c-39926569" checked=""/><div class="controls bullet"><span class="by">saurik</span><span>|</span><a href="#39925892">prev</a><span>|</span><a href="#39927298">next</a><span>|</span><label class="collapse" for="c-39926569">[-]</label><label class="expand" for="c-39926569">[1 more]</label></div><br/><div class="children"><div class="content">I know someone who ran out of disk space on her iPhone and then tried to fix some issues she didn&#x27;t realize were being caused by it by upgrading the device to a new version of iOS; but then it failed the upgrade as it couldn&#x27;t resize the disk but had already committed to doing such (I later laboriously figured this out by debugging the process using idevicerestore). I feel like this was a bug in its &quot;how much space will I need to have to install successfully, let&#x27;s verify I have enough before I begin&quot; calculation, and maybe later versions of iOS have fixed the issue, but sadly they are all even larger and the fixed version would just prevent it from trying to upgrade in the first place, not fix it once it got to this point.</div><br/></div></div><div id="39927298" class="c"><input type="checkbox" id="c-39927298" checked=""/><div class="controls bullet"><span class="by">RamRodification</span><span>|</span><a href="#39926569">prev</a><span>|</span><a href="#39927311">next</a><span>|</span><label class="collapse" for="c-39927298">[-]</label><label class="expand" for="c-39927298">[1 more]</label></div><br/><div class="children"><div class="content"><i>&gt; ... Samba (the disk-sharing protocol), ...</i><p>Pet peeve (or alternatively: correct me if I&#x27;m wrong), Samba is not a protocol. It&#x27;s a software suite that implements the SMB (Server Message Block) protocol</div><br/></div></div><div id="39927311" class="c"><input type="checkbox" id="c-39927311" checked=""/><div class="controls bullet"><span class="by">JackYoustra</span><span>|</span><a href="#39927298">prev</a><span>|</span><a href="#39926489">next</a><span>|</span><label class="collapse" for="c-39927311">[-]</label><label class="expand" for="c-39927311">[1 more]</label></div><br/><div class="children"><div class="content">This happened to me! My solution was to go to an apple store, buy one of their portable SSDs right there, cp everything on to the SSD (that didn&#x27;t appear to use any additional space!), wipe the mac, and then rm some unneeded stuff on the ssd before cp-ing back and using their no-fee return to return the SSD. There were a few esoteric issues, but for the most part it worked.</div><br/></div></div><div id="39926489" class="c"><input type="checkbox" id="c-39926489" checked=""/><div class="controls bullet"><span class="by">qiqitori</span><span>|</span><a href="#39927311">prev</a><span>|</span><a href="#39925773">next</a><span>|</span><label class="collapse" for="c-39926489">[-]</label><label class="expand" for="c-39926489">[6 more]</label></div><br/><div class="children"><div class="content">Maybe flamebait, but here is my honest opinion, which I believe is aligned with the hacker ethos: maybe if you were using an open-source operating system you could, with a little experience, write a simple tool that deletes a couple files without allocating new metadata. (Or more likely, somebody else would have been there before you and you could just use their tool.)</div><br/><div id="39927503" class="c"><input type="checkbox" id="c-39927503" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#39926489">parent</a><span>|</span><a href="#39927124">next</a><span>|</span><label class="collapse" for="c-39927503">[-]</label><label class="expand" for="c-39927503">[1 more]</label></div><br/><div class="children"><div class="content">&gt; maybe if you were using an open-source operating system you could, with a little experience, write a simple tool that deletes a couple files without allocating new metadata<p>For a filesystem where this happens, it would not be simple and it would require a lot of experience to get right.<p>&gt; Or more likely, somebody else would have been there before you and you could just use their tool.<p>I don&#x27;t think open-source makes such a tool much more likely to exist.</div><br/></div></div><div id="39927124" class="c"><input type="checkbox" id="c-39927124" checked=""/><div class="controls bullet"><span class="by">Kwpolska</span><span>|</span><a href="#39926489">parent</a><span>|</span><a href="#39927503">prev</a><span>|</span><a href="#39926957">next</a><span>|</span><label class="collapse" for="c-39927124">[-]</label><label class="expand" for="c-39927124">[2 more]</label></div><br/><div class="children"><div class="content">Most users on open-source operating systems can&#x27;t code as well. And even if they could, this still requires knowledge or guesswork to find the trick for the deletion. Some people suggest truncation, and that&#x27;s possible with a shell, but what would you do if it failed as well?</div><br/><div id="39927459" class="c"><input type="checkbox" id="c-39927459" checked=""/><div class="controls bullet"><span class="by">qiqitori</span><span>|</span><a href="#39926489">root</a><span>|</span><a href="#39927124">parent</a><span>|</span><a href="#39926957">next</a><span>|</span><label class="collapse" for="c-39927459">[-]</label><label class="expand" for="c-39927459">[1 more]</label></div><br/><div class="children"><div class="content">I have an answer, but I&#x27;m not sure you&#x27;ll find it particularly fulfilling because it is quite hypothetical.<p>The average user just needs to be able to ask the question in a decent place. E.g., Hacker News or a fitting Stack Exchange site. Some developers not afraid of touching the kernel will see the question (or one like it), and if no workaround (e.g. truncation) is found to be acceptable, someone may decide to look into the kernel source to see if it&#x27;s feasible at all. They may find a lower level function that deletes without writing metadata. Or they may find the function in the filesystem driver&#x27;s source code where the metadata is written first, and if that was successful, the actual data is written. In the easiest case, you could create a copy of the function with the calls swapped, and a live CD with the modified driver could be created. (Course, this solution is quite unsafe, as writing the metadata could still fail for some other or related reason, so it&#x27;s a bit of an emergency solution.)<p>There are two other filesystems that were mentioned in the discussion here, btrfs and ZFS.<p>ZFS solved the problem by reserving space, so creating such a tool isn&#x27;t needed. (However, ZFS is not part of Linux, so I&#x27;m not too interested in digging into the details.)<p>btrfs users apparently accept this as a fact-of-life, but have what they consider decent-enough workarounds, see e.g. <a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;btrfs&#x2F;comments&#x2F;ibjrpm&#x2F;can_i_somehow_reserve_space_to_prevent_the_btrfs&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;btrfs&#x2F;comments&#x2F;ibjrpm&#x2F;can_i_somehow...</a>.<p>(I use neither ZFS nor btrfs; I prefer boring filesystems, thank you very much.)</div><br/></div></div></div></div><div id="39926957" class="c"><input type="checkbox" id="c-39926957" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#39926489">parent</a><span>|</span><a href="#39927124">prev</a><span>|</span><a href="#39925773">next</a><span>|</span><label class="collapse" for="c-39926957">[-]</label><label class="expand" for="c-39926957">[2 more]</label></div><br/><div class="children"><div class="content">Does such a tool exist for BTRFS or ZFS?</div><br/><div id="39927845" class="c"><input type="checkbox" id="c-39927845" checked=""/><div class="controls bullet"><span class="by">bjoli</span><span>|</span><a href="#39926489">root</a><span>|</span><a href="#39926957">parent</a><span>|</span><a href="#39925773">next</a><span>|</span><label class="collapse" for="c-39927845">[-]</label><label class="expand" for="c-39927845">[1 more]</label></div><br/><div class="children"><div class="content">I was in this situation with BTRFS, but it was simple to extend the partition with an old 2gb usb stick and the problem resolved itself.</div><br/></div></div></div></div></div></div><div id="39925773" class="c"><input type="checkbox" id="c-39925773" checked=""/><div class="controls bullet"><span class="by">dannyw</span><span>|</span><a href="#39926489">prev</a><span>|</span><a href="#39926072">next</a><span>|</span><label class="collapse" for="c-39925773">[-]</label><label class="expand" for="c-39925773">[1 more]</label></div><br/><div class="children"><div class="content">This happened to me too, without Time Machine. It’s devastating how rm on macOS can’t remove files when the disk is full.</div><br/></div></div><div id="39926072" class="c"><input type="checkbox" id="c-39926072" checked=""/><div class="controls bullet"><span class="by">caseyy</span><span>|</span><a href="#39925773">prev</a><span>|</span><a href="#39926200">next</a><span>|</span><label class="collapse" for="c-39926072">[-]</label><label class="expand" for="c-39926072">[7 more]</label></div><br/><div class="children"><div class="content">Windows with NTFS will also break in mysterious ways when the system disk is full.<p>There was a time when OSs could deal with the system disk being full quite well. And not so long ago.</div><br/><div id="39926123" class="c"><input type="checkbox" id="c-39926123" checked=""/><div class="controls bullet"><span class="by">tredre3</span><span>|</span><a href="#39926072">parent</a><span>|</span><a href="#39926200">next</a><span>|</span><label class="collapse" for="c-39926123">[-]</label><label class="expand" for="c-39926123">[6 more]</label></div><br/><div class="children"><div class="content">I regularly run my Windows 10 NTFS drive down to 0 bytes free.<p>I&#x27;m always amazed at how the file system survives just fine, but the machine doesn&#x27;t even crash!<p>I&#x27;m not sure where you got your experience from.</div><br/><div id="39926359" class="c"><input type="checkbox" id="c-39926359" checked=""/><div class="controls bullet"><span class="by">caseyy</span><span>|</span><a href="#39926072">root</a><span>|</span><a href="#39926123">parent</a><span>|</span><a href="#39926388">next</a><span>|</span><label class="collapse" for="c-39926359">[-]</label><label class="expand" for="c-39926359">[3 more]</label></div><br/><div class="children"><div class="content">My work demands that I generate large amounts of data and I don’t know how much I’ll have to generate up-front. So I run out of disk space a lot.<p>My experience is that Windows and many of its programs will become very unstable with 0 b on the system drive. And about 3 times out of maybe 50, the system also became unbootable. I’ve learned to do whatever I can to free up space before restarting for stability.<p>The last time I’d regularly run out of space on Win was around Windows 98 times. I never had a problem then. Now in Windows 11 times, it’s a real headache.<p>Not sure how you’re so lucky.</div><br/><div id="39927143" class="c"><input type="checkbox" id="c-39927143" checked=""/><div class="controls bullet"><span class="by">Kwpolska</span><span>|</span><a href="#39926072">root</a><span>|</span><a href="#39926359">parent</a><span>|</span><a href="#39927554">next</a><span>|</span><label class="collapse" for="c-39927143">[-]</label><label class="expand" for="c-39927143">[1 more]</label></div><br/><div class="children"><div class="content">I manage to get to 0 or close to that sometimes, usually through uncontorlles pagefile expansion. Some apps may misbehave, but explorer is stable enough to let me delete something.</div><br/></div></div><div id="39927554" class="c"><input type="checkbox" id="c-39927554" checked=""/><div class="controls bullet"><span class="by">juitpykyk</span><span>|</span><a href="#39926072">root</a><span>|</span><a href="#39926359">parent</a><span>|</span><a href="#39927143">prev</a><span>|</span><a href="#39926388">next</a><span>|</span><label class="collapse" for="c-39927554">[-]</label><label class="expand" for="c-39927554">[1 more]</label></div><br/><div class="children"><div class="content">Maybe you should use a secondary partition for work</div><br/></div></div></div></div><div id="39926388" class="c"><input type="checkbox" id="c-39926388" checked=""/><div class="controls bullet"><span class="by">comex</span><span>|</span><a href="#39926072">root</a><span>|</span><a href="#39926123">parent</a><span>|</span><a href="#39926359">prev</a><span>|</span><a href="#39926338">next</a><span>|</span><label class="collapse" for="c-39926388">[-]</label><label class="expand" for="c-39926388">[1 more]</label></div><br/><div class="children"><div class="content">I’ve done the same on my Mac perhaps twice in the last few years.  Like you, I encountered no crash or any other obvious consequences… I just deleted data and moved on.  Though I didn’t try leaving it with zero bytes free for an extended amount of time, or rebooting.  Who knows what would happen then.<p>Still, whatever this APFS bug is, the conditions to trigger it are more specific than just filling up the disk.</div><br/></div></div><div id="39926338" class="c"><input type="checkbox" id="c-39926338" checked=""/><div class="controls bullet"><span class="by">bloomingeek</span><span>|</span><a href="#39926072">root</a><span>|</span><a href="#39926123">parent</a><span>|</span><a href="#39926388">prev</a><span>|</span><a href="#39926200">next</a><span>|</span><label class="collapse" for="c-39926338">[-]</label><label class="expand" for="c-39926338">[1 more]</label></div><br/><div class="children"><div class="content">I tried, accidentally, to over fill the HDD on a Windows Vista machine. Vista popped up a box telling me I couldn&#x27;t do it. Unfortunately, in my panic, I didn&#x27;t take a picture of the warning for posterity.</div><br/></div></div></div></div></div></div><div id="39926200" class="c"><input type="checkbox" id="c-39926200" checked=""/><div class="controls bullet"><span class="by">mproud</span><span>|</span><a href="#39926072">prev</a><span>|</span><a href="#39927086">next</a><span>|</span><label class="collapse" for="c-39926200">[-]</label><label class="expand" for="c-39926200">[2 more]</label></div><br/><div class="children"><div class="content">Safe Boot is your magical way to have the computer delete purgeable and temporary files, like boot caches. Hold shift down and once it gets to the login window, restart again.<p>Otherwise, go to Recovery mode, mount the disk in Disk Utility, and then open Terminal and rm some shit.</div><br/><div id="39926389" class="c"><input type="checkbox" id="c-39926389" checked=""/><div class="controls bullet"><span class="by">klausa</span><span>|</span><a href="#39926200">parent</a><span>|</span><a href="#39927086">next</a><span>|</span><label class="collapse" for="c-39926389">[-]</label><label class="expand" for="c-39926389">[1 more]</label></div><br/><div class="children"><div class="content">The author mentions trying this in recoveryOS to no success.</div><br/></div></div></div></div><div id="39925818" class="c"><input type="checkbox" id="c-39925818" checked=""/><div class="controls bullet"><span class="by">bingo-bongo</span><span>|</span><a href="#39927086">prev</a><span>|</span><a href="#39926322">next</a><span>|</span><label class="collapse" for="c-39925818">[-]</label><label class="expand" for="c-39925818">[1 more]</label></div><br/><div class="children"><div class="content">Probably needed to delete some of the mentioned disk snapshots, before trying to delete files.<p><a href="https:&#x2F;&#x2F;support.apple.com&#x2F;en-gb&#x2F;guide&#x2F;disk-utility&#x2F;dskuf82354dc&#x2F;mac" rel="nofollow">https:&#x2F;&#x2F;support.apple.com&#x2F;en-gb&#x2F;guide&#x2F;disk-utility&#x2F;dskuf8235...</a></div><br/></div></div><div id="39926322" class="c"><input type="checkbox" id="c-39926322" checked=""/><div class="controls bullet"><span class="by">quechimba</span><span>|</span><a href="#39925818">prev</a><span>|</span><a href="#39926819">next</a><span>|</span><label class="collapse" for="c-39926322">[-]</label><label class="expand" for="c-39926322">[1 more]</label></div><br/><div class="children"><div class="content">I had an external hard drive that I overfilled by accident while making a manual backup of media files, and after that I couldn&#x27;t even mount the APFS volume. Apparently it&#x27;s something that can happen.<p>In the end I was able to mount and rescue the data using <a href="https:&#x2F;&#x2F;github.com&#x2F;libyal&#x2F;libfsapfs">https:&#x2F;&#x2F;github.com&#x2F;libyal&#x2F;libfsapfs</a><p>I followed this guide: <a href="https:&#x2F;&#x2F;matt.sh&#x2F;apfs-object-map-free-recovery" rel="nofollow">https:&#x2F;&#x2F;matt.sh&#x2F;apfs-object-map-free-recovery</a></div><br/></div></div><div id="39926819" class="c"><input type="checkbox" id="c-39926819" checked=""/><div class="controls bullet"><span class="by">jaredhallen</span><span>|</span><a href="#39926322">prev</a><span>|</span><a href="#39926160">next</a><span>|</span><label class="collapse" for="c-39926819">[-]</label><label class="expand" for="c-39926819">[1 more]</label></div><br/><div class="children"><div class="content">Depending on how dedicated one was, it might work to dd the full contents of the affected disk to a larger one. Then expand the partition, expand the filesystem, and assuming everything is hunky dory, free up some space and reverse all those steps.</div><br/></div></div><div id="39926160" class="c"><input type="checkbox" id="c-39926160" checked=""/><div class="controls bullet"><span class="by">1970-01-01</span><span>|</span><a href="#39926819">prev</a><span>|</span><label class="collapse" for="c-39926160">[-]</label><label class="expand" for="c-39926160">[1 more]</label></div><br/><div class="children"><div class="content">A viable solution would be to clone all data onto a bigger drive, then delete some files, wipe the disk, and finally copy everything back.</div><br/></div></div></div></div></div></div></div></body></html>