<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716714051253" as="style"/><link rel="stylesheet" href="styles.css?v=1716714051253"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://arunmani.in/articles/highest-two-power-to-divide-a-number/">Why is x &amp; -x equal to the largest power of 2 that divides x?</a> <span class="domain">(<a href="https://arunmani.in">arunmani.in</a>)</span></div><div class="subtext"><span>arun-mani-j</span> | <span>29 comments</span></div><br/><div><div id="40478558" class="c"><input type="checkbox" id="c-40478558" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#40480207">next</a><span>|</span><label class="collapse" for="c-40478558">[-]</label><label class="expand" for="c-40478558">[15 more]</label></div><br/><div class="children"><div class="content">Short explanation:<p>1. The largest power of 2 that divides x is just 2^(number of trailing zeros in x)<p>2. Crucial observation: -x == ~x + 1<p>3. ~x flips all the bits of x bits, so none of the bits of ~x match those of x. (i.e. (x &amp; ~x) == 0)<p>4. When you do +1, all the trailing 1&#x27;s flip AGAIN, becoming zero like they were in x. The next highest 0 (say it was the n&#x27;th) also flips, becoming 1... like it was in x.<p>5. Crucial observation: The n&#x27;th 0 did NOT match the corresponding bit in x prior to the increment, therefore it MUST match after the increment. All higher bits stay as-is.<p>6. This leaves only the n&#x27;th bits matching in x and ~x + 1, isolating the highest power-of-2 divisor of x when you AND them.</div><br/><div id="40479625" class="c"><input type="checkbox" id="c-40479625" checked=""/><div class="controls bullet"><span class="by">pbsd</span><span>|</span><a href="#40478558">parent</a><span>|</span><a href="#40479555">next</a><span>|</span><label class="collapse" for="c-40479625">[-]</label><label class="expand" for="c-40479625">[4 more]</label></div><br/><div class="children"><div class="content">An alternative, more arithmetic, argument:<p>- x is 2^b*k for some odd k &lt; 2^(n-b)<p>- -x is 2^n - 2^b*k = 2^b*(2^(n-b)-k)<p>- k is odd by definition, and (2^(n-b)-k) + k = 0 (mod 2^(n-b)). This means that the LSB must be 1 in both operands, which results in a carry out, and in the following ith bits we have that the sum is 0 mod 2^i if and only if the ith bits of (2^(n-b)-k) and k are distinct. Thus x &amp; -x = 2^b.</div><br/><div id="40480382" class="c"><input type="checkbox" id="c-40480382" checked=""/><div class="controls bullet"><span class="by">chx</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479625">parent</a><span>|</span><a href="#40480070">next</a><span>|</span><label class="collapse" for="c-40480382">[-]</label><label class="expand" for="c-40480382">[1 more]</label></div><br/><div class="children"><div class="content">&gt; -x is 2^n - 2^b * k<p>Erm no. -x is - 2^b * k and it&#x27;s the &quot;Two&#x27;s complement&quot; notation which is 2^n - 2 * b * k<p>This is because the way we generate the &quot;Two&#x27;s complement&quot; number. Given A in binary representation, let&#x27;s call A1 the number you get by flipping every bit in A also called one&#x27;s complement. Observe how every bit in A+A1 is 1 because if the bit was 0 in A then the bit is 1 in A1 and vica versa. So then that&#x27;s 2^N-1. Two&#x27;s complement is created by adding 1 to A1 so then A + A1 is 2^N or A1 = 2^N-A. But you do need to prove this before you can use it.</div><br/></div></div><div id="40480070" class="c"><input type="checkbox" id="c-40480070" checked=""/><div class="controls bullet"><span class="by">Droobfest</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479625">parent</a><span>|</span><a href="#40480382">prev</a><span>|</span><a href="#40479555">next</a><span>|</span><label class="collapse" for="c-40480070">[-]</label><label class="expand" for="c-40480070">[2 more]</label></div><br/><div class="children"><div class="content">This immediately reads like gobbledygook to me, while the parent is easy to follow.<p>I’m not trying to dunk on you, but I can’t help to note that the denseness of math is too much for an idiot like me.</div><br/><div id="40480616" class="c"><input type="checkbox" id="c-40480616" checked=""/><div class="controls bullet"><span class="by">schoen</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40480070">parent</a><span>|</span><a href="#40479555">next</a><span>|</span><label class="collapse" for="c-40480616">[-]</label><label class="expand" for="c-40480616">[1 more]</label></div><br/><div class="children"><div class="content">It might be nicer with exponents rendered as superscripts, because it could make it more apparent how the exponents are being used.</div><br/></div></div></div></div></div></div><div id="40479555" class="c"><input type="checkbox" id="c-40479555" checked=""/><div class="controls bullet"><span class="by">mabster</span><span>|</span><a href="#40478558">parent</a><span>|</span><a href="#40479625">prev</a><span>|</span><a href="#40479868">next</a><span>|</span><label class="collapse" for="c-40479555">[-]</label><label class="expand" for="c-40479555">[2 more]</label></div><br/><div class="children"><div class="content">Thanks! I&#x27;ve used the trick and derived why it works a few times, but always forget.<p>I battled to understand the post. Your explanation got me there very quickly.</div><br/><div id="40479684" class="c"><input type="checkbox" id="c-40479684" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479555">parent</a><span>|</span><a href="#40479868">next</a><span>|</span><label class="collapse" for="c-40479684">[-]</label><label class="expand" for="c-40479684">[1 more]</label></div><br/><div class="children"><div class="content">Sure thing, happy to hear!</div><br/></div></div></div></div><div id="40479868" class="c"><input type="checkbox" id="c-40479868" checked=""/><div class="controls bullet"><span class="by">arun-mani-j</span><span>|</span><a href="#40478558">parent</a><span>|</span><a href="#40479555">prev</a><span>|</span><a href="#40479040">next</a><span>|</span><label class="collapse" for="c-40479868">[-]</label><label class="expand" for="c-40479868">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the nice summary. I found myself difficult to explain it so I took the help of visual explanation using the bits structure. :)</div><br/></div></div><div id="40479040" class="c"><input type="checkbox" id="c-40479040" checked=""/><div class="controls bullet"><span class="by">jb1991</span><span>|</span><a href="#40478558">parent</a><span>|</span><a href="#40479868">prev</a><span>|</span><a href="#40480207">next</a><span>|</span><label class="collapse" for="c-40479040">[-]</label><label class="expand" for="c-40479040">[7 more]</label></div><br/><div class="children"><div class="content">I thought there was just a sign bit. If not, how does a system know if a number should be interpreted as positive or negative?</div><br/><div id="40479662" class="c"><input type="checkbox" id="c-40479662" checked=""/><div class="controls bullet"><span class="by">cvz</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479040">parent</a><span>|</span><a href="#40479778">next</a><span>|</span><label class="collapse" for="c-40479662">[-]</label><label class="expand" for="c-40479662">[2 more]</label></div><br/><div class="children"><div class="content">In the &quot;two&#x27;s complement&quot; representation, there is a sign bit, but the meaning isn&#x27;t &quot;invert this number&quot;, it&#x27;s &quot;subtract a large, fixed power of 2 from this number&quot;.<p>The reason this has become the most common representation for signed numbers in computer hardware is that it makes the difference between signed and unsigned numbers basically irrelevant as far as the hardware is concerned. When the difference does matter (which it does in division, conversions between different word sizes, conversions to&#x2F;from text, and sometimes multiplication), there are two different instructions for signed and unsigned, and it&#x27;s up to the programmer or compiler to pick the right one.</div><br/><div id="40479850" class="c"><input type="checkbox" id="c-40479850" checked=""/><div class="controls bullet"><span class="by">thaumasiotes</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479662">parent</a><span>|</span><a href="#40479778">next</a><span>|</span><label class="collapse" for="c-40479850">[-]</label><label class="expand" for="c-40479850">[1 more]</label></div><br/><div class="children"><div class="content">&gt; n the &quot;two&#x27;s complement&quot; representation, there is a sign bit, but the meaning isn&#x27;t &quot;invert this number&quot;, it&#x27;s &quot;subtract a large, fixed power of 2 from this number&quot;.<p>This is only true if the size of your modulus is fixed. In fact, there is a &quot;sign extension&quot; command allowing you to produce, for example, signed 128-bit values from signed 64-bit values, and this basically requires interpreting two&#x27;s complement values the same way they represent themselves: a three-bit -1 is just the sum of the positive values +1, +2, and +4. To extend that to six bits, you add the positive values +8, +16, and +32.<p>The meaning of the high bit in our six-bit scheme shouldn&#x27;t be viewed as &quot;when this bit is set, subtract 32 from the value instead of adding it&quot;. It is &quot;whether this bit is set or not, all higher bits in the number, the ones that don&#x27;t exist in the hardware, are equal to it&quot;; under this interpretation, the 8-, 16-, and 32- bits were already set in the three-bit value, and that&#x27;s why they continue to be set when we do a sign extension.<p>Every place value is still positive, but as long as there is no <i>highest</i> set bit, the number itself will be negative, and equal to the value you&#x27;d calculate from its representation as a geometric series.</div><br/></div></div></div></div><div id="40479778" class="c"><input type="checkbox" id="c-40479778" checked=""/><div class="controls bullet"><span class="by">pests</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479040">parent</a><span>|</span><a href="#40479662">prev</a><span>|</span><a href="#40479415">next</a><span>|</span><label class="collapse" for="c-40479778">[-]</label><label class="expand" for="c-40479778">[1 more]</label></div><br/><div class="children"><div class="content">2s compliment helps with the problem of otherwise having a +0&#x2F;-0 and lets you subtract numbers just with adders.</div><br/></div></div><div id="40479415" class="c"><input type="checkbox" id="c-40479415" checked=""/><div class="controls bullet"><span class="by">eslaught</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479040">parent</a><span>|</span><a href="#40479778">prev</a><span>|</span><a href="#40479055">next</a><span>|</span><label class="collapse" for="c-40479415">[-]</label><label class="expand" for="c-40479415">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re thinking about a sign and magnitude representation, which is not how integers are represented in a modern computer.<p>The modern version is two&#x27;s complement. It still has a sign bit, but negating a number involves more than just changing the sign bit since the representation is modular.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Two%27s_complement" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Two%27s_complement</a><p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Modular_arithmetic" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Modular_arithmetic</a></div><br/></div></div><div id="40479055" class="c"><input type="checkbox" id="c-40479055" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479040">parent</a><span>|</span><a href="#40479415">prev</a><span>|</span><a href="#40479079">next</a><span>|</span><label class="collapse" for="c-40479055">[-]</label><label class="expand" for="c-40479055">[1 more]</label></div><br/><div class="children"><div class="content">Signedness doesn&#x27;t affect anything here, as long as the representation is in two&#x27;s complement. The negation of x (i.e. -x) in two&#x27;s complement is ~x + 1. The interpretation of the bits as signed or unsigned doesn&#x27;t change any of the following steps.</div><br/></div></div><div id="40479079" class="c"><input type="checkbox" id="c-40479079" checked=""/><div class="controls bullet"><span class="by">elevatedastalt</span><span>|</span><a href="#40478558">root</a><span>|</span><a href="#40479040">parent</a><span>|</span><a href="#40479055">prev</a><span>|</span><a href="#40480207">next</a><span>|</span><label class="collapse" for="c-40479079">[-]</label><label class="expand" for="c-40479079">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s still a sign bit. The sign bit tells you whether to interpret the rest of the number as positive or treat as negative and undo the 2s complement operation.</div><br/></div></div></div></div></div></div><div id="40480207" class="c"><input type="checkbox" id="c-40480207" checked=""/><div class="controls bullet"><span class="by">omnicognate</span><span>|</span><a href="#40478558">prev</a><span>|</span><a href="#40478653">next</a><span>|</span><label class="collapse" for="c-40480207">[-]</label><label class="expand" for="c-40480207">[1 more]</label></div><br/><div class="children"><div class="content">Grammar nazi correction, but one I think is both interesting and a useful way to remember how these work: ones&#x27; complement has the apostrophe at the end (but two&#x27;s complement is correct).<p>Ones&#x27; complement is the &quot;complement of ones (plural)&quot; in that if you take an n-bit number and the representation of its additive inverse in that scheme and add them as ordinary binary numbers you get a result that is n ones. Eg. using 4 bits, 6 is 0110, -6 is 1001, adding them with ordinary binary addition gives 1111.<p>Two&#x27;s complement is the &quot;complement of two (to the n)&quot; in that if you do the same thing you get 2^n. Eg. 6 is 0110, -6 is 1010, adding them with ordinary binary addition gives 10000, or 2^4.</div><br/></div></div><div id="40478653" class="c"><input type="checkbox" id="c-40478653" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#40480207">prev</a><span>|</span><a href="#40479340">next</a><span>|</span><label class="collapse" for="c-40478653">[-]</label><label class="expand" for="c-40478653">[4 more]</label></div><br/><div class="children"><div class="content">Or briefly, copied from my StackOverflow answer[1]:<p><pre><code>  v    000...00010100
  ~v   111...11101011 (not used directly, all bits opposite)
  -v   111...11101100 (-v == ~v + 1; this causes all low 1 bits to overflow and carry)
  v&amp;-v 000...00000100 (has a single 1 bit, from the carry)
</code></pre>
The linked article is wrong in only mentioning 2 signed integer representations. Old versions of C allowed 3 representations for integers, floats use one of those (sign-magnitude, also used widedly by bignum libraries) and one other (offset binary), and base negative-2 is also possible in theory (not sure if practical for anything), for a total of 5.<p>[1]: <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;63552117&#x2F;1405588" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;63552117&#x2F;1405588</a></div><br/><div id="40479875" class="c"><input type="checkbox" id="c-40479875" checked=""/><div class="controls bullet"><span class="by">arun-mani-j</span><span>|</span><a href="#40478653">parent</a><span>|</span><a href="#40480247">next</a><span>|</span><label class="collapse" for="c-40479875">[-]</label><label class="expand" for="c-40479875">[1 more]</label></div><br/><div class="children"><div class="content">I tried to explain only one&#x27;s complement and two&#x27;s complement because they were only relevant to the explanation.<p>TIL we have 5 such representations! :)</div><br/></div></div><div id="40480247" class="c"><input type="checkbox" id="c-40480247" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#40478653">parent</a><span>|</span><a href="#40479875">prev</a><span>|</span><a href="#40479340">next</a><span>|</span><label class="collapse" for="c-40480247">[-]</label><label class="expand" for="c-40480247">[2 more]</label></div><br/><div class="children"><div class="content">And then we have a zig-zag bijection for too many serialization formats.</div><br/><div id="40480263" class="c"><input type="checkbox" id="c-40480263" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#40478653">root</a><span>|</span><a href="#40480247">parent</a><span>|</span><a href="#40479340">next</a><span>|</span><label class="collapse" for="c-40480263">[-]</label><label class="expand" for="c-40480263">[1 more]</label></div><br/><div class="children"><div class="content">Why too many? It&#x27;s a neat trick.</div><br/></div></div></div></div></div></div><div id="40479340" class="c"><input type="checkbox" id="c-40479340" checked=""/><div class="controls bullet"><span class="by">xjay</span><span>|</span><a href="#40478653">prev</a><span>|</span><a href="#40478566">next</a><span>|</span><label class="collapse" for="c-40479340">[-]</label><label class="expand" for="c-40479340">[2 more]</label></div><br/><div class="children"><div class="content">See also: Bit Twiddling Hacks<p><a href="https:&#x2F;&#x2F;graphics.stanford.edu&#x2F;~seander&#x2F;bithacks.html" rel="nofollow">https:&#x2F;&#x2F;graphics.stanford.edu&#x2F;~seander&#x2F;bithacks.html</a></div><br/><div id="40480321" class="c"><input type="checkbox" id="c-40480321" checked=""/><div class="controls bullet"><span class="by">richrichie</span><span>|</span><a href="#40479340">parent</a><span>|</span><a href="#40478566">next</a><span>|</span><label class="collapse" for="c-40480321">[-]</label><label class="expand" for="c-40480321">[1 more]</label></div><br/><div class="children"><div class="content">I was looking for this link. You made my morning!</div><br/></div></div></div></div><div id="40478566" class="c"><input type="checkbox" id="c-40478566" checked=""/><div class="controls bullet"><span class="by">mistercow</span><span>|</span><a href="#40479340">prev</a><span>|</span><a href="#40478703">next</a><span>|</span><label class="collapse" for="c-40478566">[-]</label><label class="expand" for="c-40478566">[1 more]</label></div><br/><div class="children"><div class="content">This is a fun puzzle to try to figure out before reading the article.</div><br/></div></div><div id="40478703" class="c"><input type="checkbox" id="c-40478703" checked=""/><div class="controls bullet"><span class="by">ww520</span><span>|</span><a href="#40478566">prev</a><span>|</span><a href="#40479299">next</a><span>|</span><label class="collapse" for="c-40478703">[-]</label><label class="expand" for="c-40478703">[2 more]</label></div><br/><div class="children"><div class="content">Good explanation.  Always good to read up on some bit tweaking once a while.</div><br/></div></div><div id="40479299" class="c"><input type="checkbox" id="c-40479299" checked=""/><div class="controls bullet"><span class="by">analognoise</span><span>|</span><a href="#40478703">prev</a><span>|</span><a href="#40479272">next</a><span>|</span><label class="collapse" for="c-40479299">[-]</label><label class="expand" for="c-40479299">[2 more]</label></div><br/><div class="children"><div class="content">Does the site actually mention the book it was in?</div><br/><div id="40479882" class="c"><input type="checkbox" id="c-40479882" checked=""/><div class="controls bullet"><span class="by">arun-mani-j</span><span>|</span><a href="#40479299">parent</a><span>|</span><a href="#40479272">next</a><span>|</span><label class="collapse" for="c-40479882">[-]</label><label class="expand" for="c-40479882">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s Competitive Programmer&#x27;s Handbook - <a href="https:&#x2F;&#x2F;github.com&#x2F;pllk&#x2F;cphb&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;pllk&#x2F;cphb&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>