<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683363668492" as="style"/><link rel="stylesheet" href="styles.css?v=1683363668492"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.macarthur.me/posts/maps-for-dom-nodes">Why I Like Using Maps (and WeakMaps) for Handling DOM Nodes</a> <span class="domain">(<a href="https://www.macarthur.me">www.macarthur.me</a>)</span></div><div class="subtext"><span>joelkesler</span> | <span>22 comments</span></div><br/><div><div id="35836109" class="c"><input type="checkbox" id="c-35836109" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#35835453">next</a><span>|</span><label class="collapse" for="c-35836109">[-]</label><label class="expand" for="c-35836109">[4 more]</label></div><br/><div class="children"><div class="content">Why not just use the &#x27;dataset&#x27; property of the element itself?  Then you can use querySelectorAll to find your selected rows automatically:<p><pre><code>    node.querySelectorAll(&#x27;tr[data-selected=&quot;true&quot;]&#x27;);
</code></pre>
In other words..  &quot;use the DOM to handle the DOM.&quot;</div><br/><div id="35836602" class="c"><input type="checkbox" id="c-35836602" checked=""/><div class="controls bullet"><span class="by">nirvdrum</span><span>|</span><a href="#35836109">parent</a><span>|</span><a href="#35835453">next</a><span>|</span><label class="collapse" for="c-35836602">[-]</label><label class="expand" for="c-35836602">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;d work for this specific case, but I think that was just a simplified example. A Map can store a value of any type, while the dataset property will always be a string. If you&#x27;re only working with strings, it&#x27;s a great option since you don&#x27;t need to maintain a side data structure at all. But, serializing and deserializing arbitrary objects would be expensive.</div><br/><div id="35837233" class="c"><input type="checkbox" id="c-35837233" checked=""/><div class="controls bullet"><span class="by">ZachSaucier</span><span>|</span><a href="#35836109">root</a><span>|</span><a href="#35836602">parent</a><span>|</span><a href="#35835453">next</a><span>|</span><label class="collapse" for="c-35837233">[-]</label><label class="expand" for="c-35837233">[2 more]</label></div><br/><div class="children"><div class="content">Couldn&#x27;t you do elementReference.foo = whateverTypeYouWant? No need to restrict things to just the data attribute.<p>This wouldn&#x27;t work if you need to know the order of the properties.</div><br/><div id="35837479" class="c"><input type="checkbox" id="c-35837479" checked=""/><div class="controls bullet"><span class="by">SSchick</span><span>|</span><a href="#35836109">root</a><span>|</span><a href="#35837233">parent</a><span>|</span><a href="#35835453">next</a><span>|</span><label class="collapse" for="c-35837479">[-]</label><label class="expand" for="c-35837479">[1 more]</label></div><br/><div class="children"><div class="content">This generally doesn’t play nice with TS code bases and is generally considered an anti-pattern since there’s chances for collisions etc
, you might get away using a unique symbol index but it’s still not good design.</div><br/></div></div></div></div></div></div></div></div><div id="35835453" class="c"><input type="checkbox" id="c-35835453" checked=""/><div class="controls bullet"><span class="by">geuis</span><span>|</span><a href="#35836109">prev</a><span>|</span><a href="#35836426">next</a><span>|</span><label class="collapse" for="c-35835453">[-]</label><label class="expand" for="c-35835453">[3 more]</label></div><br/><div class="children"><div class="content">This might be one of the more interesting articles I&#x27;ve read in a few years that deal with low level direct DOM manipulation vs &quot;yet another thing about React&quot;.</div><br/><div id="35836003" class="c"><input type="checkbox" id="c-35836003" checked=""/><div class="controls bullet"><span class="by">thex10</span><span>|</span><a href="#35835453">parent</a><span>|</span><a href="#35836426">next</a><span>|</span><label class="collapse" for="c-35836003">[-]</label><label class="expand" for="c-35836003">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, I’ve too noticed how hard it is to find any web development guidance involving direct DOM manipulation now!<p>I was recently refactoring some code and wondering whether to use a (JS) class… The search results were mostly about React Class Components. And I was contemplating building a reusable component… results from the past decade were split between React Components and Web components. (In retrospect I should’ve tried DDG or something not connected to my search history lol).<p>Anyway where are the vanilla JS&#x2F;TS DOM manipulators blogging these days? I guess here is one, thankful for the post :)</div><br/><div id="35837997" class="c"><input type="checkbox" id="c-35837997" checked=""/><div class="controls bullet"><span class="by">account-5</span><span>|</span><a href="#35835453">root</a><span>|</span><a href="#35836003">parent</a><span>|</span><a href="#35836426">next</a><span>|</span><label class="collapse" for="c-35837997">[-]</label><label class="expand" for="c-35837997">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;gomakethings.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;gomakethings.com&#x2F;</a></div><br/></div></div></div></div></div></div><div id="35836426" class="c"><input type="checkbox" id="c-35836426" checked=""/><div class="controls bullet"><span class="by">kevincox</span><span>|</span><a href="#35835453">prev</a><span>|</span><a href="#35835814">next</a><span>|</span><label class="collapse" for="c-35836426">[-]</label><label class="expand" for="c-35836426">[7 more]</label></div><br/><div class="children"><div class="content">I would argue that all &quot;mapping&quot; structures should use Map these days. Objects should be used only for record&#x2F;struct data with a fixed set of programmer-named keys.<p>I think MDN has a good comparison: <a href="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;JavaScript&#x2F;Reference&#x2F;Global_Objects&#x2F;Map#objects_vs._maps" rel="nofollow">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;JavaScript&#x2F;Refe...</a><p>The only real downside of maps is that they don&#x27;t support JSON serialization. However you can fix this pretty easily by using a map with an overridden `toJSON` for serializable keys.<p><pre><code>  class StringMap extends Map {
    toJSON() {
          return Object.fromEntries(this);
    }
  }</code></pre></div><br/><div id="35836674" class="c"><input type="checkbox" id="c-35836674" checked=""/><div class="controls bullet"><span class="by">taeric</span><span>|</span><a href="#35836426">parent</a><span>|</span><a href="#35839036">next</a><span>|</span><label class="collapse" for="c-35836674">[-]</label><label class="expand" for="c-35836674">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;d say the big downside is that they don&#x27;t support the general looking accessor that I&#x27;d wager way way way too many people will accidentally use.  Myself definitely being one of them.  Would have been better if they didn&#x27;t &quot;seem&quot; to work with the wrong syntax, at least.  But, alas, here we are.</div><br/><div id="35836883" class="c"><input type="checkbox" id="c-35836883" checked=""/><div class="controls bullet"><span class="by">kevincox</span><span>|</span><a href="#35836426">root</a><span>|</span><a href="#35836674">parent</a><span>|</span><a href="#35839036">next</a><span>|</span><label class="collapse" for="c-35836883">[-]</label><label class="expand" for="c-35836883">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m typically using TypeScript so that is more or less a non-issue. But even then it seems like an easy thing to get used to.</div><br/><div id="35837001" class="c"><input type="checkbox" id="c-35837001" checked=""/><div class="controls bullet"><span class="by">taeric</span><span>|</span><a href="#35836426">root</a><span>|</span><a href="#35836883">parent</a><span>|</span><a href="#35839036">next</a><span>|</span><label class="collapse" for="c-35837001">[-]</label><label class="expand" for="c-35837001">[1 more]</label></div><br/><div class="children"><div class="content">Fair.  And I didn&#x27;t say it is a blocker.  Just an easy footgun&#x2F;downside.  Is listed on the page linked, even.</div><br/></div></div></div></div></div></div><div id="35839036" class="c"><input type="checkbox" id="c-35839036" checked=""/><div class="controls bullet"><span class="by">panzerboiler</span><span>|</span><a href="#35836426">parent</a><span>|</span><a href="#35836674">prev</a><span>|</span><a href="#35837103">next</a><span>|</span><label class="collapse" for="c-35839036">[-]</label><label class="expand" for="c-35839036">[1 more]</label></div><br/><div class="children"><div class="content">That fix is not really a fix. The thing being broken for general serialization is JSON.</div><br/></div></div><div id="35837103" class="c"><input type="checkbox" id="c-35837103" checked=""/><div class="controls bullet"><span class="by">orange8</span><span>|</span><a href="#35836426">parent</a><span>|</span><a href="#35839036">prev</a><span>|</span><a href="#35835814">next</a><span>|</span><label class="collapse" for="c-35837103">[-]</label><label class="expand" for="c-35837103">[2 more]</label></div><br/><div class="children"><div class="content">What is a &quot;mapping&quot; structure?</div><br/><div id="35839069" class="c"><input type="checkbox" id="c-35839069" checked=""/><div class="controls bullet"><span class="by">RedShift1</span><span>|</span><a href="#35836426">root</a><span>|</span><a href="#35837103">parent</a><span>|</span><a href="#35835814">next</a><span>|</span><label class="collapse" for="c-35839069">[-]</label><label class="expand" for="c-35839069">[1 more]</label></div><br/><div class="children"><div class="content">Key value, dictionary, ...</div><br/></div></div></div></div></div></div><div id="35835814" class="c"><input type="checkbox" id="c-35835814" checked=""/><div class="controls bullet"><span class="by">globalise83</span><span>|</span><a href="#35836426">prev</a><span>|</span><a href="#35836202">next</a><span>|</span><label class="collapse" for="c-35835814">[-]</label><label class="expand" for="c-35835814">[2 more]</label></div><br/><div class="children"><div class="content">Nice! I have used Maps often for storing arbitrary key-value pairs, but until 5 minutes ago I didn&#x27;t know you could use object references as keys. So this was a very good use of 5 mins.</div><br/><div id="35838845" class="c"><input type="checkbox" id="c-35838845" checked=""/><div class="controls bullet"><span class="by">beebeepka</span><span>|</span><a href="#35835814">parent</a><span>|</span><a href="#35836202">next</a><span>|</span><label class="collapse" for="c-35838845">[-]</label><label class="expand" for="c-35838845">[1 more]</label></div><br/><div class="children"><div class="content">Same applies to Set, too. You can store an object, or instance, then use &quot;has&quot; to check for it.</div><br/></div></div></div></div><div id="35836202" class="c"><input type="checkbox" id="c-35836202" checked=""/><div class="controls bullet"><span class="by">rektide</span><span>|</span><a href="#35835814">prev</a><span>|</span><a href="#35837578">next</a><span>|</span><label class="collapse" for="c-35836202">[-]</label><label class="expand" for="c-35836202">[1 more]</label></div><br/><div class="children"><div class="content">I need to read &amp; consider this more, but my word, putting data <i>in</i> the DOM is so divine, is so the web way. See, HTML is the Web, <a href="https:&#x2F;&#x2F;www.petelambert.com&#x2F;journal&#x2F;html-is-the-web" rel="nofollow">https:&#x2F;&#x2F;www.petelambert.com&#x2F;journal&#x2F;html-is-the-web</a></div><br/></div></div><div id="35837578" class="c"><input type="checkbox" id="c-35837578" checked=""/><div class="controls bullet"><span class="by">JoeSloth</span><span>|</span><a href="#35836202">prev</a><span>|</span><a href="#35838085">next</a><span>|</span><label class="collapse" for="c-35837578">[-]</label><label class="expand" for="c-35837578">[1 more]</label></div><br/><div class="children"><div class="content">This is great for some use cases, but in situations like a very large list mentioned in the article it’s likely that a real world app would be virtualizing the nodes.. which would make an id a more stable key than a dom node.</div><br/></div></div><div id="35838085" class="c"><input type="checkbox" id="c-35838085" checked=""/><div class="controls bullet"><span class="by">eviks</span><span>|</span><a href="#35837578">prev</a><span>|</span><label class="collapse" for="c-35838085">[-]</label><label class="expand" for="c-35838085">[3 more]</label></div><br/><div class="children"><div class="content">Why did they not make the map assigning syntax as convenient as with objects, instead going for the clunky get&#x2F;set?</div><br/><div id="35839017" class="c"><input type="checkbox" id="c-35839017" checked=""/><div class="controls bullet"><span class="by">panzerboiler</span><span>|</span><a href="#35838085">parent</a><span>|</span><a href="#35839139">next</a><span>|</span><label class="collapse" for="c-35839017">[-]</label><label class="expand" for="c-35839017">[1 more]</label></div><br/><div class="children"><div class="content">Because a Map <i>is</i> an Object. It has properties and methods. The only way to provide a safe and clean namespace for your keys is to provide an explicit API. It also supports keys that can be not only strings or symbols.</div><br/></div></div><div id="35839139" class="c"><input type="checkbox" id="c-35839139" checked=""/><div class="controls bullet"><span class="by">beebeepka</span><span>|</span><a href="#35838085">parent</a><span>|</span><a href="#35839017">prev</a><span>|</span><label class="collapse" for="c-35839139">[-]</label><label class="expand" for="c-35839139">[1 more]</label></div><br/><div class="children"><div class="content">Several things such as standard way for adding, removing and checking for keys, built-in size property, extensibility.<p>You think &quot;key in object&quot; is better than &quot;maaaaap.has(key)&quot;? I don&#x27;t because it&#x27;s unpredictable and prone to exceptions.<p>Give them a try. It&#x27;s not a complete replacement for regular old objects</div><br/></div></div></div></div></div></div></div></div></div></body></html>