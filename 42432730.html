<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1734426072227" as="style"/><link rel="stylesheet" href="styles.css?v=1734426072227"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://avi.im/blag/2024/faster-sqlite/">In Search of a Faster SQLite</a> <span class="domain">(<a href="https://avi.im">avi.im</a>)</span></div><div class="subtext"><span>avinassh</span> | <span>122 comments</span></div><br/><div><div id="42433218" class="c"><input type="checkbox" id="c-42433218" checked=""/><div class="controls bullet"><span class="by">efitz</span><span>|</span><a href="#42433401">next</a><span>|</span><label class="collapse" for="c-42433218">[-]</label><label class="expand" for="c-42433218">[27 more]</label></div><br/><div class="children"><div class="content">The article discusses the specific use case of serverless computing, e.g. AWS Lambda, and how a central database doesn&#x27;t always work well with apps constructed in a serverless fashion.<p>I was immediately interested in this post because 6-7 years ago I worked on this very problem- I needed to ingest a set of complex hierarchical files that could change at any time, and I needed to &quot;query&quot; them to extract particular information.  FaaS is expensive for computationally expensive tasks, and it also didn&#x27;t make sense to load big XML files and parse them every time I needed to do a lookup in any instance of my Lambda function.<p>My solution was to have a central function on a timer that read and parsed the files every couple of minutes, loaded the data into a SQLite database, indexed it, and put the file in S3.<p>Now my functions just downloaded the file from S3, if it was newer than the local copy or on a cold start, and did the lookup.  Blindingly fast and no duplication of effort.<p>One of the things that is not immediately obvious from Lambda is that it has a local &#x2F;tmp directory that you can read from and write to.  Also the Python runtime includes SQLite; no need to upload code besides your function.<p>I&#x27;m excited that work is going on that might make such solutions even faster; I think it&#x27;s a very useful pattern for distributed computing.</div><br/><div id="42434124" class="c"><input type="checkbox" id="c-42434124" checked=""/><div class="controls bullet"><span class="by">moduspol</span><span>|</span><a href="#42433218">parent</a><span>|</span><a href="#42439546">next</a><span>|</span><label class="collapse" for="c-42434124">[-]</label><label class="expand" for="c-42434124">[13 more]</label></div><br/><div class="children"><div class="content">We have that issue at work, though I solved it by including the sqlite database within the container image that we use. We then deploy the new container image (with the same code as before, but with a revised database file) at most every fifteen minutes.<p>This gives you an atomic point at which you are 100% confident all instances are using the same database, and by provisioning concurrency, you can also avoid a &quot;thundering herd&quot; of instances all fetching from the file on S3 at startup (which can otherwise lead to throttling).<p>Of course, that&#x27;s only feasible if it&#x27;s acceptable that your data can be stale for some number of minutes, but if you&#x27;re caching the way you are, and periodically checking S3 for an updated database, it probably is.</div><br/><div id="42435454" class="c"><input type="checkbox" id="c-42435454" checked=""/><div class="controls bullet"><span class="by">jrochkind1</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434124">parent</a><span>|</span><a href="#42434438">next</a><span>|</span><label class="collapse" for="c-42435454">[-]</label><label class="expand" for="c-42435454">[10 more]</label></div><br/><div class="children"><div class="content">&gt;  &quot;thundering herd&quot; of instances all fetching from the file on S3 at startup (which can otherwise lead to throttling).<p>Have any &quot;thundering herd&quot; problems with S3, including throttling, actually been seen?<p>I think S3 is advertised to have no concurrent connection limit, and support up to at least 5,500 GETs per second (per &quot;prefix&quot;, which I&#x27;m confused about what that means exactly in practice). I don&#x27;t think S3 ever applies intentional throttling, although of course if you exceed it&#x27;s capacity to deliver data you will see &quot;natural&quot; throttling.<p>Do you have a fleet big enough that you might be exceeding those limits, or have people experienced problems even well under these limits, or is it just precautionary?</div><br/><div id="42438393" class="c"><input type="checkbox" id="c-42438393" checked=""/><div class="controls bullet"><span class="by">sudhirj</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42435454">parent</a><span>|</span><a href="#42436179">next</a><span>|</span><label class="collapse" for="c-42438393">[-]</label><label class="expand" for="c-42438393">[4 more]</label></div><br/><div class="children"><div class="content">I asked the S3 team what “prefix” meant at reinvent, and my current understanding is “whatever starting length of key gives a reasonable cardinality for your objects”.<p>So if your keys are 2024&#x2F;12&#x2F;03&#x2F;22-45:24 etc, I would expect the prefix to be first 7 characters. If your keys are UUIDs I’d assume first two or three. For ULIDs I’d assume first 10. I this there’s a function that does stat analysis on key samples to figure out reasonable sharding.</div><br/><div id="42439417" class="c"><input type="checkbox" id="c-42439417" checked=""/><div class="controls bullet"><span class="by">tecleandor</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42438393">parent</a><span>|</span><a href="#42438460">next</a><span>|</span><label class="collapse" for="c-42439417">[-]</label><label class="expand" for="c-42439417">[1 more]</label></div><br/><div class="children"><div class="content">Yep. Works similarly with google cloud storage buckets. It seems like the indexing function they use for splitting&#x2F;distributing&#x2F;sharding access looks at your objects keys and finds a common prefix to do this.<p>The problem with a date based key like the one you used (that&#x27;s very common) is that if you read a lot of files that tend to be from the same date (for example: for data analysis you read all the files from one day or week, not files randomly distributed) all those files are going to share the same prefix and are going to be located in the same shard, reducing performance until the load is so high that Google splits that index in parts and begins to distribute your data in other shards.<p>For this reason they recommend to think your key name beforehand and split that prefix using some sort of random hash in a reasonable location of your key:<p><a href="https:&#x2F;&#x2F;cloud.google.com&#x2F;storage&#x2F;docs&#x2F;request-rate#naming-convention" rel="nofollow">https:&#x2F;&#x2F;cloud.google.com&#x2F;storage&#x2F;docs&#x2F;request-rate#naming-co...</a></div><br/></div></div><div id="42438460" class="c"><input type="checkbox" id="c-42438460" checked=""/><div class="controls bullet"><span class="by">jrochkind1</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42438393">parent</a><span>|</span><a href="#42439417">prev</a><span>|</span><a href="#42436179">next</a><span>|</span><label class="collapse" for="c-42438460">[-]</label><label class="expand" for="c-42438460">[2 more]</label></div><br/><div class="children"><div class="content">I have never seen this explained, so thank you!  Sounds like it&#x27;s kind of &quot;up to S3 and probably not predictable by you&quot; -- which at least explains why it wasn&#x27;t clear!<p>If you don&#x27;t have &quot;a lot&quot; of keys, then you probably have only one prefix, maybe? Without them documenting the target order of magnitude of their shards?</div><br/><div id="42439642" class="c"><input type="checkbox" id="c-42439642" checked=""/><div class="controls bullet"><span class="by">sudhirj</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42438460">parent</a><span>|</span><a href="#42436179">next</a><span>|</span><label class="collapse" for="c-42439642">[-]</label><label class="expand" for="c-42439642">[1 more]</label></div><br/><div class="children"><div class="content">I would assume so, the extreme case being just one key, which of course has only one partition. But see <a href="https:&#x2F;&#x2F;youtu.be&#x2F;NXehLy7IiPM" rel="nofollow">https:&#x2F;&#x2F;youtu.be&#x2F;NXehLy7IiPM</a> (2024 Reinvent S3 deep dive) - there’s still replication happening on single objects. So it’s still sort of sharded, but I do think key partitions where groups of keys have shared choke points based on sort order exist.</div><br/></div></div></div></div></div></div><div id="42436179" class="c"><input type="checkbox" id="c-42436179" checked=""/><div class="controls bullet"><span class="by">moduspol</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42435454">parent</a><span>|</span><a href="#42438393">prev</a><span>|</span><a href="#42437786">next</a><span>|</span><label class="collapse" for="c-42436179">[-]</label><label class="expand" for="c-42436179">[2 more]</label></div><br/><div class="children"><div class="content">Sorry--the throttling was at the AWS Lambda layer, not S3. We were being throttled because we&#x27;d deploy a new container image and suddenly thousands of new containers are all simultaneously trying to pull the database file from S3.<p>We aim to return a response in the single digit milliseconds and sometimes get tens of thousands of requests per second, so even if it only takes a second or two to fetch that file from S3, the request isn&#x27;t getting served while it&#x27;s happening, and new requests are coming in.<p>You very quickly hit your Lambda concurrency limit and get throttled just waiting for your instances to fetch the file, even though logically you&#x27;re doing exactly what you planned to.<p>By having the file exist already in the container image, you lean on AWS&#x27;s existing tools for a phased rollout to replace portions of your deployment at a time, and every one is responding in single digit milliseconds from its very first request.<p>EDIT: The same technique could be applied for other container management systems, but for stuff like Kubernetes or ECS, it might be simpler to use OP&#x27;s method with a readiness check that only returns true if you fetched the file successfully. And maybe some other logic to do something if your file gets too stale, or you&#x27;re failing to fetch updates for some reason.</div><br/><div id="42438111" class="c"><input type="checkbox" id="c-42438111" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42436179">parent</a><span>|</span><a href="#42437786">next</a><span>|</span><label class="collapse" for="c-42438111">[-]</label><label class="expand" for="c-42438111">[1 more]</label></div><br/><div class="children"><div class="content">Are lambdas guaranteed to be warm on the first request to serve in single digit milliseconds?</div><br/></div></div></div></div><div id="42437786" class="c"><input type="checkbox" id="c-42437786" checked=""/><div class="controls bullet"><span class="by">liquidgecka</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42435454">parent</a><span>|</span><a href="#42436179">prev</a><span>|</span><a href="#42434438">next</a><span>|</span><label class="collapse" for="c-42437786">[-]</label><label class="expand" for="c-42437786">[3 more]</label></div><br/><div class="children"><div class="content">I wrote a tool to handle micro blobs specifically because we were being heavily rate limited by S3 for both writes and reads. We got about 3k&#x2F;s per bucket before S3 rate limiting started kicking in hard.<p>Granted we also used said tool to bundle objects together in a way that required sezo state to track so that we could fetch them as needed cheaply and efficiently so it wasn&#x27;t a pure S3 issue.</div><br/><div id="42437926" class="c"><input type="checkbox" id="c-42437926" checked=""/><div class="controls bullet"><span class="by">jrochkind1</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42437786">parent</a><span>|</span><a href="#42434438">next</a><span>|</span><label class="collapse" for="c-42437926">[-]</label><label class="expand" for="c-42437926">[2 more]</label></div><br/><div class="children"><div class="content">Interesting, thanks! PUT is advertised at 3500&#x2F;s, so with a combo load, you were at least within range of advertised limits. I have not approached that scale so didn&#x27;t know, it was a real question!</div><br/><div id="42438405" class="c"><input type="checkbox" id="c-42438405" checked=""/><div class="controls bullet"><span class="by">hobs</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42437926">parent</a><span>|</span><a href="#42434438">next</a><span>|</span><label class="collapse" for="c-42438405">[-]</label><label class="expand" for="c-42438405">[1 more]</label></div><br/><div class="children"><div class="content">Yeah I was processing a bunch of iceberg catalog data, it was pretty trivial to get to this point on both PUTs and GETs with our data volume, I was doing 400,000 requests&#x2F;m and of course my testing was writing to one prefix :)</div><br/></div></div></div></div></div></div></div></div><div id="42434438" class="c"><input type="checkbox" id="c-42434438" checked=""/><div class="controls bullet"><span class="by">efitz</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434124">parent</a><span>|</span><a href="#42435454">prev</a><span>|</span><a href="#42439546">next</a><span>|</span><label class="collapse" for="c-42434438">[-]</label><label class="expand" for="c-42434438">[2 more]</label></div><br/><div class="children"><div class="content">I actually versioned my database file - I had a small metadata table with version number and creation time.<p>Then in the output from each of my other functions, I included the database version number.  So all my output could be subsequently normalized by re-running the same input versus an arbitrary version of the database file.</div><br/><div id="42437071" class="c"><input type="checkbox" id="c-42437071" checked=""/><div class="controls bullet"><span class="by">bob1029</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434438">parent</a><span>|</span><a href="#42439546">next</a><span>|</span><label class="collapse" for="c-42437071">[-]</label><label class="expand" for="c-42437071">[1 more]</label></div><br/><div class="children"><div class="content">Have you looked at the user_version pragma? I&#x27;ve been able to avoid use of special metadata tables with this.</div><br/></div></div></div></div></div></div><div id="42433764" class="c"><input type="checkbox" id="c-42433764" checked=""/><div class="controls bullet"><span class="by">viccis</span><span>|</span><a href="#42433218">parent</a><span>|</span><a href="#42439546">prev</a><span>|</span><a href="#42434577">next</a><span>|</span><label class="collapse" for="c-42433764">[-]</label><label class="expand" for="c-42433764">[1 more]</label></div><br/><div class="children"><div class="content">&gt; One of the things that is not immediately obvious from Lambda is that it has a local &#x2F;tmp directory that you can read from and write to.<p>The other big thing a lot of people don&#x27;t know about Python on Lambda is that your global scope is also persisted for that execution context&#x27;s lifetime like &#x2F;tmp is. I ran into issues at one point with Lambdas that processed a high volume of data getting intermittent errors connecting to S3. An AWS engineer told me to cache my boto3 stuff (session, client, resources, etc.) in the global namespace, and that solved the problem overnight.</div><br/></div></div><div id="42434577" class="c"><input type="checkbox" id="c-42434577" checked=""/><div class="controls bullet"><span class="by">up2isomorphism</span><span>|</span><a href="#42433218">parent</a><span>|</span><a href="#42433764">prev</a><span>|</span><a href="#42437955">next</a><span>|</span><label class="collapse" for="c-42434577">[-]</label><label class="expand" for="c-42434577">[4 more]</label></div><br/><div class="children"><div class="content">It is so painful to see so many people make wrong use of S3.</div><br/><div id="42434600" class="c"><input type="checkbox" id="c-42434600" checked=""/><div class="controls bullet"><span class="by">lcnPylGDnU4H9OF</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434577">parent</a><span>|</span><a href="#42437955">next</a><span>|</span><label class="collapse" for="c-42434600">[-]</label><label class="expand" for="c-42434600">[3 more]</label></div><br/><div class="children"><div class="content">Is there a list of correct uses of s3 we can all follow?</div><br/><div id="42435399" class="c"><input type="checkbox" id="c-42435399" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434600">parent</a><span>|</span><a href="#42435476">next</a><span>|</span><label class="collapse" for="c-42435399">[-]</label><label class="expand" for="c-42435399">[1 more]</label></div><br/><div class="children"><div class="content">Yep.  Right here.  [0].<p>Generally people ignore the per PUT and GET pricing on S3 along with the higher latency since it&#x27;s a &quot;global&quot; service.  If your objects are small then you&#x27;re almost always benefited from using DynamoDB as the GET pricing and latency are far more favorable,  as long as you don&#x27;t mind the region dependency or the multi region setup.<p>[0]: <a href="https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AmazonS3&#x2F;latest&#x2F;userguide&#x2F;optimizing-performance.html" rel="nofollow">https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AmazonS3&#x2F;latest&#x2F;userguide&#x2F;optimi...</a></div><br/></div></div><div id="42435476" class="c"><input type="checkbox" id="c-42435476" checked=""/><div class="controls bullet"><span class="by">compootr</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42434600">parent</a><span>|</span><a href="#42435399">prev</a><span>|</span><a href="#42437955">next</a><span>|</span><label class="collapse" for="c-42435476">[-]</label><label class="expand" for="c-42435476">[1 more]</label></div><br/><div class="children"><div class="content">storing massive amounts of unstructured data</div><br/></div></div></div></div></div></div><div id="42437955" class="c"><input type="checkbox" id="c-42437955" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433218">parent</a><span>|</span><a href="#42434577">prev</a><span>|</span><a href="#42433448">next</a><span>|</span><label class="collapse" for="c-42437955">[-]</label><label class="expand" for="c-42437955">[1 more]</label></div><br/><div class="children"><div class="content">&gt; My solution was to have a central function on a timer that read and parsed the files every couple of minutes, loaded the data into a SQLite database, indexed it, and put the file in S3.<p>I really love using S3 as a storage backend!</div><br/></div></div><div id="42433448" class="c"><input type="checkbox" id="c-42433448" checked=""/><div class="controls bullet"><span class="by">rmbyrro</span><span>|</span><a href="#42433218">parent</a><span>|</span><a href="#42437955">prev</a><span>|</span><a href="#42433401">next</a><span>|</span><label class="collapse" for="c-42433448">[-]</label><label class="expand" for="c-42433448">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Now my functions just downloaded the file from S3, if it was newer than the local copy<p>if you have strong consistency requirements, this doesn&#x27;t work. synchronizing clocks reliably between different servers is surprisingly hard. you might end up working with stale data. might work for use cases that can accept eventual consistency.</div><br/><div id="42434402" class="c"><input type="checkbox" id="c-42434402" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42433448">parent</a><span>|</span><a href="#42434225">next</a><span>|</span><label class="collapse" for="c-42434402">[-]</label><label class="expand" for="c-42434402">[1 more]</label></div><br/><div class="children"><div class="content">If you have strong consistency requirements, then it doesn&#x27;t work by the very nature of making multiple copies of the database.  Even if the clocks are perfect.  (Though the clocks are probably close enough that it doesn&#x27;t matter.)</div><br/></div></div><div id="42434225" class="c"><input type="checkbox" id="c-42434225" checked=""/><div class="controls bullet"><span class="by">jedberg</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42433448">parent</a><span>|</span><a href="#42434402">prev</a><span>|</span><a href="#42436074">next</a><span>|</span><label class="collapse" for="c-42434225">[-]</label><label class="expand" for="c-42434225">[1 more]</label></div><br/><div class="children"><div class="content">One of the announcements from AWS this year at Re:invent is that they now can guarantee that the instances clocks are synced within microseconds of each other.  Close enough that you can rely on it for distributed timekeeping.</div><br/></div></div><div id="42436074" class="c"><input type="checkbox" id="c-42436074" checked=""/><div class="controls bullet"><span class="by">iskela</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42433448">parent</a><span>|</span><a href="#42434225">prev</a><span>|</span><a href="#42434451">next</a><span>|</span><label class="collapse" for="c-42436074">[-]</label><label class="expand" for="c-42436074">[1 more]</label></div><br/><div class="children"><div class="content">Wouldnt e-tag version numbers also work? Or just havkng .jsom with version metadata next to the db blob? No need to sync clocks. Just GET the small db-ver.json and compare version details?</div><br/></div></div><div id="42434451" class="c"><input type="checkbox" id="c-42434451" checked=""/><div class="controls bullet"><span class="by">efitz</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42433448">parent</a><span>|</span><a href="#42436074">prev</a><span>|</span><a href="#42433553">next</a><span>|</span><label class="collapse" for="c-42434451">[-]</label><label class="expand" for="c-42434451">[1 more]</label></div><br/><div class="children"><div class="content">I versioned the databases and my use case didn’t require strong consistency.</div><br/></div></div><div id="42433553" class="c"><input type="checkbox" id="c-42433553" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#42433218">root</a><span>|</span><a href="#42433448">parent</a><span>|</span><a href="#42434451">prev</a><span>|</span><a href="#42433401">next</a><span>|</span><label class="collapse" for="c-42433553">[-]</label><label class="expand" for="c-42433553">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t really know if that matters for this use case. Just by the very nature of source_data -&gt; processing -&gt; dest_data taking nonzero time anything consuming dest_data must already be tolerant of some amount of lag. And how it&#x27;s coded guarantees you can never observe dest_data going new -&gt; old -&gt; new.</div><br/></div></div></div></div></div></div><div id="42433401" class="c"><input type="checkbox" id="c-42433401" checked=""/><div class="controls bullet"><span class="by">chambers</span><span>|</span><a href="#42433218">prev</a><span>|</span><a href="#42433157">next</a><span>|</span><label class="collapse" for="c-42433401">[-]</label><label class="expand" for="c-42433401">[3 more]</label></div><br/><div class="children"><div class="content">One small comment: it may be worth disclaiming that one of the two cited researchers is the author&#x27;s boss.<p>It&#x27;s a small detail, but I mistakenly thought the author and the researchers were unrelated until I read a bit more</div><br/><div id="42439501" class="c"><input type="checkbox" id="c-42439501" checked=""/><div class="controls bullet"><span class="by">chrismorgan</span><span>|</span><a href="#42433401">parent</a><span>|</span><a href="#42437808">next</a><span>|</span><label class="collapse" for="c-42439501">[-]</label><label class="expand" for="c-42439501">[1 more]</label></div><br/><div class="children"><div class="content">FYI, the word you want there is “disclosing”, not “disclaiming”.</div><br/></div></div><div id="42437808" class="c"><input type="checkbox" id="c-42437808" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433401">parent</a><span>|</span><a href="#42439501">prev</a><span>|</span><a href="#42433157">next</a><span>|</span><label class="collapse" for="c-42437808">[-]</label><label class="expand" for="c-42437808">[1 more]</label></div><br/><div class="children"><div class="content">hey, thats fair. I have mentioned that I work at Turso in my blog&#x27;s about page, but I don&#x27;t expect everyone to check that. I have updated the post to include a disclosure, thanks!</div><br/></div></div></div></div><div id="42433157" class="c"><input type="checkbox" id="c-42433157" checked=""/><div class="controls bullet"><span class="by">high_byte</span><span>|</span><a href="#42433401">prev</a><span>|</span><a href="#42438256">next</a><span>|</span><label class="collapse" for="c-42433157">[-]</label><label class="expand" for="c-42433157">[4 more]</label></div><br/><div class="children"><div class="content">&quot;The benefits become noticeable only at p999 onwards; for p90 and p99, the performance is almost the same as SQLite.&quot;<p>I hate to be a hater, and I love sqlite and optimizations, but this is true.</div><br/><div id="42433418" class="c"><input type="checkbox" id="c-42433418" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#42433157">parent</a><span>|</span><a href="#42438935">next</a><span>|</span><label class="collapse" for="c-42433418">[-]</label><label class="expand" for="c-42433418">[2 more]</label></div><br/><div class="children"><div class="content">The benchmark seems a bit weird. Fetch 100 results from a table with no filtering,sorting,or anything? That feels like the IO is going to be really small anyways.</div><br/><div id="42434108" class="c"><input type="checkbox" id="c-42434108" checked=""/><div class="controls bullet"><span class="by">tsegratis</span><span>|</span><a href="#42433157">root</a><span>|</span><a href="#42433418">parent</a><span>|</span><a href="#42438935">next</a><span>|</span><label class="collapse" for="c-42434108">[-]</label><label class="expand" for="c-42434108">[1 more]</label></div><br/><div class="children"><div class="content">they compare threads and coroutines for limbo. threads have much worse p90 latencies since they context switch.... im not sure they can draw any conclusions except that coroutines are faster (of course)</div><br/></div></div></div></div><div id="42438935" class="c"><input type="checkbox" id="c-42438935" checked=""/><div class="controls bullet"><span class="by">feverzsj</span><span>|</span><a href="#42433157">parent</a><span>|</span><a href="#42433418">prev</a><span>|</span><a href="#42438256">next</a><span>|</span><label class="collapse" for="c-42438935">[-]</label><label class="expand" for="c-42438935">[1 more]</label></div><br/><div class="children"><div class="content">So, it&#x27;s almost useless.</div><br/></div></div></div></div><div id="42438256" class="c"><input type="checkbox" id="c-42438256" checked=""/><div class="controls bullet"><span class="by">fulafel</span><span>|</span><a href="#42433157">prev</a><span>|</span><a href="#42433597">next</a><span>|</span><label class="collapse" for="c-42438256">[-]</label><label class="expand" for="c-42438256">[1 more]</label></div><br/><div class="children"><div class="content">&gt; For benchmarking, they simulate a multi-tenant serverless runtime, where each tenant gets their own embedded database. They vary the number of tenants from 1 to 100 in increments of 10. SQLite gets its own thread per tenant, and in each thread they run the query to measure.<p>How realistic is this? Wouldn&#x27;t a serverless SQLite setup (using the existing SQLite) use a SQLite process per request (or at least a SQLite process per tenant)? This way the blocking read&#x2F;write calls would have much less impact.<p>(You could possibly argue that you gain something with the new architecture if you can switch from processes to threads... if someone read the paper, was there an argument for it in there?)</div><br/></div></div><div id="42433597" class="c"><input type="checkbox" id="c-42433597" checked=""/><div class="controls bullet"><span class="by">scheme271</span><span>|</span><a href="#42438256">prev</a><span>|</span><a href="#42437863">next</a><span>|</span><label class="collapse" for="c-42433597">[-]</label><label class="expand" for="c-42433597">[4 more]</label></div><br/><div class="children"><div class="content">One of the nice things about sqlite is that there is a very extensive test suite that extensively tests it. The question is whether the rewrite have something similar or will it get the similar testing?  Especially if it uses fast but hard to write and potentially buggy features like io_uring.</div><br/><div id="42438145" class="c"><input type="checkbox" id="c-42438145" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#42433597">parent</a><span>|</span><a href="#42437978">next</a><span>|</span><label class="collapse" for="c-42438145">[-]</label><label class="expand" for="c-42438145">[1 more]</label></div><br/><div class="children"><div class="content">They could license the test suite from SQLite (and a lot of tests are open sourced): <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;prosupport.html#th3" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;prosupport.html#th3</a></div><br/></div></div><div id="42437978" class="c"><input type="checkbox" id="c-42437978" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433597">parent</a><span>|</span><a href="#42438145">prev</a><span>|</span><a href="#42434420">next</a><span>|</span><label class="collapse" for="c-42437978">[-]</label><label class="expand" for="c-42437978">[1 more]</label></div><br/><div class="children"><div class="content">&gt; One of the nice things about sqlite is that there is a very extensive test suite that extensively tests it.<p>Yes, that sets a high bar for us. We plan to use Deterministic Simulation Testing and Antithesis to reach the rigorous testing standards of SQLite.<p>Limbo comes with a simulator too</div><br/></div></div><div id="42434420" class="c"><input type="checkbox" id="c-42434420" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#42433597">parent</a><span>|</span><a href="#42437978">prev</a><span>|</span><a href="#42437863">next</a><span>|</span><label class="collapse" for="c-42434420">[-]</label><label class="expand" for="c-42434420">[1 more]</label></div><br/><div class="children"><div class="content">^^^ - this was my first reaction too. I wonder how they would ensure the same level of quality (e.g. not just safe code due to Rust)</div><br/></div></div></div></div><div id="42437863" class="c"><input type="checkbox" id="c-42437863" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433597">prev</a><span>|</span><a href="#42435172">next</a><span>|</span><label class="collapse" for="c-42437863">[-]</label><label class="expand" for="c-42437863">[2 more]</label></div><br/><div class="children"><div class="content">I am the author of this blog post and I didn&#x27;t expect to see it on the front page! For disclosure, I work at Turso and one of the authors, Pekka, is from Turso.<p>This paper came out in April 2024 when Limbo was in its nascent stages. It has seen many improvements since then, one being support for Deterministic Simulation Testing.<p>repo: <a href="https:&#x2F;&#x2F;github.com&#x2F;tursodatabase&#x2F;limbo">https:&#x2F;&#x2F;github.com&#x2F;tursodatabase&#x2F;limbo</a></div><br/><div id="42439527" class="c"><input type="checkbox" id="c-42439527" checked=""/><div class="controls bullet"><span class="by">austin-cheney</span><span>|</span><a href="#42437863">parent</a><span>|</span><a href="#42435172">next</a><span>|</span><label class="collapse" for="c-42439527">[-]</label><label class="expand" for="c-42439527">[1 more]</label></div><br/><div class="children"><div class="content">It sounds like most of the answer suggested by the paper is asynchronous IO, so maybe I am misunderstanding something.<p>There is a lot, I mean A LOT as in huge and tremendous amount, of overhead in managing data via any form of SQL versus just writing to files.  The overhead pays for itself if the size of the data is large enough and the cost of read and write operations is high enough.<p>Given those factors couldn&#x27;t similar performance improvements be achieved at far lower cost by piping data via streams to opened files using an asynchronous interface like an event loop or child processes?  That would eliminate the blocking of synchronous operations and so much of the CPU overhead associated with query interpretation during writes.  There would still be a cost to precise data extraction at read time though.<p>If just using file system operations all operational overhead only occurs at execution time.  For example managing and reading data still incurs CPU cost, but there is virtually no management cost to replicating a database if that replication is just a matter of copying files as opposed to the more complex operations concerned with replicating a SQL database.</div><br/></div></div></div></div><div id="42435172" class="c"><input type="checkbox" id="c-42435172" checked=""/><div class="controls bullet"><span class="by">samwillis</span><span>|</span><a href="#42437863">prev</a><span>|</span><a href="#42433458">next</a><span>|</span><label class="collapse" for="c-42435172">[-]</label><label class="expand" for="c-42435172">[1 more]</label></div><br/><div class="children"><div class="content">This is a great article.<p>There was a previous attempt to bring async io to Postgres, but sadly it went dormant: <a href="https:&#x2F;&#x2F;commitfest.postgresql.org&#x2F;34&#x2F;3316&#x2F;" rel="nofollow">https:&#x2F;&#x2F;commitfest.postgresql.org&#x2F;34&#x2F;3316&#x2F;</a><p>A more recent proposal was to make it possible to swap out the storage manager for a custom one without having to fork the codebase. I.e. extensions can provide an alternative. <a href="https:&#x2F;&#x2F;commitfest.postgresql.org&#x2F;49&#x2F;4428&#x2F;" rel="nofollow">https:&#x2F;&#x2F;commitfest.postgresql.org&#x2F;49&#x2F;4428&#x2F;</a><p>This would allow for custom ones that do async IO to any custom storage layer.<p>There are a lot of interested parties in the new proposal (it&#x27;s come out of Neon, as they run a fork with a custom storage manager). With the move to separate compute from storage this becomes something many Postgres orgs will want to be able to do.<p>A change of core to use async io becomes slightly less relevant when you can swap out the whole storage manager.<p>(Note that the storage manager only handles pages in the heap tables, not the WAL. There is more exploration needed there to make the WAL extendable&#x2F;replaceable)</div><br/></div></div><div id="42433458" class="c"><input type="checkbox" id="c-42433458" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#42435172">prev</a><span>|</span><a href="#42434435">next</a><span>|</span><label class="collapse" for="c-42433458">[-]</label><label class="expand" for="c-42433458">[10 more]</label></div><br/><div class="children"><div class="content">So silly question - if i understand right, the idea is you can do other stuff while i&#x2F;o is working async.<p>When working on a database, don&#x27;t you want to wait for the transaction to complete before continuing on? How does this affect durability of transactions? Or do i just have the wrong mental model for this.</div><br/><div id="42433526" class="c"><input type="checkbox" id="c-42433526" checked=""/><div class="controls bullet"><span class="by">bjornsing</span><span>|</span><a href="#42433458">parent</a><span>|</span><a href="#42438161">next</a><span>|</span><label class="collapse" for="c-42433526">[-]</label><label class="expand" for="c-42433526">[3 more]</label></div><br/><div class="children"><div class="content">I think the OP is about a runtime that runs hundreds of programs concurrently. When one program is waiting for a transaction other programs can execute.</div><br/><div id="42438752" class="c"><input type="checkbox" id="c-42438752" checked=""/><div class="controls bullet"><span class="by">mkl</span><span>|</span><a href="#42433458">root</a><span>|</span><a href="#42433526">parent</a><span>|</span><a href="#42438161">next</a><span>|</span><label class="collapse" for="c-42438752">[-]</label><label class="expand" for="c-42438752">[2 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t need io_uring for that - the usual synchronous file operations will cause the OS to switch away from processes while they wait for disk, if there are other processes needing to do work.  OP&#x27;s design is for when you have other work to do in the same process.</div><br/><div id="42439240" class="c"><input type="checkbox" id="c-42439240" checked=""/><div class="controls bullet"><span class="by">bjornsing</span><span>|</span><a href="#42433458">root</a><span>|</span><a href="#42438752">parent</a><span>|</span><a href="#42438161">next</a><span>|</span><label class="collapse" for="c-42439240">[-]</label><label class="expand" for="c-42439240">[1 more]</label></div><br/><div class="children"><div class="content">When I said “runtime” and “program” I meant it. If I had meant process I would probably have used that word.</div><br/></div></div></div></div></div></div><div id="42433835" class="c"><input type="checkbox" id="c-42433835" checked=""/><div class="controls bullet"><span class="by">graemep</span><span>|</span><a href="#42433458">parent</a><span>|</span><a href="#42438161">prev</a><span>|</span><a href="#42433990">next</a><span>|</span><label class="collapse" for="c-42433835">[-]</label><label class="expand" for="c-42433835">[1 more]</label></div><br/><div class="children"><div class="content">From the paper it looks like this is for read heavy workloads (testing write performance is &quot;future work&quot;) and I think for network file systems which will add latency.</div><br/></div></div><div id="42433990" class="c"><input type="checkbox" id="c-42433990" checked=""/><div class="controls bullet"><span class="by">mamcx</span><span>|</span><a href="#42433458">parent</a><span>|</span><a href="#42433835">prev</a><span>|</span><a href="#42433531">next</a><span>|</span><label class="collapse" for="c-42433990">[-]</label><label class="expand" for="c-42433990">[3 more]</label></div><br/><div class="children"><div class="content">The complex thing with a transactional db is that <i>many</i> concurrent transactions (should be) executed simultaneously, and that mix that single query tx and the one that loads 1 million rows.</div><br/><div id="42434775" class="c"><input type="checkbox" id="c-42434775" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#42433458">root</a><span>|</span><a href="#42433990">parent</a><span>|</span><a href="#42433531">next</a><span>|</span><label class="collapse" for="c-42434775">[-]</label><label class="expand" for="c-42434775">[2 more]</label></div><br/><div class="children"><div class="content">The sqlite model is that only one write transaction can be run at a time. That&#x27;s kind of a defining trade-off because it allows simplifying locking.</div><br/><div id="42437984" class="c"><input type="checkbox" id="c-42437984" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433458">root</a><span>|</span><a href="#42434775">parent</a><span>|</span><a href="#42433531">next</a><span>|</span><label class="collapse" for="c-42437984">[-]</label><label class="expand" for="c-42437984">[1 more]</label></div><br/><div class="children"><div class="content">Pekka already experimented with MVCC and I expect it to make it to Limbo at some point to enable multiple concurrent writers</div><br/></div></div></div></div></div></div></div></div><div id="42434435" class="c"><input type="checkbox" id="c-42434435" checked=""/><div class="controls bullet"><span class="by">egeozcan</span><span>|</span><a href="#42433458">prev</a><span>|</span><a href="#42436966">next</a><span>|</span><label class="collapse" for="c-42434435">[-]</label><label class="expand" for="c-42434435">[13 more]</label></div><br/><div class="children"><div class="content">sqlite is open source, but an important test harness is not. How does any alternative ensure compatibility?<p><a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;th3.html#th3_license" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;th3.html#th3_license</a></div><br/><div id="42438029" class="c"><input type="checkbox" id="c-42438029" checked=""/><div class="controls bullet"><span class="by">yellowapple</span><span>|</span><a href="#42434435">parent</a><span>|</span><a href="#42437991">next</a><span>|</span><label class="collapse" for="c-42438029">[-]</label><label class="expand" for="c-42438029">[1 more]</label></div><br/><div class="children"><div class="content">Obvious answer would be to buy a license for TH3 and run its tests against the alternative in question, but unfortunately (judging by <a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;prosupport.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;prosupport.html</a>) it seems like Hwaci won&#x27;t provide direct access to TH3 unless you buy an SQLite Consortium membership for $120k&#x2F;year.</div><br/></div></div><div id="42437991" class="c"><input type="checkbox" id="c-42437991" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42434435">parent</a><span>|</span><a href="#42438029">prev</a><span>|</span><a href="#42434848">next</a><span>|</span><label class="collapse" for="c-42437991">[-]</label><label class="expand" for="c-42437991">[1 more]</label></div><br/><div class="children"><div class="content">My understanding was that th3 mainly does correctness tests. Other test suites are open source and can be used to ensure compatibility</div><br/></div></div><div id="42434848" class="c"><input type="checkbox" id="c-42434848" checked=""/><div class="controls bullet"><span class="by">krossitalk</span><span>|</span><a href="#42434435">parent</a><span>|</span><a href="#42437991">prev</a><span>|</span><a href="#42436966">next</a><span>|</span><label class="collapse" for="c-42434848">[-]</label><label class="expand" for="c-42434848">[10 more]</label></div><br/><div class="children"><div class="content">I argue it&#x27;s not Open Source (Freedom, not Free Beer) because PRs are locked and only Hipp and close contributors can merge code. 
It&#x27;s openly developed, but not by the community.</div><br/><div id="42435058" class="c"><input type="checkbox" id="c-42435058" checked=""/><div class="controls bullet"><span class="by">ijlx</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434848">parent</a><span>|</span><a href="#42435095">next</a><span>|</span><label class="collapse" for="c-42435058">[-]</label><label class="expand" for="c-42435058">[1 more]</label></div><br/><div class="children"><div class="content">You can certainly argue that, but that&#x27;s not what Open Source or Free Software has ever been. It&#x27;s about your freedoms as a user, you are always free to fork with a different model. I think the expectation of &quot;open contributions&quot; is quite damaging, to the point where peple&#x2F;organizations are hesitant to release their software as open source at all.</div><br/></div></div><div id="42435095" class="c"><input type="checkbox" id="c-42435095" checked=""/><div class="controls bullet"><span class="by">jefftk</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434848">parent</a><span>|</span><a href="#42435058">prev</a><span>|</span><a href="#42435062">next</a><span>|</span><label class="collapse" for="c-42435095">[-]</label><label class="expand" for="c-42435095">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not what Open Source means.  The development team not being willing to review your pull requests does not limit your freedom to use sqlite in any way.</div><br/></div></div><div id="42435062" class="c"><input type="checkbox" id="c-42435062" checked=""/><div class="controls bullet"><span class="by">samatman</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434848">parent</a><span>|</span><a href="#42435095">prev</a><span>|</span><a href="#42434955">next</a><span>|</span><label class="collapse" for="c-42435062">[-]</label><label class="expand" for="c-42435062">[1 more]</label></div><br/><div class="children"><div class="content">This is a case of you deciding that open source means something which it does not, never has, and will not mean.<p>I consider this an empty exercise, but if it pleases you to use language that way, no one can stop you.</div><br/></div></div><div id="42434955" class="c"><input type="checkbox" id="c-42434955" checked=""/><div class="controls bullet"><span class="by">jmcqk6</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434848">parent</a><span>|</span><a href="#42435062">prev</a><span>|</span><a href="#42437209">next</a><span>|</span><label class="collapse" for="c-42434955">[-]</label><label class="expand" for="c-42434955">[3 more]</label></div><br/><div class="children"><div class="content">sqlite is actually public domain.  <a href="https:&#x2F;&#x2F;sqlite.org&#x2F;copyright.html" rel="nofollow">https:&#x2F;&#x2F;sqlite.org&#x2F;copyright.html</a>. This is also the reason why they are closed contribution.<p>It&#x27;s a strange combination in the free software world, but I&#x27;m grateful for it.</div><br/><div id="42438188" class="c"><input type="checkbox" id="c-42438188" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434955">parent</a><span>|</span><a href="#42437209">next</a><span>|</span><label class="collapse" for="c-42438188">[-]</label><label class="expand" for="c-42438188">[2 more]</label></div><br/><div class="children"><div class="content">They aren’t closed for contribution.<p>From the author:
“They have a really high bar”, but are accepted, occasionally: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34480732">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34480732</a></div><br/><div id="42438594" class="c"><input type="checkbox" id="c-42438594" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42438188">parent</a><span>|</span><a href="#42437209">next</a><span>|</span><label class="collapse" for="c-42438594">[-]</label><label class="expand" for="c-42438594">[1 more]</label></div><br/><div class="children"><div class="content">but they also have this:<p>&gt; In order to keep SQLite completely free and unencumbered by copyright, the project does not accept patches. If you would like to suggest a change and you include a patch as a proof-of-concept, that would be great. However, please do not be offended if we rewrite your patch from scratch.<p><a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;copyright.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;copyright.html</a></div><br/></div></div></div></div></div></div><div id="42437209" class="c"><input type="checkbox" id="c-42437209" checked=""/><div class="controls bullet"><span class="by">neongreen</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42434848">parent</a><span>|</span><a href="#42434955">prev</a><span>|</span><a href="#42436966">next</a><span>|</span><label class="collapse" for="c-42437209">[-]</label><label class="expand" for="c-42437209">[3 more]</label></div><br/><div class="children"><div class="content">I’ll go a few steps further:<p>- it’s only <i>kinda</i> open source if it’s not on GitHub,<p>- it’s definitely not open source if it’s not in Git,<p>- but it can regain its open sourceness if it has an open Discord and the devs are hanging out there.<p>Here, all my heuristics exposed. (I’m not claiming they’re true or sensible, just saying what my brain thinks.)</div><br/><div id="42437476" class="c"><input type="checkbox" id="c-42437476" checked=""/><div class="controls bullet"><span class="by">ThinkBeat</span><span>|</span><a href="#42434435">root</a><span>|</span><a href="#42437209">parent</a><span>|</span><a href="#42436966">next</a><span>|</span><label class="collapse" for="c-42437476">[-]</label><label class="expand" for="c-42437476">[2 more]</label></div><br/><div class="children"><div class="content">The insanity of requiring an open source project to be
hosted on a proprietary for profit Microsoft social 
platform with git hosting makes my head hurt.</div><br/></div></div></div></div></div></div></div></div><div id="42436966" class="c"><input type="checkbox" id="c-42436966" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#42434435">prev</a><span>|</span><a href="#42438786">next</a><span>|</span><label class="collapse" for="c-42436966">[-]</label><label class="expand" for="c-42436966">[1 more]</label></div><br/><div class="children"><div class="content">I went down a rabbit hole one week trying to figure out if there was a simple pathway to making a JSON-like format that was just a strict subset of SQLite file format. I figured for read-only workloads, like edge networking situations, that this might be useful.<p>There&#x27;s a lot of arbitrariness to the file format though that made me quickly lose steam. But maybe someone with a more complementary form of stubbornness than mine could pull it off.</div><br/></div></div><div id="42438786" class="c"><input type="checkbox" id="c-42438786" checked=""/><div class="controls bullet"><span class="by">chistev</span><span>|</span><a href="#42436966">prev</a><span>|</span><a href="#42434930">next</a><span>|</span><label class="collapse" for="c-42438786">[-]</label><label class="expand" for="c-42438786">[1 more]</label></div><br/><div class="children"><div class="content">In my experience, Sqlite is faster than Postgres etc. No latency.</div><br/></div></div><div id="42434930" class="c"><input type="checkbox" id="c-42434930" checked=""/><div class="controls bullet"><span class="by">conradev</span><span>|</span><a href="#42438786">prev</a><span>|</span><a href="#42433631">next</a><span>|</span><label class="collapse" for="c-42434930">[-]</label><label class="expand" for="c-42434930">[2 more]</label></div><br/><div class="children"><div class="content">I wonder if using a different allocator in SQLite (<a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;malloc.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;malloc.html</a>) would improve performance in their workload to a greater degree than any amount of Rust or io_uring.<p>I can understand how io_uring increases server utilization, but I fail to see how it will make any individual query faster.</div><br/><div id="42436489" class="c"><input type="checkbox" id="c-42436489" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#42434930">parent</a><span>|</span><a href="#42433631">next</a><span>|</span><label class="collapse" for="c-42436489">[-]</label><label class="expand" for="c-42436489">[1 more]</label></div><br/><div class="children"><div class="content">- A &quot;individual query&quot; can be a very complex, turing-complete computer program. A single query may do &gt;1 IO operation like read or write more than one database page. io_uring &amp; async IO strategy would allow this work to occur concurrently.<p>- Even if no new op-codes are introduced and the design is basically exactly the same, io_uring could allow some amortization of syscall overhead. Doing (N ring-buffer prepares + N&#x2F;10 syscalls) instead of (N syscalls) will improve your straight-line speed.</div><br/></div></div></div></div><div id="42433631" class="c"><input type="checkbox" id="c-42433631" checked=""/><div class="controls bullet"><span class="by">01HNNWZ0MV43FF</span><span>|</span><a href="#42434930">prev</a><span>|</span><a href="#42433288">next</a><span>|</span><label class="collapse" for="c-42433631">[-]</label><label class="expand" for="c-42433631">[2 more]</label></div><br/><div class="children"><div class="content">I wonder why Limbo has an installer script and isn&#x27;t just `cargo install limbo`</div><br/><div id="42435391" class="c"><input type="checkbox" id="c-42435391" checked=""/><div class="controls bullet"><span class="by">01HNNWZ0MV43FF</span><span>|</span><a href="#42433631">parent</a><span>|</span><a href="#42433288">next</a><span>|</span><label class="collapse" for="c-42435391">[-]</label><label class="expand" for="c-42435391">[1 more]</label></div><br/><div class="children"><div class="content">Update: Checked out the script and it seems to just be for convenience and maybe compatibility with OSes that Cargo can compile for but not run on.<p>Seeing a curl pipe script makes me worry it&#x27;s going to ask for odd permissions, if I don&#x27;t also see something simpler like a binary download or cargo install. There is a zip for Windows so maybe the script is just for getting the binary.</div><br/></div></div></div></div><div id="42433288" class="c"><input type="checkbox" id="c-42433288" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#42433631">prev</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42433288">[-]</label><label class="expand" for="c-42433288">[18 more]</label></div><br/><div class="children"><div class="content">Are we sure edge computing providers have io_uring enabled? It is disabled in inter alia, ChromeOS and Android, because it&#x27;s been a significant source of vulnerabilities. Seems deadly in a multi tenant environment.</div><br/><div id="42433660" class="c"><input type="checkbox" id="c-42433660" checked=""/><div class="controls bullet"><span class="by">chambers</span><span>|</span><a href="#42433288">parent</a><span>|</span><a href="#42433673">next</a><span>|</span><label class="collapse" for="c-42433660">[-]</label><label class="expand" for="c-42433660">[4 more]</label></div><br/><div class="children"><div class="content">Not an expert at all: I wonder if getting the perf requires trading-off some (advertised) safety. IO uring has been noted to be confusing with async in Rust, <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=41992975">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=41992975</a><p>I&#x27;m reminded of how Confluent advertised Kafka as a database. They quietly externalized key guarantees of an RDBMS onto their customers, who were then saddled with implementing those guarantees in application level logic. By obscuring the trade-offs, Confluent made developers feel they could have their cake and eat it too.</div><br/><div id="42435453" class="c"><input type="checkbox" id="c-42435453" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42433660">parent</a><span>|</span><a href="#42433673">next</a><span>|</span><label class="collapse" for="c-42435453">[-]</label><label class="expand" for="c-42435453">[3 more]</label></div><br/><div class="children"><div class="content">IMHO, most of io_uring&#x27;s performance should come from reducing transition between kernel and userspace. There doesn&#x27;t need to be a safety tradeoff there (although in practice, there have been several safety issues). There may be a trade off against having a simple concurrency model; without io_uring you can&#x27;t really request an accept and not handle the response that comes back, because a syscall is necessarily synchronous from the point of view of the caller; the calling thread can&#x27;t continue until it gets a response, even if that&#x27;s EINTR.</div><br/><div id="42436183" class="c"><input type="checkbox" id="c-42436183" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42435453">parent</a><span>|</span><a href="#42433673">next</a><span>|</span><label class="collapse" for="c-42436183">[-]</label><label class="expand" for="c-42436183">[2 more]</label></div><br/><div class="children"><div class="content">Out of my league &#x2F; knowledge, but a tidbit that you might understand better: last time I mentioned this, someone said something about SELinux can&#x27;t do security checks and implied it&#x27;s some fundamental mismatch, rather than some work SELinux can do</div><br/><div id="42436644" class="c"><input type="checkbox" id="c-42436644" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42436183">parent</a><span>|</span><a href="#42433673">next</a><span>|</span><label class="collapse" for="c-42436644">[-]</label><label class="expand" for="c-42436644">[1 more]</label></div><br/><div class="children"><div class="content">Well I&#x27;m a little outside my league on SELinux, but as I understand it, SELinux a way to limit syscalls by configuration.<p>io_uring operations are similar to syscalls, but not exactly the same thing, so if I&#x27;ve read up correctly, I think SELinux originally may not have covered operations --- if the config allowed you to use io_uring, you could bypass SELinux restrictions, and the easiest&#x2F;safest thing to do for that is to restrict io_uring. I think this may have been resolved, it looks like there was work on SELinux controls for io_uring back in 2021 [1] that looks like it got merged, but I haven&#x27;t really followed this. There&#x27;s also the issue that what happened  in Linus&#x27;s tree 2021 doesn&#x27;t necessarily reflect what&#x27;s in common kernels in 2024; some distributions are built from ancient branches.<p>Based on the language in the pull request, I would think you&#x27;d end up needing to have near duplicate policy entries for regular syscalls and io_uring operations, which sounds tedious (but the whole SELinux thing sounds tedious to me, so I&#x27;m maybe not the right person to ask :D )<p>[1] <a href="https:&#x2F;&#x2F;lore.kernel.org&#x2F;lkml&#x2F;CAHC9VhRJ=fHzMHM6tt8JqkZa4bf0h72CAytSX9YrEs14Oaj8SA@mail.gmail.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;lore.kernel.org&#x2F;lkml&#x2F;CAHC9VhRJ=fHzMHM6tt8JqkZa4bf0h7...</a></div><br/></div></div></div></div></div></div></div></div><div id="42433673" class="c"><input type="checkbox" id="c-42433673" checked=""/><div class="controls bullet"><span class="by">eyberg</span><span>|</span><a href="#42433288">parent</a><span>|</span><a href="#42433660">prev</a><span>|</span><a href="#42435069">next</a><span>|</span><label class="collapse" for="c-42433673">[-]</label><label class="expand" for="c-42433673">[2 more]</label></div><br/><div class="children"><div class="content">Anything new is going to have people poking and prodding at it. It doesn&#x27;t mean that the concept is &#x27;bad&#x27;.<p>Linux has desperately needed an interface like io_uring for decades. Async IO was in Windows NT 3.1 in 1993.</div><br/><div id="42433761" class="c"><input type="checkbox" id="c-42433761" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42433673">parent</a><span>|</span><a href="#42435069">next</a><span>|</span><label class="collapse" for="c-42433761">[-]</label><label class="expand" for="c-42433761">[1 more]</label></div><br/><div class="children"><div class="content">Might&#x27;ve replied to the wrong comment: I don&#x27;t think io_uring is bad, and the comment doesn&#x27;t contain &#x27;bad&#x27;, and I certainly don&#x27;t think async IO is bad :)</div><br/></div></div></div></div><div id="42435069" class="c"><input type="checkbox" id="c-42435069" checked=""/><div class="controls bullet"><span class="by">saurik</span><span>|</span><a href="#42433288">parent</a><span>|</span><a href="#42433673">prev</a><span>|</span><a href="#42433563">next</a><span>|</span><label class="collapse" for="c-42435069">[-]</label><label class="expand" for="c-42435069">[2 more]</label></div><br/><div class="children"><div class="content">Amazon runs every Lambda function in it&#x27;s own microVM.</div><br/><div id="42438207" class="c"><input type="checkbox" id="c-42438207" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42435069">parent</a><span>|</span><a href="#42433563">next</a><span>|</span><label class="collapse" for="c-42438207">[-]</label><label class="expand" for="c-42438207">[1 more]</label></div><br/><div class="children"><div class="content">Every simultaneous request is in its own microVM, making concurrency a non-issue &#x2F; thing to optimize in most cases at the function level.</div><br/></div></div></div></div><div id="42433563" class="c"><input type="checkbox" id="c-42433563" checked=""/><div class="controls bullet"><span class="by">ncruces</span><span>|</span><a href="#42433288">parent</a><span>|</span><a href="#42435069">prev</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42433563">[-]</label><label class="expand" for="c-42433563">[9 more]</label></div><br/><div class="children"><div class="content">Their goal is to run this on their own cloud.<p>Despite their lofty claims about community building, their projects are very much about forwarding their use case.<p>Given that SQLite is public domain, they&#x27;re not required to give anything back. So, it&#x27;s very cool that they&#x27;re making parts of their tech FOSS.<p>But I&#x27;ve yet to see anything coming from them that isn&#x27;t “just because we need it, and SQLite wouldn&#x27;t do it for us.”<p>There&#x27;s little concern about making things useful to others, and very little community consensus about any of it.<p><a href="https:&#x2F;&#x2F;turso.tech&#x2F;" rel="nofollow">https:&#x2F;&#x2F;turso.tech&#x2F;</a></div><br/><div id="42435088" class="c"><input type="checkbox" id="c-42435088" checked=""/><div class="controls bullet"><span class="by">nindalf</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42433563">parent</a><span>|</span><a href="#42434714">next</a><span>|</span><label class="collapse" for="c-42435088">[-]</label><label class="expand" for="c-42435088">[4 more]</label></div><br/><div class="children"><div class="content">I think you&#x27;ve taken the most cynical view possible.<p>SQLite is open source but not open contribution. So if they &quot;won&#x27;t do it for us&quot; and &quot;we need it&quot;, what else are they supposed to do? They&#x27;re offering SQLite in the cloud, obviously they need to offer a streaming backup solution. Is there something wrong in building that?<p>Alternatively, do you want them to reimplement features in SQLite already built out by the SQLite team?<p>Really sounds like you&#x27;re complaining about getting an open source, MIT licensed, open contribution bit of software <i>for free</i> that you&#x27;re under no obligation to use. And here you are complaining about &quot;community consensus&quot;.</div><br/><div id="42436034" class="c"><input type="checkbox" id="c-42436034" checked=""/><div class="controls bullet"><span class="by">adamrezich</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42435088">parent</a><span>|</span><a href="#42435235">next</a><span>|</span><label class="collapse" for="c-42436034">[-]</label><label class="expand" for="c-42436034">[2 more]</label></div><br/><div class="children"><div class="content">The problem is that SQLite already exists, and is public domain. It&#x27;s a fantastic piece of software engineering that has had a lot of time and effort put into making it great.<p>The pitch for these SQLite alternatives is:<p>- SQLite is public domain so there&#x27;s no problem with us rewriting it<p>- We&#x27;re going to rewrite it in Rust because that&#x27;s going to make it inherently better (and don&#x27;t question this)<p>- We&#x27;re going to MIT license our rewrite because there&#x27;s various reasons why people would rather use MIT-licensed code than public domain code (but SQLite being public domain means we get to do all of this rewriting and re-licensing to begin with)<p>- Also we&#x27;re going to extend SQLite to be “cloud-capable” because that&#x27;s our business use-case, even though it&#x27;s completely at odds with SQLite&#x27;s intended use-case<p>- Also we&#x27;re going to foster a “community” around our rewrite(-in-progress) (because people still think this is something desirable for some reason, as though a nonzero part of SQLite&#x27;s greatness is that it operates entirely without having do deal with “nerd drama” that such “communities” inevitably breed)<p>- Also, we replaced that pesky, unsavory-to-our-sensibilities “Code of Ethics” with a bog-standard “Code of Conduct”—because, again: “community”<p>- But we&#x27;re not going to even <i>attempt</i> to replicate the rigorous, arduous, and closed-source testing that goes into developing SQLite (which really makes up the bulk of its engineering effort)<p>- We&#x27;ve made some progress toward all of this, but it&#x27;s nowhere near done yet<p>- But we&#x27;re announcing it now anyway, because “hype” and “community” and “modern”<p>- Also, look at our microbenchmarks that show that our unfinished SQLite rewrite is already faster than SQLite (because we haven&#x27;t reimplemented everything from SQLite yet) (and also we don&#x27;t plan to reimplement <i>everything</i> from SQLite anyway)<p>I find it really odd that I can only seems to find criticism of any of this here on HN, and in a couple of reddit threads. It&#x27;s kind of like when there was that Godot controversy awhile back, and some people made a fork and announced it, despite being identical aside from the Code of Conduct. Merely <i>announcing</i> a fork&#x2F;rewrite of existing open-source software as a means of &quot;building hype&quot; and “creating a community”, while benefiting from untold man-hours of work done by others, strikes me personally as rather untoward behavior—regardless of whether the reasoning behind said fork&#x2F;rewrite is ideological (Redot) or business (libSQL&#x2F;“Limbo”).<p>Software—especially software used to create other software—should be lauded for its engineering efforts, rather than its ability to “build hype” or “build and foster online ‘community’ ‘engagement’”. If SQLite was abandonware, then it would be a somewhat different story, but SQLite is an amazing piece of software—perhaps the most widely-used <i>on the planet</i>—that is still being actively developed and supported. So, piggybacking on its success, without having concrete, demonstrable improvements to its functionality, comes across as… well, I can&#x27;t think of another polite, applicable adjective than “untoward”.</div><br/><div id="42439519" class="c"><input type="checkbox" id="c-42439519" checked=""/><div class="controls bullet"><span class="by">nindalf</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42436034">parent</a><span>|</span><a href="#42435235">next</a><span>|</span><label class="collapse" for="c-42439519">[-]</label><label class="expand" for="c-42439519">[1 more]</label></div><br/><div class="children"><div class="content">&gt; we&#x27;re not going to even attempt to replicate the rigorous, arduous, and closed-source testing<p>Almost everything you&#x27;ve said is wrong, but this one is trivially easy to prove wrong. You say &quot;not even going to attempt&quot; but they plan to take testing seriously from the get go. They say:<p>&gt; Since this is a reimplementation, doesn’t that mean that testing is now even harder? The reality is that it is the other way around. Since we are reimplementing it from scratch, we are doing it with Deterministic Simulation Testing (DST) built-in from the get-go. We have both added DST facilities to the core of the database, and partnered with Antithesis to achieve a level of reliability in the database that lives up to SQLite’s reputation.<p>&gt; Deterministic Simulation Testing is a paradigm made famous by the folks at TigerBeetle, that we at Turso already dipped our toes into with our server-side code. With DST, we believe we can achieve an even higher degree of robustness than SQLite, since it is easier to simulate unlikely scenarios in a simulator, test years of execution with different event orderings, and upon finding issues, reproduce them 100% reliably.<p>Did you make your false claim in ignorance of their post (<a href="https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;introducing-limbo-a-complete-rewrite-of-sqlite-in-rust" rel="nofollow">https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;introducing-limbo-a-complete-rewrite...</a>), or did you make it knowing full well that they&#x27;re trying hard to make a well tested library?</div><br/></div></div></div></div><div id="42435235" class="c"><input type="checkbox" id="c-42435235" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42435088">parent</a><span>|</span><a href="#42436034">prev</a><span>|</span><a href="#42434714">next</a><span>|</span><label class="collapse" for="c-42435235">[-]</label><label class="expand" for="c-42435235">[1 more]</label></div><br/><div class="children"><div class="content">I may be able to shed some light.<p>It seems they proposed a way to resolve the contradiction I raised (io_uring isn&#x27;t supported on cloud providers) with the ground reality in the company&#x27;s blog post.<p>Namely, that:<p>* it is intended for edge function deployment.<p>* the paper they mention that is informing their decision to rewrite is based on perf improvements in the longtail by using io_uring.<p>I framed it as &quot;Are we sure...?&quot;, but truth is, I know providers don&#x27;t have io_uring support. This is relatively straightforward to derive from edge functions are well-known to be multi-tenant.<p>A cursory search shows unresolved AWS tickets re: this, and multiple announcements from Google about how it has been disabled in gCloud.<p>Thus, it is likely they understood I was framing it politely, and that there was a clear contradiction here, hence their reply to me, raising a potential resolution for that contradiction, a resolution I hadn&#x27;t considered.<p>I don&#x27;t see anything complaining, or bringing up, or implicitly denying, all the other stuff (&quot;open source&quot;, &quot;MIT licensed&quot;, &quot;open contribution&quot;, &quot;software for free&quot; &quot;under no obligation to use.&quot;). In fact, they explicitly indicated they completely agree with that view (&quot;it&#x27;s very cool that they&#x27;re making parts of their tech FOSS.&quot;)</div><br/></div></div></div></div><div id="42434714" class="c"><input type="checkbox" id="c-42434714" checked=""/><div class="controls bullet"><span class="by">tracker1</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42433563">parent</a><span>|</span><a href="#42435088">prev</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42434714">[-]</label><label class="expand" for="c-42434714">[4 more]</label></div><br/><div class="children"><div class="content">Of course they are scratching their own itch, so to speak.  Thats what companies do.  I think the fact that they are doing so much in the open is the indication of good stewardship itself.  I&#x27;m not sure what else they would do or release that they didn&#x27;t need internally.  For that matter, I&#x27;m not really aware of many significant contributions to FLOSS at all that aren&#x27;t initially intended for company use, that&#x27;s kinda how it works.  Where I&#x27;m surprised here is how much secret sauce Turso is sharing at all.</div><br/><div id="42436012" class="c"><input type="checkbox" id="c-42436012" checked=""/><div class="controls bullet"><span class="by">ncruces</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42434714">parent</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42436012">[-]</label><label class="expand" for="c-42436012">[3 more]</label></div><br/><div class="children"><div class="content">I have no problem with them scratching their itch. That&#x27;s par for the course.<p>I&#x27;m salty about them describing the SQLite licensing, development model, and code of ethics as almost toxic, setting up a separate entity with a website and a manifesto promising to do better, and then folding “libSQL into the Turso family” within the year.<p>They forked, played politics, added a few features (with some ill-considered incompatibilities), and properly documented <i>zero</i> of them.<p>And I&#x27;m salty because I&#x27;m actually interested in some of those features, and they&#x27;re impossible to use without proper documentation.<p>I&#x27;ve had <i>much</i> better luck interacting with SQLite developers in the SQLite forum.</div><br/><div id="42437906" class="c"><input type="checkbox" id="c-42437906" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42436012">parent</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42437906">[-]</label><label class="expand" for="c-42437906">[2 more]</label></div><br/><div class="children"><div class="content">disclosure: I work at Turso<p>&gt;  code of ethics as almost toxic<p>This is simply not true. Can you tell me where it is being said so?<p>&gt;  then folding “libSQL into the Turso family” within the year.<p>libSQL was always part of Turso. So, I don&#x27;t get your point.<p>&gt; They forked, played politics, added a few features (with some ill-considered incompatibilities), and properly documented zero of them.<p>Again this is incorrect. There are some docs here: <a href="https:&#x2F;&#x2F;github.com&#x2F;tursodatabase&#x2F;libsql&#x2F;tree&#x2F;main&#x2F;docs">https:&#x2F;&#x2F;github.com&#x2F;tursodatabase&#x2F;libsql&#x2F;tree&#x2F;main&#x2F;docs</a><p>I am really not sure why are you so angry about libSQL.</div><br/><div id="42439423" class="c"><input type="checkbox" id="c-42439423" checked=""/><div class="controls bullet"><span class="by">ncruces</span><span>|</span><a href="#42433288">root</a><span>|</span><a href="#42437906">parent</a><span>|</span><a href="#42435081">next</a><span>|</span><label class="collapse" for="c-42439423">[-]</label><label class="expand" for="c-42439423">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This is simply not true. Can you tell me where it is being said so?<p>It&#x27;s right there in “your” manifesto.
<a href="https:&#x2F;&#x2F;turso.tech&#x2F;libsql-manifesto" rel="nofollow">https:&#x2F;&#x2F;turso.tech&#x2F;libsql-manifesto</a><p>&gt; We take our code of conduct seriously, and unlike SQLite, we do not substitute it with an unclear alternative. We strive to foster a community that values diversity, equity, and inclusion. We encourage others to speak up if they feel uncomfortable.<p>The word toxic clearly stung, but putting “unlike SQLite … we encourage others to speak up if they feel uncomfortable” in a manifesto is fine. Well, I could argue I&#x27;m just speaking up.<p>&gt; libSQL was always part of Turso. So, I don&#x27;t get your point.<p>My point is explained quite clearly in your post detailing the decision.
<a href="https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;were-bringing-libsql-into-the-turso-family-8cc1a653448e" rel="nofollow">https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;were-bringing-libsql-into-the-turso-...</a><p>&gt; We have our own self interest in making those changes (…) But we also wanted to create a welcoming community, that is open to everybody, abides by a modern code of conduct and a clear OSS license, and reimagined what SQLite could be in broader ways than just our narrow needs.<p>A little latter down that line you sum it up: doing the above (living up to your grandiose claims of a more welcoming SQLite) “meant twice the investment” (aka a lot of money) and didn&#x27;t pan out as a marketing play (showed engagement).<p>So instead of a community that “reimagined what SQLite could be in broader ways than just our narrow needs&quot; we just get the features you had your &quot;own self interest in making.&quot;<p>Which is fine, but doesn&#x27;t really match the manifesto.<p>&gt; Again this is incorrect. There are some docs…<p>Emphasis on some.<p>Do you have any documentation on how to build on the Virtual WAL (internal SQLite API that you simply opened up)? Or is that&#x27;s still a Rust example of an implementation that simply wraps another and logs without detailing anything beyond function names?<p>Do you have any documentation about the new WAL API that isn&#x27;t &quot;libsql_wal_insert_begin begins WAL insertion&quot;?<p>I&#x27;m sorry, but goal here isn&#x27;t to make things useful to others. Which is fine really: you&#x27;re doing more than you&#x27;re required. But compared to SQLite developers, and their forum, it&#x27;s not much.<p>PS: you also behaved… untowardly when you integrated SQLite3MultipleCiphers, and did this with not previous a word to the author.
<a href="https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;fully-open-source-encryption-for-sqlite-b3858225" rel="nofollow">https:&#x2F;&#x2F;turso.tech&#x2F;blog&#x2F;fully-open-source-encryption-for-sql...</a><p>&gt; One project in particular was very suitable for us, SQLite Multiple Ciphers. Since it is licensed under MIT, we have just moved the code into libSQL.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="42435081" class="c"><input type="checkbox" id="c-42435081" checked=""/><div class="controls bullet"><span class="by">meneer_oke</span><span>|</span><a href="#42433288">prev</a><span>|</span><a href="#42436947">next</a><span>|</span><label class="collapse" for="c-42435081">[-]</label><label class="expand" for="c-42435081">[3 more]</label></div><br/><div class="children"><div class="content">Just this weekend I had the perfect problem for sqlite, unfortunately 200MB and above it became unwieldy.</div><br/><div id="42436830" class="c"><input type="checkbox" id="c-42436830" checked=""/><div class="controls bullet"><span class="by">tomcam</span><span>|</span><a href="#42435081">parent</a><span>|</span><a href="#42435526">next</a><span>|</span><label class="collapse" for="c-42436830">[-]</label><label class="expand" for="c-42436830">[1 more]</label></div><br/><div class="children"><div class="content">I’d like to hear more about this</div><br/></div></div></div></div><div id="42436947" class="c"><input type="checkbox" id="c-42436947" checked=""/><div class="controls bullet"><span class="by">sqliteoldtimr</span><span>|</span><a href="#42435081">prev</a><span>|</span><a href="#42434970">next</a><span>|</span><label class="collapse" for="c-42436947">[-]</label><label class="expand" for="c-42436947">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve seen this show before. Let&#x27;s async all the things IO and not pay attention to database integrity and reliably fsync&#x27;ing with storage. I look forward to drh&#x27;s rebuttal.</div><br/><div id="42437948" class="c"><input type="checkbox" id="c-42437948" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42436947">parent</a><span>|</span><a href="#42436991">next</a><span>|</span><label class="collapse" for="c-42437948">[-]</label><label class="expand" for="c-42437948">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Let&#x27;s async all the things IO and not pay attention to database integrity and reliably fsync&#x27;ing with storage<p>I am not sure how does this affect database integrity or reliably fsync-ing<p>for e.g. TigerBeetle is another rock solid database which uses async IO. I mentioning it because it is way more mature than Limbo and does a great job at durability</div><br/></div></div><div id="42436991" class="c"><input type="checkbox" id="c-42436991" checked=""/><div class="controls bullet"><span class="by">adgjlsfhk1</span><span>|</span><a href="#42436947">parent</a><span>|</span><a href="#42437948">prev</a><span>|</span><a href="#42436984">next</a><span>|</span><label class="collapse" for="c-42436991">[-]</label><label class="expand" for="c-42436991">[1 more]</label></div><br/><div class="children"><div class="content">IIUC this is only about read performance. It&#x27;s totally fine to async all your reads as long as (like SQLite does) you have a Reader-Writer lock and verify integrity properly on writes.</div><br/></div></div><div id="42436984" class="c"><input type="checkbox" id="c-42436984" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#42436947">parent</a><span>|</span><a href="#42436991">prev</a><span>|</span><a href="#42434970">next</a><span>|</span><label class="collapse" for="c-42436984">[-]</label><label class="expand" for="c-42436984">[1 more]</label></div><br/><div class="children"><div class="content">Jepsen will have interesting things to say as well.</div><br/></div></div></div></div><div id="42434970" class="c"><input type="checkbox" id="c-42434970" checked=""/><div class="controls bullet"><span class="by">TheRealPomax</span><span>|</span><a href="#42436947">prev</a><span>|</span><a href="#42434272">next</a><span>|</span><label class="collapse" for="c-42434970">[-]</label><label class="expand" for="c-42434970">[8 more]</label></div><br/><div class="children"><div class="content">So... did they talk to the SQLite maintainer to see how much of this can be taken on board? Because it seems weird to omit that if they did, and it seems even weirder if they didn&#x27;t after benchmarking showed two orders of magnitude improvement.<p>(Even if that information should only be a line item in the paper, I don&#x27;t see one... and a post _about_ the paper should definitely have something to link to?)</div><br/><div id="42435118" class="c"><input type="checkbox" id="c-42435118" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#42434970">parent</a><span>|</span><a href="#42434272">next</a><span>|</span><label class="collapse" for="c-42435118">[-]</label><label class="expand" for="c-42435118">[7 more]</label></div><br/><div class="children"><div class="content">They&#x27;re rewriting SQLite. They&#x27;re going to put their effort into that surely? Also SQLite explicitly state that they do not accept outside contributions, so there&#x27;s no point trying.</div><br/><div id="42437153" class="c"><input type="checkbox" id="c-42437153" checked=""/><div class="controls bullet"><span class="by">f30e3dfed1c9</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42435118">parent</a><span>|</span><a href="#42438234">next</a><span>|</span><label class="collapse" for="c-42437153">[-]</label><label class="expand" for="c-42437153">[4 more]</label></div><br/><div class="children"><div class="content">It is not quite correct to say that the sqlite project does not accept outside contributions at all. The web site says &quot;the project does not accept patches from people who have not submitted an affidavit dedicating their contribution into the public domain.&quot;</div><br/><div id="42439220" class="c"><input type="checkbox" id="c-42439220" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42437153">parent</a><span>|</span><a href="#42437931">next</a><span>|</span><label class="collapse" for="c-42439220">[-]</label><label class="expand" for="c-42439220">[1 more]</label></div><br/><div class="children"><div class="content">Read further:<p>&gt; In order to keep SQLite completely free and unencumbered by copyright, the project does not accept patches.</div><br/></div></div><div id="42437931" class="c"><input type="checkbox" id="c-42437931" checked=""/><div class="controls bullet"><span class="by">avinassh</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42437153">parent</a><span>|</span><a href="#42439220">prev</a><span>|</span><a href="#42438234">next</a><span>|</span><label class="collapse" for="c-42437931">[-]</label><label class="expand" for="c-42437931">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The web site says &quot;the project does not accept patches from people who have not submitted an affidavit dedicating their contribution into the public domain.&quot;<p>I have been always curious about this. Is there any more public information to this? When one submits a affidavit, do all their work become public domain? Do you highlight the code and get a affidavit with each contribution?<p>for e.g. in my country India, I don&#x27;t think it is not possible to get such Govt approved affidavit.</div><br/><div id="42438213" class="c"><input type="checkbox" id="c-42438213" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42437931">parent</a><span>|</span><a href="#42438234">next</a><span>|</span><label class="collapse" for="c-42438213">[-]</label><label class="expand" for="c-42438213">[1 more]</label></div><br/><div class="children"><div class="content">The author of SQLite commented here about accepting contributions:<p>“They have a really high bar”, but are accepted, occasionally: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34480732">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34480732</a></div><br/></div></div></div></div></div></div><div id="42438234" class="c"><input type="checkbox" id="c-42438234" checked=""/><div class="controls bullet"><span class="by">TheRealPomax</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42435118">parent</a><span>|</span><a href="#42437153">prev</a><span>|</span><a href="#42434272">next</a><span>|</span><label class="collapse" for="c-42438234">[-]</label><label class="expand" for="c-42438234">[2 more]</label></div><br/><div class="children"><div class="content">Except that is not what SQLite states at all. They accept outside work provided the contributors waive their rights to the code by dedicating it to the public domain, and it&#x27;s a high quality contribution. Which makes a whole lot of sense when the entire planet uses it. And of course, this is an academic publication so those requirements are basically lowest bar if you&#x27;re serious. And consulting with your primary source during the research and iteration phase(s) and mentioning that in your publication is <i>kind of</i> expected?</div><br/><div id="42439226" class="c"><input type="checkbox" id="c-42439226" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#42434970">root</a><span>|</span><a href="#42438234">parent</a><span>|</span><a href="#42434272">next</a><span>|</span><label class="collapse" for="c-42439226">[-]</label><label class="expand" for="c-42439226">[1 more]</label></div><br/><div class="children"><div class="content">I quote:<p>&gt; In order to keep SQLite completely free and unencumbered by copyright, the project does not accept patches.</div><br/></div></div></div></div></div></div></div></div><div id="42434272" class="c"><input type="checkbox" id="c-42434272" checked=""/><div class="controls bullet"><span class="by">zeroq</span><span>|</span><a href="#42434970">prev</a><span>|</span><a href="#42435451">next</a><span>|</span><label class="collapse" for="c-42434272">[-]</label><label class="expand" for="c-42434272">[1 more]</label></div><br/><div class="children"><div class="content">Much better framing than the previous &quot;yet another library rewritten in Rust&quot;</div><br/></div></div><div id="42434716" class="c"><input type="checkbox" id="c-42434716" checked=""/><div class="controls bullet"><span class="by">jppope</span><span>|</span><a href="#42435451">prev</a><span>|</span><label class="collapse" for="c-42434716">[-]</label><label class="expand" for="c-42434716">[15 more]</label></div><br/><div class="children"><div class="content">&gt; &quot;However, the authors argue that KV doesn’t suit all problem domains. Mapping table-like data into a KV model leads to poor developer experience and (de)serialization costs. SQL would be much better, and SQLite being embedded solves this—it can be directly embedded in the serverless runtime.&quot;<p>The levels people will go to to so that they can use SQL never ceases to astound me.</div><br/><div id="42435262" class="c"><input type="checkbox" id="c-42435262" checked=""/><div class="controls bullet"><span class="by">liontwist</span><span>|</span><a href="#42434716">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42435262">[-]</label><label class="expand" for="c-42435262">[10 more]</label></div><br/><div class="children"><div class="content">Relations are one of the most efficient and flexible ways to represent arbitrary graphs.<p>In my experience Everyone goes to incredible lengths to avoid sql, in ignorance of this fact.<p>They store (key, value) tables they they then extract into an object graph.</div><br/><div id="42436270" class="c"><input type="checkbox" id="c-42436270" checked=""/><div class="controls bullet"><span class="by">LudwigNagasena</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42435262">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436270">[-]</label><label class="expand" for="c-42436270">[9 more]</label></div><br/><div class="children"><div class="content">Relations are cool, but SQL DBs either prohibit or make it hard to present relations inside relations, which is one of the most common ways of structuring data in everyday programming life. You can see people suggesting writing SQL functions that convert rows to json or using ORM simply to query a one-to-many relationship, that&#x27;s crazy: <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;54601529&#x2F;efficiently-mapping-one-to-many-many-to-many-database-to-struct-in-golang" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;54601529&#x2F;efficiently-map...</a></div><br/><div id="42436314" class="c"><input type="checkbox" id="c-42436314" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436270">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436314">[-]</label><label class="expand" for="c-42436314">[8 more]</label></div><br/><div class="children"><div class="content">Any tool can be used incorrectly...<p>Im not sure what relations in relations mean. Do you just mean M:N?</div><br/><div id="42436402" class="c"><input type="checkbox" id="c-42436402" checked=""/><div class="controls bullet"><span class="by">LudwigNagasena</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436314">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436402">[-]</label><label class="expand" for="c-42436402">[7 more]</label></div><br/><div class="children"><div class="content">I mean &#x27;tables&#x27; inside &#x27;tables&#x27;, 0NF. If I have a list of restaurants with their reviews, naturally, I have a table of restaurants, each of which contains a table of reviews. If I have a table of nested comments, naturally, I have a table of comments, each of which recursively contains a table of child comments.<p>Those are some of the most common use cases for data presentation; and SQL-based DBs are not flexible enough to handle them in a straightforward way.</div><br/><div id="42438486" class="c"><input type="checkbox" id="c-42438486" checked=""/><div class="controls bullet"><span class="by">yellowapple</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436402">parent</a><span>|</span><a href="#42436558">next</a><span>|</span><label class="collapse" for="c-42438486">[-]</label><label class="expand" for="c-42438486">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    PRAGMA foreign_keys = ON;
</code></pre>
&gt; If I have a list of restaurants with their reviews, naturally, I have a table of restaurants, each of which contains a table of reviews.<p><pre><code>    CREATE TABLE restaurants (id INTEGER PRIMARY KEY, name);
    CREATE TABLE reviews (timestamp, restaurant REFERENCES restaurants(id), stars, message);
    INSERT INTO restaurants (name) VALUES (...);
    INSERT INTO reviews (timestamp, restaurant, stars, message) VALUES (...);
    SELECT rv.timestamp, rv.stars, rv.message FROM reviews AS rv, restaurants AS rs WHERE rv.restaurant = rs.id AND rs.name = &quot;Foo&#x27;s Bar-B-Q&quot;;
</code></pre>
&gt; If I have a table of nested comments, naturally, I have a table of comments, each of which recursively contains a table of child comments.<p><pre><code>    CREATE TABLE comments (id INTEGER PRIMARY KEY, parent REFERENCES comments(id), body);
    INSERT INTO comments (parent, body) VALUES (...);
    WITH RECURSIVE tree AS (
        SELECT id, parent, body, CAST(id AS TEXT) AS sequence FROM comments WHERE parent IS NULL
        UNION ALL
        SELECT c.id, c.parent, c.body, (sequence || &#x27;-&#x27; || c.id) AS sequence FROM comments AS c JOIN tree AS t ON t.id = c.parent
    )
    SELECT t.sequence, t.body FROM tree AS t LEFT JOIN comments ON t.parent = comments.id ORDER BY t.sequence;
</code></pre>
Point being: what one &quot;naturally&quot; has is a matter of perspective.  Trees can always be flattened into tables that reference other tables (or even themselves).</div><br/></div></div><div id="42436558" class="c"><input type="checkbox" id="c-42436558" checked=""/><div class="controls bullet"><span class="by">liontwist</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436402">parent</a><span>|</span><a href="#42438486">prev</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436558">[-]</label><label class="expand" for="c-42436558">[5 more]</label></div><br/><div class="children"><div class="content">No. This is binding your data structure to a single access pattern. You can get all the reviews for a restaurant. Now what if you want all the reviews left by a particular user?<p>I invite you to read the original relational database paper which addresses this exact use case:  <i>A Relational Model of Data for Large Shared Data Banks</i></div><br/><div id="42436731" class="c"><input type="checkbox" id="c-42436731" checked=""/><div class="controls bullet"><span class="by">LudwigNagasena</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436558">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436731">[-]</label><label class="expand" for="c-42436731">[4 more]</label></div><br/><div class="children"><div class="content">Storing such data structure would be binding to a single access pattern, I agree. But a query to retrieve such structure is simply convoluted for no reason to the point of many people resorting to hacks like json_agg.</div><br/><div id="42436804" class="c"><input type="checkbox" id="c-42436804" checked=""/><div class="controls bullet"><span class="by">liontwist</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436731">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42436804">[-]</label><label class="expand" for="c-42436804">[3 more]</label></div><br/><div class="children"><div class="content">Make a SQL view for the tree and a function in the client application which can read a tree in its linear projected form.</div><br/><div id="42437121" class="c"><input type="checkbox" id="c-42437121" checked=""/><div class="controls bullet"><span class="by">LudwigNagasena</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42436804">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42437121">[-]</label><label class="expand" for="c-42437121">[2 more]</label></div><br/><div class="children"><div class="content">If SQL were flexible, I wouldn’t need to create a whole view for a single query.</div><br/><div id="42437614" class="c"><input type="checkbox" id="c-42437614" checked=""/><div class="controls bullet"><span class="by">liontwist</span><span>|</span><a href="#42434716">root</a><span>|</span><a href="#42437121">parent</a><span>|</span><a href="#42435074">next</a><span>|</span><label class="collapse" for="c-42437614">[-]</label><label class="expand" for="c-42437614">[1 more]</label></div><br/><div class="children"><div class="content">You’re telling me there are two presentations of reviews (by restaurant and by user) but it’s too much work to define a query for those two views.<p>I guess your app can just not support that feature and keep the tree? What do you want to hear?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="42435074" class="c"><input type="checkbox" id="c-42435074" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#42434716">parent</a><span>|</span><a href="#42435262">prev</a><span>|</span><a href="#42437311">next</a><span>|</span><label class="collapse" for="c-42435074">[-]</label><label class="expand" for="c-42435074">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Mapping table-like data into a KV model leads to poor developer experience<p>This is definitely true in my experience. Unless you are literally storing a hashmap, KV databases are a pain to use directly. I think they&#x27;re meant to be building blocks for other databases.</div><br/></div></div><div id="42437311" class="c"><input type="checkbox" id="c-42437311" checked=""/><div class="controls bullet"><span class="by">aidenn0</span><span>|</span><a href="#42434716">parent</a><span>|</span><a href="#42435074">prev</a><span>|</span><a href="#42436291">next</a><span>|</span><label class="collapse" for="c-42437311">[-]</label><label class="expand" for="c-42437311">[1 more]</label></div><br/><div class="children"><div class="content">SQLite is smaller than many KV store libraries to begin with, and KV is a degenerate case of relational data.</div><br/></div></div><div id="42436291" class="c"><input type="checkbox" id="c-42436291" checked=""/><div class="controls bullet"><span class="by">bawolff</span><span>|</span><a href="#42434716">parent</a><span>|</span><a href="#42437311">prev</a><span>|</span><a href="#42435387">next</a><span>|</span><label class="collapse" for="c-42436291">[-]</label><label class="expand" for="c-42436291">[1 more]</label></div><br/><div class="children"><div class="content">Trying to put relational data into K-V store is always going to be a crazy mess. Even if the language used was not SQL, it would still obviously be a good idea to use the right type of database for your problem space.</div><br/></div></div><div id="42435387" class="c"><input type="checkbox" id="c-42435387" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#42434716">parent</a><span>|</span><a href="#42436291">prev</a><span>|</span><label class="collapse" for="c-42435387">[-]</label><label class="expand" for="c-42435387">[1 more]</label></div><br/><div class="children"><div class="content">I mean, if SQL is a good match for the data, embedding a database engine designed to be embedded doesn&#x27;t seem like too far of a reach?</div><br/></div></div></div></div></div></div></div></div></div></body></html>