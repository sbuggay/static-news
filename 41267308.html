<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1723885262457" as="style"/><link rel="stylesheet" href="styles.css?v=1723885262457"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://martinfowler.com/articles/lmax.html">The LMAX Architecture (2011)</a> <span class="domain">(<a href="https://martinfowler.com">martinfowler.com</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>27 comments</span></div><br/><div><div id="41268799" class="c"><input type="checkbox" id="c-41268799" checked=""/><div class="controls bullet"><span class="by">bostik</span><span>|</span><a href="#41268729">next</a><span>|</span><label class="collapse" for="c-41268799">[-]</label><label class="expand" for="c-41268799">[8 more]</label></div><br/><div class="children"><div class="content">It is quite fitting that another HN darling, Jane Street, uses similar architecture in their exchange(s).<p>Event input queue, fully deterministic matching engine, and an output queue. Plus importantly, a sequencer to guarantee that the events going into the input queue have a known order.<p>Aspects of their architecture and design decisions have been made public through their podcast series, Signals and Threads.[0]<p>0: <a href="https:&#x2F;&#x2F;signalsandthreads.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;signalsandthreads.com&#x2F;</a></div><br/><div id="41269710" class="c"><input type="checkbox" id="c-41269710" checked=""/><div class="controls bullet"><span class="by">jnordwick</span><span>|</span><a href="#41268799">parent</a><span>|</span><a href="#41268729">next</a><span>|</span><label class="collapse" for="c-41269710">[-]</label><label class="expand" for="c-41269710">[7 more]</label></div><br/><div class="children"><div class="content">This isn&#x27;t even close to unique. I[&#x27;ve worked at a few HFT&#x2F;MM places that all had a similar architecture in place before LMAX wrote this. This, multicast rings, and other patters are copied a lot in the industry because they work well for the problem space.</div><br/><div id="41270436" class="c"><input type="checkbox" id="c-41270436" checked=""/><div class="controls bullet"><span class="by">bostik</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41269710">parent</a><span>|</span><a href="#41271026">next</a><span>|</span><label class="collapse" for="c-41270436">[-]</label><label class="expand" for="c-41270436">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not surprised. And I think you nailed the reason too:<p>&gt; <i>copied a lot in the industry because they work well for the problem space</i><p>Finance as an industry could be described as ... incestuous. The people move around within the small circle of firms, so any architectural knowledge gets cross-pollinated quite rapidly. From what I understand, the disruptor pattern itself was reasonably well known in the academic circles well before LMAX wrote about it - but I&#x27;m not sure anyone had put publicly available numbers on a heavily optimised version before them. (FWIW, I use a simplified disruptor in one of my own projects because it works well and simplifies the overall design. )<p>We should also be honest about the technical challenges: there are <i>very</i> few as interesting problem spaces as an exchange or a low-latency MM.</div><br/><div id="41270788" class="c"><input type="checkbox" id="c-41270788" checked=""/><div class="controls bullet"><span class="by">richliss</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41270436">parent</a><span>|</span><a href="#41271026">next</a><span>|</span><label class="collapse" for="c-41270788">[-]</label><label class="expand" for="c-41270788">[2 more]</label></div><br/><div class="children"><div class="content">So I worked at LMAX during 2009-2011 when Martin Thompson, Dave Farley, Mike Barker, Chris Smith and Danny Yates worked on the Disruptor. It was in use in 2010 inside LMAX.<p>The heritage of Martin and Dave was video games rather than finance and they had the most input into it.<p>From a friend who worked in games, the general idea behind the disruptor had been in use in games for a while.</div><br/><div id="41271930" class="c"><input type="checkbox" id="c-41271930" checked=""/><div class="controls bullet"><span class="by">jcelerier</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41270788">parent</a><span>|</span><a href="#41271026">next</a><span>|</span><label class="collapse" for="c-41271930">[-]</label><label class="expand" for="c-41271930">[1 more]</label></div><br/><div class="children"><div class="content">A ton of real-time audio&#x2F;video apps use the same general architectural pattern.</div><br/></div></div></div></div></div></div><div id="41271026" class="c"><input type="checkbox" id="c-41271026" checked=""/><div class="controls bullet"><span class="by">hangonhn</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41269710">parent</a><span>|</span><a href="#41270436">prev</a><span>|</span><a href="#41268729">next</a><span>|</span><label class="collapse" for="c-41271026">[-]</label><label class="expand" for="c-41271026">[3 more]</label></div><br/><div class="children"><div class="content">Can you explain what a multicast ring is? The article itself just grossed over it.<p>Thanks!</div><br/><div id="41271881" class="c"><input type="checkbox" id="c-41271881" checked=""/><div class="controls bullet"><span class="by">itsthecourier</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41271026">parent</a><span>|</span><a href="#41268729">next</a><span>|</span><label class="collapse" for="c-41271881">[-]</label><label class="expand" for="c-41271881">[2 more]</label></div><br/><div class="children"><div class="content">You have many servers receiving orders in a network. Instead of simple TCP&#x2F;IP packets, they go with multicast and all of them receive the same packets and keep the same state in memory. If one of them fails you can still depend on the others</div><br/><div id="41272215" class="c"><input type="checkbox" id="c-41272215" checked=""/><div class="controls bullet"><span class="by">hangonhn</span><span>|</span><a href="#41268799">root</a><span>|</span><a href="#41271881">parent</a><span>|</span><a href="#41268729">next</a><span>|</span><label class="collapse" for="c-41272215">[-]</label><label class="expand" for="c-41272215">[1 more]</label></div><br/><div class="children"><div class="content">Thank you!</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41268729" class="c"><input type="checkbox" id="c-41268729" checked=""/><div class="controls bullet"><span class="by">senderista</span><span>|</span><a href="#41268799">prev</a><span>|</span><a href="#41271069">next</a><span>|</span><label class="collapse" for="c-41268729">[-]</label><label class="expand" for="c-41268729">[5 more]</label></div><br/><div class="children"><div class="content">So much hype for a lock-free MPMC ring buffer. If you&#x27;re familiar with the concurrency literature you&#x27;ll see that nothing here was novel even at the time.</div><br/><div id="41269554" class="c"><input type="checkbox" id="c-41269554" checked=""/><div class="controls bullet"><span class="by">xxs</span><span>|</span><a href="#41268729">parent</a><span>|</span><a href="#41271519">next</a><span>|</span><label class="collapse" for="c-41269554">[-]</label><label class="expand" for="c-41269554">[1 more]</label></div><br/><div class="children"><div class="content">java had a proper memory model and the busy wait was a novelty. iirc, it was used mostly in a single thread processing (i.e. consumer) for the main business logic like matching forex order.<p>Realistically aside the disruptor LMAX had an interesting way for fail over by replaying all the input to reach the state.</div><br/></div></div><div id="41271519" class="c"><input type="checkbox" id="c-41271519" checked=""/><div class="controls bullet"><span class="by">usefulcat</span><span>|</span><a href="#41268729">parent</a><span>|</span><a href="#41269554">prev</a><span>|</span><a href="#41272243">next</a><span>|</span><label class="collapse" for="c-41271519">[-]</label><label class="expand" for="c-41271519">[2 more]</label></div><br/><div class="children"><div class="content">I thought disruptor was SPMC? Apart from that I don’t really disagree, I think it’s just an area that a lot of people didn’t&#x2F;don’t know much about.</div><br/><div id="41272202" class="c"><input type="checkbox" id="c-41272202" checked=""/><div class="controls bullet"><span class="by">yxhuvud</span><span>|</span><a href="#41268729">root</a><span>|</span><a href="#41271519">parent</a><span>|</span><a href="#41272243">next</a><span>|</span><label class="collapse" for="c-41272202">[-]</label><label class="expand" for="c-41272202">[1 more]</label></div><br/><div class="children"><div class="content">It comes in many variants with different properties.</div><br/></div></div></div></div><div id="41272243" class="c"><input type="checkbox" id="c-41272243" checked=""/><div class="controls bullet"><span class="by">anonymousDan</span><span>|</span><a href="#41268729">parent</a><span>|</span><a href="#41271519">prev</a><span>|</span><a href="#41271069">next</a><span>|</span><label class="collapse" for="c-41272243">[-]</label><label class="expand" for="c-41272243">[1 more]</label></div><br/><div class="children"><div class="content">Can you point to some relevant literature?</div><br/></div></div></div></div><div id="41271069" class="c"><input type="checkbox" id="c-41271069" checked=""/><div class="controls bullet"><span class="by">BrokrnAlgorithm</span><span>|</span><a href="#41268729">prev</a><span>|</span><a href="#41269066">next</a><span>|</span><label class="collapse" for="c-41271069">[-]</label><label class="expand" for="c-41271069">[3 more]</label></div><br/><div class="children"><div class="content">Is there any didactic implementation of the Disruptor &#x2F; multicast ring available somewhere? I&#x27;ve been curious in working through some practical example to understand the algorithm better.</div><br/><div id="41272814" class="c"><input type="checkbox" id="c-41272814" checked=""/><div class="controls bullet"><span class="by">nicholassm83</span><span>|</span><a href="#41271069">parent</a><span>|</span><a href="#41271883">next</a><span>|</span><label class="collapse" for="c-41272814">[-]</label><label class="expand" for="c-41272814">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s a high level description in TLA+:
<a href="https:&#x2F;&#x2F;github.com&#x2F;nicholassm&#x2F;disruptor-rs&#x2F;blob&#x2F;main&#x2F;verification&#x2F;Disruptor.tla">https:&#x2F;&#x2F;github.com&#x2F;nicholassm&#x2F;disruptor-rs&#x2F;blob&#x2F;main&#x2F;verific...</a><p>(Disclaimer: I wrote it.)<p>There&#x27;s also a spec for a Multi Producer Multi Consumer (MPMC) Disrupter.</div><br/></div></div><div id="41271883" class="c"><input type="checkbox" id="c-41271883" checked=""/><div class="controls bullet"><span class="by">itsthecourier</span><span>|</span><a href="#41271069">parent</a><span>|</span><a href="#41272814">prev</a><span>|</span><a href="#41269066">next</a><span>|</span><label class="collapse" for="c-41271883">[-]</label><label class="expand" for="c-41271883">[1 more]</label></div><br/><div class="children"><div class="content">LMAX have an open source version of the disruptor in GitHub <a href="https:&#x2F;&#x2F;github.com&#x2F;LMAX-Exchange&#x2F;disruptor">https:&#x2F;&#x2F;github.com&#x2F;LMAX-Exchange&#x2F;disruptor</a></div><br/></div></div></div></div><div id="41269066" class="c"><input type="checkbox" id="c-41269066" checked=""/><div class="controls bullet"><span class="by">pkaye</span><span>|</span><a href="#41271069">prev</a><span>|</span><a href="#41269104">next</a><span>|</span><label class="collapse" for="c-41269066">[-]</label><label class="expand" for="c-41269066">[4 more]</label></div><br/><div class="children"><div class="content">Is the LMAX disruptor just a ring buffer? Anything else special about it?</div><br/><div id="41269531" class="c"><input type="checkbox" id="c-41269531" checked=""/><div class="controls bullet"><span class="by">xxs</span><span>|</span><a href="#41269066">parent</a><span>|</span><a href="#41269104">next</a><span>|</span><label class="collapse" for="c-41269531">[-]</label><label class="expand" for="c-41269531">[3 more]</label></div><br/><div class="children"><div class="content">It is a ring buffer indeed, with publish serialization (on producer side) and normally a busy wait. It sort of doesn&#x27;t work on some VMs due to scheduling. (I mean the busy wait w&#x2F;o a backoff)</div><br/><div id="41269726" class="c"><input type="checkbox" id="c-41269726" checked=""/><div class="controls bullet"><span class="by">jnordwick</span><span>|</span><a href="#41269066">root</a><span>|</span><a href="#41269531">parent</a><span>|</span><a href="#41269104">next</a><span>|</span><label class="collapse" for="c-41269726">[-]</label><label class="expand" for="c-41269726">[2 more]</label></div><br/><div class="children"><div class="content">The big win is how it allows bulk processing while taking serialization dependencies into account.<p>So you algos reading market data messages and yank all that is there and apply them in bunk instead of trying to do each one individually.<p>And your logger that is storing all the messages to a file and&#x2F;or db knows what messages the algo has processed and can grab all the messages up to that point so it is always writing as much as it can and current.</div><br/><div id="41271039" class="c"><input type="checkbox" id="c-41271039" checked=""/><div class="controls bullet"><span class="by">hangonhn</span><span>|</span><a href="#41269066">root</a><span>|</span><a href="#41269726">parent</a><span>|</span><a href="#41269104">next</a><span>|</span><label class="collapse" for="c-41271039">[-]</label><label class="expand" for="c-41271039">[1 more]</label></div><br/><div class="children"><div class="content">Is this ability that is the result of each component being able to read the index&#x2F;sequence number of all the other components?</div><br/></div></div></div></div></div></div></div></div><div id="41269104" class="c"><input type="checkbox" id="c-41269104" checked=""/><div class="controls bullet"><span class="by">qwe2645692</span><span>|</span><a href="#41269066">prev</a><span>|</span><a href="#41269827">next</a><span>|</span><label class="collapse" for="c-41269104">[-]</label><label class="expand" for="c-41269104">[1 more]</label></div><br/><div class="children"><div class="content">Sounds so much like an io_uring model.</div><br/></div></div><div id="41269827" class="c"><input type="checkbox" id="c-41269827" checked=""/><div class="controls bullet"><span class="by">GenericCanadian</span><span>|</span><a href="#41269104">prev</a><span>|</span><a href="#41270124">next</a><span>|</span><label class="collapse" for="c-41269827">[-]</label><label class="expand" for="c-41269827">[2 more]</label></div><br/><div class="children"><div class="content">I wrote this in Crystal lang to learn more about it and the language: <a href="https:&#x2F;&#x2F;github.com&#x2F;nolantait&#x2F;disruptor.cr">https:&#x2F;&#x2F;github.com&#x2F;nolantait&#x2F;disruptor.cr</a><p>There is a Ruby version that is also very readable: <a href="https:&#x2F;&#x2F;github.com&#x2F;ileitch&#x2F;disruptor">https:&#x2F;&#x2F;github.com&#x2F;ileitch&#x2F;disruptor</a></div><br/><div id="41272811" class="c"><input type="checkbox" id="c-41272811" checked=""/><div class="controls bullet"><span class="by">nicholassm83</span><span>|</span><a href="#41269827">parent</a><span>|</span><a href="#41270124">next</a><span>|</span><label class="collapse" for="c-41272811">[-]</label><label class="expand" for="c-41272811">[1 more]</label></div><br/><div class="children"><div class="content">And here&#x27;s a version in Rust:
<a href="https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;disruptor" rel="nofollow">https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;disruptor</a><p>(Disclaimer: I wrote it.)</div><br/></div></div></div></div><div id="41270124" class="c"><input type="checkbox" id="c-41270124" checked=""/><div class="controls bullet"><span class="by">joezydeco</span><span>|</span><a href="#41269827">prev</a><span>|</span><a href="#41271091">next</a><span>|</span><label class="collapse" for="c-41270124">[-]</label><label class="expand" for="c-41270124">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for that. I was always curious why the finance bro down the block had an LMAX license plate on his car.</div><br/></div></div><div id="41271091" class="c"><input type="checkbox" id="c-41271091" checked=""/><div class="controls bullet"><span class="by">whoevercares</span><span>|</span><a href="#41270124">prev</a><span>|</span><a href="#41268595">next</a><span>|</span><label class="collapse" for="c-41271091">[-]</label><label class="expand" for="c-41271091">[1 more]</label></div><br/><div class="children"><div class="content">Fun fact, log4j use disrupter</div><br/></div></div><div id="41268595" class="c"><input type="checkbox" id="c-41268595" checked=""/><div class="controls bullet"><span class="by">chc4</span><span>|</span><a href="#41271091">prev</a><span>|</span><label class="collapse" for="c-41268595">[-]</label><label class="expand" for="c-41268595">[1 more]</label></div><br/><div class="children"><div class="content">See also: the discussion on the LMAX disruptor github documentation <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38313457">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=38313457</a></div><br/></div></div></div></div></div></div></div></body></html>