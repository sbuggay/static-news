<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1698310857959" as="style"/><link rel="stylesheet" href="styles.css?v=1698310857959"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://underjord.io/unpacking-elixir-observability.html">Unpacking Elixir: Observability</a> <span class="domain">(<a href="https://underjord.io">underjord.io</a>)</span></div><div class="subtext"><span>lawik</span> | <span>16 comments</span></div><br/><div><div id="38017290" class="c"><input type="checkbox" id="c-38017290" checked=""/><div class="controls bullet"><span class="by">thibaut_barrere</span><span>|</span><a href="#38018074">next</a><span>|</span><label class="collapse" for="c-38017290">[-]</label><label class="expand" for="c-38017290">[3 more]</label></div><br/><div class="children"><div class="content">The Erlang &quot;telemetry&quot; module can even be used &quot;applicatively&quot; with good uses.<p>An example of that is a &quot;caching reverse proxy&quot; in use at <a href="https:&#x2F;&#x2F;transport.data.gouv.fr&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;transport.data.gouv.fr&#x2F;</a>, which helps protect data producers servers from excessive load from data consumers (which we manage for them).<p>&quot;External&quot; requests come to us (via proxy.transport.data.gouv.fr) and if the response is not in cache (for a configured TTL), we forward the request as an &quot;internal&quot; request to the target (3rd party) server.<p>The proxy uses &quot;telemetry&quot; to generate events for these internal&#x2F;external queries, without knowing how they will be consumed (<a href="https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;unlock&#x2F;lib&#x2F;controller.ex">https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;un...</a>).<p>The main app receives those events and does what it wants, in this case upserting metrics in the database (<a href="https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;transport&#x2F;lib&#x2F;transport&#x2F;telemetry.ex">https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;tr...</a>).<p>As a result, it&#x27;s easy to use LiveView to create a real-time dashboard to show these metrics (<a href="https:&#x2F;&#x2F;jumpshare.com&#x2F;s&#x2F;rdGtTa47CzlcgOz4jsOI" rel="nofollow noreferrer">https:&#x2F;&#x2F;jumpshare.com&#x2F;s&#x2F;rdGtTa47CzlcgOz4jsOI</a> - low traffic at time of posting) or generate stats for the data producers which are behind the proxy (EDIT: LiveView source code at <a href="https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;transport&#x2F;lib&#x2F;transport_web&#x2F;live&#x2F;backoffice&#x2F;proxy_config_live.ex">https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;tr...</a> and <a href="https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;transport&#x2F;lib&#x2F;transport_web&#x2F;live&#x2F;backoffice&#x2F;proxy_config_live.html.heex">https:&#x2F;&#x2F;github.com&#x2F;etalab&#x2F;transport-site&#x2F;blob&#x2F;master&#x2F;apps&#x2F;tr...</a>).<p>It&#x27;s all quite natural to do because it&#x27;s really baked into the runtime!</div><br/><div id="38018258" class="c"><input type="checkbox" id="c-38018258" checked=""/><div class="controls bullet"><span class="by">chasers</span><span>|</span><a href="#38017290">parent</a><span>|</span><a href="#38018074">next</a><span>|</span><label class="collapse" for="c-38018258">[-]</label><label class="expand" for="c-38018258">[2 more]</label></div><br/><div class="children"><div class="content">We use :telemetry to collect usage data per tenant for Supabase Realtime.<p>We do this for rate limiting but it also makes it very easy for us to attach a listener (<a href="https:&#x2F;&#x2F;github.com&#x2F;supabase&#x2F;realtime&#x2F;blob&#x2F;main&#x2F;lib&#x2F;realtime&#x2F;telemetry&#x2F;logger.ex">https:&#x2F;&#x2F;github.com&#x2F;supabase&#x2F;realtime&#x2F;blob&#x2F;main&#x2F;lib&#x2F;realtime&#x2F;...</a>) which ships these (per second) aggregates to BigQuery (via Logflare), which then the billing team can aggregate further to display and actually bill people with.</div><br/><div id="38018356" class="c"><input type="checkbox" id="c-38018356" checked=""/><div class="controls bullet"><span class="by">thibaut_barrere</span><span>|</span><a href="#38017290">root</a><span>|</span><a href="#38018258">parent</a><span>|</span><a href="#38018074">next</a><span>|</span><label class="collapse" for="c-38018356">[-]</label><label class="expand" for="c-38018356">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for sharing!</div><br/></div></div></div></div></div></div><div id="38018074" class="c"><input type="checkbox" id="c-38018074" checked=""/><div class="controls bullet"><span class="by">chasers</span><span>|</span><a href="#38017290">prev</a><span>|</span><a href="#38015554">next</a><span>|</span><label class="collapse" for="c-38018074">[-]</label><label class="expand" for="c-38018074">[3 more]</label></div><br/><div class="children"><div class="content">We just had some orphaned database connections (our bug) to a tenant and were able to find and kill them because of Erlang&#x27;s observability:<p><a href="https:&#x2F;&#x2F;gist.github.com&#x2F;chasers&#x2F;e4aa33625e6ea39ecb89f03383dd9e38" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;chasers&#x2F;e4aa33625e6ea39ecb89f03383dd...</a><p>edit: link to gist</div><br/><div id="38019964" class="c"><input type="checkbox" id="c-38019964" checked=""/><div class="controls bullet"><span class="by">pawelduda</span><span>|</span><a href="#38018074">parent</a><span>|</span><a href="#38015554">next</a><span>|</span><label class="collapse" for="c-38019964">[-]</label><label class="expand" for="c-38019964">[2 more]</label></div><br/><div class="children"><div class="content">Not possible in your typical Rails setup where remote console spawns a separate process so you can&#x27;t inspect what&#x27;s going on with your actual servers. Even if so, the amount of observability is not remotely (pun intended) close. You don&#x27;t appreciate it until your production puma workers start going haywire and you have no idea why</div><br/><div id="38022333" class="c"><input type="checkbox" id="c-38022333" checked=""/><div class="controls bullet"><span class="by">byroot</span><span>|</span><a href="#38018074">root</a><span>|</span><a href="#38019964">parent</a><span>|</span><a href="#38015554">next</a><span>|</span><label class="collapse" for="c-38022333">[-]</label><label class="expand" for="c-38022333">[1 more]</label></div><br/><div class="children"><div class="content">You can attach to a running Ruby process with rbtrace easily.</div><br/></div></div></div></div></div></div><div id="38015554" class="c"><input type="checkbox" id="c-38015554" checked=""/><div class="controls bullet"><span class="by">nesarkvechnep</span><span>|</span><a href="#38018074">prev</a><span>|</span><a href="#38016511">next</a><span>|</span><label class="collapse" for="c-38015554">[-]</label><label class="expand" for="c-38015554">[3 more]</label></div><br/><div class="children"><div class="content">Observability on the BEAM is not an afterthought.</div><br/><div id="38015720" class="c"><input type="checkbox" id="c-38015720" checked=""/><div class="controls bullet"><span class="by">giraffe_lady</span><span>|</span><a href="#38015554">parent</a><span>|</span><a href="#38016511">next</a><span>|</span><label class="collapse" for="c-38015720">[-]</label><label class="expand" for="c-38015720">[2 more]</label></div><br/><div class="children"><div class="content">BEAM is actually as good as every new technology tries to pretend to be.</div><br/><div id="38017659" class="c"><input type="checkbox" id="c-38017659" checked=""/><div class="controls bullet"><span class="by">hmmokidk</span><span>|</span><a href="#38015554">root</a><span>|</span><a href="#38015720">parent</a><span>|</span><a href="#38016511">next</a><span>|</span><label class="collapse" for="c-38017659">[-]</label><label class="expand" for="c-38017659">[1 more]</label></div><br/><div class="children"><div class="content">Seriously. It’s an incredible tool and deserves way more praise.</div><br/></div></div></div></div></div></div><div id="38016511" class="c"><input type="checkbox" id="c-38016511" checked=""/><div class="controls bullet"><span class="by">roblh</span><span>|</span><a href="#38015554">prev</a><span>|</span><a href="#38019527">next</a><span>|</span><label class="collapse" for="c-38016511">[-]</label><label class="expand" for="c-38016511">[1 more]</label></div><br/><div class="children"><div class="content">Love this. Great series of articles too. I’m just getting started with Elixir and I had no idea about a ton of this stuff.</div><br/></div></div><div id="38019527" class="c"><input type="checkbox" id="c-38019527" checked=""/><div class="controls bullet"><span class="by">innocentoldguy</span><span>|</span><a href="#38016511">prev</a><span>|</span><a href="#38017055">next</a><span>|</span><label class="collapse" for="c-38019527">[-]</label><label class="expand" for="c-38019527">[2 more]</label></div><br/><div class="children"><div class="content">I love this article. I’m about 10 years away from retiring and Elixir&#x2F;Erlang have been the highlight of my software engineering career because of things like this.</div><br/><div id="38022035" class="c"><input type="checkbox" id="c-38022035" checked=""/><div class="controls bullet"><span class="by">lawik</span><span>|</span><a href="#38019527">parent</a><span>|</span><a href="#38017055">next</a><span>|</span><label class="collapse" for="c-38022035">[-]</label><label class="expand" for="c-38022035">[1 more]</label></div><br/><div class="children"><div class="content">Thanks. Glad it resonated :)</div><br/></div></div></div></div><div id="38017055" class="c"><input type="checkbox" id="c-38017055" checked=""/><div class="controls bullet"><span class="by">WaffleIronMaker</span><span>|</span><a href="#38019527">prev</a><span>|</span><a href="#38016364">next</a><span>|</span><label class="collapse" for="c-38017055">[-]</label><label class="expand" for="c-38017055">[2 more]</label></div><br/><div class="children"><div class="content">Small typo<p>&gt; their shape very mnuch in compilation</div><br/><div id="38022040" class="c"><input type="checkbox" id="c-38022040" checked=""/><div class="controls bullet"><span class="by">lawik</span><span>|</span><a href="#38017055">parent</a><span>|</span><a href="#38016364">next</a><span>|</span><label class="collapse" for="c-38022040">[-]</label><label class="expand" for="c-38022040">[1 more]</label></div><br/><div class="children"><div class="content">Ah yes. Will correct it to &quot;munch&quot; ;)</div><br/></div></div></div></div></div></div></div></div></div></body></html>