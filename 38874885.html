<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704445253794" as="style"/><link rel="stylesheet" href="styles.css?v=1704445253794"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.da.vidbuchanan.co.uk/blog/python-swar.html">SIMD in Pure Python</a> <span class="domain">(<a href="https://www.da.vidbuchanan.co.uk">www.da.vidbuchanan.co.uk</a>)</span></div><div class="subtext"><span>dmarto</span> | <span>13 comments</span></div><br/><div><div id="38875430" class="c"><input type="checkbox" id="c-38875430" checked=""/><div class="controls bullet"><span class="by">ashvardanian</span><span>|</span><a href="#38875792">next</a><span>|</span><label class="collapse" for="c-38875430">[-]</label><label class="expand" for="c-38875430">[2 more]</label></div><br/><div class="children"><div class="content">This is a nice exercise!<p>There is also a very different “write SIMD assembly in Python” approach available through the PeachPy library, one of the least known gems between Python and HPC worlds: <a href="https:&#x2F;&#x2F;github.com&#x2F;Maratyszcza&#x2F;PeachPy">https:&#x2F;&#x2F;github.com&#x2F;Maratyszcza&#x2F;PeachPy</a><p>This is what a dot-product would look like in PeachPy: <a href="https:&#x2F;&#x2F;unum-cloud.github.io&#x2F;usearch&#x2F;python&#x2F;index.html#id4" rel="nofollow">https:&#x2F;&#x2F;unum-cloud.github.io&#x2F;usearch&#x2F;python&#x2F;index.html#id4</a><p>PS: Cppyy and Numba are also fun to use in such projects :)</div><br/><div id="38876336" class="c"><input type="checkbox" id="c-38876336" checked=""/><div class="controls bullet"><span class="by">brrrrrm</span><span>|</span><a href="#38875430">parent</a><span>|</span><a href="#38875792">next</a><span>|</span><label class="collapse" for="c-38876336">[-]</label><label class="expand" for="c-38876336">[1 more]</label></div><br/><div class="children"><div class="content">PeachPy is awesome - it&#x27;s really a great way to play with assembly-level performance programming and not have to deal with assembler toolchains</div><br/></div></div></div></div><div id="38875792" class="c"><input type="checkbox" id="c-38875792" checked=""/><div class="controls bullet"><span class="by">justinl33</span><span>|</span><a href="#38875430">prev</a><span>|</span><a href="#38876004">next</a><span>|</span><label class="collapse" for="c-38875792">[-]</label><label class="expand" for="c-38875792">[3 more]</label></div><br/><div class="children"><div class="content">Genius!<p>&gt;* the state of the cells is being stored in a big array, accessed via the get_cell and set_cell helper functions. What if instead of using an array, we stored the whole state in one very long integer, and used SWAB arithmetic to process the whole thing at once?*<p>I’m really curious as to how the unpacking of this long integer into pixels on the screen doesn’t add more overhead than it saves. I guess I’ll have to wait for your next one on the compressed gzip stream hack.</div><br/><div id="38875983" class="c"><input type="checkbox" id="c-38875983" checked=""/><div class="controls bullet"><span class="by">nneonneo</span><span>|</span><a href="#38875792">parent</a><span>|</span><a href="#38876004">next</a><span>|</span><label class="collapse" for="c-38875983">[-]</label><label class="expand" for="c-38875983">[2 more]</label></div><br/><div class="children"><div class="content">If I had to guess, it’s a matter of setting up the Huffman tables such that every code ends up with a length of four bits, and then prepending that precomputed Huffman table onto the “compressed” stream. Then you can abuse the zlib library as a decompressor mapping the 4-bit “Huffman” codes to regular bytes.<p>Of course, this won’t be anywhere near as efficient as just implementing the decoder in C, as Huffman decoding needs to be much more general than just unpacking fixed-width chunks. But it will definitely be an improvement over naive loops.<p>I wonder whether .hex() could be pressed into service as a very scuffed 4-bit unpacker? Maybe something like .hex().encode().translate() to get an arbitrary palette mapping?</div><br/><div id="38876089" class="c"><input type="checkbox" id="c-38876089" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#38875792">root</a><span>|</span><a href="#38875983">parent</a><span>|</span><a href="#38876004">next</a><span>|</span><label class="collapse" for="c-38876089">[-]</label><label class="expand" for="c-38876089">[1 more]</label></div><br/><div class="children"><div class="content">Yup, that&#x27;s pretty much exactly it.<p>.hex() is a good idea, and probably has a decent chance of beating gzip, assuming .translate() is fast enough.<p>The fastest approach for the bitsliced AES impl ended up being pretty cursed: <a href="https:&#x2F;&#x2F;github.com&#x2F;DavidBuchanan314&#x2F;python-bitsliced-aes&#x2F;blob&#x2F;8c91eb3edb4424c641b55deef2433ddaf667eebc&#x2F;bsaes.py#L46">https:&#x2F;&#x2F;github.com&#x2F;DavidBuchanan314&#x2F;python-bitsliced-aes&#x2F;blo...</a></div><br/></div></div></div></div></div></div><div id="38876004" class="c"><input type="checkbox" id="c-38876004" checked=""/><div class="controls bullet"><span class="by">nneonneo</span><span>|</span><a href="#38875792">prev</a><span>|</span><a href="#38875382">next</a><span>|</span><label class="collapse" for="c-38876004">[-]</label><label class="expand" for="c-38876004">[2 more]</label></div><br/><div class="children"><div class="content">Neat trick! I implemented a similar bitpacking approach for solving matrix equations in GF(2), which can be used for things like forging CRC hashes (faster than bruteforce) and solving certain cryptography problems. Code is here: <a href="https:&#x2F;&#x2F;github.com&#x2F;nneonneo&#x2F;pwn-stuff&#x2F;blob&#x2F;master&#x2F;math&#x2F;gf2.py">https:&#x2F;&#x2F;github.com&#x2F;nneonneo&#x2F;pwn-stuff&#x2F;blob&#x2F;master&#x2F;math&#x2F;gf2.p...</a>.</div><br/><div id="38876056" class="c"><input type="checkbox" id="c-38876056" checked=""/><div class="controls bullet"><span class="by">Retr0id</span><span>|</span><a href="#38876004">parent</a><span>|</span><a href="#38875382">next</a><span>|</span><label class="collapse" for="c-38876056">[-]</label><label class="expand" for="c-38876056">[1 more]</label></div><br/><div class="children"><div class="content">Ha! As it happens, I&#x27;ve recently written near identical code, and was considering writing about it in a future article - I originally had leaking internal states of xorshift128+ in mind :)</div><br/></div></div></div></div><div id="38875382" class="c"><input type="checkbox" id="c-38875382" checked=""/><div class="controls bullet"><span class="by">dinkleberg</span><span>|</span><a href="#38876004">prev</a><span>|</span><a href="#38876924">next</a><span>|</span><label class="collapse" for="c-38875382">[-]</label><label class="expand" for="c-38875382">[1 more]</label></div><br/><div class="children"><div class="content">This is great, nice work!<p>I just recently started going through a performance programming course (<a href="https:&#x2F;&#x2F;computerenhance.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;computerenhance.com&#x2F;</a>) and have learned about SIMD and other techniques and it is awesome to see something out in the wild.</div><br/></div></div><div id="38876924" class="c"><input type="checkbox" id="c-38876924" checked=""/><div class="controls bullet"><span class="by">akasakahakada</span><span>|</span><a href="#38875382">prev</a><span>|</span><a href="#38875782">next</a><span>|</span><label class="collapse" for="c-38876924">[-]</label><label class="expand" for="c-38876924">[1 more]</label></div><br/><div class="children"><div class="content">np.array([ BigInt list ], dtype=object)<p>then you can apply this bit parallelism to a tensor.</div><br/></div></div><div id="38875782" class="c"><input type="checkbox" id="c-38875782" checked=""/><div class="controls bullet"><span class="by">jvans</span><span>|</span><a href="#38876924">prev</a><span>|</span><a href="#38875716">next</a><span>|</span><label class="collapse" for="c-38875782">[-]</label><label class="expand" for="c-38875782">[1 more]</label></div><br/><div class="children"><div class="content">Exercises like this really make you a better programmer. Someone should collect these types of examples in a git repo somewhere.</div><br/></div></div><div id="38875716" class="c"><input type="checkbox" id="c-38875716" checked=""/><div class="controls bullet"><span class="by">jxy</span><span>|</span><a href="#38875782">prev</a><span>|</span><a href="#38875692">next</a><span>|</span><label class="collapse" for="c-38875716">[-]</label><label class="expand" for="c-38875716">[1 more]</label></div><br/><div class="children"><div class="content">tl;dr<p>&gt; The general term for this concept is SWAR, which stands for SIMD Within A Register. But here, rather than using a machine register, we&#x27;re using an arbitrarily long Python integer. I&#x27;m calling this variant SWAB: SIMD Within A Bigint.<p>Thanks to Peano and Godel, it&#x27;s safe to say we may encode any compute with operations on natural numbers. So if anything is slow in Python for you, you may always encode it in Bigint and hope for the best.</div><br/></div></div><div id="38875692" class="c"><input type="checkbox" id="c-38875692" checked=""/><div class="controls bullet"><span class="by">redskyluan</span><span>|</span><a href="#38875716">prev</a><span>|</span><label class="collapse" for="c-38875692">[-]</label><label class="expand" for="c-38875692">[1 more]</label></div><br/><div class="children"><div class="content">Just stumbled upon this blog it&#x27;s absolutely intriguing! As a Python enthusiast, it&#x27;s like finding a hidden treasure that challenges the usual norms of Python&#x27;s capabilities. Thinks of writing a Pure python implementation of some ml algos in learning SIMD~</div><br/></div></div></div></div></div></div></div></body></html>