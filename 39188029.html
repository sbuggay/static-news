<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707123658250" as="style"/><link rel="stylesheet" href="styles.css?v=1707123658250"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.b-list.org/weblog/2022/may/13/boring-python-dependencies/">Boring Python: dependency management (2022)</a> <span class="domain">(<a href="https://www.b-list.org">www.b-list.org</a>)</span></div><div class="subtext"><span>bruh2</span> | <span>47 comments</span></div><br/><div><div id="39256600" class="c"><input type="checkbox" id="c-39256600" checked=""/><div class="controls bullet"><span class="by">irjustin</span><span>|</span><a href="#39256789">next</a><span>|</span><label class="collapse" for="c-39256600">[-]</label><label class="expand" for="c-39256600">[18 more]</label></div><br/><div class="children"><div class="content">With the move to pyproject.toml in 2022[0], Poetry has become our goto method.<p>With the lock file being default, we don&#x27;t worry about different installs in different envs.<p>Having come from the Rails world, Bundler system was solved for... a decade? So I was surprised it was such a mess in Python until so recently.<p>At the core, the thing that makes Poetry and Bundler system so predictable is 1, lock file. 2, ability to install different versions in diff locations and referencing the version you need to load. Each alone isn&#x27;t enough.<p>npm had the same problem pip suffered from, you may have a version installed different what the req.txt, proj.js or even lockfile says but because it exists inside the location, it gets loaded. It wasn&#x27;t until yarn2 did node_modules finally get moved out such that side-by-side versions wasn&#x27;t awkward.<p>[EDIT]<p>If you&#x27;re not using Poetry + Docker for deployment yet, I 100% recommend it as the &quot;boring&quot; method.<p><pre><code>  RUN curl -sSL https:&#x2F;&#x2F;install.python-poetry.org | python -
  RUN &#x2F;root&#x2F;.local&#x2F;bin&#x2F;poetry config virtualenvs.create false
  
  COPY poetry.lock pyproject.toml .&#x2F;
  
  RUN --mount=type=secret,id=gh_priv_key,target=&#x2F;root&#x2F;.ssh&#x2F;id_rsa \
      &#x2F;root&#x2F;.local&#x2F;bin&#x2F;poetry install --without dev --no-root

</code></pre>
[0] <a href="https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;tutorials&#x2F;packaging-projects&#x2F;" rel="nofollow">https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;tutorials&#x2F;packaging-p...</a></div><br/><div id="39258770" class="c"><input type="checkbox" id="c-39258770" checked=""/><div class="controls bullet"><span class="by">mrweasel</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39256967">next</a><span>|</span><label class="collapse" for="c-39258770">[-]</label><label class="expand" for="c-39258770">[1 more]</label></div><br/><div class="children"><div class="content">Poetry solves a very real problem, but I kinda hate it. It&#x27;s not a pleasant tool to use.<p>Allow me to out-bore you, because there&#x27;s way to much excitement in your solution. We just build Debian packages and deploy our applications that way. The Debian packaging infrastructure could be better, but mostly it just wraps around setuptools&#x2F;pyproject. You need to rebuild your containers every time there&#x27;s a security update to package, we just set apt to auto-update.</div><br/></div></div><div id="39256967" class="c"><input type="checkbox" id="c-39256967" checked=""/><div class="controls bullet"><span class="by">doctorpangloss</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39258770">prev</a><span>|</span><a href="#39258671">next</a><span>|</span><label class="collapse" for="c-39256967">[-]</label><label class="expand" for="c-39256967">[11 more]</label></div><br/><div class="children"><div class="content">Despite these comments, Poetry is pretty limited. You cannot install PyTorch with it for example, and the developers do not care: <a href="https:&#x2F;&#x2F;github.com&#x2F;python-poetry&#x2F;poetry&#x2F;issues&#x2F;6409">https:&#x2F;&#x2F;github.com&#x2F;python-poetry&#x2F;poetry&#x2F;issues&#x2F;6409</a><p>So basically the single most exciting thing to ever happen to the ecosystem isn’t supported by Poetry.</div><br/><div id="39258691" class="c"><input type="checkbox" id="c-39258691" checked=""/><div class="controls bullet"><span class="by">Ultimatt</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39256967">parent</a><span>|</span><a href="#39257314">next</a><span>|</span><label class="collapse" for="c-39258691">[-]</label><label class="expand" for="c-39258691">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;d say this is more like pytorch is horribly packaged and a nightmare as an eng user to integrate into codebases. All of their assumptions are you use conda and are a datascientist one time doing something in an ipython notebook. Very little consideration is made to how you deploy at scale reliably. It&#x27;s not really on poetry.</div><br/><div id="39258862" class="c"><input type="checkbox" id="c-39258862" checked=""/><div class="controls bullet"><span class="by">dagw</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39258691">parent</a><span>|</span><a href="#39257314">next</a><span>|</span><label class="collapse" for="c-39258862">[-]</label><label class="expand" for="c-39258862">[1 more]</label></div><br/><div class="children"><div class="content"><i>It&#x27;s not really on poetry.</i><p>While this is on the one hand at least partially true, it is also the case that as long a poetry can&#x27;t deal with these (and similar) cases then it cannot really be said to be a candidate for the &#x27;default&#x27; dependency management tool. Having people say &#x27;just use poetry&#x27; as the go to answer is very bad default advice as long as poetry will fail in a number of important cases.</div><br/></div></div></div></div><div id="39257314" class="c"><input type="checkbox" id="c-39257314" checked=""/><div class="controls bullet"><span class="by">irjustin</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39256967">parent</a><span>|</span><a href="#39258691">prev</a><span>|</span><a href="#39258216">next</a><span>|</span><label class="collapse" for="c-39257314">[-]</label><label class="expand" for="c-39257314">[6 more]</label></div><br/><div class="children"><div class="content">Based on this comment 5 days ago[0], it&#x27;s working? I&#x27;m not sure didn&#x27;t dig in too far but based on that comment it seems fair to say that it&#x27;s not fully Poetry&#x27;s fault because torch removed hashes (which poetry needs to be effective) for a while only recently adding it back in.<p>Not sure where I would stand if I fully investigated it tho.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;python-poetry&#x2F;poetry&#x2F;issues&#x2F;6409#issuecomment-1917702311">https:&#x2F;&#x2F;github.com&#x2F;python-poetry&#x2F;poetry&#x2F;issues&#x2F;6409#issuecom...</a></div><br/><div id="39258806" class="c"><input type="checkbox" id="c-39258806" checked=""/><div class="controls bullet"><span class="by">dagw</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39257314">parent</a><span>|</span><a href="#39257501">next</a><span>|</span><label class="collapse" for="c-39258806">[-]</label><label class="expand" for="c-39258806">[1 more]</label></div><br/><div class="children"><div class="content">The fact that it only kind of sort of incidentally works some times shows clearly that people who consider PyTorch a vital library for their work aren&#x27;t the target audience for poetry. Another use case they don&#x27;t really care about are people for whom compiling C++ etc. is important part of their build process.<p>Poetry is great if you&#x27;re developing the sort of software that the poetry devs priorities, but since poetry is only targeting a subset of the python community it will never be a good default tool for all python development, and thus the fragmentation continues.</div><br/></div></div><div id="39257501" class="c"><input type="checkbox" id="c-39257501" checked=""/><div class="controls bullet"><span class="by">doctorpangloss</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39257314">parent</a><span>|</span><a href="#39258806">prev</a><span>|</span><a href="#39258216">next</a><span>|</span><label class="collapse" for="c-39257501">[-]</label><label class="expand" for="c-39257501">[4 more]</label></div><br/><div class="children"><div class="content">Every comment in that thread, including the comment you referenced, is wrong.<p>Due to Poetry&#x27;s architecture, it can&#x27;t satisfy all three at the same time:<p>- the platonic ideal of build isolation and lockfiles<p>- installing the appropriate accelerator specific version of pytorch for the current platform non-interactively or one that the user selects<p>- dependencies for pytorch that are transitively compatible with the way dependencies for pytorch are expressed elsewhere<p>This is something you can achieve with setuptools and setup.py by forfeiting the platonic ideals of build isolation and lockfiles.<p>Poetry, on the other hand, does not let you choose which lamb to sacrifice. Everyone in the thread, for the last two years, who has reported that they have had some success are misunderstanding the state of their install, and have interacted with flaws in all three situations I&#x27;m describing. They have something that will not correctly install anything that is dependent itself on PyTorch, which is useless, since everything in the PyTorch ecosystem is is dependent on it, and the main workaround the community uses - installing torch first, followed by installing dependencies from a requirements.txt, followed by copying a dump of scripts - is not compatible with poetry.<p>Here&#x27;s the facts of the matter:<p>- 1.2M requirements.txts <a href="https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Erequirements.txt%24%2F&amp;type=code">https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Erequirements.txt%24...</a><p>- 664k setup.pys <a href="https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Esetup.py%24%2F&amp;type=code">https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Esetup.py%24%2F&amp;type...</a><p>- setup.pys that reference requirements.txts <a href="https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Esetup.py%24%2F+requirements.txt&amp;type=code">https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Esetup.py%24%2F+requ...</a>
67.1k<p>- only 30k pyproject.toml specified with dependencies <a href="https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Epyproject.toml%24%2F+&quot;dependencies+%3D&quot;&amp;type=code" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;search?q=path%3A%2F%5Epyproject.toml%24%2...</a><p>2&#x2F;3rds of Python end users do not engage with packaging at all. pyproject.toml with dependencies is about 1.5% of the ecosystem. It provides only downsides compared to setup.py and pinning your package versions by commit in your setup.py dependencies aka doing what golang does, and this does not require any external tools in Python. In my opinion, the Poetry developers need to fix pytorch or they will not get adoption during Peak Python.</div><br/><div id="39258620" class="c"><input type="checkbox" id="c-39258620" checked=""/><div class="controls bullet"><span class="by">albertzeyer</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39257501">parent</a><span>|</span><a href="#39258426">next</a><span>|</span><label class="collapse" for="c-39258620">[-]</label><label class="expand" for="c-39258620">[1 more]</label></div><br/><div class="children"><div class="content">Sorry if my questions are maybe not well informed (maybe I should delve more into Poetry, I don&#x27;t really know it), but I don&#x27;t really understand those points, but I would like to understand them.<p>What does it mean, build isolation? And how does PyTorch violate that? Or why can&#x27;t we install PyTorch with build isolation?<p>What is the issue with lockfiles?<p>I can understand there might be issues if you need to install a custom accelerator-specific version of PyTorch (although also I don&#x27;t fully understand what the issues are about this). However, what&#x27;s with just the standard version, which is suitable for most people, as it comes with CUDA support?<p>What do you mean by non-interactively? pip install is non-interactively, or not?<p>What issues are there with the dependencies for PyTorch? Why are they not compatible with the dependencies expressed elsewhere?<p>How are dependencies defined by requirements.txt different than dependencies defined by pyproject.toml or by setup.py?<p>If your answer is RTFM, maybe you can point me to some resources. I read a bit through Poetry documentation, but I still don&#x27;t really understand those issues.</div><br/></div></div><div id="39258426" class="c"><input type="checkbox" id="c-39258426" checked=""/><div class="controls bullet"><span class="by">ildjarn</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39257501">parent</a><span>|</span><a href="#39258620">prev</a><span>|</span><a href="#39257515">next</a><span>|</span><label class="collapse" for="c-39258426">[-]</label><label class="expand" for="c-39258426">[1 more]</label></div><br/><div class="children"><div class="content">Is there a path to declarative package manifests that reach Poetry’s platonic ideals?<p>Frankly setup.py is a big hack and we should strive to do better.</div><br/></div></div><div id="39257515" class="c"><input type="checkbox" id="c-39257515" checked=""/><div class="controls bullet"><span class="by">irjustin</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39257501">parent</a><span>|</span><a href="#39258426">prev</a><span>|</span><a href="#39258216">next</a><span>|</span><label class="collapse" for="c-39257515">[-]</label><label class="expand" for="c-39257515">[1 more]</label></div><br/><div class="children"><div class="content">Got it, thanks for the detailed update. Clearly much more complex.</div><br/></div></div></div></div></div></div><div id="39258236" class="c"><input type="checkbox" id="c-39258236" checked=""/><div class="controls bullet"><span class="by">chrisledet</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39256967">parent</a><span>|</span><a href="#39258216">prev</a><span>|</span><a href="#39258671">next</a><span>|</span><label class="collapse" for="c-39258236">[-]</label><label class="expand" for="c-39258236">[1 more]</label></div><br/><div class="children"><div class="content">Agreed, I haven&#x27;t been too impressed with poetry.</div><br/></div></div></div></div><div id="39258671" class="c"><input type="checkbox" id="c-39258671" checked=""/><div class="controls bullet"><span class="by">tlonny</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39256967">prev</a><span>|</span><a href="#39258069">next</a><span>|</span><label class="collapse" for="c-39258671">[-]</label><label class="expand" for="c-39258671">[1 more]</label></div><br/><div class="children"><div class="content">Very tangential, but wanted to share a small QoL trick that makes using poetry (and venv in general) much nicer...<p>Instead of having to type &quot;poetry shell&quot; to activate the virtualenv, I use a tool called direnv that automatically modifies envars when you enter a directory - undoing the changes when you leave.<p>In my direnv config (.envrc) for the directory I write:<p><pre><code>   PATH_add .venv&#x2F;bin
</code></pre>
To add all the virtualenv executables to PATH. Now I can just call &quot;python&#x2F;pip&quot; directly and never have to worry if I&#x27;m inside my virtualenv or not.<p>N.B. for this you need to update poetry config to ensure virtualenvs are placed in the project directory vs. the default centralised location</div><br/></div></div><div id="39258069" class="c"><input type="checkbox" id="c-39258069" checked=""/><div class="controls bullet"><span class="by">BiteCode_dev</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39258671">prev</a><span>|</span><a href="#39256662">next</a><span>|</span><label class="collapse" for="c-39258069">[-]</label><label class="expand" for="c-39258069">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m going to sound like a zealot at this point but:<p>&#x27;&quot;Why not tell people to &quot;simply&quot; use pyenv, poetry or anaconda&#x27;<p><a href="https:&#x2F;&#x2F;www.bitecode.dev&#x2F;p&#x2F;why-not-tell-people-to-simply-use" rel="nofollow">https:&#x2F;&#x2F;www.bitecode.dev&#x2F;p&#x2F;why-not-tell-people-to-simply-use</a></div><br/><div id="39258724" class="c"><input type="checkbox" id="c-39258724" checked=""/><div class="controls bullet"><span class="by">tempaccount1234</span><span>|</span><a href="#39256600">root</a><span>|</span><a href="#39258069">parent</a><span>|</span><a href="#39256662">next</a><span>|</span><label class="collapse" for="c-39258724">[-]</label><label class="expand" for="c-39258724">[1 more]</label></div><br/><div class="children"><div class="content">Why not simply use pip? At least that works…</div><br/></div></div></div></div><div id="39256662" class="c"><input type="checkbox" id="c-39256662" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39258069">prev</a><span>|</span><a href="#39256839">next</a><span>|</span><label class="collapse" for="c-39256662">[-]</label><label class="expand" for="c-39256662">[1 more]</label></div><br/><div class="children"><div class="content">Notably Poetry lockfiles are farrrrrr better cross-env then Pipenv&#x27;s, which if you lock on an ARM Mac, will not install on a x64 Linux box. Poetry just works.</div><br/></div></div><div id="39256839" class="c"><input type="checkbox" id="c-39256839" checked=""/><div class="controls bullet"><span class="by">andenacitelli</span><span>|</span><a href="#39256600">parent</a><span>|</span><a href="#39256662">prev</a><span>|</span><a href="#39256789">next</a><span>|</span><label class="collapse" for="c-39256839">[-]</label><label class="expand" for="c-39256839">[1 more]</label></div><br/><div class="children"><div class="content">Hard agree. This article makes good points but I feel like Poetry just simplifies so much of it and makes it so much less manual. We’ve used it at $DAYJOB for months and it’s been awesome. In the same sense as the article — it’s been sufficiently boring to rarely be the source of problems, and when it is, it’s almost always our fault rather than a design flaw in Poetry.</div><br/></div></div></div></div><div id="39256789" class="c"><input type="checkbox" id="c-39256789" checked=""/><div class="controls bullet"><span class="by">mattbillenstein</span><span>|</span><a href="#39256600">prev</a><span>|</span><a href="#39258648">next</a><span>|</span><label class="collapse" for="c-39256789">[-]</label><label class="expand" for="c-39256789">[4 more]</label></div><br/><div class="children"><div class="content">The python core team endorses pip, but pip solves something like 80% of the problem - we need them to endorse the other 20% of the solution.<p>I&#x27;ve been using pip-tools for some time, I think it solves the other 20% of the problem for me in a simple way that I like. Poetry et al seem to be trying to do too much - ymmv.<p>The iterations on packaging that don&#x27;t really seem to ever get it right are, I think, frustrating to the community where the core likes to advertise a &quot;Zen of Python&quot; &quot;one way to do things&quot; mantra, but can never really get 100% of the packaging problem sorted out in a clean way in spite of several communities seeming to figure it out.</div><br/><div id="39257021" class="c"><input type="checkbox" id="c-39257021" checked=""/><div class="controls bullet"><span class="by">doctorpangloss</span><span>|</span><a href="#39256789">parent</a><span>|</span><a href="#39258648">next</a><span>|</span><label class="collapse" for="c-39257021">[-]</label><label class="expand" for="c-39257021">[3 more]</label></div><br/><div class="children"><div class="content">The core team endorses everything, not only pip, but good luck finding an example setup.py with example repositories from any of the documentation pages you find on Google. It’s results 1-3 and is always marked Obsolete.<p>The communication on what to do is a disaster. Look at non obsolete <a href="https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;tutorials&#x2F;packaging-projects&#x2F;" rel="nofollow">https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;tutorials&#x2F;packaging-p...</a> - my dude, their pyproject.toml doesn’t even specify a dependencies section, which is 99% of the value proposition of packaging.</div><br/><div id="39258515" class="c"><input type="checkbox" id="c-39258515" checked=""/><div class="controls bullet"><span class="by">voidnap</span><span>|</span><a href="#39256789">root</a><span>|</span><a href="#39257021">parent</a><span>|</span><a href="#39257928">next</a><span>|</span><label class="collapse" for="c-39258515">[-]</label><label class="expand" for="c-39258515">[1 more]</label></div><br/><div class="children"><div class="content">&gt; their pyproject.toml doesn’t even specify a dependencies section<p>Doesn&#x27;t it though? <a href="https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;guides&#x2F;writing-pyproject-toml&#x2F;#a-full-example" rel="nofollow">https:&#x2F;&#x2F;packaging.python.org&#x2F;en&#x2F;latest&#x2F;guides&#x2F;writing-pyproj...</a></div><br/></div></div><div id="39257928" class="c"><input type="checkbox" id="c-39257928" checked=""/><div class="controls bullet"><span class="by">mattbillenstein</span><span>|</span><a href="#39256789">root</a><span>|</span><a href="#39257021">parent</a><span>|</span><a href="#39258515">prev</a><span>|</span><a href="#39258648">next</a><span>|</span><label class="collapse" for="c-39257928">[-]</label><label class="expand" for="c-39257928">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, this too.<p>I have been impressed that they&#x27;re making progress though - wheels solve some problems conda used to solve; so doing ML stuff that is based on conda I can usually just use regular pip packages now which is very nice.</div><br/></div></div></div></div></div></div><div id="39258648" class="c"><input type="checkbox" id="c-39258648" checked=""/><div class="controls bullet"><span class="by">atoav</span><span>|</span><a href="#39256789">prev</a><span>|</span><a href="#39256191">next</a><span>|</span><label class="collapse" for="c-39258648">[-]</label><label class="expand" for="c-39258648">[1 more]</label></div><br/><div class="children"><div class="content">The biggest problem about Pythons dependency managment in 2024 is that it stil feels like an afterthought. It is just not straightforward and it is not <i>pythonic</i>. I would go as far as saying that dependency managment with Python is likely more complicated than anything you would normally encounter within the language.<p>As of 2024 poetry is the best solution we have, but even it can come to its limits at times. I work in a position where I develope with poetry and have to deploy without it (using venv), and I do not wish the journey of learning how to do that on anybody.</div><br/></div></div><div id="39256191" class="c"><input type="checkbox" id="c-39256191" checked=""/><div class="controls bullet"><span class="by">djstein</span><span>|</span><a href="#39258648">prev</a><span>|</span><a href="#39256238">next</a><span>|</span><label class="collapse" for="c-39256191">[-]</label><label class="expand" for="c-39256191">[1 more]</label></div><br/><div class="children"><div class="content">I’m happy others are writing on this subject! I appreciate your enthusiasm for trying to do the most “basic” things in Python. While I personally enjoy a bit more management with tools like Poetry, I believe all Python programmers should know how pip and setuptools work before trying their supersets.<p>To add to this discussion, I recently wrote this less wordy guide on macOS Python setup <a href="https:&#x2F;&#x2F;steins.studio&#x2F;technical&#x2F;01-python-setup" rel="nofollow">https:&#x2F;&#x2F;steins.studio&#x2F;technical&#x2F;01-python-setup</a></div><br/></div></div><div id="39256238" class="c"><input type="checkbox" id="c-39256238" checked=""/><div class="controls bullet"><span class="by">Humphrey</span><span>|</span><a href="#39256191">prev</a><span>|</span><a href="#39258406">next</a><span>|</span><label class="collapse" for="c-39256238">[-]</label><label class="expand" for="c-39256238">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve landed on Poetry after having tried many different options over the years. Being able to specify my relatively open dependencies (Eg &quot;django==4.0.*&quot;) but having the exact version of every subdependency versioned has proved to be very reliable and reproducable. Docker multistage builds allow me to ship a production container without Poetry installed.</div><br/><div id="39257328" class="c"><input type="checkbox" id="c-39257328" checked=""/><div class="controls bullet"><span class="by">selcuka</span><span>|</span><a href="#39256238">parent</a><span>|</span><a href="#39258406">next</a><span>|</span><label class="collapse" for="c-39257328">[-]</label><label class="expand" for="c-39257328">[1 more]</label></div><br/><div class="children"><div class="content">Note that you can also accomplish the same with pip using the tilde operator in your requirements.txt (e.g. Django~=4.0), and Constraints Files [1] for the subdependencies.<p>A multistage build is still recommended as building your dependencies might need gcc or other tools.<p>[1] <a href="https:&#x2F;&#x2F;pip.pypa.io&#x2F;en&#x2F;stable&#x2F;user_guide&#x2F;#constraints-files" rel="nofollow">https:&#x2F;&#x2F;pip.pypa.io&#x2F;en&#x2F;stable&#x2F;user_guide&#x2F;#constraints-files</a></div><br/></div></div></div></div><div id="39258406" class="c"><input type="checkbox" id="c-39258406" checked=""/><div class="controls bullet"><span class="by">ildjarn</span><span>|</span><a href="#39256238">prev</a><span>|</span><a href="#39188802">next</a><span>|</span><label class="collapse" for="c-39258406">[-]</label><label class="expand" for="c-39258406">[1 more]</label></div><br/><div class="children"><div class="content">Has anyone figured out to how to “cross-compile” Python?<p>By this I mean creating an app bundle that contains the dependencies but for another platform than the one we are bundling on.</div><br/></div></div><div id="39188802" class="c"><input type="checkbox" id="c-39188802" checked=""/><div class="controls bullet"><span class="by">posix_monad</span><span>|</span><a href="#39258406">prev</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39188802">[-]</label><label class="expand" for="c-39188802">[10 more]</label></div><br/><div class="children"><div class="content">The &quot;boring&quot; set of tools described here does not enable reproducible artefacts. This is a huge weakness of the ecosystem.</div><br/><div id="39190478" class="c"><input type="checkbox" id="c-39190478" checked=""/><div class="controls bullet"><span class="by">bruh2</span><span>|</span><a href="#39188802">parent</a><span>|</span><a href="#39256207">next</a><span>|</span><label class="collapse" for="c-39190478">[-]</label><label class="expand" for="c-39190478">[2 more]</label></div><br/><div class="children"><div class="content">Hmm, why not? I thought the hashes feature of pip-tools solve this problem</div><br/><div id="39256068" class="c"><input type="checkbox" id="c-39256068" checked=""/><div class="controls bullet"><span class="by">the_mitsuhiko</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39190478">parent</a><span>|</span><a href="#39256207">next</a><span>|</span><label class="collapse" for="c-39256068">[-]</label><label class="expand" for="c-39256068">[1 more]</label></div><br/><div class="children"><div class="content">Unfortunately that feature is easy to break: <a href="https:&#x2F;&#x2F;github.com&#x2F;pypa&#x2F;pip&#x2F;issues&#x2F;9644">https:&#x2F;&#x2F;github.com&#x2F;pypa&#x2F;pip&#x2F;issues&#x2F;9644</a></div><br/></div></div></div></div><div id="39256207" class="c"><input type="checkbox" id="c-39256207" checked=""/><div class="controls bullet"><span class="by">linkdd</span><span>|</span><a href="#39188802">parent</a><span>|</span><a href="#39190478">prev</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39256207">[-]</label><label class="expand" for="c-39256207">[7 more]</label></div><br/><div class="children"><div class="content">Of this specific solution yes, of the &quot;ecosystem&quot; no. This has been solved by many other solutions (pipenv, poetry, pdm, etc...).</div><br/><div id="39256442" class="c"><input type="checkbox" id="c-39256442" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39256207">parent</a><span>|</span><a href="#39256242">next</a><span>|</span><label class="collapse" for="c-39256442">[-]</label><label class="expand" for="c-39256442">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This has been solved by many other solutions (pipenv, poetry, pdm, etc...).<p>It&#x27;s been <i>repeatedly not solved</i> by the new tool the Python ecosystem comes up with every few years, IME. (It reminds me of an old quote I can&#x27;t find about how every new version of C++ contains new features to fix the problems with the new features in the previous version of C++)</div><br/></div></div><div id="39256242" class="c"><input type="checkbox" id="c-39256242" checked=""/><div class="controls bullet"><span class="by">barbazoo</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39256207">parent</a><span>|</span><a href="#39256442">prev</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39256242">[-]</label><label class="expand" for="c-39256242">[5 more]</label></div><br/><div class="children"><div class="content">I haven’t tested this yet but what’s better about pipfile.lock over whatever pip-compile spits out? It sounds like both are exact versions of packages, no?</div><br/><div id="39256271" class="c"><input type="checkbox" id="c-39256271" checked=""/><div class="controls bullet"><span class="by">linkdd</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39256242">parent</a><span>|</span><a href="#39256672">next</a><span>|</span><label class="collapse" for="c-39256271">[-]</label><label class="expand" for="c-39256271">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know about pipfile.lock nor pip-compile, once I tested poetry I stuck to it without rethinking it (because I have better things to do than test all the package managers out there).<p>But the poetry.lock contains hashes as well.</div><br/></div></div><div id="39256672" class="c"><input type="checkbox" id="c-39256672" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39256242">parent</a><span>|</span><a href="#39256271">prev</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39256672">[-]</label><label class="expand" for="c-39256672">[3 more]</label></div><br/><div class="children"><div class="content">Pipfile.lock is broken if you have wheels wrapping compiled code as it captures the arch in the lock file! Poetry doesn&#x27;t do this, so you can lock on your M2 Mac and install on x86 fine.<p>Pip-compile in the most common use just creates a requirements.txt with everything pinned to a given version.<p>I think you can do hash stuff with it, but haven&#x27;t used that part.</div><br/><div id="39257540" class="c"><input type="checkbox" id="c-39257540" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39256672">parent</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39257540">[-]</label><label class="expand" for="c-39257540">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re building for multiple platforms, it doesn&#x27;t make <i>sense</i> to lock your dependencies.<p>&quot;Some platforms need newer versions&quot; is the default case; don&#x27;t make your tools fight it.<p>That said, package managers that do timestamp-based version filtering would be very useful.</div><br/><div id="39257873" class="c"><input type="checkbox" id="c-39257873" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#39188802">root</a><span>|</span><a href="#39257540">parent</a><span>|</span><a href="#39256702">next</a><span>|</span><label class="collapse" for="c-39257873">[-]</label><label class="expand" for="c-39257873">[1 more]</label></div><br/><div class="children"><div class="content">Eh? We&#x27;re locking the version of the dependency, we don&#x27;t need to look the particular compiled version of it, because they only differ in which architecture they were compiled for. We want 3.2.0 of dep_x on ARM and on x86_64, the last thing we want is running different versions of a dependency in different environments, that way lies madness.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="39256702" class="c"><input type="checkbox" id="c-39256702" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#39188802">prev</a><span>|</span><a href="#39258400">next</a><span>|</span><label class="collapse" for="c-39256702">[-]</label><label class="expand" for="c-39256702">[1 more]</label></div><br/><div class="children"><div class="content">The biggest problem in Python dep management is Pip. When upgrading pip breaks tools wrapping&#x2F;integrating with it, it&#x27;s a bad time.<p>I&#x27;ve had to pin pip itself a few times due to resolution that used to work failing, and sometimes there&#x27;s breaking API changes at the module level.<p>Oh and also because setup.pys in packages are somehow tied to pip apis.<p>It&#x27;s a weak foundation to build from.</div><br/></div></div><div id="39258400" class="c"><input type="checkbox" id="c-39258400" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#39256702">prev</a><span>|</span><a href="#39256877">next</a><span>|</span><label class="collapse" for="c-39258400">[-]</label><label class="expand" for="c-39258400">[1 more]</label></div><br/><div class="children"><div class="content">Of course you can tame your snake with a container.</div><br/></div></div><div id="39256877" class="c"><input type="checkbox" id="c-39256877" checked=""/><div class="controls bullet"><span class="by">yijiahe</span><span>|</span><a href="#39258400">prev</a><span>|</span><a href="#39258568">next</a><span>|</span><label class="collapse" for="c-39256877">[-]</label><label class="expand" for="c-39256877">[3 more]</label></div><br/><div class="children"><div class="content">The author mentions using pip freeze or pip-tools pip-compile as a solution to the indirect dependencies which are reliant on the Python environment, i.e. the platform and Python version.<p>But from what I understand pip cross-environment usage needs the requirements.txt file to be generated on the environment it is going to be run on. The solution of copying in the same requirements text for installing the packages locally might not work in the container.</div><br/><div id="39257119" class="c"><input type="checkbox" id="c-39257119" checked=""/><div class="controls bullet"><span class="by">jvolkman</span><span>|</span><a href="#39256877">parent</a><span>|</span><a href="#39258568">next</a><span>|</span><label class="collapse" for="c-39257119">[-]</label><label class="expand" for="c-39257119">[2 more]</label></div><br/><div class="children"><div class="content">You are correct. Poetry and PDM solve this problem.</div><br/><div id="39258407" class="c"><input type="checkbox" id="c-39258407" checked=""/><div class="controls bullet"><span class="by">geethree</span><span>|</span><a href="#39256877">root</a><span>|</span><a href="#39257119">parent</a><span>|</span><a href="#39258568">next</a><span>|</span><label class="collapse" for="c-39258407">[-]</label><label class="expand" for="c-39258407">[1 more]</label></div><br/><div class="children"><div class="content">As does the PEX(python executable) project.</div><br/></div></div></div></div></div></div><div id="39258568" class="c"><input type="checkbox" id="c-39258568" checked=""/><div class="controls bullet"><span class="by">globular-toast</span><span>|</span><a href="#39256877">prev</a><span>|</span><a href="#39257229">next</a><span>|</span><label class="collapse" for="c-39258568">[-]</label><label class="expand" for="c-39258568">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s my &quot;boring&quot; workflow:<p>1. Start project (mkdir, git init),<p>2. Make virtualenv using virtualenvwrapper,<p>3. Write project.toml file for setuptools,<p>4. pip install -e .<p>5. To add deps, add them to pyproject.toml and repeat step 4. <i>Do not pip install deps directly</i>. Do not pin deps to any particular version, but if you have to you can add constraints like &gt;=5 (I need a feature introduced in v5).<p>6. If you are writing a package to be pip installed by others then you&#x27;re done. Read setuptools docs for how to build etc.<p>7. If you also want to build an <i>environment</i> to run your code (e.g. docker image for deployment or serverless deployment etc) use pip-tools to pin your dependencies. (This is the only reason you need requirements.txt).<p>8. For test dependencies (e.g. pytest) or dev dependencies (e.g. test server) leverage optional dependencies in the pyproject.toml file. This plays very nicely with tools like tox, which you should use. Use pre-commit for linting etc.</div><br/></div></div><div id="39257229" class="c"><input type="checkbox" id="c-39257229" checked=""/><div class="controls bullet"><span class="by">ktbwrestler</span><span>|</span><a href="#39258568">prev</a><span>|</span><a href="#39257838">next</a><span>|</span><label class="collapse" for="c-39257229">[-]</label><label class="expand" for="c-39257229">[2 more]</label></div><br/><div class="children"><div class="content">This is great! Does anyone know of a similar resource for ruby?</div><br/><div id="39257326" class="c"><input type="checkbox" id="c-39257326" checked=""/><div class="controls bullet"><span class="by">rcaught</span><span>|</span><a href="#39257229">parent</a><span>|</span><a href="#39257838">next</a><span>|</span><label class="collapse" for="c-39257326">[-]</label><label class="expand" for="c-39257326">[1 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t need one, because Ruby dependency management isn&#x27;t a clusterf#!k like Python&#x27;s.</div><br/></div></div></div></div><div id="39257838" class="c"><input type="checkbox" id="c-39257838" checked=""/><div class="controls bullet"><span class="by">nurettin</span><span>|</span><a href="#39257229">prev</a><span>|</span><label class="collapse" for="c-39257838">[-]</label><label class="expand" for="c-39257838">[1 more]</label></div><br/><div class="children"><div class="content">pip install, pip freeze, let&#x27;s return to our roots and whatnot. But what if there are dependency constraints?</div><br/></div></div></div></div></div></div></div></body></html>