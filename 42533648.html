<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735635663378" as="style"/><link rel="stylesheet" href="styles.css?v=1735635663378"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/jeremyevans/ruby-refrigerator">Ruby-refrigerator: Freeze all core Ruby classes</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>thunderbong</span> | <span>6 comments</span></div><br/><div><div id="42557457" class="c"><input type="checkbox" id="c-42557457" checked=""/><div class="controls bullet"><span class="by">dominicrose</span><span>|</span><a href="#42556974">next</a><span>|</span><label class="collapse" for="c-42557457">[-]</label><label class="expand" for="c-42557457">[1 more]</label></div><br/><div class="children"><div class="content">I used to work with smalltalk. There was a TON of added methods on the class Object and others. When I said something about it I was told this is OOP :)</div><br/></div></div><div id="42556974" class="c"><input type="checkbox" id="c-42556974" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#42557457">prev</a><span>|</span><a href="#42557113">next</a><span>|</span><label class="collapse" for="c-42556974">[-]</label><label class="expand" for="c-42556974">[1 more]</label></div><br/><div class="children"><div class="content">Love this.<p>In my own projects most of my Ruby classes are data objects that I freeze (along with their instance variables) immediately after creation. Methods can query the state of these objects but anything that involves changing state requires returning new objects (possibly of different classes).<p>Not mutating anything has prevented <i>so many</i> bugs. And as an added bonus most of my code has been able to be parallelized pretty trivially.<p>One style nit though;<p><pre><code>    version_int = RUBY_VERSION[0..2].sub(&#x27;.&#x27;, &#x27;&#x27;).to_i
    filepath = lambda do
      File.expand_path(File.join(File.expand_path(__FILE__), &quot;..&#x2F;..&#x2F;module_names&#x2F;#{version_int}.txt&quot;))
    end
    if version_int &gt;= 18
      # :nocov:
      version_int -= 1 until File.file?(filepath.call)
      # :nocov:
    end
</code></pre>
Why not the simpler<p><pre><code>    version = RUBY_VERSION[0..2].sub(&#x27;.&#x27;, &#x27;&#x27;).to_i

    path = version.downto(18) 
      .map    { |v| &quot;#{__FILE__}&#x2F;..&#x2F;..&#x2F;module_names&#x2F;#{v}.txt&quot; }
      .map    { |p| File.expand_path(p) }
      .detect { |p| File.file?(p) }
</code></pre>
Also this logic will definitely misbehave if there&#x27;s ever a Ruby 3.xx.</div><br/></div></div><div id="42557113" class="c"><input type="checkbox" id="c-42557113" checked=""/><div class="controls bullet"><span class="by">pdntspa</span><span>|</span><a href="#42556974">prev</a><span>|</span><a href="#42556620">next</a><span>|</span><label class="collapse" for="c-42557113">[-]</label><label class="expand" for="c-42557113">[2 more]</label></div><br/><div class="children"><div class="content">As someone who inherited a codebase where we make liberal use of a monkeypatched `Object.const_missing`, and which breaks the code in frustrating and mysterious ways, thank you!</div><br/><div id="42557242" class="c"><input type="checkbox" id="c-42557242" checked=""/><div class="controls bullet"><span class="by">EdwardDiego</span><span>|</span><a href="#42557113">parent</a><span>|</span><a href="#42556620">next</a><span>|</span><label class="collapse" for="c-42557242">[-]</label><label class="expand" for="c-42557242">[1 more]</label></div><br/><div class="children"><div class="content">Trying to remember how Zed Shaw once phrased some of the shenanigans in Ruby codebases, I&#x27;m pretty sure it was something about &quot;chainsaw juggling monkey patching.&quot;</div><br/></div></div></div></div><div id="42556620" class="c"><input type="checkbox" id="c-42556620" checked=""/><div class="controls bullet"><span class="by">ilvez</span><span>|</span><a href="#42557113">prev</a><span>|</span><label class="collapse" for="c-42556620">[-]</label><label class="expand" for="c-42556620">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for linking. I have an huge legacy app that could use analysis like this.<p>Wondering how it works with Rails or the the analysis starts after I freeze? So I could only track my app specific modifications, since thats the interesting part.</div><br/></div></div></div></div></div></div></div></body></html>