<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696755677368" as="style"/><link rel="stylesheet" href="styles.css?v=1696755677368"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/efrecon/pgbackup">Dockerized local and offline backing up of PostgreSQL with rotation, compression</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>thunderbong</span> | <span>21 comments</span></div><br/><div><div id="37805833" class="c"><input type="checkbox" id="c-37805833" checked=""/><div class="controls bullet"><span class="by">michelpp</span><span>|</span><a href="#37805680">next</a><span>|</span><label class="collapse" for="c-37805833">[-]</label><label class="expand" for="c-37805833">[10 more]</label></div><br/><div class="children"><div class="content">Alternatively you could use Continuous Archiving with Point In Time Recovery [1] which has been built into Postgres for a while.  Once your db exceeds several tens of gigabytes dumping to SQL is just not a viable solution anymore.<p>[1] <a href="https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;continuous-archiving.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;continuous-archiving...</a></div><br/><div id="37806587" class="c"><input type="checkbox" id="c-37806587" checked=""/><div class="controls bullet"><span class="by">btown</span><span>|</span><a href="#37805833">parent</a><span>|</span><a href="#37806143">next</a><span>|</span><label class="collapse" for="c-37806587">[-]</label><label class="expand" for="c-37806587">[2 more]</label></div><br/><div class="children"><div class="content">Are there any standalone projects for this? A stable docker image that I can point to a Postgres server that can handle both archiving streamed logs to storage and populating a standby (say, on a different cloud) in real time?</div><br/><div id="37807342" class="c"><input type="checkbox" id="c-37807342" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37806587">parent</a><span>|</span><a href="#37806143">next</a><span>|</span><label class="collapse" for="c-37807342">[-]</label><label class="expand" for="c-37807342">[1 more]</label></div><br/><div class="children"><div class="content">Pgbackrest probably?</div><br/></div></div></div></div><div id="37806143" class="c"><input type="checkbox" id="c-37806143" checked=""/><div class="controls bullet"><span class="by">stavros</span><span>|</span><a href="#37805833">parent</a><span>|</span><a href="#37806587">prev</a><span>|</span><a href="#37806115">next</a><span>|</span><label class="collapse" for="c-37806143">[-]</label><label class="expand" for="c-37806143">[6 more]</label></div><br/><div class="children"><div class="content">This is great, I just wish it were a bit easier to set up and configure. That multi-page wall-of-text document is not looking inviting at all.</div><br/><div id="37806198" class="c"><input type="checkbox" id="c-37806198" checked=""/><div class="controls bullet"><span class="by">javaunsafe2019</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37806143">parent</a><span>|</span><a href="#37807396">next</a><span>|</span><label class="collapse" for="c-37806198">[-]</label><label class="expand" for="c-37806198">[1 more]</label></div><br/><div class="children"><div class="content">Really? I just read over it lying in bed for the last 15 minutes and found it super straight forward and well explained. Kudos to the pg team!</div><br/></div></div><div id="37807396" class="c"><input type="checkbox" id="c-37807396" checked=""/><div class="controls bullet"><span class="by">fiddlerwoaroof</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37806143">parent</a><span>|</span><a href="#37806198">prev</a><span>|</span><a href="#37806115">next</a><span>|</span><label class="collapse" for="c-37807396">[-]</label><label class="expand" for="c-37807396">[4 more]</label></div><br/><div class="children"><div class="content">It’s funny how you just can’t win with documentation: either “there is no documentation” or “tl;dr”</div><br/><div id="37808689" class="c"><input type="checkbox" id="c-37808689" checked=""/><div class="controls bullet"><span class="by">stavros</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37807396">parent</a><span>|</span><a href="#37808625">next</a><span>|</span><label class="collapse" for="c-37808689">[-]</label><label class="expand" for="c-37808689">[1 more]</label></div><br/><div class="children"><div class="content">In your opinion the two choices are &quot;no documentation&quot; and &quot;badly-written documentation&quot;?</div><br/></div></div><div id="37808625" class="c"><input type="checkbox" id="c-37808625" checked=""/><div class="controls bullet"><span class="by">quest88</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37807396">parent</a><span>|</span><a href="#37808689">prev</a><span>|</span><a href="#37807528">next</a><span>|</span><label class="collapse" for="c-37808625">[-]</label><label class="expand" for="c-37808625">[1 more]</label></div><br/><div class="children"><div class="content">Queue the future “show hn: a lightweight pg backup solution”</div><br/></div></div><div id="37807528" class="c"><input type="checkbox" id="c-37807528" checked=""/><div class="controls bullet"><span class="by">BigJono</span><span>|</span><a href="#37805833">root</a><span>|</span><a href="#37807396">parent</a><span>|</span><a href="#37808625">prev</a><span>|</span><a href="#37806115">next</a><span>|</span><label class="collapse" for="c-37807528">[-]</label><label class="expand" for="c-37807528">[1 more]</label></div><br/><div class="children"><div class="content">Surely if there&#x27;s anything you don&#x27;t need a &#x27;tl;dr&#x27; for it&#x27;s setting up your database backups lol.<p>I just had a quick skim of those docs, looks like lots of paragraphs going over all of all the things that can go wrong and how to prevent them. Good. If it takes a week to read all that and set up then it takes a week. I&#x27;ll take a pass on the &quot;docker container that just does it for me&quot; thanks.</div><br/></div></div></div></div></div></div><div id="37806115" class="c"><input type="checkbox" id="c-37806115" checked=""/><div class="controls bullet"><span class="by">itsthecourier</span><span>|</span><a href="#37805833">parent</a><span>|</span><a href="#37806143">prev</a><span>|</span><a href="#37805680">next</a><span>|</span><label class="collapse" for="c-37806115">[-]</label><label class="expand" for="c-37806115">[1 more]</label></div><br/><div class="children"><div class="content">Exactly, this is the way</div><br/></div></div></div></div><div id="37805680" class="c"><input type="checkbox" id="c-37805680" checked=""/><div class="controls bullet"><span class="by">INTPenis</span><span>|</span><a href="#37805833">prev</a><span>|</span><a href="#37806193">next</a><span>|</span><label class="collapse" for="c-37805680">[-]</label><label class="expand" for="c-37805680">[5 more]</label></div><br/><div class="children"><div class="content">Sometimes it&#x27;s like HN is reading my mind.<p>I just finished a setup where I run PostgreSQL as a quadlet on CoreOS, and in order to manage backups I use systemd Require so the postgres container depends on a pgbackrest container that just runs a relatively simple script to check if storage is empty or not, and restores the backup from S3 if storage is empty.<p>And another container runs as a oneshot timer that takes full and incremental backups to S3.<p>Instead of this [1] I use a much simpler while ! pg_isready loop.<p>1. <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;efrecon&#x2F;86456960e2110b287632fd7f42c1cd31&#x2F;1c5c811126d981507bbd6bbd70c0cfe7e9521644" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;efrecon&#x2F;86456960e2110b287632fd7f42c1...</a></div><br/><div id="37808316" class="c"><input type="checkbox" id="c-37808316" checked=""/><div class="controls bullet"><span class="by">mati365</span><span>|</span><a href="#37805680">parent</a><span>|</span><a href="#37807329">next</a><span>|</span><label class="collapse" for="c-37808316">[-]</label><label class="expand" for="c-37808316">[2 more]</label></div><br/><div class="children"><div class="content">How do you update postgres on CoreOS? Its better to keep IT immutable so in case of change the whole image must be recreated?</div><br/><div id="37808330" class="c"><input type="checkbox" id="c-37808330" checked=""/><div class="controls bullet"><span class="by">INTPenis</span><span>|</span><a href="#37805680">root</a><span>|</span><a href="#37808316">parent</a><span>|</span><a href="#37807329">next</a><span>|</span><label class="collapse" for="c-37808330">[-]</label><label class="expand" for="c-37808330">[1 more]</label></div><br/><div class="children"><div class="content">I assume you mean major release upgrade, I haven&#x27;t gotten that far yet so I view it as a problem to solve once it arises. Obviously it runs in a container, but I have to run the pg_upgrade tool before I start the new container image tag.<p>An immutable OS like CoreOS for example isn&#x27;t much different than a regular distro. You can still do a lot of manual work on it if you want. I try to avoid doing manual work on it because I want to be strict IaC, but I can for example test doing a major release upgrade in staging, manually over SSH, and work out the kinks, before I put it into practice using containers and scripts in production.<p>Though I see very little reason to automate the hell out of a major release upgrade, better do it safely and slowly with SOP&#x27;s.</div><br/></div></div></div></div><div id="37807329" class="c"><input type="checkbox" id="c-37807329" checked=""/><div class="controls bullet"><span class="by">teaearlgraycold</span><span>|</span><a href="#37805680">parent</a><span>|</span><a href="#37808316">prev</a><span>|</span><a href="#37806193">next</a><span>|</span><label class="collapse" for="c-37807329">[-]</label><label class="expand" for="c-37807329">[2 more]</label></div><br/><div class="children"><div class="content">Why use which instead of just calling nc directly?</div><br/><div id="37808315" class="c"><input type="checkbox" id="c-37808315" checked=""/><div class="controls bullet"><span class="by">INTPenis</span><span>|</span><a href="#37805680">root</a><span>|</span><a href="#37807329">parent</a><span>|</span><a href="#37806193">next</a><span>|</span><label class="collapse" for="c-37808315">[-]</label><label class="expand" for="c-37808315">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not my script, it&#x27;s the script used by the linked project.<p>I use pg_isready. Unfortunately I won&#x27;t link my project because I try to keep this HN account separate from my true identity.</div><br/></div></div></div></div></div></div><div id="37806193" class="c"><input type="checkbox" id="c-37806193" checked=""/><div class="controls bullet"><span class="by">Belphemur</span><span>|</span><a href="#37805680">prev</a><span>|</span><a href="#37806021">next</a><span>|</span><label class="collapse" for="c-37806193">[-]</label><label class="expand" for="c-37806193">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using Borgmatic for this.<p>It does everything, uses pg_dump under the hood, and adds the output as files for Borg.<p>Borg then takes care of encryption,  incremental and also bit rot. Best solution ever in my book.<p>Also you can directly restore the db with Borgmatic.<p><a href="https:&#x2F;&#x2F;torsion.org&#x2F;borgmatic&#x2F;docs&#x2F;how-to&#x2F;backup-your-databases&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;torsion.org&#x2F;borgmatic&#x2F;docs&#x2F;how-to&#x2F;backup-your-databa...</a></div><br/><div id="37806765" class="c"><input type="checkbox" id="c-37806765" checked=""/><div class="controls bullet"><span class="by">gkhartman</span><span>|</span><a href="#37806193">parent</a><span>|</span><a href="#37807143">next</a><span>|</span><label class="collapse" for="c-37806765">[-]</label><label class="expand" for="c-37806765">[1 more]</label></div><br/><div class="children"><div class="content">This looks great.  When working in smaller teams, there&#x27;s a lot of pushback when the suggestion of adding a new tool comes up, mostly due to the learning overhead involved.  This might be just what we need, since it leverages existing tools many are familiar with already.  Thanks for the suggestion.</div><br/></div></div><div id="37807143" class="c"><input type="checkbox" id="c-37807143" checked=""/><div class="controls bullet"><span class="by">BonoboIO</span><span>|</span><a href="#37806193">parent</a><span>|</span><a href="#37806765">prev</a><span>|</span><a href="#37806021">next</a><span>|</span><label class="collapse" for="c-37807143">[-]</label><label class="expand" for="c-37807143">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the tip. Maybe this will replace my shell automysqlbackup script.</div><br/></div></div></div></div><div id="37807351" class="c"><input type="checkbox" id="c-37807351" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37806021">prev</a><span>|</span><label class="collapse" for="c-37807351">[-]</label><label class="expand" for="c-37807351">[1 more]</label></div><br/><div class="children"><div class="content">Cloudnativepg or crunchydata postgres operator takes care of this.</div><br/></div></div></div></div></div></div></div></body></html>