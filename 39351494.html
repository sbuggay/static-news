<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707814871947" as="style"/><link rel="stylesheet" href="styles.css?v=1707814871947"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://peps.python.org/pep-0701/">PEP 701 – Syntactic formalization of f-strings</a> <span class="domain">(<a href="https://peps.python.org">peps.python.org</a>)</span></div><div class="subtext"><span>PaulHoule</span> | <span>18 comments</span></div><br/><div><div id="39354636" class="c"><input type="checkbox" id="c-39354636" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39355638">next</a><span>|</span><label class="collapse" for="c-39354636">[-]</label><label class="expand" for="c-39354636">[3 more]</label></div><br/><div class="children"><div class="content">For your information, this has been already added to Python 3.12 released last year. (PEP should really highlight a `Python-Version` field for accepted proposals if the target version has been already released.)</div><br/><div id="39355422" class="c"><input type="checkbox" id="c-39355422" checked=""/><div class="controls bullet"><span class="by">xavdid</span><span>|</span><a href="#39354636">parent</a><span>|</span><a href="#39355638">next</a><span>|</span><label class="collapse" for="c-39355422">[-]</label><label class="expand" for="c-39355422">[2 more]</label></div><br/><div class="children"><div class="content">&gt; PEP should really highlight a `Python-Version` field for accepted proposals if the target version has been already released.<p>I&#x27;ve got some great news: <a href="https:&#x2F;&#x2F;cdn.zappy.app&#x2F;339d2e16228a195e5149cdcf05edd572.png" rel="nofollow">https:&#x2F;&#x2F;cdn.zappy.app&#x2F;339d2e16228a195e5149cdcf05edd572.png</a></div><br/><div id="39355497" class="c"><input type="checkbox" id="c-39355497" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39354636">root</a><span>|</span><a href="#39355422">parent</a><span>|</span><a href="#39355638">next</a><span>|</span><label class="collapse" for="c-39355497">[-]</label><label class="expand" for="c-39355497">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Highlight&quot; in the sense of making it more pronounced in some way (e.g. background color, a link to the release notes etc). Also it takes time from the acceptance to the general availability of given PEP, and I think it shouldn&#x27;t be highlighted for that period.</div><br/></div></div></div></div></div></div><div id="39355638" class="c"><input type="checkbox" id="c-39355638" checked=""/><div class="controls bullet"><span class="by">int_19h</span><span>|</span><a href="#39354636">prev</a><span>|</span><a href="#39353610">next</a><span>|</span><label class="collapse" for="c-39355638">[-]</label><label class="expand" for="c-39355638">[2 more]</label></div><br/><div class="children"><div class="content">I wonder sometimes if the very notion of a string concatenation operator was a detour in the wrong direction of PL design back in the days, just because they didn&#x27;t come up with the idea of strings with embedded expressions first. If you have those, then concat(a,b) is just &quot;{a}{b}&quot;, making it very clear that operands and result are all strings, and dodging the whole issue of overloading + in a non-numeric and non-commutative context (or else coming up with a different operator).</div><br/><div id="39355762" class="c"><input type="checkbox" id="c-39355762" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39355638">parent</a><span>|</span><a href="#39353610">next</a><span>|</span><label class="collapse" for="c-39355762">[-]</label><label class="expand" for="c-39355762">[1 more]</label></div><br/><div class="children"><div class="content">Good point, and I think a syntax played a great role here. Before C#-style formatting syntax, many if not most formatting syntaxes were signaled by a single character (`%` in C printf, `$` in sh, `~` in Common Lisp and so on), probably because it was easy to implement with a simple scanner. Those were obviously difficult to extend, because the last character is implicit and not only embedded expressions but pretty much every additional syntax had to be sandwiched between the signaling character and other existing syntaxes [1]. Grouping characters are much more flexible in comparison and it should have been a natural extension to allow any expression inside.<p>[1] Some did recognize this difficulty and introduced an additional pair of grouping characters (e.g. `%|asdf|` or `${asdf}`). These were however rare, and those that ultimately allowed an arbitrary expression were even rarer.</div><br/></div></div></div></div><div id="39353610" class="c"><input type="checkbox" id="c-39353610" checked=""/><div class="controls bullet"><span class="by">atoav</span><span>|</span><a href="#39355638">prev</a><span>|</span><label class="collapse" for="c-39353610">[-]</label><label class="expand" for="c-39353610">[12 more]</label></div><br/><div class="children"><div class="content">This is a good PEP. As f-strings were introduced I switched everything except the simplest things to it.<p>Especially allowing backslash and arbitrary quotes inside the expressions is a welcome and useful change, as this makes f-strings work more as expected without having to remember a lot of special edge cases and work arounds.</div><br/><div id="39355034" class="c"><input type="checkbox" id="c-39355034" checked=""/><div class="controls bullet"><span class="by">Affric</span><span>|</span><a href="#39353610">parent</a><span>|</span><a href="#39355234">next</a><span>|</span><label class="collapse" for="c-39355034">[-]</label><label class="expand" for="c-39355034">[5 more]</label></div><br/><div class="children"><div class="content">&gt; As f-strings were introduced I switched everything except the simplest things to it.<p>Never really understood why not all strings were f-strings in python.</div><br/><div id="39355121" class="c"><input type="checkbox" id="c-39355121" checked=""/><div class="controls bullet"><span class="by">owl57</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355034">parent</a><span>|</span><a href="#39355394">next</a><span>|</span><label class="collapse" for="c-39355121">[-]</label><label class="expand" for="c-39355121">[1 more]</label></div><br/><div class="children"><div class="content">From the start? I guess because the spirit of Python&#x27;s syntax is anti-Perl.<p>Now? Maybe because another breaking change in strings is the worst nightmare of the current generation of Python developers.</div><br/></div></div><div id="39355394" class="c"><input type="checkbox" id="c-39355394" checked=""/><div class="controls bullet"><span class="by">DonaldPShimoda</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355034">parent</a><span>|</span><a href="#39355121">prev</a><span>|</span><a href="#39355628">next</a><span>|</span><label class="collapse" for="c-39355394">[-]</label><label class="expand" for="c-39355394">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Never really understood why not all strings were f-strings in python.<p>Sometimes you don&#x27;t want interpolation, and it seems more reasonable to default to a version without such a feature than to default to a version with it and have an alternate syntax for non-interpolated strings. Or, at least, that makes sense to me, but I have no knowledge of their motivations.</div><br/></div></div><div id="39355628" class="c"><input type="checkbox" id="c-39355628" checked=""/><div class="controls bullet"><span class="by">int_19h</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355034">parent</a><span>|</span><a href="#39355394">prev</a><span>|</span><a href="#39355134">next</a><span>|</span><label class="collapse" for="c-39355628">[-]</label><label class="expand" for="c-39355628">[1 more]</label></div><br/><div class="children"><div class="content">Because it wouldn&#x27;t be backwards-compatible.<p>If Python were designed from scratch today, I suspect it&#x27;d do something similar to JS.</div><br/></div></div><div id="39355134" class="c"><input type="checkbox" id="c-39355134" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355034">parent</a><span>|</span><a href="#39355628">prev</a><span>|</span><a href="#39355234">next</a><span>|</span><label class="collapse" for="c-39355134">[-]</label><label class="expand" for="c-39355134">[1 more]</label></div><br/><div class="children"><div class="content">Python f-strings are modelled after `string.format`, which is inspired by C# and introduced relatively later. Such interpolated strings would have been much more inconvenient for the older printf-like syntax.</div><br/></div></div></div></div><div id="39355234" class="c"><input type="checkbox" id="c-39355234" checked=""/><div class="controls bullet"><span class="by">Hamuko</span><span>|</span><a href="#39353610">parent</a><span>|</span><a href="#39355034">prev</a><span>|</span><label class="collapse" for="c-39355234">[-]</label><label class="expand" for="c-39355234">[6 more]</label></div><br/><div class="children"><div class="content">f-strings are also the fastest way to format a string in Python from what I&#x27;ve seen.<p><pre><code>  $ python3.12 -m timeit &#x27;f&quot;Welcome to {2 ** 3}.&quot;&#x27;
  5000000 loops, best of 5: 69.8 nsec per loop
  $ python3.12 -m timeit &#x27;&quot;Welcome to {}.&quot;.format(2 ** 3)&#x27;
  2000000 loops, best of 5: 112 nsec per loop
  $ python3.12 -m timeit &#x27;&quot;Welcome to %d.&quot; % 2 ** 3&#x27;
  5000000 loops, best of 5: 82.2 nsec per loop
  $ python3.12 -m timeit &#x27;&quot;Welcome to &quot; + str(2 ** 3) + &quot;.&quot;&#x27;
  5000000 loops, best of 5: 77.5 nsec per loop</code></pre></div><br/><div id="39355419" class="c"><input type="checkbox" id="c-39355419" checked=""/><div class="controls bullet"><span class="by">owl57</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355234">parent</a><span>|</span><a href="#39355317">next</a><span>|</span><label class="collapse" for="c-39355419">[-]</label><label class="expand" for="c-39355419">[1 more]</label></div><br/><div class="children"><div class="content">TIL. str.format and % parse the format string at runtime, so it&#x27;s expected that they&#x27;re slower. But I thought the f-string desugars to something similar to the last one. Turns out it&#x27;s not, it compiles to specialized opcodes and avoids function calls:<p><a href="https:&#x2F;&#x2F;bugs.python.org&#x2F;issue25483" rel="nofollow">https:&#x2F;&#x2F;bugs.python.org&#x2F;issue25483</a><p><a href="https:&#x2F;&#x2F;bugs.python.org&#x2F;issue27078" rel="nofollow">https:&#x2F;&#x2F;bugs.python.org&#x2F;issue27078</a></div><br/></div></div><div id="39355317" class="c"><input type="checkbox" id="c-39355317" checked=""/><div class="controls bullet"><span class="by">elevatedastalt</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355234">parent</a><span>|</span><a href="#39355419">prev</a><span>|</span><a href="#39355434">next</a><span>|</span><label class="collapse" for="c-39355317">[-]</label><label class="expand" for="c-39355317">[3 more]</label></div><br/><div class="children"><div class="content">Surprising that the double concatenation is the second fastest!</div><br/><div id="39355550" class="c"><input type="checkbox" id="c-39355550" checked=""/><div class="controls bullet"><span class="by">L3viathan</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355317">parent</a><span>|</span><a href="#39355434">next</a><span>|</span><label class="collapse" for="c-39355550">[-]</label><label class="expand" for="c-39355550">[2 more]</label></div><br/><div class="children"><div class="content">Probably because the string is so short.</div><br/><div id="39355795" class="c"><input type="checkbox" id="c-39355795" checked=""/><div class="controls bullet"><span class="by">Hamuko</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355550">parent</a><span>|</span><a href="#39355434">next</a><span>|</span><label class="collapse" for="c-39355795">[-]</label><label class="expand" for="c-39355795">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, it&#x27;s not great with long strings. f-strings seem to be great just about always though. Highly recommend.<p><pre><code>  $ python3.12 -m timeit -s &#x27;import string&#x27; -s &#x27;x = string.printable * 50&#x27; &#x27;f&quot;Welcome to {x}.&quot;&#x27;
  2000000 loops, best of 5: 106 nsec per loop
  $ python3.12 -m timeit -s &#x27;import string&#x27; -s &#x27;x = string.printable * 50&#x27; &#x27;&quot;Welcome to {}.&quot;.format(x)&#x27;
  2000000 loops, best of 5: 200 nsec per loop
  $ python3.12 -m timeit -s &#x27;import string&#x27; -s &#x27;x = string.printable * 50&#x27; &#x27;&quot;Welcome to %s.&quot; % x&#x27;
  2000000 loops, best of 5: 169 nsec per loop
  $ python3.12 -m timeit -s &#x27;import string&#x27; -s &#x27;x = string.printable * 50&#x27; &#x27;&quot;Welcome to &quot; + str(x) + &quot;.&quot;&#x27;
  1000000 loops, best of 5: 214 nsec per loop
  $ python3.12 -m timeit -s &#x27;import string&#x27; -s &#x27;x = string.printable * 50&#x27; &#x27;&quot;Welcome to &quot; + x + &quot;.&quot;&#x27;
  1000000 loops, best of 5: 198 nsec per loop
</code></pre>
len(string.printable * 50) = 5000</div><br/></div></div></div></div></div></div><div id="39355434" class="c"><input type="checkbox" id="c-39355434" checked=""/><div class="controls bullet"><span class="by">DonHopkins</span><span>|</span><a href="#39353610">root</a><span>|</span><a href="#39355234">parent</a><span>|</span><a href="#39355317">prev</a><span>|</span><label class="collapse" for="c-39355434">[-]</label><label class="expand" for="c-39355434">[1 more]</label></div><br/><div class="children"><div class="content">I used to be skeptical, but the great David Beazley convinced me that f-strings rocked because they were faster and better, in his talk &quot;The Fun of Reinvention (Screencast)&quot;.<p>The point he made was to embrace the new features of Python, and put old Python out of its misery, instead of wasting your time with backwards compatibility.<p>Just call whatever you&#x27;re doing in the latest version of Python a &quot;prototype&quot;, then ship it.<p>At 10:20 he talks about things you can do to put old Python out of its misery (dead parrot), including f-strings and ordered dictionaries.<p>The Fun of Reinvention (Screencast):<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=js_0wjzuMfc" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=js_0wjzuMfc</a><p>Invited Keynote Talk from PyCon Israel, June 12, 2017.  I cause trouble and build a framework using all sorts of new Python 3.6+ features.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>