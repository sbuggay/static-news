<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1707814871947" as="style"/><link rel="stylesheet" href="styles.css?v=1707814871947"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.trailofbits.com/2023/09/18/security-flaws-in-an-sso-plugin-for-caddy/">Security flaws in an SSO plugin for Caddy (2023)</a> <span class="domain">(<a href="https://blog.trailofbits.com">blog.trailofbits.com</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>45 comments</span></div><br/><div><div id="39355321" class="c"><input type="checkbox" id="c-39355321" checked=""/><div class="controls bullet"><span class="by">kalev</span><span>|</span><a href="#39353351">next</a><span>|</span><label class="collapse" for="c-39355321">[-]</label><label class="expand" for="c-39355321">[4 more]</label></div><br/><div class="children"><div class="content">Huge credits to the Caddy team, I’ve been using Caddy for all of my production projects over 4+ years and it’s absolutely rock solid. Never had an issue with it. Unfortunate a 3rd party plugin here is causing fallout by other HNers dumping their negative remarks here. Still, a security plugin which seems to have holes in it is a bit awkward. I’m sure someone will pick up what’s needed to be done.</div><br/><div id="39355748" class="c"><input type="checkbox" id="c-39355748" checked=""/><div class="controls bullet"><span class="by">ThePhysicist</span><span>|</span><a href="#39355321">parent</a><span>|</span><a href="#39353351">next</a><span>|</span><label class="collapse" for="c-39355748">[-]</label><label class="expand" for="c-39355748">[3 more]</label></div><br/><div class="children"><div class="content">Yeah, occasional security issues are part of the game and nothing to be ashamed of, on the other hand Caddy&#x27;s headline is &quot;makes your sites more secure, more reliable, and more scalable than any other solution&quot;. Maybe they should cut back one the hyperbole a bit.<p>Seems a bit like the situation with Wordpress, the core is pretty solid security-wise but the third-party ecosystem isn&#x27;t as well-tested or maintained.</div><br/><div id="39355794" class="c"><input type="checkbox" id="c-39355794" checked=""/><div class="controls bullet"><span class="by">hhh</span><span>|</span><a href="#39355321">root</a><span>|</span><a href="#39355748">parent</a><span>|</span><a href="#39353351">next</a><span>|</span><label class="collapse" for="c-39355794">[-]</label><label class="expand" for="c-39355794">[2 more]</label></div><br/><div class="children"><div class="content">Why should they cut back on their offerings because of a third party plugin?</div><br/><div id="39355819" class="c"><input type="checkbox" id="c-39355819" checked=""/><div class="controls bullet"><span class="by">ThePhysicist</span><span>|</span><a href="#39355321">root</a><span>|</span><a href="#39355794">parent</a><span>|</span><a href="#39353351">next</a><span>|</span><label class="collapse" for="c-39355819">[-]</label><label class="expand" for="c-39355819">[1 more]</label></div><br/><div class="children"><div class="content">They can do what they want of course, for me it just sounds like hyperbole. People seem to be unable to give a realistic description of their software, everything always has to be the fastest, most scalable, most secure. Personally it&#x27;s a red flag especially in regards to security as it shows a cavalier attitude. Using e.g. math&#x2F;rand instead of crypto&#x2F;rand is a really basic mistake and something that any decent security reviewer would flag immediately. Trusting headers that can be spoofed is also one of the most basic attack vectors that e.g. a penetration tester will try out when seeing that a server makes use of header information for a security-critical code path. I mean people use this stuff in production to secure personal and other sensitive data, and they do so because the website literally tells them &quot;it&#x27;s the most secure solution out there&quot;. I don&#x27;t think most people get that the plugins are not part of the official distribution or have a different, much lower standard in terms of engineering security. That&#x27;s the core issue for me, it&#x27;s fine if your contributors are burnt out and don&#x27;t have time to fix security issues, it&#x27;s not day their job, but then stop telling people your solution is the best, most secure solution out there.<p>And if they want to support people then pay them, Caddy is owned by a large company so they should be able to pay maintainers for their most security-critical plugins.</div><br/></div></div></div></div></div></div></div></div><div id="39353351" class="c"><input type="checkbox" id="c-39353351" checked=""/><div class="controls bullet"><span class="by">jrpelkonen</span><span>|</span><a href="#39355321">prev</a><span>|</span><a href="#39353378">next</a><span>|</span><label class="collapse" for="c-39353351">[-]</label><label class="expand" for="c-39353351">[4 more]</label></div><br/><div class="children"><div class="content">Using math&#x2F;rand seeded with a timestamp to generate crypto materials does not instill high confidence in the skills of the team. But their lack of interest in addressing the issues raised here is perhaps even more worrying.<p>If I was a user of this plugin, I’d start looking for alternatives pronto.</div><br/><div id="39354099" class="c"><input type="checkbox" id="c-39354099" checked=""/><div class="controls bullet"><span class="by">mholt</span><span>|</span><a href="#39353351">parent</a><span>|</span><a href="#39355136">next</a><span>|</span><label class="collapse" for="c-39354099">[-]</label><label class="expand" for="c-39354099">[2 more]</label></div><br/><div class="children"><div class="content">To be clear, &quot;the team&quot; you refer to is one burnt-out developer (and not the Caddy maintainer team). Having been through burnout myself several times, I can understand the lack of response.<p>I&#x27;m sure the project would benefit greatly if the community and companies who use it could bolster it up.</div><br/><div id="39354741" class="c"><input type="checkbox" id="c-39354741" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39353351">root</a><span>|</span><a href="#39354099">parent</a><span>|</span><a href="#39355136">next</a><span>|</span><label class="collapse" for="c-39354741">[-]</label><label class="expand" for="c-39354741">[1 more]</label></div><br/><div class="children"><div class="content">I do feel the pain as well, but the OP specifically says &quot;confirmed&quot; (i.e. there indeed was a response) without no further qualification. If the plugin author did say the underlying reason, I believe the OP should have reproduced the reason as well because it&#x27;s an even bigger security risk in my opinion.</div><br/></div></div></div></div><div id="39355136" class="c"><input type="checkbox" id="c-39355136" checked=""/><div class="controls bullet"><span class="by">devwastaken</span><span>|</span><a href="#39353351">parent</a><span>|</span><a href="#39354099">prev</a><span>|</span><a href="#39353378">next</a><span>|</span><label class="collapse" for="c-39355136">[-]</label><label class="expand" for="c-39355136">[1 more]</label></div><br/><div class="children"><div class="content">Ripe for a PR.</div><br/></div></div></div></div><div id="39353378" class="c"><input type="checkbox" id="c-39353378" checked=""/><div class="controls bullet"><span class="by">rrdharan</span><span>|</span><a href="#39353351">prev</a><span>|</span><a href="#39355174">next</a><span>|</span><label class="collapse" for="c-39353378">[-]</label><label class="expand" for="c-39353378">[12 more]</label></div><br/><div class="children"><div class="content">&gt; August 23, 2023: The caddy-security plugin maintainers confirmed that there were no near-term plans to act on the reported vulnerabilities.<p>Ouch. I was considering switching from oauth2_proxy to Caddy + SSO but this is pretty discouraging..</div><br/><div id="39354090" class="c"><input type="checkbox" id="c-39354090" checked=""/><div class="controls bullet"><span class="by">mholt</span><span>|</span><a href="#39353378">parent</a><span>|</span><a href="#39353745">next</a><span>|</span><label class="collapse" for="c-39354090">[-]</label><label class="expand" for="c-39354090">[1 more]</label></div><br/><div class="children"><div class="content">My understanding is Paul has been burnt out from his FAANG job. I&#x27;m sure the project could benefit from a little bolstering from the community or companies who rely on it.</div><br/></div></div><div id="39353745" class="c"><input type="checkbox" id="c-39353745" checked=""/><div class="controls bullet"><span class="by">mdeeks</span><span>|</span><a href="#39353378">parent</a><span>|</span><a href="#39354090">prev</a><span>|</span><a href="#39355174">next</a><span>|</span><label class="collapse" for="c-39353745">[-]</label><label class="expand" for="c-39353745">[10 more]</label></div><br/><div class="children"><div class="content">Discouraging? Huge understatement. An auth plugin that refuses to fix multiple high severity vulnerabilities is wild. No one should use this plugin for anything. If I were the Caddy authors I would remove all references to this project and ask that they stop use of the Caddy name.</div><br/><div id="39354053" class="c"><input type="checkbox" id="c-39354053" checked=""/><div class="controls bullet"><span class="by">tadfisher</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39353745">parent</a><span>|</span><a href="#39353878">next</a><span>|</span><label class="collapse" for="c-39354053">[-]</label><label class="expand" for="c-39354053">[3 more]</label></div><br/><div class="children"><div class="content">There is no &quot;refusal&quot; as far as I can tell. The issues were reported [1] in September 2023 (as was this blog post) and the simplest one has been fixed (insecure random seed). I&#x27;m not aware of any public statements from the plugin maintainers, and there is no hostility in the issue comments.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;greenpau&#x2F;caddy-security&#x2F;issues?q=is%3Aissue+label%3Asecurity+">https:&#x2F;&#x2F;github.com&#x2F;greenpau&#x2F;caddy-security&#x2F;issues?q=is%3Aiss...</a></div><br/><div id="39355047" class="c"><input type="checkbox" id="c-39355047" checked=""/><div class="controls bullet"><span class="by">bbarnett</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39354053">parent</a><span>|</span><a href="#39353878">next</a><span>|</span><label class="collapse" for="c-39355047">[-]</label><label class="expand" for="c-39355047">[2 more]</label></div><br/><div class="children"><div class="content">If there isn&#x27;t a refusal, fair enough.  Yet leaving high impact, publicly disclosed security issues unresolved for 6 months means the code is abandoned.<p>I&#x27;ll consoder stable code fine without new releases for years even, but security issues?  Responses and fixes need to be measured in days, not months.<p>(Some may say &quot;but what about&quot;..., and note all rhe conditions I listed above.  Publicly disclosed + timefame.  Doesn&#x27;t matter who it is, big or small, 6 months means the software maintainers show no serious commitment to security, and one should run to other solutions.)</div><br/><div id="39355117" class="c"><input type="checkbox" id="c-39355117" checked=""/><div class="controls bullet"><span class="by">blinded</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39355047">parent</a><span>|</span><a href="#39353878">next</a><span>|</span><label class="collapse" for="c-39355117">[-]</label><label class="expand" for="c-39355117">[1 more]</label></div><br/><div class="children"><div class="content">PRed welcomed</div><br/></div></div></div></div></div></div><div id="39353878" class="c"><input type="checkbox" id="c-39353878" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39353745">parent</a><span>|</span><a href="#39354053">prev</a><span>|</span><a href="#39355174">next</a><span>|</span><label class="collapse" for="c-39353878">[-]</label><label class="expand" for="c-39353878">[6 more]</label></div><br/><div class="children"><div class="content">I mean, do you feel you have a right to get those fixes for free? I&#x27;m sure you are welcome to contribute them.</div><br/><div id="39354044" class="c"><input type="checkbox" id="c-39354044" checked=""/><div class="controls bullet"><span class="by">nixgeek</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39353878">parent</a><span>|</span><a href="#39354526">next</a><span>|</span><label class="collapse" for="c-39354044">[-]</label><label class="expand" for="c-39354044">[1 more]</label></div><br/><div class="children"><div class="content">No, but I&#x27;d also hope that new and existing users of what&#x27;s probably a popular middleware for Caddy aren&#x27;t expected to read 100&#x27;s of open GitHub Issues or luck upon the Trail of Bits report to know there are significant unresolved security issues and the maintainers don&#x27;t have the time or resources to actually fix them.<p>Better know that up front, than get popped and think &quot;What happened?&quot;.</div><br/></div></div><div id="39354526" class="c"><input type="checkbox" id="c-39354526" checked=""/><div class="controls bullet"><span class="by">tgsovlerkhgsel</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39353878">parent</a><span>|</span><a href="#39354044">prev</a><span>|</span><a href="#39355183">next</a><span>|</span><label class="collapse" for="c-39354526">[-]</label><label class="expand" for="c-39354526">[2 more]</label></div><br/><div class="children"><div class="content">At the very least, there should be a clear warning not to use the current version of the software. And I think it&#x27;s reasonable to suggest that the main project authors should neither advertise software that&#x27;s dangerously insecure nor allow it to use the main project&#x27;s name (which could mislead people into assuming that it&#x27;s part of the project and similarly well maintained).</div><br/><div id="39354910" class="c"><input type="checkbox" id="c-39354910" checked=""/><div class="controls bullet"><span class="by">Aeolun</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39354526">parent</a><span>|</span><a href="#39355183">next</a><span>|</span><label class="collapse" for="c-39354910">[-]</label><label class="expand" for="c-39354910">[1 more]</label></div><br/><div class="children"><div class="content">&gt; which could mislead people into assuming that it&#x27;s part of the project and similarly well maintained<p>That’s entirely on the idiot that assumes a similarity in name means the project is maintained by the same owner.</div><br/></div></div></div></div><div id="39355183" class="c"><input type="checkbox" id="c-39355183" checked=""/><div class="controls bullet"><span class="by">lopkeny12ko</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39353878">parent</a><span>|</span><a href="#39354526">prev</a><span>|</span><a href="#39355174">next</a><span>|</span><label class="collapse" for="c-39355183">[-]</label><label class="expand" for="c-39355183">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand this attitude.<p>If you put your work in the open, advertise it as an officially supported solution, and advertise it as secure, it had better be supported and secure. You can&#x27;t just put out broken software and hide behind &quot;but you didn&#x27;t pay for it so who cares.&quot; Even worse when the attitude is &quot;it&#x27;s not my fault, go fix it yourself and submit a PR.&quot;<p>If that is the intent, why even open source it in the first place and tell people to use it. Just keep the code private and use it for yourself.<p>Over the last decade I have written hundreds of thousands of lines of code for personal projects that will never see the light of day, precisely for this reason. It&#x27;s not production-quality software, and it would be horrendously irresponsible for me to put it out in the open, advertise it, and tell people to use it, compromising the security of their homelabs (or worse, enterprise deployments).</div><br/><div id="39355428" class="c"><input type="checkbox" id="c-39355428" checked=""/><div class="controls bullet"><span class="by">selckin</span><span>|</span><a href="#39353378">root</a><span>|</span><a href="#39355183">parent</a><span>|</span><a href="#39355174">next</a><span>|</span><label class="collapse" for="c-39355428">[-]</label><label class="expand" for="c-39355428">[1 more]</label></div><br/><div class="children"><div class="content">you&#x27;re describing proprietary software with a full support contract.<p>the point of free software(tm) is gaining benefit from cooperation and community, and nobody is obligated to do anything.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="39355174" class="c"><input type="checkbox" id="c-39355174" checked=""/><div class="controls bullet"><span class="by">yonixwm</span><span>|</span><a href="#39353378">prev</a><span>|</span><a href="#39353828">next</a><span>|</span><label class="collapse" for="c-39355174">[-]</label><label class="expand" for="c-39355174">[4 more]</label></div><br/><div class="children"><div class="content">Why is it the plugin job to mitigate IP Spoofing via X-Forwarded-For Header? Isn’t it the first gateway job? Just like I wouldn’t blame a container server for cdn not making sure X-Forwarded-For is not passed from the client…<p>Meaning how will the plugin know how levels deep is it in the infrastructure… and if you really care  about warning devs then it should be a caddy level security bug, not this plugin specifically.<p>So all those spoofing items is really out of scope for this plugin…</div><br/><div id="39355202" class="c"><input type="checkbox" id="c-39355202" checked=""/><div class="controls bullet"><span class="by">francislavoie</span><span>|</span><a href="#39355174">parent</a><span>|</span><a href="#39355226">next</a><span>|</span><label class="collapse" for="c-39355202">[-]</label><label class="expand" for="c-39355202">[2 more]</label></div><br/><div class="children"><div class="content">Caddy itself has built-in support for correctly &amp; safely parsing XFF via the trusted_proxies global option <a href="https:&#x2F;&#x2F;caddyserver.com&#x2F;docs&#x2F;caddyfile&#x2F;options#trusted-proxies" rel="nofollow">https:&#x2F;&#x2F;caddyserver.com&#x2F;docs&#x2F;caddyfile&#x2F;options#trusted-proxi...</a> The plugin should use the parsed client IP produced by this, but the plugin was written before trusted_proxies existed in Caddy. (Not excusing the mistake, but there&#x27;s an &quot;easy&quot; solution if someone wants to resolve it.)</div><br/><div id="39355216" class="c"><input type="checkbox" id="c-39355216" checked=""/><div class="controls bullet"><span class="by">yonixwm</span><span>|</span><a href="#39355174">root</a><span>|</span><a href="#39355202">parent</a><span>|</span><a href="#39355226">next</a><span>|</span><label class="collapse" for="c-39355216">[-]</label><label class="expand" for="c-39355216">[1 more]</label></div><br/><div class="children"><div class="content">Again why mention the plugin? Just use the main caddy option… plugins are ment to expand caddy not replace existing directives<p>unless i am missing something and the plugin overrides default behavior then of course it’s to blame</div><br/></div></div></div></div><div id="39355226" class="c"><input type="checkbox" id="c-39355226" checked=""/><div class="controls bullet"><span class="by">buro9</span><span>|</span><a href="#39355174">parent</a><span>|</span><a href="#39355202">prev</a><span>|</span><a href="#39353828">next</a><span>|</span><label class="collapse" for="c-39355226">[-]</label><label class="expand" for="c-39355226">[1 more]</label></div><br/><div class="children"><div class="content">I think a security plugin author should have the awareness that X-Forwarded-For is just a string of untrusted user input.<p>That definitely is the job of a security plugin author who uses the value.<p>Whether it&#x27;s lesson number one or number two... Don&#x27;t trust your inputs has got to be near the top of things you learn when doing anything with security.<p>Edit: now I&#x27;ve read the article... Shocked. The vast majority of this is trusting untrusted user input.</div><br/></div></div></div></div><div id="39353828" class="c"><input type="checkbox" id="c-39353828" checked=""/><div class="controls bullet"><span class="by">yogorenapan</span><span>|</span><a href="#39355174">prev</a><span>|</span><a href="#39353036">next</a><span>|</span><label class="collapse" for="c-39353828">[-]</label><label class="expand" for="c-39353828">[2 more]</label></div><br/><div class="children"><div class="content">I took a look around and the plug-in doesn’t seem to be actively maintained. Most commits within the last year has been simple dependency version bumps.<p>Wouldn’t use it even if not for these security issues.</div><br/><div id="39354112" class="c"><input type="checkbox" id="c-39354112" checked=""/><div class="controls bullet"><span class="by">mholt</span><span>|</span><a href="#39353828">parent</a><span>|</span><a href="#39353036">next</a><span>|</span><label class="collapse" for="c-39354112">[-]</label><label class="expand" for="c-39354112">[1 more]</label></div><br/><div class="children"><div class="content">The project could definitely use some help from the community, or financial support. I believe Paul may be open to opportunities there. I know his current job has kind of burnt him out.</div><br/></div></div></div></div><div id="39353036" class="c"><input type="checkbox" id="c-39353036" checked=""/><div class="controls bullet"><span class="by">positr0n</span><span>|</span><a href="#39353828">prev</a><span>|</span><a href="#39354217">next</a><span>|</span><label class="collapse" for="c-39353036">[-]</label><label class="expand" for="c-39353036">[6 more]</label></div><br/><div class="children"><div class="content">It&#x27;s this the most popular&#x2F;common Caddy plugin for SSO?</div><br/><div id="39354278" class="c"><input type="checkbox" id="c-39354278" checked=""/><div class="controls bullet"><span class="by">Filligree</span><span>|</span><a href="#39353036">parent</a><span>|</span><a href="#39354460">next</a><span>|</span><label class="collapse" for="c-39354278">[-]</label><label class="expand" for="c-39354278">[2 more]</label></div><br/><div class="children"><div class="content">Are there alternatives?</div><br/><div id="39354800" class="c"><input type="checkbox" id="c-39354800" checked=""/><div class="controls bullet"><span class="by">francislavoie</span><span>|</span><a href="#39353036">root</a><span>|</span><a href="#39354278">parent</a><span>|</span><a href="#39354460">next</a><span>|</span><label class="collapse" for="c-39354800">[-]</label><label class="expand" for="c-39354800">[1 more]</label></div><br/><div class="children"><div class="content">Yes, using Authelia (or similar) + Caddy&#x27;s forward_auth directive <a href="https:&#x2F;&#x2F;caddyserver.com&#x2F;docs&#x2F;caddyfile&#x2F;directives&#x2F;forward_auth" rel="nofollow">https:&#x2F;&#x2F;caddyserver.com&#x2F;docs&#x2F;caddyfile&#x2F;directives&#x2F;forward_au...</a></div><br/></div></div></div></div><div id="39354460" class="c"><input type="checkbox" id="c-39354460" checked=""/><div class="controls bullet"><span class="by">theChaparral</span><span>|</span><a href="#39353036">parent</a><span>|</span><a href="#39354278">prev</a><span>|</span><a href="#39354217">next</a><span>|</span><label class="collapse" for="c-39354460">[-]</label><label class="expand" for="c-39354460">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s #9 on the overall &#x27;plugin&quot; list</div><br/><div id="39354504" class="c"><input type="checkbox" id="c-39354504" checked=""/><div class="controls bullet"><span class="by">SushiHippie</span><span>|</span><a href="#39353036">root</a><span>|</span><a href="#39354460">parent</a><span>|</span><a href="#39354217">next</a><span>|</span><label class="collapse" for="c-39354504">[-]</label><label class="expand" for="c-39354504">[2 more]</label></div><br/><div class="children"><div class="content">What list do you base this on?</div><br/><div id="39355012" class="c"><input type="checkbox" id="c-39355012" checked=""/><div class="controls bullet"><span class="by">mdeeks</span><span>|</span><a href="#39353036">root</a><span>|</span><a href="#39354504">parent</a><span>|</span><a href="#39354217">next</a><span>|</span><label class="collapse" for="c-39355012">[-]</label><label class="expand" for="c-39355012">[1 more]</label></div><br/><div class="children"><div class="content">Likely this one: <a href="https:&#x2F;&#x2F;caddyserver.com&#x2F;download" rel="nofollow">https:&#x2F;&#x2F;caddyserver.com&#x2F;download</a></div><br/></div></div></div></div></div></div></div></div><div id="39354217" class="c"><input type="checkbox" id="c-39354217" checked=""/><div class="controls bullet"><span class="by">mholt</span><span>|</span><a href="#39353036">prev</a><span>|</span><a href="#39355580">next</a><span>|</span><label class="collapse" for="c-39354217">[-]</label><label class="expand" for="c-39354217">[1 more]</label></div><br/><div class="children"><div class="content">Mods: This should probably should have a [2023] appended to the title</div><br/></div></div></div></div></div></div></div></body></html>