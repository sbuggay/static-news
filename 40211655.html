<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714554069589" as="style"/><link rel="stylesheet" href="styles.css?v=1714554069589"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://pyinfra.com/">Pyinfra: Automate Infrastructure Using Python</a>Â <span class="domain">(<a href="https://pyinfra.com">pyinfra.com</a>)</span></div><div class="subtext"><span>InitEnabler</span> | <span>176 comments</span></div><br/><div><div id="40212701" class="c"><input type="checkbox" id="c-40212701" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40215908">next</a><span>|</span><label class="collapse" for="c-40212701">[-]</label><label class="expand" for="c-40212701">[53 more]</label></div><br/><div class="children"><div class="content">Hey all, I&#x27;m the creator&#x2F;primary maintainer of pyinfra! Super excited (a little terrified) to see this on the frontpage, happy to answer any questions :)<p>I also hang out on the Matrix room: <a href="https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#pyinfra:matrix.org" rel="nofollow">https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#pyinfra:matrix.org</a><p>Another thing: the GH repo points at currently in beta v3 and the docs for this are here: <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next</a> (highly recommend starting with v3, I just haven&#x27;t had any time recently to wrap up the release, but it&#x27;s stable).</div><br/><div id="40213018" class="c"><input type="checkbox" id="c-40213018" checked=""/><div class="controls bullet"><span class="by">negus</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40213094">next</a><span>|</span><label class="collapse" for="c-40213018">[-]</label><label class="expand" for="c-40213018">[17 more]</label></div><br/><div class="children"><div class="content">As you can see here, the main question is what are the advantages over Ansible, a mature and the most popular agentless configuration management tool written in Python. So I propose putting this answer right to the landing page</div><br/><div id="40213058" class="c"><input type="checkbox" id="c-40213058" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213018">parent</a><span>|</span><a href="#40213094">next</a><span>|</span><label class="collapse" for="c-40213058">[-]</label><label class="expand" for="c-40213058">[16 more]</label></div><br/><div class="children"><div class="content">I think I tried to shy away from specifically being &quot;Ansible does this bad so pyinfra does this&quot; and instead focus on the features that differentiate like &quot;Instant debugging with realtime stdin&#x2F;stdout&#x2F;stderr output (-vvv).&quot;. But it seems like that isn&#x27;t enough and the landing page needs to be more explicit in comparison. Ty for the feedback!</div><br/><div id="40215030" class="c"><input type="checkbox" id="c-40215030" checked=""/><div class="controls bullet"><span class="by">gh02t</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213058">parent</a><span>|</span><a href="#40215252">next</a><span>|</span><label class="collapse" for="c-40215030">[-]</label><label class="expand" for="c-40215030">[1 more]</label></div><br/><div class="children"><div class="content">I applaud trying to be positive and focus on &quot;this is what we do well,&quot; but yeah at least some explicit comparison would help. The copy right now is kind of assuming the reader already knows Ansible to compare against as a baseline. Which is probably fair for most people who find your project, but people who find your project are also probably not happy with Ansible and want to know if this addresses their pain points immediately.<p>Is very interesting though, I think I&#x27;m gonna try it myself.</div><br/></div></div><div id="40215252" class="c"><input type="checkbox" id="c-40215252" checked=""/><div class="controls bullet"><span class="by">Anarch157a</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213058">parent</a><span>|</span><a href="#40215030">prev</a><span>|</span><a href="#40214413">next</a><span>|</span><label class="collapse" for="c-40215252">[-]</label><label class="expand" for="c-40215252">[7 more]</label></div><br/><div class="children"><div class="content">I like Ansible, but that doesn&#x27;t mean thera are no pain points.<p>One of them is handling &quot;if-this-then-that-else-that&quot;. Being purely declarative, Ansible is horrible at that.<p>Pyinfra can be used in imperative mode, am I right? This would make the use of if-else a breeze, which would be a really good reason for me to to switch.</div><br/><div id="40216242" class="c"><input type="checkbox" id="c-40216242" checked=""/><div class="controls bullet"><span class="by">tryauuum</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40215252">parent</a><span>|</span><a href="#40218920">next</a><span>|</span><label class="collapse" for="c-40216242">[-]</label><label class="expand" for="c-40216242">[5 more]</label></div><br/><div class="children"><div class="content">Ansible is declarative?<p>In puppet and saltstack you can declare that a folder is empty and declare a specific file in this folder. The system&#x27;s smart enough to delete all the files except the one.<p>To achieve such feat in ansible is hard. Easiest way is to have two tasks, one deletes everything and second recreates your file. Doesn&#x27;t feel very declarative<p>Unrelated thing, they don&#x27;t even try to be declarative in ansible E.g you can have a file with state &quot;touch&quot;. It not a state if it updates each playbook run!</div><br/><div id="40218175" class="c"><input type="checkbox" id="c-40218175" checked=""/><div class="controls bullet"><span class="by">Anarch157a</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40216242">parent</a><span>|</span><a href="#40218920">next</a><span>|</span><label class="collapse" for="c-40218175">[-]</label><label class="expand" for="c-40218175">[4 more]</label></div><br/><div class="children"><div class="content">You&#x27;re confusing declarative with idempotent. Ansible is both, it won&#x27;t change anything if the state is already what you declared. The nitpicked case you chose, you want the file to have the latest timestamp, this is a valid state to declare.</div><br/><div id="40218929" class="c"><input type="checkbox" id="c-40218929" checked=""/><div class="controls bullet"><span class="by">verdverm</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40218175">parent</a><span>|</span><a href="#40220720">next</a><span>|</span><label class="collapse" for="c-40218929">[-]</label><label class="expand" for="c-40218929">[2 more]</label></div><br/><div class="children"><div class="content">The shell task breaks the declarative nature a bit, along with registering task results and then writing conditional whens based on them. Interpolating values based on the registered results does too imho</div><br/><div id="40220031" class="c"><input type="checkbox" id="c-40220031" checked=""/><div class="controls bullet"><span class="by">aflukasz</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40218929">parent</a><span>|</span><a href="#40220720">next</a><span>|</span><label class="collapse" for="c-40220031">[-]</label><label class="expand" for="c-40220031">[1 more]</label></div><br/><div class="children"><div class="content">Plus, what your are declaring is often times not the state you desire but... action you want to take. Say you use `apt.name: [pkg1, pkg2]`, run it, then remove `pkg2` from the list. Running this again won&#x27;t remove `pkg2` from your system. So it&#x27;s declarative, but not necessarily on the optimal level all the times.</div><br/></div></div></div></div><div id="40220720" class="c"><input type="checkbox" id="c-40220720" checked=""/><div class="controls bullet"><span class="by">goodpoint</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40218175">parent</a><span>|</span><a href="#40218929">prev</a><span>|</span><a href="#40218920">next</a><span>|</span><label class="collapse" for="c-40220720">[-]</label><label class="expand" for="c-40220720">[1 more]</label></div><br/><div class="children"><div class="content">Ansible is neither.</div><br/></div></div></div></div></div></div><div id="40218920" class="c"><input type="checkbox" id="c-40218920" checked=""/><div class="controls bullet"><span class="by">verdverm</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40215252">parent</a><span>|</span><a href="#40216242">prev</a><span>|</span><a href="#40214413">next</a><span>|</span><label class="collapse" for="c-40218920">[-]</label><label class="expand" for="c-40218920">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s definitely a trend in this direction.<p>Pulumi for Terraform and Dagger for Docker are two examples I use<p>I like CUE as a language to replace my Yaml that has some of the typical language constructs but maintains the declarative approach</div><br/></div></div></div></div><div id="40214413" class="c"><input type="checkbox" id="c-40214413" checked=""/><div class="controls bullet"><span class="by">erikbye</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213058">parent</a><span>|</span><a href="#40215252">prev</a><span>|</span><a href="#40219376">next</a><span>|</span><label class="collapse" for="c-40214413">[-]</label><label class="expand" for="c-40214413">[6 more]</label></div><br/><div class="children"><div class="content">Is performance better than Ansible? I have used Ansible extensively and find it excruciatingly slow.</div><br/><div id="40214691" class="c"><input type="checkbox" id="c-40214691" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214413">parent</a><span>|</span><a href="#40214431">next</a><span>|</span><label class="collapse" for="c-40214691">[-]</label><label class="expand" for="c-40214691">[2 more]</label></div><br/><div class="children"><div class="content">Yes! <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;performance.html" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;performance.html</a></div><br/><div id="40215508" class="c"><input type="checkbox" id="c-40215508" checked=""/><div class="controls bullet"><span class="by">mxuribe</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214691">parent</a><span>|</span><a href="#40214431">next</a><span>|</span><label class="collapse" for="c-40215508">[-]</label><label class="expand" for="c-40215508">[1 more]</label></div><br/><div class="children"><div class="content">Hi @Fizzadar and congrats on making this and getting it out the door; kudos!<p>As you craft your &quot;Why this and not Ansible&quot; content, you might actually state clearly what you already noted on the Performance page, namely: &quot;One of the reasons pyinfra was started was performance of agent-less tools at the time.&quot;  If I read that, it&#x27;d instantly make me want to stick around and read some more, play with pyinfra, etc. BTW, i will be playing with it anyway, but just wanted to point out that you likely won;t need to start from scratch for copy (on a comparison or answering &quot;Why this and not Ansible&quot; content). Cheers!</div><br/></div></div></div></div><div id="40214431" class="c"><input type="checkbox" id="c-40214431" checked=""/><div class="controls bullet"><span class="by">helsinki</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214413">parent</a><span>|</span><a href="#40214691">prev</a><span>|</span><a href="#40219376">next</a><span>|</span><label class="collapse" for="c-40214431">[-]</label><label class="expand" for="c-40214431">[3 more]</label></div><br/><div class="children"><div class="content">Excruciatingly slow is an understatement :)</div><br/><div id="40214967" class="c"><input type="checkbox" id="c-40214967" checked=""/><div class="controls bullet"><span class="by">surfingdino</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214431">parent</a><span>|</span><a href="#40219376">next</a><span>|</span><label class="collapse" for="c-40214967">[-]</label><label class="expand" for="c-40214967">[2 more]</label></div><br/><div class="children"><div class="content">Why being slow is a bad thing? Ansible gives me a legitimate excuse to have proper lunch. ;-)</div><br/><div id="40218940" class="c"><input type="checkbox" id="c-40218940" checked=""/><div class="controls bullet"><span class="by">verdverm</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214967">parent</a><span>|</span><a href="#40219376">next</a><span>|</span><label class="collapse" for="c-40218940">[-]</label><label class="expand" for="c-40218940">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re supposed to be writing compilers during that time</div><br/></div></div></div></div></div></div></div></div><div id="40219376" class="c"><input type="checkbox" id="c-40219376" checked=""/><div class="controls bullet"><span class="by">ShakataGaNai</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213058">parent</a><span>|</span><a href="#40214413">prev</a><span>|</span><a href="#40213094">next</a><span>|</span><label class="collapse" for="c-40219376">[-]</label><label class="expand" for="c-40219376">[1 more]</label></div><br/><div class="children"><div class="content">That would be appreciated. I saw the homepage and my first thought was &quot;Ansible is python. How are these things different?&quot; Obviously pure python vs yaml is one thing. But beyond that it&#x27;s not clear. Perhaps are specific use cases in your mind where one or the other is a better fit, and that would be helpful as well.</div><br/></div></div></div></div></div></div><div id="40213094" class="c"><input type="checkbox" id="c-40213094" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40213018">prev</a><span>|</span><a href="#40214689">next</a><span>|</span><label class="collapse" for="c-40213094">[-]</label><label class="expand" for="c-40213094">[26 more]</label></div><br/><div class="children"><div class="content">Is it declarative? Obviously python isn&#x27;t, but since it&#x27;s not executed as a script but rather the module passed to pyinfra, it could be, and looks like maybe it is just registering work to (potentially) do on module load?<p>If so, nice, shout about it more - it&#x27;s my number one requirement of such a tool, why I think Terraform (or OpenTofu) is great and mostly everything else sucks, and I think it should be everyone&#x27;s. It&#x27;s just obviously (at least, once someone makes it available!) the correct paradigm for managing stateful resources and coping with drift.</div><br/><div id="40213162" class="c"><input type="checkbox" id="c-40213162" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213094">parent</a><span>|</span><a href="#40213615">next</a><span>|</span><label class="collapse" for="c-40213162">[-]</label><label class="expand" for="c-40213162">[4 more]</label></div><br/><div class="children"><div class="content">Yes... and no. It depends on the operation (the docs explicitly state if an operation is _not_ idempotent &quot;stateless operation&quot;). Operations are either:<p>- state definitions, &quot;ensure this apt package is installed&quot; (apt.packages: <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;operations&#x2F;apt.html#operations-apt-packages" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;operations&#x2F;apt.html#operati...</a>)
- stateless, &quot;run these shell commands&quot; (server.shell: <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;operations&#x2F;server.html#operations-server-shell" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;operations&#x2F;server.html#oper...</a>)<p>Most operations are state definitions and much preferred, the stateless ones exist to satisfy edge cases where either the state-ful version isn&#x27;t implemented or simply isn&#x27;t possible.</div><br/><div id="40213534" class="c"><input type="checkbox" id="c-40213534" checked=""/><div class="controls bullet"><span class="by">tetha</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213162">parent</a><span>|</span><a href="#40213615">next</a><span>|</span><label class="collapse" for="c-40213534">[-]</label><label class="expand" for="c-40213534">[3 more]</label></div><br/><div class="children"><div class="content">Ah, so this is similar to the Terraform CDK approach?<p>In Terraform CDK, you use a language like python to compute the set of resources and such you want to have, and then hand that over to the terraform core, which does the usual terraform song and dance to make it happen.<p>This is actually interesting to me, because we struggle with even the simplest data transformations in ansible so much. Like, as soon as you start thinking about doing a simple list comprehension in python in jinja templating, lots and lots of pain starts. From there, we&#x27;re really starting to think about templating the inventories in some way because it would be less painful.</div><br/><div id="40213910" class="c"><input type="checkbox" id="c-40213910" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213534">parent</a><span>|</span><a href="#40213615">next</a><span>|</span><label class="collapse" for="c-40213910">[-]</label><label class="expand" for="c-40213910">[2 more]</label></div><br/><div class="children"><div class="content">Interesting, not heard of CDK before! Kind of similar? As long as the language is Python I suppose! Would be possible to integrate with other languages too I guess, not something Iâve ever looked into though.<p>Totally agree on templating which is why inventories have always been python code just as operations, giving maximum flexibility (with some complexity&#x2F;type confusion drawbacks).</div><br/><div id="40215174" class="c"><input type="checkbox" id="c-40215174" checked=""/><div class="controls bullet"><span class="by">F-Lexx</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213910">parent</a><span>|</span><a href="#40213615">next</a><span>|</span><label class="collapse" for="c-40215174">[-]</label><label class="expand" for="c-40215174">[1 more]</label></div><br/><div class="children"><div class="content">Relevant XKCD: <a href="https:&#x2F;&#x2F;xkcd.com&#x2F;303&#x2F;" rel="nofollow">https:&#x2F;&#x2F;xkcd.com&#x2F;303&#x2F;</a></div><br/></div></div></div></div></div></div></div></div><div id="40213615" class="c"><input type="checkbox" id="c-40213615" checked=""/><div class="controls bullet"><span class="by">peteradio</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213094">parent</a><span>|</span><a href="#40213162">prev</a><span>|</span><a href="#40217498">next</a><span>|</span><label class="collapse" for="c-40213615">[-]</label><label class="expand" for="c-40213615">[19 more]</label></div><br/><div class="children"><div class="content">I never understood the desire to make things declarative.  It seemed to me to always hide what is actually happening and it made it more difficult to understand.  Is there a simple way to understand why declarative stuff is desirable to some people?</div><br/><div id="40218775" class="c"><input type="checkbox" id="c-40218775" checked=""/><div class="controls bullet"><span class="by">NortySpock</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40213692">next</a><span>|</span><label class="collapse" for="c-40218775">[-]</label><label class="expand" for="c-40218775">[1 more]</label></div><br/><div class="children"><div class="content">It lets you separate &quot;here is the final state of the system that I want&quot; from &quot;how to get there&quot;.<p>If a SQL compiler or `terraform plan` command can convert &quot;the current state of the system&quot; + &quot;desired end-state&quot; to a series of steps that constitute &quot;how to get there from here&quot;, then I can usually just move forward to declaring more desired states after that, or debugging something else, etc. Let the computer do the routine calculations.<p>When using a path-finding &#x2F; route-finding tool, having the map and some basic pathfinding algorithms already programmed in means we no longer need to &quot;pop a candidate route-segment off the list of candidates and evaluate the new route cost&quot;... I simply observe that I am &quot;probably here&quot; and I wish to get to &quot;there&quot;; propose a route and if it&#x27;s good enough I&#x27;ll instruct the machine to do that.<p>If I can declare that I want the final system to contain only the folder &quot;&#x2F;stuff&#x2F;config.yaml&quot; with permissions 700 -- I don&#x27;t care what the contents of stuff were previously, and if it had a million temp files in it from an install going sideways or the wrong permissions or a thousand nested folders in it, well, it would be great if the silly computer had a branching workflow that detected and fixed that for me, rather than me having to write yet another one-off script to clean up yet another silly mis-configured system that Bob left as a dumping ground that I have to write yet more brittle bizarre-situation-handling code for.<p>Same for SQL and data. &quot;Look, Mr. Database, I don&#x27;t actually know what&#x27;s in the table today, and I don&#x27;t know why the previous user dumped a million unrelated rows in the table.... Can you answer my query about if my package has shipped, or not?&quot;</div><br/></div></div><div id="40213692" class="c"><input type="checkbox" id="c-40213692" checked=""/><div class="controls bullet"><span class="by">michaelmior</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40218775">prev</a><span>|</span><a href="#40214416">next</a><span>|</span><label class="collapse" for="c-40213692">[-]</label><label class="expand" for="c-40213692">[7 more]</label></div><br/><div class="children"><div class="content">I think the main reason people like the declarative approach is that done right, it&#x27;s idempotent. You also don&#x27;t have to think about the current state of the system at all. You just need to describe what you want it to look like. Of course in practice it can be more nuanced than that, but thinking declaratively <i>can</i> make things much simpler in some scenarios.</div><br/><div id="40214684" class="c"><input type="checkbox" id="c-40214684" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213692">parent</a><span>|</span><a href="#40214416">next</a><span>|</span><label class="collapse" for="c-40214684">[-]</label><label class="expand" for="c-40214684">[6 more]</label></div><br/><div class="children"><div class="content">These aren&#x27;t as related as you think. Ansible is imperative and idempotent.</div><br/><div id="40215179" class="c"><input type="checkbox" id="c-40215179" checked=""/><div class="controls bullet"><span class="by">windexh8er</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214684">parent</a><span>|</span><a href="#40219849">next</a><span>|</span><label class="collapse" for="c-40215179">[-]</label><label class="expand" for="c-40215179">[4 more]</label></div><br/><div class="children"><div class="content">Ansibles&#x27; resources are declarative [0].  What part of Ansible is imperative?<p><a href="https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;reference_appendices&#x2F;glossary.html#term-Declarative" rel="nofollow">https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;reference_appendices...</a></div><br/><div id="40215625" class="c"><input type="checkbox" id="c-40215625" checked=""/><div class="controls bullet"><span class="by">matrss</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40215179">parent</a><span>|</span><a href="#40219849">next</a><span>|</span><label class="collapse" for="c-40215625">[-]</label><label class="expand" for="c-40215625">[3 more]</label></div><br/><div class="children"><div class="content">Ansible playbooks are usually a list of steps to execute in order (imperative). Those steps may try to present a declarative interface to what they are supposed to do, but many fail to fulfill the definition of &quot;declarative&quot; that you have linked. E.g. with the built-in modules it is impossible to declare a desired set of installed packages, only a set of packages to be installed _in addition to all already installed packages_. This means it is impossible to remove an installed package again by removing it from the declaration, you have to specify a second step (imperative) that explicitly removes the package. This makes it impossible to declare a final state for &quot;installed packages&quot; with ansible.</div><br/><div id="40217982" class="c"><input type="checkbox" id="c-40217982" checked=""/><div class="controls bullet"><span class="by">XorNot</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40215625">parent</a><span>|</span><a href="#40219849">next</a><span>|</span><label class="collapse" for="c-40217982">[-]</label><label class="expand" for="c-40217982">[2 more]</label></div><br/><div class="children"><div class="content">This is debating state-management though, which Ansible makes the correct choice about: Ansible largely works the way a user expects when they transition to it from doing things on the command line, and guides them towards idempotency (which is a pre-requisite for declarative configuration).<p>The problem is to track deletions you either have to constantly have a view of global state (i.e. do you want to put `linux-kernel` in your package list?) <i>or</i> you need to store specific state about that machine (i.e. `redis` was installed by playbook redis-server.yml, task &quot;install redis&quot;) - because the packages absence in that list doesn&#x27;t necessarily mean &quot;uninstall it&quot; if something else in another playbook or task will later declare it should be present.<p>As soon as you&#x27;re trying to do deletions, you&#x27;re making assumptions that the view of the state you have is complete and total and that is <i>usually</i> not the case - and even if it is within the scope of your system, is it the case on the system you&#x27;re interacting with? Do you know every package that should be installed because it comes out of the box in the distro? Do you <i>want</i> to (aka: do you have the time, resourcing and effort to do this for the almost zero gain it will get you in the short term unless you can point to business outcomes which are fulfilled by the activity?)</div><br/><div id="40218834" class="c"><input type="checkbox" id="c-40218834" checked=""/><div class="controls bullet"><span class="by">jacobr1</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40217982">parent</a><span>|</span><a href="#40219849">next</a><span>|</span><label class="collapse" for="c-40218834">[-]</label><label class="expand" for="c-40218834">[1 more]</label></div><br/><div class="children"><div class="content">&gt; As soon as you&#x27;re trying to do deletions, you&#x27;re making assumptions that the view of the state you have is complete and total and that is usually not the case<p>terraform does this, which is why it tracks the its own representation of the prior global state. So when you remove a declared resource the diff against the prior state is interpreted as a delete. Note this does introduce the problem of &quot;drift&quot; when you have resources that are not captured in the scope of the state.<p>&gt; i.e. do you want to put `linux-kernel` in your package list?<p>Yes. At least I want to put something like &quot;core-packages&quot; or &quot;default&quot; or similar as part of setting my explicit intent.</div><br/></div></div></div></div></div></div></div></div><div id="40219849" class="c"><input type="checkbox" id="c-40219849" checked=""/><div class="controls bullet"><span class="by">bjt12345</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214684">parent</a><span>|</span><a href="#40215179">prev</a><span>|</span><a href="#40214416">next</a><span>|</span><label class="collapse" for="c-40219849">[-]</label><label class="expand" for="c-40219849">[1 more]</label></div><br/><div class="children"><div class="content">Ansible is only as idempotent as the module it calls though.</div><br/></div></div></div></div></div></div><div id="40214416" class="c"><input type="checkbox" id="c-40214416" checked=""/><div class="controls bullet"><span class="by">mmh0000</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40213692">prev</a><span>|</span><a href="#40218803">next</a><span>|</span><label class="collapse" for="c-40214416">[-]</label><label class="expand" for="c-40214416">[5 more]</label></div><br/><div class="children"><div class="content">Itâs the cattle not pets mindset. In most organizations the sysadmin team is really undersized. Not uncommon to have one admin per several hundred systems. In such places, there is no time to care for individual servers. If a server is misbehaving we blow it away and spin up a clean replacement.<p>Declarative scripts make it easy to manage a fleet.</div><br/><div id="40214605" class="c"><input type="checkbox" id="c-40214605" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214416">parent</a><span>|</span><a href="#40218803">next</a><span>|</span><label class="collapse" for="c-40214605">[-]</label><label class="expand" for="c-40214605">[4 more]</label></div><br/><div class="children"><div class="content">I think that&#x27;s.. perhaps not orthogonal, but has some orthogonal component - you could certainly have something like:<p><pre><code>  for i in range(100):
      ip = cidrhost(subnet, i)
      if exists := get_server(ip):
          continue
      create_server(ip=ip)
</code></pre>
and so on. I don&#x27;t like it, but because it&#x27;s procedural&#x2F;imperative, not because it&#x27;s particularly more &#x27;petty&#x27; than the Terraform (or equivalent) would be.<p>For me it&#x27;s more about what I&#x27;m doing, conceptually. I want a server to exist, it to have access to this S3 bucket, etc. - the logic of how to interface with the APIs to make that happen, to manage their lifecycle and check current state etc. isn&#x27;t what I&#x27;m thinking about. (In Terraform terms, that belongs in the provider.) When I write the above I&#x27;m just thinking I want 100 servers, so:<p><pre><code>  resource &quot;cloud_server&quot; &quot;my_servers&quot; {
    count = 100

    ip = cidrhost(subnet, count.index)
    # and so on
  }
</code></pre>
comes much more naturally.</div><br/><div id="40214830" class="c"><input type="checkbox" id="c-40214830" checked=""/><div class="controls bullet"><span class="by">linuxdude314</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214605">parent</a><span>|</span><a href="#40218803">next</a><span>|</span><label class="collapse" for="c-40214830">[-]</label><label class="expand" for="c-40214830">[3 more]</label></div><br/><div class="children"><div class="content">This fails completely even at small scale when the script is interrupted before finishing.<p>The difference between just using some Python vs Terraform is idempotency.  TF isnât going to touch the nodes the script succeeded on; if you have to start your for-loop script it will, which may not be desirable.<p>Frankly these days configuration management is a bit datedâ¦<p>Youâre much better off in most cases using a tool like Packer with whatever system you want to bake an image, then use a simple user-data script for customization.<p>Itâs very hard to scale continuous config management to thousands of servers.</div><br/><div id="40216075" class="c"><input type="checkbox" id="c-40216075" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40214830">parent</a><span>|</span><a href="#40218803">next</a><span>|</span><label class="collapse" for="c-40216075">[-]</label><label class="expand" for="c-40216075">[2 more]</label></div><br/><div class="children"><div class="content">Eh, any way you do it could leave it in an unfinished state if interrupted, I&#x27;m not too bothered about that. (But it does sound like you think I was speaking in favour of doing it in a procedural python script sort of way? I was not.)<p>Packer and Terraform do different jobs (they&#x27;re both by Hashicorp!) - you can bake an immutable image all you like, you still need to get a server, put the image on it, give it that S3 bucket it needs, IAM, etc.</div><br/><div id="40218855" class="c"><input type="checkbox" id="c-40218855" checked=""/><div class="controls bullet"><span class="by">jacobr1</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40216075">parent</a><span>|</span><a href="#40218803">next</a><span>|</span><label class="collapse" for="c-40218855">[-]</label><label class="expand" for="c-40218855">[1 more]</label></div><br/><div class="children"><div class="content">They work together to produce immutable cattle. The alternative is managing a pool of servers where you are doing things like in-place patch upgrades, vs a teardown of the old infra and replacing it with the newly baked servers.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40218803" class="c"><input type="checkbox" id="c-40218803" checked=""/><div class="controls bullet"><span class="by">jacobr1</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40214416">prev</a><span>|</span><a href="#40215265">next</a><span>|</span><label class="collapse" for="c-40218803">[-]</label><label class="expand" for="c-40218803">[1 more]</label></div><br/><div class="children"><div class="content">Because what most people want is actually something closer to &quot;Goal Seeking.&quot; If the system works as intended (and as you point out with the need to debug is often does not!) then defining the desired end-state and letting the system figure out how to get there, is a simpler, higher order abstraction. And it can also often be clearer to just say &quot;ensure these prerequisites are met&quot; such that alternative implementations can achieve the same outcome. In practice, abstractions are leaky.</div><br/></div></div><div id="40215265" class="c"><input type="checkbox" id="c-40215265" checked=""/><div class="controls bullet"><span class="by">hathawsh</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40218803">prev</a><span>|</span><a href="#40213932">next</a><span>|</span><label class="collapse" for="c-40215265">[-]</label><label class="expand" for="c-40215265">[1 more]</label></div><br/><div class="children"><div class="content">Have you been introduced to functional programming? It&#x27;s excellent and mind-bending at first. Here&#x27;s an overview: <a href="https:&#x2F;&#x2F;github.com&#x2F;readme&#x2F;guides&#x2F;functional-programming-basics">https:&#x2F;&#x2F;github.com&#x2F;readme&#x2F;guides&#x2F;functional-programming-basi...</a><p>Declarative structure is at the heart of functional programming. Declarative is not the right choice everywhere, but when it makes sense, it can significantly raise the quality of the code.</div><br/></div></div><div id="40213932" class="c"><input type="checkbox" id="c-40213932" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40215265">prev</a><span>|</span><a href="#40216091">next</a><span>|</span><label class="collapse" for="c-40213932">[-]</label><label class="expand" for="c-40213932">[1 more]</label></div><br/><div class="children"><div class="content">Conceptually I think itâs much nicer to define the state of the system rather than the steps to get there, and tool of choice figures it out.<p>But thereâs always edge cases and situations that doesnât work which is why pyinfra supports both and they can combine any way you like.</div><br/></div></div><div id="40216091" class="c"><input type="checkbox" id="c-40216091" checked=""/><div class="controls bullet"><span class="by">dboreham</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213615">parent</a><span>|</span><a href="#40213932">prev</a><span>|</span><a href="#40217498">next</a><span>|</span><label class="collapse" for="c-40216091">[-]</label><label class="expand" for="c-40216091">[2 more]</label></div><br/><div class="children"><div class="content">It makes people feel that they&#x27;re smarter than you. See also functional programming. That said sometimes it&#x27;s useful as s way to auto generate imperative actions.</div><br/><div id="40216741" class="c"><input type="checkbox" id="c-40216741" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40216091">parent</a><span>|</span><a href="#40217498">next</a><span>|</span><label class="collapse" for="c-40216741">[-]</label><label class="expand" for="c-40216741">[1 more]</label></div><br/><div class="children"><div class="content">I really can&#x27;t see how you could feel that way about it after spending even just a few minutes (which it sounds like you have) to understand what it means beyond just reacting to terminology, something having a name.<p>I definitely think it&#x27;d be easier to explain a python-like declarative language to someone who asks what programming is than actual python. &#x27;It&#x27;s just describing the way things should be&#x27; vs. &#x27;it&#x27;s like a series of instructions for how to compute ...&#x27;<p>Certainly not more clever IMO, if anything the opposite. Like I said above or elsewhere in this thread, when I&#x27;m managing infrastructure with Terraform I don&#x27;t want to (and don&#x27;t have to) be thinking about how to interface with the API, check whether things exist already, their current state, how to move from that to what I want, etc. I just know the way I want it being, I declare that, and the procedure for figuring it out and making it so is the provider&#x27;s job. That&#x27;s not smarter! The smart&#x27;s in the provider! (But ok if you&#x27;re going to make me flex, I&#x27;ve written and contributed to providers too... But that&#x27;s Go; not declarative.)</div><br/></div></div></div></div></div></div><div id="40217498" class="c"><input type="checkbox" id="c-40217498" checked=""/><div class="controls bullet"><span class="by">pid-1</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40213094">parent</a><span>|</span><a href="#40213615">prev</a><span>|</span><a href="#40214689">next</a><span>|</span><label class="collapse" for="c-40217498">[-]</label><label class="expand" for="c-40217498">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Obviously python isn&#x27;t<p>Obviously you can create declarative idioms in Python</div><br/><div id="40218470" class="c"><input type="checkbox" id="c-40218470" checked=""/><div class="controls bullet"><span class="by">OJFord</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40217498">parent</a><span>|</span><a href="#40214689">next</a><span>|</span><label class="collapse" for="c-40218470">[-]</label><label class="expand" for="c-40218470">[1 more]</label></div><br/><div class="children"><div class="content">Sure, if you keep reading I described one that it looked like this might be doing.</div><br/></div></div></div></div></div></div><div id="40214689" class="c"><input type="checkbox" id="c-40214689" checked=""/><div class="controls bullet"><span class="by">mrled</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40213094">prev</a><span>|</span><a href="#40214144">next</a><span>|</span><label class="collapse" for="c-40214689">[-]</label><label class="expand" for="c-40214689">[1 more]</label></div><br/><div class="children"><div class="content">Oh man this is really cool. I have also written a Python infrastructure-as-code project (<a href="https:&#x2F;&#x2F;pages.micahrl.com&#x2F;progfiguration&#x2F;" rel="nofollow">https:&#x2F;&#x2F;pages.micahrl.com&#x2F;progfiguration&#x2F;</a>), I really like the idea of using a programming language rather than a text document to define infrastructure. Yours looks very polished, and the built in support for testing in Docker is a brilliant idea.</div><br/></div></div><div id="40214144" class="c"><input type="checkbox" id="c-40214144" checked=""/><div class="controls bullet"><span class="by">InitEnabler</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40214689">prev</a><span>|</span><a href="#40217916">next</a><span>|</span><label class="collapse" for="c-40214144">[-]</label><label class="expand" for="c-40214144">[1 more]</label></div><br/><div class="children"><div class="content">dang this exploded. I came across the project this morning when I was looking at a blog on how to implement a generic programming language to become a configuration language and it mentioned pyinfra. Glad this project is getting some exposure. :)</div><br/></div></div><div id="40217916" class="c"><input type="checkbox" id="c-40217916" checked=""/><div class="controls bullet"><span class="by">rbut</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40214144">prev</a><span>|</span><a href="#40214807">next</a><span>|</span><label class="collapse" for="c-40217916">[-]</label><label class="expand" for="c-40217916">[1 more]</label></div><br/><div class="children"><div class="content">How does it compare to Fabric? At first glance it looks quite similar. All our scripts are written in Fabric, but Fabric appears to be somewhat abandoned and the latest version never reached full parity with v1. I&#x27;d be looking to try something new next time.</div><br/></div></div><div id="40214807" class="c"><input type="checkbox" id="c-40214807" checked=""/><div class="controls bullet"><span class="by">esafak</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40217916">prev</a><span>|</span><a href="#40218751">next</a><span>|</span><label class="collapse" for="c-40214807">[-]</label><label class="expand" for="c-40214807">[1 more]</label></div><br/><div class="children"><div class="content">How does it compare with pulumi?</div><br/></div></div><div id="40218751" class="c"><input type="checkbox" id="c-40218751" checked=""/><div class="controls bullet"><span class="by">linsomniac</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40214807">prev</a><span>|</span><a href="#40215883">next</a><span>|</span><label class="collapse" for="c-40218751">[-]</label><label class="expand" for="c-40218751">[2 more]</label></div><br/><div class="children"><div class="content">What is different in v3?  Didn&#x27;t see it in the &quot;Next&quot; docs.</div><br/><div id="40218783" class="c"><input type="checkbox" id="c-40218783" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40218751">parent</a><span>|</span><a href="#40215883">next</a><span>|</span><label class="collapse" for="c-40218783">[-]</label><label class="expand" for="c-40218783">[1 more]</label></div><br/><div class="children"><div class="content">Mostly this from the 3.x changelog:<p>&gt; pyinfra now executes operations at runtime, rather than pre-generating commands. Although the change isn&#x27;t noticeable this fixes an entire class of bugs and confusion. See the limitations section in the v2 docs. All of those issues are now a thing of the past.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;blob&#x2F;3.x&#x2F;CHANGELOG.md">https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;blob&#x2F;3.x&#x2F;CHANGELOG.md</a></div><br/></div></div></div></div><div id="40215883" class="c"><input type="checkbox" id="c-40215883" checked=""/><div class="controls bullet"><span class="by">gnosek</span><span>|</span><a href="#40212701">parent</a><span>|</span><a href="#40218751">prev</a><span>|</span><a href="#40215908">next</a><span>|</span><label class="collapse" for="c-40215883">[-]</label><label class="expand" for="c-40215883">[3 more]</label></div><br/><div class="children"><div class="content">[yet another reference to Ansible, sorry! :)]<p>This looks like infinity times better than Ansible in some cases and somewhat worse in others (python.call every time I&#x27;d need to access a previous operation&#x27;s result feels clunky, though I certainly understand why it works that way).<p>Do you think it would be possible to use Ansible modules as pyinfra operations? As in, for example:<p><pre><code>  - name: install foo
    apt:
      pkg: foo
      state: present
</code></pre>
could be available as:<p><pre><code>  from pyinfra import ansible

  ansible(name=&#x27;install foo&#x27;).apt(pkg=&#x27;foo&#x27;, state=&#x27;present&#x27;)

</code></pre>
where the `ansible` function itself would know nothing about apt, just forward everything to the Ansible module.<p>Note 1: I know pyinfra has a way to interface with apt, this is just an example :)
Note 2: It&#x27;s just my curiosity, my sysadmin days are long gone now.</div><br/><div id="40216130" class="c"><input type="checkbox" id="c-40216130" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40215883">parent</a><span>|</span><a href="#40215908">next</a><span>|</span><label class="collapse" for="c-40216130">[-]</label><label class="expand" for="c-40216130">[2 more]</label></div><br/><div class="children"><div class="content">Definitely possible! Not familiar with the ansible Python API so partially guessing but the pyinfra op could yield a callback function that then calls ansible at execution time.<p>Alternatively you could just yield ansible cli and execute from the local machine using the @local connector.</div><br/><div id="40216790" class="c"><input type="checkbox" id="c-40216790" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40212701">root</a><span>|</span><a href="#40216130">parent</a><span>|</span><a href="#40215908">next</a><span>|</span><label class="collapse" for="c-40216790">[-]</label><label class="expand" for="c-40216790">[1 more]</label></div><br/><div class="children"><div class="content">FWIW, ansible modules (all of them, to the best of my knowledge) operate via a stdin&#x2F;stdout contract since that&#x27;s the <i>one universal api</i> for &quot;do this thing over (ssh|docker|ssm|local)&quot;. That&#x27;s also why it supports writing plugins in any language (shell, compiled, python, etc) since `subprocess.Popen().communicate(b&#x27;{&quot;do_awesome&quot;:true}&#x27;)` works great<p><i>DISCOVERING</i> the available ansible actions is the JFC since, like all good things python, it depends on what&#x27;s currently on the PYTHONPATH and what makes writing or using any such language-server some onoz<p>And this wasn&#x27;t what you asked, but ansible has a dedicated library for exec, since the normal `ansible` and `ansible-playbook` CLIs are really, <i>really</i> oriented toward interactive use: <a href="https:&#x2F;&#x2F;github.com&#x2F;ansible&#x2F;ansible-runner#readme">https:&#x2F;&#x2F;github.com&#x2F;ansible&#x2F;ansible-runner#readme</a></div><br/></div></div></div></div></div></div></div></div><div id="40215908" class="c"><input type="checkbox" id="c-40215908" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#40212701">prev</a><span>|</span><a href="#40212449">next</a><span>|</span><label class="collapse" for="c-40215908">[-]</label><label class="expand" for="c-40215908">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>Pyinfra automates infrastructure super fast at scale</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33286972">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33286972</a> - Oct 2022 (37 comments)<p><i>Show HN: pyinfra v2</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30999030">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30999030</a> - April 2022 (2 comments)<p><i>Pyinfra v2.0 Released</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30973976">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=30973976</a> - April 2022 (3 comments)<p><i>Show HN: Pyinfra v1.4</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26983266">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26983266</a> - April 2021 (3 comments)<p><i>Pyinfra â automate infrastructure super fast at scale</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=23487178">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=23487178</a> - June 2020 (64 comments)<p><i>Pyinfra v0.3</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=13862942">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=13862942</a> - March 2017 (1 comment)<p><i>Pyinfra v0.2</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=12956784">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=12956784</a> - Nov 2016 (2 comments)</div><br/></div></div><div id="40212449" class="c"><input type="checkbox" id="c-40212449" checked=""/><div class="controls bullet"><span class="by">activatedgeek</span><span>|</span><a href="#40215908">prev</a><span>|</span><a href="#40213558">next</a><span>|</span><label class="collapse" for="c-40212449">[-]</label><label class="expand" for="c-40212449">[17 more]</label></div><br/><div class="children"><div class="content">I current use Ansible to setup both local and remote hosts. I&#x27;ve been very happy with it, and love that Pyinfra intends to support the Ansible connector.<p>My main gripe with Ansible is the YAML specification. Ansible chooses to separate the task specification and task execution. 
Pyinfra chooses to directly expose the Python layer, instead of using slightly ugly magic functions&#x2F;variables. I like this approach more since it allows standard Pythonic control flow instead of using a new (arguably ugly and more hassle to maintain) grammar.<p>Excited for Pyinfra!</div><br/><div id="40217070" class="c"><input type="checkbox" id="c-40217070" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#40212449">parent</a><span>|</span><a href="#40212552">next</a><span>|</span><label class="collapse" for="c-40217070">[-]</label><label class="expand" for="c-40217070">[1 more]</label></div><br/><div class="children"><div class="content">Real Python instead of templating (Jinja in YAML) would be nice.<p>In Ansible, it&#x27;s fairly arduous to try to reshape data from command outputs into structures that can be used in loops in other tasks--especially if you want to merge output from multiple commands. Main usecase is more dynamic playbooks where you combine state from multiple systems to create a new piece of infrastructure.<p>I think templating yaml or templates inside yaml is a bit of an anti pattern.</div><br/></div></div><div id="40212552" class="c"><input type="checkbox" id="c-40212552" checked=""/><div class="controls bullet"><span class="by">WesolyKubeczek</span><span>|</span><a href="#40212449">parent</a><span>|</span><a href="#40217070">prev</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40212552">[-]</label><label class="expand" for="c-40212552">[8 more]</label></div><br/><div class="children"><div class="content">I&#x27;m only using Ansible because of its extensive documentation and mindshare, but my best successes with it were when I let go of the idea that the playbooks specify state &quot;declaratively&quot;. I now treat them as imperative steps where each step is being checked as to whether it needs to be done or not, and it has vastly simplified my mental model of what Ansible is actually doing.</div><br/><div id="40212732" class="c"><input type="checkbox" id="c-40212732" checked=""/><div class="controls bullet"><span class="by">letmeinhere</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40212552">parent</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40212732">[-]</label><label class="expand" for="c-40212732">[7 more]</label></div><br/><div class="children"><div class="content">I think of ansible as a declarative-imperative lasagna, where each playbook is a desired state, achieved by an imperative sequence of plays, which themselves are desired states, achieved by a sequence of roles, which have the same properties, and then tasks too below that, finally resolving to plain old imperative Python.<p>It&#x27;s all pretty messy but useful.</div><br/><div id="40213321" class="c"><input type="checkbox" id="c-40213321" checked=""/><div class="controls bullet"><span class="by">WesolyKubeczek</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40212732">parent</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40213321">[-]</label><label class="expand" for="c-40213321">[6 more]</label></div><br/><div class="children"><div class="content">I never grokked this âplaysâ and ârolesâ business. All in all, this clever and cute terminology gives me creeps. I only use âplaybooksâ as series of tasks, more or less.<p>Maybe I need an explanation âlike Iâm just a programmer&#x2F;sysadmin and I need to use boring terms years oldâ of what is what, every explanation so far (when I bothered to look for it last) was too invested in this theatrical terminology, so I gave up and stuck to what worked after a command or two.<p>Same with Chef and its galore of cooking words, but thankfully I donât have to use Chef.</div><br/><div id="40213922" class="c"><input type="checkbox" id="c-40213922" checked=""/><div class="controls bullet"><span class="by">zanecodes</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213321">parent</a><span>|</span><a href="#40220230">next</a><span>|</span><label class="collapse" for="c-40213922">[-]</label><label class="expand" for="c-40213922">[1 more]</label></div><br/><div class="children"><div class="content">To this day I&#x27;m miffed that Chef has &quot;cookbooks&quot; which contain &quot;recipes,&quot; which contain... &quot;resources.&quot; Why not &quot;ingredients??&quot; It was right there!</div><br/></div></div><div id="40220230" class="c"><input type="checkbox" id="c-40220230" checked=""/><div class="controls bullet"><span class="by">ornornor</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213321">parent</a><span>|</span><a href="#40213922">prev</a><span>|</span><a href="#40213455">next</a><span>|</span><label class="collapse" for="c-40220230">[-]</label><label class="expand" for="c-40220230">[1 more]</label></div><br/><div class="children"><div class="content">Ansible is useful but so confusin (to me anyway).<p>The way I see roles vs playbooks is whether Iâm going to reuse it or not.<p>Roles are more generic playbooks in a sense that I can share with others or across deployments (for example setup a reverse proxy, or install a piece of software with sane, overridable defaults.<p>I can then use roles within playbooks to tweak the piece of softwareâs configuration. If itâs a one-off confit&#x2F;setup then Iâll use a playbook.<p>I donât know if itâs the right paradigm (I donât think itâs explained well and clearly in the docs), but using this rule of thumb has helped me deal with it.<p>Of course, any role can be a playbook and vice versa since they do the same thing functionally, itâs all about reusability and sharing.<p>Kinda how you have libraries in software: role = library, playbook = the software you actually want to write.</div><br/></div></div><div id="40213455" class="c"><input type="checkbox" id="c-40213455" checked=""/><div class="controls bullet"><span class="by">rmetzler</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213321">parent</a><span>|</span><a href="#40220230">prev</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40213455">[-]</label><label class="expand" for="c-40213455">[3 more]</label></div><br/><div class="children"><div class="content">An Ansible playbook is usually the main entrypoint, it consists of a list of plays. Each play has hosts and a list of tasks to run at them.<p>Because people wanted to reuse their code, the abstraction of roles was created. A role is something like âsetup basic OS stuffâ, âcreate this list of usersâ, âsetup a Webserverâ, âsetup a databaseâ. The association, which roles to run on which machine still happens in the playbook.</div><br/><div id="40213973" class="c"><input type="checkbox" id="c-40213973" checked=""/><div class="controls bullet"><span class="by">WesolyKubeczek</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213455">parent</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40213973">[-]</label><label class="expand" for="c-40213973">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m using include_tasks: and import_playbook:, like an animal :)</div><br/><div id="40214846" class="c"><input type="checkbox" id="c-40214846" checked=""/><div class="controls bullet"><span class="by">trallnag</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213973">parent</a><span>|</span><a href="#40212861">next</a><span>|</span><label class="collapse" for="c-40214846">[-]</label><label class="expand" for="c-40214846">[1 more]</label></div><br/><div class="children"><div class="content">You can&#x27;t share a set of tasks on Ansible Galaxy without wrapping it in a role</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40212861" class="c"><input type="checkbox" id="c-40212861" checked=""/><div class="controls bullet"><span class="by">polski-g</span><span>|</span><a href="#40212449">parent</a><span>|</span><a href="#40212552">prev</a><span>|</span><a href="#40213558">next</a><span>|</span><label class="collapse" for="c-40212861">[-]</label><label class="expand" for="c-40212861">[7 more]</label></div><br/><div class="children"><div class="content">My biggest problem with Ansible is the YAML, doing anything with loops is horrendous &amp; trying to mangle nested variable types requires a StackOverflow post every time.<p>A few years ago, I found a library that lets you utilize Ansible&#x27;s tasks in raw Python, without the huge hassle of using the Ansible Python API. I cannot find it again however. But PyInfra looks great.</div><br/><div id="40212937" class="c"><input type="checkbox" id="c-40212937" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40212861">parent</a><span>|</span><a href="#40216524">next</a><span>|</span><label class="collapse" for="c-40212937">[-]</label><label class="expand" for="c-40212937">[5 more]</label></div><br/><div class="children"><div class="content">This alone is the entire reason I started working on pyinfra, loops in YAML is just evil.</div><br/><div id="40213478" class="c"><input type="checkbox" id="c-40213478" checked=""/><div class="controls bullet"><span class="by">bruh2</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40212937">parent</a><span>|</span><a href="#40216524">next</a><span>|</span><label class="collapse" for="c-40213478">[-]</label><label class="expand" for="c-40213478">[4 more]</label></div><br/><div class="children"><div class="content">Why did you choose to roll your own modules rather than do what&#x27;s described in the comment you replied to, i.e. provide a Python layer for interacting with the rich set of available Ansible modules?<p>Not trying to be rude ofc, I&#x27;m sure you considered it and have a good reason â just curious as of what it is. An incredible project you put there, nonetheless:)</div><br/><div id="40214291" class="c"><input type="checkbox" id="c-40214291" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213478">parent</a><span>|</span><a href="#40217488">next</a><span>|</span><label class="collapse" for="c-40214291">[-]</label><label class="expand" for="c-40214291">[1 more]</label></div><br/><div class="children"><div class="content">Not rude at all :) When I first started (not sure if this is still the case?) Ansible would push Python code to the target machine and execute there, meaning it wasnât actually agentless. I always thought of pyinfra as copying what a human would do if configuring a server by hand over SSH, so new modules that use only shell commands were needed.</div><br/></div></div><div id="40217488" class="c"><input type="checkbox" id="c-40217488" checked=""/><div class="controls bullet"><span class="by">natebc</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213478">parent</a><span>|</span><a href="#40214291">prev</a><span>|</span><a href="#40214382">next</a><span>|</span><label class="collapse" for="c-40217488">[-]</label><label class="expand" for="c-40217488">[1 more]</label></div><br/><div class="children"><div class="content">I recall the Ansible Python API to be labeled as Interal Use Only and subject to change on a whim because of that. That at least discouraged using ansible in that way.<p>Seems they still kinda discourage it but do have examples at least.<p><a href="https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;dev_guide&#x2F;developing_api.html" rel="nofollow">https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;dev_guide&#x2F;developing...</a></div><br/></div></div><div id="40214382" class="c"><input type="checkbox" id="c-40214382" checked=""/><div class="controls bullet"><span class="by">geerlingguy</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40213478">parent</a><span>|</span><a href="#40217488">prev</a><span>|</span><a href="#40216524">next</a><span>|</span><label class="collapse" for="c-40214382">[-]</label><label class="expand" for="c-40214382">[1 more]</label></div><br/><div class="children"><div class="content">It could be interesting if you could write a translator to use any Ansible module with this, and vice versa.</div><br/></div></div></div></div></div></div><div id="40216524" class="c"><input type="checkbox" id="c-40216524" checked=""/><div class="controls bullet"><span class="by">movedx</span><span>|</span><a href="#40212449">root</a><span>|</span><a href="#40212861">parent</a><span>|</span><a href="#40212937">prev</a><span>|</span><a href="#40213558">next</a><span>|</span><label class="collapse" for="c-40216524">[-]</label><label class="expand" for="c-40216524">[1 more]</label></div><br/><div class="children"><div class="content">But you can just write a small module in Python, have it do the looping logic for you, install it at the root of your project&#x27;s configuration-as-code repository, and then use the module in the YAML, removing the need to do complex, ugly loops in YAML.<p>Is there a reason this isn&#x27;t an option for you?</div><br/></div></div></div></div></div></div><div id="40213558" class="c"><input type="checkbox" id="c-40213558" checked=""/><div class="controls bullet"><span class="by">jdoss</span><span>|</span><a href="#40212449">prev</a><span>|</span><a href="#40212747">next</a><span>|</span><label class="collapse" for="c-40213558">[-]</label><label class="expand" for="c-40213558">[4 more]</label></div><br/><div class="children"><div class="content">I just started using Pyinfra to wrangle a bunch of servers and it is a breath of fresh air compared to Ansible. I moved all of my server OS installs to Fedora CoreOS which doesn&#x27;t ship with Python in the OS and since Pyinfra doesn&#x27;t need Python on the host node I can kick off tasks in bulk to do server things. It is great. I cannot wait to see where the Pyinfra project goes.<p>On a side note, one of the most hacky things I came up with to get Ansible working on Fedora CoreOS was to bind mount a container rootfs that had python 3 and then symlink it into the right spots. You can of course add Python in with rpm-ostree if you want but I wanted to avoid layering packages at the time. I wasn&#x27;t proud of it. But it worked.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;forem&#x2F;selfhost&#x2F;blob&#x2F;main&#x2F;playbooks&#x2F;templates&#x2F;forem.yml.j2#L67-L118">https:&#x2F;&#x2F;github.com&#x2F;forem&#x2F;selfhost&#x2F;blob&#x2F;main&#x2F;playbooks&#x2F;templa...</a></div><br/><div id="40214808" class="c"><input type="checkbox" id="c-40214808" checked=""/><div class="controls bullet"><span class="by">shoggouth</span><span>|</span><a href="#40213558">parent</a><span>|</span><a href="#40216555">next</a><span>|</span><label class="collapse" for="c-40214808">[-]</label><label class="expand" for="c-40214808">[1 more]</label></div><br/><div class="children"><div class="content">Doesnât IBM&#x2F;Red Hat own Ansible and Fedora CoreOS? I would think they would mix together perfectly.</div><br/></div></div><div id="40216555" class="c"><input type="checkbox" id="c-40216555" checked=""/><div class="controls bullet"><span class="by">movedx</span><span>|</span><a href="#40213558">parent</a><span>|</span><a href="#40214808">prev</a><span>|</span><a href="#40212747">next</a><span>|</span><label class="collapse" for="c-40216555">[-]</label><label class="expand" for="c-40216555">[2 more]</label></div><br/><div class="children"><div class="content">&gt; since Pyinfra doesn&#x27;t need Python on the host node I can kick off tasks in bulk to do server things.<p>And you can do this with Ansible, too. Check out the raw module&#x2F;command.</div><br/><div id="40216647" class="c"><input type="checkbox" id="c-40216647" checked=""/><div class="controls bullet"><span class="by">jdoss</span><span>|</span><a href="#40213558">root</a><span>|</span><a href="#40216555">parent</a><span>|</span><a href="#40212747">next</a><span>|</span><label class="collapse" for="c-40216647">[-]</label><label class="expand" for="c-40216647">[1 more]</label></div><br/><div class="children"><div class="content">I am aware of the raw module. The stuff I was doing with Ansible and Fedora CoreOS required more than just that module.</div><br/></div></div></div></div></div></div><div id="40212747" class="c"><input type="checkbox" id="c-40212747" checked=""/><div class="controls bullet"><span class="by">zbentley</span><span>|</span><a href="#40213558">prev</a><span>|</span><a href="#40215385">next</a><span>|</span><label class="collapse" for="c-40212747">[-]</label><label class="expand" for="c-40212747">[11 more]</label></div><br/><div class="children"><div class="content">I think Puppet hits the sweet spot in this area. It&#x27;s default is a series of idempotent &quot;here&#x27;s how this should be configured&quot; statements, but it can be used as a full programming language in its more advanced capacity, and it&#x27;s reasonably extensible (in Puppet-lang and Ruby) to support specific custom applications.<p>I also think that the facts&#x2F;manifest&#x2F;apply separation is conducive to nicely testable infra code, and useful dry-run output.<p>I&#x27;m always surprised that Puppet isn&#x27;t still more popular. My theory is that it&#x27;s passed over because of its age&#x2F;cruftiness&#x2F;bad vibes in some cases, and that  a couple of technical flaws mess it up for some key userbases:<p>For folks who just want a quick-to-start management tool for a small set of config, Puppet&#x27;s ugly and clunky client&#x2F;server model and the hyper-YAML-ification of its best practices (which is pursued to a fault by the community, and not helped by the Hiera pitch that the Puppet stack can also be sort of an asset tracking&#x2F;catalog system) make small-scale usage and prototyping hard. Puppet doesn&#x27;t <i>have</i> to be used that way (it can be used just like pyinfra&#x2F;Ansible with a local-apply or via Bolt, hitting a nice sweet spot between ad-hoc&#x2F;non-idempotent commands and nice declarative&#x2F;idempotent Puppet code), but I think the puppetmaster&#x2F;hiera-all-the-things legacy in the community does Puppet and potential new users a disservice.<p>From the other side, I think a lot of more cloud-oriented users looking for a &quot;better Terraform for server state&quot; end up annoyed by the quality of modules on the Puppet forge and Puppet&#x27;s lack of a statefile equivalent (meaning that it doesn&#x27;t support deletes or infrastructure state snapshots in the same way TF does).</div><br/><div id="40213333" class="c"><input type="checkbox" id="c-40213333" checked=""/><div class="controls bullet"><span class="by">turtlebits</span><span>|</span><a href="#40212747">parent</a><span>|</span><a href="#40218904">next</a><span>|</span><label class="collapse" for="c-40213333">[-]</label><label class="expand" for="c-40213333">[6 more]</label></div><br/><div class="children"><div class="content">Adding config management agents to run on your infra is IMO unnecessary operational burden. (ie puppet, chef, saltstack, etc.)  In the day and age of everything running on Docker, the closer you are to a bare OS image, the better.<p>Config management that uses SSH is generally good enough.</div><br/><div id="40213511" class="c"><input type="checkbox" id="c-40213511" checked=""/><div class="controls bullet"><span class="by">zbentley</span><span>|</span><a href="#40212747">root</a><span>|</span><a href="#40213333">parent</a><span>|</span><a href="#40213607">next</a><span>|</span><label class="collapse" for="c-40213511">[-]</label><label class="expand" for="c-40213511">[1 more]</label></div><br/><div class="children"><div class="content">I agree; that&#x27;s the &quot;client-server legacy&quot; that I mentioned in GP.<p>It&#x27;s unfortunately not widely known that Puppet can be run just like you describe, over SSH (or, for e.g. running in a Docker container, can be invoked as a one-shot &quot;puppet apply&quot; against a local configuration file like pyinfra&#x27;s &quot;local&quot; transport): <a href="https:&#x2F;&#x2F;www.puppet.com&#x2F;docs&#x2F;bolt&#x2F;latest&#x2F;bolt.html" rel="nofollow">https:&#x2F;&#x2F;www.puppet.com&#x2F;docs&#x2F;bolt&#x2F;latest&#x2F;bolt.html</a>. Doing that requires no background daemons, puppetmasters, cert-signing hell, inventory management PuppetDB&#x2F;Foreman stacks, or any of that stuff: you run a command which SSHes to a remote&#x2F;local machine and applies changes based on instructions written in Puppet-lang or one-off scripts. The remote end is entirely self-hosting; it doesn&#x27;t rely on anything being running on the remote host (Bolt will install the &quot;puppet-agent&quot; package to bootstrap itself, but in this context that package is inert and is used equivalently to a library when you run tasks).<p>I&#x27;m with you that the agent-based approach is far from the best way to go these days. I&#x27;m just bummed that we&#x27;re throwing the baby out with the bathwater: I wish Puppet-the-language and Puppet-the-server-management-tool weren&#x27;t so often dismissed along with the Puppet-as-inventory-system or Puppet-as-daemonized-continuous-compliance-engine.</div><br/></div></div><div id="40213607" class="c"><input type="checkbox" id="c-40213607" checked=""/><div class="controls bullet"><span class="by">bigstrat2003</span><span>|</span><a href="#40212747">root</a><span>|</span><a href="#40213333">parent</a><span>|</span><a href="#40213511">prev</a><span>|</span><a href="#40213409">next</a><span>|</span><label class="collapse" for="c-40213607">[-]</label><label class="expand" for="c-40213607">[1 more]</label></div><br/><div class="children"><div class="content">Hard disagree. Having an agent running on things is IMO far superior for preventing config drift (agents checking in versus one big centralized cron job pushing state to everything). And to be honest, the fact that it doesn&#x27;t play as well with Docker is a flaw with the idea of putting everything in Docker, not having a config agent. Some things work well in containers, but it&#x27;s silly to try to shoehorn everything into them the way many people do.</div><br/></div></div><div id="40213409" class="c"><input type="checkbox" id="c-40213409" checked=""/><div class="controls bullet"><span class="by">eurekin</span><span>|</span><a href="#40212747">root</a><span>|</span><a href="#40213333">parent</a><span>|</span><a href="#40213607">prev</a><span>|</span><a href="#40213579">next</a><span>|</span><label class="collapse" for="c-40213409">[-]</label><label class="expand" for="c-40213409">[2 more]</label></div><br/><div class="children"><div class="content">Can concur, used puppet a bit at the dayjob and agent issues were common at some point.<p>Also, for bigger inventories on a single vm runtimes shot up quickly in the hour realm</div><br/><div id="40213646" class="c"><input type="checkbox" id="c-40213646" checked=""/><div class="controls bullet"><span class="by">zbentley</span><span>|</span><a href="#40212747">root</a><span>|</span><a href="#40213409">parent</a><span>|</span><a href="#40213579">next</a><span>|</span><label class="collapse" for="c-40213646">[-]</label><label class="expand" for="c-40213646">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, dealing with agent issues sucked; I&#x27;m glad I haven&#x27;t worked on one of those setups in awhile. And if the agent bootstrapped some part of the shell-in-and-remotely-troubleshoot tooling, good luck debugging it, and if the agent bootstrapped the telemetry system, good luck telling the difference between &quot;host with agent failure&quot; and &quot;host that disappeared&quot;... anyway. Fun times.<p>For hour+ runtimes I really do think that&#x27;s pretty much always user error. I know that&#x27;s a clichÃ©d and grouchy comment, but (as, I&#x27;ll admit, a Puppet fan with some personal defensiveness for a favored tool) I do think it&#x27;s true in this case.</div><br/></div></div></div></div><div id="40213579" class="c"><input type="checkbox" id="c-40213579" checked=""/><div class="controls bullet"><span class="by">esoterae</span><span>|</span><a href="#40212747">root</a><span>|</span><a href="#40213333">parent</a><span>|</span><a href="#40213409">prev</a><span>|</span><a href="#40218904">next</a><span>|</span><label class="collapse" for="c-40213579">[-]</label><label class="expand" for="c-40213579">[1 more]</label></div><br/><div class="children"><div class="content">Ssh and its child processes are just another agent.  Agents of a model that must be up at time-of-convergence as seen from the coordinator node; a remarkably inflexible arrangement that can only be addressed with additional development not otherwise necessary.<p>Ruby is far, far preferable to shell for ease of idempotence and implicit convergence.</div><br/></div></div></div></div><div id="40218904" class="c"><input type="checkbox" id="c-40218904" checked=""/><div class="controls bullet"><span class="by">slyall</span><span>|</span><a href="#40212747">parent</a><span>|</span><a href="#40213333">prev</a><span>|</span><a href="#40216659">next</a><span>|</span><label class="collapse" for="c-40218904">[-]</label><label class="expand" for="c-40218904">[1 more]</label></div><br/><div class="children"><div class="content">Another reason for puppet being less popular is lots of places ended up with very complicated configuration that did everything on the server but was hard to work with.<p>Ansible you could deploy a small playbook that did just one thing. A lot easier to get started with and keep under control.<p>As others have mentioned puppet was also a lot less useful when server images can per-configured and often short lived. It was more designed to take a bare OS install and turn into a long-lived server.</div><br/></div></div><div id="40216659" class="c"><input type="checkbox" id="c-40216659" checked=""/><div class="controls bullet"><span class="by">bityard</span><span>|</span><a href="#40212747">parent</a><span>|</span><a href="#40218904">prev</a><span>|</span><a href="#40213950">next</a><span>|</span><label class="collapse" for="c-40216659">[-]</label><label class="expand" for="c-40216659">[1 more]</label></div><br/><div class="children"><div class="content">I was an early adopter of Puppet back when it was fairly new. It was a breath of fresh air when the state of the art was cfengine!<p>Despite its many great ideas, I never particularly liked the agent or need for a master server. And I&#x27;ve always managed to avoid learning Ruby so I couldn&#x27;t easily hack on it myself. The company I&#x27;m with now uses it extensively so I&#x27;m having to re-learn it and so far my impression is that it went from &quot;cool new open source thing&quot; to &quot;your average enterprise-grade bloatware thing&quot;.</div><br/></div></div><div id="40213950" class="c"><input type="checkbox" id="c-40213950" checked=""/><div class="controls bullet"><span class="by">aprdm</span><span>|</span><a href="#40212747">parent</a><span>|</span><a href="#40216659">prev</a><span>|</span><a href="#40217121">next</a><span>|</span><label class="collapse" for="c-40213950">[-]</label><label class="expand" for="c-40213950">[1 more]</label></div><br/><div class="children"><div class="content">I believe it&#x27;s due to Ruby being its language of choice. Ruby is mostly a dead language in the Ops space, unlike Python.<p>Having inherited a big mess on Puppet of some people who used the flexibility of Ruby to automate 5 datacenters,  but then left the company was also an interesting  experience..</div><br/></div></div><div id="40217121" class="c"><input type="checkbox" id="c-40217121" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#40212747">parent</a><span>|</span><a href="#40213950">prev</a><span>|</span><a href="#40215385">next</a><span>|</span><label class="collapse" for="c-40217121">[-]</label><label class="expand" for="c-40217121">[1 more]</label></div><br/><div class="children"><div class="content">Usually when I use these types of tools I&#x27;m building immutable infrastructure where a golden image gets built and an existing app data volume gets attached to a new OS image (same workflow as Docker containers but more access to kernel&#x2F;hardware)<p>Puppet doesn&#x27;t work well for that. I&#x27;ve seen it come up in auditing scenarios since the agent can effectively report if the instance is still in the correct config state.</div><br/></div></div></div></div><div id="40215385" class="c"><input type="checkbox" id="c-40215385" checked=""/><div class="controls bullet"><span class="by">kureikain</span><span>|</span><a href="#40212747">prev</a><span>|</span><a href="#40212984">next</a><span>|</span><label class="collapse" for="c-40215385">[-]</label><label class="expand" for="c-40215385">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for making Pyinfra.<p>It&#x27;s one of the tool that get out of your way and let. you get the work done. The tool works for you instead of you fighting with the tool.<p>Pain point of ansible: storing state and checking later, coordinate state between server is all a breezy with Pyinfra because you write the Python code to perform those check.<p>The system is very well though out. No need to hack around host file, inventory is just a python script that export resource definition.<p>No more static, ad-hoc host var, you get a real python script to define and return your variable.<p>Using pyinfra I was able to focus more on the &quot;compute&quot;. the state such as credential, inventory can managed and store outside such as in SSM or just call python ec2 api to filter instance by tag.</div><br/></div></div><div id="40212984" class="c"><input type="checkbox" id="c-40212984" checked=""/><div class="controls bullet"><span class="by">photonthug</span><span>|</span><a href="#40215385">prev</a><span>|</span><a href="#40213688">next</a><span>|</span><label class="collapse" for="c-40212984">[-]</label><label class="expand" for="c-40212984">[2 more]</label></div><br/><div class="children"><div class="content">Agree with those saying the landing page needs work.  But terraform&#x2F;docker integration sounds interesting.. after many years of ansible youâd think there is a more comfortable way to replace a hundred lines of hacky bash in dockerfiles.<p>Also, can I just say that cm is extremely frustrating?  Not sure this is the fix, but hopefully the story isnât over.  In my experience the maintenance of cm codebases never, ever stops.  At first I thought it was a matter of expertise, but experts typically agree and just call it the cost of doing business.<p>Shelve something for three months and it will break on the next run, on the same os&#x2F;host where it used to work.  Blame the package manager, blame the os choice, or the cm tool. But itâs embarrassing and insulting for Devops teams after putting in the effort to do things right, and evangelizing to everyone else about repeatability.  Iâd rather just see tighter integrations with containers moving forward and never think about it again.  Not everyone is using k8s but in the 2020s everyone probably should default to using docker before doing things of even marginal complexity directly on hosts.</div><br/><div id="40213026" class="c"><input type="checkbox" id="c-40213026" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212984">parent</a><span>|</span><a href="#40213688">next</a><span>|</span><label class="collapse" for="c-40213026">[-]</label><label class="expand" for="c-40213026">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Agree with those saying the landing page needs work.<p>Any &amp; all feedback much appreciated! It&#x27;s basically just a very rough copy of the README at the moment.</div><br/></div></div></div></div><div id="40213688" class="c"><input type="checkbox" id="c-40213688" checked=""/><div class="controls bullet"><span class="by">posix_monad</span><span>|</span><a href="#40212984">prev</a><span>|</span><a href="#40214789">next</a><span>|</span><label class="collapse" for="c-40213688">[-]</label><label class="expand" for="c-40213688">[19 more]</label></div><br/><div class="children"><div class="content">Python seems like a really poor choice for infrastructure.<p>- Python is not easy to build into portable binaries<p>- The package ecosystem is very hard to use in a reproducible way<p>- The language is not truly typed - types add massive value for infrastructure and scripts because they are less likely to be unit-tested<p>- The lack of a &quot;let&quot; or &quot;var&quot; keyword makes simple programming errors more likely (again, this code is less likely to be unit-tested)<p>Maybe I&#x27;m missing something? I don&#x27;t know why I would want to introduce Python in this domain.</div><br/><div id="40214609" class="c"><input type="checkbox" id="c-40214609" checked=""/><div class="controls bullet"><span class="by">DandyDev</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214007">next</a><span>|</span><label class="collapse" for="c-40214609">[-]</label><label class="expand" for="c-40214609">[4 more]</label></div><br/><div class="children"><div class="content">Why is it important to be able to build into portable binaries? Pyinfra doesn&#x27;t require running Python on the machines you manage. Pyinfra basically turns your Python code into shell commands which it runs over SSH. So only your development machine has to run Python.<p>I think there is not a lot of overlap between people who need to automate infrastructure and people who don&#x27;t know how to install Python on their development machine.<p>As for your other comments regarding Python as a language: I mostly agree. I have stepped away from Python as a language to develop production software. In Python I miss the confidence I get from static typing. Having said that, for automating infrastructure, you&#x27;re effectively comparing Pyinfra and Python to bash scripts and YAML (for things like Ansible), which are both orders of magnitude worse if you like static typing or any form of being able to verify what you wrote.</div><br/><div id="40220285" class="c"><input type="checkbox" id="c-40220285" checked=""/><div class="controls bullet"><span class="by">fire_lake</span><span>|</span><a href="#40213688">root</a><span>|</span><a href="#40214609">parent</a><span>|</span><a href="#40218205">next</a><span>|</span><label class="collapse" for="c-40220285">[-]</label><label class="expand" for="c-40220285">[1 more]</label></div><br/><div class="children"><div class="content">&gt; So only your development machine has to run Python.<p>If you have a team of developers and a CI process, then portability is important. There isnât one development machine.</div><br/></div></div><div id="40218205" class="c"><input type="checkbox" id="c-40218205" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#40213688">root</a><span>|</span><a href="#40214609">parent</a><span>|</span><a href="#40220285">prev</a><span>|</span><a href="#40218996">next</a><span>|</span><label class="collapse" for="c-40218205">[-]</label><label class="expand" for="c-40218205">[1 more]</label></div><br/><div class="children"><div class="content">N=1 I&#x27;m <i>capable</i> of handling python on my dev&#x2F;deploy box(es), but that doesn&#x27;t mean it&#x27;s not a pain. In my perfect world, ansible&#x2F;puppet&#x2F;chef&#x2F;whatever would ship as a single static binary even when they mostly ran against remote SSH targets.</div><br/></div></div><div id="40218996" class="c"><input type="checkbox" id="c-40218996" checked=""/><div class="controls bullet"><span class="by">BirAdam</span><span>|</span><a href="#40213688">root</a><span>|</span><a href="#40214609">parent</a><span>|</span><a href="#40218205">prev</a><span>|</span><a href="#40214007">next</a><span>|</span><label class="collapse" for="c-40218996">[-]</label><label class="expand" for="c-40218996">[1 more]</label></div><br/><div class="children"><div class="content">Right, but this makes me wonder why I canât just do: ssh user@host âecho âHello Worldââ<p>All these kinds of tools essentially just executing commands over SSHâ¦ I could just SSH.</div><br/></div></div></div></div><div id="40214007" class="c"><input type="checkbox" id="c-40214007" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214609">prev</a><span>|</span><a href="#40220764">next</a><span>|</span><label class="collapse" for="c-40214007">[-]</label><label class="expand" for="c-40214007">[1 more]</label></div><br/><div class="children"><div class="content">Extremely aware of this (see pyinstaller attempt): <a href="https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;pull&#x2F;768">https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;pull&#x2F;768</a>)<p>I chose Python because itâs what I was writing all day back in 2015. Which makes me realise pyinfra is almost 10!<p>Edit: I mostly write Go or YAML (k8s) these days but Python still makes an appearance from time to time (outside of pyinfra dev).</div><br/></div></div><div id="40220764" class="c"><input type="checkbox" id="c-40220764" checked=""/><div class="controls bullet"><span class="by">goodpoint</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214007">prev</a><span>|</span><a href="#40217148">next</a><span>|</span><label class="collapse" for="c-40220764">[-]</label><label class="expand" for="c-40220764">[1 more]</label></div><br/><div class="children"><div class="content">Python is an excellent choice.<p>&gt; - Python is not easy to build into portable binaries
&gt; - The package ecosystem is very hard to use in a reproducible way<p>People use OS packages since 4 decades.<p>&gt; - The language is not truly typed<p>The language IS strictly typed.<p>&gt; - types add massive value for infrastructure and scripts because they are less likely to be unit-tested<p>99% of errors in deployment are not solved by typing.<p>&gt; - The lack of a &quot;let&quot; or &quot;var&quot; keyword makes simple programming errors more likely (again, this code is less likely to be unit-tested)<p>If your logic is so complex that let&#x2F;var makes a difference you should be not touching infra.</div><br/></div></div><div id="40217148" class="c"><input type="checkbox" id="c-40217148" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40220764">prev</a><span>|</span><a href="#40213822">next</a><span>|</span><label class="collapse" for="c-40217148">[-]</label><label class="expand" for="c-40217148">[2 more]</label></div><br/><div class="children"><div class="content">A decent Python development tool chain handles most of that. Docker, pylint, black, type hints integrated with IDE&#x2F;editor<p>Admittedly some languages like Go do a better job integrating all this into the core of the language. However, Go doesn&#x27;t tend to have as powerful of a stdlib so it tends to be a lot more verbose to achieve the same thing.</div><br/><div id="40220295" class="c"><input type="checkbox" id="c-40220295" checked=""/><div class="controls bullet"><span class="by">fire_lake</span><span>|</span><a href="#40213688">root</a><span>|</span><a href="#40217148">parent</a><span>|</span><a href="#40213822">next</a><span>|</span><label class="collapse" for="c-40220295">[-]</label><label class="expand" for="c-40220295">[1 more]</label></div><br/><div class="children"><div class="content">Docker should not be required for day-to-day development.</div><br/></div></div></div></div><div id="40213822" class="c"><input type="checkbox" id="c-40213822" checked=""/><div class="controls bullet"><span class="by">aprdm</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40217148">prev</a><span>|</span><a href="#40214548">next</a><span>|</span><label class="collapse" for="c-40213822">[-]</label><label class="expand" for="c-40213822">[2 more]</label></div><br/><div class="children"><div class="content">Maybe because Python is already in use by pretty much every company that makes money in this (and others) domain ? Some of what you mention looks like pebkac problems as well.</div><br/><div id="40213966" class="c"><input type="checkbox" id="c-40213966" checked=""/><div class="controls bullet"><span class="by">mhh__</span><span>|</span><a href="#40213688">root</a><span>|</span><a href="#40213822">parent</a><span>|</span><a href="#40214548">next</a><span>|</span><label class="collapse" for="c-40213966">[-]</label><label class="expand" for="c-40213966">[1 more]</label></div><br/><div class="children"><div class="content">Well so is pretty much any configuration language under the sun, and all the other options that aren&#x27;t python.</div><br/></div></div></div></div><div id="40214548" class="c"><input type="checkbox" id="c-40214548" checked=""/><div class="controls bullet"><span class="by">benrutter</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40213822">prev</a><span>|</span><a href="#40215642">next</a><span>|</span><label class="collapse" for="c-40214548">[-]</label><label class="expand" for="c-40214548">[1 more]</label></div><br/><div class="children"><div class="content">I think Go would be a logically choice if you&#x27;re being completely language agnostic, but most teams aren&#x27;t. If teams are working exclusively in python already for web or data projects, there&#x27;s a benefit to not introducing a new language just for architecture deployment if that&#x27;s a small part of a teams function.</div><br/></div></div><div id="40215642" class="c"><input type="checkbox" id="c-40215642" checked=""/><div class="controls bullet"><span class="by">exceptione</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214548">prev</a><span>|</span><a href="#40214444">next</a><span>|</span><label class="collapse" for="c-40215642">[-]</label><label class="expand" for="c-40215642">[1 more]</label></div><br/><div class="children"><div class="content">I 100% agree with your points.<p>No type checking = no serious job. I have learned enough from Ansible to not ever touch that kind of stuff again.<p>There has been a time that Python was a fringe language, only known by some hardcore nerds. I thought Joel Spolsky had once mentioned that having Python on your resume was a signal of a quality developer, someone who went off the beaten path.<p>Times have changed. Python is now the MS Excel for developers. It shines for quick and dirty data mangling. Unfortunately, that is how a seizable portion of people approach software engineering. My theory is that for some having to do abstract thinking and perform a dry analysis beforehand is an impediment. They can only discover what they want while banging out something. They fix the runtime errors they could catch, and slap some more features on top.<p>Types imply a kind of foresight, and that is what some people really have difficulty with.<p>EDIT: Might sound negative, so I admit that the quick feedback cycle you can get from an interpreter language like php&#x2F;python is a feature in itself.</div><br/></div></div><div id="40214444" class="c"><input type="checkbox" id="c-40214444" checked=""/><div class="controls bullet"><span class="by">JoBrad</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40215642">prev</a><span>|</span><a href="#40216136">next</a><span>|</span><label class="collapse" for="c-40214444">[-]</label><label class="expand" for="c-40214444">[1 more]</label></div><br/><div class="children"><div class="content">What would you have used? All of your issues aside, Python is very approachable to people who are used to managing infrastructure but may not have a strong programming background.</div><br/></div></div><div id="40216136" class="c"><input type="checkbox" id="c-40216136" checked=""/><div class="controls bullet"><span class="by">dboreham</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214444">prev</a><span>|</span><a href="#40217529">next</a><span>|</span><label class="collapse" for="c-40216136">[-]</label><label class="expand" for="c-40216136">[1 more]</label></div><br/><div class="children"><div class="content">Shiv is a decent solution for making a portable package. Single file that only depends on a recent system Python being installed.</div><br/></div></div><div id="40217529" class="c"><input type="checkbox" id="c-40217529" checked=""/><div class="controls bullet"><span class="by">mountainriver</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40216136">prev</a><span>|</span><a href="#40214963">next</a><span>|</span><label class="collapse" for="c-40217529">[-]</label><label class="expand" for="c-40217529">[1 more]</label></div><br/><div class="children"><div class="content">Itâs better than Yaml or HCL though</div><br/></div></div><div id="40214963" class="c"><input type="checkbox" id="c-40214963" checked=""/><div class="controls bullet"><span class="by">mixmastamyk</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40217529">prev</a><span>|</span><a href="#40216605">next</a><span>|</span><label class="collapse" for="c-40214963">[-]</label><label class="expand" for="c-40214963">[1 more]</label></div><br/><div class="children"><div class="content">Sounds like you&#x27;ved misjudged the use case.  Tools like this <i>do</i> the deployment, they aren&#x27;t generally deployed themselves.<p>So a portable binary is not a requirement.  Other points like let or types are not an impediment either, there are many quality tools available if you need them (ruff, pyflakes, mypy), and python has been doing this kind of work productively for thirty years now.</div><br/></div></div><div id="40216605" class="c"><input type="checkbox" id="c-40216605" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40214963">prev</a><span>|</span><a href="#40214102">next</a><span>|</span><label class="collapse" for="c-40216605">[-]</label><label class="expand" for="c-40216605">[1 more]</label></div><br/><div class="children"><div class="content">I agree, Python is a pretty bad choice for all the reasons you mentioned.<p>That said I think there are precious few good alternatives. I&#x27;ve been using Deno a fair bit for &quot;scripting&quot; and it works pretty well, but I wish there were more options.<p>Also I have to say if you are using a tool like this to manage thousands of machines you&#x27;re absolutely doing it wrong. I don&#x27;t even work in ops&#x2F;infra but even I know that manually running commands on multiple machines via SSH is asking for trouble.</div><br/></div></div><div id="40214102" class="c"><input type="checkbox" id="c-40214102" checked=""/><div class="controls bullet"><span class="by">bborud</span><span>|</span><a href="#40213688">parent</a><span>|</span><a href="#40216605">prev</a><span>|</span><a href="#40214789">next</a><span>|</span><label class="collapse" for="c-40214102">[-]</label><label class="expand" for="c-40214102">[1 more]</label></div><br/><div class="children"><div class="content">Python is a nightmare when used for tooling. Iâve wasted so much time wrangling Python tooling for embedded development. Go would be a much better choice.</div><br/></div></div></div></div><div id="40214789" class="c"><input type="checkbox" id="c-40214789" checked=""/><div class="controls bullet"><span class="by">pants2</span><span>|</span><a href="#40213688">prev</a><span>|</span><a href="#40220186">next</a><span>|</span><label class="collapse" for="c-40214789">[-]</label><label class="expand" for="c-40214789">[5 more]</label></div><br/><div class="children"><div class="content">This will tie nicely into my favorite way to deploy services these days:<p>1. Use PyInfra to set up Docker and Tailscale on remote hosts and any other setup. Open the Docker port to your Tailnet.<p>2. Use the Docker provider for Terraform to set up and manage containers on those hosts from your dev machine or from a CI&#x2F;CD tool. Tailscale allows containers on different machines to communicate privately, or you can open a port to the web.<p>This makes for such an easy-to-use and bulletproof setup. In the past I would have used Kubernetes but I&#x27;ve come to realize that&#x27;s overkill for anything I do and way harder to debug.</div><br/><div id="40217312" class="c"><input type="checkbox" id="c-40217312" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#40214789">parent</a><span>|</span><a href="#40218844">next</a><span>|</span><label class="collapse" for="c-40217312">[-]</label><label class="expand" for="c-40217312">[1 more]</label></div><br/><div class="children"><div class="content">This kind of setup is a nice improvement over golden images with a lot of the benefits. Application setup, upgrades, and rollback become much easier when the whole app is packaged together and has its own copy of dependencies.<p>You can also throw in systemd units for Docker or Podman. I usually create a small shell script that pulls, removes any old container, then runs a new container with correct args in the foreground and toss that in a simple systemd unit</div><br/></div></div><div id="40218844" class="c"><input type="checkbox" id="c-40218844" checked=""/><div class="controls bullet"><span class="by">udev4096</span><span>|</span><a href="#40214789">parent</a><span>|</span><a href="#40217312">prev</a><span>|</span><a href="#40215034">next</a><span>|</span><label class="collapse" for="c-40218844">[-]</label><label class="expand" for="c-40218844">[1 more]</label></div><br/><div class="children"><div class="content">Why not go for headscale?</div><br/></div></div><div id="40215034" class="c"><input type="checkbox" id="c-40215034" checked=""/><div class="controls bullet"><span class="by">asselinpaul</span><span>|</span><a href="#40214789">parent</a><span>|</span><a href="#40218844">prev</a><span>|</span><a href="#40220186">next</a><span>|</span><label class="collapse" for="c-40215034">[-]</label><label class="expand" for="c-40215034">[2 more]</label></div><br/><div class="children"><div class="content">is there a blog post or github repo with more info on how you do this?</div><br/><div id="40215713" class="c"><input type="checkbox" id="c-40215713" checked=""/><div class="controls bullet"><span class="by">pants2</span><span>|</span><a href="#40214789">root</a><span>|</span><a href="#40215034">parent</a><span>|</span><a href="#40220186">next</a><span>|</span><label class="collapse" for="c-40215713">[-]</label><label class="expand" for="c-40215713">[1 more]</label></div><br/><div class="children"><div class="content">No but I&#x27;ll think about writing one up!</div><br/></div></div></div></div></div></div><div id="40220186" class="c"><input type="checkbox" id="c-40220186" checked=""/><div class="controls bullet"><span class="by">ornornor</span><span>|</span><a href="#40214789">prev</a><span>|</span><a href="#40218145">next</a><span>|</span><label class="collapse" for="c-40220186">[-]</label><label class="expand" for="c-40220186">[1 more]</label></div><br/><div class="children"><div class="content">I use pyinfra through molecule for testing sensible roles, itâs made it possible to have a process resembling TDD and have automated tests for my roles and playbooks. I actually donât know how else to do it than with molecule and pyinfra, being able to have automated tests on ansible âcodeâ made a big difference for me!</div><br/></div></div><div id="40218145" class="c"><input type="checkbox" id="c-40218145" checked=""/><div class="controls bullet"><span class="by">wg0</span><span>|</span><a href="#40220186">prev</a><span>|</span><a href="#40218169">next</a><span>|</span><label class="collapse" for="c-40218145">[-]</label><label class="expand" for="c-40218145">[1 more]</label></div><br/><div class="children"><div class="content">Ansible needs a working Python interpreter on the target machine.<p>Pyifra doesn&#x27;t even need that. Just needs a shell.<p>Subjective opinion but it is heavily under recognized piece of software.<p>Ansible is really great but you soon end up writing Python in Yaml strings.<p>So why not straight up Python?</div><br/></div></div><div id="40218169" class="c"><input type="checkbox" id="c-40218169" checked=""/><div class="controls bullet"><span class="by">mattbillenstein</span><span>|</span><a href="#40218145">prev</a><span>|</span><a href="#40214563">next</a><span>|</span><label class="collapse" for="c-40218169">[-]</label><label class="expand" for="c-40218169">[3 more]</label></div><br/><div class="children"><div class="content">Was there any thought to perhaps do a version with an agent? I really like how fast Saltstack can be as compared to Ansible.<p>I&#x27;ve been using my own homegrown project that does just this - Python roles, server&#x2F;client, Mako templates: <a href="https:&#x2F;&#x2F;github.com&#x2F;mattbillenstein&#x2F;salty">https:&#x2F;&#x2F;github.com&#x2F;mattbillenstein&#x2F;salty</a><p>It&#x27;s very very fast to do deploys on long-lived infrastructure, but it hasn&#x27;t been optimized for large clusters yet; I expect the server process will be a bottleneck with many clients, but still probably faster than Ansible for most setups.</div><br/><div id="40220093" class="c"><input type="checkbox" id="c-40220093" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40218169">parent</a><span>|</span><a href="#40214563">next</a><span>|</span><label class="collapse" for="c-40220093">[-]</label><label class="expand" for="c-40220093">[2 more]</label></div><br/><div class="children"><div class="content">pyinfra supports executing on the local machine (@local connector: <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;2.x&#x2F;connectors&#x2F;local.html" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;2.x&#x2F;connectors&#x2F;local.html</a>). If you store the operation files on the machine thatâs basically an agent when executed just without a periodic check for other changes. Adding a mode to do that in a loop would be pretty trivial..</div><br/><div id="40220734" class="c"><input type="checkbox" id="c-40220734" checked=""/><div class="controls bullet"><span class="by">mattbillenstein</span><span>|</span><a href="#40218169">root</a><span>|</span><a href="#40220093">parent</a><span>|</span><a href="#40214563">next</a><span>|</span><label class="collapse" for="c-40220734">[-]</label><label class="expand" for="c-40220734">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I&#x27;m talking more about RPC - the server sends a command to the agent - the agent does a thing and returns a response. There&#x27;s no external sync of the command and given a long-lived connection - client&#x2F;server what you will - this can all be completed in milliseconds with no new-connection overhead.</div><br/></div></div></div></div></div></div><div id="40214563" class="c"><input type="checkbox" id="c-40214563" checked=""/><div class="controls bullet"><span class="by">rajaravivarma_r</span><span>|</span><a href="#40218169">prev</a><span>|</span><a href="#40212897">next</a><span>|</span><label class="collapse" for="c-40214563">[-]</label><label class="expand" for="c-40214563">[5 more]</label></div><br/><div class="children"><div class="content">This is great. We tried ansible and gave up as it was difficult to keep configuration DRY and annoying to create conditions with no control structure.<p>It was before ansible 2, so probably things are better now.<p>Then we started using Python fabric. Wow it was so freeing. Any helper methods were easily extracted and writing conditions felt natural.<p>Now I am using Python invoke to maintain my local setup.</div><br/><div id="40216711" class="c"><input type="checkbox" id="c-40216711" checked=""/><div class="controls bullet"><span class="by">bityard</span><span>|</span><a href="#40214563">parent</a><span>|</span><a href="#40214603">next</a><span>|</span><label class="collapse" for="c-40216711">[-]</label><label class="expand" for="c-40216711">[2 more]</label></div><br/><div class="children"><div class="content">I gave up being religiously DRY in Ansible playbooks early on. It&#x27;s much easier to open a file and read through a list of simple 2- or 3-line tasks that execute sequentially, than it is to chase down a bunch of imports.<p>Same as in programming, over-adherence to DRY leads to spaghetti code.</div><br/><div id="40220921" class="c"><input type="checkbox" id="c-40220921" checked=""/><div class="controls bullet"><span class="by">rajaravivarma_r</span><span>|</span><a href="#40214563">root</a><span>|</span><a href="#40216711">parent</a><span>|</span><a href="#40214603">next</a><span>|</span><label class="collapse" for="c-40220921">[-]</label><label class="expand" for="c-40220921">[1 more]</label></div><br/><div class="children"><div class="content">I have tried this path of not trying to DRY everything, but has regretted and refactored to a more DRY approach eventually. The cost of remembering to fix&#x2F;alter the logic everywhere is more than trying to keep it DRY. More often a method or a module is enough, nothing fancy.<p>The only place where I have accepted that DRY is not worth it is, unit tests. I used to extract any common behavior in a shared test, but each object will eventually evolve in its own way that the effort to make it DRY will be useless.</div><br/></div></div></div></div><div id="40214603" class="c"><input type="checkbox" id="c-40214603" checked=""/><div class="controls bullet"><span class="by">Izmaki</span><span>|</span><a href="#40214563">parent</a><span>|</span><a href="#40216711">prev</a><span>|</span><a href="#40212897">next</a><span>|</span><label class="collapse" for="c-40214603">[-]</label><label class="expand" for="c-40214603">[2 more]</label></div><br/><div class="children"><div class="content">Ansible is strong when done right. Check out the tutorial series by Jeff Geerling on YouTube, he&#x27;s amazing.</div><br/><div id="40220955" class="c"><input type="checkbox" id="c-40220955" checked=""/><div class="controls bullet"><span class="by">rajaravivarma_r</span><span>|</span><a href="#40214563">root</a><span>|</span><a href="#40214603">parent</a><span>|</span><a href="#40212897">next</a><span>|</span><label class="collapse" for="c-40220955">[-]</label><label class="expand" for="c-40220955">[1 more]</label></div><br/><div class="children"><div class="content">May be, but moving to Python did not take anything away. It brought more joy that you have more control over things like, on which server to run the migration and choose UAT or prod and just a list of servers specified in the command line.<p>And organizing the modules was straight forward as we already knew&#x2F;did that in the project.<p>Perhaps, it comes from my programming background, but its true.</div><br/></div></div></div></div></div></div><div id="40212897" class="c"><input type="checkbox" id="c-40212897" checked=""/><div class="controls bullet"><span class="by">Lucasoato</span><span>|</span><a href="#40214563">prev</a><span>|</span><a href="#40213946">next</a><span>|</span><label class="collapse" for="c-40212897">[-]</label><label class="expand" for="c-40212897">[3 more]</label></div><br/><div class="children"><div class="content">Should this be considered some kind of alternative to tools like Ansible?<p>Also CDKTF should be in the space for imperative infrastructure as code definitions.<p>- <a href="https:&#x2F;&#x2F;developer.hashicorp.com&#x2F;terraform&#x2F;cdktf" rel="nofollow">https:&#x2F;&#x2F;developer.hashicorp.com&#x2F;terraform&#x2F;cdktf</a></div><br/><div id="40213498" class="c"><input type="checkbox" id="c-40213498" checked=""/><div class="controls bullet"><span class="by">slt2021</span><span>|</span><a href="#40212897">parent</a><span>|</span><a href="#40213946">next</a><span>|</span><label class="collapse" for="c-40213498">[-]</label><label class="expand" for="c-40213498">[2 more]</label></div><br/><div class="children"><div class="content">cdktf is fantastic</div><br/><div id="40214626" class="c"><input type="checkbox" id="c-40214626" checked=""/><div class="controls bullet"><span class="by">Lucasoato</span><span>|</span><a href="#40212897">root</a><span>|</span><a href="#40213498">parent</a><span>|</span><a href="#40213946">next</a><span>|</span><label class="collapse" for="c-40214626">[-]</label><label class="expand" for="c-40214626">[1 more]</label></div><br/><div class="children"><div class="content">What languages are you using it with? Last time I tried with python the code was super verbose, type hinting suggestions was not happening, both vs code and pycharmâ¦ can it be linked by the fact itâs transpiled from typescript?</div><br/></div></div></div></div></div></div><div id="40213946" class="c"><input type="checkbox" id="c-40213946" checked=""/><div class="controls bullet"><span class="by">mhh__</span><span>|</span><a href="#40212897">prev</a><span>|</span><a href="#40212026">next</a><span>|</span><label class="collapse" for="c-40213946">[-]</label><label class="expand" for="c-40213946">[5 more]</label></div><br/><div class="children"><div class="content">I worry about using python for this kind of thing.<p>It&#x27;s very hard to be confident about python code.<p>If you have a good code review feedback loop and so on then it can be OK but proper types enable lots of good things when dealing with configuration and state.</div><br/><div id="40214759" class="c"><input type="checkbox" id="c-40214759" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#40213946">parent</a><span>|</span><a href="#40212026">next</a><span>|</span><label class="collapse" for="c-40214759">[-]</label><label class="expand" for="c-40214759">[4 more]</label></div><br/><div class="children"><div class="content">I mean Python has your back with static type hints. While Python&#x27;s type system isn&#x27;t the most powerful in terms of expressiveness -- TypeScript is stronger, Go is weaker, it&#x27;s more than capable enough for a config management system.</div><br/><div id="40215495" class="c"><input type="checkbox" id="c-40215495" checked=""/><div class="controls bullet"><span class="by">mhh__</span><span>|</span><a href="#40213946">root</a><span>|</span><a href="#40214759">parent</a><span>|</span><a href="#40212026">next</a><span>|</span><label class="collapse" for="c-40215495">[-]</label><label class="expand" for="c-40215495">[3 more]</label></div><br/><div class="children"><div class="content">Emphasis on hints.<p>And my point is that it can be way too capable.</div><br/><div id="40215832" class="c"><input type="checkbox" id="c-40215832" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#40213946">root</a><span>|</span><a href="#40215495">parent</a><span>|</span><a href="#40212026">next</a><span>|</span><label class="collapse" for="c-40215832">[-]</label><label class="expand" for="c-40215832">[2 more]</label></div><br/><div class="children"><div class="content">I guess the fact that they&#x27;re hints doesn&#x27;t really bother me when you&#x27;re doing static analysis. You can have strong typing with a weak type system like C and Go where the types will be rigidly enforced but they&#x27;re also not expressive. There end up being lots of things you can&#x27;t express in the type system which leads you to do things like void* or `any` with manual casting.<p>But a fully type-hinted Python codebase is <i>extremely</i> expressive, the times where you have to opt-out of the type system is much much rarer and the types you end up writing  are much more specific so you get stronger guarantees. It&#x27;s not without downsides but I don&#x27;t think it&#x27;s &quot;because they&#x27;re hints you can&#x27;t trust them&quot; since lots of languages erase their types on compilation.</div><br/><div id="40216102" class="c"><input type="checkbox" id="c-40216102" checked=""/><div class="controls bullet"><span class="by">exceptione</span><span>|</span><a href="#40213946">root</a><span>|</span><a href="#40215832">parent</a><span>|</span><a href="#40212026">next</a><span>|</span><label class="collapse" for="c-40216102">[-]</label><label class="expand" for="c-40216102">[1 more]</label></div><br/><div class="children"><div class="content">I am not elbow deep into Python ecosystem, but how many python code bases are fully type-hinted?<p>Maybe I am overlooking because I am not a pythonista, but when looking at this code [1] I see only some superficial hints. Looking at `_make_command`, I need to look inside the body to see that the first argument is expected (?) to be callable (it just ignores otherwise).<p>____<p>1. <a href="https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;blob&#x2F;3.x&#x2F;pyinfra&#x2F;api&#x2F;facts.py">https:&#x2F;&#x2F;github.com&#x2F;pyinfra-dev&#x2F;pyinfra&#x2F;blob&#x2F;3.x&#x2F;pyinfra&#x2F;api&#x2F;...</a></div><br/></div></div></div></div></div></div></div></div></div></div><div id="40212026" class="c"><input type="checkbox" id="c-40212026" checked=""/><div class="controls bullet"><span class="by">manojlds</span><span>|</span><a href="#40213946">prev</a><span>|</span><a href="#40220525">next</a><span>|</span><label class="collapse" for="c-40212026">[-]</label><label class="expand" for="c-40212026">[7 more]</label></div><br/><div class="children"><div class="content">Does it allow me to run a script against an EC2 instance, say, and it spins it up and take care of everything? Something like packer would but without creating an AMI</div><br/><div id="40212766" class="c"><input type="checkbox" id="c-40212766" checked=""/><div class="controls bullet"><span class="by">letmeinhere</span><span>|</span><a href="#40212026">parent</a><span>|</span><a href="#40212807">next</a><span>|</span><label class="collapse" for="c-40212766">[-]</label><label class="expand" for="c-40212766">[3 more]</label></div><br/><div class="children"><div class="content">You ever try cloud-init?<p>You can specify your config in user-data when launching pretty generic AMIs.
 <a href="https:&#x2F;&#x2F;cloudinit.readthedocs.io&#x2F;en&#x2F;latest&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;cloudinit.readthedocs.io&#x2F;en&#x2F;latest&#x2F;index.html</a></div><br/><div id="40214526" class="c"><input type="checkbox" id="c-40214526" checked=""/><div class="controls bullet"><span class="by">manojlds</span><span>|</span><a href="#40212026">root</a><span>|</span><a href="#40212766">parent</a><span>|</span><a href="#40212807">next</a><span>|</span><label class="collapse" for="c-40214526">[-]</label><label class="expand" for="c-40214526">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t want to launch instances (and run a script to set it up etc), I want to run my script THROUGH an instance.</div><br/><div id="40217345" class="c"><input type="checkbox" id="c-40217345" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#40212026">root</a><span>|</span><a href="#40214526">parent</a><span>|</span><a href="#40212807">next</a><span>|</span><label class="collapse" for="c-40217345">[-]</label><label class="expand" for="c-40217345">[1 more]</label></div><br/><div class="children"><div class="content">I made this a while back that utilizes shell script and AWS cli to spin up and cloud init to run things <a href="https:&#x2F;&#x2F;github.com&#x2F;nijave&#x2F;cloud-init-golden-image">https:&#x2F;&#x2F;github.com&#x2F;nijave&#x2F;cloud-init-golden-image</a><p>For this type of use case AWS has managed services like Batch, ECS, or even auto scaling groups that can make this easier depending on what you&#x27;re trying to achieve.<p>ECS with Fargate executors is fairly easy to run arbitrary things inside a VPC</div><br/></div></div></div></div></div></div><div id="40212807" class="c"><input type="checkbox" id="c-40212807" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212026">parent</a><span>|</span><a href="#40212766">prev</a><span>|</span><a href="#40212668">next</a><span>|</span><label class="collapse" for="c-40212807">[-]</label><label class="expand" for="c-40212807">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;d need to create the EC2 instance outside of pyinfra (ie in Terraform). This could be done as part of the inventory itself, but wouldn&#x27;t self-delete afterwards. If using Terraform there&#x27;s a connector that allows you to plug Terraform output as a pyinfra inventory: <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;2.x&#x2F;connectors&#x2F;terraform.html" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;2.x&#x2F;connectors&#x2F;terraform.html</a></div><br/></div></div><div id="40212668" class="c"><input type="checkbox" id="c-40212668" checked=""/><div class="controls bullet"><span class="by">verdverm</span><span>|</span><a href="#40212026">parent</a><span>|</span><a href="#40212807">prev</a><span>|</span><a href="#40220525">next</a><span>|</span><label class="collapse" for="c-40212668">[-]</label><label class="expand" for="c-40212668">[2 more]</label></div><br/><div class="children"><div class="content">fyi, in Packer, there is an option to not create the final image</div><br/><div id="40214534" class="c"><input type="checkbox" id="c-40214534" checked=""/><div class="controls bullet"><span class="by">manojlds</span><span>|</span><a href="#40212026">root</a><span>|</span><a href="#40212668">parent</a><span>|</span><a href="#40220525">next</a><span>|</span><label class="collapse" for="c-40214534">[-]</label><label class="expand" for="c-40214534">[1 more]</label></div><br/><div class="children"><div class="content">Yes! Which is what I am doing now, but was feeling it was using a tool that wasn&#x27;t meant for that job a bit.</div><br/></div></div></div></div></div></div><div id="40220525" class="c"><input type="checkbox" id="c-40220525" checked=""/><div class="controls bullet"><span class="by">lodriv</span><span>|</span><a href="#40212026">prev</a><span>|</span><a href="#40213530">next</a><span>|</span><label class="collapse" for="c-40220525">[-]</label><label class="expand" for="c-40220525">[1 more]</label></div><br/><div class="children"><div class="content">However the email address was not being processed</div><br/></div></div><div id="40213530" class="c"><input type="checkbox" id="c-40213530" checked=""/><div class="controls bullet"><span class="by">godisdad</span><span>|</span><a href="#40220525">prev</a><span>|</span><a href="#40219627">next</a><span>|</span><label class="collapse" for="c-40213530">[-]</label><label class="expand" for="c-40213530">[1 more]</label></div><br/><div class="children"><div class="content">Seems like an interesting generalized mix of something like <a href="https:&#x2F;&#x2F;github.com&#x2F;cloudtools&#x2F;troposphere">https:&#x2F;&#x2F;github.com&#x2F;cloudtools&#x2F;troposphere</a> and Ansible from a glance.<p>The value add would be unifying provisioning and configuration management in a Python-y experience? The lifecycle of each is distinct and that&#x27;s traditionally where the headaches of using a single tool for both has come in</div><br/></div></div><div id="40219627" class="c"><input type="checkbox" id="c-40219627" checked=""/><div class="controls bullet"><span class="by">umen</span><span>|</span><a href="#40213530">prev</a><span>|</span><a href="#40213061">next</a><span>|</span><label class="collapse" for="c-40219627">[-]</label><label class="expand" for="c-40219627">[1 more]</label></div><br/><div class="children"><div class="content">There is need for python module that complies to ansible code</div><br/></div></div><div id="40213061" class="c"><input type="checkbox" id="c-40213061" checked=""/><div class="controls bullet"><span class="by">riffic</span><span>|</span><a href="#40219627">prev</a><span>|</span><a href="#40213062">next</a><span>|</span><label class="collapse" for="c-40213061">[-]</label><label class="expand" for="c-40213061">[1 more]</label></div><br/><div class="children"><div class="content">this feels like Michael DeHaan&#x27;s OpsMop project that existed for like a week before he pulled all the code offline.<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=18717422">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=18717422</a><p>Interesting to see all the Ansible comments here. I&#x27;ll have to check this out asap.</div><br/></div></div><div id="40213062" class="c"><input type="checkbox" id="c-40213062" checked=""/><div class="controls bullet"><span class="by">crispyambulance</span><span>|</span><a href="#40213061">prev</a><span>|</span><a href="#40215879">next</a><span>|</span><label class="collapse" for="c-40213062">[-]</label><label class="expand" for="c-40213062">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, I like this approach.<p>There&#x27;s something about YAML that just sucks the joy out of programming. It seems like a giant step backwards when we have plenty of amazing programming languages in existence.<p>Even when infrastructure yaml like cloudformation are wrapped by some SDK, it can still be a pain because you end up with stuff like...<p><pre><code>    do_something(&quot;___((!-prickly_config_string_::might as well use yaml _blah-blah:blah))&quot;)
</code></pre>
Back in the days of java and xml, there used to be a distant promise of &quot;binding&quot; the xml to code (remember jaxb?) so that you could then just manipulate it fluently as code and then &quot;marshall&quot; it out back to xml when you were done. Those days and that promise are gone, right?</div><br/><div id="40213138" class="c"><input type="checkbox" id="c-40213138" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40213062">parent</a><span>|</span><a href="#40215879">next</a><span>|</span><label class="collapse" for="c-40213138">[-]</label><label class="expand" for="c-40213138">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;aws&#x2F;aws-cdk#at-a-glance">https:&#x2F;&#x2F;github.com&#x2F;aws&#x2F;aws-cdk#at-a-glance</a> is the &quot;generate cloudformation using code,&quot; and is the AWS version of troposphere as best I can tell</div><br/></div></div></div></div><div id="40215879" class="c"><input type="checkbox" id="c-40215879" checked=""/><div class="controls bullet"><span class="by">Feathercrown</span><span>|</span><a href="#40213062">prev</a><span>|</span><a href="#40213268">next</a><span>|</span><label class="collapse" for="c-40215879">[-]</label><label class="expand" for="c-40215879">[1 more]</label></div><br/><div class="children"><div class="content">This is really cool! Kinda seems like the Nix config approach.</div><br/></div></div><div id="40213268" class="c"><input type="checkbox" id="c-40213268" checked=""/><div class="controls bullet"><span class="by">subhro</span><span>|</span><a href="#40215879">prev</a><span>|</span><a href="#40219060">next</a><span>|</span><label class="collapse" for="c-40213268">[-]</label><label class="expand" for="c-40213268">[1 more]</label></div><br/><div class="children"><div class="content">Why does this sound so familiar to Chef?</div><br/></div></div><div id="40219060" class="c"><input type="checkbox" id="c-40219060" checked=""/><div class="controls bullet"><span class="by">beefnugs</span><span>|</span><a href="#40213268">prev</a><span>|</span><a href="#40212008">next</a><span>|</span><label class="collapse" for="c-40219060">[-]</label><label class="expand" for="c-40219060">[1 more]</label></div><br/><div class="children"><div class="content">Does anyone have any info on if saltstack is going to be enshittified? That is the situation that would get me to go looking for a replacement such as this</div><br/></div></div><div id="40215062" class="c"><input type="checkbox" id="c-40215062" checked=""/><div class="controls bullet"><span class="by">mixmastamyk</span><span>|</span><a href="#40212008">prev</a><span>|</span><a href="#40212023">next</a><span>|</span><label class="collapse" for="c-40215062">[-]</label><label class="expand" for="c-40215062">[2 more]</label></div><br/><div class="children"><div class="content">How often is this kind of tool needed since containers went mainstream?  I had gathered they were not used as often any longer.</div><br/><div id="40216910" class="c"><input type="checkbox" id="c-40216910" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40215062">parent</a><span>|</span><a href="#40212023">next</a><span>|</span><label class="collapse" for="c-40216910">[-]</label><label class="expand" for="c-40216910">[1 more]</label></div><br/><div class="children"><div class="content">My experience has been that for day zero stuff, e.g. how do you get a system _prepared_ for containers, this kind of tooling is handy. I side with the sibling comment that cloud-init is The Way but it also requires (a) some trial and error (b) to think entirely in terms of cattle&#x2F;pets which some folks&#x2F;organizations are not there yet</div><br/></div></div></div></div><div id="40212023" class="c"><input type="checkbox" id="c-40212023" checked=""/><div class="controls bullet"><span class="by">emacsen</span><span>|</span><a href="#40215062">prev</a><span>|</span><a href="#40212761">next</a><span>|</span><label class="collapse" for="c-40212023">[-]</label><label class="expand" for="c-40212023">[21 more]</label></div><br/><div class="children"><div class="content">Maybe this is the best thing ever, but the documentation doesn&#x27;t answer one simple question: What problem is it solving?<p>It is a configuration management tool, like Ansible?<p>Is it meant for running one-off commands across the infrastructure, like Salt?<p>It says it integrates with Terraform, so it&#x27;s not a provisioning tool...<p>What does it do different (and presumably better) than other tools?<p>The Getting Started guide doesn&#x27;t cover this.
The FAQ doesn&#x27;t cover this, and the Docs doesn&#x27;t have an Introductory section to cover this.<p>It&#x27;s disheartening to find a potentially interesting project, but not really know what it does and how it might fit in your workflow.</div><br/><div id="40212296" class="c"><input type="checkbox" id="c-40212296" checked=""/><div class="controls bullet"><span class="by">fermigier</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212785">next</a><span>|</span><label class="collapse" for="c-40212296">[-]</label><label class="expand" for="c-40212296">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s similar to Ansible, but uses Python as a declation language rather than YAML.<p>It can also run one-off commands across the infrastructure (like Tentakel: <a href="https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;tentakel&#x2F;" rel="nofollow">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;tentakel&#x2F;</a> ).<p>I&#x27;ve been using Pyinfra for some time. It&#x27;s good enough for me.</div><br/><div id="40212560" class="c"><input type="checkbox" id="c-40212560" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212296">parent</a><span>|</span><a href="#40212785">next</a><span>|</span><label class="collapse" for="c-40212560">[-]</label><label class="expand" for="c-40212560">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using it as well with great success.<p>A couple years ago I inherited about 100 Mac Pros that are part of $dayjob&#x27;s CI infrastructure. They had been managed over the years using a combination of shell scripts, Chef, and manually via VNC. No two machines were alike. The Chef recipes had all bit-rotted and weren&#x27;t usable and due to $reasons were based on an old version of Chef that $company was stuck on.<p>So I looked around for alternatives, and being most comfortable in Python, I explored Ansible, Salt, and Pyinfra.<p>Ansible seemed like the obvious choice, but it has very few playbooks&#x2F;actions for macOS systems. I was going to have to write my own. As I dug into its documentation, I found it was taking me a long time to wrap my head around all that I needed to do and started to sour on its complexity. This is a matter of taste, but I just didn&#x27;t find Ansible very welcoming. I wanted something simpler.<p>I had previously used Fabric, so considered using it again. But Fabric offers too little (it&#x27;s really not much more than parallel ssh-if you want idempotent operations you have to write that yourself), and I don&#x27;t agree with the direction it took with version 2.x.<p>Then I found Pyinfra. It took me less than 30 minutes to understand it in its entirety. It&#x27;s conceptually simple: you have an inventory of machines that it connects to in parallel over ssh. You provide it with a deploy script that combines facts and operations. Pyinfra uses the deploy script to gather facts about each machine, then you use those facts to decide whether you need to perform any operations. It then performs those operations on each machine as needed. The inventory file, deploy script, facts, and operations are trivial to write for someone comfortable with Python. It&#x27;s all Python with the facts and operations being decorated functions. There is no DSL to learn. (It comes with a bunch of pre-written facts and operations, but they are mostly for Linux systems. I had to mostly wrote my own for macOS, but I found them really easy to write.)<p>I had it operational the same day I found it. I used it to successfully get all of the Mac Pros into consistent state: things like system settings, installing Xcode, automating installs of brew packages all at the same version, installing JVMs, updating and upgrading macOS, installing Sentinel One, etc.<p>I&#x27;ve been very happy with it, even contributing a few PRs to fix small bugs and contribute minor functionality.</div><br/><div id="40214086" class="c"><input type="checkbox" id="c-40214086" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212560">parent</a><span>|</span><a href="#40212785">next</a><span>|</span><label class="collapse" for="c-40214086">[-]</label><label class="expand" for="c-40214086">[1 more]</label></div><br/><div class="children"><div class="content">I would love to see any macOS facts&#x2F;operation code if you can&#x2F;would be willing to share! We also managed a bunch of macs using pyinfra but mostly stuck to shell commands.</div><br/></div></div></div></div></div></div><div id="40212785" class="c"><input type="checkbox" id="c-40212785" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212296">prev</a><span>|</span><a href="#40212901">next</a><span>|</span><label class="collapse" for="c-40212785">[-]</label><label class="expand" for="c-40212785">[4 more]</label></div><br/><div class="children"><div class="content">&gt; It is a configuration management tool, like Ansible?<p>Yes<p>&gt; Is it meant for running one-off commands across the infrastructure, like Salt?<p>Also yes.<p>&gt; It says it integrates with Terraform, so it&#x27;s not a provisioning tool...<p>The TF integration is specifically to use TF as an inventory source - ie TF to create resources and pyinfra to then configure them.<p>&gt; What does it do different (and presumably better) than other tools?<p>The homepage covers the highlights, I originally created pyinfra because debugging Ansible was complicated (no plain stderr as not &quot;just&quot; commands on the remote side) and slow, but things have evolved significantly since then.<p>&gt; The Getting Started guide doesn&#x27;t cover this. The FAQ doesn&#x27;t cover this, and the Docs doesn&#x27;t have an Introductory section to cover this.<p>Hugely appreciate this feedback, this is super helpful and something I will attempt to make clearer.<p>---<p>Quick attempt at a better explanation: You write Python code that defines operations (either state &quot;this apt package should be installed&quot; or stateless &quot;run this command&quot;), provide an inventory of targets (SSH, local machine) and pyinfra executes it.<p>Roughly sits where Ansible does for configuring servers, but also solves the case of &quot;how do I run this command across my server fleet&quot; (which I believe Ansible can also do).</div><br/><div id="40214169" class="c"><input type="checkbox" id="c-40214169" checked=""/><div class="controls bullet"><span class="by">emacsen</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212785">parent</a><span>|</span><a href="#40213104">next</a><span>|</span><label class="collapse" for="c-40214169">[-]</label><label class="expand" for="c-40214169">[1 more]</label></div><br/><div class="children"><div class="content">I hope I wasn&#x27;t coming across as too negative.<p>I genuinely think that an introduction with a few user stories would go a long way!</div><br/></div></div><div id="40213104" class="c"><input type="checkbox" id="c-40213104" checked=""/><div class="controls bullet"><span class="by">the_duke</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212785">parent</a><span>|</span><a href="#40214169">prev</a><span>|</span><a href="#40212901">next</a><span>|</span><label class="collapse" for="c-40213104">[-]</label><label class="expand" for="c-40213104">[2 more]</label></div><br/><div class="children"><div class="content">&gt;  and slow, but things have evolved significantly since then<p>Well, Ansible is still dog-slow, so that part has not evolved...</div><br/><div id="40214134" class="c"><input type="checkbox" id="c-40214134" checked=""/><div class="controls bullet"><span class="by">Fizzadar</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40213104">parent</a><span>|</span><a href="#40212901">next</a><span>|</span><label class="collapse" for="c-40214134">[-]</label><label class="expand" for="c-40214134">[1 more]</label></div><br/><div class="children"><div class="content">Heh yeah this is very true, I updated the perf test repo earlier this year to confirm <a href="https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;performance.html" rel="nofollow">https:&#x2F;&#x2F;docs.pyinfra.com&#x2F;en&#x2F;next&#x2F;performance.html</a></div><br/></div></div></div></div></div></div><div id="40212901" class="c"><input type="checkbox" id="c-40212901" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212785">prev</a><span>|</span><a href="#40212710">next</a><span>|</span><label class="collapse" for="c-40212901">[-]</label><label class="expand" for="c-40212901">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Great for ad-hoc command execution, service deployment, configuration management and more<p>I found that pretty clear to be honest.</div><br/></div></div><div id="40212710" class="c"><input type="checkbox" id="c-40212710" checked=""/><div class="controls bullet"><span class="by">dangoodmanUT</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212901">prev</a><span>|</span><a href="#40216287">next</a><span>|</span><label class="collapse" for="c-40212710">[-]</label><label class="expand" for="c-40212710">[1 more]</label></div><br/><div class="children"><div class="content">People will know whether it solves their problem when they see it, no need to akchually the OP or maintainer</div><br/></div></div><div id="40216287" class="c"><input type="checkbox" id="c-40216287" checked=""/><div class="controls bullet"><span class="by">tryauuum</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212710">prev</a><span>|</span><a href="#40212239">next</a><span>|</span><label class="collapse" for="c-40216287">[-]</label><label class="expand" for="c-40216287">[1 more]</label></div><br/><div class="children"><div class="content">Salt is not meant for running one-off commands. You can easily make sure state.apply is run for all of your infra several times an hour</div><br/></div></div><div id="40212239" class="c"><input type="checkbox" id="c-40212239" checked=""/><div class="controls bullet"><span class="by">paulddraper</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40216287">prev</a><span>|</span><a href="#40212691">next</a><span>|</span><label class="collapse" for="c-40212239">[-]</label><label class="expand" for="c-40212239">[8 more]</label></div><br/><div class="children"><div class="content">It&#x27;s like Ansible.<p>That&#x27;s what I discovered by reading the homepage.</div><br/><div id="40212331" class="c"><input type="checkbox" id="c-40212331" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212239">parent</a><span>|</span><a href="#40212284">next</a><span>|</span><label class="collapse" for="c-40212331">[-]</label><label class="expand" for="c-40212331">[6 more]</label></div><br/><div class="children"><div class="content">I would disagree with that since ansible actually does two things simultaneously: <i>cloud</i> provisioning and <i>local</i> provisioning (and that &quot;local&quot; is actually hiding a 3rd axis, actual local, not just local to the managed instance, say for example if you needed the azure libraries or such, you can use a pre_tasks: block to create a virtualenv and install the deps locally before firing up the main workload)<p>Reasonable people can 100% disagree about whether yaml is the correct packaging for those operations, and ansible is a bit too imperative for my liking, but as far as &quot;I have one hammer...&quot; it does all the things</div><br/><div id="40214957" class="c"><input type="checkbox" id="c-40214957" checked=""/><div class="controls bullet"><span class="by">paulddraper</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212331">parent</a><span>|</span><a href="#40212634">next</a><span>|</span><label class="collapse" for="c-40214957">[-]</label><label class="expand" for="c-40214957">[2 more]</label></div><br/><div class="children"><div class="content">Ansible can technically do cloud and local provisioning, just as Terraform can technically do cloud and local.<p>But practically, these tools have their areas of speciality.</div><br/><div id="40215501" class="c"><input type="checkbox" id="c-40215501" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40214957">parent</a><span>|</span><a href="#40212634">next</a><span>|</span><label class="collapse" for="c-40215501">[-]</label><label class="expand" for="c-40215501">[1 more]</label></div><br/><div class="children"><div class="content">&gt; just as Terraform can technically do cloud and local.<p>I feel as though we&#x27;re splitting hairs here, given there is, to the best of my knowledge, no `resource remote_file make_sshd_config { inventory_host = &quot;whatever&quot; dest = &quot;&#x2F;etc&#x2F;sshd_config&quot; src = &quot;.&#x2F;sshd_config.tmpl&quot; vars = {...} }` in TF. There is template, and there is local_exec and the rest is a Simple Matter Of Programming :-&#x2F;<p>I&#x27;m waiting patiently for someone to chime in &quot;well, just spawn ansible in local_exec&quot; as if they&#x27;re missing the point</div><br/></div></div></div></div><div id="40212634" class="c"><input type="checkbox" id="c-40212634" checked=""/><div class="controls bullet"><span class="by">activatedgeek</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212331">parent</a><span>|</span><a href="#40214957">prev</a><span>|</span><a href="#40212284">next</a><span>|</span><label class="collapse" for="c-40212634">[-]</label><label class="expand" for="c-40212634">[3 more]</label></div><br/><div class="children"><div class="content">Any kind of provisioning doesn&#x27;t seem too far a step though. It is just another &quot;operation&quot; with its own state management logic.</div><br/><div id="40212787" class="c"><input type="checkbox" id="c-40212787" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212634">parent</a><span>|</span><a href="#40212284">next</a><span>|</span><label class="collapse" for="c-40212787">[-]</label><label class="expand" for="c-40212787">[2 more]</label></div><br/><div class="children"><div class="content">I mean, I hear you in that python is Turing complete so all things are possible through another level of indirection, but I didn&#x27;t see one shred of amazon.aws.autoscaling_group anywhere in their docs so .. what, I <i>write my own</i>? If I was going to go through the trouble of writing custom shit for Yet Another Awesome Cloud Thingy I&#x27;d fire me</div><br/><div id="40213371" class="c"><input type="checkbox" id="c-40213371" checked=""/><div class="controls bullet"><span class="by">activatedgeek</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212787">parent</a><span>|</span><a href="#40212284">next</a><span>|</span><label class="collapse" for="c-40213371">[-]</label><label class="expand" for="c-40213371">[1 more]</label></div><br/><div class="children"><div class="content">The fact that Pyinfra does not currently support a feature which can be implemented using Pyinfra philosophy does not make it different than Ansible. I believe that was what the parent comment was about.</div><br/></div></div></div></div></div></div></div></div><div id="40212284" class="c"><input type="checkbox" id="c-40212284" checked=""/><div class="controls bullet"><span class="by">emacsen</span><span>|</span><a href="#40212023">root</a><span>|</span><a href="#40212239">parent</a><span>|</span><a href="#40212331">prev</a><span>|</span><a href="#40212691">next</a><span>|</span><label class="collapse" for="c-40212284">[-]</label><label class="expand" for="c-40212284">[1 more]</label></div><br/><div class="children"><div class="content">Digging in the docs, it uses words like &quot;inventories&quot; and &quot;operations&quot; which indeed look like a configuration management system, much like Ansible, it&#x27;s agent-less.<p>And that&#x27;s cool- Ansible is a bit of an oddball system, but then I&#x27;m still left wondering, why is this better, or why it is better for the author at least?<p>I&#x27;ve used cfengine, Puppet, Chef, bcfg2 (briefly) and ansible. I want to know what makes this tool different and better. :)</div><br/></div></div></div></div><div id="40212679" class="c"><input type="checkbox" id="c-40212679" checked=""/><div class="controls bullet"><span class="by">koko-blat</span><span>|</span><a href="#40212023">parent</a><span>|</span><a href="#40212691">prev</a><span>|</span><a href="#40212761">next</a><span>|</span><label class="collapse" for="c-40212679">[-]</label><label class="expand" for="c-40212679">[1 more]</label></div><br/><div class="children"><div class="content">it&#x27;s bc it solves all problem ever exist.</div><br/></div></div></div></div><div id="40212588" class="c"><input type="checkbox" id="c-40212588" checked=""/><div class="controls bullet"><span class="by">Invictus0</span><span>|</span><a href="#40212761">prev</a><span>|</span><a href="#40214189">next</a><span>|</span><label class="collapse" for="c-40212588">[-]</label><label class="expand" for="c-40212588">[2 more]</label></div><br/><div class="children"><div class="content">No one else thinks its weird that this is the number 1 hn link with only 40 upvotes?</div><br/><div id="40213003" class="c"><input type="checkbox" id="c-40213003" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#40212588">parent</a><span>|</span><a href="#40214189">next</a><span>|</span><label class="collapse" for="c-40213003">[-]</label><label class="expand" for="c-40213003">[1 more]</label></div><br/><div class="children"><div class="content">See FAQ #2</div><br/></div></div></div></div><div id="40214189" class="c"><input type="checkbox" id="c-40214189" checked=""/><div class="controls bullet"><span class="by">cheptsov</span><span>|</span><a href="#40212588">prev</a><span>|</span><label class="collapse" for="c-40214189">[-]</label><label class="expand" for="c-40214189">[1 more]</label></div><br/><div class="children"><div class="content">We build a similar tool except we focus on AI workloads. Also support on-prem clusters now in addition to GPU clouds. <a href="https:&#x2F;&#x2F;github.com&#x2F;dstackai&#x2F;dstack">https:&#x2F;&#x2F;github.com&#x2F;dstackai&#x2F;dstack</a></div><br/></div></div></div></div></div></div></div></body></html>