<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1731920460311" as="style"/><link rel="stylesheet" href="styles.css?v=1731920460311"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/oracle/bpftune">Bpftune uses BPF to auto-tune Linux systems</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>BSDobelix</span> | <span>69 comments</span></div><br/><div><div id="42164371" class="c"><input type="checkbox" id="c-42164371" checked=""/><div class="controls bullet"><span class="by">gausswho</span><span>|</span><a href="#42164065">next</a><span>|</span><label class="collapse" for="c-42164371">[-]</label><label class="expand" for="c-42164371">[31 more]</label></div><br/><div class="children"><div class="content">With this tool I am wary that I&#x27;ll encounter system issues that are dramatically more difficult to diagnose and troubleshoot because I&#x27;ll have drifted from a standard distro configuration. And in ways I&#x27;m unaware of. Is this a reasonable hesitation?</div><br/><div id="42164990" class="c"><input type="checkbox" id="c-42164990" checked=""/><div class="controls bullet"><span class="by">Twirrim</span><span>|</span><a href="#42164371">parent</a><span>|</span><a href="#42168400">next</a><span>|</span><label class="collapse" for="c-42164990">[-]</label><label class="expand" for="c-42164990">[1 more]</label></div><br/><div class="children"><div class="content">Disclaimer: I work for Oracle, who publish this tool, though I have nothing to do with the org or engineers that created it<p>I&#x27;ve been running this for a while on my laptop.  So far yet to see any particular weirdness, but also I don&#x27;t know that I can state with any confidence it has a positive impact either.  I&#x27;ve not carried out any benchmarks in either direction.<p>It logs all changes that it&#x27;s going to make including what they were on before.  Here&#x27;s an example from my logs:<p><pre><code>    bpftune[1852994]: Scenario &#x27;need to increase TCP buffer size(s)&#x27; occurred for tunable &#x27;net.ipv4.tcp_rmem&#x27; in global ns. Need to increase buffer size(s) to maximize throughput
    bpftune[1852994]: Due to need to increase max buffer size to maximize throughput change net.ipv4.tcp_rmem(min default max) from (4096 131072 7864320) -&gt; (4096 131072 9830400)</code></pre></div><br/></div></div><div id="42168400" class="c"><input type="checkbox" id="c-42168400" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42164371">parent</a><span>|</span><a href="#42164990">prev</a><span>|</span><a href="#42164481">next</a><span>|</span><label class="collapse" for="c-42168400">[-]</label><label class="expand" for="c-42168400">[7 more]</label></div><br/><div class="children"><div class="content">&quot;because I&#x27;ll have drifted from a standard distro configuration&quot;<p>You will obviously have a change management system which describes all the changes you have made to your putative standard distro configs.  You will also be monitoring those changes.<p>This tool logs all the changes it makes via the standard logging system, which can be easily captured, shipped and aggregated and then queried and reported on.<p>This is not a tool from Clown Cars R US, it&#x27;s from a reasonably reputable source - Oracle (lol etc).  Even better, you can read the code and learn or critique.<p>Not being funny but I&#x27;d rather this sort of thing by far than any amount of wooo handwavy wankery.  Would you prefer openly described and documented or &quot;take our word for it&quot;?</div><br/><div id="42168447" class="c"><input type="checkbox" id="c-42168447" checked=""/><div class="controls bullet"><span class="by">cortesoft</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168400">parent</a><span>|</span><a href="#42164481">next</a><span>|</span><label class="collapse" for="c-42168447">[-]</label><label class="expand" for="c-42168447">[6 more]</label></div><br/><div class="children"><div class="content">&gt; You will obviously have a change management system which describes all the changes you have made to your putative standard distro configs. You will also be monitoring those changes.<p>Which is now a list you will have to check for every issue. I don&#x27;t think they are complaining they don&#x27;t trust the writers of the code, just that it adds confounding variables to your system</div><br/><div id="42168508" class="c"><input type="checkbox" id="c-42168508" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168447">parent</a><span>|</span><a href="#42168577">next</a><span>|</span><label class="collapse" for="c-42168508">[-]</label><label class="expand" for="c-42168508">[4 more]</label></div><br/><div class="children"><div class="content">We (in IT security) are expected to abrogate responsibility to funky AI or whatevs anti virus and other stuff.  Buy and install a security package from ... whoever ... and all will be well.<p>This is an expert system&#x2F;advice run by real people (at a reasonably well respected firm) not an AI wankery thingie.  It is literally expert advice and it is being given away and in code form which you can read.<p>What on earth is wrong with that?</div><br/><div id="42170490" class="c"><input type="checkbox" id="c-42170490" checked=""/><div class="controls bullet"><span class="by">tw04</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168508">parent</a><span>|</span><a href="#42168546">next</a><span>|</span><label class="collapse" for="c-42170490">[-]</label><label class="expand" for="c-42170490">[1 more]</label></div><br/><div class="children"><div class="content">Well two points: Oracle isn’t really and hasn’t really been respected in several decades.<p>Oracle exists for one sole purpose, which is to make Larry money.  Anything they “give away for free” almost always includes a non-obvious catch which you only discover during some future audit.<p>In this case it appears to be gpl and thus most likely harmless.  But I’d expect either the license to change once people are hooked, or some glaring lack of functionality that’s not immediately obvious, that can only be remediated by purchasing a license of some sort.</div><br/></div></div><div id="42168546" class="c"><input type="checkbox" id="c-42168546" checked=""/><div class="controls bullet"><span class="by">cortesoft</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168508">parent</a><span>|</span><a href="#42170490">prev</a><span>|</span><a href="#42168577">next</a><span>|</span><label class="collapse" for="c-42168546">[-]</label><label class="expand" for="c-42168546">[2 more]</label></div><br/><div class="children"><div class="content">If the alternative is those proprietary anti virus products, sure this is better.<p>The original comment was comparing to doing nothing and just using the standard distro, I believe.</div><br/><div id="42168654" class="c"><input type="checkbox" id="c-42168654" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168546">parent</a><span>|</span><a href="#42168577">next</a><span>|</span><label class="collapse" for="c-42168654">[-]</label><label class="expand" for="c-42168654">[1 more]</label></div><br/><div class="children"><div class="content">I do hope I haven&#x27;t offended anyone but I also hope I will leave no one in any doubt that IT security is important.<p>The world is now very highly interconnected.  When I was a child, I would have rubbish conversations over the blower to an aunt in Australia - that latency was well over one second - satellite links.  Nowadays we have direct fibre connections.<p>So, does you does ?</div><br/></div></div></div></div></div></div><div id="42168577" class="c"><input type="checkbox" id="c-42168577" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42168447">parent</a><span>|</span><a href="#42168508">prev</a><span>|</span><a href="#42164481">next</a><span>|</span><label class="collapse" for="c-42168577">[-]</label><label class="expand" for="c-42168577">[1 more]</label></div><br/><div class="children"><div class="content">&gt; for every issue.<p>Only if you don&#x27;t know what you&#x27;re doing, which, with no judgement whatsoever, might be true for OP. Reading the source, it affects some networking related flags. If the local audio craps out, it&#x27;s not related. If the Bluetooth keyboard craps out, it&#x27;s not related. If the hard drive crashes, it&#x27;s not related.<p>I get that is just adding more variables to the system, but this isn&#x27;t Windows, where the changes under the hood are this mystery hotfix that got applied and we have no idea what it did and the vendor notes raise more questions than it asks and your computer working feels like this house of cards that&#x27;s gonna fall over if you look at it funny. If the system is acting funny, just disable this, reset them all back to default, possibly by rebooting, and see if the problem persists. If you&#x27;re technical enough to install this, I don&#x27;t think disabling it and rebooting is beyond your abilities.</div><br/></div></div></div></div></div></div><div id="42164481" class="c"><input type="checkbox" id="c-42164481" checked=""/><div class="controls bullet"><span class="by">pbhjpbhj</span><span>|</span><a href="#42164371">parent</a><span>|</span><a href="#42168400">prev</a><span>|</span><a href="#42164760">next</a><span>|</span><label class="collapse" for="c-42164481">[-]</label><label class="expand" for="c-42164481">[13 more]</label></div><br/><div class="children"><div class="content">&gt;&quot;bpftune logs to syslog so &#x2F;var&#x2F;log&#x2F;messages will contain details of any tuning carried out.&quot; (from OP GitHub readme)<p>The rmem example seems to allay fears that it will make changes one can&#x27;t reverse.</div><br/><div id="42164502" class="c"><input type="checkbox" id="c-42164502" checked=""/><div class="controls bullet"><span class="by">admax88qqq</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164481">parent</a><span>|</span><a href="#42164760">next</a><span>|</span><label class="collapse" for="c-42164502">[-]</label><label class="expand" for="c-42164502">[12 more]</label></div><br/><div class="children"><div class="content">It’s not a questions of being able to reverse. It’s a question of being able to diagnose that one of these changes even was the problem  and if so which one.</div><br/><div id="42166373" class="c"><input type="checkbox" id="c-42166373" checked=""/><div class="controls bullet"><span class="by">pbhjpbhj</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164502">parent</a><span>|</span><a href="#42165004">next</a><span>|</span><label class="collapse" for="c-42166373">[-]</label><label class="expand" for="c-42166373">[1 more]</label></div><br/><div class="children"><div class="content">I focused primarily on guesswho&#x27;s &quot;in ways I am unaware of&quot;.<p>Your issue appears to be true for any system change. Although, risk will of course vary.</div><br/></div></div><div id="42165004" class="c"><input type="checkbox" id="c-42165004" checked=""/><div class="controls bullet"><span class="by">nehal3m</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164502">parent</a><span>|</span><a href="#42166373">prev</a><span>|</span><a href="#42168709">next</a><span>|</span><label class="collapse" for="c-42165004">[-]</label><label class="expand" for="c-42165004">[9 more]</label></div><br/><div class="children"><div class="content">If they can be reversed individually you can simply deduce by rolling back changes one by one, no?</div><br/><div id="42165540" class="c"><input type="checkbox" id="c-42165540" checked=""/><div class="controls bullet"><span class="by">spenczar5</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165004">parent</a><span>|</span><a href="#42165128">next</a><span>|</span><label class="collapse" for="c-42165540">[-]</label><label class="expand" for="c-42165540">[7 more]</label></div><br/><div class="children"><div class="content">Suppose you run a fleet of a thousand machines. They all autotune. They are, lets say, serving cached video, or something.<p>You notice that your aggregate error rate been drifting upwards since using bpftune. It turns out, in reality, there is some complex interaction between the tuning and your routers, or your TOR switches, or whatever - there is feedback that causes oscillations in a tuned value, swinging between too high and too low.<p>Can you see how this is not a matter of simple deduction and rollbacks?<p>This scenario is plausible. Autotuning generally has issues with feedback, since the <i>overall</i> system lacks control theoretic structure. And the premise here is that you use this to tune a large number of machines where individual admin is infeasible.</div><br/><div id="42167792" class="c"><input type="checkbox" id="c-42167792" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165540">parent</a><span>|</span><a href="#42166437">next</a><span>|</span><label class="collapse" for="c-42167792">[-]</label><label class="expand" for="c-42167792">[1 more]</label></div><br/><div class="children"><div class="content">When you have a thousand machines, you can usually get feedback pretty quick, in my experience.<p>Run the tune on one machine. Looks good? Put it on ten. Looks good? Put it on one hundred. Looks good? Put it on everyone.<p>Find an issue a week later, and want to dig into it? Run 100 machines back on the old tune, and 100 machines with half the difference. See what happens.</div><br/></div></div><div id="42166437" class="c"><input type="checkbox" id="c-42166437" checked=""/><div class="controls bullet"><span class="by">pbhjpbhj</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165540">parent</a><span>|</span><a href="#42167792">prev</a><span>|</span><a href="#42166446">next</a><span>|</span><label class="collapse" for="c-42166437">[-]</label><label class="expand" for="c-42166437">[1 more]</label></div><br/><div class="children"><div class="content">&gt;not only can we observe the system and tune appropriately, we can also observe the effect of that tuning and re-tune if necessary. &#x2F;&#x2F;<p>Does sound like a potential way to implement literal chaos.<p>Surely it&#x27;s like anything else, you do pre-release testing and balance the benefits for you against the risks?</div><br/></div></div><div id="42166446" class="c"><input type="checkbox" id="c-42166446" checked=""/><div class="controls bullet"><span class="by">Modified3019</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165540">parent</a><span>|</span><a href="#42166437">prev</a><span>|</span><a href="#42167131">next</a><span>|</span><label class="collapse" for="c-42166446">[-]</label><label class="expand" for="c-42166446">[1 more]</label></div><br/><div class="children"><div class="content">Sounds like you have your answer of “don’t use it” then.</div><br/></div></div><div id="42167131" class="c"><input type="checkbox" id="c-42167131" checked=""/><div class="controls bullet"><span class="by">KennyBlanken</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165540">parent</a><span>|</span><a href="#42166446">prev</a><span>|</span><a href="#42166449">next</a><span>|</span><label class="collapse" for="c-42167131">[-]</label><label class="expand" for="c-42167131">[2 more]</label></div><br/><div class="children"><div class="content">Presumably one would use autotune to find optimized parameters, and then roll those out via change control, either one parameter at a time, or a mix of parameters across the systems.<p>Alternatively: if you have a fleet of thousands of machines you can very easily do a binary search with them to a)establish the problem with the auto-tuner and then b)which of the changes it settled on are causing your problems.<p>I get the impression you&#x27;ve never actually managed a &quot;fleet&quot; of systems, because these techniques would have immediately occurred to you.</div><br/><div id="42167272" class="c"><input type="checkbox" id="c-42167272" checked=""/><div class="controls bullet"><span class="by">spenczar5</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42167131">parent</a><span>|</span><a href="#42166449">next</a><span>|</span><label class="collapse" for="c-42167272">[-]</label><label class="expand" for="c-42167272">[1 more]</label></div><br/><div class="children"><div class="content">Certainly when we managed Twitch’s ~10,000 boxes of video servers, neither of the tasks you describe would have been simple. We underinvested in tools, for sure. Even so, I don’t think you can really argue that dynamically changing configs like this are going to make life easier!</div><br/></div></div></div></div><div id="42166449" class="c"><input type="checkbox" id="c-42166449" checked=""/><div class="controls bullet"><span class="by">pstuart</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165540">parent</a><span>|</span><a href="#42167131">prev</a><span>|</span><a href="#42165128">next</a><span>|</span><label class="collapse" for="c-42166449">[-]</label><label class="expand" for="c-42166449">[1 more]</label></div><br/><div class="children"><div class="content">In that scenario you could run it on a couple servers, compare and contrast, and then apply globally via whatever management tool you use.</div><br/></div></div></div></div><div id="42165128" class="c"><input type="checkbox" id="c-42165128" checked=""/><div class="controls bullet"><span class="by">jstanley</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42165004">parent</a><span>|</span><a href="#42165540">prev</a><span>|</span><a href="#42168709">next</a><span>|</span><label class="collapse" for="c-42165128">[-]</label><label class="expand" for="c-42165128">[1 more]</label></div><br/><div class="children"><div class="content">Only if you already suspect that this tool caused the problem.</div><br/></div></div></div></div><div id="42168709" class="c"><input type="checkbox" id="c-42168709" checked=""/><div class="controls bullet"><span class="by">yourapostasy</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164502">parent</a><span>|</span><a href="#42165004">prev</a><span>|</span><a href="#42164760">next</a><span>|</span><label class="collapse" for="c-42168709">[-]</label><label class="expand" for="c-42168709">[1 more]</label></div><br/><div class="children"><div class="content">Record changes in git and then git bisect issues, maybe?<p>Without change capture, solid regression testing, or observability, it seems difficult to manage these changes. I’d like to how others are managing these kinds of changes to readily troubleshoot them, without lots of regression testing or observability, if anyone has successes to share.</div><br/></div></div></div></div></div></div><div id="42164760" class="c"><input type="checkbox" id="c-42164760" checked=""/><div class="controls bullet"><span class="by">trelliscoded</span><span>|</span><a href="#42164371">parent</a><span>|</span><a href="#42164481">prev</a><span>|</span><a href="#42164533">next</a><span>|</span><label class="collapse" for="c-42164760">[-]</label><label class="expand" for="c-42164760">[1 more]</label></div><br/><div class="children"><div class="content">If your staging doesn’t do capacity checks in excess of what production sees, yes.</div><br/></div></div><div id="42164533" class="c"><input type="checkbox" id="c-42164533" checked=""/><div class="controls bullet"><span class="by">sgarland</span><span>|</span><a href="#42164371">parent</a><span>|</span><a href="#42164760">prev</a><span>|</span><a href="#42164535">next</a><span>|</span><label class="collapse" for="c-42164533">[-]</label><label class="expand" for="c-42164533">[7 more]</label></div><br/><div class="children"><div class="content">Yes, it is. IMO, except for learning (which should not be done in prod), you shouldn’t make changes that you don’t understand.<p>The tools seems to mostly tweak various networking settings. You could set up a test instance with monitoring, throw load at it, and change the parameters the tool modifies (one at a time!) to see how it reacts.</div><br/><div id="42170649" class="c"><input type="checkbox" id="c-42170649" checked=""/><div class="controls bullet"><span class="by">zorked</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164533">parent</a><span>|</span><a href="#42164601">next</a><span>|</span><label class="collapse" for="c-42170649">[-]</label><label class="expand" for="c-42170649">[1 more]</label></div><br/><div class="children"><div class="content">Learning and self-tuning happens everywhere. Cache sizes that adjust to load, pools that grow and shrink, etc. This is just adding autotuning to something that doesn&#x27;t have it. With presumably better algorithms than the rules-of-thumb approach that is more common.<p>It&#x27;s a great idea.</div><br/></div></div><div id="42164601" class="c"><input type="checkbox" id="c-42164601" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164533">parent</a><span>|</span><a href="#42170649">prev</a><span>|</span><a href="#42164535">next</a><span>|</span><label class="collapse" for="c-42164601">[-]</label><label class="expand" for="c-42164601">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;d run such a tool on prod in &quot;advice mode&quot;. It should <i>suggest</i> the tweaks, explaining the reasoning behind them, and listing the actions necessary to implement them.<p>Then humans would decide if they want to implement that as is, partly, modified, or not at all.</div><br/><div id="42166301" class="c"><input type="checkbox" id="c-42166301" checked=""/><div class="controls bullet"><span class="by">bink</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164601">parent</a><span>|</span><a href="#42164659">next</a><span>|</span><label class="collapse" for="c-42166301">[-]</label><label class="expand" for="c-42166301">[1 more]</label></div><br/><div class="children"><div class="content">I agree. There&#x27;s very little need to have a tool automatically changing complex kernel settings on the fly unless your infrastructure is undergoing dramatic changes in load and behavior on a daily basis, which seems unlikely for a modern server.</div><br/></div></div><div id="42164659" class="c"><input type="checkbox" id="c-42164659" checked=""/><div class="controls bullet"><span class="by">sgarland</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164601">parent</a><span>|</span><a href="#42166301">prev</a><span>|</span><a href="#42164535">next</a><span>|</span><label class="collapse" for="c-42164659">[-]</label><label class="expand" for="c-42164659">[3 more]</label></div><br/><div class="children"><div class="content">Fair point, though I didn’t see any such option with this tool.</div><br/><div id="42164688" class="c"><input type="checkbox" id="c-42164688" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164659">parent</a><span>|</span><a href="#42164535">next</a><span>|</span><label class="collapse" for="c-42164688">[-]</label><label class="expand" for="c-42164688">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s developed in the open; we can create  Github issue.<p>Actually <a href="https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;issues&#x2F;99">https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;issues&#x2F;99</a></div><br/><div id="42167417" class="c"><input type="checkbox" id="c-42167417" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#42164371">root</a><span>|</span><a href="#42164688">parent</a><span>|</span><a href="#42164535">next</a><span>|</span><label class="collapse" for="c-42167417">[-]</label><label class="expand" for="c-42167417">[1 more]</label></div><br/><div class="children"><div class="content">In the existing issue, we can link to the code and docs that would need to be understood and changed:<p>usage, main() <a href="https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d889e3a60de6c12feb76&#x2F;src&#x2F;bpftune.c#L280">https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d...</a><p>- [ ] CLI opts: --pretend-allow &lt;tuner&gt; or --log-only-allow &lt;tuner&gt; or [...]<p>Probably relevant function headers in libbpftune.c:<p>bpftune_sysctl_write(<p>bpftuner_tunable_sysctl_write(<p>bpftune_module_load(<p>static void bpftuner_scenario_log(struct bpftuner *tuner, unsigned int tunable, ; <a href="https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d889e3a60de6c12feb76&#x2F;src&#x2F;libbpftune.c#L716">https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d...</a> <a href="https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d889e3a60de6c12feb76&#x2F;src&#x2F;libbpftune.c#L1047">https:&#x2F;&#x2F;github.com&#x2F;oracle&#x2F;bpftune&#x2F;blob&#x2F;6a50f5ff619caeea6f04d...</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="42164065" class="c"><input type="checkbox" id="c-42164065" checked=""/><div class="controls bullet"><span class="by">gmuslera</span><span>|</span><a href="#42164371">prev</a><span>|</span><a href="#42165315">next</a><span>|</span><label class="collapse" for="c-42164065">[-]</label><label class="expand" for="c-42164065">[2 more]</label></div><br/><div class="children"><div class="content">Two words: “feedback loop”.<p>That was the first idea that jumped in when thinking in what could go wrong, not because the Linux kernel, or BPF or this program, just for how it is intended to work. There might be no risk of that happening, there may be controls around that, or if they happen they might only converge to an estable state, but still it is something to have in the map.</div><br/><div id="42164266" class="c"><input type="checkbox" id="c-42164266" checked=""/><div class="controls bullet"><span class="by">marcosdumay</span><span>|</span><a href="#42164065">parent</a><span>|</span><a href="#42165315">next</a><span>|</span><label class="collapse" for="c-42164266">[-]</label><label class="expand" for="c-42164266">[1 more]</label></div><br/><div class="children"><div class="content">&gt; or if they happen they might only converge to an stable state<p>That one will always be dependent on the usage patterns. So the auto-tuner can&#x27;t guarantee it.<p>Also, I imagine the risk of the feedback turning positive is related to the system load (not CPU, but the usage of the resources you are optimizing). If so, it will make your computer less able to manage load. But this can still be useful for optimizing for latency.</div><br/></div></div></div></div><div id="42165315" class="c"><input type="checkbox" id="c-42165315" checked=""/><div class="controls bullet"><span class="by">klysm</span><span>|</span><a href="#42164065">prev</a><span>|</span><a href="#42163717">next</a><span>|</span><label class="collapse" for="c-42165315">[-]</label><label class="expand" for="c-42165315">[1 more]</label></div><br/><div class="children"><div class="content">This seems to step into control theory, which I think is somewhat underapplied in software engineering.</div><br/></div></div><div id="42163717" class="c"><input type="checkbox" id="c-42163717" checked=""/><div class="controls bullet"><span class="by">bloopernova</span><span>|</span><a href="#42165315">prev</a><span>|</span><a href="#42164334">next</a><span>|</span><label class="collapse" for="c-42163717">[-]</label><label class="expand" for="c-42163717">[1 more]</label></div><br/><div class="children"><div class="content">Fascinating!<p>I&#x27;d like to hear from people who are running this. Is it effective? Worth the setup time?</div><br/></div></div><div id="42164334" class="c"><input type="checkbox" id="c-42164334" checked=""/><div class="controls bullet"><span class="by">mrbluecoat</span><span>|</span><a href="#42163717">prev</a><span>|</span><a href="#42163953">next</a><span>|</span><label class="collapse" for="c-42164334">[-]</label><label class="expand" for="c-42164334">[4 more]</label></div><br/><div class="children"><div class="content">&gt; bpftune is designed to be zero configuration; there are no options<p>On behalf of every junior administrator, overworked IT admin, and security-concerned &quot;cattle&quot; wrangler, thank you.<p>Having to learn a thousand+ knobs &amp; dials means most will never be touched. I for one welcome automated assistance in this area, even if the results are imperfect.</div><br/><div id="42164571" class="c"><input type="checkbox" id="c-42164571" checked=""/><div class="controls bullet"><span class="by">sgarland</span><span>|</span><a href="#42164334">parent</a><span>|</span><a href="#42163953">next</a><span>|</span><label class="collapse" for="c-42164571">[-]</label><label class="expand" for="c-42164571">[3 more]</label></div><br/><div class="children"><div class="content">I think it’s still important to know what those dials and knobs do, otherwise (as the currently top-voted comment says) when things break, you’ll be lost.</div><br/><div id="42167575" class="c"><input type="checkbox" id="c-42167575" checked=""/><div class="controls bullet"><span class="by">zymhan</span><span>|</span><a href="#42164334">root</a><span>|</span><a href="#42164571">parent</a><span>|</span><a href="#42163953">next</a><span>|</span><label class="collapse" for="c-42167575">[-]</label><label class="expand" for="c-42167575">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s exactly why it&#x27;s such a burden.</div><br/><div id="42167967" class="c"><input type="checkbox" id="c-42167967" checked=""/><div class="controls bullet"><span class="by">sgarland</span><span>|</span><a href="#42164334">root</a><span>|</span><a href="#42167575">parent</a><span>|</span><a href="#42163953">next</a><span>|</span><label class="collapse" for="c-42167967">[-]</label><label class="expand" for="c-42167967">[1 more]</label></div><br/><div class="children"><div class="content">I continue to be amazed and frustrated that people will simultaneously believe that deeply understanding a programming language is a noble pursuit, but that deeply understanding the software that allows their code to run is somehow burdensome.<p>Ops remains extremely important and extremely real. You can abstract it away in exchange for higher costs and less control, but ultimately someone at some level has studied these parameters, and decided what is best for your code.</div><br/></div></div></div></div></div></div></div></div><div id="42163953" class="c"><input type="checkbox" id="c-42163953" checked=""/><div class="controls bullet"><span class="by">BSDobelix</span><span>|</span><a href="#42164334">prev</a><span>|</span><a href="#42163820">next</a><span>|</span><label class="collapse" for="c-42163953">[-]</label><label class="expand" for="c-42163953">[1 more]</label></div><br/><div class="children"><div class="content">BTW one can use it out of the box with CachyOS.<p>After installation -&gt; CachyOS Hello -&gt; Apps&#x2F;Tweaks</div><br/></div></div><div id="42163820" class="c"><input type="checkbox" id="c-42163820" checked=""/><div class="controls bullet"><span class="by">robinhoodexe</span><span>|</span><a href="#42163953">prev</a><span>|</span><a href="#42164079">next</a><span>|</span><label class="collapse" for="c-42163820">[-]</label><label class="expand" for="c-42163820">[9 more]</label></div><br/><div class="children"><div class="content">Is tuning the TCP buffer size for instance worth it?</div><br/><div id="42167891" class="c"><input type="checkbox" id="c-42167891" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42163899">next</a><span>|</span><label class="collapse" for="c-42167891">[-]</label><label class="expand" for="c-42167891">[1 more]</label></div><br/><div class="children"><div class="content">In my experience running big servers, tuning TCP buffers is definitely worth it, because different kinds of servers have different needs. It doesn&#x27;t often work miracles, but tuning  buffers is low cost, so the potential for a small positive impact is often worth the time to try.<p>If your servers communicate at high datarates with a handful of other servers, some of which are far away, but all of which have large potential throughput, you want big buffers. Big buffers allow you to have a large amount of data in flight to remote systems, which lets you maintain throughput regardless of where your servers are. You&#x27;d know to look at making buffers bigger if your throughput to far away servers is poor.<p>If you&#x27;re providing large numbers of large downloads to public clients that are worldwide from servers in the US only, you probably want smaller buffers. Larger buffers would help with throughput to far away clients, but slow, far away clients will use a lot of buffer space and limit your concurrency. Clients that disappear mid download will tie up buffers until the connection is torn down and it&#x27;s nice if that&#x27;s less memory for each instance. You&#x27;d know to look at making buffers smaller if you&#x27;re using more memory than you think is appropriate for network buffers... a prereq is monitoring memory use by type.<p>If you&#x27;re serving dynamic web pages, you want your tcp buffers to be at least as big as your largest page, so that your dynamic generation never has to block for a slow client. You&#x27;d know to look at this if you see a lot of servers blocked on sending to clients, and&#x2F;or if you see divergent server measured response times for things that should be consistent. This is one case where getting buffer sizes right can enable miracles; Apache pre-fork+mod_PHP can scale amazingly well or amazingly poorly; it scales well when you can use an accept filter so apache doesn&#x27;t get a socket until the request is ready to be read, and PHP&#x2F;apache can send the whole response to the tcp buffer without waiting, then closes the socket; letting the kernel deal with it from there. Keep-alive and TLS make this a bit harder, but the basic idea of having enough room to buffer the whole page still fits.</div><br/></div></div><div id="42163899" class="c"><input type="checkbox" id="c-42163899" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42167891">prev</a><span>|</span><a href="#42166594">next</a><span>|</span><label class="collapse" for="c-42163899">[-]</label><label class="expand" for="c-42163899">[3 more]</label></div><br/><div class="children"><div class="content">It depends. At home - probably not. On a fleet of 2000 machines where you want to keep network utilisation close to 100% with maximal throughput, and the non-optional settings translate to a not-trivial value in $ - yes.</div><br/><div id="42164286" class="c"><input type="checkbox" id="c-42164286" checked=""/><div class="controls bullet"><span class="by">londons_explore</span><span>|</span><a href="#42163820">root</a><span>|</span><a href="#42163899">parent</a><span>|</span><a href="#42166594">next</a><span>|</span><label class="collapse" for="c-42164286">[-]</label><label class="expand" for="c-42164286">[2 more]</label></div><br/><div class="children"><div class="content">TCP parameters are a classic example of where an autotuner might bite you in the ass...<p>Imagine your tuner keeps making the congestion control more aggressive, filling network links up to 99.99% to get more data through...<p>But then any other users of the network see super high latency and packet loss and fail because the tuner isn&#x27;t aware of anything it isn&#x27;t specifically measuring - and it&#x27;s just been told to make this one application run as fast as possible.</div><br/><div id="42167701" class="c"><input type="checkbox" id="c-42167701" checked=""/><div class="controls bullet"><span class="by">withinboredom</span><span>|</span><a href="#42163820">root</a><span>|</span><a href="#42164286">parent</a><span>|</span><a href="#42166594">next</a><span>|</span><label class="collapse" for="c-42167701">[-]</label><label class="expand" for="c-42167701">[1 more]</label></div><br/><div class="children"><div class="content">It literally covers this exact scenario in the readme and explains how it prevents that.</div><br/></div></div></div></div></div></div><div id="42166594" class="c"><input type="checkbox" id="c-42166594" checked=""/><div class="controls bullet"><span class="by">crest</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42163899">prev</a><span>|</span><a href="#42167580">next</a><span>|</span><label class="collapse" for="c-42166594">[-]</label><label class="expand" for="c-42166594">[1 more]</label></div><br/><div class="children"><div class="content">It depends mostly on the bandwidth-delay-product and packet loss you expect on each connection. A there is a vast difference between a local interactive SSH session and downloading a large VM image from across an ocean.</div><br/></div></div><div id="42167580" class="c"><input type="checkbox" id="c-42167580" checked=""/><div class="controls bullet"><span class="by">zymhan</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42166594">prev</a><span>|</span><a href="#42169545">next</a><span>|</span><label class="collapse" for="c-42167580">[-]</label><label class="expand" for="c-42167580">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s not much cost to doing it, so yes.</div><br/></div></div><div id="42169545" class="c"><input type="checkbox" id="c-42169545" checked=""/><div class="controls bullet"><span class="by">arminiusreturns</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42167580">prev</a><span>|</span><a href="#42168594">next</a><span>|</span><label class="collapse" for="c-42169545">[-]</label><label class="expand" for="c-42169545">[1 more]</label></div><br/><div class="children"><div class="content">Worked with Weka to maximize NFSv4&#x2F;mellanox throughput, and it was absolutely required to get targets.</div><br/></div></div><div id="42168594" class="c"><input type="checkbox" id="c-42168594" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#42163820">parent</a><span>|</span><a href="#42169545">prev</a><span>|</span><a href="#42164079">next</a><span>|</span><label class="collapse" for="c-42168594">[-]</label><label class="expand" for="c-42168594">[1 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re on 10 or 100 gig, it&#x27;s almost required to get close to line speed performance.</div><br/></div></div></div></div><div id="42164079" class="c"><input type="checkbox" id="c-42164079" checked=""/><div class="controls bullet"><span class="by">nevon</span><span>|</span><a href="#42163820">prev</a><span>|</span><a href="#42163756">next</a><span>|</span><label class="collapse" for="c-42164079">[-]</label><label class="expand" for="c-42164079">[1 more]</label></div><br/><div class="children"><div class="content">I wonder how effective this would be in multi-tenant environments like shared k8s clusters. On the one hand, each application running will have a different purpose and will move around between nodes over time, but on the other hand there are likely broad similarities between most applications.</div><br/></div></div><div id="42163756" class="c"><input type="checkbox" id="c-42163756" checked=""/><div class="controls bullet"><span class="by">usr1106</span><span>|</span><a href="#42164079">prev</a><span>|</span><a href="#42164013">next</a><span>|</span><label class="collapse" for="c-42163756">[-]</label><label class="expand" for="c-42163756">[10 more]</label></div><br/><div class="children"><div class="content">Interesting. But if tuning parameters to their best values were easy, shouldn&#x27;t the kernel just do that in the first place?</div><br/><div id="42163880" class="c"><input type="checkbox" id="c-42163880" checked=""/><div class="controls bullet"><span class="by">RandomThoughts3</span><span>|</span><a href="#42163756">parent</a><span>|</span><a href="#42164567">next</a><span>|</span><label class="collapse" for="c-42163880">[-]</label><label class="expand" for="c-42163880">[3 more]</label></div><br/><div class="children"><div class="content">I would reverse the question: if it can be done by a BPF module, why should it be in the kernel?<p>Distributions turning it on by default is another story. Maybe it deserves to be shiped on all the time but that&#x27;s not the same thing as being part of the kernel.</div><br/><div id="42164008" class="c"><input type="checkbox" id="c-42164008" checked=""/><div class="controls bullet"><span class="by">jiehong</span><span>|</span><a href="#42163756">root</a><span>|</span><a href="#42163880">parent</a><span>|</span><a href="#42164567">next</a><span>|</span><label class="collapse" for="c-42164008">[-]</label><label class="expand" for="c-42164008">[2 more]</label></div><br/><div class="children"><div class="content">Indeed!<p>The kernel might already be too monolithic.<p>This kernel parameters optimisation reminds me of PGO compilation in programs.<p>Yet, perhaps the kernel could come with multiple defaults config files, each being a good base for different workloads: server, embedded, laptop, mobile, database, router, etc.</div><br/><div id="42166453" class="c"><input type="checkbox" id="c-42166453" checked=""/><div class="controls bullet"><span class="by">6SixTy</span><span>|</span><a href="#42163756">root</a><span>|</span><a href="#42164008">parent</a><span>|</span><a href="#42164567">next</a><span>|</span><label class="collapse" for="c-42166453">[-]</label><label class="expand" for="c-42166453">[1 more]</label></div><br/><div class="children"><div class="content">I second the different profiles for server, laptop, and so on. Though I know the kernel already comes with default configs, so I think there could be room for specialized kernel config options in addition to what&#x27;s already there.<p>Though in my opinion, there&#x27;s already kind of too much segmentation between the different use cases. A server is just a role for a computer, and embedded could literally mean anything. Quite a few WiFi access points come with a USB port on them so you can plug in a USB drive and start a SMB server.</div><br/></div></div></div></div></div></div><div id="42164567" class="c"><input type="checkbox" id="c-42164567" checked=""/><div class="controls bullet"><span class="by">sgarland</span><span>|</span><a href="#42163756">parent</a><span>|</span><a href="#42163880">prev</a><span>|</span><a href="#42167444">next</a><span>|</span><label class="collapse" for="c-42164567">[-]</label><label class="expand" for="c-42164567">[2 more]</label></div><br/><div class="children"><div class="content">I’d rather the kernel present a good-enough but extremely stable set of configs. If I’m using a distro like Arch or Gentoo, then sure, maybe run wild (though both of those would probably assume I’m tuning them anyway), but CentOS, Debian, et al.? Stable and boring. If you change something, you’d better know what it is, and why you’re doing it.</div><br/><div id="42170448" class="c"><input type="checkbox" id="c-42170448" checked=""/><div class="controls bullet"><span class="by">withinboredom</span><span>|</span><a href="#42163756">root</a><span>|</span><a href="#42164567">parent</a><span>|</span><a href="#42167444">next</a><span>|</span><label class="collapse" for="c-42170448">[-]</label><label class="expand" for="c-42170448">[1 more]</label></div><br/><div class="children"><div class="content">These parameters affect things at the hardware level, and in the kernel. There’s “good enough” defaults already, but if you want to take full advantage of your specific hardware, you need to tune it. This is especially important the more different your hardware is from kernel developers’ computers (like 10g nics).</div><br/></div></div></div></div><div id="42167444" class="c"><input type="checkbox" id="c-42167444" checked=""/><div class="controls bullet"><span class="by">LinuxBender</span><span>|</span><a href="#42163756">parent</a><span>|</span><a href="#42164567">prev</a><span>|</span><a href="#42163824">next</a><span>|</span><label class="collapse" for="c-42167444">[-]</label><label class="expand" for="c-42167444">[1 more]</label></div><br/><div class="children"><div class="content">HP-UX and to a lesser degree AIX had some of this.  Instead of just static tunable values there were some tunable formulas exposed to the admin.  If one knew what they were doing they could change the formula as needed without having to recompile the kernel.  I would not mind something like this being exposed from the Linux kernel as tunable options as opposed to just static values.  Such options could reduce the number of companies that need to recompile the kernel.</div><br/></div></div><div id="42163824" class="c"><input type="checkbox" id="c-42163824" checked=""/><div class="controls bullet"><span class="by">onetoo</span><span>|</span><a href="#42163756">parent</a><span>|</span><a href="#42167444">prev</a><span>|</span><a href="#42163778">next</a><span>|</span><label class="collapse" for="c-42163824">[-]</label><label class="expand" for="c-42163824">[1 more]</label></div><br/><div class="children"><div class="content">This doesn&#x27;t necessarily find the <i>best</i> parameters, and it doesn&#x27;t necessarily do it <i>easily</i>. From my reading, it will converge on a local optimum, and it may take some time to do that.<p>In theory, I don&#x27;t see why the kernel couldn&#x27;t have a parameter-auto-tune similar to this. In practice, I think the kernel has to work in so many different domains, it&#x27;d be impossible to land on a &quot;globally good enough&quot; set of tuning heuristics.<p>I&#x27;m far from a kernel developer, so I&#x27;m ready to be corrected here.<p>IMO if we ever see something like this deployed widely, it will be because a popular distribution decided to install it by default.</div><br/></div></div><div id="42163778" class="c"><input type="checkbox" id="c-42163778" checked=""/><div class="controls bullet"><span class="by">nitinreddy88</span><span>|</span><a href="#42163756">parent</a><span>|</span><a href="#42163824">prev</a><span>|</span><a href="#42164013">next</a><span>|</span><label class="collapse" for="c-42163778">[-]</label><label class="expand" for="c-42163778">[2 more]</label></div><br/><div class="children"><div class="content">It depends on workload. This tool generates recommended config for that specific machine workload. App Nodes can have completely different recommendations vs Database Nodes. It will be completely different for Workstation.</div><br/><div id="42163814" class="c"><input type="checkbox" id="c-42163814" checked=""/><div class="controls bullet"><span class="by">usr1106</span><span>|</span><a href="#42163756">root</a><span>|</span><a href="#42163778">parent</a><span>|</span><a href="#42164013">next</a><span>|</span><label class="collapse" for="c-42163814">[-]</label><label class="expand" for="c-42163814">[1 more]</label></div><br/><div class="children"><div class="content">Sure, but the kernel could just do the same. Of course the kernel is already too big. Is BPF the right level to make it more modular? Just thinking, I don&#x27;t think I have the answer.</div><br/></div></div></div></div></div></div><div id="42164013" class="c"><input type="checkbox" id="c-42164013" checked=""/><div class="controls bullet"><span class="by">bastloing</span><span>|</span><a href="#42163756">prev</a><span>|</span><a href="#42168645">next</a><span>|</span><label class="collapse" for="c-42164013">[-]</label><label class="expand" for="c-42164013">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s great how it grew out of simple packet filtering into tracing and monitoring. It&#x27;s one of those great tools most should know. Been using it for years.</div><br/><div id="42166435" class="c"><input type="checkbox" id="c-42166435" checked=""/><div class="controls bullet"><span class="by">orbital-decay</span><span>|</span><a href="#42164013">parent</a><span>|</span><a href="#42168645">next</a><span>|</span><label class="collapse" for="c-42166435">[-]</label><label class="expand" for="c-42166435">[1 more]</label></div><br/><div class="children"><div class="content">The entire modern ML and most of the HPC grew out of very simple programmable shaders in GeForce 3.</div><br/></div></div></div></div><div id="42168645" class="c"><input type="checkbox" id="c-42168645" checked=""/><div class="controls bullet"><span class="by">hrdwdmrbl</span><span>|</span><a href="#42164013">prev</a><span>|</span><a href="#42164470">next</a><span>|</span><label class="collapse" for="c-42168645">[-]</label><label class="expand" for="c-42168645">[1 more]</label></div><br/><div class="children"><div class="content">What is the magnitude of the effect size? The readme provides no information about what kind of results should be expected or might result.</div><br/></div></div><div id="42165865" class="c"><input type="checkbox" id="c-42165865" checked=""/><div class="controls bullet"><span class="by">6SixTy</span><span>|</span><a href="#42164470">prev</a><span>|</span><label class="collapse" for="c-42165865">[-]</label><label class="expand" for="c-42165865">[4 more]</label></div><br/><div class="children"><div class="content">As an insane Gentoo user, sign me the F*** up</div><br/><div id="42168446" class="c"><input type="checkbox" id="c-42168446" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42165865">parent</a><span>|</span><label class="collapse" for="c-42168446">[-]</label><label class="expand" for="c-42168446">[3 more]</label></div><br/><div class="children"><div class="content">You are not insane.  You are running a distro that enables you to patch both the distro package definitions and the source code that is compiled by those definitions.  Then there is the day to day stuff such as USE ...<p>I have a VM that was rather unloved that I ended up using git to go back in time to gradually move it forwards in time and update.  It took quite a while.  It started off life in the noughties and now sports a 6.10 kernel.  I won&#x27;t bore you further but it did take a while but the data is still there and accessible on a modern platform.<p>What is mad about that?</div><br/><div id="42168619" class="c"><input type="checkbox" id="c-42168619" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#42165865">root</a><span>|</span><a href="#42168446">parent</a><span>|</span><label class="collapse" for="c-42168619">[-]</label><label class="expand" for="c-42168619">[2 more]</label></div><br/><div class="children"><div class="content">Back in the day when Gentoo was in favor, USE flags and recompiling the world could make a huge difference in performance on much slower computers with far more limited RAM, and you cloths really see the difference. After waiting week for the world to recompile, that it. These days, unless you&#x27;re, a hyperscaler and need to eke that last 10% of performance our of your hardware, ain&#x27;t nobody got time for that.<p><pre><code>    emerge --update --deep --with-bdeps=y --newuse @world</code></pre></div><br/><div id="42168699" class="c"><input type="checkbox" id="c-42168699" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#42165865">root</a><span>|</span><a href="#42168619">parent</a><span>|</span><label class="collapse" for="c-42168699">[-]</label><label class="expand" for="c-42168699">[1 more]</label></div><br/><div class="children"><div class="content">I was a Gentoo aficionado for quite a while (20+ years).  I&#x27;m going back too (rather slowly)<p>There is a lot of very decent technology in Gentoo - it literally describes what all other distros need to do, in some cases.<p>You mention a week of compilation - I remember the gcc 4 thing too!</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>