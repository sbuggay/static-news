<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1685264459835" as="style"/><link rel="stylesheet" href="styles.css?v=1685264459835"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/apache/lucene/pull/12311">Java Panama Vector API Integrated with Apache Lucene</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>kurhan</span> | <span>11 comments</span></div><br/><div><div id="36098263" class="c"><input type="checkbox" id="c-36098263" checked=""/><div class="controls bullet"><span class="by">srajabi</span><span>|</span><a href="#36099362">next</a><span>|</span><label class="collapse" for="c-36098263">[-]</label><label class="expand" for="c-36098263">[6 more]</label></div><br/><div class="children"><div class="content">A little hard to understand why this is cool, but if I understand correctly:<p>1. Lucene is trying to get Approximate Nearest Neighbours (ANN) search working for semantic search purposes:
<a href="https:&#x2F;&#x2F;issues.apache.org&#x2F;jira&#x2F;browse&#x2F;LUCENE-9004" rel="nofollow">https:&#x2F;&#x2F;issues.apache.org&#x2F;jira&#x2F;browse&#x2F;LUCENE-9004</a>
<a href="https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;lucene&#x2F;issues&#x2F;10047">https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;lucene&#x2F;issues&#x2F;10047</a><p>2. The Panama Vector API allows CPU&#x27;s that support it to accelerate vector operations: <a href="https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;438" rel="nofollow">https:&#x2F;&#x2F;openjdk.org&#x2F;jeps&#x2F;438</a><p>So this allows fast ANN on Lucene for semantic search!<p>How did people do this before Lucene supported it? Only through entirely different tools?</div><br/><div id="36098658" class="c"><input type="checkbox" id="c-36098658" checked=""/><div class="controls bullet"><span class="by">dzaima</span><span>|</span><a href="#36098263">parent</a><span>|</span><a href="#36100691">next</a><span>|</span><label class="collapse" for="c-36098658">[-]</label><label class="expand" for="c-36098658">[4 more]</label></div><br/><div class="children"><div class="content">A little confusing because &quot;vector&quot; here (largely) refers to two different things. &quot;Vector search&quot; being this ANN thing, but the &quot;Vector API&quot; is about SIMD. SIMD provides CPU operations on a bunch of data at a time, i.e. instead of one instruction for each 32-bit float, you operate on, depending on the CPU, 128 or 256 or 512 bits worth of floats at the same time. So, over scalar code, SIMD here could get maybe a 4-16x improvement (give or take <i>a lot</i> - things here are pretty complicated). So, while definitely a significant change, I wouldn&#x27;t say it&#x27;s at the make-or-break level.</div><br/><div id="36099154" class="c"><input type="checkbox" id="c-36099154" checked=""/><div class="controls bullet"><span class="by">gst</span><span>|</span><a href="#36098263">root</a><span>|</span><a href="#36098658">parent</a><span>|</span><a href="#36100472">next</a><span>|</span><label class="collapse" for="c-36099154">[-]</label><label class="expand" for="c-36099154">[1 more]</label></div><br/><div class="children"><div class="content">As add-on to this comment: There&#x27;s another Lucene issue from 2 weeks ago that provides some more details on different approaches that were considered: <a href="https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;lucene&#x2F;issues&#x2F;12302">https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;lucene&#x2F;issues&#x2F;12302</a></div><br/></div></div><div id="36100472" class="c"><input type="checkbox" id="c-36100472" checked=""/><div class="controls bullet"><span class="by">invalidname</span><span>|</span><a href="#36098263">root</a><span>|</span><a href="#36098658">parent</a><span>|</span><a href="#36099154">prev</a><span>|</span><a href="#36099151">next</a><span>|</span><label class="collapse" for="c-36100472">[-]</label><label class="expand" for="c-36100472">[1 more]</label></div><br/><div class="children"><div class="content">Great explanation. But to be clear to those who don&#x27;t follow:<p>SIMD is supported by Java out of the box but the optimizer might miss some opportunities. With this API it is far more likely that SIMD will be used if it&#x27;s available and on first compilation so performance should be improved.</div><br/></div></div></div></div><div id="36100691" class="c"><input type="checkbox" id="c-36100691" checked=""/><div class="controls bullet"><span class="by">itronitron</span><span>|</span><a href="#36098263">parent</a><span>|</span><a href="#36098658">prev</a><span>|</span><a href="#36099362">next</a><span>|</span><label class="collapse" for="c-36100691">[-]</label><label class="expand" for="c-36100691">[1 more]</label></div><br/><div class="children"><div class="content">&gt;&gt; How did people do this before Lucene supported it?<p>By performing query expansion based on features of documents within the search results. Very efficient and effective if you have indexed the right features.</div><br/></div></div></div></div><div id="36099362" class="c"><input type="checkbox" id="c-36099362" checked=""/><div class="controls bullet"><span class="by">softwaredoug</span><span>|</span><a href="#36098263">prev</a><span>|</span><a href="#36101685">next</a><span>|</span><label class="collapse" for="c-36099362">[-]</label><label class="expand" for="c-36099362">[2 more]</label></div><br/><div class="children"><div class="content">This will be a big deal if Lucene got competitive on <a href="http:&#x2F;&#x2F;ann-benchmarks.com" rel="nofollow">http:&#x2F;&#x2F;ann-benchmarks.com</a> if it became a serious alternative (and more holistic) than the vector databases.<p>But it comes with continued challenges if I understand:<p>- Panama is an incubating API and Java has taken its time having an official way of using SIMD. It could all change in Java 22<p>- It only works on Java 20, with a very specific set of flags passed to the JVM. It’ll take time for this change to make it into Elasticsearch and Solr<p>- Panama itself is a weird and very low level API.<p>- Lucene organizes the HNSW vector index graph alongside its inverted index segments. And these need to be merged&#x2F;compacted periodically. Merging HNSW graphs, as I understand it, is computationally difficult as the graph gets rebuilt.</div><br/><div id="36101953" class="c"><input type="checkbox" id="c-36101953" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36099362">parent</a><span>|</span><a href="#36101685">next</a><span>|</span><label class="collapse" for="c-36101953">[-]</label><label class="expand" for="c-36101953">[1 more]</label></div><br/><div class="children"><div class="content">Great if this forces Java upgrades.<p>Using Solr with Java 8 is still quite common.</div><br/></div></div></div></div><div id="36101685" class="c"><input type="checkbox" id="c-36101685" checked=""/><div class="controls bullet"><span class="by">sandGorgon</span><span>|</span><a href="#36099362">prev</a><span>|</span><a href="#36098542">next</a><span>|</span><label class="collapse" for="c-36101685">[-]</label><label class="expand" for="c-36101685">[1 more]</label></div><br/><div class="children"><div class="content">Can someone answer this - today elasticsearch&#x2F;lucene does vector search using HNSWLib.<p>Will this allow lucene to drop hnswlib and get similar performance using native java ?</div><br/></div></div><div id="36098542" class="c"><input type="checkbox" id="c-36098542" checked=""/><div class="controls bullet"><span class="by">jillesvangurp</span><span>|</span><a href="#36101685">prev</a><span>|</span><label class="collapse" for="c-36098542">[-]</label><label class="expand" for="c-36098542">[1 more]</label></div><br/><div class="children"><div class="content">The issue you link to was marked resolved in 2020. That&#x27;s indeed what opensearch and elasticsearch are using. Solr too probably (not sure).</div><br/></div></div></div></div></div></div></div></body></html>