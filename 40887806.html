<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720256449524" as="style"/><link rel="stylesheet" href="styles.css?v=1720256449524"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://benhoyt.com/writings/hash-table-in-c/">How to implement a hash table in C (2021)</a>Â <span class="domain">(<a href="https://benhoyt.com">benhoyt.com</a>)</span></div><div class="subtext"><span>benhoyt</span> | <span>18 comments</span></div><br/><div><div id="40888326" class="c"><input type="checkbox" id="c-40888326" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#40889013">next</a><span>|</span><label class="collapse" for="c-40888326">[-]</label><label class="expand" for="c-40888326">[2 more]</label></div><br/><div class="children"><div class="content">I really like the API design of libjudy for general hash table like interfaces.  It prevents you from having to hash a key twice just to do &quot;check if key is not present,  then set value,  otherwise leave original value in hash.&quot;  The pattern also meshes better with the way iterators naturally work.<p>Also,  in terms of this table,  if you add the computed key hash value to the stored hash entry,  you can check that the value of the hashes match before you do the full strcmp.  If you have a weak hash you might also get a benefit from checking that the first characters match before calling the full strcmp.<p>It would also make rehashing easier since you already have the full key available to you and don&#x27;t have to use your internal set function to move entries into the new table.  In the posted implementation the big-O semantics of a rehash are worst case.<p>Anyways..  &quot;man hsearch.3&quot; if you want something cheap and easy.</div><br/><div id="40889051" class="c"><input type="checkbox" id="c-40889051" checked=""/><div class="controls bullet"><span class="by">shawn_w</span><span>|</span><a href="#40888326">parent</a><span>|</span><a href="#40889013">next</a><span>|</span><label class="collapse" for="c-40889051">[-]</label><label class="expand" for="c-40889051">[1 more]</label></div><br/><div class="children"><div class="content">POSIX hsearch tables are terrible. There&#x27;s a reason why nobody uses them.<p>One at a time per program, having to know how big the table needs to be at initialization time with no automatic resizing, an API that&#x27;s very limited (no way to remove entries, iterate over entries, tell how many entries are in the table, ...)</div><br/></div></div></div></div><div id="40889013" class="c"><input type="checkbox" id="c-40889013" checked=""/><div class="controls bullet"><span class="by">iamevn</span><span>|</span><a href="#40888326">prev</a><span>|</span><a href="#40888481">next</a><span>|</span><label class="collapse" for="c-40889013">[-]</label><label class="expand" for="c-40889013">[1 more]</label></div><br/><div class="children"><div class="content">if (size + size &lt; size) {<p>I know size_t wraps around on overflow so this would actually work, but this still makes me do a double take.</div><br/></div></div><div id="40888481" class="c"><input type="checkbox" id="c-40888481" checked=""/><div class="controls bullet"><span class="by">commandersaki</span><span>|</span><a href="#40889013">prev</a><span>|</span><a href="#40888503">next</a><span>|</span><label class="collapse" for="c-40888481">[-]</label><label class="expand" for="c-40888481">[2 more]</label></div><br/><div class="children"><div class="content">There was a fantastic benchmark of C and C++ hash tables doing the rounds a few weeks ago, it&#x27;s pretty fun reading: <a href="https:&#x2F;&#x2F;jacksonallan.github.io&#x2F;c_cpp_hash_tables_benchmark&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jacksonallan.github.io&#x2F;c_cpp_hash_tables_benchmark&#x2F;</a>.<p>Unless I really didn&#x27;t want to introduce dependencies, or reduce code size, I think I&#x27;d use an off the shelf hash table implementation these days. It&#x27;s still a fun exercise building your own though.</div><br/><div id="40889003" class="c"><input type="checkbox" id="c-40889003" checked=""/><div class="controls bullet"><span class="by">fenesiistvan</span><span>|</span><a href="#40888481">parent</a><span>|</span><a href="#40888503">next</a><span>|</span><label class="collapse" for="c-40889003">[-]</label><label class="expand" for="c-40889003">[1 more]</label></div><br/><div class="children"><div class="content">One important consideration is missing from this benchmark: how they behave with multi-threading. 
There can be big differences between diffent hash table implementation when you have to use them from different threads (built-in smart thread safety vs external dumb locks, etc)</div><br/></div></div></div></div><div id="40888503" class="c"><input type="checkbox" id="c-40888503" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#40888481">prev</a><span>|</span><a href="#40887824">next</a><span>|</span><label class="collapse" for="c-40888503">[-]</label><label class="expand" for="c-40888503">[1 more]</label></div><br/><div class="children"><div class="content">Discussed at the time:<p><i>How to implement a hash table in C</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26590234">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26590234</a> - March 2021 (156 comments)</div><br/></div></div><div id="40887824" class="c"><input type="checkbox" id="c-40887824" checked=""/><div class="controls bullet"><span class="by">MrVandemar</span><span>|</span><a href="#40888503">prev</a><span>|</span><a href="#40888292">next</a><span>|</span><label class="collapse" for="c-40887824">[-]</label><label class="expand" for="c-40887824">[1 more]</label></div><br/><div class="children"><div class="content">Enjoyable article and thorough run through. I didn&#x27;t read all of it, but it really took me back to learning &#x27;C&#x27; in comp sci in the early 90s. Great times.</div><br/></div></div><div id="40888292" class="c"><input type="checkbox" id="c-40888292" checked=""/><div class="controls bullet"><span class="by">suprjami</span><span>|</span><a href="#40887824">prev</a><span>|</span><a href="#40888393">next</a><span>|</span><label class="collapse" for="c-40888292">[-]</label><label class="expand" for="c-40888292">[4 more]</label></div><br/><div class="children"><div class="content">It&#x27;s the ihih guy! Thanks for being one of the few C bloggers out there.</div><br/><div id="40888893" class="c"><input type="checkbox" id="c-40888893" checked=""/><div class="controls bullet"><span class="by">rlinge</span><span>|</span><a href="#40888292">parent</a><span>|</span><a href="#40888864">next</a><span>|</span><label class="collapse" for="c-40888893">[-]</label><label class="expand" for="c-40888893">[1 more]</label></div><br/><div class="children"><div class="content">I started to make some new toys in C too:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;webd90kb&#x2F;webd&#x2F;tree&#x2F;master&#x2F;codes&#x2F;c_project_template">https:&#x2F;&#x2F;github.com&#x2F;webd90kb&#x2F;webd&#x2F;tree&#x2F;master&#x2F;codes&#x2F;c_project...</a><p><a href="https:&#x2F;&#x2F;github.com&#x2F;webd90kb&#x2F;webd&#x2F;tree&#x2F;master&#x2F;codes&#x2F;scripts&#x2F;embed_file_c">https:&#x2F;&#x2F;github.com&#x2F;webd90kb&#x2F;webd&#x2F;tree&#x2F;master&#x2F;codes&#x2F;scripts&#x2F;e...</a></div><br/></div></div><div id="40888864" class="c"><input type="checkbox" id="c-40888864" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#40888292">parent</a><span>|</span><a href="#40888893">prev</a><span>|</span><a href="#40888393">next</a><span>|</span><label class="collapse" for="c-40888864">[-]</label><label class="expand" for="c-40888864">[2 more]</label></div><br/><div class="children"><div class="content">I enjoy reading posts about C just to see how much boilerplate and footguns higher languages let you avoid. I would like to write C, but I just have no trust I would remember or even know how to do things right (use `calloc` vs `malloc`, free the table when allocation of `entries` fails etc).</div><br/><div id="40888993" class="c"><input type="checkbox" id="c-40888993" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#40888292">root</a><span>|</span><a href="#40888864">parent</a><span>|</span><a href="#40888393">next</a><span>|</span><label class="collapse" for="c-40888993">[-]</label><label class="expand" for="c-40888993">[1 more]</label></div><br/><div class="children"><div class="content">The thing about boilerplate is that you were always rewriting it, so avoiding the footguns became habit.<p>(So ... which takes longer, writing the data structure you want, as we all did then, or searching for the perfect library, as some people do now?)<p>EDIT: awk(1) had built-in hash tables, and dates from 1977. Note that generic hashing becomes much more useful after D-space gets larger than 16-64k! (14-16 bits of address)</div><br/></div></div></div></div></div></div><div id="40888393" class="c"><input type="checkbox" id="c-40888393" checked=""/><div class="controls bullet"><span class="by">a-dub</span><span>|</span><a href="#40888292">prev</a><span>|</span><a href="#40888371">next</a><span>|</span><label class="collapse" for="c-40888393">[-]</label><label class="expand" for="c-40888393">[1 more]</label></div><br/><div class="children"><div class="content">might be neat if there were acceleration wins to be had with instructions for computing hash ints from machine ints and strings.<p>or even better, a full fledged linear probing hash lookup instruction.</div><br/></div></div><div id="40888371" class="c"><input type="checkbox" id="c-40888371" checked=""/><div class="controls bullet"><span class="by">timo-e-aus-e</span><span>|</span><a href="#40888393">prev</a><span>|</span><label class="collapse" for="c-40888371">[-]</label><label class="expand" for="c-40888371">[5 more]</label></div><br/><div class="children"><div class="content">I played around with C++ when I was at university. Then never touched it again. So, with a grin I stumble over things like<p>&quot;void* ht_get(...)&quot;<p>Wait. What? A void pointer? Interesting... I have no clue.<p>I like articles like these. For someone not familiar with C it&#x27;s a perfect level. In terms of explanation and the code itself.</div><br/><div id="40888398" class="c"><input type="checkbox" id="c-40888398" checked=""/><div class="controls bullet"><span class="by">floam</span><span>|</span><a href="#40888371">parent</a><span>|</span><a href="#40888639">next</a><span>|</span><label class="collapse" for="c-40888398">[-]</label><label class="expand" for="c-40888398">[3 more]</label></div><br/><div class="children"><div class="content">It has no type, so you can cast it to whatever it actually is. Even a function you will call.<p>The main use case is generic functions. And in data structures like this.</div><br/><div id="40889008" class="c"><input type="checkbox" id="c-40889008" checked=""/><div class="controls bullet"><span class="by">shawn_w</span><span>|</span><a href="#40888371">root</a><span>|</span><a href="#40888398">parent</a><span>|</span><a href="#40888639">next</a><span>|</span><label class="collapse" for="c-40889008">[-]</label><label class="expand" for="c-40889008">[2 more]</label></div><br/><div class="children"><div class="content">Casting between void pointers and function pointers is, strictly speaking, undefined behavior. Though it does tend to work, it&#x27;s not something to rely on.<p>(And you don&#x27;t need casts when converting between void pointers and data pointers)</div><br/><div id="40889110" class="c"><input type="checkbox" id="c-40889110" checked=""/><div class="controls bullet"><span class="by">HexDecOctBin</span><span>|</span><a href="#40888371">root</a><span>|</span><a href="#40889008">parent</a><span>|</span><a href="#40888639">next</a><span>|</span><label class="collapse" for="c-40889110">[-]</label><label class="expand" for="c-40889110">[1 more]</label></div><br/><div class="children"><div class="content">AFAIK it&#x27;s undefined behaviour in ISO C, but not so in POSIX.</div><br/></div></div></div></div></div></div><div id="40888639" class="c"><input type="checkbox" id="c-40888639" checked=""/><div class="controls bullet"><span class="by">unwind</span><span>|</span><a href="#40888371">parent</a><span>|</span><a href="#40888398">prev</a><span>|</span><label class="collapse" for="c-40888639">[-]</label><label class="expand" for="c-40888639">[1 more]</label></div><br/><div class="children"><div class="content">This is a bit of a pet peeve with anonymous Internet writing, but: are we supposed to know when you were at university? Do you know when I was? Why not state something like the number of decades or whatever?<p>And yeah, a void * is how you express pointer to data of unknown type in C.</div><br/></div></div></div></div></div></div></div></div></div></body></html>