<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1702630857248" as="style"/><link rel="stylesheet" href="styles.css?v=1702630857248"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.jez.io/ruby-private/">Ruby&#x27;s private keyword is weird</a> <span class="domain">(<a href="https://blog.jez.io">blog.jez.io</a>)</span></div><div class="subtext"><span>jez</span> | <span>15 comments</span></div><br/><div><div id="38650428" class="c"><input type="checkbox" id="c-38650428" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38650428">[-]</label><label class="expand" for="c-38650428">[7 more]</label></div><br/><div class="children"><div class="content">I’ve only glanced quickly at the article, but I think the author’s understanding of private in Ruby is wrong.<p><pre><code>    class Parent
      attr_accessor :x
      private :x

      def initialize(x)
        self.x = x
        #    └── (1) allowed 
      end

      def ==(other)
        self.x == other.x
        #    │         └── (2) not allowed 
        #    └── (1) allowed 
      end
    end
</code></pre>
This is not doing what the author thinks it is doing. Or, it is, but I don’t think the authors understand why. `private :x` <i>only marks the x method as private</i>, but `x=` is a different method.<p>They would see different behavior with<p><pre><code>    private :x
    private :x=
</code></pre>
In general, public, private, and protected do the following. Public methods can be called with <i>any</i> receiver: explicit (x.foo()), self (self.foo()), or implicit (foo()). Protected methods can be invoked on self or with an implicit receiver. Private methods can only be invoked on an implicit receiver. Note that this has <i>nothing to do</i> with the class hierarchy. A private method can be called from a subclass as long as it has an implicit receiver.<p>The difference between protected and private is not really practically useful, so I personally use them to signal different levels of “private-ness”. I use protected methods to implement a class’ “internal API”, which is the core thing the public API is abstracting and exposing. I use private methods for implementing ancillary details that aren’t really core to what the class does but handle some one-off unrelated data manipulation or munging. But that’s just me.<p>I’ll also admit that something may have changed with Ruby’s rules around these keywords around 3.0 that I missed, so if that’s the case I apologize.</div><br/><div id="38650530" class="c"><input type="checkbox" id="c-38650530" checked=""/><div class="controls bullet"><span class="by">jez</span><span>|</span><a href="#38650428">parent</a><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38650530">[-]</label><label class="expand" for="c-38650530">[6 more]</label></div><br/><div class="children"><div class="content">Sorry, that’s simply a typo translating from Java to Ruby. I believe the point that section is trying to make still holds after editing it to say “private :x, :x=”<p>&gt; Private methods can only be invoked on an implicit receiver.<p>This changed in Ruby 2.7. You can now include the self keyword, which is important because it allows calling methods that share names with Ruby keywords. “begin” is a keyword but “self.begin” is a  call to a method named begin. So if that method happens to be private, you can call it now in Ruby 2.7 without needing “send(:begin)”<p>Other than the typo (thanks! I’ll fix that when I’m back at my computer), I think that the rest of the post underscores what you’ve already pointed out about how private works, modulo the misunderstanding about the changes in Ruby 2.7</div><br/><div id="38651700" class="c"><input type="checkbox" id="c-38651700" checked=""/><div class="controls bullet"><span class="by">djur</span><span>|</span><a href="#38650428">root</a><span>|</span><a href="#38650530">parent</a><span>|</span><a href="#38650882">next</a><span>|</span><label class="collapse" for="c-38651700">[-]</label><label class="expand" for="c-38651700">[1 more]</label></div><br/><div class="children"><div class="content">Along these lines, I have a nit to pick: &quot;private&quot; isn&#x27;t a keyword in Ruby. It&#x27;s just a method on Module.</div><br/></div></div><div id="38650882" class="c"><input type="checkbox" id="c-38650882" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#38650428">root</a><span>|</span><a href="#38650530">parent</a><span>|</span><a href="#38651700">prev</a><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38650882">[-]</label><label class="expand" for="c-38650882">[4 more]</label></div><br/><div class="children"><div class="content">Aha! Glad I caveated things by saying I may have missed a change in semantics. I’m surprised they did that in a minor release and not a major one.<p>So, then, is there no actual difference between private and protected now?</div><br/><div id="38651080" class="c"><input type="checkbox" id="c-38651080" checked=""/><div class="controls bullet"><span class="by">jez</span><span>|</span><a href="#38650428">root</a><span>|</span><a href="#38650882">parent</a><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38651080">[-]</label><label class="expand" for="c-38651080">[3 more]</label></div><br/><div class="children"><div class="content">The difference between private and protected is a bit subtle so I’ll defer to the Ruby FAQ:<p><a href="https:&#x2F;&#x2F;www.ruby-lang.org&#x2F;en&#x2F;documentation&#x2F;faq&#x2F;7&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.ruby-lang.org&#x2F;en&#x2F;documentation&#x2F;faq&#x2F;7&#x2F;</a><p>(On this page there’s a section called “What’s the difference between private and protected?” which explains it.)<p>It’s interesting in its own right, and it’s in my backlog to blog about because I don’t like any of the existing resources contrasting the two.</div><br/><div id="38652037" class="c"><input type="checkbox" id="c-38652037" checked=""/><div class="controls bullet"><span class="by">tsimionescu</span><span>|</span><a href="#38650428">root</a><span>|</span><a href="#38651080">parent</a><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38652037">[-]</label><label class="expand" for="c-38652037">[2 more]</label></div><br/><div class="children"><div class="content">From the examples in this FAQ, it seems like protected works a bit more like Java&#x27;s private - you can use it only inside the class, but for any object of that class, not just self, right? (with the exception that it applies to subclasses)<p>So Ruby&#x27;s private only allows you to interact with other methods on the current object. Protected allows objects of the same class to send each other the message, but not other classes. Would this be a fair summary?</div><br/><div id="38652105" class="c"><input type="checkbox" id="c-38652105" checked=""/><div class="controls bullet"><span class="by">arthurcolle</span><span>|</span><a href="#38650428">root</a><span>|</span><a href="#38652037">parent</a><span>|</span><a href="#38651691">next</a><span>|</span><label class="collapse" for="c-38652105">[-]</label><label class="expand" for="c-38652105">[1 more]</label></div><br/><div class="children"><div class="content">Ruby private literally does nothing. It&#x27;s a marker with some side effects, but isn&#x27;t actually protecting anything. You can trivially do blah.send(:thing) for any method, private or not.<p>Idk it&#x27;s been like a year since I looked at Ruby code, but I&#x27;m pretty sure that&#x27;s the idea.<p>In Ruby, the private keyword is more about controlling the visibility of methods rather than providing strict access control. It&#x27;s a part of Ruby&#x27;s philosophy of &quot;convention over enforcement.&quot; While it does mark methods as private, it doesn&#x27;t prevent you from calling them using .send. This is a design choice in Ruby to prioritize flexibility and programmer discretion.<p>Here&#x27;s a bit more detail on how it works:<p>Method Visibility: When you declare a method as private, you&#x27;re essentially saying that it should only be used within the class where it&#x27;s defined (or its subclasses). This is a way to indicate the intended usage of a method.<p>No Strict Access Control: Unlike some other languages, Ruby doesn&#x27;t enforce strict access control. It trusts the developer to follow conventions. However, this doesn&#x27;t mean you should casually break encapsulation. It&#x27;s a matter of design and discipline.<p>send and public_send: The send method allows you to invoke any method, including private ones, on an object. It&#x27;s a powerful feature that can be handy in some situations but should be used with caution. There&#x27;s also public_send, which respects the visibility rules and won&#x27;t invoke private methods.<p>Here&#x27;s an example:<p><pre><code>    class MyClass
      def public_method
        puts &quot;This is a public method&quot;
      end

      private

      def private_method
        puts &quot;This is a private method&quot;
      end
    end

    obj = MyClass.new
    obj.public_method   # works, prints the string
    obj.private_method  # fails, no method

    irb(main):014:0&gt; obj = MyClass.new
                  =&gt; #&lt;MyClass:0x00000001368fd6d0&gt;
    irb(main):015:0&gt; obj.public_method
                  This is a public method
                  =&gt; nil
    irb(main):016:0&gt; obj.private_method
    Traceback (most recent call last):
            4: from &#x2F;usr&#x2F;bin&#x2F;irb:23:in `&lt;main&gt;&#x27;
            3: from &#x2F;usr&#x2F;bin&#x2F;irb:23:in `load&#x27;
            2: from &#x2F;Library&#x2F;Ruby&#x2F;Gems&#x2F;2.6.0&#x2F;gems&#x2F;irb-1.0.0&#x2F;exe&#x2F;irb:11:in `&lt;top (required)&gt;&#x27;
            1: from (irb):16
    NoMethodError (private method `private_method&#x27; called for #&lt;MyClass:0x00000001368fd6d0&gt;)
        Did you mean?  private_methods
    irb(main):017:0&gt; obj.send(:private_method)
        This is a private method
        =&gt; nil
    irb(main):018:0&gt;</code></pre></div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="38651691" class="c"><input type="checkbox" id="c-38651691" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#38650428">prev</a><span>|</span><a href="#38651857">next</a><span>|</span><label class="collapse" for="c-38651691">[-]</label><label class="expand" for="c-38651691">[2 more]</label></div><br/><div class="children"><div class="content">Some of the reason for Scala having `private[this]` is that it allows an implementation that behaves (and performs) like a Java private field. Scala fields generally aren&#x27;t raw fields at the JVM level (because of Scala&#x27;s &quot;uniform access principle&quot; that `def x` should be accessible like `val x`), but private[this] fields allow the compiler to represent them as raw fields since they really can&#x27;t be accessed elsewhere.<p>The only other thing I&#x27;m aware of being allowed to go in the[] part of a Scala access modifier is a containing package (or object?), which allows you to emulate Java&#x27;s &quot;default&quot; (AKA &quot;package-private&quot;) visibility.</div><br/><div id="38651711" class="c"><input type="checkbox" id="c-38651711" checked=""/><div class="controls bullet"><span class="by">jez</span><span>|</span><a href="#38651691">parent</a><span>|</span><a href="#38651857">next</a><span>|</span><label class="collapse" for="c-38651711">[-]</label><label class="expand" for="c-38651711">[1 more]</label></div><br/><div class="children"><div class="content">That’s cool! Thanks for sharing, I had never considered that aspect of private[this].<p>Mentioned in the article, but it also powers covariant classes. In a language like C# only interfaces can have covariant type parameters, because it wouldn’t be sound to store a value in a (C#) private field if it had a covariant type. This influences a lot of the API design in C# where basically every container  a covariant&#x2F;immutable interface alongside the invariant&#x2F;mutable implementation.<p>(Java gets around this with use site variance annotations which are more flexible but have their own drawbacks).</div><br/></div></div></div></div><div id="38651857" class="c"><input type="checkbox" id="c-38651857" checked=""/><div class="controls bullet"><span class="by">3np</span><span>|</span><a href="#38651691">prev</a><span>|</span><a href="#38650308">next</a><span>|</span><label class="collapse" for="c-38651857">[-]</label><label class="expand" for="c-38651857">[1 more]</label></div><br/><div class="children"><div class="content">&gt; So far, I’m only aware of Ruby’s private modifier and Scala’s protected[this] which behave like this. If you know of any other languages, please email me! I’d love to hear about them.<p>Rerouting throgh comments: Event if it&#x27;s very different, TypeScript&#x27;s private has quite surprising semantics as well...</div><br/></div></div><div id="38650308" class="c"><input type="checkbox" id="c-38650308" checked=""/><div class="controls bullet"><span class="by">LesZedCB</span><span>|</span><a href="#38651857">prev</a><span>|</span><a href="#38651918">next</a><span>|</span><label class="collapse" for="c-38650308">[-]</label><label class="expand" for="c-38650308">[3 more]</label></div><br/><div class="children"><div class="content">yes this makes sense because ruby is a message passing language. even accessors are messages. only self can receive private messages.<p>and the sharing a private instance variable between separate instances example is exactly what protected does, which ruby also has.</div><br/><div id="38650357" class="c"><input type="checkbox" id="c-38650357" checked=""/><div class="controls bullet"><span class="by">caseyohara</span><span>|</span><a href="#38650308">parent</a><span>|</span><a href="#38650597">next</a><span>|</span><label class="collapse" for="c-38650357">[-]</label><label class="expand" for="c-38650357">[1 more]</label></div><br/><div class="children"><div class="content">Exactly. And prior to Ruby 2.7, even calling a private method with an explicit `self` as the receiver was not allowed, only the implicit `self` from &quot;within&quot; the class body (&quot;within&quot; in quotes because, as the blog post points out, Ruby&#x27;s concept of being inside a class body is unlike many other languages).</div><br/></div></div><div id="38650597" class="c"><input type="checkbox" id="c-38650597" checked=""/><div class="controls bullet"><span class="by">jez</span><span>|</span><a href="#38650308">parent</a><span>|</span><a href="#38650357">prev</a><span>|</span><a href="#38651918">next</a><span>|</span><label class="collapse" for="c-38650597">[-]</label><label class="expand" for="c-38650597">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think this has to be the case! I think you could build a different language with the same message passing semantics as Ruby, but with the limitations that classes are not allowed to be re-opened and method definitions must appear syntactically at the top-level of a class (and maybe a few other limitations), and then build something more similar to how `private` works in a traditional, statically-typed language.<p>You definitely don&#x27;t arrive at a language that has all the same feeling of Ruby, but you could still have the &quot;everything is an object, and everything is message passing&quot; character to the language.</div><br/></div></div></div></div><div id="38651918" class="c"><input type="checkbox" id="c-38651918" checked=""/><div class="controls bullet"><span class="by">thayne</span><span>|</span><a href="#38650308">prev</a><span>|</span><label class="collapse" for="c-38651918">[-]</label><label class="expand" for="c-38651918">[1 more]</label></div><br/><div class="children"><div class="content">protected[this] was removed in scala 3[0]. And honestly, I can&#x27;t think of a case where it was really useful.<p>[0]: <a href="https:&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;reference&#x2F;dropped-features&#x2F;this-qualifier.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.scala-lang.org&#x2F;scala3&#x2F;reference&#x2F;dropped-feature...</a></div><br/></div></div></div></div></div></div></div></body></html>