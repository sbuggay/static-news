<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729328451863" as="style"/><link rel="stylesheet" href="styles.css?v=1729328451863"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://zuplo.com/blog/2024/10/10/unlocking-the-power-of-json-patch">JSON Patch</a> <span class="domain">(<a href="https://zuplo.com">zuplo.com</a>)</span></div><div class="subtext"><span>DataOverload</span> | <span>92 comments</span></div><br/><div><div id="41881933" class="c"><input type="checkbox" id="c-41881933" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#41881312">next</a><span>|</span><label class="collapse" for="c-41881933">[-]</label><label class="expand" for="c-41881933">[14 more]</label></div><br/><div class="children"><div class="content">I quite like JSON Patch but I&#x27;ve always felt that it&#x27;s so convoluted only because of its goal of being able to modify every possible JSON document under the sun. If you allow yourself to restrict your data set slightly, you can patch documents much simpler.<p>For example, Firebase doesn&#x27;t let you store null values. Instead, for Firebase, setting something to null means the same as deleting it. With a single simple restriction like that, you can implement PATCH simply by accepting a (recursive) partial object of whatever that endpoint. Eg if &#x2F;books&#x2F;1 has<p><pre><code>    { title: &quot;Dune&quot;, score: 9 }
</code></pre>
you can add a PATCH &#x2F;books&#x2F;1 that takes eg<p><pre><code>    { score: null, author: &quot;Frank Herbert&quot; }
</code></pre>
and the result will be<p><pre><code>    { title: &quot;Dune&quot;, author: &quot;Frank Herbert&quot; }
</code></pre>
This is way simpler than JSON Patch - there&#x27;s nothing new to learn, except &quot;null means delete&quot;. IMO &quot;nothing new to learn&quot; is a fantastic feature for an API to have.<p>Of course, if you can&#x27;t reserve a magic value to mean &quot;delete&quot; then you can&#x27;t do this. Also, appending things to arrays etc can&#x27;t be done elegantly (but partially mutating arrays in PATCH is, I&#x27;d wager, often bad API design anyway). But it solves a very large % of the use cases JSON Patch is designed for in a, in my humble opinion, much more elegant way.</div><br/><div id="41882045" class="c"><input type="checkbox" id="c-41882045" checked=""/><div class="controls bullet"><span class="by">gregwebs</span><span>|</span><a href="#41881933">parent</a><span>|</span><a href="#41886201">next</a><span>|</span><label class="collapse" for="c-41882045">[-]</label><label class="expand" for="c-41882045">[8 more]</label></div><br/><div class="children"><div class="content">The article has a section at the bottom &quot;Alternatives...&quot; [1].
It links to &quot;JSON Merge Patch&quot; which is what you are describing: <a href="https:&#x2F;&#x2F;zuplo.com&#x2F;blog&#x2F;2024&#x2F;10&#x2F;11&#x2F;what-is-json-merge-patch" rel="nofollow">https:&#x2F;&#x2F;zuplo.com&#x2F;blog&#x2F;2024&#x2F;10&#x2F;11&#x2F;what-is-json-merge-patch</a><p>That&#x27;s the format that people tend to naturally use. The main problem is that arrays can only be replaced.<p>[1] <a href="https:&#x2F;&#x2F;zuplo.com&#x2F;blog&#x2F;2024&#x2F;10&#x2F;10&#x2F;unlocking-the-power-of-json-patch#alternatives-to-json-patch" rel="nofollow">https:&#x2F;&#x2F;zuplo.com&#x2F;blog&#x2F;2024&#x2F;10&#x2F;10&#x2F;unlocking-the-power-of-jso...</a></div><br/><div id="41883145" class="c"><input type="checkbox" id="c-41883145" checked=""/><div class="controls bullet"><span class="by">jmull</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41882045">parent</a><span>|</span><a href="#41885477">next</a><span>|</span><label class="collapse" for="c-41883145">[-]</label><label class="expand" for="c-41883145">[3 more]</label></div><br/><div class="children"><div class="content">json merge patch is pretty good. I think it just needs an optional extension to specify an alternative magical value for “delete”. null is a pretty good default, and comports well with typical database patterns, but is outright bad for some things.<p>I think it also needs a “replace” option at the individual object update level. Merge is a good default, but the semantics of the data or a particular update could differ.<p>You’re almost surely doing something wrong if replace doesn’t work for arrays. I think the missing thing is a collection that is both ordered and keyed (often not by the same value). JSON by itself just doesn’t do that.<p>So maybe what’s missing is a general facility for specifying metadata on an update, which can be used to specify the magical delete value, and the key&#x2F;ordering field for keyed, ordered collections.</div><br/><div id="41886076" class="c"><input type="checkbox" id="c-41886076" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41883145">parent</a><span>|</span><a href="#41883299">next</a><span>|</span><label class="collapse" for="c-41886076">[-]</label><label class="expand" for="c-41886076">[1 more]</label></div><br/><div class="children"><div class="content">Once you add all that, it loses &quot;no need to learn something new&quot;. At that point, I think I&#x27;d just go with JSON Patch which solves all of these, and more.</div><br/></div></div><div id="41883299" class="c"><input type="checkbox" id="c-41883299" checked=""/><div class="controls bullet"><span class="by">throwway120385</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41883145">parent</a><span>|</span><a href="#41886076">prev</a><span>|</span><a href="#41885477">next</a><span>|</span><label class="collapse" for="c-41883299">[-]</label><label class="expand" for="c-41883299">[1 more]</label></div><br/><div class="children"><div class="content">&gt; You’re almost surely doing something wrong if replace doesn’t work for arrays. I think the missing thing is a collection that is both ordered and keyed (often not by the same value). JSON by itself just doesn’t do that.<p>Yeah, you could assign an identity value to each element of the array and then use a subresource to manipulate those elements by identity value. Then you could PUT using the same JSON merge mechanism to clear individual fields, and you could DELETE to remove items from the array by subresource.<p>This just seems like a reinvention of a crufty piece of XML.</div><br/></div></div></div></div><div id="41885477" class="c"><input type="checkbox" id="c-41885477" checked=""/><div class="controls bullet"><span class="by">gleenn</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41882045">parent</a><span>|</span><a href="#41883145">prev</a><span>|</span><a href="#41882087">next</a><span>|</span><label class="collapse" for="c-41885477">[-]</label><label class="expand" for="c-41885477">[1 more]</label></div><br/><div class="children"><div class="content">What if you represented arrays as recursively nested triples like &#x27;(1 2 3 4 5) as [[1 null 2] 3 [4 null 5]]. Then you could parch the tree of triples much more succinctly. You might have to disallow nested arrays but this would as bad a restriction as disallowing nulls as map values. You could append and delete array indexes better. Or maybe make it an 8-way tree like Clojure does for its vector representation to condense the patch further.</div><br/></div></div><div id="41882087" class="c"><input type="checkbox" id="c-41882087" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41882045">parent</a><span>|</span><a href="#41885477">prev</a><span>|</span><a href="#41882187">next</a><span>|</span><label class="collapse" for="c-41882087">[-]</label><label class="expand" for="c-41882087">[2 more]</label></div><br/><div class="children"><div class="content">Nice! I gotta say I didn&#x27;t expect a thing called &quot;JSON Merge Patch&quot; to be simpler and more concise than a thing called &quot;JSON Patch&quot; :-)</div><br/><div id="41882397" class="c"><input type="checkbox" id="c-41882397" checked=""/><div class="controls bullet"><span class="by">DataOverload</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41882087">parent</a><span>|</span><a href="#41882187">next</a><span>|</span><label class="collapse" for="c-41882397">[-]</label><label class="expand" for="c-41882397">[1 more]</label></div><br/><div class="children"><div class="content">Same here, I actually made a tool for this called www.jsonmergepatch.com - give it a try</div><br/></div></div></div></div><div id="41882187" class="c"><input type="checkbox" id="c-41882187" checked=""/><div class="controls bullet"><span class="by">gitaarik</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41882045">parent</a><span>|</span><a href="#41882087">prev</a><span>|</span><a href="#41886201">next</a><span>|</span><label class="collapse" for="c-41882187">[-]</label><label class="expand" for="c-41882187">[1 more]</label></div><br/><div class="children"><div class="content">Also the first thing I was thinking. The only reason I can see for using JSON Patch is for updating huge arrays. But I never really had such big arrays that I felt the necessity for something like this.</div><br/></div></div></div></div><div id="41886201" class="c"><input type="checkbox" id="c-41886201" checked=""/><div class="controls bullet"><span class="by">_kidlike</span><span>|</span><a href="#41881933">parent</a><span>|</span><a href="#41882045">prev</a><span>|</span><a href="#41882475">next</a><span>|</span><label class="collapse" for="c-41886201">[-]</label><label class="expand" for="c-41886201">[1 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t this just application&#x2F;merge-patch+json?<p>(RFC 7396)</div><br/></div></div><div id="41882475" class="c"><input type="checkbox" id="c-41882475" checked=""/><div class="controls bullet"><span class="by">enragedcacti</span><span>|</span><a href="#41881933">parent</a><span>|</span><a href="#41886201">prev</a><span>|</span><a href="#41883360">next</a><span>|</span><label class="collapse" for="c-41882475">[-]</label><label class="expand" for="c-41882475">[1 more]</label></div><br/><div class="children"><div class="content">I wonder if adding a merge op would be a viable option e.g.:<p><pre><code>    { &quot;op&quot;: &quot;merge&quot;, &quot;path&quot;: &quot;&#x2F;&quot;, &quot;value&quot;: { &quot;score&quot;: null, &quot;author&quot;: &quot;Frank Herbert&quot; } }
</code></pre>
It&#x27;s kind of nice to retain the terse and intuitive format while also gaining features like &quot;test&quot; and explicit nulls. It&#x27;s of course not spec compliant anymore but for standard JSON Patch APIs the client could implement a simple Merge Patch-&gt;Patch compiler.</div><br/></div></div><div id="41883360" class="c"><input type="checkbox" id="c-41883360" checked=""/><div class="controls bullet"><span class="by">dap</span><span>|</span><a href="#41881933">parent</a><span>|</span><a href="#41882475">prev</a><span>|</span><a href="#41881312">next</a><span>|</span><label class="collapse" for="c-41883360">[-]</label><label class="expand" for="c-41883360">[3 more]</label></div><br/><div class="children"><div class="content">&gt; I quite like JSON Patch but I&#x27;ve always felt that it&#x27;s so convoluted only because of its goal of being able to modify every possible JSON document under the sun.<p>It seems like this is mainly a problem if you&#x27;re implementing this _ad hoc_ on the client or server side -- is that right?<p>I mean: presumably most of the time that you want to either of these, you already have both the old and new object, right?  Is it not straightforward to write a function (or library) that takes two plain objects and generates the JSON Patch from one to the other, and then use that everywhere and not think about this (but retain the advantage of &quot;being able to modify every possible JSON document under the sun&quot;).<p>If there are cases where you&#x27;re making a delta without the original object (i.e., I know I always want to remove one field and add some other, whatever the original state was), it seems like you could have nice helpers like `JsonPatch::new().remove_field(&#x27;field1&#x27;).add_field(&#x27;field2&#x27;, value)`.<p>I haven&#x27;t actually done this so maybe I&#x27;m missing something about how you want to use these things in practice?<p>edit to add my motivation: I&#x27;d much rather having something robust and predictable, even if it means writing tooling to make it convenient, than something that _seems_ easy but then can&#x27;t handle some cases or does something different than expected (&quot;I wanted this to be null, not gone!&quot;).</div><br/><div id="41886066" class="c"><input type="checkbox" id="c-41886066" checked=""/><div class="controls bullet"><span class="by">skrebbel</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41883360">parent</a><span>|</span><a href="#41883679">next</a><span>|</span><label class="collapse" for="c-41886066">[-]</label><label class="expand" for="c-41886066">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I mean: presumably most of the time that you want to either of these, you already have both the old and new object, right?<p>Hm, maybe? I&#x27;m thinking about this from the perspective API design, eg for REST APIs, JavaScript modules etc. How to let users change a single field in an object, and leave the rest alone? Like set the subject of a conversation? JSON Patch lets you do that, and so does this. And whether you have the target object already is kind of.. maybe? Sometimes? I wouldn&#x27;t make that assumption tbh.</div><br/></div></div><div id="41883679" class="c"><input type="checkbox" id="c-41883679" checked=""/><div class="controls bullet"><span class="by">crabmusket</span><span>|</span><a href="#41881933">root</a><span>|</span><a href="#41883360">parent</a><span>|</span><a href="#41886066">prev</a><span>|</span><a href="#41881312">next</a><span>|</span><label class="collapse" for="c-41883679">[-]</label><label class="expand" for="c-41883679">[1 more]</label></div><br/><div class="children"><div class="content">Immer can generate patches from your changes: <a href="https:&#x2F;&#x2F;immerjs.github.io&#x2F;immer&#x2F;patches" rel="nofollow">https:&#x2F;&#x2F;immerjs.github.io&#x2F;immer&#x2F;patches</a><p>I think I&#x27;ve seen this in other libraries too but I forget which.</div><br/></div></div></div></div></div></div><div id="41881312" class="c"><input type="checkbox" id="c-41881312" checked=""/><div class="controls bullet"><span class="by">bsimpson</span><span>|</span><a href="#41881933">prev</a><span>|</span><a href="#41886228">next</a><span>|</span><label class="collapse" for="c-41881312">[-]</label><label class="expand" for="c-41881312">[24 more]</label></div><br/><div class="children"><div class="content">`&#x2F;` is a weird choice of delimiter for JSON.<p>Since JSON is a subset of JS, I would have expected `.` to be the delimiter.  That jives with how people think of JSON structures in code.  (Python does require bracket syntax for traversing JSON, but even pandas uses dots when you generate a dataframe from JSON.)<p>When I see `&#x2F;`, I think:<p>- &quot;This spec must have been written by backend people,&quot; and<p>- &quot;I wonder if there&#x27;s some relative&#x2F;absolute path ambiguity they&#x27;re trying to solve by making all the paths URLs.&quot;</div><br/><div id="41883342" class="c"><input type="checkbox" id="c-41883342" checked=""/><div class="controls bullet"><span class="by">svckr</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41883303">next</a><span>|</span><label class="collapse" for="c-41883342">[-]</label><label class="expand" for="c-41883342">[2 more]</label></div><br/><div class="children"><div class="content">You&#x27;re not the only one who thinks that!<p>JSON Patch uses JSON Pointer (RFC 6901) to address elements, but another method from (very) roughly same time is JSON Path [0] (RFC 9535) and here&#x27;s one of my favorite mnemonics:<p>- JSON Path uses &quot;points&quot; between elements<p>- JSON Pointer uses &quot;path separators&quot; between elements<p>[0] <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;JSONPath" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;JSONPath</a></div><br/><div id="41885595" class="c"><input type="checkbox" id="c-41885595" checked=""/><div class="controls bullet"><span class="by">tyre</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41883342">parent</a><span>|</span><a href="#41883303">next</a><span>|</span><label class="collapse" for="c-41885595">[-]</label><label class="expand" for="c-41885595">[1 more]</label></div><br/><div class="children"><div class="content">and json path is supported in Postgres as a way to query json documents. It’s surprisingly full featured!</div><br/></div></div></div></div><div id="41883303" class="c"><input type="checkbox" id="c-41883303" checked=""/><div class="controls bullet"><span class="by">ks2048</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41883342">prev</a><span>|</span><a href="#41881615">next</a><span>|</span><label class="collapse" for="c-41883303">[-]</label><label class="expand" for="c-41883303">[2 more]</label></div><br/><div class="children"><div class="content">I agree &quot;.&quot; would make more sense than &quot;&#x2F;&quot;.<p>I actually think an array would be better, [&quot;foo&quot;,&quot;bar&quot;] for &quot;foo.bar&quot;. How many many bugs are introduced by people not escaping properly?  It&#x27;s more verbose, but judging by the rest of the standard, they don&#x27;t seem to be emphasizing brevity.</div><br/><div id="41886443" class="c"><input type="checkbox" id="c-41886443" checked=""/><div class="controls bullet"><span class="by">graftak</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41883303">parent</a><span>|</span><a href="#41881615">next</a><span>|</span><label class="collapse" for="c-41886443">[-]</label><label class="expand" for="c-41886443">[1 more]</label></div><br/><div class="children"><div class="content">Not only that; both a dot (“.”) and a forward slash (“&#x2F;”) are allowed to be used in&#x2F;as a JSON property name.<p>An array of keys alleviates this issue entirely because any string element of the array can be used as a JSON object property name too.</div><br/></div></div></div></div><div id="41881615" class="c"><input type="checkbox" id="c-41881615" checked=""/><div class="controls bullet"><span class="by">DataOverload</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41883303">prev</a><span>|</span><a href="#41881605">next</a><span>|</span><label class="collapse" for="c-41881615">[-]</label><label class="expand" for="c-41881615">[1 more]</label></div><br/><div class="children"><div class="content">It sort of is like a URL here&#x27;s some more examples with both relative and absolute queries <a href="https:&#x2F;&#x2F;opis.io&#x2F;json-schema&#x2F;2.x&#x2F;pointers.html" rel="nofollow">https:&#x2F;&#x2F;opis.io&#x2F;json-schema&#x2F;2.x&#x2F;pointers.html</a></div><br/></div></div><div id="41881605" class="c"><input type="checkbox" id="c-41881605" checked=""/><div class="controls bullet"><span class="by">bityard</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41881615">prev</a><span>|</span><a href="#41882491">next</a><span>|</span><label class="collapse" for="c-41881605">[-]</label><label class="expand" for="c-41881605">[10 more]</label></div><br/><div class="children"><div class="content">Maybe we&#x27;re talking about different things, but resources in REST are identified by their URL and URLs use &#x27;&#x2F;&#x27; to separate elements in the path.</div><br/><div id="41881871" class="c"><input type="checkbox" id="c-41881871" checked=""/><div class="controls bullet"><span class="by">bsimpson</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881605">parent</a><span>|</span><a href="#41882491">next</a><span>|</span><label class="collapse" for="c-41881871">[-]</label><label class="expand" for="c-41881871">[9 more]</label></div><br/><div class="children"><div class="content">Yeah, but nobody ever looked at<p><pre><code>    {
      &quot;a&quot;: {
        &quot;b&quot;: {
          &quot;c&quot;: []
        }
      }
    }
</code></pre>
and thought &quot;I need the list at &#x2F;a&#x2F;b&#x2F;c&quot;</div><br/><div id="41881910" class="c"><input type="checkbox" id="c-41881910" checked=""/><div class="controls bullet"><span class="by">cjblomqvist</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881871">parent</a><span>|</span><a href="#41882009">next</a><span>|</span><label class="collapse" for="c-41881910">[-]</label><label class="expand" for="c-41881910">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;ve ever done XPath you do!</div><br/><div id="41882293" class="c"><input type="checkbox" id="c-41882293" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881910">parent</a><span>|</span><a href="#41882009">next</a><span>|</span><label class="collapse" for="c-41882293">[-]</label><label class="expand" for="c-41882293">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, wrote my own XPath-like extension methods to manipulate JSON just like that. Felt very natural and makes it quite easy to generate and process JSON for the cases serialization&#x2F;deserialization isn&#x27;t the best option.</div><br/></div></div></div></div><div id="41882009" class="c"><input type="checkbox" id="c-41882009" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881871">parent</a><span>|</span><a href="#41881910">prev</a><span>|</span><a href="#41881957">next</a><span>|</span><label class="collapse" for="c-41882009">[-]</label><label class="expand" for="c-41882009">[4 more]</label></div><br/><div class="children"><div class="content">Seems like a reasonable thing to me.<p><pre><code>    {
      &quot;makes&quot;: {
        &quot;toyota&quot;: {
          &quot;models: [ ... ]
        }
      }
    }
</code></pre>
&quot;I need all the models of Toyota cars.&quot;<p>Or<p>&quot;Toyota came out with a new Camry, I need to update the Camry object within Toyota&#x27;s models.&quot;</div><br/><div id="41882225" class="c"><input type="checkbox" id="c-41882225" checked=""/><div class="controls bullet"><span class="by">bsimpson</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882009">parent</a><span>|</span><a href="#41884316">next</a><span>|</span><label class="collapse" for="c-41882225">[-]</label><label class="expand" for="c-41882225">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, but that&#x27;s makes.toyota.models, not &#x2F;makes&#x2F;toyota&#x2F;models.<p>The point is that this is a data structure and not a web server.  It&#x27;s using a convention from one domain in a different one.  Relatively minor in the scope of possible quibbles, but it&#x27;s just one more thing to remember&#x2F;one more trivial mistake to make.  I&#x27;m sure much collective time will be lost to many people using dots where the spec says to use slashes, and not realizing it because it looks right in every other context with dots.  Dots also makes copy&#x2F;pasting easier, because you wouldn&#x27;t have to migrate the format after pasting.</div><br/><div id="41882298" class="c"><input type="checkbox" id="c-41882298" checked=""/><div class="controls bullet"><span class="by">maxbond</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882225">parent</a><span>|</span><a href="#41884316">next</a><span>|</span><label class="collapse" for="c-41882298">[-]</label><label class="expand" for="c-41882298">[1 more]</label></div><br/><div class="children"><div class="content">Oh I see what you mean. I misunderstood, I also don&#x27;t like slash as a separator.</div><br/></div></div></div></div><div id="41884316" class="c"><input type="checkbox" id="c-41884316" checked=""/><div class="controls bullet"><span class="by">inkyoto</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882009">parent</a><span>|</span><a href="#41882225">prev</a><span>|</span><a href="#41881957">next</a><span>|</span><label class="collapse" for="c-41884316">[-]</label><label class="expand" for="c-41884316">[1 more]</label></div><br/><div class="children"><div class="content">It quickly gets convoluted since Camry has been produced for more than 30 years with regular model refreshes throughout the years, e.g. 1997, 2003, 2025 etc. JSON Pointer quickly falls short since we now require a selection expression to figure out which year model we need to update in the array of models: «makes.toyota.models[?year == `2025`]» (using JMESPath).<p>Both, JSONPath or JMESPath, support query expressions whereas JSON Pointer does not.</div><br/></div></div></div></div><div id="41881957" class="c"><input type="checkbox" id="c-41881957" checked=""/><div class="controls bullet"><span class="by">bombela</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881871">parent</a><span>|</span><a href="#41882009">prev</a><span>|</span><a href="#41882491">next</a><span>|</span><label class="collapse" for="c-41881957">[-]</label><label class="expand" for="c-41881957">[2 more]</label></div><br/><div class="children"><div class="content">Anecdotal, I did and I do. It&#x27;s no different than a path on a filesystem.</div><br/><div id="41882617" class="c"><input type="checkbox" id="c-41882617" checked=""/><div class="controls bullet"><span class="by">stronglikedan</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881957">parent</a><span>|</span><a href="#41882491">next</a><span>|</span><label class="collapse" for="c-41882617">[-]</label><label class="expand" for="c-41882617">[1 more]</label></div><br/><div class="children"><div class="content">But it&#x27;s different than object notation in JS, and considering JSON stands for JavaScript Object Notation, I think dot notation would have been more appropriate for JSON Pointer (and by extension JSON Path). As a bit of a rebel myself, I use dot notation when describing a location in a JSON document, unless I&#x27;m forced to use the slash for something like JSON Pointer.</div><br/></div></div></div></div></div></div></div></div><div id="41882491" class="c"><input type="checkbox" id="c-41882491" checked=""/><div class="controls bullet"><span class="by">Guthur</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41881605">prev</a><span>|</span><a href="#41881377">next</a><span>|</span><label class="collapse" for="c-41882491">[-]</label><label class="expand" for="c-41882491">[4 more]</label></div><br/><div class="children"><div class="content">JSON is derived from JavaScript, it is not a strict subset.<p>The most glaring issue is JSON number type versus JavaScript float. This causes issues in both directions whereby people consistently believe JSON can&#x27;t represent numbers outside the float range and in addition JSON has no way to represent NaN.</div><br/><div id="41882582" class="c"><input type="checkbox" id="c-41882582" checked=""/><div class="controls bullet"><span class="by">bsimpson</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882491">parent</a><span>|</span><a href="#41881377">next</a><span>|</span><label class="collapse" for="c-41882582">[-]</label><label class="expand" for="c-41882582">[3 more]</label></div><br/><div class="children"><div class="content">Is there any legal JSON that&#x27;s not legal JavaScript?<p>If not, it&#x27;s fair to say it&#x27;s a subset.</div><br/><div id="41882750" class="c"><input type="checkbox" id="c-41882750" checked=""/><div class="controls bullet"><span class="by">tubthumper8</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882582">parent</a><span>|</span><a href="#41882831">next</a><span>|</span><label class="collapse" for="c-41882750">[-]</label><label class="expand" for="c-41882750">[1 more]</label></div><br/><div class="children"><div class="content">It is a subset as of JavaScript edition ES2019, when JavaScript strings are now allowed to contain U+2028 LINE SEPARATOR and U+2029 PARAGRAPH SEPARATOR. Prior to ES2019, that was the only known example of legal JSON that was not legal JavaScript</div><br/></div></div><div id="41882831" class="c"><input type="checkbox" id="c-41882831" checked=""/><div class="controls bullet"><span class="by">fanf2</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41882582">parent</a><span>|</span><a href="#41882750">prev</a><span>|</span><a href="#41881377">next</a><span>|</span><label class="collapse" for="c-41882831">[-]</label><label class="expand" for="c-41882831">[1 more]</label></div><br/><div class="children"><div class="content">JavaScript used to forbid U+2028 line separator and U+2029 paragraph separator in string literals, but JavaScript now allows them for compatibility with JSON.<p>The remaining wrinkle is different handling of &quot;__proto__&quot;</div><br/></div></div></div></div></div></div><div id="41881377" class="c"><input type="checkbox" id="c-41881377" checked=""/><div class="controls bullet"><span class="by">yawnxyz</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41882491">prev</a><span>|</span><a href="#41885337">next</a><span>|</span><label class="collapse" for="c-41881377">[-]</label><label class="expand" for="c-41881377">[2 more]</label></div><br/><div class="children"><div class="content">this was one of the biggest learning curves &#x2F; adjustments tbh but once I got over that it&#x27;s surprisingly powerful.<p>It tackles like 80% of cases</div><br/><div id="41881594" class="c"><input type="checkbox" id="c-41881594" checked=""/><div class="controls bullet"><span class="by">dleeftink</span><span>|</span><a href="#41881312">root</a><span>|</span><a href="#41881377">parent</a><span>|</span><a href="#41885337">next</a><span>|</span><label class="collapse" for="c-41881594">[-]</label><label class="expand" for="c-41881594">[1 more]</label></div><br/><div class="children"><div class="content">Extending the 80&#x2F;20 analogy, how much additional efforts does the last 20% take here? The format seems efficient enough, but I&#x27;m wondering about the complexity trade-offs one can expect.</div><br/></div></div></div></div><div id="41885337" class="c"><input type="checkbox" id="c-41885337" checked=""/><div class="controls bullet"><span class="by">toomim</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41881377">prev</a><span>|</span><a href="#41885101">next</a><span>|</span><label class="collapse" for="c-41885337">[-]</label><label class="expand" for="c-41885337">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, it sucks.  It was borrowed from XPath.  And it&#x27;s not appropriate for JSON.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;XPath" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;XPath</a></div><br/></div></div><div id="41885101" class="c"><input type="checkbox" id="c-41885101" checked=""/><div class="controls bullet"><span class="by">xdennis</span><span>|</span><a href="#41881312">parent</a><span>|</span><a href="#41885337">prev</a><span>|</span><a href="#41886228">next</a><span>|</span><label class="collapse" for="c-41885101">[-]</label><label class="expand" for="c-41885101">[1 more]</label></div><br/><div class="children"><div class="content">I would have expected paths to be an array of string&#x2F;number (e.g. [&quot;persons&quot;, 3, &quot;name&quot;]) because keys can be any string.<p>Such a document may not be wise, but how would you update something like:<p><pre><code>    { &quot;charCounts&quot;: { &quot;&#x2F;&quot;: 1234, &quot;a&quot;: 100, &quot;.&quot;: 99 } }</code></pre></div><br/></div></div></div></div><div id="41886228" class="c"><input type="checkbox" id="c-41886228" checked=""/><div class="controls bullet"><span class="by">Too</span><span>|</span><a href="#41881312">prev</a><span>|</span><a href="#41882708">next</a><span>|</span><label class="collapse" for="c-41886228">[-]</label><label class="expand" for="c-41886228">[2 more]</label></div><br/><div class="children"><div class="content">Similar to how MongoDB update queries work. Natural, since documents there are essentially JSON.<p>Does anyone know if it’s possible to use that update language on local files, without having a full mongodb running?<p><a href="https:&#x2F;&#x2F;www.mongodb.com&#x2F;docs&#x2F;manual&#x2F;reference&#x2F;operator&#x2F;update&#x2F;#update-operators-1" rel="nofollow">https:&#x2F;&#x2F;www.mongodb.com&#x2F;docs&#x2F;manual&#x2F;reference&#x2F;operator&#x2F;updat...</a></div><br/><div id="41886351" class="c"><input type="checkbox" id="c-41886351" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#41886228">parent</a><span>|</span><a href="#41882708">next</a><span>|</span><label class="collapse" for="c-41886351">[-]</label><label class="expand" for="c-41886351">[1 more]</label></div><br/><div class="children"><div class="content">We use MongoDB for data storage, so using JSON patch in the PATCH endpoints feels very natural. Just fetch the Mongo document and apply patch. Kind of slow, though.</div><br/></div></div></div></div><div id="41882708" class="c"><input type="checkbox" id="c-41882708" checked=""/><div class="controls bullet"><span class="by">owobeid</span><span>|</span><a href="#41886228">prev</a><span>|</span><a href="#41881657">next</a><span>|</span><label class="collapse" for="c-41882708">[-]</label><label class="expand" for="c-41882708">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve only use JSON Patch once as a quick hack to fix a problem I never thought I would encounter.<p>I had built a quick and dirty web interface so that a handful of people we contracted overseas can annotate some text data at the word level.<p>Originally, the plan was that the data was being annotated in small chunks (a sentence or two of text) but apparently the person managing the annotation team started assigning whole documents and we got a complaint that suddenly the annotations weren&#x27;t being saved.<p>It turned out that the annotators had been using a dial up connection the entire time (in 2018!) and so the upload was timing out for them.<p>We panicked a bit until I discovered JSON Patch and I rewrote the upload code to only use the patch.</div><br/></div></div><div id="41881657" class="c"><input type="checkbox" id="c-41881657" checked=""/><div class="controls bullet"><span class="by">zarzavat</span><span>|</span><a href="#41882708">prev</a><span>|</span><a href="#41880960">next</a><span>|</span><label class="collapse" for="c-41881657">[-]</label><label class="expand" for="c-41881657">[3 more]</label></div><br/><div class="children"><div class="content">Why is the path a string and not an array? That means you have to have some way to escape &#x2F; in keys, and also you need to parse the path string. Parser in parser syndrome. Or otherwise it can&#x27;t handle arbitrary JSON documents.</div><br/><div id="41881801" class="c"><input type="checkbox" id="c-41881801" checked=""/><div class="controls bullet"><span class="by">10000truths</span><span>|</span><a href="#41881657">parent</a><span>|</span><a href="#41882889">next</a><span>|</span><label class="collapse" for="c-41881801">[-]</label><label class="expand" for="c-41881801">[1 more]</label></div><br/><div class="children"><div class="content">JSON pointer escapes slashes by encoding them as &quot;~1&quot;, and tildes are escaped by encoding them as &quot;~0&quot;. But I agree that using an array would have made much more sense. It would also have allowed the use of integers to disambiguate array indices from object keys that happen to be numbers, without having to parse the document to be patched.</div><br/></div></div><div id="41882889" class="c"><input type="checkbox" id="c-41882889" checked=""/><div class="controls bullet"><span class="by">lilyball</span><span>|</span><a href="#41881657">parent</a><span>|</span><a href="#41881801">prev</a><span>|</span><a href="#41880960">next</a><span>|</span><label class="collapse" for="c-41882889">[-]</label><label class="expand" for="c-41882889">[1 more]</label></div><br/><div class="children"><div class="content">Probably because JSON Patch was &quot;influenced by&quot; XML Patch.</div><br/></div></div></div></div><div id="41880960" class="c"><input type="checkbox" id="c-41880960" checked=""/><div class="controls bullet"><span class="by">culi</span><span>|</span><a href="#41881657">prev</a><span>|</span><a href="#41886339">next</a><span>|</span><label class="collapse" for="c-41880960">[-]</label><label class="expand" for="c-41880960">[4 more]</label></div><br/><div class="children"><div class="content">&gt; This pointer identifies the name field within the user object. You can refer to an array&#x27;s entries by their index (ex. &#x2F;user&#x2F;friends&#x2F;0 is Alice). The last element in an array ca be referenced using - (ex. &#x2F;user&#x2F;friends&#x2F;- is John). If a property name contains ~, then inside the pointer it must be escaped using ~0, or if contains &#x2F; then it must be escaped using ~1.<p>The biggest thing on my wishlist for a system like this is a standardized syntax for choosing an item in a list by an identifying (set?) of key-value pairs. E.g. for<p><pre><code>  {
    &quot;name&quot;: &quot;Clark St Garden&quot;,
    &quot;plants&quot;: [
      { &quot;latin&quot;: &quot;Phytelephas aequatorialis&quot;, year: 2009 },
      { &quot;latin&quot;: &quot;Ceiba speciosa&quot;, year: 2009 },
      { &quot;latin&quot;: &quot;Dillenia indica&quot;, year: 2021 }
    ]
  }
</code></pre>
I&#x27;d like to be able to specify that I want to update Ceiba speciosa regardless of its index. This gets especially important if we&#x27;re adding items or trying to analyze diffs of previous versions of a json item</div><br/><div id="41881083" class="c"><input type="checkbox" id="c-41881083" checked=""/><div class="controls bullet"><span class="by">jabbany</span><span>|</span><a href="#41880960">parent</a><span>|</span><a href="#41884326">next</a><span>|</span><label class="collapse" for="c-41881083">[-]</label><label class="expand" for="c-41881083">[2 more]</label></div><br/><div class="children"><div class="content">Query by content reminds me of XPath, so I looked it up to see if there was a version for JSON...<p>Turns out there is <a href="https:&#x2F;&#x2F;www.ietf.org&#x2F;archive&#x2F;id&#x2F;draft-goessner-dispatch-jsonpath-00.html" rel="nofollow">https:&#x2F;&#x2F;www.ietf.org&#x2F;archive&#x2F;id&#x2F;draft-goessner-dispatch-json...</a></div><br/><div id="41881563" class="c"><input type="checkbox" id="c-41881563" checked=""/><div class="controls bullet"><span class="by">numbsafari</span><span>|</span><a href="#41880960">root</a><span>|</span><a href="#41881083">parent</a><span>|</span><a href="#41884326">next</a><span>|</span><label class="collapse" for="c-41881563">[-]</label><label class="expand" for="c-41881563">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, one option is to use a different content-type for your json-patch values and basically extend JSON Patch[1] to use JSON Path[2] instead of JSON Pointer[3].<p>[1] <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc6902" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc6902</a><p>[2] <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc9535" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc9535</a><p>[3] <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc6901" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;info&#x2F;rfc6901</a></div><br/></div></div></div></div><div id="41884326" class="c"><input type="checkbox" id="c-41884326" checked=""/><div class="controls bullet"><span class="by">ccorcos</span><span>|</span><a href="#41880960">parent</a><span>|</span><a href="#41881083">prev</a><span>|</span><a href="#41886339">next</a><span>|</span><label class="collapse" for="c-41884326">[-]</label><label class="expand" for="c-41884326">[1 more]</label></div><br/><div class="children"><div class="content">I also want to be able to insert into the array after an item as opposed to at a specific index.<p>Biggest issue with JSON patch is its inability to handle even the simplest concurrent writes.</div><br/></div></div></div></div><div id="41886339" class="c"><input type="checkbox" id="c-41886339" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#41880960">prev</a><span>|</span><a href="#41880930">next</a><span>|</span><label class="collapse" for="c-41886339">[-]</label><label class="expand" for="c-41886339">[1 more]</label></div><br/><div class="children"><div class="content">We use JSON patch for all PATCH endpoints in our .NET APIs. The only downside I see is slowness if you need to patch some tens of thousands of resources.</div><br/></div></div><div id="41880930" class="c"><input type="checkbox" id="c-41880930" checked=""/><div class="controls bullet"><span class="by">graypegg</span><span>|</span><a href="#41886339">prev</a><span>|</span><a href="#41882563">next</a><span>|</span><label class="collapse" for="c-41880930">[-]</label><label class="expand" for="c-41880930">[8 more]</label></div><br/><div class="children"><div class="content">I&#x27;m probably missing a use case here, but with the JSON Pointer spec they use feeling so &quot;URL-y&quot;, couldn&#x27;t you skip the whole meta-json syntax? So rather than doing<p><pre><code>    HTTP&#x2F;1.1 PATCH &#x2F;user
    Content-Type: application&#x2F;json-patch+json

    [
      {
        &quot;op&quot;: &quot;replace&quot;,
        &quot;path&quot;: &quot;&#x2F;username&quot;,
        &quot;value&quot;: &quot;bob&quot;
      }
    ]
</code></pre>
why not<p><pre><code>    HTTP&#x2F;1.1 PATCH &#x2F;user&#x2F;username
    Content-Type: application&#x2F;json

    &quot;bob&quot;
</code></pre>
I feel like you could pretty sensibly implement replace&#x2F;delete&#x2F;append with that.<p>Edit: &quot;test&quot; and &quot;copy&quot; from the json patch spec are unique! So there is those, as well as doing multiple edits all at once in a sort of &quot;transaction&quot;.</div><br/><div id="41880995" class="c"><input type="checkbox" id="c-41880995" checked=""/><div class="controls bullet"><span class="by">kukkamario</span><span>|</span><a href="#41880930">parent</a><span>|</span><a href="#41883343">next</a><span>|</span><label class="collapse" for="c-41880995">[-]</label><label class="expand" for="c-41880995">[5 more]</label></div><br/><div class="children"><div class="content">And then you&#x27;d be limited to only one change at the time and lose the benefit of making lot of changes with one request.</div><br/><div id="41881038" class="c"><input type="checkbox" id="c-41881038" checked=""/><div class="controls bullet"><span class="by">graypegg</span><span>|</span><a href="#41880930">root</a><span>|</span><a href="#41880995">parent</a><span>|</span><a href="#41883343">next</a><span>|</span><label class="collapse" for="c-41881038">[-]</label><label class="expand" for="c-41881038">[4 more]</label></div><br/><div class="children"><div class="content">I do get that, just saw the &quot;test&quot; op, to either pass or fail the whole change as a sort of transaction. That is really neat.<p>But I just find that the 1 by 1 approach is easier to reason about if you&#x27;re opening this up to the internet. I&#x27;d personally feel more comfortable with the security model of 1 URL + Session =&gt; 1 JSON key.</div><br/><div id="41882210" class="c"><input type="checkbox" id="c-41882210" checked=""/><div class="controls bullet"><span class="by">vlowther</span><span>|</span><a href="#41880930">root</a><span>|</span><a href="#41881038">parent</a><span>|</span><a href="#41883362">next</a><span>|</span><label class="collapse" for="c-41882210">[-]</label><label class="expand" for="c-41882210">[1 more]</label></div><br/><div class="children"><div class="content">$WORK project heavily utilizes the test op to enable atomic updates to objects across multiple competing clients.  It winds up working really well for that purpose.</div><br/></div></div><div id="41883362" class="c"><input type="checkbox" id="c-41883362" checked=""/><div class="controls bullet"><span class="by">kchr</span><span>|</span><a href="#41880930">root</a><span>|</span><a href="#41881038">parent</a><span>|</span><a href="#41882210">prev</a><span>|</span><a href="#41881983">next</a><span>|</span><label class="collapse" for="c-41883362">[-]</label><label class="expand" for="c-41883362">[1 more]</label></div><br/><div class="children"><div class="content">Can you elaborate on how this affects the security model?</div><br/></div></div><div id="41881983" class="c"><input type="checkbox" id="c-41881983" checked=""/><div class="controls bullet"><span class="by">mattmanser</span><span>|</span><a href="#41880930">root</a><span>|</span><a href="#41881038">parent</a><span>|</span><a href="#41883362">prev</a><span>|</span><a href="#41883343">next</a><span>|</span><label class="collapse" for="c-41881983">[-]</label><label class="expand" for="c-41881983">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m actually using it at the moment in my work and I&#x27;m often doing 3-4 updates per patch.<p>You want them to all fail or not,<p>One-by-one is a bit of a weird suggestion tbh. You shouldn&#x27;t be reasoning that way about code.<p>If you are going to get a 4xx response to one of the 4 property updates you want them all to fail at once.<p>Just like anything else we use like SQL.</div><br/></div></div></div></div></div></div><div id="41883343" class="c"><input type="checkbox" id="c-41883343" checked=""/><div class="controls bullet"><span class="by">ks2048</span><span>|</span><a href="#41880930">parent</a><span>|</span><a href="#41880995">prev</a><span>|</span><a href="#41881640">next</a><span>|</span><label class="collapse" for="c-41883343">[-]</label><label class="expand" for="c-41883343">[1 more]</label></div><br/><div class="children"><div class="content">IMHO, the &quot;JSON patch&quot; concept is useful in contexts that have nothing to HTTP, just like having a &quot;diff&quot; format for files.</div><br/></div></div><div id="41881640" class="c"><input type="checkbox" id="c-41881640" checked=""/><div class="controls bullet"><span class="by">DataOverload</span><span>|</span><a href="#41880930">parent</a><span>|</span><a href="#41883343">prev</a><span>|</span><a href="#41882563">next</a><span>|</span><label class="collapse" for="c-41881640">[-]</label><label class="expand" for="c-41881640">[1 more]</label></div><br/><div class="children"><div class="content">You might like JSON Merge Patch then - much simpler syntax that avoids the URL stuff</div><br/></div></div></div></div><div id="41882563" class="c"><input type="checkbox" id="c-41882563" checked=""/><div class="controls bullet"><span class="by">quietbritishjim</span><span>|</span><a href="#41880930">prev</a><span>|</span><a href="#41885693">next</a><span>|</span><label class="collapse" for="c-41882563">[-]</label><label class="expand" for="c-41882563">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Strengths: ... Idempotency: JSON Patch operations can be safely retried without causing unintended side effects.<p>So, wait, you can&#x27;t add an item to an array with this (except at a predefined position)? I.e. &quot;add&quot; with path &quot;&#x2F;...&#x2F;myarray&#x2F;~&quot; (if I&#x27;ve understand their notation right) isn&#x27;t allowed?<p>I&#x27;m not sure if that&#x27;s good or bad, but it&#x27;s certainly surprising and could do with saying a bit more explicitly.</div><br/></div></div><div id="41885824" class="c"><input type="checkbox" id="c-41885824" checked=""/><div class="controls bullet"><span class="by">drivenextfunc</span><span>|</span><a href="#41885693">prev</a><span>|</span><a href="#41881425">next</a><span>|</span><label class="collapse" for="c-41885824">[-]</label><label class="expand" for="c-41885824">[1 more]</label></div><br/><div class="children"><div class="content">While I acknowledge that JSON Patch can be useful in certain contexts, I find that there are far better alternatives, particularly for the scenarios I encounter. Specifically, when using kustomization.yaml to generate slightly different Kubernetes manifests for various environments (dev&#x2F;staging&#x2F;production), tools like jsonnet offer superior functionality and flexibility.</div><br/></div></div><div id="41881425" class="c"><input type="checkbox" id="c-41881425" checked=""/><div class="controls bullet"><span class="by">cachedthing0</span><span>|</span><a href="#41885824">prev</a><span>|</span><a href="#41881311">next</a><span>|</span><label class="collapse" for="c-41881425">[-]</label><label class="expand" for="c-41881425">[3 more]</label></div><br/><div class="children"><div class="content">I am using JSONDiffpatch made by Benjamín Eidelman some years in production now. It is perfect, works in a browser and on a node&#x2F;cloudflare worker&#x2F;etc.
How does JSON Patch compare to JSONDiffpatch? It is not mentioned in the alternatives list.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;benjamine&#x2F;jsondiffpatch">https:&#x2F;&#x2F;github.com&#x2F;benjamine&#x2F;jsondiffpatch</a></div><br/><div id="41886441" class="c"><input type="checkbox" id="c-41886441" checked=""/><div class="controls bullet"><span class="by">kybernetikos</span><span>|</span><a href="#41881425">parent</a><span>|</span><a href="#41881623">next</a><span>|</span><label class="collapse" for="c-41886441">[-]</label><label class="expand" for="c-41886441">[1 more]</label></div><br/><div class="children"><div class="content">How does it do with array insertion? I didn&#x27;t like how most diffs handle them so I smashed together two pieces of code I found elsewhere to get something I thought was better.  <a href="https:&#x2F;&#x2F;github.com&#x2F;kybernetikos&#x2F;fogsaadiff">https:&#x2F;&#x2F;github.com&#x2F;kybernetikos&#x2F;fogsaadiff</a></div><br/></div></div><div id="41881623" class="c"><input type="checkbox" id="c-41881623" checked=""/><div class="controls bullet"><span class="by">DataOverload</span><span>|</span><a href="#41881425">parent</a><span>|</span><a href="#41886441">prev</a><span>|</span><a href="#41881311">next</a><span>|</span><label class="collapse" for="c-41881623">[-]</label><label class="expand" for="c-41881623">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for sharing, I&#x27;ll try and find time to compare and write about it</div><br/></div></div></div></div><div id="41881311" class="c"><input type="checkbox" id="c-41881311" checked=""/><div class="controls bullet"><span class="by">arusahni</span><span>|</span><a href="#41881425">prev</a><span>|</span><a href="#41885627">next</a><span>|</span><label class="collapse" for="c-41881311">[-]</label><label class="expand" for="c-41881311">[1 more]</label></div><br/><div class="children"><div class="content">A challenge I experienced with JSON Patch is convincing external parties it&#x27;s worth learning. I used this in a customer-facing API at $PREVJOB and had to do a lot of evangelism to get our users to understand and adopt it. Most of our customers weren&#x27;t tech shops, however, so the contracted engineering staff may have had something to do with it.</div><br/></div></div><div id="41885627" class="c"><input type="checkbox" id="c-41885627" checked=""/><div class="controls bullet"><span class="by">qwertox</span><span>|</span><a href="#41881311">prev</a><span>|</span><a href="#41883652">next</a><span>|</span><label class="collapse" for="c-41885627">[-]</label><label class="expand" for="c-41885627">[1 more]</label></div><br/><div class="children"><div class="content">I first got excited reading the article, but the following left me thinking that I won&#x27;t use it:<p><pre><code>  Weaknesses
  Maintenance Costs: As APIs evolve, the paths specified in JSON Patches might 
  become obsolete, leading to maintenance overhead.
</code></pre>
Then again, if a path becomes obsolete, it means that I would be about to update with a wrongly formatted document anyway.</div><br/></div></div><div id="41883652" class="c"><input type="checkbox" id="c-41883652" checked=""/><div class="controls bullet"><span class="by">scottlu2</span><span>|</span><a href="#41885627">prev</a><span>|</span><a href="#41885894">next</a><span>|</span><label class="collapse" for="c-41883652">[-]</label><label class="expand" for="c-41883652">[2 more]</label></div><br/><div class="children"><div class="content">The article suggests json patch is idempotent, but it isn’t idempotent for array mutations. JSON merge patch on the other hand is fully idempotent (in the array case the array is replaced).</div><br/><div id="41883789" class="c"><input type="checkbox" id="c-41883789" checked=""/><div class="controls bullet"><span class="by">kardos</span><span>|</span><a href="#41883652">parent</a><span>|</span><a href="#41885894">next</a><span>|</span><label class="collapse" for="c-41883789">[-]</label><label class="expand" for="c-41883789">[1 more]</label></div><br/><div class="children"><div class="content">Indeed it does not seem idempotent. If you move A to B and insert a new A, then rerunning the patch would yield the new A at B.<p>I suppose a subset of this is idempotent though.<p>Broadly this seems fraught with peril. It sounds like edge case upon edge case, and only would work in the narrow case where you are 100% sure exactly what the remote document looks like such that you can calculate the patch. If anything gets out of sync, or serialization differs between local and remote, etc youre going to get subtle bugs...</div><br/></div></div></div></div><div id="41885894" class="c"><input type="checkbox" id="c-41885894" checked=""/><div class="controls bullet"><span class="by">metalrain</span><span>|</span><a href="#41883652">prev</a><span>|</span><a href="#41885329">next</a><span>|</span><label class="collapse" for="c-41885894">[-]</label><label class="expand" for="c-41885894">[1 more]</label></div><br/><div class="children"><div class="content">JSON Patch solves real problem, but when you have that problem you wish you didn&#x27;t have it. Often you can split the document in smaller subdocuments that are easier to work with.</div><br/></div></div><div id="41885329" class="c"><input type="checkbox" id="c-41885329" checked=""/><div class="controls bullet"><span class="by">toomim</span><span>|</span><a href="#41885894">prev</a><span>|</span><a href="#41880913">next</a><span>|</span><label class="collapse" for="c-41885329">[-]</label><label class="expand" for="c-41885329">[1 more]</label></div><br/><div class="children"><div class="content">JSON Patch doesn&#x27;t let you represent insertions or deletions to strings. You can only replace them. This makes it useless for collaborative text editing. Thus, we can&#x27;t use it in Braid-HTTP: <a href="https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;draft-toomim-httpbis-braid-http" rel="nofollow">https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;draft-toomim-httpbis-b...</a></div><br/></div></div><div id="41880913" class="c"><input type="checkbox" id="c-41880913" checked=""/><div class="controls bullet"><span class="by">iwwr</span><span>|</span><a href="#41885329">prev</a><span>|</span><a href="#41883708">next</a><span>|</span><label class="collapse" for="c-41880913">[-]</label><label class="expand" for="c-41880913">[2 more]</label></div><br/><div class="children"><div class="content">What about auto-formatting the json and sorting all keys, to create some kind of canonical form? Then we can use standard textual patch.</div><br/><div id="41881374" class="c"><input type="checkbox" id="c-41881374" checked=""/><div class="controls bullet"><span class="by">_blk</span><span>|</span><a href="#41880913">parent</a><span>|</span><a href="#41883708">next</a><span>|</span><label class="collapse" for="c-41881374">[-]</label><label class="expand" for="c-41881374">[1 more]</label></div><br/><div class="children"><div class="content">Standard text patches (diffs) are great because they work with all text files but for a specific representation like JSON you can do a lot better. In terms of code volume it&#x27;s a lot lighter to find a node based on a json path than applying a diff.</div><br/></div></div></div></div><div id="41883708" class="c"><input type="checkbox" id="c-41883708" checked=""/><div class="controls bullet"><span class="by">zahlman</span><span>|</span><a href="#41880913">prev</a><span>|</span><a href="#41882874">next</a><span>|</span><label class="collapse" for="c-41883708">[-]</label><label class="expand" for="c-41883708">[1 more]</label></div><br/><div class="children"><div class="content">I hadn&#x27;t heard of this, but it&#x27;s nice to see that it&#x27;s standardized (although I&#x27;m not really prepared right now to evaluate that standard properly).<p>Some time ago (9 years, apparently - time sure does fly), I made a thing to describe patches to a <i>binary</i> using JSON (<a href="https:&#x2F;&#x2F;github.com&#x2F;zahlman&#x2F;json_bpatch">https:&#x2F;&#x2F;github.com&#x2F;zahlman&#x2F;json_bpatch</a>). It was meant primarily for hacking content into someone else&#x27;s existing binary file, and I spent way too much time on fancy algorithms for tracking &quot;free&quot; (safely modifiable, based on the user&#x27;s initial assessment and previous patches) space and fitting new content into the remaining space. Overall, I consider it a failure - but a fair amount of this project DNA is likely to survive in future projects.<p>I also had the idea at some point to make some kind of JSON diffing tool that works at a JSON-structure level instead of a textual level. I guess I don&#x27;t need to reinvent that wheel.</div><br/></div></div><div id="41882874" class="c"><input type="checkbox" id="c-41882874" checked=""/><div class="controls bullet"><span class="by">patwolf</span><span>|</span><a href="#41883708">prev</a><span>|</span><a href="#41881636">next</a><span>|</span><label class="collapse" for="c-41882874">[-]</label><label class="expand" for="c-41882874">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;m working on a project using CRDTs (Yjs) to generate efficient diffs for documents. I could probably use JSON Patch, but I worry about relying on something like fast-json-patch to automatically generate patches by diffing JSON documents.<p>If I have json like<p>[{&quot;name&quot;: &quot;Bob&quot;, age: 22}, {&quot;name&quot;: &quot;Sally&quot;, age: 40}]<p>and then I delete the &quot;Sally&quot; element and add &quot;Jenny&quot; with the same age, I end up with<p>[{&quot;name&quot;: &quot;Bob&quot;, age: 22&quot;}, {&quot;name&quot;: &quot;Jenny&quot;, age: 40}]<p>However, the patch would potentially look like I changed the name of &quot;Sally&quot; to &quot;Jenny&quot;, when in reality I deleted and added a new element. If I&#x27;m submitting this to a server and need to reconcile it with a database, the server cares about the specifics of how the JSON was manipulated.<p>I&#x27;d end up needing some sort of container object (like Yjs provides) that can track the individual changes and generate a correct patch.</div><br/><div id="41885794" class="c"><input type="checkbox" id="c-41885794" checked=""/><div class="controls bullet"><span class="by">dunham</span><span>|</span><a href="#41882874">parent</a><span>|</span><a href="#41883049">next</a><span>|</span><label class="collapse" for="c-41885794">[-]</label><label class="expand" for="c-41885794">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m currently using json patch in a work project for undo&#x2F;redo.  The patches and their inverse are being collected by `immer`, which can hand you a proxy and record changes made to it.<p>My plan was to dig up an operational transform implementation on json patches to implement collaborative editing when we decided we need that feature (we don&#x27;t need fine grained editing of text, but we do have arrays of objects).<p>I&#x27;m now evaluating automerge - it seems to be performant enough and not likely to disappear.<p>(I can implement OT, but I won&#x27;t be on this project forever and need to leave something that less senior devs can work with and maintain.)</div><br/></div></div><div id="41883049" class="c"><input type="checkbox" id="c-41883049" checked=""/><div class="controls bullet"><span class="by">theendisney</span><span>|</span><a href="#41882874">parent</a><span>|</span><a href="#41885794">prev</a><span>|</span><a href="#41882943">next</a><span>|</span><label class="collapse" for="c-41883049">[-]</label><label class="expand" for="c-41883049">[1 more]</label></div><br/><div class="children"><div class="content">I confess to counting soft deletes until i have enough of them.<p>[{&quot;name&quot;: &quot;Bob&quot;, age: 22}, {&quot;name&quot;: &quot;Sally&quot;, age: 40, &quot;deleted&quot;:&quot;2024-10-18 12:34:56&quot;}]</div><br/></div></div><div id="41882943" class="c"><input type="checkbox" id="c-41882943" checked=""/><div class="controls bullet"><span class="by">msikora</span><span>|</span><a href="#41882874">parent</a><span>|</span><a href="#41883049">prev</a><span>|</span><a href="#41881636">next</a><span>|</span><label class="collapse" for="c-41882943">[-]</label><label class="expand" for="c-41882943">[1 more]</label></div><br/><div class="children"><div class="content">Just add some unique IDs to your records.</div><br/></div></div></div></div><div id="41881636" class="c"><input type="checkbox" id="c-41881636" checked=""/><div class="controls bullet"><span class="by">zzbzq</span><span>|</span><a href="#41882874">prev</a><span>|</span><a href="#41884118">next</a><span>|</span><label class="collapse" for="c-41881636">[-]</label><label class="expand" for="c-41881636">[4 more]</label></div><br/><div class="children"><div class="content">Never liked it. Ignores the wonderful fact that javascript&#x27;s type system natively distinguishes undefined from null values.<p>{
  &quot;name&quot;: &quot;bob&quot;,
  &quot;phone&quot; null
}<p>This would set the name to bob, null out the phone, but leave all other fields untouched. No need for a DSL-over-json.<p>Only trouble is static type people love their type serializers, which are ever at a mismatch with the json they work with.</div><br/><div id="41881861" class="c"><input type="checkbox" id="c-41881861" checked=""/><div class="controls bullet"><span class="by">drdaeman</span><span>|</span><a href="#41881636">parent</a><span>|</span><a href="#41881682">next</a><span>|</span><label class="collapse" for="c-41881861">[-]</label><label class="expand" for="c-41881861">[1 more]</label></div><br/><div class="children"><div class="content">&gt; javascript&#x27;s type system natively distinguishes undefined from null values.<p>JSON is not JavaScript (despite the &quot;J&quot;), and `undefined` is not a part of JSON specification.<p>However, I think every language out there that has an dictionary-like type can distinguish between presence of a key and absence of one, so your argument still applies. At the very least, for simple documents that don&#x27;t require anything fancy.<p>I believe this simple merge-based approach is exactly what people are using when they don&#x27;t need JSON Patch. If you operate on large arrays or need transactional updates, JSON Patch is probably be a better choice, though.<p>&gt; Only trouble is static type people love their type serializers, which are ever at a mismatch with the json they work with.<p>I don&#x27;t think it&#x27;s a type system problem, unless the language doesn&#x27;t have some type that is present in JSON and has to improvise. Typically, it&#x27;s rather a misunderstanding that a patch document (even if it&#x27;s a merge patch like your example) has its own distinct type from the entity it&#x27;s supposed to patch - at the very least, in terms of nullability. A lot of people (myself included) made that blunder only to realize how it&#x27;s broken later. JSON Patch avoids that because it&#x27;s very explicit that patch document has its own distinct structure and types, but simple merge patches may confuse some.</div><br/></div></div><div id="41881682" class="c"><input type="checkbox" id="c-41881682" checked=""/><div class="controls bullet"><span class="by">bityard</span><span>|</span><a href="#41881636">parent</a><span>|</span><a href="#41881861">prev</a><span>|</span><a href="#41881803">next</a><span>|</span><label class="collapse" for="c-41881682">[-]</label><label class="expand" for="c-41881682">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m working on something right now that has a need to add&#x2F;remove a few items to a very large array. (Not merely updating properties of an existing Object.) I ran across JSON Patch as a solution to this but ended up implementing just the part from it that I actually needed. (The &quot;add&quot; and &quot;remove&quot; operators.)<p>The alternative is the modify the large array on the client side and send the whole modified array every time.</div><br/></div></div><div id="41881803" class="c"><input type="checkbox" id="c-41881803" checked=""/><div class="controls bullet"><span class="by">mnahkies</span><span>|</span><a href="#41881636">parent</a><span>|</span><a href="#41881682">prev</a><span>|</span><a href="#41884118">next</a><span>|</span><label class="collapse" for="c-41881803">[-]</label><label class="expand" for="c-41881803">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re looking for JSON merge patch which they briefly mentioned <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc7386" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc7386</a></div><br/></div></div></div></div><div id="41884118" class="c"><input type="checkbox" id="c-41884118" checked=""/><div class="controls bullet"><span class="by">mrloba</span><span>|</span><a href="#41881636">prev</a><span>|</span><a href="#41881361">next</a><span>|</span><label class="collapse" for="c-41884118">[-]</label><label class="expand" for="c-41884118">[1 more]</label></div><br/><div class="children"><div class="content">I always found that a simple merge style patch is enough, and a lot simpler. You just have to know that there is a difference between null and undefined. For large arrays, it&#x27;s usually some sort of bulk operation that can be solved by an array of patch&#x2F;delete requests, which is both safer and simpler. Maybe I&#x27;ve just not hit a proper use case for this yet</div><br/></div></div><div id="41881361" class="c"><input type="checkbox" id="c-41881361" checked=""/><div class="controls bullet"><span class="by">udbhavs</span><span>|</span><a href="#41884118">prev</a><span>|</span><a href="#41885228">next</a><span>|</span><label class="collapse" for="c-41881361">[-]</label><label class="expand" for="c-41881361">[1 more]</label></div><br/><div class="children"><div class="content">I used this standard a long time ago to make a simple server -&gt; client reactive state for a card game by combining it with Vue&#x27;s reactive objects to get something like a poor man&#x27;s CRDTs. This is a rough diagram of what it looked like: [1]. Although there was a reducer step on the server to hide private state for the other player, it&#x27;s still probably wildly impractical for actual games.<p>[1] <a href="https:&#x2F;&#x2F;user-images.githubusercontent.com&#x2F;50021387&#x2F;184360079-d55741b4-8566-4ad2-8f70-3dc8c041fd46.png" rel="nofollow">https:&#x2F;&#x2F;user-images.githubusercontent.com&#x2F;50021387&#x2F;184360079...</a></div><br/></div></div><div id="41885228" class="c"><input type="checkbox" id="c-41885228" checked=""/><div class="controls bullet"><span class="by">klysm</span><span>|</span><a href="#41881361">prev</a><span>|</span><a href="#41882133">next</a><span>|</span><label class="collapse" for="c-41885228">[-]</label><label class="expand" for="c-41885228">[1 more]</label></div><br/><div class="children"><div class="content">This is a problem much easier solved when you allow yourself to diverge your representations of object creation, fetching, and patching.</div><br/></div></div><div id="41882133" class="c"><input type="checkbox" id="c-41882133" checked=""/><div class="controls bullet"><span class="by">TkTech</span><span>|</span><a href="#41885228">prev</a><span>|</span><a href="#41882766">next</a><span>|</span><label class="collapse" for="c-41882133">[-]</label><label class="expand" for="c-41882133">[1 more]</label></div><br/><div class="children"><div class="content">For anyone who wants to try this in Python, `yyjson`[1] supports both JSON Patch (RFC 6902) and JSON Merge-Patch (RFC 7386)[2]<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;tktech&#x2F;py_yyjson">https:&#x2F;&#x2F;github.com&#x2F;tktech&#x2F;py_yyjson</a>
[2]: <a href="https:&#x2F;&#x2F;tkte.ch&#x2F;py_yyjson&#x2F;api.html#yyjson.Document.patch" rel="nofollow">https:&#x2F;&#x2F;tkte.ch&#x2F;py_yyjson&#x2F;api.html#yyjson.Document.patch</a></div><br/></div></div><div id="41882766" class="c"><input type="checkbox" id="c-41882766" checked=""/><div class="controls bullet"><span class="by">iddan</span><span>|</span><a href="#41882133">prev</a><span>|</span><a href="#41883153">next</a><span>|</span><label class="collapse" for="c-41882766">[-]</label><label class="expand" for="c-41882766">[1 more]</label></div><br/><div class="children"><div class="content">Really sucks we don’t have the JQ&#x2F;JS notation style for paths in this standard I think it would have made it much more accessible</div><br/></div></div><div id="41883153" class="c"><input type="checkbox" id="c-41883153" checked=""/><div class="controls bullet"><span class="by">theendisney</span><span>|</span><a href="#41882766">prev</a><span>|</span><a href="#41882543">next</a><span>|</span><label class="collapse" for="c-41883153">[-]</label><label class="expand" for="c-41883153">[3 more]</label></div><br/><div class="children"><div class="content">I imagine something like so:<p><pre><code>   {
   &quot;delete&quot;:[&quot;123-234&quot;,&quot;567-700&quot;],

   &quot;insert&quot;:[123,456],

   &quot;substrs&quot;:[{&quot;foo&quot;:&quot;bar&quot;},[]]
   }
</code></pre>
Then delete the ranges from the string, convert the substrs to strings and insert them at the offset.</div><br/><div id="41884836" class="c"><input type="checkbox" id="c-41884836" checked=""/><div class="controls bullet"><span class="by">Izkata</span><span>|</span><a href="#41883153">parent</a><span>|</span><a href="#41882543">next</a><span>|</span><label class="collapse" for="c-41884836">[-]</label><label class="expand" for="c-41884836">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure I understand what you mean, but it almost sounds like something we already have a single verb for:  &quot;splice&quot;.  It means &quot;replace this range with these values&quot;:<p><pre><code>  z = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;]
  z.splice(2, 3, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;)

  Array(7) [ &quot;a&quot;, &quot;b&quot;, &quot;w&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;f&quot; ]
</code></pre>
Unfortunately it&#x27;s not on strings in javascript, but the verb has basically that meaning even outside of programming and could work here too.<p>I don&#x27;t see how the values in your example would work though.</div><br/><div id="41885564" class="c"><input type="checkbox" id="c-41885564" checked=""/><div class="controls bullet"><span class="by">theendisney</span><span>|</span><a href="#41883153">root</a><span>|</span><a href="#41884836">parent</a><span>|</span><a href="#41882543">next</a><span>|</span><label class="collapse" for="c-41885564">[-]</label><label class="expand" for="c-41885564">[1 more]</label></div><br/><div class="children"><div class="content">That seems to be it.<p>You compare the old string with the new one. What should be deleted is marked for deletion. Say char 10 to 30. Then the insert part points at spots where new stuff should be inserted.<p>Commas are left as an exercise for the backend.</div><br/></div></div></div></div></div></div><div id="41882543" class="c"><input type="checkbox" id="c-41882543" checked=""/><div class="controls bullet"><span class="by">dmarinus</span><span>|</span><a href="#41883153">prev</a><span>|</span><a href="#41882706">next</a><span>|</span><label class="collapse" for="c-41882543">[-]</label><label class="expand" for="c-41882543">[1 more]</label></div><br/><div class="children"><div class="content">The RFC 6902 - JavaScript Object Notation (JSON) Patch standard is also used by the AWS Cloud Control API:<p><a href="https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;cloudcontrolapi&#x2F;latest&#x2F;APIReference&#x2F;API_UpdateResource.html" rel="nofollow">https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;cloudcontrolapi&#x2F;latest&#x2F;APIRefere...</a></div><br/></div></div><div id="41882706" class="c"><input type="checkbox" id="c-41882706" checked=""/><div class="controls bullet"><span class="by">n0n0n4t0r</span><span>|</span><a href="#41882543">prev</a><span>|</span><a href="#41881586">next</a><span>|</span><label class="collapse" for="c-41882706">[-]</label><label class="expand" for="c-41882706">[1 more]</label></div><br/><div class="children"><div class="content">Funny enough, it makes me think about iTop&#x27;s way of patching XML files:
<a href="https:&#x2F;&#x2F;www.itophub.io&#x2F;wiki&#x2F;page?id=latest:customization:xml_reference#alter_node_contents" rel="nofollow">https:&#x2F;&#x2F;www.itophub.io&#x2F;wiki&#x2F;page?id=latest:customization:xml...</a></div><br/></div></div><div id="41881586" class="c"><input type="checkbox" id="c-41881586" checked=""/><div class="controls bullet"><span class="by">internetter</span><span>|</span><a href="#41882706">prev</a><span>|</span><label class="collapse" for="c-41881586">[-]</label><label class="expand" for="c-41881586">[1 more]</label></div><br/><div class="children"><div class="content">The pros&#x2F;cons section is giving ChatGPT to me</div><br/></div></div></div></div></div></div></div></body></html>