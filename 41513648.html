<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1726131657750" as="style"/><link rel="stylesheet" href="styles.css?v=1726131657750"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://fractaledmind.github.io/2024/04/15/sqlite-on-rails-the-how-and-why-of-optimal-performance/">SQLite on Rails: The how and why of optimal performance</a> <span class="domain">(<a href="https://fractaledmind.github.io">fractaledmind.github.io</a>)</span></div><div class="subtext"><span>tosh</span> | <span>80 comments</span></div><br/><div><div id="41515567" class="c"><input type="checkbox" id="c-41515567" checked=""/><div class="controls bullet"><span class="by">richjdsmith</span><span>|</span><a href="#41514546">next</a><span>|</span><label class="collapse" for="c-41515567">[-]</label><label class="expand" for="c-41515567">[2 more]</label></div><br/><div class="children"><div class="content">Anyone who is looking at using SQLIte + Rails should check out the work done by Oldmoe (X&#x2F;Github) on his Litestack project.<p>Here&#x27;s the intro paragraph: &quot;Litestack is a Ruby gem that provides both Ruby and Ruby on Rails applications an all-in-one solution for web application data infrastructure. It exploits the power and embeddedness of SQLite to deliver a full-fledged SQL database, a fast cache , a robust job queue, a reliable message broker, a full text search engine and a metrics platform all in a single package.&quot;<p>I&#x27;m currently using it on a project and can&#x27;t say enough good things about it!<p><a href="https:&#x2F;&#x2F;github.com&#x2F;oldmoe&#x2F;litestack">https:&#x2F;&#x2F;github.com&#x2F;oldmoe&#x2F;litestack</a></div><br/><div id="41517243" class="c"><input type="checkbox" id="c-41517243" checked=""/><div class="controls bullet"><span class="by">rcaught</span><span>|</span><a href="#41515567">parent</a><span>|</span><a href="#41514546">next</a><span>|</span><label class="collapse" for="c-41517243">[-]</label><label class="expand" for="c-41517243">[1 more]</label></div><br/><div class="children"><div class="content">Rails 8 will by default use the DB for cache, queues and WebSocket broadcasting - <a href="https:&#x2F;&#x2F;fly.io&#x2F;ruby-dispatch&#x2F;the-plan-for-rails-8&#x2F;">https:&#x2F;&#x2F;fly.io&#x2F;ruby-dispatch&#x2F;the-plan-for-rails-8&#x2F;</a></div><br/></div></div></div></div><div id="41514546" class="c"><input type="checkbox" id="c-41514546" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#41515567">prev</a><span>|</span><a href="#41515265">next</a><span>|</span><label class="collapse" for="c-41514546">[-]</label><label class="expand" for="c-41514546">[1 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t imagine how many days the author took to write such detailed article.<p>This is useful to anyone trying to scale SQLite web applications, even beyond Rails.<p>So thank you!</div><br/></div></div><div id="41515265" class="c"><input type="checkbox" id="c-41515265" checked=""/><div class="controls bullet"><span class="by">rootedbox</span><span>|</span><a href="#41514546">prev</a><span>|</span><a href="#41517199">next</a><span>|</span><label class="collapse" for="c-41515265">[-]</label><label class="expand" for="c-41515265">[1 more]</label></div><br/><div class="children"><div class="content">Anyone that does work with SQLite should read this article. Independent of language &#x2F; framework you are using.<p>I had to figure most of this stuff out on my own years ago. Thank you for writing this!</div><br/></div></div><div id="41517199" class="c"><input type="checkbox" id="c-41517199" checked=""/><div class="controls bullet"><span class="by">fulafel</span><span>|</span><a href="#41515265">prev</a><span>|</span><a href="#41518276">next</a><span>|</span><label class="collapse" for="c-41517199">[-]</label><label class="expand" for="c-41517199">[2 more]</label></div><br/><div class="children"><div class="content">&gt; By design, the sqlite3-ruby gem does not release the GVL when calling SQLite. For the most part, this is a reasonable decision [...]<p>Following the issue comment link <a href="https:&#x2F;&#x2F;github.com&#x2F;sparklemotion&#x2F;sqlite3-ruby&#x2F;issues&#x2F;287#issuecomment-615346313">https:&#x2F;&#x2F;github.com&#x2F;sparklemotion&#x2F;sqlite3-ruby&#x2F;issues&#x2F;287#iss...</a>, it sounds like they they had a suspicion about a significant cost of reacquiring the lock but didn&#x27;t validate it. Sounds iffy especially given all this workaround effort.<p>I feel in eg Python extensions culture this would have gotten designed the other way (maybe someone knows how it&#x27;s done there?).<p>edit: also, there&#x27;s this other comment in the linked issue:<p>&gt; The extralite gem is an alternative SQLite client which releases the GVL during blocking, see note on concurrency here: <a href="https:&#x2F;&#x2F;github.com&#x2F;digital-fabric&#x2F;extralite?tab=readme-ov-file#concurrency">https:&#x2F;&#x2F;github.com&#x2F;digital-fabric&#x2F;extralite?tab=readme-ov-fi...</a>. It is both significantly faster than this gem in general and doesn&#x27;t have concurrency issues.</div><br/><div id="41518274" class="c"><input type="checkbox" id="c-41518274" checked=""/><div class="controls bullet"><span class="by">fractaledmind</span><span>|</span><a href="#41517199">parent</a><span>|</span><a href="#41518276">next</a><span>|</span><label class="collapse" for="c-41518274">[-]</label><label class="expand" for="c-41518274">[1 more]</label></div><br/><div class="children"><div class="content">You can read more discussion here: <a href="https:&#x2F;&#x2F;github.com&#x2F;sparklemotion&#x2F;sqlite3-ruby&#x2F;pull&#x2F;528">https:&#x2F;&#x2F;github.com&#x2F;sparklemotion&#x2F;sqlite3-ruby&#x2F;pull&#x2F;528</a> and here: <a href="https:&#x2F;&#x2F;github.com&#x2F;digital-fabric&#x2F;extralite&#x2F;pull&#x2F;46">https:&#x2F;&#x2F;github.com&#x2F;digital-fabric&#x2F;extralite&#x2F;pull&#x2F;46</a> to see how it was validated that simply releases the GVL for every `step` in the SQLite VM majorly hurts single-threaded performance. Finding a middle ground for both single threaded and multi-threaded performance is tricky. In Rails, we know it is multi-threaded because of the connection pool. But the lower level gem is used in many other libraries and tools where it is used in a single threaded environment</div><br/></div></div></div></div><div id="41518276" class="c"><input type="checkbox" id="c-41518276" checked=""/><div class="controls bullet"><span class="by">shafyy</span><span>|</span><a href="#41517199">prev</a><span>|</span><a href="#41515044">next</a><span>|</span><label class="collapse" for="c-41518276">[-]</label><label class="expand" for="c-41518276">[1 more]</label></div><br/><div class="children"><div class="content">Very informative article and well written! I wonder why the default `busy_timeout` method has this exponential delay that punishes old old queries. Why does this make sense as the default?</div><br/></div></div><div id="41515044" class="c"><input type="checkbox" id="c-41515044" checked=""/><div class="controls bullet"><span class="by">iambateman</span><span>|</span><a href="#41518276">prev</a><span>|</span><a href="#41518489">next</a><span>|</span><label class="collapse" for="c-41515044">[-]</label><label class="expand" for="c-41515044">[18 more]</label></div><br/><div class="children"><div class="content">General SQLite question for the group…<p>I’m making a FOSS analytics system, and ease-of-installation is important. I want to send event data to a separate SQLite database, to keep analytics data separate from the main app’s data.<p>I’m concerned about scaling, since even a modestly busy website could have 1000+ events per second.<p>My thought is to store events in memory on the server and then make one batched write every second.<p>Does this seem like a reasonable way to get around the SQLite limitation where it struggles with lots of DB writes? Any better ideas?</div><br/><div id="41515556" class="c"><input type="checkbox" id="c-41515556" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41515124">next</a><span>|</span><label class="collapse" for="c-41515556">[-]</label><label class="expand" for="c-41515556">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;d say that&#x27;s a very reasonable and very good idea. I&#x27;ve implemented similar ideas in many other systems. Batching in general always reduces the per-entry overhead. It&#x27;s easy to prove this via a benchmark. You can even put all the batched items in a single transaction. And since you are batching, you essentially will always have one thread that&#x27;s getting the batch and actually doing the write, perfectly matched with SQLite&#x27;s limitation of one concurrent write at a time.<p>What you need to worry about is slightly higher complexity: (1) what happens when a single batched write doesn&#x27;t complete within one second; (2) what is the size of queue you store events in memory and whether it is unbounded or not; (3) if it is unbounded are you confident that overloading the server won&#x27;t cause it to be killed by OOM (queueing theory says when the arrival rate is too high the queue size becomes infinite so there must be another mechanism to push back), and if it is bounded are you comfortable with dropping entries; (4) if you do decide to drop entries from a bounded queue, which entries you drop; (5) for a bounded queue what its limit is. These are very necessary questions that arise in almost every system that needs queueing. Thinking about these questions not only help you in this instance, but also in many other future scenarios you may encounter.</div><br/></div></div><div id="41515124" class="c"><input type="checkbox" id="c-41515124" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41515556">prev</a><span>|</span><a href="#41516973">next</a><span>|</span><label class="collapse" for="c-41515124">[-]</label><label class="expand" for="c-41515124">[2 more]</label></div><br/><div class="children"><div class="content">SQLite doesn&#x27;t struggle with writes. But it only supports a single write transaction at a time; if you don&#x27;t trust SQLite&#x27;s transaction concurrency performance, you might serialize all your writes on a specific thread&#x2F;process.</div><br/><div id="41515139" class="c"><input type="checkbox" id="c-41515139" checked=""/><div class="controls bullet"><span class="by">iambateman</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41515124">parent</a><span>|</span><a href="#41516973">next</a><span>|</span><label class="collapse" for="c-41515139">[-]</label><label class="expand" for="c-41515139">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!</div><br/></div></div></div></div><div id="41516973" class="c"><input type="checkbox" id="c-41516973" checked=""/><div class="controls bullet"><span class="by">pradeepchhetri</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41515124">prev</a><span>|</span><a href="#41517074">next</a><span>|</span><label class="collapse" for="c-41516973">[-]</label><label class="expand" for="c-41516973">[1 more]</label></div><br/><div class="children"><div class="content">Since analytics data is generally write-heavy, I would recommend to use ClickHouse. You can use async-insert[0] feature of ClickHouse, thus you don&#x27;t need to worry about batching events on your side. If you are looking for an embedded solution, you can use chDB which is built on top of ClickHouse.<p>[0] <a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;asynchronous-data-inserts-in-clickhouse" rel="nofollow">https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;asynchronous-data-inserts-in-cli...</a></div><br/></div></div><div id="41517074" class="c"><input type="checkbox" id="c-41517074" checked=""/><div class="controls bullet"><span class="by">rpcope1</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41516973">prev</a><span>|</span><a href="#41515710">next</a><span>|</span><label class="collapse" for="c-41517074">[-]</label><label class="expand" for="c-41517074">[1 more]</label></div><br/><div class="children"><div class="content">Batching writes is probably a good idea, but by far the absolute best way to do something like this with SQLite is to use WAL and have a single designated writer (and as many readers as you want), probably fed by something like a queue. As long as you do that, I usually find the the performance is often really amazing.</div><br/></div></div><div id="41515710" class="c"><input type="checkbox" id="c-41515710" checked=""/><div class="controls bullet"><span class="by">duffyjp</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41517074">prev</a><span>|</span><a href="#41517381">next</a><span>|</span><label class="collapse" for="c-41515710">[-]</label><label class="expand" for="c-41515710">[1 more]</label></div><br/><div class="children"><div class="content">I do something similar for an audit trail at work.  I work with the type of data where we may need to know who looked at what and when.  All those records are stored in a separate SQLite DB (main DB is postgres), and I cycle it out once per calendar year.  That makes archival trivial, and should a compliance person need to look at it a simple desktop app can open the file easily.<p>You can&#x27;t beat SQLite for ease of use.  I&#x27;d try it out and simulate some load to see if SQLite can keep up, if you keep your inserts simple I bet it can.</div><br/></div></div><div id="41517381" class="c"><input type="checkbox" id="c-41517381" checked=""/><div class="controls bullet"><span class="by">randomdrake</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41515710">prev</a><span>|</span><a href="#41516132">next</a><span>|</span><label class="collapse" for="c-41517381">[-]</label><label class="expand" for="c-41517381">[1 more]</label></div><br/><div class="children"><div class="content">Worked here. Changed my mind on SQLite. Hipp worked alongside us. SQLite can be crazy performant:<p><a href="https:&#x2F;&#x2F;use.expensify.com&#x2F;blog&#x2F;scaling-sqlite-to-4m-qps-on-a-single-server" rel="nofollow">https:&#x2F;&#x2F;use.expensify.com&#x2F;blog&#x2F;scaling-sqlite-to-4m-qps-on-a...</a></div><br/></div></div><div id="41516132" class="c"><input type="checkbox" id="c-41516132" checked=""/><div class="controls bullet"><span class="by">aseipp</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41517381">prev</a><span>|</span><a href="#41515577">next</a><span>|</span><label class="collapse" for="c-41516132">[-]</label><label class="expand" for="c-41516132">[2 more]</label></div><br/><div class="children"><div class="content">You can write large SQLite databases at disk speed with the right data model and schema.<p>What most people do as mentioned is either batch writes, or simply send them over some kind of channel to a single thread that is the designated writer, some kind of MPSC queue, and that queue effectively acts as a serialization barrier.<p>Either can work depending on your latency&#x2F;durability requirements.<p>You also absolutely need to use the WAL journaling mode which allows concurrent reads&#x2F;writes at the same time, N readers but only 1 writer, and you probably want to take a hard look at disabling synchronous mode, which forces SQLite to fsync everywhere all the time. In practice this sounds bad but consider your example: if you make one batched write every second, then there is always a 1-second window where data can be lost anyway. There&#x27;s always a &quot;window&quot; where uncommitted data can be lost, it&#x27;s mostly a matter of how small that window is, and if internal consistency of the system is preserved in face of that failed write.<p>In your case the lack of synchronous mode wouldn&#x27;t really be that bad because your typical &quot;loss window&quot; would be much greater than what it implies. At the same time, turning off synchronous mode can give you an order of magnitude performance increase. So it&#x27;s very well worth thinking about.<p>TL;DR use a single thread to serialize writes (or batch writes), enable WAL mode, and think about synchronous mode. If you do these things you can hit extremely fast write speeds quite easily.</div><br/><div id="41516892" class="c"><input type="checkbox" id="c-41516892" checked=""/><div class="controls bullet"><span class="by">charleslmunger</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516132">parent</a><span>|</span><a href="#41515577">next</a><span>|</span><label class="collapse" for="c-41516892">[-]</label><label class="expand" for="c-41516892">[1 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t need to turn off synchronous mode, but you can set it to NORMAL, which will only fsync when compacting the WAL file.<p>Another great pattern for batch writes is to use a system like Nagle&#x27;s algorithm - push stuff into a queue, and insert from the queue in batches.</div><br/></div></div></div></div><div id="41515577" class="c"><input type="checkbox" id="c-41515577" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41516132">prev</a><span>|</span><a href="#41516122">next</a><span>|</span><label class="collapse" for="c-41515577">[-]</label><label class="expand" for="c-41515577">[1 more]</label></div><br/><div class="children"><div class="content">For analytics it&#x27;s hard to beat clickhouse in many aspects. It&#x27;s quite portable too.<p>I&#x27;d suggest taking a good look at it.</div><br/></div></div><div id="41516122" class="c"><input type="checkbox" id="c-41516122" checked=""/><div class="controls bullet"><span class="by">rodgerd</span><span>|</span><a href="#41515044">parent</a><span>|</span><a href="#41515577">prev</a><span>|</span><a href="#41518489">next</a><span>|</span><label class="collapse" for="c-41516122">[-]</label><label class="expand" for="c-41516122">[7 more]</label></div><br/><div class="children"><div class="content">Write events in parquet format and use DuckDB for your analytics?</div><br/><div id="41516845" class="c"><input type="checkbox" id="c-41516845" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516122">parent</a><span>|</span><a href="#41518615">next</a><span>|</span><label class="collapse" for="c-41516845">[-]</label><label class="expand" for="c-41516845">[2 more]</label></div><br/><div class="children"><div class="content">This. If you’re looking for something portable, DuckDB is hard to beat. It’s pretty much the SQLite for analytics.<p>I’ve had good experience with ClickHouse, too, but it feels a bit more like Postgres rather than SQLite in terms of portability.</div><br/><div id="41518634" class="c"><input type="checkbox" id="c-41518634" checked=""/><div class="controls bullet"><span class="by">tosh</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516845">parent</a><span>|</span><a href="#41518615">next</a><span>|</span><label class="collapse" for="c-41518634">[-]</label><label class="expand" for="c-41518634">[1 more]</label></div><br/><div class="children"><div class="content">Take a look at chDB and clickhouse-local. Clickhouse can do a lot even without running it as a server.<p><a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;chdb" rel="nofollow">https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;chdb</a><p><a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;operations&#x2F;utilities&#x2F;clickhouse-local" rel="nofollow">https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;operations&#x2F;utilities&#x2F;clickhou...</a></div><br/></div></div></div></div><div id="41518615" class="c"><input type="checkbox" id="c-41518615" checked=""/><div class="controls bullet"><span class="by">tosh</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516122">parent</a><span>|</span><a href="#41516845">prev</a><span>|</span><a href="#41516984">next</a><span>|</span><label class="collapse" for="c-41518615">[-]</label><label class="expand" for="c-41518615">[1 more]</label></div><br/><div class="children"><div class="content">afaiu appending to parquet files is not cheap, you basically have to re-write the file.<p>Do you mean periodically flushing a queue of logs into a new parquet file (e.g. named with a timestamp)?</div><br/></div></div><div id="41516984" class="c"><input type="checkbox" id="c-41516984" checked=""/><div class="controls bullet"><span class="by">iambateman</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516122">parent</a><span>|</span><a href="#41518615">prev</a><span>|</span><a href="#41518489">next</a><span>|</span><label class="collapse" for="c-41516984">[-]</label><label class="expand" for="c-41516984">[3 more]</label></div><br/><div class="children"><div class="content">Thanks for this...I&#x27;d never heard of DuckDB.<p>I&#x27;m writing in PHP, so it looks like that&#x27;s a nonstarter for now, but _very_ interested to see if a PHP extension pops up for this in the future.</div><br/><div id="41517035" class="c"><input type="checkbox" id="c-41517035" checked=""/><div class="controls bullet"><span class="by">pradeepchhetri</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516984">parent</a><span>|</span><a href="#41517011">next</a><span>|</span><label class="collapse" for="c-41517035">[-]</label><label class="expand" for="c-41517035">[1 more]</label></div><br/><div class="children"><div class="content">There was a great talk[0] recently from Laravel core team member about ClickHouse, Probably you will enjoy watching it.<p>[0] <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=_jjvaFWWKqg" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=_jjvaFWWKqg</a></div><br/></div></div><div id="41517011" class="c"><input type="checkbox" id="c-41517011" checked=""/><div class="controls bullet"><span class="by">pradeepchhetri</span><span>|</span><a href="#41515044">root</a><span>|</span><a href="#41516984">parent</a><span>|</span><a href="#41517035">prev</a><span>|</span><a href="#41518489">next</a><span>|</span><label class="collapse" for="c-41517011">[-]</label><label class="expand" for="c-41517011">[1 more]</label></div><br/><div class="children"><div class="content">You should look at ClickHouse which has good PHP client<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;smi2&#x2F;phpClickHouse">https:&#x2F;&#x2F;github.com&#x2F;smi2&#x2F;phpClickHouse</a></div><br/></div></div></div></div></div></div></div></div><div id="41518489" class="c"><input type="checkbox" id="c-41518489" checked=""/><div class="controls bullet"><span class="by">thih9</span><span>|</span><a href="#41515044">prev</a><span>|</span><a href="#41515394">next</a><span>|</span><label class="collapse" for="c-41518489">[-]</label><label class="expand" for="c-41518489">[1 more]</label></div><br/><div class="children"><div class="content">That was a satisfying and very informative read - thanks and congrats.<p>Feature request: a similar article for other DBs, starting with PostgreSQL.</div><br/></div></div><div id="41515394" class="c"><input type="checkbox" id="c-41515394" checked=""/><div class="controls bullet"><span class="by">nikisweeting</span><span>|</span><a href="#41518489">prev</a><span>|</span><a href="#41516565">next</a><span>|</span><label class="collapse" for="c-41515394">[-]</label><label class="expand" for="c-41515394">[5 more]</label></div><br/><div class="children"><div class="content">This is an excellent article! I wonder if there is any equivalent for Django?<p>ArchiveBox uses SQLite via django and I&#x27;ve run into exactly the issue the author describes in rails fairly often. It would be awesome to have a SQLite-layer solution that doesn&#x27;t require serializing all my writes through some other channel in the app.</div><br/><div id="41515498" class="c"><input type="checkbox" id="c-41515498" checked=""/><div class="controls bullet"><span class="by">DataDive</span><span>|</span><a href="#41515394">parent</a><span>|</span><a href="#41515554">next</a><span>|</span><label class="collapse" for="c-41515498">[-]</label><label class="expand" for="c-41515498">[2 more]</label></div><br/><div class="children"><div class="content">I recall a post by Simon Willison<p><a href="https:&#x2F;&#x2F;simonwillison.net&#x2F;2022&#x2F;Oct&#x2F;23&#x2F;datasette-gunicorn&#x2F;#benchmarking-sqlite" rel="nofollow">https:&#x2F;&#x2F;simonwillison.net&#x2F;2022&#x2F;Oct&#x2F;23&#x2F;datasette-gunicorn&#x2F;#be...</a></div><br/><div id="41516496" class="c"><input type="checkbox" id="c-41516496" checked=""/><div class="controls bullet"><span class="by">nikisweeting</span><span>|</span><a href="#41515394">root</a><span>|</span><a href="#41515498">parent</a><span>|</span><a href="#41515554">next</a><span>|</span><label class="collapse" for="c-41516496">[-]</label><label class="expand" for="c-41516496">[1 more]</label></div><br/><div class="children"><div class="content">Thanks, he&#x27;s even building a similar product as me on the same stack as me! shotscraper looks very similar to ArchiveBox.</div><br/></div></div></div></div><div id="41515554" class="c"><input type="checkbox" id="c-41515554" checked=""/><div class="controls bullet"><span class="by">BiteCode_dev</span><span>|</span><a href="#41515394">parent</a><span>|</span><a href="#41515498">prev</a><span>|</span><a href="#41516565">next</a><span>|</span><label class="collapse" for="c-41515554">[-]</label><label class="expand" for="c-41515554">[2 more]</label></div><br/><div class="children"><div class="content">Yes, there is: <a href="https:&#x2F;&#x2F;gcollazo.com&#x2F;optimal-sqlite-settings-for-django&#x2F;" rel="nofollow">https:&#x2F;&#x2F;gcollazo.com&#x2F;optimal-sqlite-settings-for-django&#x2F;</a></div><br/><div id="41516509" class="c"><input type="checkbox" id="c-41516509" checked=""/><div class="controls bullet"><span class="by">nikisweeting</span><span>|</span><a href="#41515394">root</a><span>|</span><a href="#41515554">parent</a><span>|</span><a href="#41516565">next</a><span>|</span><label class="collapse" for="c-41516509">[-]</label><label class="expand" for="c-41516509">[1 more]</label></div><br/><div class="children"><div class="content">Awesome, thanks.<p>I think @flexterra (aka gcollazo) should also add `&quot;check_same_thread&quot;: False` to the recommended OPTIONS, right? Unless they left it out intentionally?</div><br/></div></div></div></div></div></div><div id="41516565" class="c"><input type="checkbox" id="c-41516565" checked=""/><div class="controls bullet"><span class="by">hk1337</span><span>|</span><a href="#41515394">prev</a><span>|</span><a href="#41515708">next</a><span>|</span><label class="collapse" for="c-41516565">[-]</label><label class="expand" for="c-41516565">[5 more]</label></div><br/><div class="children"><div class="content">I like SQLite and I like Rails but this seems synonymous with using MS Access in a production environment.</div><br/><div id="41517397" class="c"><input type="checkbox" id="c-41517397" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41516565">parent</a><span>|</span><a href="#41516865">next</a><span>|</span><label class="collapse" for="c-41517397">[-]</label><label class="expand" for="c-41517397">[1 more]</label></div><br/><div class="children"><div class="content">Why is that? Especially if you have a read-heavy application, what is the scaling limit you&#x27;re worried about?</div><br/></div></div><div id="41516865" class="c"><input type="checkbox" id="c-41516865" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41516565">parent</a><span>|</span><a href="#41517397">prev</a><span>|</span><a href="#41516612">next</a><span>|</span><label class="collapse" for="c-41516865">[-]</label><label class="expand" for="c-41516865">[1 more]</label></div><br/><div class="children"><div class="content">I would <i>love</i> to have something like MS Access but for web apps. I’ve tried various website builder products but nothing seems as straightforward as Access was.</div><br/></div></div><div id="41516612" class="c"><input type="checkbox" id="c-41516612" checked=""/><div class="controls bullet"><span class="by">bryan2</span><span>|</span><a href="#41516565">parent</a><span>|</span><a href="#41516865">prev</a><span>|</span><a href="#41515708">next</a><span>|</span><label class="collapse" for="c-41516612">[-]</label><label class="expand" for="c-41516612">[2 more]</label></div><br/><div class="children"><div class="content">I mean this works for Pieter Levels. Definitely will cause issues when you get above a certain threshold of users.</div><br/><div id="41516668" class="c"><input type="checkbox" id="c-41516668" checked=""/><div class="controls bullet"><span class="by">eric-hu</span><span>|</span><a href="#41516565">root</a><span>|</span><a href="#41516612">parent</a><span>|</span><a href="#41515708">next</a><span>|</span><label class="collapse" for="c-41516668">[-]</label><label class="expand" for="c-41516668">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;levels.io&#x2F;remote-ok&#x2F;" rel="nofollow">https:&#x2F;&#x2F;levels.io&#x2F;remote-ok&#x2F;</a><p>2015<p>&gt; It’d analyze the feed, see which jobs were remote, then normalize the data and then push it into a simple SQLite database (yes, I’m not using JSON text files as a database anymore, thank you :P).<p><a href="https:&#x2F;&#x2F;levels.io&#x2F;how-i-build-my-minimum-viable-products&#x2F;" rel="nofollow">https:&#x2F;&#x2F;levels.io&#x2F;how-i-build-my-minimum-viable-products&#x2F;</a><p>2014<p>&gt; This includes all data used by the app. I actually shy away from using real database systems in the 12 startups. Instead I use JSON text files.<p>I was hoping to find data on Pieter&#x27;s current projects using Sqlite and their loads. (For all I know, RemoteOK still does, but I can&#x27;t find more recent posts about it).</div><br/></div></div></div></div></div></div><div id="41515708" class="c"><input type="checkbox" id="c-41515708" checked=""/><div class="controls bullet"><span class="by">dwheeler</span><span>|</span><a href="#41516565">prev</a><span>|</span><a href="#41516004">next</a><span>|</span><label class="collapse" for="c-41515708">[-]</label><label class="expand" for="c-41515708">[2 more]</label></div><br/><div class="children"><div class="content">Awesome, I&#x27;m always glad to see when someone figures out integration problems and helps the rest of us. I hope he manages to get these fixes into the default Rails confug.<p>I run a Rails app; I switched to Postgres years ago and never looked back. Postgres is awesome. Still, it&#x27;s great to have alternatives available, and I use sqlite for other tasks, so I know it has good capabilities too.</div><br/><div id="41518630" class="c"><input type="checkbox" id="c-41518630" checked=""/><div class="controls bullet"><span class="by">fractaledmind</span><span>|</span><a href="#41515708">parent</a><span>|</span><a href="#41516004">next</a><span>|</span><label class="collapse" for="c-41518630">[-]</label><label class="expand" for="c-41518630">[1 more]</label></div><br/><div class="children"><div class="content">I’m very excited that yes indeed we have the four major pillars in Rails 8, which is releasing soon, but can be used now via the main branch. The default, out-of-the-box experience with Rails 8 will go all in on SQLite, a database will be the only dependency, and you will have a production-ready app with jobs, cache, web sockets, and a primary database ready from `rails new`. I’ll be talking more about this all at Rails World in a couple weeks and that talk will be on YouTube sometime after that. But exciting times are ahead for Rails, for sure.</div><br/></div></div></div></div><div id="41516004" class="c"><input type="checkbox" id="c-41516004" checked=""/><div class="controls bullet"><span class="by">aeze</span><span>|</span><a href="#41515708">prev</a><span>|</span><a href="#41515076">next</a><span>|</span><label class="collapse" for="c-41516004">[-]</label><label class="expand" for="c-41516004">[4 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re using SQLite on Rails are you effectively constrained to one machine&#x2F;server?</div><br/><div id="41516083" class="c"><input type="checkbox" id="c-41516083" checked=""/><div class="controls bullet"><span class="by">klabb3</span><span>|</span><a href="#41516004">parent</a><span>|</span><a href="#41515076">next</a><span>|</span><label class="collapse" for="c-41516083">[-]</label><label class="expand" for="c-41516083">[3 more]</label></div><br/><div class="children"><div class="content">No, you can set up replication with, eg LiteFS where you have one writer and multiple read replicas.<p>That said, then you have operational overhead that defeats a part of the purpose with SQLite. In practice, you can get very far with a single machine and many CPUs (Postgres is ironically a good example of this). In eg Go you can easily parallelize most workloads. In rails, I don’t know if that’s possible. A quick search suggests there’s a GIL which can be limiting.</div><br/><div id="41518649" class="c"><input type="checkbox" id="c-41518649" checked=""/><div class="controls bullet"><span class="by">fractaledmind</span><span>|</span><a href="#41516004">root</a><span>|</span><a href="#41516083">parent</a><span>|</span><a href="#41517173">next</a><span>|</span><label class="collapse" for="c-41518649">[-]</label><label class="expand" for="c-41518649">[1 more]</label></div><br/><div class="children"><div class="content">This is my perspective as well. You certainly can horizontally scale with SQLite, but I strongly recommend that you vertically until you hit an actual limit there. If you know you will absolutely need multiple app nodes on day 1 or day 10, I think you will probably be better served by choosing a client&#x2F;server database like MySQL or PG instead.<p>So, you aren’t limited to single machine, but you should stay single machine as long as possible and extract as much value from that operational simplicity before you trade that simplicity for some kind of horizontal scale</div><br/></div></div><div id="41517173" class="c"><input type="checkbox" id="c-41517173" checked=""/><div class="controls bullet"><span class="by">rcaught</span><span>|</span><a href="#41516004">root</a><span>|</span><a href="#41516083">parent</a><span>|</span><a href="#41518649">prev</a><span>|</span><a href="#41515076">next</a><span>|</span><label class="collapse" for="c-41517173">[-]</label><label class="expand" for="c-41517173">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;guides.rubyonrails.org&#x2F;active_job_basics.html" rel="nofollow">https:&#x2F;&#x2F;guides.rubyonrails.org&#x2F;active_job_basics.html</a></div><br/></div></div></div></div></div></div><div id="41515076" class="c"><input type="checkbox" id="c-41515076" checked=""/><div class="controls bullet"><span class="by">nop_slide</span><span>|</span><a href="#41516004">prev</a><span>|</span><a href="#41517192">next</a><span>|</span><label class="collapse" for="c-41515076">[-]</label><label class="expand" for="c-41515076">[1 more]</label></div><br/><div class="children"><div class="content">I’ve been rediscovering rails recently and this article is super timely as I’ve begun using SQLite more, thanks!</div><br/></div></div><div id="41517192" class="c"><input type="checkbox" id="c-41517192" checked=""/><div class="controls bullet"><span class="by">VWWHFSfQ</span><span>|</span><a href="#41515076">prev</a><span>|</span><a href="#41514892">next</a><span>|</span><label class="collapse" for="c-41517192">[-]</label><label class="expand" for="c-41517192">[12 more]</label></div><br/><div class="children"><div class="content">I&#x27;m still not understanding this push toward using SQLite as a production backend database. It&#x27;s great for what it is, a tiny embeddable client-side application database. Like an address book on your phone. But even the developers themselves have steadfastly refused to allow it to expand beyond that scope. For instance, they won&#x27;t add native types for any useful things like dates&#x2F;times, or uuids. Because that would bloat the code and the size of the embedded object. So you&#x27;re stuck with &quot;everything is a string&quot;. Ref integrity can be enabled, but even those constraint options are very limited.<p>Not sure why people are still trying to shoe-horn it into a role that it&#x27;s not meant to be in, and not even really supported to be.</div><br/><div id="41517412" class="c"><input type="checkbox" id="c-41517412" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41517192">parent</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517412">[-]</label><label class="expand" for="c-41517412">[9 more]</label></div><br/><div class="children"><div class="content">First off, I don&#x27;t know that Richard Hipp agrees with you about what roles SQLite is &quot;meant&quot; to be in.<p>Second: the reasons are straightforward:<p>* For read-heavy access patterns, SQLite is crazy fast.<p>* It&#x27;s fast enough that you can often simplify your database access code; for instance, N+1 queries are often just not a problem in practice.<p>* SQLite removes a whole tier from the N-tier architecture, which in turn removes a whole set of things that can go wrong (and if you&#x27;ve ever managed your own Postgres or MySQL: things <i>do</i> go wrong).<p>It&#x27;s not a perfect fit for every application, or even the majority of applications, but the push you&#x27;re seeing is a correction against the pretty clearly false idea that SQLite is well suited only for &quot;tiny embedded client-side application databases&quot;.</div><br/><div id="41517496" class="c"><input type="checkbox" id="c-41517496" checked=""/><div class="controls bullet"><span class="by">petcat</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517412">parent</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517496">[-]</label><label class="expand" for="c-41517496">[8 more]</label></div><br/><div class="children"><div class="content">&gt; I don&#x27;t know that Richard Hipp agrees with you about what roles SQLite is &quot;meant&quot; to be in.<p>If Hipp thought that SQLite was suitable for backend applications where the database is the authority then he would allow real types and the associated constraints.  But he won&#x27;t do that because it complicates the code and bloats the embedded object size.<p>SQLite is great for what it is.  But it&#x27;s not a real concurrent backend database.  It&#x27;s a client-side database.  That&#x27;s all the SQLite developers will ever allow it to be.<p>We can try to layer-on a bunch of stuff like Lite Stream or whatever, and sharding.  But the fact is that the core database itself is not, and will never be, suitable for backend applications.<p>You can accidentally write a string to an int column.  Will SQLite say no?  No.  SQLite doesn&#x27;t care.  It returns everything is A-OK!<p>You can query an ISO-8601 string column with date_trunc() and strftime() and it just returns NULL whether there was a value or not, or maybe just because it did&#x27;t recognize the string in that column (LOL).<p>SQLite is fine.  But it&#x27;s not a real backend database.  It&#x27;s not a replacement for PG.</div><br/><div id="41518827" class="c"><input type="checkbox" id="c-41518827" checked=""/><div class="controls bullet"><span class="by">biorach</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517496">parent</a><span>|</span><a href="#41517535">next</a><span>|</span><label class="collapse" for="c-41518827">[-]</label><label class="expand" for="c-41518827">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  But it&#x27;s not a real concurrent backend database. It&#x27;s a client-side database<p>People are successfully using it server-side, in specific situations it appears to be a good fit.<p>&gt; You can accidentally write a string to an int column<p>Yes, you need more validation logic client-side in exchange for the performance gain. 
It&#x27;s a trade-off, not a black&#x2F;white distinction. A strongly typed language can help here.</div><br/></div></div><div id="41517535" class="c"><input type="checkbox" id="c-41517535" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517496">parent</a><span>|</span><a href="#41518827">prev</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517535">[-]</label><label class="expand" for="c-41517535">[6 more]</label></div><br/><div class="children"><div class="content">What&#x27;s a &quot;real&quot; &quot;concurrent&quot; &quot;backend&quot; database? It&#x27;s absolutely not a &quot;client-side&quot; database. Plenty of people use it in backends. Some of them are posting about it on this thread.<p>The correctness arguments apply just as much, if not more so, to MySQL and to document&#x2F;schemaless databases. Lots of people don&#x27;t like those databases, but nobody claims they&#x27;re not &quot;real backend databases&quot;.<p>You seem hung up on the idea that &quot;backend&quot; means &quot;n-tier&quot;, with a segregated compute&#x2F;storage tier for the database with networked connectivity to the app server. <i>That</i> architecture is something SQLite will never support, but that is not the only backend architecture.</div><br/><div id="41517592" class="c"><input type="checkbox" id="c-41517592" checked=""/><div class="controls bullet"><span class="by">petcat</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517535">parent</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517592">[-]</label><label class="expand" for="c-41517592">[5 more]</label></div><br/><div class="children"><div class="content">I think there&#x27;s a new generation of developers that don&#x27;t want to use &quot;no sql&quot; databases anymore (MongoDB, etc.)  I think that&#x27;s why we&#x27;re starting to see a surge in people wanting to run SQLite as their backend database. It&#x27;s similarly simple to start out with, and also similarly flimsy when dealing with actual data integrity. Very limited types, limited&#x2F;uncomplicated isolation options, ref integrity disabled by default (Mongo DB also disables things by default that hurts their benchmarks).</div><br/><div id="41517698" class="c"><input type="checkbox" id="c-41517698" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517592">parent</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517698">[-]</label><label class="expand" for="c-41517698">[4 more]</label></div><br/><div class="children"><div class="content">No, you&#x27;re seeing a surge in interest for SQLite because people like relational databases, but the n-tier architecture is sometimes not the right solution for the problems people have. And again: many of your arguments have been applied to MySQL, but nobody can with a straight face say it&#x27;s not a &quot;real&quot; backend database.<p>(To a first approximation ~nobody is interested in SQLite because it lacks correctness or rigid typing features; what&#x27;s interesting about SQLite is not what was interesting about schemaless databases, but rather the ability to ship backend apps without a separate database tier.)<p>Again: I think you need to snap out of the idea that n-tier architectures are axiomatically optimal for all backend applications. They often are! But not all the time.</div><br/><div id="41517745" class="c"><input type="checkbox" id="c-41517745" checked=""/><div class="controls bullet"><span class="by">petcat</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517698">parent</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517745">[-]</label><label class="expand" for="c-41517745">[3 more]</label></div><br/><div class="children"><div class="content">I think that most applications are written for their database. Their database defines their application.<p>If you write your application on a flimsy database then your application becomes equally flimsy.  All of your business constraints become flimsy because your source-of-truth (the database) is flimsy.<p>SQLite is flimsy by design.</div><br/><div id="41518022" class="c"><input type="checkbox" id="c-41518022" checked=""/><div class="controls bullet"><span class="by">snovv_crash</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517745">parent</a><span>|</span><a href="#41517762">next</a><span>|</span><label class="collapse" for="c-41518022">[-]</label><label class="expand" for="c-41518022">[1 more]</label></div><br/><div class="children"><div class="content">Au contraire, SQLite makes it very easy to write extensive automated testing for your application, since you can spin up in-memory DBs per test with minimal overhead. This makes your application much more robust.</div><br/></div></div><div id="41517762" class="c"><input type="checkbox" id="c-41517762" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41517192">root</a><span>|</span><a href="#41517745">parent</a><span>|</span><a href="#41518022">prev</a><span>|</span><a href="#41517286">next</a><span>|</span><label class="collapse" for="c-41517762">[-]</label><label class="expand" for="c-41517762">[1 more]</label></div><br/><div class="children"><div class="content">This was the kind of thing people used to say about MySQL before Meta made those arguments look silly, and so they&#x27;ve moved to SQLite as a new target. I like Postgres fine, but it&#x27;s just a tool, like many others.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="41517286" class="c"><input type="checkbox" id="c-41517286" checked=""/><div class="controls bullet"><span class="by">randomdata</span><span>|</span><a href="#41517192">parent</a><span>|</span><a href="#41517412">prev</a><span>|</span><a href="#41517637">next</a><span>|</span><label class="collapse" for="c-41517286">[-]</label><label class="expand" for="c-41517286">[1 more]</label></div><br/><div class="children"><div class="content">We eventually realized that the &quot;API server&quot; was actually just a DBMS all along. And once that was realized, it was realized that a DBMS sitting beside <i>another</i> DMBS that deals with the exact same data is rather silly, which is now leading to:<p><pre><code>    1. Let the clients connect to Postgres directly.
         - or -
    2. Cut Postgres out of the picture and double down on the homegrown DMBS.
</code></pre>
Some are going the #1 route, others #2. Where #2 is opted, SQLite is a convenient engine on which to build upon. It may not be perfect but it is what we have. Keep in mind that this realization on a grand scale (I&#x27;m sure some noticed many years ago) is fairly recent, so there is a lot of experimenting going on to figure out what works and what doesn&#x27;t.<p>It&#x27;s the natural cycle of computing. What is old is new again.<p>(Replace Postgres with MySQL, MSSQL, Oracle, or other DBMS as you see fit.)</div><br/></div></div><div id="41517637" class="c"><input type="checkbox" id="c-41517637" checked=""/><div class="controls bullet"><span class="by">QuadrupleA</span><span>|</span><a href="#41517192">parent</a><span>|</span><a href="#41517286">prev</a><span>|</span><a href="#41514892">next</a><span>|</span><label class="collapse" for="c-41517637">[-]</label><label class="expand" for="c-41517637">[1 more]</label></div><br/><div class="children"><div class="content">Why not do UUIDs as a string or blob? And dates as strings, or integer &#x2F; real timestamps?<p>It conceptually simplifies things in so many ways that benefit the app developer, not just the sqlite devs and low-spec hardware. Simpler documentation, shorter learning curve, smaller surface area for bugs, smaller binary size, etc.<p>There&#x27;s a trend to add bloat and complexity to everything in software these days, but I&#x27;m so glad that a few projects like SQLite are pushing against that.</div><br/></div></div></div></div><div id="41514892" class="c"><input type="checkbox" id="c-41514892" checked=""/><div class="controls bullet"><span class="by">Alifatisk</span><span>|</span><a href="#41517192">prev</a><span>|</span><a href="#41514679">next</a><span>|</span><label class="collapse" for="c-41514892">[-]</label><label class="expand" for="c-41514892">[1 more]</label></div><br/><div class="children"><div class="content">So this is Rails + Litstream, cool!</div><br/></div></div><div id="41514679" class="c"><input type="checkbox" id="c-41514679" checked=""/><div class="controls bullet"><span class="by">dorianmariefr</span><span>|</span><a href="#41514892">prev</a><span>|</span><a href="#41514459">next</a><span>|</span><label class="collapse" for="c-41514679">[-]</label><label class="expand" for="c-41514679">[12 more]</label></div><br/><div class="children"><div class="content">much easier just to use pg</div><br/><div id="41515041" class="c"><input type="checkbox" id="c-41515041" checked=""/><div class="controls bullet"><span class="by">vidarh</span><span>|</span><a href="#41514679">parent</a><span>|</span><a href="#41515130">next</a><span>|</span><label class="collapse" for="c-41515041">[-]</label><label class="expand" for="c-41515041">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not using Rails, but I now have several sites using my own little thing that is a single docker container where all state + content is in a single sqlite file, and it&#x27;s very nice to be able to just move that single file around. I love postgres, but doing the equivalent of that with Postgres is a lot more hassle.</div><br/></div></div><div id="41515130" class="c"><input type="checkbox" id="c-41515130" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41514679">parent</a><span>|</span><a href="#41515041">prev</a><span>|</span><a href="#41515197">next</a><span>|</span><label class="collapse" for="c-41515130">[-]</label><label class="expand" for="c-41515130">[7 more]</label></div><br/><div class="children"><div class="content">It is until you realize that using SQLite means you don&#x27;t have to worry about N+1 queries, which actually does make a pretty big difference in Rails code.</div><br/><div id="41515367" class="c"><input type="checkbox" id="c-41515367" checked=""/><div class="controls bullet"><span class="by">abound</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41515130">parent</a><span>|</span><a href="#41515197">next</a><span>|</span><label class="collapse" for="c-41515367">[-]</label><label class="expand" for="c-41515367">[6 more]</label></div><br/><div class="children"><div class="content">Not sure I understand this point, how does SQLite fix the N+1 query problem? Just by having the data co-located with the app and avoiding the round-trip latency hit?<p>If so, I&#x27;d argue you still have N+1 problems, you just won&#x27;t notice them until N gets a bit larger.</div><br/><div id="41515381" class="c"><input type="checkbox" id="c-41515381" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41515367">parent</a><span>|</span><a href="#41516100">next</a><span>|</span><label class="collapse" for="c-41515381">[-]</label><label class="expand" for="c-41515381">[4 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.sqlite.org&#x2F;np1queryprob.html" rel="nofollow">https:&#x2F;&#x2F;www.sqlite.org&#x2F;np1queryprob.html</a></div><br/><div id="41515646" class="c"><input type="checkbox" id="c-41515646" checked=""/><div class="controls bullet"><span class="by">abound</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41515381">parent</a><span>|</span><a href="#41516100">next</a><span>|</span><label class="collapse" for="c-41515646">[-]</label><label class="expand" for="c-41515646">[3 more]</label></div><br/><div class="children"><div class="content">Ah cool, thanks for the link!<p>For others, the short-ish answer is that doing hundreds of SQL queries in response to a request (loading nested timeline elements in their case) in SQLite is fine because of the lack of networking&#x2F;IPC overhead. The nature of N+1 queries is unchanged.</div><br/><div id="41516451" class="c"><input type="checkbox" id="c-41516451" checked=""/><div class="controls bullet"><span class="by">plorkyeran</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41515646">parent</a><span>|</span><a href="#41516100">next</a><span>|</span><label class="collapse" for="c-41516451">[-]</label><label class="expand" for="c-41516451">[2 more]</label></div><br/><div class="children"><div class="content">The other half of it that the sqlite page doesn&#x27;t mention is that sqlite lacks query engine optimizations which would make one large query faster than many smaller queries. If you had a hypothetical in-process version of postgres which didn&#x27;t have any IPC or networking overhead you&#x27;d still see benefits from performing fewer larger queries when using it because the query planner adds some overhead to small queries but makes complex queries faster.</div><br/><div id="41516896" class="c"><input type="checkbox" id="c-41516896" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41516451">parent</a><span>|</span><a href="#41516100">next</a><span>|</span><label class="collapse" for="c-41516896">[-]</label><label class="expand" for="c-41516896">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m wondering how would it perform if we can compile <a href="https:&#x2F;&#x2F;pglite.dev&#x2F;" rel="nofollow">https:&#x2F;&#x2F;pglite.dev&#x2F;</a> as a native library and use it as an in-process Postgres... I know Node folks already use it as a Wasm module, so it shouldn’t be too tricky?</div><br/></div></div></div></div></div></div></div></div><div id="41516100" class="c"><input type="checkbox" id="c-41516100" checked=""/><div class="controls bullet"><span class="by">prisenco</span><span>|</span><a href="#41514679">root</a><span>|</span><a href="#41515367">parent</a><span>|</span><a href="#41515381">prev</a><span>|</span><a href="#41515197">next</a><span>|</span><label class="collapse" for="c-41516100">[-]</label><label class="expand" for="c-41516100">[1 more]</label></div><br/><div class="children"><div class="content">Right, but it <i>effectively</i> solves it (even if not theoretically).<p>Most applications won&#x27;t come close to encountering the N+1 problem on Sqlite, whereas it comes early on in server-based databases.</div><br/></div></div></div></div></div></div><div id="41515197" class="c"><input type="checkbox" id="c-41515197" checked=""/><div class="controls bullet"><span class="by">dewey</span><span>|</span><a href="#41514679">parent</a><span>|</span><a href="#41515130">prev</a><span>|</span><a href="#41514830">next</a><span>|</span><label class="collapse" for="c-41515197">[-]</label><label class="expand" for="c-41515197">[1 more]</label></div><br/><div class="children"><div class="content">I kind of have to agree, I recently thought I&#x27;ll use sqlite in Rails for my new project to keep things simple but then realized it&#x27;s actually more annoying for my use case. I&#x27;d need a persistent volume with the right permissions, and I can&#x27;t just connect to my PG instance running on the server from my local machine to run some queries.<p>I&#x27;m sure it makes things easier for some use cases but it&#x27;s not a given.</div><br/></div></div><div id="41514830" class="c"><input type="checkbox" id="c-41514830" checked=""/><div class="controls bullet"><span class="by">jilles</span><span>|</span><a href="#41514679">parent</a><span>|</span><a href="#41515197">prev</a><span>|</span><a href="#41515187">next</a><span>|</span><label class="collapse" for="c-41514830">[-]</label><label class="expand" for="c-41514830">[1 more]</label></div><br/><div class="children"><div class="content">Not really. Setting a few sqlite options and enabling litestream for backups is much easier than setting up Postgres with reliable backups.<p>Should you do this for all apps? No. Do you have read heavy applications? Consider SQLite</div><br/></div></div><div id="41515187" class="c"><input type="checkbox" id="c-41515187" checked=""/><div class="controls bullet"><span class="by">anothername12</span><span>|</span><a href="#41514679">parent</a><span>|</span><a href="#41514830">prev</a><span>|</span><a href="#41514459">next</a><span>|</span><label class="collapse" for="c-41515187">[-]</label><label class="expand" for="c-41515187">[1 more]</label></div><br/><div class="children"><div class="content">Agreed. I always regret starting a new rails project with sqlite. Invariably I end up wanting some bunch of features only pg has.<p>Even for running tens of thousands of integration tests in a few seconds, pg is fine.</div><br/></div></div></div></div><div id="41514459" class="c"><input type="checkbox" id="c-41514459" checked=""/><div class="controls bullet"><span class="by">rbranson</span><span>|</span><a href="#41514679">prev</a><span>|</span><label class="collapse" for="c-41514459">[-]</label><label class="expand" for="c-41514459">[11 more]</label></div><br/><div class="children"><div class="content">This is a really long blog post to just say that you should turn on the WAL if you want concurrency out of SQLite. All the other stuff is superfluous.</div><br/><div id="41514535" class="c"><input type="checkbox" id="c-41514535" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#41514459">parent</a><span>|</span><a href="#41514550">next</a><span>|</span><label class="collapse" for="c-41514535">[-]</label><label class="expand" for="c-41514535">[8 more]</label></div><br/><div class="children"><div class="content">Can&#x27;t agree.<p>I learned about BEGIN IMMEDIATE TRANSACTION.<p>And there&#x27;s also busy_timeout.<p>The article also explains why&#x2F;how&#x2F;when things occur in detail which is valuable.</div><br/><div id="41515734" class="c"><input type="checkbox" id="c-41515734" checked=""/><div class="controls bullet"><span class="by">rbranson</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41514535">parent</a><span>|</span><a href="#41514550">next</a><span>|</span><label class="collapse" for="c-41515734">[-]</label><label class="expand" for="c-41515734">[7 more]</label></div><br/><div class="children"><div class="content">WAL mode makes those redundant. Just use WAL mode.</div><br/><div id="41516394" class="c"><input type="checkbox" id="c-41516394" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41515734">parent</a><span>|</span><a href="#41516241">next</a><span>|</span><label class="collapse" for="c-41516394">[-]</label><label class="expand" for="c-41516394">[4 more]</label></div><br/><div class="children"><div class="content">We all wish you were right. But alas life&#x27;s not that simple.<p>I suggest reading the manual on the section: &quot;Sometimes Queries Return SQLITE_BUSY In WAL Mode&quot;<p><a href="https:&#x2F;&#x2F;sqlite.org&#x2F;wal.html#sometimes_queries_return_sqlite_busy_in_wal_mode" rel="nofollow">https:&#x2F;&#x2F;sqlite.org&#x2F;wal.html#sometimes_queries_return_sqlite_...</a></div><br/><div id="41516540" class="c"><input type="checkbox" id="c-41516540" checked=""/><div class="controls bullet"><span class="by">rbranson</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41516394">parent</a><span>|</span><a href="#41516241">next</a><span>|</span><label class="collapse" for="c-41516540">[-]</label><label class="expand" for="c-41516540">[3 more]</label></div><br/><div class="children"><div class="content">Yeah, this almost never happens in practice. It’s not even worth being concerned about.</div><br/><div id="41516987" class="c"><input type="checkbox" id="c-41516987" checked=""/><div class="controls bullet"><span class="by">nikisweeting</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41516540">parent</a><span>|</span><a href="#41516241">next</a><span>|</span><label class="collapse" for="c-41516987">[-]</label><label class="expand" for="c-41516987">[2 more]</label></div><br/><div class="children"><div class="content">Happened all the time to me before I did some tuning   Depends how much write contention you have and how long open transactions take to finish.</div><br/><div id="41518130" class="c"><input type="checkbox" id="c-41518130" checked=""/><div class="controls bullet"><span class="by">rbranson</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41516987">parent</a><span>|</span><a href="#41516241">next</a><span>|</span><label class="collapse" for="c-41518130">[-]</label><label class="expand" for="c-41518130">[1 more]</label></div><br/><div class="children"><div class="content">The list of circumstances for WAL-mode busy errors is in the doc linked by one of the posters above. It has nothing to do with transactions.</div><br/></div></div></div></div></div></div></div></div><div id="41516241" class="c"><input type="checkbox" id="c-41516241" checked=""/><div class="controls bullet"><span class="by">adamtaylor_13</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41515734">parent</a><span>|</span><a href="#41516394">prev</a><span>|</span><a href="#41514550">next</a><span>|</span><label class="collapse" for="c-41516241">[-]</label><label class="expand" for="c-41516241">[2 more]</label></div><br/><div class="children"><div class="content">…what? No it doesn’t. Go read the article. Every optimization listed addresses a different performance aspect of SQLite.</div><br/><div id="41516541" class="c"><input type="checkbox" id="c-41516541" checked=""/><div class="controls bullet"><span class="by">rbranson</span><span>|</span><a href="#41514459">root</a><span>|</span><a href="#41516241">parent</a><span>|</span><a href="#41514550">next</a><span>|</span><label class="collapse" for="c-41516541">[-]</label><label class="expand" for="c-41516541">[1 more]</label></div><br/><div class="children"><div class="content">How does busy_timeout address a performance aspect of SQLite?</div><br/></div></div></div></div></div></div></div></div><div id="41514550" class="c"><input type="checkbox" id="c-41514550" checked=""/><div class="controls bullet"><span class="by">NortySpock</span><span>|</span><a href="#41514459">parent</a><span>|</span><a href="#41514535">prev</a><span>|</span><a href="#41514565">next</a><span>|</span><label class="collapse" for="c-41514550">[-]</label><label class="expand" for="c-41514550">[1 more]</label></div><br/><div class="children"><div class="content">I thought it was a pretty good list of common Rails-application-specific and sqlite3-specific knobs to turn, for newcomers to performance tuning. (Really just a guided tour though -- turn this knob to enable this particular tool for dealing with concurrency problems...)</div><br/></div></div></div></div></div></div></div></div></div></body></html>