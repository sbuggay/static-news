<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1699520478082" as="style"/><link rel="stylesheet" href="styles.css?v=1699520478082"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.swift.org/blog/swift-5.9-backtraces/">On-Crash Backtraces in Swift</a>Â <span class="domain">(<a href="https://www.swift.org">www.swift.org</a>)</span></div><div class="subtext"><span>yaglo</span> | <span>13 comments</span></div><br/><div><div id="38200187" class="c"><input type="checkbox" id="c-38200187" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#38201115">next</a><span>|</span><label class="collapse" for="c-38200187">[-]</label><label class="expand" for="c-38200187">[1 more]</label></div><br/><div class="children"><div class="content">Hah that&#x27;s funny, I recently ported the Swift compiler to a Debian package using the Ubuntu package (aside: why is Debian not supported, that baffles me, especially for Swift on Linux server? But Ubuntu is?).<p>I thought I did something wrong when the crash reported looked so different. I was unaware, that since the last time I did this (ubuntu-&gt;debian .deb), the compiler had changed its error reporting.<p>Props to the Swift team doing the good work, and please add a .deb to the binaries artefacts!</div><br/></div></div><div id="38201115" class="c"><input type="checkbox" id="c-38201115" checked=""/><div class="controls bullet"><span class="by">andrewjl</span><span>|</span><a href="#38200187">prev</a><span>|</span><a href="#38198639">next</a><span>|</span><label class="collapse" for="c-38201115">[-]</label><label class="expand" for="c-38201115">[1 more]</label></div><br/><div class="children"><div class="content">Here are some links to related discussions from the Swift forums<p><a href="https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;backtraces-in-swift&#x2F;61736" rel="nofollow noreferrer">https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;backtraces-in-swift&#x2F;61736</a><p><a href="https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;pitch-swift-backtracing-api&#x2F;62741" rel="nofollow noreferrer">https:&#x2F;&#x2F;forums.swift.org&#x2F;t&#x2F;pitch-swift-backtracing-api&#x2F;62741</a><p>I found the backtracing API design discussions in the second link especially illuminating</div><br/></div></div><div id="38198639" class="c"><input type="checkbox" id="c-38198639" checked=""/><div class="controls bullet"><span class="by">yaglo</span><span>|</span><a href="#38201115">prev</a><span>|</span><a href="#38200994">next</a><span>|</span><label class="collapse" for="c-38198639">[-]</label><label class="expand" for="c-38198639">[6 more]</label></div><br/><div class="children"><div class="content">The best part of is that you can get all this goodness even without having Swift code in your codebase.<p>Just link your C++ (or whatever) project with The Swift runtime (swiftrt.o and libswiftCore.so), and there you have it without writing any Swift.</div><br/><div id="38199531" class="c"><input type="checkbox" id="c-38199531" checked=""/><div class="controls bullet"><span class="by">eatonphil</span><span>|</span><a href="#38198639">parent</a><span>|</span><a href="#38199343">next</a><span>|</span><label class="collapse" for="c-38199531">[-]</label><label class="expand" for="c-38199531">[3 more]</label></div><br/><div class="children"><div class="content">Looks like &lt;stacktrace&gt; is already part of C++23 [0]. But if you must use an older C++, why link the entire Swift runtime rather than something GCC&#x27;s builtin backtraces [1] or libbacktrace [2]?<p>[0] <a href="https:&#x2F;&#x2F;www.sandordargo.com&#x2F;blog&#x2F;2022&#x2F;09&#x2F;21&#x2F;cpp23-stacktrace-library" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.sandordargo.com&#x2F;blog&#x2F;2022&#x2F;09&#x2F;21&#x2F;cpp23-stacktrace...</a><p>[1] <a href="https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;libc&#x2F;manual&#x2F;html_node&#x2F;Backtraces.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;libc&#x2F;manual&#x2F;html_node&#x2F;Backtrace...</a><p>[2] <a href="https:&#x2F;&#x2F;github.com&#x2F;ianlancetaylor&#x2F;libbacktrace">https:&#x2F;&#x2F;github.com&#x2F;ianlancetaylor&#x2F;libbacktrace</a></div><br/><div id="38200572" class="c"><input type="checkbox" id="c-38200572" checked=""/><div class="controls bullet"><span class="by">favorited</span><span>|</span><a href="#38198639">root</a><span>|</span><a href="#38199531">parent</a><span>|</span><a href="#38201509">next</a><span>|</span><label class="collapse" for="c-38200572">[-]</label><label class="expand" for="c-38200572">[1 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re on the Mac, your process is probably linking the Swift runtime anyway.  Foundation.framework is being reimplemented in Swift, so if your process links Foundation (or even just CF), you&#x27;ve got the Swift runtime.</div><br/></div></div><div id="38201509" class="c"><input type="checkbox" id="c-38201509" checked=""/><div class="controls bullet"><span class="by">anarazel</span><span>|</span><a href="#38198639">root</a><span>|</span><a href="#38199531">parent</a><span>|</span><a href="#38200572">prev</a><span>|</span><a href="#38199343">next</a><span>|</span><label class="collapse" for="c-38201509">[-]</label><label class="expand" for="c-38201509">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think &lt;stacktrace&gt; is async signal safe, and thus shouldn&#x27;t be used for in-process crash reporting.</div><br/></div></div></div></div><div id="38199343" class="c"><input type="checkbox" id="c-38199343" checked=""/><div class="controls bullet"><span class="by">krackers</span><span>|</span><a href="#38198639">parent</a><span>|</span><a href="#38199531">prev</a><span>|</span><a href="#38200994">next</a><span>|</span><label class="collapse" for="c-38199343">[-]</label><label class="expand" for="c-38199343">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re on mac (where I assume the two are already available), what compiler flags need to be passed in to do this?</div><br/><div id="38201272" class="c"><input type="checkbox" id="c-38201272" checked=""/><div class="controls bullet"><span class="by">torarnv</span><span>|</span><a href="#38198639">root</a><span>|</span><a href="#38199343">parent</a><span>|</span><a href="#38200994">next</a><span>|</span><label class="collapse" for="c-38201272">[-]</label><label class="expand" for="c-38201272">[1 more]</label></div><br/><div class="children"><div class="content">$ clang++ foo.cpp -o foo -framework Foundation<p>-lswift_Backtracing also works, but dunno if that&#x27;s &quot;public API&quot;<p>$ codesign --force --sign - --entitlements entitlements.plist foo<p><a href="https:&#x2F;&#x2F;github.com&#x2F;apple&#x2F;swift&#x2F;blob&#x2F;main&#x2F;docs&#x2F;Backtracing.rst#macos">https:&#x2F;&#x2F;github.com&#x2F;apple&#x2F;swift&#x2F;blob&#x2F;main&#x2F;docs&#x2F;Backtracing.rs...</a><p>$ SWIFT_BACKTRACE=&quot;enable=yes&quot; .&#x2F;foo<p>Very cool!</div><br/></div></div></div></div></div></div><div id="38200994" class="c"><input type="checkbox" id="c-38200994" checked=""/><div class="controls bullet"><span class="by">driggs</span><span>|</span><a href="#38198639">prev</a><span>|</span><a href="#38200017">next</a><span>|</span><label class="collapse" for="c-38200994">[-]</label><label class="expand" for="c-38200994">[1 more]</label></div><br/><div class="children"><div class="content">Great that it lets you attach the debugger if it&#x27;s running as interactive process.<p>Does that get you a full Swift REPL like Python&#x27;s debugger does?</div><br/></div></div><div id="38200017" class="c"><input type="checkbox" id="c-38200017" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#38200994">prev</a><span>|</span><label class="collapse" for="c-38200017">[-]</label><label class="expand" for="c-38200017">[3 more]</label></div><br/><div class="children"><div class="content">&gt; The backtracer also skips over system frames and Swift thunks by default.<p>Boo! Show me my system frames!<p>(Also, is this available in the Xcode toolchain yet?)</div><br/><div id="38200229" class="c"><input type="checkbox" id="c-38200229" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#38200017">parent</a><span>|</span><a href="#38200109">next</a><span>|</span><label class="collapse" for="c-38200229">[-]</label><label class="expand" for="c-38200229">[1 more]</label></div><br/><div class="children"><div class="content">Part of Swift 5.9 which is in Xcode 15, so, I think so, but it&#x27;s opt-in:<p>&gt; This feature is also available on macOS but is disabled by default. To enable it, set SWIFT_BACKTRACE=enable=yes and sign your program with the com.apple.security.get-task-allow entitlement.<p><a href="https:&#x2F;&#x2F;www.swift.org&#x2F;blog&#x2F;swift-5.9-released&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.swift.org&#x2F;blog&#x2F;swift-5.9-released&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>