<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1688634067077" as="style"/><link rel="stylesheet" href="styles.css?v=1688634067077"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sqlite.org/cloudsqlite/doc/trunk/www/index.wiki">Cloud Backed SQLite</a> <span class="domain">(<a href="https://sqlite.org">sqlite.org</a>)</span></div><div class="subtext"><span>nalgeon</span> | <span>67 comments</span></div><br/><div><div id="36612192" class="c"><input type="checkbox" id="c-36612192" checked=""/><div class="controls bullet"><span class="by">noman-land</span><span>|</span><a href="#36611338">next</a><span>|</span><label class="collapse" for="c-36612192">[-]</label><label class="expand" for="c-36612192">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve just been exploring serving large SQLite databases in chunks and querying them with http range requests to prevent downloading the entire database. It&#x27;s pretty awesome!<p>I found a really interesting library called sql.js-httpvfs[0] that does pretty much all the work. I chunked up my 350Mb sqlite db into 43 x 8Mb pieces with the included script and uploaded them with my static files to GitHub, which gets deployed via GitHub Pages.[1]<p>It&#x27;s in the very rough early stages but you can check it out here.<p><a href="https:&#x2F;&#x2F;transcript.fish" rel="nofollow noreferrer">https:&#x2F;&#x2F;transcript.fish</a><p>I recommend going into the console and network tab to see it in action. It&#x27;s impressively quick and I haven&#x27;t even fine-tuned it at all yet. SQLite rules.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;sql.js-httpvfs">https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;sql.js-httpvfs</a><p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;noman-land&#x2F;transcript.fish">https:&#x2F;&#x2F;github.com&#x2F;noman-land&#x2F;transcript.fish</a></div><br/><div id="36612260" class="c"><input type="checkbox" id="c-36612260" checked=""/><div class="controls bullet"><span class="by">dopamean</span><span>|</span><a href="#36612192">parent</a><span>|</span><a href="#36612772">next</a><span>|</span><label class="collapse" for="c-36612260">[-]</label><label class="expand" for="c-36612260">[1 more]</label></div><br/><div class="children"><div class="content">The timing of this is incredible. I was recently given a 120gb SQLite db to work with and I was going to investigate ways to work with it in the morning.</div><br/></div></div><div id="36612772" class="c"><input type="checkbox" id="c-36612772" checked=""/><div class="controls bullet"><span class="by">eterevsky</span><span>|</span><a href="#36612192">parent</a><span>|</span><a href="#36612260">prev</a><span>|</span><a href="#36612426">next</a><span>|</span><label class="collapse" for="c-36612772">[-]</label><label class="expand" for="c-36612772">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know much about SQLite internals, but on the face of it it sounds hacky as hell (pardon if I&#x27;m wrong).<p>Wouldn&#x27;t it be better to make a proper client-server API similar to traditional SQL databases, but on top of SQLite?</div><br/><div id="36612916" class="c"><input type="checkbox" id="c-36612916" checked=""/><div class="controls bullet"><span class="by">ComodoHacker</span><span>|</span><a href="#36612192">root</a><span>|</span><a href="#36612772">parent</a><span>|</span><a href="#36612426">next</a><span>|</span><label class="collapse" for="c-36612916">[-]</label><label class="expand" for="c-36612916">[1 more]</label></div><br/><div class="children"><div class="content">The point is to use dumb cheap blob storage instead of CPU-consuming server someone has to manage.</div><br/></div></div></div></div><div id="36612426" class="c"><input type="checkbox" id="c-36612426" checked=""/><div class="controls bullet"><span class="by">snowstormsun</span><span>|</span><a href="#36612192">parent</a><span>|</span><a href="#36612772">prev</a><span>|</span><a href="#36612743">next</a><span>|</span><label class="collapse" for="c-36612426">[-]</label><label class="expand" for="c-36612426">[1 more]</label></div><br/><div class="children"><div class="content">Wow, that&#x27;s so cool!</div><br/></div></div><div id="36612743" class="c"><input type="checkbox" id="c-36612743" checked=""/><div class="controls bullet"><span class="by">6510</span><span>|</span><a href="#36612192">parent</a><span>|</span><a href="#36612426">prev</a><span>|</span><a href="#36611338">next</a><span>|</span><label class="collapse" for="c-36612743">[-]</label><label class="expand" for="c-36612743">[1 more]</label></div><br/><div class="children"><div class="content">it badly needs {cursor:pointer} for the things one can click on.</div><br/></div></div></div></div><div id="36611338" class="c"><input type="checkbox" id="c-36611338" checked=""/><div class="controls bullet"><span class="by">0xbadcafebee</span><span>|</span><a href="#36612192">prev</a><span>|</span><a href="#36611551">next</a><span>|</span><label class="collapse" for="c-36611338">[-]</label><label class="expand" for="c-36611338">[7 more]</label></div><br/><div class="children"><div class="content">This adds more cache consistency issues, concurrency issues, network blocking issues, authn+z issues, daemon process supervision issues, ... for what? To store your SQL data in a remote data store? I would rather my app shell out to gsutil (or curl!) than deal with all of this.<p>Simple hack: mount a tmpfs filesystem and write your sqlite database there. Every 30 seconds, stop writing, make a copy of the old database to a new file, start writing to the new file, fork a process to copy the database to the object store and delete the old database file when it&#x27;s done. Add a routine during every 30 second check to look for stale files&#x2F;forked processes.<p>Why use that &quot;crazy hack&quot;, versus the impeccably programmed Cloud Backed SQLite solution?<p>- Easier to troubleshoot. The components involved are all loosely-coupled, well tested, highly stable, simple operations. Every step has a well known set of operations and failure modes that can be easily established by a relatively unskilled technician.<p>- File contents are kept in memory, where copies are cheap and fast.<p>- No daemon outside of the program to maintain<p>- Simple global locking semantics for the file copy, independent of the application<p>- Thread-safe<p>- No network blocking of the application<p>- Authentication is... well, whatever you want, but your application doesn&#x27;t have to handle it, an external application can.<p>- It&#x27;s (mostly) independent of your application, requiring less custom coding, allowing you to focus more on your app and less on the bizarre semantics of directly dealing with writes to a networked block object store.</div><br/><div id="36613072" class="c"><input type="checkbox" id="c-36613072" checked=""/><div class="controls bullet"><span class="by">CraigJPerry</span><span>|</span><a href="#36611338">parent</a><span>|</span><a href="#36611816">next</a><span>|</span><label class="collapse" for="c-36613072">[-]</label><label class="expand" for="c-36613072">[1 more]</label></div><br/><div class="children"><div class="content">&gt;&gt; Every 30 seconds, stop writing, make a copy of the old database<p>That sounds so simple that i almost glossed over it. But then the alarm bells started ringing.<p>If you don’t need to collaborate with other people, this kind of hacking is mostly fine (and even where its not fine, you can always upgrade to using filesystem snapshots to reduce copy burden when that becomes an issue and use the sqlite clone features to reduce global lock contention when you grow into that hurdle etc etc) but if you need to collaborate with others, the hacky approaches always lead to tears. And the tears arrive when you’re busy with something else.</div><br/></div></div><div id="36611816" class="c"><input type="checkbox" id="c-36611816" checked=""/><div class="controls bullet"><span class="by">beebmam</span><span>|</span><a href="#36611338">parent</a><span>|</span><a href="#36613072">prev</a><span>|</span><a href="#36611792">next</a><span>|</span><label class="collapse" for="c-36611816">[-]</label><label class="expand" for="c-36611816">[4 more]</label></div><br/><div class="children"><div class="content">Or just use a database like Postgres. It&#x27;s a one liner to download and start up a postgres container.</div><br/><div id="36612129" class="c"><input type="checkbox" id="c-36612129" checked=""/><div class="controls bullet"><span class="by">chaxor</span><span>|</span><a href="#36611338">root</a><span>|</span><a href="#36611816">parent</a><span>|</span><a href="#36611792">next</a><span>|</span><label class="collapse" for="c-36612129">[-]</label><label class="expand" for="c-36612129">[3 more]</label></div><br/><div class="children"><div class="content">Is it really now? I have heavily preferred SQLite to postgres after having nightmares with it many years ago.
I preferred SQLite because I often needed a single 1TB file to hand someone to get started on a project with the DB, which seemed far more complex with postgres.  
There were a ton of steps required to get things set up, just with the installation and authentication alone.  I recall needing to make a few users and passwords and specify which tables were allowed for different users, etc.
It was far, far too complex for just storing data.  Multiple users are extremely uncommon for data analysis, and hiding certain tables isn&#x27;t really needed most of the time.<p>I know it  does have it&#x27;s use cases, but if you don&#x27;t need access control and more complexities, postgres (at least then) seems like so much hassle.<p>If it&#x27;s better now perhaps I may try it, but I can&#x27;t say I have high hopes.</div><br/><div id="36612278" class="c"><input type="checkbox" id="c-36612278" checked=""/><div class="controls bullet"><span class="by">fauigerzigerk</span><span>|</span><a href="#36611338">root</a><span>|</span><a href="#36612129">parent</a><span>|</span><a href="#36612929">next</a><span>|</span><label class="collapse" for="c-36612278">[-]</label><label class="expand" for="c-36612278">[1 more]</label></div><br/><div class="children"><div class="content">Is cloud storage authnz is any less convoluted? I realise you&#x27;re responding only to the &quot;one liner&quot; argument, but as soon as you do anything with SQLite that involves the cloud or authnz or secondary processes, you&#x27;re right back to where you were with client&#x2F;server database systems in terms of complexity.</div><br/></div></div><div id="36612929" class="c"><input type="checkbox" id="c-36612929" checked=""/><div class="controls bullet"><span class="by">sauercrowd</span><span>|</span><a href="#36611338">root</a><span>|</span><a href="#36612129">parent</a><span>|</span><a href="#36612278">prev</a><span>|</span><a href="#36611792">next</a><span>|</span><label class="collapse" for="c-36612929">[-]</label><label class="expand" for="c-36612929">[1 more]</label></div><br/><div class="children"><div class="content">Using the docker container is a breeze - add a POSTGRES_PASSWORD env variable and you&#x27;re all set. I&#x27;d be curios how it performs for a TB of data but I would be surprised if it straight out breaks.<p><a href="https:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;postgres" rel="nofollow noreferrer">https:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;postgres</a></div><br/></div></div></div></div></div></div><div id="36611792" class="c"><input type="checkbox" id="c-36611792" checked=""/><div class="controls bullet"><span class="by">vasco</span><span>|</span><a href="#36611338">parent</a><span>|</span><a href="#36611816">prev</a><span>|</span><a href="#36611551">next</a><span>|</span><label class="collapse" for="c-36611792">[-]</label><label class="expand" for="c-36611792">[1 more]</label></div><br/><div class="children"><div class="content">&gt; ... for what?<p>Backups, replication to different regions, access to the data etc become standardized when it&#x27;s the same as any other cloud bucket. This makes compliance easier and there&#x27;s no need to roll your own solution. I also never had to troubleshoot sqlite, so I&#x27;d trust this will be more robust than what I&#x27;ll come up with, so I don&#x27;t get your troubleshooting argument.<p>Not everyone will care about this, but those can just not use it I guess.</div><br/></div></div></div></div><div id="36611551" class="c"><input type="checkbox" id="c-36611551" checked=""/><div class="controls bullet"><span class="by">p-e-w</span><span>|</span><a href="#36611338">prev</a><span>|</span><a href="#36612503">next</a><span>|</span><label class="collapse" for="c-36611551">[-]</label><label class="expand" for="c-36611551">[13 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand what the goal is here. Wherever the cloud is, there is PostgreSQL, and conveniently, PostgreSQL already solves all of the problems that &quot;Cloud SQLite&quot; creates, with support for concurrent access, higher performance, richer queries, and lots more.<p>Is this just a toy? What are the upsides in practice of deploying an embedded database to a cloud service?</div><br/><div id="36611569" class="c"><input type="checkbox" id="c-36611569" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611551">parent</a><span>|</span><a href="#36611571">next</a><span>|</span><label class="collapse" for="c-36611569">[-]</label><label class="expand" for="c-36611569">[10 more]</label></div><br/><div class="children"><div class="content">Hosting files in S3 is much, much cheaper than running a live instance of PostgreSQL. Incomparably so. We do it specifically to move large, mostly cold, read-only data out of the main RDBMS and into S3 in a way that it can still be queried on-the-fly* without having to be fully downloaded and reconstituted on a server first. Works great and we get to pay S3 prices for storage and <i>nothing</i> for compute. As a kicker, because it&#x27;s S3 we can access it from any availability zone without paying for cross-AZ data transfer. For the size and coldness of this data, the juice is worth the squeeze. None of the downsides matter for our use case at all.<p>* Using indexes and only touching the pages you need. This is specifically <i>much</i> better than S3 Select, which we considered as an alternative.</div><br/><div id="36612829" class="c"><input type="checkbox" id="c-36612829" checked=""/><div class="controls bullet"><span class="by">DeathArrow</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36611569">parent</a><span>|</span><a href="#36612066">next</a><span>|</span><label class="collapse" for="c-36612829">[-]</label><label class="expand" for="c-36612829">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Hosting files in S3 is much, much cheaper than running a live instance of PostgreSQL.<p>If your app is running on premises and the DB is on cloud, you can also move the DB on premises so the costs are lower.<p>If your app runs on cloud, too, then you already are paying for the cloud compute so you can just fire up an VM and install Postgres on that.</div><br/></div></div><div id="36612066" class="c"><input type="checkbox" id="c-36612066" checked=""/><div class="controls bullet"><span class="by">qaq</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36611569">parent</a><span>|</span><a href="#36612829">prev</a><span>|</span><a href="#36611795">next</a><span>|</span><label class="collapse" for="c-36612066">[-]</label><label class="expand" for="c-36612066">[4 more]</label></div><br/><div class="children"><div class="content">This highly depends on app access patterns</div><br/><div id="36612100" class="c"><input type="checkbox" id="c-36612100" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36612066">parent</a><span>|</span><a href="#36611795">next</a><span>|</span><label class="collapse" for="c-36612100">[-]</label><label class="expand" for="c-36612100">[3 more]</label></div><br/><div class="children"><div class="content">Absolutely. I’ll go further and say that you must specifically design the database schema knowing that it’s going to be used this way. Your pages need to be packed full with the data you need and nothing you don’t. Spatial locality matters bigtime since “seeks” are so expensive (additional S3 requests), when in a traditional db it matters much less. Wide tables with a lot of columns that might not be used in a query are a bad idea here.<p>Here’s an in-the-weeds tip for anyone attempting the same: your tables should all be WITHOUT ROWID tables. Otherwise SQLite sprays rows all over the place based on its internal rowids, ruining locality when you attempt to read rows that you thought would be consecutive based on the primary key.</div><br/><div id="36612210" class="c"><input type="checkbox" id="c-36612210" checked=""/><div class="controls bullet"><span class="by">p-e-w</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36612100">parent</a><span>|</span><a href="#36611795">next</a><span>|</span><label class="collapse" for="c-36612210">[-]</label><label class="expand" for="c-36612210">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I’ll go further and say that you must specifically design the database schema knowing that it’s going to be used this way.<p>If it ever turns out, at some point in the future, that you <i>do</i> need features from a standard RDBMS after all, you are going to regret not using Postgres in the first place, because re-engineering all of that is going to be vastly more expensive than what it would have cost to just &quot;do it right&quot; from the start.<p>So it seems that Cloud SQLite is basically a hyper-optimization that only makes sense if you are completely, totally, 100% certain beyond any reasonable doubt that you will <i>never</i> need anything more than that.</div><br/><div id="36612268" class="c"><input type="checkbox" id="c-36612268" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36612210">parent</a><span>|</span><a href="#36611795">next</a><span>|</span><label class="collapse" for="c-36612268">[-]</label><label class="expand" for="c-36612268">[1 more]</label></div><br/><div class="children"><div class="content">I can’t reveal too many internal details but this data lived in the RDBMS for years. Its access patterns are well understood. That’s exactly when you start cost optimizing. If this didn’t work out we’d just move back to the old DB schema that we were already using and pay for a bigger server. If we wanted, we could keep the schema as-is and just move it into SQL Server. That would work just fine, too. No re-engineering required.<p>Don’t know how else to say “we were not born yesterday; we thought of that” politely here. This definitely isn’t something to have your junior devs work on, nor is it appropriate for most DB usage, but that’s different than it not having any use. It’s a relatively straightforward solution to a niche problem.</div><br/></div></div></div></div></div></div></div></div><div id="36611795" class="c"><input type="checkbox" id="c-36611795" checked=""/><div class="controls bullet"><span class="by">BoorishBears</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36611569">parent</a><span>|</span><a href="#36612066">prev</a><span>|</span><a href="#36611571">next</a><span>|</span><label class="collapse" for="c-36611795">[-]</label><label class="expand" for="c-36611795">[4 more]</label></div><br/><div class="children"><div class="content">If you mentioned Athena <i>maybe</i> I could see how this follows what the earlier comment says, but as is your usecase doesn&#x27;t really overlap with why people are building cloud sql products</div><br/><div id="36611857" class="c"><input type="checkbox" id="c-36611857" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36611795">parent</a><span>|</span><a href="#36611571">next</a><span>|</span><label class="collapse" for="c-36611857">[-]</label><label class="expand" for="c-36611857">[3 more]</label></div><br/><div class="children"><div class="content">Am I not “people”? :)<p>I built a SQLite VFS module just like the one linked here, and this is what I use it for in production. My use case obviously does not preclude other people’s use cases. It’s one of many.<p>GP asked whether this is a toy and what the upsides might be. I answered both questions with an example of my production usage and what we get out of it.</div><br/><div id="36612151" class="c"><input type="checkbox" id="c-36612151" checked=""/><div class="controls bullet"><span class="by">BoorishBears</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36611857">parent</a><span>|</span><a href="#36611571">next</a><span>|</span><label class="collapse" for="c-36612151">[-]</label><label class="expand" for="c-36612151">[2 more]</label></div><br/><div class="children"><div class="content">A SQLite VFS module isn&#x27;t a cloud SQL product, my comment refers to companies like fly.io and MotherDuck that are actually selling &quot;embedded database in the cloud&quot;<p>It&#x27;s entirely predicated on developer experience, otherwise there&#x27;s no reason to specifically reach for an embedded database (in-process doesn&#x27;t mean anything when the only thing the process is doing is running your DB)</div><br/><div id="36612186" class="c"><input type="checkbox" id="c-36612186" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611551">root</a><span>|</span><a href="#36612151">parent</a><span>|</span><a href="#36611571">next</a><span>|</span><label class="collapse" for="c-36612186">[-]</label><label class="expand" for="c-36612186">[1 more]</label></div><br/><div class="children"><div class="content">Okay, sure. I’m satisfied that I answered GP’s questions about this VFS module. This HN post is about the VFS module, posted by a notable SQLite extension developer (nalgeon).</div><br/></div></div></div></div></div></div></div></div></div></div><div id="36611571" class="c"><input type="checkbox" id="c-36611571" checked=""/><div class="controls bullet"><span class="by">benatkin</span><span>|</span><a href="#36611551">parent</a><span>|</span><a href="#36611569">prev</a><span>|</span><a href="#36611819">next</a><span>|</span><label class="collapse" for="c-36611571">[-]</label><label class="expand" for="c-36611571">[1 more]</label></div><br/><div class="children"><div class="content">I think letting people build their own system of isolated databases that can easily be started up and shut down for writing or randomly accessed for reading could be one use. It could be used for both performance and security. Offline use could also be improved, possibly by sending binary diffs.</div><br/></div></div><div id="36611819" class="c"><input type="checkbox" id="c-36611819" checked=""/><div class="controls bullet"><span class="by">BoorishBears</span><span>|</span><a href="#36611551">parent</a><span>|</span><a href="#36611571">prev</a><span>|</span><a href="#36612503">next</a><span>|</span><label class="collapse" for="c-36611819">[-]</label><label class="expand" for="c-36611819">[1 more]</label></div><br/><div class="children"><div class="content">From my POV this is part of the developer experience push.<p>SQLite running in-process is so convenient to build with that even when people use other DBs they write wrappers to sub it in<p>I guess this is an attempt to let that convenience scale?</div><br/></div></div></div></div><div id="36612503" class="c"><input type="checkbox" id="c-36612503" checked=""/><div class="controls bullet"><span class="by">anyoneamous</span><span>|</span><a href="#36611551">prev</a><span>|</span><a href="#36612201">next</a><span>|</span><label class="collapse" for="c-36612503">[-]</label><label class="expand" for="c-36612503">[4 more]</label></div><br/><div class="children"><div class="content">Lots of people here talking about S3, and yet:<p>&gt; The system currently supports Azure Blob Storage and Google Cloud Storage.<p>I&#x27;d interpret that as either a hard &quot;fuck you&quot; to AWS, or a sign that the S3 API is somehow more difficult to use for this purpose.</div><br/><div id="36612970" class="c"><input type="checkbox" id="c-36612970" checked=""/><div class="controls bullet"><span class="by">FooBarWidget</span><span>|</span><a href="#36612503">parent</a><span>|</span><a href="#36612747">prev</a><span>|</span><a href="#36612201">next</a><span>|</span><label class="collapse" for="c-36612970">[-]</label><label class="expand" for="c-36612970">[2 more]</label></div><br/><div class="children"><div class="content">The S3 API doesn&#x27;t have the concurrency control primitives necessary to guarantee consistency in the face of concurrent writes.<p>I wrote a distributed lock on Google Cloud Storage. <a href="https:&#x2F;&#x2F;www.joyfulbikeshedding.com&#x2F;blog&#x2F;2021-05-19-robust-distributed-locking-algorithm-based-on-google-cloud-storage.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.joyfulbikeshedding.com&#x2F;blog&#x2F;2021-05-19-robust-di...</a>
During my research it was quickly evident that GCS has more concurrency control primitives than S3. Heck S3 didn&#x27;t even guarantee strong read-after-write until recently.</div><br/><div id="36613011" class="c"><input type="checkbox" id="c-36613011" checked=""/><div class="controls bullet"><span class="by">fs111</span><span>|</span><a href="#36612503">root</a><span>|</span><a href="#36612970">parent</a><span>|</span><a href="#36612201">next</a><span>|</span><label class="collapse" for="c-36613011">[-]</label><label class="expand" for="c-36613011">[1 more]</label></div><br/><div class="children"><div class="content">&gt; until recently<p>Almost 3 years <a href="https:&#x2F;&#x2F;aws.amazon.com&#x2F;blogs&#x2F;aws&#x2F;amazon-s3-update-strong-read-after-write-consistency&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;aws.amazon.com&#x2F;blogs&#x2F;aws&#x2F;amazon-s3-update-strong-rea...</a></div><br/></div></div></div></div></div></div><div id="36612201" class="c"><input type="checkbox" id="c-36612201" checked=""/><div class="controls bullet"><span class="by">up2isomorphism</span><span>|</span><a href="#36612503">prev</a><span>|</span><a href="#36611619">next</a><span>|</span><label class="collapse" for="c-36612201">[-]</label><label class="expand" for="c-36612201">[1 more]</label></div><br/><div class="children"><div class="content">Linus had once said database people seldom have good taste, I have to agree with him in this case.</div><br/></div></div><div id="36611619" class="c"><input type="checkbox" id="c-36611619" checked=""/><div class="controls bullet"><span class="by">rsync</span><span>|</span><a href="#36612201">prev</a><span>|</span><a href="#36611175">next</a><span>|</span><label class="collapse" for="c-36611619">[-]</label><label class="expand" for="c-36611619">[10 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been (proudly) noting these elegant one-liners for ... 18 years now:<p><pre><code>  pg_dump -U postgres db | ssh user@rsync.net &quot;dd of=db_dump&quot;

  mysqldump -u mysql db | ssh user@rsync.net &quot;dd of=db_dump&quot;
</code></pre>
... but what is the equivalent command for SQLite ?<p>I see that there is a &#x27;.dump&#x27; command for use <i>within</i> the SQLite console but that wouldn&#x27;t be suitable for pipelining ... is there not a standalone &#x27;sqlitedump&#x27; binary ?</div><br/><div id="36611691" class="c"><input type="checkbox" id="c-36611691" checked=""/><div class="controls bullet"><span class="by">troyjfarrell</span><span>|</span><a href="#36611619">parent</a><span>|</span><a href="#36612113">next</a><span>|</span><label class="collapse" for="c-36611691">[-]</label><label class="expand" for="c-36611691">[1 more]</label></div><br/><div class="children"><div class="content">I believe that you can echo the &#x27;.dump&#x27; command to SQLite.<p><pre><code>    echo .dump | sqlite3 db | ssh user@rsync.net &quot;dd of=db_dump&quot;
</code></pre>
It worked for me.</div><br/></div></div><div id="36612113" class="c"><input type="checkbox" id="c-36612113" checked=""/><div class="controls bullet"><span class="by">oefrha</span><span>|</span><a href="#36611619">parent</a><span>|</span><a href="#36611691">prev</a><span>|</span><a href="#36611729">next</a><span>|</span><label class="collapse" for="c-36612113">[-]</label><label class="expand" for="c-36612113">[3 more]</label></div><br/><div class="children"><div class="content">The .backup command is better than than the .dump command suggested in siblings, as it doesn’t block all writes until it completes. You can then do anything with the backup. (Do keep in mind there’s the .backup never finishing problem on a db with non-stop writes.)</div><br/><div id="36612741" class="c"><input type="checkbox" id="c-36612741" checked=""/><div class="controls bullet"><span class="by">polyrand</span><span>|</span><a href="#36611619">root</a><span>|</span><a href="#36612113">parent</a><span>|</span><a href="#36611729">next</a><span>|</span><label class="collapse" for="c-36612741">[-]</label><label class="expand" for="c-36612741">[2 more]</label></div><br/><div class="children"><div class="content">The .dump command creates a read transaction[0], so it shouldn&#x27;t block any writes.<p>From the SQLite docs:<p><pre><code>  When a SAVEPOINT is the outer-most savepoint and it is not within a BEGIN...COMMIT then the behavior is the same as BEGIN DEFERRED TRANSACTION
</code></pre>
Internally, the .dump command only runs SELECT queries.<p>[0]: <a href="https:&#x2F;&#x2F;github.com&#x2F;sqlite&#x2F;sqlite&#x2F;blob&#x2F;3748b7329f5cdbab0dc486ac484c1801fa6f08dc&#x2F;src&#x2F;shell.c.in#L8439">https:&#x2F;&#x2F;github.com&#x2F;sqlite&#x2F;sqlite&#x2F;blob&#x2F;3748b7329f5cdbab0dc486...</a></div><br/><div id="36612853" class="c"><input type="checkbox" id="c-36612853" checked=""/><div class="controls bullet"><span class="by">oefrha</span><span>|</span><a href="#36611619">root</a><span>|</span><a href="#36612741">parent</a><span>|</span><a href="#36611729">next</a><span>|</span><label class="collapse" for="c-36612853">[-]</label><label class="expand" for="c-36612853">[1 more]</label></div><br/><div class="children"><div class="content">A read transaction does block writes, unless you enable WAL mode, which I forgot to mention.</div><br/></div></div></div></div></div></div><div id="36611729" class="c"><input type="checkbox" id="c-36611729" checked=""/><div class="controls bullet"><span class="by">throwawaaarrgh</span><span>|</span><a href="#36611619">parent</a><span>|</span><a href="#36612113">prev</a><span>|</span><a href="#36611682">next</a><span>|</span><label class="collapse" for="c-36611729">[-]</label><label class="expand" for="c-36611729">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  sqlite3 my_database .dump | gzip -c | ssh foo &quot;dd of=db_dump&quot;
</code></pre>
Technically .backup is better because it locks less and batches operations, rather than doing a bunch of selects in a transaction. Do you prefer slowly filling up local disk or locking all writes?</div><br/></div></div><div id="36611682" class="c"><input type="checkbox" id="c-36611682" checked=""/><div class="controls bullet"><span class="by">comex</span><span>|</span><a href="#36611619">parent</a><span>|</span><a href="#36611729">prev</a><span>|</span><a href="#36612561">next</a><span>|</span><label class="collapse" for="c-36611682">[-]</label><label class="expand" for="c-36611682">[1 more]</label></div><br/><div class="children"><div class="content">You can pass console commands as arguments:<p><pre><code>    sqlite3 &#x2F;path&#x2F;to&#x2F;db.sqlite .dump</code></pre></div><br/></div></div><div id="36612561" class="c"><input type="checkbox" id="c-36612561" checked=""/><div class="controls bullet"><span class="by">jamietanna</span><span>|</span><a href="#36611619">parent</a><span>|</span><a href="#36611682">prev</a><span>|</span><a href="#36611684">next</a><span>|</span><label class="collapse" for="c-36612561">[-]</label><label class="expand" for="c-36612561">[2 more]</label></div><br/><div class="children"><div class="content">Couldn&#x27;t you also just `cp` the SQLite DB file?</div><br/><div id="36612949" class="c"><input type="checkbox" id="c-36612949" checked=""/><div class="controls bullet"><span class="by">idoubtit</span><span>|</span><a href="#36611619">root</a><span>|</span><a href="#36612561">parent</a><span>|</span><a href="#36611684">next</a><span>|</span><label class="collapse" for="c-36612949">[-]</label><label class="expand" for="c-36612949">[1 more]</label></div><br/><div class="children"><div class="content">In many cases, `cp` on the DB file won&#x27;t be enough. For instance, when WAL (Write Ahead Logging) is enabled (which is much faster than the old rollback journal), some data may lie in other files aside the main DB.<p>I once had a problem where my application couldn&#x27;t read from a SQLite DB whose file was read-only. Turned out that even a read-only access to the DB required a write access to the directory, for a WAL DB. This was partly fixed years later, but I&#x27;d learned the hard way that a SQLite DB may be more than a single file.</div><br/></div></div></div></div></div></div><div id="36611175" class="c"><input type="checkbox" id="c-36611175" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#36611619">prev</a><span>|</span><a href="#36611512">next</a><span>|</span><label class="collapse" for="c-36611175">[-]</label><label class="expand" for="c-36611175">[5 more]</label></div><br/><div class="children"><div class="content">It is not clear to me - is this an officially supported, core module? Or more, &quot;You can technically do this, but ehhhh&quot; kind of deal?<p>Would this mean I might eventually be able to do something insane like run Datasette (from within Pyodide) against an external cloud storage?</div><br/><div id="36611288" class="c"><input type="checkbox" id="c-36611288" checked=""/><div class="controls bullet"><span class="by">benatkin</span><span>|</span><a href="#36611175">parent</a><span>|</span><a href="#36611432">next</a><span>|</span><label class="collapse" for="c-36611288">[-]</label><label class="expand" for="c-36611288">[1 more]</label></div><br/><div class="children"><div class="content">It seems like they&#x27;re taking a bottom-up approach. I can&#x27;t see any link to it on the main site. It would probably first bubble up to the News page, like WebAssembly did on 2022-11-16. <a href="https:&#x2F;&#x2F;sqlite.org&#x2F;news.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite.org&#x2F;news.html</a> WebAssembly also has a URL inside the root that redirects to doc&#x2F;trunk&#x2F;www&#x2F;index.wiki: <a href="https:&#x2F;&#x2F;sqlite.org&#x2F;wasm&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite.org&#x2F;wasm&#x2F;</a></div><br/></div></div><div id="36611432" class="c"><input type="checkbox" id="c-36611432" checked=""/><div class="controls bullet"><span class="by">rickette</span><span>|</span><a href="#36611175">parent</a><span>|</span><a href="#36611288">prev</a><span>|</span><a href="#36611228">next</a><span>|</span><label class="collapse" for="c-36611432">[-]</label><label class="expand" for="c-36611432">[1 more]</label></div><br/><div class="children"><div class="content">It looks really promising, would also love to know the status of this. Can&#x27;t find any announcements of this yet.</div><br/></div></div><div id="36611337" class="c"><input type="checkbox" id="c-36611337" checked=""/><div class="controls bullet"><span class="by">captn3m0</span><span>|</span><a href="#36611175">parent</a><span>|</span><a href="#36611228">prev</a><span>|</span><a href="#36611512">next</a><span>|</span><label class="collapse" for="c-36611337">[-]</label><label class="expand" for="c-36611337">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think the blob storage APIs (which this seems to be using, instead of accessing over the web-gateway urls) are CORS accessible. So you might have to proxy it.<p>However, it might become possible to run datasette etc much more easily in an edge function.</div><br/></div></div></div></div><div id="36611512" class="c"><input type="checkbox" id="c-36611512" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611175">prev</a><span>|</span><a href="#36611859">next</a><span>|</span><label class="collapse" for="c-36611512">[-]</label><label class="expand" for="c-36611512">[2 more]</label></div><br/><div class="children"><div class="content">SQLite&#x27;s VFS layer is flexible and easy-to-use. There are lots of implementations (public and private) of this &quot;use a SQLite database directly from cloud object storage&quot; idea because it&#x27;s pretty obvious how to do it when you look at the VFS functions that you have to implement. If you do a read-only implementation, it&#x27;s an afternoon project. It&#x27;s mostly a matter of following the VFS docs and when you&#x27;re about halfway done implementing the functions, SQL queries start working instead of producing errors. The only tricky bit, as always, is caching.</div><br/><div id="36612563" class="c"><input type="checkbox" id="c-36612563" checked=""/><div class="controls bullet"><span class="by">noman-land</span><span>|</span><a href="#36611512">parent</a><span>|</span><a href="#36611859">next</a><span>|</span><label class="collapse" for="c-36612563">[-]</label><label class="expand" for="c-36612563">[1 more]</label></div><br/><div class="children"><div class="content">I used this[0] awesome library to do just this over http. I posted more info in my other comment. I&#x27;m still exploring but so far it&#x27;s been pretty impressive to me.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;sql.js-httpvfs">https:&#x2F;&#x2F;github.com&#x2F;phiresky&#x2F;sql.js-httpvfs</a></div><br/></div></div></div></div><div id="36611859" class="c"><input type="checkbox" id="c-36611859" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#36611512">prev</a><span>|</span><a href="#36611156">next</a><span>|</span><label class="collapse" for="c-36611859">[-]</label><label class="expand" for="c-36611859">[13 more]</label></div><br/><div class="children"><div class="content">I always wondered by never bothered to implement:<p>What if I would implement an S3-backed block storage. Like every 16MB chunk is stored in a separate object. And filesystem driver would download&#x2F;upload chunks just like it does it with HDD.<p>And then format this block device with Ext4 or use it in any other way (LVM, encrypted FS, RAID and so on).<p>Is it usable concept?</div><br/><div id="36611968" class="c"><input type="checkbox" id="c-36611968" checked=""/><div class="controls bullet"><span class="by">DaiPlusPlus</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611888">next</a><span>|</span><label class="collapse" for="c-36611968">[-]</label><label class="expand" for="c-36611968">[5 more]</label></div><br/><div class="children"><div class="content">What you&#x27;re describing already exists in Azure Blob Storage (Azure&#x27;s S3 compete), known as <i>Page Blobs</i>, which is also how you host VM HDDs (VHDs) in Azure, as it allows for page-level (i.e. disk-block-level) reads&#x2F;writes.<p>I&#x27;m not clued-in to AWS&#x27;s equivalent, but a quick google suggests it&#x27;s AWS EBS (Elastic Block Storage), though it doesn&#x27;t seem to coexist side-by-side with normal S3 storage, and their API for reading&#x2F;writing blocks looks considerably more complicated than Azure&#x27;s: <a href="https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AWSEC2&#x2F;latest&#x2F;UserGuide&#x2F;ebs-accessing-snapshot.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AWSEC2&#x2F;latest&#x2F;UserGuide&#x2F;ebs-acce...</a></div><br/><div id="36612128" class="c"><input type="checkbox" id="c-36612128" checked=""/><div class="controls bullet"><span class="by">yread</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36611968">parent</a><span>|</span><a href="#36612152">next</a><span>|</span><label class="collapse" for="c-36612128">[-]</label><label class="expand" for="c-36612128">[3 more]</label></div><br/><div class="children"><div class="content">Their fuse-based filesystem driver even supported CACHED block access ie you would download, cache and read the blocks you needed locally instead of sending every read over the wire. Close to local fs performance for little space</div><br/><div id="36612144" class="c"><input type="checkbox" id="c-36612144" checked=""/><div class="controls bullet"><span class="by">DaiPlusPlus</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36612128">parent</a><span>|</span><a href="#36612152">next</a><span>|</span><label class="collapse" for="c-36612144">[-]</label><label class="expand" for="c-36612144">[2 more]</label></div><br/><div class="children"><div class="content">How does that handle concurrent writes to the same block? How is the cache invalidated?</div><br/><div id="36612242" class="c"><input type="checkbox" id="c-36612242" checked=""/><div class="controls bullet"><span class="by">mappu</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36612144">parent</a><span>|</span><a href="#36612152">next</a><span>|</span><label class="collapse" for="c-36612242">[-]</label><label class="expand" for="c-36612242">[1 more]</label></div><br/><div class="children"><div class="content">The single FUSE process can coordinate all that with an in-memory mutex.<p>This thread is in the context of filesystems like ext4, which are completely unsafe for concurrent mounts - if you connect from multiple machines then it will just corrupt horrifically. If your filesystem was glusterfs, moose&#x2F;lizard, or lustre, then they have ways to handle this (with on-disk locks&#x2F;semaphores in some other sector).</div><br/></div></div></div></div></div></div><div id="36612152" class="c"><input type="checkbox" id="c-36612152" checked=""/><div class="controls bullet"><span class="by">electroly</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36611968">parent</a><span>|</span><a href="#36612128">prev</a><span>|</span><a href="#36611888">next</a><span>|</span><label class="collapse" for="c-36612152">[-]</label><label class="expand" for="c-36612152">[1 more]</label></div><br/><div class="children"><div class="content">Behind the scenes, EBS Snapshots are stored in S3. When you first create an EBS volume from a snapshot, it pulls blocks from S3 on-demand.</div><br/></div></div></div></div><div id="36611888" class="c"><input type="checkbox" id="c-36611888" checked=""/><div class="controls bullet"><span class="by">damagednoob</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611968">prev</a><span>|</span><a href="#36611889">next</a><span>|</span><label class="collapse" for="c-36611888">[-]</label><label class="expand" for="c-36611888">[1 more]</label></div><br/><div class="children"><div class="content">Not sure if it&#x27;s a usable concept but it sounds similar to what someone else did[1]:<p>&gt; ...I implemented a virtual file system that fetches chunks of the database with HTTP Range requests when SQLite tries to read from the filesystem...<p>[1]: <a href="https:&#x2F;&#x2F;phiresky.github.io&#x2F;blog&#x2F;2021&#x2F;hosting-sqlite-databases-on-github-pages&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;phiresky.github.io&#x2F;blog&#x2F;2021&#x2F;hosting-sqlite-database...</a></div><br/></div></div><div id="36611889" class="c"><input type="checkbox" id="c-36611889" checked=""/><div class="controls bullet"><span class="by">kirubakaran</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611888">prev</a><span>|</span><a href="#36611916">next</a><span>|</span><label class="collapse" for="c-36611889">[-]</label><label class="expand" for="c-36611889">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;s3fs-fuse&#x2F;s3fs-fuse">https:&#x2F;&#x2F;github.com&#x2F;s3fs-fuse&#x2F;s3fs-fuse</a></div><br/><div id="36611959" class="c"><input type="checkbox" id="c-36611959" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36611889">parent</a><span>|</span><a href="#36611916">next</a><span>|</span><label class="collapse" for="c-36611959">[-]</label><label class="expand" for="c-36611959">[1 more]</label></div><br/><div class="children"><div class="content">It uses S3 as a filesystem. I&#x27;m talking about using S3 as a block device. Slightly different approach.</div><br/></div></div></div></div><div id="36611916" class="c"><input type="checkbox" id="c-36611916" checked=""/><div class="controls bullet"><span class="by">franky47</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611889">prev</a><span>|</span><a href="#36611921">next</a><span>|</span><label class="collapse" for="c-36611916">[-]</label><label class="expand" for="c-36611916">[1 more]</label></div><br/><div class="children"><div class="content">Sounds like a very expensive way to build a filesystem.</div><br/></div></div><div id="36611921" class="c"><input type="checkbox" id="c-36611921" checked=""/><div class="controls bullet"><span class="by">cbluth</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611916">prev</a><span>|</span><a href="#36611919">next</a><span>|</span><label class="collapse" for="c-36611921">[-]</label><label class="expand" for="c-36611921">[2 more]</label></div><br/><div class="children"><div class="content">Yes, its called s3backer</div><br/><div id="36611965" class="c"><input type="checkbox" id="c-36611965" checked=""/><div class="controls bullet"><span class="by">vbezhenar</span><span>|</span><a href="#36611859">root</a><span>|</span><a href="#36611921">parent</a><span>|</span><a href="#36611919">next</a><span>|</span><label class="collapse" for="c-36611965">[-]</label><label class="expand" for="c-36611965">[1 more]</label></div><br/><div class="children"><div class="content">Thanks, that&#x27;s the thing.</div><br/></div></div></div></div><div id="36611919" class="c"><input type="checkbox" id="c-36611919" checked=""/><div class="controls bullet"><span class="by">candiodari</span><span>|</span><a href="#36611859">parent</a><span>|</span><a href="#36611921">prev</a><span>|</span><a href="#36611156">next</a><span>|</span><label class="collapse" for="c-36611919">[-]</label><label class="expand" for="c-36611919">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;s3fs-fuse&#x2F;s3fs-fuse&#x2F;wiki&#x2F;Fuse-Over-Amazon">https:&#x2F;&#x2F;github.com&#x2F;s3fs-fuse&#x2F;s3fs-fuse&#x2F;wiki&#x2F;Fuse-Over-Amazon</a><p>Seems like a usable concept yes.</div><br/></div></div></div></div><div id="36611156" class="c"><input type="checkbox" id="c-36611156" checked=""/><div class="controls bullet"><span class="by">schemescape</span><span>|</span><a href="#36611859">prev</a><span>|</span><a href="#36611489">next</a><span>|</span><label class="collapse" for="c-36611156">[-]</label><label class="expand" for="c-36611156">[3 more]</label></div><br/><div class="children"><div class="content">Edit: I misread the date, as pointed out in a reply.<p>Why does the forum say some messages are from 19 years ago?<p><a href="https:&#x2F;&#x2F;sqlite.org&#x2F;cloudsqlite&#x2F;forum" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite.org&#x2F;cloudsqlite&#x2F;forum</a></div><br/><div id="36611189" class="c"><input type="checkbox" id="c-36611189" checked=""/><div class="controls bullet"><span class="by">benatkin</span><span>|</span><a href="#36611156">parent</a><span>|</span><a href="#36611201">next</a><span>|</span><label class="collapse" for="c-36611189">[-]</label><label class="expand" for="c-36611189">[1 more]</label></div><br/><div class="children"><div class="content">Because they really are years old, and not days old.<p>Except it&#x27;s 1.19 years ago.<p>And the oldest one is from 2020. <a href="https:&#x2F;&#x2F;sqlite.org&#x2F;cloudsqlite&#x2F;forumpost&#x2F;da9d84ff6e" rel="nofollow noreferrer">https:&#x2F;&#x2F;sqlite.org&#x2F;cloudsqlite&#x2F;forumpost&#x2F;da9d84ff6e</a><p>It might be announced recently, but it has been under development for a while.</div><br/></div></div></div></div><div id="36611489" class="c"><input type="checkbox" id="c-36611489" checked=""/><div class="controls bullet"><span class="by">TekMol</span><span>|</span><a href="#36611156">prev</a><span>|</span><label class="collapse" for="c-36611489">[-]</label><label class="expand" for="c-36611489">[2 more]</label></div><br/><div class="children"><div class="content">I guess you could just proxy a normal SQLite DB?<p>Should take only a few lines of PHP. Maybe just one:<p><pre><code>    echo DB::select($_GET[&#x27;query&#x27;]);
</code></pre>
All that is needed is a VM in the cloud. A VM with 10 GB is just $4&#x2F;month these days.<p>And you can add a 100 GB volume for just $10&#x2F;month.</div><br/></div></div></div></div></div></div></div></body></html>