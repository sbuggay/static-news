<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696842083411" as="style"/><link rel="stylesheet" href="styles.css?v=1696842083411"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://render.com/blog/knative">Scaling Knative to 100K+ Webapps</a> <span class="domain">(<a href="https://render.com">render.com</a>)</span></div><div class="subtext"><span>anurag</span> | <span>36 comments</span></div><br/><div><div id="37817834" class="c"><input type="checkbox" id="c-37817834" checked=""/><div class="controls bullet"><span class="by">NickHoff</span><span>|</span><a href="#37814062">next</a><span>|</span><label class="collapse" for="c-37817834">[-]</label><label class="expand" for="c-37817834">[2 more]</label></div><br/><div class="children"><div class="content">I clicked their link to Knative so I could read about it. On the Knative webpage, the cookie banner pops up. I don&#x27;t want to accept so I click &quot;learn more&quot;. That expands the cookie banner to include a button that says &quot;I understand how to opt out, hide this notice&quot; as well as a link to a lengthy explanation of cookies. Well I don&#x27;t want to click the button so I click the link to the cookie explanation. At the bottom of that page are more links to browser documentation that might eventually explain how to opt out, but I can&#x27;t click those links because everything on the page is disabled - because the same cookie popup is on this page too. It blocks interaction, including clicking on their links about how to opt out, until you opt in. This stuff is getting worse.</div><br/><div id="37818070" class="c"><input type="checkbox" id="c-37818070" checked=""/><div class="controls bullet"><span class="by">thih9</span><span>|</span><a href="#37817834">parent</a><span>|</span><a href="#37814062">next</a><span>|</span><label class="collapse" for="c-37818070">[-]</label><label class="expand" for="c-37818070">[1 more]</label></div><br/><div class="children"><div class="content">Having to click “learn more” button is not compliant with GDPR, it should be as easy to not give consent as it is to give consent.<p>Google and Facebook were fined over this[1] and fixed their UI.<p>Many providers of cookie popups respect that too; possibly this will get better long term.<p>[1]: <a href="https:&#x2F;&#x2F;www.lexology.com&#x2F;library&#x2F;detail.aspx?g=6001cd19-ecbf-4d77-93eb-f5ff8453064a" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.lexology.com&#x2F;library&#x2F;detail.aspx?g=6001cd19-ecbf...</a></div><br/></div></div></div></div><div id="37814062" class="c"><input type="checkbox" id="c-37814062" checked=""/><div class="controls bullet"><span class="by">btown</span><span>|</span><a href="#37817834">prev</a><span>|</span><a href="#37815175">next</a><span>|</span><label class="collapse" for="c-37814062">[-]</label><label class="expand" for="c-37814062">[1 more]</label></div><br/><div class="children"><div class="content">This is a case study in why there&#x27;s the word &quot;dev&quot; in devops. While Kubernetes gets really far towards giving you all the dials you need, at the end of the day those dials are the result of low-level code, and of people who made specific (and often well-documented) assumptions in tooling repository pull requests and RFC processes. Just like an application developer might debug or work around an issue with a library dependency by looking at its source code and understanding the nuance of the extension points that exist, and contribute documentation updates or new extension points upstream, a devops team should be empowered to do the same.<p>And from my experience devops is a really welcoming community - people take great pride in making sure their infrastructure tooling covers unorthodox use cases, and meeting them as a collaborator (not just an end user) can be incredibly fulfilling for all involved.<p>(That said, yak shaving is definitely a risk, especially since testing can be complicated with these systems when making low-level tweaks. But it&#x27;s still often useful to roll up one&#x27;s sleeves and read Go code rather than just restricting oneself to coloring within the existing configurability lines.)</div><br/></div></div><div id="37815175" class="c"><input type="checkbox" id="c-37815175" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#37814062">prev</a><span>|</span><a href="#37815456">next</a><span>|</span><label class="collapse" for="c-37815175">[-]</label><label class="expand" for="c-37815175">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;d be nice if the CPU graphs contained the y axis. The proportion is a large drop but it&#x27;s unclear is that&#x27;s 1000m to 100m or 4000m to 250m (a much bigger cost reduction)<p>It also sounds like their knative solution is slowly getting flattened into a load balanced or &quot;smart&quot; L7 proxy.<p>Also curious is they submitted these changes upstream. Seems like a pretty clear use case with numbers behind it which usually helps with interest.<p>Finally, I really love a solution that net deletes code and makes everything faster (and simpler).</div><br/><div id="37815262" class="c"><input type="checkbox" id="c-37815262" checked=""/><div class="controls bullet"><span class="by">redleather</span><span>|</span><a href="#37815175">parent</a><span>|</span><a href="#37815456">next</a><span>|</span><label class="collapse" for="c-37815262">[-]</label><label class="expand" for="c-37815262">[1 more]</label></div><br/><div class="children"><div class="content">Hi there, my name is on the post!
 The CPU graph was a 500 (second) drop in the sum of CPU usage of kube-proxy pods alone. I think this is okay to disclose (we took out most y axes during final edits, this one seems to be a collateral).
You&#x27;re right about the flattening - since this work, we&#x27;ve taken out the pieces of knative we really needed. Right again about embedding some of those pieces in our L7 proxy.
We didn&#x27;t upstream the changes because we feel our use case is atypical - all KServices (Knative Services) only ever had one pod. This constraint enabled most of the simplifications we were able to make.
On the last point - so do we!</div><br/></div></div></div></div><div id="37815456" class="c"><input type="checkbox" id="c-37815456" checked=""/><div class="controls bullet"><span class="by">karakanb</span><span>|</span><a href="#37815175">prev</a><span>|</span><a href="#37814524">next</a><span>|</span><label class="collapse" for="c-37815456">[-]</label><label class="expand" for="c-37815456">[4 more]</label></div><br/><div class="children"><div class="content">This is a really interesting read, thanks for the write up. I had no idea they were running these customer services on k8s, given that it is untrusted code and containers are not the best isolation layer. Are there any pointers on how Render approached running untrusted code in k8s?</div><br/><div id="37816140" class="c"><input type="checkbox" id="c-37816140" checked=""/><div class="controls bullet"><span class="by">cyrnel</span><span>|</span><a href="#37815456">parent</a><span>|</span><a href="#37815501">next</a><span>|</span><label class="collapse" for="c-37816140">[-]</label><label class="expand" for="c-37816140">[1 more]</label></div><br/><div class="children"><div class="content">With the right amount of hardening, containers can provide a relatively secure sandbox. It&#x27;s certainly not built for that which leads to natural weaknesses, but in my experience auditors seem pretty happy with the controls present in OpenShift (page 79): <a href="https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;resources&#x2F;openshift-security-guide-ebook" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.redhat.com&#x2F;en&#x2F;resources&#x2F;openshift-security-guide...</a></div><br/></div></div><div id="37815501" class="c"><input type="checkbox" id="c-37815501" checked=""/><div class="controls bullet"><span class="by">anurag</span><span>|</span><a href="#37815456">parent</a><span>|</span><a href="#37816140">prev</a><span>|</span><a href="#37815686">next</a><span>|</span><label class="collapse" for="c-37815501">[-]</label><label class="expand" for="c-37815501">[1 more]</label></div><br/><div class="children"><div class="content">Containers are just one isolation layer of many we&#x27;ve built into our systems over the years. A topic for another post, and happy to chat if this is something you&#x27;re working on.</div><br/></div></div></div></div><div id="37814524" class="c"><input type="checkbox" id="c-37814524" checked=""/><div class="controls bullet"><span class="by">lbhdc</span><span>|</span><a href="#37815456">prev</a><span>|</span><a href="#37813430">next</a><span>|</span><label class="collapse" for="c-37814524">[-]</label><label class="expand" for="c-37814524">[3 more]</label></div><br/><div class="children"><div class="content">Really interesting read.<p>&gt; With a little experimentation, we discovered that the activator could both wake Pods and reverse-proxy to a woke Pod, even though that behavior wasn’t documented! We just needed to set the right headers.<p>Are you setting those headers on call #2 (tell [knative] autoscaler to bring up pod) in the diagrams from y&#x27;alls other post?<p><a href="https:&#x2F;&#x2F;render.com&#x2F;blog&#x2F;knative-design-doc" rel="nofollow noreferrer">https:&#x2F;&#x2F;render.com&#x2F;blog&#x2F;knative-design-doc</a></div><br/><div id="37815633" class="c"><input type="checkbox" id="c-37815633" checked=""/><div class="controls bullet"><span class="by">redleather</span><span>|</span><a href="#37814524">parent</a><span>|</span><a href="#37813430">next</a><span>|</span><label class="collapse" for="c-37815633">[-]</label><label class="expand" for="c-37815633">[2 more]</label></div><br/><div class="children"><div class="content">Glad you enjoyed it!<p>It was in step #1. Most knative tutorials we found have you set up istio, which was the one setting the headers. There was separate work to rip out istio (which did not scale well either) that we didn&#x27;t include in the post.<p>So istio used to sit between our proxy and knative&#x27;s proxy. In order to figure out what headers it was setting, we ran a caddy container as a sidecar to the activator, and had it output the request metadata. We then read the code to confirm</div><br/></div></div></div></div><div id="37813430" class="c"><input type="checkbox" id="c-37813430" checked=""/><div class="controls bullet"><span class="by">xiwenc</span><span>|</span><a href="#37814524">prev</a><span>|</span><a href="#37813650">next</a><span>|</span><label class="collapse" for="c-37813430">[-]</label><label class="expand" for="c-37813430">[1 more]</label></div><br/><div class="children"><div class="content">Really nice write up.<p>This reminds me of my time building a similar platform back in 2015-ish. It was also a free tier for back then 40k apps. Built on top of cloud foundry. Before k8s was GA.<p>We also suffered from scalability issues which required creative solutions.<p>Good times.</div><br/></div></div><div id="37813650" class="c"><input type="checkbox" id="c-37813650" checked=""/><div class="controls bullet"><span class="by">debarshri</span><span>|</span><a href="#37813430">prev</a><span>|</span><a href="#37816992">next</a><span>|</span><label class="collapse" for="c-37813650">[-]</label><label class="expand" for="c-37813650">[18 more]</label></div><br/><div class="children"><div class="content">In my opinion the economics don&#x27;t workout that well when you building a hosting service on top of k8s especially when you have to compete with amazon on prices. It is tier that has the highest churn and lowest spending power that I feel they marketing too.<p>Would love to hear some thought. May be I am missing something.<p>On the tech side, IPAM can fail to assign IP in k8s. It could be of various reasons. What do you guys do in that case?</div><br/><div id="37818061" class="c"><input type="checkbox" id="c-37818061" checked=""/><div class="controls bullet"><span class="by">esher</span><span>|</span><a href="#37813650">parent</a><span>|</span><a href="#37814416">next</a><span>|</span><label class="collapse" for="c-37818061">[-]</label><label class="expand" for="c-37818061">[2 more]</label></div><br/><div class="children"><div class="content">co-founder of fortrabbit here. We offer a PHP PaaS for 10y+ (on AWS).<p>We started with a free tier (copying the Heroku model) and had to fight with &#x27;free users&#x27; as well.<p>The free tier created a lot of noise distracting us from our paying customers. Support requests from users with no interest ever upgrading, often beginners and noobs. Cat and mouse games with script kiddies trying to abuse the service. Fraud and phishing … Most free tier Apps are just tests, maybe there is an index file printing a hello world. Yet you need to keep some responsibility to keep that data around.<p>After a while we changed it to free trial (try before buy). That works much better for us.</div><br/><div id="37818313" class="c"><input type="checkbox" id="c-37818313" checked=""/><div class="controls bullet"><span class="by">debarshri</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37818061">parent</a><span>|</span><a href="#37814416">next</a><span>|</span><label class="collapse" for="c-37818313">[-]</label><label class="expand" for="c-37818313">[1 more]</label></div><br/><div class="children"><div class="content">Congratulations on running it successfully for 10+ years.<p>Could you share some light on the unit economics of your PaaS?<p>I would assume the cost of acquisition is fair low now that you have a fix trial but how is the customer retention cost. I would assume theres huge amount of support cost as generally there always various edge cases that you wouldn&#x27;t accommodate in your generic PaaS.</div><br/></div></div></div></div><div id="37814416" class="c"><input type="checkbox" id="c-37814416" checked=""/><div class="controls bullet"><span class="by">anurag</span><span>|</span><a href="#37813650">parent</a><span>|</span><a href="#37818061">prev</a><span>|</span><a href="#37814348">next</a><span>|</span><label class="collapse" for="c-37814416">[-]</label><label class="expand" for="c-37814416">[2 more]</label></div><br/><div class="children"><div class="content">(Render CEO) The economics are working out well so far and will only improve with scale. Our customers don&#x27;t want to (or can&#x27;t) build out large devops or platform engineering teams which cost millions of dollars every year. From that lens, we&#x27;re not selling compute. We&#x27;re selling product velocity and operational efficiency. You get the features and scale of K8s without needing to think about it.<p>IPAM has not been an issue with how we use K8s.</div><br/><div id="37814491" class="c"><input type="checkbox" id="c-37814491" checked=""/><div class="controls bullet"><span class="by">debarshri</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37814416">parent</a><span>|</span><a href="#37814348">next</a><span>|</span><label class="collapse" for="c-37814491">[-]</label><label class="expand" for="c-37814491">[1 more]</label></div><br/><div class="children"><div class="content">Thank you for your response. That makes sense.</div><br/></div></div></div></div><div id="37814348" class="c"><input type="checkbox" id="c-37814348" checked=""/><div class="controls bullet"><span class="by">pid-1</span><span>|</span><a href="#37813650">parent</a><span>|</span><a href="#37814416">prev</a><span>|</span><a href="#37814333">next</a><span>|</span><label class="collapse" for="c-37814348">[-]</label><label class="expand" for="c-37814348">[8 more]</label></div><br/><div class="children"><div class="content">I tend to agree. Their computer service is 4x more expensive than Fargate, which is expensive already.<p>Plus AWS has spot &#x2F; reserved instances.<p>You gotta really hate AWS&#x27;s UX to use a service like that.</div><br/><div id="37815167" class="c"><input type="checkbox" id="c-37815167" checked=""/><div class="controls bullet"><span class="by">Sytten</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37814348">parent</a><span>|</span><a href="#37814398">next</a><span>|</span><label class="collapse" for="c-37815167">[-]</label><label class="expand" for="c-37815167">[6 more]</label></div><br/><div class="children"><div class="content">We use render at Caido.<p>&lt;rant&gt;I am pretty pissed off by their per user per team pricing that was introduced early this year. Specially since you still need to pay for multiple teams to get network segmentation between envs WTF&lt;&#x2F;rant&gt;.<p>BUT on the compute, it is on par with fargate. I dont know how you arrived at 4x the cost but lets take 1 vcpu + 2GB ram. Render is 25$&#x2F;month and fargate is 35.50$&#x2F;month. For 2 vcpu and 4gb, render is at 85$&#x2F;m and Fargate is 71.10$&#x2F;m.<p>For our business, I am considering migrating off render within the next year. Unsure where to yet, I would like to avoid using another PaaS but managing a k8s cluster doesnt appeal to me so still looking.</div><br/><div id="37815614" class="c"><input type="checkbox" id="c-37815614" checked=""/><div class="controls bullet"><span class="by">sungrokshim</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37815167">parent</a><span>|</span><a href="#37815254">next</a><span>|</span><label class="collapse" for="c-37815614">[-]</label><label class="expand" for="c-37815614">[1 more]</label></div><br/><div class="children"><div class="content">Co-founder of Porter (<a href="https:&#x2F;&#x2F;porter.run">https:&#x2F;&#x2F;porter.run</a>) here - Porter brings that easy PaaS experience to a k8s cluster that&#x27;s running in your own cloud account (and manages it for you so you don&#x27;t have to). We specialize in serving the segment of users who don&#x27;t want to manage devops fully in-house but are outgrowing their existing PaaS providers.<p>We are offering a credit program for early stage startups that you can apply for here. Happy to fast track your application! <a href="https:&#x2F;&#x2F;porter.run&#x2F;for-seed-stage-startups">https:&#x2F;&#x2F;porter.run&#x2F;for-seed-stage-startups</a></div><br/></div></div><div id="37815254" class="c"><input type="checkbox" id="c-37815254" checked=""/><div class="controls bullet"><span class="by">anurag</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37815167">parent</a><span>|</span><a href="#37815614">prev</a><span>|</span><a href="#37816046">next</a><span>|</span><label class="collapse" for="c-37815254">[-]</label><label class="expand" for="c-37815254">[2 more]</label></div><br/><div class="children"><div class="content">Network segmentation between projects&#x2F;environments will land in the next year. Any chance you&#x27;d be up for a call so I understand the use case better? Email in profile.</div><br/><div id="37816682" class="c"><input type="checkbox" id="c-37816682" checked=""/><div class="controls bullet"><span class="by">Sytten</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37815254">parent</a><span>|</span><a href="#37816046">next</a><span>|</span><label class="collapse" for="c-37816682">[-]</label><label class="expand" for="c-37816682">[1 more]</label></div><br/><div class="children"><div class="content">Landing network segmentation between env should have been done before introducing per user per team pricing.......... I feel like as a PaaS I should not have to explain this.</div><br/></div></div></div></div><div id="37816046" class="c"><input type="checkbox" id="c-37816046" checked=""/><div class="controls bullet"><span class="by">flybayer</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37815167">parent</a><span>|</span><a href="#37815254">prev</a><span>|</span><a href="#37815654">next</a><span>|</span><label class="collapse" for="c-37816046">[-]</label><label class="expand" for="c-37816046">[1 more]</label></div><br/><div class="children"><div class="content">Depends on what parts of PaaS you like or not, but you might like <a href="https:&#x2F;&#x2F;www.Flightcontrol.dev">https:&#x2F;&#x2F;www.Flightcontrol.dev</a> which streamlines Fargate deployments. Also static sites, preview environments, etc. (I’m Flightcontrol cofounder&#x2F;CEO)</div><br/></div></div><div id="37815654" class="c"><input type="checkbox" id="c-37815654" checked=""/><div class="controls bullet"><span class="by">pid-1</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37815167">parent</a><span>|</span><a href="#37816046">prev</a><span>|</span><a href="#37814398">next</a><span>|</span><label class="collapse" for="c-37815654">[-]</label><label class="expand" for="c-37815654">[1 more]</label></div><br/><div class="children"><div class="content">Oops, I used Fargate Spot pricing on us-west-2. Thanks for the correction.</div><br/></div></div></div></div><div id="37814398" class="c"><input type="checkbox" id="c-37814398" checked=""/><div class="controls bullet"><span class="by">debarshri</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37814348">parent</a><span>|</span><a href="#37815167">prev</a><span>|</span><a href="#37814333">next</a><span>|</span><label class="collapse" for="c-37814398">[-]</label><label class="expand" for="c-37814398">[1 more]</label></div><br/><div class="children"><div class="content">Large orgs. cut huge deals with AWS. AWS gives huge discounts too. Money &gt; UX anyday.</div><br/></div></div></div></div><div id="37814333" class="c"><input type="checkbox" id="c-37814333" checked=""/><div class="controls bullet"><span class="by">kolanos</span><span>|</span><a href="#37813650">parent</a><span>|</span><a href="#37814348">prev</a><span>|</span><a href="#37816992">next</a><span>|</span><label class="collapse" for="c-37814333">[-]</label><label class="expand" for="c-37814333">[5 more]</label></div><br/><div class="children"><div class="content">Which AWS services do you think are more cost effective? Cost is rarely the reason I&#x27;ve chosen AWS over another  provider.<p>But I don&#x27;t think Render is competing with AWS head-on in regards to cost. They&#x27;re very much trying to fill that Heroku niche of hosting providers geared towards developers who don&#x27;t want to manage VMs let alone a k8s cluster. And as Heroku has proven, there is money to be made charging a premium for such convenience.</div><br/><div id="37814377" class="c"><input type="checkbox" id="c-37814377" checked=""/><div class="controls bullet"><span class="by">pid-1</span><span>|</span><a href="#37813650">root</a><span>|</span><a href="#37814333">parent</a><span>|</span><a href="#37814385">next</a><span>|</span><label class="collapse" for="c-37814377">[-]</label><label class="expand" for="c-37814377">[3 more]</label></div><br/><div class="children"><div class="content">&gt; And as Heroku has proven, there is money to be made charging a premium for such convenience<p>Heroku proved you can get many people to use your service by offering free stuff. Maybe there was a reason they sold the business.</div><br/></div></div></div></div></div></div><div id="37816992" class="c"><input type="checkbox" id="c-37816992" checked=""/><div class="controls bullet"><span class="by">skarlso</span><span>|</span><a href="#37813650">prev</a><span>|</span><a href="#37814046">next</a><span>|</span><label class="collapse" for="c-37816992">[-]</label><label class="expand" for="c-37816992">[1 more]</label></div><br/><div class="children"><div class="content">Just a small remark that dog-autoscaler which is `cluster-autoscaler` supports scaling to and from 0 pretty nicely. I even implemented that functionality in cluster api provider aws using cluster autoscaler. Which probably why the native support isn’t going along so nicely.</div><br/></div></div><div id="37814046" class="c"><input type="checkbox" id="c-37814046" checked=""/><div class="controls bullet"><span class="by">bittermandel</span><span>|</span><a href="#37816992">prev</a><span>|</span><a href="#37815599">next</a><span>|</span><label class="collapse" for="c-37814046">[-]</label><label class="expand" for="c-37814046">[1 more]</label></div><br/><div class="children"><div class="content">Thank you so much for this write-up. Reminds me strongly of when we were exploring GKE container native routing. It really makes it so much efficient being able to route directly to the pods, rather than passing through all these Service layers.</div><br/></div></div><div id="37815599" class="c"><input type="checkbox" id="c-37815599" checked=""/><div class="controls bullet"><span class="by">ed_mercer</span><span>|</span><a href="#37814046">prev</a><span>|</span><a href="#37814282">next</a><span>|</span><label class="collapse" for="c-37815599">[-]</label><label class="expand" for="c-37815599">[1 more]</label></div><br/><div class="children"><div class="content">Nice! I considered building a hosting service on Knative back in 2019. Happy to see it actually worked out for you.</div><br/></div></div><div id="37814282" class="c"><input type="checkbox" id="c-37814282" checked=""/><div class="controls bullet"><span class="by">pid-1</span><span>|</span><a href="#37815599">prev</a><span>|</span><label class="collapse" for="c-37814282">[-]</label><label class="expand" for="c-37814282">[1 more]</label></div><br/><div class="children"><div class="content">I solved that by deleting services in every new deployment, during CD.<p>Not elegant, but we lost nothing of value.</div><br/></div></div></div></div></div></div></div></body></html>