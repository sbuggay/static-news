<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1734339678010" as="style"/><link rel="stylesheet" href="styles.css?v=1734339678010"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cyphernet.es/#">Cyphernetes: A Query Language for Kubernetes</a> <span class="domain">(<a href="https://cyphernet.es">cyphernet.es</a>)</span></div><div class="subtext"><span>fatliverfreddy</span> | <span>30 comments</span></div><br/><div><div id="42428304" class="c"><input type="checkbox" id="c-42428304" checked=""/><div class="controls bullet"><span class="by">alpb</span><span>|</span><a href="#42428178">next</a><span>|</span><label class="collapse" for="c-42428304">[-]</label><label class="expand" for="c-42428304">[4 more]</label></div><br/><div class="children"><div class="content">During many years of operating several-thousands of nodes production clusters on Kubernetes, I&#x27;ve never seen any of these observability tools that query kube-apiserver work at that scale. Even the popular tools like k9s make super expensive queries like listing all pods in the cluster that if you don&#x27;t have enough load protections, can tip your Kubernetes apiserver over and cause an incident. If you&#x27;re serious about these querying capabilities, I highly recommend building your own data sources (e.g. watch objects with a controller and dump the data in a sql db) and stop hitting apiserver for these things. You&#x27;ll be better off in the long run.</div><br/><div id="42428681" class="c"><input type="checkbox" id="c-42428681" checked=""/><div class="controls bullet"><span class="by">rtpg</span><span>|</span><a href="#42428304">parent</a><span>|</span><a href="#42428358">next</a><span>|</span><label class="collapse" for="c-42428681">[-]</label><label class="expand" for="c-42428681">[1 more]</label></div><br/><div class="children"><div class="content">how are Kubernetes apiservers suffering this much from this kind of query? Surely even in huge systems the amount of data that would need to be traversed is super small, right?<p>Is this a question of Kubernetes just sticking everything into &quot;standard&quot; datastructures instead of using a database?</div><br/></div></div><div id="42428358" class="c"><input type="checkbox" id="c-42428358" checked=""/><div class="controls bullet"><span class="by">ramoz</span><span>|</span><a href="#42428304">parent</a><span>|</span><a href="#42428681">prev</a><span>|</span><a href="#42428323">next</a><span>|</span><label class="collapse" for="c-42428358">[-]</label><label class="expand" for="c-42428358">[1 more]</label></div><br/><div class="children"><div class="content">How fun was kube-ops-view though</div><br/></div></div><div id="42428323" class="c"><input type="checkbox" id="c-42428323" checked=""/><div class="controls bullet"><span class="by">fatliverfreddy</span><span>|</span><a href="#42428304">parent</a><span>|</span><a href="#42428358">prev</a><span>|</span><a href="#42428178">next</a><span>|</span><label class="collapse" for="c-42428323">[-]</label><label class="expand" for="c-42428323">[1 more]</label></div><br/><div class="children"><div class="content">This is a very good point and is on the roadmap.</div><br/></div></div></div></div><div id="42428178" class="c"><input type="checkbox" id="c-42428178" checked=""/><div class="controls bullet"><span class="by">danpalmer</span><span>|</span><a href="#42428304">prev</a><span>|</span><a href="#42429038">next</a><span>|</span><label class="collapse" for="c-42428178">[-]</label><label class="expand" for="c-42428178">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not against replacing jq&#x2F;jsonpath for the right tool, they&#x27;re not the most ergonomic. What isn&#x27;t clear to me though is why this isn&#x27;t SQL? It&#x27;s so nearly SQL, and seems to support almost identical semantics. I realise SQL isn&#x27;t perfect, but the goal of this project isn&#x27;t (I assume) to invent a new query language, but to make Kubernetes more easily queryable.</div><br/><div id="42428266" class="c"><input type="checkbox" id="c-42428266" checked=""/><div class="controls bullet"><span class="by">rubenvanwyk</span><span>|</span><a href="#42428178">parent</a><span>|</span><a href="#42428213">next</a><span>|</span><label class="collapse" for="c-42428266">[-]</label><label class="expand" for="c-42428266">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s based on Cypher, which is a query languages for graph databases. The author&#x2F;s probably thought the data is more graph-like than relational.</div><br/></div></div><div id="42428213" class="c"><input type="checkbox" id="c-42428213" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#42428178">parent</a><span>|</span><a href="#42428266">prev</a><span>|</span><a href="#42429038">next</a><span>|</span><label class="collapse" for="c-42428213">[-]</label><label class="expand" for="c-42428213">[1 more]</label></div><br/><div class="children"><div class="content">Reading your comment made me think that they&#x27;re so close to &quot;OSQuery for k8s&quot;, but that already seems to exist: <a href="https:&#x2F;&#x2F;www.uptycs.com&#x2F;blog&#x2F;kubequery-brings-the-power-of-osquery-to-kubernetes-clusters" rel="nofollow">https:&#x2F;&#x2F;www.uptycs.com&#x2F;blog&#x2F;kubequery-brings-the-power-of-os...</a></div><br/></div></div></div></div><div id="42429038" class="c"><input type="checkbox" id="c-42429038" checked=""/><div class="controls bullet"><span class="by">omrispector</span><span>|</span><a href="#42428178">prev</a><span>|</span><a href="#42428230">next</a><span>|</span><label class="collapse" for="c-42429038">[-]</label><label class="expand" for="c-42429038">[1 more]</label></div><br/><div class="children"><div class="content">This is way cool. The ability to visualize the k8s object model as a graph and query it as such makes so much sense!
The hottest feature in my mind is applying this in an operator - maintaining state as defined by a simple graph query. It is much more readable, and does so with very little code.
Well Done!</div><br/></div></div><div id="42428230" class="c"><input type="checkbox" id="c-42428230" checked=""/><div class="controls bullet"><span class="by">jeremya</span><span>|</span><a href="#42429038">prev</a><span>|</span><a href="#42428752">next</a><span>|</span><label class="collapse" for="c-42428230">[-]</label><label class="expand" for="c-42428230">[1 more]</label></div><br/><div class="children"><div class="content">This is fantastic. I’ve always enjoyed the cypher language that the neo4j team created for querying graph data.  The connected k8s api objects seem like a great place to apply that lens.</div><br/></div></div><div id="42428752" class="c"><input type="checkbox" id="c-42428752" checked=""/><div class="controls bullet"><span class="by">UltraSane</span><span>|</span><a href="#42428230">prev</a><span>|</span><a href="#42428496">next</a><span>|</span><label class="collapse" for="c-42428752">[-]</label><label class="expand" for="c-42428752">[1 more]</label></div><br/><div class="children"><div class="content">I am a big fan of Cypher I love this. I really wish actual Cypher supported the dot notation for nested keys.</div><br/></div></div><div id="42428496" class="c"><input type="checkbox" id="c-42428496" checked=""/><div class="controls bullet"><span class="by">devops99</span><span>|</span><a href="#42428752">prev</a><span>|</span><a href="#42428644">next</a><span>|</span><label class="collapse" for="c-42428496">[-]</label><label class="expand" for="c-42428496">[8 more]</label></div><br/><div class="children"><div class="content">The<p><pre><code>  brew install cyphernetes
</code></pre>
at the top of the page is an immediate turn-off.</div><br/><div id="42428602" class="c"><input type="checkbox" id="c-42428602" checked=""/><div class="controls bullet"><span class="by">rjh29</span><span>|</span><a href="#42428496">parent</a><span>|</span><a href="#42428521">next</a><span>|</span><label class="collapse" for="c-42428602">[-]</label><label class="expand" for="c-42428602">[3 more]</label></div><br/><div class="children"><div class="content">Agree but I&#x27;m not sure why. I&#x27;m not a mac user so the initial impression is like &quot;this isn&#x27;t for you, go away&quot;. At least add a linux command alongside it!</div><br/><div id="42428705" class="c"><input type="checkbox" id="c-42428705" checked=""/><div class="controls bullet"><span class="by">koito17</span><span>|</span><a href="#42428496">root</a><span>|</span><a href="#42428602">parent</a><span>|</span><a href="#42428709">next</a><span>|</span><label class="collapse" for="c-42428705">[-]</label><label class="expand" for="c-42428705">[1 more]</label></div><br/><div class="children"><div class="content">Homebrew has a Linux variant, but I assume almost nobody uses it.<p>Personally use a Mac with Nix, and so do many of my coworkers. Assuming Homebrew, even for a Mac user, leaves a bad impression on me.</div><br/></div></div><div id="42428709" class="c"><input type="checkbox" id="c-42428709" checked=""/><div class="controls bullet"><span class="by">fatliverfreddy</span><span>|</span><a href="#42428496">root</a><span>|</span><a href="#42428602">parent</a><span>|</span><a href="#42428705">prev</a><span>|</span><a href="#42428521">next</a><span>|</span><label class="collapse" for="c-42428709">[-]</label><label class="expand" for="c-42428709">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the feedback. Will add more commands there on rotation to show the different installation options.</div><br/></div></div></div></div><div id="42428521" class="c"><input type="checkbox" id="c-42428521" checked=""/><div class="controls bullet"><span class="by">riku_iki</span><span>|</span><a href="#42428496">parent</a><span>|</span><a href="#42428602">prev</a><span>|</span><a href="#42428644">next</a><span>|</span><label class="collapse" for="c-42428521">[-]</label><label class="expand" for="c-42428521">[4 more]</label></div><br/><div class="children"><div class="content">why?..</div><br/><div id="42428680" class="c"><input type="checkbox" id="c-42428680" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#42428496">root</a><span>|</span><a href="#42428521">parent</a><span>|</span><a href="#42428644">next</a><span>|</span><label class="collapse" for="c-42428680">[-]</label><label class="expand" for="c-42428680">[3 more]</label></div><br/><div class="children"><div class="content">Kubernetes only runs on linux, so it follows to reason if you care about k8s you should care about linux. My experience is also that good experienced sysadmins often use linux for their own machines as well.<p>Targetting a tool at macOS users, and omitting linux instructions, gives the impression that the tool isn&#x27;t targeted at sysadmins or hackers (i.e. at us), but rather at beginners, frontend developers, etc.</div><br/><div id="42428772" class="c"><input type="checkbox" id="c-42428772" checked=""/><div class="controls bullet"><span class="by">darkwater</span><span>|</span><a href="#42428496">root</a><span>|</span><a href="#42428680">parent</a><span>|</span><a href="#42428644">next</a><span>|</span><label class="collapse" for="c-42428772">[-]</label><label class="expand" for="c-42428772">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m a &quot;sysadmin&quot;. I only run Linux on my workstation. I even run NixOs on a home server. I manager Kubernetes clusters. Yet, I use Homebrew on Linux.</div><br/><div id="42428954" class="c"><input type="checkbox" id="c-42428954" checked=""/><div class="controls bullet"><span class="by">politelemon</span><span>|</span><a href="#42428496">root</a><span>|</span><a href="#42428772">parent</a><span>|</span><a href="#42428644">next</a><span>|</span><label class="collapse" for="c-42428954">[-]</label><label class="expand" for="c-42428954">[1 more]</label></div><br/><div class="children"><div class="content">Most, however, do not, nor should they be expected to. Homebrew is not a safe or viable package manager, especially when better and safer package managers exist in the Linux ecosystem.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="42428644" class="c"><input type="checkbox" id="c-42428644" checked=""/><div class="controls bullet"><span class="by">multani</span><span>|</span><a href="#42428496">prev</a><span>|</span><a href="#42428134">next</a><span>|</span><label class="collapse" for="c-42428644">[-]</label><label class="expand" for="c-42428644">[1 more]</label></div><br/><div class="children"><div class="content">I really really like Steampipe to do this kind of query: <a href="https:&#x2F;&#x2F;steampipe.io" rel="nofollow">https:&#x2F;&#x2F;steampipe.io</a>, which is essentially PostgreSQL (literally) to query many different kind of APIs, which means you have access to all PostgreSQL&#x27;s SQL language can offer to request data.<p>They have a Kubernetes plugin at <a href="https:&#x2F;&#x2F;hub.steampipe.io&#x2F;plugins&#x2F;turbot&#x2F;kubernetes" rel="nofollow">https:&#x2F;&#x2F;hub.steampipe.io&#x2F;plugins&#x2F;turbot&#x2F;kubernetes</a> and there are a couple of things I really like:<p>* it&#x27;s super easy to request multiple Kubernetes clusters transparently: define one Steampipe &quot;connection&quot; for each of your clusters + define an &quot;aggregator&quot; connection that aggregates all of them, then query the &quot;aggregator&quot; connection. You will get a &quot;context&quot; column that indicates which Kubernetes cluster the row came from.
* it&#x27;s relatively fast in my experience, even for large result sets. It&#x27;s also possible to configure a caching mechanism inside Steampipe to speed up your queries
* it also understands custom resource definitions, although you need to help Steampipe a bit (explained here: <a href="https:&#x2F;&#x2F;hub.steampipe.io&#x2F;plugins&#x2F;turbot&#x2F;kubernetes&#x2F;tables&#x2F;kubernetes_%7Bcustom_resource_singular_name%7D" rel="nofollow">https:&#x2F;&#x2F;hub.steampipe.io&#x2F;plugins&#x2F;turbot&#x2F;kubernetes&#x2F;tables&#x2F;ku...</a>)<p>Last but not least: you can of course join multiple &quot;plugins&quot; together. I used it a couple of times to join content exposed only in GCP with content from Kubernetes, that was quite useful.<p>The things I don&#x27;t like so much but can be lived with:<p>* Several columns are just exposed a plain JSON fields ; you need to get familiar with PostgreSQL JSON operators to get something useful. There&#x27;s a page in Steampipe&#x27;s doc to explain how to use them better.
* Be familiar also with PostgreSQL&#x27;s common table expressions: there are not so difficult to use but makes the SQL code much easier to read
* It&#x27;s SQL, so you have to know which columns you want to pick before selecting the table they come from ; not ideal from autocompletion
* the Steampipe &quot;psql&quot; client is good, but sometimes a bit counter intuitive ; I don&#x27;t have specific examples but I have the feeling it behaves slightly differently than other CLI client I used.<p>All in all: I think Steampipe is a cool tool to know about, for Kubernetes but also other API systems.</div><br/></div></div><div id="42428134" class="c"><input type="checkbox" id="c-42428134" checked=""/><div class="controls bullet"><span class="by">nikau</span><span>|</span><a href="#42428644">prev</a><span>|</span><a href="#42428095">next</a><span>|</span><label class="collapse" for="c-42428134">[-]</label><label class="expand" for="c-42428134">[6 more]</label></div><br/><div class="children"><div class="content">What does this offer over jq which I can also afford?</div><br/><div id="42428196" class="c"><input type="checkbox" id="c-42428196" checked=""/><div class="controls bullet"><span class="by">weddpros</span><span>|</span><a href="#42428134">parent</a><span>|</span><a href="#42428175">next</a><span>|</span><label class="collapse" for="c-42428196">[-]</label><label class="expand" for="c-42428196">[4 more]</label></div><br/><div class="children"><div class="content">Cyphernetes seems capable of graph&#x2F;relational logic.<p>The example on the homepage is literally &quot;give me deployments with more than 2 replicas with pods that are not Running, and give me the IP address of the service they&#x27;re serving&quot;...<p>Any idea how to do that with kubectl | jq? Their solution seems elegant to me.</div><br/><div id="42428357" class="c"><input type="checkbox" id="c-42428357" checked=""/><div class="controls bullet"><span class="by">nikau</span><span>|</span><a href="#42428134">root</a><span>|</span><a href="#42428196">parent</a><span>|</span><a href="#42428175">next</a><span>|</span><label class="collapse" for="c-42428357">[-]</label><label class="expand" for="c-42428357">[3 more]</label></div><br/><div class="children"><div class="content">Can just use normal jq select filters unless I&#x27;m missing something?</div><br/><div id="42428420" class="c"><input type="checkbox" id="c-42428420" checked=""/><div class="controls bullet"><span class="by">weddpros</span><span>|</span><a href="#42428134">root</a><span>|</span><a href="#42428357">parent</a><span>|</span><a href="#42428175">next</a><span>|</span><label class="collapse" for="c-42428420">[-]</label><label class="expand" for="c-42428420">[2 more]</label></div><br/><div class="children"><div class="content">the thing is you&#x27;d need 3 k8s queries, one for pods, one for deployments, one for services, then link all of them, and filter... jq helps with the filtering, kubectl can query, but you still need to join the 3 resources to answer the query...</div><br/><div id="42429164" class="c"><input type="checkbox" id="c-42429164" checked=""/><div class="controls bullet"><span class="by">nikau</span><span>|</span><a href="#42428134">root</a><span>|</span><a href="#42428420">parent</a><span>|</span><a href="#42428175">next</a><span>|</span><label class="collapse" for="c-42429164">[-]</label><label class="expand" for="c-42429164">[1 more]</label></div><br/><div class="children"><div class="content">Right, so doable just a bit more effort to do 3 queries to pipes or tmp files</div><br/></div></div></div></div></div></div></div></div></div></div><div id="42428095" class="c"><input type="checkbox" id="c-42428095" checked=""/><div class="controls bullet"><span class="by">solatic</span><span>|</span><a href="#42428134">prev</a><span>|</span><label class="collapse" for="c-42428095">[-]</label><label class="expand" for="c-42428095">[4 more]</label></div><br/><div class="children"><div class="content">I dunno, Kubernetes has a query language, it&#x27;s called jq. As in, kubectl get pods -A -ojson | jq -r &#x27;.items[] | ...&#x27;. Cyphernetes seems simpler perhaps but it&#x27;s not the 10x improvement I need to switch and introduce a new dependency.</div><br/><div id="42428205" class="c"><input type="checkbox" id="c-42428205" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#42428095">parent</a><span>|</span><a href="#42428145">next</a><span>|</span><label class="collapse" for="c-42428205">[-]</label><label class="expand" for="c-42428205">[1 more]</label></div><br/><div class="children"><div class="content">I guess they would say that you have to send the output of that to be inputs of another kubectl command like<p><pre><code>  $ kubectl logs -n foo $(kubectl get pod -n foo | awk &#x27;&#x2F;Running&#x2F;{print $1}&#x27;)
</code></pre>
because one of their selling points is &quot;no nested kubectl queries&quot;.<p>I don&#x27;t see how their queries can be more efficient than hitting the kube-apiserver multiple times, unless they have something that lives clusterside observing lifecycle events for all CRDs and answering queries with only one round-trip instead of multiple.<p>Or maybe they&#x27;re selling &quot;no nested kubectl queries&quot; as an experience feature, saying that a query language is more ergonomic than bash command redirection.  My brain has been warped into the shape of the shell, for better or for worse, so it&#x27;s not a selling point for me.</div><br/></div></div><div id="42428145" class="c"><input type="checkbox" id="c-42428145" checked=""/><div class="controls bullet"><span class="by">Thaxll</span><span>|</span><a href="#42428095">parent</a><span>|</span><a href="#42428205">prev</a><span>|</span><a href="#42428224">next</a><span>|</span><label class="collapse" for="c-42428145">[-]</label><label class="expand" for="c-42428145">[1 more]</label></div><br/><div class="children"><div class="content">You usually don&#x27;t need that, since kubectl supports jsonpath.</div><br/></div></div></div></div></div></div></div></div></div></body></html>