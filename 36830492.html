<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1690102844211" as="style"/><link rel="stylesheet" href="styles.css?v=1690102844211"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lamarrr.github.io/STX/">STX – C++17 and C++ 20 error-handling and utility extensions</a> <span class="domain">(<a href="https://lamarrr.github.io">lamarrr.github.io</a>)</span></div><div class="subtext"><span>whou</span> | <span>20 comments</span></div><br/><div><div id="36833422" class="c"><input type="checkbox" id="c-36833422" checked=""/><div class="controls bullet"><span class="by">tempodox</span><span>|</span><a href="#36831218">next</a><span>|</span><label class="collapse" for="c-36833422">[-]</label><label class="expand" for="c-36833422">[1 more]</label></div><br/><div class="children"><div class="content">Wow.  Have you looked at the sources[1]?  Doc comments to the hilt.  Links to `cppreference.com`.  The works.  If only all sources I see were commented like this.  What I see instead are barren wastelands.  If I find a comment every 1000 lines or so, it&#x27;s completely useless and just repeats what the code says anyways.  And developers who are <i>against comments</i> because it could be work to keep them up to date.  This project is a rare respite from my daily tortures.<p>1: <a href="https:&#x2F;&#x2F;github.com&#x2F;lamarrr&#x2F;stx">https:&#x2F;&#x2F;github.com&#x2F;lamarrr&#x2F;stx</a></div><br/></div></div><div id="36831218" class="c"><input type="checkbox" id="c-36831218" checked=""/><div class="controls bullet"><span class="by">chrsig</span><span>|</span><a href="#36833422">prev</a><span>|</span><a href="#36832007">next</a><span>|</span><label class="collapse" for="c-36831218">[-]</label><label class="expand" for="c-36831218">[2 more]</label></div><br/><div class="children"><div class="content">stx::backtrace looks quite nice.<p>The documentation seems nice as well...except I can&#x27;t seem to find a link to the code itself.  I have to believe it&#x27;s right in front of me and I&#x27;m just not seeing it.</div><br/><div id="36831435" class="c"><input type="checkbox" id="c-36831435" checked=""/><div class="controls bullet"><span class="by">whou</span><span>|</span><a href="#36831218">parent</a><span>|</span><a href="#36832007">next</a><span>|</span><label class="collapse" for="c-36831435">[-]</label><label class="expand" for="c-36831435">[1 more]</label></div><br/><div class="children"><div class="content">source code: <a href="https:&#x2F;&#x2F;github.com&#x2F;lamarrr&#x2F;stx">https:&#x2F;&#x2F;github.com&#x2F;lamarrr&#x2F;stx</a><p>you aren&#x27;t crazy, I also thought it was very weird that there weren&#x27;t any links</div><br/></div></div></div></div><div id="36832007" class="c"><input type="checkbox" id="c-36832007" checked=""/><div class="controls bullet"><span class="by">adastra22</span><span>|</span><a href="#36831218">prev</a><span>|</span><a href="#36830536">next</a><span>|</span><label class="collapse" for="c-36832007">[-]</label><label class="expand" for="c-36832007">[9 more]</label></div><br/><div class="children"><div class="content">This is essentially &quot;Rust&#x27;s error handling in C++&quot;, no? I generally think this is an improvement and good to have, but I&#x27;m wondering if there are any hidden differences.<p>The C++ standard library already exposes a std::optional type. Does this stx::Option type differ from that one?</div><br/><div id="36833176" class="c"><input type="checkbox" id="c-36833176" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#36832007">parent</a><span>|</span><a href="#36832082">next</a><span>|</span><label class="collapse" for="c-36833176">[-]</label><label class="expand" for="c-36833176">[5 more]</label></div><br/><div class="children"><div class="content">&gt; The C++ standard library already exposes a std::optional type. Does this stx::Option type differ from that one?<p>std::optional is a stack pointer, like other C++ pointers you can straight up deref’ it and get an UB.<p>It looks like stx::Option is an actually option type, it focuses on safety and will throw if “unsafe” methods are called on the wrong state. It also provides a slew of monadic operators to operate over values.</div><br/><div id="36833374" class="c"><input type="checkbox" id="c-36833374" checked=""/><div class="controls bullet"><span class="by">imron</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36833176">parent</a><span>|</span><a href="#36833509">next</a><span>|</span><label class="collapse" for="c-36833374">[-]</label><label class="expand" for="c-36833374">[2 more]</label></div><br/><div class="children"><div class="content">&gt; and will throw if “unsafe” methods are called on the wrong state<p>I haven’t looked at the code but the stx documentation said it doesn’t use exceptions.</div><br/><div id="36833674" class="c"><input type="checkbox" id="c-36833674" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36833374">parent</a><span>|</span><a href="#36833509">next</a><span>|</span><label class="collapse" for="c-36833674">[-]</label><label class="expand" for="c-36833674">[1 more]</label></div><br/><div class="children"><div class="content">The doc states it panics, maybe that&#x27;s process termination, but either way it doesn&#x27;t let you do the thing.</div><br/></div></div></div></div><div id="36833509" class="c"><input type="checkbox" id="c-36833509" checked=""/><div class="controls bullet"><span class="by">jzwinck</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36833176">parent</a><span>|</span><a href="#36833374">prev</a><span>|</span><a href="#36832082">next</a><span>|</span><label class="collapse" for="c-36833509">[-]</label><label class="expand" for="c-36833509">[2 more]</label></div><br/><div class="children"><div class="content">std::optional is not a pointer. And it has a safe dereference method called value() if you want the extra runtime check which operator* skips.</div><br/><div id="36833675" class="c"><input type="checkbox" id="c-36833675" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36833509">parent</a><span>|</span><a href="#36832082">next</a><span>|</span><label class="collapse" for="c-36833675">[-]</label><label class="expand" for="c-36833675">[1 more]</label></div><br/><div class="children"><div class="content">A pointer with an opt-in, less convenient, safe dereference... is still a pointer.</div><br/></div></div></div></div></div></div><div id="36832082" class="c"><input type="checkbox" id="c-36832082" checked=""/><div class="controls bullet"><span class="by">BenFrantzDale</span><span>|</span><a href="#36832007">parent</a><span>|</span><a href="#36833176">prev</a><span>|</span><a href="#36830536">next</a><span>|</span><label class="collapse" for="c-36832082">[-]</label><label class="expand" for="c-36832082">[3 more]</label></div><br/><div class="children"><div class="content">C++ also has `std::expected&lt;T,E&gt;`.</div><br/><div id="36833274" class="c"><input type="checkbox" id="c-36833274" checked=""/><div class="controls bullet"><span class="by">tommiegannert</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36832082">parent</a><span>|</span><a href="#36832469">next</a><span>|</span><label class="collapse" for="c-36833274">[-]</label><label class="expand" for="c-36833274">[1 more]</label></div><br/><div class="children"><div class="content">(In C++23.)<p><a href="https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;utility&#x2F;expected" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;utility&#x2F;expected</a></div><br/></div></div><div id="36832469" class="c"><input type="checkbox" id="c-36832469" checked=""/><div class="controls bullet"><span class="by">adastra22</span><span>|</span><a href="#36832007">root</a><span>|</span><a href="#36832082">parent</a><span>|</span><a href="#36833274">prev</a><span>|</span><a href="#36830536">next</a><span>|</span><label class="collapse" for="c-36832469">[-]</label><label class="expand" for="c-36832469">[1 more]</label></div><br/><div class="children"><div class="content">Thanks, TIL.</div><br/></div></div></div></div></div></div><div id="36830536" class="c"><input type="checkbox" id="c-36830536" checked=""/><div class="controls bullet"><span class="by">synergy20</span><span>|</span><a href="#36832007">prev</a><span>|</span><a href="#36830901">next</a><span>|</span><label class="collapse" for="c-36830536">[-]</label><label class="expand" for="c-36830536">[6 more]</label></div><br/><div class="children"><div class="content">what does &#x27;no-std&#x27; mean in STX&#x27;s description? new to me, very interesting.</div><br/><div id="36830753" class="c"><input type="checkbox" id="c-36830753" checked=""/><div class="controls bullet"><span class="by">paulddraper</span><span>|</span><a href="#36830536">parent</a><span>|</span><a href="#36830901">next</a><span>|</span><label class="collapse" for="c-36830753">[-]</label><label class="expand" for="c-36830753">[5 more]</label></div><br/><div class="children"><div class="content">Yeah, I&#x27;ve only seen that term used in Rust, though the concept is very common in C++.<p>They explain it there: &quot;No RTTI, memory allocation, nor exceptions.&quot;<p>Basically, nothing that has significant &quot;runtime&quot; cost....dynamic_cast, new&#x2F;malloc, throwing exceptions.</div><br/><div id="36830922" class="c"><input type="checkbox" id="c-36830922" checked=""/><div class="controls bullet"><span class="by">pbsd</span><span>|</span><a href="#36830536">root</a><span>|</span><a href="#36830753">parent</a><span>|</span><a href="#36830957">next</a><span>|</span><label class="collapse" for="c-36830922">[-]</label><label class="expand" for="c-36830922">[1 more]</label></div><br/><div class="children"><div class="content">This is generally known as &quot;freestanding&quot; in the C&#x2F;C++ world -- <a href="https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;freestanding" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;cpp&#x2F;freestanding</a></div><br/></div></div><div id="36830957" class="c"><input type="checkbox" id="c-36830957" checked=""/><div class="controls bullet"><span class="by">tialaramex</span><span>|</span><a href="#36830536">root</a><span>|</span><a href="#36830753">parent</a><span>|</span><a href="#36830922">prev</a><span>|</span><a href="#36831420">next</a><span>|</span><label class="collapse" for="c-36830957">[-]</label><label class="expand" for="c-36830957">[2 more]</label></div><br/><div class="children"><div class="content">In Rust there&#x27;s actually deliberately a core library, and so no_std actually makes sense - you get the core library, not the larger std which re-exports all of core plus a lot more. There&#x27;s quite a lot of stuff in that core library, just nothing that requires an operating system or an allocator. So Rust&#x27;s Mutex isn&#x27;t available (how can we provide a mutual exclusion mechanism on the bare hardware?) but Rust&#x27;s Option&lt;(core::net::IpAddr, core::time::Duration) is available everywhere, it&#x27;s either None or a pair of an IP (v4 or v6) address and a duration, perhaps some sort of address lease because maybe we&#x27;re an embedded device which has, or gives out, address leases.<p>In C++ this makes less sense because their standard library does have a defined &quot;freestanding&quot; subset but it doesn&#x27;t make a very coherent whole, it&#x27;s roughly the bits that seemed obviously to just not need any other components to work. It changes from version to version. And this stx library replaces what you might think of as core ideas, like an optional type, so you don&#x27;t keep the shared vocabulary benefit.<p>[Edited to correct &quot;standalone&quot; to &quot;freestanding&quot;]</div><br/><div id="36832377" class="c"><input type="checkbox" id="c-36832377" checked=""/><div class="controls bullet"><span class="by">greatfilter251</span><span>|</span><a href="#36830536">root</a><span>|</span><a href="#36830957">parent</a><span>|</span><a href="#36831420">next</a><span>|</span><label class="collapse" for="c-36832377">[-]</label><label class="expand" for="c-36832377">[1 more]</label></div><br/><div class="children"><div class="content">&gt; how can we provide a mutual exclusion mechanism on the bare hardware?<p>This is a bit misleading. It&#x27;s easier to provide mutual exclusion on bare hardware than in an OS; just do a spinlock, except with modern ISAs the core doesn&#x27;t even spin.<p>Presumably core doesn&#x27;t offer this because it&#x27;s a massive footgun for devs new to multithreading who would not understand why this is unacceptable to use in an OS-hosted process.</div><br/></div></div></div></div><div id="36831420" class="c"><input type="checkbox" id="c-36831420" checked=""/><div class="controls bullet"><span class="by">wyldfire</span><span>|</span><a href="#36830536">root</a><span>|</span><a href="#36830753">parent</a><span>|</span><a href="#36830957">prev</a><span>|</span><a href="#36830901">next</a><span>|</span><label class="collapse" for="c-36831420">[-]</label><label class="expand" for="c-36831420">[1 more]</label></div><br/><div class="children"><div class="content">IMO the typical use case is for portability to platforms that don&#x27;t have those features, or implementing a lower-layer: bootloader&#x2F;OS kernel&#x2F;etc.  Regardless of the runtime cost - you don&#x27;t have a C&#x2F;C++ library to rely on (or you&#x27;re implementing one).<p>I&#x27;d always assumed rust may have taken this from C compiler arguments like -nostdlib &#x2F; -nostdinc (and corresponding C++ ones -nostdlib++, -nostdinc++).</div><br/></div></div></div></div></div></div><div id="36830901" class="c"><input type="checkbox" id="c-36830901" checked=""/><div class="controls bullet"><span class="by">sendfoods</span><span>|</span><a href="#36830536">prev</a><span>|</span><label class="collapse" for="c-36830901">[-]</label><label class="expand" for="c-36830901">[1 more]</label></div><br/><div class="children"><div class="content">This looks amazing, thank you for sharing.</div><br/></div></div></div></div></div></div></div></body></html>