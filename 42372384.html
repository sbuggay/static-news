<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1733821280183" as="style"/><link rel="stylesheet" href="styles.css?v=1733821280183"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://bdash.net.nz/posts/tcc-and-the-platform-sandbox-policy/">TCC and the macOS Platform Sandbox Policy</a> <span class="domain">(<a href="https://bdash.net.nz">bdash.net.nz</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>13 comments</span></div><br/><div><div id="42373449" class="c"><input type="checkbox" id="c-42373449" checked=""/><div class="controls bullet"><span class="by">weikju</span><span>|</span><a href="#42373092">next</a><span>|</span><label class="collapse" for="c-42373449">[-]</label><label class="expand" for="c-42373449">[7 more]</label></div><br/><div class="children"><div class="content">It would be very interesting to read about how S-expressions became the language of choice for macOS&#x27;s sandboxing, somehow sandwiched between the XML and JSON trends (e.g. plists were&#x2F;are still? XML)</div><br/><div id="42373625" class="c"><input type="checkbox" id="c-42373625" checked=""/><div class="controls bullet"><span class="by">AlotOfReading</span><span>|</span><a href="#42373449">parent</a><span>|</span><a href="#42374871">next</a><span>|</span><label class="collapse" for="c-42373625">[-]</label><label class="expand" for="c-42373625">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a fork of tinyscheme with some security improvements that&#x27;s been in MacOS since 2007. It&#x27;s used to compile all the rules down to a bytecode (similar to eBPF) that&#x27;s evaluated by the kernel.<p>I don&#x27;t have specific info on the rationale, but a powerful language with a small surface area that&#x27;s easy to parse was probably an attractive choice for mid-2000s security code written in C.</div><br/><div id="42374355" class="c"><input type="checkbox" id="c-42374355" checked=""/><div class="controls bullet"><span class="by">bdash</span><span>|</span><a href="#42373449">root</a><span>|</span><a href="#42373625">parent</a><span>|</span><a href="#42373705">next</a><span>|</span><label class="collapse" for="c-42374355">[-]</label><label class="expand" for="c-42374355">[1 more]</label></div><br/><div class="children"><div class="content">It still compiles the rules down to a very basic bytecode: <a href="https:&#x2F;&#x2F;bdash.net.nz&#x2F;posts&#x2F;sandboxing-on-macos&#x2F;#sandbox-policy-evaluation" rel="nofollow">https:&#x2F;&#x2F;bdash.net.nz&#x2F;posts&#x2F;sandboxing-on-macos&#x2F;#sandbox-poli...</a></div><br/></div></div><div id="42373705" class="c"><input type="checkbox" id="c-42373705" checked=""/><div class="controls bullet"><span class="by">walterbell</span><span>|</span><a href="#42373449">root</a><span>|</span><a href="#42373625">parent</a><span>|</span><a href="#42374355">prev</a><span>|</span><a href="#42374871">next</a><span>|</span><label class="collapse" for="c-42373705">[-]</label><label class="expand" for="c-42373705">[1 more]</label></div><br/><div class="children"><div class="content">Guix also chose scheme in 2010s, <a href="https:&#x2F;&#x2F;guix.gnu.org&#x2F;manual&#x2F;en&#x2F;html_node&#x2F;G_002dExpressions.html" rel="nofollow">https:&#x2F;&#x2F;guix.gnu.org&#x2F;manual&#x2F;en&#x2F;html_node&#x2F;G_002dExpressions.h...</a><p><pre><code>  (define build-exp
  #~(begin
      (mkdir #$output)
      (chdir #$output)
      (symlink (string-append #$coreutils &quot;&#x2F;bin&#x2F;ls&quot;)
               &quot;list-files&quot;)))</code></pre></div><br/></div></div></div></div><div id="42374871" class="c"><input type="checkbox" id="c-42374871" checked=""/><div class="controls bullet"><span class="by">nxobject</span><span>|</span><a href="#42373449">parent</a><span>|</span><a href="#42373625">prev</a><span>|</span><a href="#42373514">next</a><span>|</span><label class="collapse" for="c-42374871">[-]</label><label class="expand" for="c-42374871">[1 more]</label></div><br/><div class="children"><div class="content">Funfact of historical interest only: in NeXTSTEP&#x2F;OPENSTEP, plists had a more JSON-type syntax, although of course it predates JS.</div><br/></div></div><div id="42373514" class="c"><input type="checkbox" id="c-42373514" checked=""/><div class="controls bullet"><span class="by">dartos</span><span>|</span><a href="#42373449">parent</a><span>|</span><a href="#42374871">prev</a><span>|</span><a href="#42373092">next</a><span>|</span><label class="collapse" for="c-42373514">[-]</label><label class="expand" for="c-42373514">[2 more]</label></div><br/><div class="children"><div class="content">To take a stab in the dark.<p>JSON and xml are both data representation formats, but the code snippets in the article seem more like a declarative language.<p>You could make a declarative language using JSON semantics, but maybe they wanted something more bespoke.<p>it’s also super duper easy to write an s-expression parser</div><br/><div id="42374424" class="c"><input type="checkbox" id="c-42374424" checked=""/><div class="controls bullet"><span class="by">bdash</span><span>|</span><a href="#42373449">root</a><span>|</span><a href="#42373514">parent</a><span>|</span><a href="#42373092">next</a><span>|</span><label class="collapse" for="c-42374424">[-]</label><label class="expand" for="c-42374424">[1 more]</label></div><br/><div class="children"><div class="content">The code snippets are purely declarative because they are reconstructed from the simple bytecode that the macOS sandbox library generates after evaluating the Scheme code. At that point any abstractions present in the source code are long gone and only predicates and actions remain.<p>If you look at typical SBPL source code you&#x27;ll see it tends to contain a mix of straightforward, declarative `(allow …)` policies and custom functions&#x2F;macros used to simplify repeated patterns. See <a href="https:&#x2F;&#x2F;github.com&#x2F;WebKit&#x2F;WebKit&#x2F;blob&#x2F;11b5279aec6113c661dac368e2fc015fbc598f9c&#x2F;Source&#x2F;WebKit&#x2F;Shared&#x2F;Sandbox&#x2F;iOS&#x2F;common.sb">https:&#x2F;&#x2F;github.com&#x2F;WebKit&#x2F;WebKit&#x2F;blob&#x2F;11b5279aec6113c661dac3...</a>, for example.</div><br/></div></div></div></div></div></div><div id="42373092" class="c"><input type="checkbox" id="c-42373092" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#42373449">prev</a><span>|</span><label class="collapse" for="c-42373092">[-]</label><label class="expand" for="c-42373092">[5 more]</label></div><br/><div class="children"><div class="content">TCC = Transparency, Consent and Control<p>Not to be confused with numerous other uses of the acronym.</div><br/><div id="42373375" class="c"><input type="checkbox" id="c-42373375" checked=""/><div class="controls bullet"><span class="by">wild_pointer</span><span>|</span><a href="#42373092">parent</a><span>|</span><label class="collapse" for="c-42373375">[-]</label><label class="expand" for="c-42373375">[4 more]</label></div><br/><div class="children"><div class="content">I thought it was about <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Tiny_C_Compiler" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Tiny_C_Compiler</a></div><br/><div id="42374301" class="c"><input type="checkbox" id="c-42374301" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#42373092">root</a><span>|</span><a href="#42373375">parent</a><span>|</span><label class="collapse" for="c-42374301">[-]</label><label class="expand" for="c-42374301">[3 more]</label></div><br/><div class="children"><div class="content">Indeed, I opened the link wondering what Apple had fucked up in their sandbox policy that it could hinder an innocent C compiler.</div><br/><div id="42374368" class="c"><input type="checkbox" id="c-42374368" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#42373092">root</a><span>|</span><a href="#42374301">parent</a><span>|</span><label class="collapse" for="c-42374368">[-]</label><label class="expand" for="c-42374368">[2 more]</label></div><br/><div class="children"><div class="content">I was guessing breakage of some JIT thing, though in hindsight that would probably be a bit out of character for tcc.</div><br/><div id="42374649" class="c"><input type="checkbox" id="c-42374649" checked=""/><div class="controls bullet"><span class="by">pwdisswordfishz</span><span>|</span><a href="#42373092">root</a><span>|</span><a href="#42374368">parent</a><span>|</span><label class="collapse" for="c-42374649">[-]</label><label class="expand" for="c-42374649">[1 more]</label></div><br/><div class="children"><div class="content">What, tcc -run?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>