<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1692954061573" as="style"/><link rel="stylesheet" href="styles.css?v=1692954061573"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://thestarman.pcministry.com/asm/mbr/GRUB.htm">The GRUB MBR (2008)</a> <span class="domain">(<a href="https://thestarman.pcministry.com">thestarman.pcministry.com</a>)</span></div><div class="subtext"><span>susam</span> | <span>12 comments</span></div><br/><div><div id="37258173" class="c"><input type="checkbox" id="c-37258173" checked=""/><div class="controls bullet"><span class="by">deathanatos</span><span>|</span><a href="#37258040">next</a><span>|</span><label class="collapse" for="c-37258173">[-]</label><label class="expand" for="c-37258173">[3 more]</label></div><br/><div class="children"><div class="content">&gt; (lots of text about stage2 and the &quot;first track&quot;)<p>stage2 has to naturally follow the MBR; there&#x27;s … nowhere else to put it, really. IIRC … and this seems to be what the article is <i>advocating</i> … there was some idiocy where some people would put the sector number of where stage2 was <i>inside an ext2fs</i> or so. This requires several things that ext2 (nor really any FS guarantees): that the file is contiguous, and that its data is pinned to that physical on-disk location.<p>AIUI, the root of the problem is that stage1 doesn&#x27;t have enough space to encode a filesystem driver to actually properly find the file on an FS; that&#x27;s what stage2 <i>is</i>.<p>Adding it in the gap between the MBR &amp; the first partition is an easy enough solution. It then isn&#x27;t in any FS, and so cannot be inadvertently moved accidentally.<p>The problem today is obviated by GPT &amp; EFI.</div><br/><div id="37259253" class="c"><input type="checkbox" id="c-37259253" checked=""/><div class="controls bullet"><span class="by">messe</span><span>|</span><a href="#37258173">parent</a><span>|</span><a href="#37259252">next</a><span>|</span><label class="collapse" for="c-37259253">[-]</label><label class="expand" for="c-37259253">[1 more]</label></div><br/><div class="children"><div class="content">&gt; AIUI, the root of the problem is that stage1 doesn&#x27;t have enough space to encode a filesystem driver to actually properly find the file on an FS; that&#x27;s what stage2 is.<p>There <i>is</i> more than enough space to encode an EXT2 driver in a boot sector (and if you really push it, you can even parse a simple ELF file as well). You can only really fit a single filesystem driver in the boot sector though, and for something more complex than EXT2, even this can be tricky to fit in.<p>The trouble is that GRUB supports multiple file systems, and doesn&#x27;t maintain a separate boot sector for each one, so instead came up with the Stage 1.5 approach. If Stage 1.5 is installed between the MBR and first partition, then GRUB loads that and jumps to it. Stage 1.5 contains a proper filesystem driver that it then uses to load Stage 2. Stage 1.5 doesn&#x27;t have the size limitations of the MBR.<p>If Stage 1.5 is not installed, for example if the first partition starts immediately after the MBR, then, and only then, GRUB falls back to using a hard coded list of sectors.<p>On BIOS&#x2F;GPT based systems, IIRC GRUB2 uses a partition type called BIOS Boot Partition to store its equivalent to Stage 1.5&#x2F;2 (I&#x27;m calling it a mix of 1.5&#x2F;2, as GRUB2 also loads modules from the filesystem where it&#x27;s stored as part of the boot process).<p>&gt; The problem today is obviated by GPT &amp; EFI.<p>Yep, UEFI makes things pretty convenient for the OS developer! When writing a bootloader these days you don&#x27;t even need to write a filesystem driver if your kernel is stored on the EFI partition. You can just use SimpleFileSystemProtocol to load it into memory.</div><br/></div></div><div id="37259252" class="c"><input type="checkbox" id="c-37259252" checked=""/><div class="controls bullet"><span class="by">chungy</span><span>|</span><a href="#37258173">parent</a><span>|</span><a href="#37259253">prev</a><span>|</span><a href="#37258040">next</a><span>|</span><label class="collapse" for="c-37259252">[-]</label><label class="expand" for="c-37259252">[1 more]</label></div><br/><div class="children"><div class="content">GRUB2 combined with GPT made this whole thing way better. You make a partition with a certain type (0xef02 in gdisk&#x27;s shortened codes) and that&#x27;s where the GRUB stage2 code goes; the stage1 finds the partition and loads it. It certainly eases my mind of &quot;well, let&#x27;s hope nothing decides to overwrite this &#x27;unused&#x27; part of disk&quot;.</div><br/></div></div></div></div><div id="37258040" class="c"><input type="checkbox" id="c-37258040" checked=""/><div class="controls bullet"><span class="by">guestbest</span><span>|</span><a href="#37258173">prev</a><span>|</span><a href="#37258269">next</a><span>|</span><label class="collapse" for="c-37258040">[-]</label><label class="expand" for="c-37258040">[5 more]</label></div><br/><div class="children"><div class="content">I always preferred LILO, since it always seemed to work, whereas GRUB aleays took an extra step back when I was using Gentoo in 2003</div><br/><div id="37259197" class="c"><input type="checkbox" id="c-37259197" checked=""/><div class="controls bullet"><span class="by">sedatk</span><span>|</span><a href="#37258040">parent</a><span>|</span><a href="#37258161">next</a><span>|</span><label class="collapse" for="c-37259197">[-]</label><label class="expand" for="c-37259197">[3 more]</label></div><br/><div class="children"><div class="content">I loved how each letter in LILO would signify a boot phase when I learned about it the first time my PC got frozen at &quot;LI&quot;.</div><br/><div id="37259514" class="c"><input type="checkbox" id="c-37259514" checked=""/><div class="controls bullet"><span class="by">gattilorenz</span><span>|</span><a href="#37258040">root</a><span>|</span><a href="#37259197">parent</a><span>|</span><a href="#37259432">next</a><span>|</span><label class="collapse" for="c-37259514">[-]</label><label class="expand" for="c-37259514">[1 more]</label></div><br/><div class="children"><div class="content">Similarly, the kernel of Xenix used letters A to Z to indicate which stage of the initialization it had reached: <a href="https:&#x2F;&#x2F;www.scosales.com&#x2F;ta&#x2F;kb&#x2F;105420.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.scosales.com&#x2F;ta&#x2F;kb&#x2F;105420.html</a>
Helpful for debugging issues.<p>I assume this was common with other Unices.</div><br/></div></div></div></div><div id="37258161" class="c"><input type="checkbox" id="c-37258161" checked=""/><div class="controls bullet"><span class="by">djbusby</span><span>|</span><a href="#37258040">parent</a><span>|</span><a href="#37259197">prev</a><span>|</span><a href="#37258269">next</a><span>|</span><label class="collapse" for="c-37258161">[-]</label><label class="expand" for="c-37258161">[1 more]</label></div><br/><div class="children"><div class="content">syslinux FTW!</div><br/></div></div></div></div><div id="37258269" class="c"><input type="checkbox" id="c-37258269" checked=""/><div class="controls bullet"><span class="by">user3939382</span><span>|</span><a href="#37258040">prev</a><span>|</span><a href="#37257017">next</a><span>|</span><label class="collapse" for="c-37258269">[-]</label><label class="expand" for="c-37258269">[1 more]</label></div><br/><div class="children"><div class="content">I created a disaster playing around with GRUB once 20 years ago and I’ve been afraid of it ever since.</div><br/></div></div><div id="37257017" class="c"><input type="checkbox" id="c-37257017" checked=""/><div class="controls bullet"><span class="by">freitzkriesler2</span><span>|</span><a href="#37258269">prev</a><span>|</span><label class="collapse" for="c-37257017">[-]</label><label class="expand" for="c-37257017">[2 more]</label></div><br/><div class="children"><div class="content">Bringing me back. There was another program I used to use on my penryn MacBook pro of the era. Refit I think but maybe older.</div><br/><div id="37257783" class="c"><input type="checkbox" id="c-37257783" checked=""/><div class="controls bullet"><span class="by">IAmLiterallyAB</span><span>|</span><a href="#37257017">parent</a><span>|</span><label class="collapse" for="c-37257783">[-]</label><label class="expand" for="c-37257783">[1 more]</label></div><br/><div class="children"><div class="content">Now there is rEFInd, a fork of rEFIt. <a href="http:&#x2F;&#x2F;www.rodsbooks.com&#x2F;refind&#x2F;" rel="nofollow noreferrer">http:&#x2F;&#x2F;www.rodsbooks.com&#x2F;refind&#x2F;</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>