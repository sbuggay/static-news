<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1684400451676" as="style"/><link rel="stylesheet" href="styles.css?v=1684400451676"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://medium.com/airbnb-engineering/improving-performance-with-http-streaming-ba9e72c66408">Improving Performance with HTTP Streaming</a> <span class="domain">(<a href="https://medium.com">medium.com</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>20 comments</span></div><br/><div><div id="35984492" class="c"><input type="checkbox" id="c-35984492" checked=""/><div class="controls bullet"><span class="by">nicbou</span><span>|</span><a href="#35985277">next</a><span>|</span><label class="collapse" for="c-35984492">[-]</label><label class="expand" for="c-35984492">[5 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think that we should get performance advice from the Airbnb team. It&#x27;s a really slow website that has no business being slow.</div><br/><div id="35985335" class="c"><input type="checkbox" id="c-35985335" checked=""/><div class="controls bullet"><span class="by">SerCe</span><span>|</span><a href="#35984492">parent</a><span>|</span><a href="#35984821">next</a><span>|</span><label class="collapse" for="c-35985335">[-]</label><label class="expand" for="c-35985335">[1 more]</label></div><br/><div class="children"><div class="content">It’s true that AirBnB isn’t the fastest website in the world. However, I don’t believe it’s fair or fruitful to criticise an article where an engineer spent time writing a blog and sharing interesting findings based on the merit of AirBnB’s current performance. If the advice is good, it doesn&#x27;t matter where it came from.</div><br/></div></div><div id="35984821" class="c"><input type="checkbox" id="c-35984821" checked=""/><div class="controls bullet"><span class="by">xiphias2</span><span>|</span><a href="#35984492">parent</a><span>|</span><a href="#35985335">prev</a><span>|</span><a href="#35985277">next</a><span>|</span><label class="collapse" for="c-35984821">[-]</label><label class="expand" for="c-35984821">[3 more]</label></div><br/><div class="children"><div class="content">I just went to check how fast is airbnb: the base site loads fast, then they are showing popups of their ,,new features’’ and cookie popups.<p>They should get rid of the popups before starting other optimizations.</div><br/><div id="35985412" class="c"><input type="checkbox" id="c-35985412" checked=""/><div class="controls bullet"><span class="by">dgb23</span><span>|</span><a href="#35984492">root</a><span>|</span><a href="#35984821">parent</a><span>|</span><a href="#35985337">next</a><span>|</span><label class="collapse" for="c-35985412">[-]</label><label class="expand" for="c-35985412">[1 more]</label></div><br/><div class="children"><div class="content">Part of my job is web performance “optimization”[0]:<p>Cookie popups and third party JS are two of the biggest culprits for slow sites next to large images&#x2F;videos and general bloat. Some of these tracking scripts and cookie popups require you to put them into the head. It’s terrible.<p>I always suggest my clients to simply remove them. Users are retained when the site loads and navigates fast. Spying on them doesn’t help…<p>Very large sites actually get leverage out of some analysis and tracking, however they should be doing that inhouse.<p>For everyone else it’s simply not worth it except that is your business model (not our clients).<p>[0] it’s called optimization, but it’s mostly just measuring, cleaning up, moving to standard practices and deleting alot of code. The times I get to optimize queries and algorithms are fun, impactful but rare. Most sites just suck because they are bloated and unpolished.</div><br/></div></div><div id="35985337" class="c"><input type="checkbox" id="c-35985337" checked=""/><div class="controls bullet"><span class="by">andy_ppp</span><span>|</span><a href="#35984492">root</a><span>|</span><a href="#35984821">parent</a><span>|</span><a href="#35985412">prev</a><span>|</span><a href="#35985277">next</a><span>|</span><label class="collapse" for="c-35985337">[-]</label><label class="expand" for="c-35985337">[1 more]</label></div><br/><div class="children"><div class="content">I still don’t think the cookie pop ups are mandatory, just put a toggle for them in the footer and you’ve complied in a perfectly reasonable way IMO.</div><br/></div></div></div></div></div></div><div id="35985277" class="c"><input type="checkbox" id="c-35985277" checked=""/><div class="controls bullet"><span class="by">kristjank</span><span>|</span><a href="#35984492">prev</a><span>|</span><a href="#35984142">next</a><span>|</span><label class="collapse" for="c-35985277">[-]</label><label class="expand" for="c-35985277">[2 more]</label></div><br/><div class="children"><div class="content">I use a &gt;10 years old X3470 for my college PC, which works surprisingly well for most computing-intensive tasks like compiling, virtualization, and running services in the background. It is however lagging behind horribly in web browsing, because of its poor single thread performance.<p>When I see posts like these, I become even more afraid of what the web is becoming. I don&#x27;t want to have any website fetching itself piecemeal, freezing my browser window for ~5 seconds while the browser logic scrambles to reconstitute content from a million pieces.</div><br/><div id="35985367" class="c"><input type="checkbox" id="c-35985367" checked=""/><div class="controls bullet"><span class="by">dgb23</span><span>|</span><a href="#35985277">parent</a><span>|</span><a href="#35984142">next</a><span>|</span><label class="collapse" for="c-35985367">[-]</label><label class="expand" for="c-35985367">[1 more]</label></div><br/><div class="children"><div class="content">Streaming HTML documents is basically the default for the majority of sites, because most sites run on PHP.</div><br/></div></div></div></div><div id="35984142" class="c"><input type="checkbox" id="c-35984142" checked=""/><div class="controls bullet"><span class="by">byroot</span><span>|</span><a href="#35985277">prev</a><span>|</span><a href="#35984610">next</a><span>|</span><label class="collapse" for="c-35984142">[-]</label><label class="expand" for="c-35984142">[9 more]</label></div><br/><div class="children"><div class="content">I wonder why they didn&#x27;t consider 103 Early Hints instead, as it solves the same problem in a much more elegant way, and doesn&#x27;t require to re-architecture your application.</div><br/><div id="35984881" class="c"><input type="checkbox" id="c-35984881" checked=""/><div class="controls bullet"><span class="by">dmw_ng</span><span>|</span><a href="#35984142">parent</a><span>|</span><a href="#35984681">next</a><span>|</span><label class="collapse" for="c-35984881">[-]</label><label class="expand" for="c-35984881">[4 more]</label></div><br/><div class="children"><div class="content">Early hints solves a different problem, there you have a list of asset URLs you know your rendered page will need. This is about producing pieces of rendered page as computation completes on the backend.<p>Implementing this is a pain in the ass, any new intermediary (haproxy, nginx, ...) introduces a potential new source of buffering or IO loop that attempts to helpfully batch up your writes. But when the technique is implemented, it is legitimately an amazing way to reduce latency at the client.<p>I use this technique in an app where an opening chunk is used to ensure the browser has begun fetching&#x2F;executing the app JS bundle before a list response is rendered. After the list is rendered (incrementally as each chunk becomes available) it is again used to execute a slow summary query without having to break out a separate request. All that fits in a single HTTP response body, no additional latency is introduced by making separate API requests for the list or for the counts. Because of the initial chunk causing the JS to execute, it is also possible for the app to display certain dialogs (depending on query string parameters) that are immediately ready for user input even before the subsequent responses have finished rendering or downloading. In the case of this specific app, the technique means some dialogs are usable 300ms earlier than otherwise<p>Another issue not touched on in the post is how all this newly unbuffered incrementally-arriving data interacts with visual rendering on the client, there is potential for a lot of flicker and burned CPU continually re-rendering UI elements.<p>It sounds like Airbnb are disabling compression to make their implementation work. So long as CPU isn&#x27;t a problem, you can also implement compression in the backend, and flush the compressor each time some useful unit of work is produced (some task completes, or some amount of data e.g. aligned to the size of an Ethernet MTU is available for writing). Assuming all the stars align, this should produce compressed output in a form the browser can act on every time it manages to read any amount of data from the backend.<p>All this effort seems like nonsense until finding you have a perfectly functional app on a crappy airport wifi network where it was otherwise impossible to even get Google to load</div><br/><div id="35984987" class="c"><input type="checkbox" id="c-35984987" checked=""/><div class="controls bullet"><span class="by">byroot</span><span>|</span><a href="#35984142">root</a><span>|</span><a href="#35984881">parent</a><span>|</span><a href="#35984681">next</a><span>|</span><label class="collapse" for="c-35984987">[-]</label><label class="expand" for="c-35984987">[3 more]</label></div><br/><div class="children"><div class="content">&gt; Early hints solves a different problem<p>I think it saves the same main problem which is to trigger assets download early.<p>However you are right streaming the response has a few extra advantages.<p>I still think getting most of the results with a tiny fraction of the effort is a better solution, but your mileage may vary.</div><br/><div id="35985003" class="c"><input type="checkbox" id="c-35985003" checked=""/><div class="controls bullet"><span class="by">dmw_ng</span><span>|</span><a href="#35984142">root</a><span>|</span><a href="#35984987">parent</a><span>|</span><a href="#35984681">next</a><span>|</span><label class="collapse" for="c-35985003">[-]</label><label class="expand" for="c-35985003">[2 more]</label></div><br/><div class="children"><div class="content">What if the assets are a list of URLs computed incrementally? In my app&#x27;s case, the specific JS bundle variant to load is itself a result of a database query. It&#x27;s easy to see many scenarios where the majority of assets (e.g. say photos) aren&#x27;t known prior to building the response body</div><br/><div id="35985027" class="c"><input type="checkbox" id="c-35985027" checked=""/><div class="controls bullet"><span class="by">byroot</span><span>|</span><a href="#35984142">root</a><span>|</span><a href="#35985003">parent</a><span>|</span><a href="#35984681">next</a><span>|</span><label class="collapse" for="c-35985027">[-]</label><label class="expand" for="c-35985027">[1 more]</label></div><br/><div class="children"><div class="content">But you can emit as many 103 as you want. So you can start by sending the statically known assets, and then emit an extra 103 each time you are at the stage where the other assets are known.</div><br/></div></div></div></div></div></div></div></div><div id="35984681" class="c"><input type="checkbox" id="c-35984681" checked=""/><div class="controls bullet"><span class="by">LinusU</span><span>|</span><a href="#35984142">parent</a><span>|</span><a href="#35984881">prev</a><span>|</span><a href="#35984717">next</a><span>|</span><label class="collapse" for="c-35984681">[-]</label><label class="expand" for="c-35984681">[1 more]</label></div><br/><div class="children"><div class="content">103 Early Hints is &quot;experimental technology&quot; (according to MDN) and isn&#x27;t supported by Safari and Firefox. In Chrome it&#x27;s only supported when using HTTP&#x2F;2 or later (Firefox Nightly support it for HTTP&#x2F;1).<p>ref: <a href="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Status&#x2F;103" rel="nofollow">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Status&#x2F;103</a></div><br/></div></div><div id="35984717" class="c"><input type="checkbox" id="c-35984717" checked=""/><div class="controls bullet"><span class="by">vrnvu</span><span>|</span><a href="#35984142">parent</a><span>|</span><a href="#35984681">prev</a><span>|</span><a href="#35984516">next</a><span>|</span><label class="collapse" for="c-35984717">[-]</label><label class="expand" for="c-35984717">[1 more]</label></div><br/><div class="children"><div class="content">Simple solutions don&#x27;t get software engineers promoted for their architecture skills, and catchy blog posts can&#x27;t be written.</div><br/></div></div><div id="35984516" class="c"><input type="checkbox" id="c-35984516" checked=""/><div class="controls bullet"><span class="by">memco</span><span>|</span><a href="#35984142">parent</a><span>|</span><a href="#35984717">prev</a><span>|</span><a href="#35984610">next</a><span>|</span><label class="collapse" for="c-35984516">[-]</label><label class="expand" for="c-35984516">[2 more]</label></div><br/><div class="children"><div class="content">Can you share more? How are they implemented and how do they help?</div><br/><div id="35984577" class="c"><input type="checkbox" id="c-35984577" checked=""/><div class="controls bullet"><span class="by">byroot</span><span>|</span><a href="#35984142">root</a><span>|</span><a href="#35984516">parent</a><span>|</span><a href="#35984610">next</a><span>|</span><label class="collapse" for="c-35984577">[-]</label><label class="expand" for="c-35984577">[1 more]</label></div><br/><div class="children"><div class="content">See <a href="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Status&#x2F;103" rel="nofollow">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Web&#x2F;HTTP&#x2F;Status&#x2F;103</a><p>As they mention in the article, the main goal of streaming your response is to deliver the &lt;head&gt; tag to the browser sooner, so that it can start downloading assets sooner.<p>However it has many downsides like explained in the article (can&#x27;t change response code or headers once they are sent etc), which requires many hacks.<p>103 early hints allow to asynchronously send &quot;provisional&quot; headers, including `Link rel=preload` headers, which the browser can use to start downloading assets, but without restricting in any way the final response rendering.<p>That&#x27;s basically the same goal than HTTP2 Server Push (which was deprecated), but much simpler to implement (works with HTTP&#x2F;1), and allow the browser not to download resources it already have in cache.</div><br/></div></div></div></div></div></div><div id="35984610" class="c"><input type="checkbox" id="c-35984610" checked=""/><div class="controls bullet"><span class="by">bobske3</span><span>|</span><a href="#35984142">prev</a><span>|</span><a href="#35985025">next</a><span>|</span><label class="collapse" for="c-35984610">[-]</label><label class="expand" for="c-35984610">[1 more]</label></div><br/><div class="children"><div class="content">what framework is used here? I don’t see any implementation or what?<p>Blazor has this inbuilt now in .NET 8 preview 4:
<a href="https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;dotnet&#x2F;asp-net-core-updates-in-dotnet-8-preview-4&#x2F;#blazor" rel="nofollow">https:&#x2F;&#x2F;devblogs.microsoft.com&#x2F;dotnet&#x2F;asp-net-core-updates-i...</a></div><br/></div></div><div id="35985025" class="c"><input type="checkbox" id="c-35985025" checked=""/><div class="controls bullet"><span class="by">ulrischa</span><span>|</span><a href="#35984610">prev</a><span>|</span><label class="collapse" for="c-35985025">[-]</label><label class="expand" for="c-35985025">[2 more]</label></div><br/><div class="children"><div class="content">I did something similar with an ajax call to a php script using output buffer. What is important to use the ajax state 3. Here is a description (sorry in German):
<a href="https:&#x2F;&#x2F;www.ulrischa.de&#x2F;quasi-realtime-anwendung-mit-jquery-und-php&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.ulrischa.de&#x2F;quasi-realtime-anwendung-mit-jquery-...</a></div><br/><div id="35985530" class="c"><input type="checkbox" id="c-35985530" checked=""/><div class="controls bullet"><span class="by">dgb23</span><span>|</span><a href="#35985025">parent</a><span>|</span><label class="collapse" for="c-35985530">[-]</label><label class="expand" for="c-35985530">[1 more]</label></div><br/><div class="children"><div class="content">PHP streams by default. It’s not entirely clear to me why you buffered the output and flushed it manually (in every iteration?) from the article.</div><br/></div></div></div></div></div></div></div></div></div></body></html>