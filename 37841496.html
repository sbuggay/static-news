<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1697014864179" as="style"/><link rel="stylesheet" href="styles.css?v=1697014864179"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://daniel.haxx.se/blog/2023/10/11/how-i-made-a-heap-overflow-in-curl/">How I Made a Heap Overflow in Curl</a> <span class="domain">(<a href="https://daniel.haxx.se">daniel.haxx.se</a>)</span></div><div class="subtext"><span>ghuntley</span> | <span>17 comments</span></div><br/><div><div id="37842314" class="c"><input type="checkbox" id="c-37842314" checked=""/><div class="controls bullet"><span class="by">dig1</span><span>|</span><a href="#37842028">next</a><span>|</span><label class="collapse" for="c-37842314">[-]</label><label class="expand" for="c-37842314">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Yes, this family of flaws would have been impossible if curl had been written in a memory-safe language instead of C<p>It could have been impossible, but you never know if there is a way to escape language VM barriers. However, the author clearly ignored the DNS hostname limit stated in RFC1123 [1], which is hardcoded even in Java libraries.<p>[1] <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc1123" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc1123</a></div><br/></div></div><div id="37842028" class="c"><input type="checkbox" id="c-37842028" checked=""/><div class="controls bullet"><span class="by">gkhartman</span><span>|</span><a href="#37842314">prev</a><span>|</span><a href="#37842063">next</a><span>|</span><label class="collapse" for="c-37842028">[-]</label><label class="expand" for="c-37842028">[1 more]</label></div><br/><div class="children"><div class="content">It still blows my mind that so many devices depend on a library largely written by a single person.  The level of pressure must be insane and it shows in this bit:<p>&quot;Reading the code now it is impossible not to see the bug. Yes, it truly aches having to accept the fact that I did this mistake without noticing and that the flaw then remained undiscovered in code for 1315 days. I apologize. I am but a human.&quot;<p>If Daniel happens to read this, thanks for your hard work, and I really don&#x27;t think any apology is necessary.  After all, the source was right there for any of us to read and review.</div><br/></div></div><div id="37842063" class="c"><input type="checkbox" id="c-37842063" checked=""/><div class="controls bullet"><span class="by">pizza234</span><span>|</span><a href="#37842028">prev</a><span>|</span><a href="#37842004">next</a><span>|</span><label class="collapse" for="c-37842063">[-]</label><label class="expand" for="c-37842063">[1 more]</label></div><br/><div class="children"><div class="content">Very sensible conclusions about memory safety&#x2F;memory-safe languages; excerpts follow.<p>---<p>Yes, this family of flaws would have been impossible if curl had been written in a memory-safe language instead of C [...]<p>The only approach in that direction I consider viable and sensible is to:<p>- allow, use and support more dependencies written in memory-safe languages and<p>- potentially and gradually replace parts of curl piecemeal, like with the introduction of hyper.<p>Such development is however currently happening in a near glacial speed and shows with painful clarity the challenges involved. curl will remain written in C for the foreseeable future.<p>Everyone not happy about this are of course welcome to roll up their sleeves and get working.<p>Including the latest two CVEs reported for curl 8.4.0, the accumulated total says that 41% of the security vulnerabilities ever found in curl would likely not have happened should we have used a memory-safe language. But also: the rust language was not even a possibility for practical use for this purpose during the time in which we introduced maybe the first 80% of the C related problems.<p>[...]<p>We repeatedly run several static code analyzers on the code and none of them have spotted any problems in this function.</div><br/></div></div><div id="37842004" class="c"><input type="checkbox" id="c-37842004" checked=""/><div class="controls bullet"><span class="by">account-5</span><span>|</span><a href="#37842063">prev</a><span>|</span><a href="#37842252">next</a><span>|</span><label class="collapse" for="c-37842004">[-]</label><label class="expand" for="c-37842004">[1 more]</label></div><br/><div class="children"><div class="content">I have to say this is the best CVE writeups I&#x27;ve ever read. And I can only commend the author who is humble throughout despite authoring one of the cornerstone software products of the age. Much respect.</div><br/></div></div><div id="37842252" class="c"><input type="checkbox" id="c-37842252" checked=""/><div class="controls bullet"><span class="by">dogben</span><span>|</span><a href="#37842004">prev</a><span>|</span><a href="#37841768">next</a><span>|</span><label class="collapse" for="c-37842252">[-]</label><label class="expand" for="c-37842252">[1 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  if(!socks5_resolve_local &amp;&amp; hostname_len &gt; 255) {
    socks5_resolve_local = TRUE;
  }
</code></pre>
This is really a bad idea. For people who use anti-censorship tool to protect privacy, this can leak their identity though DNS.</div><br/></div></div><div id="37841768" class="c"><input type="checkbox" id="c-37841768" checked=""/><div class="controls bullet"><span class="by">notRobot</span><span>|</span><a href="#37842252">prev</a><span>|</span><a href="#37841628">next</a><span>|</span><label class="collapse" for="c-37841768">[-]</label><label class="expand" for="c-37841768">[1 more]</label></div><br/><div class="children"><div class="content">I have always been a huge fan of Daniel&#x27;s writing. Such clear and honest writing explaining reasonings and perspectives.</div><br/></div></div><div id="37841628" class="c"><input type="checkbox" id="c-37841628" checked=""/><div class="controls bullet"><span class="by">junon</span><span>|</span><a href="#37841768">prev</a><span>|</span><a href="#37841844">next</a><span>|</span><label class="collapse" for="c-37841628">[-]</label><label class="expand" for="c-37841628">[8 more]</label></div><br/><div class="children"><div class="content">&gt; Yes, this family of flaws would have been impossible if curl had been written in a memory-safe language instead of C, but porting curl to another language is not on the agenda. I am sure the news about this vulnerability will trigger a new flood of questions about and calls for that and I can sigh, roll my eyes and try to answer this again.<p>Just to get ahead of the HN comments about this.</div><br/><div id="37841716" class="c"><input type="checkbox" id="c-37841716" checked=""/><div class="controls bullet"><span class="by">knallfrosch</span><span>|</span><a href="#37841628">parent</a><span>|</span><a href="#37841736">next</a><span>|</span><label class="collapse" for="c-37841716">[-]</label><label class="expand" for="c-37841716">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Everyone not happy about this are of course welcome to roll up their sleeves and get working.</div><br/><div id="37841922" class="c"><input type="checkbox" id="c-37841922" checked=""/><div class="controls bullet"><span class="by">junon</span><span>|</span><a href="#37841628">root</a><span>|</span><a href="#37841716">parent</a><span>|</span><a href="#37841736">next</a><span>|</span><label class="collapse" for="c-37841922">[-]</label><label class="expand" for="c-37841922">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t post it as an angry response, just knew what kind of comments this would receive. Not sure why it got flagged, I wasn&#x27;t saying this was some sort of excuse or that it should be rewritten, just found it interesting he included it. I&#x27;m sure he gets that comment a lot.</div><br/></div></div></div></div><div id="37841736" class="c"><input type="checkbox" id="c-37841736" checked=""/><div class="controls bullet"><span class="by">ahoka</span><span>|</span><a href="#37841628">parent</a><span>|</span><a href="#37841716">prev</a><span>|</span><a href="#37841844">next</a><span>|</span><label class="collapse" for="c-37841736">[-]</label><label class="expand" for="c-37841736">[5 more]</label></div><br/><div class="children"><div class="content">It doesn’t help that the whole function is a huge computed goto mutating things, spanning multiple pages.</div><br/><div id="37841850" class="c"><input type="checkbox" id="c-37841850" checked=""/><div class="controls bullet"><span class="by">messe</span><span>|</span><a href="#37841628">root</a><span>|</span><a href="#37841736">parent</a><span>|</span><a href="#37841844">next</a><span>|</span><label class="collapse" for="c-37841850">[-]</label><label class="expand" for="c-37841850">[4 more]</label></div><br/><div class="children"><div class="content">…you mean the most common pattern for writing a state machine?</div><br/><div id="37842303" class="c"><input type="checkbox" id="c-37842303" checked=""/><div class="controls bullet"><span class="by">diogenes4</span><span>|</span><a href="#37841628">root</a><span>|</span><a href="#37841850">parent</a><span>|</span><a href="#37841997">next</a><span>|</span><label class="collapse" for="c-37842303">[-]</label><label class="expand" for="c-37842303">[1 more]</label></div><br/><div class="children"><div class="content">This is a well-discussed issue with c memes, not a widespread issue.</div><br/></div></div><div id="37841997" class="c"><input type="checkbox" id="c-37841997" checked=""/><div class="controls bullet"><span class="by">anon-3988</span><span>|</span><a href="#37841628">root</a><span>|</span><a href="#37841850">parent</a><span>|</span><a href="#37842303">prev</a><span>|</span><a href="#37841844">next</a><span>|</span><label class="collapse" for="c-37841997">[-]</label><label class="expand" for="c-37841997">[2 more]</label></div><br/><div class="children"><div class="content">There&#x27;s obviously no better way to write state machines...</div><br/><div id="37842027" class="c"><input type="checkbox" id="c-37842027" checked=""/><div class="controls bullet"><span class="by">parasti</span><span>|</span><a href="#37841628">root</a><span>|</span><a href="#37841997">parent</a><span>|</span><a href="#37841844">next</a><span>|</span><label class="collapse" for="c-37842027">[-]</label><label class="expand" for="c-37842027">[1 more]</label></div><br/><div class="children"><div class="content">Can you elaborate?</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37841844" class="c"><input type="checkbox" id="c-37841844" checked=""/><div class="controls bullet"><span class="by">ChoHag</span><span>|</span><a href="#37841628">prev</a><span>|</span><label class="collapse" for="c-37841844">[-]</label><label class="expand" for="c-37841844">[2 more]</label></div><br/><div class="children"><div class="content">In case anyone missed it in the word salad which obscures any of the details, it read from a server it had no reason to trust and wrote its response into a buffer that was not prepared for it.</div><br/><div id="37842229" class="c"><input type="checkbox" id="c-37842229" checked=""/><div class="controls bullet"><span class="by">pgeorgi</span><span>|</span><a href="#37841844">parent</a><span>|</span><label class="collapse" for="c-37842229">[-]</label><label class="expand" for="c-37842229">[1 more]</label></div><br/><div class="children"><div class="content">Come on, it starts out with a link to the CVE and a remark &quot;While the advisory contains all the necessary details. I figured I would use a few additional words...&quot;<p>If you just want the gist of it, the article does everything it can to send you there.</div><br/></div></div></div></div></div></div></div></div></div></body></html>