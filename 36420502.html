<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687424459210" as="style"/><link rel="stylesheet" href="styles.css?v=1687424459210"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://people.freebsd.org/~lstewart/articles/cpumemory.pdf">What every programmer should know about memory (2007) [pdf]</a> <span class="domain">(<a href="https://people.freebsd.org">people.freebsd.org</a>)</span></div><div class="subtext"><span>quackulus</span> | <span>31 comments</span></div><br/><div><div id="36427565" class="c"><input type="checkbox" id="c-36427565" checked=""/><div class="controls bullet"><span class="by">harry8</span><span>|</span><a href="#36425817">next</a><span>|</span><label class="collapse" for="c-36427565">[-]</label><label class="expand" for="c-36427565">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;8126311&#x2F;how-much-of-what-every-programmer-should-know-about-memory-is-still-valid" rel="nofollow noreferrer">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;8126311&#x2F;how-much-of-what...</a><p>Discussion of it in slightly more modern context, worth looking at.</div><br/></div></div><div id="36425817" class="c"><input type="checkbox" id="c-36425817" checked=""/><div class="controls bullet"><span class="by">karmakaze</span><span>|</span><a href="#36427565">prev</a><span>|</span><a href="#36424182">next</a><span>|</span><label class="collapse" for="c-36425817">[-]</label><label class="expand" for="c-36425817">[1 more]</label></div><br/><div class="children"><div class="content">I get by with latency numbers every programmer should know[0]. Knowing a bit about how cache sharing works is helpful some times[1].<p>[0] <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;hellerbarde&#x2F;2843375?permalink_comment_id=1753093#latency-numbers-every-programmer-should-know" rel="nofollow noreferrer">https:&#x2F;&#x2F;gist.github.com&#x2F;hellerbarde&#x2F;2843375?permalink_commen...</a><p>[1] <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;False_sharing" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;False_sharing</a></div><br/></div></div><div id="36424182" class="c"><input type="checkbox" id="c-36424182" checked=""/><div class="controls bullet"><span class="by">frithsun</span><span>|</span><a href="#36425817">prev</a><span>|</span><a href="#36426210">next</a><span>|</span><label class="collapse" for="c-36424182">[-]</label><label class="expand" for="c-36424182">[4 more]</label></div><br/><div class="children"><div class="content">What only a small subset of highly specialized programmers should know about memory (2007) [pdf]</div><br/><div id="36425660" class="c"><input type="checkbox" id="c-36425660" checked=""/><div class="controls bullet"><span class="by">santiagobasulto</span><span>|</span><a href="#36424182">parent</a><span>|</span><a href="#36426210">next</a><span>|</span><label class="collapse" for="c-36425660">[-]</label><label class="expand" for="c-36425660">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m a very high level programmer, turned Data Scientist, turned founder (I successfully exited my prev startup). I still read this paper (a few years ago). I guess if you&#x27;re &quot;born&quot; a programmer, all these nerdy&#x2F;curious things are entertaining. One of my &quot;developer&quot; passions is multithreading and concurrency. Even now running my second startup, I, from time to time, sit to write some concurrent puzzle programs.<p>I also like to follow Tobi Lütke. The guy is the founder&#x2F;CEO of Shopify (with all which that might entail), and he still tweets amazingly interesting low level coder stuff.</div><br/><div id="36427118" class="c"><input type="checkbox" id="c-36427118" checked=""/><div class="controls bullet"><span class="by">niuzeta</span><span>|</span><a href="#36424182">root</a><span>|</span><a href="#36425660">parent</a><span>|</span><a href="#36427920">next</a><span>|</span><label class="collapse" for="c-36427118">[-]</label><label class="expand" for="c-36427118">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  sit to write some concurrent puzzle programs.<p>I concur. There&#x27;s something about concurrency and multithreading that ticks your brain in a weird way. It keeps me stimulated.<p>My favorite is setting up a scenario that would normally be considered as a disasterous concurrency failure. Like intentionally messing up a `volatile` state. You can&#x27;t ever have those in prod, of course, but seeing them in a controlled, _expected_ way tickles my brain in a very perverse way.</div><br/></div></div><div id="36427920" class="c"><input type="checkbox" id="c-36427920" checked=""/><div class="controls bullet"><span class="by">sbmthakur</span><span>|</span><a href="#36424182">root</a><span>|</span><a href="#36425660">parent</a><span>|</span><a href="#36427118">prev</a><span>|</span><a href="#36426210">next</a><span>|</span><label class="collapse" for="c-36427920">[-]</label><label class="expand" for="c-36427920">[1 more]</label></div><br/><div class="children"><div class="content">Any sample of your puzzle program that you may be willing to share? I want to perform my own experiments with multi threading but being a Javascript dev, it&#x27;s not something I deal with quite often. Also great work on DataWars. The onboarding experience and the site layout is pleasant.</div><br/></div></div></div></div></div></div><div id="36426210" class="c"><input type="checkbox" id="c-36426210" checked=""/><div class="controls bullet"><span class="by">antonvs</span><span>|</span><a href="#36424182">prev</a><span>|</span><a href="#36424273">next</a><span>|</span><label class="collapse" for="c-36426210">[-]</label><label class="expand" for="c-36426210">[1 more]</label></div><br/><div class="children"><div class="content">Hardware memory characteristics may have changed in the last 16 years, but the attractions of misleading clickbait titles have not.</div><br/></div></div><div id="36424273" class="c"><input type="checkbox" id="c-36424273" checked=""/><div class="controls bullet"><span class="by">lizardking</span><span>|</span><a href="#36426210">prev</a><span>|</span><a href="#36422751">next</a><span>|</span><label class="collapse" for="c-36424273">[-]</label><label class="expand" for="c-36424273">[2 more]</label></div><br/><div class="children"><div class="content">Yes, every developer needs 114 pages worth of knowledge about memory.</div><br/><div id="36426115" class="c"><input type="checkbox" id="c-36426115" checked=""/><div class="controls bullet"><span class="by">mrwnmonm</span><span>|</span><a href="#36424273">parent</a><span>|</span><a href="#36422751">next</a><span>|</span><label class="collapse" for="c-36426115">[-]</label><label class="expand" for="c-36426115">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, I read some of it before, and had no idea why I would need this.</div><br/></div></div></div></div><div id="36422751" class="c"><input type="checkbox" id="c-36422751" checked=""/><div class="controls bullet"><span class="by">redhal</span><span>|</span><a href="#36424273">prev</a><span>|</span><a href="#36425410">next</a><span>|</span><label class="collapse" for="c-36422751">[-]</label><label class="expand" for="c-36422751">[3 more]</label></div><br/><div class="children"><div class="content">For a great read with more recent numbers, I recommend you checkout this post
<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=22287993">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=22287993</a></div><br/><div id="36423542" class="c"><input type="checkbox" id="c-36423542" checked=""/><div class="controls bullet"><span class="by">cbsmith</span><span>|</span><a href="#36422751">parent</a><span>|</span><a href="#36425410">next</a><span>|</span><label class="collapse" for="c-36423542">[-]</label><label class="expand" for="c-36423542">[2 more]</label></div><br/><div class="children"><div class="content">The most important stuff in this paper isn&#x27;t the numbers.</div><br/><div id="36425363" class="c"><input type="checkbox" id="c-36425363" checked=""/><div class="controls bullet"><span class="by">utopcell</span><span>|</span><a href="#36422751">root</a><span>|</span><a href="#36423542">parent</a><span>|</span><a href="#36425410">next</a><span>|</span><label class="collapse" for="c-36425363">[-]</label><label class="expand" for="c-36425363">[1 more]</label></div><br/><div class="children"><div class="content">Still, the parent is a valuable link. Thanks for sharing.</div><br/></div></div></div></div></div></div><div id="36425410" class="c"><input type="checkbox" id="c-36425410" checked=""/><div class="controls bullet"><span class="by">utopcell</span><span>|</span><a href="#36422751">prev</a><span>|</span><a href="#36423139">next</a><span>|</span><label class="collapse" for="c-36425410">[-]</label><label class="expand" for="c-36425410">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve read this doc many years ago, and I remember it was worth the time. If folks are contemplating on what has changed since 2007 that this doc is not covering, I&#x27;d say it is CCX awareness for AMD CPUs.</div><br/></div></div><div id="36423139" class="c"><input type="checkbox" id="c-36423139" checked=""/><div class="controls bullet"><span class="by">alberth</span><span>|</span><a href="#36425410">prev</a><span>|</span><a href="#36423719">next</a><span>|</span><label class="collapse" for="c-36423139">[-]</label><label class="expand" for="c-36423139">[4 more]</label></div><br/><div class="children"><div class="content">FYI - this doesn&#x27;t seem to be related to FreeBSD (even though it&#x27;s hosted there).<p>It just appears to be an external PDF that FreeBSD committer Lawrence Stewart saved to their fileshare, written by someone else.</div><br/><div id="36423525" class="c"><input type="checkbox" id="c-36423525" checked=""/><div class="controls bullet"><span class="by">cbsmith</span><span>|</span><a href="#36423139">parent</a><span>|</span><a href="#36423719">next</a><span>|</span><label class="collapse" for="c-36423525">[-]</label><label class="expand" for="c-36423525">[3 more]</label></div><br/><div class="children"><div class="content">Yeah, there&#x27;s a pretty famous history on this paper (and with Ulrich Drepper).</div><br/><div id="36423631" class="c"><input type="checkbox" id="c-36423631" checked=""/><div class="controls bullet"><span class="by">quackulus</span><span>|</span><a href="#36423139">root</a><span>|</span><a href="#36423525">parent</a><span>|</span><a href="#36423719">next</a><span>|</span><label class="collapse" for="c-36423631">[-]</label><label class="expand" for="c-36423631">[2 more]</label></div><br/><div class="children"><div class="content">Please do tell</div><br/><div id="36424635" class="c"><input type="checkbox" id="c-36424635" checked=""/><div class="controls bullet"><span class="by">cbsmith</span><span>|</span><a href="#36423139">root</a><span>|</span><a href="#36423631">parent</a><span>|</span><a href="#36423719">next</a><span>|</span><label class="collapse" for="c-36424635">[-]</label><label class="expand" for="c-36424635">[1 more]</label></div><br/><div class="children"><div class="content">He&#x27;s been the maintainer of glibc (still a developer), and a variety of other key bits of open source software. He&#x27;s kind of famously abrasive&#x2F;obtuse: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=2378013">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=2378013</a>. The paper was kind of a canonical work, referenced by most everyone (which is no doubt why there&#x27;s a copy of it on the FreeBSD site).</div><br/></div></div></div></div></div></div></div></div><div id="36423719" class="c"><input type="checkbox" id="c-36423719" checked=""/><div class="controls bullet"><span class="by">everyone</span><span>|</span><a href="#36423139">prev</a><span>|</span><a href="#36422205">next</a><span>|</span><label class="collapse" for="c-36423719">[-]</label><label class="expand" for="c-36423719">[3 more]</label></div><br/><div class="children"><div class="content">I dunno, I&#x27;m a game programmer and it seems a bit too much for me personally.
I just John Carmack it, and always do the simplest thing <i>for me</i> as the dev. If the benchmarks arent fit for purpose¹ then I will look at profiler to see what lowest hanging fruit is to optimise. I&#x27;m not gonna guess what is slow, I am not a computer, I only just look at profiler.<p>¹This almost never happens.</div><br/><div id="36427895" class="c"><input type="checkbox" id="c-36427895" checked=""/><div class="controls bullet"><span class="by">sbmthakur</span><span>|</span><a href="#36423719">parent</a><span>|</span><a href="#36422205">next</a><span>|</span><label class="collapse" for="c-36427895">[-]</label><label class="expand" for="c-36427895">[2 more]</label></div><br/><div class="children"><div class="content">What does &quot;John Carmack it&quot; means? Take the simplest and correct approach?</div><br/><div id="36428080" class="c"><input type="checkbox" id="c-36428080" checked=""/><div class="controls bullet"><span class="by">everyone</span><span>|</span><a href="#36423719">root</a><span>|</span><a href="#36427895">parent</a><span>|</span><a href="#36422205">next</a><span>|</span><label class="collapse" for="c-36428080">[-]</label><label class="expand" for="c-36428080">[1 more]</label></div><br/><div class="children"><div class="content">Like what I described, start with the utter simplest&#x2F;easiest code for <i>you</i> the developer, and only optimise it&#x2F;make it more complicated, later if it&#x27;s benchmarked and not up to a standard you are aiming for (of feature quality or performance or whatever). There was a bit about it in that book &quot;Masters of DOOM&quot; 
I also personally equate simplest&#x2F;easiest code for <i>you</i> with most maintainable code also.</div><br/></div></div></div></div></div></div><div id="36422205" class="c"><input type="checkbox" id="c-36422205" checked=""/><div class="controls bullet"><span class="by">kaycey2022</span><span>|</span><a href="#36423719">prev</a><span>|</span><a href="#36420628">next</a><span>|</span><label class="collapse" for="c-36422205">[-]</label><label class="expand" for="c-36422205">[1 more]</label></div><br/><div class="children"><div class="content">What would be an up to date alternative to this document?</div><br/></div></div><div id="36420628" class="c"><input type="checkbox" id="c-36420628" checked=""/><div class="controls bullet"><span class="by">AnimalMuppet</span><span>|</span><a href="#36422205">prev</a><span>|</span><a href="#36422689">next</a><span>|</span><label class="collapse" for="c-36420628">[-]</label><label class="expand" for="c-36420628">[8 more]</label></div><br/><div class="children"><div class="content">(2007).</div><br/><div id="36420747" class="c"><input type="checkbox" id="c-36420747" checked=""/><div class="controls bullet"><span class="by">bediger4000</span><span>|</span><a href="#36420628">parent</a><span>|</span><a href="#36422689">next</a><span>|</span><label class="collapse" for="c-36420747">[-]</label><label class="expand" for="c-36420747">[7 more]</label></div><br/><div class="children"><div class="content">Does the age affect how I, as a programmer, should read it?</div><br/><div id="36421917" class="c"><input type="checkbox" id="c-36421917" checked=""/><div class="controls bullet"><span class="by">mdaverde</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36420747">parent</a><span>|</span><a href="#36425286">next</a><span>|</span><label class="collapse" for="c-36421917">[-]</label><label class="expand" for="c-36421917">[1 more]</label></div><br/><div class="children"><div class="content">Literally, yes.<p>As example, the north bridge isn&#x27;t as explicit today as the document makes it seem. A lot of functionality that used to be reserved for the north bridge is now being tucked away into the CPUs or motherboards themselves.<p>Still, worth reading.</div><br/></div></div><div id="36425286" class="c"><input type="checkbox" id="c-36425286" checked=""/><div class="controls bullet"><span class="by">kevstev</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36420747">parent</a><span>|</span><a href="#36421917">prev</a><span>|</span><a href="#36421938">next</a><span>|</span><label class="collapse" for="c-36425286">[-]</label><label class="expand" for="c-36425286">[1 more]</label></div><br/><div class="children"><div class="content">Tbh, this paper is a bit much, unless you have a lot of time on your hands for it, and also the necessary understanding of CPU architecture to really grok it.<p>I think there are better blog posts out there that explain the concepts. &quot;Cache locality&quot; &quot;memory cost of context switching&quot; are some terms to put in search engines. Maybe add &quot;thread local storage&quot; in there too.<p>The big takeaway from this paper though, at least when I first read it, and the concept has risen to prominence in the years since- backed up by benchmarks- that Big O isn&#x27;t really the end of the argument when it comes to performance.<p>The way CPUs work is that its extremely fast to rip through contiguous datasets. Jumping around to random memory addresses is way slower. A corollary to that is that jumping between threads is very slow for the same reasons- loading and unloading random chunks of memory. There are a lot of details around the specifics of why though- different cache levels and their latencies, and what happens when there is a cache miss, etc..<p>This lead HFT type programs to favor linear arrays to store things, and pinning threads to CPU cores, amongst other things, but that&#x27;s the gist of it.</div><br/></div></div><div id="36421938" class="c"><input type="checkbox" id="c-36421938" checked=""/><div class="controls bullet"><span class="by">burnished</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36420747">parent</a><span>|</span><a href="#36425286">prev</a><span>|</span><a href="#36423564">next</a><span>|</span><label class="collapse" for="c-36421938">[-]</label><label class="expand" for="c-36421938">[2 more]</label></div><br/><div class="children"><div class="content">Yes, because the advice is necessarily hardware dependent.</div><br/><div id="36422636" class="c"><input type="checkbox" id="c-36422636" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36421938">parent</a><span>|</span><a href="#36423564">next</a><span>|</span><label class="collapse" for="c-36422636">[-]</label><label class="expand" for="c-36422636">[1 more]</label></div><br/><div class="children"><div class="content">This is why I think this document was too detailed and should have omitted low-level details. The way you optimize your code hasn&#x27;t really changed since 2007, but the hardware churn since then triggers people to say &quot;well akshually the northbridge...&quot;</div><br/></div></div></div></div><div id="36423564" class="c"><input type="checkbox" id="c-36423564" checked=""/><div class="controls bullet"><span class="by">cbsmith</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36420747">parent</a><span>|</span><a href="#36421938">prev</a><span>|</span><a href="#36423576">next</a><span>|</span><label class="collapse" for="c-36423564">[-]</label><label class="expand" for="c-36423564">[1 more]</label></div><br/><div class="children"><div class="content">Yes and no. A lot of the concepts about memory management and how memory functions are still the same or similar. It&#x27;s a good baseline to start with, and then look at how things have changed since then (they certainly have changed, but most of the paper still applies).</div><br/></div></div><div id="36423576" class="c"><input type="checkbox" id="c-36423576" checked=""/><div class="controls bullet"><span class="by">AnimalMuppet</span><span>|</span><a href="#36420628">root</a><span>|</span><a href="#36420747">parent</a><span>|</span><a href="#36423564">prev</a><span>|</span><a href="#36422689">next</a><span>|</span><label class="collapse" for="c-36423576">[-]</label><label class="expand" for="c-36423576">[1 more]</label></div><br/><div class="children"><div class="content">Perhaps yes.  Multiples cores are now much more a thing than they were in 2007; that at least could be a change in emphasis.  OSes may do things differently in terms of how they implement memory mapping.  And so on.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>