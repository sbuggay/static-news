<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1725872472874" as="style"/><link rel="stylesheet" href="styles.css?v=1725872472874"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://pyatl.dev/2024/09/01/bitten-by-unicode/">Bitten by Unicode</a> <span class="domain">(<a href="https://pyatl.dev">pyatl.dev</a>)</span></div><div class="subtext"><span>pryelluw</span> | <span>53 comments</span></div><br/><div><div id="41485216" class="c"><input type="checkbox" id="c-41485216" checked=""/><div class="controls bullet"><span class="by">ks2048</span><span>|</span><a href="#41485669">next</a><span>|</span><label class="collapse" for="c-41485216">[-]</label><label class="expand" for="c-41485216">[17 more]</label></div><br/><div class="children"><div class="content">That&#x27;s only the tip of the iceberg of hyphen-looking characters.<p>Here&#x27;s some more,<p><pre><code>  2010 ; 002D ; MA #* ( ‐ → - ) HYPHEN → HYPHEN-MINUS # 
  2011 ; 002D ; MA #* ( ‑ → - ) NON-BREAKING HYPHEN → HYPHEN-MINUS # 
  2012 ; 002D ; MA #* ( ‒ → - ) FIGURE DASH → HYPHEN-MINUS # 
  2013 ; 002D ; MA #* ( – → - ) EN DASH → HYPHEN-MINUS # 
  FE58 ; 002D ; MA #* ( ﹘ → - ) SMALL EM DASH → HYPHEN-MINUS # 
  06D4 ; 002D ; MA #* ( ‎۔‎ → - ) ARABIC FULL STOP → HYPHEN-MINUS # →‐→
  2043 ; 002D ; MA #* ( ⁃ → - ) HYPHEN BULLET → HYPHEN-MINUS # →‐→
  02D7 ; 002D ; MA #* ( ˗ → - ) MODIFIER LETTER MINUS SIGN → HYPHEN-MINUS # 
  2212 ; 002D ; MA #* ( − → - ) MINUS SIGN → HYPHEN-MINUS # 
  2796 ; 002D ; MA #* (  → - ) HEAVY MINUS SIGN → HYPHEN-MINUS # →−→
  2CBA ; 002D ; MA # ( Ⲻ → - ) COPTIC CAPITAL LETTER DIALECT-P NI → HYPHEN-MINUS # →‒→
</code></pre>
copied from <a href="https:&#x2F;&#x2F;www.unicode.org&#x2F;Public&#x2F;security&#x2F;8.0.0&#x2F;confusables.txt" rel="nofollow">https:&#x2F;&#x2F;www.unicode.org&#x2F;Public&#x2F;security&#x2F;8.0.0&#x2F;confusables.tx...</a></div><br/><div id="41486455" class="c"><input type="checkbox" id="c-41486455" checked=""/><div class="controls bullet"><span class="by">renhanxue</span><span>|</span><a href="#41485216">parent</a><span>|</span><a href="#41485257">next</a><span>|</span><label class="collapse" for="c-41486455">[-]</label><label class="expand" for="c-41486455">[1 more]</label></div><br/><div class="children"><div class="content">Three Minus Signs for the Mathematicians under the pi,<p><pre><code>  2212 MINUS SIGN
  2796 HEAVY MINUS SIGN
  02D7 MODIFIER LETTER MINUS SIGN
</code></pre>
Seven Dashes for the Dash-lords in their quotes as shown,<p><pre><code>  2012 FIGURE DASH
  2013 EN DASH
  2014 EM DASH
  2015 QUOTATION DASH
  2E3A TWO-EM DASH
  2E3B THREE-EM DASH
  FE58 SMALL EM DASH
</code></pre>
Nine Hyphens for Word Breakers, one of them &amp;shy;,<p><pre><code>  00AD SOFT HYPHEN
  058A ARMENIAN HYPHEN
  1400 CANADIAN SYLLABICS HYPHEN
  1806 MONGOLIAN TODO SOFT HYPHEN
  2010 HYPHEN
  2011 NON-BREAKING HYPHEN
  2E17 DOUBLE OBLIQUE HYPHEN
  2E40 DOUBLE HYPHEN
  30A0 KATAKANA-HIRAGANA DOUBLE HYPHEN
</code></pre>
One for the Dark Word in the QWERTY zone<p>In the land of ASCII where Basic Latin lie.<p>One String to rule them all, One String to find them,<p>One String to bring them all and in the plain-text, bind them<p>In the land of ASCII where Basic Latin lie.<p><pre><code>  002D HYPHEN-MINUS
</code></pre>
- @FakeUnicode on Twitter, with apologies to J. R. R. Tolkien</div><br/></div></div><div id="41485257" class="c"><input type="checkbox" id="c-41485257" checked=""/><div class="controls bullet"><span class="by">markus_zhang</span><span>|</span><a href="#41485216">parent</a><span>|</span><a href="#41486455">prev</a><span>|</span><a href="#41485259">next</a><span>|</span><label class="collapse" for="c-41485257">[-]</label><label class="expand" for="c-41485257">[13 more]</label></div><br/><div class="children"><div class="content">I think it&#x27;s a good idea to write a plugin for any IDE to highlight those confusing characters.</div><br/><div id="41485409" class="c"><input type="checkbox" id="c-41485409" checked=""/><div class="controls bullet"><span class="by">MrJohz</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485257">parent</a><span>|</span><a href="#41485350">next</a><span>|</span><label class="collapse" for="c-41485409">[-]</label><label class="expand" for="c-41485409">[1 more]</label></div><br/><div class="children"><div class="content">I know vscode had this feature built in, and it&#x27;s come in handy a couple of times for me.</div><br/></div></div><div id="41485350" class="c"><input type="checkbox" id="c-41485350" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485257">parent</a><span>|</span><a href="#41485409">prev</a><span>|</span><a href="#41485307">next</a><span>|</span><label class="collapse" for="c-41485350">[-]</label><label class="expand" for="c-41485350">[10 more]</label></div><br/><div class="children"><div class="content">Using an ASCII-only font automatically shows all characters that IMHO should not be present in source code.</div><br/><div id="41486453" class="c"><input type="checkbox" id="c-41486453" checked=""/><div class="controls bullet"><span class="by">makeitdouble</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485350">parent</a><span>|</span><a href="#41486418">next</a><span>|</span><label class="collapse" for="c-41486453">[-]</label><label class="expand" for="c-41486453">[1 more]</label></div><br/><div class="children"><div class="content">A note on non-ascii in code: I thought of it as an abomination, until hitting test pattern descriptors.<p>On a project targeted at a non English speaking devs with a strong domain knowledge requirement, writing the test patterns (endless arrays of input -&gt; expected output sequences, interspersed with adjustment code) in the native language saves an incredible amount of time and effort, in particular as we don&#x27;t need to translate obscure notions into even more obscure English.<p>And that had very little downsides as it&#x27;s not production running code, lining will still raise anything problematic, and and the whole thing is easier to get reviewed by non domain experts.<p>We could have made a translation layer to have the content in a spreadsheet and convert it to test code, but that&#x27;s not any more stable than having unicode names straight into the code.</div><br/></div></div><div id="41486418" class="c"><input type="checkbox" id="c-41486418" checked=""/><div class="controls bullet"><span class="by">keybored</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485350">parent</a><span>|</span><a href="#41486453">prev</a><span>|</span><a href="#41485749">next</a><span>|</span><label class="collapse" for="c-41486418">[-]</label><label class="expand" for="c-41486418">[1 more]</label></div><br/><div class="children"><div class="content">For every such Unicode problem (which is a data input problem, not a programming source code error) there are fifty problems caused by the anemic ASCII character set like Unix toothpicks and three layers of escaping due to using too uniform delimiters.<p>(Granted this is heavily biased since so much source code is ASCII-only so you don’t get many Unicode problems in the first place...)</div><br/></div></div><div id="41485749" class="c"><input type="checkbox" id="c-41485749" checked=""/><div class="controls bullet"><span class="by">powersnail</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485350">parent</a><span>|</span><a href="#41486418">prev</a><span>|</span><a href="#41485426">next</a><span>|</span><label class="collapse" for="c-41485749">[-]</label><label class="expand" for="c-41485749">[2 more]</label></div><br/><div class="children"><div class="content">That would make it impossible to edit non-ascii strings, like texts in foreign languages. As far as I know, most editors&#x2F;IDE don&#x27;t support switching fonts for string literals. It is more feasible for a syntax highlighter to highlight non-ascii characters outside of literals.</div><br/><div id="41486597" class="c"><input type="checkbox" id="c-41486597" checked=""/><div class="controls bullet"><span class="by">Someone</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485749">parent</a><span>|</span><a href="#41485426">next</a><span>|</span><label class="collapse" for="c-41486597">[-]</label><label class="expand" for="c-41486597">[1 more]</label></div><br/><div class="children"><div class="content">&gt; As far as I know, most editors&#x2F;IDE don&#x27;t support switching fonts for string literals<p>When asked to render an Unicode character that isn’t present in the font modern OSes will automatically pick a font that has it.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Fallback_font" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Fallback_font</a>: <i>“A fallback font is a reserve typeface containing symbols for as many Unicode characters as possible. When a display system encounters a character that is not part of the repertoire of any of the other available fonts, a symbol from a fallback font is used instead. Typically, a fallback font will contain symbols representative of the various types of Unicode characters.”</i><p>That can be avoided, for example by storing text as “one character per byte”, but I don’t think many editors do that nowadays.</div><br/></div></div></div></div><div id="41485426" class="c"><input type="checkbox" id="c-41485426" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485350">parent</a><span>|</span><a href="#41485749">prev</a><span>|</span><a href="#41485363">next</a><span>|</span><label class="collapse" for="c-41485426">[-]</label><label class="expand" for="c-41485426">[1 more]</label></div><br/><div class="children"><div class="content">String literals frequently have non-ASCII characters to say the least.</div><br/></div></div><div id="41485363" class="c"><input type="checkbox" id="c-41485363" checked=""/><div class="controls bullet"><span class="by">metadat</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485350">parent</a><span>|</span><a href="#41485426">prev</a><span>|</span><a href="#41485307">next</a><span>|</span><label class="collapse" for="c-41485363">[-]</label><label class="expand" for="c-41485363">[4 more]</label></div><br/><div class="children"><div class="content">Some platforms, such at python3 have full UTF-8 support already, so what is the problem?</div><br/><div id="41485378" class="c"><input type="checkbox" id="c-41485378" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485363">parent</a><span>|</span><a href="#41485307">next</a><span>|</span><label class="collapse" for="c-41485378">[-]</label><label class="expand" for="c-41485378">[3 more]</label></div><br/><div class="children"><div class="content">The one shown very clearly by this article.</div><br/><div id="41486541" class="c"><input type="checkbox" id="c-41486541" checked=""/><div class="controls bullet"><span class="by">keybored</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485378">parent</a><span>|</span><a href="#41485401">next</a><span>|</span><label class="collapse" for="c-41486541">[-]</label><label class="expand" for="c-41486541">[1 more]</label></div><br/><div class="children"><div class="content">The wrong values are from PDF files. Maybe you mean using a system-wide ASCII-only font but you finished your point with “should not be present in source code”. Source code wasn’t the problem here.</div><br/></div></div><div id="41485401" class="c"><input type="checkbox" id="c-41485401" checked=""/><div class="controls bullet"><span class="by">metadat</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485378">parent</a><span>|</span><a href="#41486541">prev</a><span>|</span><a href="#41485307">next</a><span>|</span><label class="collapse" for="c-41485401">[-]</label><label class="expand" for="c-41485401">[1 more]</label></div><br/><div class="children"><div class="content">Thanks usrbinator.. <i>guilty grimace smile</i><p>Maybe highlighting isn&#x27;t such bad idea :)</div><br/></div></div></div></div></div></div></div></div><div id="41485307" class="c"><input type="checkbox" id="c-41485307" checked=""/><div class="controls bullet"><span class="by">samatman</span><span>|</span><a href="#41485216">root</a><span>|</span><a href="#41485257">parent</a><span>|</span><a href="#41485350">prev</a><span>|</span><a href="#41485259">next</a><span>|</span><label class="collapse" for="c-41485307">[-]</label><label class="expand" for="c-41485307">[1 more]</label></div><br/><div class="children"><div class="content">VSCode does this out of the box actually. Ended up putting a few on a whitelist while writing Julia, where it can get kind of ugly (puts a yellow box around them).</div><br/></div></div></div></div><div id="41485259" class="c"><input type="checkbox" id="c-41485259" checked=""/><div class="controls bullet"><span class="by">mjevans</span><span>|</span><a href="#41485216">parent</a><span>|</span><a href="#41485257">prev</a><span>|</span><a href="#41485427">next</a><span>|</span><label class="collapse" for="c-41485259">[-]</label><label class="expand" for="c-41485259">[1 more]</label></div><br/><div class="children"><div class="content">Also remember to squash &#x27;wide&#x27; characters back to the ASCII table where possible, if the data is being processed by normal tools.<p>There are honestly so many data-cleaning steps a pipeline could need &#x2F; have to produce programatically well-formatted data.</div><br/></div></div><div id="41485427" class="c"><input type="checkbox" id="c-41485427" checked=""/><div class="controls bullet"><span class="by">toastal</span><span>|</span><a href="#41485216">parent</a><span>|</span><a href="#41485259">prev</a><span>|</span><a href="#41485669">next</a><span>|</span><label class="collapse" for="c-41485427">[-]</label><label class="expand" for="c-41485427">[1 more]</label></div><br/><div class="children"><div class="content">And yet all of these serve a different, useful purpose for semantics.</div><br/></div></div></div></div><div id="41485669" class="c"><input type="checkbox" id="c-41485669" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#41485216">prev</a><span>|</span><a href="#41485382">next</a><span>|</span><label class="collapse" for="c-41485669">[-]</label><label class="expand" for="c-41485669">[1 more]</label></div><br/><div class="children"><div class="content">This highlights a way I constantly see people misuse regex: they aren’t specific enough. You weren’t bitten by Unicode, you were bitten by lazy and unprincipled parsing. Explicitly and strictly parse <i>every</i> character.<p>For here, assuming you already have <i>only</i> have the numeric value as a token, the regex should look like<p><pre><code>    &#x2F; ^ -? [0-9]+ ( \. [0-9]+ )? $ &#x2F;x
</code></pre>
or something similar. Match the beginning and end of the string and everything inbetween: an optional hyphen, any number of digits, and an optional decimal conponent. Feel free to adjust the details to match your spec, but <i>any</i> unexpected character will fail to parse.</div><br/></div></div><div id="41485382" class="c"><input type="checkbox" id="c-41485382" checked=""/><div class="controls bullet"><span class="by">Toxygene</span><span>|</span><a href="#41485669">prev</a><span>|</span><a href="#41486635">next</a><span>|</span><label class="collapse" for="c-41485382">[-]</label><label class="expand" for="c-41485382">[1 more]</label></div><br/><div class="children"><div class="content">Another option would be to detect and&#x2F;or normalize Unicode input using the recommendations from the Unicode consortium.<p><a href="https:&#x2F;&#x2F;www.unicode.org&#x2F;reports&#x2F;tr39&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.unicode.org&#x2F;reports&#x2F;tr39&#x2F;</a><p>Here&#x27;s the relevant bit from the doc:<p>&gt; For an input string X, define skeleton(X) to be the following transformation on the string:<p><pre><code>    Convert X to NFD format, as described in [UAX15].
    Remove any characters in X that have the property Default_Ignorable_Code_Point.
    Concatenate the prototypes for each character in X according to the specified data, producing a string of exemplar characters.
    Reapply NFD.
</code></pre>
The strings X and Y are defined to be confusable if and only if skeleton(X) = skeleton(Y). This is abbreviated as X ≅ Y.<p>This is obviously talking about comparing two string to see if they are &quot;confusable&quot; but if you just run the skeleton function on a string, you get a &quot;normalize&quot; version of it.</div><br/></div></div><div id="41486635" class="c"><input type="checkbox" id="c-41486635" checked=""/><div class="controls bullet"><span class="by">bluecalm</span><span>|</span><a href="#41485382">prev</a><span>|</span><a href="#41485328">next</a><span>|</span><label class="collapse" for="c-41486635">[-]</label><label class="expand" for="c-41486635">[1 more]</label></div><br/><div class="children"><div class="content">Reading my code from some years ago I can see I was very frustrated by a similar problem when parsing .csv files from some financial institutions:<p><pre><code>    # converts idiotic number format containing random junk into normal
    # represantion of a number
    def junkno_to_normal(s):
    (...)
</code></pre>
There are so many random characters you can insert into dates or numbers. Not only hyphens but also all kind of white spaces or invisible characters. It&#x27;s always a warm feeling when you import a text document and not only it&#x27;s encoded in UTF-8 but you see YYYY-MM-DD date format. You know it&#x27;s going to be safe from there. Unfortunately it&#x27;s still very rare in my experience (even UTF-8 bit).</div><br/></div></div><div id="41485328" class="c"><input type="checkbox" id="c-41485328" checked=""/><div class="controls bullet"><span class="by">rdtsc</span><span>|</span><a href="#41486635">prev</a><span>|</span><a href="#41485346">next</a><span>|</span><label class="collapse" for="c-41485328">[-]</label><label class="expand" for="c-41485328">[1 more]</label></div><br/><div class="children"><div class="content">A bit off-topic but a thing that jumps out is using floats for currency. Good for examples and small demos but beware using it for anything serious.</div><br/></div></div><div id="41485346" class="c"><input type="checkbox" id="c-41485346" checked=""/><div class="controls bullet"><span class="by">mwkaufma</span><span>|</span><a href="#41485328">prev</a><span>|</span><a href="#41485404">next</a><span>|</span><label class="collapse" for="c-41485346">[-]</label><label class="expand" for="c-41485346">[1 more]</label></div><br/><div class="children"><div class="content">&quot;For dollar figures I find a prefixed dollar symbol and convert the number following it into a float.&quot;<p>Bloombug red flag!!</div><br/></div></div><div id="41485404" class="c"><input type="checkbox" id="c-41485404" checked=""/><div class="controls bullet"><span class="by">wodenokoto</span><span>|</span><a href="#41485346">prev</a><span>|</span><a href="#41485242">next</a><span>|</span><label class="collapse" for="c-41485404">[-]</label><label class="expand" for="c-41485404">[3 more]</label></div><br/><div class="children"><div class="content">If your source is not consistent enough to give you consistent hyphen there are probably a lot of other weird things that are slipping through the cracks.</div><br/><div id="41485420" class="c"><input type="checkbox" id="c-41485420" checked=""/><div class="controls bullet"><span class="by">tomcam</span><span>|</span><a href="#41485404">parent</a><span>|</span><a href="#41485516">next</a><span>|</span><label class="collapse" for="c-41485420">[-]</label><label class="expand" for="c-41485420">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s pretty much all real-world datasets</div><br/></div></div><div id="41485516" class="c"><input type="checkbox" id="c-41485516" checked=""/><div class="controls bullet"><span class="by">advisedwang</span><span>|</span><a href="#41485404">parent</a><span>|</span><a href="#41485420">prev</a><span>|</span><a href="#41485242">next</a><span>|</span><label class="collapse" for="c-41485516">[-]</label><label class="expand" for="c-41485516">[1 more]</label></div><br/><div class="children"><div class="content">Probably true, but unless you are suggesting the author should abandon the product&#x2F;feature, the author needs to achieve the best they can given the constraints. Stuff like fixing hypens gets closer. There&#x27;s probably a lot more such things their code will end up doing.</div><br/></div></div></div></div><div id="41485242" class="c"><input type="checkbox" id="c-41485242" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#41485404">prev</a><span>|</span><a href="#41485282">next</a><span>|</span><label class="collapse" for="c-41485242">[-]</label><label class="expand" for="c-41485242">[5 more]</label></div><br/><div class="children"><div class="content">Does anyone here know of any actual Unicode-encoded documents that consistently use U+2010 HYPHEN  for their hyphens? Among those documents that do distinguish between dash-like characters, the most common usage I&#x27;ve seen is to use U+002D HYPHEN-MINUS for hyphens and U+2212 MINUS SIGN for minus signs, alongside the rest of U+2013 EN-DASH, U+2014 EM-DASH, etc. U+2010 seems conspicuously absent from everything, even when the &#x27;proper&#x27; character usage is otherwise adhered to.</div><br/><div id="41485305" class="c"><input type="checkbox" id="c-41485305" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41485242">parent</a><span>|</span><a href="#41485253">next</a><span>|</span><label class="collapse" for="c-41485305">[-]</label><label class="expand" for="c-41485305">[1 more]</label></div><br/><div class="children"><div class="content">I too haven&#x27;t seen any natural use of U+2010. But some Unicode characters are equally underused, often because they are historical or designed for specialized or internal uses. Here U+2010 can be thought as a normalized form for U+002D after some processing to filter non-hyphens, which justifies its inclusion even when the character itself might not be used much.</div><br/></div></div><div id="41485253" class="c"><input type="checkbox" id="c-41485253" checked=""/><div class="controls bullet"><span class="by">mjevans</span><span>|</span><a href="#41485242">parent</a><span>|</span><a href="#41485305">prev</a><span>|</span><a href="#41485282">next</a><span>|</span><label class="collapse" for="c-41485253">[-]</label><label class="expand" for="c-41485253">[3 more]</label></div><br/><div class="children"><div class="content">If you ever find any, it might be time to ask if a true General AI has been developed.  I really doubt most humans bother, and LLMs will copy our mistakes.</div><br/><div id="41485269" class="c"><input type="checkbox" id="c-41485269" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#41485242">root</a><span>|</span><a href="#41485253">parent</a><span>|</span><a href="#41485282">next</a><span>|</span><label class="collapse" for="c-41485269">[-]</label><label class="expand" for="c-41485269">[2 more]</label></div><br/><div class="children"><div class="content">My point is, there <i>are</i> penty of documents which bother with minus signs, en-dashes, and em-dashes, including Wikipedia, the Unicode Standard itself, and well-edited online news articles. Yet they still don&#x27;t bother with U+2010 in particular, which makes me question the character&#x27;s usefulness.</div><br/><div id="41486048" class="c"><input type="checkbox" id="c-41486048" checked=""/><div class="controls bullet"><span class="by">adrian_b</span><span>|</span><a href="#41485242">root</a><span>|</span><a href="#41485269">parent</a><span>|</span><a href="#41485282">next</a><span>|</span><label class="collapse" for="c-41486048">[-]</label><label class="expand" for="c-41486048">[1 more]</label></div><br/><div class="children"><div class="content">U+2010 has the advantage that it is not ambiguous and its appearance is predictable. You can never know whether a given typeface will display U+002D as a hyphen or as a minus or en-dash.<p>The reason why it is seldom used is that all keyboards by default provide only a way to easily type U+002D and the other ASCII characters. The input methods may provide some combination of keys that allows you to enter a minus or an en-dash, but nobody bothers to add an additional key combination for U+2010. The U+002D key could be reconfigured to output U+2010, but this would annoy the programmers who use programming languages where U+002D is used for minus.<p>So there is no way out of this mess. In programming languages or spreadsheets U+002D is used for minus, while in documents intended for reading, U+002D is used for hyphen, and the appropriate Unicode characters are used for minus and en-dash.<p>An exception among programming languages was COBOL. Originally it used only a hyphen character, which was used to improve the readability of long identifiers. This was possible because the arithmetic operations were written with words, i.e. SUBTRACT, so there was no need for a minus character.<p>A few years later (1964-12), when the PL&#x2F;I language was developed to replace both FORTRAN and COBOL, they have introduced the underscore character, replacing the hyphen in long identifiers, where it was used to improve their readability like in COBOL, so that the hyphen&#x2F;minus character could be used with the meaning of minus, like in FORTRAN. This convention has been inherited by most later programming languages, except by most dialects of LISP, which typically use a hyphen character in identifiers and they do not use a minus character, except for the sign of numbers.</div><br/></div></div></div></div></div></div></div></div><div id="41485282" class="c"><input type="checkbox" id="c-41485282" checked=""/><div class="controls bullet"><span class="by">chithanh</span><span>|</span><a href="#41485242">prev</a><span>|</span><a href="#41485772">next</a><span>|</span><label class="collapse" for="c-41485282">[-]</label><label class="expand" for="c-41485282">[1 more]</label></div><br/><div class="children"><div class="content">Seems not a good idea to roll your own. What if your software encounters U+2212 &quot;MINUS SIGN&quot; next?<p>Probably best to just transliterate to ASCII using gettext or unidecode or similar.</div><br/></div></div><div id="41485772" class="c"><input type="checkbox" id="c-41485772" checked=""/><div class="controls bullet"><span class="by">SomewhatLikely</span><span>|</span><a href="#41485282">prev</a><span>|</span><a href="#41486195">next</a><span>|</span><label class="collapse" for="c-41485772">[-]</label><label class="expand" for="c-41485772">[1 more]</label></div><br/><div class="children"><div class="content">Where I thought this might be going from the first paragraph:<p>Negative numbers are sometimes represented with parentheses: (234.58)<p>Tables sometimes tell you in the description that all numbers in are in 1000&#x27;s or millions.<p>The dollar sign is used by many currencies, including in Australia and Canada.<p>I&#x27;d probably look around for some other gotchas.  Here&#x27;s one page on prices in general: <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;rgs&#x2F;6509585" rel="nofollow">https:&#x2F;&#x2F;gist.github.com&#x2F;rgs&#x2F;6509585</a> but interestingly doesn&#x27;t quite cover the OP&#x27;s problem or the ones I brought up, though the use cases are slightly different.</div><br/></div></div><div id="41486195" class="c"><input type="checkbox" id="c-41486195" checked=""/><div class="controls bullet"><span class="by">eviks</span><span>|</span><a href="#41485772">prev</a><span>|</span><a href="#41485343">next</a><span>|</span><label class="collapse" for="c-41486195">[-]</label><label class="expand" for="c-41486195">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Inspecting the hyphen.
&gt; I pulled in the standard library module unicodedata and starting checking things.<p>Or you could extend your editor to show Unicode character name in the status bar and do the inspection in a more immediate way</div><br/><div id="41486421" class="c"><input type="checkbox" id="c-41486421" checked=""/><div class="controls bullet"><span class="by">wonger_</span><span>|</span><a href="#41486195">parent</a><span>|</span><a href="#41485343">next</a><span>|</span><label class="collapse" for="c-41486421">[-]</label><label class="expand" for="c-41486421">[1 more]</label></div><br/><div class="children"><div class="content">Or in vim, `ga` when hovered over a character</div><br/></div></div></div></div><div id="41485343" class="c"><input type="checkbox" id="c-41485343" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41486195">prev</a><span>|</span><a href="#41485544">next</a><span>|</span><label class="collapse" for="c-41485343">[-]</label><label class="expand" for="c-41485343">[1 more]</label></div><br/><div class="children"><div class="content">In my current font, that hyphen looks very slightly different from the normal ASCII one - it&#x27;s just a pixel shorter and located a pixel lower. If I force the charset to CP1252 then I get â€ which is very obviously not a hyphen.</div><br/></div></div><div id="41485544" class="c"><input type="checkbox" id="c-41485544" checked=""/><div class="controls bullet"><span class="by">riffraff</span><span>|</span><a href="#41485343">prev</a><span>|</span><a href="#41485495">next</a><span>|</span><label class="collapse" for="c-41485544">[-]</label><label class="expand" for="c-41485544">[1 more]</label></div><br/><div class="children"><div class="content">FWIW, python regex support checking for Unicode properties via the \p{SOME NAME} syntax, but as people said there&#x27;s a lot more weird edge cases.
Btw looks like the code may also have a couple lurking bugs (parsing floats vs decimals, implicit locale number formatting ).<p>I feel all &quot;import data from multiple sources&quot; I&#x27;ve seen in my life grew through repeated application of edge case handling.</div><br/></div></div><div id="41485495" class="c"><input type="checkbox" id="c-41485495" checked=""/><div class="controls bullet"><span class="by">kccqzy</span><span>|</span><a href="#41485544">prev</a><span>|</span><a href="#41485319">next</a><span>|</span><label class="collapse" for="c-41485495">[-]</label><label class="expand" for="c-41485495">[1 more]</label></div><br/><div class="children"><div class="content">Run this:<p><pre><code>    &gt;&gt;&gt; unicodedata.category(&#x27;\N{MINUS SIGN}&#x27;)
    &#x27;Sm&#x27;
</code></pre>
There you go. No need to thank me for breaking your code.<p>Also, nobody has yet commented on the fact that the author is also doing PDF text extraction. That&#x27;s yet another area where a lot of fuzziness needs to be applied. My confidence in the author&#x27;s product greatly decreased after reading this post.</div><br/></div></div><div id="41485319" class="c"><input type="checkbox" id="c-41485319" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41485495">prev</a><span>|</span><a href="#41485620">next</a><span>|</span><label class="collapse" for="c-41485319">[-]</label><label class="expand" for="c-41485319">[3 more]</label></div><br/><div class="children"><div class="content">To be clear, you weren&#x27;t bitten by Unicode but bitten by bad Unicode usages. Which are prevalent enough that any text processing pipeline has to be fuzzy enough to recognize them. I have seen, for example, many uses of archaic Hangul jamo ㆍ (U+318D) in place of middle dots (U+00B7) or bullets (U+2022), while middle dots and bullets themselves are often confused to each other.</div><br/><div id="41485518" class="c"><input type="checkbox" id="c-41485518" checked=""/><div class="controls bullet"><span class="by">riffraff</span><span>|</span><a href="#41485319">parent</a><span>|</span><a href="#41485620">next</a><span>|</span><label class="collapse" for="c-41485518">[-]</label><label class="expand" for="c-41485518">[2 more]</label></div><br/><div class="children"><div class="content">Why bad? This is the intended use for this character</div><br/><div id="41485682" class="c"><input type="checkbox" id="c-41485682" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41485319">root</a><span>|</span><a href="#41485518">parent</a><span>|</span><a href="#41485620">next</a><span>|</span><label class="collapse" for="c-41485682">[-]</label><label class="expand" for="c-41485682">[1 more]</label></div><br/><div class="children"><div class="content">Hyphen is a distinct (but of course very commonly confused) character from minus, which Unicode separately encodes U+2212. Though it is also possible that an OCR somehow produced a hyphen out of nowhere.</div><br/></div></div></div></div></div></div><div id="41485620" class="c"><input type="checkbox" id="c-41485620" checked=""/><div class="controls bullet"><span class="by">bobbylarrybobby</span><span>|</span><a href="#41485319">prev</a><span>|</span><a href="#41485415">next</a><span>|</span><label class="collapse" for="c-41485620">[-]</label><label class="expand" for="c-41485620">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;d be concerned about `value[0]` — how does that work in the face of multi byte characters? Is all string indexing in Python O(n)? Does it store whether a given string is ascii-only and switch to constant time lookup if it is?</div><br/><div id="41485634" class="c"><input type="checkbox" id="c-41485634" checked=""/><div class="controls bullet"><span class="by">Sniffnoy</span><span>|</span><a href="#41485620">parent</a><span>|</span><a href="#41485415">next</a><span>|</span><label class="collapse" for="c-41485634">[-]</label><label class="expand" for="c-41485634">[3 more]</label></div><br/><div class="children"><div class="content">Python 3 actually uses UTF-32, so it&#x27;s all constant-time. A tradeoff few make, certainly!</div><br/><div id="41485694" class="c"><input type="checkbox" id="c-41485694" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41485620">root</a><span>|</span><a href="#41485634">parent</a><span>|</span><a href="#41485415">next</a><span>|</span><label class="collapse" for="c-41485694">[-]</label><label class="expand" for="c-41485694">[2 more]</label></div><br/><div class="children"><div class="content">Or more accurately, behaves as if it is UTF-32. The actual implementation uses multiple internal representations, just like JS engines emulating UCS-2.</div><br/><div id="41485859" class="c"><input type="checkbox" id="c-41485859" checked=""/><div class="controls bullet"><span class="by">Sniffnoy</span><span>|</span><a href="#41485620">root</a><span>|</span><a href="#41485694">parent</a><span>|</span><a href="#41485415">next</a><span>|</span><label class="collapse" for="c-41485859">[-]</label><label class="expand" for="c-41485859">[1 more]</label></div><br/><div class="children"><div class="content">Huh!  I was unaware (of both of those), thanks.</div><br/></div></div></div></div></div></div></div></div><div id="41485415" class="c"><input type="checkbox" id="c-41485415" checked=""/><div class="controls bullet"><span class="by">ReleaseCandidat</span><span>|</span><a href="#41485620">prev</a><span>|</span><a href="#41485302">next</a><span>|</span><label class="collapse" for="c-41485415">[-]</label><label class="expand" for="c-41485415">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s why you don&#x27;t want to use regexes to parse something, but an actual tokenizer which uses Unicode _k_ompatibility normalisation (NFKC or NFKD) for comparisons. Although I&#x27;m not sure if that works with the Dollar emoji (which HN doesn&#x27;t like to display)</div><br/><div id="41485527" class="c"><input type="checkbox" id="c-41485527" checked=""/><div class="controls bullet"><span class="by">riffraff</span><span>|</span><a href="#41485415">parent</a><span>|</span><a href="#41485302">next</a><span>|</span><label class="collapse" for="c-41485527">[-]</label><label class="expand" for="c-41485527">[2 more]</label></div><br/><div class="children"><div class="content">Regexes can handle Unicode categories just fine, if he&#x27;d written a tokenizer it would still have failed. 
Which in fact it did when he removed the regex.</div><br/><div id="41486440" class="c"><input type="checkbox" id="c-41486440" checked=""/><div class="controls bullet"><span class="by">ReleaseCandidat</span><span>|</span><a href="#41485415">root</a><span>|</span><a href="#41485527">parent</a><span>|</span><a href="#41485302">next</a><span>|</span><label class="collapse" for="c-41486440">[-]</label><label class="expand" for="c-41486440">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not about categories they don&#x27;t help with such problems, but comparison using compatible normalisation (either NFKC or NFKD).
Using that, e.g. 1 compares equal to I and i (the roman number literals) the 1 in a circle and all the other Unicode code points which have the samé meaning.</div><br/></div></div></div></div></div></div><div id="41485302" class="c"><input type="checkbox" id="c-41485302" checked=""/><div class="controls bullet"><span class="by">samatman</span><span>|</span><a href="#41485415">prev</a><span>|</span><a href="#41485681">next</a><span>|</span><label class="collapse" for="c-41485302">[-]</label><label class="expand" for="c-41485302">[1 more]</label></div><br/><div class="children"><div class="content">Still broken, alas. &#x27;−&#x27;, named MINUS SIGN, U+2212, is an Sm: Symbol, math.  Arguably the one which <i>should</i> be used, meaning the risk of actually encountering it, while ε, is never 0.<p>As ks2048 points out, the only thing for it is to collect &#x27;em all.<p>Which is why (shameless plug) I wrote this: <a href="https:&#x2F;&#x2F;github.com&#x2F;mnemnion&#x2F;runeset">https:&#x2F;&#x2F;github.com&#x2F;mnemnion&#x2F;runeset</a></div><br/></div></div><div id="41485681" class="c"><input type="checkbox" id="c-41485681" checked=""/><div class="controls bullet"><span class="by">pino82</span><span>|</span><a href="#41485302">prev</a><span>|</span><a href="#41485645">next</a><span>|</span><label class="collapse" for="c-41485681">[-]</label><label class="expand" for="c-41485681">[2 more]</label></div><br/><div class="children"><div class="content">Bitten by MS Outlook... ^^</div><br/><div id="41485733" class="c"><input type="checkbox" id="c-41485733" checked=""/><div class="controls bullet"><span class="by">emmelaich</span><span>|</span><a href="#41485681">parent</a><span>|</span><a href="#41485645">next</a><span>|</span><label class="collapse" for="c-41485733">[-]</label><label class="expand" for="c-41485733">[1 more]</label></div><br/><div class="children"><div class="content">Indeed, very familiar to those who copy code from Outlook, Word, and some websites.<p>Even some manpages had (or still do) have hyphen instead of minus for the option character.  Argh!</div><br/></div></div></div></div><div id="41485645" class="c"><input type="checkbox" id="c-41485645" checked=""/><div class="controls bullet"><span class="by">wonnage</span><span>|</span><a href="#41485681">prev</a><span>|</span><a href="#41485349">next</a><span>|</span><label class="collapse" for="c-41485645">[-]</label><label class="expand" for="c-41485645">[1 more]</label></div><br/><div class="children"><div class="content">I feel like the responsible thing to do here is throw an error if you encounter an unexpected character. Others have already pointed out that there&#x27;s an actual minus sign character that would break this. This code is dealing with like four different tricky&#x2F;unpredictable things (parsing PDFs, parsing strings, unicode, money) and the lack of basic exception handling should raise alarm bells.</div><br/></div></div><div id="41485349" class="c"><input type="checkbox" id="c-41485349" checked=""/><div class="controls bullet"><span class="by">makach</span><span>|</span><a href="#41485645">prev</a><span>|</span><label class="collapse" for="c-41485349">[-]</label><label class="expand" for="c-41485349">[1 more]</label></div><br/><div class="children"><div class="content">*Bitten by regex</div><br/></div></div></div></div></div></div></div></body></html>