<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1710493274638" as="style"/><link rel="stylesheet" href="styles.css?v=1710493274638"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blogs.windows.com/windowsdeveloper/2024/03/06/sandboxing-python-with-win32-app-isolation/">Sandboxing Python with Win32 App Isolation</a>Â <span class="domain">(<a href="https://blogs.windows.com">blogs.windows.com</a>)</span></div><div class="subtext"><span>pjmlp</span> | <span>40 comments</span></div><br/><div><div id="39711179" class="c"><input type="checkbox" id="c-39711179" checked=""/><div class="controls bullet"><span class="by">ack_complete</span><span>|</span><a href="#39712890">next</a><span>|</span><label class="collapse" for="c-39711179">[-]</label><label class="expand" for="c-39711179">[12 more]</label></div><br/><div class="children"><div class="content">Am I reading it correctly that because App Isolation is based on MSIX and MSIX requires code signing, that an app cannot be sandboxed unless it is signed? That seems silly.</div><br/><div id="39712989" class="c"><input type="checkbox" id="c-39712989" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39711179">parent</a><span>|</span><a href="#39712976">next</a><span>|</span><label class="collapse" for="c-39712989">[-]</label><label class="expand" for="c-39712989">[5 more]</label></div><br/><div class="children"><div class="content">It&#x27;s mandatory on all sandboxing systems and for good reasons: sandboxing and identity are intimately related. To be usable the OS must cache permissions you grant the app but if your app isn&#x27;t signed then nothing stops another app impersonating you and using your cached permissions.<p>This is true for literally every user-facing sandboxing system even when it may seem that it&#x27;s not the case. For example, the web ties app identity to the domain name from where it was downloaded, but asserted domain name isn&#x27;t good enough so in practice browsers require SSL&#x2F;TLS for most permissions (which requires a certificate and is a form of pseudo-&quot;signing&quot;).<p>It&#x27;s even true on Linux. The designs on Linux aren&#x27;t as robust or decentralised as on macOS or Windows, but packages are signed there too by your distro provider. Although you can install packages from outside the distro and thus work around this system, by doing so you disable any protections against apps stealing cached resources (exception: I think Flatpak doesn&#x27;t have this problem but it uses a more store-like model where the store operators are expected to stop apps impersonating each other and if you install other &quot;stores&quot; then all bets are off again).<p>Now all that said. Conveyor (see my other post in this thread) can produce self-signed MSIXs, and those are fully fledged MSIX packages that will be able to take part in sandboxing when it&#x27;s finally released. Installing such packages requires admin elevation because the installer has to add your self-signed root certificate to the user&#x27;s trust store, and that&#x27;s equivalent to overriding the protections (you could then sign an app as if it came from anyone). But it can be useful in corporate environments where the certificate is pre-distributed via Active Directory.</div><br/><div id="39713468" class="c"><input type="checkbox" id="c-39713468" checked=""/><div class="controls bullet"><span class="by">ack_complete</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39712989">parent</a><span>|</span><a href="#39713014">next</a><span>|</span><label class="collapse" for="c-39713468">[-]</label><label class="expand" for="c-39713468">[1 more]</label></div><br/><div class="children"><div class="content">But with MSIX requiring installation, couldn&#x27;t the cached credentials be tied to the container? I would think that the OS would need to protect the container to some extent, and thus an application that could break into the container would effectively already have filesystem privileges equivalent to administrator access.<p>It&#x27;d be more tolerable if self-signed certificates were allowed without janky workarounds like adding them to the cert store. There are too many significant downsides to commercial code signing certificates for individuals, like cost, loss of anonymity, certificates getting revoked for bogus reasons like antivirus false positives, and the slow creep toward more things requiring EV (like maintaining reputation). The majority of the time, the only actual trust I have in an application and its developer is from past history, and for that all I need is assurance that a new version was signed by the same entity as the last version.</div><br/></div></div><div id="39713014" class="c"><input type="checkbox" id="c-39713014" checked=""/><div class="controls bullet"><span class="by">actionfromafar</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39712989">parent</a><span>|</span><a href="#39713468">prev</a><span>|</span><a href="#39712976">next</a><span>|</span><label class="collapse" for="c-39713014">[-]</label><label class="expand" for="c-39713014">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s still silly to not allow sandboxing of unsigned binaries. There could at least be a user sandbox where all non-signed apps can live. There could be an option for a temporary sandbox. And so on.<p>There could be many useful options which would still improve security incrementally.</div><br/><div id="39713076" class="c"><input type="checkbox" id="c-39713076" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39713014">parent</a><span>|</span><a href="#39712976">next</a><span>|</span><label class="collapse" for="c-39713076">[-]</label><label class="expand" for="c-39713076">[2 more]</label></div><br/><div class="children"><div class="content">Windows already has that, it&#x27;s a feature called Windows Sandbox:<p><a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;security&#x2F;application-security&#x2F;application-isolation&#x2F;windows-sandbox&#x2F;windows-sandbox-overview" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;security&#x2F;applicati...</a><p>But this blog post is about App Isolation which is more conventional kernel level sandboxing.</div><br/><div id="39713332" class="c"><input type="checkbox" id="c-39713332" checked=""/><div class="controls bullet"><span class="by">actionfromafar</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39713076">parent</a><span>|</span><a href="#39712976">next</a><span>|</span><label class="collapse" for="c-39713332">[-]</label><label class="expand" for="c-39713332">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!</div><br/></div></div></div></div></div></div></div></div><div id="39712976" class="c"><input type="checkbox" id="c-39712976" checked=""/><div class="controls bullet"><span class="by">creatonez</span><span>|</span><a href="#39711179">parent</a><span>|</span><a href="#39712989">prev</a><span>|</span><a href="#39712606">next</a><span>|</span><label class="collapse" for="c-39712976">[-]</label><label class="expand" for="c-39712976">[2 more]</label></div><br/><div class="children"><div class="content">An additional bit of context for why this is so annoying - Microsoft recently switched code signing to physical hardware only, meaning you must buy a server with a HSM, a USB security key, or use a more expensive CA. There&#x27;s no longer any free CAs for this.</div><br/><div id="39713086" class="c"><input type="checkbox" id="c-39713086" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39712976">parent</a><span>|</span><a href="#39712606">next</a><span>|</span><label class="collapse" for="c-39713086">[-]</label><label class="expand" for="c-39713086">[1 more]</label></div><br/><div class="children"><div class="content">You can use a cloud HSM and some CAs offer cloud signing. We described some info about setting that up with our tool in this blog post (it talks about Electron but the instructions work for any kind of app):<p><a href="https:&#x2F;&#x2F;www.hydraulic.dev&#x2F;blog&#x2F;21-shipping-electron-apps-from-ci-using-hsm-certificates.html" rel="nofollow">https:&#x2F;&#x2F;www.hydraulic.dev&#x2F;blog&#x2F;21-shipping-electron-apps-fro...</a></div><br/></div></div></div></div><div id="39712606" class="c"><input type="checkbox" id="c-39712606" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#39711179">parent</a><span>|</span><a href="#39712976">prev</a><span>|</span><a href="#39712623">next</a><span>|</span><label class="collapse" for="c-39712606">[-]</label><label class="expand" for="c-39712606">[1 more]</label></div><br/><div class="children"><div class="content">That is indeed the end goal, as revelead last year.<p>&quot;Modernize your Win32 application for security and privacy&quot; - BUILD 2023<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=w6VwHGPz12w" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=w6VwHGPz12w</a></div><br/></div></div><div id="39712623" class="c"><input type="checkbox" id="c-39712623" checked=""/><div class="controls bullet"><span class="by">charcircuit</span><span>|</span><a href="#39711179">parent</a><span>|</span><a href="#39712606">prev</a><span>|</span><a href="#39712890">next</a><span>|</span><label class="collapse" for="c-39712623">[-]</label><label class="expand" for="c-39712623">[3 more]</label></div><br/><div class="children"><div class="content">&gt;That seems silly.<p>That is already how it works on Android and iOS so I don&#x27;t think it is very silly.</div><br/><div id="39712882" class="c"><input type="checkbox" id="c-39712882" checked=""/><div class="controls bullet"><span class="by">jeroenhd</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39712623">parent</a><span>|</span><a href="#39712890">next</a><span>|</span><label class="collapse" for="c-39712882">[-]</label><label class="expand" for="c-39712882">[2 more]</label></div><br/><div class="children"><div class="content">Android allows self-signing, though. The biggest use case of Android&#x27;s signatures right now is to make sure only the packager can serve updates (and gain access to the data stored within the sandbox). You don&#x27;t even need to provision any developer specific signing certificates to install these apps.<p>In theory Android could start using certificate verification, of course, but right now that&#x27;s not being used.</div><br/><div id="39712938" class="c"><input type="checkbox" id="c-39712938" checked=""/><div class="controls bullet"><span class="by">charcircuit</span><span>|</span><a href="#39711179">root</a><span>|</span><a href="#39712882">parent</a><span>|</span><a href="#39712890">next</a><span>|</span><label class="collapse" for="c-39712938">[-]</label><label class="expand" for="c-39712938">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s true. I hope with proper sandboxing Microsoft will allow self signed certs for such apps. I can understand the risk when an application can access literally everything of the user&#x27;s, but the level of trust needed for sandboxed apps is less.</div><br/></div></div></div></div></div></div></div></div><div id="39712890" class="c"><input type="checkbox" id="c-39712890" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#39711179">prev</a><span>|</span><a href="#39687709">next</a><span>|</span><label class="collapse" for="c-39712890">[-]</label><label class="expand" for="c-39712890">[1 more]</label></div><br/><div class="children"><div class="content">SandBoxie is a thing, but I don&#x27;t know if it supports denying read access to existing files.  It&#x27;s more designed to stop writes.</div><br/></div></div><div id="39687709" class="c"><input type="checkbox" id="c-39687709" checked=""/><div class="controls bullet"><span class="by">mmis1000</span><span>|</span><a href="#39712890">prev</a><span>|</span><a href="#39711700">next</a><span>|</span><label class="collapse" for="c-39687709">[-]</label><label class="expand" for="c-39687709">[2 more]</label></div><br/><div class="children"><div class="content">So, is that basically app-armor for windows? You define which file&#x2F;netowrk&#x2F;process a program can access, while not result in a full container resolution like docker&#x2F;snap&#x2F;flat pack&#x2F;uwp.</div><br/><div id="39689741" class="c"><input type="checkbox" id="c-39689741" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#39687709">parent</a><span>|</span><a href="#39711700">next</a><span>|</span><label class="collapse" for="c-39689741">[-]</label><label class="expand" for="c-39689741">[1 more]</label></div><br/><div class="children"><div class="content">This is the evolution of UWP sandboxing into Win32, given that UWP went as we all know.</div><br/></div></div></div></div><div id="39711700" class="c"><input type="checkbox" id="c-39711700" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#39687709">prev</a><span>|</span><a href="#39689638">next</a><span>|</span><label class="collapse" for="c-39711700">[-]</label><label class="expand" for="c-39711700">[4 more]</label></div><br/><div class="children"><div class="content">Is there something more granular than &quot;File system access&quot; or not? I would like for apps to have their own temp&#x2F;cache and optionally access to common files. Having to do all or nothing significantly curtails the utility.</div><br/><div id="39713010" class="c"><input type="checkbox" id="c-39713010" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39711700">parent</a><span>|</span><a href="#39712611">next</a><span>|</span><label class="collapse" for="c-39713010">[-]</label><label class="expand" for="c-39713010">[2 more]</label></div><br/><div class="children"><div class="content">MSIX already provides that. All apps run in a very lightweight &quot;sandbox&quot; that virtualizes file access to the user&#x27;s AppData directory. Writes inside it are redirected to a package-private location that&#x27;s blown away on uninstall. Same for registry writes. It means the OS can cleanly and immediately uninstall such packages.<p>Temp is also virtualized in the same way, although Conveyor devirtualizes it in some cases due to a Windows kernel bug.<p>This is just intended for keeping the system clean. Your app can devirtualize locations in AppData by requesting it in package metadata, if you need to modify files belonging other apps for example, see:<p><a href="https:&#x2F;&#x2F;conveyor.hydraulic.dev&#x2F;13.1&#x2F;configs&#x2F;windows&#x2F;#virtualization" rel="nofollow">https:&#x2F;&#x2F;conveyor.hydraulic.dev&#x2F;13.1&#x2F;configs&#x2F;windows&#x2F;#virtual...</a></div><br/><div id="39713019" class="c"><input type="checkbox" id="c-39713019" checked=""/><div class="controls bullet"><span class="by">actionfromafar</span><span>|</span><a href="#39711700">root</a><span>|</span><a href="#39713010">parent</a><span>|</span><a href="#39712611">next</a><span>|</span><label class="collapse" for="c-39713019">[-]</label><label class="expand" for="c-39713019">[1 more]</label></div><br/><div class="children"><div class="content">Huh, interesting, I will have to reconsider MSIX then. It sounds very neat.</div><br/></div></div></div></div><div id="39712611" class="c"><input type="checkbox" id="c-39712611" checked=""/><div class="controls bullet"><span class="by">charcircuit</span><span>|</span><a href="#39711700">parent</a><span>|</span><a href="#39713010">prev</a><span>|</span><a href="#39689638">next</a><span>|</span><label class="collapse" for="c-39712611">[-]</label><label class="expand" for="c-39712611">[1 more]</label></div><br/><div class="children"><div class="content">It already is granular. The &quot;File system access&quot; setting is unrelated to what this article is talking about. That setting is for the broadFileSystemAccess capability for UWP apps.</div><br/></div></div></div></div><div id="39689638" class="c"><input type="checkbox" id="c-39689638" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39711700">prev</a><span>|</span><a href="#39710185">next</a><span>|</span><label class="collapse" for="c-39689638">[-]</label><label class="expand" for="c-39689638">[5 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a really cool feature, but be aware that MSIX can be tricky to use in its raw form. My company makes a tool [1] that can produce both signed and self-signed MSIX packages from any OS including Linux or macOS using a much friendlier toolchain than what MS provides. It also produces a small installer EXE that works around the unfortunately large number of bugs in Windows to produce a reliable and easier to use experience.<p>We&#x27;re waiting for this feature to emerge from the insiders builds before adding support for sandboxing, but should do so once it&#x27;s ready.<p>Released Conveyor currently only supports native, Electron, Flutter and JVM apps. But, we have some unfinished support for shipping Python apps as well. In the tutorial MS sort of hand-wave how to do this, basically saying to repackage the entire Python interpreter and details like pipenvs and native code are left as an exercise for the reader. Real apps do need to think about this of course.<p>If anyone has a need for shipping sandboxed [Python] apps on Windows please do get in touch. It&#x27;d be good to understand how much demand is out there before investing in finishing off these features.<p>An alternative approach that can also work well is to use software-level sandboxing, either in replacement or in combination with OS level sandboxing. For example GraalPy is a Python interpreter and JIT engine that not only runs Python faster than CPython but which also supports sandboxing with a high level API and easy interop with other languages:<p><a href="https:&#x2F;&#x2F;www.graalvm.org&#x2F;python&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.graalvm.org&#x2F;python&#x2F;</a><p>For example if you want to expose capabilities to your code, this is a good way to do it that&#x27;s much easier than with kernel sandboxing (ditto for JavaScript). The cost is that Python compatibility isn&#x27;t yet 100%, and memory usage can be higher. But if it works for your app it can be a useful weapon in your armory.<p>Tying the above together, because GraalPy can be turned into a JVM app (including an ahead-of-time compiled JVM app) you can also ship customized sandboxing Python interpreters with Conveyor, including making a server that uses systemd to start up and sandbox, to really lock down the process tightly. So you can get both software and kernel sandboxing on Linux and macOS, for desktop apps and servers, and maybe in future Windows too. Pretty cool stuff.<p>Disclosure: I own the company that makes Conveyor, and also do part time research work with the Graal team. So I&#x27;m talking my own book here, but only because it&#x27;s a good book.<p>[1] <a href="https:&#x2F;&#x2F;conveyor.hydraulic.dev" rel="nofollow">https:&#x2F;&#x2F;conveyor.hydraulic.dev</a></div><br/><div id="39711294" class="c"><input type="checkbox" id="c-39711294" checked=""/><div class="controls bullet"><span class="by">throwaway2037</span><span>|</span><a href="#39689638">parent</a><span>|</span><a href="#39711666">next</a><span>|</span><label class="collapse" for="c-39711294">[-]</label><label class="expand" for="c-39711294">[2 more]</label></div><br/><div class="children"><div class="content">Thank you to write this detailed post.  It is very helpful.<p>Do I understand GraalVM correctly: It can run CPython native extensions (C code extensions compiled to run from CPython)?  It sounds like you need to recompile the extension for GraalVM, but it should work OK.</div><br/><div id="39713032" class="c"><input type="checkbox" id="c-39713032" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39689638">root</a><span>|</span><a href="#39711294">parent</a><span>|</span><a href="#39711666">next</a><span>|</span><label class="collapse" for="c-39713032">[-]</label><label class="expand" for="c-39713032">[1 more]</label></div><br/><div class="children"><div class="content">Yes it can with caveats.<p>A lot of packages that use native code work but not all. The Python ecosystem is pretty messy and doesn&#x27;t care much about alternative impls, so some packages do silly things like hard-code that the interpreter must be named &quot;CPython&quot;. Others make extremely deep assumptions about the CPython internals that GraalPy can&#x27;t meet. There&#x27;s no equivalent of a standardized interface like JNI in the Python world yet (there&#x27;s an effort called HPy but it&#x27;s new). GraalPy comes with a modified pip that knows how to patch popular packages that do bad things to work with it.<p>Still, GraalPy actually can use native extensions and in theory in future even sandbox them (or maybe even today, I forget the status). Most alternative implemenations were never able to do it at all!<p>Now if you want to sandbox Python code you must also be able to sandbox arbitrary C&#x2F;C++. Python is so slow that almost any real program will rely on extensions. The tech stack can do it and it&#x27;s been done for other languages, because Graal can actually JIT compile and sandbox LLVM bitcode as well. In that case you recompile with a special toolchain and the native code always thinks it&#x27;s running on Intel Linux. But that has some warmup time impacts and you have limited access to hardware&#x2F;the OS in that mode obviously, as with any sandboxing. For example PyTorch couldn&#x27;t be sandboxed in that way. Also I don&#x27;t know if GraalPy supports sandboxing yet, it might be taking a back seat to other priorities like more ecosystem compatibility.</div><br/></div></div></div></div><div id="39711666" class="c"><input type="checkbox" id="c-39711666" checked=""/><div class="controls bullet"><span class="by">marwis</span><span>|</span><a href="#39689638">parent</a><span>|</span><a href="#39711294">prev</a><span>|</span><a href="#39710185">next</a><span>|</span><label class="collapse" for="c-39711666">[-]</label><label class="expand" for="c-39711666">[2 more]</label></div><br/><div class="children"><div class="content">Is the GraalVM sandboxing only applicable to polyglot runtime or also to JVM itself?</div><br/><div id="39713043" class="c"><input type="checkbox" id="c-39713043" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39689638">root</a><span>|</span><a href="#39711666">parent</a><span>|</span><a href="#39710185">next</a><span>|</span><label class="collapse" for="c-39713043">[-]</label><label class="expand" for="c-39713043">[1 more]</label></div><br/><div class="children"><div class="content">Only the polyglot runtime. But, there&#x27;s a JVM implemented using polyglot&#x2F;truffle called Espresso. It doesn&#x27;t fully support sandboxing yet but it&#x27;s being worked on. Then you would be able to load Java code and execute it inside a  sandbox without the SecurityManager. Ask on their slack if you want to learn more about it.</div><br/></div></div></div></div></div></div><div id="39710185" class="c"><input type="checkbox" id="c-39710185" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#39689638">prev</a><span>|</span><a href="#39687256">next</a><span>|</span><label class="collapse" for="c-39710185">[-]</label><label class="expand" for="c-39710185">[12 more]</label></div><br/><div class="children"><div class="content">this talks about locking down network and filesystem access, but does Win32 App Isolation also offer a way to restrict CPU and memory usage?<p>I want to be able to run untrusted code in a sandbox such that &quot;while True&quot; won&#x27;t exhaust my system resources, and with a limit on the amount of memory that the sandboxed program can allocate itself.</div><br/><div id="39713060" class="c"><input type="checkbox" id="c-39713060" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39710185">parent</a><span>|</span><a href="#39712103">next</a><span>|</span><label class="collapse" for="c-39713060">[-]</label><label class="expand" for="c-39713060">[1 more]</label></div><br/><div class="children"><div class="content">App Isolation is a feature layered on top of low level sandbox primitives and IIRC it doesn&#x27;t support this.<p>On the other hand, it also wouldn&#x27;t make sense for App Isolation because that&#x27;s intended to give apps a lightweight way to opt-in to isolating <i>themselves</i>, in order to restrict the blast radius of exploits. It&#x27;s not intended to let you run arbitrary third party code sandboxed. For that you would need to use something more like the Chromium sandbox that uses kernel job objects, which a sibling comment describes. Using that would require fluency in Win32.</div><br/></div></div><div id="39712103" class="c"><input type="checkbox" id="c-39712103" checked=""/><div class="controls bullet"><span class="by">anitil</span><span>|</span><a href="#39710185">parent</a><span>|</span><a href="#39713060">prev</a><span>|</span><a href="#39711686">next</a><span>|</span><label class="collapse" for="c-39712103">[-]</label><label class="expand" for="c-39712103">[1 more]</label></div><br/><div class="children"><div class="content">(Off topic, but heads up I&#x27;m getting NET::ERR_CERT_COMMON_NAME_INVALID at <a href="https:&#x2F;&#x2F;simonwillison.net&#x2F;" rel="nofollow">https:&#x2F;&#x2F;simonwillison.net&#x2F;</a> and <a href="https:&#x2F;&#x2F;www.simonwillison.net" rel="nofollow">https:&#x2F;&#x2F;www.simonwillison.net</a> is redirecting to 123-reg.co.uk )</div><br/></div></div><div id="39711686" class="c"><input type="checkbox" id="c-39711686" checked=""/><div class="controls bullet"><span class="by">marwis</span><span>|</span><a href="#39710185">parent</a><span>|</span><a href="#39712103">prev</a><span>|</span><a href="#39711631">next</a><span>|</span><label class="collapse" for="c-39711686">[-]</label><label class="expand" for="c-39711686">[7 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not an expert on the subject but just happen to know this was possible since XP: <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winnt&#x2F;ns-winnt-jobobject_basic_limit_information" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winnt&#x2F;ns...</a><p>See JOB_OBJECT_LIMIT_PROCESS_MEMORY and JOB_OBJECT_LIMIT_PROCESS_TIME.<p>Job is basically Windows equivalent of Linux Control Group.</div><br/><div id="39712114" class="c"><input type="checkbox" id="c-39712114" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39711686">parent</a><span>|</span><a href="#39711631">next</a><span>|</span><label class="collapse" for="c-39712114">[-]</label><label class="expand" for="c-39712114">[6 more]</label></div><br/><div class="children"><div class="content">No, the CPU one isn&#x27;t the same. It&#x27;s a cumulative limit (resulting in termination when exceeded). The parent is asking for rate limits (resulting in throttling when exceeded).</div><br/><div id="39712181" class="c"><input type="checkbox" id="c-39712181" checked=""/><div class="controls bullet"><span class="by">marwis</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39712114">parent</a><span>|</span><a href="#39711631">next</a><span>|</span><label class="collapse" for="c-39712181">[-]</label><label class="expand" for="c-39712181">[5 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not really clear from OP that it&#x27;s about rate. Cumulative limit would still fulfill requirement of stopping while(true) from exhausting resources.<p>But if you need rate there&#x27;s this: JOB_OBJECT_ CPU_RATE_CONTROL_MIN_MAX_RATE <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winnt&#x2F;ns-winnt-jobobject_cpu_rate_control_information" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;windows&#x2F;win32&#x2F;api&#x2F;winnt&#x2F;ns...</a></div><br/><div id="39712253" class="c"><input type="checkbox" id="c-39712253" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39712181">parent</a><span>|</span><a href="#39712228">next</a><span>|</span><label class="collapse" for="c-39712253">[-]</label><label class="expand" for="c-39712253">[3 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not explicitly written, but it&#x27;s a pretty unavoidable conclusion.<p>As far as the verbiage goes -- &quot;doesn&#x27;t exhaust&quot; means &quot;uses less than the full amount available&quot;. Given that &quot;total CPU time&quot; isn&#x27;t something you can run out of, &quot;doesn&#x27;t exhaust CPU&quot; can only mean &quot;uses less CPU than is currently available&quot;, i.e. &quot;utilizes &lt; 100% of the CPU&quot;, i.e. throttling.<p>As a practical matter, pretty much ~no user wants to kill a program after N seconds, and ~no program can limit itself to N seconds of work, either. People just want their CPU to have bandwidth to do other work, avoid heating up, etc. So unless you have a strong reason to believe otherwise, it&#x27;s fair to assume people want to limit CPU utilization, not total CPU time.</div><br/><div id="39713051" class="c"><input type="checkbox" id="c-39713051" checked=""/><div class="controls bullet"><span class="by">mike_hearn</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39712253">parent</a><span>|</span><a href="#39712228">next</a><span>|</span><label class="collapse" for="c-39713051">[-]</label><label class="expand" for="c-39713051">[2 more]</label></div><br/><div class="children"><div class="content"><i>&gt; pretty much ~no user wants to kill a program after N seconds</i><p>This is exactly how the web and cloud FaaS like AWS Lambda does it, so I don&#x27;t think it&#x27;s right to say nobody wants this. Runaway code does need to be killed.</div><br/><div id="39713081" class="c"><input type="checkbox" id="c-39713081" checked=""/><div class="controls bullet"><span class="by">dataflow</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39713051">parent</a><span>|</span><a href="#39712228">next</a><span>|</span><label class="collapse" for="c-39713081">[-]</label><label class="expand" for="c-39713081">[1 more]</label></div><br/><div class="children"><div class="content">I didn&#x27;t say <i>nobody</i> wants this, I said no <i>user</i> wants this. We&#x27;re not talking web servers, we&#x27;re talking about Windows desktop apps here... with humans <i>using</i> them. User != admin != owner. &quot;Web and cloud FaaS like AWS Lambda&quot; don&#x27;t have &quot;users&quot; (i.e. the kind who would say &quot;this shouldn&#x27;t exhaust my system resources&quot; like the parent did). They&#x27;re cattle, running batch jobs, and&#x2F;or serving APIs that other client applications invoke...</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="39711631" class="c"><input type="checkbox" id="c-39711631" checked=""/><div class="controls bullet"><span class="by">fbdab103</span><span>|</span><a href="#39710185">parent</a><span>|</span><a href="#39711686">prev</a><span>|</span><a href="#39687256">next</a><span>|</span><label class="collapse" for="c-39711631">[-]</label><label class="expand" for="c-39711631">[2 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the best way to accomplish this on Linux? If there is a good mechanism, can you apply it to a currently running process or do you have to pre-define available resources?<p>The only trick I have up my sleeve is to use earlyoom to abort misbehaving processes if I suddenly squander all of my ram.</div><br/><div id="39712605" class="c"><input type="checkbox" id="c-39712605" checked=""/><div class="controls bullet"><span class="by">NekkoDroid</span><span>|</span><a href="#39710185">root</a><span>|</span><a href="#39711631">parent</a><span>|</span><a href="#39687256">next</a><span>|</span><label class="collapse" for="c-39712605">[-]</label><label class="expand" for="c-39712605">[1 more]</label></div><br/><div class="children"><div class="content">I do remember systemd having `CPUQuota` to set an absolute limit, I am not sure if this is only limited to actual units or if this can be applied to slices as well (KDE and GNOME default to running individual desktop apps in their own slice IIRC), but from the quick glance I took on <a href="https:&#x2F;&#x2F;www.freedesktop.org&#x2F;software&#x2F;systemd&#x2F;man&#x2F;latest&#x2F;systemd.resource-control.html" rel="nofollow">https:&#x2F;&#x2F;www.freedesktop.org&#x2F;software&#x2F;systemd&#x2F;man&#x2F;latest&#x2F;syst...</a> I think it should be possible also to do it on a per slice basis.</div><br/></div></div></div></div></div></div><div id="39711265" class="c"><input type="checkbox" id="c-39711265" checked=""/><div class="controls bullet"><span class="by">throwaway2037</span><span>|</span><a href="#39687256">prev</a><span>|</span><a href="#39693487">next</a><span>|</span><label class="collapse" for="c-39711265">[-]</label><label class="expand" for="c-39711265">[1 more]</label></div><br/><div class="children"><div class="content">Tangent: The image at the top of this blog post is amazing.  Why does the scale feel immense?  It is like something from the film _Interstellar_.</div><br/></div></div><div id="39693487" class="c"><input type="checkbox" id="c-39693487" checked=""/><div class="controls bullet"><span class="by">sciencesama</span><span>|</span><a href="#39711265">prev</a><span>|</span><label class="collapse" for="c-39693487">[-]</label><label class="expand" for="c-39693487">[1 more]</label></div><br/><div class="children"><div class="content">Venv for python with a gui ??</div><br/></div></div></div></div></div></div></div></body></html>