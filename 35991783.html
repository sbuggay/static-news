<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1684573246943" as="style"/><link rel="stylesheet" href="styles.css?v=1684573246943"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/josephernest/Swap">Show HN: Swap.js – a JavaScript micro-framework (HTML fragments over the wire)</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>josephernest</span> | <span>30 comments</span></div><br/><div><div id="36008341" class="c"><input type="checkbox" id="c-36008341" checked=""/><div class="controls bullet"><span class="by">dyeje</span><span>|</span><a href="#36010001">next</a><span>|</span><label class="collapse" for="c-36008341">[-]</label><label class="expand" for="c-36008341">[3 more]</label></div><br/><div class="children"><div class="content">I’m bought in to this approach after using Hotwire, but I’m concerned that all the competing implementations are going to undermine adoption. Maybe we should all just use htmx and call it a day.</div><br/><div id="36009748" class="c"><input type="checkbox" id="c-36009748" checked=""/><div class="controls bullet"><span class="by">quickthrower2</span><span>|</span><a href="#36008341">parent</a><span>|</span><a href="#36009350">next</a><span>|</span><label class="collapse" for="c-36009748">[-]</label><label class="expand" for="c-36009748">[1 more]</label></div><br/><div class="children"><div class="content">The nice thing is the simplicity of all these libraries means changing from one to another is no big deal. Most of the work is server side and already done. It is not like you need to swap all your React components to Vue ones.</div><br/></div></div></div></div><div id="36010001" class="c"><input type="checkbox" id="c-36010001" checked=""/><div class="controls bullet"><span class="by">janwillemb</span><span>|</span><a href="#36008341">prev</a><span>|</span><a href="#36010218">next</a><span>|</span><label class="collapse" for="c-36010001">[-]</label><label class="expand" for="c-36010001">[1 more]</label></div><br/><div class="children"><div class="content">&gt; vanilla JS (no external tool needed: no bundler, no webpack, no TypeScript compiler, no minification needed...)<p>Nice, I like that. I dread the modern way of having to jump through random hoops to get a garbled output that is supposed to contain my code as well. This is way more as I feel it is supposed to work: include a script tag.</div><br/></div></div><div id="36010218" class="c"><input type="checkbox" id="c-36010218" checked=""/><div class="controls bullet"><span class="by">harha_</span><span>|</span><a href="#36010001">prev</a><span>|</span><a href="#36010130">next</a><span>|</span><label class="collapse" for="c-36010218">[-]</label><label class="expand" for="c-36010218">[1 more]</label></div><br/><div class="children"><div class="content">I read through the swap.js file and there&#x27;s a lot of things happening. I also like the fact that it has no dependencies and it&#x27;s cool that it achieves so much with so little code.</div><br/></div></div><div id="36010130" class="c"><input type="checkbox" id="c-36010130" checked=""/><div class="controls bullet"><span class="by">josephernest</span><span>|</span><a href="#36010218">prev</a><span>|</span><a href="#36008516">next</a><span>|</span><label class="collapse" for="c-36010130">[-]</label><label class="expand" for="c-36010130">[1 more]</label></div><br/><div class="children"><div class="content">Demo showing the library in action: <a href="https:&#x2F;&#x2F;afewthingz.com&#x2F;swap-library&#x2F;email&#x2F;" rel="nofollow">https:&#x2F;&#x2F;afewthingz.com&#x2F;swap-library&#x2F;email&#x2F;</a></div><br/></div></div><div id="36008516" class="c"><input type="checkbox" id="c-36008516" checked=""/><div class="controls bullet"><span class="by">chrismorgan</span><span>|</span><a href="#36010130">prev</a><span>|</span><a href="#36008182">next</a><span>|</span><label class="collapse" for="c-36008516">[-]</label><label class="expand" for="c-36008516">[6 more]</label></div><br/><div class="children"><div class="content">Link handling needs to check keyboard modifier state, so that you don’t intercept things like Ctrl+click.<p>You can also work with just one event handler rather than many, which is generally easier, and more reliable if other scripts ever touch the DOM.<p>Here’s something you could replace the first register_links() call with (and drop the other register_links call and definition):<p><pre><code>  addEventListener(&quot;click&quot;, event =&gt; {
      var link;
      if (
          !event.button &amp;&amp;
          !event.altKey &amp;&amp;
          !event.ctrlKey &amp;&amp;
          !event.metaKey &amp;&amp;
          !event.shiftKey &amp;&amp;
          (link = event.target.closest(&quot;[swap-target]&quot;))
      ) {
          update(link.href, link.getAttribute(&#x27;swap-target&#x27;), link.getAttribute(&#x27;swap-history&#x27;));
          event.preventDefault();
      }
  });
</code></pre>
Some other minuscule patches for size and&#x2F;or performance (of things a minifier won’t do):<p><pre><code>  -document.querySelector(&quot;html&quot;)
  +document.documentElement

  -window.addEventListener
  +addEventListener

  -&#x27;*[swap-target]&#x27;
  +&#x27;[swap-target]&#x27;

  -fallback = null
  +fallback
</code></pre>
You can also simplify the code a tad by inlining function dom_changes and dom_load—though any minifier will do this for you, but I find it nicer having those functions inline to begin with. On style, I also wish for consistent single or double quotes rather than mixed.<p>The document.createElement(&#x27;html&#x27;) dance feels wrong. I feel like it should be using new DOMParser().parseFromString(). I’m not sure off the top of my head if it will matter, but it feels like you’re inviting mXSS attacks.<p>On update, you’re only applying <i>body</i> stuff, but you normally want to merge head changes in as well, especially document title.<p>You’re going to run into problems with replacing document.body.outerHTML. Browser extensions and other page JavaScript regularly rely on being able to inject their own stuff onto that element, and on a stable identity for the element, too much—so you’re going to break or be broken by various user extensions and other scripts that you load beside swap.js. Major UI libraries have sometimes started with working directly on document.body, but they’ve all ended up recommending that you mount them in a subelement instead, because otherwise too many things mysteriously break. I recommend getting away from this somehow, but I’m not sure quite how—it’d definitely add required complexity.<p>I’m not fond of how loading works: you rely upon this script being loaded blockingly, with customisation also blocking and after it. Some major uses of this script could otherwise be async and completely optional (progressive enhancement territory). Unfortunately, because of how you handle loaders, you can’t just switch to `document.readyState == &quot;loading&quot; ? addEventListener(&quot;DOMContentLoaded&quot;, dom_load) : dom_load()` to make it <i>support</i> &lt;script async&gt; usage, without losing functionality. You’d need to expose some other way of adding to Swap.loaders.</div><br/><div id="36009985" class="c"><input type="checkbox" id="c-36009985" checked=""/><div class="controls bullet"><span class="by">josephernest</span><span>|</span><a href="#36008516">parent</a><span>|</span><a href="#36009680">next</a><span>|</span><label class="collapse" for="c-36009985">[-]</label><label class="expand" for="c-36009985">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for your detailed comment, the in-depth reading, and for this insightful advice. I&#x27;m going to think about all these points!</div><br/></div></div><div id="36009680" class="c"><input type="checkbox" id="c-36009680" checked=""/><div class="controls bullet"><span class="by">Lorin</span><span>|</span><a href="#36008516">parent</a><span>|</span><a href="#36009985">prev</a><span>|</span><a href="#36008944">next</a><span>|</span><label class="collapse" for="c-36009680">[-]</label><label class="expand" for="c-36009680">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been working on my own library and as soon as I saw the code I realized I didn&#x27;t have handling for keyboard modifiers either - so even if the original doesn&#x27;t see your comment - it wasn&#x27;t a waste! Thank you! :)</div><br/></div></div><div id="36008944" class="c"><input type="checkbox" id="c-36008944" checked=""/><div class="controls bullet"><span class="by">qingcharles</span><span>|</span><a href="#36008516">parent</a><span>|</span><a href="#36009680">prev</a><span>|</span><a href="#36009494">next</a><span>|</span><label class="collapse" for="c-36008944">[-]</label><label class="expand" for="c-36008944">[2 more]</label></div><br/><div class="children"><div class="content">These are all great comments. Doesn&#x27;t look like the author read them (or at least they never responded). Hopefully they read them at some point and use your good info.</div><br/><div id="36009847" class="c"><input type="checkbox" id="c-36009847" checked=""/><div class="controls bullet"><span class="by">josephernest</span><span>|</span><a href="#36008516">root</a><span>|</span><a href="#36008944">parent</a><span>|</span><a href="#36009494">next</a><span>|</span><label class="collapse" for="c-36009847">[-]</label><label class="expand" for="c-36009847">[1 more]</label></div><br/><div class="children"><div class="content">Hi, author here, I just woke up and see all these comments :) I&#x27;m reading and I&#x27;ll answer!</div><br/></div></div></div></div><div id="36009494" class="c"><input type="checkbox" id="c-36009494" checked=""/><div class="controls bullet"><span class="by">hombre_fatal</span><span>|</span><a href="#36008516">parent</a><span>|</span><a href="#36008944">prev</a><span>|</span><a href="#36008182">next</a><span>|</span><label class="collapse" for="c-36009494">[-]</label><label class="expand" for="c-36009494">[1 more]</label></div><br/><div class="children"><div class="content">I wish someone would do this for any of my libraries. Good stuff.</div><br/></div></div></div></div><div id="36008182" class="c"><input type="checkbox" id="c-36008182" checked=""/><div class="controls bullet"><span class="by">canadiantim</span><span>|</span><a href="#36008516">prev</a><span>|</span><a href="#36008794">next</a><span>|</span><label class="collapse" for="c-36008182">[-]</label><label class="expand" for="c-36008182">[7 more]</label></div><br/><div class="children"><div class="content">How would you compare yourself to HTMX and Unpoly? I&#x27;m keenly interesting in this space for sure and love that you&#x27;re working on another!</div><br/><div id="36009951" class="c"><input type="checkbox" id="c-36009951" checked=""/><div class="controls bullet"><span class="by">josephernest</span><span>|</span><a href="#36008182">parent</a><span>|</span><a href="#36008216">next</a><span>|</span><label class="collapse" for="c-36009951">[-]</label><label class="expand" for="c-36009951">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for the comment!<p>These 2 other libraries are really great.<p>For something as important as the choice of a web framework, I realized I really wanted to 100% understand the internals, then I starting working on Swap.<p>The key things for me are:<p>- no tool required (just a text editor, no compiler, no bundler&#x2F;packer, no minification even needed: I just wanted to write JS and that&#x27;s all).<p>- be able to re-read the source code in 10 minutes and 100% understand how it works, which is impossible with most frameworks<p>- even if simple, I wanted that non-trivial features are included (such as browser history, when using previous &#x2F; forward browser buttons), because I don&#x27;t want to have to think about this when creating a new web appliation<p>My first prototypes took a few hundreds of lines of code (for the same result). I spent some good time redesigning it, and finally I was surprised I can cover 80% of my navigation needs (when doing web applications), with only 50 to 100 LoC.<p>For the rest (features not enhanced by Swap, like form submission), of course, I just write normal JS, but I think I would have done it anyway whatever the framework.<p><i>TL;DR</i>: in my lib I just focused on swapping HTML content (parts of the page) when navigating, thus the name &quot;Swap&quot; :) + I wanted the lib to do the boring stuff for me (make sure the browser history still works, etc.)</div><br/></div></div><div id="36008216" class="c"><input type="checkbox" id="c-36008216" checked=""/><div class="controls bullet"><span class="by">devmunchies</span><span>|</span><a href="#36008182">parent</a><span>|</span><a href="#36009951">prev</a><span>|</span><a href="#36008794">next</a><span>|</span><label class="collapse" for="c-36008216">[-]</label><label class="expand" for="c-36008216">[5 more]</label></div><br/><div class="children"><div class="content">Lib is EXTREMELY minimal. Only GET requests with anchor tags. That you can’t POST forms or send metadata make it mostly useless for anything but the most basic website.<p>I guess the creator will think about the minimal features to add in their remaining 50 LoC budget. (IMO a minimized KB target would be a better ceiling).</div><br/><div id="36009064" class="c"><input type="checkbox" id="c-36009064" checked=""/><div class="controls bullet"><span class="by">juancampa</span><span>|</span><a href="#36008182">root</a><span>|</span><a href="#36008216">parent</a><span>|</span><a href="#36008504">next</a><span>|</span><label class="collapse" for="c-36009064">[-]</label><label class="expand" for="c-36009064">[3 more]</label></div><br/><div class="children"><div class="content">Isn&#x27;t that what &lt;form&gt; is for?</div><br/><div id="36009307" class="c"><input type="checkbox" id="c-36009307" checked=""/><div class="controls bullet"><span class="by">djbusby</span><span>|</span><a href="#36008182">root</a><span>|</span><a href="#36009064">parent</a><span>|</span><a href="#36008504">next</a><span>|</span><label class="collapse" for="c-36009307">[-]</label><label class="expand" for="c-36009307">[2 more]</label></div><br/><div class="children"><div class="content">Was. for, &quot;modern&quot; things (libs, framework, etc) intercept these bog standard bits with their &quot;magic&quot; rebuilding to maybe 70% of what already worked.</div><br/><div id="36009503" class="c"><input type="checkbox" id="c-36009503" checked=""/><div class="controls bullet"><span class="by">hombre_fatal</span><span>|</span><a href="#36008182">root</a><span>|</span><a href="#36009307">parent</a><span>|</span><a href="#36008504">next</a><span>|</span><label class="collapse" for="c-36009503">[-]</label><label class="expand" for="c-36009503">[1 more]</label></div><br/><div class="children"><div class="content">Refreshing the page to send an upvote isn’t peak UX.</div><br/></div></div></div></div></div></div><div id="36008504" class="c"><input type="checkbox" id="c-36008504" checked=""/><div class="controls bullet"><span class="by">breakfastduck</span><span>|</span><a href="#36008182">root</a><span>|</span><a href="#36008216">parent</a><span>|</span><a href="#36009064">prev</a><span>|</span><a href="#36008794">next</a><span>|</span><label class="collapse" for="c-36008504">[-]</label><label class="expand" for="c-36008504">[1 more]</label></div><br/><div class="children"><div class="content">I mean, you can just write some code to post data to an API.</div><br/></div></div></div></div></div></div><div id="36008794" class="c"><input type="checkbox" id="c-36008794" checked=""/><div class="controls bullet"><span class="by">krsdcbl</span><span>|</span><a href="#36008182">prev</a><span>|</span><a href="#36010109">next</a><span>|</span><label class="collapse" for="c-36008794">[-]</label><label class="expand" for="c-36008794">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m getting a bit of deja vu from this recebt rediscovery of ajax but i really like it. Back when js was obscure and jQuery became ubiquitous, that practice was a go to and sites started to feel, albeit sluggish, like more and more like todays spa centric ecosystem.<p>Seeing projects spawn that the default that ssr was and making those early, simple optimisation tools much more streamlined, understandable, accessible and purely functional is great!</div><br/></div></div><div id="36010109" class="c"><input type="checkbox" id="c-36010109" checked=""/><div class="controls bullet"><span class="by">dvh</span><span>|</span><a href="#36008794">prev</a><span>|</span><a href="#36009348">next</a><span>|</span><label class="collapse" for="c-36010109">[-]</label><label class="expand" for="c-36010109">[1 more]</label></div><br/><div class="children"><div class="content">Ah the good old element.innerHTML = xss_vector_here</div><br/></div></div><div id="36009348" class="c"><input type="checkbox" id="c-36009348" checked=""/><div class="controls bullet"><span class="by">tommica</span><span>|</span><a href="#36010109">prev</a><span>|</span><a href="#36008214">next</a><span>|</span><label class="collapse" for="c-36009348">[-]</label><label class="expand" for="c-36009348">[1 more]</label></div><br/><div class="children"><div class="content">Oh nice, I am working on something similar, but didn&#x27;t think of using MutationObserver for anything.<p>But be careful with hooking to links, there situations you want to test for that might need to work like a normal link (target blank or external url for example)</div><br/></div></div><div id="36008214" class="c"><input type="checkbox" id="c-36008214" checked=""/><div class="controls bullet"><span class="by">garganzol</span><span>|</span><a href="#36009348">prev</a><span>|</span><a href="#36009882">next</a><span>|</span><label class="collapse" for="c-36008214">[-]</label><label class="expand" for="c-36008214">[3 more]</label></div><br/><div class="children"><div class="content">Impressive, especially considering the implementation size. Just by looking at swap.js file, I could not actually believe it really works but it clearly gets the job done.</div><br/><div id="36008542" class="c"><input type="checkbox" id="c-36008542" checked=""/><div class="controls bullet"><span class="by">LeonB</span><span>|</span><a href="#36008214">parent</a><span>|</span><a href="#36008582">next</a><span>|</span><label class="collapse" for="c-36008542">[-]</label><label class="expand" for="c-36008542">[1 more]</label></div><br/><div class="children"><div class="content">Yes, I think it’s quite a delightful example. Small enough that it’s quite realistic to be able to read it, understand it, and add to it.</div><br/></div></div><div id="36008582" class="c"><input type="checkbox" id="c-36008582" checked=""/><div class="controls bullet"><span class="by">shaunxcode</span><span>|</span><a href="#36008214">parent</a><span>|</span><a href="#36008542">prev</a><span>|</span><a href="#36009882">next</a><span>|</span><label class="collapse" for="c-36008582">[-]</label><label class="expand" for="c-36008582">[1 more]</label></div><br/><div class="children"><div class="content">Why fight evolution?</div><br/></div></div></div></div><div id="36009882" class="c"><input type="checkbox" id="c-36009882" checked=""/><div class="controls bullet"><span class="by">ulrischa</span><span>|</span><a href="#36008214">prev</a><span>|</span><a href="#36009122">next</a><span>|</span><label class="collapse" for="c-36009882">[-]</label><label class="expand" for="c-36009882">[1 more]</label></div><br/><div class="children"><div class="content">This is much better than htmx. I like the focus on just swapping content</div><br/></div></div><div id="36009122" class="c"><input type="checkbox" id="c-36009122" checked=""/><div class="controls bullet"><span class="by">gijoeyguerra</span><span>|</span><a href="#36009882">prev</a><span>|</span><a href="#35992266">next</a><span>|</span><label class="collapse" for="c-36009122">[-]</label><label class="expand" for="c-36009122">[1 more]</label></div><br/><div class="children"><div class="content">A new world: Part Three.</div><br/></div></div></div></div></div></div></div></body></html>