<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729414851290" as="style"/><link rel="stylesheet" href="styles.css?v=1729414851290"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cpldcpu.wordpress.com/2024/05/02/machine-learning-mnist-inference-on-the-3-cent-microcontroller/">Implementing neural networks on the &quot;3 cent&quot; 8-bit microcontroller</a>Â <span class="domain">(<a href="https://cpldcpu.wordpress.com">cpldcpu.wordpress.com</a>)</span></div><div class="subtext"><span>cpldcpu</span> | <span>7 comments</span></div><br/><div><div id="41893315" class="c"><input type="checkbox" id="c-41893315" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#41892377">next</a><span>|</span><label class="collapse" for="c-41893315">[-]</label><label class="expand" for="c-41893315">[2 more]</label></div><br/><div class="children"><div class="content">I feel like to really get to the level of hypothetically useful it should be able to take the samples from an input source.<p>I wonder if you could do it on the full 28*28 by never holding the full image in memory at once, just as an input stream.   
say a 1d convolution on each line as it comes in to turn a [1,28] to [3,7] 
buffer two lines of the [3,7] = 42.   Then after there are three results of the third line convolution are produced [3,3]=9, start performing a 2d convolution using the first two lines [2,3,:3] replacing the data at the start (as it has already been processed).</div><br/><div id="41893420" class="c"><input type="checkbox" id="c-41893420" checked=""/><div class="controls bullet"><span class="by">cpldcpu</span><span>|</span><a href="#41893315">parent</a><span>|</span><a href="#41892377">next</a><span>|</span><label class="collapse" for="c-41893420">[-]</label><label class="expand" for="c-41893420">[1 more]</label></div><br/><div class="children"><div class="content">Yes, you could implement it in a way where the first layer is streamed and accumulate on output activations in parallel in the memory. This would limit the memory requirements for the input activations, but would increase execution time, as more activiations have to be shuffled around.<p>In this case I am streaing from ROM anyways, so it does not matter if the inputs are read only once or multiple times.</div><br/></div></div></div></div><div id="41892377" class="c"><input type="checkbox" id="c-41892377" checked=""/><div class="controls bullet"><span class="by">malwrar</span><span>|</span><a href="#41893315">prev</a><span>|</span><a href="#41892062">next</a><span>|</span><label class="collapse" for="c-41892377">[-]</label><label class="expand" for="c-41892377">[2 more]</label></div><br/><div class="children"><div class="content">Super interesting!<p>I wish tfa would have found some way to measure the PMS150C implementation the headline brags about, but even the PFS154 (2x mem, 3x price) version is super neat! Interesting to see how the net in particular is built at such small scale. I also wish they included numbers about performance like they do in their linked CH32V003 post. I&#x27;m wondering how quick these MCUs are compared to each other and e.g. OP&#x27;s PC, and how hot they get under sustained load.</div><br/><div id="41893406" class="c"><input type="checkbox" id="c-41893406" checked=""/><div class="controls bullet"><span class="by">cpldcpu</span><span>|</span><a href="#41892377">parent</a><span>|</span><a href="#41892062">next</a><span>|</span><label class="collapse" for="c-41893406">[-]</label><label class="expand" for="c-41893406">[1 more]</label></div><br/><div class="children"><div class="content">There are no performance profiling mechanisms on these small devices, and the timers are rather coarse.<p>But it is easily possible to estimate the execute time:<p>- mulacc of one weight takes 11 clock cycles.<p>- There are 1696 weights in the model, each one is only touched once.<p>- We can assume ~25%-50% overhead for loops and housekeeping (1:4 unrolled)<p>=&gt; ~23000-28000 clock cycles per inference, which is less than 2ms at 16MHz<p>Since this is an MLP, the inference time directly scales with the number of weights. (This would be different for a CNN)<p>As per veryfing on PMC150C - I considered using an LED for valid&#x2F;nonvalid output. But iterating with OTP devices is quite tedious when you do not have an emulator. Since both devices are code compatible, we can assume that the code works on the smaller devices, though.</div><br/></div></div></div></div><div id="41892062" class="c"><input type="checkbox" id="c-41892062" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#41892377">prev</a><span>|</span><label class="collapse" for="c-41892062">[-]</label><label class="expand" for="c-41892062">[2 more]</label></div><br/><div class="children"><div class="content">Fun to see neural nets pushed to such extremes, really enjoyed the post.<p>&gt; The smallest models had to be trained without data augmentation, as they would not converge otherwise.<p>Was this also the case for the 2-bit model you ended up with?</div><br/><div id="41893238" class="c"><input type="checkbox" id="c-41893238" checked=""/><div class="controls bullet"><span class="by">cpldcpu</span><span>|</span><a href="#41892062">parent</a><span>|</span><label class="collapse" for="c-41893238">[-]</label><label class="expand" for="c-41893238">[1 more]</label></div><br/><div class="children"><div class="content">Yes, as far as i remember the limit was somewhere around 1kbyte total parameters size.</div><br/></div></div></div></div></div></div></div></div></div></body></html>