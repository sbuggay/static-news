<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1733994055633" as="style"/><link rel="stylesheet" href="styles.css?v=1733994055633"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://pgroll.com/">Pgroll – Zero-downtime, reversible, schema changes for PostgreSQL (new website)</a> <span class="domain">(<a href="https://pgroll.com">pgroll.com</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>43 comments</span></div><br/><div><div id="42391929" class="c"><input type="checkbox" id="c-42391929" checked=""/><div class="controls bullet"><span class="by">rixed</span><span>|</span><a href="#42392649">next</a><span>|</span><label class="collapse" for="c-42391929">[-]</label><label class="expand" for="c-42391929">[9 more]</label></div><br/><div class="children"><div class="content">Pgroll shines if you are doing slow rollouts.<p>Recently on the market for a tool to manage SQL migration patches with no need for slow rollouts, I reviewed many such tools and the one that impressed me was sqitch: <a href="https:&#x2F;&#x2F;github.com&#x2F;sqitchers&#x2F;sqitch" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;sqitchers&#x2F;sqitch</a><p>So if you are interrested in this field and if Pgroll is not quite what you are looking for, I recommand you have a look at sqitch.</div><br/><div id="42396893" class="c"><input type="checkbox" id="c-42396893" checked=""/><div class="controls bullet"><span class="by">rswail</span><span>|</span><a href="#42391929">parent</a><span>|</span><a href="#42392070">next</a><span>|</span><label class="collapse" for="c-42396893">[-]</label><label class="expand" for="c-42396893">[2 more]</label></div><br/><div class="children"><div class="content">Using sqitch in production, the main issue is that it effectively has no knowledge of what is happening except for running psql files for you. So it&#x27;s hard to keep track of what the actual resulting schema should look like after each change has been applied to work out whether it&#x27;s correct.<p>Getting people to write deploy&#x2F;revert scripts are relatively easy. Asking them to write verify scripts that do more than check that a column has been added&#x2F;removed is hard.<p>There&#x27;s the &quot;physical&quot; issues of modifying a schema, and sqitch is great for that. But handling the &quot;logical&quot; issues of schema migration is more than an automated tool for running scripts.<p>This tool (pgroll) allows you to actually test the modified schema for logical validity without impacting the ongoing operations, which to me, seems like a win.</div><br/><div id="42397356" class="c"><input type="checkbox" id="c-42397356" checked=""/><div class="controls bullet"><span class="by">rixed</span><span>|</span><a href="#42391929">root</a><span>|</span><a href="#42396893">parent</a><span>|</span><a href="#42392070">next</a><span>|</span><label class="collapse" for="c-42397356">[-]</label><label class="expand" for="c-42397356">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Using sqitch in production, the main issue is that it effectively has no knowledge of what is happening except for running psql files for you.<p>I came to the conclusion that you can not have anything more than that without compromising on how you can change your schema.<p>&gt; So it&#x27;s hard to keep track of what the actual resulting schema should look like after each change has been applied to work out whether it&#x27;s correct.<p>At first sight, this is a gripe that has to be addressed to SQL itself that the SQL to change a schema can not trivially be inferred from the &quot;before&quot; and &quot;after&quot; schema definitions. But probably there is no way around it, il all generality.<p>One can store the current version of the schema in the source repository and make sure that the schema extracted after one or several applications of the migration match that.</div><br/></div></div></div></div><div id="42392070" class="c"><input type="checkbox" id="c-42392070" checked=""/><div class="controls bullet"><span class="by">lucideer</span><span>|</span><a href="#42391929">parent</a><span>|</span><a href="#42396893">prev</a><span>|</span><a href="#42392797">next</a><span>|</span><label class="collapse" for="c-42392070">[-]</label><label class="expand" for="c-42392070">[2 more]</label></div><br/><div class="children"><div class="content">&gt; <i>if Pgroll is not quite what you are looking for</i><p>If you don&#x27;t need slow rollouts, what would you say the downsides of using Pgroll over Sqitch would be?<p>(I&#x27;ve used neither, but I got the impression from the op that slow rollouts was a feature, not a requirement)</div><br/><div id="42397301" class="c"><input type="checkbox" id="c-42397301" checked=""/><div class="controls bullet"><span class="by">rixed</span><span>|</span><a href="#42391929">root</a><span>|</span><a href="#42392070">parent</a><span>|</span><a href="#42392797">next</a><span>|</span><label class="collapse" for="c-42397301">[-]</label><label class="expand" for="c-42397301">[1 more]</label></div><br/><div class="children"><div class="content">What Pgroll offers does not come for free: it puts some constraints on your schema and what migrations you can perform. Most &quot;automatic migration&quot; tools I&#x27;ve seen are designed for the easy migrations (&quot;horizontal&quot; changes, ie adding&#x2F;removing&#x2F;altering columns). But a schema migration is not equivalent to a view and a pair of triggers in general, even if in practice it&#x27;s often limited to that. (simplest if a bit contrived example I can come up with: imagine you have a short table with 3 columns and 4 lines, and you wish to use instead a transposition of this table with 4 columns and 3 lines)<p>It&#x27;s also why I&#x27;m dubious of &quot;revert patches&quot; in general. If there exist a revert patch for a migration, that&#x27;s an easy migration. Sqitch can use a revert patch, like it can use a verify statement, but just for the convenience; it does not require them.<p>Yet, 9 schema migrations out of 10 are easy ones that pgroll handle nicely. It&#x27;s a bit like using an ORM : if you just need a DB to store objects manipulated only in your program, sure go ahead use an ORM; but if your DB is the core of your business then you&#x27;d better not let an ORM anywhere near your schema.<p>At the end of the day, I&#x27;m under the impression that if one wants to handle the general case then one has to keep the whole previous DB and apps in one hand and the new DB and apps in the other, and transition customers from the former to the later. That&#x27;s much less work if you don&#x27;t need slow rollout.</div><br/></div></div></div></div><div id="42392797" class="c"><input type="checkbox" id="c-42392797" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#42391929">parent</a><span>|</span><a href="#42392070">prev</a><span>|</span><a href="#42392350">next</a><span>|</span><label class="collapse" for="c-42392797">[-]</label><label class="expand" for="c-42392797">[3 more]</label></div><br/><div class="children"><div class="content">My experience with Sqitch was &quot;all the fun of git rebase with all the fun of manual rollback and verification code&quot; :-( I would never wish that upon my enemies<p>I&#x27;m open to the fact that we may have just had legacy antipatterns drug into the project, since it was shoehorned into the team by a similarly strongly opinionated advocate</div><br/><div id="42397335" class="c"><input type="checkbox" id="c-42397335" checked=""/><div class="controls bullet"><span class="by">filterfish</span><span>|</span><a href="#42391929">root</a><span>|</span><a href="#42392797">parent</a><span>|</span><a href="#42396894">next</a><span>|</span><label class="collapse" for="c-42397335">[-]</label><label class="expand" for="c-42397335">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using sqitch for years and haven&#x27;t had any problems with it. Though they haven&#x27;t been big projects with lots of devs so I may be using in it&#x27;s sweet spot.</div><br/></div></div><div id="42396894" class="c"><input type="checkbox" id="c-42396894" checked=""/><div class="controls bullet"><span class="by">jokethrowaway</span><span>|</span><a href="#42391929">root</a><span>|</span><a href="#42392797">parent</a><span>|</span><a href="#42397335">prev</a><span>|</span><a href="#42392350">next</a><span>|</span><label class="collapse" for="c-42396894">[-]</label><label class="expand" for="c-42396894">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think it&#x27;s that bad but I used sqitch from the start of the project - so maybe I am the problem<p>I also don&#x27;t think rebasing is the nightmare everybody makes it out to be. git rebase -i follow the instructions and you are good to go</div><br/></div></div></div></div><div id="42392350" class="c"><input type="checkbox" id="c-42392350" checked=""/><div class="controls bullet"><span class="by">hendiatris</span><span>|</span><a href="#42391929">parent</a><span>|</span><a href="#42392797">prev</a><span>|</span><a href="#42392649">next</a><span>|</span><label class="collapse" for="c-42392350">[-]</label><label class="expand" for="c-42392350">[1 more]</label></div><br/><div class="children"><div class="content">Sqitch is an incredibly under appreciated tool. It doesn’t have a business pushing it like flyway and liquibase, so it isn’t as widely known, but I vastly prefer it to comparable migration tools.</div><br/></div></div></div></div><div id="42392649" class="c"><input type="checkbox" id="c-42392649" checked=""/><div class="controls bullet"><span class="by">Arctic_fly</span><span>|</span><a href="#42391929">prev</a><span>|</span><a href="#42396775">next</a><span>|</span><label class="collapse" for="c-42392649">[-]</label><label class="expand" for="c-42392649">[3 more]</label></div><br/><div class="children"><div class="content">We&#x27;ve looked into this tool a couple times, haven&#x27;t adopted it yet. The main issue is compatibility with prisma, which we use for defining our db&#x27;s schema and automating migrations. If there were a slick integration between the two, that would go a long way to convincing us to adopt. In the meantime, we&#x27;ll go with convenience and (slightly, almost immeasurably) lower reliability. We haven&#x27;t had downtime due to a migration in months!</div><br/><div id="42392909" class="c"><input type="checkbox" id="c-42392909" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42392649">parent</a><span>|</span><a href="#42392868">next</a><span>|</span><label class="collapse" for="c-42392909">[-]</label><label class="expand" for="c-42392909">[1 more]</label></div><br/><div class="children"><div class="content">Yes, this is the biggest issue right now and we’re working on a solution.<p>What we want to do is add the ability to generate the pgroll migrations based on the prisma generated migration files. Depending on the operation, you might need to add more info.<p>This will work fairly generally, not only prisma.</div><br/></div></div><div id="42392868" class="c"><input type="checkbox" id="c-42392868" checked=""/><div class="controls bullet"><span class="by">notpushkin</span><span>|</span><a href="#42392649">parent</a><span>|</span><a href="#42392909">prev</a><span>|</span><a href="#42396775">next</a><span>|</span><label class="collapse" for="c-42392868">[-]</label><label class="expand" for="c-42392868">[1 more]</label></div><br/><div class="children"><div class="content">Same but with Alembic! I&#x27;m wondering how hard would it be to open pgroll up for third party migration systems.</div><br/></div></div></div></div><div id="42396775" class="c"><input type="checkbox" id="c-42396775" checked=""/><div class="controls bullet"><span class="by">polskibus</span><span>|</span><a href="#42392649">prev</a><span>|</span><a href="#42390043">next</a><span>|</span><label class="collapse" for="c-42396775">[-]</label><label class="expand" for="c-42396775">[1 more]</label></div><br/><div class="children"><div class="content">Does anyone know of similar tool for MS SQL?</div><br/></div></div><div id="42390043" class="c"><input type="checkbox" id="c-42390043" checked=""/><div class="controls bullet"><span class="by">colemannerd</span><span>|</span><a href="#42396775">prev</a><span>|</span><a href="#42393396">next</a><span>|</span><label class="collapse" for="c-42390043">[-]</label><label class="expand" for="c-42390043">[6 more]</label></div><br/><div class="children"><div class="content">Are migrations still specified in json?</div><br/><div id="42390770" class="c"><input type="checkbox" id="c-42390770" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42390043">parent</a><span>|</span><a href="#42392980">next</a><span>|</span><label class="collapse" for="c-42390770">[-]</label><label class="expand" for="c-42390770">[3 more]</label></div><br/><div class="children"><div class="content">Yes, but we&#x27;re working on a converter from DDL sql to pgroll json.<p>The reason for JSON is because the pgroll migrations are &quot;higher level&quot;. For example, let&#x27;s say that you are adding a new unique column that should infer its data from an existing column (e.g. split `name` into `first_name` and `last_name`). The pgroll migration contains not only the info that new columns are added, but also about how to backfill the data.<p>The sql2pgroll converter is creating the higher level migration files, but leaves placeholder for the &quot;up&quot; &#x2F; &quot;down&quot; data migrations.<p>The issue where sql2pgroll is tracked is this one: <a href="https:&#x2F;&#x2F;github.com&#x2F;xataio&#x2F;pgroll&#x2F;issues&#x2F;504" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;xataio&#x2F;pgroll&#x2F;issues&#x2F;504</a></div><br/><div id="42397214" class="c"><input type="checkbox" id="c-42397214" checked=""/><div class="controls bullet"><span class="by">solatic</span><span>|</span><a href="#42390043">root</a><span>|</span><a href="#42390770">parent</a><span>|</span><a href="#42394204">next</a><span>|</span><label class="collapse" for="c-42397214">[-]</label><label class="expand" for="c-42397214">[1 more]</label></div><br/><div class="children"><div class="content">I completely understand the need for a higher-level language above SQL, but straight JSON is a deal-breaker. It&#x27;s not just comments, it&#x27;s also that editors won&#x27;t understand that JSON should have syntax-highlighting to help people catch trivial typos. A configuration language that allows for importing a file as a string would allow users to write the SQL in files with .sql extensions and get syntax-highlighting.<p>pgroll is written in Go, so if you were to accept configuration written in CUE, you would get the best of all worlds:<p>* Besides support for comments, there&#x27;s first-class support in Go for writing configuration in CUE and then importing it: <a href="https:&#x2F;&#x2F;cuelang.org&#x2F;docs&#x2F;concept&#x2F;how-cue-works-with-go&#x2F;#loading-cue-data" rel="nofollow">https:&#x2F;&#x2F;cuelang.org&#x2F;docs&#x2F;concept&#x2F;how-cue-works-with-go&#x2F;#load...</a><p>* SQL can written in files with .sql extensions and embedded in CUE with @embed: <a href="https:&#x2F;&#x2F;cuelang.org&#x2F;docs&#x2F;howto&#x2F;embed-files-in-cue-evaluation&#x2F;" rel="nofollow">https:&#x2F;&#x2F;cuelang.org&#x2F;docs&#x2F;howto&#x2F;embed-files-in-cue-evaluation...</a></div><br/></div></div><div id="42394204" class="c"><input type="checkbox" id="c-42394204" checked=""/><div class="controls bullet"><span class="by">colemannerd</span><span>|</span><a href="#42390043">root</a><span>|</span><a href="#42390770">parent</a><span>|</span><a href="#42397214">prev</a><span>|</span><a href="#42392980">next</a><span>|</span><label class="collapse" for="c-42394204">[-]</label><label class="expand" for="c-42394204">[1 more]</label></div><br/><div class="children"><div class="content">Thank you so much! I’ll be watching</div><br/></div></div></div></div><div id="42392980" class="c"><input type="checkbox" id="c-42392980" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#42390043">parent</a><span>|</span><a href="#42390770">prev</a><span>|</span><a href="#42393396">next</a><span>|</span><label class="collapse" for="c-42392980">[-]</label><label class="expand" for="c-42392980">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;xataio&#x2F;pgroll&#x2F;issues&#x2F;281" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;xataio&#x2F;pgroll&#x2F;issues&#x2F;281</a> may be worth a :+1: even though it seems from tudorg&#x27;s comment that they&#x27;re really wedded to .json :-(</div><br/><div id="42393200" class="c"><input type="checkbox" id="c-42393200" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42390043">root</a><span>|</span><a href="#42392980">parent</a><span>|</span><a href="#42393396">next</a><span>|</span><label class="collapse" for="c-42393200">[-]</label><label class="expand" for="c-42393200">[1 more]</label></div><br/><div class="children"><div class="content">Ha ha, we&#x27;re not wedded, I was only explaining why a .sql file is not quite enough. Using some json equivalent should be fine, thanks for pointing to the issue.</div><br/></div></div></div></div></div></div><div id="42393396" class="c"><input type="checkbox" id="c-42393396" checked=""/><div class="controls bullet"><span class="by">muratsu</span><span>|</span><a href="#42390043">prev</a><span>|</span><a href="#42390797">next</a><span>|</span><label class="collapse" for="c-42393396">[-]</label><label class="expand" for="c-42393396">[2 more]</label></div><br/><div class="children"><div class="content">Unrelated to the OP product but I’m curious how people are solving this issue on smaller scale with nextjs + prisma&#x2F;drizzle. Do you just run the builtin migrate script with npm run?</div><br/><div id="42396659" class="c"><input type="checkbox" id="c-42396659" checked=""/><div class="controls bullet"><span class="by">maxf</span><span>|</span><a href="#42393396">parent</a><span>|</span><a href="#42390797">next</a><span>|</span><label class="collapse" for="c-42396659">[-]</label><label class="expand" for="c-42396659">[1 more]</label></div><br/><div class="children"><div class="content">We use a CI job that runs drizzle migrate whenever the schema files change. Drizzle doesn’t have rollbacks though. Replacing this process with pgroll as a sort of drop-in replacement would be nice. Then orchestrate everything with a couple of CI jobs, and done!</div><br/></div></div></div></div><div id="42390797" class="c"><input type="checkbox" id="c-42390797" checked=""/><div class="controls bullet"><span class="by">cpursley</span><span>|</span><a href="#42393396">prev</a><span>|</span><a href="#42390778">next</a><span>|</span><label class="collapse" for="c-42390797">[-]</label><label class="expand" for="c-42390797">[5 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s a few other migration tooling options for Postgres: <a href="https:&#x2F;&#x2F;gist.github.com&#x2F;cpursley&#x2F;c8fb81fe8a7e5df038158bdfe0f06dbb#migrations" rel="nofollow">https:&#x2F;&#x2F;gist.github.com&#x2F;cpursley&#x2F;c8fb81fe8a7e5df038158bdfe0f...</a></div><br/><div id="42391738" class="c"><input type="checkbox" id="c-42391738" checked=""/><div class="controls bullet"><span class="by">brycethornton</span><span>|</span><a href="#42390797">parent</a><span>|</span><a href="#42390778">next</a><span>|</span><label class="collapse" for="c-42391738">[-]</label><label class="expand" for="c-42391738">[4 more]</label></div><br/><div class="children"><div class="content">Can you add <a href="https:&#x2F;&#x2F;github.com&#x2F;shayonj&#x2F;pg-osc" rel="nofollow">https:&#x2F;&#x2F;github.com&#x2F;shayonj&#x2F;pg-osc</a>? It&#x27;s my favorite PG migration tool.</div><br/><div id="42394562" class="c"><input type="checkbox" id="c-42394562" checked=""/><div class="controls bullet"><span class="by">paulryanrogers</span><span>|</span><a href="#42390797">root</a><span>|</span><a href="#42391738">parent</a><span>|</span><a href="#42394544">prev</a><span>|</span><a href="#42392118">next</a><span>|</span><label class="collapse" for="c-42394562">[-]</label><label class="expand" for="c-42394562">[1 more]</label></div><br/><div class="children"><div class="content">How many have you used?<p>At ORIS I wrote a Laravel wrapper for PTOSC and really miss it now that I&#x27;m back on PostgreSQL. Now I mostly use updatable views in front of modified tables then drop-swap things later once any transitional backfilling is done.</div><br/></div></div><div id="42392118" class="c"><input type="checkbox" id="c-42392118" checked=""/><div class="controls bullet"><span class="by">shayonj</span><span>|</span><a href="#42390797">root</a><span>|</span><a href="#42391738">parent</a><span>|</span><a href="#42394562">prev</a><span>|</span><a href="#42390778">next</a><span>|</span><label class="collapse" for="c-42392118">[-]</label><label class="expand" for="c-42392118">[1 more]</label></div><br/><div class="children"><div class="content">Thank you Bryce &lt;3</div><br/></div></div></div></div></div></div><div id="42390778" class="c"><input type="checkbox" id="c-42390778" checked=""/><div class="controls bullet"><span class="by">rtuin</span><span>|</span><a href="#42390797">prev</a><span>|</span><a href="#42390868">next</a><span>|</span><label class="collapse" for="c-42390778">[-]</label><label class="expand" for="c-42390778">[1 more]</label></div><br/><div class="children"><div class="content">This seems like a great tool! I like how it &quot;simply&quot; works by putting a view on top of the actual table. This concept is widely used in the data engineering world  (in dbt).<p>There must be an easier way to write migrations for pgroll though. I mean, JSON, really?</div><br/></div></div><div id="42390868" class="c"><input type="checkbox" id="c-42390868" checked=""/><div class="controls bullet"><span class="by">konradb</span><span>|</span><a href="#42390778">prev</a><span>|</span><a href="#42390490">next</a><span>|</span><label class="collapse" for="c-42390868">[-]</label><label class="expand" for="c-42390868">[2 more]</label></div><br/><div class="children"><div class="content">Cool new site!  I got &#x27;invalid invite&#x27; on the discord link from the front page, I only mention as I&#x27;d like to join it.</div><br/><div id="42390893" class="c"><input type="checkbox" id="c-42390893" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42390868">parent</a><span>|</span><a href="#42390490">next</a><span>|</span><label class="collapse" for="c-42390893">[-]</label><label class="expand" for="c-42390893">[1 more]</label></div><br/><div class="children"><div class="content">Oops, fixing it now. This link should work: <a href="https:&#x2F;&#x2F;discord.com&#x2F;invite&#x2F;kvAcQKh7vm" rel="nofollow">https:&#x2F;&#x2F;discord.com&#x2F;invite&#x2F;kvAcQKh7vm</a></div><br/></div></div></div></div><div id="42390490" class="c"><input type="checkbox" id="c-42390490" checked=""/><div class="controls bullet"><span class="by">jherskovic</span><span>|</span><a href="#42390868">prev</a><span>|</span><a href="#42391886">next</a><span>|</span><label class="collapse" for="c-42390490">[-]</label><label class="expand" for="c-42390490">[2 more]</label></div><br/><div class="children"><div class="content">The website generally looks good, but the font in the headings is weird. What is up with the &quot;d&quot; in it?!</div><br/><div id="42391083" class="c"><input type="checkbox" id="c-42391083" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42390490">parent</a><span>|</span><a href="#42391886">next</a><span>|</span><label class="collapse" for="c-42391083">[-]</label><label class="expand" for="c-42391083">[1 more]</label></div><br/><div class="children"><div class="content">This is the font, we wanted something a bit different :) <a href="https:&#x2F;&#x2F;unbounded.polkadot.network&#x2F;" rel="nofollow">https:&#x2F;&#x2F;unbounded.polkadot.network&#x2F;</a></div><br/></div></div></div></div><div id="42391886" class="c"><input type="checkbox" id="c-42391886" checked=""/><div class="controls bullet"><span class="by">ltbarcly3</span><span>|</span><a href="#42390490">prev</a><span>|</span><a href="#42391139">next</a><span>|</span><label class="collapse" for="c-42391886">[-]</label><label class="expand" for="c-42391886">[9 more]</label></div><br/><div class="children"><div class="content">This seems nice at first glance, but lets think about it for a minute:<p>Before: You had a .sql file and if you messed up you had to revert manually.  Maybe you would pre-write the revert script, maybe your site is down if you mess up.  It&#x27;s super easy to understand what is happening though.<p>Now: you use pgroll.  An absolute heaping ton of magic is happening behind the scenes.  Every table is replaced by a view and tables have tons of &#x27;secret&#x27; columns holding old data.  Every operation that made sense before (ALTER TABLE foo ADD COLUMN bar INTEGER NOT NULL) turns into some ugly json mess (look at the docs, it&#x27;s horrible) that then drops into the magic of pgroll to get turned into who knows what operations in the db, with the <i>PROMISE</i> that it can be reversed safely.  Since all software has bugs, pgroll has bugs.  When pgroll leaves you in a broken state, which it will sooner or later, you are just FUCKED.  You will have to reverse engineer all it&#x27;s complicated magic and try to get it back on the rails live.<p>You&#x27;re trading something you understand and is simple, but maybe not super convenient, for something that is magically convenient and which will eventually put a bullet in your head.  It&#x27;s a horrific product, don&#x27;t use it.</div><br/><div id="42392014" class="c"><input type="checkbox" id="c-42392014" checked=""/><div class="controls bullet"><span class="by">erulabs</span><span>|</span><a href="#42391886">parent</a><span>|</span><a href="#42392366">next</a><span>|</span><label class="collapse" for="c-42392014">[-]</label><label class="expand" for="c-42392014">[6 more]</label></div><br/><div class="children"><div class="content">What is good for the goose is not necessarily good for the gander.<p>Obviously for startups, you&#x27;re 100% right. Just announce a brief downtime and&#x2F;or do migrations after-hours. Keep it simple, no one will care if their requests timeout once every week for 30 seconds.<p>If your company has hundreds of developers making changes across every timezone and downtime (or developers being blocked waiting for scheduled merge windows) costs real money or creates real problems other than optics, something like this or Vitess (MySQL) is definitely worth it.<p>Engineering should not be a &quot;one-size-fits-all&quot; type of job, and while I do love postgres, my main gripe with the community is that the &quot;keep it simple stupid&quot; mentality persists well beyond its sell-by date in many cases.</div><br/><div id="42392970" class="c"><input type="checkbox" id="c-42392970" checked=""/><div class="controls bullet"><span class="by">emmelaich</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42392014">parent</a><span>|</span><a href="#42392166">next</a><span>|</span><label class="collapse" for="c-42392970">[-]</label><label class="expand" for="c-42392970">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve found in practice, over many years in many industries that downtime is actually much easier to schedule and makes many things far far easier.</div><br/></div></div><div id="42392166" class="c"><input type="checkbox" id="c-42392166" checked=""/><div class="controls bullet"><span class="by">ltbarcly3</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42392014">parent</a><span>|</span><a href="#42392970">prev</a><span>|</span><a href="#42392366">next</a><span>|</span><label class="collapse" for="c-42392166">[-]</label><label class="expand" for="c-42392166">[4 more]</label></div><br/><div class="children"><div class="content">The bigger and more important your company is, the less you should rely on a tool like this.  You have more budget to invest in operations and less tolerance for being down for 3 days when a tool like this has a bug that takes your site down.  You should hire DBA&#x27;s and operations staff that understand how to apply db migrations in a safe way, and have them review them before and&#x2F;or apply them during deployments.  It&#x27;s not hard to do manually, just a little bit of extra work (not that much extra).  With a little bit of feedback engineers will learn the basics of how to write migrations that are safe and then the use case for this product is dramatically reduced anyway.<p>You keep things simple because you need to be able to understand what is going on to work with it later.  pgroll is inherently complex and poorly designed, but even if it wasn&#x27;t it is still bad to use something that you can&#x27;t reasonably correct the problems it causes when it breaks.</div><br/><div id="42392555" class="c"><input type="checkbox" id="c-42392555" checked=""/><div class="controls bullet"><span class="by">erulabs</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42392166">parent</a><span>|</span><a href="#42392366">next</a><span>|</span><label class="collapse" for="c-42392555">[-]</label><label class="expand" for="c-42392555">[3 more]</label></div><br/><div class="children"><div class="content">You may be right about pgroll specifically, I haven&#x27;t looked at it closely. However, you can&#x27;t really say &quot;just do db migrations in a safe way&quot;. The way your DBA staff would &quot;apply migrations safely&quot; would be to use ghost-tables and views and triggers and locks - ie: they would write pt-online-schema-change or gh-ost or VReplication or, well, pgroll. These tools were <i>born</i> at places like Facebook or Github by the team responsible for applying migrations safely.<p>The argument that &quot;all software has bugs&quot; applies to both the database itself as well as the software you&#x27;re writing on top. Hence why &quot;reversible&quot; is the 2nd selling-point here.</div><br/><div id="42395970" class="c"><input type="checkbox" id="c-42395970" checked=""/><div class="controls bullet"><span class="by">thayne</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42392555">parent</a><span>|</span><a href="#42392366">next</a><span>|</span><label class="collapse" for="c-42395970">[-]</label><label class="expand" for="c-42395970">[2 more]</label></div><br/><div class="children"><div class="content">And if you don&#x27;t use a tool like that (whether off the shelf, or home built), then your DBAs will be a bottleneck to any schema changes, which will lead to them being overworked and stressed, which will lead to them making more mistakes.</div><br/><div id="42396220" class="c"><input type="checkbox" id="c-42396220" checked=""/><div class="controls bullet"><span class="by">ltbarcly3</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42395970">parent</a><span>|</span><a href="#42392366">next</a><span>|</span><label class="collapse" for="c-42396220">[-]</label><label class="expand" for="c-42396220">[1 more]</label></div><br/><div class="children"><div class="content">I think you are way out of your realm of experience here.<p>Nope, schema changes are not that common compared to other tasks and will only account for a small fraction of your DBA&#x27;s day.  I can say this from copious (over 20 years) experience.<p>They will make FAR fewer mistakes than some random engineer.  It takes less time (like a fraction, 1&#x2F;20 or less) to validate and give feedback on schema changes than it does to untangle the mess that gets made otherwise, restore data from backups, go to meetings to explain outages to executives, etc etc so if you want to keep your DBA&#x27;s happy and able to sign out of work at a reasonable hour, make sure they get to approve schema changes before they go out.  Not to mention that very few engineers have a good understanding of schema design or how to write performant schemas, how to index data, etc.  Getting a good migration the first time is just so much less painful and time consuming than trying to deal with bad ones.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="42392366" class="c"><input type="checkbox" id="c-42392366" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42391886">parent</a><span>|</span><a href="#42392014">prev</a><span>|</span><a href="#42391139">next</a><span>|</span><label class="collapse" for="c-42392366">[-]</label><label class="expand" for="c-42392366">[2 more]</label></div><br/><div class="children"><div class="content">I think it is fair criticism that this adds complexity. However, I do have a couple of counter-arguments:<p>In order to avoid downtime and locking, you generally need multiple steps (e.g. some variation of add another column, backfill the data, remove previous column). You can codify this in long guidebooks on how to do schema changes (for example this one from gitlab [1]). You also need to orchestrate your app deployments in between those steps, and you often need to have some backwards compatibility code.<p>This is all fine but: 1. it slows you down and 2. it&#x27;s manual and error prone. With pgroll, the process is always the same (start pgroll migration, deploy code, complete&#x2F;rollback migration) so the team can exercise it often.<p>Second, while any software has bugs, it&#x27;s worth noting that the main reason roll-ing back is quick and safe with pgroll is that it only has to drop views and any hidden columns. While the physical schema is changed, it is in a backwards compatible way until with complete the migration, so you can always skip the views if you have to bypass whatever pgroll is doing.<p>[1]: <a href="https:&#x2F;&#x2F;docs.gitlab.com&#x2F;ee&#x2F;development&#x2F;migration_style_guide.html#choose-an-appropriate-migration-type" rel="nofollow">https:&#x2F;&#x2F;docs.gitlab.com&#x2F;ee&#x2F;development&#x2F;migration_style_guide...</a></div><br/><div id="42392464" class="c"><input type="checkbox" id="c-42392464" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#42391886">root</a><span>|</span><a href="#42392366">parent</a><span>|</span><a href="#42391139">next</a><span>|</span><label class="collapse" for="c-42392464">[-]</label><label class="expand" for="c-42392464">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t necessarily see friction as a bad thing. I had to explain a lot at my last job that yeah, we did in fact do a whole bunch of work to smooth out a process. Why are we &quot;only&quot; seeing a 70% reduction in error rate per unit time? Well that&#x27;s because we&#x27;re using the process 3x as much now. We reduced errors by 10x which makes people more likely to use the process. Supply and demand.<p>A bit of friction on tasks that can result in massive problems can cause people to tap the brakes a bit.</div><br/></div></div></div></div></div></div><div id="42391139" class="c"><input type="checkbox" id="c-42391139" checked=""/><div class="controls bullet"><span class="by">Dinux</span><span>|</span><a href="#42391886">prev</a><span>|</span><label class="collapse" for="c-42391139">[-]</label><label class="expand" for="c-42391139">[2 more]</label></div><br/><div class="children"><div class="content">Is this related to supabase? There seems to be a link?</div><br/><div id="42391198" class="c"><input type="checkbox" id="c-42391198" checked=""/><div class="controls bullet"><span class="by">tudorg</span><span>|</span><a href="#42391139">parent</a><span>|</span><label class="collapse" for="c-42391198">[-]</label><label class="expand" for="c-42391198">[1 more]</label></div><br/><div class="children"><div class="content">Actually no, this is a project by Xata. What link do you mean?</div><br/></div></div></div></div></div></div></div></div></div></body></html>