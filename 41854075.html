<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1729069267399" as="style"/><link rel="stylesheet" href="styles.css?v=1729069267399"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.daemonology.net/freebsd-ec2-boot-performance/">FreeBSD/EC2 boot performance over time</a> <span class="domain">(<a href="https://www.daemonology.net">www.daemonology.net</a>)</span></div><div class="subtext"><span>cperciva</span> | <span>35 comments</span></div><br/><div><div id="41854307" class="c"><input type="checkbox" id="c-41854307" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#41855066">next</a><span>|</span><label class="collapse" for="c-41854307">[-]</label><label class="expand" for="c-41854307">[2 more]</label></div><br/><div class="children"><div class="content">Presumably seconds since I&#x27;m not sure what else would make sense here. It&#x27;d also be helpful if the y axis had consistent scale between each graph and horizontal lines are set y axis intervals<p>Seems zfs is quite a bit faster than ufs</div><br/><div id="41854419" class="c"><input type="checkbox" id="c-41854419" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854307">parent</a><span>|</span><a href="#41855066">next</a><span>|</span><label class="collapse" for="c-41854419">[-]</label><label class="expand" for="c-41854419">[1 more]</label></div><br/><div class="children"><div class="content">The different X axes are because I figured there&#x27;s no point having a bunch of graphs which are 90% empty.  For a long time we only had base&#x2F;UFS images.  (Even arm64 came a few years later than amd64.)</div><br/></div></div></div></div><div id="41855066" class="c"><input type="checkbox" id="c-41855066" checked=""/><div class="controls bullet"><span class="by">bas</span><span>|</span><a href="#41854307">prev</a><span>|</span><a href="#41854273">next</a><span>|</span><label class="collapse" for="c-41855066">[-]</label><label class="expand" for="c-41855066">[1 more]</label></div><br/><div class="children"><div class="content">Your FreeBSD on AWS work is appreciated, @cperciva.</div><br/></div></div><div id="41854273" class="c"><input type="checkbox" id="c-41854273" checked=""/><div class="controls bullet"><span class="by">defrost</span><span>|</span><a href="#41855066">prev</a><span>|</span><a href="#41856369">next</a><span>|</span><label class="collapse" for="c-41854273">[-]</label><label class="expand" for="c-41854273">[11 more]</label></div><br/><div class="children"><div class="content">That&#x27;s an impressive drop from 30 minutes in 2019 to under 10 minutes today.<p>No, wait .. maybe that&#x27;s seconds? milliseconds?</div><br/><div id="41854404" class="c"><input type="checkbox" id="c-41854404" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854273">parent</a><span>|</span><a href="#41854317">next</a><span>|</span><label class="collapse" for="c-41854404">[-]</label><label class="expand" for="c-41854404">[9 more]</label></div><br/><div class="children"><div class="content">Seconds, yes.  Sorry I figured that was obvious, I&#x27;ll add it to the graphs I generate next week.</div><br/><div id="41854917" class="c"><input type="checkbox" id="c-41854917" checked=""/><div class="controls bullet"><span class="by">amiga386</span><span>|</span><a href="#41854273">root</a><span>|</span><a href="#41854404">parent</a><span>|</span><a href="#41854839">next</a><span>|</span><label class="collapse" for="c-41854917">[-]</label><label class="expand" for="c-41854917">[3 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re taking requests, then can the Y axis start at zero, please?<p><a href="https:&#x2F;&#x2F;handsondataviz.org&#x2F;images&#x2F;14-detect&#x2F;gdp-baseline-merged-annotated.png" rel="nofollow">https:&#x2F;&#x2F;handsondataviz.org&#x2F;images&#x2F;14-detect&#x2F;gdp-baseline-mer...</a><p>And what is going on with that Y axis? There is no consistent spacing between the marks!<p><a href="https:&#x2F;&#x2F;imgur.com&#x2F;HaJmTSU" rel="nofollow">https:&#x2F;&#x2F;imgur.com&#x2F;HaJmTSU</a></div><br/><div id="41854967" class="c"><input type="checkbox" id="c-41854967" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854273">root</a><span>|</span><a href="#41854917">parent</a><span>|</span><a href="#41854839">next</a><span>|</span><label class="collapse" for="c-41854967">[-]</label><label class="expand" for="c-41854967">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a bit hard for a log axis to start at zero.</div><br/><div id="41855076" class="c"><input type="checkbox" id="c-41855076" checked=""/><div class="controls bullet"><span class="by">amiga386</span><span>|</span><a href="#41854273">root</a><span>|</span><a href="#41854967">parent</a><span>|</span><a href="#41854839">next</a><span>|</span><label class="collapse" for="c-41855076">[-]</label><label class="expand" for="c-41855076">[1 more]</label></div><br/><div class="children"><div class="content">Well start it at 0.00001 then. There&#x27;s no need for a log axis, as all the values are within 2 orders of magnitude of each other - between 1 and 100. They will fit better, and will no longer be distorted, on a linear Y axis starting from zero.</div><br/></div></div></div></div></div></div><div id="41854839" class="c"><input type="checkbox" id="c-41854839" checked=""/><div class="controls bullet"><span class="by">defrost</span><span>|</span><a href="#41854273">root</a><span>|</span><a href="#41854404">parent</a><span>|</span><a href="#41854917">prev</a><span>|</span><a href="#41854511">next</a><span>|</span><label class="collapse" for="c-41854839">[-]</label><label class="expand" for="c-41854839">[4 more]</label></div><br/><div class="children"><div class="content">Good to hear.<p>Seconds was my best <i>guess</i> .. but that doesn&#x27;t make it certain for the viewer.<p>No real drama, but FWiW I&#x27;ve looked at a <i>lot</i> of data across engineering, math, geophysics, mining, energy, etc and unlabeled data and graphs are a major annoyance.</div><br/></div></div><div id="41854511" class="c"><input type="checkbox" id="c-41854511" checked=""/><div class="controls bullet"><span class="by">pushupentry1219</span><span>|</span><a href="#41854273">root</a><span>|</span><a href="#41854404">parent</a><span>|</span><a href="#41854839">prev</a><span>|</span><a href="#41854317">next</a><span>|</span><label class="collapse" for="c-41854511">[-]</label><label class="expand" for="c-41854511">[1 more]</label></div><br/><div class="children"><div class="content">Thank you! Was about to ask for axis labels as well. I assumed seconds but I had some doubts because there were no labels!</div><br/></div></div></div></div><div id="41854317" class="c"><input type="checkbox" id="c-41854317" checked=""/><div class="controls bullet"><span class="by">spease</span><span>|</span><a href="#41854273">parent</a><span>|</span><a href="#41854404">prev</a><span>|</span><a href="#41856369">next</a><span>|</span><label class="collapse" for="c-41854317">[-]</label><label class="expand" for="c-41854317">[1 more]</label></div><br/><div class="children"><div class="content">Microts!</div><br/></div></div></div></div><div id="41856369" class="c"><input type="checkbox" id="c-41856369" checked=""/><div class="controls bullet"><span class="by">alexellisuk</span><span>|</span><a href="#41854273">prev</a><span>|</span><a href="#41856329">next</a><span>|</span><label class="collapse" for="c-41856369">[-]</label><label class="expand" for="c-41856369">[2 more]</label></div><br/><div class="children"><div class="content">Nice improvements in boot speed. Perhaps a little blurb &#x2F; intro &#x2F; summary would be helpful to the post to help with understanding the achievements made.<p>Did the patches ever make it into Firecracker for booting FreeBSD as a guest? I looked back at the paper trail and it seemed like it may have stalled.<p>Does anyone know?</div><br/><div id="41856554" class="c"><input type="checkbox" id="c-41856554" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41856369">parent</a><span>|</span><a href="#41856329">next</a><span>|</span><label class="collapse" for="c-41856554">[-]</label><label class="expand" for="c-41856554">[1 more]</label></div><br/><div class="children"><div class="content">Things stalled; there were a couple outstanding bugs (one I know has now been fixed, not sure about the other) and I had to take over FreeBSD release engineering and didn&#x27;t have time to follow up on the Firecracker bits.<p>I understand that NetBSD can boot in Firecracker using the same patches so I&#x27;m hoping they can resolve any remaining issues and prod the Firecracker developers into merging things.</div><br/></div></div></div></div><div id="41856329" class="c"><input type="checkbox" id="c-41856329" checked=""/><div class="controls bullet"><span class="by">Temporary_31337</span><span>|</span><a href="#41856369">prev</a><span>|</span><a href="#41854603">next</a><span>|</span><label class="collapse" for="c-41856329">[-]</label><label class="expand" for="c-41856329">[2 more]</label></div><br/><div class="children"><div class="content">That suits our deployments where for HA we simply terminate and replace unresponsive EC2 nodes with new ones. I’ll have to talk to other developers to see how much work would it be to compile to freebsd instead of Linux</div><br/><div id="41856934" class="c"><input type="checkbox" id="c-41856934" checked=""/><div class="controls bullet"><span class="by">wilted-iris</span><span>|</span><a href="#41856329">parent</a><span>|</span><a href="#41854603">next</a><span>|</span><label class="collapse" for="c-41856934">[-]</label><label class="expand" for="c-41856934">[1 more]</label></div><br/><div class="children"><div class="content">Linux probably boots faster fwiw. As a starting point, see this bench: <a href="https:&#x2F;&#x2F;www.daemonology.net&#x2F;blog&#x2F;2021-08-12-EC2-boot-time-benchmarking.html" rel="nofollow">https:&#x2F;&#x2F;www.daemonology.net&#x2F;blog&#x2F;2021-08-12-EC2-boot-time-be...</a></div><br/></div></div></div></div><div id="41854603" class="c"><input type="checkbox" id="c-41854603" checked=""/><div class="controls bullet"><span class="by">AdieuToLogic</span><span>|</span><a href="#41856329">prev</a><span>|</span><a href="#41854427">next</a><span>|</span><label class="collapse" for="c-41854603">[-]</label><label class="expand" for="c-41854603">[5 more]</label></div><br/><div class="children"><div class="content">Is there an architectural change and&#x2F;or approach to which the boot performance increase(s) can be attributed?<p>If not, which is understandable, is there something specific to <i>stable&#x2F;14</i> for interested parties to familiarize themselves with?</div><br/><div id="41854659" class="c"><input type="checkbox" id="c-41854659" checked=""/><div class="controls bullet"><span class="by">cbhl</span><span>|</span><a href="#41854603">parent</a><span>|</span><a href="#41854798">next</a><span>|</span><label class="collapse" for="c-41854659">[-]</label><label class="expand" for="c-41854659">[3 more]</label></div><br/><div class="children"><div class="content">My impression is that cperciva has been working on FreeBSD&#x2F;EC2 boot times for the last six years, not just specifically some changes in 14.<p>The most accessible summary of his work is probably on his Patreon: <a href="https:&#x2F;&#x2F;www.patreon.com&#x2F;c&#x2F;cperciva&#x2F;posts" rel="nofollow">https:&#x2F;&#x2F;www.patreon.com&#x2F;c&#x2F;cperciva&#x2F;posts</a>. If you go digging there are also some anecdotes on his Twitter too; most recent I can find is <a href="https:&#x2F;&#x2F;x.com&#x2F;cperciva&#x2F;status&#x2F;1833735559614988526" rel="nofollow">https:&#x2F;&#x2F;x.com&#x2F;cperciva&#x2F;status&#x2F;1833735559614988526</a></div><br/><div id="41854792" class="c"><input type="checkbox" id="c-41854792" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854603">root</a><span>|</span><a href="#41854659">parent</a><span>|</span><a href="#41854798">next</a><span>|</span><label class="collapse" for="c-41854792">[-]</label><label class="expand" for="c-41854792">[2 more]</label></div><br/><div class="children"><div class="content">I gave a talk at BSDCan 2022 about this (&quot;speeding up the FreeBSD boot&quot;) -- I&#x27;m on my phone right now so I can&#x27;t provide a link but it&#x27;s on YouTube.<p>There&#x27;s also a somewhat out of date summary of most of the work on the FreeBSD wiki: <a href="https:&#x2F;&#x2F;wiki.freebsd.org&#x2F;BootTime" rel="nofollow">https:&#x2F;&#x2F;wiki.freebsd.org&#x2F;BootTime</a></div><br/><div id="41856949" class="c"><input type="checkbox" id="c-41856949" checked=""/><div class="controls bullet"><span class="by">homebrewer</span><span>|</span><a href="#41854603">root</a><span>|</span><a href="#41854792">parent</a><span>|</span><a href="#41854798">next</a><span>|</span><label class="collapse" for="c-41856949">[-]</label><label class="expand" for="c-41856949">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=10XRCiBtyhA" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=10XRCiBtyhA</a></div><br/></div></div></div></div></div></div><div id="41854798" class="c"><input type="checkbox" id="c-41854798" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854603">parent</a><span>|</span><a href="#41854659">prev</a><span>|</span><a href="#41854427">next</a><span>|</span><label class="collapse" for="c-41854798">[-]</label><label class="expand" for="c-41854798">[1 more]</label></div><br/><div class="children"><div class="content">The best summary I can provide is &quot;profiling and lots of small wins&quot;.</div><br/></div></div></div></div><div id="41854427" class="c"><input type="checkbox" id="c-41854427" checked=""/><div class="controls bullet"><span class="by">silisili</span><span>|</span><a href="#41854603">prev</a><span>|</span><a href="#41854345">next</a><span>|</span><label class="collapse" for="c-41854427">[-]</label><label class="expand" for="c-41854427">[5 more]</label></div><br/><div class="children"><div class="content">Would be nice to see how this compares to Linux, I think, for perspective.</div><br/><div id="41854453" class="c"><input type="checkbox" id="c-41854453" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854427">parent</a><span>|</span><a href="#41854345">next</a><span>|</span><label class="collapse" for="c-41854453">[-]</label><label class="expand" for="c-41854453">[4 more]</label></div><br/><div class="children"><div class="content">I did that comparison a few years ago: <a href="https:&#x2F;&#x2F;www.daemonology.net&#x2F;blog&#x2F;2021-08-12-EC2-boot-time-benchmarking.html" rel="nofollow">https:&#x2F;&#x2F;www.daemonology.net&#x2F;blog&#x2F;2021-08-12-EC2-boot-time-be...</a><p>Re-running the comparison with Linux AMIs from 2024 is on my to-do list.</div><br/><div id="41855348" class="c"><input type="checkbox" id="c-41855348" checked=""/><div class="controls bullet"><span class="by">andai</span><span>|</span><a href="#41854427">root</a><span>|</span><a href="#41854453">parent</a><span>|</span><a href="#41854345">next</a><span>|</span><label class="collapse" for="c-41855348">[-]</label><label class="expand" for="c-41855348">[3 more]</label></div><br/><div class="children"><div class="content">Dang, Clear Linux boots in one second? How is it ten times faster?</div><br/><div id="41856971" class="c"><input type="checkbox" id="c-41856971" checked=""/><div class="controls bullet"><span class="by">homebrewer</span><span>|</span><a href="#41854427">root</a><span>|</span><a href="#41855348">parent</a><span>|</span><a href="#41855641">next</a><span>|</span><label class="collapse" for="c-41856971">[-]</label><label class="expand" for="c-41856971">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s been possible for a long time:<p><a href="https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;299483" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;299483</a></div><br/></div></div><div id="41855641" class="c"><input type="checkbox" id="c-41855641" checked=""/><div class="controls bullet"><span class="by">transpute</span><span>|</span><a href="#41854427">root</a><span>|</span><a href="#41855348">parent</a><span>|</span><a href="#41856971">prev</a><span>|</span><a href="#41854345">next</a><span>|</span><label class="collapse" for="c-41855641">[-]</label><label class="expand" for="c-41855641">[1 more]</label></div><br/><div class="children"><div class="content">Optimized for automotive use case (max 2s to enable rear camera), <a href="https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Clear-Linux-Kernel-3s-to-300ms" rel="nofollow">https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Clear-Linux-Kernel-3s-to-300ms</a><p><i>&gt; They started out with around a three second kernel boot time but cut it down to just 300 ms. Among the optimizations carried out to really speed-up their boot time were ensuring more asynchronous driver probing, only initializing a small amount of RAM at start and then after booted hot-plug the rest of it in parallel via systemd, optimized root file-system mounting, disabling unnecessary kernel modules, and similar approaches. Moving forward they are still looking at optimizations for the boot process around in-kernel deferred memory initialization, SMP initialization changes, ACPI tweaking, and user-space&#x2F;systemd optimizations.</i></div><br/></div></div></div></div></div></div></div></div><div id="41854345" class="c"><input type="checkbox" id="c-41854345" checked=""/><div class="controls bullet"><span class="by">nostrebored</span><span>|</span><a href="#41854427">prev</a><span>|</span><a href="#41854270">next</a><span>|</span><label class="collapse" for="c-41854345">[-]</label><label class="expand" for="c-41854345">[2 more]</label></div><br/><div class="children"><div class="content">Fixing instance types was probably wrong.<p>You’re getting progressively legacy (and more likely to be degraded) hardware. This impacts how tightly packed the instance type as a whole is, which impacts launch instance performance</div><br/><div id="41854446" class="c"><input type="checkbox" id="c-41854446" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854345">parent</a><span>|</span><a href="#41854270">next</a><span>|</span><label class="collapse" for="c-41854446">[-]</label><label class="expand" for="c-41854446">[1 more]</label></div><br/><div class="children"><div class="content"><i>Fixing instance types was probably wrong.</i><p>Depends what you&#x27;re trying to measure, I think?  My goal as a FreeBSD developer is to look at FreeBSD performance -- this is both to show the improvements which have been made over the years and to alert me to any performance regressions (I generate these graphs automatically when I build the weekly snapshots).<p>If you want to compare EC2 to other clouds you would definitely want to use the latest instance generation, of course.</div><br/></div></div></div></div><div id="41854270" class="c"><input type="checkbox" id="c-41854270" checked=""/><div class="controls bullet"><span class="by">wadefletch</span><span>|</span><a href="#41854345">prev</a><span>|</span><a href="#41854324">next</a><span>|</span><label class="collapse" for="c-41854270">[-]</label><label class="expand" for="c-41854270">[2 more]</label></div><br/><div class="children"><div class="content">What are the y-axis units?</div><br/><div id="41854298" class="c"><input type="checkbox" id="c-41854298" checked=""/><div class="controls bullet"><span class="by">NekkoDroid</span><span>|</span><a href="#41854270">parent</a><span>|</span><a href="#41854324">next</a><span>|</span><label class="collapse" for="c-41854298">[-]</label><label class="expand" for="c-41854298">[1 more]</label></div><br/><div class="children"><div class="content">I would guess hamburgers eaten :)<p>On a more serious note, the only thing that really makes sense would be seconds.</div><br/></div></div></div></div><div id="41854324" class="c"><input type="checkbox" id="c-41854324" checked=""/><div class="controls bullet"><span class="by">pluto_modadic</span><span>|</span><a href="#41854270">prev</a><span>|</span><label class="collapse" for="c-41854324">[-]</label><label class="expand" for="c-41854324">[2 more]</label></div><br/><div class="children"><div class="content">wow they make it impressively hard to contact them.</div><br/><div id="41854424" class="c"><input type="checkbox" id="c-41854424" checked=""/><div class="controls bullet"><span class="by">cperciva</span><span>|</span><a href="#41854324">parent</a><span>|</span><label class="collapse" for="c-41854424">[-]</label><label class="expand" for="c-41854424">[1 more]</label></div><br/><div class="children"><div class="content">me @FreeBSD.org.  I figured most people reading this would know who I am.</div><br/></div></div></div></div></div></div></div></div></div></body></html>