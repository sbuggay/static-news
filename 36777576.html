<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689757254306" as="style"/><link rel="stylesheet" href="styles.css?v=1689757254306"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://pdos.csail.mit.edu/~baford/vm/">Vx32: Portable, efficient, safe user-space execution of untrusted x86 code (2008)</a> <span class="domain">(<a href="https://pdos.csail.mit.edu">pdos.csail.mit.edu</a>)</span></div><div class="subtext"><span>nateb2022</span> | <span>22 comments</span></div><br/><div><div id="36778705" class="c"><input type="checkbox" id="c-36778705" checked=""/><div class="controls bullet"><span class="by">nneonneo</span><span>|</span><a href="#36780460">next</a><span>|</span><label class="collapse" for="c-36778705">[-]</label><label class="expand" for="c-36778705">[2 more]</label></div><br/><div class="children"><div class="content">Also see Unicorn (<a href="https:&#x2F;&#x2F;www.unicorn-engine.org&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.unicorn-engine.org&#x2F;</a>), a QEMU-based emulator-as-a-library that handles a wide range of processors (ARM, AArch64, x86, x64, PowerPC, MIPS, SPARC, …) and comes with bindings for many popular languages (C, Python, Rust, Java, …).<p>Unicorn is used quite widely for reverse engineering and malware analysis; the Qiling project (<a href="https:&#x2F;&#x2F;qiling.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;qiling.io&#x2F;</a>) extends it to OS-level emulation.</div><br/><div id="36780405" class="c"><input type="checkbox" id="c-36780405" checked=""/><div class="controls bullet"><span class="by">nerpderp82</span><span>|</span><a href="#36778705">parent</a><span>|</span><a href="#36780460">next</a><span>|</span><label class="collapse" for="c-36780405">[-]</label><label class="expand" for="c-36780405">[1 more]</label></div><br/><div class="children"><div class="content">I was <i>just</i> looking for QEMU as a library, thank you!</div><br/></div></div></div></div><div id="36780460" class="c"><input type="checkbox" id="c-36780460" checked=""/><div class="controls bullet"><span class="by">nerpderp82</span><span>|</span><a href="#36778705">prev</a><span>|</span><a href="#36779073">next</a><span>|</span><label class="collapse" for="c-36780460">[-]</label><label class="expand" for="c-36780460">[1 more]</label></div><br/><div class="children"><div class="content">BTW, VX32 is paying homage to <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;FX!32" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;FX!32</a> the first ground breaking binary translation tool that allowed x86 binaries to run on Alpha (at faster than x86 speeds).</div><br/></div></div><div id="36779073" class="c"><input type="checkbox" id="c-36779073" checked=""/><div class="controls bullet"><span class="by">Karliss</span><span>|</span><a href="#36780460">prev</a><span>|</span><a href="#36778801">next</a><span>|</span><label class="collapse" for="c-36779073">[-]</label><label class="expand" for="c-36779073">[4 more]</label></div><br/><div class="children"><div class="content">I guess at this point same process native code sandboxing approaches like Vx32 and NaCl are more or less dead due to the various speculative execution attacks that came up in the recent few years.</div><br/><div id="36782940" class="c"><input type="checkbox" id="c-36782940" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36779073">parent</a><span>|</span><a href="#36781709">next</a><span>|</span><label class="collapse" for="c-36782940">[-]</label><label class="expand" for="c-36782940">[1 more]</label></div><br/><div class="children"><div class="content">Same applies to WASM, regardless of the security sales pitch.</div><br/></div></div><div id="36781709" class="c"><input type="checkbox" id="c-36781709" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36779073">parent</a><span>|</span><a href="#36782940">prev</a><span>|</span><a href="#36778801">next</a><span>|</span><label class="collapse" for="c-36781709">[-]</label><label class="expand" for="c-36781709">[2 more]</label></div><br/><div class="children"><div class="content">You can take the same approach as browsers: block the guest from using high-precision timing functions.</div><br/><div id="36783049" class="c"><input type="checkbox" id="c-36783049" checked=""/><div class="controls bullet"><span class="by">rwmj</span><span>|</span><a href="#36779073">root</a><span>|</span><a href="#36781709">parent</a><span>|</span><a href="#36778801">next</a><span>|</span><label class="collapse" for="c-36783049">[-]</label><label class="expand" for="c-36783049">[1 more]</label></div><br/><div class="children"><div class="content">Can&#x27;t you synthesize these from simple loops, especially if the untrusted code is able to use threads?</div><br/></div></div></div></div></div></div><div id="36778801" class="c"><input type="checkbox" id="c-36778801" checked=""/><div class="controls bullet"><span class="by">pizlonator</span><span>|</span><a href="#36779073">prev</a><span>|</span><a href="#36782151">next</a><span>|</span><label class="collapse" for="c-36778801">[-]</label><label class="expand" for="c-36778801">[2 more]</label></div><br/><div class="children"><div class="content">The link to the paper in that page doesn’t work but I found it here: <a href="https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;vx32:usenix08.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;vx32:usenix08.pdf</a><p>Very cool technique, but I’m not enough of a DBT expert to judge how significant it is compared to the many many DBTs that folks have built before and since.</div><br/><div id="36781504" class="c"><input type="checkbox" id="c-36781504" checked=""/><div class="controls bullet"><span class="by">kragen</span><span>|</span><a href="#36778801">parent</a><span>|</span><a href="#36782151">next</a><span>|</span><label class="collapse" for="c-36781504">[-]</label><label class="expand" for="c-36781504">[1 more]</label></div><br/><div class="children"><div class="content">guessing dbt means <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Binary_translation#Dynamic_binary_translation" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Binary_translation#Dynamic_bin...</a></div><br/></div></div></div></div><div id="36782151" class="c"><input type="checkbox" id="c-36782151" checked=""/><div class="controls bullet"><span class="by">fsmv</span><span>|</span><a href="#36778801">prev</a><span>|</span><a href="#36781128">next</a><span>|</span><label class="collapse" for="c-36782151">[-]</label><label class="expand" for="c-36782151">[1 more]</label></div><br/><div class="children"><div class="content">From [the slides](<a href="https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;vxa:fast05-slides.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;pdos.csail.mit.edu&#x2F;papers&#x2F;vxa:fast05-slides.pdf</a>) it sounds like what they do is rewrite the code so syscall call into the vx32 runtime library instead and this prevents all syscalls except for the small handful they support. That in addition to memory sandboxing.<p>So it doesn&#x27;t really just run any random untrusted code, it has to be prepared to work with their sandboxing.<p>The main purpose of this is being a self extracting archive not running untrusted code.</div><br/></div></div><div id="36781128" class="c"><input type="checkbox" id="c-36781128" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#36782151">prev</a><span>|</span><a href="#36778785">next</a><span>|</span><label class="collapse" for="c-36781128">[-]</label><label class="expand" for="c-36781128">[1 more]</label></div><br/><div class="children"><div class="content">Back in the day I put VX32 into a npapi plugin to run x86 code in-browser.  I was working with an XO-1 at the time.  It made for a decent flash-like-content experience without running at a crawl on the modest CPU.<p>I think I put it on google code, so I guess it&#x27;s gone now.  Then again so is npapi.</div><br/></div></div><div id="36778785" class="c"><input type="checkbox" id="c-36778785" checked=""/><div class="controls bullet"><span class="by">karmakaze</span><span>|</span><a href="#36781128">prev</a><span>|</span><a href="#36778212">next</a><span>|</span><label class="collapse" for="c-36778785">[-]</label><label class="expand" for="c-36778785">[2 more]</label></div><br/><div class="children"><div class="content">Ah. I can see how this might be useful for supporting a large library of plugins for various applications and industries.<p>&gt; Vx32 is similar in purpose to the Java or .NET virtual machines, but it runs native x86 code, so plug-ins can be written in ANY language, not just Java or C#.</div><br/><div id="36781714" class="c"><input type="checkbox" id="c-36781714" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36778785">parent</a><span>|</span><a href="#36778212">next</a><span>|</span><label class="collapse" for="c-36781714">[-]</label><label class="expand" for="c-36781714">[1 more]</label></div><br/><div class="children"><div class="content">That are many languages that can run on the JVM.</div><br/></div></div></div></div><div id="36778212" class="c"><input type="checkbox" id="c-36778212" checked=""/><div class="controls bullet"><span class="by">muricula</span><span>|</span><a href="#36778785">prev</a><span>|</span><a href="#36778093">next</a><span>|</span><label class="collapse" for="c-36778212">[-]</label><label class="expand" for="c-36778212">[3 more]</label></div><br/><div class="children"><div class="content">Was this the predecessor to Google Native Client?
<a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Google_Native_Client" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Google_Native_Client</a></div><br/><div id="36778915" class="c"><input type="checkbox" id="c-36778915" checked=""/><div class="controls bullet"><span class="by">Karliss</span><span>|</span><a href="#36778212">parent</a><span>|</span><a href="#36778725">next</a><span>|</span><label class="collapse" for="c-36778915">[-]</label><label class="expand" for="c-36778915">[1 more]</label></div><br/><div class="children"><div class="content">There are some similarities to the  32 bit x86 NaCL and one of the early NaCl paper mentions this. <a href="https:&#x2F;&#x2F;storage.googleapis.com&#x2F;pub-tools-public-publication-data&#x2F;pdf&#x2F;34913.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;storage.googleapis.com&#x2F;pub-tools-public-publication-...</a><p>They both use x86 memory segment functionality for limiting memory access, but seems like there are also plenty of things they do differently. And the x86_64 and ARM versions of NaCl are even more different, they can&#x27;t use the segment registers so they use masking instead.</div><br/></div></div><div id="36778725" class="c"><input type="checkbox" id="c-36778725" checked=""/><div class="controls bullet"><span class="by">redog</span><span>|</span><a href="#36778212">parent</a><span>|</span><a href="#36778915">prev</a><span>|</span><a href="#36778093">next</a><span>|</span><label class="collapse" for="c-36778725">[-]</label><label class="expand" for="c-36778725">[1 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t look like it: <a href="https:&#x2F;&#x2F;www.chromium.org&#x2F;nativeclient&#x2F;reference&#x2F;external-resource-directory&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.chromium.org&#x2F;nativeclient&#x2F;reference&#x2F;external-res...</a></div><br/></div></div></div></div><div id="36778093" class="c"><input type="checkbox" id="c-36778093" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#36778212">prev</a><span>|</span><a href="#36779565">next</a><span>|</span><label class="collapse" for="c-36778093">[-]</label><label class="expand" for="c-36778093">[1 more]</label></div><br/><div class="children"><div class="content">Super cool project; I think it&#x27;s kind of sad that it didn&#x27;t get picked up and become more popular. The Plan 9 port is particularly impressive, in my opinion:) (It would be interesting to compare that to User Mode Linux, come to think of it)</div><br/></div></div><div id="36779565" class="c"><input type="checkbox" id="c-36779565" checked=""/><div class="controls bullet"><span class="by">jgrahamc</span><span>|</span><a href="#36778093">prev</a><span>|</span><a href="#36778438">next</a><span>|</span><label class="collapse" for="c-36779565">[-]</label><label class="expand" for="c-36779565">[2 more]</label></div><br/><div class="children"><div class="content">Paging majke who used this a lot at Cloudflare at one point.</div><br/><div id="36783378" class="c"><input type="checkbox" id="c-36783378" checked=""/><div class="controls bullet"><span class="by">majke</span><span>|</span><a href="#36779565">parent</a><span>|</span><a href="#36778438">next</a><span>|</span><label class="collapse" for="c-36783378">[-]</label><label class="expand" for="c-36783378">[1 more]</label></div><br/><div class="children"><div class="content">I used vx32 as a technical demo before workers came to be. It was super useful.<p>However, vx32 itself is very much not production ready. There are issues with instruction decoding, floating point, and interrupt handling. (it uses itimer as a schedululer tick for preemption).<p>I think playing with vx32 is a great experience, taught me way more than all my systems programming classes at uni.<p>Vx32 was a predecessor to NaCL, and shared the same problems. Nowadays WASI seems to have taken this niche.</div><br/></div></div></div></div><div id="36778438" class="c"><input type="checkbox" id="c-36778438" checked=""/><div class="controls bullet"><span class="by">littlestymaar</span><span>|</span><a href="#36779565">prev</a><span>|</span><a href="#36779896">next</a><span>|</span><label class="collapse" for="c-36778438">[-]</label><label class="expand" for="c-36778438">[1 more]</label></div><br/><div class="children"><div class="content">(2008)</div><br/></div></div></div></div></div></div></div></body></html>