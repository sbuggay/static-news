<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1695546059968" as="style"/><link rel="stylesheet" href="styles.css?v=1695546059968"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://flak.tedunangst.com/post/www-which-wasm-works">Www which WASM works</a> <span class="domain">(<a href="https://flak.tedunangst.com">flak.tedunangst.com</a>)</span></div><div class="subtext"><span>2bluesc</span> | <span>32 comments</span></div><br/><div><div id="37629619" class="c"><input type="checkbox" id="c-37629619" checked=""/><div class="controls bullet"><span class="by">AgentME</span><span>|</span><a href="#37629580">next</a><span>|</span><label class="collapse" for="c-37629619">[-]</label><label class="expand" for="c-37629619">[3 more]</label></div><br/><div class="children"><div class="content">Anything built with emscripten expects the emscripten runtime to be provided for those imports. The default output of emscripten isn&#x27;t a WASM file that&#x27;s meant to be used on its own, but a WASM file plus a JS file that sets up the runtime. It looks like they&#x27;re trying to use the WASM file on its own and running into the problems that come from that.<p>Standards like WASI are meant to define a common runtime for WASM modules. A WASM module built for WASI would fit the author&#x27;s expectations better (as they could possibly find an all-in-one WASM+WASI library or attach a WASI implementation to a WASM library to run the WASM file), though I don&#x27;t know anything about emscripten and WASI compatibility.<p>Edit: You can use the STANDALONE_WASM emscripten option to make it not depend on the emscripten runtime and use WASI instead. This is what the author should use.</div><br/><div id="37631030" class="c"><input type="checkbox" id="c-37631030" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#37629619">parent</a><span>|</span><a href="#37629580">next</a><span>|</span><label class="collapse" for="c-37631030">[-]</label><label class="expand" for="c-37631030">[2 more]</label></div><br/><div class="children"><div class="content">The problem is that the instructions for actually running the WASM file are not that clear... the docs the author mentions shows how to compile to WASM, which is easy enough, but then here&#x27;s the instructions to make that actually work in the browser:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;libjxl&#x2F;libjxl&#x2F;blob&#x2F;main&#x2F;tools&#x2F;wasm_demo&#x2F;README.md">https:&#x2F;&#x2F;github.com&#x2F;libjxl&#x2F;libjxl&#x2F;blob&#x2F;main&#x2F;tools&#x2F;wasm_demo&#x2F;R...</a><p>Yeah, you need some mysterious Python script, a JS service worker at runtime, choose whether you want the WASM or WASM_SIMD target, use a browser that supports Threads and SIMD if you chose that, make sure to serve everything with the appropriate custom HTTP headers... just reading that, I can see that to get this stuff working on non-browser WASM targets would likely require expertise in WASM, which is the point of the OP. WASM&#x27;s UX is just not there yet.</div><br/><div id="37631262" class="c"><input type="checkbox" id="c-37631262" checked=""/><div class="controls bullet"><span class="by">meheleventyone</span><span>|</span><a href="#37629619">root</a><span>|</span><a href="#37631030">parent</a><span>|</span><a href="#37629580">next</a><span>|</span><label class="collapse" for="c-37631262">[-]</label><label class="expand" for="c-37631262">[1 more]</label></div><br/><div class="children"><div class="content">Most of the stuff there has nothing to do with WASM itself though. Loading an running a WASM module is very simple. In this case it’s mostly web craziness like bundling and the hoops you have to jump through to enable some features post-spectre mitigations. Then seemingly that the go runtimes suck.</div><br/></div></div></div></div></div></div><div id="37629580" class="c"><input type="checkbox" id="c-37629580" checked=""/><div class="controls bullet"><span class="by">Conlectus</span><span>|</span><a href="#37629619">prev</a><span>|</span><a href="#37629685">next</a><span>|</span><label class="collapse" for="c-37629580">[-]</label><label class="expand" for="c-37629580">[1 more]</label></div><br/><div class="children"><div class="content">From what I can tell the issue here is that the author has produced a WASM module with minified dynamic dependencies. This is not an issue with the runtimes but with the earlier compilation toolchain.<p>In another thread it was suggested that Emscripten was used, but its runtime wasn’t provided.</div><br/></div></div><div id="37629685" class="c"><input type="checkbox" id="c-37629685" checked=""/><div class="controls bullet"><span class="by">evmar</span><span>|</span><a href="#37629580">prev</a><span>|</span><a href="#37629437">next</a><span>|</span><label class="collapse" for="c-37629685">[-]</label><label class="expand" for="c-37629685">[9 more]</label></div><br/><div class="children"><div class="content">This is a disappointing post -- they picked up a complex thing that they didn&#x27;t fully understand, pushed some buttons, and then complained when it didn&#x27;t work as they expected.  I expect more from this blogger, whose content I think of as usually good.</div><br/><div id="37630493" class="c"><input type="checkbox" id="c-37630493" checked=""/><div class="controls bullet"><span class="by">Grimburger</span><span>|</span><a href="#37629685">parent</a><span>|</span><a href="#37629927">next</a><span>|</span><label class="collapse" for="c-37630493">[-]</label><label class="expand" for="c-37630493">[2 more]</label></div><br/><div class="children"><div class="content">I had a good laugh at it, it was relatable.<p>They are right about the DX with wasm, it&#x27;s simply not there. Those error messages are all too common and there&#x27;s a lot of vague things going on when you compile it down. The whole ecosystem is quite fragmented and a bit of a mess.</div><br/><div id="37630865" class="c"><input type="checkbox" id="c-37630865" checked=""/><div class="controls bullet"><span class="by">hutzlibu</span><span>|</span><a href="#37629685">root</a><span>|</span><a href="#37630493">parent</a><span>|</span><a href="#37629927">next</a><span>|</span><label class="collapse" for="c-37630865">[-]</label><label class="expand" for="c-37630865">[1 more]</label></div><br/><div class="children"><div class="content">&quot;The whole ecosystem is quite fragmented and a bit of a mess.&quot;<p>Just the general web style of doing things?
I was hoping wasm to be somewhat cleaner and I think it is compared to html and co, but I also ran into quite some wtf moments, with the little experiments I was doing.</div><br/></div></div></div></div><div id="37629927" class="c"><input type="checkbox" id="c-37629927" checked=""/><div class="controls bullet"><span class="by">klysm</span><span>|</span><a href="#37629685">parent</a><span>|</span><a href="#37630493">prev</a><span>|</span><a href="#37631224">next</a><span>|</span><label class="collapse" for="c-37629927">[-]</label><label class="expand" for="c-37629927">[2 more]</label></div><br/><div class="children"><div class="content">Well why not write about it? I don’t see this as “bad” content</div><br/></div></div><div id="37631224" class="c"><input type="checkbox" id="c-37631224" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#37629685">parent</a><span>|</span><a href="#37629927">prev</a><span>|</span><a href="#37630101">next</a><span>|</span><label class="collapse" for="c-37631224">[-]</label><label class="expand" for="c-37631224">[1 more]</label></div><br/><div class="children"><div class="content">Being complex isn&#x27;t an excuse for being completely unapproachable.<p>There are multiple ways in which error messages and documentation could have been way better here.</div><br/></div></div><div id="37630101" class="c"><input type="checkbox" id="c-37630101" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#37629685">parent</a><span>|</span><a href="#37631224">prev</a><span>|</span><a href="#37630842">next</a><span>|</span><label class="collapse" for="c-37630101">[-]</label><label class="expand" for="c-37630101">[2 more]</label></div><br/><div class="children"><div class="content">Being perfectly frank: this really resonated with me. I fought through all this about 18 months ago and it was worth it. Tried again 3 months ago and it was impossible, gave it a solid 3-5 days before I pulled back and just did FFI on native and JS on web.<p>WASM has an extremely high learning curve and this post did a great job representing it. Even the &quot;oh you just need X Y and Z&quot; post is indecipherable to me and I learned the acronyms, again, just 3 months ago.<p>EDIT: this comment <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37629619">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=37629619</a></div><br/><div id="37630767" class="c"><input type="checkbox" id="c-37630767" checked=""/><div class="controls bullet"><span class="by">djur</span><span>|</span><a href="#37629685">root</a><span>|</span><a href="#37630101">parent</a><span>|</span><a href="#37630842">next</a><span>|</span><label class="collapse" for="c-37630767">[-]</label><label class="expand" for="c-37630767">[1 more]</label></div><br/><div class="children"><div class="content">The post carefully avoids making any more expansive claims than &quot;I tried to use WASM in the most obvious way apparent to me and ran into a lot of difficulties&quot;. What this implies for the grandiose claims of some WASM boosters is left to the reader to determine. (And I&#x27;d describe myself as fairly pro-WASM myself.) In that sense it&#x27;s a great counterbalance to the hundreds of &quot;here&#x27;s how I used WASM to accomplish some trivial or meaningless task&quot; pieces you see out there.</div><br/></div></div></div></div></div></div><div id="37629437" class="c"><input type="checkbox" id="c-37629437" checked=""/><div class="controls bullet"><span class="by">dwattttt</span><span>|</span><a href="#37629685">prev</a><span>|</span><a href="#37630955">next</a><span>|</span><label class="collapse" for="c-37629437">[-]</label><label class="expand" for="c-37629437">[7 more]</label></div><br/><div class="children"><div class="content">It&#x27;s normal for JS tooling to minify symbol names in order to shrink the amount of JS being pushed to user agents; those a... symbols might actually have sensible names somewhere along the compilation pipeline.</div><br/><div id="37629531" class="c"><input type="checkbox" id="c-37629531" checked=""/><div class="controls bullet"><span class="by">capitainenemo</span><span>|</span><a href="#37629437">parent</a><span>|</span><a href="#37630955">next</a><span>|</span><label class="collapse" for="c-37629531">[-]</label><label class="expand" for="c-37629531">[6 more]</label></div><br/><div class="children"><div class="content">I do wish this was less common.  It&#x27;s kinda hostile to any users who might want to fire up a debugger for learning or solving a problem with your site, and as we can see can mess with developers too.<p>And while it does speed up load time a bit in JS engines, this was never a measurable amount in any JS library I used.  Bytes pushed out from the site were only slightly lower than the non-minified, since both were compressed in transit anyway.</div><br/><div id="37629562" class="c"><input type="checkbox" id="c-37629562" checked=""/><div class="controls bullet"><span class="by">strbean</span><span>|</span><a href="#37629437">root</a><span>|</span><a href="#37629531">parent</a><span>|</span><a href="#37629762">next</a><span>|</span><label class="collapse" for="c-37629562">[-]</label><label class="expand" for="c-37629562">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s what source maps are for (assuming they work).<p>Still leads to strangeness when the minified code doesn&#x27;t have statements that corresponds 1:1 with the original code.</div><br/><div id="37629569" class="c"><input type="checkbox" id="c-37629569" checked=""/><div class="controls bullet"><span class="by">capitainenemo</span><span>|</span><a href="#37629437">root</a><span>|</span><a href="#37629562">parent</a><span>|</span><a href="#37629762">next</a><span>|</span><label class="collapse" for="c-37629569">[-]</label><label class="expand" for="c-37629569">[1 more]</label></div><br/><div class="children"><div class="content">Assuming they are working and were created yeah. It just seems like another hack layer on top of something that really doesn&#x27;t seem to add much in the first place.  I mean, if you&#x27;re wanting every last bit of performance, maybe just use WASM or something?  Bonus, always obfuscated.</div><br/></div></div></div></div><div id="37629762" class="c"><input type="checkbox" id="c-37629762" checked=""/><div class="controls bullet"><span class="by">aragonite</span><span>|</span><a href="#37629437">root</a><span>|</span><a href="#37629531">parent</a><span>|</span><a href="#37629562">prev</a><span>|</span><a href="#37630221">next</a><span>|</span><label class="collapse" for="c-37629762">[-]</label><label class="expand" for="c-37629762">[1 more]</label></div><br/><div class="children"><div class="content">Examining this kind of (unintentionally) obfuscated code can be a learning opportunity as well.<p>Forgetting the intuitive meaning of symbols is often helpful in doing mathematical proofs (I think Weyl has a famous quote about that). Who knows, maybe the same is true of programming! I&#x27;ve been trying to train myself to to read code purely based on their form, replacing variables names by purely unsuggestive random letters and training myself to visually pattern match first elementary, then increasingly complicated patterns. Still too early to tell whether this will lead anywhere. But in some cases it definitely saved me time by removing the temptation to wonder what the original author&#x27;s &quot;thinking&quot; was behind this or that choice of variable&#x2F;function name.</div><br/></div></div><div id="37630221" class="c"><input type="checkbox" id="c-37630221" checked=""/><div class="controls bullet"><span class="by">gitgud</span><span>|</span><a href="#37629437">root</a><span>|</span><a href="#37629531">parent</a><span>|</span><a href="#37629762">prev</a><span>|</span><a href="#37629564">next</a><span>|</span><label class="collapse" for="c-37630221">[-]</label><label class="expand" for="c-37630221">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>It&#x27;s kinda hostile to any users who might want to fire up a debugger for learning or solving a problem with your site</i><p>It’s intentional, as commercial sites don’t want you to know how it actually works, as you could steal it.<p>Business cannot exist without secrecy…</div><br/></div></div><div id="37629564" class="c"><input type="checkbox" id="c-37629564" checked=""/><div class="controls bullet"><span class="by">capitainenemo</span><span>|</span><a href="#37629437">root</a><span>|</span><a href="#37629531">parent</a><span>|</span><a href="#37630221">prev</a><span>|</span><a href="#37630955">next</a><span>|</span><label class="collapse" for="c-37629564">[-]</label><label class="expand" for="c-37629564">[1 more]</label></div><br/><div class="children"><div class="content">Hm... I guess the user hostile could be a feature not a bug. Obfuscation.</div><br/></div></div></div></div></div></div><div id="37630955" class="c"><input type="checkbox" id="c-37630955" checked=""/><div class="controls bullet"><span class="by">jwilk</span><span>|</span><a href="#37629437">prev</a><span>|</span><a href="#37629404">next</a><span>|</span><label class="collapse" for="c-37630955">[-]</label><label class="expand" for="c-37630955">[1 more]</label></div><br/><div class="children"><div class="content">The page doesn&#x27;t load for me.<p>Archived copy:<p><a href="https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20230922182842&#x2F;https:&#x2F;&#x2F;flak.tedunangst.com&#x2F;post&#x2F;www-which-wasm-works" rel="nofollow noreferrer">https:&#x2F;&#x2F;web.archive.org&#x2F;web&#x2F;20230922182842&#x2F;https:&#x2F;&#x2F;flak.tedu...</a></div><br/></div></div><div id="37629404" class="c"><input type="checkbox" id="c-37629404" checked=""/><div class="controls bullet"><span class="by">schemescape</span><span>|</span><a href="#37630955">prev</a><span>|</span><a href="#37630006">next</a><span>|</span><label class="collapse" for="c-37629404">[-]</label><label class="expand" for="c-37629404">[2 more]</label></div><br/><div class="children"><div class="content">Are the missing imports only needed for WASI?<p>When I ran into that situation in the past, the imports had reasonable names (e.g. &quot;fd_write&quot;). Which WebAssembly toolchain is just using letters of the alphabet? Is that common practice now?</div><br/><div id="37631085" class="c"><input type="checkbox" id="c-37631085" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#37629404">parent</a><span>|</span><a href="#37630006">next</a><span>|</span><label class="collapse" for="c-37631085">[-]</label><label class="expand" for="c-37631085">[1 more]</label></div><br/><div class="children"><div class="content">It seems libjxl does not compile for WASI, but for emscripten. Hence that minified JS is likely the emscripten glue code that&#x27;s required at runtime, but which the libjxl documentation fails to mention clearly (as it just tells users to run some python script and get a magic file included at runtime). To run that outside the browser, the author will need to generate a emcripten runtime that works with WASI, which as far as I know is not possible.</div><br/></div></div></div></div><div id="37630006" class="c"><input type="checkbox" id="c-37630006" checked=""/><div class="controls bullet"><span class="by">artdigital</span><span>|</span><a href="#37629404">prev</a><span>|</span><a href="#37630004">next</a><span>|</span><label class="collapse" for="c-37630006">[-]</label><label class="expand" for="c-37630006">[1 more]</label></div><br/><div class="children"><div class="content">The native Golang wasm support isn’t bad actually. It gives you a js file with the bindings to import, then load the wasm binary that got built with the normal ‘go build’ command<p>Not the smallest binary, but I had good success with it. Needs a bit of glue for making it run nicely in both browser and node environment at the same time because of different imports and runtime, but outside of publishing npm packages you don’t really need that anyway</div><br/></div></div><div id="37630004" class="c"><input type="checkbox" id="c-37630004" checked=""/><div class="controls bullet"><span class="by">lucgagan</span><span>|</span><a href="#37630006">prev</a><span>|</span><a href="#37629806">next</a><span>|</span><label class="collapse" for="c-37630004">[-]</label><label class="expand" for="c-37630004">[1 more]</label></div><br/><div class="children"><div class="content">This title makes little sense</div><br/></div></div><div id="37629806" class="c"><input type="checkbox" id="c-37629806" checked=""/><div class="controls bullet"><span class="by">SCSIfloppy</span><span>|</span><a href="#37630004">prev</a><span>|</span><a href="#37629497">next</a><span>|</span><label class="collapse" for="c-37629806">[-]</label><label class="expand" for="c-37629806">[2 more]</label></div><br/><div class="children"><div class="content">I just turn this stuff off for now, the only use I can see for it is unskippable &#x2F; unblockable ads no matter what neat things are theoretically possible. Soon we&#x27;ll have &quot;booter&quot; sites which suck their data from who knows where, without the browser being able to intercept and block the baddies.</div><br/></div></div><div id="37629497" class="c"><input type="checkbox" id="c-37629497" checked=""/><div class="controls bullet"><span class="by">airstrike</span><span>|</span><a href="#37629806">prev</a><span>|</span><label class="collapse" for="c-37629497">[-]</label><label class="expand" for="c-37629497">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Ah, I see now why they didn’t feel the need to document these imports. They’re so simple and obvious, it probably never occurred to anybody that this would benefit from documentation. I like that the list starts with “b” and ends with “a”.<p>LMAO absolutely hilarious<p>thanks for sharing this</div><br/><div id="37629742" class="c"><input type="checkbox" id="c-37629742" checked=""/><div class="controls bullet"><span class="by">earthboundkid</span><span>|</span><a href="#37629497">parent</a><span>|</span><a href="#37629557">next</a><span>|</span><label class="collapse" for="c-37629742">[-]</label><label class="expand" for="c-37629742">[2 more]</label></div><br/><div class="children"><div class="content">ESBuild will try to use variables so that they have better gzip compression, so it’s plausible the imports would receive minified names out of order.</div><br/><div id="37629750" class="c"><input type="checkbox" id="c-37629750" checked=""/><div class="controls bullet"><span class="by">airstrike</span><span>|</span><a href="#37629497">root</a><span>|</span><a href="#37629742">parent</a><span>|</span><a href="#37629557">next</a><span>|</span><label class="collapse" for="c-37629750">[-]</label><label class="expand" for="c-37629750">[1 more]</label></div><br/><div class="children"><div class="content">I understand that. It&#x27;s still a funny read</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>