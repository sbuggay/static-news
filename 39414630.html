<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1708246851043" as="style"/><link rel="stylesheet" href="styles.css?v=1708246851043"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://git.kernel.dk/cgit/liburing/tree/examples/proxy.c">Basic proxy implementation using io_uring</a> <span class="domain">(<a href="https://git.kernel.dk">git.kernel.dk</a>)</span></div><div class="subtext"><span>mfiguiere</span> | <span>24 comments</span></div><br/><div><div id="39415135" class="c"><input type="checkbox" id="c-39415135" checked=""/><div class="controls bullet"><span class="by">bjconlan</span><span>|</span><a href="#39416721">next</a><span>|</span><label class="collapse" for="c-39415135">[-]</label><label class="expand" for="c-39415135">[1 more]</label></div><br/><div class="children"><div class="content">I really need to get my head across some of these things. I&#x27;ve been meaning to also look into <a href="https:&#x2F;&#x2F;www.kernel.org&#x2F;doc&#x2F;html&#x2F;latest&#x2F;networking&#x2F;tproxy.html" rel="nofollow">https:&#x2F;&#x2F;www.kernel.org&#x2F;doc&#x2F;html&#x2F;latest&#x2F;networking&#x2F;tproxy.htm...</a> (in regards to udp(quic)&#x2F;ztunnel-esque behaviour). This will serve as a great reference, thanks.</div><br/></div></div><div id="39416721" class="c"><input type="checkbox" id="c-39416721" checked=""/><div class="controls bullet"><span class="by">gigatexal</span><span>|</span><a href="#39415135">prev</a><span>|</span><a href="#39416012">next</a><span>|</span><label class="collapse" for="c-39416721">[-]</label><label class="expand" for="c-39416721">[1 more]</label></div><br/><div class="children"><div class="content">Come on HN. Do better. Silly conversations about the number of lines? How about any C experts and networking pros weigh in on this? Has anyone built it and tested it?</div><br/></div></div><div id="39416012" class="c"><input type="checkbox" id="c-39416012" checked=""/><div class="controls bullet"><span class="by">CoolCold</span><span>|</span><a href="#39416721">prev</a><span>|</span><a href="#39416091">next</a><span>|</span><label class="collapse" for="c-39416012">[-]</label><label class="expand" for="c-39416012">[1 more]</label></div><br/><div class="children"><div class="content">would be interesting to see some performance benchmarks - I do care on TCP streams mostly for now, cases I do cover by HAproxy&#x2F;Nginx in the systems.</div><br/></div></div><div id="39416091" class="c"><input type="checkbox" id="c-39416091" checked=""/><div class="controls bullet"><span class="by">SPascareli13</span><span>|</span><a href="#39416012">prev</a><span>|</span><a href="#39415493">next</a><span>|</span><label class="collapse" for="c-39416091">[-]</label><label class="expand" for="c-39416091">[6 more]</label></div><br/><div class="children"><div class="content">So, is io_uring used anywhere yet?</div><br/><div id="39416921" class="c"><input type="checkbox" id="c-39416921" checked=""/><div class="controls bullet"><span class="by">lukeh</span><span>|</span><a href="#39416091">parent</a><span>|</span><a href="#39416677">next</a><span>|</span><label class="collapse" for="c-39416921">[-]</label><label class="expand" for="c-39416921">[1 more]</label></div><br/><div class="children"><div class="content">I’m using it for all I&#x2F;O (file, socket, SPI and UART) in an embedded application written in Swift. Wrappers here:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;PADL&#x2F;IORingSwift">https:&#x2F;&#x2F;github.com&#x2F;PADL&#x2F;IORingSwift</a></div><br/></div></div><div id="39416677" class="c"><input type="checkbox" id="c-39416677" checked=""/><div class="controls bullet"><span class="by">sbstp</span><span>|</span><a href="#39416091">parent</a><span>|</span><a href="#39416921">prev</a><span>|</span><a href="#39416263">next</a><span>|</span><label class="collapse" for="c-39416677">[-]</label><label class="expand" for="c-39416677">[1 more]</label></div><br/><div class="children"><div class="content">I think there&#x27;s still a lot of concerns related to security <a href="https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Google-Restricting-IO_uring" rel="nofollow">https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Google-Restricting-IO_uring</a></div><br/></div></div><div id="39416263" class="c"><input type="checkbox" id="c-39416263" checked=""/><div class="controls bullet"><span class="by">dankebitte</span><span>|</span><a href="#39416091">parent</a><span>|</span><a href="#39416677">prev</a><span>|</span><a href="#39416904">next</a><span>|</span><label class="collapse" for="c-39416263">[-]</label><label class="expand" for="c-39416263">[1 more]</label></div><br/><div class="children"><div class="content">Anything using glommio [1].<p>[1] <a href="https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;glommio&#x2F;reverse_dependencies" rel="nofollow">https:&#x2F;&#x2F;crates.io&#x2F;crates&#x2F;glommio&#x2F;reverse_dependencies</a></div><br/></div></div><div id="39416904" class="c"><input type="checkbox" id="c-39416904" checked=""/><div class="controls bullet"><span class="by">jandrewrogers</span><span>|</span><a href="#39416091">parent</a><span>|</span><a href="#39416263">prev</a><span>|</span><a href="#39416358">next</a><span>|</span><label class="collapse" for="c-39416904">[-]</label><label class="expand" for="c-39416904">[1 more]</label></div><br/><div class="children"><div class="content">There are practical backward compatibility and security issues currently that prevent widespread deployment. I’ve been leaning into io_uring going forward because it is clearly the future and brings a lot to the table. It still can’t be used in many environments but I expect it to be mainstream in 2-3 years. Niche, but not for much longer.<p>Most software doesn’t properly use the old io_submit facility and that has been around for decades, despite the large performance improvements possible. Even when io_uring is widely deployable, most software won’t use it.</div><br/></div></div><div id="39416358" class="c"><input type="checkbox" id="c-39416358" checked=""/><div class="controls bullet"><span class="by">i_am_a_peasant</span><span>|</span><a href="#39416091">parent</a><span>|</span><a href="#39416904">prev</a><span>|</span><a href="#39415493">next</a><span>|</span><label class="collapse" for="c-39416358">[-]</label><label class="expand" for="c-39416358">[1 more]</label></div><br/><div class="children"><div class="content">I used it for some high datarate record applications at work.<p>Does the job nicely without even half the boilerplate of aio if you use liburing.</div><br/></div></div></div></div><div id="39415493" class="c"><input type="checkbox" id="c-39415493" checked=""/><div class="controls bullet"><span class="by">lukeh</span><span>|</span><a href="#39416091">prev</a><span>|</span><a href="#39415182">next</a><span>|</span><label class="collapse" for="c-39415493">[-]</label><label class="expand" for="c-39415493">[3 more]</label></div><br/><div class="children"><div class="content">io_uring is wonderful.</div><br/><div id="39416981" class="c"><input type="checkbox" id="c-39416981" checked=""/><div class="controls bullet"><span class="by">topspin</span><span>|</span><a href="#39415493">parent</a><span>|</span><a href="#39415182">next</a><span>|</span><label class="collapse" for="c-39416981">[-]</label><label class="expand" for="c-39416981">[2 more]</label></div><br/><div class="children"><div class="content">io_uring has produced many security problems.  Google has found it necessary to either completely forego io_uring or severely limit its use to trusted code[1].  This policy includes Chrome OS, Android and Google Cloud.  Docker has also blocked io_uring syscalls (by default) from being called by containers for the same reason and, although they&#x27;ve flip flopped on this at least once, I believe io_uring is currently blocked.<p>This is highly disappointing to me, but also not surprising given the nature of io_uring.  Solving it will require more design rigor, probably some performance compromises and possibly some degree of formal validation.<p>[1] <a href="https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Google-Restricting-IO_uring" rel="nofollow">https:&#x2F;&#x2F;www.phoronix.com&#x2F;news&#x2F;Google-Restricting-IO_uring</a></div><br/><div id="39417166" class="c"><input type="checkbox" id="c-39417166" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#39415493">root</a><span>|</span><a href="#39416981">parent</a><span>|</span><a href="#39415182">next</a><span>|</span><label class="collapse" for="c-39417166">[-]</label><label class="expand" for="c-39417166">[1 more]</label></div><br/><div class="children"><div class="content">“Faster than possible” is a phrase I picked up an awfully long time ago. I hope someone finds a reasonable middle ground that’s still several times faster but not Swiss cheese.</div><br/></div></div></div></div></div></div><div id="39415182" class="c"><input type="checkbox" id="c-39415182" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#39415493">prev</a><span>|</span><label class="collapse" for="c-39415182">[-]</label><label class="expand" for="c-39415182">[11 more]</label></div><br/><div class="children"><div class="content">&gt; basic<p>1300 lines...<p>also, the line numbers dont actually align with the lines:<p><a href="https:&#x2F;&#x2F;git.kernel.dk&#x2F;cgit&#x2F;liburing&#x2F;tree&#x2F;examples&#x2F;proxy.c#n1303" rel="nofollow">https:&#x2F;&#x2F;git.kernel.dk&#x2F;cgit&#x2F;liburing&#x2F;tree&#x2F;examples&#x2F;proxy.c#n1...</a></div><br/><div id="39415348" class="c"><input type="checkbox" id="c-39415348" checked=""/><div class="controls bullet"><span class="by">o11c</span><span>|</span><a href="#39415182">parent</a><span>|</span><a href="#39415394">next</a><span>|</span><label class="collapse" for="c-39415348">[-]</label><label class="expand" for="c-39415348">[1 more]</label></div><br/><div class="children"><div class="content">FWIW it&#x27;s about 800 lines excluding comments.<p>and yeah, this is why you don&#x27;t abuse side-by-side divs ... actually, that&#x27;s a table ... and instead just make your number unselectable (there are several ways to do this).</div><br/></div></div><div id="39415394" class="c"><input type="checkbox" id="c-39415394" checked=""/><div class="controls bullet"><span class="by">packetlost</span><span>|</span><a href="#39415182">parent</a><span>|</span><a href="#39415348">prev</a><span>|</span><a href="#39416678">next</a><span>|</span><label class="collapse" for="c-39415394">[-]</label><label class="expand" for="c-39415394">[5 more]</label></div><br/><div class="children"><div class="content">That&#x27;s pretty small for a complete C application...</div><br/><div id="39416584" class="c"><input type="checkbox" id="c-39416584" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39415182">root</a><span>|</span><a href="#39415394">parent</a><span>|</span><a href="#39416678">next</a><span>|</span><label class="collapse" for="c-39416584">[-]</label><label class="expand" for="c-39416584">[4 more]</label></div><br/><div class="children"><div class="content">Various things that I have written in less than 1300 lines of C:<p><pre><code>    * TCP proxy (~200)
    * Win32 GUI TOTP authenticator (~230)
    * GIF decoder (~300)
    * PNG decoder (~470)
    * JPEG decoder (~770)
    * H.261 decoder (~740)
    * H.263 decoder (~1100)
    * MPEG-1 decoder (~1100)
</code></pre>
All of the above I would consider a &quot;complete C application&quot;.<p>Edit: looks like some people just have no respect for craftsmanship.</div><br/><div id="39417073" class="c"><input type="checkbox" id="c-39417073" checked=""/><div class="controls bullet"><span class="by">rogers12</span><span>|</span><a href="#39415182">root</a><span>|</span><a href="#39416584">parent</a><span>|</span><a href="#39416624">next</a><span>|</span><label class="collapse" for="c-39417073">[-]</label><label class="expand" for="c-39417073">[2 more]</label></div><br/><div class="children"><div class="content">You should go back and add error handling to your C programs</div><br/><div id="39417104" class="c"><input type="checkbox" id="c-39417104" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#39415182">root</a><span>|</span><a href="#39417073">parent</a><span>|</span><a href="#39416624">next</a><span>|</span><label class="collapse" for="c-39417104">[-]</label><label class="expand" for="c-39417104">[1 more]</label></div><br/><div class="children"><div class="content">Are you implying I don&#x27;t already have error handling?<p>Personal insults are not acceptable here.</div><br/></div></div></div></div></div></div></div></div><div id="39416678" class="c"><input type="checkbox" id="c-39416678" checked=""/><div class="controls bullet"><span class="by">rwiggins</span><span>|</span><a href="#39415182">parent</a><span>|</span><a href="#39415394">prev</a><span>|</span><a href="#39416227">next</a><span>|</span><label class="collapse" for="c-39416678">[-]</label><label class="expand" for="c-39416678">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s something super weird going on with those line numbers. They don&#x27;t align for me either (Firefox on Windows 11). In the web inspector, the line numbers are rendering with Courier New as the font, whereas the code itself is `monospace`.<p>The weird thing is both are controlled by a single CSS rule,<p><pre><code>    div#cgit pre {
      font-family: &quot;Source Code Pro&quot;, &quot;Courier New&quot;, monospace;
    }
</code></pre>
(Changing to just `monospace` fixes it.)<p>I&#x27;m not sure how two elements <i>could</i> have different fonts with that. I&#x27;m possibly missing something obscure, but it really feels like a browser bug.</div><br/></div></div><div id="39416227" class="c"><input type="checkbox" id="c-39416227" checked=""/><div class="controls bullet"><span class="by">jeroenhd</span><span>|</span><a href="#39415182">parent</a><span>|</span><a href="#39416678">prev</a><span>|</span><label class="collapse" for="c-39416227">[-]</label><label class="expand" for="c-39416227">[3 more]</label></div><br/><div class="children"><div class="content">It aligns perfectly for me. Must&#x27;ve been mostly tested on Firefox.</div><br/><div id="39416673" class="c"><input type="checkbox" id="c-39416673" checked=""/><div class="controls bullet"><span class="by">marwis</span><span>|</span><a href="#39415182">root</a><span>|</span><a href="#39416227">parent</a><span>|</span><a href="#39416357">next</a><span>|</span><label class="collapse" for="c-39416673">[-]</label><label class="expand" for="c-39416673">[1 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t work on Chrome too.<p>Needs .linenumbers { line-height: 12pt } but I think vertical line spacing within text node cannot be precisely controlled and is browser dependent.</div><br/></div></div><div id="39416357" class="c"><input type="checkbox" id="c-39416357" checked=""/><div class="controls bullet"><span class="by">38</span><span>|</span><a href="#39415182">root</a><span>|</span><a href="#39416227">parent</a><span>|</span><a href="#39416673">prev</a><span>|</span><label class="collapse" for="c-39416357">[-]</label><label class="expand" for="c-39416357">[1 more]</label></div><br/><div class="children"><div class="content">I am on Firefox...</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>