<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1687338073373" as="style"/><link rel="stylesheet" href="styles.css?v=1687338073373"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://cedwards.xyz/defer-for-shell/">Defer for Shell (2020)</a> <span class="domain">(<a href="https://cedwards.xyz">cedwards.xyz</a>)</span></div><div class="subtext"><span>harporoeder</span> | <span>34 comments</span></div><br/><div><div id="36413338" class="c"><input type="checkbox" id="c-36413338" checked=""/><div class="controls bullet"><span class="by">vermilingua</span><span>|</span><a href="#36415939">next</a><span>|</span><label class="collapse" for="c-36413338">[-]</label><label class="expand" for="c-36413338">[1 more]</label></div><br/><div class="children"><div class="content">&gt; This is known as idempotency.<p>No? Idempotency is ensuring that calling the same function with the same input N times will have the exact same effect as calling it once. Adding this defer does _not_ guarantee idempotency, because it has no impact on the body of the script. You can provide just as much idempotency by running `rm -rf &#x2F;tmp&#x2F;$script_dir*` on the first line.</div><br/></div></div><div id="36415939" class="c"><input type="checkbox" id="c-36415939" checked=""/><div class="controls bullet"><span class="by">ceving</span><span>|</span><a href="#36413338">prev</a><span>|</span><a href="#36413867">next</a><span>|</span><label class="collapse" for="c-36415939">[-]</label><label class="expand" for="c-36415939">[2 more]</label></div><br/><div class="children"><div class="content">I wrote something similar some years ago:
<a href="https:&#x2F;&#x2F;codereview.stackexchange.com&#x2F;questions&#x2F;67417&#x2F;an-atexit-for-bash" rel="nofollow noreferrer">https:&#x2F;&#x2F;codereview.stackexchange.com&#x2F;questions&#x2F;67417&#x2F;an-atex...</a><p>I do not like the way you build expressions by concatenating strings. This is the driving force behind SQL injections.</div><br/><div id="36416025" class="c"><input type="checkbox" id="c-36416025" checked=""/><div class="controls bullet"><span class="by">mplewis9z</span><span>|</span><a href="#36415939">parent</a><span>|</span><a href="#36413867">next</a><span>|</span><label class="collapse" for="c-36416025">[-]</label><label class="expand" for="c-36416025">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I do not like the way you build expressions by concatenating strings.<p>Unfortunately this is the only option if you&#x27;re trying to preserve POSIX shell compatibility - arrays are implementation-specific additions to the specifications.<p>I do not like the way Bash has become synonymous with shell, and appreciate people making an effort to make their scripts work across a large variety of different systems.</div><br/></div></div></div></div><div id="36413867" class="c"><input type="checkbox" id="c-36413867" checked=""/><div class="controls bullet"><span class="by">mplewis9z</span><span>|</span><a href="#36415939">prev</a><span>|</span><a href="#36415605">next</a><span>|</span><label class="collapse" for="c-36413867">[-]</label><label class="expand" for="c-36413867">[5 more]</label></div><br/><div class="children"><div class="content">While this is great, this only cleans up temporary files on a clean exit (well, depending on the shell), and no trap can catch SIGKILL. I much prefer cleaning up my files _before_ I use them, like:<p>```<p>touch &#x27;temp.txt&#x27;<p>exec 3 &lt; &#x27;temp.txt&#x27;<p>exec 4 &gt; &#x27;temp.txt&#x27;<p>rm -f &#x27;temp.txt&#x27;<p>```<p>Now I have file descriptors 3 and 4 available for reading and writing, respectively, and even if I pulled the plug out from my desktop the file will not be anywhere on my filesystem.</div><br/><div id="36416016" class="c"><input type="checkbox" id="c-36416016" checked=""/><div class="controls bullet"><span class="by">mbwgh</span><span>|</span><a href="#36413867">parent</a><span>|</span><a href="#36415501">next</a><span>|</span><label class="collapse" for="c-36416016">[-]</label><label class="expand" for="c-36416016">[1 more]</label></div><br/><div class="children"><div class="content">Can you use something similar for lock files?<p>For instance, I have some script which looks like this:<p><pre><code>    function cleanup() {
        pkill -P $$  # Kill child processes.
        rm -f myscript.lock
    }
    trap cleanup exit

    lockfile -r 0 myscript.lock  # Try to create lock file once.
    if [[ $? != 0 ]]; then
        echo &quot;:(&quot;
        exit 1
    fi
    
    # Work work...
    cleanup
</code></pre>
Like you said, the cleanup handler is not invoked if the script receives a SIGKILL.
Since the lock file needs to be present in the FS (contrary to a tmp file), maybe this is some inherent limitation, but I would be curious if some better approach exists.</div><br/></div></div><div id="36415501" class="c"><input type="checkbox" id="c-36415501" checked=""/><div class="controls bullet"><span class="by">hkwerf</span><span>|</span><a href="#36413867">parent</a><span>|</span><a href="#36416016">prev</a><span>|</span><a href="#36414991">next</a><span>|</span><label class="collapse" for="c-36415501">[-]</label><label class="expand" for="c-36415501">[1 more]</label></div><br/><div class="children"><div class="content">Same here. I&#x27;m maintaining a script which generate a file, sets up a loopback device and dmcrypt, then mounts the resulting map. Every of these operations but the mount can be done in a way that the kernel will remove them once they&#x27;re not needed anymore, i.e. unmounting the filesystem leads to the dm-crypt map being discarded, leads to the loopback device being removed and the space reserved by the file being freed. This even persists past the exit of the script.</div><br/></div></div><div id="36414991" class="c"><input type="checkbox" id="c-36414991" checked=""/><div class="controls bullet"><span class="by">m1keil</span><span>|</span><a href="#36413867">parent</a><span>|</span><a href="#36415501">prev</a><span>|</span><a href="#36415605">next</a><span>|</span><label class="collapse" for="c-36414991">[-]</label><label class="expand" for="c-36414991">[2 more]</label></div><br/><div class="children"><div class="content">If I understand correctly, this works more like a pipe and not a file in the sense that you can only read what you wrote once, right? But a nice trick nonetheless.</div><br/><div id="36415062" class="c"><input type="checkbox" id="c-36415062" checked=""/><div class="controls bullet"><span class="by">mplewis9z</span><span>|</span><a href="#36413867">root</a><span>|</span><a href="#36414991">parent</a><span>|</span><a href="#36415605">next</a><span>|</span><label class="collapse" for="c-36415062">[-]</label><label class="expand" for="c-36415062">[1 more]</label></div><br/><div class="children"><div class="content">&gt; you can only read what you wrote once<p>In the way I’ve written it, yes. But you can open as many file descriptors as you need before you `rm` the file, and they each will keep their own position in the file. You can’t do a dynamic number of reads through the file (at least without dumping the contents somewhere else first), but a fixed number greater than one is absolutely possible.</div><br/></div></div></div></div></div></div><div id="36413148" class="c"><input type="checkbox" id="c-36413148" checked=""/><div class="controls bullet"><span class="by">abathur</span><span>|</span><a href="#36415605">prev</a><span>|</span><a href="#36412970">next</a><span>|</span><label class="collapse" for="c-36413148">[-]</label><label class="expand" for="c-36413148">[1 more]</label></div><br/><div class="children"><div class="content">Heh! Not sure if it&#x27;s a cosmic coincidence, but I posted something (<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36410781">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=36410781</a>) similar based on <a href="https:&#x2F;&#x2F;github.com&#x2F;bashup&#x2F;events">https:&#x2F;&#x2F;github.com&#x2F;bashup&#x2F;events</a> a few hours ago in another thread.<p>The version here&#x27;s much simpler, which has its merit if you need the performance or have a simple (append-only, exit-only) use-case.<p>bashup.events supports removing handlers, one-time events, pseudo-promises, and more. It&#x27;s easy to use it for something like this, but also modular deferred init&#x2F;load and more.<p>(linked comment has a little more detail on how I use it.)</div><br/></div></div><div id="36412970" class="c"><input type="checkbox" id="c-36412970" checked=""/><div class="controls bullet"><span class="by">_huayra_</span><span>|</span><a href="#36413148">prev</a><span>|</span><a href="#36413045">next</a><span>|</span><label class="collapse" for="c-36412970">[-]</label><label class="expand" for="c-36412970">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m adding this to my dotfiles because it just seems so dang useful, but this really seems to be the intersection of elegance and hackery that&#x27;s the epitome of shell scripting. A close second would be that &quot;fork bomb&quot; that&#x27;s just a bunch of :{}|{} or something weird like that, but `defer` here is actually useful!</div><br/></div></div><div id="36413045" class="c"><input type="checkbox" id="c-36413045" checked=""/><div class="controls bullet"><span class="by">JohnMakin</span><span>|</span><a href="#36412970">prev</a><span>|</span><a href="#36412939">next</a><span>|</span><label class="collapse" for="c-36413045">[-]</label><label class="expand" for="c-36413045">[9 more]</label></div><br/><div class="children"><div class="content">I’m trying to figure out a way this can backfire horribly but falling short of it. Curious to test the interaction with set -e if your defer command also errors. Very clever.</div><br/><div id="36413228" class="c"><input type="checkbox" id="c-36413228" checked=""/><div class="controls bullet"><span class="by">adrianmonk</span><span>|</span><a href="#36413045">parent</a><span>|</span><a href="#36413303">next</a><span>|</span><label class="collapse" for="c-36413228">[-]</label><label class="expand" for="c-36413228">[6 more]</label></div><br/><div class="children"><div class="content">Well, for one thing, it doesn&#x27;t quote arguments correctly.<p>If you do this...<p><pre><code>    touch &quot;a b&quot;
</code></pre>
...it will create one file called &quot;a b&quot;.<p>But if you do this...<p><pre><code>    defer touch &quot;a b&quot;
</code></pre>
...it will create two files called &quot;a&quot; and &quot;b&quot;.</div><br/><div id="36414299" class="c"><input type="checkbox" id="c-36414299" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#36413045">root</a><span>|</span><a href="#36413228">parent</a><span>|</span><a href="#36413432">next</a><span>|</span><label class="collapse" for="c-36414299">[-]</label><label class="expand" for="c-36414299">[2 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>  #!&#x2F;bin&#x2F;sh

  DEFER=

  defer() {
    local i
    local cmdline=&quot;&quot;

    for arg in ${@+&quot;$@&quot;} ; do
      [ -n &quot;$cmdline&quot; ] &amp;&amp; cmdline=&quot;$cmdline &quot;
      case $arg in
      *&quot;&#x27;&quot;* )
        case $arg in
        *[\&quot;\$\\]* )
          cmdline=&quot;$cmdline&#x27;$(printf &quot;%s&quot; &quot;$arg&quot; | sed -e &quot;s&#x2F;&#x27;&#x2F;&#x27;\\\\&#x27;&#x27;&#x2F;g&quot;)&#x27;&quot;
          ;;
        * )
          cmdline=&quot;$cmdline\&quot;$arg\&quot;&quot;
          ;;
        esac
        ;;
      *&#x27;&quot;&#x27;* | *[&#x27;$*?[(){};&amp;|&lt;&gt;#&#x27;]* | &#x27;~&#x27;* )
        cmdline=&quot;$cmdline&#x27;$arg&#x27;&quot;
        ;;
      *&#x27; &#x27;* | *&#x27;        &#x27;* ) # literal tab between second pair of quotes
        cmdline=&quot;$cmdline\&quot;$arg\&quot;&quot;
        ;;
      * )
        cmdline=&quot;$cmdline$arg&quot;
        ;;
      esac
    done
    DEFER=&quot;$cmdline; $DEFER&quot;
    # printf &quot;DEFER=%s\n&quot; &quot;$DEFER&quot; # debugging
    trap &quot;command $DEFER&quot; EXIT
  }
</code></pre>
(The quoting code is complicated because it&#x27;s taken from a program that quotes &quot;neatly&quot;. Words that don&#x27;t need quoting aren&#x27;t quoted, and single or double quotes are used, whichever is nicer. It&#x27;s not valuable if all you do is execute, but it could help the debug printf be more understandable.)</div><br/><div id="36415988" class="c"><input type="checkbox" id="c-36415988" checked=""/><div class="controls bullet"><span class="by">patrec</span><span>|</span><a href="#36413045">root</a><span>|</span><a href="#36414299">parent</a><span>|</span><a href="#36413432">next</a><span>|</span><label class="collapse" for="c-36415988">[-]</label><label class="expand" for="c-36415988">[1 more]</label></div><br/><div class="children"><div class="content">No need for the gobbledygook. Just use printf %q, which will quote neatly, too.<p><pre><code>    defer() {
       new_cmd=&quot;$(printf &quot;%q&quot; &quot;$@&quot;)&quot;
       DEFER=&quot;${new_cmd% }; $DEFER&quot;
       trap &quot;command $DEFER&quot; EXIT
    }
</code></pre>
Yeah, %q is not in POSIX, so this won&#x27;t work with e.g. dash – but trying to stick to POSIX is almost always a dumb idea.</div><br/></div></div></div></div><div id="36413432" class="c"><input type="checkbox" id="c-36413432" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36413045">root</a><span>|</span><a href="#36413228">parent</a><span>|</span><a href="#36414299">prev</a><span>|</span><a href="#36413303">next</a><span>|</span><label class="collapse" for="c-36413432">[-]</label><label class="expand" for="c-36413432">[3 more]</label></div><br/><div class="children"><div class="content">You mean it doesn&#x27;t quote arguments <i>automatically</i>, it is safe so long as you always quote the command<p><pre><code>    defer &#x27;touch &quot;a b&quot;&#x27;
</code></pre>
(a usability pitfall I know, but probably not fixable easily)<p>edit: maybe escaping could be added though, using sed?<p><pre><code>    DEFER=&quot;; ${DEFER}&quot;
    for arg in &quot;$@&quot;; do
        DEFER=&quot;$(printf -- %s &quot;${arg}&quot; | sed &quot;s&#x2F;&#x27;&#x2F;&#x27;\\\\&#x27;&#x27;&#x2F;g;1s&#x2F;^&#x2F;&#x27;&#x2F;;\$s&#x2F;\$&#x2F;&#x27;&#x2F;&quot;) ${DEFER}&quot;
    done</code></pre></div><br/><div id="36413477" class="c"><input type="checkbox" id="c-36413477" checked=""/><div class="controls bullet"><span class="by">ramses0</span><span>|</span><a href="#36413045">root</a><span>|</span><a href="#36413432">parent</a><span>|</span><a href="#36413303">next</a><span>|</span><label class="collapse" for="c-36413477">[-]</label><label class="expand" for="c-36413477">[2 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    printf &quot;%q&quot; &quot;$VAR&quot;
</code></pre>
P.S. quotes matter, surprisingly or unsurprisingly because “bash”</div><br/><div id="36413497" class="c"><input type="checkbox" id="c-36413497" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36413045">root</a><span>|</span><a href="#36413477">parent</a><span>|</span><a href="#36413303">next</a><span>|</span><label class="collapse" for="c-36413497">[-]</label><label class="expand" for="c-36413497">[1 more]</label></div><br/><div class="children"><div class="content">I suspect that this works only for bash and won&#x27;t work in other shells.</div><br/></div></div></div></div></div></div></div></div><div id="36413303" class="c"><input type="checkbox" id="c-36413303" checked=""/><div class="controls bullet"><span class="by">loeg</span><span>|</span><a href="#36413045">parent</a><span>|</span><a href="#36413228">prev</a><span>|</span><a href="#36413582">next</a><span>|</span><label class="collapse" for="c-36413303">[-]</label><label class="expand" for="c-36413303">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not lexically scoped, so if you (try to) use this in a function, all cleanups are deferred until exit rather than when the function returns.</div><br/></div></div><div id="36413582" class="c"><input type="checkbox" id="c-36413582" checked=""/><div class="controls bullet"><span class="by">adastra22</span><span>|</span><a href="#36413045">parent</a><span>|</span><a href="#36413303">prev</a><span>|</span><a href="#36412939">next</a><span>|</span><label class="collapse" for="c-36413582">[-]</label><label class="expand" for="c-36413582">[1 more]</label></div><br/><div class="children"><div class="content">As written it is vulnerable to shell injection. See the GitHub link at the very end for a fix.</div><br/></div></div></div></div><div id="36412939" class="c"><input type="checkbox" id="c-36412939" checked=""/><div class="controls bullet"><span class="by">archargelod</span><span>|</span><a href="#36413045">prev</a><span>|</span><a href="#36412695">next</a><span>|</span><label class="collapse" for="c-36412939">[-]</label><label class="expand" for="c-36412939">[8 more]</label></div><br/><div class="children"><div class="content">I know, so far, only two languages that use defer: Go and Nim.</div><br/><div id="36413997" class="c"><input type="checkbox" id="c-36413997" checked=""/><div class="controls bullet"><span class="by">darrenf</span><span>|</span><a href="#36412939">parent</a><span>|</span><a href="#36413309">next</a><span>|</span><label class="collapse" for="c-36413997">[-]</label><label class="expand" for="c-36413997">[1 more]</label></div><br/><div class="children"><div class="content">Perl has experimental support for defer: <a href="https:&#x2F;&#x2F;perldoc.perl.org&#x2F;perlsyn#defer-blocks" rel="nofollow noreferrer">https:&#x2F;&#x2F;perldoc.perl.org&#x2F;perlsyn#defer-blocks</a></div><br/></div></div><div id="36413309" class="c"><input type="checkbox" id="c-36413309" checked=""/><div class="controls bullet"><span class="by">loeg</span><span>|</span><a href="#36412939">parent</a><span>|</span><a href="#36413997">prev</a><span>|</span><a href="#36413044">next</a><span>|</span><label class="collapse" for="c-36413309">[-]</label><label class="expand" for="c-36413309">[1 more]</label></div><br/><div class="children"><div class="content">C++ with folly&#x27;s SCOPE_EXIT {} construct:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;folly&#x2F;blob&#x2F;main&#x2F;folly&#x2F;ScopeGuard.h#L310">https:&#x2F;&#x2F;github.com&#x2F;facebook&#x2F;folly&#x2F;blob&#x2F;main&#x2F;folly&#x2F;ScopeGuard...</a></div><br/></div></div><div id="36413044" class="c"><input type="checkbox" id="c-36413044" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#36412939">parent</a><span>|</span><a href="#36413309">prev</a><span>|</span><a href="#36413013">next</a><span>|</span><label class="collapse" for="c-36413044">[-]</label><label class="expand" for="c-36413044">[3 more]</label></div><br/><div class="children"><div class="content">Swift, but it is bound to narrower scopes, not just the function scope like Go. How does Nim scope defer statements?</div><br/><div id="36413233" class="c"><input type="checkbox" id="c-36413233" checked=""/><div class="controls bullet"><span class="by">archargelod</span><span>|</span><a href="#36412939">root</a><span>|</span><a href="#36413044">parent</a><span>|</span><a href="#36413013">next</a><span>|</span><label class="collapse" for="c-36413233">[-]</label><label class="expand" for="c-36413233">[2 more]</label></div><br/><div class="children"><div class="content">In Nim, defer is a macro, that rewrites scope into &quot;try: finally:&quot; statement. &#x27;finally&#x27; code block is always executed, even if there were any exceptions.<p><a href="https:&#x2F;&#x2F;nim-lang.org&#x2F;docs&#x2F;manual.html#exception-handling-defer-statement" rel="nofollow noreferrer">https:&#x2F;&#x2F;nim-lang.org&#x2F;docs&#x2F;manual.html#exception-handling-def...</a></div><br/><div id="36413283" class="c"><input type="checkbox" id="c-36413283" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#36412939">root</a><span>|</span><a href="#36413233">parent</a><span>|</span><a href="#36413013">next</a><span>|</span><label class="collapse" for="c-36413283">[-]</label><label class="expand" for="c-36413283">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, my main question was about the scope of the defer but it appears that it&#x27;s block scoped like Swift, not function scoped like Go.</div><br/></div></div></div></div></div></div><div id="36413013" class="c"><input type="checkbox" id="c-36413013" checked=""/><div class="controls bullet"><span class="by">wearhere</span><span>|</span><a href="#36412939">parent</a><span>|</span><a href="#36413044">prev</a><span>|</span><a href="#36413115">next</a><span>|</span><label class="collapse" for="c-36413013">[-]</label><label class="expand" for="c-36413013">[1 more]</label></div><br/><div class="children"><div class="content">Also Swift!</div><br/></div></div><div id="36413115" class="c"><input type="checkbox" id="c-36413115" checked=""/><div class="controls bullet"><span class="by">hiyer</span><span>|</span><a href="#36412939">parent</a><span>|</span><a href="#36413013">prev</a><span>|</span><a href="#36412695">next</a><span>|</span><label class="collapse" for="c-36413115">[-]</label><label class="expand" for="c-36413115">[1 more]</label></div><br/><div class="children"><div class="content">Zig has it too.</div><br/></div></div></div></div><div id="36412695" class="c"><input type="checkbox" id="c-36412695" checked=""/><div class="controls bullet"><span class="by">smitty1e</span><span>|</span><a href="#36412939">prev</a><span>|</span><label class="collapse" for="c-36412695">[-]</label><label class="expand" for="c-36412695">[5 more]</label></div><br/><div class="children"><div class="content">This seems conceptually similar to python&#x27;s `with` statement.<p><a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;reference&#x2F;compound_stmts.html#the-with-statement" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;reference&#x2F;compound_stmts.html#the-...</a></div><br/><div id="36412924" class="c"><input type="checkbox" id="c-36412924" checked=""/><div class="controls bullet"><span class="by">joeblubaugh</span><span>|</span><a href="#36412695">parent</a><span>|</span><a href="#36413547">next</a><span>|</span><label class="collapse" for="c-36412924">[-]</label><label class="expand" for="c-36412924">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, with also provides a nice finalization call, but there are a few differences:
- with requires the subject to implement a particular interface.
- multiple with calls either nest, or they execute in the order they’re written, as soon as you exit the block. Multiple withs nest uncomfortably deep.<p>Go’s defer, and this she’ll one, turn statements into a stack where the past defer executes first on exit.</div><br/><div id="36413529" class="c"><input type="checkbox" id="c-36413529" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36412695">root</a><span>|</span><a href="#36412924">parent</a><span>|</span><a href="#36413547">next</a><span>|</span><label class="collapse" for="c-36413529">[-]</label><label class="expand" for="c-36413529">[1 more]</label></div><br/><div class="children"><div class="content">contextlib from the standard library, specifically contextlib.ExitStack, provide the rest of the patterns you might want to use with &#x27;with&#x27;. Including removing the need for nested &#x27;with&#x27; block, and non-lexical finalization orders.</div><br/></div></div></div></div><div id="36413547" class="c"><input type="checkbox" id="c-36413547" checked=""/><div class="controls bullet"><span class="by">remram</span><span>|</span><a href="#36412695">parent</a><span>|</span><a href="#36412924">prev</a><span>|</span><label class="collapse" for="c-36413547">[-]</label><label class="expand" for="c-36413547">[2 more]</label></div><br/><div class="children"><div class="content">More like C and Python&#x27;s atexit</div><br/><div id="36413621" class="c"><input type="checkbox" id="c-36413621" checked=""/><div class="controls bullet"><span class="by">nomel</span><span>|</span><a href="#36412695">root</a><span>|</span><a href="#36413547">parent</a><span>|</span><label class="collapse" for="c-36413621">[-]</label><label class="expand" for="c-36413621">[1 more]</label></div><br/><div class="children"><div class="content">C: <a href="https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;c&#x2F;program&#x2F;atexit" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.cppreference.com&#x2F;w&#x2F;c&#x2F;program&#x2F;atexit</a><p>Python: <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;atexit.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;atexit.html</a><p>TIL for python. I&#x27;ve only used signal: <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;signal.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;signal.html</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>