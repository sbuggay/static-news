<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1721984466086" as="style"/><link rel="stylesheet" href="styles.css?v=1721984466086"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/mannylopez/TinyMoon">Show HN: Tiny Moon – Swift library to calculate the moon phase</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>mannylopez</span> | <span>31 comments</span></div><br/><div><div id="41075821" class="c"><input type="checkbox" id="c-41075821" checked=""/><div class="controls bullet"><span class="by">adityapurwa</span><span>|</span><a href="#41073671">next</a><span>|</span><label class="collapse" for="c-41075821">[-]</label><label class="expand" for="c-41075821">[2 more]</label></div><br/><div class="children"><div class="content">If granular accuracy is not an important factor, you can also use Islamic calendar to calculate the moon phase. Muslims uses lunar cycles for some religious events (e.g. the Ayyamul Bidh or 3 days fasting during full moon). So when its 15 of an Islamic calendar, it’ll be a full moon.<p>I used this approach because most platforms supports islamic calendar.<p>I really like the offline first approach, and would definitely use the library when there’s a need.<p>Thanks for sharing!</div><br/><div id="41076084" class="c"><input type="checkbox" id="c-41076084" checked=""/><div class="controls bullet"><span class="by">throwup238</span><span>|</span><a href="#41075821">parent</a><span>|</span><a href="#41073671">next</a><span>|</span><label class="collapse" for="c-41076084">[-]</label><label class="expand" for="c-41076084">[1 more]</label></div><br/><div class="children"><div class="content">I wonder, how is Allah&#x27;s tolerance towards technotheological errors?<p>What if there&#x27;s a bug in the calendar for Ramadan or Salah?</div><br/></div></div></div></div><div id="41073671" class="c"><input type="checkbox" id="c-41073671" checked=""/><div class="controls bullet"><span class="by">rubiquity</span><span>|</span><a href="#41075821">prev</a><span>|</span><a href="#41075824">next</a><span>|</span><label class="collapse" for="c-41073671">[-]</label><label class="expand" for="c-41073671">[2 more]</label></div><br/><div class="children"><div class="content">I know a lot of people into fishing that would love this as an app to quickly check the moon phase on a given date when planning a multi-day fishing trip or deciding when to go out. Apex predators are typically less hungry around and during a full moon due to the extra light making hunting at night easy.</div><br/><div id="41076410" class="c"><input type="checkbox" id="c-41076410" checked=""/><div class="controls bullet"><span class="by">nektro</span><span>|</span><a href="#41073671">parent</a><span>|</span><a href="#41075824">next</a><span>|</span><label class="collapse" for="c-41076410">[-]</label><label class="expand" for="c-41076410">[1 more]</label></div><br/><div class="children"><div class="content">the ios weather app has moon info for the current, previous, and next month</div><br/></div></div></div></div><div id="41075824" class="c"><input type="checkbox" id="c-41075824" checked=""/><div class="controls bullet"><span class="by">8mobile</span><span>|</span><a href="#41073671">prev</a><span>|</span><a href="#41073118">next</a><span>|</span><label class="collapse" for="c-41075824">[-]</label><label class="expand" for="c-41075824">[1 more]</label></div><br/><div class="children"><div class="content">Hi,<p>Great library, super documentation and the code seems well written with lots of tests. Kudos, I will definitely check it out for my next ios project.<p>Thanks
Otto</div><br/></div></div><div id="41073118" class="c"><input type="checkbox" id="c-41073118" checked=""/><div class="controls bullet"><span class="by">ChrisMarshallNY</span><span>|</span><a href="#41075824">prev</a><span>|</span><a href="#41071376">next</a><span>|</span><label class="collapse" for="c-41073118">[-]</label><label class="expand" for="c-41073118">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t really have use for this, but I must compliment the author on a job well-done. The code is well-structured, well-documented, well-tested, and well-designed.</div><br/><div id="41073334" class="c"><input type="checkbox" id="c-41073334" checked=""/><div class="controls bullet"><span class="by">mannylopez</span><span>|</span><a href="#41073118">parent</a><span>|</span><a href="#41071376">next</a><span>|</span><label class="collapse" for="c-41073334">[-]</label><label class="expand" for="c-41073334">[1 more]</label></div><br/><div class="children"><div class="content">Thank you! I was a technical writer before learning how to program, so it&#x27;s important for me to write well-documented and well-tested code.<p>Doing so also allowed me to completely remove and replace my first attempt at implementing the moon phase algorithm when it turned out to be not-accurate enough (the values were off by about 4 hours).</div><br/></div></div></div></div><div id="41071376" class="c"><input type="checkbox" id="c-41071376" checked=""/><div class="controls bullet"><span class="by">shainvs</span><span>|</span><a href="#41073118">prev</a><span>|</span><a href="#41070301">next</a><span>|</span><label class="collapse" for="c-41071376">[-]</label><label class="expand" for="c-41071376">[3 more]</label></div><br/><div class="children"><div class="content">Is there a plan to add this for linux &#x2F; windows? Either way, super cool project</div><br/><div id="41072983" class="c"><input type="checkbox" id="c-41072983" checked=""/><div class="controls bullet"><span class="by">robsh</span><span>|</span><a href="#41071376">parent</a><span>|</span><a href="#41072253">next</a><span>|</span><label class="collapse" for="c-41072983">[-]</label><label class="expand" for="c-41072983">[1 more]</label></div><br/><div class="children"><div class="content">The following formula will return the closest moon phase emoji in Excel:<p>=LET(phase,MOD(ROUND(MOD(NOW(),29.5275)&#x2F;3.691,0)-2,8)+1,UNICHAR(127760+phase)))</div><br/></div></div><div id="41072253" class="c"><input type="checkbox" id="c-41072253" checked=""/><div class="controls bullet"><span class="by">mannylopez</span><span>|</span><a href="#41071376">parent</a><span>|</span><a href="#41072983">prev</a><span>|</span><a href="#41070301">next</a><span>|</span><label class="collapse" for="c-41072253">[-]</label><label class="expand" for="c-41072253">[1 more]</label></div><br/><div class="children"><div class="content">Good news! According to Swift Package Index [0], Tiny Moon is already compatible with Linux environments.<p>0. <a href="https:&#x2F;&#x2F;swiftpackageindex.com&#x2F;mannylopez&#x2F;TinyMoon&#x2F;" rel="nofollow">https:&#x2F;&#x2F;swiftpackageindex.com&#x2F;mannylopez&#x2F;TinyMoon&#x2F;</a></div><br/></div></div></div></div><div id="41070301" class="c"><input type="checkbox" id="c-41070301" checked=""/><div class="controls bullet"><span class="by">jes5199</span><span>|</span><a href="#41071376">prev</a><span>|</span><a href="#41070944">next</a><span>|</span><label class="collapse" for="c-41070301">[-]</label><label class="expand" for="c-41070301">[2 more]</label></div><br/><div class="children"><div class="content">nice! I have needed this before. I think you&#x27;re using the Meeus algorithm from Astronomical Algorithms? it&#x27;s a classic, great choice</div><br/><div id="41072334" class="c"><input type="checkbox" id="c-41072334" checked=""/><div class="controls bullet"><span class="by">mannylopez</span><span>|</span><a href="#41070301">parent</a><span>|</span><a href="#41070944">next</a><span>|</span><label class="collapse" for="c-41072334">[-]</label><label class="expand" for="c-41072334">[1 more]</label></div><br/><div class="children"><div class="content">Yes, pretty much every good library I came across referenced Meeus&#x27; Astronomical Algorithms [0] book and formulas. Those were a bit dense for me to fully parse, but Dr. Louis Strous` page [1] on finding the position of the moon helped simplify it for me (although that implementation is less accurate, I think).<p>The algorithm in Moontool for Windows [2], which Tiny Moon is based off of, is based off of Meeus&#x27; algorithm.<p>0. <a href="https:&#x2F;&#x2F;www.agopax.it&#x2F;Libri_astronomia&#x2F;pdf&#x2F;Astronomical%20Algorithms.pdf" rel="nofollow">https:&#x2F;&#x2F;www.agopax.it&#x2F;Libri_astronomia&#x2F;pdf&#x2F;Astronomical%20Al...</a><p>1. <a href="https:&#x2F;&#x2F;aa.quae.nl&#x2F;en&#x2F;reken&#x2F;hemelpositie.html#4" rel="nofollow">https:&#x2F;&#x2F;aa.quae.nl&#x2F;en&#x2F;reken&#x2F;hemelpositie.html#4</a><p>2. <a href="https:&#x2F;&#x2F;www.fourmilab.ch&#x2F;moontoolw&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.fourmilab.ch&#x2F;moontoolw&#x2F;</a></div><br/></div></div></div></div><div id="41070944" class="c"><input type="checkbox" id="c-41070944" checked=""/><div class="controls bullet"><span class="by">ks2048</span><span>|</span><a href="#41070301">prev</a><span>|</span><a href="#41075894">next</a><span>|</span><label class="collapse" for="c-41070944">[-]</label><label class="expand" for="c-41070944">[3 more]</label></div><br/><div class="children"><div class="content">Nice work. Just FYI for anybody else - it adds an icon to status bar (if that&#x27;s what it&#x27;s called? - top right icons). I thought it was going to open an app window and didn&#x27;t notice the icon, so thought it wasn&#x27;t working. (In hindsight, it&#x27;s clear from screenshots in app store).</div><br/><div id="41071037" class="c"><input type="checkbox" id="c-41071037" checked=""/><div class="controls bullet"><span class="by">asrael_io</span><span>|</span><a href="#41070944">parent</a><span>|</span><a href="#41075894">next</a><span>|</span><label class="collapse" for="c-41071037">[-]</label><label class="expand" for="c-41071037">[2 more]</label></div><br/><div class="children"><div class="content">I think it&#x27;s called the menu bar, and apps that don&#x27;t open windows (with an icon in the menu bar) are known as &quot;menu bar apps&quot;. Until recently, these were a PITA to implement with Apple&#x27;s SDK. Thankfully they provided API support sometime I think starting with macOS 13... before that it was pretty kludgy.</div><br/><div id="41072727" class="c"><input type="checkbox" id="c-41072727" checked=""/><div class="controls bullet"><span class="by">rgovostes</span><span>|</span><a href="#41070944">root</a><span>|</span><a href="#41071037">parent</a><span>|</span><a href="#41075894">next</a><span>|</span><label class="collapse" for="c-41072727">[-]</label><label class="expand" for="c-41072727">[1 more]</label></div><br/><div class="children"><div class="content">The menus themselves are called &quot;menu bar extras&quot;: <a href="https:&#x2F;&#x2F;developer.apple.com&#x2F;design&#x2F;human-interface-guidelines&#x2F;the-menu-bar#Menu-bar-extras" rel="nofollow">https:&#x2F;&#x2F;developer.apple.com&#x2F;design&#x2F;human-interface-guideline...</a></div><br/></div></div></div></div></div></div><div id="41075894" class="c"><input type="checkbox" id="c-41075894" checked=""/><div class="controls bullet"><span class="by">jheriko</span><span>|</span><a href="#41070944">prev</a><span>|</span><a href="#41074328">next</a><span>|</span><label class="collapse" for="c-41075894">[-]</label><label class="expand" for="c-41075894">[3 more]</label></div><br/><div class="children"><div class="content">this looks incredibly bad from the implementation. there is a much simpler algorithm that works for hundreds of years in either direction of the present...<p>by comparison this is an absolute mountain of code. here is a good one - but note that it is only so accurate for each quarter phase (...and not sure why it destroys the formatting):<p>function approximateMoonPhase(julianDay)<p>{<p><pre><code>    &#x2F;&#x2F; from Meeus p.319

    &#x2F;&#x2F; JDE = 2451 550.09765 + 29.530 588 853 k

    &#x2F;&#x2F; + 0.000 1337 T2

    &#x2F;&#x2F; - 0.000 000 150 T3

    &#x2F;&#x2F; + 0.000 000 000 73 T4

    const t = toJulianCenturiesSinceJ2000(julianDay);

    const lhs = julianDay - 2451550.09765 + (-0.0001337 + (0.00000015 - 0.00000000073 * t) * t) * t * t;

    return lhs &#x2F; 29.530588853;
</code></pre>
}<p>enjoy. its from the same source as your work appears to use...<p>which, as someone who as implemented a ton of this stuff. its kind of a damning sentiment that we still refer to such an old book instead of learning the problem space and making better solutions... i have a whole book in me about this at some point.</div><br/><div id="41076765" class="c"><input type="checkbox" id="c-41076765" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#41075894">parent</a><span>|</span><a href="#41076791">next</a><span>|</span><label class="collapse" for="c-41076765">[-]</label><label class="expand" for="c-41076765">[1 more]</label></div><br/><div class="children"><div class="content">&gt; but note that it is only so accurate for each quarter phase<p>So it&#x27;s not actually comparable at all?</div><br/></div></div><div id="41076791" class="c"><input type="checkbox" id="c-41076791" checked=""/><div class="controls bullet"><span class="by">loufe</span><span>|</span><a href="#41075894">parent</a><span>|</span><a href="#41076765">prev</a><span>|</span><a href="#41074328">next</a><span>|</span><label class="collapse" for="c-41076791">[-]</label><label class="expand" for="c-41076791">[1 more]</label></div><br/><div class="children"><div class="content">You almost earned a downvote from me for the unnecessarily negative tone. You have a great post and the idea that there&#x27;s a more elegant solution is awesome, but I&#x27;m puzzled why you chose to phrase your response that way.<p>To your point though, is this your solution? Is the accuracy helped by using more precise numbers or is it more of a structural limitation?</div><br/></div></div></div></div><div id="41074328" class="c"><input type="checkbox" id="c-41074328" checked=""/><div class="controls bullet"><span class="by">whartung</span><span>|</span><a href="#41075894">prev</a><span>|</span><a href="#41072463">next</a><span>|</span><label class="collapse" for="c-41074328">[-]</label><label class="expand" for="c-41074328">[2 more]</label></div><br/><div class="children"><div class="content">And then, there was an anecdote!<p>I bought my friends daughter a watch for her birthday. She was, like, 12 or something. I got it at Target.<p>And it had a moon phase dial! How about that?!<p>So I was determined to set it accurately for her.<p>To wit I started dredging through the internet. And to be completely honest, I&#x27;m not quite sure how I was doing that, having nothing but a Netcom.com shell account available to me. Perhaps I was using Lynx, or using some mail gateway, or who knows what. It wasn&#x27;t no 10 seconds on Google, I&#x27;ll tell you that.<p>In the end, I stumbled upon some code for my HP-48. Aha! This should do nicely!<p>Somehow, I got the code into the calculator. Did I type it in? Did I download it over Kermit? Who knows. Times were moving fast back then. Somehow, someway, however, I got that code in and calculated away.<p>Finally! ACCURATE results. Done with precision and math and engineering. Done Right!<p>To wit, I then proceeded to get the watch set properly.<p>And...it was a fashion watch for a 12 year old girl from Target. This may come as a shock to some, I was obviously taken aback by it, however -- the moon phase did not work. It was just a moon on a dial that moved, though some undetermined mechanism. It could not be set independently.<p>Oh.</div><br/></div></div><div id="41072463" class="c"><input type="checkbox" id="c-41072463" checked=""/><div class="controls bullet"><span class="by">gmiller123456</span><span>|</span><a href="#41074328">prev</a><span>|</span><a href="#41071959">next</a><span>|</span><label class="collapse" for="c-41072463">[-]</label><label class="expand" for="c-41072463">[2 more]</label></div><br/><div class="children"><div class="content">I have a site with a lot of these stand alone &quot;snippets&quot; so that you don&#x27;t have to include&#x2F;port an entire astronomy library just to get the Sun rise&#x2F;set times, etc.  <a href="https:&#x2F;&#x2F;www.celestialprogramming.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.celestialprogramming.com&#x2F;</a><p>Most of them are written in JavaScript only, but specifically written to be easy to port to other languages.</div><br/></div></div><div id="41071959" class="c"><input type="checkbox" id="c-41071959" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#41072463">prev</a><span>|</span><a href="#41072570">next</a><span>|</span><label class="collapse" for="c-41071959">[-]</label><label class="expand" for="c-41071959">[5 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s a tiny calculator for moon phase that I kludged up ca. 2018 but (at least as of this month) is still tracking the full moon (which makes sense given that the algo came out of a dead tree source from over half a century ago?):<p><pre><code>  _=min
  lphase = lambda y,m,d: _( lkp(ph,p)
        for lkp in [lambda t,x: _(v for (kl,v),(kh,w)
                        in zip(t,t[1:]) if kl &lt;= x &lt; kh)]
        for daynum  in [lambda y,m,d: daynum(y-1,m+12,d) if m&lt;3 else
                         y*365 + y&#x2F;&#x2F;4 - y&#x2F;&#x2F;100 + y&#x2F;&#x2F;400 + (153*m+3)&#x2F;&#x2F;5 + d]
        for o   in [daynum(y,m,d)-daynum(2000,1,6)]
        for p   in [o%29.53] # mean; varies significantly!
        for ph  in [[(0,&quot;new&quot;),(0.5,&quot;waxing crescent&quot;),(7,&quot;first quarter&quot;),
                (8,&quot;waxing gibbous&quot;),(14.5,&quot;full&quot;),(15.5,&quot;waning gibbous&quot;),
                (21.7,&quot;last quarter&quot;),(22.7,&quot;waning crescent&quot;),(29,&quot;new&quot;),
                (30,None)]] )</code></pre></div><br/><div id="41072371" class="c"><input type="checkbox" id="c-41072371" checked=""/><div class="controls bullet"><span class="by">madcaptenor</span><span>|</span><a href="#41071959">parent</a><span>|</span><a href="#41072543">next</a><span>|</span><label class="collapse" for="c-41072371">[-]</label><label class="expand" for="c-41072371">[3 more]</label></div><br/><div class="children"><div class="content">So this is just saying that the phase of the moon is the day mod 29.53, starting from a new moon on 2000-01-06.  That&#x27;s about a minute off the actual mean length of a lunation - I guess the error from that approximation is less than the approximation in your &quot;varies significantly&quot;?<p>(For what it&#x27;s worth - 29.53 * 300 = 8859 exactly, and 2000-01-06 + 8859 days = 2024-04-08, and I am quite sure there was a new moon on the latter date because of the solar eclipse.)</div><br/><div id="41072665" class="c"><input type="checkbox" id="c-41072665" checked=""/><div class="controls bullet"><span class="by">082349872349872</span><span>|</span><a href="#41071959">root</a><span>|</span><a href="#41072371">parent</a><span>|</span><a href="#41072543">next</a><span>|</span><label class="collapse" for="c-41072665">[-]</label><label class="expand" for="c-41072665">[2 more]</label></div><br/><div class="children"><div class="content">Yes. (any cultures that have a purely lunar calendar could do away with all the date fiddling? but then again, I guess they&#x27;d just <i>know</i> when the next full moon would be...)<p>[If that constant is only a minute off, it ought to be good for a few centuries more, and I&#x27;m not planning on being around longer than decades, so probably good enough for my purposes.]</div><br/><div id="41073023" class="c"><input type="checkbox" id="c-41073023" checked=""/><div class="controls bullet"><span class="by">gmiller123456</span><span>|</span><a href="#41071959">root</a><span>|</span><a href="#41072665">parent</a><span>|</span><a href="#41072543">next</a><span>|</span><label class="collapse" for="c-41073023">[-]</label><label class="expand" for="c-41073023">[1 more]</label></div><br/><div class="children"><div class="content">I think the point is that the lunations vary by a couple of days within a year, so you might confuse users by stating a phase is on the wrong day when they are unaware a low accuracy algorithm is being used.  But that algorithm probably would be good enough for just drawing an icon, since the differences would be imperceptable.<p>Honestly, I recommend people use the most accurate algorithm they practically can, even if it&#x27;s overkill for the given application.  This just avoids user confusion when different apps give different answers, even if it&#x27;s not significant.<p>E.g., I have ported VSOP87 which gives the position of the moon and planets to sub-arcsecond accuracy to a couple of dozen languages.  They are much, much longer than the &quot;snippets&quot;, but are not impractical, and users won&#x27;t notice much difference in application size or computation time.  <a href="https:&#x2F;&#x2F;github.com&#x2F;gmiller123456&#x2F;vsop87-multilang">https:&#x2F;&#x2F;github.com&#x2F;gmiller123456&#x2F;vsop87-multilang</a></div><br/></div></div></div></div></div></div></div></div><div id="41072570" class="c"><input type="checkbox" id="c-41072570" checked=""/><div class="controls bullet"><span class="by">kickingvegas</span><span>|</span><a href="#41071959">prev</a><span>|</span><label class="collapse" for="c-41072570">[-]</label><label class="expand" for="c-41072570">[3 more]</label></div><br/><div class="children"><div class="content">Side note, if you use Emacs you can get the phases of the Moon by pressing “M” in either calendar or Org Agenda.</div><br/><div id="41073178" class="c"><input type="checkbox" id="c-41073178" checked=""/><div class="controls bullet"><span class="by">eesmith</span><span>|</span><a href="#41072570">parent</a><span>|</span><a href="#41074809">next</a><span>|</span><label class="collapse" for="c-41073178">[-]</label><label class="expand" for="c-41073178">[1 more]</label></div><br/><div class="children"><div class="content">With M-x lunar-phases you get the next three lunar months; something like:<p><pre><code>  Thursday, June 6, 2024: New Moon 8:40am (EDT)
  Friday, June 14, 2024: First Quarter Moon 1:20am (EDT)
     .. I removed a few lines ...
  Monday, August 19, 2024: Full Moon 2:24pm (EDT)
  Monday, August 26, 2024: Last Quarter Moon 5:34am (EDT
</code></pre>
Also, M-x sunrise-sunset computes sunrise and sunset after you give it lat&#x2F;long.</div><br/></div></div></div></div></div></div></div></div></div></body></html>