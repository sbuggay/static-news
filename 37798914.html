<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696669263483" as="style"/><link rel="stylesheet" href="styles.css?v=1696669263483"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/markmoxon/nes-elite-beebasm">Documented source code for Elite on the NES</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>ibobev</span> | <span>18 comments</span></div><br/><div><div id="37799944" class="c"><input type="checkbox" id="c-37799944" checked=""/><div class="controls bullet"><span class="by">abainbridge</span><span>|</span><a href="#37800052">next</a><span>|</span><label class="collapse" for="c-37799944">[-]</label><label class="expand" for="c-37799944">[2 more]</label></div><br/><div class="children"><div class="content">Many years ago, when I worked at Frontier, David Braben told me a fun anecdote about NES Elite. He said they initially got the game working using the hardware timer in the NES to keep track of real time so that the in-game physics progressed at a constant rate regardless of the frame rate, which varied. When they submitted the game to Nintendo for pre-release checks, Nintendo said they couldn&#x27;t use the hardware timer because a few of the earliest NESs didn&#x27;t have working ones. So Bell&#x2F;Braben had to make the functions in the game maintain their own estimate of how many clock cycles they each took that frame. At the end of the frame they were all added up and used as an estimate for how much real time had elapsed.<p>Looking at the source github, it appears I misremembered, or likely didn&#x27;t even understand what Braben was saying. elite-source-bank-7.asm has a comment saying, &quot;Update the NMI timer, which we can use in place of hardware timers (which the NES does not support)&quot;. It looks like they somehow implemented their own real time (ish) clock by counting non-maskable interrupts.</div><br/><div id="37800075" class="c"><input type="checkbox" id="c-37800075" checked=""/><div class="controls bullet"><span class="by">NobodyNada</span><span>|</span><a href="#37799944">parent</a><span>|</span><a href="#37800052">next</a><span>|</span><label class="collapse" for="c-37800075">[-]</label><label class="expand" for="c-37800075">[1 more]</label></div><br/><div class="children"><div class="content">Yes, I bet you’re misremembering something — no released NES has a “hardware timer”, in any revision.<p>The earliest revisions of the NES CPU <i>do</i> remnants of a buggy and disabled programmable interval timer on the die: <a href="https:&#x2F;&#x2F;www.nesdev.org&#x2F;wiki&#x2F;RP2A03_Programmable_Interval_Timer" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.nesdev.org&#x2F;wiki&#x2F;RP2A03_Programmable_Interval_Tim...</a>. This was fully removed in later revisions. Perhaps this was enabled on a dev kit or something — relying on functionality that never worked on consumer units certainly would have led to Nintendo rejecting it during testing.<p>But even if released consoles had a PIT, it would only be very useful for sub-frame measurements for e.g. timing precise raster effects. Counting NMIs would be by far the most sensible way to measure real time. The NMI fires at the start of each video frame, which is extremely consistent at 60.0988 Hz, and not affected by in-game processing (i.e. game engine may run at a slower&#x2F;variable framerate if it can’t keep up, but nothing that happens CPU-side can affect the timing of the video signal in any way; the rendering process runs off a fixed timer in hardware).<p>(FWIW, the audio hardware also has the ability to generate timer interrupts, and many expansion chips have scanline counters that can generate timer interrupts if you need fine-grained synchronization to the rendering process. There’s no shortage of ways to measure time on the NES if you need it).</div><br/></div></div></div></div><div id="37800052" class="c"><input type="checkbox" id="c-37800052" checked=""/><div class="controls bullet"><span class="by">ralferoo</span><span>|</span><a href="#37799944">prev</a><span>|</span><a href="#37800073">next</a><span>|</span><label class="collapse" for="c-37800052">[-]</label><label class="expand" for="c-37800052">[1 more]</label></div><br/><div class="children"><div class="content">I like how the start of every bank contains a bank switch shim like this:<p><pre><code>  SEI
  INC $C006
  JMP BEGIN 
</code></pre>
Then it goes into a lot of detail about how it does this to save space, but it seems to me that the only reason the JMP is even needed is because of the instruction pipeline, which could be flushed with just a NOP. So here&#x27;s my 2 byte optimisation to this code:<p><pre><code>  SEI
  INC $FFFD ; use the C0 in the instruction vector instead
  NOP</code></pre></div><br/></div></div><div id="37800073" class="c"><input type="checkbox" id="c-37800073" checked=""/><div class="controls bullet"><span class="by">ttctciyf</span><span>|</span><a href="#37800052">prev</a><span>|</span><a href="#37799418">next</a><span>|</span><label class="collapse" for="c-37800073">[-]</label><label class="expand" for="c-37800073">[1 more]</label></div><br/><div class="children"><div class="content">I embarked on Elite: Dangerous, the successor game, recently. It has its share of problems, granted, but nonetheless is a pretty amazing experience.<p>Seeing the continuity of game elements from the 1984 version (which I also sunk hours into) is weirdly moving. Seeing the same game objects like the ships and especially the Coriolis station transformed from vector graphics on a 16K memory-mapped screen (SOTA at the time!) to fully rendered 3D at 60fps was more of an emotional ride for me than I expected. Finally experiencing the detailed Coriolis interior complete with advertising hoardings, plant and docking gear moistened my eyes somewhat I don&#x27;t mind admitting.<p>Despite current difficulties the game is a precious institution, I really hope it sticks around in some form or other!</div><br/></div></div><div id="37799418" class="c"><input type="checkbox" id="c-37799418" checked=""/><div class="controls bullet"><span class="by">LeoPanthera</span><span>|</span><a href="#37800073">prev</a><span>|</span><a href="#37799690">next</a><span>|</span><label class="collapse" for="c-37799418">[-]</label><label class="expand" for="c-37799418">[2 more]</label></div><br/><div class="children"><div class="content">Ian Bell, author of Elite, claimed that the NES version was his personal favorite 8-bit version of Elite.<p>(He liked the 32-bit Archimedes port the best overall.)</div><br/><div id="37799676" class="c"><input type="checkbox" id="c-37799676" checked=""/><div class="controls bullet"><span class="by">pipes</span><span>|</span><a href="#37799418">parent</a><span>|</span><a href="#37799690">next</a><span>|</span><label class="collapse" for="c-37799676">[-]</label><label class="expand" for="c-37799676">[1 more]</label></div><br/><div class="children"><div class="content">But they removed trading slaves and narcotics! :)<p>(I think)</div><br/></div></div></div></div><div id="37799690" class="c"><input type="checkbox" id="c-37799690" checked=""/><div class="controls bullet"><span class="by">Apocryphon</span><span>|</span><a href="#37799418">prev</a><span>|</span><a href="#37799845">next</a><span>|</span><label class="collapse" for="c-37799690">[-]</label><label class="expand" for="c-37799690">[1 more]</label></div><br/><div class="children"><div class="content">In contrast, here&#x27;s the source code for Oolite, the open source Elite clone written in Objective-C: <a href="https:&#x2F;&#x2F;github.com&#x2F;OoliteProject&#x2F;oolite">https:&#x2F;&#x2F;github.com&#x2F;OoliteProject&#x2F;oolite</a><p><a href="https:&#x2F;&#x2F;oolite.space" rel="nofollow noreferrer">https:&#x2F;&#x2F;oolite.space</a><p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=7894145">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=7894145</a></div><br/></div></div><div id="37799845" class="c"><input type="checkbox" id="c-37799845" checked=""/><div class="controls bullet"><span class="by">BrissyCoder</span><span>|</span><a href="#37799690">prev</a><span>|</span><a href="#37799899">next</a><span>|</span><label class="collapse" for="c-37799845">[-]</label><label class="expand" for="c-37799845">[1 more]</label></div><br/><div class="children"><div class="content">I played it on the C64 as an 8 year old. 30 years later I don&#x27;t understand this code.</div><br/></div></div><div id="37799899" class="c"><input type="checkbox" id="c-37799899" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#37799845">prev</a><span>|</span><a href="#37799391">next</a><span>|</span><label class="collapse" for="c-37799899">[-]</label><label class="expand" for="c-37799899">[1 more]</label></div><br/><div class="children"><div class="content">Maybe someone can finally port it to run on NTSC consoles.  Would still take a lot of scanlines to cut out though.</div><br/></div></div><div id="37799391" class="c"><input type="checkbox" id="c-37799391" checked=""/><div class="controls bullet"><span class="by">raytopia</span><span>|</span><a href="#37799899">prev</a><span>|</span><a href="#37799965">next</a><span>|</span><label class="collapse" for="c-37799391">[-]</label><label class="expand" for="c-37799391">[6 more]</label></div><br/><div class="children"><div class="content">18305 lines of assembly for bank 0... I have no clue how you&#x27;d keep that in your head.</div><br/><div id="37799481" class="c"><input type="checkbox" id="c-37799481" checked=""/><div class="controls bullet"><span class="by">LeoPanthera</span><span>|</span><a href="#37799391">parent</a><span>|</span><a href="#37799721">next</a><span>|</span><label class="collapse" for="c-37799481">[-]</label><label class="expand" for="c-37799481">[1 more]</label></div><br/><div class="children"><div class="content">Back when I was writing 6502, you didn&#x27;t keep it all in your head, you kept it in reams of tractor-fed dot matrix paper, usually with a lot of scribbled pencil notes and corrections.</div><br/></div></div><div id="37799721" class="c"><input type="checkbox" id="c-37799721" checked=""/><div class="controls bullet"><span class="by">yetanotherloss</span><span>|</span><a href="#37799391">parent</a><span>|</span><a href="#37799481">prev</a><span>|</span><a href="#37799912">next</a><span>|</span><label class="collapse" for="c-37799721">[-]</label><label class="expand" for="c-37799721">[2 more]</label></div><br/><div class="children"><div class="content">We were out better selves back then.<p>Seriously though any project of size almost had to involve large amounts of code written or printed on paper. Lots and lots of paper.</div><br/><div id="37800001" class="c"><input type="checkbox" id="c-37800001" checked=""/><div class="controls bullet"><span class="by">anthk</span><span>|</span><a href="#37799391">root</a><span>|</span><a href="#37799721">parent</a><span>|</span><a href="#37799912">next</a><span>|</span><label class="collapse" for="c-37800001">[-]</label><label class="expand" for="c-37800001">[1 more]</label></div><br/><div class="children"><div class="content">Well, it depends. On some environments such as Lucas Arts they used Unix based OSes to develop SCUMM. With grep and such, editing and porting the engine could have been a breeze.</div><br/></div></div></div></div><div id="37799912" class="c"><input type="checkbox" id="c-37799912" checked=""/><div class="controls bullet"><span class="by">PUSH_AX</span><span>|</span><a href="#37799391">parent</a><span>|</span><a href="#37799721">prev</a><span>|</span><a href="#37799965">next</a><span>|</span><label class="collapse" for="c-37799912">[-]</label><label class="expand" for="c-37799912">[2 more]</label></div><br/><div class="children"><div class="content">Can anyone explain this to a modern engineer? Why would you need to hold this in your head?</div><br/><div id="37800082" class="c"><input type="checkbox" id="c-37800082" checked=""/><div class="controls bullet"><span class="by">imjonse</span><span>|</span><a href="#37799391">root</a><span>|</span><a href="#37799912">parent</a><span>|</span><a href="#37799965">next</a><span>|</span><label class="collapse" for="c-37800082">[-]</label><label class="expand" for="c-37800082">[1 more]</label></div><br/><div class="children"><div class="content">Possibly lack of tools that make code search&#x2F;navigation easy.</div><br/></div></div></div></div></div></div><div id="37799965" class="c"><input type="checkbox" id="c-37799965" checked=""/><div class="controls bullet"><span class="by">anthk</span><span>|</span><a href="#37799391">prev</a><span>|</span><label class="collapse" for="c-37799965">[-]</label><label class="expand" for="c-37799965">[2 more]</label></div><br/><div class="children"><div class="content">Not libre. Too bad, if I were the Elite creator I&#x27;d put all the game ports under a libre license. Anyway, nowadays you can play Oolite on a cheap netbook and have the exact same fun, if not more due to the huge addon list for it.</div><br/><div id="37800112" class="c"><input type="checkbox" id="c-37800112" checked=""/><div class="controls bullet"><span class="by">lstodd</span><span>|</span><a href="#37799965">parent</a><span>|</span><label class="collapse" for="c-37800112">[-]</label><label class="expand" for="c-37800112">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s Braben being a dick about copyright. Bell on the other hand was a nice guy and released most that he himself wrote.</div><br/></div></div></div></div></div></div></div></div></div></body></html>