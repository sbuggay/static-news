<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1736672473216" as="style"/><link rel="stylesheet" href="styles.css?v=1736672473216"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://joyofrails.com/articles/simple-trick-to-understand-ruby-lazy-enumerator">A visual demo of Ruby&#x27;s lazy enumerator</a> <span class="domain">(<a href="https://joyofrails.com">joyofrails.com</a>)</span></div><div class="subtext"><span>rossta</span> | <span>24 comments</span></div><br/><div><div id="42669332" class="c"><input type="checkbox" id="c-42669332" checked=""/><div class="controls bullet"><span class="by">afraca</span><span>|</span><a href="#42671955">next</a><span>|</span><label class="collapse" for="c-42669332">[-]</label><label class="expand" for="c-42669332">[2 more]</label></div><br/><div class="children"><div class="content">When I learned Haskell in college I was blown away by how laziness enables cool things like dealing with infinite lists or more performance even though the UX is exactly the same. (Apparently with Ruby there is the slight hint of adding the lazy method in between)<p>Later I found out laziness in the whole system by default leads to some difficult issues, which quite a few people seem to agree with. Simon Peyton Jones (Haskell co-creator) apparently has said &quot;The next Haskell will be strict&quot;. (<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=14011943">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=14011943</a>)</div><br/><div id="42669723" class="c"><input type="checkbox" id="c-42669723" checked=""/><div class="controls bullet"><span class="by">drnewman</span><span>|</span><a href="#42669332">parent</a><span>|</span><a href="#42671955">next</a><span>|</span><label class="collapse" for="c-42669723">[-]</label><label class="expand" for="c-42669723">[1 more]</label></div><br/><div class="children"><div class="content">Laziness is great for collections, and modeling the infinite but as a general model for programming it&#x27;s a little loopy for my taste too ;-)</div><br/></div></div></div></div><div id="42671955" class="c"><input type="checkbox" id="c-42671955" checked=""/><div class="controls bullet"><span class="by">pansa2</span><span>|</span><a href="#42669332">prev</a><span>|</span><a href="#42672162">next</a><span>|</span><label class="collapse" for="c-42671955">[-]</label><label class="expand" for="c-42671955">[2 more]</label></div><br/><div class="children"><div class="content">So in Ruby, `map` and `select` are eager-by-default, but you can just write `lazy.map().select()` to make the <i>whole chain</i> lazy? That&#x27;s really nice - much better than Python 2, which was also eager-by-default and you had to change every function call to make it lazy (`map` =&gt; `imap`, `filter` =&gt; `ifilter`).<p>Python 3 changed to being lazy-by-default. I assume that improves CPU&#x2F;memory usage, but in some cases it does have less predictable behaviour. I can see why Ruby, with its goal of &quot;developer happiness&quot;, would choose to retain the predictable behaviour of eager-by-default.</div><br/><div id="42672073" class="c"><input type="checkbox" id="c-42672073" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#42671955">parent</a><span>|</span><a href="#42672162">next</a><span>|</span><label class="collapse" for="c-42672073">[-]</label><label class="expand" for="c-42672073">[1 more]</label></div><br/><div class="children"><div class="content">Swift does this too, with almost the same syntax. IMO it&#x27;s the right choice.</div><br/></div></div></div></div><div id="42672162" class="c"><input type="checkbox" id="c-42672162" checked=""/><div class="controls bullet"><span class="by">lukasb</span><span>|</span><a href="#42671955">prev</a><span>|</span><a href="#42668572">next</a><span>|</span><label class="collapse" for="c-42672162">[-]</label><label class="expand" for="c-42672162">[1 more]</label></div><br/><div class="children"><div class="content">Apparently Typescript doesn’t have anything built-in like this?</div><br/></div></div><div id="42668572" class="c"><input type="checkbox" id="c-42668572" checked=""/><div class="controls bullet"><span class="by">adsteel_</span><span>|</span><a href="#42672162">prev</a><span>|</span><a href="#42667308">next</a><span>|</span><label class="collapse" for="c-42668572">[-]</label><label class="expand" for="c-42668572">[2 more]</label></div><br/><div class="children"><div class="content">Hm, the CSS and JS don&#x27;t appear to load for me. Not even a &lt;body&gt;&lt;html&gt; set of tags in the HTML response.</div><br/><div id="42669247" class="c"><input type="checkbox" id="c-42669247" checked=""/><div class="controls bullet"><span class="by">fredrikholm</span><span>|</span><a href="#42668572">parent</a><span>|</span><a href="#42667308">next</a><span>|</span><label class="collapse" for="c-42669247">[-]</label><label class="expand" for="c-42669247">[1 more]</label></div><br/><div class="children"><div class="content">Same here, both on computer and mobile. The rest of the website looks fine.</div><br/></div></div></div></div><div id="42667308" class="c"><input type="checkbox" id="c-42667308" checked=""/><div class="controls bullet"><span class="by">Syntaf</span><span>|</span><a href="#42668572">prev</a><span>|</span><a href="#42668083">next</a><span>|</span><label class="collapse" for="c-42667308">[-]</label><label class="expand" for="c-42667308">[2 more]</label></div><br/><div class="children"><div class="content">Really cool visualization and neat to learn about lazy enumeration!<p>Excuse me while I go back through my code and make sure I’m using lazy enumeration wherever I’m iterating over large collections….</div><br/><div id="42668434" class="c"><input type="checkbox" id="c-42668434" checked=""/><div class="controls bullet"><span class="by">dylan604</span><span>|</span><a href="#42667308">parent</a><span>|</span><a href="#42668083">next</a><span>|</span><label class="collapse" for="c-42668434">[-]</label><label class="expand" for="c-42668434">[1 more]</label></div><br/><div class="children"><div class="content">This sounds like a similar response I had when learning about stream editors vs text editors. It was one of the killer apps that convinced to become a CLI warrior. Opening up a large text file in Notepad took for ever, but opening the same file in vim was a nothing burger. Then, the same person that showed me that showed me sed&#x2F;awk&#x2F;grep, and I was off to the races.</div><br/></div></div></div></div><div id="42668083" class="c"><input type="checkbox" id="c-42668083" checked=""/><div class="controls bullet"><span class="by">hakunin</span><span>|</span><a href="#42667308">prev</a><span>|</span><a href="#42667120">next</a><span>|</span><label class="collapse" for="c-42668083">[-]</label><label class="expand" for="c-42668083">[6 more]</label></div><br/><div class="children"><div class="content">Lazy enumeration can also save memory, because you aren’t storing entire collections during intermediate steps, and it works with infinite&#x2F;unknown size collections. Such as streaming data.<p>Some examples:<p>I wrote a utility gem a while ago that lets you lazily intersect, union, etc various potentially infinite streams of data. <a href="https:&#x2F;&#x2F;github.com&#x2F;maxim&#x2F;enum_utils&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;maxim&#x2F;enum_utils&#x2F;</a><p>I also used lazy enumeration for traversing the wordmap in my no-RAM static storage gem. <a href="https:&#x2F;&#x2F;github.com&#x2F;maxim&#x2F;wordmap&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;maxim&#x2F;wordmap&#x2F;</a></div><br/><div id="42668756" class="c"><input type="checkbox" id="c-42668756" checked=""/><div class="controls bullet"><span class="by">hansvm</span><span>|</span><a href="#42668083">parent</a><span>|</span><a href="#42668985">next</a><span>|</span><label class="collapse" for="c-42668756">[-]</label><label class="expand" for="c-42668756">[3 more]</label></div><br/><div class="children"><div class="content">In the worst case, that must have intermediate space requirements equal to the entire collections, right?</div><br/><div id="42668884" class="c"><input type="checkbox" id="c-42668884" checked=""/><div class="controls bullet"><span class="by">hakunin</span><span>|</span><a href="#42668083">root</a><span>|</span><a href="#42668756">parent</a><span>|</span><a href="#42668985">next</a><span>|</span><label class="collapse" for="c-42668884">[-]</label><label class="expand" for="c-42668884">[2 more]</label></div><br/><div class="children"><div class="content">I don’t think that can happen because all those functions assume the streams are consistently sorted.</div><br/><div id="42668995" class="c"><input type="checkbox" id="c-42668995" checked=""/><div class="controls bullet"><span class="by">hansvm</span><span>|</span><a href="#42668083">root</a><span>|</span><a href="#42668884">parent</a><span>|</span><a href="#42668985">next</a><span>|</span><label class="collapse" for="c-42668995">[-]</label><label class="expand" for="c-42668995">[1 more]</label></div><br/><div class="children"><div class="content">Ohhhhh, nice. Yeah, sorted data is powerful. Thanks for pointing that out.</div><br/></div></div></div></div></div></div><div id="42668985" class="c"><input type="checkbox" id="c-42668985" checked=""/><div class="controls bullet"><span class="by">pyinstallwoes</span><span>|</span><a href="#42668083">parent</a><span>|</span><a href="#42668756">prev</a><span>|</span><a href="#42667120">next</a><span>|</span><label class="collapse" for="c-42668985">[-]</label><label class="expand" for="c-42668985">[2 more]</label></div><br/><div class="children"><div class="content">How is it different than a window, rolling window?</div><br/><div id="42669061" class="c"><input type="checkbox" id="c-42669061" checked=""/><div class="controls bullet"><span class="by">hakunin</span><span>|</span><a href="#42668083">root</a><span>|</span><a href="#42668985">parent</a><span>|</span><a href="#42667120">next</a><span>|</span><label class="collapse" for="c-42669061">[-]</label><label class="expand" for="c-42669061">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s probably a version of that. But since data is assumed sorted, memory requirements almost never grow beyond one item per stream.</div><br/></div></div></div></div></div></div><div id="42667120" class="c"><input type="checkbox" id="c-42667120" checked=""/><div class="controls bullet"><span class="by">endorphine</span><span>|</span><a href="#42668083">prev</a><span>|</span><a href="#42667300">next</a><span>|</span><label class="collapse" for="c-42667120">[-]</label><label class="expand" for="c-42667120">[6 more]</label></div><br/><div class="children"><div class="content">I was expecting a visual comparison towards the end of the article, where you would be able to click a button and both the eager and lazy versions would start executing simultaneously, one displayed next to the other, and you would clearly see that the lazy one completed earlier. This would make it even more obvious how the lazy one is faster.<p>Nevertheless, this was great.</div><br/><div id="42668419" class="c"><input type="checkbox" id="c-42668419" checked=""/><div class="controls bullet"><span class="by">rossta</span><span>|</span><a href="#42667120">parent</a><span>|</span><a href="#42667300">next</a><span>|</span><label class="collapse" for="c-42668419">[-]</label><label class="expand" for="c-42668419">[5 more]</label></div><br/><div class="children"><div class="content">Thanks for the feedback. I was thinking along those lines but settled on a version that let you toggle between the two. I’ll keep this in mind for next time though.<p>There are probably a lot of fun variations to explore. Since this post seemed to resonate, I may be motivated to try some more experiments.</div><br/><div id="42669116" class="c"><input type="checkbox" id="c-42669116" checked=""/><div class="controls bullet"><span class="by">robocat</span><span>|</span><a href="#42667120">root</a><span>|</span><a href="#42668419">parent</a><span>|</span><a href="#42670312">next</a><span>|</span><label class="collapse" for="c-42669116">[-]</label><label class="expand" for="c-42669116">[3 more]</label></div><br/><div class="children"><div class="content">I find horizontal&#x2F;vertical is usually confusing (not to you obviously). Here is an example: <a href="https:&#x2F;&#x2F;www.investopedia.com&#x2F;terms&#x2F;h&#x2F;horizontalanalysis.asp" rel="nofollow">https:&#x2F;&#x2F;www.investopedia.com&#x2F;terms&#x2F;h&#x2F;horizontalanalysis.asp</a> Maybe easier to stick with the lazy&#x2F;eager wording?</div><br/><div id="42669534" class="c"><input type="checkbox" id="c-42669534" checked=""/><div class="controls bullet"><span class="by">rossta</span><span>|</span><a href="#42667120">root</a><span>|</span><a href="#42669116">parent</a><span>|</span><a href="#42670312">next</a><span>|</span><label class="collapse" for="c-42669534">[-]</label><label class="expand" for="c-42669534">[2 more]</label></div><br/><div class="children"><div class="content">That’s fair. I acknowledge that terms like &quot;horizontal&quot; and &quot;vertical&quot; may be overloaded or even confusing, in this case, if it’s difficult to see the connection with the visuals. This is somewhat part of the risk in trying to explain a concept in a less-than precise way to introduce a new concept.</div><br/><div id="42671812" class="c"><input type="checkbox" id="c-42671812" checked=""/><div class="controls bullet"><span class="by">robocat</span><span>|</span><a href="#42667120">root</a><span>|</span><a href="#42669534">parent</a><span>|</span><a href="#42670312">next</a><span>|</span><label class="collapse" for="c-42671812">[-]</label><label class="expand" for="c-42671812">[1 more]</label></div><br/><div class="children"><div class="content">I love the visuals - they are fantastic at showing the difference.<p>If the visuals were vertical then the filtering might look more natural because time would be left-to-right and balls would have natural gravity and fall &quot;down&quot; through filters? Code runs top to bottom so I&#x27;m guessing it would still be clear.<p>And putting a number in each of the balls might help clarity too :-)<p>The only crazy thing is that Haskell lazy is pull (right) whereas Ruby lazy is still push - so the lazy keyword is somewhat confusing but that can&#x27;t be fixed.<p>I am not criticising and certainly don&#x27;t want to make unnecessary work for you. Graphic design and animation are dark arts!</div><br/></div></div></div></div></div></div><div id="42670312" class="c"><input type="checkbox" id="c-42670312" checked=""/><div class="controls bullet"><span class="by">Exuma</span><span>|</span><a href="#42667120">root</a><span>|</span><a href="#42668419">parent</a><span>|</span><a href="#42669116">prev</a><span>|</span><a href="#42667300">next</a><span>|</span><label class="collapse" for="c-42670312">[-]</label><label class="expand" for="c-42670312">[1 more]</label></div><br/><div class="children"><div class="content">Your site is broken...</div><br/></div></div></div></div></div></div><div id="42667300" class="c"><input type="checkbox" id="c-42667300" checked=""/><div class="controls bullet"><span class="by">thih9</span><span>|</span><a href="#42667120">prev</a><span>|</span><a href="#42666983">next</a><span>|</span><label class="collapse" for="c-42667300">[-]</label><label class="expand" for="c-42667300">[1 more]</label></div><br/><div class="children"><div class="content">Related discussion from yesterday:<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=42652775">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=42652775</a> (different submitter; 29 points, 3 comments)</div><br/></div></div><div id="42666983" class="c"><input type="checkbox" id="c-42666983" checked=""/><div class="controls bullet"><span class="by">Lio</span><span>|</span><a href="#42667300">prev</a><span>|</span><label class="collapse" for="c-42666983">[-]</label><label class="expand" for="c-42666983">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s lovely and makes it very obvious what&#x27;s happening.</div><br/></div></div></div></div></div></div></div></body></html>