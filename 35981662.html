<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1684400451676" as="style"/><link rel="stylesheet" href="styles.css?v=1684400451676"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://shaneosullivan.wordpress.com/2023/05/17/using-bun-js-as-a-bundler/">Using Bun.js as a Bundler</a> <span class="domain">(<a href="https://shaneosullivan.wordpress.com">shaneosullivan.wordpress.com</a>)</span></div><div class="subtext"><span>shaneos</span> | <span>38 comments</span></div><br/><div><div id="35982173" class="c"><input type="checkbox" id="c-35982173" checked=""/><div class="controls bullet"><span class="by">Jarred</span><span>|</span><a href="#35982401">next</a><span>|</span><label class="collapse" for="c-35982173">[-]</label><label class="expand" for="c-35982173">[2 more]</label></div><br/><div class="children"><div class="content">(I work on Bun)<p>Great writeup<p>We are working on the crash with the minifier + multiple entry points and hopefully will have a fix this week<p>&gt; Bun inserts code that looks like this at the bottom of the built file, in this case from a file called account.ts<p><pre><code>  var account_default = {};
  export {
    account_default as default
  };
</code></pre>
Currently, Bun only supports esm output so for this to work you&#x27;ll need `&lt;script type=&quot;module&quot;&gt;` instead of `&lt;script&gt;`. We will add support for IIFE though (which should fix this)<p>&gt; Hopefully Bun will implement fs.watch soon and I can throw out this code.<p>Yeah we need to do this. It&#x27;s not super hard and we have plenty of existing code for inotify and kqueue in place for watching files, there&#x27;s no good reason why we haven&#x27;t done this yet.<p>&gt; There’s something unfinished with Bun’s implementation of the child_process module that breaks when run in the Vercel build environment.<p>Currently, Bun.spawn &amp; Bun.spawnSync (which child_process uses internally) relies on `pidfd_open` (<a href="https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;pidfd_open.2.html" rel="nofollow">https:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;pidfd_open.2.html</a>) which Vercel, due to using AWS Lambda, does not support because it is on Linux Kernel 5.10 (3 years old). We need to add a fork() + exec() fallback for this<p>edit: it&#x27;s not pidfd_open, but it is one of these posix_spawn related calls that is missing</div><br/><div id="35985398" class="c"><input type="checkbox" id="c-35985398" checked=""/><div class="controls bullet"><span class="by">rjrodger</span><span>|</span><a href="#35982173">parent</a><span>|</span><a href="#35982401">next</a><span>|</span><label class="collapse" for="c-35985398">[-]</label><label class="expand" for="c-35985398">[1 more]</label></div><br/><div class="children"><div class="content">fs.watch is definitely a high priority in order to support day-to-day dev as a build system.<p>(Hey Jarred - Let’s get that zig package thing done soon!)</div><br/></div></div></div></div><div id="35982401" class="c"><input type="checkbox" id="c-35982401" checked=""/><div class="controls bullet"><span class="by">iainmerrick</span><span>|</span><a href="#35982173">prev</a><span>|</span><a href="#35982114">next</a><span>|</span><label class="collapse" for="c-35982401">[-]</label><label class="expand" for="c-35982401">[10 more]</label></div><br/><div class="children"><div class="content">It’ll take a lot to replace esbuild for me -- it’s fast enough that it’s never the bottleneck and more importantly has always been absolutely rock-solid and reliable. So a tool that’s 2x faster but less reliable isn’t appealing.</div><br/><div id="35984061" class="c"><input type="checkbox" id="c-35984061" checked=""/><div class="controls bullet"><span class="by">reilly3000</span><span>|</span><a href="#35982401">parent</a><span>|</span><a href="#35982443">next</a><span>|</span><label class="collapse" for="c-35984061">[-]</label><label class="expand" for="c-35984061">[4 more]</label></div><br/><div class="children"><div class="content">It isn’t clear to me that bun is less reliable. A day old bundling tool is not a fair yardstick for what I’m referring to. In general I haven’t heard about any reliability issues and see glowing reviews about its cold start time and thorough-put. If there are any I should be aware of please do share.</div><br/><div id="35984445" class="c"><input type="checkbox" id="c-35984445" checked=""/><div class="controls bullet"><span class="by">iainmerrick</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35984061">parent</a><span>|</span><a href="#35982443">next</a><span>|</span><label class="collapse" for="c-35984445">[-]</label><label class="expand" for="c-35984445">[3 more]</label></div><br/><div class="children"><div class="content">I was just thinking about the sort of issues described in this post, like having to use specific flags to prevent the minifier breaking code, or write an extra pass to tweak the output. I’d worry about what other problems there might be that I hadn’t noticed yet.<p>Presumably those will get fixed over time, and at some point bun will just work if you want to replace your existing bundler. But even then, I personally would lean to sticking with esbuild as it’s more than fast enough for my purposes -- extra speed isn’t a compelling selling point (for me).</div><br/><div id="35984789" class="c"><input type="checkbox" id="c-35984789" checked=""/><div class="controls bullet"><span class="by">shaneos</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35984445">parent</a><span>|</span><a href="#35982443">next</a><span>|</span><label class="collapse" for="c-35984789">[-]</label><label class="expand" for="c-35984789">[2 more]</label></div><br/><div class="children"><div class="content">Yes, Bun is very much in beta, but it&#x27;s already really, really good.  I&#x27;m fine using it with my hobby projects right now, but once it gets to 1.0 I&#x27;ll give serious consideration to using it in production code too.  The API is really simple, and I love how it just understands Typescript, so you can throw any code in your repo at it and it chugs away happily.</div><br/><div id="35984906" class="c"><input type="checkbox" id="c-35984906" checked=""/><div class="controls bullet"><span class="by">iainmerrick</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35984789">parent</a><span>|</span><a href="#35982443">next</a><span>|</span><label class="collapse" for="c-35984906">[-]</label><label class="expand" for="c-35984906">[1 more]</label></div><br/><div class="children"><div class="content">Yes, being able to just run TS directly is very appealing. When I last tried, neither bun nor deno nor ts-node worked out of the box for me. The other two seem to be a bit stuck in the weeds (deno aggressively trying to do its own thing, then backtracking and adding node compatibility back in; ts-node hampered by having to work around weird design decisions in both node and TS) so I wouldn’t be surprised if bun ends up as the winning TS engine.</div><br/></div></div></div></div></div></div></div></div><div id="35982443" class="c"><input type="checkbox" id="c-35982443" checked=""/><div class="controls bullet"><span class="by">throwme_123</span><span>|</span><a href="#35982401">parent</a><span>|</span><a href="#35984061">prev</a><span>|</span><a href="#35983408">next</a><span>|</span><label class="collapse" for="c-35982443">[-]</label><label class="expand" for="c-35982443">[4 more]</label></div><br/><div class="children"><div class="content">bun seems great and promising but I&#x27;m in the same boat. vite&#x2F;esbuild with vitest is running perfectly, and already fast enough (and at last not struggling with webpack or rollup overall poor quality anymore...).</div><br/><div id="35984652" class="c"><input type="checkbox" id="c-35984652" checked=""/><div class="controls bullet"><span class="by">eyelidlessness</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35982443">parent</a><span>|</span><a href="#35982656">next</a><span>|</span><label class="collapse" for="c-35984652">[-]</label><label class="expand" for="c-35984652">[1 more]</label></div><br/><div class="children"><div class="content">My problem with “Vite is good enough” and “Vitest is good enough” as a paired hypothesis is they are literally opposite in their target environments. It’s explicitly unsupported to use Vite to build projects specifically for Node as a target, and it’s explicitly unsupported to test in Vitest in browser environments (though I think that’s being actively addressed, but it’s still going to be a second class solution).</div><br/></div></div><div id="35982656" class="c"><input type="checkbox" id="c-35982656" checked=""/><div class="controls bullet"><span class="by">silverwind</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35982443">parent</a><span>|</span><a href="#35984652">prev</a><span>|</span><a href="#35982496">next</a><span>|</span><label class="collapse" for="c-35982656">[-]</label><label class="expand" for="c-35982656">[1 more]</label></div><br/><div class="children"><div class="content">bun can run vite prod build at least and seems about 10% faster at it than node according to my testing.</div><br/></div></div><div id="35982496" class="c"><input type="checkbox" id="c-35982496" checked=""/><div class="controls bullet"><span class="by">iainmerrick</span><span>|</span><a href="#35982401">root</a><span>|</span><a href="#35982443">parent</a><span>|</span><a href="#35982656">prev</a><span>|</span><a href="#35983408">next</a><span>|</span><label class="collapse" for="c-35982496">[-]</label><label class="expand" for="c-35982496">[1 more]</label></div><br/><div class="children"><div class="content">Yep, vite is really nice too.</div><br/></div></div></div></div><div id="35983408" class="c"><input type="checkbox" id="c-35983408" checked=""/><div class="controls bullet"><span class="by">8n4vidtmkvmk</span><span>|</span><a href="#35982401">parent</a><span>|</span><a href="#35982443">prev</a><span>|</span><a href="#35982114">next</a><span>|</span><label class="collapse" for="c-35983408">[-]</label><label class="expand" for="c-35983408">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve had bad experiences with esbuild. Don&#x27;t remember what specifically but didn&#x27;t work for my use cases.<p>Roll-up for libs and webpack for apps. Only thing that works for me and all the wonky edge cases involved in building for web and node and npm and old browsers and various file types and loaders and whatnot.</div><br/></div></div></div></div><div id="35982114" class="c"><input type="checkbox" id="c-35982114" checked=""/><div class="controls bullet"><span class="by">afavour</span><span>|</span><a href="#35982401">prev</a><span>|</span><a href="#35982142">next</a><span>|</span><label class="collapse" for="c-35982114">[-]</label><label class="expand" for="c-35982114">[10 more]</label></div><br/><div class="children"><div class="content">This is awesome but in case anyone was wondering: the author was previously using Webpack rather than a newer generation tool. So the speed benefits outlined here would likely be the same if they were still using Node with esbuild instead.<p>Overall I like Bun - diversity in JS ecosystems is a great thing - but I’m struggling to come up with reasons to actually use it (which is fine! As long as the author is enjoying the work, why not?)</div><br/><div id="35983003" class="c"><input type="checkbox" id="c-35983003" checked=""/><div class="controls bullet"><span class="by">000ooo000</span><span>|</span><a href="#35982114">parent</a><span>|</span><a href="#35982276">next</a><span>|</span><label class="collapse" for="c-35983003">[-]</label><label class="expand" for="c-35983003">[1 more]</label></div><br/><div class="children"><div class="content">&gt;I’m struggling to come up with reasons to actually use it (which is fine! As long as the author is enjoying the work, why not?)<p>I wish more people, or at least more HN commenters, had this attitude. Don&#x27;t have to look hard to find negativity in response to folks getting out there and having a go. How many passion projects went nowhere* but taught authors valuable shit that lead to incredible engineering and projects? Besides, I love writing software and anyone who says I shouldn&#x27;t because it isn&#x27;t going to be better than the status quo can beat it.<p>*not implying Bun is going nowhere. Be gone, pedants.</div><br/></div></div><div id="35982276" class="c"><input type="checkbox" id="c-35982276" checked=""/><div class="controls bullet"><span class="by">brundolf</span><span>|</span><a href="#35982114">parent</a><span>|</span><a href="#35983003">prev</a><span>|</span><a href="#35982137">next</a><span>|</span><label class="collapse" for="c-35982276">[-]</label><label class="expand" for="c-35982276">[3 more]</label></div><br/><div class="children"><div class="content">They weren&#x27;t using SWC? They describe deploying to Vercel, and Next.js has had stable built-in support for SWC for a good while now</div><br/><div id="35985490" class="c"><input type="checkbox" id="c-35985490" checked=""/><div class="controls bullet"><span class="by">re-thc</span><span>|</span><a href="#35982114">root</a><span>|</span><a href="#35982276">parent</a><span>|</span><a href="#35984576">next</a><span>|</span><label class="collapse" for="c-35985490">[-]</label><label class="expand" for="c-35985490">[1 more]</label></div><br/><div class="children"><div class="content">Webpack is the bundler. SWC as used in Next.js doesn&#x27;t do the bundling part.</div><br/></div></div><div id="35984576" class="c"><input type="checkbox" id="c-35984576" checked=""/><div class="controls bullet"><span class="by">byhemechi</span><span>|</span><a href="#35982114">root</a><span>|</span><a href="#35982276">parent</a><span>|</span><a href="#35985490">prev</a><span>|</span><a href="#35982137">next</a><span>|</span><label class="collapse" for="c-35984576">[-]</label><label class="expand" for="c-35984576">[1 more]</label></div><br/><div class="children"><div class="content">iirc next.js only uses swc for the dev mode bundler<p>edit: this is no longer the case, ignore me :)</div><br/></div></div></div></div><div id="35982137" class="c"><input type="checkbox" id="c-35982137" checked=""/><div class="controls bullet"><span class="by">paulddraper</span><span>|</span><a href="#35982114">parent</a><span>|</span><a href="#35982276">prev</a><span>|</span><a href="#35982803">next</a><span>|</span><label class="collapse" for="c-35982137">[-]</label><label class="expand" for="c-35982137">[1 more]</label></div><br/><div class="children"><div class="content">You can see at the beginning of the article a benchmark comparison with Webpack and esbuild.</div><br/></div></div><div id="35982803" class="c"><input type="checkbox" id="c-35982803" checked=""/><div class="controls bullet"><span class="by">taosx</span><span>|</span><a href="#35982114">parent</a><span>|</span><a href="#35982137">prev</a><span>|</span><a href="#35982142">next</a><span>|</span><label class="collapse" for="c-35982803">[-]</label><label class="expand" for="c-35982803">[4 more]</label></div><br/><div class="children"><div class="content">I use it a lot for small cli apps and during dev, it&#x27;s so nice to be able to run typescript files with bun instead of tsx or ts-node.</div><br/><div id="35984684" class="c"><input type="checkbox" id="c-35984684" checked=""/><div class="controls bullet"><span class="by">sroussey</span><span>|</span><a href="#35982114">root</a><span>|</span><a href="#35982803">parent</a><span>|</span><a href="#35982835">next</a><span>|</span><label class="collapse" for="c-35984684">[-]</label><label class="expand" for="c-35984684">[2 more]</label></div><br/><div class="children"><div class="content">Yes, I love bun for running typescript cli apps. 40x80 or some such is hardwired as the screen size though, and without raw mode, things like terminal window “controls” are broken.</div><br/><div id="35984707" class="c"><input type="checkbox" id="c-35984707" checked=""/><div class="controls bullet"><span class="by">Jarred</span><span>|</span><a href="#35982114">root</a><span>|</span><a href="#35984684">parent</a><span>|</span><a href="#35982835">next</a><span>|</span><label class="collapse" for="c-35984707">[-]</label><label class="expand" for="c-35984707">[1 more]</label></div><br/><div class="children"><div class="content">Yeah we need to fix raw mode</div><br/></div></div></div></div><div id="35982835" class="c"><input type="checkbox" id="c-35982835" checked=""/><div class="controls bullet"><span class="by">white_dragon88</span><span>|</span><a href="#35982114">root</a><span>|</span><a href="#35982803">parent</a><span>|</span><a href="#35984684">prev</a><span>|</span><a href="#35982142">next</a><span>|</span><label class="collapse" for="c-35982835">[-]</label><label class="expand" for="c-35982835">[1 more]</label></div><br/><div class="children"><div class="content">I use esbuild-runner, it works fine for me</div><br/></div></div></div></div></div></div><div id="35982142" class="c"><input type="checkbox" id="c-35982142" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#35982114">prev</a><span>|</span><a href="#35984970">next</a><span>|</span><label class="collapse" for="c-35982142">[-]</label><label class="expand" for="c-35982142">[1 more]</label></div><br/><div class="children"><div class="content">&gt; After a few hours of work, reading up on Bun and working my way through these issues, I now have a much simpler build system that runs in the blink of an eye. My Vercel build times have reduced from 2 minutes to just 50 seconds (that’s all React stuff &amp; fetching node_modules). My watch script runs in a few milliseconds instead of 5 or more seconds, My code is much simpler and I’ve removed Webpack, Browserify and Uglify from my projects.<p>This is like when esbuild first appeared level&#x27;s of excitement to me. Can&#x27;t wait to try it out.</div><br/></div></div><div id="35984970" class="c"><input type="checkbox" id="c-35984970" checked=""/><div class="controls bullet"><span class="by">bluelightning2k</span><span>|</span><a href="#35982142">prev</a><span>|</span><a href="#35982731">next</a><span>|</span><label class="collapse" for="c-35984970">[-]</label><label class="expand" for="c-35984970">[1 more]</label></div><br/><div class="children"><div class="content">Bun clearly is both a great project and has rough edges.<p>Thank you to the Bun team for the work you&#x27;re doing.<p>Thanks also to OP - the success of tooling depends upon the work of both the project and the early adopters willing to put in the work like OP did (seems substantial and motivated at least partly by sheer challenge&#x2F;intellectual curiosity).<p>While it&#x27;s definitely not ready for the mainstream, it&#x27;s still a very interesting project.</div><br/></div></div><div id="35982731" class="c"><input type="checkbox" id="c-35982731" checked=""/><div class="controls bullet"><span class="by">mahathu</span><span>|</span><a href="#35984970">prev</a><span>|</span><a href="#35981989">next</a><span>|</span><label class="collapse" for="c-35982731">[-]</label><label class="expand" for="c-35982731">[1 more]</label></div><br/><div class="children"><div class="content">From OP:<p>A second issue with the default minification is that it broke my app in strange ways that I could not track down – I’m guessing that it’s rewriting the code in some way that is not fully stable yet. I solved it by turning off the syntax minification option<p>Rest sounds nice:)</div><br/></div></div><div id="35981989" class="c"><input type="checkbox" id="c-35981989" checked=""/><div class="controls bullet"><span class="by">brundolf</span><span>|</span><a href="#35982731">prev</a><span>|</span><a href="#35983132">next</a><span>|</span><label class="collapse" for="c-35981989">[-]</label><label class="expand" for="c-35981989">[1 more]</label></div><br/><div class="children"><div class="content">Good to see some real anecdotes. Bun makes big promises, so I&#x27;ve been really curious to see how the reality lines up right now (and not just in a hypothetical future)</div><br/></div></div><div id="35983132" class="c"><input type="checkbox" id="c-35983132" checked=""/><div class="controls bullet"><span class="by">IceHegel</span><span>|</span><a href="#35981989">prev</a><span>|</span><a href="#35982087">next</a><span>|</span><label class="collapse" for="c-35983132">[-]</label><label class="expand" for="c-35983132">[2 more]</label></div><br/><div class="children"><div class="content">I appreciate the kind of guy that adopts a technology before it’s “ready.”<p>Bun is really sweet tech. I think a good benchmark for it being ready is being able to run Nestjs.</div><br/><div id="35985454" class="c"><input type="checkbox" id="c-35985454" checked=""/><div class="controls bullet"><span class="by">meekaaku</span><span>|</span><a href="#35983132">parent</a><span>|</span><a href="#35982087">next</a><span>|</span><label class="collapse" for="c-35985454">[-]</label><label class="expand" for="c-35985454">[1 more]</label></div><br/><div class="children"><div class="content">Has any one tried bun with nestjs? I have a nestjs project that uses webpack.</div><br/></div></div></div></div><div id="35982087" class="c"><input type="checkbox" id="c-35982087" checked=""/><div class="controls bullet"><span class="by">arendtio</span><span>|</span><a href="#35983132">prev</a><span>|</span><a href="#35984644">next</a><span>|</span><label class="collapse" for="c-35982087">[-]</label><label class="expand" for="c-35982087">[5 more]</label></div><br/><div class="children"><div class="content">Actually, I find kidzfun.art much more interesting than yet another js bundler ;-)</div><br/><div id="35982104" class="c"><input type="checkbox" id="c-35982104" checked=""/><div class="controls bullet"><span class="by">shaneos</span><span>|</span><a href="#35982087">parent</a><span>|</span><a href="#35982115">next</a><span>|</span><label class="collapse" for="c-35982104">[-]</label><label class="expand" for="c-35982104">[1 more]</label></div><br/><div class="children"><div class="content">Glad to hear it! My kids love it which keeps me working on it. Having your ideal testers living with you is an amazing plus :-)</div><br/></div></div><div id="35982115" class="c"><input type="checkbox" id="c-35982115" checked=""/><div class="controls bullet"><span class="by">revskill</span><span>|</span><a href="#35982087">parent</a><span>|</span><a href="#35982104">prev</a><span>|</span><a href="#35984644">next</a><span>|</span><label class="collapse" for="c-35982115">[-]</label><label class="expand" for="c-35982115">[3 more]</label></div><br/><div class="children"><div class="content">But it&#x27;s not related ?</div><br/><div id="35982140" class="c"><input type="checkbox" id="c-35982140" checked=""/><div class="controls bullet"><span class="by">shaneos</span><span>|</span><a href="#35982087">root</a><span>|</span><a href="#35982115">parent</a><span>|</span><a href="#35985430">prev</a><span>|</span><a href="#35984644">next</a><span>|</span><label class="collapse" for="c-35982140">[-]</label><label class="expand" for="c-35982140">[1 more]</label></div><br/><div class="children"><div class="content">It’s the project I integrated Bun with as a bundler, thereby running into all these issues. I figured that others would hit the same problems so write this post about how to work around them</div><br/></div></div></div></div></div></div><div id="35984644" class="c"><input type="checkbox" id="c-35984644" checked=""/><div class="controls bullet"><span class="by">frogrammer</span><span>|</span><a href="#35982087">prev</a><span>|</span><a href="#35983082">next</a><span>|</span><label class="collapse" for="c-35984644">[-]</label><label class="expand" for="c-35984644">[2 more]</label></div><br/><div class="children"><div class="content">kidzfun.art is pretty good. I enjoyed it every much. Here is a screenshot,
<a href="https:&#x2F;&#x2F;ibb.co&#x2F;WygKLDc" rel="nofollow">https:&#x2F;&#x2F;ibb.co&#x2F;WygKLDc</a></div><br/><div id="35985132" class="c"><input type="checkbox" id="c-35985132" checked=""/><div class="controls bullet"><span class="by">shaneos</span><span>|</span><a href="#35984644">parent</a><span>|</span><a href="#35983082">next</a><span>|</span><label class="collapse" for="c-35985132">[-]</label><label class="expand" for="c-35985132">[1 more]</label></div><br/><div class="children"><div class="content">Glad you like it :-). I&#x27;m planning to write a few blog posts about how it&#x27;s built, there&#x27;s some fun stuff in there - the first one will probably be about how I make the paint bucket fill operation be instantaneous, that was an interesting problem to solve<p>Now, go make some Gifs in the Animation section!</div><br/></div></div></div></div><div id="35982780" class="c"><input type="checkbox" id="c-35982780" checked=""/><div class="controls bullet"><span class="by">ghosts_</span><span>|</span><a href="#35983082">prev</a><span>|</span><label class="collapse" for="c-35982780">[-]</label><label class="expand" for="c-35982780">[1 more]</label></div><br/><div class="children"><div class="content">a BUNdler</div><br/></div></div></div></div></div></div></div></body></html>