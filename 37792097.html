<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696669263483" as="style"/><link rel="stylesheet" href="styles.css?v=1696669263483"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.meain.io/2023/what-is-in-dot-git/">What is in that .git directory?</a>Â <span class="domain">(<a href="https://blog.meain.io">blog.meain.io</a>)</span></div><div class="subtext"><span>Ivoah</span> | <span>24 comments</span></div><br/><div><div id="37798599" class="c"><input type="checkbox" id="c-37798599" checked=""/><div class="controls bullet"><span class="by">charles_f</span><span>|</span><a href="#37799907">next</a><span>|</span><label class="collapse" for="c-37798599">[-]</label><label class="expand" for="c-37798599">[7 more]</label></div><br/><div class="children"><div class="content">By random chance I ended up in the git internals doc^1 today, also lovely refered to as plumbing and porcelain. It&#x27;s a fantastic read, very well explained. I wish all doc was written with such explicit care to be understood. It reads like a good friend is trying to explain you something.<p>What got me into that was a 51Gb &quot;.pack&quot; file that I wanted to understand. If you wonder about that, they&#x27;re pack files, and what that &quot;delta compression&quot; message when you commit is about^2. The 51Gb file though I don&#x27;t have an explanation for as of yet, I&#x27;m guessing something terrible happened before I joined, and people didn&#x27;t find the courage to forego the history just yet. But at least I got an entertaining read out of it.<p>^1: <a href="https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Plumbing-and-Porcelain" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Plumbing-and-Po...</a><p>^2: <a href="https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Packfiles" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Packfiles</a></div><br/><div id="37798656" class="c"><input type="checkbox" id="c-37798656" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#37798599">parent</a><span>|</span><a href="#37799461">next</a><span>|</span><label class="collapse" for="c-37798656">[-]</label><label class="expand" for="c-37798656">[5 more]</label></div><br/><div class="children"><div class="content">Unpack the files (git-unpack). Maybe it was one large file that someone added, then deleted in a later commit. You&#x27;d have to rewrite history to get rid of it entirely. Alternately it might be a bunch of medium sized files that were added and removed. It may take a little while to track down, but I&#x27;d start by unpacking.<p>This stack-overflow looks like it contains a reasonable description about how to rewrite history to remove objects:<p><a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;11050265&#x2F;remove-large-pack-file-created-by-git" rel="nofollow noreferrer">https:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;11050265&#x2F;remove-large-pa...</a><p>It might be easier to declare repo bankruptcy. Seed a new repo from the existing repo&#x27;s source files. Have the commit message point to the old repo. Stop using the old repo. Yes, you lose history and folks trying to perform repo archeology will have to jump to the old repo.<p>But rewriting history to remove large files can be equally as awful since references to git commit IDs tend to end up in places you don&#x27;t expect and when you rewrite history, you change the commit IDs.<p>Good luck.</div><br/><div id="37798819" class="c"><input type="checkbox" id="c-37798819" checked=""/><div class="controls bullet"><span class="by">charles_f</span><span>|</span><a href="#37798599">root</a><span>|</span><a href="#37798656">parent</a><span>|</span><a href="#37799461">next</a><span>|</span><label class="collapse" for="c-37798819">[-]</label><label class="expand" for="c-37798819">[4 more]</label></div><br/><div class="children"><div class="content">Thanks! Yeah I plan to get to the bottom of it. I will probably propose to just keep a branch with full history somewhere (we need to keep history for auditability) and reset the main branch from a recent state.</div><br/><div id="37799722" class="c"><input type="checkbox" id="c-37799722" checked=""/><div class="controls bullet"><span class="by">tharos47</span><span>|</span><a href="#37798599">root</a><span>|</span><a href="#37798819">parent</a><span>|</span><a href="#37798880">next</a><span>|</span><label class="collapse" for="c-37799722">[-]</label><label class="expand" for="c-37799722">[1 more]</label></div><br/><div class="children"><div class="content">I can recommend git-filter-repo instead, it&#x27;s relatively recent and there is a lot of outdated info on the internet about cleaning git repos. The --analyse flag will generate a report about files in your repo even if they were deleted. I used it to cleanup a number of repo and it helped in detecting large files commited by mistake 10 years ago.
The history rewrite removed the files and we didn&#x27;t need to create a new repo (old history still works fine).</div><br/></div></div><div id="37798880" class="c"><input type="checkbox" id="c-37798880" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#37798599">root</a><span>|</span><a href="#37798819">parent</a><span>|</span><a href="#37799722">prev</a><span>|</span><a href="#37798958">next</a><span>|</span><label class="collapse" for="c-37798880">[-]</label><label class="expand" for="c-37798880">[1 more]</label></div><br/><div class="children"><div class="content">That won&#x27;t shrink the repo. Any reference will keep all the objects alive and they all get packed together. If you only care about reducing clone size see this post:<p><a href="https:&#x2F;&#x2F;github.blog&#x2F;2020-12-21-get-up-to-speed-with-partial-clone-and-shallow-clone&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;github.blog&#x2F;2020-12-21-get-up-to-speed-with-partial-...</a><p>To be clear, I was not suggesting deleting the old repo. Keep it for historical purposes, whether you rewrite or start fresh.</div><br/></div></div><div id="37798958" class="c"><input type="checkbox" id="c-37798958" checked=""/><div class="controls bullet"><span class="by">acemarke</span><span>|</span><a href="#37798599">root</a><span>|</span><a href="#37798819">parent</a><span>|</span><a href="#37798880">prev</a><span>|</span><a href="#37799461">next</a><span>|</span><label class="collapse" for="c-37798958">[-]</label><label class="expand" for="c-37798958">[1 more]</label></div><br/><div class="children"><div class="content">If it helps, I wrote a very long and detailed blog post several years ago about the techniques I used to rewrite my team&#x27;s Git repo history (including stripping out junk files, _and_ actually rewriting source file contents via formatting and codemods for _old_ commits):<p><a href="https:&#x2F;&#x2F;blog.isquaredsoftware.com&#x2F;2018&#x2F;11&#x2F;git-js-history-rewriting&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.isquaredsoftware.com&#x2F;2018&#x2F;11&#x2F;git-js-history-rew...</a><p>I specifically was looking for techniques that would let me quickly iterate over ~15000 commits.<p>granted, the repo size I was working with was only a few GB, but hopefully there&#x27;s some pieces there you can find useful.</div><br/></div></div></div></div></div></div><div id="37799461" class="c"><input type="checkbox" id="c-37799461" checked=""/><div class="controls bullet"><span class="by">glandium</span><span>|</span><a href="#37798599">parent</a><span>|</span><a href="#37798656">prev</a><span>|</span><a href="#37799907">next</a><span>|</span><label class="collapse" for="c-37799461">[-]</label><label class="expand" for="c-37799461">[1 more]</label></div><br/><div class="children"><div class="content">Check the git verify-pack subcommand, particularly the -s and -v flags.</div><br/></div></div></div></div><div id="37799907" class="c"><input type="checkbox" id="c-37799907" checked=""/><div class="controls bullet"><span class="by">rollcat</span><span>|</span><a href="#37798599">prev</a><span>|</span><a href="#37799691">next</a><span>|</span><label class="collapse" for="c-37799907">[-]</label><label class="expand" for="c-37799907">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s fairly easy to grab info from .git for your own purposes. For example, the program that generates my PS1 peeks there (without wasting precious cycles on shelling out to the git command) to find the current branch we&#x27;re on:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;rollcat&#x2F;etc&#x2F;blob&#x2F;b2fd739&#x2F;cmd&#x2F;prompter&#x2F;main.go#L78">https:&#x2F;&#x2F;github.com&#x2F;rollcat&#x2F;etc&#x2F;blob&#x2F;b2fd739&#x2F;cmd&#x2F;prompter&#x2F;mai...</a></div><br/></div></div><div id="37799691" class="c"><input type="checkbox" id="c-37799691" checked=""/><div class="controls bullet"><span class="by">p4bl0</span><span>|</span><a href="#37799907">prev</a><span>|</span><a href="#37799767">next</a><span>|</span><label class="collapse" for="c-37799691">[-]</label><label class="expand" for="c-37799691">[1 more]</label></div><br/><div class="children"><div class="content">Nice post, thanks for sharing! I found that another way to learn about Git internals is following a very step by step re-implementation of Git. It really was a very cool and efficient way for me to understand what&#x27;s in the .git repository.<p>See for example the ugit [1] &quot;build Git from scratch in Python&quot; series for that.<p>[1] <a href="https:&#x2F;&#x2F;www.leshenko.net&#x2F;p&#x2F;ugit&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.leshenko.net&#x2F;p&#x2F;ugit&#x2F;</a></div><br/></div></div><div id="37799767" class="c"><input type="checkbox" id="c-37799767" checked=""/><div class="controls bullet"><span class="by">rossant</span><span>|</span><a href="#37799691">prev</a><span>|</span><a href="#37799087">next</a><span>|</span><label class="collapse" for="c-37799767">[-]</label><label class="expand" for="c-37799767">[1 more]</label></div><br/><div class="children"><div class="content">Great post. Git becomes much less mysterious once knowing how it works internally.</div><br/></div></div><div id="37798577" class="c"><input type="checkbox" id="c-37798577" checked=""/><div class="controls bullet"><span class="by">js2</span><span>|</span><a href="#37799087">prev</a><span>|</span><a href="#37799356">next</a><span>|</span><label class="collapse" for="c-37798577">[-]</label><label class="expand" for="c-37798577">[1 more]</label></div><br/><div class="children"><div class="content">If you&#x27;d like a more in-depth treatment of the topic, let me suggest chapter 10 of the git book:<p><a href="https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Plumbing-and-Porcelain" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Plumbing-and-Po...</a><p>&gt; But what gets sent to the other git repo? It is everything that is in objects and under refs.<p>Not everything under refs. Just the refs that you push. What gets pushed depends on how you configure git, what arguments you provide to `git push` and how the refspecs are configured for the remote under `.git&#x2F;config`:<p><a href="https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-The-Refspec" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-The-Refspec</a><p>e.g., I regularly use `git push origin +HEAD:develop` to force push the checked out branch to a destination branch named `develop`.<p>A couple additional points not mentioned:<p>There are also tag objects. You create these with `git tag -a`. These are also called annotated tags. They carry their own message and point to a commit. Without `-a` you create a so-called lightweight tag which is just an entry under `refs&#x2F;tags` pointing directly to a commit (as opposed to pointing to a tag object).<p><a href="https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-tag" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;docs&#x2F;git-tag</a><p>All those loose objects get packed up into pack files periodically to save space and improve git&#x27;s speed. You can manually run `git gc` but git will do so for you automatically every so many commits. You&#x27;ll find the pack files under `.git&#x2F;objects&#x2F;pack`:<p><a href="https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Packfiles" rel="nofollow noreferrer">https:&#x2F;&#x2F;git-scm.com&#x2F;book&#x2F;en&#x2F;v2&#x2F;Git-Internals-Packfiles</a></div><br/></div></div><div id="37799356" class="c"><input type="checkbox" id="c-37799356" checked=""/><div class="controls bullet"><span class="by">nnnnnande</span><span>|</span><a href="#37798577">prev</a><span>|</span><a href="#37799090">next</a><span>|</span><label class="collapse" for="c-37799356">[-]</label><label class="expand" for="c-37799356">[1 more]</label></div><br/><div class="children"><div class="content">On the same topic, I usually refer back to this fantastic talk on how to add and commit a file without using git add or git commit: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=mdvlu_R8EWE">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=mdvlu_R8EWE</a></div><br/></div></div></div></div></div></div></div></body></html>