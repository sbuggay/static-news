<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1710061251457" as="style"/><link rel="stylesheet" href="styles.css?v=1710061251457"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://arkadiyt.com/2024/03/03/reverse-engineering-protobuf-definitiions-from-compiled-binaries/">Reverse Engineering Protobuf Definitions from Compiled Binaries</a> <span class="domain">(<a href="https://arkadiyt.com">arkadiyt.com</a>)</span></div><div class="subtext"><span>arkadiyt</span> | <span>11 comments</span></div><br/><div><div id="39657713" class="c"><input type="checkbox" id="c-39657713" checked=""/><div class="controls bullet"><span class="by">mkl</span><span>|</span><a href="#39656750">next</a><span>|</span><label class="collapse" for="c-39657713">[-]</label><label class="expand" for="c-39657713">[1 more]</label></div><br/><div class="children"><div class="content">I have used this other tool to good effect to reverse engineer a file format based on Protobuf: <a href="https:&#x2F;&#x2F;github.com&#x2F;mildsunrise&#x2F;protobuf-inspector">https:&#x2F;&#x2F;github.com&#x2F;mildsunrise&#x2F;protobuf-inspector</a></div><br/></div></div><div id="39656750" class="c"><input type="checkbox" id="c-39656750" checked=""/><div class="controls bullet"><span class="by">dunham</span><span>|</span><a href="#39657713">prev</a><span>|</span><a href="#39657454">next</a><span>|</span><label class="collapse" for="c-39656750">[-]</label><label class="expand" for="c-39656750">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve used protodump before, but have found that some applications don&#x27;t embed the .proto data.<p>It may be bit-rotted by now, but a couple of years ago I hacked together a python script that would extract a proto definition from Objective C apps by scanning the assembly output and looking for the patterns of code generated by the protoc compiler. I put it on github in case it is useful to somebody.<p><a href="https:&#x2F;&#x2F;gist.github.com&#x2F;dunhamsteve&#x2F;224e26a7f56689c33cea4f0fa7632c3d" rel="nofollow">https:&#x2F;&#x2F;gist.github.com&#x2F;dunhamsteve&#x2F;224e26a7f56689c33cea4f0f...</a><p>Compiled ObjectiveC is a bit simpler than compiled C&#x2F;C++, you can read the method invocations out of it.  I haven&#x27;t looked into how hard the output of Swift is to read.<p>I&#x27;ve also analyzed protobuf data (Apple Notes) by writing code that decodes the data in a generic fashion and output a guess at the schema. I would run on about 100 samples, to help distinguish binary data from sub-objects, to detect optional fields, and to detect &#x27;repeated&#x27; fields.  Then you have to go through and figure out what all of the fields are.<p>I succeeded, but later learned that the notes web app embedded the plain text .proto file, which would have made things a lot easier.</div><br/></div></div><div id="39657454" class="c"><input type="checkbox" id="c-39657454" checked=""/><div class="controls bullet"><span class="by">sandermvanvliet</span><span>|</span><a href="#39656750">prev</a><span>|</span><a href="#39657649">next</a><span>|</span><label class="collapse" for="c-39657454">[-]</label><label class="expand" for="c-39657454">[1 more]</label></div><br/><div class="children"><div class="content">Definitely a useful tool. 
Decoding protobuf (and message formats in general) can be such a pain and fun at the same time.<p>I’ve written ProtobufDecoder which takes a different approach: analyze the structure of the actual messages to help you figure out the protobuf structure of a message.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;sandermvanvliet&#x2F;ProtobufDecoder">https:&#x2F;&#x2F;github.com&#x2F;sandermvanvliet&#x2F;ProtobufDecoder</a></div><br/></div></div><div id="39657649" class="c"><input type="checkbox" id="c-39657649" checked=""/><div class="controls bullet"><span class="by">davedx</span><span>|</span><a href="#39657454">prev</a><span>|</span><a href="#39656808">next</a><span>|</span><label class="collapse" for="c-39657649">[-]</label><label class="expand" for="c-39657649">[1 more]</label></div><br/><div class="children"><div class="content">Useful! Wish I had this when I started reverse engineering pbf map tiles a few months back.</div><br/></div></div><div id="39656808" class="c"><input type="checkbox" id="c-39656808" checked=""/><div class="controls bullet"><span class="by">jobmeplease</span><span>|</span><a href="#39657649">prev</a><span>|</span><a href="#39657386">next</a><span>|</span><label class="collapse" for="c-39656808">[-]</label><label class="expand" for="c-39656808">[4 more]</label></div><br/><div class="children"><div class="content">Back at Google there was a really nice extension to protobufs where servers had a side channel that let you query all the services on the end point along with their full proto descriptors. That&#x27;s probably internal only though (but I haven&#x27;t played with grpc enough to know).</div><br/><div id="39656876" class="c"><input type="checkbox" id="c-39656876" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#39656808">parent</a><span>|</span><a href="#39657546">next</a><span>|</span><label class="collapse" for="c-39656876">[-]</label><label class="expand" for="c-39656876">[1 more]</label></div><br/><div class="children"><div class="content">The reflection service is open-sourced (at least for some sdks):<p>* <a href="https:&#x2F;&#x2F;github.com&#x2F;grpc&#x2F;grpc-go&#x2F;blob&#x2F;master&#x2F;Documentation&#x2F;server-reflection-tutorial.md">https:&#x2F;&#x2F;github.com&#x2F;grpc&#x2F;grpc-go&#x2F;blob&#x2F;master&#x2F;Documentation&#x2F;se...</a><p>* <a href="https:&#x2F;&#x2F;chromium.googlesource.com&#x2F;external&#x2F;github.com&#x2F;grpc&#x2F;grpc-go&#x2F;+&#x2F;refs&#x2F;heads&#x2F;v1.10.x&#x2F;Documentation&#x2F;server-reflection-tutorial.md" rel="nofollow">https:&#x2F;&#x2F;chromium.googlesource.com&#x2F;external&#x2F;github.com&#x2F;grpc&#x2F;g...</a><p>You must explicitly enable it  in code and many people… well just dont</div><br/></div></div><div id="39657546" class="c"><input type="checkbox" id="c-39657546" checked=""/><div class="controls bullet"><span class="by">peheje</span><span>|</span><a href="#39656808">parent</a><span>|</span><a href="#39656876">prev</a><span>|</span><a href="#39656861">next</a><span>|</span><label class="collapse" for="c-39657546">[-]</label><label class="expand" for="c-39657546">[1 more]</label></div><br/><div class="children"><div class="content">.NET has gRPC reflection. <a href="https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;aspnet&#x2F;core&#x2F;grpc&#x2F;test-tools?view=aspnetcore-8.0#set-up-grpc-reflection" rel="nofollow">https:&#x2F;&#x2F;learn.microsoft.com&#x2F;en-us&#x2F;aspnet&#x2F;core&#x2F;grpc&#x2F;test-tool...</a></div><br/></div></div><div id="39656861" class="c"><input type="checkbox" id="c-39656861" checked=""/><div class="controls bullet"><span class="by">kleton</span><span>|</span><a href="#39656808">parent</a><span>|</span><a href="#39657546">prev</a><span>|</span><a href="#39657386">next</a><span>|</span><label class="collapse" for="c-39656861">[-]</label><label class="expand" for="c-39656861">[1 more]</label></div><br/><div class="children"><div class="content">That was a stubby cli command right? It was a special reflection proto service that was built into the c++ proto server. I think open source grpc_cli has it <a href="https:&#x2F;&#x2F;grpc.github.io&#x2F;grpc&#x2F;core&#x2F;md_doc_server_reflection_tutorial.html" rel="nofollow">https:&#x2F;&#x2F;grpc.github.io&#x2F;grpc&#x2F;core&#x2F;md_doc_server_reflection_tu...</a></div><br/></div></div></div></div><div id="39657202" class="c"><input type="checkbox" id="c-39657202" checked=""/><div class="controls bullet"><span class="by">choppaface</span><span>|</span><a href="#39657386">prev</a><span>|</span><label class="collapse" for="c-39657202">[-]</label><label class="expand" for="c-39657202">[1 more]</label></div><br/><div class="children"><div class="content">For at least 4 years protobuf has had decent support for self-describing messages (very similar to avro) as well as reflection<p><a href="https:&#x2F;&#x2F;github.com&#x2F;protocolbuffers&#x2F;protobuf&#x2F;blob&#x2F;main&#x2F;src&#x2F;google&#x2F;protobuf&#x2F;reflection.h">https:&#x2F;&#x2F;github.com&#x2F;protocolbuffers&#x2F;protobuf&#x2F;blob&#x2F;main&#x2F;src&#x2F;go...</a><p>Xgooglers trying to make do on the cheap will just create a Union of all their messages and include the message def in a self-describing message pattern. Super-sensitive network I&#x2F;O can elide the message def (empty buffer) and any for RecordIO clone well file compression takes care of the definition.<p>Definitely useful to be able to dig out old defs but protobuf maintainers have surprisingly added useful features so you don’t have to.<p>Bonus points tho for extracting the protobuf defs that e.g. Apple bakes into their binaries.</div><br/></div></div></div></div></div></div></div></body></html>