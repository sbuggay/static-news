<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716714051253" as="style"/><link rel="stylesheet" href="styles.css?v=1716714051253"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.cmtops.dev/posts/rootless-docker-in-multiuser-environment/">Rootless Docker in a multi-user environment</a> <span class="domain">(<a href="https://www.cmtops.dev">www.cmtops.dev</a>)</span></div><div class="subtext"><span>rducksherlock</span> | <span>33 comments</span></div><br/><div><div id="40479673" class="c"><input type="checkbox" id="c-40479673" checked=""/><div class="controls bullet"><span class="by">Helmut10001</span><span>|</span><a href="#40479772">next</a><span>|</span><label class="collapse" for="c-40479673">[-]</label><label class="expand" for="c-40479673">[2 more]</label></div><br/><div class="children"><div class="content">Site is down? I am getting a connection refused..<p>Anyway, surprised that so many comments wonder about the usefulness of docker rootless in a shared environment. It is my main approach for separation of concerns in my homelab. I always use docker rootless to share resources with many isolated apps. I wrote a blog post about how to host Mastodon with docker rootless [1].<p>[1]: <a href="https:&#x2F;&#x2F;du.nkel.dev&#x2F;blog&#x2F;2023-12-12_mastodon-docker-rootless&#x2F;" rel="nofollow">https:&#x2F;&#x2F;du.nkel.dev&#x2F;blog&#x2F;2023-12-12_mastodon-docker-rootless...</a></div><br/></div></div><div id="40479772" class="c"><input type="checkbox" id="c-40479772" checked=""/><div class="controls bullet"><span class="by">abound</span><span>|</span><a href="#40479673">prev</a><span>|</span><a href="#40478803">next</a><span>|</span><label class="collapse" for="c-40479772">[-]</label><label class="expand" for="c-40479772">[3 more]</label></div><br/><div class="children"><div class="content">This is a lot of work for something that works out of the box with Podman. Of course, using Podman introduces its own idiosyncrasies, and as someone else noted, the benefit of the approach in the article is that all users share an image cache.<p>Source: I use Podman on a workstation where I SSH in as a bunch of different non-root users, and I&#x27;ve never had to think about it working.</div><br/><div id="40479848" class="c"><input type="checkbox" id="c-40479848" checked=""/><div class="controls bullet"><span class="by">jeppester</span><span>|</span><a href="#40479772">parent</a><span>|</span><a href="#40479863">next</a><span>|</span><label class="collapse" for="c-40479848">[-]</label><label class="expand" for="c-40479848">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve used rootless podman for development for several months now.<p>I had a few issues in the beginning, but in the end the solutions were rather trivial. I had to:<p>- Delete config files from previous podman versions (pre 4)<p>- Enable the docker socket (for my user)<p>- Use docker compose 2 rather than &quot;podman compose&quot; or an older docker compose (shipped with the distro)<p>We mostly use docker-compose files for our dev setups, so I can&#x27;t say if I&#x27;d run into issues with more elaborate setups. But I must say that it works extremely well for me.</div><br/></div></div><div id="40479863" class="c"><input type="checkbox" id="c-40479863" checked=""/><div class="controls bullet"><span class="by">rducksherlock</span><span>|</span><a href="#40479772">parent</a><span>|</span><a href="#40479848">prev</a><span>|</span><a href="#40478803">next</a><span>|</span><label class="collapse" for="c-40479863">[-]</label><label class="expand" for="c-40479863">[1 more]</label></div><br/><div class="children"><div class="content">You are absolutely right.<p>However, if your company has already highly invested into using Docker, the fact of something working OOTB in any other piece of software doesn&#x27;t convince to make a decision to switch.<p>On top of that, our DevOps team is pretty happy with Docker :)</div><br/></div></div></div></div><div id="40478803" class="c"><input type="checkbox" id="c-40478803" checked=""/><div class="controls bullet"><span class="by">from-nibly</span><span>|</span><a href="#40479772">prev</a><span>|</span><a href="#40479419">next</a><span>|</span><label class="collapse" for="c-40478803">[-]</label><label class="expand" for="c-40478803">[12 more]</label></div><br/><div class="children"><div class="content">I still don&#x27;t get why multi user. I haven&#x27;t seen a multi user scenario that makes any sense for any Linux deploy in ages. Is this a shared prod server? Is it a shared Dev server? Why would those be multi user? For prod, why isnt it cattle where you don&#x27;t ever SSH onto the server?
For Dev if you can&#x27;t just run it all on your local machine why not do something like shipyard.build<p>Somebody tell me what im missing.</div><br/><div id="40478840" class="c"><input type="checkbox" id="c-40478840" checked=""/><div class="controls bullet"><span class="by">hamandcheese</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40478899">next</a><span>|</span><label class="collapse" for="c-40478840">[-]</label><label class="expand" for="c-40478840">[1 more]</label></div><br/><div class="children"><div class="content">Not docker specific, but there are still lots and lots of servers out there running multiple services. Especially in my home-lab! Each service runs under a service-specific user, sometimes with extra hardening applied by systemd. It&#x27;s a tried-and-true method for gaining some semblance of security boundaries on a shared server without the additional administration overhead of kubernetes or similar.<p>A more relevant use case to industry might be a CI machine that you want to get better utilization out of. Easy, just start of multiple CI runners under different users. &quot;Just use Kubernetes&quot; I hear someone screaming? Well, sometimes you need CI on macOS.</div><br/></div></div><div id="40478899" class="c"><input type="checkbox" id="c-40478899" checked=""/><div class="controls bullet"><span class="by">racingmars</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40478840">prev</a><span>|</span><a href="#40478986">next</a><span>|</span><label class="collapse" for="c-40478899">[-]</label><label class="expand" for="c-40478899">[1 more]</label></div><br/><div class="children"><div class="content">I run a multi-user Linux server. It&#x27;s IBM POWER9 hardware and several of my friends in the open-source community who care about testing on something other than x86, or who are interested in different architectures or playing with its unique capabilities such as quad-precision floating point implemented in the hardware appreciate having shell access to it.</div><br/></div></div><div id="40478986" class="c"><input type="checkbox" id="c-40478986" checked=""/><div class="controls bullet"><span class="by">3np</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40478899">prev</a><span>|</span><a href="#40479219">next</a><span>|</span><label class="collapse" for="c-40478986">[-]</label><label class="expand" for="c-40478986">[2 more]</label></div><br/><div class="children"><div class="content">Let&#x27;s say you have some centralized monitoring of various host metrics. The ingestion process needs some amount of privileged access. But you don&#x27;t want to give it full root. Meanwhile, your actual service probably needs no privileged access, save for some secrets which should also be inaccessible for the monitoring agent process. You may want to run both of these as containers.<p>I guess you may be using SELinux but even so, users and groups are natural parts of expressing and enforcing such constraints.</div><br/><div id="40479065" class="c"><input type="checkbox" id="c-40479065" checked=""/><div class="controls bullet"><span class="by">candiddevmike</span><span>|</span><a href="#40478803">root</a><span>|</span><a href="#40478986">parent</a><span>|</span><a href="#40479219">next</a><span>|</span><label class="collapse" for="c-40479065">[-]</label><label class="expand" for="c-40479065">[1 more]</label></div><br/><div class="children"><div class="content">IMO, Kubernetes is going to be easier for an end user and more performant than rolling your own rootless container platform.</div><br/></div></div></div></div><div id="40479219" class="c"><input type="checkbox" id="c-40479219" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40478986">prev</a><span>|</span><a href="#40479111">next</a><span>|</span><label class="collapse" for="c-40479219">[-]</label><label class="expand" for="c-40479219">[4 more]</label></div><br/><div class="children"><div class="content">&gt;&gt; Why would those be multi user? For prod, why isnt it cattle where you don&#x27;t ever SSH onto the server?<p>I hate the cattle not pets analogy, do you know how well taken care of most cattle are?<p>If your operating at google&#x2F;fb&#x2F;apple scale then yes you can have this approach. There are lots of business that DON&#x27;t need, want or have to scale to this level. There are lots of systems where this approach breaks down.<p>Docker is great if you&#x27;re deploying some sort of mess of software. Your average node&#x2F;python&#x2F;ruby setup with its run time and packages + custom code makes sense to get shoved into a container and deployed. Docker turns these sorts of deployments into App Store like experiences.<p>It doesn&#x27;t mean is the only, or a good approach... if your dev env looks like your production env, if your deploying binaries then pushing out as a c-group or even an old school &quot;user&quot; is not only viable it has a lot less complexity.<p>As a bonus you can SSH in, you have all the tools available on a machine, you can tweak a box to add in perf&#x2F;monitoring&#x2F;debug&#x2F;testing tools on there to get to the source of those &quot;it only happens here&quot; bugs...</div><br/><div id="40480043" class="c"><input type="checkbox" id="c-40480043" checked=""/><div class="controls bullet"><span class="by">alexey-salmin</span><span>|</span><a href="#40478803">root</a><span>|</span><a href="#40479219">parent</a><span>|</span><a href="#40479608">next</a><span>|</span><label class="collapse" for="c-40480043">[-]</label><label class="expand" for="c-40480043">[1 more]</label></div><br/><div class="children"><div class="content">&gt; If your operating at google&#x2F;fb&#x2F;apple scale then yes you can have this approach. There are lots of business that DON&#x27;t need, want or have to scale to this level. There are lots of systems where this approach breaks down.<p>I used to work at Yandex which is not Google but had hundreds of thousands of servers in runtime nevertheless. So definitely cattle.<p>Still the CTO of search repeatedly said things like &quot;It&#x27;s your production? Then ssh into a random instance, attach with gdb and look at the stacks. Is it busy doing what you think it should be doing?&quot;<p>Dealing with cattle means spending a lot of time in the barn not in the books.</div><br/></div></div><div id="40479608" class="c"><input type="checkbox" id="c-40479608" checked=""/><div class="controls bullet"><span class="by">from-nibly</span><span>|</span><a href="#40478803">root</a><span>|</span><a href="#40479219">parent</a><span>|</span><a href="#40480043">prev</a><span>|</span><a href="#40479111">next</a><span>|</span><label class="collapse" for="c-40479608">[-]</label><label class="expand" for="c-40479608">[2 more]</label></div><br/><div class="children"><div class="content">The &quot;it only happens here&quot; bugs are a symptom of mutable infrastructure.</div><br/><div id="40479984" class="c"><input type="checkbox" id="c-40479984" checked=""/><div class="controls bullet"><span class="by">zer00eyz</span><span>|</span><a href="#40478803">root</a><span>|</span><a href="#40479608">parent</a><span>|</span><a href="#40479111">next</a><span>|</span><label class="collapse" for="c-40479984">[-]</label><label class="expand" for="c-40479984">[1 more]</label></div><br/><div class="children"><div class="content">Boundary conditions, behavior under load, behavior under dynamic load, behavior using real world networks, with real word latency...<p>If you dont give a shit about your customers (google, FB) where errors at scale dont matter then yes you can believe that.<p>Most of us dont have that luxury or dont want it.</div><br/></div></div></div></div></div></div><div id="40479111" class="c"><input type="checkbox" id="c-40479111" checked=""/><div class="controls bullet"><span class="by">curt15</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40479219">prev</a><span>|</span><a href="#40479843">next</a><span>|</span><label class="collapse" for="c-40479111">[-]</label><label class="expand" for="c-40479111">[1 more]</label></div><br/><div class="children"><div class="content">Aren&#x27;t most HPC clusters multiuser?</div><br/></div></div><div id="40479843" class="c"><input type="checkbox" id="c-40479843" checked=""/><div class="controls bullet"><span class="by">Dwedit</span><span>|</span><a href="#40478803">parent</a><span>|</span><a href="#40479111">prev</a><span>|</span><a href="#40479837">next</a><span>|</span><label class="collapse" for="c-40479843">[-]</label><label class="expand" for="c-40479843">[1 more]</label></div><br/><div class="children"><div class="content">Shared webhosting is still done with multi users.</div><br/></div></div></div></div><div id="40479419" class="c"><input type="checkbox" id="c-40479419" checked=""/><div class="controls bullet"><span class="by">rbut</span><span>|</span><a href="#40478803">prev</a><span>|</span><a href="#40478316">next</a><span>|</span><label class="collapse" for="c-40479419">[-]</label><label class="expand" for="c-40479419">[1 more]</label></div><br/><div class="children"><div class="content">Here&#x27;s our experience with rootless docker.<p>We&#x27;ve used it in a single-user (a docker user) and multi-user (user for each dev) environment.<p>Most, if not all, containers work fine, there are some, like mailcow which don&#x27;t work well with it.<p>If you have multiple IPs on the one machine, there is a longstanding bug that means you can&#x27;t bind the same port on different IPs. Eg IP1:80 and IP2:80. The workaround for this is separate rootless docker users + runtime for each container that shares ports, nasty.<p>In a multi-user environment we simply setup rootless docker under each devs user, so they have their own runtime and their own containers isolated from other devs. This works really well.<p>Overall it works well for us.</div><br/></div></div><div id="40478316" class="c"><input type="checkbox" id="c-40478316" checked=""/><div class="controls bullet"><span class="by">curt15</span><span>|</span><a href="#40479419">prev</a><span>|</span><a href="#40478789">next</a><span>|</span><label class="collapse" for="c-40478316">[-]</label><label class="expand" for="c-40478316">[4 more]</label></div><br/><div class="children"><div class="content">How well does rootless docker work compared to rootless podman?</div><br/><div id="40478997" class="c"><input type="checkbox" id="c-40478997" checked=""/><div class="controls bullet"><span class="by">sarusso</span><span>|</span><a href="#40478316">parent</a><span>|</span><a href="#40478789">next</a><span>|</span><label class="collapse" for="c-40478997">[-]</label><label class="expand" for="c-40478997">[3 more]</label></div><br/><div class="children"><div class="content"><i>If</i> it works as I understood, in this setup I can see an advantage at an architectural level: in Podman containers images are stored on a per-user basis, while in this setup they would be shared between users, thus using much less disk space (if using the same base images). Besides this, I actually have the same question.</div><br/><div id="40479818" class="c"><input type="checkbox" id="c-40479818" checked=""/><div class="controls bullet"><span class="by">cpuguy83</span><span>|</span><a href="#40478316">root</a><span>|</span><a href="#40478997">parent</a><span>|</span><a href="#40478789">next</a><span>|</span><label class="collapse" for="c-40479818">[-]</label><label class="expand" for="c-40479818">[2 more]</label></div><br/><div class="children"><div class="content">No both use the exact same techniques to achieve so called
&quot;rootless&quot;  which is generally considered to be insecure.<p>Rootless docker stores images for the user executing it and that is all, same as podman.</div><br/><div id="40480033" class="c"><input type="checkbox" id="c-40480033" checked=""/><div class="controls bullet"><span class="by">bjoli</span><span>|</span><a href="#40478316">root</a><span>|</span><a href="#40479818">parent</a><span>|</span><a href="#40478789">next</a><span>|</span><label class="collapse" for="c-40480033">[-]</label><label class="expand" for="c-40480033">[1 more]</label></div><br/><div class="children"><div class="content">How are they considered insecure?</div><br/></div></div></div></div></div></div></div></div><div id="40478789" class="c"><input type="checkbox" id="c-40478789" checked=""/><div class="controls bullet"><span class="by">lmeyerov</span><span>|</span><a href="#40478316">prev</a><span>|</span><a href="#40478584">next</a><span>|</span><label class="collapse" for="c-40478789">[-]</label><label class="expand" for="c-40478789">[1 more]</label></div><br/><div class="children"><div class="content">Related: If you are into this kind of thing and the extra fun that is GPUs + pydata, we have a 1mo or 2mo project around adding rootless to our GPU graph AI containers &amp; packer flow. Ping build@graphistry.com .<p>Niche but a project we have been wanting for awhile. Base containers get OSS&#x27;d etc. This stuff is twisty!</div><br/></div></div><div id="40478584" class="c"><input type="checkbox" id="c-40478584" checked=""/><div class="controls bullet"><span class="by">grudg3</span><span>|</span><a href="#40478789">prev</a><span>|</span><label class="collapse" for="c-40478584">[-]</label><label class="expand" for="c-40478584">[9 more]</label></div><br/><div class="children"><div class="content">I wonder why people aren&#x27;t using Singularity containers instead which seem to be rootless by design.</div><br/><div id="40478910" class="c"><input type="checkbox" id="c-40478910" checked=""/><div class="controls bullet"><span class="by">sarusso</span><span>|</span><a href="#40478584">parent</a><span>|</span><a href="#40478676">next</a><span>|</span><label class="collapse" for="c-40478910">[-]</label><label class="expand" for="c-40478910">[4 more]</label></div><br/><div class="children"><div class="content">Oh man, Singularity… I once wrote: “In the shipping container analogy, you can think about Singularty containers as if they have no walls.” [1]<p>[1] <a href="https:&#x2F;&#x2F;sarusso.github.io&#x2F;blog&#x2F;container-engines-runtimes-orchestrators.html" rel="nofollow">https:&#x2F;&#x2F;sarusso.github.io&#x2F;blog&#x2F;container-engines-runtimes-or...</a></div><br/><div id="40479533" class="c"><input type="checkbox" id="c-40479533" checked=""/><div class="controls bullet"><span class="by">IcyWindows</span><span>|</span><a href="#40478584">root</a><span>|</span><a href="#40478910">parent</a><span>|</span><a href="#40479002">next</a><span>|</span><label class="collapse" for="c-40479533">[-]</label><label class="expand" for="c-40479533">[1 more]</label></div><br/><div class="children"><div class="content">I think singularity is about keeping program dependencies together, not isolation.</div><br/></div></div><div id="40479002" class="c"><input type="checkbox" id="c-40479002" checked=""/><div class="controls bullet"><span class="by">grudg3</span><span>|</span><a href="#40478584">root</a><span>|</span><a href="#40478910">parent</a><span>|</span><a href="#40479533">prev</a><span>|</span><a href="#40478969">next</a><span>|</span><label class="collapse" for="c-40479002">[-]</label><label class="expand" for="c-40479002">[1 more]</label></div><br/><div class="children"><div class="content">Well, I&#x27;m glad I asked, appreciate your response and great blog post.</div><br/></div></div><div id="40478969" class="c"><input type="checkbox" id="c-40478969" checked=""/><div class="controls bullet"><span class="by">smitty1110</span><span>|</span><a href="#40478584">root</a><span>|</span><a href="#40478910">parent</a><span>|</span><a href="#40479002">prev</a><span>|</span><a href="#40478676">next</a><span>|</span><label class="collapse" for="c-40478969">[-]</label><label class="expand" for="c-40478969">[1 more]</label></div><br/><div class="children"><div class="content">Well, that blog post is getting a bookmark. Next time a junior dev asks me how this BS works, I&#x27;m going to show them your diagram.</div><br/></div></div></div></div><div id="40478676" class="c"><input type="checkbox" id="c-40478676" checked=""/><div class="controls bullet"><span class="by">yjftsjthsd-h</span><span>|</span><a href="#40478584">parent</a><span>|</span><a href="#40478910">prev</a><span>|</span><a href="#40478888">next</a><span>|</span><label class="collapse" for="c-40478676">[-]</label><label class="expand" for="c-40478676">[3 more]</label></div><br/><div class="children"><div class="content">At the risk of showcasing my bubble: Lack of exposure; how many people even know what singularity is or how to use it? I know it&#x27;s used in scientific HPC, but I don&#x27;t see evidence of wider adoption.</div><br/><div id="40479205" class="c"><input type="checkbox" id="c-40479205" checked=""/><div class="controls bullet"><span class="by">grudg3</span><span>|</span><a href="#40478584">root</a><span>|</span><a href="#40478676">parent</a><span>|</span><a href="#40478773">next</a><span>|</span><label class="collapse" for="c-40479205">[-]</label><label class="expand" for="c-40479205">[1 more]</label></div><br/><div class="children"><div class="content">Definitely used in HPC environments where multi user is prevalent, I know of it because I used to admin a small HPC</div><br/></div></div><div id="40478773" class="c"><input type="checkbox" id="c-40478773" checked=""/><div class="controls bullet"><span class="by">firesteelrain</span><span>|</span><a href="#40478584">root</a><span>|</span><a href="#40478676">parent</a><span>|</span><a href="#40479205">prev</a><span>|</span><a href="#40478888">next</a><span>|</span><label class="collapse" for="c-40478773">[-]</label><label class="expand" for="c-40478773">[1 more]</label></div><br/><div class="children"><div class="content">Never heard of it. Podman or bust</div><br/></div></div></div></div><div id="40478888" class="c"><input type="checkbox" id="c-40478888" checked=""/><div class="controls bullet"><span class="by">ratscylla</span><span>|</span><a href="#40478584">parent</a><span>|</span><a href="#40478676">prev</a><span>|</span><label class="collapse" for="c-40478888">[-]</label><label class="expand" for="c-40478888">[1 more]</label></div><br/><div class="children"><div class="content">I think it is a few things together. The rootless and daemonless design leads to UX differences with Docker. Because of the differences, it isn&#x27;t just a drop in replacement; porting applications can be a pain if they do anything weird (no network isolation, --containall isn&#x27;t default and still is a bit different when on, etc). And Docker has a ton of momentum and usage.</div><br/></div></div></div></div></div></div></div></div></div></body></html>