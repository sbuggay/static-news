<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1717318872462" as="style"/><link rel="stylesheet" href="styles.css?v=1717318872462"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://healeycodes.com/lisp-compiler-optimizations">I added some optimizations to my compiler that turns Lisp into JavaScript</a> <span class="domain">(<a href="https://healeycodes.com">healeycodes.com</a>)</span></div><div class="subtext"><span>healeycodes</span> | <span>11 comments</span></div><br/><div><div id="40549305" class="c"><input type="checkbox" id="c-40549305" checked=""/><div class="controls bullet"><span class="by">love2read</span><span>|</span><a href="#40548965">next</a><span>|</span><label class="collapse" for="c-40549305">[-]</label><label class="expand" for="c-40549305">[2 more]</label></div><br/><div class="children"><div class="content">I did a similar thing in opposite order, I compile js to scheme. <a href="https:&#x2F;&#x2F;github.com&#x2F;u9g&#x2F;js2scheme&#x2F;blob&#x2F;main&#x2F;example.js">https:&#x2F;&#x2F;github.com&#x2F;u9g&#x2F;js2scheme&#x2F;blob&#x2F;main&#x2F;example.js</a><p>Not a serious project, made purely because I had a class that mandated writing scheme for the homeworks.<p>I think the coolest thing to come out of that project was that I learned that it is possible to convert branching if statements to lisp constructs. That was a fun project :)</div><br/><div id="40551353" class="c"><input type="checkbox" id="c-40551353" checked=""/><div class="controls bullet"><span class="by">djtango</span><span>|</span><a href="#40549305">parent</a><span>|</span><a href="#40548965">next</a><span>|</span><label class="collapse" for="c-40551353">[-]</label><label class="expand" for="c-40551353">[1 more]</label></div><br/><div class="children"><div class="content">I admire your commitment towards not writing Scheme but I recommend giving it a go. Maybe use it as an opportunity to learn Vim or Emacs and have a go at structural editing. It&#x27;ll change how you think about your code...</div><br/></div></div></div></div><div id="40548965" class="c"><input type="checkbox" id="c-40548965" checked=""/><div class="controls bullet"><span class="by">tromp</span><span>|</span><a href="#40549305">prev</a><span>|</span><a href="#40547915">next</a><span>|</span><label class="collapse" for="c-40548965">[-]</label><label class="expand" for="c-40548965">[5 more]</label></div><br/><div class="children"><div class="content">Do you check whether constant folding actually results in shorter code?
E.g. something like<p><pre><code>    let a=&quot;hello &quot;; b=a++a; c=b++b; in c++c
</code></pre>
probably shouldn&#x27;t be changed into<p><pre><code>    &quot;hello hello hello hello hello hello hello hello &quot;</code></pre></div><br/><div id="40549137" class="c"><input type="checkbox" id="c-40549137" checked=""/><div class="controls bullet"><span class="by">healeycodes</span><span>|</span><a href="#40548965">parent</a><span>|</span><a href="#40550633">next</a><span>|</span><label class="collapse" for="c-40549137">[-]</label><label class="expand" for="c-40549137">[1 more]</label></div><br/><div class="children"><div class="content">The Lisp variant that the compiler supports at the moment only handles f64 numbers so I don&#x27;t think this kind of issue is possible.<p>However, this is a very relevant point. If the goal is just shorter code (as opposed to a mix of shorter code and less run-time operations), then you need to check that folding strings (and similar types) actually makes the expression shorter to represent.</div><br/></div></div><div id="40550633" class="c"><input type="checkbox" id="c-40550633" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#40548965">parent</a><span>|</span><a href="#40549137">prev</a><span>|</span><a href="#40549315">next</a><span>|</span><label class="collapse" for="c-40550633">[-]</label><label class="expand" for="c-40550633">[1 more]</label></div><br/><div class="children"><div class="content">If these operations produce mutable strings, the conditions under which that would be allowed are fairly stringent. It&#x27;s not worth doing; it&#x27;s better for the Lisp to have constructs that allow the programmer easily stage the evaluation in the desired way.<p>Common Lisp has <i>load-time-value</i>. It&#x27;s also easy to write a macro called <i>macro-eval</i> which evaluates its argument at macro time, and substitutes the result (as a quoted object).</div><br/></div></div><div id="40549315" class="c"><input type="checkbox" id="c-40549315" checked=""/><div class="controls bullet"><span class="by">retrac</span><span>|</span><a href="#40548965">parent</a><span>|</span><a href="#40550633">prev</a><span>|</span><a href="#40549112">next</a><span>|</span><label class="collapse" for="c-40549315">[-]</label><label class="expand" for="c-40549315">[1 more]</label></div><br/><div class="children"><div class="content">Depends whether you&#x27;re optimizing for program size or runtime speed.</div><br/></div></div><div id="40549112" class="c"><input type="checkbox" id="c-40549112" checked=""/><div class="controls bullet"><span class="by">dualogy</span><span>|</span><a href="#40548965">parent</a><span>|</span><a href="#40549315">prev</a><span>|</span><a href="#40547915">next</a><span>|</span><label class="collapse" for="c-40549112">[-]</label><label class="expand" for="c-40549112">[1 more]</label></div><br/><div class="children"><div class="content">A sufficiently smart minifier should rewrite that back into `&quot;hello &quot;.times(8)`  =)</div><br/></div></div></div></div><div id="40547915" class="c"><input type="checkbox" id="c-40547915" checked=""/><div class="controls bullet"><span class="by">User23</span><span>|</span><a href="#40548965">prev</a><span>|</span><a href="#40551076">next</a><span>|</span><label class="collapse" for="c-40547915">[-]</label><label class="expand" for="c-40547915">[1 more]</label></div><br/><div class="children"><div class="content">Good stuff.<p>On a Lisp compiler optimization tangent: It’s still relevant to SBCL and also generally interesting so the CMUCL advanced compiler manual section[1] is good reading.<p>[1] <a href="https:&#x2F;&#x2F;cmucl.org&#x2F;docs&#x2F;cmu-user&#x2F;cmu-user.html#Advanced-Compiler-Use-and-Efficiency-Hints" rel="nofollow">https:&#x2F;&#x2F;cmucl.org&#x2F;docs&#x2F;cmu-user&#x2F;cmu-user.html#Advanced-Compi...</a></div><br/></div></div><div id="40551076" class="c"><input type="checkbox" id="c-40551076" checked=""/><div class="controls bullet"><span class="by">inopinatus</span><span>|</span><a href="#40547915">prev</a><span>|</span><a href="#40549067">next</a><span>|</span><label class="collapse" for="c-40551076">[-]</label><label class="expand" for="c-40551076">[1 more]</label></div><br/><div class="children"><div class="content">&quot;Javascript is a Lisp&quot; would definitely be found in the Big Bumper Book of Divisive Things To Say To Programmers alongside its more famous entries, &quot;Tabs or Spaces?&quot;, and &quot;Vim or Emacs?&quot;.</div><br/></div></div><div id="40549067" class="c"><input type="checkbox" id="c-40549067" checked=""/><div class="controls bullet"><span class="by">jagged-chisel</span><span>|</span><a href="#40551076">prev</a><span>|</span><label class="collapse" for="c-40549067">[-]</label><label class="expand" for="c-40549067">[1 more]</label></div><br/><div class="children"><div class="content">My immediate reaction is that this is as much a semantic mistake as “this message does not exist.”<p>Maybe I’m wrong, but … well, there it is.</div><br/></div></div></div></div></div></div></div></body></html>