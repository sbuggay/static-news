<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1720774863287" as="style"/><link rel="stylesheet" href="styles.css?v=1720774863287"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/postgresml/korvus">Korvus: Single-Query RAG with Postgres</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>levkk</span> | <span>35 comments</span></div><br/><div><div id="40943844" class="c"><input type="checkbox" id="c-40943844" checked=""/><div class="controls bullet"><span class="by">wonderfuly</span><span>|</span><a href="#40938326">next</a><span>|</span><label class="collapse" for="c-40943844">[-]</label><label class="expand" for="c-40943844">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure if this is a good idea, just like pretending a network request is a function call, it hides a lot of elements that shouldn&#x27;t be ignored. I still prefer to clearly explicit embedding, LLM generation, etc.</div><br/></div></div><div id="40938326" class="c"><input type="checkbox" id="c-40938326" checked=""/><div class="controls bullet"><span class="by">levkk</span><span>|</span><a href="#40943844">prev</a><span>|</span><a href="#40939239">next</a><span>|</span><label class="collapse" for="c-40938326">[-]</label><label class="expand" for="c-40938326">[7 more]</label></div><br/><div class="children"><div class="content">Hey fellow open-source enthusiasts,<p>We built Korvus, an open-source RAG (Retrieval-Augmented Generation) pipeline that consolidates the entire RAG workflow - from embedding generation to text generation - into a single SQL query, significantly reducing architectural complexity and latency.<p>Here&#x27;s some of the highlights:<p>- Full RAG pipeline (embedding generation, vector search, reranking, and text generation) in one SQL query<p>- SDKs for Python, JavaScript, and Rust (more languages planned)<p>- Built on PostgreSQL, leveraging pgvector and pgml<p>- Open-source, with support for open models<p>- Designed for high performance and scalability<p>Korvus utilizes Postgres&#x27; advanced features to perform complex RAG operations natively within the database. We&#x27;re also the developers of PostgresML, so we&#x27;re big advocates of in-database machine learning. This approach eliminates the need for external services and API calls, potentially reducing latency by orders of magnitude compared to traditional microservice architectures. It&#x27;s how our founding team built and scaled the ML platform at Instacart.<p>We&#x27;re eager to get feedback from the community and welcome contributions. Check out our GitHub repo for more details, and feel free to hit us up in our Discord!</div><br/><div id="40940140" class="c"><input type="checkbox" id="c-40940140" checked=""/><div class="controls bullet"><span class="by">kaspermarstal</span><span>|</span><a href="#40938326">parent</a><span>|</span><a href="#40943245">prev</a><span>|</span><a href="#40940216">next</a><span>|</span><label class="collapse" for="c-40940140">[-]</label><label class="expand" for="c-40940140">[3 more]</label></div><br/><div class="children"><div class="content">Very cool! A assume you use Postgres&#x27; native full-text search capabilities? Any plans for BM25 or similar? This would make Korvus the end-game for open source rag IMO.</div><br/><div id="40942449" class="c"><input type="checkbox" id="c-40942449" checked=""/><div class="controls bullet"><span class="by">darby_nine</span><span>|</span><a href="#40938326">root</a><span>|</span><a href="#40940140">parent</a><span>|</span><a href="#40940216">next</a><span>|</span><label class="collapse" for="c-40942449">[-]</label><label class="expand" for="c-40942449">[2 more]</label></div><br/><div class="children"><div class="content">How do you resolve the disparity between semantic and text search? Surely these rankings are difficult to combine.</div><br/><div id="40942665" class="c"><input type="checkbox" id="c-40942665" checked=""/><div class="controls bullet"><span class="by">whakim</span><span>|</span><a href="#40938326">root</a><span>|</span><a href="#40942449">parent</a><span>|</span><a href="#40940216">next</a><span>|</span><label class="collapse" for="c-40942665">[-]</label><label class="expand" for="c-40942665">[1 more]</label></div><br/><div class="children"><div class="content">I’d start with something very simple such as Reciprocal Rank Fusion. I’d also want to make sure I really trusted the outputs of each search pipeline before worrying too much about the appropriate algorithm for combining the rankings.</div><br/></div></div></div></div></div></div><div id="40940216" class="c"><input type="checkbox" id="c-40940216" checked=""/><div class="controls bullet"><span class="by">mdaniel</span><span>|</span><a href="#40938326">parent</a><span>|</span><a href="#40940140">prev</a><span>|</span><a href="#40939239">next</a><span>|</span><label class="collapse" for="c-40940216">[-]</label><label class="expand" for="c-40940216">[2 more]</label></div><br/><div class="children"><div class="content">I find it misleading to use an f-string containing encoded `{CONTEXT}`  &lt;<a href="https:&#x2F;&#x2F;github.com&#x2F;postgresml&#x2F;korvus&#x2F;blob&#x2F;bce269a20a1dbea933820daa2038d68ed2893ddf&#x2F;README.md#L165">https:&#x2F;&#x2F;github.com&#x2F;postgresml&#x2F;korvus&#x2F;blob&#x2F;bce269a20a1dbea933...</a>&gt;, and after digging into TFM &lt;<a href="https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;guides&#x2F;rag#simple-rag" rel="nofollow">https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;guides&#x2F;rag#si...</a>&gt; it seems it is not, in fact, an f-string artifact but rather the literal characters &quot;{&quot;+&quot;CONTEXT&quot;+&quot;}&quot; and are the same in all the language bindings?<p>IMHO it would be much clearer if you just used the normal %s for the &quot;outer&quot; string and left the <i>implicit</i> f-string syntax as it is, e.g.<p><pre><code>                    {
                        &quot;role&quot;: &quot;user&quot;,
                        # this is not an f-string, is rather replaced by TODO FIXME
                        &quot;content&quot;: &quot;Given the context\n:{CONTEXT}\nAnswer the question: %s&quot; % query,
                    },
</code></pre>
The way the example (in both the readme and the docs) is written, it seems to imply I can put my own fileds as siblings to the chat key and they, too, will be resolved<p><pre><code>    results = await collection.rag(
        {
            &quot;EXAMPLE&quot;: {
              &quot;uh-huh&quot;: True
            },
            &quot;CONTEXT&quot;: {
                &quot;vector_search&quot;: {
                    &quot;query&quot;: {
                        &quot;fields&quot;: {&quot;text&quot;: {&quot;query&quot;: query}},
                    },
                    &quot;document&quot;: {&quot;keys&quot;: [&quot;id&quot;]},
                    &quot;limit&quot;: 1,
                },
                &quot;aggregate&quot;: {&quot;join&quot;: &quot;\n&quot;},
            },
            &quot;chat&quot;: {
              &quot;messages&quot;: [{&quot;content&quot;: &quot;Given Context:\n{CONTEXT}\nAn Example:\n{EXAMPLE}&quot;
            }


</code></pre>
One could not fault the user for thinking such a thing since the *API* docs say &quot;see the *GUIDE*&quot; :-( <a href="https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;api&#x2F;collections#rag" rel="nofollow">https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;api&#x2F;collectio...</a></div><br/><div id="40940927" class="c"><input type="checkbox" id="c-40940927" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40938326">root</a><span>|</span><a href="#40940216">parent</a><span>|</span><a href="#40939239">next</a><span>|</span><label class="collapse" for="c-40940927">[-]</label><label class="expand" for="c-40940927">[1 more]</label></div><br/><div class="children"><div class="content">This section of the docs may be confusing. What you described will actually almost work. See: <a href="https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;guides&#x2F;rag#raw-sql-queries-&#x2F;-multi-variable-context" rel="nofollow">https:&#x2F;&#x2F;postgresml.org&#x2F;docs&#x2F;open-source&#x2F;korvus&#x2F;guides&#x2F;rag#ra...</a></div><br/></div></div></div></div></div></div><div id="40939239" class="c"><input type="checkbox" id="c-40939239" checked=""/><div class="controls bullet"><span class="by">hahahacorn</span><span>|</span><a href="#40938326">prev</a><span>|</span><a href="#40940333">next</a><span>|</span><label class="collapse" for="c-40939239">[-]</label><label class="expand" for="c-40939239">[3 more]</label></div><br/><div class="children"><div class="content">Very cool. I see more languages planned in your comment. Are you looking for community help developing SDKs in other languages? After spending an entire Saturday running a RAG pipeline for a POC for a &quot;fun&quot; side project, I definitely would&#x27;ve loved to have been able to use this instead.<p>I spent too long reading Python docs because I haven&#x27;t touched the language since 2019. Happy to help develop a Ruby SDK!</div><br/><div id="40939499" class="c"><input type="checkbox" id="c-40939499" checked=""/><div class="controls bullet"><span class="by">pqdbr</span><span>|</span><a href="#40939239">parent</a><span>|</span><a href="#40940333">next</a><span>|</span><label class="collapse" for="c-40939499">[-]</label><label class="expand" for="c-40939499">[2 more]</label></div><br/><div class="children"><div class="content">+1 for a Ruby SDK!</div><br/><div id="40939630" class="c"><input type="checkbox" id="c-40939630" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40939239">root</a><span>|</span><a href="#40939499">parent</a><span>|</span><a href="#40940333">next</a><span>|</span><label class="collapse" for="c-40939630">[-]</label><label class="expand" for="c-40939630">[1 more]</label></div><br/><div class="children"><div class="content">We would love help developing a Ruby SDK! We programmatically generate our Python, JavaScript, and C bindings from our Rust library. Check out the rust-bridge folder for more info on how we do that.</div><br/></div></div></div></div></div></div><div id="40940333" class="c"><input type="checkbox" id="c-40940333" checked=""/><div class="controls bullet"><span class="by">simonw</span><span>|</span><a href="#40939239">prev</a><span>|</span><a href="#40941403">next</a><span>|</span><label class="collapse" for="c-40940333">[-]</label><label class="expand" for="c-40940333">[2 more]</label></div><br/><div class="children"><div class="content">Does this work my running LLM such as Llama directly on the database server? If so, does that mean that your database and the LLM are competing for the same CPU and memory resources?<p>Can it run the LLM on a GPU?</div><br/><div id="40940906" class="c"><input type="checkbox" id="c-40940906" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40940333">parent</a><span>|</span><a href="#40941403">next</a><span>|</span><label class="collapse" for="c-40940906">[-]</label><label class="expand" for="c-40940906">[1 more]</label></div><br/><div class="children"><div class="content">It does work by running the LLM on the database server but you can configure the LLM to run on the GPU</div><br/></div></div></div></div><div id="40941403" class="c"><input type="checkbox" id="c-40941403" checked=""/><div class="controls bullet"><span class="by">omneity</span><span>|</span><a href="#40940333">prev</a><span>|</span><a href="#40940652">next</a><span>|</span><label class="collapse" for="c-40941403">[-]</label><label class="expand" for="c-40941403">[1 more]</label></div><br/><div class="children"><div class="content">As a long time user of pgvector I&#x27;m really hyped up about this. Korvus has the potential to reduce a lot of the repetitive code in projects I work on.<p>You mention pulling models from huggingface for document embedding. Is it possible to pass an hf token to use private models?<p>I train domain and language-specific[0] embedding and conversational models and if I can use them in Korvus I&#x27;ll most likely switch to it overnight.<p>[0]: <a href="https:&#x2F;&#x2F;sawalni.com&#x2F;developers" rel="nofollow">https:&#x2F;&#x2F;sawalni.com&#x2F;developers</a></div><br/></div></div><div id="40940652" class="c"><input type="checkbox" id="c-40940652" checked=""/><div class="controls bullet"><span class="by">nkmnz</span><span>|</span><a href="#40941403">prev</a><span>|</span><a href="#40939354">next</a><span>|</span><label class="collapse" for="c-40940652">[-]</label><label class="expand" for="c-40940652">[4 more]</label></div><br/><div class="children"><div class="content">This sounds very promising, but let me ask an honest question: to me, it seems like databases are the hardest part to scale in your average IT infrastructure. How much work does it add to the database if you let it make all the ML related work as well? How much work is saved by reducing the number of necessary queries?</div><br/><div id="40942820" class="c"><input type="checkbox" id="c-40942820" checked=""/><div class="controls bullet"><span class="by">whakim</span><span>|</span><a href="#40940652">parent</a><span>|</span><a href="#40940663">next</a><span>|</span><label class="collapse" for="c-40942820">[-]</label><label class="expand" for="c-40942820">[1 more]</label></div><br/><div class="children"><div class="content">Contrary to some of the sibling responses, my experience with pgvector specifically (with hundreds of millions or billions of vectors) is that the workload is quite different from your typical web-app workload, enough so that you really want them on separate databases. For example, you have to be really careful about how vacuum&#x2F;autovacuum interacts with pgvector’s HNSW indices if you’re frequently updating data; you have to be aware that the tables and indices are <i>huge</i> and take up a ton of memory, which can have knock-on performance implications for other systems; etc.</div><br/></div></div><div id="40940663" class="c"><input type="checkbox" id="c-40940663" checked=""/><div class="controls bullet"><span class="by">CuriouslyC</span><span>|</span><a href="#40940652">parent</a><span>|</span><a href="#40942820">prev</a><span>|</span><a href="#40939354">next</a><span>|</span><label class="collapse" for="c-40940663">[-]</label><label class="expand" for="c-40940663">[2 more]</label></div><br/><div class="children"><div class="content">This is a read workload that can be easily horizontally scaled.  The reduction in dev and infrastructure complexity is well worth the slight increase in DB provisioning.</div><br/><div id="40941373" class="c"><input type="checkbox" id="c-40941373" checked=""/><div class="controls bullet"><span class="by">montanalow</span><span>|</span><a href="#40940652">root</a><span>|</span><a href="#40940663">parent</a><span>|</span><a href="#40939354">next</a><span>|</span><label class="collapse" for="c-40941373">[-]</label><label class="expand" for="c-40941373">[1 more]</label></div><br/><div class="children"><div class="content">Yep, one of our other projects, pgcat is exactly to help make the horizontal scaling as easy as possible.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;postgresml&#x2F;pgcat">https:&#x2F;&#x2F;github.com&#x2F;postgresml&#x2F;pgcat</a></div><br/></div></div></div></div></div></div><div id="40939354" class="c"><input type="checkbox" id="c-40939354" checked=""/><div class="controls bullet"><span class="by">jiocrag</span><span>|</span><a href="#40940652">prev</a><span>|</span><a href="#40939273">next</a><span>|</span><label class="collapse" for="c-40939354">[-]</label><label class="expand" for="c-40939354">[2 more]</label></div><br/><div class="children"><div class="content">Is there any way to deploy this to an existing postgres database or does it need to use the docker instance.</div><br/><div id="40939637" class="c"><input type="checkbox" id="c-40939637" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40939354">parent</a><span>|</span><a href="#40939273">next</a><span>|</span><label class="collapse" for="c-40939637">[-]</label><label class="expand" for="c-40939637">[1 more]</label></div><br/><div class="children"><div class="content">You can totally use an existing postgres database. Just make sure to install the pgvector and pgml postgres extensions and it will work!</div><br/></div></div></div></div><div id="40939273" class="c"><input type="checkbox" id="c-40939273" checked=""/><div class="controls bullet"><span class="by">naveen_k</span><span>|</span><a href="#40939354">prev</a><span>|</span><a href="#40939315">next</a><span>|</span><label class="collapse" for="c-40939273">[-]</label><label class="expand" for="c-40939273">[2 more]</label></div><br/><div class="children"><div class="content">This looks exciting! Will definitely be testing it out in the coming days.<p>I see you offer re-ranking using local models, will there be build-in support for making re-ranking calls to external services such as cohere in the future?</div><br/><div id="40939658" class="c"><input type="checkbox" id="c-40939658" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40939273">parent</a><span>|</span><a href="#40939315">next</a><span>|</span><label class="collapse" for="c-40939658">[-]</label><label class="expand" for="c-40939658">[1 more]</label></div><br/><div class="children"><div class="content">Great question! Making calls to external services is not something we plan to support. The point of Korvus is to write SQL queries that take advantage of the pgml and pgvector extensions. Making calls to external services is something that could be done by users after retrieval.</div><br/></div></div></div></div><div id="40939315" class="c"><input type="checkbox" id="c-40939315" checked=""/><div class="controls bullet"><span class="by">lecha</span><span>|</span><a href="#40939273">prev</a><span>|</span><a href="#40940889">next</a><span>|</span><label class="collapse" for="c-40939315">[-]</label><label class="expand" for="c-40939315">[3 more]</label></div><br/><div class="children"><div class="content">Interesting! Is there a way to deploy this on AWS RDS?</div><br/><div id="40939493" class="c"><input type="checkbox" id="c-40939493" checked=""/><div class="controls bullet"><span class="by">klysm</span><span>|</span><a href="#40939315">parent</a><span>|</span><a href="#40940889">next</a><span>|</span><label class="collapse" for="c-40939493">[-]</label><label class="expand" for="c-40939493">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;d imagine it just comes down to whether or not the extensions are allowed or not</div><br/><div id="40939640" class="c"><input type="checkbox" id="c-40939640" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40939315">root</a><span>|</span><a href="#40939493">parent</a><span>|</span><a href="#40940889">next</a><span>|</span><label class="collapse" for="c-40939640">[-]</label><label class="expand" for="c-40939640">[1 more]</label></div><br/><div class="children"><div class="content">Unfortunately the pgml extension does not work on AWS RDS so there is not.</div><br/></div></div></div></div></div></div><div id="40940889" class="c"><input type="checkbox" id="c-40940889" checked=""/><div class="controls bullet"><span class="by">thawkins</span><span>|</span><a href="#40939315">prev</a><span>|</span><a href="#40941799">next</a><span>|</span><label class="collapse" for="c-40940889">[-]</label><label class="expand" for="c-40940889">[1 more]</label></div><br/><div class="children"><div class="content">What LLM system does it use to run models? Does it support ollama?</div><br/></div></div><div id="40941799" class="c"><input type="checkbox" id="c-40941799" checked=""/><div class="controls bullet"><span class="by">iaabtpbtpnn</span><span>|</span><a href="#40940889">prev</a><span>|</span><a href="#40940050">next</a><span>|</span><label class="collapse" for="c-40941799">[-]</label><label class="expand" for="c-40941799">[1 more]</label></div><br/><div class="children"><div class="content">You emphasize single-query, but I can&#x27;t find the query. Where can I see it?</div><br/></div></div><div id="40940050" class="c"><input type="checkbox" id="c-40940050" checked=""/><div class="controls bullet"><span class="by">stavros</span><span>|</span><a href="#40941799">prev</a><span>|</span><a href="#40941150">next</a><span>|</span><label class="collapse" for="c-40940050">[-]</label><label class="expand" for="c-40940050">[2 more]</label></div><br/><div class="children"><div class="content">This looks great, thanks! After being disappointed by how flaky gpt-4-turbo&#x27;s RAG is, I want to set up my own, so this came at the right time.<p>One question: Can I use an external model (ie get the raw RAG snippets, or prompt text)? Or does it have to be the one specified in Korvus?</div><br/><div id="40940895" class="c"><input type="checkbox" id="c-40940895" checked=""/><div class="controls bullet"><span class="by">smarvin2</span><span>|</span><a href="#40940050">parent</a><span>|</span><a href="#40941150">next</a><span>|</span><label class="collapse" for="c-40940895">[-]</label><label class="expand" for="c-40940895">[1 more]</label></div><br/><div class="children"><div class="content">You can use Korvus for search and feed the results to an external model</div><br/></div></div></div></div><div id="40940104" class="c"><input type="checkbox" id="c-40940104" checked=""/><div class="controls bullet"><span class="by">unixhero</span><span>|</span><a href="#40941150">prev</a><span>|</span><label class="collapse" for="c-40940104">[-]</label><label class="expand" for="c-40940104">[4 more]</label></div><br/><div class="children"><div class="content">Is RAG the new DAG? <i>outoftheloop</i></div><br/><div id="40940327" class="c"><input type="checkbox" id="c-40940327" checked=""/><div class="controls bullet"><span class="by">helsinki</span><span>|</span><a href="#40940104">parent</a><span>|</span><label class="collapse" for="c-40940327">[-]</label><label class="expand" for="c-40940327">[3 more]</label></div><br/><div class="children"><div class="content">Zero mention of what a RAG is on the README. No clue, here.</div><br/><div id="40941136" class="c"><input type="checkbox" id="c-40941136" checked=""/><div class="controls bullet"><span class="by">brylie</span><span>|</span><a href="#40940104">root</a><span>|</span><a href="#40940327">parent</a><span>|</span><a href="#40940595">next</a><span>|</span><label class="collapse" for="c-40941136">[-]</label><label class="expand" for="c-40941136">[1 more]</label></div><br/><div class="children"><div class="content">Retrieval Augmented Generation uses text that is stored in a database to augment user prompts that are sent to a generative AI, like a large language model. The retrieval results are based on their similarities to the user input. The goal is to improve the output of the generative AI by providing more information in the input (user prompt + retrieval results.) For example, we can provide the LLM details from an internal knowledge base so it can generate responses that are specific to an organization rather than based on general information. It may also reduce errors and improve the relevancy of the model output, depending on the context.</div><br/></div></div><div id="40940595" class="c"><input type="checkbox" id="c-40940595" checked=""/><div class="controls bullet"><span class="by">jzig</span><span>|</span><a href="#40940104">root</a><span>|</span><a href="#40940327">parent</a><span>|</span><a href="#40941136">prev</a><span>|</span><label class="collapse" for="c-40940595">[-]</label><label class="expand" for="c-40940595">[1 more]</label></div><br/><div class="children"><div class="content">From the README:<p>&gt; Korvus is an all-in-one, open-source RAG (Retrieval-Augmented Generation) pipeline...</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>