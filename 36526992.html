<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1688115646420" as="style"/><link rel="stylesheet" href="styles.css?v=1688115646420"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.run.house/blog/a-pytorch-approach-to-ml-infrastructure">A PyTorch Approach to ML Infrastructure</a> <span class="domain">(<a href="https://www.run.house">www.run.house</a>)</span></div><div class="subtext"><span>donnygreenberg</span> | <span>20 comments</span></div><br/><div><div id="36529018" class="c"><input type="checkbox" id="c-36529018" checked=""/><div class="controls bullet"><span class="by">extr</span><span>|</span><a href="#36529708">next</a><span>|</span><label class="collapse" for="c-36529018">[-]</label><label class="expand" for="c-36529018">[4 more]</label></div><br/><div class="children"><div class="content">Very interesting. I just worked to implement a baby version of this kind of system at work. Similar to this project, our basic use case was allowing researchers to quickly&#x2F;easily execute their arbitrary R&amp;D code on cloud resources. It&#x27;s difficult to know in advance what they might be doing, and we wanted to avoid a situation where they are pushing a docker container or submitting a file every time they change something. So we made it possible for them to &quot;just&quot; ship a single class&#x2F;function without leaving their local interactive environment.<p>I see from looking at the source here, run.house is using the same approach of cloudpickling the function. That works, but one struggle we are having is it&#x27;s quite brittle. It&#x27;s all gravy assuming everyone is operating in perfectly fresh environments that mirror the cluster, but this is rarely the case. Even subtle changes in the execution environment locally can produce segfaults when run on the server. Very hard to debug. The code here looks a lot more mature, so I&#x27;m assuming this is more robust than what we have. But would be curious if the developers have run into similar challenges.</div><br/><div id="36529595" class="c"><input type="checkbox" id="c-36529595" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36529018">parent</a><span>|</span><a href="#36529708">next</a><span>|</span><label class="collapse" for="c-36529595">[-]</label><label class="expand" for="c-36529595">[3 more]</label></div><br/><div class="children"><div class="content">Hi! That&#x27;s awesome to hear, and very aligned with the devx we&#x27;re going for. How was your system received?<p>In fact we totally agree and are not cloudpickling the function because of the package minor version issues. We sync over the code to the destination environment and the server imports it fresh, which is much more robust. The one piece of code that cloudpickles functions is a trap door for certain weird situations, but frankly we haven&#x27;t had to use it in months.</div><br/><div id="36530198" class="c"><input type="checkbox" id="c-36530198" checked=""/><div class="controls bullet"><span class="by">extr</span><span>|</span><a href="#36529018">root</a><span>|</span><a href="#36529595">parent</a><span>|</span><a href="#36529708">next</a><span>|</span><label class="collapse" for="c-36530198">[-]</label><label class="expand" for="c-36530198">[2 more]</label></div><br/><div class="children"><div class="content">Our system was super well received minus the stability issues. I think the UX of being able to &quot;ship&quot; code like this is a big leap over the alternatives - it actually gives me a lot of confidence in the approach seeing that someone else had a similar thought.<p>Very interesting about the implementation. I admittedly did not read that closely and clearly did not grok the what the actual hot path was there, will check it out more. May have to borrow your approach or perhaps just adopt this wholesale :) Regardless, super cool project, will be following.</div><br/><div id="36530207" class="c"><input type="checkbox" id="c-36530207" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36529018">root</a><span>|</span><a href="#36530198">parent</a><span>|</span><a href="#36529708">next</a><span>|</span><label class="collapse" for="c-36530207">[-]</label><label class="expand" for="c-36530207">[1 more]</label></div><br/><div class="children"><div class="content">Excellent! Don&#x27;t hesitate to reach out (donny at run dot house) if you want to chat about adopting our approach or using Runhouse.</div><br/></div></div></div></div></div></div></div></div><div id="36529708" class="c"><input type="checkbox" id="c-36529708" checked=""/><div class="controls bullet"><span class="by">cbarrick</span><span>|</span><a href="#36529018">prev</a><span>|</span><a href="#36530353">next</a><span>|</span><label class="collapse" for="c-36529708">[-]</label><label class="expand" for="c-36529708">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Just as PyTorch lets you send a model .to(&quot;cuda&quot;), Runhouse enables hardware heterogeneity by letting you send your code (or dataset, environment, pipeline, etc) .to(“cloud_instance”, “on_prem”, “data_store”...), all from inside a Python notebook or script. There’s no need to manually move the code and data around, package into docker containers, or translate into a pipeline DAG.<p>From an SRE perspective, this sounds like a nightmare. Controlled releases are <i>really</i> important for reliability. I definitely don&#x27;t want my devs doing manual rollouts from a notebook.</div><br/><div id="36529785" class="c"><input type="checkbox" id="c-36529785" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36529708">parent</a><span>|</span><a href="#36530353">next</a><span>|</span><label class="collapse" for="c-36529785">[-]</label><label class="expand" for="c-36529785">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a great point. The funny thing is that the rest of the world just has dev, QA, and prod staging and canaries, while ML has &quot;the 6 months it takes to translate from notebook to pipeline&quot; or &quot;uploading a new checkpoint&#x2F;image to the platform.&quot; We can just stage properly and release through CD like everyone else does, but not spend 6 months flipping the switch. We built the ability to specify the package for a function as a git repo and a particular revision to enable this, and hopefully it means more people rely on version control as the source of truth in prod and not the most recently uploaded model checkpoint to Sagemaker. During experimentation though, it really is frustrating that many systems only allow you <i>run</i> what you&#x27;ve committed.<p>We&#x27;ve also built a basic permissioning system to control who can actually overwrite the saved version of a resource, so there are no accidents. E.g. if the prod inference blob is saved at &quot;mikes_pizza&#x2F;nlp&#x2F;bert&#x2F;bert_prod&quot;, you can set it so only x accounts can overwrite that metadata to point to a new model. Ideally we just inherit existing RBAC groups sometime soon.<p>Does that make sense? Curious if you had something else in mind as far as the danger.</div><br/></div></div></div></div><div id="36530353" class="c"><input type="checkbox" id="c-36530353" checked=""/><div class="controls bullet"><span class="by">m_ke</span><span>|</span><a href="#36529708">prev</a><span>|</span><a href="#36529297">next</a><span>|</span><label class="collapse" for="c-36530353">[-]</label><label class="expand" for="c-36530353">[2 more]</label></div><br/><div class="children"><div class="content">Since people are suggesting alternatives, I&#x27;d like to shoutout skypilot: <a href="https:&#x2F;&#x2F;github.com&#x2F;skypilot-org&#x2F;skypilot">https:&#x2F;&#x2F;github.com&#x2F;skypilot-org&#x2F;skypilot</a><p>EDIT: looks like this actually uses it under the hood: <a href="https:&#x2F;&#x2F;github.com&#x2F;run-house&#x2F;runhouse&#x2F;blob&#x2F;main&#x2F;requirements.txt#L8">https:&#x2F;&#x2F;github.com&#x2F;run-house&#x2F;runhouse&#x2F;blob&#x2F;main&#x2F;requirements...</a></div><br/><div id="36530520" class="c"><input type="checkbox" id="c-36530520" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36530353">parent</a><span>|</span><a href="#36529297">next</a><span>|</span><label class="collapse" for="c-36530520">[-]</label><label class="expand" for="c-36530520">[1 more]</label></div><br/><div class="children"><div class="content">Yes, we work pretty closely with them and they&#x27;re lovely. Everyone should try SkyPilot.</div><br/></div></div></div></div><div id="36529297" class="c"><input type="checkbox" id="c-36529297" checked=""/><div class="controls bullet"><span class="by">voz_</span><span>|</span><a href="#36530353">prev</a><span>|</span><a href="#36528699">next</a><span>|</span><label class="collapse" for="c-36529297">[-]</label><label class="expand" for="c-36529297">[1 more]</label></div><br/><div class="children"><div class="content">This is a cool approach. I really like the notion of small, powerful components that compose well together. ML infra is sorely missing this piece. I wish you the best of luck!</div><br/></div></div><div id="36528699" class="c"><input type="checkbox" id="c-36528699" checked=""/><div class="controls bullet"><span class="by">guluarte</span><span>|</span><a href="#36529297">prev</a><span>|</span><a href="#36529986">next</a><span>|</span><label class="collapse" for="c-36528699">[-]</label><label class="expand" for="c-36528699">[1 more]</label></div><br/><div class="children"><div class="content">Sounds similar to <a href="https:&#x2F;&#x2F;dstack.ai&#x2F;docs&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;dstack.ai&#x2F;docs&#x2F;</a></div><br/></div></div><div id="36529986" class="c"><input type="checkbox" id="c-36529986" checked=""/><div class="controls bullet"><span class="by">pavelstoev</span><span>|</span><a href="#36528699">prev</a><span>|</span><a href="#36528454">next</a><span>|</span><label class="collapse" for="c-36529986">[-]</label><label class="expand" for="c-36529986">[2 more]</label></div><br/><div class="children"><div class="content">Have you tired Hidet ? <a href="https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;hidet&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;hidet&#x2F;</a></div><br/><div id="36530222" class="c"><input type="checkbox" id="c-36530222" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36529986">parent</a><span>|</span><a href="#36528454">next</a><span>|</span><label class="collapse" for="c-36530222">[-]</label><label class="expand" for="c-36530222">[1 more]</label></div><br/><div class="children"><div class="content">No, I know of CentML but don&#x27;t deeply know the surface of hardware they compile for. I&#x27;m enthusiastic about projects like this and others which integrate with PyTorch 2.0. Flexible compilers make the value of being able to ship your code around to various hardware even more powerful.</div><br/></div></div></div></div><div id="36528454" class="c"><input type="checkbox" id="c-36528454" checked=""/><div class="controls bullet"><span class="by">nologic01</span><span>|</span><a href="#36529986">prev</a><span>|</span><a href="#36529957">next</a><span>|</span><label class="collapse" for="c-36528454">[-]</label><label class="expand" for="c-36528454">[4 more]</label></div><br/><div class="children"><div class="content">How would you position this vs the Modular&#x2F;Mojo approach which aims to relieve similar pain points.</div><br/><div id="36529639" class="c"><input type="checkbox" id="c-36529639" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36528454">parent</a><span>|</span><a href="#36528576">next</a><span>|</span><label class="collapse" for="c-36529639">[-]</label><label class="expand" for="c-36529639">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s a good question. I actually love the Mojo concept, but see it as very different. They&#x27;re creating a portable acceleration option in Python proper, while we&#x27;re trying to make it so you can easily ship around such code to different infra. You can see them or other DSLs like Ray as handling &quot;inside the cluster&quot; while we&#x27;re focused on solving &quot;outside the cluster.&quot; That&#x27;s what I&#x27;ve picked up from their marketing but could be missing something.<p>In general making code itself more portable is great (which is the objective of many ML compilers) and will make Runhouse even more valuable, because the ability to take the same code and send it to different places shines when those different places can be different compute types.</div><br/></div></div><div id="36528576" class="c"><input type="checkbox" id="c-36528576" checked=""/><div class="controls bullet"><span class="by">daveguy</span><span>|</span><a href="#36528454">parent</a><span>|</span><a href="#36529639">prev</a><span>|</span><a href="#36529281">next</a><span>|</span><label class="collapse" for="c-36528576">[-]</label><label class="expand" for="c-36528576">[1 more]</label></div><br/><div class="children"><div class="content">Looks like Runhouse is FOSS (Apache 2.0) and you get to choose your own infrastructure. I will try out Runhouse. Mojo wants me to send them my info to get started.</div><br/></div></div><div id="36529281" class="c"><input type="checkbox" id="c-36529281" checked=""/><div class="controls bullet"><span class="by">voz_</span><span>|</span><a href="#36528454">parent</a><span>|</span><a href="#36528576">prev</a><span>|</span><a href="#36529957">next</a><span>|</span><label class="collapse" for="c-36529281">[-]</label><label class="expand" for="c-36529281">[1 more]</label></div><br/><div class="children"><div class="content">What is the mojo approach?</div><br/></div></div></div></div><div id="36529957" class="c"><input type="checkbox" id="c-36529957" checked=""/><div class="controls bullet"><span class="by">chenzhekl</span><span>|</span><a href="#36528454">prev</a><span>|</span><a href="#36528178">next</a><span>|</span><label class="collapse" for="c-36529957">[-]</label><label class="expand" for="c-36529957">[2 more]</label></div><br/><div class="children"><div class="content">How do you compare Runhouse with Ray which also simplifies distributed computing?</div><br/><div id="36530253" class="c"><input type="checkbox" id="c-36530253" checked=""/><div class="controls bullet"><span class="by">donnygreenberg</span><span>|</span><a href="#36529957">parent</a><span>|</span><a href="#36528178">next</a><span>|</span><label class="collapse" for="c-36530253">[-]</label><label class="expand" for="c-36530253">[1 more]</label></div><br/><div class="children"><div class="content">Good question. We actually use Ray to handle a bunch of the scheduling within the compute, but largely see our role as outside the compute. Meaning, Ray provides a powerful DSL for distributed compute, while we are aggressively DSL-free so users can ship Ray code, PyTorch Distributed, Accelerate, Horovod, etc. to their hardware through Runhouse. We&#x27;re more focused on connecting disparate compute and storage and making them multiplayer (but largely see the cluster as an opaque unit of compute) while they&#x27;re more focused on enabling distribution inside the cluster, if that makes sense.</div><br/></div></div></div></div></div></div></div></div></div></body></html>