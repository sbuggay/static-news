<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1689757254306" as="style"/><link rel="stylesheet" href="styles.css?v=1689757254306"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.europython.eu/kraken-technologies-how-we-organize-our-very-large-pythonmonolith/">Kraken Technologies: How we organise our large Python monolith</a> <span class="domain">(<a href="https://blog.europython.eu">blog.europython.eu</a>)</span></div><div class="subtext"><span>rbanffy</span> | <span>18 comments</span></div><br/><div><div id="36779743" class="c"><input type="checkbox" id="c-36779743" checked=""/><div class="controls bullet"><span class="by">CraigJPerry</span><span>|</span><a href="#36782340">next</a><span>|</span><label class="collapse" for="c-36779743">[-]</label><label class="expand" for="c-36779743">[5 more]</label></div><br/><div class="children"><div class="content">This is java circa 2009 flavoured, this model was a popular approach in the java community around that timeframe. Was enforcer the name of the maven plugin? I can’t remember now, but it became fairly popular.<p>I wonder if this might be susceptible to the same issues that we had in java, specifically it doesn’t prevent accidental duplication, it makes refactoring harder&#x2F;slower and it’s problematic for the team when it unexpectedly doesn’t catch a misuse - and this happens because the rules enforcement can only happen effectively if the rules themselves are perfect and complete and that gets harder to guarantee with scale and speed of iteration.<p>For my money today, there’s another model “polylith” which is similar in some ways and as easy to understand but maybe simpler to evolve&#x2F;change your mind over time.</div><br/><div id="36779833" class="c"><input type="checkbox" id="c-36779833" checked=""/><div class="controls bullet"><span class="by">photonthug</span><span>|</span><a href="#36779743">parent</a><span>|</span><a href="#36782580">next</a><span>|</span><label class="collapse" for="c-36779833">[-]</label><label class="expand" for="c-36779833">[2 more]</label></div><br/><div class="children"><div class="content">&gt; this happens because the rules enforcement can only happen effectively if the rules themselves are perfect and complete and that gets harder to guarantee with scale and speed of iteration.<p>IMHO, project-level assertions about initialization-order feels a little bit dirty, but potentially practical as long as there&#x27;s only a few rules.  Surely even a bazillion line monolith can still often be thought of in terms of a few layers.  But by the time you get to lots of rules it&#x27;s getting hard to stomach the code-smell and keep justifying it as practical.  At that point I&#x27;d want something dynamic and backed by a real solver.. not just a layer of static-analysis.<p>The deal framework for DBC doesn&#x27;t quite do this afaik but is starting to expose some stuff along these lines, and at least can assert imports are &quot;pure&quot;.  <a href="https:&#x2F;&#x2F;deal.readthedocs.io&#x2F;details&#x2F;module_load.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;deal.readthedocs.io&#x2F;details&#x2F;module_load.html</a></div><br/><div id="36783223" class="c"><input type="checkbox" id="c-36783223" checked=""/><div class="controls bullet"><span class="by">ianandrich</span><span>|</span><a href="#36779743">root</a><span>|</span><a href="#36779833">parent</a><span>|</span><a href="#36782580">next</a><span>|</span><label class="collapse" for="c-36783223">[-]</label><label class="expand" for="c-36783223">[1 more]</label></div><br/><div class="children"><div class="content">Have you had any experience using deal on personal projects or professionally yet?</div><br/></div></div></div></div><div id="36782580" class="c"><input type="checkbox" id="c-36782580" checked=""/><div class="controls bullet"><span class="by">barefeg</span><span>|</span><a href="#36779743">parent</a><span>|</span><a href="#36779833">prev</a><span>|</span><a href="#36781203">next</a><span>|</span><label class="collapse" for="c-36782580">[-]</label><label class="expand" for="c-36782580">[1 more]</label></div><br/><div class="children"><div class="content">What is the current flavor in Java?</div><br/></div></div><div id="36781203" class="c"><input type="checkbox" id="c-36781203" checked=""/><div class="controls bullet"><span class="by">bnert</span><span>|</span><a href="#36779743">parent</a><span>|</span><a href="#36782580">prev</a><span>|</span><a href="#36782340">next</a><span>|</span><label class="collapse" for="c-36781203">[-]</label><label class="expand" for="c-36781203">[1 more]</label></div><br/><div class="children"><div class="content">polylith ftw.<p>Been learning some of the idioms of a polylith architecture using the `poly` tool + clojure. Really enjoying the idioms&#x2F;practices it encourages.</div><br/></div></div></div></div><div id="36782340" class="c"><input type="checkbox" id="c-36782340" checked=""/><div class="controls bullet"><span class="by">gyulai</span><span>|</span><a href="#36779743">prev</a><span>|</span><a href="#36780982">next</a><span>|</span><label class="collapse" for="c-36782340">[-]</label><label class="expand" for="c-36782340">[6 more]</label></div><br/><div class="children"><div class="content">I quite like layered dependency structures.<p>I even have a lua codebase where I&#x27;ve linearized the sourcecode files into a particular order.  The layout looks like this:<p><pre><code>  01_foo&#x2F;  
    03_foo.lua  
    04_bar.lua  
    15_whatever.lua  
  02_bar&#x2F;  
    22_whatever.lua  
    56_something.lua  
</code></pre>
It has always bothered me in codebases that they don&#x27;t have a &quot;beginning&quot; and an &quot;end&quot;, and therefore it&#x27;s difficult for a reader to know where to start when they just want to read the codebase.<p>So, my approach is to impose this linear order and only allow code that comes later to depend on code that comes earlier, never the other way around.  This way, you can read through the code rather easily.  As you look at any piece of code, it will only depend on code you&#x27;ve already looked at, so you don&#x27;t have to be constantly jumping through the codebase as you&#x27;re reading.<p>I&#x27;ve also found that failure to correspond to a linearizable dependency structure is a &quot;code smell&quot;, and that, as I try to eradicate that code smell, I frequently end up with code that&#x27;s better in all kinds of ways.</div><br/><div id="36782439" class="c"><input type="checkbox" id="c-36782439" checked=""/><div class="controls bullet"><span class="by">globalreset</span><span>|</span><a href="#36782340">parent</a><span>|</span><a href="#36782451">next</a><span>|</span><label class="collapse" for="c-36782439">[-]</label><label class="expand" for="c-36782439">[4 more]</label></div><br/><div class="children"><div class="content">That sounds like one of the things they could write about in dailywtf.<p>First, who has time to read a project from start to beginning. Second, as the time changes the dependencies between parts will change as well.</div><br/><div id="36782690" class="c"><input type="checkbox" id="c-36782690" checked=""/><div class="controls bullet"><span class="by">gyulai</span><span>|</span><a href="#36782340">root</a><span>|</span><a href="#36782439">parent</a><span>|</span><a href="#36782451">next</a><span>|</span><label class="collapse" for="c-36782690">[-]</label><label class="expand" for="c-36782690">[3 more]</label></div><br/><div class="children"><div class="content">Who has time to write documentation?  As the software evolves, the documentation will need changing.  Who has time to write unit tests?  As the modules evolve, the unit tests will need updating.  Why do any of these things?<p>A well-written piece of code that actually solves a complex problem is a demanding mistress and doesn&#x27;t appreciate the &quot;who has time...&quot; attitude.<p>Among the software engineering good practices that I engage in, I&#x27;m finding this to be one of the highest bang-for-the-buck ones.<p>For example, literate programming is a thing that many people believe is worth the effort, at least in certain scenarios and at least for certain parts of codebases:  But, if you can make your codebase more readable without requiring additional prose to be written, then that&#x27;s a comparatively high bang-for-the-buck alternative.<p>In practice, linear structure doesn&#x27;t need all that much updating at all: You may have noticed that I don&#x27;t use strictly sequential numbers.  Early in the life of the codebase, I will generally skip lots of numbers, so that I can fill in the gaps with code that comes later.  Mostly, all it really takes is to be <i>intentional</i> about where in the linear order to insert new code.<p>Also, note that it&#x27;s still useful, even if no one ever goes on a mission to read the codebase in its entirety.  If the codebase as a whole has a linear structure, that also imposes a linear structure on any subset of it.  If you have five sourcecode files that are somehow pertinent to something you&#x27;re doing, you immediately know the order in which to look at them.</div><br/><div id="36783241" class="c"><input type="checkbox" id="c-36783241" checked=""/><div class="controls bullet"><span class="by">globalreset</span><span>|</span><a href="#36782340">root</a><span>|</span><a href="#36782690">parent</a><span>|</span><a href="#36782451">next</a><span>|</span><label class="collapse" for="c-36783241">[-]</label><label class="expand" for="c-36783241">[2 more]</label></div><br/><div class="children"><div class="content">Large part of biggest crimes I&#x27;ve seen in software comes down to picking some allegedly good property and optimizing for it irrespective of costs and limitations it involves. Encapsulation, modularity, flexibility, readability, purity, testability - you name it. Some dubious, some reasonable - no matter what, it usually involves costs and drawbacks.<p>I have 99 big problems developing software, and not being able to read it from start to end ain&#x27;t one.<p>I&#x27;m a bit jealous for people advocating such things, being able to work on software tiny enough to even be able to think this is practical. Literate programming could work for tiny software that can be approximately flattened to a 1d &quot;story&quot;: &quot;beginning -&gt; end&quot; with only minor detours.<p>Most of projects I worked with was large enough that things are optimized precisely for not having to understand large parts that were abstracted away (and the problem is to try to do it without introducing too much complexity).</div><br/><div id="36783582" class="c"><input type="checkbox" id="c-36783582" checked=""/><div class="controls bullet"><span class="by">gyulai</span><span>|</span><a href="#36782340">root</a><span>|</span><a href="#36783241">parent</a><span>|</span><a href="#36782451">next</a><span>|</span><label class="collapse" for="c-36783582">[-]</label><label class="expand" for="c-36783582">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s not so much about the size of the codebase, it&#x27;s more about the tradeoff of how much code there is, versus how much intrinsic&#x2F;real complexity.<p>By &quot;real&quot; complexity, I mean to exclude complexity for complexity&#x27;s sake, or complexity that&#x27;s a side effect of a piece of software being concerned with itself and its own structure rather than with solving any problem that exists outside of it. -- We can surely all agree that the latter is bad.<p>Academic prototypes, for example, tend to solve highly complex problems with small codebases, but the problems are often contrived or they are tiny pieces of systems that would have to be much larger to be of any use.<p>Software systems you encounter in your run-of-the-mill software engineering business often have huge codebases, but the large size is not due to the fact that there&#x27;s any problem there of any real complexity.  The system just needs to solve trivial problems, and there are just <i>a lot</i> of them.<p>But you can certainly have systems that need to solve many problems and some of those problems have high intrinsic complexity.  In such a scenario, it&#x27;s important to recognize that there&#x27;s a part of your system that&#x27;s &quot;extra special&quot; due to its complexity, and needs to be approached in a way that&#x27;s different from how you approach most of your engineering.  You might need to write a library in a literate programming style, and then use that library from your other code, which isn&#x27;t written in literate style.  Engineering organizations are seldom able to have that kind of flexibility.  The opinion you&#x27;re likely to get is &quot;we don&#x27;t do literate programming here&quot;.  The outcome is that such organizations are just not capable of writing such systems, because a system is only as good as the worst job you&#x27;ve done at solving any of the problems it raises.</div><br/></div></div></div></div></div></div></div></div><div id="36782451" class="c"><input type="checkbox" id="c-36782451" checked=""/><div class="controls bullet"><span class="by">banashark</span><span>|</span><a href="#36782340">parent</a><span>|</span><a href="#36782439">prev</a><span>|</span><a href="#36780982">next</a><span>|</span><label class="collapse" for="c-36782451">[-]</label><label class="expand" for="c-36782451">[1 more]</label></div><br/><div class="children"><div class="content">This was always one of my favorite parts of f#. It’s not only mandated for structures within a file (no hoisting), but also for files within a project.<p>Reading and understanding an f# code base has always been vastly more simple to me than the incredible indirection of some other codebases (trying to find where the provider for the factory of the abstract class member that’s an interface implemented by 10 almost exactly similar c# classes? Good luck &#x2F;s)</div><br/></div></div></div></div><div id="36780982" class="c"><input type="checkbox" id="c-36780982" checked=""/><div class="controls bullet"><span class="by">mint2</span><span>|</span><a href="#36782340">prev</a><span>|</span><a href="#36779431">next</a><span>|</span><label class="collapse" for="c-36780982">[-]</label><label class="expand" for="c-36780982">[2 more]</label></div><br/><div class="children"><div class="content">Note, this is not the crypto kraken, it’s a different kraken for those who ignore crypto related stuff</div><br/><div id="36782003" class="c"><input type="checkbox" id="c-36782003" checked=""/><div class="controls bullet"><span class="by">loveparade</span><span>|</span><a href="#36780982">parent</a><span>|</span><a href="#36779431">next</a><span>|</span><label class="collapse" for="c-36782003">[-]</label><label class="expand" for="c-36782003">[1 more]</label></div><br/><div class="children"><div class="content">Why does it matter? Just because I don&#x27;t like Google doesn&#x27;t mean they suck at writing Python code. The same goes for anything crypto.</div><br/></div></div></div></div><div id="36779431" class="c"><input type="checkbox" id="c-36779431" checked=""/><div class="controls bullet"><span class="by">photonthug</span><span>|</span><a href="#36780982">prev</a><span>|</span><a href="#36782133">next</a><span>|</span><label class="collapse" for="c-36779431">[-]</label><label class="expand" for="c-36779431">[3 more]</label></div><br/><div class="children"><div class="content">Never heard of <a href="https:&#x2F;&#x2F;import-linter.readthedocs.io&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;import-linter.readthedocs.io&#x2F;</a> before.  Not sure if I like this type of solution, but it&#x27;s interesting, and certainly the problem is real.</div><br/><div id="36779584" class="c"><input type="checkbox" id="c-36779584" checked=""/><div class="controls bullet"><span class="by">bitdivision</span><span>|</span><a href="#36779431">parent</a><span>|</span><a href="#36782133">next</a><span>|</span><label class="collapse" for="c-36779584">[-]</label><label class="expand" for="c-36779584">[2 more]</label></div><br/><div class="children"><div class="content">The author, David Seddon, is also the author of the package [0]. So I&#x27;m guessing Kraken was an initial user.<p>0: <a href="https:&#x2F;&#x2F;import-linter.readthedocs.io&#x2F;en&#x2F;stable&#x2F;authors.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;import-linter.readthedocs.io&#x2F;en&#x2F;stable&#x2F;authors.html</a></div><br/><div id="36782566" class="c"><input type="checkbox" id="c-36782566" checked=""/><div class="controls bullet"><span class="by">walthamstow</span><span>|</span><a href="#36779431">root</a><span>|</span><a href="#36779584">parent</a><span>|</span><a href="#36782133">next</a><span>|</span><label class="collapse" for="c-36782566">[-]</label><label class="expand" for="c-36782566">[1 more]</label></div><br/><div class="children"><div class="content">Interesting that he doesn&#x27;t blow his own horn about being the author of the linting tool. He simply describes it as &#x27;an open source tool&#x27;</div><br/></div></div></div></div></div></div><div id="36782133" class="c"><input type="checkbox" id="c-36782133" checked=""/><div class="controls bullet"><span class="by">febed</span><span>|</span><a href="#36779431">prev</a><span>|</span><label class="collapse" for="c-36782133">[-]</label><label class="expand" for="c-36782133">[1 more]</label></div><br/><div class="children"><div class="content">IMHO the customer specific stuff should have been forked out into a separate repo instead of cluttering up the main one</div><br/></div></div></div></div></div></div></div></body></html>