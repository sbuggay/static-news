<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714122122619" as="style"/><link rel="stylesheet" href="styles.css?v=1714122122619"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.erlang.org/blog/optimizations/">The Optimizations in Erlang/OTP 27</a> <span class="domain">(<a href="https://www.erlang.org">www.erlang.org</a>)</span></div><div class="subtext"><span>pjmlp</span> | <span>20 comments</span></div><br/><div><div id="40165700" class="c"><input type="checkbox" id="c-40165700" checked=""/><div class="controls bullet"><span class="by">asa400</span><span>|</span><a href="#40163813">next</a><span>|</span><label class="collapse" for="c-40165700">[-]</label><label class="expand" for="c-40165700">[2 more]</label></div><br/><div class="children"><div class="content">This is not mentioned in the article, but since it has performance implications for a ton of BEAM applications, it&#x27;s probably relevant: OTP 27 will also include a new builtin JSON module, and I did a quick and dirty benchmark [1] of it against Elixir&#x27;s (excellent) Jason library. It seems like it&#x27;ll be a pretty good performance win for BEAM applications that work with JSON.<p>[1] <a href="https:&#x2F;&#x2F;zeroclarkthirty.com&#x2F;2024-04-21-benchmarking-erlangs-new-json" rel="nofollow">https:&#x2F;&#x2F;zeroclarkthirty.com&#x2F;2024-04-21-benchmarking-erlangs-...</a></div><br/><div id="40165940" class="c"><input type="checkbox" id="c-40165940" checked=""/><div class="controls bullet"><span class="by">Zambyte</span><span>|</span><a href="#40165700">parent</a><span>|</span><a href="#40163813">next</a><span>|</span><label class="collapse" for="c-40165940">[-]</label><label class="expand" for="c-40165940">[1 more]</label></div><br/><div class="children"><div class="content">Coincidentally I started playing around with CouchDB today. I wonder if this will have much of an impact on its performance.</div><br/></div></div></div></div><div id="40163813" class="c"><input type="checkbox" id="c-40163813" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#40165700">prev</a><span>|</span><a href="#40166383">next</a><span>|</span><label class="collapse" for="c-40163813">[-]</label><label class="expand" for="c-40163813">[9 more]</label></div><br/><div class="children"><div class="content">&gt; ...It measures the time to convert a binary holding 1,262,000 digits to an integer.<p>&gt; Running an unpatched Erlang&#x2F;OTP 26 on my Intel-based iMac from 2017, the benchmark finishes in about 10 seconds.<p>&gt; The same benchmark run using Erlang&#x2F;OTP 26.0.2 finishes in about 0.4 seconds.<p>I love that Erlang even <i>supports</i> an integer with 1,262,000 digits, but I imagine that&#x27;s one reason it&#x27;ll never be a mathematical speed daemon.</div><br/><div id="40164701" class="c"><input type="checkbox" id="c-40164701" checked=""/><div class="controls bullet"><span class="by">retrac</span><span>|</span><a href="#40163813">parent</a><span>|</span><a href="#40164440">next</a><span>|</span><label class="collapse" for="c-40164701">[-]</label><label class="expand" for="c-40164701">[2 more]</label></div><br/><div class="children"><div class="content">Arbitrary precision integers aren&#x27;t necessarily that expensive to implement.  It does require overflow checking for operations on regular fixed integers, and keeping track of type, but if you&#x27;re doing that anyway (many languages are) then it&#x27;s almost free; the bignum code only runs when it doesn&#x27;t fit in a fixed integer.  Common Lisp, Python, Haskell use big integers for all integers, too.  And others, I&#x27;m sure.  It can be optimized away by a compiler to just fixed integers, sometimes.</div><br/><div id="40165826" class="c"><input type="checkbox" id="c-40165826" checked=""/><div class="controls bullet"><span class="by">hayley-patton</span><span>|</span><a href="#40163813">root</a><span>|</span><a href="#40164701">parent</a><span>|</span><a href="#40164440">next</a><span>|</span><label class="collapse" for="c-40165826">[-]</label><label class="expand" for="c-40165826">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It can be optimized away by a compiler to just fixed integers, sometimes<p>Yep, SBCL does range analysis and can do inline fixnum or unboxed arithmetic.</div><br/></div></div></div></div><div id="40164440" class="c"><input type="checkbox" id="c-40164440" checked=""/><div class="controls bullet"><span class="by">nickpeterson</span><span>|</span><a href="#40163813">parent</a><span>|</span><a href="#40164701">prev</a><span>|</span><a href="#40166370">next</a><span>|</span><label class="collapse" for="c-40164440">[-]</label><label class="expand" for="c-40164440">[2 more]</label></div><br/><div class="children"><div class="content">It really pisses me off because sometimes I have numbers with 1,262,001 digits and erlang leaves me completely stranded!</div><br/><div id="40165739" class="c"><input type="checkbox" id="c-40165739" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#40163813">root</a><span>|</span><a href="#40164440">parent</a><span>|</span><a href="#40166370">next</a><span>|</span><label class="collapse" for="c-40165739">[-]</label><label class="expand" for="c-40165739">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think there&#x27;s an explicit to large integers, other than memory? Just the benchmark needs to pick a size, and 1_262_000 digits is used for the benchmark.<p>And Erlang&#x2F;OTP follows a pattern of not setting limits on things unless needed, but not necessarily being well optimized at large sizes. Big integers have been there forever? with no explicit size limit, but pretty slow for the last several decades.</div><br/></div></div></div></div><div id="40166370" class="c"><input type="checkbox" id="c-40166370" checked=""/><div class="controls bullet"><span class="by">andy_ppp</span><span>|</span><a href="#40163813">parent</a><span>|</span><a href="#40164440">prev</a><span>|</span><a href="#40164825">next</a><span>|</span><label class="collapse" for="c-40166370">[-]</label><label class="expand" for="c-40166370">[2 more]</label></div><br/><div class="children"><div class="content">If you need mathematical performance and parallel computing (SIMD or matrix multiplication) it might be worth using the NX library which is basically the elixir equivalent of numpy. Otherwise you could probably write maths stuff in rustler if there really is a performance issue. Generally it’s immutability slowing down the maths not the calculations.</div><br/><div id="40166485" class="c"><input type="checkbox" id="c-40166485" checked=""/><div class="controls bullet"><span class="by">mrkeen</span><span>|</span><a href="#40163813">root</a><span>|</span><a href="#40166370">parent</a><span>|</span><a href="#40164825">next</a><span>|</span><label class="collapse" for="c-40166485">[-]</label><label class="expand" for="c-40166485">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Generally it’s immutability slowing down the maths not the calculations<p>&gt;&gt; A brief history of recent optimizations<p>&gt;&gt; Erlang&#x2F;OTP 22 introduced a new SSA-based intermediate representation in the compiler.</div><br/></div></div></div></div><div id="40164825" class="c"><input type="checkbox" id="c-40164825" checked=""/><div class="controls bullet"><span class="by">gregors</span><span>|</span><a href="#40163813">parent</a><span>|</span><a href="#40166370">prev</a><span>|</span><a href="#40165634">next</a><span>|</span><label class="collapse" for="c-40164825">[-]</label><label class="expand" for="c-40164825">[1 more]</label></div><br/><div class="children"><div class="content">I actually really love this!<p>Using Karatsuba fixes a problem I&#x27;ve been complaining about for awhile when I&#x27;d run into certain fake-believe leetcode style problem or just doing weird non-sensical math benchmarks across different languages.<p>If you&#x27;re not familiar with Karatsuba checkout the following<p>* <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=frT1UPiJUO0" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=frT1UPiJUO0</a><p>* <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=JCbZayFr9RE" rel="nofollow">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=JCbZayFr9RE</a></div><br/></div></div><div id="40165634" class="c"><input type="checkbox" id="c-40165634" checked=""/><div class="controls bullet"><span class="by">hinkley</span><span>|</span><a href="#40163813">parent</a><span>|</span><a href="#40164825">prev</a><span>|</span><a href="#40166383">next</a><span>|</span><label class="collapse" for="c-40165634">[-]</label><label class="expand" for="c-40165634">[1 more]</label></div><br/><div class="children"><div class="content">I had a problem last year with opentelemetry.js where it started concatenating numbers as strings instead of summing them. The backend, which I believe is Python? Did not blow up until we hit somewhere north of 300 digits, which is still pretty good.<p>But a million digits is a pretty good BigInteger. What is that? Half a megabyte?</div><br/></div></div></div></div><div id="40166383" class="c"><input type="checkbox" id="c-40166383" checked=""/><div class="controls bullet"><span class="by">Muromec</span><span>|</span><a href="#40163813">prev</a><span>|</span><a href="#40164434">next</a><span>|</span><label class="collapse" for="c-40166383">[-]</label><label class="expand" for="c-40166383">[1 more]</label></div><br/><div class="children"><div class="content">Well, that&#x27;s nice. Maybe 2025 will be the year I finally get an Erlang&#x2F;Elixir job</div><br/></div></div><div id="40164434" class="c"><input type="checkbox" id="c-40164434" checked=""/><div class="controls bullet"><span class="by">alberth</span><span>|</span><a href="#40166383">prev</a><span>|</span><a href="#40164038">next</a><span>|</span><label class="collapse" for="c-40164434">[-]</label><label class="expand" for="c-40164434">[2 more]</label></div><br/><div class="children"><div class="content">Seems like most of the optimizations were actually in 26.0.2 (not 27).</div><br/><div id="40166164" class="c"><input type="checkbox" id="c-40166164" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#40164434">parent</a><span>|</span><a href="#40164038">next</a><span>|</span><label class="collapse" for="c-40166164">[-]</label><label class="expand" for="c-40166164">[1 more]</label></div><br/><div class="children"><div class="content">Most of the post is about changes in 27; although most of the binary_to_integer&#x2F;1 improvement is indeed from 26.0.2.</div><br/></div></div></div></div><div id="40164038" class="c"><input type="checkbox" id="c-40164038" checked=""/><div class="controls bullet"><span class="by">lamuswawir</span><span>|</span><a href="#40164434">prev</a><span>|</span><label class="collapse" for="c-40164038">[-]</label><label class="expand" for="c-40164038">[5 more]</label></div><br/><div class="children"><div class="content">If no more optimisations could be done in OTP 22, does that mean 22 is completed software.</div><br/><div id="40166045" class="c"><input type="checkbox" id="c-40166045" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#40164038">parent</a><span>|</span><a href="#40165716">next</a><span>|</span><label class="collapse" for="c-40166045">[-]</label><label class="expand" for="c-40166045">[1 more]</label></div><br/><div class="children"><div class="content">I was going to say that OTP was certainly done, but it got a patch last month [1]. I don&#x27;t expect many more? But just because OTP 22 is done, doesn&#x27;t mean OTP is done. There&#x27;s obviously lots of optimization available that can be done, as well as ports to future architectures, and the requirements aren&#x27;t set in stone; it&#x27;s got a TLS stack, so that&#x27;s never done for example.<p>[1] <a href="https:&#x2F;&#x2F;www.erlang.org&#x2F;patches&#x2F;otp-22.3.4.27" rel="nofollow">https:&#x2F;&#x2F;www.erlang.org&#x2F;patches&#x2F;otp-22.3.4.27</a></div><br/></div></div><div id="40165716" class="c"><input type="checkbox" id="c-40165716" checked=""/><div class="controls bullet"><span class="by">imoverclocked</span><span>|</span><a href="#40164038">parent</a><span>|</span><a href="#40166045">prev</a><span>|</span><label class="collapse" for="c-40165716">[-]</label><label class="expand" for="c-40165716">[3 more]</label></div><br/><div class="children"><div class="content">Software isn’t complete until it is lost.</div><br/><div id="40165927" class="c"><input type="checkbox" id="c-40165927" checked=""/><div class="controls bullet"><span class="by">worthless-trash</span><span>|</span><a href="#40164038">root</a><span>|</span><a href="#40165716">parent</a><span>|</span><label class="collapse" for="c-40165927">[-]</label><label class="expand" for="c-40165927">[2 more]</label></div><br/><div class="children"><div class="content">Not all which is lost is complete though.</div><br/><div id="40166926" class="c"><input type="checkbox" id="c-40166926" checked=""/><div class="controls bullet"><span class="by">Y_Y</span><span>|</span><a href="#40164038">root</a><span>|</span><a href="#40165927">parent</a><span>|</span><label class="collapse" for="c-40166926">[-]</label><label class="expand" for="c-40166926">[1 more]</label></div><br/><div class="children"><div class="content">Not all which is lost, wanders</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>