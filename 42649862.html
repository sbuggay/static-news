<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1736758873826" as="style"/><link rel="stylesheet" href="styles.css?v=1736758873826"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.downtowndougbrown.com/2024/04/why-is-my-cpu-usage-always-100-upgrading-my-chumby-8-kernel-part-9/">Why is my CPU usage always 100%?</a>Â <span class="domain">(<a href="https://www.downtowndougbrown.com">www.downtowndougbrown.com</a>)</span></div><div class="subtext"><span>pncnmnp</span> | <span>16 comments</span></div><br/><div><div id="42681449" class="c"><input type="checkbox" id="c-42681449" checked=""/><div class="controls bullet"><span class="by">sneela</span><span>|</span><a href="#42680977">next</a><span>|</span><label class="collapse" for="c-42681449">[-]</label><label class="expand" for="c-42681449">[1 more]</label></div><br/><div class="children"><div class="content">This is a wonderful write-up and a very enjoyable read. Although my knowledge about systems programming on ARM is limited, I know that it isn&#x27;t easy to read hardware-based time counters; at the very least, it&#x27;s not as simple as the x86 rdtsc [1]. This is probably why the author writes:<p>&gt; This code is more complicated than what I expected to see. I was thinking it would just be a simple register read. Instead, it has to write a 1 to the register, and then delay for a while, and then read back the same register. There was also a very noticeable FIXME in the comment for the function, which definitely raised a red flag in my mind.<p>Regardless, this was a very nice read and I&#x27;m glad they got down to the issue and the problem fixed.<p>[1]: <a href="https:&#x2F;&#x2F;www.felixcloutier.com&#x2F;x86&#x2F;rdtsc" rel="nofollow">https:&#x2F;&#x2F;www.felixcloutier.com&#x2F;x86&#x2F;rdtsc</a>.</div><br/></div></div><div id="42680977" class="c"><input type="checkbox" id="c-42680977" checked=""/><div class="controls bullet"><span class="by">veltas</span><span>|</span><a href="#42681449">prev</a><span>|</span><a href="#42681395">next</a><span>|</span><label class="collapse" for="c-42680977">[-]</label><label class="expand" for="c-42680977">[2 more]</label></div><br/><div class="children"><div class="content">It doesn&#x27;t feel like reading 4 times is necessarily a portable solution, if there will be more versions at different speeds and different I&#x2F;O architectures; or how this will work under more load, and whether the original change was done to fix some other performance problem OP is not aware of, but not sure what else can be done.  Unfortunately many vendors like Marvell can seriously under-document crucial features like this.  If anything it would be good to put some of this info in the comment itself, not very elegant but how else practically are we meant to keep track of this, is the mailing list part of the documentation?<p>Doesn&#x27;t look like there&#x27;s a lot of discussion on the mailing list, but I don&#x27;t know if I&#x27;m reading the thread view correctly.</div><br/><div id="42681269" class="c"><input type="checkbox" id="c-42681269" checked=""/><div class="controls bullet"><span class="by">_nalply</span><span>|</span><a href="#42680977">parent</a><span>|</span><a href="#42681395">next</a><span>|</span><label class="collapse" for="c-42681269">[-]</label><label class="expand" for="c-42681269">[1 more]</label></div><br/><div class="children"><div class="content">I also wondered about this, but there&#x27;s a crucial differnce, no idea if it matters: in that loop it reads the register, so the register is read at least 4 times.</div><br/></div></div></div></div><div id="42681395" class="c"><input type="checkbox" id="c-42681395" checked=""/><div class="controls bullet"><span class="by">g-b-r</span><span>|</span><a href="#42680977">prev</a><span>|</span><a href="#42681165">next</a><span>|</span><label class="collapse" for="c-42681395">[-]</label><label class="expand" for="c-42681395">[2 more]</label></div><br/><div class="children"><div class="content">I expected it to be about holding down the spacebar :&#x2F;</div><br/><div id="42681438" class="c"><input type="checkbox" id="c-42681438" checked=""/><div class="controls bullet"><span class="by">labster</span><span>|</span><a href="#42681395">parent</a><span>|</span><a href="#42681165">next</a><span>|</span><label class="collapse" for="c-42681438">[-]</label><label class="expand" for="c-42681438">[1 more]</label></div><br/><div class="children"><div class="content">Spacebar heating was great for my workflow, please re-enable</div><br/></div></div></div></div><div id="42681165" class="c"><input type="checkbox" id="c-42681165" checked=""/><div class="controls bullet"><span class="by">begueradj</span><span>|</span><a href="#42681395">prev</a><span>|</span><label class="collapse" for="c-42681165">[-]</label><label class="expand" for="c-42681165">[10 more]</label></div><br/><div class="children"><div class="content">Oops, this is not valid.</div><br/><div id="42681297" class="c"><input type="checkbox" id="c-42681297" checked=""/><div class="controls bullet"><span class="by">homebrewer</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681316">next</a><span>|</span><label class="collapse" for="c-42681297">[-]</label><label class="expand" for="c-42681297">[1 more]</label></div><br/><div class="children"><div class="content">This feels like the often-repeated &quot;argument&quot; that Electron applications are fine because &quot;unused memory is wasted memory&quot;. What Linus meant by that is that the operating system should strive to use as much of the <i>free</i> RAM as possible for things like file and dentry caches. Not that memory should be wasted on millions of layers of abstraction and too-high resolution images. But it&#x27;s often misunderstood that way.</div><br/></div></div><div id="42681316" class="c"><input type="checkbox" id="c-42681316" checked=""/><div class="controls bullet"><span class="by">TonyTrapp</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681297">prev</a><span>|</span><a href="#42681259">next</a><span>|</span><label class="collapse" for="c-42681316">[-]</label><label class="expand" for="c-42681316">[1 more]</label></div><br/><div class="children"><div class="content">What you are probably thinking of is &quot;race to idle&quot;. A CPU should process everything it can, as quickly it can (using all the power), and then go to an idle state, instead of processing everything slowly (potentially consuming less energy at that time) but take more time.</div><br/></div></div><div id="42681259" class="c"><input type="checkbox" id="c-42681259" checked=""/><div class="controls bullet"><span class="by">josephg</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681316">prev</a><span>|</span><a href="#42681253">next</a><span>|</span><label class="collapse" for="c-42681259">[-]</label><label class="expand" for="c-42681259">[4 more]</label></div><br/><div class="children"><div class="content">Only when your computer actually has work to do. Otherwise your CPU is just a really expensive heater.<p>Modern computers are designed to idle at 0% then temporarily boost up when you have work to do. Then once the task is done, they can drop back to idle and cool down again.</div><br/><div id="42681278" class="c"><input type="checkbox" id="c-42681278" checked=""/><div class="controls bullet"><span class="by">PUSH_AX</span><span>|</span><a href="#42681165">root</a><span>|</span><a href="#42681259">parent</a><span>|</span><a href="#42681253">next</a><span>|</span><label class="collapse" for="c-42681278">[-]</label><label class="expand" for="c-42681278">[3 more]</label></div><br/><div class="children"><div class="content">Not that I disagree, but when exactly in modern operating systems are there moments where there are zero instructions being executed? Surely there are always processes doing background things?</div><br/><div id="42681361" class="c"><input type="checkbox" id="c-42681361" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#42681165">root</a><span>|</span><a href="#42681278">parent</a><span>|</span><a href="#42681345">next</a><span>|</span><label class="collapse" for="c-42681361">[-]</label><label class="expand" for="c-42681361">[1 more]</label></div><br/><div class="children"><div class="content">There are a lot of such moments, but they are just short. When you&#x27;re playing music, you download a bit of data from the network or the SSD&#x2F;HDD by first issuing a request and then waiting (i.e. doing nothing) to get the short piece of data back. Then you decode it and upload a short bit of the sound to your sound card and then again you wait for new space to come up, before you send more data.<p>One of the older ways (in x86 side) to do this was to invoke the HLT instruction <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;HLT_(x86_instruction)" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;HLT_(x86_instruction)</a> : you stop the processor, and then the processor wakes up when an interrupt wakes it up. An interrupt might come from the sound card, network card, keyboard, GPU, timer (e.g. 100 times a second to schedule an another process, if some process exists that is waiting for CPU), and during the time you wait for the interrupt to happen you just do nothing, thus saving energy.<p>I suspect things are more complicated in the world of multiple CPUs.</div><br/></div></div><div id="42681345" class="c"><input type="checkbox" id="c-42681345" checked=""/><div class="controls bullet"><span class="by">pintxo</span><span>|</span><a href="#42681165">root</a><span>|</span><a href="#42681278">parent</a><span>|</span><a href="#42681361">prev</a><span>|</span><a href="#42681253">next</a><span>|</span><label class="collapse" for="c-42681345">[-]</label><label class="expand" for="c-42681345">[1 more]</label></div><br/><div class="children"><div class="content">With multi-core cpus, some of them can be fully off, while others handle any background tasks.</div><br/></div></div></div></div></div></div><div id="42681253" class="c"><input type="checkbox" id="c-42681253" checked=""/><div class="controls bullet"><span class="by">zaik</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681259">prev</a><span>|</span><a href="#42681200">next</a><span>|</span><label class="collapse" for="c-42681253">[-]</label><label class="expand" for="c-42681253">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re probably thinking about memory and caching. There are no advantages to keeping the CPU at 100% when no workload needs to be done.</div><br/></div></div><div id="42681200" class="c"><input type="checkbox" id="c-42681200" checked=""/><div class="controls bullet"><span class="by">M95D</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681253">prev</a><span>|</span><a href="#42681340">next</a><span>|</span><label class="collapse" for="c-42681200">[-]</label><label class="expand" for="c-42681200">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m sure a few more software updates will take care of this little problem...</div><br/></div></div><div id="42681340" class="c"><input type="checkbox" id="c-42681340" checked=""/><div class="controls bullet"><span class="by">j16sdiz</span><span>|</span><a href="#42681165">parent</a><span>|</span><a href="#42681200">prev</a><span>|</span><label class="collapse" for="c-42681340">[-]</label><label class="expand" for="c-42681340">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  computer architecture courses.<p>I guess it was some _theoretical_ task scheduling stuff.... 
When you are doing task scheduling, yes, maybe, depends on what you optimize for.<p>.... but this bug have nothing  to do with that. This bug is about some accounting error.</div><br/></div></div></div></div></div></div></div></div></div></body></html>