<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1724835687388" as="style"/><link rel="stylesheet" href="styles.css?v=1724835687388"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.apnic.net/2021/11/18/vulnerabilities-show-why-starttls-should-be-avoided-if-possible/">Vulnerabilities show why STARTTLS should be avoided if possible (2021)</a> <span class="domain">(<a href="https://blog.apnic.net">blog.apnic.net</a>)</span></div><div class="subtext"><span>fanf2</span> | <span>50 comments</span></div><br/><div><div id="41372202" class="c"><input type="checkbox" id="c-41372202" checked=""/><div class="controls bullet"><span class="by">hannob</span><span>|</span><a href="#41374601">next</a><span>|</span><label class="collapse" for="c-41372202">[-]</label><label class="expand" for="c-41372202">[3 more]</label></div><br/><div class="children"><div class="content">Author here.<p>If you want more technical details, we&#x27;ve put up a webpage back then, and published a background paper on those vulns:
<a href="https:&#x2F;&#x2F;nostarttls.secvuln.info&#x2F;" rel="nofollow">https:&#x2F;&#x2F;nostarttls.secvuln.info&#x2F;</a></div><br/><div id="41374373" class="c"><input type="checkbox" id="c-41374373" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#41372202">parent</a><span>|</span><a href="#41374601">next</a><span>|</span><label class="collapse" for="c-41374373">[-]</label><label class="expand" for="c-41374373">[2 more]</label></div><br/><div class="children"><div class="content">You explicitly call out imap and other email protocols.  Can this be applied to LDAP?<p>LDAP (think Active Directory if you are short of imagination, and&#x2F;or experience).<p>A lot of connections use STARTTLS on port 389 instead of full on explicit TLS on port 636.  Then there are the other two ports for the &quot;global catalogue&quot; which I think is basically a Win NT style domain flat lists for users and groups on 3268&#x2F;tcp and 3269&#x2F;tcp.<p>I&#x27;ve always had my suspicions about STARTTLS but it looked quite convincing to a sysadmin and was always encouraged by the sort of people who use terms like: &quot;best practice&quot;.  I&#x27;ll start dumping it from now on.  This will take a while.</div><br/><div id="41374981" class="c"><input type="checkbox" id="c-41374981" checked=""/><div class="controls bullet"><span class="by">tass</span><span>|</span><a href="#41372202">root</a><span>|</span><a href="#41374373">parent</a><span>|</span><a href="#41374601">next</a><span>|</span><label class="collapse" for="c-41374981">[-]</label><label class="expand" for="c-41374981">[1 more]</label></div><br/><div class="children"><div class="content">I’m not the writer of the paper, but I do remember STARTTLS being called out as an issue when I was previously working on setting up an ldap directory.</div><br/></div></div></div></div></div></div><div id="41374601" class="c"><input type="checkbox" id="c-41374601" checked=""/><div class="controls bullet"><span class="by">denkmoon</span><span>|</span><a href="#41372202">prev</a><span>|</span><a href="#41373842">next</a><span>|</span><label class="collapse" for="c-41374601">[-]</label><label class="expand" for="c-41374601">[5 more]</label></div><br/><div class="children"><div class="content">To this day plenty of documentation refers to STARTTLS as being the preferred way of configuring your email client. This is _clearly_ insane in the face of implicit TLS existing. I&#x27;ve never understood why STARTTLS is recommended over implicit TLS.</div><br/><div id="41374669" class="c"><input type="checkbox" id="c-41374669" checked=""/><div class="controls bullet"><span class="by">Avamander</span><span>|</span><a href="#41374601">parent</a><span>|</span><a href="#41375625">next</a><span>|</span><label class="collapse" for="c-41374669">[-]</label><label class="expand" for="c-41374669">[2 more]</label></div><br/><div class="children"><div class="content">We still have plenty of documentation referring to TLS as SSL too. There&#x27;s just a tremendous amount of old habits out there, especially with email.</div><br/><div id="41375638" class="c"><input type="checkbox" id="c-41375638" checked=""/><div class="controls bullet"><span class="by">kijin</span><span>|</span><a href="#41374601">root</a><span>|</span><a href="#41374669">parent</a><span>|</span><a href="#41375625">next</a><span>|</span><label class="collapse" for="c-41375638">[-]</label><label class="expand" for="c-41375638">[1 more]</label></div><br/><div class="children"><div class="content">Documentation often refers to the implcit-TLS protocol as SSL, and the STARTTLS protocol as TLS, with the implication that the latter is better.<p>It&#x27;s even easier to fall for these shenanigans if you know just a little bit about security and heard that TLS supersedes SSL.</div><br/></div></div></div></div><div id="41375625" class="c"><input type="checkbox" id="c-41375625" checked=""/><div class="controls bullet"><span class="by">kijin</span><span>|</span><a href="#41374601">parent</a><span>|</span><a href="#41374669">prev</a><span>|</span><a href="#41373842">next</a><span>|</span><label class="collapse" for="c-41375625">[-]</label><label class="expand" for="c-41375625">[2 more]</label></div><br/><div class="children"><div class="content">I think it was because of corporate firewalls. Unencrypted ports for POP3, IMAP, and SMTP were widely known and allowed where necessary, but their implicit-TLS counterparts were often blocked and IT departments were slow to adapt. STARTTLS helps you smuggle an encrypted tunnel over a well-known port.<p>Nowadays, it&#x27;s often the reverse. Many clouds block outgoing port 25 by default, and sometimes even 587. But almost nobody blocks port 465 -- the assumption is that if you&#x27;re using 465, you must be authorized to use that server -- so that&#x27;s the port you must use if you want to send emails by SMTP from a typical cloud server.</div><br/><div id="41376814" class="c"><input type="checkbox" id="c-41376814" checked=""/><div class="controls bullet"><span class="by">Culonavirus</span><span>|</span><a href="#41374601">root</a><span>|</span><a href="#41375625">parent</a><span>|</span><a href="#41373842">next</a><span>|</span><label class="collapse" for="c-41376814">[-]</label><label class="expand" for="c-41376814">[1 more]</label></div><br/><div class="children"><div class="content">&gt; it was because of corporate firewalls<p>What wasn&#x27;t because of corporate firewalls. :)</div><br/></div></div></div></div></div></div><div id="41373842" class="c"><input type="checkbox" id="c-41373842" checked=""/><div class="controls bullet"><span class="by">agwa</span><span>|</span><a href="#41374601">prev</a><span>|</span><a href="#41377259">next</a><span>|</span><label class="collapse" for="c-41373842">[-]</label><label class="expand" for="c-41373842">[5 more]</label></div><br/><div class="children"><div class="content">I predicted problems with STARTTLS 10 years ago: <a href="https:&#x2F;&#x2F;www.agwa.name&#x2F;blog&#x2F;post&#x2F;starttls_considered_harmful" rel="nofollow">https:&#x2F;&#x2F;www.agwa.name&#x2F;blog&#x2F;post&#x2F;starttls_considered_harmful</a> (HN discussion at the time: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8171838">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8171838</a>)<p>I&#x27;m very glad that Hanno et al gave this the thorough look that it needed and that the IETF no longer favors STARTTLS.</div><br/><div id="41375975" class="c"><input type="checkbox" id="c-41375975" checked=""/><div class="controls bullet"><span class="by">wahern</span><span>|</span><a href="#41373842">parent</a><span>|</span><a href="#41374032">next</a><span>|</span><label class="collapse" for="c-41375975">[-]</label><label class="expand" for="c-41375975">[1 more]</label></div><br/><div class="children"><div class="content">STARTTLS command buffer smuggling was already a known issue long before 2014. In particular, the deluge of CVEs for MTAs started in early 2011, and it was obvious from the nature of the issue that it wasn&#x27;t limited to SMTP, but rather pertained to lower level I&#x2F;O interfaces common to network facing servers generally.<p>I believe Postfix had the honor of the first CVE: <a href="https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2011-0411" rel="nofollow">https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2011-0411</a> There would be another 7 CVEs for command injection in other servers before the end of 2011. (<a href="https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=starttls" rel="nofollow">https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=starttls</a>)</div><br/></div></div><div id="41374032" class="c"><input type="checkbox" id="c-41374032" checked=""/><div class="controls bullet"><span class="by">metadat</span><span>|</span><a href="#41373842">parent</a><span>|</span><a href="#41375975">prev</a><span>|</span><a href="#41377259">next</a><span>|</span><label class="collapse" for="c-41374032">[-]</label><label class="expand" for="c-41374032">[3 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t mean to be difficult, but in the spirit of being forthcoming:<p><i>&quot;Called it!&quot;</i> posts really turn me off.  You were right before, that&#x27;s cool.  What else can you add to a potentially interesting conversation?  Bring your audience along for the ride..<p>I&#x27;m much more interested in any new insights you have on the matter!<p>Best wishes and take care &lt;3, and again, I&#x27;m sorry, I wish I had the perfect words to connect with you.</div><br/><div id="41374283" class="c"><input type="checkbox" id="c-41374283" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#41373842">root</a><span>|</span><a href="#41374032">parent</a><span>|</span><a href="#41377259">next</a><span>|</span><label class="collapse" for="c-41374283">[-]</label><label class="expand" for="c-41374283">[2 more]</label></div><br/><div class="children"><div class="content">Their blog post from 2014 does seem to &quot;call it&quot; quite succinctly, with a rather beige background.<p>This is a called it post with evidence.  Why not read it!  The current post has only just  been ... posted.  I&#x27;m sure Andrew will have an angle (if he can be arsed) but he does get to call it: &quot;Called it&quot;.<p>Words are never perfect unless they are conjugating to a particular tense 8)</div><br/><div id="41374303" class="c"><input type="checkbox" id="c-41374303" checked=""/><div class="controls bullet"><span class="by">metadat</span><span>|</span><a href="#41373842">root</a><span>|</span><a href="#41374283">parent</a><span>|</span><a href="#41377259">next</a><span>|</span><label class="collapse" for="c-41374303">[-]</label><label class="expand" for="c-41374303">[1 more]</label></div><br/><div class="children"><div class="content">Thanks, I&#x27;ll check it again.  Cheers!</div><br/></div></div></div></div></div></div></div></div><div id="41377259" class="c"><input type="checkbox" id="c-41377259" checked=""/><div class="controls bullet"><span class="by">dathinab</span><span>|</span><a href="#41373842">prev</a><span>|</span><a href="#41371654">next</a><span>|</span><label class="collapse" for="c-41377259">[-]</label><label class="expand" for="c-41377259">[1 more]</label></div><br/><div class="children"><div class="content">the dumbest thing is if the server refused STARTTLS or the client doesn&#x27;t send STARTTLS you are supposed to still continue if you strictly follow the standard<p>I really hope no implementation actual does support this behavior without setting some really dangerous sounding settings (but I&#x27;m pretty sure some probably do).<p>at least they did standardize directly connecting with TLS by now (it not &quot;that&quot; long ago that while supported in practice it wasn&#x27;t technically standard complaint)</div><br/></div></div><div id="41371654" class="c"><input type="checkbox" id="c-41371654" checked=""/><div class="controls bullet"><span class="by">dogma1138</span><span>|</span><a href="#41377259">prev</a><span>|</span><a href="#41372547">next</a><span>|</span><label class="collapse" for="c-41371654">[-]</label><label class="expand" for="c-41371654">[15 more]</label></div><br/><div class="children"><div class="content">The blog post is a bit poor; this seems like a packet racing vulnerability where by the attacker attempts to hijack the session.<p>This means that the attacker needs to be on the same network network as the victim as spoofing the IP on a TCP connection is rather challenging.<p>Not great but also not particularly useful in the real world either.</div><br/><div id="41377415" class="c"><input type="checkbox" id="c-41377415" checked=""/><div class="controls bullet"><span class="by">USiBqidmOOkAqRb</span><span>|</span><a href="#41371654">parent</a><span>|</span><a href="#41374197">next</a><span>|</span><label class="collapse" for="c-41377415">[-]</label><label class="expand" for="c-41377415">[1 more]</label></div><br/><div class="children"><div class="content">With the amount of air conditioners and coffee makers (et al.) connected to WiFi I think lapses in correct separation is more frequent than anyone would be willing to admit. Maybe not too practical to hijack a TCP stream, but still worth to remember if anyone claims to be protected by NAT.</div><br/></div></div><div id="41374197" class="c"><input type="checkbox" id="c-41374197" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#41371654">parent</a><span>|</span><a href="#41377415">prev</a><span>|</span><a href="#41371835">next</a><span>|</span><label class="collapse" for="c-41374197">[-]</label><label class="expand" for="c-41374197">[4 more]</label></div><br/><div class="children"><div class="content">Many cloudy environments end up economizing on IP addresses.  That means that there will be loads of neighbours, not all of them will be your mates.  Once you have found a way in via another method, you now have this weapon to deploy.  STARTTLS is massively used to secure internal comms as a (cough) &quot;best practice&quot;.  The article notes email related protocols but AD via LDAP is often accessed via port 389 with STARTTLS.<p>You may not be familiar with Hanno - he&#x27;s been around for a while and knows what he is on about.<p>I&#x27;m not sure which real world you inhabit.  This is quite horrendous.<p>(I&#x27;m not sure why &quot;implicit&quot; is used instead of &quot;explicit&quot; for full on TLS over STARTTLS.  I suspect English as a foreign language).</div><br/><div id="41376374" class="c"><input type="checkbox" id="c-41376374" checked=""/><div class="controls bullet"><span class="by">thayne</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374197">parent</a><span>|</span><a href="#41374558">next</a><span>|</span><label class="collapse" for="c-41376374">[-]</label><label class="expand" for="c-41376374">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  STARTTLS is massively used to secure internal comms as a (cough) &quot;best practice&quot;<p>Well, I&#x27;ve seen it be a &quot;best practice&quot;, because of some legacy component that only supported ldap with starttls or plaintext. It wasn&#x27;t so much &quot;starttls is great&quot; as &quot;starttls is the best we can do right now&quot;.</div><br/></div></div><div id="41374558" class="c"><input type="checkbox" id="c-41374558" checked=""/><div class="controls bullet"><span class="by">mistrial9</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374197">parent</a><span>|</span><a href="#41376374">prev</a><span>|</span><a href="#41371835">next</a><span>|</span><label class="collapse" for="c-41374558">[-]</label><label class="expand" for="c-41374558">[2 more]</label></div><br/><div class="children"><div class="content">as a civilian, if cloud compute server conditions internally result in exposing some mid-transaction packet insertion problem as a real thing, AND that in turn justifies some massive re-deployment of new network drivers stacks to the detriment of just about everybody&#x27;s gray hairs and finite hours in the day, then actually screw that, with emphasis.</div><br/><div id="41374719" class="c"><input type="checkbox" id="c-41374719" checked=""/><div class="controls bullet"><span class="by">gerdesj</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374558">parent</a><span>|</span><a href="#41371835">next</a><span>|</span><label class="collapse" for="c-41374719">[-]</label><label class="expand" for="c-41374719">[1 more]</label></div><br/><div class="children"><div class="content">Your keyboard should have at least two shift keys. We are generally all civilians (both of my parents were soldiers - I&#x27;m not but I did love growing up in West Germany, funny old world).<p>This is yet another CVS and as I happen to be the MD of an IT company, I take it seriously.  It is a bit of a pain having to patch a lot of systems every month and fiddle with firewall rules in response to notes and more besides.<p>I don&#x27;t intend to feature in an el Reg or HN article.  I&#x27;ve been lucky so far.<p>Have you found the shift keys?</div><br/></div></div></div></div></div></div><div id="41371835" class="c"><input type="checkbox" id="c-41371835" checked=""/><div class="controls bullet"><span class="by">tremon</span><span>|</span><a href="#41371654">parent</a><span>|</span><a href="#41374197">prev</a><span>|</span><a href="#41372547">next</a><span>|</span><label class="collapse" for="c-41371835">[-]</label><label class="expand" for="c-41371835">[9 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not the only way, DNS cache poisoning or hijacking can also redirect a victim to an attacker-controlled proxy. Or am I missing something?</div><br/><div id="41372351" class="c"><input type="checkbox" id="c-41372351" checked=""/><div class="controls bullet"><span class="by">dogma1138</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41371835">parent</a><span>|</span><a href="#41372547">next</a><span>|</span><label class="collapse" for="c-41372351">[-]</label><label class="expand" for="c-41372351">[8 more]</label></div><br/><div class="children"><div class="content">If you can redirect the victim to a proxy via DNS poisoning you don’t need this attack you can simply pretend to be the mail server; not only that but it doesn’t actually allows you to execute this specific attack.<p>How this works is that you inject the commands into the plain text of the victim which requires packet racing or some other local network attack that allows you to take over the TCP stream.<p>How this works is that the victim sends from:, creds, to:, email content but you somehow inject starttls, from:, creds:, to: a head of it which forces the entire message from the victim to be treated as data fully so the SMTP commands are disregarded which means you will be receiving an email with their credentials.<p>I highly suspect that SMTP without starttls will work in the same manner, but perhaps the opportunistic encryption gives more time for this attack to be more effective.<p>Every other scenario requires you to be able to MITM the traffic which is pretty much already gameover.<p>I honestly can’t really think of a scenario where you could launch a network attack that would allow you to inject yourself in the middle in this manner that won’t allow you also to eavesdrop on credentials sent in plaintext or MITM the entire thing.</div><br/><div id="41373794" class="c"><input type="checkbox" id="c-41373794" checked=""/><div class="controls bullet"><span class="by">maxdamantus</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41372351">parent</a><span>|</span><a href="#41372614">next</a><span>|</span><label class="collapse" for="c-41373794">[-]</label><label class="expand" for="c-41373794">[5 more]</label></div><br/><div class="children"><div class="content">&gt; Every other scenario requires you to be able to MITM the traffic which is pretty much already gameover.<p>MITM attacks is one of the major reasons for using TLS&#x2F;PKI. You might have total control over the TLS connections I make to a website, but you won&#x27;t be able to inject information in either direction. All you can do is observe the amount of data being transferred and terminate&#x2F;hang&#x2F;throttle the connection. If you send something effectively different to what was intended by the sender, the recipient will detect it as a TLS error and terminate the connection.<p>This attack involves injecting information before STARTTLS which puts the connection into a state that the client is not aware of, this is not normally possible in plain TLS connections.</div><br/><div id="41374476" class="c"><input type="checkbox" id="c-41374476" checked=""/><div class="controls bullet"><span class="by">dogma1138</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41373794">parent</a><span>|</span><a href="#41372614">next</a><span>|</span><label class="collapse" for="c-41374476">[-]</label><label class="expand" for="c-41374476">[4 more]</label></div><br/><div class="children"><div class="content">MITM attacks today are extremely difficult to execute. Most local networks are immune to traditional types of attacks such as arp spoofing&#x2F;poisoning and wifi networks outside of one’s home have had client isolation enabled by default for at least a decade now.<p>So this leaves internet scale MITM which means TLAs and other actors at a similar scale.<p>The TLDR here is that if you can MITM a clear text protocol without any integrity verification then you can alter the message, I’m honestly not entirely sure why is this report worthy on its own.<p>The issues with STARTTLS are known since the RFC was published.</div><br/><div id="41374846" class="c"><input type="checkbox" id="c-41374846" checked=""/><div class="controls bullet"><span class="by">maxdamantus</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374476">parent</a><span>|</span><a href="#41374734">next</a><span>|</span><label class="collapse" for="c-41374846">[-]</label><label class="expand" for="c-41374846">[1 more]</label></div><br/><div class="children"><div class="content">&gt; MITM attacks today are extremely difficult to execute. Most local networks are immune to traditional types of attacks such as arp spoofing&#x2F;poisoning and wifi networks outside of one’s home have had client isolation enabled by default for at least a decade now.<p>I find this hard to believe when authentication of WiFi itself is basically just SSID + PSK (ie, if you know both, you can either connect to an access point, or you can <i>be</i> an access point that other devices will connect to (&quot;evil twin&quot; attack)).<p>If there&#x27;s a reason for MITM attacks not occurring nowadays, it&#x27;s probably that they&#x27;re usually not very useful because everything important is meant to be protected by TLS, not that they&#x27;re difficult.<p>Your points seem to imply that TLS in general is useless, which I think you&#x27;ll have a hard time convincing security-minded people of.</div><br/></div></div><div id="41374734" class="c"><input type="checkbox" id="c-41374734" checked=""/><div class="controls bullet"><span class="by">Avamander</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374476">parent</a><span>|</span><a href="#41374846">prev</a><span>|</span><a href="#41372614">next</a><span>|</span><label class="collapse" for="c-41374734">[-]</label><label class="expand" for="c-41374734">[2 more]</label></div><br/><div class="children"><div class="content">&gt; MITM attacks today are extremely difficult to execute. Most local networks are immune to traditional types of attacks such as arp spoofing&#x2F;poisoning and wifi networks outside of one’s home have had client isolation enabled by default for at least a decade now.<p>That&#x27;s a strong claim. Most home networks most certainly aren&#x27;t. There&#x27;s also no enforcement so someone evil can always set up an evil twin, so what that the original has client isolation.</div><br/><div id="41374876" class="c"><input type="checkbox" id="c-41374876" checked=""/><div class="controls bullet"><span class="by">stackskipton</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41374734">parent</a><span>|</span><a href="#41372614">next</a><span>|</span><label class="collapse" for="c-41374876">[-]</label><label class="expand" for="c-41374876">[1 more]</label></div><br/><div class="children"><div class="content">I would imagine ~99.9% of email submitted by end users is done over HTTPS which are highest risk. Servers talking to Servers are almost entirely wired so risk there is much lower which is probably why email providers have been slow to patch this.</div><br/></div></div></div></div></div></div></div></div><div id="41372614" class="c"><input type="checkbox" id="c-41372614" checked=""/><div class="controls bullet"><span class="by">jsiepkes</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41372351">parent</a><span>|</span><a href="#41373794">prev</a><span>|</span><a href="#41372547">next</a><span>|</span><label class="collapse" for="c-41372614">[-]</label><label class="expand" for="c-41372614">[2 more]</label></div><br/><div class="children"><div class="content">&gt; If you can redirect the victim to a proxy via DNS poisoning you don’t need this attack you can simply pretend to be the mail server.<p>Not if the client uses SMTPS (i.e. SMTP with TLS) on port 587. Which is actually quite common for mail clients.</div><br/><div id="41372862" class="c"><input type="checkbox" id="c-41372862" checked=""/><div class="controls bullet"><span class="by">dogma1138</span><span>|</span><a href="#41371654">root</a><span>|</span><a href="#41372614">parent</a><span>|</span><a href="#41372547">next</a><span>|</span><label class="collapse" for="c-41372862">[-]</label><label class="expand" for="c-41372862">[1 more]</label></div><br/><div class="children"><div class="content">Yes but then this attack doesn’t work either, you need a client that is happy with either unencrypted SMTP or one that will
attempt opportunistic encryption.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41372547" class="c"><input type="checkbox" id="c-41372547" checked=""/><div class="controls bullet"><span class="by">exabrial</span><span>|</span><a href="#41371654">prev</a><span>|</span><a href="#41374896">next</a><span>|</span><label class="collapse" for="c-41372547">[-]</label><label class="expand" for="c-41372547">[11 more]</label></div><br/><div class="children"><div class="content">For awhile (2018ish - now), many large companies (Google, for example) were pushing everyone from STARTTLS and trying to move away from implied TLS. It was dumb then and of course it&#x27;s still a bad idea.<p>Binary (or text) protocols needs to be de-bundled from transport layer for _a lot_ of reasons (looking at you QUIC).<p>Once we conquer this, we can de-bundle port number from service location.</div><br/><div id="41372675" class="c"><input type="checkbox" id="c-41372675" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#41372547">parent</a><span>|</span><a href="#41372684">next</a><span>|</span><label class="collapse" for="c-41372675">[-]</label><label class="expand" for="c-41372675">[1 more]</label></div><br/><div class="children"><div class="content">Do you have a link for Google pushing people away from latent&#x2F;implied TLS and towards STARTTLS? My recollection was the exact opposite (companies have increasingly pushing to kill off STARTTLS), but it&#x27;s possible I&#x27;ve misremembered.</div><br/></div></div><div id="41372684" class="c"><input type="checkbox" id="c-41372684" checked=""/><div class="controls bullet"><span class="by">unethical_ban</span><span>|</span><a href="#41372547">parent</a><span>|</span><a href="#41372675">prev</a><span>|</span><a href="#41374896">next</a><span>|</span><label class="collapse" for="c-41372684">[-]</label><label class="expand" for="c-41372684">[9 more]</label></div><br/><div class="children"><div class="content">What is port number, if not an identifier of service location?</div><br/><div id="41373433" class="c"><input type="checkbox" id="c-41373433" checked=""/><div class="controls bullet"><span class="by">exabrial</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41372684">parent</a><span>|</span><a href="#41373009">next</a><span>|</span><label class="collapse" for="c-41373433">[-]</label><label class="expand" for="c-41373433">[4 more]</label></div><br/><div class="children"><div class="content">In the early internet years, your ip address was your identifier. It would have been absurd for your ip address to ever change. That changed quickly.<p>In the early internet years, fixed ports were the service locator. Yet this has not evolved.<p>As another commentor said, you can now only run one instance of a service per IP, which is aburdly wasteful of the possible ~65k inbound ports. TLS and SNI have come up with workarounds, but the root problem is still, port numbers should be available for anything, and we should have a system for service location. DNS is certainly an option, but there are other practical ways to do it.</div><br/><div id="41374013" class="c"><input type="checkbox" id="c-41374013" checked=""/><div class="controls bullet"><span class="by">moduspol</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41373433">parent</a><span>|</span><a href="#41375447">next</a><span>|</span><label class="collapse" for="c-41374013">[-]</label><label class="expand" for="c-41374013">[1 more]</label></div><br/><div class="children"><div class="content">Sadly it probably won&#x27;t ever happen because of the numerous packet forwarding layers that have baked-in security expectations that &quot;HTTP = 80&quot; and &quot;HTTPS = 443&quot;, etc. It&#x27;d still be nice to reach that promised land, but I think the damage has already been done.</div><br/></div></div><div id="41375447" class="c"><input type="checkbox" id="c-41375447" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41373433">parent</a><span>|</span><a href="#41374013">prev</a><span>|</span><a href="#41375301">next</a><span>|</span><label class="collapse" for="c-41375447">[-]</label><label class="expand" for="c-41375447">[1 more]</label></div><br/><div class="children"><div class="content">&gt; which is aburdly wasteful of the possible ~65k inbound ports<p>What is being wasted?  It&#x27;s not as if those extra ports have additional bandwidth or processing power available to them that you wouldn&#x27;t otherwise have.  You also need a spare port if you&#x27;re going to do any outbound connections.<p>Worst case,  as far as I can see,  is that CGNAT providers might require more outbound IP addresses than they might ideally need if more ports were actually used;  but in the general case,  there is no reason to care about &quot;wasted&quot; ports.</div><br/></div></div><div id="41375301" class="c"><input type="checkbox" id="c-41375301" checked=""/><div class="controls bullet"><span class="by">magicalhippo</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41373433">parent</a><span>|</span><a href="#41375447">prev</a><span>|</span><a href="#41373009">next</a><span>|</span><label class="collapse" for="c-41375301">[-]</label><label class="expand" for="c-41375301">[1 more]</label></div><br/><div class="children"><div class="content">I know it&#x27;s not viable, but yet I&#x27;ve always felt IPv6 would have been a nice opportunity to extinguish port numbers. Just give each service its own IP from the &#x2F;64 the host was allocated.<p>Then you could have one DNS entry per service. That would have been perfect for residential IPv6 with dynamic prefixes, which require dynamic DNS anyway.</div><br/></div></div></div></div><div id="41373009" class="c"><input type="checkbox" id="c-41373009" checked=""/><div class="controls bullet"><span class="by">oasisaimlessly</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41372684">parent</a><span>|</span><a href="#41373433">prev</a><span>|</span><a href="#41374896">next</a><span>|</span><label class="collapse" for="c-41373009">[-]</label><label class="expand" for="c-41373009">[4 more]</label></div><br/><div class="children"><div class="content">Using port number as a service identifier sucks because it means you can only run e.g. one normally-accessible SSH server per IP address. One potential solution is to look up port numbers via DNS SRV records[1], but very few protocol standards demand clients do this.<p>HTTP and SMTP have their own ad-hoc, partial solutions to this (vhosting, MX records), but most every other service requires a unique IP address per instance.<p>* [1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SRV_record" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;SRV_record</a></div><br/><div id="41375459" class="c"><input type="checkbox" id="c-41375459" checked=""/><div class="controls bullet"><span class="by">akira2501</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41373009">parent</a><span>|</span><a href="#41374657">next</a><span>|</span><label class="collapse" for="c-41375459">[-]</label><label class="expand" for="c-41375459">[1 more]</label></div><br/><div class="children"><div class="content">&gt; one normally-accessible SSH server per IP address<p>With IPv6 this consideration is almost completely moot.<p>&gt; MX records<p>Have fun with your MX not being port 25.<p>&gt; but most every other service requires a unique IP address per instance.<p>This constant engineering overhead to play to the weaknesses of IPv4 is the problem.</div><br/></div></div><div id="41374657" class="c"><input type="checkbox" id="c-41374657" checked=""/><div class="controls bullet"><span class="by">mistrial9</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41373009">parent</a><span>|</span><a href="#41375459">prev</a><span>|</span><a href="#41374896">next</a><span>|</span><label class="collapse" for="c-41374657">[-]</label><label class="expand" for="c-41374657">[2 more]</label></div><br/><div class="children"><div class="content">&quot;How to Configure SSH for Multiple Ports | Baeldung on Linux
March 18, 2024 - Learn how to start an SSH server on multiple ports.&quot;</div><br/><div id="41374770" class="c"><input type="checkbox" id="c-41374770" checked=""/><div class="controls bullet"><span class="by">mmerlin</span><span>|</span><a href="#41372547">root</a><span>|</span><a href="#41374657">parent</a><span>|</span><a href="#41374896">next</a><span>|</span><label class="collapse" for="c-41374770">[-]</label><label class="expand" for="c-41374770">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.baeldung.com&#x2F;linux&#x2F;ssh-multiple-ports" rel="nofollow">https:&#x2F;&#x2F;www.baeldung.com&#x2F;linux&#x2F;ssh-multiple-ports</a></div><br/></div></div></div></div></div></div></div></div></div></div><div id="41374896" class="c"><input type="checkbox" id="c-41374896" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41372547">prev</a><span>|</span><a href="#41372319">next</a><span>|</span><label class="collapse" for="c-41374896">[-]</label><label class="expand" for="c-41374896">[2 more]</label></div><br/><div class="children"><div class="content"><i>We found more than 40 vulnerabilities in STARTTLS implementations.</i><p>In other words, the bugs are in faulty implementations, not specification.<p>Incidentally I was just reading about STARTTLS recently (i.e. within a month), and having to implement it, looked at the discussions about command injection, whereupon my first reaction was &quot;seriously?&quot;<p><i>This works by attaching additional commands to the TCP packet that sends the still unprotected STARTTLS command.</i><p>Am I the only one who thinks it should be bloody obvious that the first byte after the &quot;\r\n&quot; that ends the STARTTLS command should be the first byte of a TLS handshake, and that anyone who uses the term &quot;TCP packet&quot; needs to learn more about how TCP works?<p>Read bytes from the network into a buffer. At each \r\n (or \n to be more permissive), stop and parse the command. If it&#x27;s STARTTLS, whatever is left in the buffer is the start of the handshake so feed that into the TLS layer. In my implementation, if I wanted to deliberately make it vulnerable, I&#x27;d have to make it <i>more</i> complex --- set a flag to remember, and do the TLS handshake only after parsing the whole buffer; but then, as everyone should know, TCP is a stream, so what if the buffer has a partial command in it? No. The only thing that makes sense is the bytes after STARTTLS\r\n are a TLS handshake, and maybe application data if the buffer is big enough.<p>Reading the linked Postfix article about how its design made it vulnerable confirms my suspicions --- they didn&#x27;t understand TCP.</div><br/><div id="41376460" class="c"><input type="checkbox" id="c-41376460" checked=""/><div class="controls bullet"><span class="by">jsiepkes</span><span>|</span><a href="#41374896">parent</a><span>|</span><a href="#41372319">next</a><span>|</span><label class="collapse" for="c-41376460">[-]</label><label class="expand" for="c-41376460">[1 more]</label></div><br/><div class="children"><div class="content">&gt; In other words, the bugs are in faulty implementations, not specification.<p>Problems with STARTTLS have been going on for atleast a decade. At some point you need to start wondering if the design isn&#x27;t the problem.<p>Besides, why would you even want STARTTLS? Even the authors of the RFC can&#x27;t come up with a good reason to use STARTTLS [1]. Most of these reasons are from another era:<p>&gt; Separate ports lead to a separate URL scheme which intrudes into the user interface in inappropriate ways.<p>Actually knowing in advance if something is going to be a secure connection (like HTTP vs HTTPS) sounds pretty desirable to me.<p>&gt; Separate ports imply a model of either &quot;secure&quot; or &quot;not secure.&quot; This can be misleading in a number of ways.  First, the &quot;secure&quot; port may not in fact be acceptably secure as an export-crippled cipher suite might be in use.  This can mislead users into a false sense of security.  Second, the normal port might in fact be secured by using a SASL mechanism which includes a security layer.<p>Export ciphers are obviously not a thing in 2024 anymore. And &quot;using a SASL mechanism which includes a security layer&quot; where apparently someone made their own alternative to TLS sounds like a really bad idea.<p>&gt; Use of separate ports for SSL has caused clients to implement only two security policies: use SSL or don&#x27;t use SSL.<p>That actually sounds desirable.<p>&gt; Port numbers are a limited resource. While they are not yet in short supply<p>Only very few protocols get an actual IANA assigned port number nowadays.<p>[1] <a href="https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc2595#section-7" rel="nofollow">https:&#x2F;&#x2F;datatracker.ietf.org&#x2F;doc&#x2F;html&#x2F;rfc2595#section-7</a></div><br/></div></div></div></div><div id="41372319" class="c"><input type="checkbox" id="c-41372319" checked=""/><div class="controls bullet"><span class="by">newman314</span><span>|</span><a href="#41374896">prev</a><span>|</span><a href="#41375738">next</a><span>|</span><label class="collapse" for="c-41372319">[-]</label><label class="expand" for="c-41372319">[4 more]</label></div><br/><div class="children"><div class="content">I wonder what the uptake of MTA-STS is. Does anyone collect stats on this?</div><br/><div id="41372786" class="c"><input type="checkbox" id="c-41372786" checked=""/><div class="controls bullet"><span class="by">8organicbits</span><span>|</span><a href="#41372319">parent</a><span>|</span><a href="#41374716">next</a><span>|</span><label class="collapse" for="c-41372786">[-]</label><label class="expand" for="c-41372786">[1 more]</label></div><br/><div class="children"><div class="content">I was poking around recently. Adoption appears very low on a per-domain basis [1], but high-volume mail providers like Gmail support it.<p>Relatedly, DNSSEC adoption (and presumably DANE) is finally decreasing. So MTA-STS looks like the path forward. Lots of folks have been predicting this. [2]<p>[1] <a href="https:&#x2F;&#x2F;www.uriports.com&#x2F;blog&#x2F;mta-sts-survey-2024&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.uriports.com&#x2F;blog&#x2F;mta-sts-survey-2024&#x2F;</a><p>[2] <a href="https:&#x2F;&#x2F;www.verisign.com&#x2F;en_US&#x2F;company-information&#x2F;verisign-labs&#x2F;internet-security-tools&#x2F;dnssec-scoreboard&#x2F;index.xhtml" rel="nofollow">https:&#x2F;&#x2F;www.verisign.com&#x2F;en_US&#x2F;company-information&#x2F;verisign-...</a></div><br/></div></div><div id="41374716" class="c"><input type="checkbox" id="c-41374716" checked=""/><div class="controls bullet"><span class="by">Avamander</span><span>|</span><a href="#41372319">parent</a><span>|</span><a href="#41372786">prev</a><span>|</span><a href="#41375738">next</a><span>|</span><label class="collapse" for="c-41374716">[-]</label><label class="expand" for="c-41374716">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s quite a bit more accessible than DANE, so uptake has increased in the last few years. A bunch of high-volume operators support it, like gmail. But support also exists in newer MTA software like Stalwart, Maddy and ZoneMTA. (Though there are ways to add MTA-STS support to Postfix as well.)<p>MTA-STS has a great benefit that one doesn&#x27;t need to deal with the antiquities of their registrars or TLD operators, just set up a few records and run a web server. WebPKI in general is also significantly better than DNSSEC. So you win twice.<p>Though MTA-STS doesn&#x27;t cover the part between MUA and MSA unfortunately, I&#x27;ve seen an abandoned draft for MUA-STS but that&#x27;s about it.</div><br/><div id="41376505" class="c"><input type="checkbox" id="c-41376505" checked=""/><div class="controls bullet"><span class="by">newman314</span><span>|</span><a href="#41372319">root</a><span>|</span><a href="#41374716">parent</a><span>|</span><a href="#41375738">next</a><span>|</span><label class="collapse" for="c-41376505">[-]</label><label class="expand" for="c-41376505">[1 more]</label></div><br/><div class="children"><div class="content">You can actually run MTA-STS on Cloudflare Workers so the web server piece isn&#x27;t even necessary. It was fairly easy to implement and works well for me.</div><br/></div></div></div></div></div></div><div id="41375738" class="c"><input type="checkbox" id="c-41375738" checked=""/><div class="controls bullet"><span class="by">stevefan1999</span><span>|</span><a href="#41372319">prev</a><span>|</span><a href="#41371651">next</a><span>|</span><label class="collapse" for="c-41375738">[-]</label><label class="expand" for="c-41375738">[1 more]</label></div><br/><div class="children"><div class="content">As someone who self-hosted email servers, here&#x27;s why it is a big deal: we all know that HTTPS is basically HTTP with implicit TLS, which is a common knowledge and industry standard of today.<p>But back in time when people still don&#x27;t realize the importance of encryption, and most computers process crypto primitives in software, to the time when SIMD was not even a big thing (3DNow, MMX, SSE...) and only some high-tech niches and games such as Quake and Unreal Tournament demands it (where we obviously know today SIMD is super important for everything that can be processed in automatic vectorization with advancement in compiler optimization tech, including the fancy matrix&#x2F;tensor math you run with your transformers and LLMs), which means they are slow because back in 30 years people don&#x27;t have the luxury to enjoy widespread cryptography, only few nerds are adventurous enough to go deep into the abyss, and worse, still have to fight a war with the US government that they have military exports control on cryptography [1], since that&#x27;s when RSA (the company, not just the algorithm) was prevailing, and everyone is still discovering new applications of cryptography to the commercial internet, one of which was smart cards, but that&#x27;s not convincing enough to the US government cryptography should be set free from controls.<p>Today we even have accelerators for AES called AES-NI and the same for SHA too, and we even have those on embedded systems, MCUs such as Cortex-M or ESP32.<p>And so, cryptography is not only slow, not readily available and researched throughout, but also having legal troubles 30 years ago, so the predecessors used something called &quot;opportunistic encryption&quot;, aka STARTTLS in your email client. All it means is that you start a TLS session on demand with a plaintext command (heck everything before STARTTLS is plaintext) indicating the following data would be new TLS handshake and starts the state machine exchange process.<p>Basically, they want to make sure that if the outcome of crypto wars turned out to be favoring the government, ala the three letter boys (FBI, CIA, NSA), we can still have some countries that could use TLS, hence the opportunity part, but this is obviously hell because everything before STARTTLS including the STARTTLS command itself is subjectable to MITM.<p>Today this is a thing of the past, including the crypto wars which it eventually sided to the people and flourished all e-commence businesses because now we all can enjoy safe and secure internet, and we all agreed that implicit TLS is the only way to go. I would argue that the success of TLS is part of the reasons internet exploded to an exponential scale because now banks can make secure transactions without someone sniffing it, and increased liquidity to the internet businesses, and that itself is a virtuous cycle.<p>And some people dare to have the audacity and have attempted to even remove implicit TLS from official IANA port list in the form of RFCs, only to be met with protest. This is why there are a lot of misconceptions online saying that implicit TLS is bad (those RFCs to remove implicit TLS were initially accepted but then quickly retracted), and often give confusing information which port people need to use. Basically, they are reinforcing the reminiscent knowledge 30 years ago.<p>Protect cryptography and thus your privacy and security at all costs.<p>[1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Crypto_Wars" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Crypto_Wars</a></div><br/></div></div><div id="41371651" class="c"><input type="checkbox" id="c-41371651" checked=""/><div class="controls bullet"><span class="by">tuwtuwtuwtuw</span><span>|</span><a href="#41375738">prev</a><span>|</span><a href="#41373091">next</a><span>|</span><label class="collapse" for="c-41371651">[-]</label><label class="expand" for="c-41371651">[1 more]</label></div><br/><div class="children"><div class="content">Server to server communication still relies on STARTTLS all the time, and very often simply ignore cert errors or, my favorite, attempts STARTTLS and fall back to non-encrypted if handshake fails due to host name mismatch.</div><br/></div></div></div></div></div></div></div></body></html>