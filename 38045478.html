<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1698483652248" as="style"/><link rel="stylesheet" href="styles.css?v=1698483652248"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.techyourchance.com/kotlin-coroutines-vs-threads-performance-benchmark/">Kotlin Coroutines vs. Threads Performance Benchmark</a> <span class="domain">(<a href="https://www.techyourchance.com">www.techyourchance.com</a>)</span></div><div class="subtext"><span>flykespice</span> | <span>29 comments</span></div><br/><div><div id="38046566" class="c"><input type="checkbox" id="c-38046566" checked=""/><div class="controls bullet"><span class="by">koito17</span><span>|</span><a href="#38047551">next</a><span>|</span><label class="collapse" for="c-38046566">[-]</label><label class="expand" for="c-38046566">[1 more]</label></div><br/><div class="children"><div class="content">Deeply flawed methodology. This comment in the blog post summarizes it best<p>&gt; Under the hood, [Kotlin] coroutines are runnables with an additional parameter representing the continuation, running on an executor. If you are not going to make any use of the continuation, you do not need the coroutines, you are just adding overhead over runnables and fixedthreadpools (which is what you measure).</div><br/></div></div><div id="38047551" class="c"><input type="checkbox" id="c-38047551" checked=""/><div class="controls bullet"><span class="by">DotaFan</span><span>|</span><a href="#38046566">prev</a><span>|</span><a href="#38048211">next</a><span>|</span><label class="collapse" for="c-38047551">[-]</label><label class="expand" for="c-38047551">[4 more]</label></div><br/><div class="children"><div class="content">To get anyone from outside of Android ecosystem up to speed, blog author has always had controversial opinions. He&#x27;s been trying to prove to the community that new Compose library is for what worse than decade old imperative UI system on Android for the past couple of years.</div><br/><div id="38048152" class="c"><input type="checkbox" id="c-38048152" checked=""/><div class="controls bullet"><span class="by">carstenhag</span><span>|</span><a href="#38047551">parent</a><span>|</span><a href="#38047574">next</a><span>|</span><label class="collapse" for="c-38048152">[-]</label><label class="expand" for="c-38048152">[2 more]</label></div><br/><div class="children"><div class="content">(I am aware of the author). The opinion not mentioned is not flawed. Some basic things were definitely missing when Compose was made 1.0.
Now 2 years later, there are still features open that some consider basic.<p>My opinion as an android dev: he&#x27;s definitely very knowledgeable, but you should also hear other opinions. It&#x27;s not a writer you should listen to blindly.</div><br/><div id="38048221" class="c"><input type="checkbox" id="c-38048221" checked=""/><div class="controls bullet"><span class="by">csydas</span><span>|</span><a href="#38047551">root</a><span>|</span><a href="#38048152">parent</a><span>|</span><a href="#38047574">next</a><span>|</span><label class="collapse" for="c-38048221">[-]</label><label class="expand" for="c-38048221">[1 more]</label></div><br/><div class="children"><div class="content">will take advantage of your knowledge for a question and also a comment to your post.<p>No writer should be trusted blindly but i don’t thjnk you meant that literally ;) just for others to see. all information should have some verification even from trusted sources.<p>on the author though, can you share a bit about the subject and the author’s participation in android dev?  i’ve never touched android anything dev wise so i’m not even sure if the topic being discussed is a new and unexplored territory, explored but still evolving, or if it’s something the community has settled on with plenty of data to back their conclusion. similarly im not sure if the author is really skilled enough to have controversial opinions or if it’s more they’re alright but excitable.<p>how would you position the two points just from your point of view?<p>i get the impression the author of the article is controversial and also opinionated i. “unusual” ways — for me, such persons are interesting to hear from even if a lot of their ideas are non-sense or fanciful. “out-there” ideas often are just out there for no reason, but sometimes there’s gold in such ideas, or good thoughts and starting points for actual golden ones.<p>wiuod you personally at least listen to this author just in case there’s some gold or are they very much so just in their own world?</div><br/></div></div></div></div><div id="38047574" class="c"><input type="checkbox" id="c-38047574" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#38047551">parent</a><span>|</span><a href="#38048152">prev</a><span>|</span><a href="#38048211">next</a><span>|</span><label class="collapse" for="c-38047574">[-]</label><label class="expand" for="c-38047574">[1 more]</label></div><br/><div class="children"><div class="content">I agree with several of his opinions, many in the Android community cargo cult opinions from influencers in the Android team, sorry Developer Advocates, without any thoughts of how real they happen to be.</div><br/></div></div></div></div><div id="38048211" class="c"><input type="checkbox" id="c-38048211" checked=""/><div class="controls bullet"><span class="by">simon_void</span><span>|</span><a href="#38047551">prev</a><span>|</span><a href="#38046701">next</a><span>|</span><label class="collapse" for="c-38048211">[-]</label><label class="expand" for="c-38048211">[1 more]</label></div><br/><div class="children"><div class="content">here is the talk by Roman Elizarov, the Kotlin project lead, at KotlinConf 2023 about Coroutines vs VThreads: <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=zluKcazgkV4">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=zluKcazgkV4</a>
short version: both were optimized for different things, so there is a place for both of them.</div><br/></div></div><div id="38046701" class="c"><input type="checkbox" id="c-38046701" checked=""/><div class="controls bullet"><span class="by">yafetn</span><span>|</span><a href="#38048211">prev</a><span>|</span><a href="#38046901">next</a><span>|</span><label class="collapse" for="c-38046701">[-]</label><label class="expand" for="c-38046701">[5 more]</label></div><br/><div class="children"><div class="content">Lest someone new to Kotlin only reads the title and decides to spawn bare threads all over the place, don’t. At first pass, it&#x27;s not clear to me what the actual work the author is doing in his benchmark. Instead, I’d point to the excellent work of Marcin Moskala’s Kt.Academy[0] and other resources on the topic.<p>[0] <a href="https:&#x2F;&#x2F;kt.academy&#x2F;article&#x2F;cc-best-practices" rel="nofollow noreferrer">https:&#x2F;&#x2F;kt.academy&#x2F;article&#x2F;cc-best-practices</a></div><br/><div id="38047305" class="c"><input type="checkbox" id="c-38047305" checked=""/><div class="controls bullet"><span class="by">zekrioca</span><span>|</span><a href="#38046701">parent</a><span>|</span><a href="#38046901">next</a><span>|</span><label class="collapse" for="c-38047305">[-]</label><label class="expand" for="c-38047305">[4 more]</label></div><br/><div class="children"><div class="content">There aren’t numbers in your reference, just a set of recommendations. The author of the post tried to compare the performance overheads of using Coroutines over threads, that’s all.</div><br/><div id="38047356" class="c"><input type="checkbox" id="c-38047356" checked=""/><div class="controls bullet"><span class="by">asdfaoeu</span><span>|</span><a href="#38046701">root</a><span>|</span><a href="#38047305">parent</a><span>|</span><a href="#38046901">next</a><span>|</span><label class="collapse" for="c-38047356">[-]</label><label class="expand" for="c-38047356">[3 more]</label></div><br/><div class="children"><div class="content">The issue with OPs is that it&#x27;s really a case where coroutines would have any advantage so it&#x27;s kind of pointless.</div><br/><div id="38048274" class="c"><input type="checkbox" id="c-38048274" checked=""/><div class="controls bullet"><span class="by">otabdeveloper4</span><span>|</span><a href="#38046701">root</a><span>|</span><a href="#38047356">parent</a><span>|</span><a href="#38047591">next</a><span>|</span><label class="collapse" for="c-38048274">[-]</label><label class="expand" for="c-38048274">[1 more]</label></div><br/><div class="children"><div class="content">What, you mean using threads doesn&#x27;t automatically make your machine slow to a crawl because of le &quot;&quot;context switches&quot;&quot;??<p>Heresy! But my async!</div><br/></div></div><div id="38047591" class="c"><input type="checkbox" id="c-38047591" checked=""/><div class="controls bullet"><span class="by">zekrioca</span><span>|</span><a href="#38046701">root</a><span>|</span><a href="#38047356">parent</a><span>|</span><a href="#38048274">prev</a><span>|</span><a href="#38046901">next</a><span>|</span><label class="collapse" for="c-38047591">[-]</label><label class="expand" for="c-38047591">[1 more]</label></div><br/><div class="children"><div class="content">I agree OP could have been more elaborate, but the main takeaway is that goroutines still cost at least 50% that of normal threads (though this needs to be verified in normal servers as well, not just smartphones). With goroutines, though usually supported by runtime systems (e.g., in Go), applications are responsible to manage tasks (e.g., HTTP requests) in order to harvest goroutines benefits, whereas this is easier with threads.<p>Edited for clarification.</div><br/></div></div></div></div></div></div></div></div><div id="38046901" class="c"><input type="checkbox" id="c-38046901" checked=""/><div class="controls bullet"><span class="by">taeric</span><span>|</span><a href="#38046701">prev</a><span>|</span><a href="#38047637">next</a><span>|</span><label class="collapse" for="c-38046901">[-]</label><label class="expand" for="c-38046901">[2 more]</label></div><br/><div class="children"><div class="content">I went in expecting an odd explanation about how threads are inherently evil.  Was surprised to see a speed comparison that largely confirmed that creating threads is the slowest option.  And mostly delighted to see the admission that even thread creation is not hugely problematic.<p>The language affordances of coroutines are not to be ignored.  But performance is a siren song.</div><br/><div id="38048283" class="c"><input type="checkbox" id="c-38048283" checked=""/><div class="controls bullet"><span class="by">otabdeveloper4</span><span>|</span><a href="#38046901">parent</a><span>|</span><a href="#38047637">next</a><span>|</span><label class="collapse" for="c-38048283">[-]</label><label class="expand" for="c-38048283">[1 more]</label></div><br/><div class="children"><div class="content">Creating threads is about the fastest of all system calls. (Still a system call, though, and predicated on all the other runtime crap to support the obscure pthreads API features.)</div><br/></div></div></div></div><div id="38047637" class="c"><input type="checkbox" id="c-38047637" checked=""/><div class="controls bullet"><span class="by">wiseowise</span><span>|</span><a href="#38046901">prev</a><span>|</span><a href="#38046904">next</a><span>|</span><label class="collapse" for="c-38047637">[-]</label><label class="expand" for="c-38047637">[1 more]</label></div><br/><div class="children"><div class="content">Showing results without any code is silly.</div><br/></div></div><div id="38046904" class="c"><input type="checkbox" id="c-38046904" checked=""/><div class="controls bullet"><span class="by">lawgimenez</span><span>|</span><a href="#38047637">prev</a><span>|</span><a href="#38046441">next</a><span>|</span><label class="collapse" for="c-38046904">[-]</label><label class="expand" for="c-38046904">[3 more]</label></div><br/><div class="children"><div class="content">From my limited understanding is that Coroutines can suspend themselves (unless you use some dispatcher I guess), while Threads you have to invoke suspend(). Right? Thus comparing the two of them is insane.</div><br/><div id="38047131" class="c"><input type="checkbox" id="c-38047131" checked=""/><div class="controls bullet"><span class="by">tadfisher</span><span>|</span><a href="#38046904">parent</a><span>|</span><a href="#38047060">next</a><span>|</span><label class="collapse" for="c-38047131">[-]</label><label class="expand" for="c-38047131">[1 more]</label></div><br/><div class="children"><div class="content">Coroutines are always scheduled on a Dispatcher; if you don&#x27;t provide one in launch() it will use Dispatchers.Default.<p>But under the hood, Dispatchers schedule on Executors, usually ThreadPoolExecutor. So the more apt technology to compare to is VirtualThread with structured concurrency, and the takeaway should be that coroutines are an ergonomic way to manage concurrent work. Secondarily, they _can_ improve performance by reducing the number of OS threads, if the alternative were to naively spawn them and wait on I&#x2F;O or something.</div><br/></div></div><div id="38047060" class="c"><input type="checkbox" id="c-38047060" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#38046904">parent</a><span>|</span><a href="#38047131">prev</a><span>|</span><a href="#38046441">next</a><span>|</span><label class="collapse" for="c-38047060">[-]</label><label class="expand" for="c-38047060">[1 more]</label></div><br/><div class="children"><div class="content">Since Kotlin threads appear to be Java threads (NB: Just following their documentation, I&#x27;ve never used Kotlin and have only started learning it because we may use it at work for some things in the near-ish future), you oughtn&#x27;t use Thread::suspend. It&#x27;s been deprecated for a while. Java threads are preemptible, though. You don&#x27;t need to explicitly suspend them (even if that method weren&#x27;t deprecated) since the scheduler will happily do it for you.</div><br/></div></div></div></div><div id="38046441" class="c"><input type="checkbox" id="c-38046441" checked=""/><div class="controls bullet"><span class="by">jqpabc123</span><span>|</span><a href="#38046904">prev</a><span>|</span><a href="#38046410">next</a><span>|</span><label class="collapse" for="c-38046441">[-]</label><label class="expand" for="c-38046441">[7 more]</label></div><br/><div class="children"><div class="content">Conclusion: A thread pool is the preferred solution and the go to that I have been using for years.  The tricky part is optimizing the size of the pool.</div><br/><div id="38048075" class="c"><input type="checkbox" id="c-38048075" checked=""/><div class="controls bullet"><span class="by">jillesvangurp</span><span>|</span><a href="#38046441">parent</a><span>|</span><a href="#38047717">next</a><span>|</span><label class="collapse" for="c-38048075">[-]</label><label class="expand" for="c-38048075">[1 more]</label></div><br/><div class="children"><div class="content">You can schedule co-routines on a thread pool. Any Threadpool can be trivially turned into a co-routines dispatcher. Including project loom backed ones (not available on Android of course).<p>The comparison is nonsensical. It&#x27;s not an either or kind of thing. If your co-routines are doing any blocking IO, you&#x27;d use the built in IO dispatcher, which is backed by a thread pool or you&#x27;d create your own dispatcher. Each co-routine gets its own thread if you use that; which can then do blocking IO and block the thread. Very common on the jvm if you are interacting with blocking IO things. I was working on some code that needed this yesterday.<p>The examples in this &quot;benchmark&quot; don&#x27;t make any sense. It&#x27;s not clear what the work is or why threads&#x2F;co-routines are even needed. Handling UI events with threads is not a thing. But co-routines are very useful for that. Because they have very low overhead.</div><br/></div></div><div id="38047717" class="c"><input type="checkbox" id="c-38047717" checked=""/><div class="controls bullet"><span class="by">manmal</span><span>|</span><a href="#38046441">parent</a><span>|</span><a href="#38048075">prev</a><span>|</span><a href="#38046455">next</a><span>|</span><label class="collapse" for="c-38047717">[-]</label><label class="expand" for="c-38047717">[1 more]</label></div><br/><div class="children"><div class="content">Coroutines also run on a thread pool, and usually the pool size is optimized for the device‘s CPU.</div><br/></div></div><div id="38046455" class="c"><input type="checkbox" id="c-38046455" checked=""/><div class="controls bullet"><span class="by">sgammon</span><span>|</span><a href="#38046441">parent</a><span>|</span><a href="#38047717">prev</a><span>|</span><a href="#38046935">next</a><span>|</span><label class="collapse" for="c-38046455">[-]</label><label class="expand" for="c-38046455">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m not sure a cached pool of OS threads is comparable in this way to coroutines. The author also isn&#x27;t doing any I&#x2F;O bound work... or... any work at all?<p>You can schedule coroutines over a threadpool. From the author&#x27;s code, I&#x27;m not even sure this was accounted for in the benchmark. If they are using a threadpool and vanilla coroutines, without specifying where they are scheduled, yes, of course it won&#x27;t start up a pool of threads for you and be as fast as a pool of threads. It would be terrible if it did that by default.</div><br/><div id="38047172" class="c"><input type="checkbox" id="c-38047172" checked=""/><div class="controls bullet"><span class="by">tadfisher</span><span>|</span><a href="#38046441">root</a><span>|</span><a href="#38046455">parent</a><span>|</span><a href="#38046935">next</a><span>|</span><label class="collapse" for="c-38047172">[-]</label><label class="expand" for="c-38047172">[2 more]</label></div><br/><div class="children"><div class="content">It does do this by default; Dispatchers.Default wraps a ThreadPoolExecutor with <i>n</i> threads, where <i>n</i> is the number of logical CPU cores. This is used for computation-bound work. The other built-in Dispatcher instances are Dispatchers.IO, with an unbounded thread pool for I&#x2F;O-bound work; and Dispatchers.Main, which schedules on your platform&#x27;s UI thread.</div><br/><div id="38048091" class="c"><input type="checkbox" id="c-38048091" checked=""/><div class="controls bullet"><span class="by">jillesvangurp</span><span>|</span><a href="#38046441">root</a><span>|</span><a href="#38047172">parent</a><span>|</span><a href="#38046935">next</a><span>|</span><label class="collapse" for="c-38048091">[-]</label><label class="expand" for="c-38048091">[1 more]</label></div><br/><div class="children"><div class="content">The IO dispatcher is a fixed size threadpool of 64 threads or the number of cpu cores (whichever is larger). You can use the kotlinx.coroutines.io.parallelism system property to override the default of 64.</div><br/></div></div></div></div></div></div><div id="38046935" class="c"><input type="checkbox" id="c-38046935" checked=""/><div class="controls bullet"><span class="by">hota_mazi</span><span>|</span><a href="#38046441">parent</a><span>|</span><a href="#38046455">prev</a><span>|</span><a href="#38046410">next</a><span>|</span><label class="collapse" for="c-38046935">[-]</label><label class="expand" for="c-38046935">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s really not the conclusion, and not something you should seriously do.<p>The rule of thumb should be:<p>- Is your task CPU bound? Put it in a thread pool.<p>- Is your task spending most of its time waiting (e.g. network call)? Use a coroutine</div><br/></div></div></div></div><div id="38046410" class="c"><input type="checkbox" id="c-38046410" checked=""/><div class="controls bullet"><span class="by">sgammon</span><span>|</span><a href="#38046441">prev</a><span>|</span><label class="collapse" for="c-38046410">[-]</label><label class="expand" for="c-38046410">[4 more]</label></div><br/><div class="children"><div class="content">Well that was a frustrating read, largely because of the comment section</div><br/><div id="38046644" class="c"><input type="checkbox" id="c-38046644" checked=""/><div class="controls bullet"><span class="by">sgammon</span><span>|</span><a href="#38046410">parent</a><span>|</span><label class="collapse" for="c-38046644">[-]</label><label class="expand" for="c-38046644">[3 more]</label></div><br/><div class="children"><div class="content">Please don&#x27;t downvote me? I&#x27;m referring to the comment section, mostly</div><br/><div id="38046806" class="c"><input type="checkbox" id="c-38046806" checked=""/><div class="controls bullet"><span class="by">poink</span><span>|</span><a href="#38046410">root</a><span>|</span><a href="#38046644">parent</a><span>|</span><label class="collapse" for="c-38046806">[-]</label><label class="expand" for="c-38046806">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Please don&#x27;t comment about the voting on comments. It never does any good, and it makes boring reading.</div><br/><div id="38046823" class="c"><input type="checkbox" id="c-38046823" checked=""/><div class="controls bullet"><span class="by">sgammon</span><span>|</span><a href="#38046410">root</a><span>|</span><a href="#38046806">parent</a><span>|</span><label class="collapse" for="c-38046823">[-]</label><label class="expand" for="c-38046823">[1 more]</label></div><br/><div class="children"><div class="content">Well, I can&#x27;t delete comments, so I hope explaining them clarifies when they unintentionally are seen as mean. But, point taken.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>