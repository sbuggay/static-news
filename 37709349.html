<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696064459061" as="style"/><link rel="stylesheet" href="styles.css?v=1696064459061"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/a13xp0p0v/kernel-hardening-checker">Linux Kernel Hardening Checker</a>Â <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>sandreas</span> | <span>7 comments</span></div><br/><div><div id="37711999" class="c"><input type="checkbox" id="c-37711999" checked=""/><div class="controls bullet"><span class="by">josephcsible</span><span>|</span><a href="#37713085">next</a><span>|</span><label class="collapse" for="c-37711999">[-]</label><label class="expand" for="c-37711999">[5 more]</label></div><br/><div class="children"><div class="content">Hardening the kernel against root is DRM-adjacent. I&#x27;d hope for a poor score from this tool on any computer I use.</div><br/><div id="37712385" class="c"><input type="checkbox" id="c-37712385" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#37711999">parent</a><span>|</span><a href="#37712792">next</a><span>|</span><label class="collapse" for="c-37712385">[-]</label><label class="expand" for="c-37712385">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not quite what&#x27;s happening here. Most of those options protect the general userspace&#x2F;kernel interfaces and hardware issues (spectre, etc.)<p>Very few are root specific. And even then you likely do want your VMs (running as root) to not be able to talk to either the host or other VMs. DRM is a very specific flavour of this and I really don&#x27;t think you want a poor score here.</div><br/><div id="37713122" class="c"><input type="checkbox" id="c-37713122" checked=""/><div class="controls bullet"><span class="by">josephcsible</span><span>|</span><a href="#37711999">root</a><span>|</span><a href="#37712385">parent</a><span>|</span><a href="#37712792">next</a><span>|</span><label class="collapse" for="c-37713122">[-]</label><label class="expand" for="c-37713122">[2 more]</label></div><br/><div class="children"><div class="content">From the KSPP recommended settings, I think the following are evil:<p><pre><code>  # Do not allow direct physical memory access (but if you must have it, at least enable STRICT mode...)
  # CONFIG_DEVMEM is not set
  CONFIG_STRICT_DEVMEM=y
  CONFIG_IO_STRICT_DEVMEM=y
  
  # Make sure SELinux cannot be disabled trivially.
  # CONFIG_SECURITY_SELINUX_BOOTPARAM is not set
  # CONFIG_SECURITY_SELINUX_DEVELOP is not set
  # CONFIG_SECURITY_WRITABLE_HOOKS is not set
  
  # Enable &quot;lockdown&quot; LSM for bright line between the root user and kernel memory.
  CONFIG_SECURITY_LOCKDOWN_LSM=y
  CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y
  CONFIG_LOCK_DOWN_KERNEL_FORCE_CONFIDENTIALITY=y
  
  # Dangerous; enabling this allows direct physical memory writing.
  # CONFIG_ACPI_CUSTOM_METHOD is not set
  
  # Dangerous; enabling this allows direct kernel memory writing.
  # CONFIG_DEVKMEM is not set
  
  # Dangerous; exposes kernel text image layout.
  # CONFIG_PROC_KCORE is not set
  
  # Dangerous; enabling this allows replacement of running kernel.
  # CONFIG_KEXEC is not set
  
  # Dangerous; enabling this allows replacement of running kernel.
  # CONFIG_HIBERNATION is not set
  
  # Keep root from altering kernel memory via loadable modules.
  # CONFIG_MODULES is not set
  
  # But if CONFIG_MODULE=y is needed, at least they must be signed with a per-build key.
  CONFIG_MODULE_SIG_FORCE=y
  
  # Disable Model-Specific Register writes.
  # CONFIG_X86_MSR is not set
  
  # Turn off kexec, even if it&#x27;s built in.
  kernel.kexec_load_disabled = 1
</code></pre>
Also, regarding this:<p>&gt; And even then you likely do want your VMs (running as root) to not be able to talk to either the host or other VMs.<p>I want root in a VM to have full access to that VM&#x27;s kernel, and that&#x27;s all that these settings can stop. VMs already can&#x27;t take over other VMs or the outer system without a vulnerability in the hypervisor.</div><br/><div id="37713494" class="c"><input type="checkbox" id="c-37713494" checked=""/><div class="controls bullet"><span class="by">viraptor</span><span>|</span><a href="#37711999">root</a><span>|</span><a href="#37713122">parent</a><span>|</span><a href="#37712792">next</a><span>|</span><label class="collapse" for="c-37713494">[-]</label><label class="expand" for="c-37713494">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Do not allow direct physical memory access<p>This means someone can&#x27;t plug in a FireWire&#x2F;pcie&#x2F;whatever over usb-c device and read&#x2F;write any data they want (like drive decryption keys).<p>&gt; exposes kernel text image layout.<p>This means if you have a partial exploit but don&#x27;t know where to jump because of address randomisation, the information is leaked.<p>&gt; Keep root from altering kernel memory via loadable modules.<p>It means you can&#x27;t plug in a USB device with a known-vulnerable module that gets auto-loaded and leaves your device open.<p>All of the cases of root also mean &quot;user action which triggers a root-level service to execute something&quot;.<p>&gt; VMs already can&#x27;t take over other VMs or the outer system without a vulnerability in the hypervisor.<p>And if it is vulnerable (or more likely, when it&#x27;s vulnerable) KSPP is the last layer of defence which can prevent the hypervisor from taking over the system.<p>There are reason to enable&#x2F;disable many of those settings, but none of them are evil.</div><br/></div></div></div></div></div></div><div id="37712792" class="c"><input type="checkbox" id="c-37712792" checked=""/><div class="controls bullet"><span class="by">sandreas</span><span>|</span><a href="#37711999">parent</a><span>|</span><a href="#37712385">prev</a><span>|</span><a href="#37713085">next</a><span>|</span><label class="collapse" for="c-37712792">[-]</label><label class="expand" for="c-37712792">[1 more]</label></div><br/><div class="children"><div class="content">This is also very useful on open source router OS distributions like OpenWRT. There is a fork for my Linksys 32X called &quot;divested&quot;[1] which uses this project to harden the kernel.<p>[1]: <a href="https:&#x2F;&#x2F;divested.dev&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;divested.dev&#x2F;</a></div><br/></div></div></div></div><div id="37713085" class="c"><input type="checkbox" id="c-37713085" checked=""/><div class="controls bullet"><span class="by">jakeogh</span><span>|</span><a href="#37711999">prev</a><span>|</span><label class="collapse" for="c-37713085">[-]</label><label class="expand" for="c-37713085">[1 more]</label></div><br/><div class="children"><div class="content">This is very fine. Ran it, wondered why CONFIG_SLUB_DEBUG=y (the first red option in the list) took 15s to find the answer: <a href="https:&#x2F;&#x2F;github.com&#x2F;a13xp0p0v&#x2F;kernel-hardening-checker&#x2F;blob&#x2F;0cfd2e7b87a1d704e378b1d774163d7954f73cff&#x2F;kernel_hardening_checker&#x2F;config_files&#x2F;distros&#x2F;clipos_kernel_doc.txt#L98">https:&#x2F;&#x2F;github.com&#x2F;a13xp0p0v&#x2F;kernel-hardening-checker&#x2F;blob&#x2F;0...</a><p>Turns out that one is&#x2F;was(?) a ~%10 perf hit:
<a href="https:&#x2F;&#x2F;blog.herecura.eu&#x2F;blog&#x2F;2020-05-30-kconfig-hardening-tests&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.herecura.eu&#x2F;blog&#x2F;2020-05-30-kconfig-hardening-t...</a></div><br/></div></div></div></div></div></div></div></body></html>