<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1722869859016" as="style"/><link rel="stylesheet" href="styles.css?v=1722869859016"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sh4dy.com/2024/08/03/beetracer/">Writing a system call tracer using eBPF</a>Â <span class="domain">(<a href="https://sh4dy.com">sh4dy.com</a>)</span></div><div class="subtext"><span>tim_sw</span> | <span>2 comments</span></div><br/><div><div id="41161241" class="c"><input type="checkbox" id="c-41161241" checked=""/><div class="controls bullet"><span class="by">khuey</span><span>|</span><label class="collapse" for="c-41161241">[-]</label><label class="expand" for="c-41161241">[1 more]</label></div><br/><div class="children"><div class="content">This example doesn&#x27;t really gain much by using eBPF. The tracepoint machinery and perf_event_open is perfectly capable of recording pids and registers at syscall entry&#x2F;exit (via PERF_SAMPLE_TID and PERF_SAMPLE_REGS_USER) into a ring buffer. `perf trace` does that today and it can be a useful replacement for strace in situations where strace disturbs the program&#x27;s timing too much or otherwise cannot be used (e.g. you want to strace something that&#x27;s already being ptraced by another process).<p>Where eBPF is powerful is that it allows you to extend the tracepoint ability to grab more complicated system call arguments. The first register argument to open(2) for instance, is a pointer to the filename to open. Merely reporting the registers is largely useless, the tracer needs to chase the pointer and report the string too. An eBPF filter can be used to recognize that the tracepoint is at an open(2) and to read the userspace memory that the relevant register points to. This enables a &quot;full&quot; strace replacement without using ptrace at all. There&#x27;s some ongoing work to add this capability to `perf trace`.</div><br/></div></div></div></div></div></div></div></body></html>