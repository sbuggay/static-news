<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1692522055730" as="style"/><link rel="stylesheet" href="styles.css?v=1692522055730"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://zenhack.net/2019/06/25/a-critique-of-the-capnproto-schema-language.html">A Critique of the Cap&#x27;n Proto Schema Language</a> <span class="domain">(<a href="https://zenhack.net">zenhack.net</a>)</span></div><div class="subtext"><span>signa11</span> | <span>26 comments</span></div><br/><div><div id="37196911" class="c"><input type="checkbox" id="c-37196911" checked=""/><div class="controls bullet"><span class="by">klabb3</span><span>|</span><a href="#37196304">next</a><span>|</span><label class="collapse" for="c-37196911">[-]</label><label class="expand" for="c-37196911">[1 more]</label></div><br/><div class="children"><div class="content">Great post, digestible without experience in capn proto specifics.<p>I really like that they talk in terms of “features carrying their own weight” and survey real world code to see what cases features solve for, and how (surprisingly little) certain features are actually used.<p>A side effect of dropping features when designing for code generation (in this case) is that it makes things more concise for everyone else as well, including the users.<p>There are generally no easy <i>answers</i>, but as a <i>principle</i> I think the burden of proof for new features should be high. “Oh it’s nice” is not enough, unless it’s trivial syntactic sugar. It should really be at least a strong need and ideally multiple needs per feature, so to say.</div><br/></div></div><div id="37196304" class="c"><input type="checkbox" id="c-37196304" checked=""/><div class="controls bullet"><span class="by">ardel95</span><span>|</span><a href="#37196911">prev</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37196304">[-]</label><label class="expand" for="c-37196304">[10 more]</label></div><br/><div class="children"><div class="content">I think one of the most desirable and under-appreciated goals of schema languages and serialization formats is safety. These tools are typically used in places that deal with untrusted inputs, and features and design choices can go a long way in either exposing or shielding developers from potential safety bugs.<p>My read of Cap’n’Proto didn’t make it sound that safety was the highest priority. At least not above performance.</div><br/><div id="37196950" class="c"><input type="checkbox" id="c-37196950" checked=""/><div class="controls bullet"><span class="by">woodruffw</span><span>|</span><a href="#37196304">parent</a><span>|</span><a href="#37197162">next</a><span>|</span><label class="collapse" for="c-37196950">[-]</label><label class="expand" for="c-37196950">[1 more]</label></div><br/><div class="children"><div class="content">I agree entirely, and this is one of my single greatest frustrations with the majority of the current popular IDLs&#x2F;schema languages.<p>ASN.1 is hilariously bad in a lot of ways, but one thing it gets <i>absolutely</i> right is strong typing and being able to express constraints (ranges, values dependent on other values). That combined with a canonicalized encoding form (DER) goes a <i>long</i> way in making various error states unrepresentable.</div><br/></div></div><div id="37197162" class="c"><input type="checkbox" id="c-37197162" checked=""/><div class="controls bullet"><span class="by">gizmo686</span><span>|</span><a href="#37196304">parent</a><span>|</span><a href="#37196950">prev</a><span>|</span><a href="#37197072">next</a><span>|</span><label class="collapse" for="c-37197162">[-]</label><label class="expand" for="c-37197162">[1 more]</label></div><br/><div class="children"><div class="content">Check out DFDL&#x2F;Apache Daffodil. [0] a large portion of the development team is working on it specifically for use in a cybersecurity context. (Disclaimer, I was one such contributer. Although am presently not working on Daffodil).<p>Having said that, DFDL fails pretty miserably by the standards set in the article. The main design goal was to be able to describe as many existing data formats as possible, which means the spec is massive and supports a lot of bad ideas.<p>Despite having its 1.0 release in 2015, and being the most complete implementation, Apache Daffodil still does not fully implement the DFDL spec. And it is not an easy code base to jump into and understand.<p>[0] <a href="https:&#x2F;&#x2F;daffodil.apache.org&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;daffodil.apache.org&#x2F;</a></div><br/></div></div><div id="37197072" class="c"><input type="checkbox" id="c-37197072" checked=""/><div class="controls bullet"><span class="by">nullc</span><span>|</span><a href="#37196304">parent</a><span>|</span><a href="#37197162">prev</a><span>|</span><a href="#37196866">next</a><span>|</span><label class="collapse" for="c-37197072">[-]</label><label class="expand" for="c-37197072">[1 more]</label></div><br/><div class="children"><div class="content">&gt; and serialization formats is safety. These tools are typically used in places that deal with untrusted inputs, and features and design choices can go a long way in either exposing or shielding developers from potential safety bugs<p>My potentially incorrect understanding is that Cap&#x27;n Proto&#x27;s zero copy nature means the serialization format IS the in-memory representation, which means that if you build a Cap&#x27;n Proto object on top of non-zeroed memory you can leak data in the padding when transmitting.  [Presumably not an issue if the packed encoding is used rather than the zero-copy one]</div><br/></div></div><div id="37196866" class="c"><input type="checkbox" id="c-37196866" checked=""/><div class="controls bullet"><span class="by">signa11</span><span>|</span><a href="#37196304">parent</a><span>|</span><a href="#37197072">prev</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37196866">[-]</label><label class="expand" for="c-37196866">[6 more]</label></div><br/><div class="children"><div class="content">hmm, i don’t understand how schema-languages can do anything about that though. afterall, you just serialize&#x2F;de-serialize based on provided inputs, GIGO if you will.<p>safety w.r.t bad&#x2F;malicious inputs should be a ‘higher level’ concern afaik.</div><br/><div id="37196902" class="c"><input type="checkbox" id="c-37196902" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#37196304">root</a><span>|</span><a href="#37196866">parent</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37196902">[-]</label><label class="expand" for="c-37196902">[5 more]</label></div><br/><div class="children"><div class="content">Safety means: garbage in, error out.</div><br/><div id="37197050" class="c"><input type="checkbox" id="c-37197050" checked=""/><div class="controls bullet"><span class="by">signa11</span><span>|</span><a href="#37196304">root</a><span>|</span><a href="#37196902">parent</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37197050">[-]</label><label class="expand" for="c-37197050">[4 more]</label></div><br/><div class="children"><div class="content">right, and it should not be left to the serialization layer for that.</div><br/><div id="37197336" class="c"><input type="checkbox" id="c-37197336" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#37196304">root</a><span>|</span><a href="#37197050">parent</a><span>|</span><a href="#37197085">next</a><span>|</span><label class="collapse" for="c-37197336">[-]</label><label class="expand" for="c-37197336">[1 more]</label></div><br/><div class="children"><div class="content">Security is a concern for <i>every</i> layer. It&#x27;s not magic pixie dust that&#x27; can be sprinkled on top of software to renders it secure!<p>A while ago I read a great article about how the Adobe PDF serialization format is nearly impossible to secure because it allows inherently unsafe constructs.<p>For example, it allows cross-references that are basically just arbitrary unaligned pointers. It uses many different alignment and padding algorithms. It has length-prefixed and not-length prefixed sections. Etc, etc...<p>Apparently it was a <i>serious research exercise</i> to make a safe PDF parser, and they only covered a fraction of the full spec!<p>To put things in perspective: Originally, PDF allowed arbitrary code execution <i>as a core feature</i>, allowing the output of shell commands to be used as document content.<p>Most people like the Chromium and Firefox teams have just given up and now parse PDF using a sandboxed JavaScript VM because it&#x27;s too hard to do it safely with C++. They parse HTML and JavaScript with C++, but not PDF. Think about that.<p>A similar issue caused Log4j, where a &quot;format string parser&quot; contained a vulnerability because it was too flexible and allowed network requests to be triggered by user-controlled data.<p>Even trivial, &quot;surely it must be safe&quot; formats like XML and JSON are riddled with security issues, such as different layers in a microservice architecture having different handling semantics for duplicate keys, null values, etc... This can result in exploits such as authentication and authorization tokens being interpreted by a system one way, but a <i>different way</i> by a different system. For real-world attacks along these lines, search for &quot;request smuggling&quot;.<p>Serialization and parsing are <i>security minefields</i> and it is dangerously naive to just hand-wave that away.<p>See: <a href="https:&#x2F;&#x2F;seriot.ch&#x2F;projects&#x2F;parsing_json.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;seriot.ch&#x2F;projects&#x2F;parsing_json.html</a></div><br/></div></div><div id="37197085" class="c"><input type="checkbox" id="c-37197085" checked=""/><div class="controls bullet"><span class="by">afiori</span><span>|</span><a href="#37196304">root</a><span>|</span><a href="#37197050">parent</a><span>|</span><a href="#37197336">prev</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37197085">[-]</label><label class="expand" for="c-37197085">[2 more]</label></div><br/><div class="children"><div class="content">it depends on what type of safety.<p>The schema language might for example allow you to specify that an input string&#x2F;blob should be smaller than 10MB and refuse to deserialize it if it is longer, same for array&#x2F;list&#x2F;vector length.</div><br/><div id="37197182" class="c"><input type="checkbox" id="c-37197182" checked=""/><div class="controls bullet"><span class="by">seangrogg</span><span>|</span><a href="#37196304">root</a><span>|</span><a href="#37197085">parent</a><span>|</span><a href="#37196300">next</a><span>|</span><label class="collapse" for="c-37197182">[-]</label><label class="expand" for="c-37197182">[1 more]</label></div><br/><div class="children"><div class="content">It feels like a check against an input size of 10MB is something you would do well before deserialization, no?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="37196300" class="c"><input type="checkbox" id="c-37196300" checked=""/><div class="controls bullet"><span class="by">hlieberman</span><span>|</span><a href="#37196304">prev</a><span>|</span><a href="#37196012">next</a><span>|</span><label class="collapse" for="c-37196300">[-]</label><label class="expand" for="c-37196300">[3 more]</label></div><br/><div class="children"><div class="content">Rest in peace, Ian, my friend.</div><br/><div id="37197076" class="c"><input type="checkbox" id="c-37197076" checked=""/><div class="controls bullet"><span class="by">muxator</span><span>|</span><a href="#37196300">parent</a><span>|</span><a href="#37196012">next</a><span>|</span><label class="collapse" for="c-37197076">[-]</label><label class="expand" for="c-37197076">[2 more]</label></div><br/><div class="children"><div class="content">For context: it seems that the author passed away on last July<p><a href="https:&#x2F;&#x2F;www.winchesteruu.org&#x2F;2023&#x2F;07&#x2F;25&#x2F;joys-sorrows-and-transitions&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.winchesteruu.org&#x2F;2023&#x2F;07&#x2F;25&#x2F;joys-sorrows-and-tra...</a></div><br/><div id="37197252" class="c"><input type="checkbox" id="c-37197252" checked=""/><div class="controls bullet"><span class="by">gadders</span><span>|</span><a href="#37196300">root</a><span>|</span><a href="#37197076">parent</a><span>|</span><a href="#37196012">next</a><span>|</span><label class="collapse" for="c-37197252">[-]</label><label class="expand" for="c-37197252">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;us.firenews.video&#x2F;us-news&#x2F;boston-man-dead-art-festival-vermont-necn&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;us.firenews.video&#x2F;us-news&#x2F;boston-man-dead-art-festiv...</a></div><br/></div></div></div></div></div></div><div id="37196012" class="c"><input type="checkbox" id="c-37196012" checked=""/><div class="controls bullet"><span class="by">CoastalCoder</span><span>|</span><a href="#37196300">prev</a><span>|</span><label class="collapse" for="c-37196012">[-]</label><label class="expand" for="c-37196012">[11 more]</label></div><br/><div class="children"><div class="content">2019</div><br/><div id="37196449" class="c"><input type="checkbox" id="c-37196449" checked=""/><div class="controls bullet"><span class="by">scrame</span><span>|</span><a href="#37196012">parent</a><span>|</span><a href="#37196272">next</a><span>|</span><label class="collapse" for="c-37196449">[-]</label><label class="expand" for="c-37196449">[6 more]</label></div><br/><div class="children"><div class="content">does that invalidate the criticisms?</div><br/><div id="37196481" class="c"><input type="checkbox" id="c-37196481" checked=""/><div class="controls bullet"><span class="by">gary_0</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196449">parent</a><span>|</span><a href="#37196938">next</a><span>|</span><label class="collapse" for="c-37196481">[-]</label><label class="expand" for="c-37196481">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s common on HN to note the date for reposts. The mods will usually add the year to the title if it&#x27;s not included. So that&#x27;s probably all that CoastalCoder was signaling.</div><br/><div id="37197094" class="c"><input type="checkbox" id="c-37197094" checked=""/><div class="controls bullet"><span class="by">orhmeh09</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196481">parent</a><span>|</span><a href="#37196938">next</a><span>|</span><label class="collapse" for="c-37197094">[-]</label><label class="expand" for="c-37197094">[1 more]</label></div><br/><div class="children"><div class="content">Users are not advised to do this themselves. The submission guidelines contain no such allowance. They specify a very limited set of cases where the title of a submission can be modified from the web page title.</div><br/></div></div></div></div><div id="37196938" class="c"><input type="checkbox" id="c-37196938" checked=""/><div class="controls bullet"><span class="by">gjvc</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196449">parent</a><span>|</span><a href="#37196481">prev</a><span>|</span><a href="#37196272">next</a><span>|</span><label class="collapse" for="c-37196938">[-]</label><label class="expand" for="c-37196938">[3 more]</label></div><br/><div class="children"><div class="content">recency trolling;  it&#x27;s trivial to find the date of publication, but some people seem to think they can get karma points by their selfless public service...</div><br/><div id="37197123" class="c"><input type="checkbox" id="c-37197123" checked=""/><div class="controls bullet"><span class="by">IshKebab</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196938">parent</a><span>|</span><a href="#37196272">next</a><span>|</span><label class="collapse" for="c-37197123">[-]</label><label class="expand" for="c-37197123">[2 more]</label></div><br/><div class="children"><div class="content">No, some people go to Hacker <i>News</i> to read things that are <i>new</i>. But people love reposting so the compromise is to put the date in the title for old posts so we can easily skip over them.</div><br/><div id="37197240" class="c"><input type="checkbox" id="c-37197240" checked=""/><div class="controls bullet"><span class="by">gjvc</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37197123">parent</a><span>|</span><a href="#37196272">next</a><span>|</span><label class="collapse" for="c-37197240">[-]</label><label class="expand" for="c-37197240">[1 more]</label></div><br/><div class="children"><div class="content">such people must not be easily disappointed</div><br/></div></div></div></div></div></div></div></div><div id="37196272" class="c"><input type="checkbox" id="c-37196272" checked=""/><div class="controls bullet"><span class="by">signa11</span><span>|</span><a href="#37196012">parent</a><span>|</span><a href="#37196449">prev</a><span>|</span><label class="collapse" for="c-37196272">[-]</label><label class="expand" for="c-37196272">[4 more]</label></div><br/><div class="children"><div class="content">yes ?</div><br/><div id="37196498" class="c"><input type="checkbox" id="c-37196498" checked=""/><div class="controls bullet"><span class="by">eesmith</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196272">parent</a><span>|</span><label class="collapse" for="c-37196498">[-]</label><label class="expand" for="c-37196498">[3 more]</label></div><br/><div class="children"><div class="content">Knowing that it&#x27;s from a few years ago gives helpful information to the potential reader.<p>1) Someone may have read the essay before, remembered the point, but forgotten the exact title. It has, after all, been posted on HN twice before. Simply reading the comment that it&#x27;s from 4 years ago may be enough to confirm that it&#x27;s the same article, as it did with me.<p>While the essay has the date right at the top, in general there is no consistency about where people post a date, or if there is one at all.<p>I know that I sometimes skim the HN comments first rather than follow a page link because then I don&#x27;t need to worry about cookie notices, requests to subscribe to a newsletter, etc. This essay does not have those, but enough do that it&#x27;s a general nuisance.<p>2) Software changes over time. Cap&#x27;n Proto&#x27;s Schema language may have changed since then - perhaps as a response to this essay - making this essay of historic interest only. While that is not likely the case, it is an example of how having the date may provide helpful information.<p>This is useful enough that it is accepted practice to add the date to older information. For example, the previous two HN submissions to this essay both include (2019) in the title. See <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;from?site=zenhack.net">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;from?site=zenhack.net</a></div><br/><div id="37196948" class="c"><input type="checkbox" id="c-37196948" checked=""/><div class="controls bullet"><span class="by">gjvc</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196498">parent</a><span>|</span><a href="#37197089">next</a><span>|</span><label class="collapse" for="c-37196948">[-]</label><label class="expand" for="c-37196948">[1 more]</label></div><br/><div class="children"><div class="content"><i>Knowing that it&#x27;s from a few years ago gives helpful information to the potential reader.</i><p>because it&#x27;s so difficult to find the date of publication before people waste their precious time goofing off from their overpaid jobs.</div><br/></div></div><div id="37197089" class="c"><input type="checkbox" id="c-37197089" checked=""/><div class="controls bullet"><span class="by">orhmeh09</span><span>|</span><a href="#37196012">root</a><span>|</span><a href="#37196498">parent</a><span>|</span><a href="#37196948">prev</a><span>|</span><label class="collapse" for="c-37197089">[-]</label><label class="expand" for="c-37197089">[1 more]</label></div><br/><div class="children"><div class="content">The submission guidelines contain no such allowance. They specify a very limited set of cases where the title of a submission can be modified from the web page title.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>