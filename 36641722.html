<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1688893260983" as="style"/><link rel="stylesheet" href="styles.css?v=1688893260983"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/shadyfennec/stupidalloc">Stupid alloc – what if memory allocation was annoying</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>jmmv</span> | <span>48 comments</span></div><br/><div><div id="36651967" class="c"><input type="checkbox" id="c-36651967" checked=""/><div class="controls bullet"><span class="by">PaulDavisThe1st</span><span>|</span><a href="#36651445">next</a><span>|</span><label class="collapse" for="c-36651967">[-]</label><label class="expand" for="c-36651967">[6 more]</label></div><br/><div class="children"><div class="content">Given the implementation of this little thing, I&#x27;m mildly curious about how easy it is&#x2F;will be for a C&#x2F;C++ project&#x2F;programmer to use these Rust crates.<p>The other way around is relatively well defined and has been the subject of a lot of attention for several decades. Is the Rust-lib-called-from-C even feasible?</div><br/><div id="36652770" class="c"><input type="checkbox" id="c-36652770" checked=""/><div class="controls bullet"><span class="by">raggi</span><span>|</span><a href="#36651967">parent</a><span>|</span><a href="#36652629">next</a><span>|</span><label class="collapse" for="c-36652770">[-]</label><label class="expand" for="c-36652770">[1 more]</label></div><br/><div class="children"><div class="content">fairly straightforward:<p><pre><code>        #[global_allocator]
        static GLOBAL: StupidAlloc = StupidAlloc;
        
        #[no_mangle]
        pub unsafe extern &quot;C&quot; fn stupid_malloc(size: usize) -&gt; *mut u8 {
            let layout = Layout::from_size_align(size, 1).unwrap();
            GLOBAL.alloc(layout)
        }
        
        #[no_mangle]
        pub unsafe extern &quot;C&quot; fn stupid_free(ptr: *mut u8) {
            let layout = Layout::from_size_align(1, 1).unwrap();
            GLOBAL.dealloc(ptr, layout)
        }
</code></pre>
then build with --crate-type cdylib, giving you a .so you can link</div><br/></div></div><div id="36652629" class="c"><input type="checkbox" id="c-36652629" checked=""/><div class="controls bullet"><span class="by">exDM69</span><span>|</span><a href="#36651967">parent</a><span>|</span><a href="#36652770">prev</a><span>|</span><a href="#36652640">next</a><span>|</span><label class="collapse" for="c-36652629">[-]</label><label class="expand" for="c-36652629">[1 more]</label></div><br/><div class="children"><div class="content">Rust can be called from C the same way as C++ can. You need to export unmangled extern &quot;C&quot; symbols. Not quite frictionless but there are helper utilities for this.<p>If the Rust code uses the &quot;StupidAlloc&quot; allocator, it should work as expected. There may be some constructor&#x2F;destructor code involved with its usual complications.<p>But it would not replace malloc&#x2F;free in C code nor will it be compatible with C++ allocators for std containers.</div><br/></div></div><div id="36652640" class="c"><input type="checkbox" id="c-36652640" checked=""/><div class="controls bullet"><span class="by">conradludgate</span><span>|</span><a href="#36651967">parent</a><span>|</span><a href="#36652629">prev</a><span>|</span><a href="#36652331">next</a><span>|</span><label class="collapse" for="c-36652640">[-]</label><label class="expand" for="c-36652640">[1 more]</label></div><br/><div class="children"><div class="content">It has been practical for ages. You define a wrapper function as no_mangle and extern &quot;C&quot;, then compile the lib as a staticlib. When compiled, it produces a .a file you can link into your C application</div><br/></div></div><div id="36652331" class="c"><input type="checkbox" id="c-36652331" checked=""/><div class="controls bullet"><span class="by">lionkor</span><span>|</span><a href="#36651967">parent</a><span>|</span><a href="#36652640">prev</a><span>|</span><a href="#36651445">next</a><span>|</span><label class="collapse" for="c-36652331">[-]</label><label class="expand" for="c-36652331">[2 more]</label></div><br/><div class="children"><div class="content">I feel like Rust was designed to fully replace old languages, and is now facing the same issue as every language before it - C and C++ interop (both ways).<p>Zig nailed it, Rust fucked it up. Time will tell if thats big enough of an issue to warrant some bigger changes to fix it.</div><br/><div id="36652426" class="c"><input type="checkbox" id="c-36652426" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#36651967">root</a><span>|</span><a href="#36652331">parent</a><span>|</span><a href="#36651445">next</a><span>|</span><label class="collapse" for="c-36652426">[-]</label><label class="expand" for="c-36652426">[1 more]</label></div><br/><div class="children"><div class="content">That is mischaracterization. Rust has been intended to be able to incrementally integrate to C&#x2F;C++ codebases, of course most significantly integrating Rust&#x2F;Servo components to Firefox&#x2F;Gecko.<p>See for example this rsvg presentation[1] and gstreamer blog post[2] for examples of the interop<p>[1] <a href="https:&#x2F;&#x2F;viruta.org&#x2F;docs&#x2F;fmq-porting-c-to-rust.pdf" rel="nofollow noreferrer">https:&#x2F;&#x2F;viruta.org&#x2F;docs&#x2F;fmq-porting-c-to-rust.pdf</a><p>[2] <a href="https:&#x2F;&#x2F;coaxion.net&#x2F;blog&#x2F;2016&#x2F;05&#x2F;writing-gstreamer-plugins-and-elements-in-rust&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;coaxion.net&#x2F;blog&#x2F;2016&#x2F;05&#x2F;writing-gstreamer-plugins-a...</a></div><br/></div></div></div></div></div></div><div id="36651445" class="c"><input type="checkbox" id="c-36651445" checked=""/><div class="controls bullet"><span class="by">andrewmcwatters</span><span>|</span><a href="#36651967">prev</a><span>|</span><a href="#36651085">next</a><span>|</span><label class="collapse" for="c-36651445">[-]</label><label class="expand" for="c-36651445">[4 more]</label></div><br/><div class="children"><div class="content">I love it. I’d also like to see a bellalloc which plays the system warning sound on every allocation.[1]<p>[1]: <a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Bell_character" rel="nofollow noreferrer">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Bell_character</a></div><br/><div id="36651599" class="c"><input type="checkbox" id="c-36651599" checked=""/><div class="controls bullet"><span class="by">jswrenn</span><span>|</span><a href="#36651445">parent</a><span>|</span><a href="#36651965">next</a><span>|</span><label class="collapse" for="c-36651599">[-]</label><label class="expand" for="c-36651599">[2 more]</label></div><br/><div class="children"><div class="content">It already exists! <a href="https:&#x2F;&#x2F;github.com&#x2F;cuviper&#x2F;alloc_geiger">https:&#x2F;&#x2F;github.com&#x2F;cuviper&#x2F;alloc_geiger</a></div><br/><div id="36651622" class="c"><input type="checkbox" id="c-36651622" checked=""/><div class="controls bullet"><span class="by">andrewmcwatters</span><span>|</span><a href="#36651445">root</a><span>|</span><a href="#36651599">parent</a><span>|</span><a href="#36651965">next</a><span>|</span><label class="collapse" for="c-36651622">[-]</label><label class="expand" for="c-36651622">[1 more]</label></div><br/><div class="children"><div class="content">Hahaha, perfect! Edit: Wow, I love that this does specifically that, too.</div><br/></div></div></div></div><div id="36651965" class="c"><input type="checkbox" id="c-36651965" checked=""/><div class="controls bullet"><span class="by">LiamPowell</span><span>|</span><a href="#36651445">parent</a><span>|</span><a href="#36651599">prev</a><span>|</span><a href="#36651085">next</a><span>|</span><label class="collapse" for="c-36651965">[-]</label><label class="expand" for="c-36651965">[1 more]</label></div><br/><div class="children"><div class="content">Not Rust, but it&#x27;s very easy to wrap malloc under gcc for this kind of thing (or something more useful). Compile with --wrap=malloc and:<p><pre><code>    void *__real_malloc(size_t);
    void *__wrap_malloc(size_t size) {
        ...
        return __real_malloc(size);
    }</code></pre></div><br/></div></div></div></div><div id="36651085" class="c"><input type="checkbox" id="c-36651085" checked=""/><div class="controls bullet"><span class="by">VWWHFSfQ</span><span>|</span><a href="#36651445">prev</a><span>|</span><a href="#36651289">next</a><span>|</span><label class="collapse" for="c-36651085">[-]</label><label class="expand" for="c-36651085">[34 more]</label></div><br/><div class="children"><div class="content">I love Rust.  But it seems like there&#x27;s some kind of religion about allocations.<p>Don&#x27;t use String you fool, you want &amp;str!<p>Don&#x27;t use Vec you fool, use &amp;[]!<p>It really puts people off.  Because now they have to learn all about lifetimes and that&#x27;s a fucking nightmare.  My advice: Use String.  Use Vec.  Use Hashmaps.  It&#x27;s all still going to be a million time faster than whatever you were doing in Python, or Java, or Go, or Javascript, or whatever.</div><br/><div id="36651305" class="c"><input type="checkbox" id="c-36651305" checked=""/><div class="controls bullet"><span class="by">mostlylurks</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651383">next</a><span>|</span><label class="collapse" for="c-36651305">[-]</label><label class="expand" for="c-36651305">[5 more]</label></div><br/><div class="children"><div class="content">If you don&#x27;t understand how lifetimes and associated aspects of the language work, you might very realistically run into situations where your code will be a million times slower than the python, java, etc. equivalent, not faster. For instance, copying a massive dynamically allocated container in every iteration of a hot loop instead of passing a reference (much less likely to do on accident than in C++, but still possible), if you don&#x27;t understand value vs reference semantics, copying, moving, etc, since garbage collected languages don&#x27;t force you to learn these things, and passing around references to large collections is cheap in those languages.</div><br/><div id="36652857" class="c"><input type="checkbox" id="c-36652857" checked=""/><div class="controls bullet"><span class="by">raggi</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651305">parent</a><span>|</span><a href="#36652317">next</a><span>|</span><label class="collapse" for="c-36652857">[-]</label><label class="expand" for="c-36652857">[1 more]</label></div><br/><div class="children"><div class="content">so then you do that, making stuff on the heap, doing extra zero&#x27;ing and so on, and your debug build gets faster, and you call it good. then someone profiles a release build, removes the allocation and watches the optimizer wipe out the entire copy because all you were really doing is touching a single field. there&#x27;s no general case here.</div><br/></div></div><div id="36652317" class="c"><input type="checkbox" id="c-36652317" checked=""/><div class="controls bullet"><span class="by">xxs</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651305">parent</a><span>|</span><a href="#36652857">prev</a><span>|</span><a href="#36651893">next</a><span>|</span><label class="collapse" for="c-36652317">[-]</label><label class="expand" for="c-36652317">[2 more]</label></div><br/><div class="children"><div class="content">&gt;For instance, copying a massive dynamically allocated container in every iteration<p>Java has references only by design, so you can&#x27;t do that.</div><br/><div id="36652565" class="c"><input type="checkbox" id="c-36652565" checked=""/><div class="controls bullet"><span class="by">RGBCube</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36652317">parent</a><span>|</span><a href="#36651893">next</a><span>|</span><label class="collapse" for="c-36652565">[-]</label><label class="expand" for="c-36652565">[1 more]</label></div><br/><div class="children"><div class="content">Exactly, that&#x27;s the point.</div><br/></div></div></div></div><div id="36651893" class="c"><input type="checkbox" id="c-36651893" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651305">parent</a><span>|</span><a href="#36652317">prev</a><span>|</span><a href="#36651383">next</a><span>|</span><label class="collapse" for="c-36651893">[-]</label><label class="expand" for="c-36651893">[1 more]</label></div><br/><div class="children"><div class="content">That sounds like the problem is the container itself contains value types rather than references, but then doesn&#x27;t implement copy-on-write, which is a simple way to solve this.</div><br/></div></div></div></div><div id="36651383" class="c"><input type="checkbox" id="c-36651383" checked=""/><div class="controls bullet"><span class="by">mikebenfield</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651305">prev</a><span>|</span><a href="#36652673">next</a><span>|</span><label class="collapse" for="c-36651383">[-]</label><label class="expand" for="c-36651383">[1 more]</label></div><br/><div class="children"><div class="content">Well you&#x27;re not going to be much of a Rust user if you don&#x27;t learn the basics of lifetimes anyway. I don&#x27;t mean to get all gatekeepy, but if someone&#x27;s not comfortable with &amp;str and &amp;[T], they&#x27;re missing half the point of the language and won&#x27;t be able to use much library code anyway.</div><br/></div></div><div id="36652673" class="c"><input type="checkbox" id="c-36652673" checked=""/><div class="controls bullet"><span class="by">constantcrying</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651383">prev</a><span>|</span><a href="#36651182">next</a><span>|</span><label class="collapse" for="c-36652673">[-]</label><label class="expand" for="c-36652673">[1 more]</label></div><br/><div class="children"><div class="content">&gt;now they have to learn all about lifetimes<p>If you do not want to learn about lifetimes do not use Rust. The advice is also terrible since inevitably you are going to use someone elses code, which does use slices.</div><br/></div></div><div id="36651182" class="c"><input type="checkbox" id="c-36651182" checked=""/><div class="controls bullet"><span class="by">tadfisher</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36652673">prev</a><span>|</span><a href="#36651468">next</a><span>|</span><label class="collapse" for="c-36651182">[-]</label><label class="expand" for="c-36651182">[6 more]</label></div><br/><div class="children"><div class="content">This isn&#x27;t really a Rust problem. Even Java forces you to reckon with heap vs. stack allocation with its boxed types, and you&#x27;ll get annoying warnings when you use Integer when int would do.<p>This is just programming culture; given two ways of doing something, with one being harder but more performant, we gravitate to the harder one at all costs.</div><br/><div id="36652624" class="c"><input type="checkbox" id="c-36652624" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651182">parent</a><span>|</span><a href="#36651488">next</a><span>|</span><label class="collapse" for="c-36652624">[-]</label><label class="expand" for="c-36652624">[1 more]</label></div><br/><div class="children"><div class="content">&gt; you&#x27;ll get annoying warnings when you use Integer when int would do.<p>You can turn them off though, and most of the culture will support you in ignoring them if that&#x27;s appropriate to your use case.</div><br/></div></div><div id="36651488" class="c"><input type="checkbox" id="c-36651488" checked=""/><div class="controls bullet"><span class="by">jonhohle</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651182">parent</a><span>|</span><a href="#36652624">prev</a><span>|</span><a href="#36651478">next</a><span>|</span><label class="collapse" for="c-36651488">[-]</label><label class="expand" for="c-36651488">[2 more]</label></div><br/><div class="children"><div class="content">There are only two times to use boxed types in Java: when they’re in collection types that take objects (e.g. generics), or when the value needs to be nullable. The first is a language design flaw (imho) that can’t be easily fixed due to backwards compatibility desires. The second is almost always a boundary (DB to app, app to API, etc.) issue that should be resolved quickly, imho.<p>In existing codebases I’ve worked with, often 90% or more boxed primitives are unnecessary, introduce unnecessary errors (assumed non-null refs vs. guaranteed non-null values) and performance penalties. They have a purpose, but there are libraries that address the first concern and Optional${Type} that are more expressive for the second.</div><br/><div id="36652386" class="c"><input type="checkbox" id="c-36652386" checked=""/><div class="controls bullet"><span class="by">xxs</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651488">parent</a><span>|</span><a href="#36651478">next</a><span>|</span><label class="collapse" for="c-36652386">[-]</label><label class="expand" for="c-36652386">[1 more]</label></div><br/><div class="children"><div class="content">&gt;or when the value needs to be nullable.<p>I&#x27;d discount this part entirely. Using a boxes&#x2F;non-primitive type for nullability is likely a design mistake. I can go in a full rant mode, in practical terms I tend to reject pull requests that do that.</div><br/></div></div></div></div><div id="36651478" class="c"><input type="checkbox" id="c-36651478" checked=""/><div class="controls bullet"><span class="by">smabie</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651182">parent</a><span>|</span><a href="#36651488">prev</a><span>|</span><a href="#36651277">next</a><span>|</span><label class="collapse" for="c-36651478">[-]</label><label class="expand" for="c-36651478">[1 more]</label></div><br/><div class="children"><div class="content">Considering how mind boggling slow most software is, doesn&#x27;t seem we are gravitating to the more performant options..</div><br/></div></div></div></div><div id="36651468" class="c"><input type="checkbox" id="c-36651468" checked=""/><div class="controls bullet"><span class="by">smabie</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651182">prev</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36651468">[-]</label><label class="expand" for="c-36651468">[7 more]</label></div><br/><div class="children"><div class="content">If you don&#x27;t care about allocations why are you using Rust in the first place?<p>Also if you are super sloppy with allocations I would expect something like Java or Go would be faster since GC is more efficient.</div><br/><div id="36651693" class="c"><input type="checkbox" id="c-36651693" checked=""/><div class="controls bullet"><span class="by">ripley12</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651468">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36651693">[-]</label><label class="expand" for="c-36651693">[6 more]</label></div><br/><div class="children"><div class="content">&gt; If you don&#x27;t care about allocations why are you using Rust in the first place?<p>Because Rust excels on a lot of dimensions other than &quot;systems programming&quot;; Cargo is fantastic, the ecosystem of packages is great, it&#x27;s one of the only languages that takes cross-platform support (including Windows) seriously, and it&#x27;s got sum types.<p>Or, as withoutboats put it: <a href="https:&#x2F;&#x2F;twitter.com&#x2F;withoutboats&#x2F;status&#x2F;1658536526043570179" rel="nofollow noreferrer">https:&#x2F;&#x2F;twitter.com&#x2F;withoutboats&#x2F;status&#x2F;1658536526043570179</a></div><br/><div id="36651833" class="c"><input type="checkbox" id="c-36651833" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651693">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36651833">[-]</label><label class="expand" for="c-36651833">[5 more]</label></div><br/><div class="children"><div class="content">Any ML influenced language has sum types.<p>Including some that run on the JVM and 30 years of Java, makes Maven Central certainly beat cargo.io in package count.<p>So there are options.</div><br/><div id="36651975" class="c"><input type="checkbox" id="c-36651975" checked=""/><div class="controls bullet"><span class="by">Ygg2</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651833">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36651975">[-]</label><label class="expand" for="c-36651975">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Any ML influenced language has sum types.<p>&gt; Including some that run on the JVM<p>True. However, most that want to keep interoperability with Java, in order to get benefit of huge deposit of packages. That often means having to repeat Java&#x27;s mistakes to maintain compatibility.</div><br/><div id="36652233" class="c"><input type="checkbox" id="c-36652233" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651975">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36652233">[-]</label><label class="expand" for="c-36652233">[3 more]</label></div><br/><div class="children"><div class="content">So is the fate of guest languages.<p>Likewise a language without flaws, is a language with no users.</div><br/><div id="36652616" class="c"><input type="checkbox" id="c-36652616" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36652233">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36652616">[-]</label><label class="expand" for="c-36652616">[2 more]</label></div><br/><div class="children"><div class="content">Rust has managed to be popular without having to resort to being a guest language.</div><br/><div id="36652738" class="c"><input type="checkbox" id="c-36652738" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36652616">parent</a><span>|</span><a href="#36651239">next</a><span>|</span><label class="collapse" for="c-36652738">[-]</label><label class="expand" for="c-36652738">[1 more]</label></div><br/><div class="children"><div class="content">Another worthless Rust advocacy strike force comment.<p>No one over here was making the point Rust being a guest language, unless you want to now start discussing about GraalVM capability of executing LLVM bitcode.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="36651239" class="c"><input type="checkbox" id="c-36651239" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651468">prev</a><span>|</span><a href="#36651769">next</a><span>|</span><label class="collapse" for="c-36651239">[-]</label><label class="expand" for="c-36651239">[7 more]</label></div><br/><div class="children"><div class="content">I agree, but I don&#x27;t know about a million :)<p><a href="https:&#x2F;&#x2F;programming-language-benchmarks.vercel.app&#x2F;rust-vs-java" rel="nofollow noreferrer">https:&#x2F;&#x2F;programming-language-benchmarks.vercel.app&#x2F;rust-vs-j...</a><p>For giggles, also checkout the amount of generated machine code in godbolt with a simple Hello world that uses &amp;str vs String. Its like 10x the instructions :P</div><br/><div id="36652362" class="c"><input type="checkbox" id="c-36652362" checked=""/><div class="controls bullet"><span class="by">xxs</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651239">parent</a><span>|</span><a href="#36652367">next</a><span>|</span><label class="collapse" for="c-36652362">[-]</label><label class="expand" for="c-36652362">[1 more]</label></div><br/><div class="children"><div class="content">While I agree about million times, [micro]benchmarks that run seconds (or milliseconds) have extremely limited use, esp. when combined with non-compiled languages, that&#x27;s effectively comparing compilation, guidance, and run time.<p>I&#x27;d consider the entire site&#x2F;process flawed.</div><br/></div></div><div id="36652367" class="c"><input type="checkbox" id="c-36652367" checked=""/><div class="controls bullet"><span class="by">return_to_monke</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651239">parent</a><span>|</span><a href="#36652362">prev</a><span>|</span><a href="#36651334">next</a><span>|</span><label class="collapse" for="c-36652367">[-]</label><label class="expand" for="c-36652367">[2 more]</label></div><br/><div class="children"><div class="content">Do the java benchmarks include JVM startup?</div><br/><div id="36652729" class="c"><input type="checkbox" id="c-36652729" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36652367">parent</a><span>|</span><a href="#36651334">next</a><span>|</span><label class="collapse" for="c-36652729">[-]</label><label class="expand" for="c-36652729">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, it appears they just run a script, I don&#x27;t think the code itself is allowed to say how long the test took. That&#x27;s why you have to subtract like 80ms (estimating from the hello world comparison) for most of them.</div><br/></div></div></div></div><div id="36651334" class="c"><input type="checkbox" id="c-36651334" checked=""/><div class="controls bullet"><span class="by">rolobio</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651239">parent</a><span>|</span><a href="#36652367">prev</a><span>|</span><a href="#36651769">next</a><span>|</span><label class="collapse" for="c-36651334">[-]</label><label class="expand" for="c-36651334">[3 more]</label></div><br/><div class="children"><div class="content">That link does not work for me?</div><br/><div id="36651439" class="c"><input type="checkbox" id="c-36651439" checked=""/><div class="controls bullet"><span class="by">satvikpendem</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651334">parent</a><span>|</span><a href="#36651769">next</a><span>|</span><label class="collapse" for="c-36651439">[-]</label><label class="expand" for="c-36651439">[2 more]</label></div><br/><div class="children"><div class="content">Not sure why they posted an AMP link, here&#x27;s the correct one: <a href="https:&#x2F;&#x2F;programming-language-benchmarks.vercel.app&#x2F;rust-vs-java" rel="nofollow noreferrer">https:&#x2F;&#x2F;programming-language-benchmarks.vercel.app&#x2F;rust-vs-j...</a></div><br/><div id="36651571" class="c"><input type="checkbox" id="c-36651571" checked=""/><div class="controls bullet"><span class="by">winrid</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651439">parent</a><span>|</span><a href="#36651769">next</a><span>|</span><label class="collapse" for="c-36651571">[-]</label><label class="expand" for="c-36651571">[1 more]</label></div><br/><div class="children"><div class="content">I fixed it. Didn&#x27;t trim enough of the URL on mobile..</div><br/></div></div></div></div></div></div></div></div><div id="36651769" class="c"><input type="checkbox" id="c-36651769" checked=""/><div class="controls bullet"><span class="by">kstrauser</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651239">prev</a><span>|</span><a href="#36651816">next</a><span>|</span><label class="collapse" for="c-36651769">[-]</label><label class="expand" for="c-36651769">[4 more]</label></div><br/><div class="children"><div class="content">I like to pre-allocate a &amp;str buffer at launch, then create &amp;str variables pointing into that buffer. I separate them with 0x00 bytes so I don’t have to store an extra size counter or invent a new data type.</div><br/><div id="36652837" class="c"><input type="checkbox" id="c-36652837" checked=""/><div class="controls bullet"><span class="by">raggi</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651769">parent</a><span>|</span><a href="#36652710">next</a><span>|</span><label class="collapse" for="c-36652837">[-]</label><label class="expand" for="c-36652837">[1 more]</label></div><br/><div class="children"><div class="content">argv, have the caller do it for you</div><br/></div></div><div id="36652710" class="c"><input type="checkbox" id="c-36652710" checked=""/><div class="controls bullet"><span class="by">mandarax8</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651769">parent</a><span>|</span><a href="#36652837">prev</a><span>|</span><a href="#36652672">next</a><span>|</span><label class="collapse" for="c-36652710">[-]</label><label class="expand" for="c-36652710">[1 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t rust already do this for string literals? Or am I missing the joke?</div><br/></div></div><div id="36652672" class="c"><input type="checkbox" id="c-36652672" checked=""/><div class="controls bullet"><span class="by">saagarjha</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651769">parent</a><span>|</span><a href="#36652710">prev</a><span>|</span><a href="#36651816">next</a><span>|</span><label class="collapse" for="c-36652672">[-]</label><label class="expand" for="c-36652672">[1 more]</label></div><br/><div class="children"><div class="content">I C what you did there.</div><br/></div></div></div></div><div id="36651816" class="c"><input type="checkbox" id="c-36651816" checked=""/><div class="controls bullet"><span class="by">int0x2e</span><span>|</span><a href="#36651085">parent</a><span>|</span><a href="#36651769">prev</a><span>|</span><a href="#36651289">next</a><span>|</span><label class="collapse" for="c-36651816">[-]</label><label class="expand" for="c-36651816">[2 more]</label></div><br/><div class="children"><div class="content">That works for some types of code and fails for other types. If you have very long lived but memory heavy apps, allocations really matter...</div><br/><div id="36651886" class="c"><input type="checkbox" id="c-36651886" checked=""/><div class="controls bullet"><span class="by">astrange</span><span>|</span><a href="#36651085">root</a><span>|</span><a href="#36651816">parent</a><span>|</span><a href="#36651289">next</a><span>|</span><label class="collapse" for="c-36651886">[-]</label><label class="expand" for="c-36651886">[1 more]</label></div><br/><div class="children"><div class="content">There&#x27;s other ways to avoid the problem. One is to just restart the whole process every so often.<p>Also, copies are not bad and they&#x27;re often a better tradeoff than microoptimizing all your lifetimes.</div><br/></div></div></div></div></div></div><div id="36651289" class="c"><input type="checkbox" id="c-36651289" checked=""/><div class="controls bullet"><span class="by">dbetteridge</span><span>|</span><a href="#36651085">prev</a><span>|</span><a href="#36650981">next</a><span>|</span><label class="collapse" for="c-36651289">[-]</label><label class="expand" for="c-36651289">[1 more]</label></div><br/><div class="children"><div class="content">If?</div><br/></div></div><div id="36650981" class="c"><input type="checkbox" id="c-36650981" checked=""/><div class="controls bullet"><span class="by">B1FF_PSUVM</span><span>|</span><a href="#36651289">prev</a><span>|</span><a href="#36651018">next</a><span>|</span><label class="collapse" for="c-36650981">[-]</label><label class="expand" for="c-36650981">[1 more]</label></div><br/><div class="children"><div class="content">Sounds like a good feature for valgrind(1)</div><br/></div></div><div id="36651018" class="c"><input type="checkbox" id="c-36651018" checked=""/><div class="controls bullet"><span class="by">eek2121</span><span>|</span><a href="#36650981">prev</a><span>|</span><label class="collapse" for="c-36651018">[-]</label><label class="expand" for="c-36651018">[1 more]</label></div><br/><div class="children"><div class="content">So, a couple decades ago I was a C&#x2F;C++ developer (oh and ASM!). I loved life, enjoyed the language. Then, I learned the higher level stuff. SQL, Visual Basic, ASP, C#, PHP, Python, Ruby, etc. I REALLY enjoyed that stuff, and it has fueled my career. This morning I found out about an interesting language called Hare, which kinda looks like a certain other language...then I saw this post.<p>I hate you. I hate you for making me hate low level programming. I mean...I don&#x27;t hate it. I don&#x27;t even hate memory management...but YOU...YOU sir...</div><br/></div></div></div></div></div></div></div></body></html>