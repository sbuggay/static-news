<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712307649518" as="style"/><link rel="stylesheet" href="styles.css?v=1712307649518"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://mas-bandwidth.com/xdp-for-game-programmers/">XDP for game programmers</a> <span class="domain">(<a href="https://mas-bandwidth.com">mas-bandwidth.com</a>)</span></div><div class="subtext"><span>gafferongames</span> | <span>64 comments</span></div><br/><div><div id="39935514" class="c"><input type="checkbox" id="c-39935514" checked=""/><div class="controls bullet"><span class="by">nicebyte</span><span>|</span><a href="#39936199">next</a><span>|</span><label class="collapse" for="c-39935514">[-]</label><label class="expand" for="c-39935514">[12 more]</label></div><br/><div class="children"><div class="content">I&#x27;m calling eBPF &quot;kernel shaders&quot; to confuse graphics, os and gpgpu people all at the same time.</div><br/><div id="39935678" class="c"><input type="checkbox" id="c-39935678" checked=""/><div class="controls bullet"><span class="by">sakras</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39936002">next</a><span>|</span><label class="collapse" for="c-39935678">[-]</label><label class="expand" for="c-39935678">[5 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been exactly thinking about it this way for a long time. Actually once we&#x27;re able to push computation down into our disk drives, I wouldn&#x27;t be surprised if these &quot;Disk Shaders&quot; will be written in eBPF.</div><br/><div id="39940208" class="c"><input type="checkbox" id="c-39940208" checked=""/><div class="controls bullet"><span class="by">danwills</span><span>|</span><a href="#39935514">root</a><span>|</span><a href="#39935678">parent</a><span>|</span><a href="#39937904">next</a><span>|</span><label class="collapse" for="c-39940208">[-]</label><label class="expand" for="c-39940208">[1 more]</label></div><br/><div class="children"><div class="content">Totally sibling comment confirms it already exists! I hope that the &#x27;shader&#x27; name sticks too! I find the idea of a shader has a very appropriate shape for tiny-program-embedded-in-specific-context so it seems perfect from a hacker POV!<p>I have a VFX(Houdini now, RSL shaders etc earlier) and openCL-dabbling and demoscene-lurking background, based on which I think I prefer &#x27;shader&#x27; to &#x27;kernel&#x27;, that&#x27;s what OpenCL calls them.. but that conflicts with the name of like, &#x27;the OS kernel&#x27; at least somewhat..</div><br/></div></div><div id="39937904" class="c"><input type="checkbox" id="c-39937904" checked=""/><div class="controls bullet"><span class="by">killerstorm</span><span>|</span><a href="#39935514">root</a><span>|</span><a href="#39935678">parent</a><span>|</span><a href="#39940208">prev</a><span>|</span><a href="#39936208">next</a><span>|</span><label class="collapse" for="c-39937904">[-]</label><label class="expand" for="c-39937904">[2 more]</label></div><br/><div class="children"><div class="content">It&#x27;s already a thing on mainframes, disk shaders are called channel programs: <a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Channel_I&#x2F;O#Channel_program" rel="nofollow">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;Channel_I&#x2F;O#Channel_program</a></div><br/><div id="39939278" class="c"><input type="checkbox" id="c-39939278" checked=""/><div class="controls bullet"><span class="by">worthless-trash</span><span>|</span><a href="#39935514">root</a><span>|</span><a href="#39937904">parent</a><span>|</span><a href="#39936208">next</a><span>|</span><label class="collapse" for="c-39939278">[-]</label><label class="expand" for="c-39939278">[1 more]</label></div><br/><div class="children"><div class="content">Thank you for this beautiful rabbit hole to chase.</div><br/></div></div></div></div></div></div><div id="39936002" class="c"><input type="checkbox" id="c-39936002" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39935678">prev</a><span>|</span><a href="#39937181">next</a><span>|</span><label class="collapse" for="c-39936002">[-]</label><label class="expand" for="c-39936002">[2 more]</label></div><br/><div class="children"><div class="content">Decade and a half ago there was PacketShader, which used usermode networking+GPUs to do packet routing. It was a thrilling time. I thought this kind of effort to integrate off-the-shelf hardware and open source software-defined-networking (SDN) was only going to build and amplify. We do have some great SDN but remains a fairly niche world that stays largely behind the scenes. <a href="https:&#x2F;&#x2F;shader.kaist.edu&#x2F;packetshader&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;shader.kaist.edu&#x2F;packetshader&#x2F;index.html</a><p>I wish someone would take up this effort again. It&#x27;d be awesome to see VPP or someone target offload to GPUs again. It feels like there&#x27;s a ton of optimization we could do today based around PCI-P2P, where the network card could DMA direct to the GPU and back out without having to transit main-memory&#x2F;the CPU at all; lower latency &amp; very efficient. It&#x27;s a long leap &amp; long hope, but I very much dream that CXL eventually brings us closer to that &quot;disaggregated rack&quot; model where a less host-based fabric starts disrupting architecture, create more deeply connected systems.<p>That said, just dropping down an fpga right on the nic is probably&#x2F;definitely a smarter move. Seems like a bunch of hyperscaler do this. Unclear how much traction Marvell&#x2F;Nvidia get from BlueField being on their boxes but it&#x27;s there. Actually using the fpga is hard of course. Xilinx&#x2F;AMD have a track record of kicking out some open source projects that seem interesting but don&#x27;t seem to have any follow through. Nanotube being an XDP offload engine seemed brilliant, like a sure win. <a href="https:&#x2F;&#x2F;github.com&#x2F;Xilinx&#x2F;nanotube">https:&#x2F;&#x2F;github.com&#x2F;Xilinx&#x2F;nanotube</a> and <a href="https:&#x2F;&#x2F;github.com&#x2F;Xilinx&#x2F;open-nic">https:&#x2F;&#x2F;github.com&#x2F;Xilinx&#x2F;open-nic</a> .</div><br/><div id="39937270" class="c"><input type="checkbox" id="c-39937270" checked=""/><div class="controls bullet"><span class="by">mordechai9000</span><span>|</span><a href="#39935514">root</a><span>|</span><a href="#39936002">parent</a><span>|</span><a href="#39937181">next</a><span>|</span><label class="collapse" for="c-39937270">[-]</label><label class="expand" for="c-39937270">[1 more]</label></div><br/><div class="children"><div class="content">What about Nvidia &#x2F; Mellanox &#x2F; Bluefield?<p>It looks like they have some demo code doing something like that. 
<a href="https:&#x2F;&#x2F;docs.nvidia.com&#x2F;doca&#x2F;archive&#x2F;doca-v2.2.1&#x2F;gpu-packet-processing&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;docs.nvidia.com&#x2F;doca&#x2F;archive&#x2F;doca-v2.2.1&#x2F;gpu-packet-...</a><p>What kind of workloads do you think would benefit from GPU processing?</div><br/></div></div></div></div><div id="39937181" class="c"><input type="checkbox" id="c-39937181" checked=""/><div class="controls bullet"><span class="by">wheybags</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39936002">prev</a><span>|</span><a href="#39937791">next</a><span>|</span><label class="collapse" for="c-39937181">[-]</label><label class="expand" for="c-39937181">[1 more]</label></div><br/><div class="children"><div class="content">I love this name, I hope it catches on</div><br/></div></div><div id="39937791" class="c"><input type="checkbox" id="c-39937791" checked=""/><div class="controls bullet"><span class="by">Waterluvian</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39937181">prev</a><span>|</span><a href="#39935954">next</a><span>|</span><label class="collapse" for="c-39937791">[-]</label><label class="expand" for="c-39937791">[1 more]</label></div><br/><div class="children"><div class="content">The name “shader” screwed me up for so long. But once I better understood what they really are I think they’re incredibly powerful.  “Kernel shader” is amazing.</div><br/></div></div><div id="39935954" class="c"><input type="checkbox" id="c-39935954" checked=""/><div class="controls bullet"><span class="by">reactordev</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39937791">prev</a><span>|</span><a href="#39935640">next</a><span>|</span><label class="collapse" for="c-39935954">[-]</label><label class="expand" for="c-39935954">[1 more]</label></div><br/><div class="children"><div class="content">not &quot;koroutines&quot;? I like &quot;kernel shaders&quot; though.</div><br/></div></div><div id="39935640" class="c"><input type="checkbox" id="c-39935640" checked=""/><div class="controls bullet"><span class="by">meindnoch</span><span>|</span><a href="#39935514">parent</a><span>|</span><a href="#39935954">prev</a><span>|</span><a href="#39936199">next</a><span>|</span><label class="collapse" for="c-39935640">[-]</label><label class="expand" for="c-39935640">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m stealing this.</div><br/></div></div></div></div><div id="39936199" class="c"><input type="checkbox" id="c-39936199" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#39935514">prev</a><span>|</span><a href="#39940067">next</a><span>|</span><label class="collapse" for="c-39936199">[-]</label><label class="expand" for="c-39936199">[11 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve actually written a high-performance metaverse client, one that can usefully pull half a gigabit per second and more from the Internet. So I get to see this happening. I&#x27;m looking at a highly detailed area right now, from the air, and traffic peaked around 200Mb&#x2F;s.  This XDP thing seems to address the wrong problem.<p>Actual traffic for a metaverse is mostly bulk content download. Highly interactive traffic over UDP is maybe 1MB&#x2F;second, including voice. You&#x27;re mostly sending positions and orientations for moving objects.
Latency matters for that, but an extra few hundred microseconds won&#x27;t hurt. The rest is large file transfers. Those may be from totally different servers than the ones that talk interactive UDP. There&#x27;s probably a CDN involved, and you&#x27;re talking to caches. Latency doesn&#x27;t matter that much, but big-block bandwidth does.<p>Practical problems include data caps. If you go driving around a big metaverse, you can easily pull 200GB&#x2F;hour from the asset servers. Don&#x27;t try this on &quot;AT&amp;T Unlimited Extra® EL&quot;. Check your data plan.<p>The last thing you want is game-specific code in the kernel. That creates a whole new attack surface.</div><br/><div id="39937433" class="c"><input type="checkbox" id="c-39937433" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#39936199">parent</a><span>|</span><a href="#39936519">next</a><span>|</span><label class="collapse" for="c-39937433">[-]</label><label class="expand" for="c-39937433">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know about how well this solves any game programmer&#x27;s problem, but the attack surface thing --- modulo the kfunc trick --- doesn&#x27;t seem real: eBPF programs are ruthlessly verified, and most valid, safe C programs aren&#x27;t accepted (because the verifier can&#x27;t prove every loop in them is bounded and every memory access is provably bounded). It&#x27;s kind of an unlikely place to expect a vulnerability, just because the programming model is so simplistic.</div><br/></div></div><div id="39936519" class="c"><input type="checkbox" id="c-39936519" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39936199">parent</a><span>|</span><a href="#39937433">prev</a><span>|</span><a href="#39936351">next</a><span>|</span><label class="collapse" for="c-39936519">[-]</label><label class="expand" for="c-39936519">[6 more]</label></div><br/><div class="children"><div class="content">&gt; Actual traffic for a metaverse is mostly bulk content download. Highly interactive traffic over UDP is maybe 1MB&#x2F;second, including voice.<p>Typical bandwidth for multiplayer games like FPS (Counterstrike, Apex Legends) are around 512kbps-1mbit per-second down per-client, and this is old information, newer games almost certainly use more.<p>It&#x27;s easy to see a more high fidelity gaming experience taking 10mbit - 100mbit traffic from server to client, just increase the size and fidelity of the world. next, increase player counts and you can easily fill 10gbit&#x2F;sec for a future FPS&#x2F;MMO hybrid.<p>God save us from the egress BW costs though :)</div><br/><div id="39939902" class="c"><input type="checkbox" id="c-39939902" checked=""/><div class="controls bullet"><span class="by">geraldhh</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39936519">parent</a><span>|</span><a href="#39936815">next</a><span>|</span><label class="collapse" for="c-39939902">[-]</label><label class="expand" for="c-39939902">[1 more]</label></div><br/><div class="children"><div class="content">i venture a guess that there are still no online games that use more than one mbps for interactive traffic and seeing fully remote gaming using tens of mbps, i don&#x27;t see any justification for complexities like asset streaming.</div><br/></div></div><div id="39936815" class="c"><input type="checkbox" id="c-39936815" checked=""/><div class="controls bullet"><span class="by">Animats</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39936519">parent</a><span>|</span><a href="#39939902">prev</a><span>|</span><a href="#39936351">next</a><span>|</span><label class="collapse" for="c-39936815">[-]</label><label class="expand" for="c-39936815">[4 more]</label></div><br/><div class="children"><div class="content">There are only so many pixels on the screen, as Epic points out. The need for bandwidth is finite.<p>It will be interesting to see if Epic makes a streamed version of the Matrix Awakens demo. You can download that and build it. It&#x27;s about 1TB after decompression. If they can make that work with their asset streaming system, that will settle the question of what you really need from the network.</div><br/><div id="39937082" class="c"><input type="checkbox" id="c-39937082" checked=""/><div class="controls bullet"><span class="by">fluoridation</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39936815">parent</a><span>|</span><a href="#39936848">next</a><span>|</span><label class="collapse" for="c-39937082">[-]</label><label class="expand" for="c-39937082">[2 more]</label></div><br/><div class="children"><div class="content">But pixels can be arbitrarily &quot;deep&quot;. That is to say, the amount of context that is needed to figure out the color of a pixel can grow arbitrarily large.</div><br/><div id="39938328" class="c"><input type="checkbox" id="c-39938328" checked=""/><div class="controls bullet"><span class="by">Kamq</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39937082">parent</a><span>|</span><a href="#39936848">next</a><span>|</span><label class="collapse" for="c-39938328">[-]</label><label class="expand" for="c-39938328">[1 more]</label></div><br/><div class="children"><div class="content">Yes, but if it requires more data than the screen&#x27;s worth of pixels, you can just send the pixels. Pretty sure this is the &quot;cap&quot; that was described.</div><br/></div></div></div></div><div id="39936848" class="c"><input type="checkbox" id="c-39936848" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39936815">parent</a><span>|</span><a href="#39937082">prev</a><span>|</span><a href="#39936351">next</a><span>|</span><label class="collapse" for="c-39936848">[-]</label><label class="expand" for="c-39936848">[1 more]</label></div><br/><div class="children"><div class="content">You can&#x27;t client side predict pixels.</div><br/></div></div></div></div></div></div><div id="39936351" class="c"><input type="checkbox" id="c-39936351" checked=""/><div class="controls bullet"><span class="by">lisplist</span><span>|</span><a href="#39936199">parent</a><span>|</span><a href="#39936519">prev</a><span>|</span><a href="#39937243">next</a><span>|</span><label class="collapse" for="c-39936351">[-]</label><label class="expand" for="c-39936351">[2 more]</label></div><br/><div class="children"><div class="content">What is a metaverse client? Do you just mean a cross platform VR app?</div><br/><div id="39939765" class="c"><input type="checkbox" id="c-39939765" checked=""/><div class="controls bullet"><span class="by">sbierwagen</span><span>|</span><a href="#39936199">root</a><span>|</span><a href="#39936351">parent</a><span>|</span><a href="#39937243">next</a><span>|</span><label class="collapse" for="c-39939765">[-]</label><label class="expand" for="c-39939765">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a client for <a href="https:&#x2F;&#x2F;secondlife.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;secondlife.com&#x2F;</a></div><br/></div></div></div></div><div id="39937243" class="c"><input type="checkbox" id="c-39937243" checked=""/><div class="controls bullet"><span class="by">readyplayernull</span><span>|</span><a href="#39936199">parent</a><span>|</span><a href="#39936351">prev</a><span>|</span><a href="#39940067">next</a><span>|</span><label class="collapse" for="c-39937243">[-]</label><label class="expand" for="c-39937243">[1 more]</label></div><br/><div class="children"><div class="content">In games the problem isn&#x27;t about bandwidth but latency.</div><br/></div></div></div></div><div id="39940067" class="c"><input type="checkbox" id="c-39940067" checked=""/><div class="controls bullet"><span class="by">posix_monad</span><span>|</span><a href="#39936199">prev</a><span>|</span><a href="#39936659">next</a><span>|</span><label class="collapse" for="c-39940067">[-]</label><label class="expand" for="c-39940067">[1 more]</label></div><br/><div class="children"><div class="content">I was hoping a few code snippets.<p>So these mini kernel programs are written in a subset of C?</div><br/></div></div><div id="39936659" class="c"><input type="checkbox" id="c-39936659" checked=""/><div class="controls bullet"><span class="by">mondobe</span><span>|</span><a href="#39940067">prev</a><span>|</span><a href="#39936234">next</a><span>|</span><label class="collapse" for="c-39936659">[-]</label><label class="expand" for="c-39936659">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Within 10 years, everybody is going to have 10gbps internet. How will this change how games are made? How are we going to use all this bandwidth? 5v5 shooters just aren&#x27;t going to cut it anymore.<p>I have no doubt that more bandwidth will change how games are made, but 5v5 shooters (and pretty much all existing multiplayer styles) are here to stay for a lot longer than that, in some form or another.</div><br/></div></div><div id="39936234" class="c"><input type="checkbox" id="c-39936234" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936659">prev</a><span>|</span><a href="#39938726">next</a><span>|</span><label class="collapse" for="c-39936234">[-]</label><label class="expand" for="c-39936234">[17 more]</label></div><br/><div class="children"><div class="content">This article is plain ridiculous.<p>&gt; Why? Because otherwise, the overhead of processing each packet in the kernel and passing it down to user space and back up to the kernel and out to the NIC limits the throughput you can achieve. We&#x27;re talking 10gbps and above here.<p>_Throughpout_ is not problematic at all for the Linux network stack, even at 100gbps. What is problematic is &gt;10gbps line rate. In other words, unless you&#x27;re receiving 10gbps unshaped UDP datagrams with no payloads at line rate, the problem is non existant. Considering internet is 99% fat TCP packets, this sentence is completely absurd.<p>&gt; With other kernel bypass technologies like DPDK you needed to install a second NIC to run your program or basically implement (or license) an entire TCP&#x2F;IP network stack to make sure that everything works correctly under the hood<p>That is just wrong on so many levels.<p>First, DPDK allows reinjecting packets in the Linux network stack. That is called queue splitting,is done by the NIC, and can be trivially achieved using e.g. the bifurcated driver.<p>Second, there are plenty of available performant network stacks out there, especially considering high end NICs implement 80% of the performance sensitive parts of the stack on chip.<p>Last, kernel bypassing is made on _trusted private networks_, you would have to be crazy or damn well know what you&#x27;re doing to bypass on publicly addressable networks, otherwise you will have a bad reality check. There are decades of security checks and counter measures baked in the Linux network stack that a game would be irresponsible to ask his players to skip.<p>I&#x27;m not even mentioning the ridiculous latency gains to be achieved here. Wire tapping the packet &quot;NIC in&quot; to userspace buffer should be in the ballpark of 3us. If you think you can do better and this latency is too much for your application, you&#x27;re either day dreaming or you&#x27;re not working in the video game industry.</div><br/><div id="39936412" class="c"><input type="checkbox" id="c-39936412" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39936234">parent</a><span>|</span><a href="#39937416">next</a><span>|</span><label class="collapse" for="c-39936412">[-]</label><label class="expand" for="c-39936412">[11 more]</label></div><br/><div class="children"><div class="content">&gt; _Throughpout_ is not problematic at all for the Linux network stack, even at 100gbps. What is problematic is &gt;10gbps line rate. In other words, unless you&#x27;re receiving 10gbps unshaped UDP small datagrams at line rate, the problem is non existant. Considering internet is 99% fat TCP packets, this sentence is completely absurd.<p>But games are not 99% fat TCP packets.<p>Games are typically networked with UDP small datagrams sent at high rates for most recent state or inputs, with custom protocols built on top of UDP to avoid TCP head of line blocking. Packet send rates per-client can often exceed 60HZ, especially when games tie client packet send rate to the display frequency, eg. Valve and Apex Legends network models.<p>Now imagine you have many thousands of players and you can see that the problem does indeed exist. If not for current games, for future games and metaverse applications when we start to scale up the player counts from the typical 16, 32 or 64 players per-server instance, and try to merge something like FPS techniques with the scale of MMOs, which is actively something I&#x27;m actually doing.<p>XDP&#x2F;eBPF is a useful set of technologies for people who develop multiplayer games with custom UDP based protocols. You&#x27;ll see a lot more usage of this in the future moving forward, as player counts increase for multiplayer games, and other metaverse-like experiences.<p>Best wishes<p>- Glenn</div><br/><div id="39937214" class="c"><input type="checkbox" id="c-39937214" checked=""/><div class="controls bullet"><span class="by">nsguy</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39936412">parent</a><span>|</span><a href="#39937942">next</a><span>|</span><label class="collapse" for="c-39937214">[-]</label><label class="expand" for="c-39937214">[5 more]</label></div><br/><div class="children"><div class="content">A modern server class machine can push &quot;100Gbps&quot; through the entire Linux stack just fine. TCP or UDP. With standard packet sizes (e.g. 1500 bytes.) We do this where I work. Yes a long time ago 1Gbps was hard, you needed jumbo frames, then 10Gbps was hard, then 100Gbps was hard. Right now where we are seems to be you don&#x27;t need to do a kernel bypass unless you&#x27;re running multiple 100Gbps NICs - that&#x27;s an application where I&#x27;ve seen DPDK used in the wild.<p>EDIT: Might be some benefits in terms of latency through the stack and resource usage on the machine... But I don&#x27;t think 10Gbps is where the pain is for these either.</div><br/><div id="39937652" class="c"><input type="checkbox" id="c-39937652" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39937214">parent</a><span>|</span><a href="#39937942">next</a><span>|</span><label class="collapse" for="c-39937652">[-]</label><label class="expand" for="c-39937652">[4 more]</label></div><br/><div class="children"><div class="content">&gt; A modern server class machine can push &quot;100Gbps&quot; through the entire Linux stack just fine.<p>Maybe we&#x27;d like to use some of that CPU to run the game instead of pushing packets.<p>Maybe if we can push the packets more efficiently, we save $$$.<p>Maybe game servers get DDoS&#x27;d and it&#x27;s great to be able to quickly drop packets without any linux kernel overhead.</div><br/><div id="39939749" class="c"><input type="checkbox" id="c-39939749" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39937652">parent</a><span>|</span><a href="#39937942">next</a><span>|</span><label class="collapse" for="c-39939749">[-]</label><label class="expand" for="c-39939749">[3 more]</label></div><br/><div class="children"><div class="content">Maybe I would like my games to not access my kernel?<p>Maybe I would like my games to not bypass my firewall and VPN?<p>Also, eBPF is not a way to shave CPU cycles, you would use DPDK&#x2F;Netmap&#x2F;BSD BPF for that, it&#x27;s a way to lower latency. And we&#x27;re talking single digit microsecond latency, where a typical internet link has millisecond jitter.</div><br/><div id="39939850" class="c"><input type="checkbox" id="c-39939850" checked=""/><div class="controls bullet"><span class="by">mattnewport</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39939749">parent</a><span>|</span><a href="#39937942">next</a><span>|</span><label class="collapse" for="c-39939850">[-]</label><label class="expand" for="c-39939850">[2 more]</label></div><br/><div class="children"><div class="content">The use case is for dedicated game servers controlled by the developer running in data centers, not clients running on player&#x27;s home computers.</div><br/><div id="39939896" class="c"><input type="checkbox" id="c-39939896" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39939850">parent</a><span>|</span><a href="#39937942">next</a><span>|</span><label class="collapse" for="c-39939896">[-]</label><label class="expand" for="c-39939896">[1 more]</label></div><br/><div class="children"><div class="content">If we&#x27;re talking server tech then why does the article claim that 10gbps is becoming retail commodity? 10,40 and 100gbps is already the baseline for servers since a decade, I have not seen a server with 1gbps NICs for anything else than remote management or off band communication in a decade.<p>If it&#x27;s for servers then the article still doesn&#x27;t make any sense. See my other comment <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39939876">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39939876</a></div><br/></div></div></div></div></div></div></div></div></div></div><div id="39936469" class="c"><input type="checkbox" id="c-39936469" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39936412">parent</a><span>|</span><a href="#39937942">prev</a><span>|</span><a href="#39939632">next</a><span>|</span><label class="collapse" for="c-39936469">[-]</label><label class="expand" for="c-39936469">[2 more]</label></div><br/><div class="children"><div class="content">&gt; First, DPDK allows reinjecting packets in the Linux network stack. That is called queue splitting,is done by the NIC, and can be trivially achieved using e.g. the bifurcated driver.<p>My apologies, the last time I looked at DPDK was in 2016, and I don&#x27;t believe this was true back then. Either way, it seems that XDP&#x2F;eBPF is much easier to use. YMMV!</div><br/><div id="39939814" class="c"><input type="checkbox" id="c-39939814" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39936469">parent</a><span>|</span><a href="#39939632">next</a><span>|</span><label class="collapse" for="c-39939814">[-]</label><label class="expand" for="c-39939814">[1 more]</label></div><br/><div class="children"><div class="content">No harm taken, kernel bypass technologies have moved fast in the last decade.<p>As a side note though, I would encourage you to revisit DPDK. I&#x27;ve worked in the low latency space for a long time, and used pretty much every solution out there, open source or proprietary, and DPDK is one of my favorite.<p>This is because DPDK is not _just_ poll mode drivers, it&#x27;s a a full featured SDK for low latency packet processing. You get top notch thread safe memory pools to store packets, thread safe queues, hand written intrinsics optimized hashing and CRC algos, a cooperative scheduler in case you isolate your CPUs, etc, etc.</div><br/></div></div></div></div><div id="39939632" class="c"><input type="checkbox" id="c-39939632" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39936412">parent</a><span>|</span><a href="#39936469">prev</a><span>|</span><a href="#39936518">next</a><span>|</span><label class="collapse" for="c-39939632">[-]</label><label class="expand" for="c-39939632">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Packet send rates per-client can often exceed 60HZ<p>You do realize the most random Python program, written by the most random programmer, running on the most random computer, could easily read 10k TCP packets per second per core?</div><br/></div></div></div></div><div id="39937416" class="c"><input type="checkbox" id="c-39937416" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#39936234">parent</a><span>|</span><a href="#39936412">prev</a><span>|</span><a href="#39940024">next</a><span>|</span><label class="collapse" for="c-39937416">[-]</label><label class="expand" for="c-39937416">[2 more]</label></div><br/><div class="children"><div class="content">I feel like I&#x27;m reasonably well read into low-level TCP&#x2F;IP security (also: eBPF) and I&#x27;m not sure what you mean by &quot;decades of security checks and countermeasures baked into the Linux network stack&quot; than an XDP kernel bypass would skip. Can you say more?</div><br/><div id="39939488" class="c"><input type="checkbox" id="c-39939488" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39937416">parent</a><span>|</span><a href="#39940024">next</a><span>|</span><label class="collapse" for="c-39939488">[-]</label><label class="expand" for="c-39939488">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I&#x27;m reasonably well read into low-level TCP&#x2F;IP security
&gt; I&#x27;m not sure what you mean by &quot;decades of security checks and countermeasures baked into the Linux network stack&quot; than an XDP kernel bypass would skip. Can you say more?<p>If you bypass the kernel stack on an publicly addressable network, then it is your responsibility to implement and calibrate backloging, handshake recycling, SYN cookies</div><br/></div></div></div></div><div id="39940024" class="c"><input type="checkbox" id="c-39940024" checked=""/><div class="controls bullet"><span class="by">cornel_io</span><span>|</span><a href="#39936234">parent</a><span>|</span><a href="#39937416">prev</a><span>|</span><a href="#39936995">next</a><span>|</span><label class="collapse" for="c-39940024">[-]</label><label class="expand" for="c-39940024">[1 more]</label></div><br/><div class="children"><div class="content">Are you under the impression that he was talking about game <i>clients</i> doing this? That would be absurd, since no gamers (within epsilon of zero) use Linux, and you&#x27;d need a completely different bag of tricks on Windows.<p>He&#x27;s fully focused on the backend.</div><br/></div></div><div id="39936995" class="c"><input type="checkbox" id="c-39936995" checked=""/><div class="controls bullet"><span class="by">ncallaway</span><span>|</span><a href="#39936234">parent</a><span>|</span><a href="#39940024">prev</a><span>|</span><a href="#39938726">next</a><span>|</span><label class="collapse" for="c-39936995">[-]</label><label class="expand" for="c-39936995">[2 more]</label></div><br/><div class="children"><div class="content">&gt; In other words, unless you&#x27;re receiving 10gbps unshaped UDP datagrams with no payloads at line rate, the problem is non existant. Considering internet is 99% fat TCP packets, this sentence is completely absurd.<p>Uh, &quot;the internet&quot; traffic shape is a <i>terrible</i> model for low-latency multiplayer games traffic shape. Surely you don&#x27;t think that 99% of the packets being exchanged during a session of Counter-Strike 2 are fat TCP packets, right?</div><br/><div id="39939576" class="c"><input type="checkbox" id="c-39939576" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39936234">root</a><span>|</span><a href="#39936995">parent</a><span>|</span><a href="#39938726">next</a><span>|</span><label class="collapse" for="c-39939576">[-]</label><label class="expand" for="c-39939576">[1 more]</label></div><br/><div class="children"><div class="content">Surely not, but I don&#x27;t expect a video game datagram size and rate to be anywhere near line rate. To put things in perspective, we are talking ~1M datagrams per seconds on a 1gbps link, 10M dgps on a 10gbps link.<p>Hell, I don&#x27;t even think a commodity gaming computer have enough cores to process line rate datagrams on a 1gbps link.</div><br/></div></div></div></div></div></div><div id="39938726" class="c"><input type="checkbox" id="c-39938726" checked=""/><div class="controls bullet"><span class="by">10000truths</span><span>|</span><a href="#39936234">prev</a><span>|</span><a href="#39937915">next</a><span>|</span><label class="collapse" for="c-39938726">[-]</label><label class="expand" for="c-39938726">[2 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t need to create your own kernel modules to define custom packet processing logic. You can map an RX&#x2F;TX ring into userspace memory by invoking setsockopt on your XDP socket with the XDP_RX_RING, XDP_TX_RING and XDP_UMEM_REG options. Your XDP BPF program can then choose to redirect an incoming packet to the RX ring (see BPF_MAP_TYPE_XSKMAP).</div><br/><div id="39938779" class="c"><input type="checkbox" id="c-39938779" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#39938726">parent</a><span>|</span><a href="#39937915">next</a><span>|</span><label class="collapse" for="c-39938779">[-]</label><label class="expand" for="c-39938779">[1 more]</label></div><br/><div class="children"><div class="content">What I think you&#x27;re describing here is AF_XDP (just for a simpler search term).</div><br/></div></div></div></div><div id="39937915" class="c"><input type="checkbox" id="c-39937915" checked=""/><div class="controls bullet"><span class="by">cookiengineer</span><span>|</span><a href="#39938726">prev</a><span>|</span><a href="#39935644">next</a><span>|</span><label class="collapse" for="c-39937915">[-]</label><label class="expand" for="c-39937915">[5 more]</label></div><br/><div class="children"><div class="content">Ah yes, the golden age of eBPF malware has begun.<p>Game programmers don&#x27;t need eBPF, at all. If they do, they aren&#x27;t game programmers.<p>eBPF is not only a violation of user trust, it&#x27;s a compromise of everything they have running on their system. If you intercept via XDP, you have to account for every single packet corruption scenario. And that test suite is likely never finished nor stable.<p>I&#x27;m waiting for distro maintainers to disable eBPF by default for their kernel packages because of how eBPF is abused in the wild. I&#x27;ve seen multiple rootkits and bots ready to use, working on any modern linux system.<p>And there&#x27;s literally nothing you can do, it&#x27;s a privilege escalation nightmare and a whole new attack surface to cover , which not even auditd can do squats about.<p>The bpftool maintainer tells you to learn the bytecode, so approaching them with this kind of problem is useless. In their world anybody using eBPF has full system administration rights.<p>It&#x27;s an operational security nightmare.</div><br/><div id="39937982" class="c"><input type="checkbox" id="c-39937982" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39937915">parent</a><span>|</span><a href="#39935644">next</a><span>|</span><label class="collapse" for="c-39937982">[-]</label><label class="expand" for="c-39937982">[4 more]</label></div><br/><div class="children"><div class="content">The eBPF code runs on the game server not the client. Cool story tho</div><br/><div id="39939876" class="c"><input type="checkbox" id="c-39939876" checked=""/><div class="controls bullet"><span class="by">Galanwe</span><span>|</span><a href="#39937915">root</a><span>|</span><a href="#39937982">parent</a><span>|</span><a href="#39938145">next</a><span>|</span><label class="collapse" for="c-39939876">[-]</label><label class="expand" for="c-39939876">[1 more]</label></div><br/><div class="children"><div class="content">If you want to use kernel bypass on the server, not the client, then XDP is even more useless. Because on the server world, you have access to professional NICs that you cannot expect clients to have.<p>It&#x27;s been decades now that people routinely do kernel bypass on servers using e. g. Solarflare NICs with OnLoad. You just write your networking code normally using BSD sockets API, and LD_PRELOAD the OnLoad SDK which will intercept the socket API and perform a bypass. You get 90% of the latency benefits of kernel bypass without modifying your code, which still runs everywhere.</div><br/></div></div><div id="39938145" class="c"><input type="checkbox" id="c-39938145" checked=""/><div class="controls bullet"><span class="by">cookiengineer</span><span>|</span><a href="#39937915">root</a><span>|</span><a href="#39937982">parent</a><span>|</span><a href="#39939876">prev</a><span>|</span><a href="#39935644">next</a><span>|</span><label class="collapse" for="c-39938145">[-]</label><label class="expand" for="c-39938145">[2 more]</label></div><br/><div class="children"><div class="content">Doesn&#x27;t mean you should risk a takeover of all your game databases because you decided to bypass every single security measurement linux has in place already.<p>I&#x27;d argue it&#x27;s even worse, and network programming wise I&#x27;d argue that every custom implementation of TCP&#x2F;UDP was broken in the past and lead to a lot of remote exploits, and eventually was abandoned due to maintenance costs.<p>Just think about the shitshow of the source engine, for example. RCE&#x27;ing in the wild for what, 14+ years now? Took a long while and a lot of steam runtime sandboxing code to fix the decision to use a custom unsafe networking code.</div><br/><div id="39938754" class="c"><input type="checkbox" id="c-39938754" checked=""/><div class="controls bullet"><span class="by">tptacek</span><span>|</span><a href="#39937915">root</a><span>|</span><a href="#39938145">parent</a><span>|</span><a href="#39935644">next</a><span>|</span><label class="collapse" for="c-39938754">[-]</label><label class="expand" for="c-39938754">[1 more]</label></div><br/><div class="children"><div class="content">What takeover risk? What security measurements is eBPF bypassing? How are you imagining getting RCE from a compiled eBPF packet processor?</div><br/></div></div></div></div></div></div></div></div><div id="39935644" class="c"><input type="checkbox" id="c-39935644" checked=""/><div class="controls bullet"><span class="by">hobs</span><span>|</span><a href="#39937915">prev</a><span>|</span><a href="#39937556">next</a><span>|</span><label class="collapse" for="c-39935644">[-]</label><label class="expand" for="c-39935644">[11 more]</label></div><br/><div class="children"><div class="content">&gt; Within 10 years, everybody is going to have 10gbps internet<p>LOL, no way in America is that going to be true.</div><br/><div id="39939571" class="c"><input type="checkbox" id="c-39939571" checked=""/><div class="controls bullet"><span class="by">voidUpdate</span><span>|</span><a href="#39935644">parent</a><span>|</span><a href="#39937390">next</a><span>|</span><label class="collapse" for="c-39939571">[-]</label><label class="expand" for="c-39939571">[3 more]</label></div><br/><div class="children"><div class="content">I live on the outskirts of a city in the middle of England and I &#x2F;very&#x2F; much doubt I&#x27;ll see 10gig in 10 years</div><br/><div id="39939655" class="c"><input type="checkbox" id="c-39939655" checked=""/><div class="controls bullet"><span class="by">fragmede</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39939571">parent</a><span>|</span><a href="#39937390">next</a><span>|</span><label class="collapse" for="c-39939655">[-]</label><label class="expand" for="c-39939655">[2 more]</label></div><br/><div class="children"><div class="content">What if that kind of bandwidth becomes available over cell networks?</div><br/><div id="39939893" class="c"><input type="checkbox" id="c-39939893" checked=""/><div class="controls bullet"><span class="by">voidUpdate</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39939655">parent</a><span>|</span><a href="#39937390">next</a><span>|</span><label class="collapse" for="c-39939893">[-]</label><label class="expand" for="c-39939893">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve restricted my phone to only using 4G because I&#x27;ve had a lot of problems with 5G feeling a lot slower than 4G. I&#x27;ve not done any quantitative testing on it but it just generally feels a lot slower, even when I&#x27;m looking right at the 5G mast, and the 4G mast is behind a few buildings. If whatever problem it&#x27;s having can be fixed, and it can be priced similarly to broadband, then maybe</div><br/></div></div></div></div></div></div><div id="39937390" class="c"><input type="checkbox" id="c-39937390" checked=""/><div class="controls bullet"><span class="by">_carbyau_</span><span>|</span><a href="#39935644">parent</a><span>|</span><a href="#39939571">prev</a><span>|</span><a href="#39935671">next</a><span>|</span><label class="collapse" for="c-39937390">[-]</label><label class="expand" for="c-39937390">[3 more]</label></div><br/><div class="children"><div class="content">Meanwhile in the rest of the world it is ALSO not true.<p>That opening blanket statement turned me off so hard I couldn&#x27;t get past that paragraph to read the rest of the article.<p>I am struggling to justify 10Gb LAN in my house. Between purchase costs and energy requirements (some 10Gb arrangements seem to be crazy inefficient). And I <i>like</i> &quot;more, more, faster, faster&quot; in my tech.<p>How does this scale (and cost) across even a significant section of human society?!? According to the article&#x27;s prediction things must get crazy soon.</div><br/><div id="39937662" class="c"><input type="checkbox" id="c-39937662" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39937390">parent</a><span>|</span><a href="#39935671">next</a><span>|</span><label class="collapse" for="c-39937662">[-]</label><label class="expand" for="c-39937662">[2 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.nngroup.com&#x2F;articles&#x2F;law-of-bandwidth&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.nngroup.com&#x2F;articles&#x2F;law-of-bandwidth&#x2F;</a></div><br/><div id="39938570" class="c"><input type="checkbox" id="c-39938570" checked=""/><div class="controls bullet"><span class="by">_carbyau_</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39937662">parent</a><span>|</span><a href="#39935671">next</a><span>|</span><label class="collapse" for="c-39938570">[-]</label><label class="expand" for="c-39938570">[1 more]</label></div><br/><div class="children"><div class="content">An interesting article.<p>Given it applies to &quot;A high-end user&#x27;s connection speed&quot; I am dubious as to the applicability to everyone else - say the bottom 20% of society for example - and so I am most doubtful of the article&#x27;s &quot;everyone will have 10Gbit&quot; claim.<p>Maybe &quot;everyone&quot; has a stricter definition than I think.<p>But as someone who has literally grown up alongside PC&#x27;s - your link gives confidence to look forward to the crazy ahead. :-)</div><br/></div></div></div></div></div></div><div id="39935671" class="c"><input type="checkbox" id="c-39935671" checked=""/><div class="controls bullet"><span class="by">gafferongames</span><span>|</span><a href="#39935644">parent</a><span>|</span><a href="#39937390">prev</a><span>|</span><a href="#39935932">next</a><span>|</span><label class="collapse" for="c-39935671">[-]</label><label class="expand" for="c-39935671">[3 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;www.cablelabs.com&#x2F;10g" rel="nofollow">https:&#x2F;&#x2F;www.cablelabs.com&#x2F;10g</a></div><br/><div id="39935729" class="c"><input type="checkbox" id="c-39935729" checked=""/><div class="controls bullet"><span class="by">hobs</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39935671">parent</a><span>|</span><a href="#39935932">next</a><span>|</span><label class="collapse" for="c-39935729">[-]</label><label class="expand" for="c-39935729">[2 more]</label></div><br/><div class="children"><div class="content">Is this supposed to be a joke? 
I cant even reliably get 1G in most places.</div><br/><div id="39935937" class="c"><input type="checkbox" id="c-39935937" checked=""/><div class="controls bullet"><span class="by">hansvm</span><span>|</span><a href="#39935644">root</a><span>|</span><a href="#39935729">parent</a><span>|</span><a href="#39935932">next</a><span>|</span><label class="collapse" for="c-39935937">[-]</label><label class="expand" for="c-39935937">[1 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t get 0.05G reliably in most suburbs, even when I do the worst-case ping in a typical 10-minute window is 500+ms, and there are still many places in the US where the best internet I can find is under 0.001G.</div><br/></div></div></div></div></div></div></div></div><div id="39937556" class="c"><input type="checkbox" id="c-39937556" checked=""/><div class="controls bullet"><span class="by">jay_kyburz</span><span>|</span><a href="#39935644">prev</a><span>|</span><a href="#39933661">next</a><span>|</span><label class="collapse" for="c-39937556">[-]</label><label class="expand" for="c-39937556">[1 more]</label></div><br/><div class="children"><div class="content">Hello from Canberra Glenn!</div><br/></div></div></div></div></div></div></div></body></html>