<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1727082072545" as="style"/><link rel="stylesheet" href="styles.css?v=1727082072545"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://keleshev.com/compiling-to-assembly-from-scratch">Compiling to Assembly from Scratch</a> <span class="domain">(<a href="https://keleshev.com">keleshev.com</a>)</span></div><div class="subtext"><span>AlexeyBrin</span> | <span>26 comments</span></div><br/><div><div id="41622327" class="c"><input type="checkbox" id="c-41622327" checked=""/><div class="controls bullet"><span class="by">hirvi74</span><span>|</span><a href="#41623652">next</a><span>|</span><label class="collapse" for="c-41622327">[-]</label><label class="expand" for="c-41622327">[9 more]</label></div><br/><div class="children"><div class="content">God, the title reminds me of when I when I took an x86 assembly class in college about a decade ago. Only 6 of the dumbest souls in the CS program dared to take the class the semester.  The professor for the class was an ex-NASA computer engineer. Our test used to be writing assembly <i>by hand.</i> We were graded for accuracy too. I swear, at that point in time, I could convert between Hex, Dec, Oct, and Binary almost without thinking. I made a D in class with 40+ hours a week of studying. However, I learned more in that one class than my entire degree.<p>Anyway, thank you, OP,  for sharing this. I have been looking into picking up ARM as way to crawl out of burnout from my career. It&#x27;s been a years since I even touched x86 with any seriousness. I will add this book to my list resources.</div><br/><div id="41622552" class="c"><input type="checkbox" id="c-41622552" checked=""/><div class="controls bullet"><span class="by">alok-g</span><span>|</span><a href="#41622327">parent</a><span>|</span><a href="#41623652">next</a><span>|</span><label class="collapse" for="c-41622552">[-]</label><label class="expand" for="c-41622552">[8 more]</label></div><br/><div class="children"><div class="content">Ever tried writing machine code (not assembly) by hand?  I used to do that a few decades back for an 8-bit microprocessor.  I am still looking for good resources on how to do that for a modern processor.</div><br/><div id="41623707" class="c"><input type="checkbox" id="c-41623707" checked=""/><div class="controls bullet"><span class="by">tomcam</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41622552">parent</a><span>|</span><a href="#41622830">next</a><span>|</span><label class="collapse" for="c-41623707">[-]</label><label class="expand" for="c-41623707">[1 more]</label></div><br/><div class="children"><div class="content">I’ve told this before, but it’s so amazing I like to give Tim credit. I worked on Visual Basic at Microsoft with Tim Paterson, who also created the operating system that became MS-DOS. He worked on code generation and debugged by looking at the opcodes in a hex dump. Assembly was too slow for him him.</div><br/></div></div><div id="41622830" class="c"><input type="checkbox" id="c-41622830" checked=""/><div class="controls bullet"><span class="by">ReleaseCandidat</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41622552">parent</a><span>|</span><a href="#41623707">prev</a><span>|</span><a href="#41623674">next</a><span>|</span><label class="collapse" for="c-41622830">[-]</label><label class="expand" for="c-41622830">[2 more]</label></div><br/><div class="children"><div class="content">You look up the opcodes for each assembler instructions in the ISA specifications, like <a href="https:&#x2F;&#x2F;www2.eecs.berkeley.edu&#x2F;Pubs&#x2F;TechRpts&#x2F;2016&#x2F;EECS-2016-118.pdf" rel="nofollow">https:&#x2F;&#x2F;www2.eecs.berkeley.edu&#x2F;Pubs&#x2F;TechRpts&#x2F;2016&#x2F;EECS-2016-...</a>. Information about the machine code format starts at &quot;2.2 Base Instruction Formats&quot;. The actual opcodes you can find in chapter 9,&quot;RV32&#x2F;64G Instruction Set Listings&quot;.
But be aware that some assembler instructions (called e.g. pseudo instructions) generate more than one.<p>The linked document is an old one, current ones are at <a href="https:&#x2F;&#x2F;riscv.org&#x2F;technical&#x2F;specifications&#x2F;" rel="nofollow">https:&#x2F;&#x2F;riscv.org&#x2F;technical&#x2F;specifications&#x2F;</a></div><br/><div id="41623789" class="c"><input type="checkbox" id="c-41623789" checked=""/><div class="controls bullet"><span class="by">alok-g</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41622830">parent</a><span>|</span><a href="#41623674">next</a><span>|</span><label class="collapse" for="c-41623789">[-]</label><label class="expand" for="c-41623789">[1 more]</label></div><br/><div class="children"><div class="content">Awesome!  Thanks!</div><br/></div></div></div></div><div id="41623674" class="c"><input type="checkbox" id="c-41623674" checked=""/><div class="controls bullet"><span class="by">eterps</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41622552">parent</a><span>|</span><a href="#41622830">prev</a><span>|</span><a href="#41623652">next</a><span>|</span><label class="collapse" for="c-41623674">[-]</label><label class="expand" for="c-41623674">[4 more]</label></div><br/><div class="children"><div class="content">You should definitely look at: <a href="https:&#x2F;&#x2F;github.com&#x2F;akkartik&#x2F;mu&#x2F;blob&#x2F;main&#x2F;subx.md">https:&#x2F;&#x2F;github.com&#x2F;akkartik&#x2F;mu&#x2F;blob&#x2F;main&#x2F;subx.md</a></div><br/><div id="41623699" class="c"><input type="checkbox" id="c-41623699" checked=""/><div class="controls bullet"><span class="by">eterps</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41623674">parent</a><span>|</span><a href="#41623785">next</a><span>|</span><label class="collapse" for="c-41623699">[-]</label><label class="expand" for="c-41623699">[2 more]</label></div><br/><div class="children"><div class="content">Also, running machine code directly can be done like this:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;eterps&#x2F;loader&#x2F;blob&#x2F;master&#x2F;syscall.nim">https:&#x2F;&#x2F;github.com&#x2F;eterps&#x2F;loader&#x2F;blob&#x2F;master&#x2F;syscall.nim</a></div><br/><div id="41623774" class="c"><input type="checkbox" id="c-41623774" checked=""/><div class="controls bullet"><span class="by">alok-g</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41623699">parent</a><span>|</span><a href="#41623785">next</a><span>|</span><label class="collapse" for="c-41623774">[-]</label><label class="expand" for="c-41623774">[1 more]</label></div><br/><div class="children"><div class="content">This is cool!  This is how I used to do also by embedding hand-written machine code within a BASIC program and calling it to run natively.</div><br/></div></div></div></div><div id="41623785" class="c"><input type="checkbox" id="c-41623785" checked=""/><div class="controls bullet"><span class="by">alok-g</span><span>|</span><a href="#41622327">root</a><span>|</span><a href="#41623674">parent</a><span>|</span><a href="#41623699">prev</a><span>|</span><a href="#41623652">next</a><span>|</span><label class="collapse" for="c-41623785">[-]</label><label class="expand" for="c-41623785">[1 more]</label></div><br/><div class="children"><div class="content">SubX seems like an assembly language itself following a subset of x86 32-bit instructions.  Would looking into this help me understand how to translate from assembly to machine code manually?  Thanks.</div><br/></div></div></div></div></div></div></div></div><div id="41623652" class="c"><input type="checkbox" id="c-41623652" checked=""/><div class="controls bullet"><span class="by">evnix</span><span>|</span><a href="#41622327">prev</a><span>|</span><a href="#41621469">next</a><span>|</span><label class="collapse" for="c-41623652">[-]</label><label class="expand" for="c-41623652">[1 more]</label></div><br/><div class="children"><div class="content">I really liked how short and concise these chapters are. What took me months of effort  has been condensed to these few chapters and It&#x27;s well worth the read.<p>Though Why use 32bit instead of 64, why add so much friction for a first time learner.</div><br/></div></div><div id="41621469" class="c"><input type="checkbox" id="c-41621469" checked=""/><div class="controls bullet"><span class="by">ggorlen</span><span>|</span><a href="#41623652">prev</a><span>|</span><a href="#41620245">next</a><span>|</span><label class="collapse" for="c-41621469">[-]</label><label class="expand" for="c-41621469">[6 more]</label></div><br/><div class="children"><div class="content">As is often the case, the title is unfortunately overloaded. I initially read this as writing code in the Scratch programming language[1] that compiles to assembly.<p>[1]: <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Scratch_(programming_language)" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Scratch_(programming_language)</a></div><br/><div id="41622378" class="c"><input type="checkbox" id="c-41622378" checked=""/><div class="controls bullet"><span class="by">userbinator</span><span>|</span><a href="#41621469">parent</a><span>|</span><a href="#41622961">next</a><span>|</span><label class="collapse" for="c-41622378">[-]</label><label class="expand" for="c-41622378">[1 more]</label></div><br/><div class="children"><div class="content">Given that we&#x27;ve seen things like C compilers written in Bash[1] and TLS libraries in Visual Basic[2], I think it&#x27;s only a matter of time before someone with the right skills and motivation actually does it (or writes a compiler for $language <i>in</i> Scratch).<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;otakuto&#x2F;bashcc">https:&#x2F;&#x2F;github.com&#x2F;otakuto&#x2F;bashcc</a><p>[2] <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35882985">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35882985</a></div><br/></div></div><div id="41622961" class="c"><input type="checkbox" id="c-41622961" checked=""/><div class="controls bullet"><span class="by">ithkuil</span><span>|</span><a href="#41621469">parent</a><span>|</span><a href="#41622378">prev</a><span>|</span><a href="#41622400">next</a><span>|</span><label class="collapse" for="c-41622961">[-]</label><label class="expand" for="c-41622961">[1 more]</label></div><br/><div class="children"><div class="content">Ironically the word &quot;overloaded&quot; is overloaded too.</div><br/></div></div><div id="41622400" class="c"><input type="checkbox" id="c-41622400" checked=""/><div class="controls bullet"><span class="by">__MatrixMan__</span><span>|</span><a href="#41621469">parent</a><span>|</span><a href="#41622961">prev</a><span>|</span><a href="#41621992">next</a><span>|</span><label class="collapse" for="c-41622400">[-]</label><label class="expand" for="c-41622400">[1 more]</label></div><br/><div class="children"><div class="content">Me also. The actual thing is probably pretty cool, but now that my hopes were up I&#x27;m finding it insufficiently whimsical.</div><br/></div></div><div id="41621931" class="c"><input type="checkbox" id="c-41621931" checked=""/><div class="controls bullet"><span class="by">MiguelX413</span><span>|</span><a href="#41621469">parent</a><span>|</span><a href="#41621992">prev</a><span>|</span><a href="#41620245">next</a><span>|</span><label class="collapse" for="c-41621931">[-]</label><label class="expand" for="c-41621931">[1 more]</label></div><br/><div class="children"><div class="content">I also misunderstood it in that manner.</div><br/></div></div></div></div><div id="41620245" class="c"><input type="checkbox" id="c-41620245" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#41621469">prev</a><span>|</span><a href="#41623036">next</a><span>|</span><label class="collapse" for="c-41620245">[-]</label><label class="expand" for="c-41620245">[1 more]</label></div><br/><div class="children"><div class="content">I got the ebook when it came out, and is relatively nice as ramp up into the world of compiler development.</div><br/></div></div><div id="41623036" class="c"><input type="checkbox" id="c-41623036" checked=""/><div class="controls bullet"><span class="by">neuroelectron</span><span>|</span><a href="#41620245">prev</a><span>|</span><a href="#41620629">next</a><span>|</span><label class="collapse" for="c-41623036">[-]</label><label class="expand" for="c-41623036">[2 more]</label></div><br/><div class="children"><div class="content">Ctrl-F &quot;bootstrap&quot; zero hits. That seems strange.</div><br/><div id="41623275" class="c"><input type="checkbox" id="c-41623275" checked=""/><div class="controls bullet"><span class="by">ReleaseCandidat</span><span>|</span><a href="#41623036">parent</a><span>|</span><a href="#41620629">next</a><span>|</span><label class="collapse" for="c-41623275">[-]</label><label class="expand" for="c-41623275">[1 more]</label></div><br/><div class="children"><div class="content">For a &quot;first&quot; compiler? No, not at all.</div><br/></div></div></div></div><div id="41620629" class="c"><input type="checkbox" id="c-41620629" checked=""/><div class="controls bullet"><span class="by">stonethrowaway</span><span>|</span><a href="#41623036">prev</a><span>|</span><label class="collapse" for="c-41620629">[-]</label><label class="expand" for="c-41620629">[6 more]</label></div><br/><div class="children"><div class="content">Speaking of embedded systems, I have an old board, an offshoot of Zilog Z80 called Rabbit. I think recently Dave from EEVBlog took apart one of his ancient projects and I was floored to see a Rabbit. Talk about a left hook. Assuming this is Hacker News, I suspect someone probably knows what I’m talking about. The language used (called “Dynamic C”) has some unconventional additions, a kind of coroutine mechanism in addition to chaining functions to be called one after another in groups. It’s mostly C otherwise, so I suspect some macro shennanigans with interrupt vector priority for managing this coroutine stuff.<p>Anyhow, so I’ve got a bunch of .bin files around for it, no C source code, just straight assembly output ready to be flashed. And the text and data segments are often interwoven, each fetch being resolved to data or instruction in real time by the rabbit processor. So I’ve been thinking of sitting down, going through the assembly&#x2F;processor manual for the board and just writing a board simulator hoping to get it back to source code by blackbox reversing in a sense. I’d have to rummage through JEDEC for the standard used by the EEPROM to figure out what pins it’s using there and the edge triggering sequences. Once I can execute it and see what registers and  GPIOs are written when, I can probably figure out the original code path. Not sure if anyone has tips or guides or suggestions here.</div><br/><div id="41620775" class="c"><input type="checkbox" id="c-41620775" checked=""/><div class="controls bullet"><span class="by">Something1234</span><span>|</span><a href="#41620629">parent</a><span>|</span><label class="collapse" for="c-41620775">[-]</label><label class="expand" for="c-41620775">[5 more]</label></div><br/><div class="children"><div class="content">Any chance a decompiler like ghidra might get you part ways there?</div><br/><div id="41620794" class="c"><input type="checkbox" id="c-41620794" checked=""/><div class="controls bullet"><span class="by">stonethrowaway</span><span>|</span><a href="#41620629">root</a><span>|</span><a href="#41620775">parent</a><span>|</span><label class="collapse" for="c-41620794">[-]</label><label class="expand" for="c-41620794">[4 more]</label></div><br/><div class="children"><div class="content">The closest I came across was a Z80 simulator, I forget the name of it. But it allowed you to step through command by command giving you ability to query the processor state in a terminal.<p>So I don’t know if it would be easier trying to find this, and updating it to support rabbit, vs trying to wedge something into ghidra which itself is an undertaking of a behemoth platform. As far as I know ghidra does not have Z80 support.</div><br/><div id="41620906" class="c"><input type="checkbox" id="c-41620906" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#41620629">root</a><span>|</span><a href="#41620794">parent</a><span>|</span><a href="#41621407">next</a><span>|</span><label class="collapse" for="c-41620906">[-]</label><label class="expand" for="c-41620906">[1 more]</label></div><br/><div class="children"><div class="content">Ghidra has Z80 support (based on the installation on my laptop), but I&#x27;ve never used it.</div><br/></div></div><div id="41621407" class="c"><input type="checkbox" id="c-41621407" checked=""/><div class="controls bullet"><span class="by">stonethrowaway</span><span>|</span><a href="#41620629">root</a><span>|</span><a href="#41620794">parent</a><span>|</span><a href="#41620906">prev</a><span>|</span><a href="#41620919">next</a><span>|</span><label class="collapse" for="c-41621407">[-]</label><label class="expand" for="c-41621407">[1 more]</label></div><br/><div class="children"><div class="content">Ended up answering my own question. The Z88-DK[0] seems to be what I found. It supports most Rabbit processors, so I ran one of binaries through it and it spat out assembly my way which seems to make sense. Will have to run it through the simulator and see if I can get it to act like a microcontroller with setting voltage levels on particular pins.<p>[0] <a href="https:&#x2F;&#x2F;github.com&#x2F;z88dk&#x2F;z88dk">https:&#x2F;&#x2F;github.com&#x2F;z88dk&#x2F;z88dk</a></div><br/></div></div><div id="41620919" class="c"><input type="checkbox" id="c-41620919" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#41620629">root</a><span>|</span><a href="#41620794">parent</a><span>|</span><a href="#41621407">prev</a><span>|</span><label class="collapse" for="c-41620919">[-]</label><label class="expand" for="c-41620919">[1 more]</label></div><br/><div class="children"><div class="content">An Emu86.assembler.virtual_machine.Z8Machine (like MIPSMachine, RISCVMachine, and IntelMachine) could be stepped through in a notebook: 
<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=41576922">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=41576922</a></div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>