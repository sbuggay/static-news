<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1706259658538" as="style"/><link rel="stylesheet" href="styles.css?v=1706259658538"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.rorvswild.com/blog/2024/ruby-on-rails-load-testing-habits">Ruby on Rails load testing habits</a> <span class="domain">(<a href="https://www.rorvswild.com">www.rorvswild.com</a>)</span></div><div class="subtext"><span>a12b</span> | <span>15 comments</span></div><br/><div><div id="39139603" class="c"><input type="checkbox" id="c-39139603" checked=""/><div class="controls bullet"><span class="by">Hendrikto</span><span>|</span><a href="#39139027">next</a><span>|</span><label class="collapse" for="c-39139603">[-]</label><label class="expand" for="c-39139603">[5 more]</label></div><br/><div class="children"><div class="content">&gt; If the application can’t saturate the CPU, there’s a fundamental problem. It’s a shame because it makes adding more servers less efficient. Money is being wasted on hosting costs, and this should be a priority to address.<p>Talking about efficiency being a priority, but using RoR. I guess that is one way of saturating the CPU.</div><br/><div id="39139643" class="c"><input type="checkbox" id="c-39139643" checked=""/><div class="controls bullet"><span class="by">stouset</span><span>|</span><a href="#39139603">parent</a><span>|</span><a href="#39139741">next</a><span>|</span><label class="collapse" for="c-39139643">[-]</label><label class="expand" for="c-39139643">[2 more]</label></div><br/><div class="children"><div class="content">If your application can’t saturate the CPU, Rails probably isn’t your bottleneck.</div><br/></div></div><div id="39139741" class="c"><input type="checkbox" id="c-39139741" checked=""/><div class="controls bullet"><span class="by">block_dagger</span><span>|</span><a href="#39139603">parent</a><span>|</span><a href="#39139643">prev</a><span>|</span><a href="#39139936">next</a><span>|</span><label class="collapse" for="c-39139741">[-]</label><label class="expand" for="c-39139741">[1 more]</label></div><br/><div class="children"><div class="content">The author means efficiency in terms of the software that is running, not efficiency in terms of all possible optimizations such as switching to a different lang.</div><br/></div></div><div id="39139936" class="c"><input type="checkbox" id="c-39139936" checked=""/><div class="controls bullet"><span class="by">irjustin</span><span>|</span><a href="#39139603">parent</a><span>|</span><a href="#39139741">prev</a><span>|</span><a href="#39139027">next</a><span>|</span><label class="collapse" for="c-39139936">[-]</label><label class="expand" for="c-39139936">[1 more]</label></div><br/><div class="children"><div class="content">While you missed the point of the saturation comment, this is why we love AWS Lambda over ECS+Fargate.<p>Rails has really poor startup time due to loading all codepaths. We switched to Django and it runs beautifuly on AWS Lambda where our CI is more expensive than actual server costs. We&#x27;re a b2b application so traffic is quite low so we REALLY don&#x27;t saturate the CPU in a normal Fargate setup.</div><br/></div></div></div></div><div id="39139027" class="c"><input type="checkbox" id="c-39139027" checked=""/><div class="controls bullet"><span class="by">rdoherty</span><span>|</span><a href="#39139603">prev</a><span>|</span><a href="#39139776">next</a><span>|</span><label class="collapse" for="c-39139027">[-]</label><label class="expand" for="c-39139027">[1 more]</label></div><br/><div class="children"><div class="content">These are great tips for load testing any web service. Don&#x27;t forget that you can also saturate memory, disk or network too, so watch those graphs too. I&#x27;ve seen load tests unable to saturate CPU because another resource was limited.<p>Also don&#x27;t forget that you are load testing all the dependencies of your service. Database, caching tier, external services, etc. Make sure other teams are aware!<p>Also nothing beats real world traffic. Users&#x27; connections will stay open longer than a synthetic tool may hold them open due to bandwidth, they make very random, sporadic requests too. Your service will behave very differently under large amounts of real world traffic vs synthetic.<p>Other options if you are running multiple web servers is to shift traffic around to increase traffic to 1 host and see where it fails. That is usually a very reliable signal for peak load.<p>And don&#x27;t forget to do this on a schedule as your codebase (and your dependencies codebases) changes!</div><br/></div></div><div id="39139776" class="c"><input type="checkbox" id="c-39139776" checked=""/><div class="controls bullet"><span class="by">pistoriusp</span><span>|</span><a href="#39139027">prev</a><span>|</span><a href="#39138040">next</a><span>|</span><label class="collapse" for="c-39139776">[-]</label><label class="expand" for="c-39139776">[1 more]</label></div><br/><div class="children"><div class="content">Having your test database mirror production as closely as possible is also an important habit, however I’m biased since that’s part of the offering that I’m building.</div><br/></div></div><div id="39138040" class="c"><input type="checkbox" id="c-39138040" checked=""/><div class="controls bullet"><span class="by">anonacct37</span><span>|</span><a href="#39139776">prev</a><span>|</span><a href="#39138507">next</a><span>|</span><label class="collapse" for="c-39138040">[-]</label><label class="expand" for="c-39138040">[5 more]</label></div><br/><div class="children"><div class="content">&gt; My initial requirement was to send requests with unique parameters. To the best of my knowledge, no tool could do this.<p>wrk does this with lua. <a href="https:&#x2F;&#x2F;github.com&#x2F;wg&#x2F;wrk&#x2F;blob&#x2F;master&#x2F;src&#x2F;wrk.lua">https:&#x2F;&#x2F;github.com&#x2F;wg&#x2F;wrk&#x2F;blob&#x2F;master&#x2F;src&#x2F;wrk.lua</a><p>Also even things like the venerable jmeter supported pulling parameters from a csv file.</div><br/><div id="39138096" class="c"><input type="checkbox" id="c-39138096" checked=""/><div class="controls bullet"><span class="by">nomilk</span><span>|</span><a href="#39138040">parent</a><span>|</span><a href="#39138507">next</a><span>|</span><label class="collapse" for="c-39138096">[-]</label><label class="expand" for="c-39138096">[4 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve never done load testing before, but would it be hard to write a script in pure ruby (maybe with a few libraries) that makes a lot of concurrent requests to whatever endpoints and using whatever params you like?</div><br/><div id="39139244" class="c"><input type="checkbox" id="c-39139244" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#39138040">root</a><span>|</span><a href="#39138096">parent</a><span>|</span><a href="#39138733">next</a><span>|</span><label class="collapse" for="c-39139244">[-]</label><label class="expand" for="c-39139244">[1 more]</label></div><br/><div class="children"><div class="content">Load testing can be harder on the client side than the server side at high loads, which might be surprising, but consider how many servers need to handle large numbers of clients connecting and how few clients need to connect to large number of servers --- if you do it yourself, you&#x27;re going to have to relearn all the techniques to make large number of connections possible.<p>If your desired load for testing is small, it&#x27;s not a big deal, of course.</div><br/></div></div><div id="39138733" class="c"><input type="checkbox" id="c-39138733" checked=""/><div class="controls bullet"><span class="by">paulryanrogers</span><span>|</span><a href="#39138040">root</a><span>|</span><a href="#39138096">parent</a><span>|</span><a href="#39139244">prev</a><span>|</span><a href="#39138434">next</a><span>|</span><label class="collapse" for="c-39138733">[-]</label><label class="expand" for="c-39138733">[1 more]</label></div><br/><div class="children"><div class="content">Depends on needs and familiarity. I used Bash and Curl, then PHP, then settled on Jmeter for a tricky bug due to a memory leak from a race under load. All three could reproduce the problem. Jmeter had quite a learning curve, and preparing data for it was a pain. Ultimately though it was more reliable, can do distributed testing, and has lots of nice built in features and analytics.</div><br/></div></div><div id="39138434" class="c"><input type="checkbox" id="c-39138434" checked=""/><div class="controls bullet"><span class="by">liveoneggs</span><span>|</span><a href="#39138040">root</a><span>|</span><a href="#39138096">parent</a><span>|</span><a href="#39138733">prev</a><span>|</span><a href="#39138507">next</a><span>|</span><label class="collapse" for="c-39138434">[-]</label><label class="expand" for="c-39138434">[1 more]</label></div><br/><div class="children"><div class="content">there is no reason to write your own</div><br/></div></div></div></div></div></div><div id="39138507" class="c"><input type="checkbox" id="c-39138507" checked=""/><div class="controls bullet"><span class="by">rubyissimo</span><span>|</span><a href="#39138040">prev</a><span>|</span><a href="#39137750">next</a><span>|</span><label class="collapse" for="c-39138507">[-]</label><label class="expand" for="c-39138507">[1 more]</label></div><br/><div class="children"><div class="content">fwiw, I know it&#x27;s the right thing to run tests from a different computer. But it&#x27;s more annoying. And I hereby tell you that 90% of the time it probably doesn&#x27;t matter.<p>Definitely times it isn&#x27;t true. But if you&#x27;re not doing a load test bc it&#x27;s a pita, do it locally. Most of the time I&#x27;ve wanted to do this, all the action is inside the app. Just be careful to acknowledge that there could be limitations &#x2F; surprises.</div><br/></div></div><div id="39137750" class="c"><input type="checkbox" id="c-39137750" checked=""/><div class="controls bullet"><span class="by">mplewis</span><span>|</span><a href="#39138507">prev</a><span>|</span><label class="collapse" for="c-39137750">[-]</label><label class="expand" for="c-39137750">[1 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re looking to run programmable load test scenarios as described in this blog post, consider checking out <a href="https:&#x2F;&#x2F;k6.io&#x2F;" rel="nofollow">https:&#x2F;&#x2F;k6.io&#x2F;</a>, which I&#x27;ve found to be extremely easy to use and powerful.</div><br/></div></div></div></div></div></div></div></body></html>