<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1710147663537" as="style"/><link rel="stylesheet" href="styles.css?v=1710147663537"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://fabiensanglard.net/iSummer/">How the Devteam Conquered the iPhone</a>Â <span class="domain">(<a href="https://fabiensanglard.net">fabiensanglard.net</a>)</span></div><div class="subtext"><span>jdkee</span> | <span>5 comments</span></div><br/><div><div id="39665442" class="c"><input type="checkbox" id="c-39665442" checked=""/><div class="controls bullet"><span class="by">nicoboo</span><span>|</span><a href="#39665691">next</a><span>|</span><label class="collapse" for="c-39665442">[-]</label><label class="expand" for="c-39665442">[3 more]</label></div><br/><div class="children"><div class="content">Well written and highly detailed description, as always with Fabien&#x27;s work.<p>I remember seeing the investigation on this iPhone protection back at the time, what a journey it has been since this work.<p>Also, I hope someone can provide more information about that minus 0x400 shift before data write so it would be completely explained.</div><br/><div id="39665536" class="c"><input type="checkbox" id="c-39665536" checked=""/><div class="controls bullet"><span class="by">e1ghtSpace</span><span>|</span><a href="#39665442">parent</a><span>|</span><a href="#39665691">next</a><span>|</span><label class="collapse" for="c-39665536">[-]</label><label class="expand" for="c-39665536">[2 more]</label></div><br/><div class="children"><div class="content">The minus 0x400 shift appears to work like this:<p><pre><code>  Seek(fd, 0xA0020000 - 0x400);
</code></pre>
We seek to 0x400 before where we need to write the data<p><pre><code>  SendWrite(fd, foo, 0x400, false);
</code></pre>
We set the first 0x400 bytes of what we want to write to 0<p><pre><code>  SendWrite(fd, fw, fwsize, true);
</code></pre>
We then set the rest of the bytes to our data.<p><pre><code>  SendEndSecpack(fd);
</code></pre>
The iphone copies the data from 0x400 bytes onwards (which is all the data we wanted to write), then tries to verify the signature and fails. If the signature could be verified the first 0x400 bytes (which we left as all zeros) would then be copied.</div><br/><div id="39665674" class="c"><input type="checkbox" id="c-39665674" checked=""/><div class="controls bullet"><span class="by">trashburger</span><span>|</span><a href="#39665442">root</a><span>|</span><a href="#39665536">parent</a><span>|</span><a href="#39665691">next</a><span>|</span><label class="collapse" for="c-39665674">[-]</label><label class="expand" for="c-39665674">[1 more]</label></div><br/><div class="children"><div class="content">Ouch! That&#x27;s a fail on the same level of Microsoft forgetting the XBox decryption keys on the secret ROM.</div><br/></div></div></div></div></div></div><div id="39665691" class="c"><input type="checkbox" id="c-39665691" checked=""/><div class="controls bullet"><span class="by">dmitrygr</span><span>|</span><a href="#39665442">prev</a><span>|</span><label class="collapse" for="c-39665691">[-]</label><label class="expand" for="c-39665691">[1 more]</label></div><br/><div class="children"><div class="content">&gt;       HELP WANTED: If you happen to know why -0x400 trick works, or can get in touch with Geohotz&#x2F;MuscleNerd, please let me know. I have tried to ask around but have not found any explanation. I would be happy to update this article if someone knows.<p>This is commonly done with fw updaters. first 0x400 bytes is a header that the earlier stage loader needs to see before it&#x27;ll allow this stage to boot. So you RX the data, write it freely, just not the header. This is safe and will not allow any code exec since the header is missing. then at the end you sig check the whole thing you wrote, and if it is good, you write the header, making the whole image valid.<p>the trick here is you write 0x400 bytes of garbage first, 0x400 bytes earlier than your desired write. this is buffered but not written (treated as the headers). The rest of what you sent IS written (writing what you wanted where you wanted). then sig is checked. you fail. the first 0x400 is not written (and you did not want it written).<p>win</div><br/></div></div></div></div></div></div></div></body></html>