<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1734426072227" as="style"/><link rel="stylesheet" href="styles.css?v=1734426072227"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://linus.schreibt.jetzt/posts/qemu-9p-performance.html">Make your QEMU faster (2022)</a>Â <span class="domain">(<a href="https://linus.schreibt.jetzt">linus.schreibt.jetzt</a>)</span></div><div class="subtext"><span>tripdout</span> | <span>15 comments</span></div><br/><div><div id="42438605" class="c"><input type="checkbox" id="c-42438605" checked=""/><div class="controls bullet"><span class="by">Svenstaro</span><span>|</span><a href="#42439447">next</a><span>|</span><label class="collapse" for="c-42438605">[-]</label><label class="expand" for="c-42438605">[2 more]</label></div><br/><div class="children"><div class="content">Is there a reason to use 9p over virtiofs in this case? It looks to me as though virtiofs was made exactly with the idea to deal good performance.</div><br/><div id="42438969" class="c"><input type="checkbox" id="c-42438969" checked=""/><div class="controls bullet"><span class="by">hackernudes</span><span>|</span><a href="#42438605">parent</a><span>|</span><a href="#42439447">next</a><span>|</span><label class="collapse" for="c-42438969">[-]</label><label class="expand" for="c-42438969">[1 more]</label></div><br/><div class="children"><div class="content">The author commented on that in 2022 <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33200731">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33200731</a></div><br/></div></div></div></div><div id="42439447" class="c"><input type="checkbox" id="c-42439447" checked=""/><div class="controls bullet"><span class="by">mordae</span><span>|</span><a href="#42438605">prev</a><span>|</span><a href="#42438652">next</a><span>|</span><label class="collapse" for="c-42439447">[-]</label><label class="expand" for="c-42439447">[1 more]</label></div><br/><div class="children"><div class="content">For better convenience there is now <a href="https:&#x2F;&#x2F;github.com&#x2F;KDAB&#x2F;hotspot">https:&#x2F;&#x2F;github.com&#x2F;KDAB&#x2F;hotspot</a> to render the flame graph from your perf data. You can also use online <a href="https:&#x2F;&#x2F;profiler.firefox.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;profiler.firefox.com&#x2F;</a>.</div><br/></div></div><div id="42438652" class="c"><input type="checkbox" id="c-42438652" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#42439447">prev</a><span>|</span><a href="#42438764">next</a><span>|</span><label class="collapse" for="c-42438652">[-]</label><label class="expand" for="c-42438652">[1 more]</label></div><br/><div class="children"><div class="content">Discussed at the time:<p><i>Digging into a QEMU problem of slow data copying</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33192152">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33192152</a> - Oct 2022 (31 comments)</div><br/></div></div><div id="42438764" class="c"><input type="checkbox" id="c-42438764" checked=""/><div class="controls bullet"><span class="by">Svenstaro</span><span>|</span><a href="#42438652">prev</a><span>|</span><a href="#42438554">next</a><span>|</span><label class="collapse" for="c-42438764">[-]</label><label class="expand" for="c-42438764">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve recently deep-dived into QEMU performance especially in order to cut down boot&#x2F;bootstrapping times for quickly running tests and I&#x27;d like to share some tricks:<p>- Templating: <a href="https:&#x2F;&#x2F;qemu.readthedocs.io&#x2F;en&#x2F;v9.1.0&#x2F;system&#x2F;vm-templating.html" rel="nofollow">https:&#x2F;&#x2F;qemu.readthedocs.io&#x2F;en&#x2F;v9.1.0&#x2F;system&#x2F;vm-templating.h...</a>
- virtio-fs: <a href="https:&#x2F;&#x2F;virtio-fs.gitlab.io&#x2F;" rel="nofollow">https:&#x2F;&#x2F;virtio-fs.gitlab.io&#x2F;</a>
- Overlay storage images: <a href="https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;QEMU#Overlay_storage_images" rel="nofollow">https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;QEMU#Overlay_storage_images</a></div><br/><div id="42438805" class="c"><input type="checkbox" id="c-42438805" checked=""/><div class="controls bullet"><span class="by">nijave</span><span>|</span><a href="#42438764">parent</a><span>|</span><a href="#42438554">next</a><span>|</span><label class="collapse" for="c-42438805">[-]</label><label class="expand" for="c-42438805">[1 more]</label></div><br/><div class="children"><div class="content">Cloud init will handle unique IDs although might add some boot time</div><br/></div></div></div></div><div id="42438554" class="c"><input type="checkbox" id="c-42438554" checked=""/><div class="controls bullet"><span class="by">m463</span><span>|</span><a href="#42438764">prev</a><span>|</span><a href="#42438602">next</a><span>|</span><label class="collapse" for="c-42438554">[-]</label><label class="expand" for="c-42438554">[1 more]</label></div><br/><div class="children"><div class="content">wow, clickbait title, then 9p and nix in the first couple paragraphs firmly set the hook.</div><br/></div></div><div id="42438602" class="c"><input type="checkbox" id="c-42438602" checked=""/><div class="controls bullet"><span class="by">glandium</span><span>|</span><a href="#42438554">prev</a><span>|</span><a href="#42438588">next</a><span>|</span><label class="collapse" for="c-42438602">[-]</label><label class="expand" for="c-42438602">[1 more]</label></div><br/><div class="children"><div class="content">This was interesting, but by the end of it, I was still expecting some weird trick to work around the problem without the patch.</div><br/></div></div><div id="42438549" class="c"><input type="checkbox" id="c-42438549" checked=""/><div class="controls bullet"><span class="by">ryan_lane</span><span>|</span><a href="#42438588">prev</a><span>|</span><a href="#42438627">next</a><span>|</span><label class="collapse" for="c-42438549">[-]</label><label class="expand" for="c-42438549">[3 more]</label></div><br/><div class="children"><div class="content">They delivered on the clickbait title to engagement time metric, as the title promises one weird trick and the content has no TLDR.</div><br/><div id="42438643" class="c"><input type="checkbox" id="c-42438643" checked=""/><div class="controls bullet"><span class="by">dmitrygr</span><span>|</span><a href="#42438549">parent</a><span>|</span><a href="#42438621">next</a><span>|</span><label class="collapse" for="c-42438643">[-]</label><label class="expand" for="c-42438643">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve got you:<p>hashtables faster than linked lists in places where lookups are frequent &amp; item count is high</div><br/></div></div><div id="42438621" class="c"><input type="checkbox" id="c-42438621" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#42438549">parent</a><span>|</span><a href="#42438643">prev</a><span>|</span><a href="#42438627">next</a><span>|</span><label class="collapse" for="c-42438621">[-]</label><label class="expand" for="c-42438621">[1 more]</label></div><br/><div class="children"><div class="content">Well, the article is fairly short, so a TLDR is perhaps not necessary.</div><br/></div></div></div></div><div id="42438627" class="c"><input type="checkbox" id="c-42438627" checked=""/><div class="controls bullet"><span class="by">mannyv</span><span>|</span><a href="#42438549">prev</a><span>|</span><label class="collapse" for="c-42438627">[-]</label><label class="expand" for="c-42438627">[2 more]</label></div><br/><div class="children"><div class="content">Tl;dr: file descriptors for the guest os are stored as linked lists by qemu, and changing that sped qemu file copying up by a ton.</div><br/><div id="42438824" class="c"><input type="checkbox" id="c-42438824" checked=""/><div class="controls bullet"><span class="by">tuukkah</span><span>|</span><a href="#42438627">parent</a><span>|</span><label class="collapse" for="c-42438824">[-]</label><label class="expand" for="c-42438824">[1 more]</label></div><br/><div class="children"><div class="content">And the commit here: <a href="https:&#x2F;&#x2F;gitlab.com&#x2F;qemu-project&#x2F;qemu&#x2F;-&#x2F;commit&#x2F;f5265c8f917ea8c71a30e549b7e3017c1038db63" rel="nofollow">https:&#x2F;&#x2F;gitlab.com&#x2F;qemu-project&#x2F;qemu&#x2F;-&#x2F;commit&#x2F;f5265c8f917ea8...</a><p>Included in QEMU version 7.2.0 from 2022-12-14.</div><br/></div></div></div></div></div></div></div></div></div></body></html>