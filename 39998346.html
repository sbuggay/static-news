<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712826053866" as="style"/><link rel="stylesheet" href="styles.css?v=1712826053866"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://rachelbythebay.com/w/2024/04/10/rtc/">Going in circles without a real-time clock</a> <span class="domain">(<a href="https://rachelbythebay.com">rachelbythebay.com</a>)</span></div><div class="subtext"><span>X-Cubed</span> | <span>37 comments</span></div><br/><div><div id="39998753" class="c"><input type="checkbox" id="c-39998753" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39999330">next</a><span>|</span><label class="collapse" for="c-39998753">[-]</label><label class="expand" for="c-39998753">[3 more]</label></div><br/><div class="children"><div class="content">&gt; By &quot;everything else&quot;, I also mean WireGuard. Did you know that if your machine gets far enough out of sync, that&#x27;ll stop working, too? I had no idea that it apparently includes time in its crypto stuff, but what other explanation is there?<p>WireGuard only requires a monotonic clock, because it periodically rotates keys to provide the forward secrecy. Peer clocks are otherwise not required to be synchronized [1]. I guess the clock had a higher rate than usual and it couldn&#x27;t be corrected due to the lack of RTC?<p>[1] <a href="https:&#x2F;&#x2F;www.wireguard.com&#x2F;papers&#x2F;wireguard.pdf#page=7" rel="nofollow">https:&#x2F;&#x2F;www.wireguard.com&#x2F;papers&#x2F;wireguard.pdf#page=7</a> &quot;In fact, it does not even have to be an accurate timestamp; it simply must be a per-peer monotonically increasing 96-bit number.&quot;</div><br/><div id="39999199" class="c"><input type="checkbox" id="c-39999199" checked=""/><div class="controls bullet"><span class="by">josephg</span><span>|</span><a href="#39998753">parent</a><span>|</span><a href="#39999330">next</a><span>|</span><label class="collapse" for="c-39999199">[-]</label><label class="expand" for="c-39999199">[2 more]</label></div><br/><div class="children"><div class="content">Why does it use the time then? Why not just increment its own 96 bit number whenever you use it?</div><br/><div id="39999285" class="c"><input type="checkbox" id="c-39999285" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39998753">root</a><span>|</span><a href="#39999199">parent</a><span>|</span><a href="#39999330">next</a><span>|</span><label class="collapse" for="c-39999285">[-]</label><label class="expand" for="c-39999285">[1 more]</label></div><br/><div class="children"><div class="content">Because it is required to be monotonic <i>per peer</i>. WireGuard has no intrinsic states, so multiple machines with the same peer key will be seen as a single peer and that is actually a legitimate use of WireGuard. These machines would have to be synchronized to each other (but not necessarily to the external clock), and using a time is a straightforward and reasonable way to ensure this.</div><br/></div></div></div></div></div></div><div id="39999330" class="c"><input type="checkbox" id="c-39999330" checked=""/><div class="controls bullet"><span class="by">CaliforniaKarl</span><span>|</span><a href="#39998753">prev</a><span>|</span><a href="#39999215">next</a><span>|</span><label class="collapse" for="c-39999330">[-]</label><label class="expand" for="c-39999330">[3 more]</label></div><br/><div class="children"><div class="content">I know I’ve brought this up before, but I can’t remember exactly where.<p>It would be nice if DHCP could provide the current time as one of the pieces of information it provides with a lease.  If you’re already trusting it for your IP address, you might as well trust it with the current UTC time: The current 64-bit timestamp would be enough to get timestamp-sensitive things working.</div><br/><div id="39999796" class="c"><input type="checkbox" id="c-39999796" checked=""/><div class="controls bullet"><span class="by">mapreduce</span><span>|</span><a href="#39999330">parent</a><span>|</span><a href="#39999715">next</a><span>|</span><label class="collapse" for="c-39999796">[-]</label><label class="expand" for="c-39999796">[1 more]</label></div><br/><div class="children"><div class="content">&gt;  If you’re already trusting it for your IP address, you might as well trust it with the current UTC time<p>I don&#x27;t follow! How does trusting DHCP with IP address automatically mean I should trust it with the current UTC time?<p>Time requires higher degree of trust than IP.<p>I may not care what my IP address looks like but I might care a lot about what the current UTC time is and I might want this to come from a more trustworthy device.</div><br/></div></div><div id="39999715" class="c"><input type="checkbox" id="c-39999715" checked=""/><div class="controls bullet"><span class="by">citrin_ru</span><span>|</span><a href="#39999330">parent</a><span>|</span><a href="#39999796">prev</a><span>|</span><a href="#39999215">next</a><span>|</span><label class="collapse" for="c-39999715">[-]</label><label class="expand" for="c-39999715">[1 more]</label></div><br/><div class="children"><div class="content">I trust a free wifi hotspot to give me an IP (traffic will be protected by TLS), but not with the time. E. g. time from the past can be used to trick into accepting an expired TLS certificate. But for most wifi hotspots it will be unintentionally wrong beca such devices often unmonitored and not maintained until they completely break.</div><br/></div></div></div></div><div id="39999215" class="c"><input type="checkbox" id="c-39999215" checked=""/><div class="controls bullet"><span class="by">mplaisier</span><span>|</span><a href="#39999330">prev</a><span>|</span><a href="#39999685">next</a><span>|</span><label class="collapse" for="c-39999215">[-]</label><label class="expand" for="c-39999215">[1 more]</label></div><br/><div class="children"><div class="content">I ran into a similar problem on a Raspberry Pi, where my program would ignore data because it was deemed too old. 
It turns out a Pi uses fake-hwclock. This tool stores a timestamp regularly in a file. On boot the Pi reads from that file to set the time. When the Pi has been turned off for longer then the initial time can be hours or days out of sync. 
The Pi then takes a couple of seconds to obtain a valid time via NTP, but my program ran quickly enough to work with the old timestamp. After a couple of minutes it would typically work again.</div><br/></div></div><div id="39999685" class="c"><input type="checkbox" id="c-39999685" checked=""/><div class="controls bullet"><span class="by">silasdavis</span><span>|</span><a href="#39999215">prev</a><span>|</span><a href="#39999525">next</a><span>|</span><label class="collapse" for="c-39999685">[-]</label><label class="expand" for="c-39999685">[1 more]</label></div><br/><div class="children"><div class="content">Tangential: I have a pi 4 running openwrt and a wireguard interface that is routed over the WiFi access point. If you connect to this network it&#x27;s as if you are connecting in another country. I have outbound traffic only going over wireguard. If wireguard is down then no internet (to avoid any leakage). However if pi loses power the clock resets, wireguard can&#x27;t handshake with that much clock skew, NTP can&#x27;t connect without wireguard. So I need to manually update clock after a power failure.<p>I guess I need requests to the NTP server to go over WAN directly. Always seemed like a hassle to get this to work with openwrt zones and stuff. My eternal gratitude to anyone who shoves me in the right direction...</div><br/></div></div><div id="39999525" class="c"><input type="checkbox" id="c-39999525" checked=""/><div class="controls bullet"><span class="by">cjbillington</span><span>|</span><a href="#39999685">prev</a><span>|</span><a href="#39999329">next</a><span>|</span><label class="collapse" for="c-39999525">[-]</label><label class="expand" for="c-39999525">[1 more]</label></div><br/><div class="children"><div class="content">The wireguard problem is a pain in the neck. Even if you&#x27;re happy for your system to not have a realtime clock, when it does come online you&#x27;d want wireguard to not start until after the clock has synced to a timeserver. The below is what I&#x27;m doing at the moment, but I can&#x27;t say I&#x27;m sure it&#x27;s working - haven&#x27;t seen wireguard start before the time is synced since doing it, but it could be probabilistic:<p><pre><code>    systemctl enable systemd-time-wait-sync.service
    mkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;wg-quick@wg0.service.d&#x2F;
    echo &quot;[Unit]
    After=time-sync.target
    Wants=time-sync.target
    &quot; &gt; &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;wg-quick@wg0.service.d&#x2F;override.conf
</code></pre>
I&#x27;d be interested if anyone could let me know if they think this is likely to be achieving what I want or not.</div><br/></div></div><div id="39999329" class="c"><input type="checkbox" id="c-39999329" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#39999525">prev</a><span>|</span><a href="#39999066">next</a><span>|</span><label class="collapse" for="c-39999329">[-]</label><label class="expand" for="c-39999329">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s unfortunate that using DHCP to get <i>rough</i> time isn&#x27;t more popular, especially for devices without RTC. Sure DHCP can be spoofed and should be considered more of a last resort, but it sure would be better than nothing and ending up in this kind of a situation where nothing works anymore.<p>Previous discussion on similar thing: &quot;Encrypted DNS + NTP = Deadlock&quot; <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34177331">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34177331</a></div><br/></div></div><div id="39999066" class="c"><input type="checkbox" id="c-39999066" checked=""/><div class="controls bullet"><span class="by">riobard</span><span>|</span><a href="#39999329">prev</a><span>|</span><a href="#39999799">next</a><span>|</span><label class="collapse" for="c-39999066">[-]</label><label class="expand" for="c-39999066">[7 more]</label></div><br/><div class="children"><div class="content">Speaking of RTC battery, I&#x27;ve recently come to the realization that I have to make sure that BIOS battery is not absolutely dead in always-on PC boxes.<p>Background: I use an x86 box as home router. I&#x27;ve changed the configuration in the BIOS that it should automatically boot up on power. However if the BIOS battery is dead, the config will be lost and it will revert to default settings, which is not to boot on power.<p>But there is no way to know how much juice is left in the BIOS battery, thus there is no way to issue warnings that the battery should be replaced soon. If there is power loss AND the battery is dead, when the power comes back up again, the router will just stay off indefinitely until it&#x27;s manually turned on.<p>That&#x27;s when I realized why most consumer routers do not feature RTC nor do they require batteries.</div><br/><div id="39999698" class="c"><input type="checkbox" id="c-39999698" checked=""/><div class="controls bullet"><span class="by">Hrnrurj</span><span>|</span><a href="#39999066">parent</a><span>|</span><a href="#39999138">next</a><span>|</span><label class="collapse" for="c-39999698">[-]</label><label class="expand" for="c-39999698">[1 more]</label></div><br/><div class="children"><div class="content">Voltage check on battery is part of regular PC maintenance. Like cleaning dust, checking all fans are spinning,  capacitors are not getting bigger, checking for weird sounds in PSU, overnight memtest...<p>You should do it every year or two...</div><br/></div></div><div id="39999138" class="c"><input type="checkbox" id="c-39999138" checked=""/><div class="controls bullet"><span class="by">qiqitori</span><span>|</span><a href="#39999066">parent</a><span>|</span><a href="#39999698">prev</a><span>|</span><a href="#39999130">next</a><span>|</span><label class="collapse" for="c-39999138">[-]</label><label class="expand" for="c-39999138">[2 more]</label></div><br/><div class="children"><div class="content">Some unsolicited solutions, maybe not for you but somebody in a similar situation: maybe replace it with a supercapacitor (needs some wiring changes, otherwise it won&#x27;t ever be charged, should last long enough for most power outages), or use a stack of coin cells in parallel (difficult due to physical dimensions, and they&#x27;ll still go dead at some point). You can also short two wires on the ATX supply to automatically turn on the computer when power is supplied (which may not be good enough if you have to press a key during boot to dismiss the low battery warning). Or hack the BIOS :)</div><br/><div id="39999640" class="c"><input type="checkbox" id="c-39999640" checked=""/><div class="controls bullet"><span class="by">riobard</span><span>|</span><a href="#39999066">root</a><span>|</span><a href="#39999138">parent</a><span>|</span><a href="#39999130">next</a><span>|</span><label class="collapse" for="c-39999640">[-]</label><label class="expand" for="c-39999640">[1 more]</label></div><br/><div class="children"><div class="content">Somehow I feel reliability might take a hit… :|</div><br/></div></div></div></div><div id="39999130" class="c"><input type="checkbox" id="c-39999130" checked=""/><div class="controls bullet"><span class="by">qmarchi</span><span>|</span><a href="#39999066">parent</a><span>|</span><a href="#39999138">prev</a><span>|</span><a href="#39999799">next</a><span>|</span><label class="collapse" for="c-39999130">[-]</label><label class="expand" for="c-39999130">[3 more]</label></div><br/><div class="children"><div class="content">Most newer systems persist EFI options to NVRAM now days as well. Pulling the battery isn&#x27;t generally enough to reset them anymore.</div><br/><div id="39999196" class="c"><input type="checkbox" id="c-39999196" checked=""/><div class="controls bullet"><span class="by">progbits</span><span>|</span><a href="#39999066">root</a><span>|</span><a href="#39999130">parent</a><span>|</span><a href="#39999799">next</a><span>|</span><label class="collapse" for="c-39999196">[-]</label><label class="expand" for="c-39999196">[2 more]</label></div><br/><div class="children"><div class="content">My desktop remembers all settings, but after power loss still goes into a warning where I have to press F1 to enter settings, then exit them without making changes. I couldn&#x27;t find an option to not do that.</div><br/><div id="39999428" class="c"><input type="checkbox" id="c-39999428" checked=""/><div class="controls bullet"><span class="by">riobard</span><span>|</span><a href="#39999066">root</a><span>|</span><a href="#39999196">parent</a><span>|</span><a href="#39999799">next</a><span>|</span><label class="collapse" for="c-39999428">[-]</label><label class="expand" for="c-39999428">[1 more]</label></div><br/><div class="children"><div class="content">Yes, this is very annoying.</div><br/></div></div></div></div></div></div></div></div><div id="39999799" class="c"><input type="checkbox" id="c-39999799" checked=""/><div class="controls bullet"><span class="by">hcfman</span><span>|</span><a href="#39999066">prev</a><span>|</span><a href="#39998997">next</a><span>|</span><label class="collapse" for="c-39999799">[-]</label><label class="expand" for="c-39999799">[3 more]</label></div><br/><div class="children"><div class="content">Install sbts-aru as a base system and it will keep your Pi accuracy to sub-microsecond error.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;hcfman&#x2F;sbts-aru">https:&#x2F;&#x2F;github.com&#x2F;hcfman&#x2F;sbts-aru</a><p>Problem solved.</div><br/><div id="39999807" class="c"><input type="checkbox" id="c-39999807" checked=""/><div class="controls bullet"><span class="by">hcfman</span><span>|</span><a href="#39999799">parent</a><span>|</span><a href="#39998997">next</a><span>|</span><label class="collapse" for="c-39999807">[-]</label><label class="expand" for="c-39999807">[2 more]</label></div><br/><div class="children"><div class="content">Or... Install one of these on a Pi somewhere in your network and use that as a time source for all of your devices. Problem solved for all your machines.</div><br/><div id="39999973" class="c"><input type="checkbox" id="c-39999973" checked=""/><div class="controls bullet"><span class="by">hcfman</span><span>|</span><a href="#39999799">root</a><span>|</span><a href="#39999807">parent</a><span>|</span><a href="#39998997">next</a><span>|</span><label class="collapse" for="c-39999973">[-]</label><label class="expand" for="c-39999973">[1 more]</label></div><br/><div class="children"><div class="content">So you know, sbts-aru is an audio recording program. However, in one command it sets an an overlayFS protected SD card setup and chrony GPS based time synchronization. You can turn off all the recording related stuff and then you have a stratum #1 time server for your network. Real easy, real cheap. No more time problems.<p>There&#x27;s no reason now for all geeks not to have at least one stratum #1 time server in their networks. Really none.</div><br/></div></div></div></div></div></div><div id="39998997" class="c"><input type="checkbox" id="c-39998997" checked=""/><div class="controls bullet"><span class="by">jlubawy</span><span>|</span><a href="#39999799">prev</a><span>|</span><a href="#39998864">next</a><span>|</span><label class="collapse" for="c-39998997">[-]</label><label class="expand" for="c-39998997">[1 more]</label></div><br/><div class="children"><div class="content">My raspberry pi is also currently dead, something it didn&#x27;t like about updating the OS caused it to be bricked. All updates were done within the OS, so didn&#x27;t expect anything bad to happen.<p>I could reflash the OS, but I also &quot;don&#x27;t have the time&quot;. I&#x27;ll just use my laptop until I do have the time someday to resurrect it.</div><br/></div></div><div id="39998864" class="c"><input type="checkbox" id="c-39998864" checked=""/><div class="controls bullet"><span class="by">wodenokoto</span><span>|</span><a href="#39998997">prev</a><span>|</span><a href="#39999224">next</a><span>|</span><label class="collapse" for="c-39998864">[-]</label><label class="expand" for="c-39998864">[5 more]</label></div><br/><div class="children"><div class="content">What is she referring to by “THE ONE”?</div><br/><div id="39998978" class="c"><input type="checkbox" id="c-39998978" checked=""/><div class="controls bullet"><span class="by">bjackman</span><span>|</span><a href="#39998864">parent</a><span>|</span><a href="#39998987">next</a><span>|</span><label class="collapse" for="c-39998978">[-]</label><label class="expand" for="c-39998978">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s pre-empting the sibling comment saying &quot;RTC module is $1&quot;</div><br/></div></div><div id="39998987" class="c"><input type="checkbox" id="c-39998987" checked=""/><div class="controls bullet"><span class="by">dmvdoug</span><span>|</span><a href="#39998864">parent</a><span>|</span><a href="#39998978">prev</a><span>|</span><a href="#39998889">next</a><span>|</span><label class="collapse" for="c-39998987">[-]</label><label class="expand" for="c-39998987">[1 more]</label></div><br/><div class="children"><div class="content">See, e.g., <a href="https:&#x2F;&#x2F;rachelbythebay.com&#x2F;w&#x2F;2018&#x2F;04&#x2F;28&#x2F;meta&#x2F;" rel="nofollow">https:&#x2F;&#x2F;rachelbythebay.com&#x2F;w&#x2F;2018&#x2F;04&#x2F;28&#x2F;meta&#x2F;</a></div><br/></div></div><div id="39998889" class="c"><input type="checkbox" id="c-39998889" checked=""/><div class="controls bullet"><span class="by">semireg</span><span>|</span><a href="#39998864">parent</a><span>|</span><a href="#39998987">prev</a><span>|</span><a href="#39999224">next</a><span>|</span><label class="collapse" for="c-39998889">[-]</label><label class="expand" for="c-39998889">[2 more]</label></div><br/><div class="children"><div class="content">The know it all. This “wouldn’t have happened to them because they are” THE ONE. Also known as, “that guy” as in, “don’t be THAT GUY.”</div><br/><div id="39999011" class="c"><input type="checkbox" id="c-39999011" checked=""/><div class="controls bullet"><span class="by">k1t</span><span>|</span><a href="#39998864">root</a><span>|</span><a href="#39998889">parent</a><span>|</span><a href="#39999224">next</a><span>|</span><label class="collapse" for="c-39999011">[-]</label><label class="expand" for="c-39999011">[1 more]</label></div><br/><div class="children"><div class="content">As sibling comment somewhat points out, she is literally referencing The One (2001)<p><a href="https:&#x2F;&#x2F;m.imdb.com&#x2F;title&#x2F;tt0267804&#x2F;" rel="nofollow">https:&#x2F;&#x2F;m.imdb.com&#x2F;title&#x2F;tt0267804&#x2F;</a></div><br/></div></div></div></div></div></div><div id="39999224" class="c"><input type="checkbox" id="c-39999224" checked=""/><div class="controls bullet"><span class="by">Joel_Mckay</span><span>|</span><a href="#39998864">prev</a><span>|</span><a href="#39998919">next</a><span>|</span><label class="collapse" for="c-39999224">[-]</label><label class="expand" for="c-39999224">[1 more]</label></div><br/><div class="children"><div class="content">If you are running Bind or SSL&#x2F;x.509 certs, than an RTC is pretty much a requirement on the raspberry pi.  Network time leaps over NTP even when working (first big leap was allowed etc.) can still bork a lot of services.<p>Local stratum 1 GPS time (even with PPS pin) servers based on Pi&#x27;s can suffer similar issues when they lose satellite lock (weather etc.)<p>Have a great day =)</div><br/></div></div><div id="39998919" class="c"><input type="checkbox" id="c-39998919" checked=""/><div class="controls bullet"><span class="by">M95D</span><span>|</span><a href="#39999224">prev</a><span>|</span><a href="#39998750">next</a><span>|</span><label class="collapse" for="c-39998919">[-]</label><label class="expand" for="c-39998919">[4 more]</label></div><br/><div class="children"><div class="content">RTC module for Raspberry is ~ $1.</div><br/><div id="39999089" class="c"><input type="checkbox" id="c-39999089" checked=""/><div class="controls bullet"><span class="by">icehawk</span><span>|</span><a href="#39998919">parent</a><span>|</span><a href="#39998750">next</a><span>|</span><label class="collapse" for="c-39999089">[-]</label><label class="expand" for="c-39999089">[3 more]</label></div><br/><div class="children"><div class="content">and you certaintly get what you pay for, DS3231s fry almost as easily as MAX3232s,<p>(And you can do the same thing were you write the time to the RTC before you have the correct time)</div><br/><div id="39999718" class="c"><input type="checkbox" id="c-39999718" checked=""/><div class="controls bullet"><span class="by">M95D</span><span>|</span><a href="#39998919">root</a><span>|</span><a href="#39999089">parent</a><span>|</span><a href="#39999288">next</a><span>|</span><label class="collapse" for="c-39999718">[-]</label><label class="expand" for="c-39999718">[1 more]</label></div><br/><div class="children"><div class="content">I have a DS1307 installed ever since I bought a RPi3B+. It didn&#x27;t fail and it&#x27;s accurate enough until NTP updates the time.<p>Are you sure you connected it correctly?</div><br/></div></div><div id="39999288" class="c"><input type="checkbox" id="c-39999288" checked=""/><div class="controls bullet"><span class="by">Joel_Mckay</span><span>|</span><a href="#39998919">root</a><span>|</span><a href="#39999089">parent</a><span>|</span><a href="#39999718">prev</a><span>|</span><a href="#39998750">next</a><span>|</span><label class="collapse" for="c-39999288">[-]</label><label class="expand" for="c-39999288">[1 more]</label></div><br/><div class="children"><div class="content">I have used these in product designs before with zero failures.  Where exactly did you buy your samples?<p>We found they drift less than 28s a year in standalone mode. Also, were  repeatable within +-18ms when using a NTP client.<p>Microchip RTCs are harder to setup, but also seem to work just as well (ignoring the goofy epoch).<p>Chip shortage caused people to do unspeakable things.... ;-)</div><br/></div></div></div></div></div></div><div id="39998750" class="c"><input type="checkbox" id="c-39998750" checked=""/><div class="controls bullet"><span class="by">koala_man</span><span>|</span><a href="#39998919">prev</a><span>|</span><label class="collapse" for="c-39998750">[-]</label><label class="expand" for="c-39998750">[5 more]</label></div><br/><div class="children"><div class="content">tl;dr: machine is unable synchronize its clock because it won&#x27;t trust the NTP server&#x27;s DNSSEC certificate because its clock isn&#x27;t synchronized. Oof.</div><br/><div id="39999025" class="c"><input type="checkbox" id="c-39999025" checked=""/><div class="controls bullet"><span class="by">jandrese</span><span>|</span><a href="#39998750">parent</a><span>|</span><a href="#39998898">next</a><span>|</span><label class="collapse" for="c-39999025">[-]</label><label class="expand" for="c-39999025">[2 more]</label></div><br/><div class="children"><div class="content">This is the perennial problem with trying to secure NTP.  I&#x27;ve also seen people suggest that we just use HTTPS for time sync, not realizing that if your clocks are too far off you can&#x27;t make a HTTPS connection.</div><br/><div id="39999147" class="c"><input type="checkbox" id="c-39999147" checked=""/><div class="controls bullet"><span class="by">toast0</span><span>|</span><a href="#39998750">root</a><span>|</span><a href="#39999025">parent</a><span>|</span><a href="#39998898">next</a><span>|</span><label class="collapse" for="c-39999147">[-]</label><label class="expand" for="c-39999147">[1 more]</label></div><br/><div class="children"><div class="content">It takes more creativity, but you can start to make a narrowing range of times if you&#x27;re careful.<p>You&#x27;ll have to ignore DNSSEC time based validation while you start up, of course... Start with the last time you were properly synced: it&#x27;s most likely less than a month behind then.<p>Then take a sampling of certificates offered from well known sites. If the certificates validate, other than time, no reasonable CA that you trust issues not-before dates in the future, so it&#x27;s not before the most recent not-before date in a certificate. It&#x27;s probably not much after the not-after dates either, well know sites tend to replace their certificates (but maybe you&#x27;re getting MITMed with a compromised, old certificate).<p>Maybe ask for OSCP stapling, which should get you a more narrow range of times. I think OSCP responses are valid for a week? But if you get several from different https servers, chances are good you&#x27;ll narrow the range.<p>In the case as suggested that the time was only off by about a day, IMHO, something is seriously wrong if it can&#x27;t get to sync from there, but I guess I&#x27;m not really surprised either.</div><br/></div></div></div></div><div id="39998898" class="c"><input type="checkbox" id="c-39998898" checked=""/><div class="controls bullet"><span class="by">kakkoko</span><span>|</span><a href="#39998750">parent</a><span>|</span><a href="#39999025">prev</a><span>|</span><a href="#39998815">next</a><span>|</span><label class="collapse" for="c-39998898">[-]</label><label class="expand" for="c-39998898">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;github.com&#x2F;systemd&#x2F;systemd&#x2F;commit&#x2F;abf4e5c1d3ad767bc0ed67883e8e4d916af095ec">https:&#x2F;&#x2F;github.com&#x2F;systemd&#x2F;systemd&#x2F;commit&#x2F;abf4e5c1d3ad767bc0...</a><p>While systemd-timesyncd contains a workaround for this, chrony does not seem to.</div><br/></div></div><div id="39998815" class="c"><input type="checkbox" id="c-39998815" checked=""/><div class="controls bullet"><span class="by">iforgotpassword</span><span>|</span><a href="#39998750">parent</a><span>|</span><a href="#39998898">prev</a><span>|</span><label class="collapse" for="c-39998815">[-]</label><label class="expand" for="c-39998815">[1 more]</label></div><br/><div class="children"><div class="content">Yeah in hindsight it might not be the best idea to enable this for ntp.org, especially when the ntp protocol itself isn&#x27;t secure.</div><br/></div></div></div></div></div></div></div></div></div></body></html>