<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1716541273151" as="style"/><link rel="stylesheet" href="styles.css?v=1716541273151"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://bitfehler.srht.site/posts/2024-04-15_m2dir-treating-mails-as-files-without-going-crazy.html">M2dir: Treating mails as files without going crazy</a> <span class="domain">(<a href="https://bitfehler.srht.site">bitfehler.srht.site</a>)</span></div><div class="subtext"><span>cl3misch</span> | <span>47 comments</span></div><br/><div><div id="40455399" class="c"><input type="checkbox" id="c-40455399" checked=""/><div class="controls bullet"><span class="by">ksherlock</span><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40455399">[-]</label><label class="expand" for="c-40455399">[10 more]</label></div><br/><div class="children"><div class="content">BeOS stored mail as individual files with extended attributes holding the subject, date, sender, etc.  The email app (BeMail) was used to view&#x2F;compose&#x2F;send email but inbox management was handled by Tracker (BeOS version of Macintosh Finder or Windows Explorer).  But the Tracker window was configured to display the extended attributes instead of the file names. The actual filename wasn&#x27;t even displayed.  Nobody went crazy.<p>Example: <a href="https:&#x2F;&#x2F;birdhouse.org&#x2F;beos&#x2F;refugee&#x2F;bemail.jpg" rel="nofollow">https:&#x2F;&#x2F;birdhouse.org&#x2F;beos&#x2F;refugee&#x2F;bemail.jpg</a> via <a href="https:&#x2F;&#x2F;birdhouse.org&#x2F;beos&#x2F;refugee&#x2F;" rel="nofollow">https:&#x2F;&#x2F;birdhouse.org&#x2F;beos&#x2F;refugee&#x2F;</a> (which has some other images of Tracker organization with extended attributes)</div><br/><div id="40455641" class="c"><input type="checkbox" id="c-40455641" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#40455399">parent</a><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40455641">[-]</label><label class="expand" for="c-40455641">[9 more]</label></div><br/><div class="children"><div class="content">Pushing concerns up to the OS level is that one thing we could be doing in so many places, but havent really tried in decades. Should we use a universal format&#x2F;protocol agnostic way of having data attached to files? Naaaahhhh. &#x2F;s</div><br/><div id="40460574" class="c"><input type="checkbox" id="c-40460574" checked=""/><div class="controls bullet"><span class="by">ryandrake</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40455641">parent</a><span>|</span><a href="#40464063">next</a><span>|</span><label class="collapse" for="c-40460574">[-]</label><label class="expand" for="c-40460574">[3 more]</label></div><br/><div class="children"><div class="content">I&#x27;m generally a fan of taking advantage of the filesystem, especially when your application is just... storing and viewing files. It irrationally upsets me when an application grafts its own &quot;Library&quot; on top of my perfectly working filesystem, requiring me to import my files into an artificial thing that is just like a filesystem.<p>On the other hand, extended attributes and other filesystem-specific features could be problematic if you want to share files with other operating systems. If I copy a file to a FAT32 formatted SDCard, I need to worry about what might not copy over.</div><br/><div id="40461159" class="c"><input type="checkbox" id="c-40461159" checked=""/><div class="controls bullet"><span class="by">gryn</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40460574">parent</a><span>|</span><a href="#40464063">next</a><span>|</span><label class="collapse" for="c-40461159">[-]</label><label class="expand" for="c-40461159">[2 more]</label></div><br/><div class="children"><div class="content">the problem as you said is that the common denominator between all filesystem that are currently in use is to practically forget that metadata exist because you&#x27;re only one filesystem transfer away from it disappearing (copy from one hdd to another, sent to cloud, transfer with a usb, etc ...)<p>the other problem is that the filesystem&#x2F; desktop environment closely entangles 2 concepts that imho should&#x27;ve been more orthogonal. 
- data storage+indexing for apps (a common unified KV store would&#x27;ve been more general abstraction that can be used to build upon other kind of abstractions, would be nice if yo could define your own indexing instead of what&#x27;s done with folders)
- data&#x2F;information access for users in the &quot;desktop environment&quot;</div><br/><div id="40463810" class="c"><input type="checkbox" id="c-40463810" checked=""/><div class="controls bullet"><span class="by">rchard2scout</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40461159">parent</a><span>|</span><a href="#40464063">next</a><span>|</span><label class="collapse" for="c-40463810">[-]</label><label class="expand" for="c-40463810">[1 more]</label></div><br/><div class="children"><div class="content">&gt;common unified KV store<p>So, something like the Windows Registry?</div><br/></div></div></div></div></div></div><div id="40464063" class="c"><input type="checkbox" id="c-40464063" checked=""/><div class="controls bullet"><span class="by">pjc50</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40455641">parent</a><span>|</span><a href="#40460574">prev</a><span>|</span><a href="#40457827">next</a><span>|</span><label class="collapse" for="c-40464063">[-]</label><label class="expand" for="c-40464063">[1 more]</label></div><br/><div class="children"><div class="content">&gt; universal format&#x2F;protocol agnostic<p>That&#x27;s not a &quot;should we&quot;, that&#x27;s a &quot;we can&#x27;t&quot;. Too bit a civilization-level project.</div><br/></div></div><div id="40457827" class="c"><input type="checkbox" id="c-40457827" checked=""/><div class="controls bullet"><span class="by">bobthecowboy</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40455641">parent</a><span>|</span><a href="#40464063">prev</a><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40457827">[-]</label><label class="expand" for="c-40457827">[4 more]</label></div><br/><div class="children"><div class="content">My gut reaction to this was &quot;isn&#x27;t that just sqlite&quot;?<p>I don&#x27;t think this is what you were thinking of, but I do kind of love the idea of formalizing sqlite file formats where the &quot;metadata&quot; is standardized and the &quot;file&quot; is stored inside.  Like a file format for a recipe, or a picture, or ...</div><br/><div id="40457882" class="c"><input type="checkbox" id="c-40457882" checked=""/><div class="controls bullet"><span class="by">brirec</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40457827">parent</a><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40457882">[-]</label><label class="expand" for="c-40457882">[3 more]</label></div><br/><div class="children"><div class="content">Isn’t <i>that</i> just a container format, like what video and audio files have used for decades?<p>I don’t know of any existing container formats with support for a relational DB as one of the embedded streams, but the whole point of container formats is that you <i>can</i> add arbitrary metadata, which of course can be a whole database.<p>Of course, the way BeOS does what OP is talking about is by having many DB columns within the filesystem itself! (The filesystem <i>is</i> a queryable database).</div><br/><div id="40458318" class="c"><input type="checkbox" id="c-40458318" checked=""/><div class="controls bullet"><span class="by">bobthecowboy</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40457882">parent</a><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40458318">[-]</label><label class="expand" for="c-40458318">[2 more]</label></div><br/><div class="children"><div class="content">Yes, I totally get the distinction (and I was among those amazed by BeOS back in the day - I still show the old demo videos to friends who haven&#x27;t seen it).  I hadn&#x27;t considered the container formats used by media, but in my head it would be the other way around - each file would be a sqlite file <i>first</i> so that they all share some commonality around access and inspection (I&#x27;m assuming in my ignorance that the media container formats are different).<p>Are there any database filesystems today?  I haven&#x27;t really looked, but the last one I heard of was the one that MS abandoned years ago.  Actually I suppose Haiku probably still has one?  I can&#x27;t imagine how difficult it would be to get a DB Filesystem as a mainstream choice on Linux, let alone across OSen.</div><br/><div id="40463756" class="c"><input type="checkbox" id="c-40463756" checked=""/><div class="controls bullet"><span class="by">pjerem</span><span>|</span><a href="#40455399">root</a><span>|</span><a href="#40458318">parent</a><span>|</span><a href="#40464022">next</a><span>|</span><label class="collapse" for="c-40463756">[-]</label><label class="expand" for="c-40463756">[1 more]</label></div><br/><div class="children"><div class="content">If you want something more tangible than old demos, try HaikuOS. It works wonderfully from a usb drive.<p>I’m too young to have known BeOS (well I was a kid in the nineties so not too young but afaik, BeOS was pretty rare (overall and) at home. However  I’m old enough to have known OSes that were build around offline usage and that’s what I loved trying Haiku is that it remembers me when your OS was made to use your computer, not to be an internet client.<p>I feel that having your emails as files is a good example of that : you connect to the internet to get your mails. You disconnect. You want to work to those mails on another computer ? No problem, just copy paste them on a USB d… I mean floppy disk, answer your mails put the answers on your floppy disk and send them tonight when you’re back home.<p>It may feel pretty cumbersome when we have today’s tools but that’s the feeling I feel I lost : owning my data not only legally but physically. And not only physically but physically in a useful way.<p>It remembers me the time when you just had to understand simple abstractions like files and folders and windows to own the computer (and you were just learning some programming language away to master it).</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40464022" class="c"><input type="checkbox" id="c-40464022" checked=""/><div class="controls bullet"><span class="by">stephen_cagle</span><span>|</span><a href="#40455399">prev</a><span>|</span><a href="#40455691">next</a><span>|</span><label class="collapse" for="c-40464022">[-]</label><label class="expand" for="c-40464022">[1 more]</label></div><br/><div class="children"><div class="content">Are there other good alternatives for treating email as simple files that I can contrast this with? I&#x27;m quite surprised that this does not already exist? Are there hybrid approaches like FUSE filesystem to your email?</div><br/></div></div><div id="40455691" class="c"><input type="checkbox" id="c-40455691" checked=""/><div class="controls bullet"><span class="by">tracker1</span><span>|</span><a href="#40464022">prev</a><span>|</span><a href="#40460990">next</a><span>|</span><label class="collapse" for="c-40455691">[-]</label><label class="expand" for="c-40455691">[9 more]</label></div><br/><div class="children"><div class="content">It&#x27;s a somewhat interesting idea... I&#x27;ve had similar ideas in the past regarding maildir replacement without resorting to a db file.  I like the idea of having directories representing email dir&#x2F;folders, you generally will want some level of aggregation and&#x2F;or search...  I&#x27;ve thought that having separate eml (header + body) along with a .meta.json file for additional tagging&#x2F;details (deleted flag, tags, etc).<p>Search is a very different story, you wouldn&#x27;t want to have to do a full directory scan for text based search.  So some level of indexing would be useful for a client mail service.<p>Similarly, I&#x27;ve thought it would be really cool if Cloudflare offered a TCP worker option, you could to a simple mail service backed by R2.  The web ui&#x2F;ux could be pretty awesome and geo distributed.</div><br/><div id="40457026" class="c"><input type="checkbox" id="c-40457026" checked=""/><div class="controls bullet"><span class="by">rakoo</span><span>|</span><a href="#40455691">parent</a><span>|</span><a href="#40463524">next</a><span>|</span><label class="collapse" for="c-40457026">[-]</label><label class="expand" for="c-40457026">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Search is a very different story, you wouldn&#x27;t want to have to do a full directory scan for text based search. So some level of indexing would be useful for a client mail service.<p>While notmuch and mu exist, I myself use the mblaze suite (<a href="https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;mblaze">https:&#x2F;&#x2F;github.com&#x2F;leahneukirchen&#x2F;mblaze</a>) and it&#x27;s more than enough for me. As a totally unscientific benchmark, it takes 300 ms to find 7 mails out of 24k when searching in headers, 4 seconds when searching in the body.<p>I myself use a different way: I convert the entire (all 24k of them) list of emails to 1-lines with Sender, Subject, Date, Folder and feed it to fzf which gives me preview as well. The search is then instant; on the given fields only, but I never need more than that. This is my full MUA: <a href="https:&#x2F;&#x2F;sr.ht&#x2F;~rakoo&#x2F;omail&#x2F;" rel="nofollow">https:&#x2F;&#x2F;sr.ht&#x2F;~rakoo&#x2F;omail&#x2F;</a></div><br/></div></div><div id="40463524" class="c"><input type="checkbox" id="c-40463524" checked=""/><div class="controls bullet"><span class="by">zimpenfish</span><span>|</span><a href="#40455691">parent</a><span>|</span><a href="#40457026">prev</a><span>|</span><a href="#40456144">next</a><span>|</span><label class="collapse" for="c-40463524">[-]</label><label class="expand" for="c-40463524">[1 more]</label></div><br/><div class="children"><div class="content">&gt; separate<p>Then you start running into race conditions when updating &#x2F; reading.  The great thing about Maildir is that the updates can be done atomically - saves you a lot of locking and complexity.</div><br/></div></div><div id="40456144" class="c"><input type="checkbox" id="c-40456144" checked=""/><div class="controls bullet"><span class="by">arp242</span><span>|</span><a href="#40455691">parent</a><span>|</span><a href="#40463524">prev</a><span>|</span><a href="#40457839">next</a><span>|</span><label class="collapse" for="c-40456144">[-]</label><label class="expand" for="c-40456144">[4 more]</label></div><br/><div class="children"><div class="content">&gt; Search is a very different story, you wouldn&#x27;t want to have to do a full directory scan for text based search. So some level of indexing would be useful for a client mail service.<p>I don&#x27;t know; my ~&#x2F;code directory has tons of stuff and searching with ripgrep doesn&#x27;t seem too slow:<p><pre><code>  % time rg HelloWorld | wc -l
  4
  rg HelloWorld &gt; &#x2F;dev&#x2F;null  0.13s user 0.12s system 99% cpu 0.251 total

  % time rg string | wc -l
  57813
  rg string &gt; &#x2F;dev&#x2F;null  0.20s user 0.14s system 99% cpu 0.339 total

</code></pre>
Rough estimate of files that rg will search:<p><pre><code>  % scc
  ───────────────────────────────────────────────────────────────────────────────
  Language                     Files       Lines     Blanks    Comments      Code
  …
  Total                        11024     1864982     175565      208777   1480640
  ───────────────────────────────────────────────────────────────────────────────
</code></pre>
Finding close to 60k matches in 11k files&#x2F;1.7M lines in about 0.3 seconds isn&#x27;t too bad.<p>It should be said I ran a few commands on that directory before the above results, so there&#x27;s probably some filesystem caching going on, but I can&#x27;t be bothered to reboot.<p>For many (not all, obviously) cases I think you may be able to get away without a index. Most people aren&#x27;t subscribed to tons of email lists and get maybe a few emails a day at the most.<p>I&#x27;d consider anything below ~3 seconds to be fine for search, so this scales to about 100k files&#x2F;emails. At 10 emails&#x2F;day on average that&#x27;s about a decade. Most people do not get 10 emails&#x2F;day on average.<p>And you can even do some &quot;poor man indexing&quot; by just making a new directory every five or ten years. Most of the time you want just emails from the last year or so.</div><br/><div id="40456683" class="c"><input type="checkbox" id="c-40456683" checked=""/><div class="controls bullet"><span class="by">Arelius</span><span>|</span><a href="#40455691">root</a><span>|</span><a href="#40456144">parent</a><span>|</span><a href="#40458359">next</a><span>|</span><label class="collapse" for="c-40456683">[-]</label><label class="expand" for="c-40456683">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Most people do not get 10 emails&#x2F;day on average.<p>I&#x27;d like to see the stats, but I seem to average around &gt; 40 emails a day, (most are unactionable) but always considered my email load quite light. For people like my wife who do much of their work communication over email, it appears to be much higher.</div><br/></div></div><div id="40458359" class="c"><input type="checkbox" id="c-40458359" checked=""/><div class="controls bullet"><span class="by">tracker1</span><span>|</span><a href="#40455691">root</a><span>|</span><a href="#40456144">parent</a><span>|</span><a href="#40456683">prev</a><span>|</span><a href="#40457839">next</a><span>|</span><label class="collapse" for="c-40458359">[-]</label><label class="expand" for="c-40458359">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m also considering a Server&#x2F;Service that has a web ui component, where it&#x27;s shared server resources... yeah, running a search on a local ssd&#x2F;nvme is crazy fast... now do it when there are 100k other users on that filesystem.</div><br/></div></div></div></div><div id="40457839" class="c"><input type="checkbox" id="c-40457839" checked=""/><div class="controls bullet"><span class="by">geek_at</span><span>|</span><a href="#40455691">parent</a><span>|</span><a href="#40456144">prev</a><span>|</span><a href="#40457473">next</a><span>|</span><label class="collapse" for="c-40457839">[-]</label><label class="expand" for="c-40457839">[1 more]</label></div><br/><div class="children"><div class="content">not 100% related but I have build OpenTrashmail [1] which gives you the emails in 3 variants. As folders on disk (no DB used), as RSS feed or as JSON feed. Which satisfied my needs for local management of emails<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;HaschekSolutions&#x2F;opentrashmail">https:&#x2F;&#x2F;github.com&#x2F;HaschekSolutions&#x2F;opentrashmail</a></div><br/></div></div><div id="40457473" class="c"><input type="checkbox" id="c-40457473" checked=""/><div class="controls bullet"><span class="by">mxuribe</span><span>|</span><a href="#40455691">parent</a><span>|</span><a href="#40457839">prev</a><span>|</span><a href="#40460990">next</a><span>|</span><label class="collapse" for="c-40457473">[-]</label><label class="expand" for="c-40457473">[1 more]</label></div><br/><div class="children"><div class="content">@tracker1  If i&#x27;m not mistaken i think thunderbird and other email clients who support conventional maildir often include a local db (such as sqlite) whose purpose tends to be mostly for helping indexing content to ease some aspects of search. That being said, as others have noted, search mostly tends to be fast enough at the filesystem level. ;-)</div><br/></div></div></div></div><div id="40460990" class="c"><input type="checkbox" id="c-40460990" checked=""/><div class="controls bullet"><span class="by">crtified</span><span>|</span><a href="#40455691">prev</a><span>|</span><a href="#40462999">next</a><span>|</span><label class="collapse" for="c-40460990">[-]</label><label class="expand" for="c-40460990">[1 more]</label></div><br/><div class="children"><div class="content">Vaguely related anecdote with no punchline.<p>Over a decade ago I developed, for our small (small enough to not have any IT dept or IT management) office a bespoke extension for Outlook (yes, bad idea, I know) which translated all incoming emails and attachments into the standard file system, decanted into project folders.<p>It was triggered upon any opening of an Unread email, and required the user to pick a project from a list, and hit OK. Cancelling was an option (for personal emails).<p>There was a config tab for the admin to define the filename string, by arranging elements like date&#x2F;time&#x2F;to&#x2F;from&#x2F;subject&#x2F;.., and any attachments were also placed as files.<p>A <i>very</i> imperfect approach, but under the circumstances it was a vast improvement over the prior mess of individual mailboxes bestrewn with all manner of project correspondence and files, which made intricate queries about past doings into frustrating spaghettified detanglements.<p>And ultimately - perhaps like a good deal of IT - at heart was uninformed management, and the reality of ordinary users with little notion of information management.</div><br/></div></div><div id="40462999" class="c"><input type="checkbox" id="c-40462999" checked=""/><div class="controls bullet"><span class="by">follower</span><span>|</span><a href="#40460990">prev</a><span>|</span><a href="#40463060">next</a><span>|</span><label class="collapse" for="c-40462999">[-]</label><label class="expand" for="c-40462999">[1 more]</label></div><br/><div class="children"><div class="content">Note that it seems some details of the spec have changed since the blog post was written, so the linked blog post is slightly outdated&#x2F;lagging behind the actual spec document here: <a href="https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;" rel="nofollow">https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;</a><p>(Which I discovered when I ran into this project yesterday.)<p>via conversation on the mailing it seems there are currently two WIP Rust crates&#x2F;libraries being developed to implement the spec--one by the primary spec writer &amp; another by an &quot;email-interested&quot; :) 3rd party, developed independently (AIUI) in part as an exploration of library API design space.</div><br/></div></div><div id="40463060" class="c"><input type="checkbox" id="c-40463060" checked=""/><div class="controls bullet"><span class="by">foresto</span><span>|</span><a href="#40462999">prev</a><span>|</span><a href="#40458058">next</a><span>|</span><label class="collapse" for="c-40463060">[-]</label><label class="expand" for="c-40463060">[2 more]</label></div><br/><div class="children"><div class="content">What always nagged at me about the one-file-per-message approach is what happens when you accumulate <i>many</i> messages, perhaps by being on high-volume mailing lists, or never throwing anything away, or both. In particular:<p>How much space is wasted due to partially filled filesystem blocks? This is less important with today&#x27;s workstation drives than it was 30 years ago, but perhaps still relevant on a single-board computer with limited flash storage, for example.<p>How does performance suffer from scanning a directory with millions of files, or if they&#x27;re spread across multiple directories, from traversing the directories? Even if the delivery and user agents handle it well, what about the command line tools that would make one-file-per-message appealing? What if it&#x27;s a network filesystem?<p>Filesystems can be chosen and tuned for their expected contents, of course, as usenet admins once did for news spools. But most users won&#x27;t maintain a special filesystem just for email; they will expect it to work well on the same fs that they use for everything else.<p>With those considerations in mind, I can understand the appeal of multiple messages per file, whether it&#x27;s a database or just plain old mbox format with a nearby index.<p>Neither approach seems strictly better than the other.</div><br/><div id="40463513" class="c"><input type="checkbox" id="c-40463513" checked=""/><div class="controls bullet"><span class="by">zimpenfish</span><span>|</span><a href="#40463060">parent</a><span>|</span><a href="#40458058">next</a><span>|</span><label class="collapse" for="c-40463513">[-]</label><label class="expand" for="c-40463513">[1 more]</label></div><br/><div class="children"><div class="content">&gt; as usenet admins once did for news spools<p>Message-per-file was abandoned pretty quickly once the volume started to go up in favour of things like Diablo&#x27;s &quot;huge file that&#x27;s a circular buffer&quot; approach.  Then the tuning was more about, IIRC, how big you could make inodes to efficiently handle huge (100s of GB) files (not really a problem for mail messages!)<p>(although I have to say I am 20 years out of usenet admin and maybe things have swung back towards the INN style - it does make long retention easier and modern filesystems are probably much better.  Back then we were experimenting with everything from JFS to XFS to FreeBSD to ...)</div><br/></div></div></div></div><div id="40458058" class="c"><input type="checkbox" id="c-40458058" checked=""/><div class="controls bullet"><span class="by">Aloisius</span><span>|</span><a href="#40463060">prev</a><span>|</span><a href="#40463915">next</a><span>|</span><label class="collapse" for="c-40458058">[-]</label><label class="expand" for="c-40458058">[1 more]</label></div><br/><div class="children"><div class="content">For MacOS, extracting attachments into files is useful so that Spotlight can index them for search. I believe the same is true for Windows.<p>Mail.app, uses a directory structure that looks similar* to this for say, gmail:<p><pre><code>    {account-uuid}&#x2F;[Gmail].mbox&#x2F;All Mail.mbox&#x2F;{mailbox-guid}&#x2F;Data&#x2F;Messages&#x2F;{msguid}.partial.emlx

    {account-uuid}&#x2F;[Gmail].mbox&#x2F;All Mail.mbox&#x2F;{mailbox-guid}&#x2F;Data&#x2F;Attachments&#x2F;{msguid}&#x2F;{mime part #}&#x2F;{mime subpart #}&#x2F;filename.ext
</code></pre>
The emlx format is a bit different from eml. It contains the number of bytes for the message at the top and an xml plist at the end that has message flags, last viewed time, gmail labels, etc. For partial.emlx files, the base64 content is removed from the email itself and a content length is added.<p>This format has its drawbacks, of course.<p>* Not shown is the hierarchy based on message uid used to keep the number of files in the Messages directory down.</div><br/></div></div><div id="40463915" class="c"><input type="checkbox" id="c-40463915" checked=""/><div class="controls bullet"><span class="by">childintime</span><span>|</span><a href="#40458058">prev</a><span>|</span><a href="#40456178">next</a><span>|</span><label class="collapse" for="c-40463915">[-]</label><label class="expand" for="c-40463915">[1 more]</label></div><br/><div class="children"><div class="content">Wow, a spec with a filename with colons in it. Going crazy.<p>How about something like this instead:<p>20230904T1347-sender@example.com-GTfrlwJfN5vyR28R<p>Fewer underscore also mean better readability to me.</div><br/></div></div><div id="40456178" class="c"><input type="checkbox" id="c-40456178" checked=""/><div class="controls bullet"><span class="by">Gys</span><span>|</span><a href="#40463915">prev</a><span>|</span><a href="#40463574">next</a><span>|</span><label class="collapse" for="c-40456178">[-]</label><label class="expand" for="c-40456178">[1 more]</label></div><br/><div class="children"><div class="content">The mail protocol is plain text so it’s not difficult to save emails as individual files. I had such setup some years ago for a company. Emails were stored in one folder per week, each email in its own subfolder with attachments extracted and a meta text file. References were in a database.<p>I also remember working with a windows email server that saved all emails only as files, no db, although the directory structure was more complicated. But that was maybe 20 years ago…</div><br/></div></div><div id="40463574" class="c"><input type="checkbox" id="c-40463574" checked=""/><div class="controls bullet"><span class="by">adius</span><span>|</span><a href="#40456178">prev</a><span>|</span><a href="#40462081">next</a><span>|</span><label class="collapse" for="c-40463574">[-]</label><label class="expand" for="c-40463574">[1 more]</label></div><br/><div class="children"><div class="content">Can somebody please define a specification on how to store emails in SQLite? Seems to be the only sensible approach if you ask me.</div><br/></div></div><div id="40462081" class="c"><input type="checkbox" id="c-40462081" checked=""/><div class="controls bullet"><span class="by">makeitdouble</span><span>|</span><a href="#40463574">prev</a><span>|</span><a href="#40456094">next</a><span>|</span><label class="collapse" for="c-40462081">[-]</label><label class="expand" for="c-40462081">[1 more]</label></div><br/><div class="children"><div class="content">There seems to be nothing about performance and how to deal with file count within a directory.<p>Anyone who tried to naively store millions of files in a file system folder realizes at some point that listing files becomes horrible, there&#x27;s no GUI tool that will handle that gracefully, and even on the CLI this is a very serious roadblock.<p>It&#x27;s still fine for accessing files straight by name, and there must be ways to read each file sequentially, but the concept of folder merely becomes an arbitrary namespace and not something to handle a whole group.<p>The other obvious option is to shard the mail folders to ensure there&#x27;s no more than X files in each folders, but that becomes pretty complex IMHO.<p>At the end of the day, a database is needed somewhere down the line.</div><br/></div></div><div id="40456094" class="c"><input type="checkbox" id="c-40456094" checked=""/><div class="controls bullet"><span class="by">jll29</span><span>|</span><a href="#40462081">prev</a><span>|</span><a href="#40460236">next</a><span>|</span><label class="collapse" for="c-40456094">[-]</label><label class="expand" for="c-40456094">[6 more]</label></div><br/><div class="children"><div class="content">One wonders why email isn&#x27;t kept in a well-thought out directory structure since the beginnings of UNIX, given that almost anything is a file in UNIX, and especially given the power of UNIX text processing tools.</div><br/><div id="40456160" class="c"><input type="checkbox" id="c-40456160" checked=""/><div class="controls bullet"><span class="by">technofiend</span><span>|</span><a href="#40456094">parent</a><span>|</span><a href="#40456519">next</a><span>|</span><label class="collapse" for="c-40456160">[-]</label><label class="expand" for="c-40456160">[2 more]</label></div><br/><div class="children"><div class="content">If you&#x27;d like to try it, MH uses directories and files for managing your email: <a href="https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;emacs&#x2F;manual&#x2F;html_node&#x2F;mh-e&#x2F;index.html" rel="nofollow">https:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;emacs&#x2F;manual&#x2F;html_node&#x2F;mh-e&#x2F;ind...</a>  As you mentioned this is the unix way and MH (according to Wikipedia) dates back to 1979: <a href="https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;MH_Message_Handling_System" rel="nofollow">https:&#x2F;&#x2F;en.m.wikipedia.org&#x2F;wiki&#x2F;MH_Message_Handling_System</a></div><br/><div id="40459462" class="c"><input type="checkbox" id="c-40459462" checked=""/><div class="controls bullet"><span class="by">MassPikeMike</span><span>|</span><a href="#40456094">root</a><span>|</span><a href="#40456160">parent</a><span>|</span><a href="#40456519">next</a><span>|</span><label class="collapse" for="c-40459462">[-]</label><label class="expand" for="c-40459462">[1 more]</label></div><br/><div class="children"><div class="content">The parent&#x27;s pointer is to &quot;MH-E&quot;, the emacs package, which is a great interface to MH for folks who use emacs to read their email.<p>For folks who don&#x27;t, I wanted to clarify that MH also works great outside of emacs. Its command-line tools are composable, so you can do things like reply to the first message about chess sent this week:<p>repl `pick -subject chess -after &quot;19 May 24 0000 PST&quot;`<p>Using them in scripts is especially powerful.<p>The modern implementation is &quot;nmh&quot;, &quot;New Message Handler&quot;, <a href="https:&#x2F;&#x2F;www.nongnu.org&#x2F;nmh&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.nongnu.org&#x2F;nmh&#x2F;</a>. MH was the mail system within MIT&#x27;s Athena computing environment back in the day, so many MIT folks developed a fondness for it and it retains a following. There&#x27;s even a very comprehensive O&#x27;Reilly book, free online: <a href="https:&#x2F;&#x2F;rand-mh.sourceforge.io&#x2F;book&#x2F;" rel="nofollow">https:&#x2F;&#x2F;rand-mh.sourceforge.io&#x2F;book&#x2F;</a></div><br/></div></div></div></div><div id="40456519" class="c"><input type="checkbox" id="c-40456519" checked=""/><div class="controls bullet"><span class="by">PurpleRamen</span><span>|</span><a href="#40456094">parent</a><span>|</span><a href="#40456160">prev</a><span>|</span><a href="#40460236">next</a><span>|</span><label class="collapse" for="c-40456519">[-]</label><label class="expand" for="c-40456519">[3 more]</label></div><br/><div class="children"><div class="content">There were multiple formats for storing mails through the times. And many are using folders. But each format has their own problems, and were optimized for certain benefits. And on unix you have to make this workable with multiple programs accessing them in parallel, because in the early days there were no servers who had tight control over everything. So, formats were often designed around using or preventing file locks, making efficient use of storage or allowing fast handling and management of mail-flags.</div><br/><div id="40460147" class="c"><input type="checkbox" id="c-40460147" checked=""/><div class="controls bullet"><span class="by">mbreese</span><span>|</span><a href="#40456094">root</a><span>|</span><a href="#40456519">parent</a><span>|</span><a href="#40459459">next</a><span>|</span><label class="collapse" for="c-40460147">[-]</label><label class="expand" for="c-40460147">[1 more]</label></div><br/><div class="children"><div class="content">Not even just common formats, but way back, Mail was delivered by copying files from one server to another. I (barely) remember using UUCP before SMTP&#x2F;NNTP to sync Mail and news. So, the format that you stored messages in was very important. It’s easy to copy a single message when it is a complete file.</div><br/></div></div><div id="40459459" class="c"><input type="checkbox" id="c-40459459" checked=""/><div class="controls bullet"><span class="by">ck45</span><span>|</span><a href="#40456094">root</a><span>|</span><a href="#40456519">parent</a><span>|</span><a href="#40460147">prev</a><span>|</span><a href="#40460236">next</a><span>|</span><label class="collapse" for="c-40459459">[-]</label><label class="expand" for="c-40459459">[1 more]</label></div><br/><div class="children"><div class="content">For a quite long time, a very popular format was mbox (the most popular?), which is a single file. With the arrival of qmail, it was slowly replaced by Maildir.</div><br/></div></div></div></div></div></div><div id="40460236" class="c"><input type="checkbox" id="c-40460236" checked=""/><div class="controls bullet"><span class="by">AdieuToLogic</span><span>|</span><a href="#40456094">prev</a><span>|</span><a href="#40459176">next</a><span>|</span><label class="collapse" for="c-40460236">[-]</label><label class="expand" for="c-40460236">[1 more]</label></div><br/><div class="children"><div class="content">Whenever I see efforts to treat email as files, I fondly think of my time using nmh[0].  Until the pervasive use of multimedia email, nmh was a really nice way to communicate with email IMHO.<p>0 - <a href="https:&#x2F;&#x2F;www.nongnu.org&#x2F;nmh&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.nongnu.org&#x2F;nmh&#x2F;</a></div><br/></div></div><div id="40459176" class="c"><input type="checkbox" id="c-40459176" checked=""/><div class="controls bullet"><span class="by">QasimK</span><span>|</span><a href="#40460236">prev</a><span>|</span><a href="#40456437">next</a><span>|</span><label class="collapse" for="c-40459176">[-]</label><label class="expand" for="c-40459176">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been thinking about doing this myself, so it&#x27;s fantastic to see a project.<p>I find a files-centric (and more broadly filesystem-centric) approach easier to grapple with than one that focuses on apps (and hiding away the data). It makes it much easier to access my own data for other purposes outside of what the app provides. In particular when the files are in plain-text or otherwise human-editable. I can reuse all of the existing tool that I&#x27;m familiar with to search, modify or re-purpose the data.</div><br/><div id="40459731" class="c"><input type="checkbox" id="c-40459731" checked=""/><div class="controls bullet"><span class="by">skydhash</span><span>|</span><a href="#40459176">parent</a><span>|</span><a href="#40456437">next</a><span>|</span><label class="collapse" for="c-40459731">[-]</label><label class="expand" for="c-40459731">[1 more]</label></div><br/><div class="children"><div class="content">I can do away with files if the app provides scripting capabilities (IPC, plugins,...). I know the average users won&#x27;t use it, but if you&#x27;ve nailed down your workflow, it&#x27;s liberating to be able to speed up parts of it.</div><br/></div></div></div></div><div id="40456437" class="c"><input type="checkbox" id="c-40456437" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#40459176">prev</a><span>|</span><a href="#40459781">next</a><span>|</span><label class="collapse" for="c-40456437">[-]</label><label class="expand" for="c-40456437">[2 more]</label></div><br/><div class="children"><div class="content">Is there a reason why metadata and the message are stored so separately? I.e. why<p><pre><code>   INBOX&#x2F;2023-09-04_13:47_builds@sr.ht,GTfrlwJfN5vyR28R
   INBOX&#x2F;.meta&#x2F;GTfrlwJfN5vyR28R.flags
</code></pre>
instead of<p><pre><code>   INBOX&#x2F;2023-09-04_13:47_builds@sr.ht,GTfrlwJfN5vyR28R&#x2F;message
   INBOX&#x2F;2023-09-04_13:47_builds@sr.ht,GTfrlwJfN5vyR28R&#x2F;.flags
</code></pre>
The latter structure would allow creating&#x2F;deleting the message and flags atomically.</div><br/><div id="40456663" class="c"><input type="checkbox" id="c-40456663" checked=""/><div class="controls bullet"><span class="by">mathfailure</span><span>|</span><a href="#40456437">parent</a><span>|</span><a href="#40459781">next</a><span>|</span><label class="collapse" for="c-40456663">[-]</label><label class="expand" for="c-40456663">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;d require jumping between dirs when traversing multiple messages.</div><br/></div></div></div></div><div id="40459781" class="c"><input type="checkbox" id="c-40459781" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#40456437">prev</a><span>|</span><a href="#40456717">next</a><span>|</span><label class="collapse" for="c-40459781">[-]</label><label class="expand" for="c-40459781">[3 more]</label></div><br/><div class="children"><div class="content">I was hoping the mailing list link would be to an FTP site I&#x27;d upload my email to.</div><br/><div id="40460002" class="c"><input type="checkbox" id="c-40460002" checked=""/><div class="controls bullet"><span class="by">colinsane</span><span>|</span><a href="#40459781">parent</a><span>|</span><a href="#40456717">next</a><span>|</span><label class="collapse" for="c-40460002">[-]</label><label class="expand" for="c-40460002">[2 more]</label></div><br/><div class="children"><div class="content">my chief concern with the spec was actually &quot;do FTP clients generally support `:` in a filename?&quot;<p>but then i realized i&#x27;m not likely to mount a remote M2dir so i&#x27;m far less concerned with the answer.</div><br/><div id="40462950" class="c"><input type="checkbox" id="c-40462950" checked=""/><div class="controls bullet"><span class="by">follower</span><span>|</span><a href="#40459781">root</a><span>|</span><a href="#40460002">parent</a><span>|</span><a href="#40456717">next</a><span>|</span><label class="collapse" for="c-40462950">[-]</label><label class="expand" for="c-40462950">[1 more]</label></div><br/><div class="children"><div class="content">&gt; so i&#x27;m far less concerned with the answer.<p>In that case, let me definitely take the time to provide you <i>an</i> answer then... :D<p>The linked blog post outlining the spec is slightly outdated&#x2F;lagging behind the <i>actual</i> spec document here: <a href="https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;" rel="nofollow">https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;</a><p>The updated detail relevant to your query being: the `:` separator was replaced by use of `,` (comma) as the separator instead: <a href="https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;#parsing-filenames" rel="nofollow">https:&#x2F;&#x2F;man.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;#parsing-filenames</a><p>More detail on the reasons for the change is given in the associated commit message [informative commit messages? what a novel concept! :D ]: <a href="https:&#x2F;&#x2F;git.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;commit&#x2F;100b7683f53899c836e76c13ad9fb825e827f78e" rel="nofollow">https:&#x2F;&#x2F;git.sr.ht&#x2F;~bitfehler&#x2F;m2dir&#x2F;commit&#x2F;100b7683f53899c836...</a> [TL;DR: bash &amp; NTFS&#x2F;ADS]</div><br/></div></div></div></div></div></div><div id="40456717" class="c"><input type="checkbox" id="c-40456717" checked=""/><div class="controls bullet"><span class="by">graycat</span><span>|</span><a href="#40459781">prev</a><span>|</span><a href="#40455294">next</a><span>|</span><label class="collapse" for="c-40456717">[-]</label><label class="expand" for="c-40456717">[1 more]</label></div><br/><div class="children"><div class="content">Been thinking about this subject:<p>Of course, standard (usual, common) email is just text.  Right for the pictures, to have them just as text, they are <i>encoded</i> as <i>base64</i>.  Right, its MIME (MultiMedia Internet Mail Extensions).<p>Soooo, okay, my ISP (Internet Service Provider) 
has an email service.  The service is a Web site, and it does offer getting the &quot;Source&quot;, that is, the text, all as just one file.<p>Now, suppose for each email message I send&#x2F;receive, I keep the text in its own file, with just the text, just as I got it from, say, my ISP.  I will handle the file naming, indexing, summarization, etc.<p>Help!!!!  Is there an <i>email</i> program that I can run that, for each of those files, can read it and <i>display</i> it?  Sure, it should be able to display the text, as text, that is not one of the MIME extensions but also be able to do <i>the right thing</i> for each of the rest, still images, video clips, audio, whatever.  Know of such a program????  Thanks!</div><br/></div></div><div id="40455294" class="c"><input type="checkbox" id="c-40455294" checked=""/><div class="controls bullet"><span class="by">chriscappuccio</span><span>|</span><a href="#40456717">prev</a><span>|</span><label class="collapse" for="c-40455294">[-]</label><label class="expand" for="c-40455294">[2 more]</label></div><br/><div class="children"><div class="content">As a CLI fan, I&#x27;m interested in where this could go</div><br/><div id="40456699" class="c"><input type="checkbox" id="c-40456699" checked=""/><div class="controls bullet"><span class="by">mathfailure</span><span>|</span><a href="#40455294">parent</a><span>|</span><label class="collapse" for="c-40456699">[-]</label><label class="expand" for="c-40456699">[1 more]</label></div><br/><div class="children"><div class="content">It would go only where you&#x27;d bring it to.</div><br/></div></div></div></div></div></div></div></div></div></body></html>