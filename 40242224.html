<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714726863964" as="style"/><link rel="stylesheet" href="styles.css?v=1714726863964"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.trailofbits.com/2024/05/02/the-life-and-times-of-an-abstract-syntax-tree/">The life and times of an Abstract Syntax Tree</a> <span class="domain">(<a href="https://blog.trailofbits.com">blog.trailofbits.com</a>)</span></div><div class="subtext"><span>jnord</span> | <span>11 comments</span></div><br/><div><div id="40245237" class="c"><input type="checkbox" id="c-40245237" checked=""/><div class="controls bullet"><span class="by">librasteve</span><span>|</span><a href="#40242527">next</a><span>|</span><label class="collapse" for="c-40245237">[-]</label><label class="expand" for="c-40245237">[1 more]</label></div><br/><div class="children"><div class="content">The raku devs are working away on rakuAST, which is now in v6.PREVIEW and early adoption is eased by the Slangify module <a href="https:&#x2F;&#x2F;raku.land&#x2F;zef:lizmat&#x2F;Slangify" rel="nofollow">https:&#x2F;&#x2F;raku.land&#x2F;zef:lizmat&#x2F;Slangify</a><p>raku’s killer app is its built-in Grammars … now you can write Actions that build AST right in your code. What does this mean? You can define your own Domain Specific Language (DSL) in your code and then just tag the blocks that use it. (Well raku is anyway a collaborative set of DSLs - eg for regexes, quoting constructs - but AST now makes this extensible by user code)<p>The first examples of this are Brainf*k and BASIC interpreters.<p>Checkout this introduction… <a href="https:&#x2F;&#x2F;dev.to&#x2F;lizmat&#x2F;rakuast-for-early-adopters-576n" rel="nofollow">https:&#x2F;&#x2F;dev.to&#x2F;lizmat&#x2F;rakuast-for-early-adopters-576n</a></div><br/></div></div><div id="40242527" class="c"><input type="checkbox" id="c-40242527" checked=""/><div class="controls bullet"><span class="by">chc4</span><span>|</span><a href="#40245237">prev</a><span>|</span><a href="#40242584">next</a><span>|</span><label class="collapse" for="c-40242527">[-]</label><label class="expand" for="c-40242527">[1 more]</label></div><br/><div class="children"><div class="content">Starting a paragraph about how to &quot;safely&quot; remove safeguards, and then tongue-in-cheek joking about Rust, kind of looks worse when your very first example isn&#x27;t safe and liable to segfault even before the &quot;proverbial gun&quot; variant :)<p>It needs to be<p>&gt; auto &amp;lhs = *node_storage.emplace_back(make_unique(...));<p>instead of dereferencing lhs on the third line: emplace_back returns a reference to the inserted item, so it&#x27;s a &amp;unique_ptr...and that reference is invalidated by the rhs emplace_back reallocating the vector.<p>Rust also has a number of easy to use ways to do the same thing - slotmap or typed_arena are the standard, or just doing the vector indices scheme manually like at the bottom: this post is talking in circles around the fact the vector is really being used as an arena allocator without saying that, and so has obvious problems with it being extremely fragile to anyone who reads the type and expects it to be vector-like. It would probably do better explicitly saying that and linking to the wikipedia page or whatever, so the reader can look into the proper way of doing the code pattern.</div><br/></div></div><div id="40242584" class="c"><input type="checkbox" id="c-40242584" checked=""/><div class="controls bullet"><span class="by">Rusky</span><span>|</span><a href="#40242527">prev</a><span>|</span><a href="#40243945">next</a><span>|</span><label class="collapse" for="c-40242584">[-]</label><label class="expand" for="c-40242584">[2 more]</label></div><br/><div class="children"><div class="content">There&#x27;s another, much nicer, solution to the contiguous allocation problem: use a proper arena allocator. This is essentially the article&#x27;s `std::deque` option, but without the downsides of &quot;every node is the same size&quot; or Microsoft&#x27;s deque implementation.<p>You can get 90% of the way there by expanding the `vector`+`reserve` approach to keep a list of vectors, and allocate a new one whenever the previous one fills up. Replace the vectors with untyped byte buffers, and you can fill them with objects of different sizes.<p>This is quite reasonable to do even in Rust, e.g. with bumpalo: <a href="https:&#x2F;&#x2F;docs.rs&#x2F;bumpalo&#x2F;latest&#x2F;bumpalo&#x2F;" rel="nofollow">https:&#x2F;&#x2F;docs.rs&#x2F;bumpalo&#x2F;latest&#x2F;bumpalo&#x2F;</a>.</div><br/><div id="40242778" class="c"><input type="checkbox" id="c-40242778" checked=""/><div class="controls bullet"><span class="by">nu11ptr</span><span>|</span><a href="#40242584">parent</a><span>|</span><a href="#40243945">next</a><span>|</span><label class="collapse" for="c-40242778">[-]</label><label class="expand" for="c-40242778">[1 more]</label></div><br/><div class="children"><div class="content">I admit I was also thinking arena allocator the whole time I was reading that. I think it would work rather well since you are building up a tree piece by piece.</div><br/></div></div></div></div><div id="40243945" class="c"><input type="checkbox" id="c-40243945" checked=""/><div class="controls bullet"><span class="by">Ericson2314</span><span>|</span><a href="#40242584">prev</a><span>|</span><a href="#40243118">next</a><span>|</span><label class="collapse" for="c-40243945">[-]</label><label class="expand" for="c-40243945">[2 more]</label></div><br/><div class="children"><div class="content">This is why I really like compacting garbage collection:<p>- Don&#x27;t have to think about this stuff, no matter how the AST is manipulated.<p>- Get locality for free from live objects being compacted together<p>A pretty good deal!</div><br/><div id="40245168" class="c"><input type="checkbox" id="c-40245168" checked=""/><div class="controls bullet"><span class="by">sirwhinesalot</span><span>|</span><a href="#40243945">parent</a><span>|</span><a href="#40243118">next</a><span>|</span><label class="collapse" for="c-40245168">[-]</label><label class="expand" for="c-40245168">[1 more]</label></div><br/><div class="children"><div class="content">I recently implemented a compacting garbage collected arena in C, was surprised at how simple it was to make (though I need to still improve some things). I wonder why it&#x27;s not used more? Just keep the really huge non-temp data buffers in a different datastructure so they don&#x27;t need to be compacted, otherwise you can go wild with allocations and never have a use-after-free.</div><br/></div></div></div></div><div id="40243118" class="c"><input type="checkbox" id="c-40243118" checked=""/><div class="controls bullet"><span class="by">chubot</span><span>|</span><a href="#40243945">prev</a><span>|</span><a href="#40243264">next</a><span>|</span><label class="collapse" for="c-40243118">[-]</label><label class="expand" for="c-40243118">[1 more]</label></div><br/><div class="children"><div class="content">Some related references (on a somewhat messy wiki page) - <a href="https:&#x2F;&#x2F;github.com&#x2F;oilshell&#x2F;oil&#x2F;wiki&#x2F;Compact-AST-Representation">https:&#x2F;&#x2F;github.com&#x2F;oilshell&#x2F;oil&#x2F;wiki&#x2F;Compact-AST-Representat...</a><p>Feel free to add others</div><br/></div></div><div id="40243264" class="c"><input type="checkbox" id="c-40243264" checked=""/><div class="controls bullet"><span class="by">pipeline_peak</span><span>|</span><a href="#40243118">prev</a><span>|</span><label class="collapse" for="c-40243264">[-]</label><label class="expand" for="c-40243264">[3 more]</label></div><br/><div class="children"><div class="content">Is learning how compilers work or how to implement them still worth it with AI replacing programming?</div><br/><div id="40245388" class="c"><input type="checkbox" id="c-40245388" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#40243264">parent</a><span>|</span><a href="#40243359">next</a><span>|</span><label class="collapse" for="c-40245388">[-]</label><label class="expand" for="c-40245388">[1 more]</label></div><br/><div class="children"><div class="content">Show me several convincing examples of AI replacing programming.<p>Don&#x27;t fall for hype, this is not happening. We only got some okay snippet generators and some semi-adequate translators of simple pieces of code, from a limited set of languages to another.<p>There&#x27;s nothing else. AI is not replacing programming yet. Or even soon.</div><br/></div></div><div id="40243359" class="c"><input type="checkbox" id="c-40243359" checked=""/><div class="controls bullet"><span class="by">kevindamm</span><span>|</span><a href="#40243264">parent</a><span>|</span><a href="#40245388">prev</a><span>|</span><label class="collapse" for="c-40243359">[-]</label><label class="expand" for="c-40243359">[1 more]</label></div><br/><div class="children"><div class="content">Yes.  Knowing how the language is transformed into running code helps your mental model for simulating the process as thoughts.<p>You still have to read and validate the code that an LLM emits, and some code will be faster for you to type than it is to prompt,wait,correct,test,adapt etc.  It may even help in describing the problem to the LLM, as knowledge of the appropriate language terms will guide the context along the right lines.<p>And it&#x27;s also fulfilling to design programming languages, whether general purpose or DSLs, at least in my opinion.</div><br/></div></div></div></div></div></div></div></div></div></body></html>