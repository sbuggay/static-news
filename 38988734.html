<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1705395658247" as="style"/><link rel="stylesheet" href="styles.css?v=1705395658247"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lemire.me/blog/2024/01/13/estimating-your-memory-bandwidth/">Estimating your memory bandwidth</a>Â <span class="domain">(<a href="https://lemire.me">lemire.me</a>)</span></div><div class="subtext"><span>ingve</span> | <span>8 comments</span></div><br/><div><div id="39010410" class="c"><input type="checkbox" id="c-39010410" checked=""/><div class="controls bullet"><span class="by">anonymousDan</span><span>|</span><a href="#39011043">prev</a><span>|</span><a href="#39010168">next</a><span>|</span><label class="collapse" for="c-39010410">[-]</label><label class="expand" for="c-39010410">[1 more]</label></div><br/><div class="children"><div class="content">Any easy way to monitor current memory bandwidth consumption using Linux perf or some other command line tool? As opposed to measuring max bandwidth.</div><br/></div></div><div id="39010168" class="c"><input type="checkbox" id="c-39010168" checked=""/><div class="controls bullet"><span class="by">MrYellowP</span><span>|</span><a href="#39010410">prev</a><span>|</span><a href="#39009494">next</a><span>|</span><label class="collapse" for="c-39010168">[-]</label><label class="expand" for="c-39010168">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;m impressed that this made it to the front page, but don&#x27;t understand why.</div><br/><div id="39010350" class="c"><input type="checkbox" id="c-39010350" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#39010168">parent</a><span>|</span><a href="#39009494">next</a><span>|</span><label class="collapse" for="c-39010350">[-]</label><label class="expand" for="c-39010350">[1 more]</label></div><br/><div class="children"><div class="content">Daniel Lemire has a good reputation in the HN due to his work on simdjson and the Eisel-Lemire floating point parsing algorithm among others.</div><br/></div></div></div></div><div id="39009494" class="c"><input type="checkbox" id="c-39009494" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#39010168">prev</a><span>|</span><a href="#39009405">next</a><span>|</span><label class="collapse" for="c-39009494">[-]</label><label class="expand" for="c-39009494">[2 more]</label></div><br/><div class="children"><div class="content">Generally for this type of measurement, you need to measure the bandwidth as a function of buffer size. This reveals the various L1&#x2F;L2&#x2F;L3 bandwidths, as well as the main memory bandwidth.<p>There are some really complicated effects as well, such as: TLB cache misses, huge pages, and NUMA.<p>For example, on typical two-socket servers, half the memory is &quot;faster&quot; and half the memory is &quot;slower&quot; because it is attached to the remote CPU.<p>Here&#x27;s an example: <a href="https:&#x2F;&#x2F;images.anandtech.com&#x2F;doci&#x2F;17024&#x2F;BandwidthCPU_575px.png" rel="nofollow">https:&#x2F;&#x2F;images.anandtech.com&#x2F;doci&#x2F;17024&#x2F;BandwidthCPU_575px.p...</a></div><br/><div id="39009971" class="c"><input type="checkbox" id="c-39009971" checked=""/><div class="controls bullet"><span class="by">hobs</span><span>|</span><a href="#39009494">parent</a><span>|</span><a href="#39009405">next</a><span>|</span><label class="collapse" for="c-39009971">[-]</label><label class="expand" for="c-39009971">[1 more]</label></div><br/><div class="children"><div class="content">The NUMA stuff is a big deal if you want to have predictable performance, in my database days we&#x27;d definitely try to run a database server in one NUMA node.</div><br/></div></div></div></div><div id="39009405" class="c"><input type="checkbox" id="c-39009405" checked=""/><div class="controls bullet"><span class="by">pengaru</span><span>|</span><a href="#39009494">prev</a><span>|</span><label class="collapse" for="c-39009405">[-]</label><label class="expand" for="c-39009405">[1 more]</label></div><br/><div class="children"><div class="content">On your typical Linux host you can just run `hdparm -T $BLKDEV` (e.g. BLKDEV=&#x2F;dev&#x2F;sda here):<p><pre><code>  # hdparm -T &#x2F;dev&#x2F;sda

  &#x2F;dev&#x2F;sda:
   Timing cached reads:   19110 MB in  1.99 seconds = 9582.36 MB&#x2F;sec
</code></pre>
Which quickly tells me single-threaded memory bandwidth of ~10GB&#x2F;s (i7 X230 ThinkPad w&#x2F;2x8GB SODIMMs(16GB))<p>It&#x27;s often interesting to run multiple of these simultaneously and observe how much the per-core and aggregate bandwidth increases&#x2F;decreases with increased parallelism.</div><br/></div></div></div></div></div></div></div></body></html>