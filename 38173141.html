<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1699347658365" as="style"/><link rel="stylesheet" href="styles.css?v=1699347658365"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.hezmatt.org/~mpalmer/blog/2023/11/07/postgresql-encryption-options.html">PostgreSQL Encryption: The Available Options</a> <span class="domain">(<a href="https://www.hezmatt.org">www.hezmatt.org</a>)</span></div><div class="subtext"><span>JNRowe</span> | <span>12 comments</span></div><br/><div><div id="38173740" class="c"><input type="checkbox" id="c-38173740" checked=""/><div class="controls bullet"><span class="by">hn_throwaway_99</span><span>|</span><a href="#38173700">next</a><span>|</span><label class="collapse" for="c-38173740">[-]</label><label class="expand" for="c-38173740">[1 more]</label></div><br/><div class="children"><div class="content">Thanks for posting, very interesting project!<p>I implemented something similar at the company I work with:<p>1. All private data is encrypted&#x2F;decrypted client side using envelope encryption: a random AES key is generated to encrypt the data, and then we use KMS (which are basically the same services in both AWS and GCP) to encrypt the AES key with a public key. Thus, storing data requires no KMS API call to encrypt data, but decryption does. But we basically have per-user AES keys, and since our data access patterns are largely per-user it means we can cache the decrypted key.<p>2. We use blind indexes for lookups.<p>3. We then hit the issue of needing to order on encrypted data, and we used one of the order-respecting encryption algos but your explanation was super helpful to me! I&#x27;ll definitely look more into the Lewi-Yu scheme.<p>All in all a very cool project I look forward to digging in more. I haven&#x27;t looked yet at how you store&#x2F;retrieve the encryption keys but integration with a service like KMS would be great. For us it is ideal because all calls to KMS are auditable so we can audit exactly when data was decrypted.</div><br/></div></div><div id="38173700" class="c"><input type="checkbox" id="c-38173700" checked=""/><div class="controls bullet"><span class="by">neotrope</span><span>|</span><a href="#38173740">prev</a><span>|</span><a href="#38174141">next</a><span>|</span><label class="collapse" for="c-38173700">[-]</label><label class="expand" for="c-38173700">[3 more]</label></div><br/><div class="children"><div class="content">&gt; All this brings us to the project I run: Enquo. It takes application-layer encryption to a new level, by providing a language- and framework-agnostic cryptosystem that also enables encrypted data to be efficiently queried by the database.<p>If you want people to use this, don&#x27;t bury the lede.<p>Is this a problem worth solving? How does aws&#x2F;gcp&#x2F;azure solve for this?</div><br/><div id="38173799" class="c"><input type="checkbox" id="c-38173799" checked=""/><div class="controls bullet"><span class="by">hn_throwaway_99</span><span>|</span><a href="#38173700">parent</a><span>|</span><a href="#38174325">next</a><span>|</span><label class="collapse" for="c-38173799">[-]</label><label class="expand" for="c-38173799">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Is this a problem worth solving? How does aws&#x2F;gcp&#x2F;azure solve for this?<p>Yes. I had to build something very similar, and neither GCP nor AWS &quot;solve&quot; this at all. They provide good building block to solve it, like KMS and tools for envelope 
encryption (e.g. <a href="https:&#x2F;&#x2F;cloud.google.com&#x2F;sql&#x2F;docs&#x2F;postgres&#x2F;client-side-encryption" rel="nofollow noreferrer">https:&#x2F;&#x2F;cloud.google.com&#x2F;sql&#x2F;docs&#x2F;postgres&#x2F;client-side-encry...</a>), but importantly if you want to <i>search</i> on this encrypted data you need to role your own with something like blind indexes (the linked project explains some of the problems with that), and even harder is if you need to <i>sort</i> by that data, which this Enquo project also addresses.<p>There are a bunch of &quot;PII vaulting services&quot;, companies like Very Good Security, that provide similar solutions, but it would be ideal to have this all securely encrypted in the DB if you&#x27;re already using Postgres.</div><br/></div></div><div id="38174325" class="c"><input type="checkbox" id="c-38174325" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#38173700">parent</a><span>|</span><a href="#38173799">prev</a><span>|</span><a href="#38174141">next</a><span>|</span><label class="collapse" for="c-38174325">[-]</label><label class="expand" for="c-38174325">[1 more]</label></div><br/><div class="children"><div class="content">First, you complain that the person started by explaining the current state of the art and why a better solution is needed (&quot;don&#x27;t bury the lede&quot;).<p>Second you wonder if the problem is worth solving and what the current state of the art is, which is exactly what the text you&#x27;re complaining about answered clearly.<p>I&#x27;m personally quite happy with how they formatted this blogpost.</div><br/></div></div></div></div><div id="38174141" class="c"><input type="checkbox" id="c-38174141" checked=""/><div class="controls bullet"><span class="by">kiwicopple</span><span>|</span><a href="#38173700">prev</a><span>|</span><a href="#38174315">next</a><span>|</span><label class="collapse" for="c-38174141">[-]</label><label class="expand" for="c-38174141">[1 more]</label></div><br/><div class="children"><div class="content">I’ve never seen pg_enquo before but from first skim it looks excellent. Since it’s built with Rust it should be able to run on RDS (in theory, now that AWS supports pl&#x2F;Rust).<p>Also worth checking out this excellent extension which is a wrapper around libsodium:<p><a href="https:&#x2F;&#x2F;github.com&#x2F;michelp&#x2F;pgsodium">https:&#x2F;&#x2F;github.com&#x2F;michelp&#x2F;pgsodium</a><p>We use it at Supabase to provide our in-database “Vault”:<p><a href="https:&#x2F;&#x2F;supabase.com&#x2F;blog&#x2F;supabase-vault">https:&#x2F;&#x2F;supabase.com&#x2F;blog&#x2F;supabase-vault</a></div><br/></div></div><div id="38174315" class="c"><input type="checkbox" id="c-38174315" checked=""/><div class="controls bullet"><span class="by">lgkk</span><span>|</span><a href="#38174141">prev</a><span>|</span><a href="#38174473">next</a><span>|</span><label class="collapse" for="c-38174315">[-]</label><label class="expand" for="c-38174315">[2 more]</label></div><br/><div class="children"><div class="content">Interesting.<p>I’m still building my automation platform product and looking to encrypt my data going into db.<p>In my case I’m using Go for the backend applications. Any suggestions there?<p>Also do you suggest I do per user level keys or organization&#x2F;workspace level?<p>Working solo and there’s a lot I don’t know. Happy to learn, thanks!</div><br/><div id="38174565" class="c"><input type="checkbox" id="c-38174565" checked=""/><div class="controls bullet"><span class="by">franky47</span><span>|</span><a href="#38174315">parent</a><span>|</span><a href="#38174473">next</a><span>|</span><label class="collapse" for="c-38174565">[-]</label><label class="expand" for="c-38174565">[1 more]</label></div><br/><div class="children"><div class="content">Encryption of records should be tied to their location (table + column + row) in the DB, preferably using AEAD methods. This helps mitigate Confused Deputy attacks:<p><a href="https:&#x2F;&#x2F;soatok.blog&#x2F;2023&#x2F;03&#x2F;01&#x2F;database-cryptography-fur-the-rest-of-us&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;soatok.blog&#x2F;2023&#x2F;03&#x2F;01&#x2F;database-cryptography-fur-the...</a></div><br/></div></div></div></div><div id="38174473" class="c"><input type="checkbox" id="c-38174473" checked=""/><div class="controls bullet"><span class="by">esseti</span><span>|</span><a href="#38174315">prev</a><span>|</span><a href="#38174215">next</a><span>|</span><label class="collapse" for="c-38174473">[-]</label><label class="expand" for="c-38174473">[1 more]</label></div><br/><div class="children"><div class="content">homomorphic encryption should solve the problem of field encryption. But not now.
Note: the choice of the different solutions should be aligned with the sensitivity of the data, such as: Field Encryption for Highly sensitive (among others, bank data, health data etc), while the DB is, off course, only encrypted at rest.</div><br/></div></div><div id="38174215" class="c"><input type="checkbox" id="c-38174215" checked=""/><div class="controls bullet"><span class="by">Traubenfuchs</span><span>|</span><a href="#38174473">prev</a><span>|</span><label class="collapse" for="c-38174215">[-]</label><label class="expand" for="c-38174215">[3 more]</label></div><br/><div class="children"><div class="content">I feel like this is security theater (like most modern IT security), a marketing checkbox or a certification requirement but doesn&#x27;t protect against actually realistic attacks.<p>Are there any publicly available case reports of where an encrypted database protected data?</div><br/><div id="38174391" class="c"><input type="checkbox" id="c-38174391" checked=""/><div class="controls bullet"><span class="by">TheDong</span><span>|</span><a href="#38174215">parent</a><span>|</span><label class="collapse" for="c-38174391">[-]</label><label class="expand" for="c-38174391">[2 more]</label></div><br/><div class="children"><div class="content">I think it depends on the situation, but there&#x27;s some legitimate defense-in-depth benefits here.<p>I&#x27;ve personally run across &quot;dump.sql&quot; files before in public s3 buckets, and as I understand it, this would help in that case.</div><br/><div id="38174500" class="c"><input type="checkbox" id="c-38174500" checked=""/><div class="controls bullet"><span class="by">Traubenfuchs</span><span>|</span><a href="#38174215">root</a><span>|</span><a href="#38174391">parent</a><span>|</span><label class="collapse" for="c-38174500">[-]</label><label class="expand" for="c-38174500">[1 more]</label></div><br/><div class="children"><div class="content">&gt; &quot;dump.sql&quot; files before in public s3 buckets<p>That kind of sounds like something half of the companies I worked for would end up eventually doing, fair point.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>