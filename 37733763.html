<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696237265978" as="style"/><link rel="stylesheet" href="styles.css?v=1696237265978"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/NAlexPear/pg_branch">Pg_branch: Experimental Postgres extension brings Neon-like branching</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>bx376</span> | <span>13 comments</span></div><br/><div><div id="37735605" class="c"><input type="checkbox" id="c-37735605" checked=""/><div class="controls bullet"><span class="by">mj4e</span><span>|</span><a href="#37734454">next</a><span>|</span><label class="collapse" for="c-37735605">[-]</label><label class="expand" for="c-37735605">[1 more]</label></div><br/><div class="children"><div class="content">For anyone wondering what &quot;Neon-like branching&quot; is, this is worth a read: <a href="https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;database-branching-for-postgres-with-neon" rel="nofollow noreferrer">https:&#x2F;&#x2F;neon.tech&#x2F;blog&#x2F;database-branching-for-postgres-with-...</a></div><br/></div></div><div id="37734454" class="c"><input type="checkbox" id="c-37734454" checked=""/><div class="controls bullet"><span class="by">sverhagen</span><span>|</span><a href="#37735605">prev</a><span>|</span><a href="#37735459">next</a><span>|</span><label class="collapse" for="c-37734454">[-]</label><label class="expand" for="c-37734454">[3 more]</label></div><br/><div class="children"><div class="content">I think I saw an Uber-engineer&#x27;s presentation (YouTube; can&#x27;t find it now anymore) about their test environment having the ability to automatically fork the database for every new test run, such that they could easily &quot;revert&quot; (in their case ignore&#x2F;walk away from) the database after a test run. I find that an appealing idea, since regular test runs in the places where I work, tend to create cruft data in the test enviroment that is lopsided and voluminous in ways that do not properly represent the production system anymore. (And no one wants to troubleshoot performance issues that only ever exist in the test environment.) I have to imagine that pg_branch might be part of building a solution similar to this? Could people speak to some practical applications for this? Maybe I&#x27;m thinking about entirely the wrong one here...</div><br/><div id="37734600" class="c"><input type="checkbox" id="c-37734600" checked=""/><div class="controls bullet"><span class="by">petepete</span><span>|</span><a href="#37734454">parent</a><span>|</span><a href="#37735459">next</a><span>|</span><label class="collapse" for="c-37734600">[-]</label><label class="expand" for="c-37734600">[2 more]</label></div><br/><div class="children"><div class="content">&gt; about their test environment having the ability to automatically fork the database for every new test run, such that they could easily &quot;revert&quot; (in their case ignore&#x2F;walk away from) the database after a test run<p>I think this should be really straightforward by using one database as a template for another. This is how Postgres&#x27;s create database works and it defaults to Template1<p><a href="https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;manage-ag-templatedbs.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F;current&#x2F;manage-ag-templatedb...</a></div><br/><div id="37734832" class="c"><input type="checkbox" id="c-37734832" checked=""/><div class="controls bullet"><span class="by">jasfi</span><span>|</span><a href="#37734454">root</a><span>|</span><a href="#37734600">parent</a><span>|</span><a href="#37735459">next</a><span>|</span><label class="collapse" for="c-37734832">[-]</label><label class="expand" for="c-37734832">[1 more]</label></div><br/><div class="children"><div class="content">The intention of pg_branch is to optimize this process. They mention two problems:<p>1. The template database can&#x27;t have active connections during the CREATE DATABASE process.<p>2. The CREATE DATABASE from a template database can be slow for large DBs.</div><br/></div></div></div></div></div></div><div id="37735459" class="c"><input type="checkbox" id="c-37735459" checked=""/><div class="controls bullet"><span class="by">imiric</span><span>|</span><a href="#37734454">prev</a><span>|</span><a href="#37735065">next</a><span>|</span><label class="collapse" for="c-37735459">[-]</label><label class="expand" for="c-37735459">[2 more]</label></div><br/><div class="children"><div class="content">This is neat, but I wouldn&#x27;t trust BTRFS for any serious usage. I&#x27;ve read way too many data loss reports to make me stay away even for personal use.<p>Could this work on ZFS, or a layered FS like Aufs&#x2F;OverlayFS?</div><br/><div id="37735517" class="c"><input type="checkbox" id="c-37735517" checked=""/><div class="controls bullet"><span class="by">bantunes</span><span>|</span><a href="#37735459">parent</a><span>|</span><a href="#37735065">next</a><span>|</span><label class="collapse" for="c-37735517">[-]</label><label class="expand" for="c-37735517">[1 more]</label></div><br/><div class="children"><div class="content">I thought the only major issues with Btrfs were with RAID usage. I mean, some distros default to it out of the box, right?</div><br/></div></div></div></div><div id="37735065" class="c"><input type="checkbox" id="c-37735065" checked=""/><div class="controls bullet"><span class="by">skeptrune</span><span>|</span><a href="#37735459">prev</a><span>|</span><a href="#37734154">next</a><span>|</span><label class="collapse" for="c-37735065">[-]</label><label class="expand" for="c-37735065">[1 more]</label></div><br/><div class="children"><div class="content">Holy hell this thing is awesome. I am incredibly surprised at how little code it took to achieve a MVP on this. Adding this to local docker image would make doing so many things easier during testing and local dev.<p>Having it on CI actions would also be amazing.</div><br/></div></div><div id="37734154" class="c"><input type="checkbox" id="c-37734154" checked=""/><div class="controls bullet"><span class="by">bhouston</span><span>|</span><a href="#37735065">prev</a><span>|</span><a href="#37735096">next</a><span>|</span><label class="collapse" for="c-37734154">[-]</label><label class="expand" for="c-37734154">[2 more]</label></div><br/><div class="children"><div class="content">Interesting that branching is now better supported and almost free.  I wonder if merging can be simplified or whether it already is as simple and as fast as it can be?<p>I guess I am inspired by Dolt’s ability to branch and merge: <a href="https:&#x2F;&#x2F;github.com&#x2F;dolthub&#x2F;dolt">https:&#x2F;&#x2F;github.com&#x2F;dolthub&#x2F;dolt</a></div><br/><div id="37735438" class="c"><input type="checkbox" id="c-37735438" checked=""/><div class="controls bullet"><span class="by">lifty</span><span>|</span><a href="#37734154">parent</a><span>|</span><a href="#37735096">next</a><span>|</span><label class="collapse" for="c-37735438">[-]</label><label class="expand" for="c-37735438">[1 more]</label></div><br/><div class="children"><div class="content">Dolt is on a whole different level. They use prolly trees as their underlying data structure, which allowed them to replicate most of Git’s features very efficiently. And I think they’re planning on building a Postgres frontend as well.</div><br/></div></div></div></div><div id="37735096" class="c"><input type="checkbox" id="c-37735096" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#37734154">prev</a><span>|</span><label class="collapse" for="c-37735096">[-]</label><label class="expand" for="c-37735096">[3 more]</label></div><br/><div class="children"><div class="content">Remind me why macOS is the best development OS again...? This has the potential to 2x my debug speed when bisecting test failures and testing fixes. Wonder what corporate IT will say if they see me doing real work on a Linux vm, I&#x27;m <i>very</i> tempted to check.<p>Edit: quick google tells me APFS supports snapshots&#x2F;cow, could the same approach be used here?</div><br/><div id="37735138" class="c"><input type="checkbox" id="c-37735138" checked=""/><div class="controls bullet"><span class="by">lnenad</span><span>|</span><a href="#37735096">parent</a><span>|</span><label class="collapse" for="c-37735138">[-]</label><label class="expand" for="c-37735138">[2 more]</label></div><br/><div class="children"><div class="content">What makes people write these kind of messages? If you don&#x27;t want to use macOS then don&#x27;t use it.</div><br/><div id="37735426" class="c"><input type="checkbox" id="c-37735426" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#37735096">root</a><span>|</span><a href="#37735138">parent</a><span>|</span><label class="collapse" for="c-37735426">[-]</label><label class="expand" for="c-37735426">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s right there - corporate IT</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>