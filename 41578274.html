<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1726909253206" as="style"/><link rel="stylesheet" href="styles.css?v=1726909253206"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/Telemaco019/kubesafe">Kubesafe: Never run Kubernetes commands on the wrong cluster again</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>Telemaco019</span> | <span>13 comments</span></div><br/><div><div id="41607984" class="c"><input type="checkbox" id="c-41607984" checked=""/><div class="controls bullet"><span class="by">ed_mercer</span><span>|</span><a href="#41608394">next</a><span>|</span><label class="collapse" for="c-41607984">[-]</label><label class="expand" for="c-41607984">[1 more]</label></div><br/><div class="children"><div class="content">I got burned by this recently and came to the conclusion that the concept of a current context is evil. Now I always specify —-context when running kubectl commands.</div><br/></div></div><div id="41608394" class="c"><input type="checkbox" id="c-41608394" checked=""/><div class="controls bullet"><span class="by">smlx</span><span>|</span><a href="#41607984">prev</a><span>|</span><a href="#41608291">next</a><span>|</span><label class="collapse" for="c-41608394">[-]</label><label class="expand" for="c-41608394">[1 more]</label></div><br/><div class="children"><div class="content">I came up with a simpler solution that keeps kube contexts separated per terminal.<p><a href="https:&#x2F;&#x2F;smlx.dev&#x2F;posts&#x2F;kubectl-global-state&#x2F;" rel="nofollow">https:&#x2F;&#x2F;smlx.dev&#x2F;posts&#x2F;kubectl-global-state&#x2F;</a></div><br/></div></div><div id="41608291" class="c"><input type="checkbox" id="c-41608291" checked=""/><div class="controls bullet"><span class="by">evnix</span><span>|</span><a href="#41608394">prev</a><span>|</span><a href="#41608360">next</a><span>|</span><label class="collapse" for="c-41608291">[-]</label><label class="expand" for="c-41608291">[1 more]</label></div><br/><div class="children"><div class="content">Have been burnt by this, I have to deal with close to 8 clusters and it is very easy to make a mistake.<p>Would highly recommend kubie, it allows you to switch and shows you the name of the cluster in the prompt. It&#x27;s probably a more visual way of solving the same problem.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;sbstp&#x2F;kubie">https:&#x2F;&#x2F;github.com&#x2F;sbstp&#x2F;kubie</a></div><br/></div></div><div id="41608360" class="c"><input type="checkbox" id="c-41608360" checked=""/><div class="controls bullet"><span class="by">renewiltord</span><span>|</span><a href="#41608291">prev</a><span>|</span><a href="#41607578">next</a><span>|</span><label class="collapse" for="c-41608360">[-]</label><label class="expand" for="c-41608360">[1 more]</label></div><br/><div class="children"><div class="content">Someone here showed me this cool technique with `fzf`:<p><pre><code>    #!&#x2F;usr&#x2F;bin&#x2F;env bash

    set -e

    context=$(kubectl config get-contexts | awk &#x27;{print $2;}&#x27; | grep -v NAME | fzf --preview &#x27;kubectl config use-context {} &amp;&amp; kubectl get namespaces&#x27;)
    kubectl config use-context $context
</code></pre>
You get a two-pane window with the context on the left and the namespaces on the right. That&#x27;s all I need to find what I&#x27;m looking at. It&#x27;s destructive, though.</div><br/></div></div><div id="41607578" class="c"><input type="checkbox" id="c-41607578" checked=""/><div class="controls bullet"><span class="by">thewisenerd</span><span>|</span><a href="#41608360">prev</a><span>|</span><a href="#41581897">next</a><span>|</span><label class="collapse" for="c-41607578">[-]</label><label class="expand" for="c-41607578">[1 more]</label></div><br/><div class="children"><div class="content">haha<p>i added the following to my bashrc a few days ago for similar reasons; this forces me to be explicit about the cluster; now i mess up the wrong namespace instead :)<p><pre><code>    if [[ -e &quot;&#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;kubectl&quot; ]]; then
        &#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;kubectl config unset current-context &gt;&#x2F;dev&#x2F;null
    fi</code></pre></div><br/></div></div><div id="41581897" class="c"><input type="checkbox" id="c-41581897" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#41607578">prev</a><span>|</span><a href="#41582831">next</a><span>|</span><label class="collapse" for="c-41581897">[-]</label><label class="expand" for="c-41581897">[3 more]</label></div><br/><div class="children"><div class="content">This seems good, but can it also be done via ACLs in vanilla Kubernetes?</div><br/><div id="41583513" class="c"><input type="checkbox" id="c-41583513" checked=""/><div class="controls bullet"><span class="by">Telemaco019</span><span>|</span><a href="#41581897">parent</a><span>|</span><a href="#41582831">next</a><span>|</span><label class="collapse" for="c-41583513">[-]</label><label class="expand" for="c-41583513">[2 more]</label></div><br/><div class="children"><div class="content">Thanks Robert! Yes, you can achieve this with ACLs in Kubernetes, but it requires setting up multiple Roles and contexts. Even then, you might accidentally switch to a higher-permission Role and accidentally run a risky command, thinking you&#x27;re in a different cluster or using a low-permission user.<p>Kubesafe is just an extra safety net to prevent those kind of accidents :)</div><br/><div id="41586648" class="c"><input type="checkbox" id="c-41586648" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#41581897">root</a><span>|</span><a href="#41583513">parent</a><span>|</span><a href="#41582831">next</a><span>|</span><label class="collapse" for="c-41586648">[-]</label><label class="expand" for="c-41586648">[1 more]</label></div><br/><div class="children"><div class="content">That makes sense - thanks for the reply.</div><br/></div></div></div></div></div></div><div id="41582831" class="c"><input type="checkbox" id="c-41582831" checked=""/><div class="controls bullet"><span class="by">JohnMakin</span><span>|</span><a href="#41581897">prev</a><span>|</span><label class="collapse" for="c-41582831">[-]</label><label class="expand" for="c-41582831">[4 more]</label></div><br/><div class="children"><div class="content">I am not trying to shit on this, sorry - but can&#x27;t you achieve the same thing with rudimentary automation, and barring that, rudimentary scripting? This seems to just be adding y&#x2F;n prompts to certain contexts. How&#x27;s that different than a bash wrapper script that does something like this?<p>context=$(grep &quot;current-context:&quot; ~&#x2F;.kube&#x2F;config | grep &quot;*prod*&quot;)<p>if [[ -z ${context} ]]<p>then
  # do the command<p>else
  # do a y&#x2F;n prompt<p>fi<p>Am I missing something?</div><br/><div id="41583435" class="c"><input type="checkbox" id="c-41583435" checked=""/><div class="controls bullet"><span class="by">Telemaco019</span><span>|</span><a href="#41582831">parent</a><span>|</span><label class="collapse" for="c-41583435">[-]</label><label class="expand" for="c-41583435">[3 more]</label></div><br/><div class="children"><div class="content">Thanks for the feedback John! You&#x27;re right, that&#x27;s pretty much it :)<p>I developed kubesafe because (1) I was tired of tinkering with shell aliases and scripts (especially when I wanted to define protected commands) and (2) I needed something that worked smoothly with all Kubernetes tools like kubectl, helm, kubecolor, etc.<p>Kubesafe is just a convenient way to manage protected commands and contexts. Nothing too fancy!<p>Btw - I also found a kubectl plugin written in Bash that’s similar to what you mentioned, in case you&#x27;re interested: <a href="https:&#x2F;&#x2F;github.com&#x2F;jordanwilson230&#x2F;kubectl-plugins&#x2F;blob&#x2F;krew&#x2F;kubectl-prompt">https:&#x2F;&#x2F;github.com&#x2F;jordanwilson230&#x2F;kubectl-plugins&#x2F;blob&#x2F;krew...</a></div><br/><div id="41583509" class="c"><input type="checkbox" id="c-41583509" checked=""/><div class="controls bullet"><span class="by">JohnMakin</span><span>|</span><a href="#41582831">root</a><span>|</span><a href="#41583435">parent</a><span>|</span><label class="collapse" for="c-41583509">[-]</label><label class="expand" for="c-41583509">[2 more]</label></div><br/><div class="children"><div class="content">thanks for the explanation, I like the idea</div><br/><div id="41583570" class="c"><input type="checkbox" id="c-41583570" checked=""/><div class="controls bullet"><span class="by">Telemaco019</span><span>|</span><a href="#41582831">root</a><span>|</span><a href="#41583509">parent</a><span>|</span><label class="collapse" for="c-41583570">[-]</label><label class="expand" for="c-41583570">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;re welcome! And thanks again for the feedback!</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>