<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704099666227" as="style"/><link rel="stylesheet" href="styles.css?v=1704099666227"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.yelinaung.com/posts/what-happened-to-my-print/">Why my print didn&#x27;t output before a segmentation fault</a>Â <span class="domain">(<a href="https://blog.yelinaung.com">blog.yelinaung.com</a>)</span></div><div class="subtext"><span>yla92</span> | <span>14 comments</span></div><br/><div><div id="38830109" class="c"><input type="checkbox" id="c-38830109" checked=""/><div class="controls bullet"><span class="by">jcalvinowens</span><span>|</span><a href="#38830026">next</a><span>|</span><label class="collapse" for="c-38830109">[-]</label><label class="expand" for="c-38830109">[1 more]</label></div><br/><div class="children"><div class="content">If you use stderr, you get this for free: stderr is always unbuffered (see <a href="https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;3&#x2F;stderr" rel="nofollow">https:&#x2F;&#x2F;linux.die.net&#x2F;man&#x2F;3&#x2F;stderr</a>).</div><br/></div></div><div id="38830026" class="c"><input type="checkbox" id="c-38830026" checked=""/><div class="controls bullet"><span class="by">Taniwha</span><span>|</span><a href="#38830109">prev</a><span>|</span><a href="#38829994">next</a><span>|</span><label class="collapse" for="c-38830026">[-]</label><label class="expand" for="c-38830026">[1 more]</label></div><br/><div class="children"><div class="content">For those who don&#x27;t know &quot;fflush(0);&quot; flushes ALL FILEs</div><br/></div></div><div id="38829994" class="c"><input type="checkbox" id="c-38829994" checked=""/><div class="controls bullet"><span class="by">LorenDB</span><span>|</span><a href="#38830026">prev</a><span>|</span><a href="#38803607">next</a><span>|</span><label class="collapse" for="c-38829994">[-]</label><label class="expand" for="c-38829994">[1 more]</label></div><br/><div class="children"><div class="content">In C++, I&#x27;ve absolutely had to explicitly use std::endl while debugging to make sure that my debug messages actually were visible when they were supposed to be. Using std::flush also works if you don&#x27;t want to force a newline. However, in my experience, printing a newline character via std::cout does <i>not</i> flush the stream.</div><br/></div></div><div id="38803607" class="c"><input type="checkbox" id="c-38803607" checked=""/><div class="controls bullet"><span class="by">rini17</span><span>|</span><a href="#38829994">prev</a><span>|</span><label class="collapse" for="c-38803607">[-]</label><label class="expand" for="c-38803607">[10 more]</label></div><br/><div class="children"><div class="content">Am I right to claim C compiler could determine the NULL pointer dereference is an undefined behavior and do anything, like completely removing the dereference?</div><br/><div id="38829978" class="c"><input type="checkbox" id="c-38829978" checked=""/><div class="controls bullet"><span class="by">valleyer</span><span>|</span><a href="#38803607">parent</a><span>|</span><label class="collapse" for="c-38829978">[-]</label><label class="expand" for="c-38829978">[9 more]</label></div><br/><div class="children"><div class="content">Technically (which is the best kind), yes.</div><br/><div id="38830012" class="c"><input type="checkbox" id="c-38830012" checked=""/><div class="controls bullet"><span class="by">LegionMammal978</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38829978">parent</a><span>|</span><label class="collapse" for="c-38830012">[-]</label><label class="expand" for="c-38830012">[8 more]</label></div><br/><div class="children"><div class="content">At least the print and flush will occur before whatever the compiler decides to do with the UB, unless it&#x27;s one of those purely-theoretical impelementations that can prove that those functions eventually return.</div><br/><div id="38830093" class="c"><input type="checkbox" id="c-38830093" checked=""/><div class="controls bullet"><span class="by">readams</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830012">parent</a><span>|</span><a href="#38830100">next</a><span>|</span><label class="collapse" for="c-38830093">[-]</label><label class="expand" for="c-38830093">[1 more]</label></div><br/><div class="children"><div class="content">I know you already know this but wanted to clarify that technically ub can &quot;go back in time&quot; and not print those earlier statements.</div><br/></div></div><div id="38830100" class="c"><input type="checkbox" id="c-38830100" checked=""/><div class="controls bullet"><span class="by">jcranmer</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830012">parent</a><span>|</span><a href="#38830093">prev</a><span>|</span><a href="#38830095">next</a><span>|</span><label class="collapse" for="c-38830100">[-]</label><label class="expand" for="c-38830100">[5 more]</label></div><br/><div class="children"><div class="content">I&#x2F;O is considered a visible side effect, so compilers can&#x27;t optimize away the call to the print and flush, even if UB happens immediately afterwards.</div><br/><div id="38830169" class="c"><input type="checkbox" id="c-38830169" checked=""/><div class="controls bullet"><span class="by">gizmo686</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830100">parent</a><span>|</span><a href="#38830120">next</a><span>|</span><label class="collapse" for="c-38830169">[-]</label><label class="expand" for="c-38830169">[1 more]</label></div><br/><div class="children"><div class="content">C compilers are allowed to assume that UB never happens. This means that if there is a code path that results in UB, the compiler can &quot;know&quot; that path will never be taken and simply not compile it (or replace it with code that summons demons through your serial port)</div><br/></div></div><div id="38830120" class="c"><input type="checkbox" id="c-38830120" checked=""/><div class="controls bullet"><span class="by">SpaghettiCthulu</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830100">parent</a><span>|</span><a href="#38830169">prev</a><span>|</span><a href="#38830117">next</a><span>|</span><label class="collapse" for="c-38830120">[-]</label><label class="expand" for="c-38830120">[2 more]</label></div><br/><div class="children"><div class="content">But if the compiler can prove that the code causing the UB will be reached regardless of the IO action, could it not assume that the IO action can never be reached, progagating the UB before it?</div><br/><div id="38830171" class="c"><input type="checkbox" id="c-38830171" checked=""/><div class="controls bullet"><span class="by">lights0123</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830120">parent</a><span>|</span><a href="#38830117">next</a><span>|</span><label class="collapse" for="c-38830171">[-]</label><label class="expand" for="c-38830171">[1 more]</label></div><br/><div class="children"><div class="content">Correct, since unless the program is compiled with -nostdlib, the compiler can assume you&#x27;re using its printf implementation which does not alter code flow (such as by exit(), longjmp, or exceptions in C++)</div><br/></div></div></div></div><div id="38830117" class="c"><input type="checkbox" id="c-38830117" checked=""/><div class="controls bullet"><span class="by">Dylan16807</span><span>|</span><a href="#38803607">root</a><span>|</span><a href="#38830100">parent</a><span>|</span><a href="#38830120">prev</a><span>|</span><a href="#38830095">next</a><span>|</span><label class="collapse" for="c-38830117">[-]</label><label class="expand" for="c-38830117">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m pretty sure they can.<p>In practical terms, compilers are allowed to reorder calculations, and the print <i>might as well</i> not be there if it&#x27;s after a crash.<p>In theoretical terms, once UB is guaranteed to happen then your program execution is no longer valid, the entire execution, and the compiler is not bound by any rules whatsoever.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>