<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1685005259881" as="style"/><link rel="stylesheet" href="styles.css?v=1685005259881"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.koehntopp.info/2023/03/14/tracing-python.html">Tracing Python</a>Â <span class="domain">(<a href="https://blog.koehntopp.info">blog.koehntopp.info</a>)</span></div><div class="subtext"><span>jimyl</span> | <span>12 comments</span></div><br/><div><div id="36066670" class="c"><input type="checkbox" id="c-36066670" checked=""/><div class="controls bullet"><span class="by">peterkelly</span><span>|</span><a href="#36066786">next</a><span>|</span><label class="collapse" for="c-36066670">[-]</label><label class="expand" for="c-36066670">[5 more]</label></div><br/><div class="children"><div class="content">Python has a built-in API for tracing: <a href="https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;sys.html#sys.settrace" rel="nofollow">https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;sys.html#sys.settrace</a><p>Here&#x27;s an example of how to use it (obviously a minimal case, you can customise your handler do do whatever you need):<p><pre><code>    def mytrace(frame, event, arg):
        if event == &quot;call&quot;:
            print(&quot;call&quot;, frame.f_code.co_name, frame.f_locals)
        elif event == &quot;return&quot;:
            print(&quot;return&quot;, frame.f_code.co_name, arg)
        return mytrace

    import sys
    sys.settrace(mytrace)
</code></pre>
For example, given the following code:<p><pre><code>    def three(z):
        return 3

    def two(y):
        return three(&quot;BBB&quot;) - 1

    def one():
        return two(&quot;AAA&quot;) - 1

    one()
</code></pre>
It will output:<p><pre><code>    call one {}
    call two {&#x27;y&#x27;: &#x27;AAA&#x27;}
    call three {&#x27;z&#x27;: &#x27;BBB&#x27;}
    return three 3
    return two 2
    return one 1</code></pre></div><br/><div id="36066878" class="c"><input type="checkbox" id="c-36066878" checked=""/><div class="controls bullet"><span class="by">taeric</span><span>|</span><a href="#36066670">parent</a><span>|</span><a href="#36067422">next</a><span>|</span><label class="collapse" for="c-36066878">[-]</label><label class="expand" for="c-36066878">[2 more]</label></div><br/><div class="children"><div class="content">I confess I&#x27;m surprised the builtin wasn&#x27;t one of the demoed options. Curious what the reason is.</div><br/><div id="36068000" class="c"><input type="checkbox" id="c-36068000" checked=""/><div class="controls bullet"><span class="by">isotopp</span><span>|</span><a href="#36066670">root</a><span>|</span><a href="#36066878">parent</a><span>|</span><a href="#36067422">next</a><span>|</span><label class="collapse" for="c-36068000">[-]</label><label class="expand" for="c-36068000">[1 more]</label></div><br/><div class="children"><div class="content">I just pushed an addendum, and it is being rendered right now.</div><br/></div></div></div></div><div id="36067422" class="c"><input type="checkbox" id="c-36067422" checked=""/><div class="controls bullet"><span class="by">yi_xuan</span><span>|</span><a href="#36066670">parent</a><span>|</span><a href="#36066878">prev</a><span>|</span><a href="#36067520">next</a><span>|</span><label class="collapse" for="c-36067422">[-]</label><label class="expand" for="c-36067422">[1 more]</label></div><br/><div class="children"><div class="content">Pdb also employs this approach for debug. I had wondered about pdb&#x27;s implementation, when I saw it, I felt a little surprised.</div><br/></div></div><div id="36067520" class="c"><input type="checkbox" id="c-36067520" checked=""/><div class="controls bullet"><span class="by">RJIb8RBYxzAMX9u</span><span>|</span><a href="#36066670">parent</a><span>|</span><a href="#36067422">prev</a><span>|</span><a href="#36066786">next</a><span>|</span><label class="collapse" for="c-36067520">[-]</label><label class="expand" for="c-36067520">[1 more]</label></div><br/><div class="children"><div class="content">Wow, I can&#x27;t believe I didn&#x27;t know about this until now! I&#x27;m the lucky 10k[0] today.<p>[0] <a href="https:&#x2F;&#x2F;xkcd.com&#x2F;1053&#x2F;" rel="nofollow">https:&#x2F;&#x2F;xkcd.com&#x2F;1053&#x2F;</a></div><br/></div></div></div></div><div id="36066786" class="c"><input type="checkbox" id="c-36066786" checked=""/><div class="controls bullet"><span class="by">lathiat</span><span>|</span><a href="#36066670">prev</a><span>|</span><a href="#36065657">next</a><span>|</span><label class="collapse" for="c-36066786">[-]</label><label class="expand" for="c-36066786">[1 more]</label></div><br/><div class="children"><div class="content">There are many different tools, but when I want to quickly understand what the code was doing I have been reaching for pysnooper:
<a href="https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;PySnooper&#x2F;" rel="nofollow">https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;PySnooper&#x2F;</a><p>Has a pretty nice and importantly colored output by default, which I find much easier to follow. In many cases snooping one specific function has done the job. It has an easy to use decorator to decorate any function without having to otherwise intercept the main python invocation or set something up at the start. Good for libraries etc.<p>pysnooper has mostly been enough for me but the &quot;snoop&quot; mentioned in the article seems to be a superset and more. Will have to give it a go next time.<p>Outside of this if I want to understand performance or more roughly what code paths are executing (and not a per-statement trace) then austin and py-spy are both amazing.. convert to flamescope and drop into flamescope.app.</div><br/></div></div><div id="36065657" class="c"><input type="checkbox" id="c-36065657" checked=""/><div class="controls bullet"><span class="by">sys_64738</span><span>|</span><a href="#36066786">prev</a><span>|</span><a href="#36066856">next</a><span>|</span><label class="collapse" for="c-36065657">[-]</label><label class="expand" for="c-36065657">[1 more]</label></div><br/><div class="children"><div class="content">A more traditional debugger for Python.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;inducer&#x2F;pudb">https:&#x2F;&#x2F;github.com&#x2F;inducer&#x2F;pudb</a></div><br/></div></div><div id="36066856" class="c"><input type="checkbox" id="c-36066856" checked=""/><div class="controls bullet"><span class="by">nomel</span><span>|</span><a href="#36065657">prev</a><span>|</span><a href="#36067601">next</a><span>|</span><label class="collapse" for="c-36066856">[-]</label><label class="expand" for="c-36066856">[2 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the modern practical use case for tracing in python? Environments without an IDE&#x2F;remote debugger?<p>I can&#x27;t recall the last time I needed to enable tracing, in the last couple of decades, besides bash scripts.</div><br/><div id="36068054" class="c"><input type="checkbox" id="c-36068054" checked=""/><div class="controls bullet"><span class="by">isotopp</span><span>|</span><a href="#36066856">parent</a><span>|</span><a href="#36067601">next</a><span>|</span><label class="collapse" for="c-36068054">[-]</label><label class="expand" for="c-36068054">[1 more]</label></div><br/><div class="children"><div class="content">Originally the question was &quot;What is Honeycomb.io and Opentracing doing and how can I get this into my existing application?&quot; on IRC. On explaining, the discussion went into various directions (Fred Fish C Debugging Macros and tracing Python).</div><br/></div></div></div></div><div id="36067601" class="c"><input type="checkbox" id="c-36067601" checked=""/><div class="controls bullet"><span class="by">knlb2022</span><span>|</span><a href="#36066856">prev</a><span>|</span><a href="#36066523">next</a><span>|</span><label class="collapse" for="c-36067601">[-]</label><label class="expand" for="c-36067601">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll throw in my own too: <a href="https:&#x2F;&#x2F;github.com&#x2F;kunalb&#x2F;panopticon">https:&#x2F;&#x2F;github.com&#x2F;kunalb&#x2F;panopticon</a></div><br/></div></div><div id="36066523" class="c"><input type="checkbox" id="c-36066523" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#36067601">prev</a><span>|</span><label class="collapse" for="c-36066523">[-]</label><label class="expand" for="c-36066523">[1 more]</label></div><br/><div class="children"><div class="content">Fantastic article and something I&#x27;ve been looking for better tools for. None of them seem to have my ideal workflow though -- providing an external manifest of what and how to trace that can be used against an existing program without changing the code. Something like Otel&#x27;s auto instrumentation.</div><br/></div></div></div></div></div></div></div></body></html>