<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1696928467233" as="style"/><link rel="stylesheet" href="styles.css?v=1696928467233"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://alexandreolive.medium.com/video-streaming-at-scale-with-kubernetes-and-rabbitmq-6e23fd0e75fb">Video streaming at scale with Kubernetes and RabbitMQ</a>Â <span class="domain">(<a href="https://alexandreolive.medium.com">alexandreolive.medium.com</a>)</span></div><div class="subtext"><span>thunderbong</span> | <span>84 comments</span></div><br/><div><div id="37823889" class="c"><input type="checkbox" id="c-37823889" checked=""/><div class="controls bullet"><span class="by">schott12521</span><span>|</span><a href="#37824006">next</a><span>|</span><label class="collapse" for="c-37823889">[-]</label><label class="expand" for="c-37823889">[11 more]</label></div><br/><div class="children"><div class="content">I thoroughly appreciated this article as I&#x27;ve been building a short-form video content streaming service and the performance hasn&#x27;t been what I expected.<p>Granted, I knew that my service needs to be able to scale at different bottlenecks, but a lot of &quot;build your own video service!&quot; tutorials start with:<p>- Build a backend, return a video file<p>- Build a frontend, embed the video<p>And that leaves a lot to be desired in terms of performance. I think the actual steps should be:<p>- Build a backend that consists of:<p><pre><code>  - Video Ingestion service

  - Video Upload &#x2F; Processing Service that saves the video into chunks

  - Build a streaming service that returns video chunks
</code></pre>
- Build a frontend that consists of:<p><pre><code>  - Build or use a video streaming library that can play video chunks as a stream
</code></pre>
Edit: From the author&#x27;s links, I found this website which is very informative: <a href="https:&#x2F;&#x2F;howvideo.works&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;howvideo.works&#x2F;</a></div><br/><div id="37824789" class="c"><input type="checkbox" id="c-37824789" checked=""/><div class="controls bullet"><span class="by">mmcclure</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37829326">next</a><span>|</span><label class="collapse" for="c-37824789">[-]</label><label class="expand" for="c-37824789">[2 more]</label></div><br/><div class="children"><div class="content">I helped work on howvideo.works, fun to see it helping people! The world of video is, I&#x27;d argue, one of those technical spaces that is extremely iceberg-y. You can get decently far enough using S3 + the HTML5 video tag, which I think creates a perception among some that video is just images but a little bigger, but that couldn&#x27;t be further from the truth. You can really pick just about any step along the video pipeline from production to playback and go as deep for as many years as you&#x27;d like.<p>This is both a semi-shameless plug <i>and</i> probably a few levels deeper than what you&#x27;re looking for, but I organize a conference for video developers called Demuxed. The YouTube channel[1] has 8 years worth of conference videos about streaming video (and the 9th year is happening in a couple of weeks). The bullet points you mentioned are definitely covered across a few talks, but it&#x27;s certainly not in any kind of &quot;how to&quot; format.<p>[1]: <a href="https:&#x2F;&#x2F;youtube.com&#x2F;demuxed">https:&#x2F;&#x2F;youtube.com&#x2F;demuxed</a></div><br/><div id="37825451" class="c"><input type="checkbox" id="c-37825451" checked=""/><div class="controls bullet"><span class="by">alexandreolive</span><span>|</span><a href="#37823889">root</a><span>|</span><a href="#37824789">parent</a><span>|</span><a href="#37829326">next</a><span>|</span><label class="collapse" for="c-37825451">[-]</label><label class="expand" for="c-37825451">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m the writer of the article; I LOVE howvideo.works. It helped me quite a lot when I started working on video processing. I&#x27;m still a beginner and always fall back to it when I&#x27;m unsure about something fundamental. Thanks for your work. I&#x27;ll take a look at your YouTube channel.</div><br/></div></div></div></div><div id="37829326" class="c"><input type="checkbox" id="c-37829326" checked=""/><div class="controls bullet"><span class="by">wouldbecouldbe</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37824789">prev</a><span>|</span><a href="#37825508">next</a><span>|</span><label class="collapse" for="c-37829326">[-]</label><label class="expand" for="c-37829326">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been using commercial streaming services for in app (cloudflare, bunny, vimeo), and found performance &amp; bandwith use terrible. The HLS protocol for iOS doesnt work wel for 5-10 second clips, since it needs 1-4 seconds. Now using compress mp4 with progressive loading. Way better.</div><br/><div id="37829360" class="c"><input type="checkbox" id="c-37829360" checked=""/><div class="controls bullet"><span class="by">ddorian43</span><span>|</span><a href="#37823889">root</a><span>|</span><a href="#37829326">parent</a><span>|</span><a href="#37825508">next</a><span>|</span><label class="collapse" for="c-37829360">[-]</label><label class="expand" for="c-37829360">[1 more]</label></div><br/><div class="children"><div class="content">&gt; and found performance &amp; bandwith use terrible<p>Can you explain exactly what you mean?</div><br/></div></div></div></div><div id="37825508" class="c"><input type="checkbox" id="c-37825508" checked=""/><div class="controls bullet"><span class="by">alexandreolive</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37829326">prev</a><span>|</span><a href="#37825914">next</a><span>|</span><label class="collapse" for="c-37825508">[-]</label><label class="expand" for="c-37825508">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;m the writer of the article; thanks for your lovely comment. I skipped many essential parts of the architecture in the article to keep it concise. The following articles will be about the technical implementation of what I discussed in this one.</div><br/></div></div><div id="37825914" class="c"><input type="checkbox" id="c-37825914" checked=""/><div class="controls bullet"><span class="by">Uehreka</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37825508">prev</a><span>|</span><a href="#37823938">next</a><span>|</span><label class="collapse" for="c-37825914">[-]</label><label class="expand" for="c-37825914">[1 more]</label></div><br/><div class="children"><div class="content">Something like this? <a href="https:&#x2F;&#x2F;github.com&#x2F;streamlinevideo&#x2F;streamline">https:&#x2F;&#x2F;github.com&#x2F;streamlinevideo&#x2F;streamline</a></div><br/></div></div><div id="37823938" class="c"><input type="checkbox" id="c-37823938" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37825914">prev</a><span>|</span><a href="#37825809">next</a><span>|</span><label class="collapse" for="c-37823938">[-]</label><label class="expand" for="c-37823938">[2 more]</label></div><br/><div class="children"><div class="content">&gt;&gt; I&#x27;ve been building a short-form video content streaming service<p>What does it do?</div><br/><div id="37824028" class="c"><input type="checkbox" id="c-37824028" checked=""/><div class="controls bullet"><span class="by">schott12521</span><span>|</span><a href="#37823889">root</a><span>|</span><a href="#37823938">parent</a><span>|</span><a href="#37825809">next</a><span>|</span><label class="collapse" for="c-37824028">[-]</label><label class="expand" for="c-37824028">[1 more]</label></div><br/><div class="children"><div class="content">Right now I&#x27;m basically trying to just re-create the TikTok &#x2F; Youtube Shorts &#x2F; Instagram Reels experience of infinitely scrolling videos.<p>Mostly just building for fun though.</div><br/></div></div></div></div><div id="37825809" class="c"><input type="checkbox" id="c-37825809" checked=""/><div class="controls bullet"><span class="by">John23832</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37823938">prev</a><span>|</span><a href="#37828958">next</a><span>|</span><label class="collapse" for="c-37825809">[-]</label><label class="expand" for="c-37825809">[1 more]</label></div><br/><div class="children"><div class="content">I built a similar project, and had great results with cloudflare stream.</div><br/></div></div><div id="37828958" class="c"><input type="checkbox" id="c-37828958" checked=""/><div class="controls bullet"><span class="by">littlestymaar</span><span>|</span><a href="#37823889">parent</a><span>|</span><a href="#37825809">prev</a><span>|</span><a href="#37824006">next</a><span>|</span><label class="collapse" for="c-37828958">[-]</label><label class="expand" for="c-37828958">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Video Upload &#x2F; Processing Service that saves the video into chunks<p>At this point you also need to chose what streaming protocol you want to use. You have mostly two choices, HLS if you want to get things done quick, or MPEG-DASH if you want more control (but you&#x27;d need a separate HLS pipeline for iOS anywayâ¦)<p>&gt; Build or use a video streaming library that can play video chunks as a stream<p>As someone who&#x27;s worked on a web streaming player, I&#x27;d strongly recommend not to build one but to use an existing one (or, in short: use HLS.js)</div><br/></div></div></div></div><div id="37824006" class="c"><input type="checkbox" id="c-37824006" checked=""/><div class="controls bullet"><span class="by">com2kid</span><span>|</span><a href="#37823889">prev</a><span>|</span><a href="#37825215">next</a><span>|</span><label class="collapse" for="c-37824006">[-]</label><label class="expand" for="c-37824006">[7 more]</label></div><br/><div class="children"><div class="content">This is nice if you only have to deliver in one format, but as soon as you want to show up on TVs you are stuck delivering in a <i>lot</i> of formats, and life gets complicated quickly.<p>Throw subtitles in multiple languages, and different audio tracks, into the mix, and all of a sudden streaming video becomes a nightmare.<p>Finally, if you are dealing with copyrighted materials, you have to be aware as to what country your user is physically residing in while accessing the videos, as you likely don&#x27;t have a license to stream all your videos in every country all at once.<p>Throw this all into a blender and what is needed is a very fancy asset catalog management system, and that part right there ends up being annoyingly complicated.</div><br/><div id="37824112" class="c"><input type="checkbox" id="c-37824112" checked=""/><div class="controls bullet"><span class="by">dbrueck</span><span>|</span><a href="#37824006">parent</a><span>|</span><a href="#37824270">next</a><span>|</span><label class="collapse" for="c-37824112">[-]</label><label class="expand" for="c-37824112">[4 more]</label></div><br/><div class="children"><div class="content">Oh, this is just the tip of the iceberg. Many parts of on-demand video streaming are largely commoditized at this point. Add in support for linear (live) streaming and ad insertion and things start to get really interesting. :)</div><br/><div id="37828092" class="c"><input type="checkbox" id="c-37828092" checked=""/><div class="controls bullet"><span class="by">chunkymilk</span><span>|</span><a href="#37824006">root</a><span>|</span><a href="#37824112">parent</a><span>|</span><a href="#37828377">next</a><span>|</span><label class="collapse" for="c-37828092">[-]</label><label class="expand" for="c-37828092">[1 more]</label></div><br/><div class="children"><div class="content">My background is in linear (title VI and OTT) and ad-insertion.  A big chunk of my job is explaining to folks that just because you solved VOD that doesn&#x27;t mean you&#x27;ve solved linear.  It&#x27;s almost best to think of them as two distinct problems.</div><br/></div></div><div id="37828377" class="c"><input type="checkbox" id="c-37828377" checked=""/><div class="controls bullet"><span class="by">jackcviers3</span><span>|</span><a href="#37824006">root</a><span>|</span><a href="#37824112">parent</a><span>|</span><a href="#37828092">prev</a><span>|</span><a href="#37824270">next</a><span>|</span><label class="collapse" for="c-37828377">[-]</label><label class="expand" for="c-37828377">[2 more]</label></div><br/><div class="children"><div class="content">Article made me nostalgic.<p>My very first job was writing streaming media services for radio. Integrating the ad services over events embedded into the stream identifying content was a pretty nifty solution. You send the metadata to your ad server, it selects the ads based on your user and media metadata, you swap out the player&#x27;s media url to play the ad(s), and keep the stream going in the background. When the commercial break is up, you kill the ad stream and swap the media stream player back in. Presto changeo, seamless ads in 2007.<p>You also track media playback through the stream embedded events.<p>The hard part back then was live video&#x2F;audio encoding. These cards lived at the stations, and streamed to our cdn. Geocoding for American service bases in foreign countries was interesting too, the streaming rights for stuff limits the countries you can stream in.<p>Monitoring the live encoders was an interesting problem - I setup an event-based solution so I could capture the audio waveform and analyze the frequency buckets on dozens of streams at once. Could tell if a stream was silent pretty quickly,  and alert the station engineer via email.<p>Back then, a lot of this stuff wasn&#x27;t off the shelf like it was today. Even on the frontend,working with Flash, window&#x27;s media player sdk, and the QuickTime sdk and integrating it with Javascript was challenging. And the backends were all in php and Java 1.4, and mysql, and a whole lot of memcache.<p>Was a really great experience for a new professional programmer to write all that.</div><br/><div id="37828802" class="c"><input type="checkbox" id="c-37828802" checked=""/><div class="controls bullet"><span class="by">timc3</span><span>|</span><a href="#37824006">root</a><span>|</span><a href="#37828377">parent</a><span>|</span><a href="#37824270">next</a><span>|</span><label class="collapse" for="c-37828802">[-]</label><label class="expand" for="c-37828802">[1 more]</label></div><br/><div class="children"><div class="content">In 2007 and i would argue before that, live media encoding for streams was pretty much a solved problem but it was often very expensive, and out of reach of radio stations and the information wasn&#x27;t readily accessible so you could potentially end up giving Microsoft or Real networks lots of money.<p>I was working on streaming in the late 90s - that was real wild west, had to write solutions myself, and it felt very duck taped together. Luckily it was an offshoot of a largish ISP so we had bandwidth and a lot of servers. incoming streams often used bonded ISDN lines.</div><br/></div></div></div></div></div></div><div id="37824270" class="c"><input type="checkbox" id="c-37824270" checked=""/><div class="controls bullet"><span class="by">grzes</span><span>|</span><a href="#37824006">parent</a><span>|</span><a href="#37824112">prev</a><span>|</span><a href="#37825215">next</a><span>|</span><label class="collapse" for="c-37824270">[-]</label><label class="expand" for="c-37824270">[2 more]</label></div><br/><div class="children"><div class="content">&quot;fancy asset catalog management system&quot; - was thinking about building such solution lately - do you know any open-source solutions of this kind?</div><br/><div id="37828862" class="c"><input type="checkbox" id="c-37828862" checked=""/><div class="controls bullet"><span class="by">timc3</span><span>|</span><a href="#37824006">root</a><span>|</span><a href="#37824270">parent</a><span>|</span><a href="#37825215">next</a><span>|</span><label class="collapse" for="c-37828862">[-]</label><label class="expand" for="c-37828862">[1 more]</label></div><br/><div class="children"><div class="content">Iâve built or been involved in building 4 closed source media asset management systems ( including my current place of work and one I cofounded) and you can get relatively far in the first month.<p>But the devil is in the details and most people that attempt it donât even get the database models right on the first or second time, they underestimate the complexity particularly when it comes to video and struggle when the use cases widen. Document asset management systems are way easier but usually donât understand media as in depth as a media asset management system.</div><br/></div></div></div></div></div></div><div id="37825215" class="c"><input type="checkbox" id="c-37825215" checked=""/><div class="controls bullet"><span class="by">dvliman</span><span>|</span><a href="#37824006">prev</a><span>|</span><a href="#37825297">next</a><span>|</span><label class="collapse" for="c-37825215">[-]</label><label class="expand" for="c-37825215">[4 more]</label></div><br/><div class="children"><div class="content">I built a similar video pipeline, not on Kubernetes but using EC2 instances for those hungry FFMPEG encoder.<p>The system differ in that it was not user generated video content. It was coming from the cameras in our fitness studio.<p>Here is the article if anyone intereste to read about: <a href="https:&#x2F;&#x2F;dev.to&#x2F;dvliman&#x2F;building-a-live-streaming-app-in-clojure-329m" rel="nofollow noreferrer">https:&#x2F;&#x2F;dev.to&#x2F;dvliman&#x2F;building-a-live-streaming-app-in-cloj...</a></div><br/><div id="37825737" class="c"><input type="checkbox" id="c-37825737" checked=""/><div class="controls bullet"><span class="by">devgoth</span><span>|</span><a href="#37825215">parent</a><span>|</span><a href="#37825297">next</a><span>|</span><label class="collapse" for="c-37825737">[-]</label><label class="expand" for="c-37825737">[3 more]</label></div><br/><div class="children"><div class="content">awesome article! curious -- why clojure?</div><br/><div id="37825950" class="c"><input type="checkbox" id="c-37825950" checked=""/><div class="controls bullet"><span class="by">dvliman</span><span>|</span><a href="#37825215">root</a><span>|</span><a href="#37825737">parent</a><span>|</span><a href="#37825917">next</a><span>|</span><label class="collapse" for="c-37825950">[-]</label><label class="expand" for="c-37825950">[1 more]</label></div><br/><div class="children"><div class="content">No specific reason. It could have been built in any language. It was just the language we were using and enjoyed at that time.</div><br/></div></div><div id="37825917" class="c"><input type="checkbox" id="c-37825917" checked=""/><div class="controls bullet"><span class="by">robinduckett</span><span>|</span><a href="#37825215">root</a><span>|</span><a href="#37825737">parent</a><span>|</span><a href="#37825950">prev</a><span>|</span><a href="#37825297">next</a><span>|</span><label class="collapse" for="c-37825917">[-]</label><label class="expand" for="c-37825917">[1 more]</label></div><br/><div class="children"><div class="content">Because CS Degree</div><br/></div></div></div></div></div></div><div id="37825297" class="c"><input type="checkbox" id="c-37825297" checked=""/><div class="controls bullet"><span class="by">mannyv</span><span>|</span><a href="#37825215">prev</a><span>|</span><a href="#37825491">next</a><span>|</span><label class="collapse" for="c-37825297">[-]</label><label class="expand" for="c-37825297">[18 more]</label></div><br/><div class="children"><div class="content">Fuck K8. You literally don&#x27;t need it. Maybe he needs it because he&#x27;s building on google cloud.<p>AWS is easier, but you can do it with anything. The basic steps are:<p>1. Upload the file somewhere
2. Transcode it
3. Put the parts somewhere
4. Serve the parts<p>You should really transcode everything into HLS. It&#x27;s 2023, and everything that matters supports it. If you want 4k you can use HLS or the other thing (which I keep forgetting the acronym for).<p>If you want to get fancy you can do rendition audio, which not everything supports. Rendition audio means sharing one audio stream amongst N number of video streams.<p>You can use FFMPEG to transcode, but I&#x27;d suggest using AWS MediaConvert. It&#x27;s cheap, fast, and probably does everything you want. Using FFmpeg directly works, but why bother. You will get an option wrong and screw everything up. You don&#x27;t want your video to not work on some random device that 50k people are using in some country you didn&#x27;t think about.<p>He&#x27;s using RabbitMQ but you should use SQS, because SQS can trigger lambdas...which means no polling required. But use whatever queue you want.<p>You can kick the process off by attaching a Lambda to S3, which will start the process when the file is uploaded.<p>You can kick your &quot;availability activation&quot; off by attaching a Lambda to the S3 output bucket.<p>Background: I help run a streaming service and built the backend pipeline.<p>This omits the entire &quot;metadata management and analytics&quot; side as well. That&#x27;s left as an exercise for the user.</div><br/><div id="37826877" class="c"><input type="checkbox" id="c-37826877" checked=""/><div class="controls bullet"><span class="by">mikeryan</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37829590">next</a><span>|</span><label class="collapse" for="c-37826877">[-]</label><label class="expand" for="c-37826877">[2 more]</label></div><br/><div class="children"><div class="content">I would like to know what the costs come out to per minute of video encoded and how many outputs they&#x27;re getting in order to compare this to something like Media Convert (AWS), Google Transcode or something dedicated like Mux.<p>For reference Google Transcoder is about $0.13 per minute of encoding (at four resolutions).  Mux is at $0.032 &#x2F; min, AWS Media Convert $0.0188.<p>I should note I know Mux&#x27;s pricing well, use them a lot, happily. It gets a bit confusing with Google and Media Convert because I&#x27;m not sure how these costs map to the resulting bitrate renditions that get created and I&#x27;ve not got the time for a deeper dive to get a more straight apples to apples comparison (ignore scale discounts)<p>[1] <a href="https:&#x2F;&#x2F;cloud.google.com&#x2F;transcoder&#x2F;pricing" rel="nofollow noreferrer">https:&#x2F;&#x2F;cloud.google.com&#x2F;transcoder&#x2F;pricing</a><p>[2] <a href="https:&#x2F;&#x2F;www.mux.com&#x2F;pricing&#x2F;video" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.mux.com&#x2F;pricing&#x2F;video</a><p>[3] <a href="https:&#x2F;&#x2F;aws.amazon.com&#x2F;mediaconvert&#x2F;pricing&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;aws.amazon.com&#x2F;mediaconvert&#x2F;pricing&#x2F;</a></div><br/><div id="37828358" class="c"><input type="checkbox" id="c-37828358" checked=""/><div class="controls bullet"><span class="by">hckr1292</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37826877">parent</a><span>|</span><a href="#37829590">next</a><span>|</span><label class="collapse" for="c-37828358">[-]</label><label class="expand" for="c-37828358">[1 more]</label></div><br/><div class="children"><div class="content">Full disclosure, I currently work at Mux on the video product. Previously though, I worked at an education startup with user generated video content. Like many others commenting on this thread, I built a simple queuing system using RabbitMQ and celery, transcoding on EC2 with ffmpeg. While we might have saved some money by doing this in house, we almost certainly discouraged users from uploading content because the entire video needed to transcoded before it could be viewed. For use cases like the breaking news or high traffic user generated content, you really want to minimize wait time, and that requires some kind of special sauce. At Mux, we encode content just in time for very fast publish times. Itâs very challenging to do this on your own.</div><br/></div></div></div></div><div id="37829590" class="c"><input type="checkbox" id="c-37829590" checked=""/><div class="controls bullet"><span class="by">mrd3v0</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37826877">prev</a><span>|</span><a href="#37829454">next</a><span>|</span><label class="collapse" for="c-37829590">[-]</label><label class="expand" for="c-37829590">[1 more]</label></div><br/><div class="children"><div class="content">Depending on proprietary software such as cloud offerings for something as essential to its requirements such as encoding is not sustainable, and will create technical debt as your software&#x2F;company will rely on the <i>profitable</i> success of the cloud service.</div><br/></div></div><div id="37829454" class="c"><input type="checkbox" id="c-37829454" checked=""/><div class="controls bullet"><span class="by">TheFragenTaken</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37829590">prev</a><span>|</span><a href="#37825455">next</a><span>|</span><label class="collapse" for="c-37829454">[-]</label><label class="expand" for="c-37829454">[1 more]</label></div><br/><div class="children"><div class="content">Recently got burnt by Microsoft deprecating Azure Media Services, so I can understand if the author doesn&#x27;t want to use a cloud offering for encoding.</div><br/></div></div><div id="37825455" class="c"><input type="checkbox" id="c-37825455" checked=""/><div class="controls bullet"><span class="by">jiggawatts</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37829454">prev</a><span>|</span><a href="#37827215">next</a><span>|</span><label class="collapse" for="c-37825455">[-]</label><label class="expand" for="c-37825455">[3 more]</label></div><br/><div class="children"><div class="content">This post is somewhat unfairly voted down.<p>Cloud services like S3 and Azure Storage were invented specifically for hosting images and video. Thatâs their origin story, their foundation, their very reason for being.<p>Similarly, cloud functions &#x2F; lambda were invented for background processing of blobs. The first demos were always of resizing images!<p>Building out this infrastructure yourself is a little insane. Unless youâre Netflix, donât bother. Just dump your videos into blobs.<p>Itâs like driving to your cousinâs place, but step one is building your own highway because you couldnât be bothered to check the map to see if one already existed.<p>PS: Netflix serves video from BSD running directly on bare metal because at that scale efficiency matters! If efficiency doesnât matter <i>that much</i>, use blobs. Kubernetes is going to be even worse.</div><br/><div id="37828024" class="c"><input type="checkbox" id="c-37828024" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37825455">parent</a><span>|</span><a href="#37827215">next</a><span>|</span><label class="collapse" for="c-37828024">[-]</label><label class="expand" for="c-37828024">[2 more]</label></div><br/><div class="children"><div class="content">I actually worked on system just like OP is describing and we ran everything ourselves including DBs (on k8s) so I can offer some perspective. For egress heavy services such as video minimizing outrageous cloud egress fees is key. Having an ability to tell your cloud account manager you can easily run multi-cloud or on-prem makes it a lot easier to negotiate sane rates.<p>Ultimately youâre competing with the likes of Twitch (IVS), youtube and cloudflare on price and they ALL run their own compute so at certain size you <i>will have to</i> run your own hardware to stay competitive especially now that zirp is in rear view mirror.<p>See Dropbox as another example of this but in documents&#x2F;storage space</div><br/></div></div></div></div><div id="37827215" class="c"><input type="checkbox" id="c-37827215" checked=""/><div class="controls bullet"><span class="by">c7DJTLrn</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37825455">prev</a><span>|</span><a href="#37827760">next</a><span>|</span><label class="collapse" for="c-37827215">[-]</label><label class="expand" for="c-37827215">[3 more]</label></div><br/><div class="children"><div class="content">If I&#x27;m understanding correctly you&#x27;re suggesting using Lambda for processing. Is that a good idea? Lambda is actually expensive for heavy workloads.</div><br/><div id="37827375" class="c"><input type="checkbox" id="c-37827375" checked=""/><div class="controls bullet"><span class="by">pyrophane</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37827215">parent</a><span>|</span><a href="#37827760">next</a><span>|</span><label class="collapse" for="c-37827375">[-]</label><label class="expand" for="c-37827375">[2 more]</label></div><br/><div class="children"><div class="content">I believe the Lambda would just trigger a MediaConvert process, so it would actually be doing very little.</div><br/><div id="37827492" class="c"><input type="checkbox" id="c-37827492" checked=""/><div class="controls bullet"><span class="by">c7DJTLrn</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37827375">parent</a><span>|</span><a href="#37827760">next</a><span>|</span><label class="collapse" for="c-37827492">[-]</label><label class="expand" for="c-37827492">[1 more]</label></div><br/><div class="children"><div class="content">Ah, got it, thanks.</div><br/></div></div></div></div></div></div><div id="37827760" class="c"><input type="checkbox" id="c-37827760" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37827215">prev</a><span>|</span><a href="#37825387">next</a><span>|</span><label class="collapse" for="c-37827760">[-]</label><label class="expand" for="c-37827760">[1 more]</label></div><br/><div class="children"><div class="content">serverless on aws is underrated if your workload can fit on it. i have an app that hasn&#x27;t received a single ounce of maintenance in like 3 years that still &quot;just works&quot;, collects revenue from stripe, does all the business logic on lambdas, generates downloadable print-friendly pdf&#x27;s on lambdas, etc. the supporting tech is dynamo + triggers for lambda, s3 and related triggers for lambda. but it would be hard for a non-expert aws user to fathom this sort of architecture, so i don&#x27;t fault others for falling down the nih rabbit hole.</div><br/></div></div><div id="37825387" class="c"><input type="checkbox" id="c-37825387" checked=""/><div class="controls bullet"><span class="by">jonnycoder</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37827760">prev</a><span>|</span><a href="#37825541">next</a><span>|</span><label class="collapse" for="c-37825387">[-]</label><label class="expand" for="c-37825387">[1 more]</label></div><br/><div class="children"><div class="content">What would you recommend using as an alternative to being locked into AWS?</div><br/></div></div><div id="37826694" class="c"><input type="checkbox" id="c-37826694" checked=""/><div class="controls bullet"><span class="by">_joel</span><span>|</span><a href="#37825297">parent</a><span>|</span><a href="#37825541">prev</a><span>|</span><a href="#37825491">next</a><span>|</span><label class="collapse" for="c-37826694">[-]</label><label class="expand" for="c-37826694">[4 more]</label></div><br/><div class="children"><div class="content">Not one mention of MPEG-DASH</div><br/><div id="37827980" class="c"><input type="checkbox" id="c-37827980" checked=""/><div class="controls bullet"><span class="by">bmurphy1976</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37826694">parent</a><span>|</span><a href="#37826794">next</a><span>|</span><label class="collapse" for="c-37827980">[-]</label><label class="expand" for="c-37827980">[1 more]</label></div><br/><div class="children"><div class="content">You need to use MPEG DASH if you are contractually obligated to use DRM. You can create an M3U8 and an MPEG DASH manifest that share the same encrypted segment files.</div><br/></div></div><div id="37826794" class="c"><input type="checkbox" id="c-37826794" checked=""/><div class="controls bullet"><span class="by">mikeryan</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37826694">parent</a><span>|</span><a href="#37827980">prev</a><span>|</span><a href="#37825491">next</a><span>|</span><label class="collapse" for="c-37826794">[-]</label><label class="expand" for="c-37826794">[2 more]</label></div><br/><div class="children"><div class="content">I believe thats what <i>&quot;or the other thing (which I keep forgetting the acronym for).&quot;</i> was referring to.</div><br/><div id="37829571" class="c"><input type="checkbox" id="c-37829571" checked=""/><div class="controls bullet"><span class="by">_joel</span><span>|</span><a href="#37825297">root</a><span>|</span><a href="#37826794">parent</a><span>|</span><a href="#37825491">next</a><span>|</span><label class="collapse" for="c-37829571">[-]</label><label class="expand" for="c-37829571">[1 more]</label></div><br/><div class="children"><div class="content">Well it&#x27;s an international standard, no biggie.</div><br/></div></div></div></div></div></div></div></div><div id="37825491" class="c"><input type="checkbox" id="c-37825491" checked=""/><div class="controls bullet"><span class="by">thomasjudge</span><span>|</span><a href="#37825297">prev</a><span>|</span><a href="#37829724">next</a><span>|</span><label class="collapse" for="c-37825491">[-]</label><label class="expand" for="c-37825491">[3 more]</label></div><br/><div class="children"><div class="content">OP mentions that &quot;I would love to be a little mouse and peek at YouTubeâs complete architecture to see how far we are from them.&quot; You can occasionally find posts -often linked here- from another player in streaming video which you might have heard of, discussing technical architecture. For example, this might be a little lower level that you may be interested in as it relates to kernel optimizations to jack bit throughput rates, but I dig this sort of thing -<p><a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=36qZYL5RlgY">https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v=36qZYL5RlgY</a></div><br/><div id="37827240" class="c"><input type="checkbox" id="c-37827240" checked=""/><div class="controls bullet"><span class="by">c7DJTLrn</span><span>|</span><a href="#37825491">parent</a><span>|</span><a href="#37829724">next</a><span>|</span><label class="collapse" for="c-37827240">[-]</label><label class="expand" for="c-37827240">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve heard somewhere that YouTube has their own transcoding hardware.</div><br/><div id="37827626" class="c"><input type="checkbox" id="c-37827626" checked=""/><div class="controls bullet"><span class="by">EricBurnett</span><span>|</span><a href="#37825491">root</a><span>|</span><a href="#37827240">parent</a><span>|</span><a href="#37829724">next</a><span>|</span><label class="collapse" for="c-37827626">[-]</label><label class="expand" for="c-37827626">[1 more]</label></div><br/><div class="children"><div class="content">Indeed. <a href="https:&#x2F;&#x2F;blog.youtube&#x2F;inside-youtube&#x2F;new-era-video-infrastructure&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;blog.youtube&#x2F;inside-youtube&#x2F;new-era-video-infrastruc...</a> , <a href="https:&#x2F;&#x2F;research.google&#x2F;pubs&#x2F;pub50300&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;research.google&#x2F;pubs&#x2F;pub50300&#x2F;</a> . (Search the paper title and you should be able to find the pdf itself elsewhere).<p>I&#x27;m not actually sure on balance how much transcode gets done in hardware vs software, since it&#x27;s also very amenable to using batch compute that&#x27;s otherwise idle. I&#x27;ll guess that most or all live transcoding - streams, on-the-fly transcode into formats not pregenerated - are done in hardware, and transcoding new formats for the back catalog are probably done on a mixture of mechanisms where and when capacity is available.
(Source: Googler, not on YouTube though.)</div><br/></div></div></div></div></div></div><div id="37829724" class="c"><input type="checkbox" id="c-37829724" checked=""/><div class="controls bullet"><span class="by">sonof0dn</span><span>|</span><a href="#37825491">prev</a><span>|</span><a href="#37825464">next</a><span>|</span><label class="collapse" for="c-37829724">[-]</label><label class="expand" for="c-37829724">[1 more]</label></div><br/><div class="children"><div class="content">Great article. The other day in my local dev group I gave a talk about something similar but much less sophisticated.</div><br/></div></div><div id="37825464" class="c"><input type="checkbox" id="c-37825464" checked=""/><div class="controls bullet"><span class="by">FaisalMahmoud</span><span>|</span><a href="#37829724">prev</a><span>|</span><a href="#37826755">next</a><span>|</span><label class="collapse" for="c-37825464">[-]</label><label class="expand" for="c-37825464">[1 more]</label></div><br/><div class="children"><div class="content">For general video streaming, Mux.com has greatly decreased my development time. Getting playback working is straightforward. And for advanced use cases, like real time editing and preview in a web browser, it works as expected and doesnât get in the way.</div><br/></div></div><div id="37826755" class="c"><input type="checkbox" id="c-37826755" checked=""/><div class="controls bullet"><span class="by">jspizziri</span><span>|</span><a href="#37825464">prev</a><span>|</span><a href="#37824275">next</a><span>|</span><label class="collapse" for="c-37826755">[-]</label><label class="expand" for="c-37826755">[1 more]</label></div><br/><div class="children"><div class="content">Weâve built a similar pipeline architecture for our product. One key thing Iâll mention is that weâre using Shaka-streamer which is a python wrapper around Shaka-packager (which in turn is a wrapper around ffmpeg). We queue our transcode jobs into a redis queue, and use k8s to scale the transcode workers based on queue volume. Lastly, as a few folks have mentioned, we have an experimental on-prem transcoding cluster with consumer grade HW that is pretty cheap.<p>If youâre interested in working on transcoding Iâd highly recommend taking a look at Shaka-packager&#x2F;streamer.</div><br/></div></div><div id="37824275" class="c"><input type="checkbox" id="c-37824275" checked=""/><div class="controls bullet"><span class="by">totallyunknown</span><span>|</span><a href="#37826755">prev</a><span>|</span><a href="#37828069">next</a><span>|</span><label class="collapse" for="c-37824275">[-]</label><label class="expand" for="c-37824275">[1 more]</label></div><br/><div class="children"><div class="content">While the article provides guidance on utilizing standard software and services to construct a basic video upload platform, it lacks deeper insights into advanced scaling techniques.</div><br/></div></div><div id="37828069" class="c"><input type="checkbox" id="c-37828069" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#37824275">prev</a><span>|</span><a href="#37828352">next</a><span>|</span><label class="collapse" for="c-37828069">[-]</label><label class="expand" for="c-37828069">[1 more]</label></div><br/><div class="children"><div class="content">I used to work on system like this and even built the logic to use preemptible pool effectively just like OP. If I had to design it from scratch today I would use Temporal for job scheduling - their durable compute concept is perfect fit for this and we had a lot of trouble maturing the equivalent scheduling system trying to keep up with rapidly growing scale</div><br/></div></div><div id="37828352" class="c"><input type="checkbox" id="c-37828352" checked=""/><div class="controls bullet"><span class="by">adityapatadia</span><span>|</span><a href="#37828069">prev</a><span>|</span><a href="#37823700">next</a><span>|</span><label class="collapse" for="c-37828352">[-]</label><label class="expand" for="c-37828352">[1 more]</label></div><br/><div class="children"><div class="content">Shameless plug here. In case someone does not want to build any of this and still stream video, you can check <a href="https:&#x2F;&#x2F;www.gumlet.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.gumlet.com</a></div><br/></div></div><div id="37823700" class="c"><input type="checkbox" id="c-37823700" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#37828352">prev</a><span>|</span><a href="#37823853">next</a><span>|</span><label class="collapse" for="c-37823700">[-]</label><label class="expand" for="c-37823700">[13 more]</label></div><br/><div class="children"><div class="content">Must be expensive to run on Google Cloud.<p>Also looks pretty complex.<p>The stabilization step presumably does a video encode â¦. thatâs extremely expensive in terms of time, compute and money I wonder why itâs necessary.</div><br/><div id="37825357" class="c"><input type="checkbox" id="c-37825357" checked=""/><div class="controls bullet"><span class="by">alexandreolive</span><span>|</span><a href="#37823700">parent</a><span>|</span><a href="#37823913">next</a><span>|</span><label class="collapse" for="c-37825357">[-]</label><label class="expand" for="c-37825357">[1 more]</label></div><br/><div class="children"><div class="content">Hello, I&#x27;m the writer of the article. Our solution gets videos from random people who present products we sent them. We get dodgy videos filmed on bad devices, and the process of contacting the user and getting him to re-upload another video in better quality is time-consuming for our team. We&#x27;d rather spend a little bit more in computing to try and save time overall. I hope this answers your question.</div><br/></div></div><div id="37823913" class="c"><input type="checkbox" id="c-37823913" checked=""/><div class="controls bullet"><span class="by">klaussilveira</span><span>|</span><a href="#37823700">parent</a><span>|</span><a href="#37825357">prev</a><span>|</span><a href="#37823850">next</a><span>|</span><label class="collapse" for="c-37823913">[-]</label><label class="expand" for="c-37823913">[5 more]</label></div><br/><div class="children"><div class="content">I wonder if it wouldn&#x27;t be cheaper to run an on-prem farm of BestBuy-grade &quot;gamer PC&quot; for smaller scale networks like that.</div><br/><div id="37828285" class="c"><input type="checkbox" id="c-37828285" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37823913">parent</a><span>|</span><a href="#37824058">next</a><span>|</span><label class="collapse" for="c-37828285">[-]</label><label class="expand" for="c-37828285">[1 more]</label></div><br/><div class="children"><div class="content">Twitch used to use cheap cores with Intel quicksync and maybe still does</div><br/></div></div><div id="37824058" class="c"><input type="checkbox" id="c-37824058" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37823913">parent</a><span>|</span><a href="#37828285">prev</a><span>|</span><a href="#37823850">next</a><span>|</span><label class="collapse" for="c-37824058">[-]</label><label class="expand" for="c-37824058">[3 more]</label></div><br/><div class="children"><div class="content">Slap one of these puppies inâ¦.<p>AMD Alveo MA35D Media Accelerator<p><a href="https:&#x2F;&#x2F;www.xilinx.com&#x2F;applications&#x2F;data-center&#x2F;video-imaging&#x2F;alveo-ma35d.html" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.xilinx.com&#x2F;applications&#x2F;data-center&#x2F;video-imagin...</a></div><br/><div id="37825132" class="c"><input type="checkbox" id="c-37825132" checked=""/><div class="controls bullet"><span class="by">goeiedaggoeie</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37824058">parent</a><span>|</span><a href="#37823850">next</a><span>|</span><label class="collapse" for="c-37825132">[-]</label><label class="expand" for="c-37825132">[2 more]</label></div><br/><div class="children"><div class="content">Ive used xilinx a fair bit for encoding. once you get past the pain of compiling your tooling for it it does speed up VOD encode significantly.</div><br/><div id="37828280" class="c"><input type="checkbox" id="c-37828280" checked=""/><div class="controls bullet"><span class="by">dilyevsky</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37825132">parent</a><span>|</span><a href="#37823850">next</a><span>|</span><label class="collapse" for="c-37828280">[-]</label><label class="expand" for="c-37828280">[1 more]</label></div><br/><div class="children"><div class="content">Howâs the quality? I heard it was so-so and i think you canât close your own presets</div><br/></div></div></div></div></div></div></div></div><div id="37823850" class="c"><input type="checkbox" id="c-37823850" checked=""/><div class="controls bullet"><span class="by">latchkey</span><span>|</span><a href="#37823700">parent</a><span>|</span><a href="#37823913">prev</a><span>|</span><a href="#37824426">next</a><span>|</span><label class="collapse" for="c-37823850">[-]</label><label class="expand" for="c-37823850">[1 more]</label></div><br/><div class="children"><div class="content">Not necessarily. GCP, when used correctly, can be super cheap. You also don&#x27;t know the contractual deals they have with GCP.</div><br/></div></div><div id="37823770" class="c"><input type="checkbox" id="c-37823770" checked=""/><div class="controls bullet"><span class="by">tehlike</span><span>|</span><a href="#37823700">parent</a><span>|</span><a href="#37824426">prev</a><span>|</span><a href="#37823853">next</a><span>|</span><label class="collapse" for="c-37823770">[-]</label><label class="expand" for="c-37823770">[4 more]</label></div><br/><div class="children"><div class="content">I was thinking the same. CF on the front would improve on it but still.<p>Hetzner or other bare metal providers would probably be a better idea.</div><br/><div id="37824897" class="c"><input type="checkbox" id="c-37824897" checked=""/><div class="controls bullet"><span class="by">hotnfresh</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37823770">parent</a><span>|</span><a href="#37823853">next</a><span>|</span><label class="collapse" for="c-37824897">[-]</label><label class="expand" for="c-37824897">[3 more]</label></div><br/><div class="children"><div class="content">CF meaning Cloudflare? If youâre serving video through them, then youâre in âenterprise planâ territory. You canât do that on the free or âself-serveâ paid plans. $5k+&#x2F;m depending on bandwidth needs (and if you just need a cdn to push bits, CF wonât be competitive on priceâtheir enterprise prices are tailored for companies that want all sorts of managed services and private networking stuff)</div><br/><div id="37827666" class="c"><input type="checkbox" id="c-37827666" checked=""/><div class="controls bullet"><span class="by">mikeryan</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37824897">parent</a><span>|</span><a href="#37823853">next</a><span>|</span><label class="collapse" for="c-37827666">[-]</label><label class="expand" for="c-37827666">[2 more]</label></div><br/><div class="children"><div class="content">Um. Cloudflare stream starts at $5 per month and you donât pay for encoding only storage and bandwidth.  You can serve a decent video library for $500 per month.<p><a href="https:&#x2F;&#x2F;www.cloudflare.com&#x2F;products&#x2F;cloudflare-stream&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.cloudflare.com&#x2F;products&#x2F;cloudflare-stream&#x2F;</a></div><br/><div id="37827916" class="c"><input type="checkbox" id="c-37827916" checked=""/><div class="controls bullet"><span class="by">hotnfresh</span><span>|</span><a href="#37823700">root</a><span>|</span><a href="#37827666">parent</a><span>|</span><a href="#37823853">next</a><span>|</span><label class="collapse" for="c-37827916">[-]</label><label class="expand" for="c-37827916">[1 more]</label></div><br/><div class="children"><div class="content">Ah, mustâve changed up their billing structure to provide more add-ons for the self-serve plans since last time I was dealing them them. Thatâs good.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="37823853" class="c"><input type="checkbox" id="c-37823853" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#37823700">prev</a><span>|</span><a href="#37828631">next</a><span>|</span><label class="collapse" for="c-37823853">[-]</label><label class="expand" for="c-37823853">[20 more]</label></div><br/><div class="children"><div class="content">I have to ask, why bother with Kubernetes and all the associated config and pain? Why not just start a new spot instance? I canât see any reason for Kubernetes in this architecture even though itâs the title of the post.<p>Also personally I wouldnât use rabbitmq â¦ itâs pretty heavyweightâ¦ thereâs lots of lightweight queues out there. Overall this architecture looks like it could be simplified.<p>Also, the post doesnât mention if the video encoding uses GPU hardware acceleration. Makes a big difference especially if using spot instances â¦. ffmpeg in CPU is extremely computationally expensive.<p>Presumably all input videos need reencoding to convert them to HLS.</div><br/><div id="37825426" class="c"><input type="checkbox" id="c-37825426" checked=""/><div class="controls bullet"><span class="by">alexandreolive</span><span>|</span><a href="#37823853">parent</a><span>|</span><a href="#37824158">next</a><span>|</span><label class="collapse" for="c-37825426">[-]</label><label class="expand" for="c-37825426">[4 more]</label></div><br/><div class="children"><div class="content">Hello, I&#x27;m the writer of the article. We are using Kubernetes for our whole architecture, consisting of around 40 microservices and cron jobs. I just wanted in this article to give an example of asynchronous architecture using Kubernetes and RabbitMQ.<p>We are using RabbitMQ because it&#x27;s my company target solution. There might better so lighter solution that would fit us but having just one for every solution is easier to maintain.<p>Great comment about GPU hardware acceleration for encoding, I&#x27;m going to look this up.</div><br/><div id="37825656" class="c"><input type="checkbox" id="c-37825656" checked=""/><div class="controls bullet"><span class="by">andrewstuart</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37825426">parent</a><span>|</span><a href="#37824158">next</a><span>|</span><label class="collapse" for="c-37825656">[-]</label><label class="expand" for="c-37825656">[3 more]</label></div><br/><div class="children"><div class="content">So Kubernetes is only in this architecture because other systems use it and its required by the parent company but not needed.<p>That&#x27;s pretty important context.</div><br/><div id="37825765" class="c"><input type="checkbox" id="c-37825765" checked=""/><div class="controls bullet"><span class="by">alexandreolive</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37825656">parent</a><span>|</span><a href="#37824158">next</a><span>|</span><label class="collapse" for="c-37825765">[-]</label><label class="expand" for="c-37825765">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not what I said; sorry if that was not clear. The parent company requires RabbitMQ, we are using Kubernetes because managing 40 microservices without it would be hell. In the article, I only showed 1 user-facing API, but it&#x27;s actually multiple services, I just did not want to complicate it too much.</div><br/></div></div></div></div></div></div><div id="37824158" class="c"><input type="checkbox" id="c-37824158" checked=""/><div class="controls bullet"><span class="by">mihaitodor</span><span>|</span><a href="#37823853">parent</a><span>|</span><a href="#37825426">prev</a><span>|</span><a href="#37826406">next</a><span>|</span><label class="collapse" for="c-37824158">[-]</label><label class="expand" for="c-37824158">[1 more]</label></div><br/><div class="children"><div class="content">I believe loads of auxiliary microservices have been omitted for brevity. Of course, those also donât require Kubernetes, but maybe they have some standardised deployment system which keeps things manageable. Donât forget about Observability and whatnot.</div><br/></div></div><div id="37826406" class="c"><input type="checkbox" id="c-37826406" checked=""/><div class="controls bullet"><span class="by">pyrophane</span><span>|</span><a href="#37823853">parent</a><span>|</span><a href="#37824158">prev</a><span>|</span><a href="#37824068">next</a><span>|</span><label class="collapse" for="c-37826406">[-]</label><label class="expand" for="c-37826406">[2 more]</label></div><br/><div class="children"><div class="content">Why do you say RabbitMQ is heavyweight? What queues do you consider more lightweight and what would be your go-to in a situation like this?</div><br/><div id="37829379" class="c"><input type="checkbox" id="c-37829379" checked=""/><div class="controls bullet"><span class="by">KronisLV</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37826406">parent</a><span>|</span><a href="#37824068">next</a><span>|</span><label class="collapse" for="c-37829379">[-]</label><label class="expand" for="c-37829379">[1 more]</label></div><br/><div class="children"><div class="content">They might be thinking of something like ZeroMQ, which is pretty well liked: <a href="https:&#x2F;&#x2F;zeromq.org&#x2F;" rel="nofollow noreferrer">https:&#x2F;&#x2F;zeromq.org&#x2F;</a><p>That said, I wouldn&#x27;t call RabbitMQ that heavyweight myself, at least when compared to something like Apache Kafka.</div><br/></div></div></div></div><div id="37824068" class="c"><input type="checkbox" id="c-37824068" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#37823853">parent</a><span>|</span><a href="#37826406">prev</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37824068">[-]</label><label class="expand" for="c-37824068">[11 more]</label></div><br/><div class="children"><div class="content">This is what I was wondering, in the article it looks like kubernetes is just used to launch the node containers - why is the database and rabbitmq outside of kubernetes? This architecture looks like itâs been cobbled together by a junior</div><br/><div id="37827026" class="c"><input type="checkbox" id="c-37827026" checked=""/><div class="controls bullet"><span class="by">sass_muffin</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37824068">parent</a><span>|</span><a href="#37825201">next</a><span>|</span><label class="collapse" for="c-37827026">[-]</label><label class="expand" for="c-37827026">[2 more]</label></div><br/><div class="children"><div class="content">It is actually the opposite, it is currently considered a good  practice to run stateful workloads outside of kubernetes and stateless workloads inside of kubernetes.</div><br/><div id="37829432" class="c"><input type="checkbox" id="c-37829432" checked=""/><div class="controls bullet"><span class="by">KronisLV</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37827026">parent</a><span>|</span><a href="#37825201">next</a><span>|</span><label class="collapse" for="c-37829432">[-]</label><label class="expand" for="c-37829432">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It is actually the opposite, it is currently considered a good practice to run stateful workloads outside of kubernetes and stateless workloads inside of kubernetes.<p>Is that still true?<p>I wouldn&#x27;t call the parent comment charitable enough, because there definitely can be some reasons for running stateful workloads even outside of containers altogether (familiarity included), but at the same time it feels like a lot of effort has been invested into making that a non-issue.<p>For example, how many database Operators are now available for Kubernetes: <a href="https:&#x2F;&#x2F;operatorhub.io&#x2F;?category=Database&amp;capabilityLevel=%5B%22Seamless+Upgrades%22%2C%22Full+Lifecycle%22%2C%22Deep+Insights%22%2C%22Auto+Pilot%22%5D" rel="nofollow noreferrer">https:&#x2F;&#x2F;operatorhub.io&#x2F;?category=Database&amp;capabilityLevel=%5...</a><p>Honestly, as long as you have storage and config setup correctly, it&#x27;s not like you even need an Operator, that&#x27;s for more advanced setups. I&#x27;ve been running databases in containers (even without Kubernetes) for years, haven&#x27;t had that many issues at small&#x2F;medium scale.</div><br/></div></div></div></div><div id="37825201" class="c"><input type="checkbox" id="c-37825201" checked=""/><div class="controls bullet"><span class="by">baq</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37824068">parent</a><span>|</span><a href="#37827026">prev</a><span>|</span><a href="#37825003">next</a><span>|</span><label class="collapse" for="c-37825201">[-]</label><label class="expand" for="c-37825201">[1 more]</label></div><br/><div class="children"><div class="content">There some of us who still perform four extra steps before putting any DB in k8s and we have good reasons.</div><br/></div></div><div id="37825003" class="c"><input type="checkbox" id="c-37825003" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37824068">parent</a><span>|</span><a href="#37825201">prev</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37825003">[-]</label><label class="expand" for="c-37825003">[7 more]</label></div><br/><div class="children"><div class="content">Kubernetes loves stateless services. Zero wrong with moving RabbitMQ or a database outside of it.</div><br/><div id="37825420" class="c"><input type="checkbox" id="c-37825420" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37825003">parent</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37825420">[-]</label><label class="expand" for="c-37825420">[6 more]</label></div><br/><div class="children"><div class="content">Except kubernetes has a whole storage provisioning system that gives you redundancy and automatic failover, if youâre going to the trouble of running kubernetes why not just run your whole infra on it?<p>I run <a href="https:&#x2F;&#x2F;atomictessellator.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;atomictessellator.com</a>  solo, using kubernetes, and my database, Minio object store, application servers, quantum workers, everything is all on kubernetes, itâs self healing and much simpler to run all the infrastructure the same.<p>Recently I had a node failure while I was sleeping and the whole system healed itself while I slept, the monitoring system didnât even alarm me because the small blip of increased latency while the pods rebalanced wasnât above the alert threshold so it didnât even wake me up.<p>What happens in the article infra when the rabbitmq or database nodes fail? The whole system goes offline, which seems very silly setup when you have kubernetes sitting right there, whoâs primary function is to handle all of this.</div><br/><div id="37827906" class="c"><input type="checkbox" id="c-37827906" checked=""/><div class="controls bullet"><span class="by">codenesium</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37825420">parent</a><span>|</span><a href="#37826096">next</a><span>|</span><label class="collapse" for="c-37827906">[-]</label><label class="expand" for="c-37827906">[2 more]</label></div><br/><div class="children"><div class="content">Rabbit and most databases have their own failover strategy. Putting it all on k8s is fine for a toy app but idk why anyone would deploy a real system like that.</div><br/><div id="37828965" class="c"><input type="checkbox" id="c-37828965" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37827906">parent</a><span>|</span><a href="#37826096">next</a><span>|</span><label class="collapse" for="c-37828965">[-]</label><label class="expand" for="c-37828965">[1 more]</label></div><br/><div class="children"><div class="content">OK, I can only speak to my personal projects and 20+ years experience at work.<p>We run all of our stateful and stateless workloads on 10+ kubernetes clusters at work in multiple datacenters in multiple continents, and we serve 500 million users a month with it.<p>I wrote the first BORG version of DFP backend systems at Google, where we served billions of users billions of ads a day, and we used stateful infrastructure management on some of the first container runtime systems that inspired k8s during it&#x27;s development.<p>Using rabbit and &quot;most databases&quot; native fallover strategy is fine for toy projects, but when you&#x27;re operating at this scale, you need automated infrastructure provisioning and all of the automated tooling around it.</div><br/></div></div></div></div><div id="37826096" class="c"><input type="checkbox" id="c-37826096" checked=""/><div class="controls bullet"><span class="by">robertlagrant</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37825420">parent</a><span>|</span><a href="#37827906">prev</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37826096">[-]</label><label class="expand" for="c-37826096">[3 more]</label></div><br/><div class="children"><div class="content">What happens when your storage detaches from your k8s cluster? Your services start 503ing, hopefully, because you didn&#x27;t design your system thinking that k8s == 100% uptime.</div><br/><div id="37826186" class="c"><input type="checkbox" id="c-37826186" checked=""/><div class="controls bullet"><span class="by">malux85</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37826096">parent</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37826186">[-]</label><label class="expand" for="c-37826186">[2 more]</label></div><br/><div class="children"><div class="content">Anybody can invent random problems ad nauseam - that doesnât prove anything.<p>Iâm not claiming that itâs totally bullet proof, I never said that - Iâm saying that if you had a kubernetes cluster anyway why not benefit from its abilities? Especially when the alternative is single node, single points of failure, which is clearly inferior.<p>The &quot;what if the storage detaches&quot; argument could easily apply to the single node VMs too, in which case the outcome would be a total system failure.<p>We are discussing the contrast between the articles architecture and running everything on K8s ... and I&#x27;m saying that running everything on K8s is clearly better</div><br/><div id="37827312" class="c"><input type="checkbox" id="c-37827312" checked=""/><div class="controls bullet"><span class="by">jrockway</span><span>|</span><a href="#37823853">root</a><span>|</span><a href="#37826186">parent</a><span>|</span><a href="#37824443">next</a><span>|</span><label class="collapse" for="c-37827312">[-]</label><label class="expand" for="c-37827312">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, what happens when someone in AWS clicks &quot;delete database&quot; accidentally?  It&#x27;s the same thing that happens when K8s blows up in some weird way.  You restore from your backup.  (Fun fact: deleting the instance deletes the backups!)</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="37828631" class="c"><input type="checkbox" id="c-37828631" checked=""/><div class="controls bullet"><span class="by">akbansa</span><span>|</span><a href="#37823853">prev</a><span>|</span><label class="collapse" for="c-37828631">[-]</label><label class="expand" for="c-37828631">[1 more]</label></div><br/><div class="children"><div class="content">I am sure it&#x27;s difficult for someone to build and scale video infrastructure. A few companies are doing it for you; plug in the APIs, and you&#x27;re done.<p>Gumlet (<a href="https:&#x2F;&#x2F;www.gumlet.com" rel="nofollow noreferrer">https:&#x2F;&#x2F;www.gumlet.com</a>): Per-title encoding (Netflix&#x27;s approach) to optimize and transcode your videos to boost engagement rates. Moreover, securing your videos is easy with digital rights management solutions paired with Widevine and Fairplay. Made for developers, by developers.<p>Mux: Developer-friendly video infrastructure for your on-demand &amp; live video needs.<p>I love Gumlet because of their pricing and support.</div><br/></div></div></div></div></div></div></div></body></html>