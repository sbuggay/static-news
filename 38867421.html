<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704445253794" as="style"/><link rel="stylesheet" href="styles.css?v=1704445253794"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/spotify/sparkey">Sparkey: A simple constant key/value storage library</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>14 comments</span></div><br/><div><div id="38870514" class="c"><input type="checkbox" id="c-38870514" checked=""/><div class="controls bullet"><span class="by">jitl</span><span>|</span><a href="#38871142">next</a><span>|</span><label class="collapse" for="c-38870514">[-]</label><label class="expand" for="c-38870514">[6 more]</label></div><br/><div class="children"><div class="content">At Airbnb we are implementing translation serving on top of Sparkey; part of our Ruby system open sourced here: <a href="https:&#x2F;&#x2F;github.com&#x2F;airbnb&#x2F;hammerspace">https:&#x2F;&#x2F;github.com&#x2F;airbnb&#x2F;hammerspace</a><p>The way the system worked (iirc it’s been a while): we’d periodically dump all the translation strings from our translation editor app (MySQL backed) into a sparkey S3 path, and use a Kubernetes daemonset to fetch the sparkey file to each host in the cluster. Finally application pods written in any language use a host volume to read translation strings from the local sparkey file. Certainly overkill for smaller apps but with a bunch of services and hundreds of thousands of translation strings, the out of band updates are well worth it and keep the app container small.</div><br/><div id="38871131" class="c"><input type="checkbox" id="c-38871131" checked=""/><div class="controls bullet"><span class="by">esprehn</span><span>|</span><a href="#38870514">parent</a><span>|</span><a href="#38871945">next</a><span>|</span><label class="collapse" for="c-38871131">[-]</label><label class="expand" for="c-38871131">[3 more]</label></div><br/><div class="children"><div class="content">IIRC many of Airbnb&#x27;s systems were implemented on top of sparkey: translations, feature flags, experiments, dynamic config. It stood the test of time really well. Probably all built by Jon Tai.</div><br/><div id="38871362" class="c"><input type="checkbox" id="c-38871362" checked=""/><div class="controls bullet"><span class="by">nurgasemetey</span><span>|</span><a href="#38870514">root</a><span>|</span><a href="#38871131">parent</a><span>|</span><a href="#38871945">next</a><span>|</span><label class="collapse" for="c-38871362">[-]</label><label class="expand" for="c-38871362">[2 more]</label></div><br/><div class="children"><div class="content">Very ingenious indeed. How would you deal with data corruptions? How it was detected? Is repair automatic?</div><br/><div id="38875419" class="c"><input type="checkbox" id="c-38875419" checked=""/><div class="controls bullet"><span class="by">esprehn</span><span>|</span><a href="#38870514">root</a><span>|</span><a href="#38871362">parent</a><span>|</span><a href="#38871945">next</a><span>|</span><label class="collapse" for="c-38875419">[-]</label><label class="expand" for="c-38875419">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t believe there was any special handling for corruption, but there was probably hash checking when syncing new data every few minutes. The data stored in there was not user data, so the failure modes are not as severe. Sparkey is also never the source of truth, it&#x27;s a local cache for each service instance.</div><br/></div></div></div></div></div></div><div id="38871945" class="c"><input type="checkbox" id="c-38871945" checked=""/><div class="controls bullet"><span class="by">mooreds</span><span>|</span><a href="#38870514">parent</a><span>|</span><a href="#38871131">prev</a><span>|</span><a href="#38870755">next</a><span>|</span><label class="collapse" for="c-38871945">[-]</label><label class="expand" for="c-38871945">[1 more]</label></div><br/><div class="children"><div class="content">Do you know if that system is still in use? The gem looks abandoned.</div><br/></div></div><div id="38870755" class="c"><input type="checkbox" id="c-38870755" checked=""/><div class="controls bullet"><span class="by">igor47</span><span>|</span><a href="#38870514">parent</a><span>|</span><a href="#38871945">prev</a><span>|</span><a href="#38871142">next</a><span>|</span><label class="collapse" for="c-38870755">[-]</label><label class="expand" for="c-38870755">[1 more]</label></div><br/><div class="children"><div class="content">Ah yes! For the Rails monolith the sparkey integration was accomplished through <a href="https:&#x2F;&#x2F;github.com&#x2F;airbnb&#x2F;hammerspace">https:&#x2F;&#x2F;github.com&#x2F;airbnb&#x2F;hammerspace</a></div><br/></div></div></div></div><div id="38871142" class="c"><input type="checkbox" id="c-38871142" checked=""/><div class="controls bullet"><span class="by">KAdot</span><span>|</span><a href="#38870514">prev</a><span>|</span><a href="#38877055">next</a><span>|</span><label class="collapse" for="c-38871142">[-]</label><label class="expand" for="c-38871142">[1 more]</label></div><br/><div class="children"><div class="content">A similar idea implemented in Go <a href="https:&#x2F;&#x2F;github.com&#x2F;akrylysov&#x2F;pogreb">https:&#x2F;&#x2F;github.com&#x2F;akrylysov&#x2F;pogreb</a> (disclaimer: I&#x27;m the author of this package).</div><br/></div></div><div id="38877055" class="c"><input type="checkbox" id="c-38877055" checked=""/><div class="controls bullet"><span class="by">secwang</span><span>|</span><a href="#38871142">prev</a><span>|</span><a href="#38875278">next</a><span>|</span><label class="collapse" for="c-38877055">[-]</label><label class="expand" for="c-38877055">[1 more]</label></div><br/><div class="children"><div class="content">glad they mentioned cdb.</div><br/></div></div><div id="38875278" class="c"><input type="checkbox" id="c-38875278" checked=""/><div class="controls bullet"><span class="by">unbearded</span><span>|</span><a href="#38877055">prev</a><span>|</span><a href="#38870209">next</a><span>|</span><label class="collapse" for="c-38875278">[-]</label><label class="expand" for="c-38875278">[1 more]</label></div><br/><div class="children"><div class="content">I use sparkey &#x2F; hammerspace for caching static data (tried rocksdb but hammerspace was faster) for many years.<p>It helps me have a 20ms on a 100r&#x2F;s on a ruby on rails app (ruunning on a ryzen 5950X). I keep seeing people brag about 100ms on applications and maybe I’m old school or haven’t seen enough, but 100ms breaks personal SLO.  will trigger a 5-alarm alert.
Also use redis a lot. But when possible, I use hammerspace&#x2F;sparkey instead of it.</div><br/></div></div><div id="38870209" class="c"><input type="checkbox" id="c-38870209" checked=""/><div class="controls bullet"><span class="by">vitiral</span><span>|</span><a href="#38875278">prev</a><span>|</span><a href="#38874503">next</a><span>|</span><label class="collapse" for="c-38870209">[-]</label><label class="expand" for="c-38870209">[1 more]</label></div><br/><div class="children"><div class="content">Hey, this is effectively the same idea I&#x27;m going to implement!<p><a href="https:&#x2F;&#x2F;github.com&#x2F;civboot&#x2F;civboot&#x2F;blob&#x2F;main&#x2F;blog&#x2F;0012-dev-libraries-and-software.md#loam-keyvalue-store">https:&#x2F;&#x2F;github.com&#x2F;civboot&#x2F;civboot&#x2F;blob&#x2F;main&#x2F;blog&#x2F;0012-dev-l...</a><p>Mine will be slightly more than key&#x2F;value. My index file will support indexes of arbitrary record fields as well as the index of all items in loam, but it&#x27;s effectively the same idea.<p>Note you could keep a live instance running to handle live writes, which uses an in-memory hash for recent writes and updates the hash index as-needed. Because the index can be rebuilt from the data there is no concern about data loss.</div><br/></div></div><div id="38876074" class="c"><input type="checkbox" id="c-38876074" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#38874503">prev</a><span>|</span><a href="#38876261">next</a><span>|</span><label class="collapse" for="c-38876074">[-]</label><label class="expand" for="c-38876074">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>Sparkey – Key&#x2F;value storage by Spotify</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=6314310">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=6314310</a> - Sept 2013 (55 comments)</div><br/></div></div></div></div></div></div></div></body></html>