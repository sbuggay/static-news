<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1693990869238" as="style"/><link rel="stylesheet" href="styles.css?v=1693990869238"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://stevelosh.com/blog/2021/03/small-common-lisp-cli-programs/">Writing Small CLI Programs in Common Lisp (2021)</a> <span class="domain">(<a href="https://stevelosh.com">stevelosh.com</a>)</span></div><div class="subtext"><span>mooreds</span> | <span>12 comments</span></div><br/><div><div id="37402539" class="c"><input type="checkbox" id="c-37402539" checked=""/><div class="controls bullet"><span class="by">ducktective</span><span>|</span><a href="#37401828">next</a><span>|</span><label class="collapse" for="c-37402539">[-]</label><label class="expand" for="c-37402539">[3 more]</label></div><br/><div class="children"><div class="content">Awesome, but there is kind of a deal-breaker here:<p>AFAIK, there isn&#x27;t an official and hassle-free way to generate a statically-compiled binary with SBCL the way Go and Rust can. Like you develop on a debian 12 system, then move the binary to your debian 11 server only to be confronted with the notorious &#x27;incompatible glibc version error&#x27;. It&#x27;s super annoying.<p>In ECL, I <i>think</i> it&#x27;s possible to use musl and bundle libecl and mucl libc into the final binary, but I&#x27;m not sure.<p>The caveat is ECL output startup time is around 500ms (as opposed to the much more performant SBCL output)</div><br/><div id="37402572" class="c"><input type="checkbox" id="c-37402572" checked=""/><div class="controls bullet"><span class="by">nathell</span><span>|</span><a href="#37402539">parent</a><span>|</span><a href="#37401828">next</a><span>|</span><label class="collapse" for="c-37402572">[-]</label><label class="expand" for="c-37402572">[2 more]</label></div><br/><div class="children"><div class="content">Sure there is, as always: load all the code into the running SBCL, then call (SB-EXT:SAVE-LISP-AND-DIE :EXECUTABLE T :TOPLEVEL your-entry-point). The downside, as always, is that this kills the Lisp process, and the resulting binary weighs tens of megabytes even for a simple hello world. I guess one of these disqualifies it as not hassle-free.</div><br/><div id="37402588" class="c"><input type="checkbox" id="c-37402588" checked=""/><div class="controls bullet"><span class="by">ducktective</span><span>|</span><a href="#37402539">root</a><span>|</span><a href="#37402572">parent</a><span>|</span><a href="#37401828">next</a><span>|</span><label class="collapse" for="c-37402588">[-]</label><label class="expand" for="c-37402588">[1 more]</label></div><br/><div class="children"><div class="content">No, I mean the dumped image depends on system glibc (not portable)</div><br/></div></div></div></div></div></div><div id="37401828" class="c"><input type="checkbox" id="c-37401828" checked=""/><div class="controls bullet"><span class="by">bjoli</span><span>|</span><a href="#37402539">prev</a><span>|</span><a href="#37400883">next</a><span>|</span><label class="collapse" for="c-37401828">[-]</label><label class="expand" for="c-37401828">[1 more]</label></div><br/><div class="children"><div class="content">I decided to port all my old perl scripts to guile scheme recently and got to add a bunch of nicities (like properly cleaning up on ctrl-c). Not because I really needed to, but because I haven&#x27;t written perl seriously since 2010 and updating the scripts has started becoming hard.<p>The guile manual is pretty nice, but having something like this will always help people get started. For people that don&#x27;t know about things like how non-local exits work getting started and doing it correctly can really take some time to figure out.</div><br/></div></div><div id="37400883" class="c"><input type="checkbox" id="c-37400883" checked=""/><div class="controls bullet"><span class="by">mooreds</span><span>|</span><a href="#37401828">prev</a><span>|</span><a href="#37401998">next</a><span>|</span><label class="collapse" for="c-37400883">[-]</label><label class="expand" for="c-37400883">[2 more]</label></div><br/><div class="children"><div class="content">Past discussion: <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26493588">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26493588</a></div><br/><div id="37402342" class="c"><input type="checkbox" id="c-37402342" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#37400883">parent</a><span>|</span><a href="#37401998">next</a><span>|</span><label class="collapse" for="c-37402342">[-]</label><label class="expand" for="c-37402342">[1 more]</label></div><br/><div class="children"><div class="content">Thanks! Macroexpanded:<p><i>Writing Small CLI Programs in Common Lisp</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26493588">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=26493588</a> - March 2021 (61 comments)</div><br/></div></div></div></div><div id="37401998" class="c"><input type="checkbox" id="c-37401998" checked=""/><div class="controls bullet"><span class="by">rawoke083600</span><span>|</span><a href="#37400883">prev</a><span>|</span><a href="#37400975">next</a><span>|</span><label class="collapse" for="c-37401998">[-]</label><label class="expand" for="c-37401998">[2 more]</label></div><br/><div class="children"><div class="content">very good article, nice and practical<p>An alternative is also Babashka which is excellent for this !
<a href="https:&#x2F;&#x2F;github.com&#x2F;babashka&#x2F;babashka">https:&#x2F;&#x2F;github.com&#x2F;babashka&#x2F;babashka</a></div><br/><div id="37402375" class="c"><input type="checkbox" id="c-37402375" checked=""/><div class="controls bullet"><span class="by">vindarel</span><span>|</span><a href="#37401998">parent</a><span>|</span><a href="#37400975">next</a><span>|</span><label class="collapse" for="c-37402375">[-]</label><label class="expand" for="c-37402375">[1 more]</label></div><br/><div class="children"><div class="content">and for CL: <a href="https:&#x2F;&#x2F;github.com&#x2F;ciel-lang&#x2F;CIEL&#x2F;">https:&#x2F;&#x2F;github.com&#x2F;ciel-lang&#x2F;CIEL&#x2F;</a> (pre-alpha) CL with many batteries included (json, csv, http, CLI parser…) so the scripts start fast.</div><br/></div></div></div></div><div id="37400975" class="c"><input type="checkbox" id="c-37400975" checked=""/><div class="controls bullet"><span class="by">dannyobrien</span><span>|</span><a href="#37401998">prev</a><span>|</span><a href="#37401431">next</a><span>|</span><label class="collapse" for="c-37400975">[-]</label><label class="expand" for="c-37400975">[2 more]</label></div><br/><div class="children"><div class="content">amusingly i was just wrangling with how to do this yesterday, while writing a CLI common lisp file-watching testrunner.<p>i ended up heading toward something that was more engineered to run a simple repl function call via SWANK, because i&#x27;m increasingly settled to having a single, long-running SBCL image rather than starting up individually compiled or interpreted lisp scripts. Feels more lispy somehow -- and definitely better for TDD.</div><br/><div id="37401207" class="c"><input type="checkbox" id="c-37401207" checked=""/><div class="controls bullet"><span class="by">fiddlerwoaroof</span><span>|</span><a href="#37400975">parent</a><span>|</span><a href="#37401431">next</a><span>|</span><label class="collapse" for="c-37401207">[-]</label><label class="expand" for="c-37401207">[1 more]</label></div><br/><div class="children"><div class="content">Yeah, that’s definitely where I’ve ended up: I have a lot of lisp code, but it’s more of a toolbox for my shell (REPL) than standalone programs.<p>However, I’ve settled on a pattern that works pretty well for the few small tools I write: <a href="https:&#x2F;&#x2F;github.com&#x2F;fiddlerwoaroof&#x2F;dotfiles&#x2F;blob&#x2F;18cecfc93bcf935427580e1616d6c748b7f43396&#x2F;tools&#x2F;Makefile#L3">https:&#x2F;&#x2F;github.com&#x2F;fiddlerwoaroof&#x2F;dotfiles&#x2F;blob&#x2F;18cecfc93bcf...</a></div><br/></div></div></div></div><div id="37401431" class="c"><input type="checkbox" id="c-37401431" checked=""/><div class="controls bullet"><span class="by">julianeon</span><span>|</span><a href="#37400975">prev</a><span>|</span><label class="collapse" for="c-37401431">[-]</label><label class="expand" for="c-37401431">[1 more]</label></div><br/><div class="children"><div class="content">This reminds me of something I thought about taking back up:<p>A while back I wrote a number of Emacs scripts so that I could listen to Discord messages, as they were streaming in basically, and then &#x27;do Lisp&#x27; on them. For example, take the data that was streaming in and format it into a web page with a few links I could then investigate. I may get back into that.</div><br/></div></div></div></div></div></div></div></body></html>