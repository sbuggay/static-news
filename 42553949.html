<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735635663378" as="style"/><link rel="stylesheet" href="styles.css?v=1735635663378"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://jonot.me/posts/zig-gba/">I wrote a Game Boy Advance game in Zig</a> <span class="domain">(<a href="https://jonot.me">jonot.me</a>)</span></div><div class="subtext"><span>tehnub</span> | <span>56 comments</span></div><br/><div><div id="42556773" class="c"><input type="checkbox" id="c-42556773" checked=""/><div class="controls bullet"><span class="by">AndyKelley</span><span>|</span><a href="#42556580">next</a><span>|</span><label class="collapse" for="c-42556773">[-]</label><label class="expand" for="c-42556773">[1 more]</label></div><br/><div class="children"><div class="content">&gt; it would be nice if there was some way to specify how memory in certain address ranges need to be addressed.<p>If making the respective loads and stores volatile doesn&#x27;t solve this problem please feel free to file a bug against the compiler.<p><a href="https:&#x2F;&#x2F;ziglang.org&#x2F;documentation&#x2F;0.13.0&#x2F;#volatile" rel="nofollow">https:&#x2F;&#x2F;ziglang.org&#x2F;documentation&#x2F;0.13.0&#x2F;#volatile</a></div><br/></div></div><div id="42556580" class="c"><input type="checkbox" id="c-42556580" checked=""/><div class="controls bullet"><span class="by">zzo38computer</span><span>|</span><a href="#42556773">prev</a><span>|</span><a href="#42555205">next</a><span>|</span><label class="collapse" for="c-42556580">[-]</label><label class="expand" for="c-42556580">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Did you know that you can’t write to video memory on the Game Boy Advance in units of 8 bits, and if you do, it’ll still work but all your graphics will be messed up with no obvious way to figure it out unless you read one specific paragraph of the documentation?<p>I did. At one time I did write a program that wrote to video memory in units of 8 bits, but the emulator I was using did not prevent that, so my program worked on the emulator but not on the real hardware, and I could not figure it out until I found out that was the problem and I managed to fix my program so that it would work.</div><br/><div id="42556731" class="c"><input type="checkbox" id="c-42556731" checked=""/><div class="controls bullet"><span class="by">yard2010</span><span>|</span><a href="#42556580">parent</a><span>|</span><a href="#42555205">next</a><span>|</span><label class="collapse" for="c-42556731">[-]</label><label class="expand" for="c-42556731">[1 more]</label></div><br/><div class="children"><div class="content">How did you find the cause of it?</div><br/></div></div></div></div><div id="42555205" class="c"><input type="checkbox" id="c-42555205" checked=""/><div class="controls bullet"><span class="by">dijit</span><span>|</span><a href="#42556580">prev</a><span>|</span><a href="#42555858">next</a><span>|</span><label class="collapse" for="c-42555205">[-]</label><label class="expand" for="c-42555205">[24 more]</label></div><br/><div class="children"><div class="content">&gt; I started using Linux five years ago, mainly because I couldn’t figure out how to get Python working on Windows<p>Windows being by far the most dominant operating system from 97-2015 definitely exacerbated a dearth in knowledge among the young. In the early days internet access was not ubiquitous and shipping an operating system without even a primitive programming environment definitely lead to missed years of programming for me.<p>I learned a lot about windows, lots of UIs and how the system was constructed somewhat, but no visual studio, no functioning compiler in base and the only interpreter being <i>fucking batchfiles</i> with no docs… come on…</div><br/><div id="42555584" class="c"><input type="checkbox" id="c-42555584" checked=""/><div class="controls bullet"><span class="by">alexjplant</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555504">next</a><span>|</span><label class="collapse" for="c-42555584">[-]</label><label class="expand" for="c-42555584">[1 more]</label></div><br/><div class="children"><div class="content">I will also say that starting to use Linux in earnest around the age of 20 was a very humbling experience having been raised on Windows. Back in the 00s being able to deal with Microsoft esoterica by way of registry hacks and MMC snap-in wizardry meant that you were a &quot;smart computer kid&quot; that non-technical folks found impressive. It wasn&#x27;t until I started using an OS that acted more consistently and predictably that I realized I&#x27;d been building a career (and decently-sized ego) out of Microsoft-specific make-work. Being freed up to learn more timeless and universal concepts lined up perfectly with my college coursework centered around writing shells, compilers, etc. and completely changed how I interacted with computers for the better.<p>Apropos - if I ever win the lottery and don&#x27;t need a job I&#x27;m going to spend some time learning Plan 9. Superficially it seems to be Unix without many of the warts combined with some concepts from NT&#x2F;VMS that make good sense.</div><br/></div></div><div id="42555504" class="c"><input type="checkbox" id="c-42555504" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555584">prev</a><span>|</span><a href="#42555318">next</a><span>|</span><label class="collapse" for="c-42555504">[-]</label><label class="expand" for="c-42555504">[8 more]</label></div><br/><div class="children"><div class="content">Python is actually relatively easy to set up on Windows.  (Or at least it was easy to set up on Windows 98 in the early 2000s.  I don&#x27;t know how it&#x27;s now, or five years ago.)<p>You just download the official Python installer, and off you go.  It even comes with Idle as a reasonably good IDE.</div><br/><div id="42555541" class="c"><input type="checkbox" id="c-42555541" checked=""/><div class="controls bullet"><span class="by">nicce</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555504">parent</a><span>|</span><a href="#42555685">next</a><span>|</span><label class="collapse" for="c-42555541">[-]</label><label class="expand" for="c-42555541">[2 more]</label></div><br/><div class="children"><div class="content">If you run python in command-line, it starts Windows Store…</div><br/><div id="42555788" class="c"><input type="checkbox" id="c-42555788" checked=""/><div class="controls bullet"><span class="by">a1o</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555541">parent</a><span>|</span><a href="#42555685">next</a><span>|</span><label class="collapse" for="c-42555788">[-]</label><label class="expand" for="c-42555788">[1 more]</label></div><br/><div class="children"><div class="content">The python from Windows Store is not good, it redirects some path writes and will make the debugging experience of tools using python dreadful. Always install from the win32 installer from the website.</div><br/></div></div></div></div><div id="42555685" class="c"><input type="checkbox" id="c-42555685" checked=""/><div class="controls bullet"><span class="by">actuallyalys</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555504">parent</a><span>|</span><a href="#42555541">prev</a><span>|</span><a href="#42556837">next</a><span>|</span><label class="collapse" for="c-42555685">[-]</label><label class="expand" for="c-42555685">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s currently just as easy to use for learning and experimenting on Windows as you describe. I don&#x27;t use Python on Windows heavily enough to evaluate it for more serious development.</div><br/></div></div><div id="42556837" class="c"><input type="checkbox" id="c-42556837" checked=""/><div class="controls bullet"><span class="by">m1keil</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555504">parent</a><span>|</span><a href="#42555685">prev</a><span>|</span><a href="#42557070">next</a><span>|</span><label class="collapse" for="c-42556837">[-]</label><label class="expand" for="c-42556837">[1 more]</label></div><br/><div class="children"><div class="content">I started using python at around 2.6&#x2F;2.7, and while it was easy to install python on windows, anything that involved non pure python was a nightmare.<p>Back in these days you had no wheels and I think it was at least a partial reason for why conda was a thing.</div><br/></div></div><div id="42557070" class="c"><input type="checkbox" id="c-42557070" checked=""/><div class="controls bullet"><span class="by">rvba</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555504">parent</a><span>|</span><a href="#42556837">prev</a><span>|</span><a href="#42556263">next</a><span>|</span><label class="collapse" for="c-42557070">[-]</label><label class="expand" for="c-42557070">[1 more]</label></div><br/><div class="children"><div class="content">Long time ago I participated in a Python course, where it just wouldnt work for half of the students (like 10 people) - and the lecturer couldnt figure it out.<p>As far as I remember Python REQUIRED to be installed on C: and in something like C:\Python where it would bring 5000 various files.<p>Even more time ago, I was at a Java class, where my code would work on my computer but just wouldnt work on the computer of the lecturer. I remember the guy spend like 10 minutes looking at the (very simple) code and trying to figure out why the code worked on Windows but not on Linux</div><br/></div></div><div id="42556263" class="c"><input type="checkbox" id="c-42556263" checked=""/><div class="controls bullet"><span class="by">thrdbndndn</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555504">parent</a><span>|</span><a href="#42557070">prev</a><span>|</span><a href="#42555318">next</a><span>|</span><label class="collapse" for="c-42556263">[-]</label><label class="expand" for="c-42556263">[2 more]</label></div><br/><div class="children"><div class="content">Yeah, upgrading Python from build-in ancient version that came with Linux distro (usually 3.8, or even 2.x) is actually much harder than doing so on Windows.</div><br/><div id="42557093" class="c"><input type="checkbox" id="c-42557093" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42556263">parent</a><span>|</span><a href="#42555318">next</a><span>|</span><label class="collapse" for="c-42557093">[-]</label><label class="expand" for="c-42557093">[1 more]</label></div><br/><div class="children"><div class="content">you don&#x27;t have to upgrade, you can have more than one python install at the same time. You only really need to know about how to manage your PATH environment variable.</div><br/></div></div></div></div></div></div><div id="42555318" class="c"><input type="checkbox" id="c-42555318" checked=""/><div class="controls bullet"><span class="by">ashleyn</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555504">prev</a><span>|</span><a href="#42556098">next</a><span>|</span><label class="collapse" for="c-42555318">[-]</label><label class="expand" for="c-42555318">[6 more]</label></div><br/><div class="children"><div class="content">windows 95 did come with Qbasic for MS-DOS. it wasn&#x27;t the latest and greatest, but it did contribute to a moderately large online scene of kids making Qbasic games or Windows-like Qbasic GUIs for DOS.</div><br/><div id="42557482" class="c"><input type="checkbox" id="c-42557482" checked=""/><div class="controls bullet"><span class="by">spacechild1</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555318">parent</a><span>|</span><a href="#42557266">next</a><span>|</span><label class="collapse" for="c-42557482">[-]</label><label class="expand" for="c-42557482">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s how I started programming as a kid! There even were a few sample games.</div><br/></div></div><div id="42557266" class="c"><input type="checkbox" id="c-42557266" checked=""/><div class="controls bullet"><span class="by">paride5745</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555318">parent</a><span>|</span><a href="#42557482">prev</a><span>|</span><a href="#42555334">next</a><span>|</span><label class="collapse" for="c-42557266">[-]</label><label class="expand" for="c-42557266">[1 more]</label></div><br/><div class="children"><div class="content">I remember in Win98 it being hidden in the Windows folder, if you didn’t know where and what to look for, it was pretty much impossible to find.</div><br/></div></div><div id="42555334" class="c"><input type="checkbox" id="c-42555334" checked=""/><div class="controls bullet"><span class="by">bigfishrunning</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555318">parent</a><span>|</span><a href="#42557266">prev</a><span>|</span><a href="#42555711">next</a><span>|</span><label class="collapse" for="c-42555334">[-]</label><label class="expand" for="c-42555334">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s where I got started, copying basic code from the back of Boy&#x27;s Life magazine, before I had a modem. I&#x27;m sure I&#x27;m not the only one here!</div><br/><div id="42555622" class="c"><input type="checkbox" id="c-42555622" checked=""/><div class="controls bullet"><span class="by">binary132</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555334">parent</a><span>|</span><a href="#42555711">next</a><span>|</span><label class="collapse" for="c-42555622">[-]</label><label class="expand" for="c-42555622">[1 more]</label></div><br/><div class="children"><div class="content">I learned BASIC from those Usborne books on it, muddling my way through with qbasic.  The PDFs of them are actually available on their site now!</div><br/></div></div></div></div><div id="42555711" class="c"><input type="checkbox" id="c-42555711" checked=""/><div class="controls bullet"><span class="by">kevin_thibedeau</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555318">parent</a><span>|</span><a href="#42555334">prev</a><span>|</span><a href="#42556098">next</a><span>|</span><label class="collapse" for="c-42555711">[-]</label><label class="expand" for="c-42555711">[1 more]</label></div><br/><div class="children"><div class="content">Debug.exe still shipped in Win7 x86.</div><br/></div></div></div></div><div id="42556098" class="c"><input type="checkbox" id="c-42556098" checked=""/><div class="controls bullet"><span class="by">afavour</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555318">prev</a><span>|</span><a href="#42557100">next</a><span>|</span><label class="collapse" for="c-42556098">[-]</label><label class="expand" for="c-42556098">[1 more]</label></div><br/><div class="children"><div class="content">In all those years (and in years since) the most-used programming environment was the web browser. But it always gets written off.<p>I grew up in the MS-DOS era and my exposure to programming was basically batch files too. That and editing CONFIG.SYS.</div><br/></div></div><div id="42557100" class="c"><input type="checkbox" id="c-42557100" checked=""/><div class="controls bullet"><span class="by">SOLAR_FIELDS</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42556098">prev</a><span>|</span><a href="#42555718">next</a><span>|</span><label class="collapse" for="c-42557100">[-]</label><label class="expand" for="c-42557100">[1 more]</label></div><br/><div class="children"><div class="content">Opposite hot take: one of the main reasons I got into programming was because Microsoft Access made it accessible enough that I was confident enough to produce value even knowing nothing about how to think like a software engineer</div><br/></div></div><div id="42555718" class="c"><input type="checkbox" id="c-42555718" checked=""/><div class="controls bullet"><span class="by">purple-leafy</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42557100">prev</a><span>|</span><a href="#42555332">next</a><span>|</span><label class="collapse" for="c-42555718">[-]</label><label class="expand" for="c-42555718">[1 more]</label></div><br/><div class="children"><div class="content">Lol when I first had to use Linux at uni, I tried to set up a hard-drive partition and wiped my windows partition. That was a fun day, I knew nothing!</div><br/></div></div><div id="42555332" class="c"><input type="checkbox" id="c-42555332" checked=""/><div class="controls bullet"><span class="by">ralusek</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555718">prev</a><span>|</span><a href="#42555902">next</a><span>|</span><label class="collapse" for="c-42555332">[-]</label><label class="expand" for="c-42555332">[1 more]</label></div><br/><div class="children"><div class="content">When I was first getting started with programming in about 2008, I found it to be so unbelievably frustrating. Any tutorial I was following would invariably run into something that didn&#x27;t work how it was supposed to. I would try to find some work around, and sort of would, but it would lead to other unforeseen issues down the line. I finally came across cygwin, and that sort of made things start to work.<p>Eventually, though, I just installed a linux partition and literally never looked back. The entire ecosystem of everything I was learning at the time (Python, JS, PHP) was set up for unix. Things have improved over time, and obviously WSL is nice, but it&#x27;s still a pain.</div><br/></div></div><div id="42555902" class="c"><input type="checkbox" id="c-42555902" checked=""/><div class="controls bullet"><span class="by">BrouteMinou</span><span>|</span><a href="#42555205">parent</a><span>|</span><a href="#42555332">prev</a><span>|</span><a href="#42555858">next</a><span>|</span><label class="collapse" for="c-42555902">[-]</label><label class="expand" for="c-42555902">[4 more]</label></div><br/><div class="children"><div class="content">I started on an Amiga without a compiler, and I&#x27;ve learned my first programming language there.<p>Then I got my first PC with Windows, and I learned a shit ton on it.<p>I am sure you had little effort to get your games, didn&#x27;t you?<p>If you wanted to code, you would have done the same effort to get what you needed.<p>Magazines were a thing too...<p>Cheap excuses, the OS is irrelevant here.</div><br/><div id="42557333" class="c"><input type="checkbox" id="c-42557333" checked=""/><div class="controls bullet"><span class="by">homebrewer</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555902">parent</a><span>|</span><a href="#42556487">next</a><span>|</span><label class="collapse" for="c-42557333">[-]</label><label class="expand" for="c-42557333">[1 more]</label></div><br/><div class="children"><div class="content">I lived in bumfuck nowhere where there were basically no developers (if you knew how to reinstall Windows you were called &quot;a genius kid&quot;), no computer magazines, and access to the internet was available through dial-up for an hour or two in the middle of the night a couple of times per month because it was:<p>1) very slow — my modem was never able to achieve more than 2.5-3 KB&#x2F;s, and<p>2) pretty expensive given our measly salaries.<p>I also didn&#x27;t speak English at all. I first got access to a programming environment at 16, at an age where my Western peers were starting to write operating systems: it was a copy of &quot;pirated&quot; Delphi that came by pure chance. The first couple of years I was making shit that wouldn&#x27;t impress anybody because there was nothing to learn from besides the standard library, which would probably be achievable by a computer science version of Ramanujan, but not by some random dude like myself.<p>Please remember about the rest of the world before accusing others of making &quot;cheap excuses&quot;. Not every person on this planet lived or lives in the middle of Manhattan; this may very well include GP.</div><br/></div></div><div id="42556487" class="c"><input type="checkbox" id="c-42556487" checked=""/><div class="controls bullet"><span class="by">worthless-trash</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42555902">parent</a><span>|</span><a href="#42557333">prev</a><span>|</span><a href="#42555858">next</a><span>|</span><label class="collapse" for="c-42556487">[-]</label><label class="expand" for="c-42556487">[2 more]</label></div><br/><div class="children"><div class="content">Not everyone had finances for magazines, not everyone lives in a densely populated area where you can get access to information, including libraries.<p>Many HN readers frequently forget they lived in the perfect storm to allow their skills to grow.</div><br/><div id="42557129" class="c"><input type="checkbox" id="c-42557129" checked=""/><div class="controls bullet"><span class="by">ane</span><span>|</span><a href="#42555205">root</a><span>|</span><a href="#42556487">parent</a><span>|</span><a href="#42555858">next</a><span>|</span><label class="collapse" for="c-42557129">[-]</label><label class="expand" for="c-42557129">[1 more]</label></div><br/><div class="children"><div class="content">Indeed, as a kid of 10, I remember learning C&#x2F;C++ thanks to DJGPP, a DOS port of GCC, being free software. I didn&#x27;t have any money to buy a commercial compiler, though I never asked my parents. I wasn&#x27;t sure how to frame the question, I guess. Well, regardless, getting your hands on a commercial compiler wasn&#x27;t that difficult in the late 90s&#x2F;early 00s. Soon after though small non-commercial indie games kinda died out and everyone was using DirectX using MSVC on Windows, until SDL came out.</div><br/></div></div></div></div></div></div></div></div><div id="42555858" class="c"><input type="checkbox" id="c-42555858" checked=""/><div class="controls bullet"><span class="by">MobiusHorizons</span><span>|</span><a href="#42555205">prev</a><span>|</span><a href="#42555092">next</a><span>|</span><label class="collapse" for="c-42555858">[-]</label><label class="expand" for="c-42555858">[7 more]</label></div><br/><div class="children"><div class="content">&gt; Sometimes, the compiler would get too smart for its own good, and recognize that a function that I wrote just copies memory. It would helpfully replace the function body with memcpy to save space.<p>I would generally expect this optimization to only be done for programs executing in userspace, not os &#x2F; kernel style programs like this is. I would have expected the equivalent of -nostdlib to handle this automatically. I wonder if the author&#x27;s build could be tweaked to tell llvm (which zig is based on) not to perform this or other &quot;default to stdlib implementation&quot; style optimizations</div><br/><div id="42556152" class="c"><input type="checkbox" id="c-42556152" checked=""/><div class="controls bullet"><span class="by">pcwalton</span><span>|</span><a href="#42555858">parent</a><span>|</span><a href="#42556624">next</a><span>|</span><label class="collapse" for="c-42556152">[-]</label><label class="expand" for="c-42556152">[4 more]</label></div><br/><div class="children"><div class="content">This is controllable by customizing TargetLibraryInfo [1] for your target in LLVM. Note, however, that detecting memcpy is always a valid optimization in C, not just in userspace. The C <i>language</i> standard, not POSIX, requires that a function spelled &quot;memcpy&quot; be available.<p>As a side note, the optimization pass that detects and replaces memcpy is called LoopIdiomRecognize [2]. It actually detects quite a bit, not just memcpy.<p>[1]: <a href="https:&#x2F;&#x2F;llvm.org&#x2F;doxygen&#x2F;TargetLibraryInfo_8cpp_source.html" rel="nofollow">https:&#x2F;&#x2F;llvm.org&#x2F;doxygen&#x2F;TargetLibraryInfo_8cpp_source.html</a><p>[2]: <a href="https:&#x2F;&#x2F;llvm.org&#x2F;doxygen&#x2F;LoopIdiomRecognize_8cpp.html" rel="nofollow">https:&#x2F;&#x2F;llvm.org&#x2F;doxygen&#x2F;LoopIdiomRecognize_8cpp.html</a></div><br/><div id="42556366" class="c"><input type="checkbox" id="c-42556366" checked=""/><div class="controls bullet"><span class="by">MobiusHorizons</span><span>|</span><a href="#42555858">root</a><span>|</span><a href="#42556152">parent</a><span>|</span><a href="#42556624">next</a><span>|</span><label class="collapse" for="c-42556366">[-]</label><label class="expand" for="c-42556366">[3 more]</label></div><br/><div class="children"><div class="content">Very Interesting! I guess I would still expect the optimization to use the library implementation of memcpy to be invalid when interacting with memory mapped IO. In this case the issue was the size of writes being issued (byte vs word), but you can easily imagine other issues that would not matter something like memcpy. I would have thought volatile might have signaled this, even if the issue here is not related to values being cached in registers. Does zig have a version of volatile?</div><br/></div></div></div></div><div id="42556624" class="c"><input type="checkbox" id="c-42556624" checked=""/><div class="controls bullet"><span class="by">NobodyNada</span><span>|</span><a href="#42555858">parent</a><span>|</span><a href="#42556152">prev</a><span>|</span><a href="#42556850">next</a><span>|</span><label class="collapse" for="c-42556624">[-]</label><label class="expand" for="c-42556624">[1 more]</label></div><br/><div class="children"><div class="content">The &quot;correct&quot; thing to do here is to use volatile writes to tell the compiler that they must not be torn: <a href="https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;LangRef.html#volatile-memory-accesses" rel="nofollow">https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;LangRef.html#volatile-memory-accesses</a><p>&gt; IR-level volatile loads and stores cannot safely be optimized into llvm.memcpy or llvm.memmove intrinsics even when those intrinsics are flagged volatile. Likewise, the backend should never split or merge target-legal volatile load&#x2F;store instructions. Similarly, IR-level volatile loads and stores cannot change from integer to floating-point or vice versa.<p>Even in a baremetal&#x2F;OS context, the compiler is generally allowed to split, combine, reorder, and eliminate memory access however it likes as long as the end result is consistent. Being able to do that is very important for performance and code size, which <i>especially</i> matters in embedded or OS dev -- for example, inserting memcpy calls can save on code size for things like passing a medium-sized struct to a function. The memory model for any reasonably low-level programming language nowadays requires you to specify whenever you actually need memory access that look <i>exactly</i> like you wrote.<p>The OP suggests:<p>&gt; I know that this is a long shot, but it would be nice if there was some way to specify how memory in certain address ranges need to be addressed.<p>The downside to this approach is that the compiler doesn&#x27;t usually know what address range an arbitrary pointer will acccess; it&#x27;s not resolved until link-time or often runtime. So this would require dynamic checks around <i>every single memory access</i>, which would kill performance. Thus, the solution is to use volatile loads and stores for any memory ranges that need special treatment.</div><br/></div></div><div id="42556850" class="c"><input type="checkbox" id="c-42556850" checked=""/><div class="controls bullet"><span class="by">matheusmoreira</span><span>|</span><a href="#42555858">parent</a><span>|</span><a href="#42556624">prev</a><span>|</span><a href="#42555092">next</a><span>|</span><label class="collapse" for="c-42556850">[-]</label><label class="expand" for="c-42556850">[1 more]</label></div><br/><div class="children"><div class="content">Even GCC emits calls to memcpy. Even for freestanding nostdlib targets. There is no way to turn it off. I had to implement memcpy because of it. Incredibly annoying.<p><a href="https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc&#x2F;Link-Options.html" rel="nofollow">https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc&#x2F;Link-Options.html</a><p>&gt; The compiler may generate calls to memcmp, memset, memcpy and memmove.</div><br/></div></div></div></div><div id="42555092" class="c"><input type="checkbox" id="c-42555092" checked=""/><div class="controls bullet"><span class="by">aquova</span><span>|</span><a href="#42555858">prev</a><span>|</span><a href="#42555511">next</a><span>|</span><label class="collapse" for="c-42555092">[-]</label><label class="expand" for="c-42555092">[3 more]</label></div><br/><div class="children"><div class="content">This is really interesting. As an aside, someone has created a GBA toolchain for the Nim language as well. It&#x27;s really cool seeing these projects for a variety of languages.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;exelotl&#x2F;natu">https:&#x2F;&#x2F;github.com&#x2F;exelotl&#x2F;natu</a></div><br/><div id="42556540" class="c"><input type="checkbox" id="c-42556540" checked=""/><div class="controls bullet"><span class="by">girvo</span><span>|</span><a href="#42555092">parent</a><span>|</span><a href="#42555791">next</a><span>|</span><label class="collapse" for="c-42556540">[-]</label><label class="expand" for="c-42556540">[1 more]</label></div><br/><div class="children"><div class="content">And interestingly, one of the problems raised in the article<p><pre><code>    __attribute__((target(&quot;arm&quot;)))
    void interrupt_handler() {
        ...
    }
</code></pre>
that fancy __attribute output can be achieved quite nicely using a custom pragma&#x2F;codegendecl -- we did exactly this for the embedded firmware written in Nim at my previous workplace, to get access to some specific features of the ESP32-S3 (things like RTC_ATTR_NOINIT for example)</div><br/></div></div><div id="42555791" class="c"><input type="checkbox" id="c-42555791" checked=""/><div class="controls bullet"><span class="by">archargelod</span><span>|</span><a href="#42555092">parent</a><span>|</span><a href="#42556540">prev</a><span>|</span><a href="#42555511">next</a><span>|</span><label class="collapse" for="c-42555791">[-]</label><label class="expand" for="c-42555791">[1 more]</label></div><br/><div class="children"><div class="content">Natu has an amazing commercial game called Goodboy Galaxy [0]. In addition to the Game Boy Advance version, they&#x27;ve also ported it to Windows and Linux with Xatu [1] (which is also written in Nim).<p>0 - <a href="https:&#x2F;&#x2F;goodboygalaxy.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;goodboygalaxy.com&#x2F;</a><p>1 - <a href="https:&#x2F;&#x2F;git.sr.ht&#x2F;~exelotl&#x2F;xatu" rel="nofollow">https:&#x2F;&#x2F;git.sr.ht&#x2F;~exelotl&#x2F;xatu</a></div><br/></div></div></div></div><div id="42555511" class="c"><input type="checkbox" id="c-42555511" checked=""/><div class="controls bullet"><span class="by">dropbear3</span><span>|</span><a href="#42555092">prev</a><span>|</span><a href="#42556227">next</a><span>|</span><label class="collapse" for="c-42555511">[-]</label><label class="expand" for="c-42555511">[5 more]</label></div><br/><div class="children"><div class="content">&gt; How would you do [packed structs] in C?<p>Bitfields! This is valid C:<p><pre><code>  struct foo {
    unsigned bg_priority: 2;
    unsigned character_base: 2;
    &#x2F;&#x2F; ...
  };</code></pre></div><br/><div id="42555704" class="c"><input type="checkbox" id="c-42555704" checked=""/><div class="controls bullet"><span class="by">purple-leafy</span><span>|</span><a href="#42555511">parent</a><span>|</span><a href="#42555948">next</a><span>|</span><label class="collapse" for="c-42555704">[-]</label><label class="expand" for="c-42555704">[3 more]</label></div><br/><div class="children"><div class="content">But C&#x2F; C-compilers don&#x27;t guarantee your struct wont have holes (by default), so you may have to do something like __attribute__((packed)) to ensure they are packed structs:<p><pre><code>    struct bitmap_file_header
    {
      UWord signature;
      UDWord file_size;
      UWord reserved_1;
      UWord reserved_2;
      UDWord file_offset_to_pixel_array;
    } __attribute__((packed));</code></pre></div><br/><div id="42555899" class="c"><input type="checkbox" id="c-42555899" checked=""/><div class="controls bullet"><span class="by">dropbear3</span><span>|</span><a href="#42555511">root</a><span>|</span><a href="#42555704">parent</a><span>|</span><a href="#42555774">next</a><span>|</span><label class="collapse" for="c-42555899">[-]</label><label class="expand" for="c-42555899">[1 more]</label></div><br/><div class="children"><div class="content">This is not true of adjacent bitfields, at least for C99:<p><pre><code>  An implementation may allocate any addressable storage unit large enough to hold a bit-field. If enough space remains, a bit-field that immediately follows another bit-field in a structure shall be packed into adjacent bits of the same unit.
</code></pre>
<a href="https:&#x2F;&#x2F;www.open-std.org&#x2F;jtc1&#x2F;sc22&#x2F;wg14&#x2F;www&#x2F;docs&#x2F;n1256.pdf" rel="nofollow">https:&#x2F;&#x2F;www.open-std.org&#x2F;jtc1&#x2F;sc22&#x2F;wg14&#x2F;www&#x2F;docs&#x2F;n1256.pdf</a> 6.7.2.1 § 10</div><br/></div></div><div id="42555774" class="c"><input type="checkbox" id="c-42555774" checked=""/><div class="controls bullet"><span class="by">travisgriggs</span><span>|</span><a href="#42555511">root</a><span>|</span><a href="#42555704">parent</a><span>|</span><a href="#42555899">prev</a><span>|</span><a href="#42555948">next</a><span>|</span><label class="collapse" for="c-42555774">[-]</label><label class="expand" for="c-42555774">[1 more]</label></div><br/><div class="children"><div class="content">There’s also a directive (don’t have code in front of me) that you can do at file level that will cause all subsequent struct defs to be packed…<p>#push(pragma(pack(0)) ??<p>I’ve done a lot of direct register access in C this way. I do like Zigs ability to just define the different sizes though.</div><br/></div></div></div></div><div id="42555948" class="c"><input type="checkbox" id="c-42555948" checked=""/><div class="controls bullet"><span class="by">MobiusHorizons</span><span>|</span><a href="#42555511">parent</a><span>|</span><a href="#42555704">prev</a><span>|</span><a href="#42556227">next</a><span>|</span><label class="collapse" for="c-42555948">[-]</label><label class="expand" for="c-42555948">[1 more]</label></div><br/><div class="children"><div class="content">in microcontrollers it&#x27;s very common to see code generated that creates structs for the registers. They will typically output fields that are a full machine word in size (or maybe in some cases as small as a byte), and individual bits will be addressed with bitmasking (ie `my_device.some_reg |= SOME_REG_FLAG_NAME` or `my_device.some_reg &amp;= ~SOME_REG_FLAG_NAME` to clear it). It is sometimes necessary to be thoughtful about batching writes so that certain bits are set before the periferal begins some process. A trivial example would be:<p><pre><code>  port_a.data_out |= GPIOA_PIN_1 | GPIOA_PIN_2;
</code></pre>
and<p><pre><code>  port_a.pin1 = true;
  port_a.pin2 = true;</code></pre></div><br/></div></div></div></div><div id="42556227" class="c"><input type="checkbox" id="c-42556227" checked=""/><div class="controls bullet"><span class="by">klooney</span><span>|</span><a href="#42555511">prev</a><span>|</span><a href="#42555114">next</a><span>|</span><label class="collapse" for="c-42556227">[-]</label><label class="expand" for="c-42556227">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Did you know that you can’t write to video memory on the Game Boy Advance in units of 8 bits, and if you do, it’ll still work but all your graphics will be messed up with no obvious way to figure it out unless you read one specific paragraph of the documentation? Hey did you know that when you compile a binary optimized for size, memory copies will be by units of 8 bits, but not if you use debug mode?<p>Brutal. I don&#x27;t miss but banging much.</div><br/></div></div><div id="42555114" class="c"><input type="checkbox" id="c-42555114" checked=""/><div class="controls bullet"><span class="by">keyle</span><span>|</span><a href="#42556227">prev</a><span>|</span><a href="#42557126">next</a><span>|</span><label class="collapse" for="c-42555114">[-]</label><label class="expand" for="c-42555114">[2 more]</label></div><br/><div class="children"><div class="content">Interesting post. I wish it went deeper but I guess it&#x27;s just a post-mortem.<p>Related, I found this old post that goes into the basics of GBA coding [1]. It doesn&#x27;t look nearly as bad as I expected. That said I&#x27;m sure performance might be the issue once you start having a few things going.<p>If you have a good resource please let me know (I prefer C).<p>Edit: also this library [2].<p>[1] <a href="http:&#x2F;&#x2F;www.loirak.com&#x2F;gameboy&#x2F;gbatutor.php" rel="nofollow">http:&#x2F;&#x2F;www.loirak.com&#x2F;gameboy&#x2F;gbatutor.php</a><p>[2] <a href="https:&#x2F;&#x2F;www.coranac.com&#x2F;tonc&#x2F;text&#x2F;toc.htm" rel="nofollow">https:&#x2F;&#x2F;www.coranac.com&#x2F;tonc&#x2F;text&#x2F;toc.htm</a></div><br/><div id="42557195" class="c"><input type="checkbox" id="c-42557195" checked=""/><div class="controls bullet"><span class="by">discard38484</span><span>|</span><a href="#42555114">parent</a><span>|</span><a href="#42557126">next</a><span>|</span><label class="collapse" for="c-42557195">[-]</label><label class="expand" for="c-42557195">[1 more]</label></div><br/><div class="children"><div class="content">Check out <a href="https:&#x2F;&#x2F;gbadev.net" rel="nofollow">https:&#x2F;&#x2F;gbadev.net</a></div><br/></div></div></div></div><div id="42557126" class="c"><input type="checkbox" id="c-42557126" checked=""/><div class="controls bullet"><span class="by">mysecretaccount</span><span>|</span><a href="#42555114">prev</a><span>|</span><a href="#42555308">next</a><span>|</span><label class="collapse" for="c-42557126">[-]</label><label class="expand" for="c-42557126">[2 more]</label></div><br/><div class="children"><div class="content">Why is the DS in the &quot;Non-modern graphics&quot; row? It does not use a tile based renderer.</div><br/><div id="42557170" class="c"><input type="checkbox" id="c-42557170" checked=""/><div class="controls bullet"><span class="by">msephton</span><span>|</span><a href="#42557126">parent</a><span>|</span><a href="#42555308">next</a><span>|</span><label class="collapse" for="c-42557170">[-]</label><label class="expand" for="c-42557170">[1 more]</label></div><br/><div class="children"><div class="content">DS has both 2D tile-based renderer and 3D renderer. You can find many examples of games with tiled graphics. I made a tile map viewer for my favourite DS game <a href="https:&#x2F;&#x2F;blog.gingerbeardman.com&#x2F;2021&#x2F;04&#x2F;21&#x2F;level-viewer-for-" rel="nofollow">https:&#x2F;&#x2F;blog.gingerbeardman.com&#x2F;2021&#x2F;04&#x2F;21&#x2F;level-viewer-for-</a>...</div><br/></div></div></div></div><div id="42555308" class="c"><input type="checkbox" id="c-42555308" checked=""/><div class="controls bullet"><span class="by">oxidant</span><span>|</span><a href="#42557126">prev</a><span>|</span><a href="#42555228">next</a><span>|</span><label class="collapse" for="c-42555308">[-]</label><label class="expand" for="c-42555308">[2 more]</label></div><br/><div class="children"><div class="content">This was an interesting read, thanks.<p>One nit on mobile (Firefox and Chrome, Android), your code blocks overflow the background instead of scrolling.</div><br/><div id="42555314" class="c"><input type="checkbox" id="c-42555314" checked=""/><div class="controls bullet"><span class="by">yapyap</span><span>|</span><a href="#42555308">parent</a><span>|</span><a href="#42555228">next</a><span>|</span><label class="collapse" for="c-42555314">[-]</label><label class="expand" for="c-42555314">[1 more]</label></div><br/><div class="children"><div class="content">in safari as well</div><br/></div></div></div></div><div id="42555228" class="c"><input type="checkbox" id="c-42555228" checked=""/><div class="controls bullet"><span class="by">actionfromafar</span><span>|</span><a href="#42555308">prev</a><span>|</span><a href="#42556775">next</a><span>|</span><label class="collapse" for="c-42555228">[-]</label><label class="expand" for="c-42555228">[4 more]</label></div><br/><div class="children"><div class="content">For the upper right quadrant, something like a Silicon Graphics might fit.</div><br/><div id="42555912" class="c"><input type="checkbox" id="c-42555912" checked=""/><div class="controls bullet"><span class="by">erik</span><span>|</span><a href="#42555228">parent</a><span>|</span><a href="#42556775">next</a><span>|</span><label class="collapse" for="c-42555912">[-]</label><label class="expand" for="c-42555912">[3 more]</label></div><br/><div class="children"><div class="content">Upper right quadrant would be an 8-bit (or maybe 16-bit) CPU paired with a 3D graphics capable GPU. SNES + the SuperFX chip is the closest example I can think of. Similarly, there is the Genesis&#x2F;Mega Drive + SVP chip.<p>I can&#x27;t name a fully 8-bit machine with a 3d focused graphics chip.  Maybe there are arcade boards?</div><br/><div id="42557450" class="c"><input type="checkbox" id="c-42557450" checked=""/><div class="controls bullet"><span class="by">wk_end</span><span>|</span><a href="#42555228">root</a><span>|</span><a href="#42555912">parent</a><span>|</span><a href="#42556093">next</a><span>|</span><label class="collapse" for="c-42557450">[-]</label><label class="expand" for="c-42557450">[1 more]</label></div><br/><div class="children"><div class="content">It&#x27;s stretching the definition of &quot;3D-focused graphics chip&quot;, but an early example might be I, Robot. An 8-bit 6809 CPU drives a custom polygon-pushing graphics processor. It&#x27;s primitive but must&#x27;ve been mind-blowing in 1984.<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;I,_Robot_(video_game)" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;I,_Robot_(video_game)</a></div><br/></div></div><div id="42556093" class="c"><input type="checkbox" id="c-42556093" checked=""/><div class="controls bullet"><span class="by">coolsunglasses</span><span>|</span><a href="#42555228">root</a><span>|</span><a href="#42555912">parent</a><span>|</span><a href="#42557450">prev</a><span>|</span><a href="#42556775">next</a><span>|</span><label class="collapse" for="c-42556093">[-]</label><label class="expand" for="c-42556093">[1 more]</label></div><br/><div class="children"><div class="content">Mega Drive is probably earliest that was capable of it really, but Namco System 21 and especially Sega Model 1 (1990) were designed with 3d&#x2F;polygons in mind but have relatively old chips in them. Programming for those things could not have been easy.</div><br/></div></div></div></div></div></div><div id="42556775" class="c"><input type="checkbox" id="c-42556775" checked=""/><div class="controls bullet"><span class="by">__loam</span><span>|</span><a href="#42555228">prev</a><span>|</span><label class="collapse" for="c-42556775">[-]</label><label class="expand" for="c-42556775">[1 more]</label></div><br/><div class="children"><div class="content">Extremely excited to read through this. I&#x27;m fascinated by Zig and the GBA. It&#x27;s really cool to see people still developing software on such an old machine.</div><br/></div></div></div></div></div></div></div></body></html>