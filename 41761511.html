<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1728291677326" as="style"/><link rel="stylesheet" href="styles.css?v=1728291677326"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.sqlite.org/amalgamation.html">The SQLite Amalgamation</a> <span class="domain">(<a href="https://www.sqlite.org">www.sqlite.org</a>)</span></div><div class="subtext"><span>burglins</span> | <span>11 comments</span></div><br/><div><div id="41763179" class="c"><input type="checkbox" id="c-41763179" checked=""/><div class="controls bullet"><span class="by">stevefan1999</span><span>|</span><a href="#41763380">next</a><span>|</span><label class="collapse" for="c-41763179">[-]</label><label class="expand" for="c-41763179">[5 more]</label></div><br/><div class="children"><div class="content">Unreal Engine also do something called a Unity build (the irony) which also put multiple cpp files in one big file by using #include</div><br/><div id="41763215" class="c"><input type="checkbox" id="c-41763215" checked=""/><div class="controls bullet"><span class="by">forrestthewoods</span><span>|</span><a href="#41763179">parent</a><span>|</span><a href="#41763380">next</a><span>|</span><label class="collapse" for="c-41763215">[-]</label><label class="expand" for="c-41763215">[4 more]</label></div><br/><div class="children"><div class="content">That&#x27;s not <i>really</i> the same thing. Unreal&#x27;s &quot;Unity&quot; build is more of a build time optimization. It doesn&#x27;t output actual source files you can drop into a project like SQLite&#x27;s amalgamation.<p>Perhaps similar in structure. But different in both goal and output.</div><br/><div id="41763283" class="c"><input type="checkbox" id="c-41763283" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41763179">root</a><span>|</span><a href="#41763215">parent</a><span>|</span><a href="#41763380">next</a><span>|</span><label class="collapse" for="c-41763283">[-]</label><label class="expand" for="c-41763283">[3 more]</label></div><br/><div class="children"><div class="content">Both do share a minor but significant performance advantage. Also unity builds don&#x27;t really improve build time much by itself, it only makes sense because many unchanged files are still too many to link in incremental settings.</div><br/><div id="41763534" class="c"><input type="checkbox" id="c-41763534" checked=""/><div class="controls bullet"><span class="by">forrestthewoods</span><span>|</span><a href="#41763179">root</a><span>|</span><a href="#41763283">parent</a><span>|</span><a href="#41763380">next</a><span>|</span><label class="collapse" for="c-41763534">[-]</label><label class="expand" for="c-41763534">[2 more]</label></div><br/><div class="children"><div class="content">I’m pretty sure the primary reason Unity builds exist is to make builds faster by eliminating massively duplicated header compiles…</div><br/><div id="41763697" class="c"><input type="checkbox" id="c-41763697" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41763179">root</a><span>|</span><a href="#41763534">parent</a><span>|</span><a href="#41763380">next</a><span>|</span><label class="collapse" for="c-41763697">[-]</label><label class="expand" for="c-41763697">[1 more]</label></div><br/><div class="children"><div class="content">You have probably confused unity builds from precompiled header files, which <i>can</i> be combined in the same fashion.<p>Unity builds just mean the combined compilation of otherwise multiple files and therefore the reduction of output files to be further processed. An unqualified &quot;unity build&quot; typically means unity builds where inputs are source files and outputs are object files to be linked. This is most evident by considering how would you use corresponding header files from your project: you would still include the same set of header files.<p>PCH unity builds would instead force you to include a <i>single</i> dedicated header file, like `#include &quot;pch.h&quot;`. I never heard them to be called just &quot;unity builds&quot; in my experience, in fact it was more likely that &quot;PCH&quot; implied a unity build of PCH files.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="41763380" class="c"><input type="checkbox" id="c-41763380" checked=""/><div class="controls bullet"><span class="by">Tiberium</span><span>|</span><a href="#41763179">prev</a><span>|</span><a href="#41762958">next</a><span>|</span><label class="collapse" for="c-41763380">[-]</label><label class="expand" for="c-41763380">[1 more]</label></div><br/><div class="children"><div class="content">FWIW it&#x27;s possible to amalgamate almost any C program automatically with the help of <a href="https:&#x2F;&#x2F;github.com&#x2F;goblint&#x2F;cil">https:&#x2F;&#x2F;github.com&#x2F;goblint&#x2F;cil</a> (a maintained fork of CIL): <a href="https:&#x2F;&#x2F;goblint.github.io&#x2F;cil&#x2F;merger.html" rel="nofollow">https:&#x2F;&#x2F;goblint.github.io&#x2F;cil&#x2F;merger.html</a><p>All you have to do is to make your CC this:<p>cilly --noPrintLn --merge --keepmerged<p>And in the end after compilation there will be a file named yourproject_comb.c</div><br/></div></div><div id="41762958" class="c"><input type="checkbox" id="c-41762958" checked=""/><div class="controls bullet"><span class="by">rtpg</span><span>|</span><a href="#41763380">prev</a><span>|</span><a href="#41763302">next</a><span>|</span><label class="collapse" for="c-41762958">[-]</label><label class="expand" for="c-41762958">[1 more]</label></div><br/><div class="children"><div class="content">Xonsh, a Python-based shell, used to do this for startup speed reasons, but got rid of it on account of stack traces being a mess afterwards.</div><br/></div></div><div id="41763302" class="c"><input type="checkbox" id="c-41763302" checked=""/><div class="controls bullet"><span class="by">matheusmoreira</span><span>|</span><a href="#41762958">prev</a><span>|</span><a href="#41762919">next</a><span>|</span><label class="collapse" for="c-41763302">[-]</label><label class="expand" for="c-41763302">[2 more]</label></div><br/><div class="children"><div class="content">&gt; And because all code is in a single translation unit, compilers can do better inter-procedure and inlining optimization resulting in machine code that is between 5% and 10% faster.<p>It&#x27;s weird that this is still true even though compilers are now capable of whole program optimization at link time. Enabling LTO should be equivalent to compiling everything as a single translation unit but apparently it isn&#x27;t. I wonder what exactly inhibits the aforementioned inter-procedural and code inlining optimizations in LTO builds.</div><br/><div id="41763728" class="c"><input type="checkbox" id="c-41763728" checked=""/><div class="controls bullet"><span class="by">lifthrasiir</span><span>|</span><a href="#41763302">parent</a><span>|</span><a href="#41762919">next</a><span>|</span><label class="collapse" for="c-41763728">[-]</label><label class="expand" for="c-41763728">[1 more]</label></div><br/><div class="children"><div class="content">Because LTO is a global decision while amalgamation (or unity builds) is a local decision. As a global decision, LTO can&#x27;t be too slow and is subject to heavier trade-offs. Combining files in this way is a local decision that you can just do if you know it would be a-okay and doesn&#x27;t otherwise impact the whole build.</div><br/></div></div></div></div><div id="41762919" class="c"><input type="checkbox" id="c-41762919" checked=""/><div class="controls bullet"><span class="by">layla5alive</span><span>|</span><a href="#41763302">prev</a><span>|</span><label class="collapse" for="c-41762919">[-]</label><label class="expand" for="c-41762919">[1 more]</label></div><br/><div class="children"><div class="content">This appears to be a hand-rolled Unity build..</div><br/></div></div></div></div></div></div></div></body></html>