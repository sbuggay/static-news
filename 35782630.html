<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1683002452746" as="style"/><link rel="stylesheet" href="styles.css?v=1683002452746"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://sysprog21.github.io/lkmpg/">The Linux Kernel Module Programming Guide</a>Â <span class="domain">(<a href="https://sysprog21.github.io">sysprog21.github.io</a>)</span></div><div class="subtext"><span>asicsp</span> | <span>8 comments</span></div><br/><div><div id="35783086" class="c"><input type="checkbox" id="c-35783086" checked=""/><div class="controls bullet"><span class="by">totetsu</span><span>|</span><a href="#35783110">next</a><span>|</span><label class="collapse" for="c-35783086">[-]</label><label class="expand" for="c-35783086">[1 more]</label></div><br/><div class="children"><div class="content">I always liked the Hitchhikers Guide to Kernel module programming, with DONT PANIC on the cover.</div><br/></div></div><div id="35783110" class="c"><input type="checkbox" id="c-35783110" checked=""/><div class="controls bullet"><span class="by">asicsp</span><span>|</span><a href="#35783086">prev</a><span>|</span><a href="#35782936">next</a><span>|</span><label class="collapse" for="c-35783110">[-]</label><label class="expand" for="c-35783110">[1 more]</label></div><br/><div class="children"><div class="content">Previous discussions:<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28036619" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28036619</a> <i>(154 points | Aug 2, 2021 | 30 comments)</i><p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28283030" rel="nofollow">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28283030</a> <i>(339 points | Aug 23, 2021 | 42 comments)</i><p>See also: <a href="https:&#x2F;&#x2F;0xax.gitbooks.io&#x2F;linux-insides&#x2F;content&#x2F;" rel="nofollow">https:&#x2F;&#x2F;0xax.gitbooks.io&#x2F;linux-insides&#x2F;content&#x2F;</a> (A book-in-progress about the linux kernel and its insides)</div><br/></div></div><div id="35782936" class="c"><input type="checkbox" id="c-35782936" checked=""/><div class="controls bullet"><span class="by">packetlost</span><span>|</span><a href="#35783110">prev</a><span>|</span><a href="#35783059">next</a><span>|</span><label class="collapse" for="c-35782936">[-]</label><label class="expand" for="c-35782936">[2 more]</label></div><br/><div class="children"><div class="content">This... is really helpful. I&#x27;ve been trying to contribute some drivers for Pine64 devices lately and am trying to get up to speed on Linux Kernel development. There&#x27;s... a lot.<p>Does anyone know if this is up to date with current Linux best practices?</div><br/><div id="35783039" class="c"><input type="checkbox" id="c-35783039" checked=""/><div class="controls bullet"><span class="by">smashed</span><span>|</span><a href="#35782936">parent</a><span>|</span><a href="#35783059">next</a><span>|</span><label class="collapse" for="c-35783039">[-]</label><label class="expand" for="c-35783039">[1 more]</label></div><br/><div class="children"><div class="content">According to the github readme, the guide has been around since 2001 but it seems fairly up to date..<p>There are numerous discussion going on the issue tracker, about adding rust chapter, targeting linux 6.1, etc.. Very cool to see github issues and pull request actively used to keep a guide up to date.<p>The guide will walk you through the basic of a kernel module. Exposing virtual files under &#x2F;proc or &#x2F;sys or messing around with system calls. It will fall short of helping you with the nitty gritty of writing an hardware driver though.<p>The problem with writing drivers is that you are interfacing with a real-world machine for which you will have very little information about.<p>Pick a device similar to the one you want to support, but that is already supported in linux. Go look at its source code. This will tell you far more about the work involved. You might realize that there is simply not enough information available to support the driver.</div><br/></div></div></div></div><div id="35783059" class="c"><input type="checkbox" id="c-35783059" checked=""/><div class="controls bullet"><span class="by">bvan</span><span>|</span><a href="#35782936">prev</a><span>|</span><a href="#35783214">next</a><span>|</span><label class="collapse" for="c-35783059">[-]</label><label class="expand" for="c-35783059">[1 more]</label></div><br/><div class="children"><div class="content">Fantastic resource. Thanks for sharing.</div><br/></div></div><div id="35783214" class="c"><input type="checkbox" id="c-35783214" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#35783059">prev</a><span>|</span><label class="collapse" for="c-35783214">[-]</label><label class="expand" for="c-35783214">[2 more]</label></div><br/><div class="children"><div class="content">Ctrl-F &quot;rust&quot;<p><a href="https:&#x2F;&#x2F;rust-for-linux.com&#x2F;" rel="nofollow">https:&#x2F;&#x2F;rust-for-linux.com&#x2F;</a> links to LWN articles at <a href="https:&#x2F;&#x2F;lwn.net&#x2F;Kernel&#x2F;Index&#x2F;#Development_tools-Rust" rel="nofollow">https:&#x2F;&#x2F;lwn.net&#x2F;Kernel&#x2F;Index&#x2F;#Development_tools-Rust</a> that suggest that only basic modules are yet possible with the rust support in Linux kernels 6.2 and 6.3.<p>Rust-for-linux links to the Android binder module though: <a href="https:&#x2F;&#x2F;rust-for-linux.com&#x2F;Android-Binder-Driver.html" rel="nofollow">https:&#x2F;&#x2F;rust-for-linux.com&#x2F;Android-Binder-Driver.html</a> :<p>&gt; Android Binder Driver: <i>This project is an effort to rewrite Android&#x27;s Binder kernel driver in Rust.</i><p>&gt; Motivation: <i>Binder is one of the most security and performance critical components of Android. Android isolates apps from each other and the system by assigning each app a unique user ID (UID). This is called &quot;application sandboxing&quot;, and is a fundamental tenet of the Android Platform Security Model.</i><p>&gt; <i>The majority of inter-process communication (IPC) on Android goes through Binder. Thus, memory unsafety vulnerabilities are especially critical when they happen in the Binder driver</i><p>... &quot;Rust in the Linux kernel&quot; (2021) <a href="https:&#x2F;&#x2F;security.googleblog.com&#x2F;2021&#x2F;04&#x2F;rust-in-linux-kernel.html?m=1" rel="nofollow">https:&#x2F;&#x2F;security.googleblog.com&#x2F;2021&#x2F;04&#x2F;rust-in-linux-kernel...</a> :<p>&gt; [...] <i>We also need designs that allow code in the two languages to interact with each other: we&#x27;re particularly interested in safe, zero-cost abstractions that allow Rust code to use kernel functionality written in C, and how to implement functionality in idiomatic Rust that can be called seamlessly from the C portions of the kernel.</i><p>&gt; <i>Since Rust is a new language for the kernel, we also have the opportunity to enforce best practices in terms of documentation and uniformity. For example, we have specific machine-checked requirements around the usage of unsafe code: for every unsafe function, the developer must document the requirements that need to be satisfied by callers to ensure that its usage is safe; additionally, for every call to unsafe functions (or usage of unsafe constructs like dereferencing a raw pointer), the developer must document the justification for why it is safe to do so.</i><p>&gt; <i>We&#x27;ll now show how such a driver would be implemented in Rust, contrasting it with a C implementation.</i> [...]<p>Is this the source for the rust port of the Android binder kernel module?: 
<a href="https:&#x2F;&#x2F;android.googlesource.com&#x2F;platform&#x2F;frameworks&#x2F;native&#x2F;+&#x2F;master&#x2F;libs&#x2F;binder&#x2F;rust&#x2F;src" rel="nofollow">https:&#x2F;&#x2F;android.googlesource.com&#x2F;platform&#x2F;frameworks&#x2F;native&#x2F;...</a><p>This guide with unsafe rust that calls into the C, and then with next gen much safer rust right next to it would be a helpful resource too.<p>What of the post-docker container support (with userspaces also written in go) should be cloned to rust first?<p>What are some good examples of non-trivial Linux kernel modules written in Rust?</div><br/><div id="35783241" class="c"><input type="checkbox" id="c-35783241" checked=""/><div class="controls bullet"><span class="by">piperswe</span><span>|</span><a href="#35783214">parent</a><span>|</span><label class="collapse" for="c-35783241">[-]</label><label class="expand" for="c-35783241">[1 more]</label></div><br/><div class="children"><div class="content">There aren&#x27;t really any non-trivial mainline modules, since the Rust support is so new. There&#x27;s the non-mainline Asahi M1 GPU driver though! It will eventually be mainlined, but IIRC some more Rust support code needs to be mainlined first.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;AsahiLinux&#x2F;linux&#x2F;tree&#x2F;asahi&#x2F;drivers&#x2F;gpu&#x2F;drm&#x2F;asahi">https:&#x2F;&#x2F;github.com&#x2F;AsahiLinux&#x2F;linux&#x2F;tree&#x2F;asahi&#x2F;drivers&#x2F;gpu&#x2F;d...</a></div><br/></div></div></div></div></div></div></div></div></div></body></html>