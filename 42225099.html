<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1732438848763" as="style"/><link rel="stylesheet" href="styles.css?v=1732438848763"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://blog.voyageai.com/2024/09/18/voyage-3/">32k context length text embedding models</a> <span class="domain">(<a href="https://blog.voyageai.com">blog.voyageai.com</a>)</span></div><div class="subtext"><span>fzliu</span> | <span>16 comments</span></div><br/><div><div id="42225960" class="c"><input type="checkbox" id="c-42225960" checked=""/><div class="controls bullet"><span class="by">throwup238</span><span>|</span><a href="#42226304">next</a><span>|</span><label class="collapse" for="c-42225960">[-]</label><label class="expand" for="c-42225960">[8 more]</label></div><br/><div class="children"><div class="content">What’s the benefit of generating embeddings for such large chunks? Do people use these large contexts to include lots of document specific headers&#x2F;footers or are they actually generating embeddings of single large documents?<p>I don’t understand how the math works out on those vectors</div><br/><div id="42226094" class="c"><input type="checkbox" id="c-42226094" checked=""/><div class="controls bullet"><span class="by">lsorber</span><span>|</span><a href="#42225960">parent</a><span>|</span><a href="#42226395">next</a><span>|</span><label class="collapse" for="c-42226094">[-]</label><label class="expand" for="c-42226094">[5 more]</label></div><br/><div class="children"><div class="content">You don’t have to reduce a long context to a single embedding vector. Instead, you can compute the token embeddings of a long context and then pool those into say sentence embeddings.<p>The benefit is that each sentence’s embedding is informed by all of the other sentences in the context. So when a sentence refers to “The company” for example, the sentence embedding will have captured which company that is based on the other sentences in the context.<p>This technique is called ‘late chunking’ [1], and is based on another technique called ‘late interaction’ [2].<p>And you can combine late chunking (to pool token embeddings) with semantic chunking (to partition the document) for even better retrieval results. For an example implementation that applies both techniques, check out RAGLite [3].<p>[1] <a href="https:&#x2F;&#x2F;weaviate.io&#x2F;blog&#x2F;late-chunking" rel="nofollow">https:&#x2F;&#x2F;weaviate.io&#x2F;blog&#x2F;late-chunking</a><p>[2] <a href="https:&#x2F;&#x2F;jina.ai&#x2F;news&#x2F;what-is-colbert-and-late-interaction-and-why-they-matter-in-search&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jina.ai&#x2F;news&#x2F;what-is-colbert-and-late-interaction-an...</a><p>[3] <a href="https:&#x2F;&#x2F;github.com&#x2F;superlinear-ai&#x2F;raglite">https:&#x2F;&#x2F;github.com&#x2F;superlinear-ai&#x2F;raglite</a></div><br/><div id="42226444" class="c"><input type="checkbox" id="c-42226444" checked=""/><div class="controls bullet"><span class="by">voiper1</span><span>|</span><a href="#42225960">root</a><span>|</span><a href="#42226094">parent</a><span>|</span><a href="#42226318">next</a><span>|</span><label class="collapse" for="c-42226444">[-]</label><label class="expand" for="c-42226444">[3 more]</label></div><br/><div class="children"><div class="content">I read both those articles, but I still don&#x27;t get how to do it. It seems the idea is that more of the embedding is informed by context, but do I _do_ late chunking?<p>My best guess so far is that somehow I embed a long text and then I break up the returned embedding into multiple parts and search each separately? But that doesn&#x27;t sound right.</div><br/><div id="42226704" class="c"><input type="checkbox" id="c-42226704" checked=""/><div class="controls bullet"><span class="by">lsorber</span><span>|</span><a href="#42225960">root</a><span>|</span><a href="#42226444">parent</a><span>|</span><a href="#42226690">next</a><span>|</span><label class="collapse" for="c-42226704">[-]</label><label class="expand" for="c-42226704">[1 more]</label></div><br/><div class="children"><div class="content">The name ‘late chunking’ is indeed somewhat of a misnomer in the sense that the technique does not partition documents into document chunks. What it actually does is to pool token embeddings (of a large context) into say sentence embeddings. The result is that your document is now represented as a sequence of sentence embeddings, each of which is informed by the other sentences in the document.<p>Then, you want to parition the document into chunks. Late chunking pairs really well with semantic chunking because it can use late chunking&#x27;s improved sentence embeddings to find semantically more cohesive chunks. In fact, you can cast this as a binary integer programming problem and find the ‘best’ chunks this way. See RAGLite [1] for an implementation of both techniques including the formulation of semantic chunking as an optimization problem.<p>Finally, you have a sequence of document chunks, each represented as a multi-vector sequence of sentence embeddings. You could choose to pool these sentence embeddings into a single embedding vector per chunk. Or, you could leave the multi-vector chunk embeddings as-is and apply a more advanced querying technique like ColBERT&#x27;s MaxSim [2].<p>[1] <a href="https:&#x2F;&#x2F;github.com&#x2F;superlinear-ai&#x2F;raglite">https:&#x2F;&#x2F;github.com&#x2F;superlinear-ai&#x2F;raglite</a><p>[2] <a href="https:&#x2F;&#x2F;huggingface.co&#x2F;blog&#x2F;fsommers&#x2F;document-similarity-colpali" rel="nofollow">https:&#x2F;&#x2F;huggingface.co&#x2F;blog&#x2F;fsommers&#x2F;document-similarity-col...</a></div><br/></div></div><div id="42226690" class="c"><input type="checkbox" id="c-42226690" checked=""/><div class="controls bullet"><span class="by">_hl_</span><span>|</span><a href="#42225960">root</a><span>|</span><a href="#42226444">parent</a><span>|</span><a href="#42226704">prev</a><span>|</span><a href="#42226318">next</a><span>|</span><label class="collapse" for="c-42226690">[-]</label><label class="expand" for="c-42226690">[1 more]</label></div><br/><div class="children"><div class="content">You’d need to go a level below the API that most embedding services expose.<p>A transformer-based embedding model doesn’t just give you a vector for the entire input string, it gives you vectors <i>for each token</i>. These are then “pooled” together (eg averaged, or max-pooled, or other strategies) to reduce these many vectors down into a single vector.<p>Late chunking means changing this reduction to yield many vectors instead of just one.</div><br/></div></div></div></div><div id="42226318" class="c"><input type="checkbox" id="c-42226318" checked=""/><div class="controls bullet"><span class="by">visarga</span><span>|</span><a href="#42225960">root</a><span>|</span><a href="#42226094">parent</a><span>|</span><a href="#42226444">prev</a><span>|</span><a href="#42226395">next</a><span>|</span><label class="collapse" for="c-42226318">[-]</label><label class="expand" for="c-42226318">[1 more]</label></div><br/><div class="children"><div class="content">You can achieve the same effect by using LLM to do question answering prior to embedding, it&#x27;s much more flexible but slower, you can use CoT, or even graph rag. Late chunking is a faster implicit alternative.</div><br/></div></div></div></div><div id="42226395" class="c"><input type="checkbox" id="c-42226395" checked=""/><div class="controls bullet"><span class="by">voiper1</span><span>|</span><a href="#42225960">parent</a><span>|</span><a href="#42226094">prev</a><span>|</span><a href="#42226080">next</a><span>|</span><label class="collapse" for="c-42226395">[-]</label><label class="expand" for="c-42226395">[1 more]</label></div><br/><div class="children"><div class="content">I thought embedding large chunks would &quot;dilute&quot; the ideas, since large chunks tend to have multiple disparate ideas?<p>Does it somehow capture _all_ of the ideas, and querying for a single one would somehow match?<p>Isn&#x27;t that the point of breaking down into sentences?<p>Someone mentioned adding context -- but doesn&#x27;t it calculate embedding on the whole thing?
The API Docs list `input` but no separate `context`. <a href="https:&#x2F;&#x2F;docs.voyageai.com&#x2F;reference&#x2F;embeddings-api" rel="nofollow">https:&#x2F;&#x2F;docs.voyageai.com&#x2F;reference&#x2F;embeddings-api</a></div><br/></div></div><div id="42226080" class="c"><input type="checkbox" id="c-42226080" checked=""/><div class="controls bullet"><span class="by">Arctic_fly</span><span>|</span><a href="#42225960">parent</a><span>|</span><a href="#42226395">prev</a><span>|</span><a href="#42226304">next</a><span>|</span><label class="collapse" for="c-42226080">[-]</label><label class="expand" for="c-42226080">[1 more]</label></div><br/><div class="children"><div class="content">&gt; What’s the benefit of generating embeddings for such large chunks?<p>Not an expert, but I believe now that we can fit more tokens into an LLM&#x27;s context window, we can avoid a number of problems by providing additional context around any chunk of text that might be useful to the LLM. Solves the problem of misinterpretation of the important bit by the LLM.</div><br/></div></div></div></div><div id="42226304" class="c"><input type="checkbox" id="c-42226304" checked=""/><div class="controls bullet"><span class="by">ChrisArchitect</span><span>|</span><a href="#42225960">prev</a><span>|</span><a href="#42226111">next</a><span>|</span><label class="collapse" for="c-42226304">[-]</label><label class="expand" for="c-42226304">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;hn.algolia.com&#x2F;?q=https%3A%2F%2Fblog.voyageai.com%2F2024%2F09%2F18%2Fvoyage-3%2F" rel="nofollow">https:&#x2F;&#x2F;hn.algolia.com&#x2F;?q=https%3A%2F%2Fblog.voyageai.com%2F...</a></div><br/></div></div><div id="42226111" class="c"><input type="checkbox" id="c-42226111" checked=""/><div class="controls bullet"><span class="by">OutOfHere</span><span>|</span><a href="#42226304">prev</a><span>|</span><a href="#42225884">next</a><span>|</span><label class="collapse" for="c-42226111">[-]</label><label class="expand" for="c-42226111">[2 more]</label></div><br/><div class="children"><div class="content">I would like to see an independent benchmark.</div><br/><div id="42226148" class="c"><input type="checkbox" id="c-42226148" checked=""/><div class="controls bullet"><span class="by">benreesman</span><span>|</span><a href="#42226111">parent</a><span>|</span><a href="#42225884">next</a><span>|</span><label class="collapse" for="c-42226148">[-]</label><label class="expand" for="c-42226148">[1 more]</label></div><br/><div class="children"><div class="content">This looks quite serious (which would be unsurprising given that Fei-Fei Li and Christopher Ré are involved).<p>I&#x27;m also quite interested in the nuts and bolts: does anyone know what the current accepted leaderboard on this is? I was screwing around with GritLM [1] a few months back and I seem to remember the MTEB [2] was kind of the headline thing at that time, but I might be out of date.<p>[1] <a href="https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2402.09906" rel="nofollow">https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2402.09906</a>
[2] <a href="https:&#x2F;&#x2F;huggingface.co&#x2F;blog&#x2F;mteb" rel="nofollow">https:&#x2F;&#x2F;huggingface.co&#x2F;blog&#x2F;mteb</a></div><br/></div></div></div></div><div id="42225884" class="c"><input type="checkbox" id="c-42225884" checked=""/><div class="controls bullet"><span class="by">johnfn</span><span>|</span><a href="#42226111">prev</a><span>|</span><a href="#42226240">next</a><span>|</span><label class="collapse" for="c-42225884">[-]</label><label class="expand" for="c-42225884">[3 more]</label></div><br/><div class="children"><div class="content">What on earth is &quot;OpenAI V3&quot;? Just to be sure I wasn&#x27;t being obtuse, I Googled it, only to get a bunch of articles pointing back at this post.</div><br/><div id="42225906" class="c"><input type="checkbox" id="c-42225906" checked=""/><div class="controls bullet"><span class="by">refulgentis</span><span>|</span><a href="#42225884">parent</a><span>|</span><a href="#42225904">next</a><span>|</span><label class="collapse" for="c-42225906">[-]</label><label class="expand" for="c-42225906">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;openai.com&#x2F;index&#x2F;new-embedding-models-and-api-updates&#x2F;" rel="nofollow">https:&#x2F;&#x2F;openai.com&#x2F;index&#x2F;new-embedding-models-and-api-update...</a><p>API constant is text-embedding-3</div><br/></div></div><div id="42225904" class="c"><input type="checkbox" id="c-42225904" checked=""/><div class="controls bullet"><span class="by">chipgap98</span><span>|</span><a href="#42225884">parent</a><span>|</span><a href="#42225906">prev</a><span>|</span><a href="#42226240">next</a><span>|</span><label class="collapse" for="c-42225904">[-]</label><label class="expand" for="c-42225904">[1 more]</label></div><br/><div class="children"><div class="content">It is OpenAI&#x27;s vector embedding model</div><br/></div></div></div></div><div id="42226240" class="c"><input type="checkbox" id="c-42226240" checked=""/><div class="controls bullet"><span class="by">ldjkfkdsjnv</span><span>|</span><a href="#42225884">prev</a><span>|</span><label class="collapse" for="c-42226240">[-]</label><label class="expand" for="c-42226240">[1 more]</label></div><br/><div class="children"><div class="content">I build a RAG system with voyage and it crushed openai embeddings, the difference in retrieval quality was noticeable</div><br/></div></div></div></div></div></div></div></body></html>