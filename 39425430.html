<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1708333270017" as="style"/><link rel="stylesheet" href="styles.css?v=1708333270017"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://mediocregopher.com/posts/git-proxy">Serving a website from a Git repo without cloning it</a> <span class="domain">(<a href="https://mediocregopher.com">mediocregopher.com</a>)</span></div><div class="subtext"><span>todsacerdoti</span> | <span>30 comments</span></div><br/><div><div id="39426526" class="c"><input type="checkbox" id="c-39426526" checked=""/><div class="controls bullet"><span class="by">sho</span><span>|</span><a href="#39426666">next</a><span>|</span><label class="collapse" for="c-39426526">[-]</label><label class="expand" for="c-39426526">[11 more]</label></div><br/><div class="children"><div class="content">&gt; It&#x27;s fairly common to use git repositories as a vehicle for serving websites. The webdev pushes their changes to some branch of a publicly available git repository<p>This doesn&#x27;t require the git repo to be public. My go-to &quot;day one&quot; static website deploy strategy is to set up a git remote on some VPS, point nginx at its public html folder, then &quot;deploy&quot; to that with a git push, authed by ssh key.<p>You&#x27;d be surprised how far you can get with simple tricks like this. I served about the first 6 months of what would become a multi-hundred-million company with this hilariously simple setup running on a $20&#x2F;m DO VPS.</div><br/><div id="39427452" class="c"><input type="checkbox" id="c-39427452" checked=""/><div class="controls bullet"><span class="by">dirkc</span><span>|</span><a href="#39426526">parent</a><span>|</span><a href="#39426830">next</a><span>|</span><label class="collapse" for="c-39427452">[-]</label><label class="expand" for="c-39427452">[3 more]</label></div><br/><div class="children"><div class="content">If you&#x27;re just serving static files, wouldn&#x27;t a S3 website be easier and more robust?</div><br/><div id="39427464" class="c"><input type="checkbox" id="c-39427464" checked=""/><div class="controls bullet"><span class="by">0xFF0123</span><span>|</span><a href="#39426526">root</a><span>|</span><a href="#39427452">parent</a><span>|</span><a href="#39426830">next</a><span>|</span><label class="collapse" for="c-39427464">[-]</label><label class="expand" for="c-39427464">[2 more]</label></div><br/><div class="children"><div class="content">With unbounded running costs... There is something comforting about knowing it&#x27;s always going to cost you $20.</div><br/><div id="39427500" class="c"><input type="checkbox" id="c-39427500" checked=""/><div class="controls bullet"><span class="by">dirkc</span><span>|</span><a href="#39426526">root</a><span>|</span><a href="#39427464">parent</a><span>|</span><a href="#39426830">next</a><span>|</span><label class="collapse" for="c-39427500">[-]</label><label class="expand" for="c-39427500">[1 more]</label></div><br/><div class="children"><div class="content">True, didn&#x27;t think about it from the limited cost perspective. Would be a lot of traffic to get you past $20, but a possibility like you say.</div><br/></div></div></div></div></div></div><div id="39426830" class="c"><input type="checkbox" id="c-39426830" checked=""/><div class="controls bullet"><span class="by">p4bl0</span><span>|</span><a href="#39426526">parent</a><span>|</span><a href="#39427452">prev</a><span>|</span><a href="#39427065">next</a><span>|</span><label class="collapse" for="c-39426830">[-]</label><label class="expand" for="c-39426830">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve been publishing my personal web page like this for more than 15 years now (the repos log history goes back to early 2009). I use a post-update hook that makes sure on each push that the working directory is on par with the master branch (so that things that are pushed to other branches aren&#x27;t made public) and then the public site is rebuilt (using a Makefile and custom scripts making heavy use of xml2, 2xml, sed, and the coreutils, but that&#x27;s another story).<p>I can see why the author of the linked blog post would want to serve directly from the Git repository: it&#x27;s fun. But I agree that it seems uselessly inefficient compared to (re)generating a static version of the site only when changes occur.<p>If there is no processing needed like in the case of the blog post, a simple post-update hook can easily do the trick: go to the public directory served by the web server, then set the GIT_DIR environment variable to point to the .git directory of your repository, then execute the command `git checkout <i>main-branch</i> -- .` to get all the static files out of the repository). This would then have the exact same external behavior as what is proposed in the linked blog post, but will be way more efficient (except of course if you have no visitors and update your website very very often).</div><br/></div></div><div id="39427065" class="c"><input type="checkbox" id="c-39427065" checked=""/><div class="controls bullet"><span class="by">geek_at</span><span>|</span><a href="#39426526">parent</a><span>|</span><a href="#39426830">prev</a><span>|</span><a href="#39426932">next</a><span>|</span><label class="collapse" for="c-39427065">[-]</label><label class="expand" for="c-39427065">[1 more]</label></div><br/><div class="children"><div class="content">I do the same. My blog on a 9€&#x2F;mo Contabo VPS survived multiple HN&#x2F;Reddit hugs.<p>Lateley I&#x27;ve been playing with more configuration options like I have two servers configured behind a load balancer but with a heavy focus on server 1. Only if the response time of server 1 is under 500ms, server two is used, which hosts an almost identical site but with ads. So under normal circumstances nobody will see ads on my blog unless I get a huge spike (more than 600 concurrent users ususall)</div><br/></div></div><div id="39426932" class="c"><input type="checkbox" id="c-39426932" checked=""/><div class="controls bullet"><span class="by">supriyo-biswas</span><span>|</span><a href="#39426526">parent</a><span>|</span><a href="#39427065">prev</a><span>|</span><a href="#39427199">next</a><span>|</span><label class="collapse" for="c-39426932">[-]</label><label class="expand" for="c-39426932">[3 more]</label></div><br/><div class="children"><div class="content">This approach is fine for static websites, but for web applications you should probably block requests to &#x2F;.git so that people can’t clone your application off of the web.</div><br/><div id="39427097" class="c"><input type="checkbox" id="c-39427097" checked=""/><div class="controls bullet"><span class="by">p4bl0</span><span>|</span><a href="#39426526">root</a><span>|</span><a href="#39426932">parent</a><span>|</span><a href="#39427199">next</a><span>|</span><label class="collapse" for="c-39427097">[-]</label><label class="expand" for="c-39427097">[2 more]</label></div><br/><div class="children"><div class="content">The .git directory doesn&#x27;t necessarily need to be in the public directory at all.</div><br/><div id="39427484" class="c"><input type="checkbox" id="c-39427484" checked=""/><div class="controls bullet"><span class="by">quectophoton</span><span>|</span><a href="#39426526">root</a><span>|</span><a href="#39427097">parent</a><span>|</span><a href="#39427199">next</a><span>|</span><label class="collapse" for="c-39427484">[-]</label><label class="expand" for="c-39427484">[1 more]</label></div><br/><div class="children"><div class="content">If anyone wants to read more about this, search for `GIT_DIR` and `GIT_WORK_TREE` environment variables.</div><br/></div></div></div></div></div></div><div id="39427199" class="c"><input type="checkbox" id="c-39427199" checked=""/><div class="controls bullet"><span class="by">throwaway828</span><span>|</span><a href="#39426526">parent</a><span>|</span><a href="#39426932">prev</a><span>|</span><a href="#39426666">next</a><span>|</span><label class="collapse" for="c-39427199">[-]</label><label class="expand" for="c-39427199">[2 more]</label></div><br/><div class="children"><div class="content">What was your multi hundred million dollar company?</div><br/><div id="39427218" class="c"><input type="checkbox" id="c-39427218" checked=""/><div class="controls bullet"><span class="by">sho</span><span>|</span><a href="#39426526">root</a><span>|</span><a href="#39427199">parent</a><span>|</span><a href="#39426666">next</a><span>|</span><label class="collapse" for="c-39427218">[-]</label><label class="expand" for="c-39427218">[1 more]</label></div><br/><div class="children"><div class="content">Unfortunately, it wasn&#x27;t <i>my</i> hundred million dollar company.</div><br/></div></div></div></div></div></div><div id="39426666" class="c"><input type="checkbox" id="c-39426666" checked=""/><div class="controls bullet"><span class="by">RandomWorker</span><span>|</span><a href="#39426526">prev</a><span>|</span><a href="#39427185">next</a><span>|</span><label class="collapse" for="c-39426666">[-]</label><label class="expand" for="c-39426666">[1 more]</label></div><br/><div class="children"><div class="content">I just ssh in periodically run a git pull and it’s done. I have a text file with the various things I need to do. Takes less than 2 min of work. I’ve not been convinced automating this process yet would save me much time.</div><br/></div></div><div id="39427185" class="c"><input type="checkbox" id="c-39427185" checked=""/><div class="controls bullet"><span class="by">iamflimflam1</span><span>|</span><a href="#39426666">prev</a><span>|</span><a href="#39425926">next</a><span>|</span><label class="collapse" for="c-39427185">[-]</label><label class="expand" for="c-39427185">[2 more]</label></div><br/><div class="children"><div class="content">The cheapest solution I’ve found for static sites is an S3 bucket with Cloudfront sat in front of it. Costs next to nothing.</div><br/><div id="39427467" class="c"><input type="checkbox" id="c-39427467" checked=""/><div class="controls bullet"><span class="by">sakopov</span><span>|</span><a href="#39427185">parent</a><span>|</span><a href="#39425926">next</a><span>|</span><label class="collapse" for="c-39427467">[-]</label><label class="expand" for="c-39427467">[1 more]</label></div><br/><div class="children"><div class="content">Cheapest option I found is a Jekyll site deployed out of a GitHub repo (can be private) to Cloudlfare Sites. No cost at all even with a custom domain.</div><br/></div></div></div></div><div id="39426235" class="c"><input type="checkbox" id="c-39426235" checked=""/><div class="controls bullet"><span class="by">merlincorey</span><span>|</span><a href="#39425926">prev</a><span>|</span><a href="#39426172">next</a><span>|</span><label class="collapse" for="c-39426235">[-]</label><label class="expand" for="c-39426235">[5 more]</label></div><br/><div class="children"><div class="content">Why not just use Partial or Shallow Clones? [0]<p>[0] <a href="https:&#x2F;&#x2F;github.blog&#x2F;2020-12-21-get-up-to-speed-with-partial-clone-and-shallow-clone&#x2F;" rel="nofollow">https:&#x2F;&#x2F;github.blog&#x2F;2020-12-21-get-up-to-speed-with-partial-...</a></div><br/><div id="39426332" class="c"><input type="checkbox" id="c-39426332" checked=""/><div class="controls bullet"><span class="by">verticalscaler</span><span>|</span><a href="#39426235">parent</a><span>|</span><a href="#39426172">next</a><span>|</span><label class="collapse" for="c-39426332">[-]</label><label class="expand" for="c-39426332">[4 more]</label></div><br/><div class="children"><div class="content">git clone --depth=1 is fast because it doesn&#x27;t grab the full commits history but OP is getting at a specific <i>singular file directly</i>.<p>It is neat, not aware of a git incantation so fine grained. Hope it gets built into Git directly.</div><br/><div id="39426818" class="c"><input type="checkbox" id="c-39426818" checked=""/><div class="controls bullet"><span class="by">merlincorey</span><span>|</span><a href="#39426235">root</a><span>|</span><a href="#39426332">parent</a><span>|</span><a href="#39426973">next</a><span>|</span><label class="collapse" for="c-39426818">[-]</label><label class="expand" for="c-39426818">[1 more]</label></div><br/><div class="children"><div class="content">Ah, thank you for the clarification -- as far as I know that is indeed unique.<p>It&#x27;s a thimbleful sized shallow clone, one could say.</div><br/></div></div><div id="39426973" class="c"><input type="checkbox" id="c-39426973" checked=""/><div class="controls bullet"><span class="by">paulddraper</span><span>|</span><a href="#39426235">root</a><span>|</span><a href="#39426332">parent</a><span>|</span><a href="#39426818">prev</a><span>|</span><a href="#39426172">next</a><span>|</span><label class="collapse" for="c-39426973">[-]</label><label class="expand" for="c-39426973">[2 more]</label></div><br/><div class="children"><div class="content">You can do a shallow clone and partial checkout.</div><br/><div id="39426991" class="c"><input type="checkbox" id="c-39426991" checked=""/><div class="controls bullet"><span class="by">verticalscaler</span><span>|</span><a href="#39426235">root</a><span>|</span><a href="#39426973">parent</a><span>|</span><a href="#39426172">next</a><span>|</span><label class="collapse" for="c-39426991">[-]</label><label class="expand" for="c-39426991">[1 more]</label></div><br/><div class="children"><div class="content">Cool! Why you gotta tease me like this without busting out a one liner? :)<p>Gemini disagrees with you btw:<p>Unfortunately, directly combining git shallow clone and git partial checkout to grab just one specific file isn&#x27;t straightforward. Here&#x27;s why:<p>Shallow clone: This limits the downloaded commit history to a specific depth, but it still fetches all files involved in those commits. While reducing data, it wouldn&#x27;t restrict files solely based on your needs.<p>Partial checkout: This lets you specify which files to include in your working directory, but <i>it requires a full clone initially</i>.<p>However, you have a few alternative approaches to achieve your goal:<p>1. Shallow clone + Sparse checkout:<p>Use git clone --depth=&lt;commit_depth&gt; --single-branch=&lt;branch&gt; to shallow clone the specific branch and limit history.
Create a .git&#x2F;info&#x2F;sparse-checkout file containing only the path to the desired file.
Run git read-tree -u to update the index based on the sparse-checkout file.
 This method downloads a limited history and only keeps the specified file in your working directory.<p>2. Partial clone with server support (limited availability):<p>Check if the server supports partial clones (currently implemented on Github and some Gitlab self-hosted instances).<p>Use git clone --filter=blob:none &lt;url&gt; for a &quot;blobless&quot; clone that only contains file content, no history or directory structure.<p>Add the desired file path to the .git&#x2F;info&#x2F;sparse-checkout file and run git read-tree -u as before.<p>This approach minimizes downloaded data but requires server support and won&#x27;t work everywhere.</div><br/></div></div></div></div></div></div></div></div><div id="39426172" class="c"><input type="checkbox" id="c-39426172" checked=""/><div class="controls bullet"><span class="by">stevefan1999</span><span>|</span><a href="#39426235">prev</a><span>|</span><label class="collapse" for="c-39426172">[-]</label><label class="expand" for="c-39426172">[9 more]</label></div><br/><div class="children"><div class="content">Congratulations! That means you basically figured out how the clone procedure works and found a way to do so just in a partial way (also in an unsafe way). But it is a cool idea, nonetheless.<p>Also check out the Scalar [1] project and its predecessor, GVFS [2], both from Microsoft to manage their monorepo via a VFS layer.<p>[1]: <a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;scalar">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;scalar</a><p>[2]: <a href="https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;VFSForGit">https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;VFSForGit</a></div><br/><div id="39426446" class="c"><input type="checkbox" id="c-39426446" checked=""/><div class="controls bullet"><span class="by">vsuperpower2020</span><span>|</span><a href="#39426172">parent</a><span>|</span><a href="#39426220">next</a><span>|</span><label class="collapse" for="c-39426446">[-]</label><label class="expand" for="c-39426446">[1 more]</label></div><br/><div class="children"><div class="content">Why are you congratulating the author? There&#x27;s no reason to be condescending.</div><br/></div></div><div id="39426220" class="c"><input type="checkbox" id="c-39426220" checked=""/><div class="controls bullet"><span class="by">ttymck</span><span>|</span><a href="#39426172">parent</a><span>|</span><a href="#39426446">prev</a><span>|</span><label class="collapse" for="c-39426220">[-]</label><label class="expand" for="c-39426220">[7 more]</label></div><br/><div class="children"><div class="content">What is unsafe about it?</div><br/><div id="39427281" class="c"><input type="checkbox" id="c-39427281" checked=""/><div class="controls bullet"><span class="by">pacifika</span><span>|</span><a href="#39426172">root</a><span>|</span><a href="#39426220">parent</a><span>|</span><a href="#39426386">next</a><span>|</span><label class="collapse" for="c-39427281">[-]</label><label class="expand" for="c-39427281">[1 more]</label></div><br/><div class="children"><div class="content">Stevefan’s configuration of the website apparently</div><br/></div></div><div id="39426386" class="c"><input type="checkbox" id="c-39426386" checked=""/><div class="controls bullet"><span class="by">est</span><span>|</span><a href="#39426172">root</a><span>|</span><a href="#39426220">parent</a><span>|</span><a href="#39427281">prev</a><span>|</span><label class="collapse" for="c-39426386">[-]</label><label class="expand" for="c-39426386">[5 more]</label></div><br/><div class="children"><div class="content">I think it means if you serve it to the public, a hacker might eventually find a way to enumerate all of your .git repo.</div><br/><div id="39426740" class="c"><input type="checkbox" id="c-39426740" checked=""/><div class="controls bullet"><span class="by">yau8edq12i</span><span>|</span><a href="#39426172">root</a><span>|</span><a href="#39426386">parent</a><span>|</span><a href="#39427032">next</a><span>|</span><label class="collapse" for="c-39426740">[-]</label><label class="expand" for="c-39426740">[1 more]</label></div><br/><div class="children"><div class="content">Then don&#x27;t put sensitive material in a repo that you decide to essentially make public and serve to the whole world.</div><br/></div></div><div id="39426684" class="c"><input type="checkbox" id="c-39426684" checked=""/><div class="controls bullet"><span class="by">TeMPOraL</span><span>|</span><a href="#39426172">root</a><span>|</span><a href="#39426386">parent</a><span>|</span><a href="#39427032">prev</a><span>|</span><label class="collapse" for="c-39426684">[-]</label><label class="expand" for="c-39426684">[2 more]</label></div><br/><div class="children"><div class="content">And then what happens?</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>