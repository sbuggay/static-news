<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1704618054741" as="style"/><link rel="stylesheet" href="styles.css?v=1704618054741"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://old.reddit.com/r/aoe2/comments/18ysttu/aoe_is_written_in_assembly_is_this_actually_true_o/">Original Age of Empires 2 dev talks about its usage of assembly code</a>Â <span class="domain">(<a href="https://old.reddit.com">old.reddit.com</a>)</span></div><div class="subtext"><span>the-smug-one</span> | <span>27 comments</span></div><br/><div><div id="38897406" class="c"><input type="checkbox" id="c-38897406" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#38897279">next</a><span>|</span><label class="collapse" for="c-38897406">[-]</label><label class="expand" for="c-38897406">[11 more]</label></div><br/><div class="children"><div class="content">I worked on port of a Konami game from PSX to PC, that was 1999-2000 - the code (C) had lots of #ifdefs like where inline assembly was placed, and the original &quot;C&quot; code was kept. It seemed all done by one specific programmer, and what really saved us (in porting) the game was the originallly kept &quot;C&quot; code. My mips knowledge was never as good as x86.<p>So yes, it was the norm back then. My second job (1998), was working on a team that was going to do some software for Intel for the upcoming back then Katmai processor (Pentium I was it). It had all the new fancy SIMD instructions. The software was supposed to be something like media composer - you slap images, rotate them, etc all in realtime using software rendering (GPUs were still relatively expensive).<p>I wrote a bilinear and bicubic texture mapper with marching squares for transparent areas. It was all in assembly, and I spent lots of time optimizing it. Back then we used Intel&#x27;s VTune, and it was super-precise (for the processors back then) - how they are going to pipeline, how much (supposedly) instructions cycles would take, waits, etc. That helped a lot!<p>But the real lesson was, that me and my manager - both claiming to be super good at assembly (after our recent achievements), rewrote the sphere mapping code for a game another team was writting in assembly, but alas our assembly (but no katmai instructions) code was slower than what the compiler did ;) - TBH, if we did proper mipmapping and texture swizzling we would&#x27;ve fared both ways, but hey, demo coders were not always to be found so they had to rely on regular programmers like us!<p>flipcode keeps a lot of good articles, with lots of good assembly for that - <a href="https:&#x2F;&#x2F;www.flipcode.com&#x2F;archives&#x2F;articles.shtml" rel="nofollow">https:&#x2F;&#x2F;www.flipcode.com&#x2F;archives&#x2F;articles.shtml</a> - there were even better materials from earlier years, but can&#x27;t find them.<p>Turbo&#x2F;Borland Pascal were so awesome, because they allowed for very easy of inline assembly use (somehow) than C&#x2F;C++ - though you had to know which registers you can touch or not.</div><br/><div id="38899692" class="c"><input type="checkbox" id="c-38899692" checked=""/><div class="controls bullet"><span class="by">pjmlp</span><span>|</span><a href="#38897406">parent</a><span>|</span><a href="#38897838">next</a><span>|</span><label class="collapse" for="c-38899692">[-]</label><label class="expand" for="c-38899692">[1 more]</label></div><br/><div class="children"><div class="content">Another Flipcode user!<p>I missed that other game forums of similar vintage are now gone.<p>The way to being able to do Assembly in Borland products, and to lesser extent on VC++, was great.<p>I always feel like vomiting when looking at the mess UNIX compilers have come up for it, instead of inferring how registers are being used, and the whole string concatenation stuff.</div><br/></div></div><div id="38897838" class="c"><input type="checkbox" id="c-38897838" checked=""/><div class="controls bullet"><span class="by">akoboldfrying</span><span>|</span><a href="#38897406">parent</a><span>|</span><a href="#38899692">prev</a><span>|</span><a href="#38897987">next</a><span>|</span><label class="collapse" for="c-38897838">[-]</label><label class="expand" for="c-38897838">[3 more]</label></div><br/><div class="children"><div class="content">It was always so disappointing, spending hours coding up a tightly wound assembly language version of some inner loop that uses half the instructions generated by the C++ compiler, only to find that your slaved-over version is actually 5% <i>slower</i>. But OTOH... the thrill when it actually was faster!<p>This was back in the Pentium 4 era, where there were deep pipelines and oddities like some simple ALU instructions (ADD, SUB, etc.) taking 0.5 cycles(!), while others (ADC, SHR) took 4 cycles IIRC.</div><br/><div id="38898403" class="c"><input type="checkbox" id="c-38898403" checked=""/><div class="controls bullet"><span class="by">chii</span><span>|</span><a href="#38897406">root</a><span>|</span><a href="#38897838">parent</a><span>|</span><a href="#38897987">next</a><span>|</span><label class="collapse" for="c-38898403">[-]</label><label class="expand" for="c-38898403">[2 more]</label></div><br/><div class="children"><div class="content">&gt; uses half the instructions generated by the C++ compiler<p>is there a tool that could profile&#x2F;predict ahead of time, so that one does not attempt to hand write assembly before knowing for sure it will beat the compiled version?</div><br/><div id="38898969" class="c"><input type="checkbox" id="c-38898969" checked=""/><div class="controls bullet"><span class="by">adrianN</span><span>|</span><a href="#38897406">root</a><span>|</span><a href="#38898403">parent</a><span>|</span><a href="#38897987">next</a><span>|</span><label class="collapse" for="c-38898969">[-]</label><label class="expand" for="c-38898969">[1 more]</label></div><br/><div class="children"><div class="content">For small pieces of code I would try to use a superoptimizer like souper.</div><br/></div></div></div></div></div></div><div id="38897987" class="c"><input type="checkbox" id="c-38897987" checked=""/><div class="controls bullet"><span class="by">philistine</span><span>|</span><a href="#38897406">parent</a><span>|</span><a href="#38897838">prev</a><span>|</span><a href="#38897559">next</a><span>|</span><label class="collapse" for="c-38897987">[-]</label><label class="expand" for="c-38897987">[2 more]</label></div><br/><div class="children"><div class="content">You worked on the port of Metal Gear Solid?! OH MY GOD THIS IS SO COOL!<p>Edit: Looking it up you might have worked on a larger amount of games than I thought. Very awesome nonetheless. <a href="https:&#x2F;&#x2F;www.mobygames.com&#x2F;game&#x2F;company:99&#x2F;from:1998&#x2F;platform:windows&#x2F;until:2001&#x2F;sort:-date&#x2F;page:1&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.mobygames.com&#x2F;game&#x2F;company:99&#x2F;from:1998&#x2F;platform...</a></div><br/><div id="38898858" class="c"><input type="checkbox" id="c-38898858" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#38897406">root</a><span>|</span><a href="#38897987">parent</a><span>|</span><a href="#38897559">next</a><span>|</span><label class="collapse" for="c-38898858">[-]</label><label class="expand" for="c-38898858">[1 more]</label></div><br/><div class="children"><div class="content">Thanks!!! Yes it was MGS - the deal was with our studio to do the port from PSX -&gt; PC and since Microsoft was the publisher, part of the deal was for Konami to port Age Of Empires (1? 2?) to PSX.</div><br/></div></div></div></div><div id="38897559" class="c"><input type="checkbox" id="c-38897559" checked=""/><div class="controls bullet"><span class="by">zeusk</span><span>|</span><a href="#38897406">parent</a><span>|</span><a href="#38897987">prev</a><span>|</span><a href="#38897650">next</a><span>|</span><label class="collapse" for="c-38897559">[-]</label><label class="expand" for="c-38897559">[3 more]</label></div><br/><div class="children"><div class="content">Are there any good resources on using mipmapping and swizzling effectively?</div><br/><div id="38897767" class="c"><input type="checkbox" id="c-38897767" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#38897406">root</a><span>|</span><a href="#38897559">parent</a><span>|</span><a href="#38897650">next</a><span>|</span><label class="collapse" for="c-38897767">[-]</label><label class="expand" for="c-38897767">[2 more]</label></div><br/><div class="children"><div class="content">I was actually trying to find it - there were lots of .txt files published back then - and there was one about texture mapping from 1992... 1994? - and it explained swizzling and why it was efficient with caches.</div><br/><div id="38897863" class="c"><input type="checkbox" id="c-38897863" checked=""/><div class="controls bullet"><span class="by">malkia</span><span>|</span><a href="#38897406">root</a><span>|</span><a href="#38897767">parent</a><span>|</span><a href="#38897650">next</a><span>|</span><label class="collapse" for="c-38897863">[-]</label><label class="expand" for="c-38897863">[1 more]</label></div><br/><div class="children"><div class="content">Now I remember - back then these texture mappers were called roto zoomers, Alex Champandard did excellent series here -&gt;<p><a href="https:&#x2F;&#x2F;www.flipcode.com&#x2F;archives&#x2F;The_Art_of_Demomaking-Issue_10_Roto-Zooming.shtml" rel="nofollow">https:&#x2F;&#x2F;www.flipcode.com&#x2F;archives&#x2F;The_Art_of_Demomaking-Issu...</a> - look for zip file with the source code.<p>I&#x27;ve also found Go version (and there were 2 java ones)<p><a href="https:&#x2F;&#x2F;github.com&#x2F;search?q=BlockTextureScreen">https:&#x2F;&#x2F;github.com&#x2F;search?q=BlockTextureScreen</a><p>So it&#x27;s not as neat as swizzling (quickly looking at it) - but essentially same goal - keep pixels that have to be drawn together at close (e.g. blocks). Mipmapping helps too, as then you don&#x27;t &quot;skip&quot; too many pixels - and you both gain better quality and less cache misses.</div><br/></div></div></div></div></div></div><div id="38897650" class="c"><input type="checkbox" id="c-38897650" checked=""/><div class="controls bullet"><span class="by">takiyo</span><span>|</span><a href="#38897406">parent</a><span>|</span><a href="#38897559">prev</a><span>|</span><a href="#38897279">next</a><span>|</span><label class="collapse" for="c-38897650">[-]</label><label class="expand" for="c-38897650">[1 more]</label></div><br/><div class="children"><div class="content">This was a nice read, thanks for writing.</div><br/></div></div></div></div><div id="38897279" class="c"><input type="checkbox" id="c-38897279" checked=""/><div class="controls bullet"><span class="by">Havoc</span><span>|</span><a href="#38897406">prev</a><span>|</span><a href="#38897582">next</a><span>|</span><label class="collapse" for="c-38897279">[-]</label><label class="expand" for="c-38897279">[5 more]</label></div><br/><div class="children"><div class="content">&gt;The use of assembly in the drawing core resulting in a ~10x sprite drawing speed improvement over the C++<p>Wow that&#x27;s a chunky improvement over an already fast lang</div><br/><div id="38897411" class="c"><input type="checkbox" id="c-38897411" checked=""/><div class="controls bullet"><span class="by">necubi</span><span>|</span><a href="#38897279">parent</a><span>|</span><a href="#38898332">next</a><span>|</span><label class="collapse" for="c-38897411">[-]</label><label class="expand" for="c-38897411">[3 more]</label></div><br/><div class="children"><div class="content">This was in 1999. C++ compilers have come a long ways since then. While there are still opportunities for hand-written asm to go and order of magnitude faster than C++, they&#x27;re mostly around manual vectorization where the auto-vectorizer fails.</div><br/><div id="38898279" class="c"><input type="checkbox" id="c-38898279" checked=""/><div class="controls bullet"><span class="by">mysteria</span><span>|</span><a href="#38897279">root</a><span>|</span><a href="#38897411">parent</a><span>|</span><a href="#38897786">next</a><span>|</span><label class="collapse" for="c-38898279">[-]</label><label class="expand" for="c-38898279">[1 more]</label></div><br/><div class="children"><div class="content">And when that happens SIMD intrinsics are often used rather than going straight into raw assembly.</div><br/></div></div></div></div><div id="38898332" class="c"><input type="checkbox" id="c-38898332" checked=""/><div class="controls bullet"><span class="by">frozenport</span><span>|</span><a href="#38897279">parent</a><span>|</span><a href="#38897411">prev</a><span>|</span><a href="#38897582">next</a><span>|</span><label class="collapse" for="c-38898332">[-]</label><label class="expand" for="c-38898332">[1 more]</label></div><br/><div class="children"><div class="content">Functionality should have been provided by directx though</div><br/></div></div></div></div><div id="38897582" class="c"><input type="checkbox" id="c-38897582" checked=""/><div class="controls bullet"><span class="by">puttycat</span><span>|</span><a href="#38897279">prev</a><span>|</span><a href="#38897330">next</a><span>|</span><label class="collapse" for="c-38897582">[-]</label><label class="expand" for="c-38897582">[9 more]</label></div><br/><div class="children"><div class="content">&gt; A key speedup technique AoE used was realized during discussions I had with iD software programmer and optimization guru Michael Abrash over lunch at Tia&#x27;s Mexican Restaurant in Mesquite, TX.<p>How many freeform interactions like this did we lose because of the Internet&#x27;s illusion of being connected?</div><br/><div id="38897604" class="c"><input type="checkbox" id="c-38897604" checked=""/><div class="controls bullet"><span class="by">ahstilde</span><span>|</span><a href="#38897582">parent</a><span>|</span><a href="#38897673">next</a><span>|</span><label class="collapse" for="c-38897604">[-]</label><label class="expand" for="c-38897604">[4 more]</label></div><br/><div class="children"><div class="content">We&#x27;ve gained many. Chatting in a discord is similar to this.</div><br/><div id="38898046" class="c"><input type="checkbox" id="c-38898046" checked=""/><div class="controls bullet"><span class="by">lucb1e</span><span>|</span><a href="#38897582">root</a><span>|</span><a href="#38897604">parent</a><span>|</span><a href="#38897665">next</a><span>|</span><label class="collapse" for="c-38898046">[-]</label><label class="expand" for="c-38898046">[1 more]</label></div><br/><div class="children"><div class="content">Well, yes, but I also see their point (even if I&#x27;m not sure I agree with it): by being forced to meet IRL, you&#x27;re also forced to make real contact and seem more likely to form strong relations, and it is off-the-record by default so you can share more things<p>Of course, the (massive) counterpoint is that you get to talk to way fewer people, particularly if they&#x27;re more than half an hour traveling away. Quantity versus quality, but by having a lot of quantity through more diverse online interactions, you can find the conversations that have a lot of quality for you (overlapping fields of work, hobbies, or just a personality match).<p>Which is better? Probably something in the middle, where you hang out in chat rooms but are also conscious of the advantages of arranging to meet up. I do find it inspirational (too strong a word, but you get the idea) to hear of other times or cultures where things are done differently</div><br/></div></div><div id="38897665" class="c"><input type="checkbox" id="c-38897665" checked=""/><div class="controls bullet"><span class="by">sho_hn</span><span>|</span><a href="#38897582">root</a><span>|</span><a href="#38897604">parent</a><span>|</span><a href="#38898046">prev</a><span>|</span><a href="#38897673">next</a><span>|</span><label class="collapse" for="c-38897665">[-]</label><label class="expand" for="c-38897665">[2 more]</label></div><br/><div class="children"><div class="content">And IRC was even better at it.</div><br/><div id="38899062" class="c"><input type="checkbox" id="c-38899062" checked=""/><div class="controls bullet"><span class="by">subtra3t</span><span>|</span><a href="#38897582">root</a><span>|</span><a href="#38897665">parent</a><span>|</span><a href="#38897673">next</a><span>|</span><label class="collapse" for="c-38899062">[-]</label><label class="expand" for="c-38899062">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think so. I know everybody loves to say that IRC is better than [insert commercial chat application] but in this particular use case discord is superior to irc imo because of the voice&#x2F;video chat features and greater convenience.</div><br/></div></div></div></div></div></div><div id="38897673" class="c"><input type="checkbox" id="c-38897673" checked=""/><div class="controls bullet"><span class="by">tom_</span><span>|</span><a href="#38897582">parent</a><span>|</span><a href="#38897604">prev</a><span>|</span><a href="#38899255">next</a><span>|</span><label class="collapse" for="c-38897673">[-]</label><label class="expand" for="c-38897673">[2 more]</label></div><br/><div class="children"><div class="content">NEVER FORGET WHAT THEY HAVE TAKEN FROM US. WE WERE ONCE A CULTURE. NOW WE ARE LOST, FOREVER. WHITHER OUR SENSE OF BEAUTY. (etc., etc., insert architecture pics to taste)<p>C&#x27;mon dude. The opportunity for people to talk to one another about this stuff is <i>unimaginably</i> better than it was back then. Like, here we are, right now, me telling you you&#x27;re full of shit. What are the chances of us being able to do that in 1999?<p>(I&#x27;m sorry to be mean, but I remember 1999 very well and it was much harder to get good information about things, and discuss things with others interested in the same topics, than it is today. And it was already markedly better then than it was even 5 years prior to that!)</div><br/></div></div><div id="38899255" class="c"><input type="checkbox" id="c-38899255" checked=""/><div class="controls bullet"><span class="by">PeterStuer</span><span>|</span><a href="#38897582">parent</a><span>|</span><a href="#38897673">prev</a><span>|</span><a href="#38899568">next</a><span>|</span><label class="collapse" for="c-38899255">[-]</label><label class="expand" for="c-38899255">[1 more]</label></div><br/><div class="children"><div class="content">Don&#x27;t people still have lunch?</div><br/></div></div></div></div><div id="38897330" class="c"><input type="checkbox" id="c-38897330" checked=""/><div class="controls bullet"><span class="by">santoshalper</span><span>|</span><a href="#38897582">prev</a><span>|</span><label class="collapse" for="c-38897330">[-]</label><label class="expand" for="c-38897330">[1 more]</label></div><br/><div class="children"><div class="content">I love that Michael Abrash shows up in this story. Seems like anywhere graphical innovation happened, he was there.</div><br/></div></div></div></div></div></div></div></body></html>