<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1732870866314" as="style"/><link rel="stylesheet" href="styles.css?v=1732870866314"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://mrale.ph/blog/2024/11/27/microbenchmarks-are-experiments.html">Microbenchmarks Are Experiments</a> <span class="domain">(<a href="https://mrale.ph">mrale.ph</a>)</span></div><div class="subtext"><span>zdw</span> | <span>7 comments</span></div><br/><div><div id="42270596" class="c"><input type="checkbox" id="c-42270596" checked=""/><div class="controls bullet"><span class="by">pizlonator</span><span>|</span><a href="#42271321">next</a><span>|</span><label class="collapse" for="c-42270596">[-]</label><label class="expand" for="c-42270596">[4 more]</label></div><br/><div class="children"><div class="content">It’s cool to see this kind of analysis, even if it’s analyzing a totally bogus benchmark.<p>If you want to compare language runtimes, compilers, or CPUs then you have to pick a larger workload than just one loop. So, if a microbenchmark is an experiment, then it is a truly bad experiment indeed.<p>Reason: loops like this are easy for compilers to analyze, in a way that makes them not representative of real code. The hard part of writing a good compiler is handling the hard to analyze cases, not loops like this. So, if a runtime does well on a bullshit loop like this then it doesn’t mean that it’ll do well on real stuff.<p>(Source: I wrote a bunch of the JSC optimizations including the loop reshaping and the modulo ones mentioned by this post.)</div><br/><div id="42271329" class="c"><input type="checkbox" id="c-42271329" checked=""/><div class="controls bullet"><span class="by">ergeysay</span><span>|</span><a href="#42270596">parent</a><span>|</span><a href="#42271105">next</a><span>|</span><label class="collapse" for="c-42271329">[-]</label><label class="expand" for="c-42271329">[1 more]</label></div><br/><div class="children"><div class="content">&gt; loops like this are easy for compilers to analyze, in a way that makes them not representative of real code<p>Which makes it a perfectly fine benchmark to measure whether a particular compiler implements these optimisations. The benchmark also highlights fine implementation details. I did not know about Dart&#x27;s interrupt checks, for instance.<p>I see these microbenchmarks as genuinely useful, as I can analyse them, the logic behind them, and apply results in interpreter design. Consider [0] for example. Any sane compiler would do this kind of optimisation, but I&#x27;ve seen only one production interpreter (daScript) doing it.<p>[0] <a href="https:&#x2F;&#x2F;ergeysay.github.io&#x2F;optimising-interpreters-fusion.html" rel="nofollow">https:&#x2F;&#x2F;ergeysay.github.io&#x2F;optimising-interpreters-fusion.ht...</a></div><br/></div></div><div id="42271105" class="c"><input type="checkbox" id="c-42271105" checked=""/><div class="controls bullet"><span class="by">pkolaczk</span><span>|</span><a href="#42270596">parent</a><span>|</span><a href="#42271329">prev</a><span>|</span><a href="#42271697">next</a><span>|</span><label class="collapse" for="c-42271105">[-]</label><label class="expand" for="c-42271105">[1 more]</label></div><br/><div class="children"><div class="content">And what if the runtime does poorly on even such a simple loop? Go is surprisingly slower here than Java and Kotlin.<p>I agree with the author of the blog here - microbenchmarks are just experiments and they can be very useful if you do proper analysis of the results. You can definitely learn something about the runtimes even from such a simple for loop benchmark.</div><br/></div></div><div id="42271697" class="c"><input type="checkbox" id="c-42271697" checked=""/><div class="controls bullet"><span class="by">brabel</span><span>|</span><a href="#42270596">parent</a><span>|</span><a href="#42271105">prev</a><span>|</span><a href="#42271321">next</a><span>|</span><label class="collapse" for="c-42271697">[-]</label><label class="expand" for="c-42271697">[1 more]</label></div><br/><div class="children"><div class="content">&gt; It’s cool to see this kind of analysis, even if it’s analyzing a totally bogus benchmark.<p>Yeah but that bogus benchmark has become viral on social networks, and people are even writing their own shitty &quot;experiments&quot; based on that one.<p>This post is absolutely wonderful in that it doesn&#x27;t shit on the original benchmark too much, while explaining patiently how to do it right. Hopefully, the person who started with the bogus benchmark, as well as people following in his footsteps, will learn something important (I myself have posted benchmarks before - though I believe much higher quality - but failed to properly analyse the results as shown here).<p>Notice that the bogus benchmark ended up catching the attention of a Dart maintainer and looks like they found their compiler was missing some easy optimisations... so it may end up having been helpful for every Dart user in the world!</div><br/></div></div></div></div><div id="42271321" class="c"><input type="checkbox" id="c-42271321" checked=""/><div class="controls bullet"><span class="by">nixpulvis</span><span>|</span><a href="#42270596">prev</a><span>|</span><a href="#42271331">next</a><span>|</span><label class="collapse" for="c-42271321">[-]</label><label class="expand" for="c-42271321">[1 more]</label></div><br/><div class="children"><div class="content">Responding to the title:<p>I&#x27;ve always viewed the act of computer programming as a bunch of experiments or thought experiments. You first build a hypothesis in code, then you evaluate it and analyze the results.<p>I like this because it puts the science in computer science.</div><br/></div></div><div id="42271331" class="c"><input type="checkbox" id="c-42271331" checked=""/><div class="controls bullet"><span class="by">bddicken</span><span>|</span><a href="#42271321">prev</a><span>|</span><label class="collapse" for="c-42271331">[-]</label><label class="expand" for="c-42271331">[1 more]</label></div><br/><div class="children"><div class="content">Tweet OP here: Very good analysis, thanks for sharing.</div><br/></div></div></div></div></div></div></div></body></html>