<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1712826053866" as="style"/><link rel="stylesheet" href="styles.css?v=1712826053866"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.youtube.com/watch?v=bISBNVtXZ6M">Nimble: A new columnar file format by Meta [video]</a> <span class="domain">(<a href="https://www.youtube.com">www.youtube.com</a>)</span></div><div class="subtext"><span>aduffy</span> | <span>28 comments</span></div><br/><div><div id="39995409" class="c"><input type="checkbox" id="c-39995409" checked=""/><div class="controls bullet"><span class="by">CharlesW</span><span>|</span><a href="#39999340">next</a><span>|</span><label class="collapse" for="c-39995409">[-]</label><label class="expand" for="c-39995409">[10 more]</label></div><br/><div class="children"><div class="content">I learned that &quot;Nimble&quot; is the new name for &quot;Alpha&quot;, discussed in this 2023 report: <a href="https:&#x2F;&#x2F;www.cidrdb.org&#x2F;cidr2023&#x2F;papers&#x2F;p77-chattopadhyay.pdf" rel="nofollow">https:&#x2F;&#x2F;www.cidrdb.org&#x2F;cidr2023&#x2F;papers&#x2F;p77-chattopadhyay.pdf</a><p>Here&#x27;s an excerpt that may save some folks a click or three…<p>&gt; <i>&quot;While storing analytical and ML tables together in the data lakehouse is beneficial from a management and integration perspective, it also imposes some unique challenges. For example, it is increasingly common for ML tables to outgrow analytical tables by up to an order of magnitude. ML tables are also typically much wider, and tend to have tens of thousands of features usually stored as large maps.</i><p>&gt; <i>&quot;As we executed on our codec convergence strategy for ORC, it gradually exposed significant weaknesses in the ORC format itself, especially for ML use cases. The most pressing issue with the DWRF format was metadata overhead; our ML use cases needed a very large number of features (typically stored as giant maps), and the DWRF map format, albeit optimized, had too much metadata overhead. Apart from this, DWRF had several other limitations related to encodings and stripe structure, which were very difficult to fix in a backward-compatible way. Therefore, we decided to build a new columnar file format that addresses the needs of the next generation data stack; specifically, one that is targeted from the onset towards ML use cases, but without sacrificing any of the
analytical needs.</i><p>&gt; <i>&quot;The result was a new format we call Alpha. Alpha has several notable characteristics that make it particularly suitable for mixed Analytical nd ML training use cases. It has a custom serialization format for metadata that is significantly faster to decode, especially for very wide tables and deep maps, in addition to more modern compression algorithms. It also provides a richer set of encodings and an adaptive encoding algorithm that can smartly pick the best encoding based on historical data patterns, through an encoding history loopback database. Alpha requires fewer streams per column for many common data types, making read coalescing much easier and saving I&#x2F;Os, especially for HDDs. Alpha was written in modern C++ from scratch in a way that allows it to be extended easily in the future.</i><p>&gt; <i>&quot;Alpha is being deployed in production today for several important ML training applications and showing 2-3x better performance than ORC on decoding, with comparable encoding performance and file size.&quot;</i></div><br/><div id="39995776" class="c"><input type="checkbox" id="c-39995776" checked=""/><div class="controls bullet"><span class="by">0cf8612b2e1e</span><span>|</span><a href="#39995409">parent</a><span>|</span><a href="#39997103">next</a><span>|</span><label class="collapse" for="c-39995776">[-]</label><label class="expand" for="c-39995776">[7 more]</label></div><br/><div class="children"><div class="content">Alpha has got to be one of the worst names I have ever heard for a new product. Did they want to make it impossible to find?</div><br/><div id="39995822" class="c"><input type="checkbox" id="c-39995822" checked=""/><div class="controls bullet"><span class="by">__MatrixMan__</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39995776">parent</a><span>|</span><a href="#39996337">next</a><span>|</span><label class="collapse" for="c-39995822">[-]</label><label class="expand" for="c-39995822">[2 more]</label></div><br/><div class="children"><div class="content">How could a company called Meta be so shortsighted?</div><br/><div id="39996459" class="c"><input type="checkbox" id="c-39996459" checked=""/><div class="controls bullet"><span class="by">santoshalper</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39995822">parent</a><span>|</span><a href="#39996337">next</a><span>|</span><label class="collapse" for="c-39996459">[-]</label><label class="expand" for="c-39996459">[1 more]</label></div><br/><div class="children"><div class="content">Well played.</div><br/></div></div></div></div><div id="39996337" class="c"><input type="checkbox" id="c-39996337" checked=""/><div class="controls bullet"><span class="by">isodev</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39995776">parent</a><span>|</span><a href="#39995822">prev</a><span>|</span><a href="#39996318">next</a><span>|</span><label class="collapse" for="c-39996337">[-]</label><label class="expand" for="c-39996337">[3 more]</label></div><br/><div class="children"><div class="content">Alpha was also the name of the virtual assistant owned by the bad guy in Extrapolations.<p><a href="https:&#x2F;&#x2F;www.imdb.com&#x2F;title&#x2F;tt13821126&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.imdb.com&#x2F;title&#x2F;tt13821126&#x2F;</a></div><br/><div id="39996511" class="c"><input type="checkbox" id="c-39996511" checked=""/><div class="controls bullet"><span class="by">jeffcox</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39996337">parent</a><span>|</span><a href="#39996318">next</a><span>|</span><label class="collapse" for="c-39996511">[-]</label><label class="expand" for="c-39996511">[2 more]</label></div><br/><div class="children"><div class="content">Yes, but before that he was helping Zordon and the Power Rangers.<p><a href="https:&#x2F;&#x2F;www.imdb.com&#x2F;title&#x2F;tt0106064&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.imdb.com&#x2F;title&#x2F;tt0106064&#x2F;</a></div><br/><div id="39996572" class="c"><input type="checkbox" id="c-39996572" checked=""/><div class="controls bullet"><span class="by">isodev</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39996511">parent</a><span>|</span><a href="#39996318">next</a><span>|</span><label class="collapse" for="c-39996572">[-]</label><label class="expand" for="c-39996572">[1 more]</label></div><br/><div class="children"><div class="content">Haha, good times!</div><br/></div></div></div></div></div></div></div></div><div id="39997103" class="c"><input type="checkbox" id="c-39997103" checked=""/><div class="controls bullet"><span class="by">metadat</span><span>|</span><a href="#39995409">parent</a><span>|</span><a href="#39995776">prev</a><span>|</span><a href="#39999340">next</a><span>|</span><label class="collapse" for="c-39997103">[-]</label><label class="expand" for="c-39997103">[2 more]</label></div><br/><div class="children"><div class="content">So Nimble&#x2F;Alpha (which are both seriously terrible names, btw) is basically Parquet++, is that right?<p><i>&gt; Apache Parquet is a column-oriented data storage format.  It provides efficient data compression and encoding schemes with enhanced performance to handle complex data in bulk.</i><p><a href="https:&#x2F;&#x2F;parquet.apache.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;parquet.apache.org&#x2F;</a><p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Apache_Parquet" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Apache_Parquet</a></div><br/><div id="39997416" class="c"><input type="checkbox" id="c-39997416" checked=""/><div class="controls bullet"><span class="by">aduffy</span><span>|</span><a href="#39995409">root</a><span>|</span><a href="#39997103">parent</a><span>|</span><a href="#39999340">next</a><span>|</span><label class="collapse" for="c-39997416">[-]</label><label class="expand" for="c-39997416">[1 more]</label></div><br/><div class="children"><div class="content">It’s really ORC++ as they mention in the video.<p>I have a thread with Andy Pavlo on the salient bits but basically it grew out of ORC modifications<p><a href="https:&#x2F;&#x2F;x.com&#x2F;andreweduffy&#x2F;status&#x2F;1778054712517857458?s=46" rel="nofollow">https:&#x2F;&#x2F;x.com&#x2F;andreweduffy&#x2F;status&#x2F;1778054712517857458?s=46</a></div><br/></div></div></div></div></div></div><div id="39999340" class="c"><input type="checkbox" id="c-39999340" checked=""/><div class="controls bullet"><span class="by">RyanHamilton</span><span>|</span><a href="#39995409">prev</a><span>|</span><a href="#39997294">next</a><span>|</span><label class="collapse" for="c-39999340">[-]</label><label class="expand" for="c-39999340">[1 more]</label></div><br/><div class="children"><div class="content">Parquet + Arrow hopefully seem to be emerging as standards. I would much rather see those standards improved than new formats emerge. Even within those existing formats there has become enough variation than some platforms only support a subset of functionality. That and the performance and size of the libraries is poor.<p>e.g. DuckDB &#x2F; Clickhouse Parquet nanosecond compatibility. <a href="https:&#x2F;&#x2F;github.com&#x2F;duckdb&#x2F;duckdb&#x2F;issues&#x2F;9852">https:&#x2F;&#x2F;github.com&#x2F;duckdb&#x2F;duckdb&#x2F;issues&#x2F;9852</a>
e.g. The arrow SQL driver is 70+MB in java.</div><br/></div></div><div id="39997294" class="c"><input type="checkbox" id="c-39997294" checked=""/><div class="controls bullet"><span class="by">horusporus</span><span>|</span><a href="#39999340">prev</a><span>|</span><a href="#39996789">next</a><span>|</span><label class="collapse" for="c-39997294">[-]</label><label class="expand" for="c-39997294">[1 more]</label></div><br/><div class="children"><div class="content">I was really hoping to see Cap&#x27;N Proto used for the format, since that has fast access without decoding, and reasonable backwards compatibility with old files.  Anyone know why Flatbuffers were used?</div><br/></div></div><div id="39996789" class="c"><input type="checkbox" id="c-39996789" checked=""/><div class="controls bullet"><span class="by">MaximilianEmel</span><span>|</span><a href="#39997294">prev</a><span>|</span><a href="#39996908">next</a><span>|</span><label class="collapse" for="c-39996789">[-]</label><label class="expand" for="c-39996789">[2 more]</label></div><br/><div class="children"><div class="content">Is there a quick description of the structure of it anywhere?</div><br/></div></div><div id="39996908" class="c"><input type="checkbox" id="c-39996908" checked=""/><div class="controls bullet"><span class="by">mrtimo</span><span>|</span><a href="#39996789">prev</a><span>|</span><a href="#39998128">next</a><span>|</span><label class="collapse" for="c-39996908">[-]</label><label class="expand" for="c-39996908">[1 more]</label></div><br/><div class="children"><div class="content">How is this compare with parquet format?</div><br/></div></div><div id="39998128" class="c"><input type="checkbox" id="c-39998128" checked=""/><div class="controls bullet"><span class="by">Kalanos</span><span>|</span><a href="#39996908">prev</a><span>|</span><a href="#39995732">next</a><span>|</span><label class="collapse" for="c-39998128">[-]</label><label class="expand" for="c-39998128">[1 more]</label></div><br/><div class="children"><div class="content">By the time data has been preprocessed for ML, it is numerically encoded as floats, so .npy&#x2F;npz is a good fit and `np.memmap` is an incredible way to seek into ndim data.</div><br/></div></div><div id="39995732" class="c"><input type="checkbox" id="c-39995732" checked=""/><div class="controls bullet"><span class="by">jauntywundrkind</span><span>|</span><a href="#39998128">prev</a><span>|</span><a href="#39995281">next</a><span>|</span><label class="collapse" for="c-39995732">[-]</label><label class="expand" for="c-39995732">[5 more]</label></div><br/><div class="children"><div class="content">There&#x27;s already been some interesting column format optimization work at Meta, as their Velox execution engine team worked with Apache Arrow to align their columnar formats. This talk is actually happening at VeloxCon, so there&#x27;s got to be some awareness! <a href="https:&#x2F;&#x2F;engineering.fb.com&#x2F;2024&#x2F;02&#x2F;20&#x2F;developer-tools&#x2F;velox-apache-arrow-15-composable-data-management&#x2F;" rel="nofollow">https:&#x2F;&#x2F;engineering.fb.com&#x2F;2024&#x2F;02&#x2F;20&#x2F;developer-tools&#x2F;velox-...</a> <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39454763">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=39454763</a><p>I wonder how much if any overlap there is here, and whether it was intentional or accidentally similar. Ah, &quot;return efficient Velox vectors&quot; is on the list, but still seems likely to be some overlap in encoding strategies etc.<p>The four main points seem to be: a) encoding metadata as part of stream rather than fixed metadata, b) nls are just another encoding, c) no stripe footer&#x2F;only stream locations is in footer, d) FlatBuffers! Shout out to FlatBuffers, wasn&#x27;t expecting to see them making a comeback!<p>I do wish there were a lot more diagrams&#x2F;slides. There&#x27;s four bullet points, and Yoav Helfman talks to them, but there&#x27;s not a ton of showing what he&#x27;s talking about.</div><br/><div id="39999417" class="c"><input type="checkbox" id="c-39999417" checked=""/><div class="controls bullet"><span class="by">westurner</span><span>|</span><a href="#39995732">parent</a><span>|</span><a href="#39997672">next</a><span>|</span><label class="collapse" for="c-39999417">[-]</label><label class="expand" for="c-39999417">[1 more]</label></div><br/><div class="children"><div class="content">How do Parquet, Lance, and Nimble compare?<p>lancedb&#x2F;lance: <a href="https:&#x2F;&#x2F;github.com&#x2F;lancedb&#x2F;lance">https:&#x2F;&#x2F;github.com&#x2F;lancedb&#x2F;lance</a> :<p>&gt; <i>Modern columnar data format for ML. Convert from Parquet in 2-lines of code for 100x faster random access, a vector index, data versioning, and more.
Compatible with pandas, DuckDB, Polars, and pyarrow</i><p>Can the optimizations in lance be ported to other formats without significant redesign?</div><br/></div></div><div id="39997672" class="c"><input type="checkbox" id="c-39997672" checked=""/><div class="controls bullet"><span class="by">hiyer</span><span>|</span><a href="#39995732">parent</a><span>|</span><a href="#39999417">prev</a><span>|</span><a href="#39995281">next</a><span>|</span><label class="collapse" for="c-39997672">[-]</label><label class="expand" for="c-39997672">[3 more]</label></div><br/><div class="children"><div class="content">What&#x27;s the future for datafusion (<a href="https:&#x2F;&#x2F;arrow.apache.org&#x2F;datafusion&#x2F;" rel="nofollow">https:&#x2F;&#x2F;arrow.apache.org&#x2F;datafusion&#x2F;</a>) if Arrow is moving towards Velox?</div><br/><div id="39997905" class="c"><input type="checkbox" id="c-39997905" checked=""/><div class="controls bullet"><span class="by">theLiminator</span><span>|</span><a href="#39995732">root</a><span>|</span><a href="#39997672">parent</a><span>|</span><a href="#39995281">next</a><span>|</span><label class="collapse" for="c-39997905">[-]</label><label class="expand" for="c-39997905">[2 more]</label></div><br/><div class="children"><div class="content">What do you mean by Arrow is moving towards Velox? Arrow is a standard for in-memory columnar data? At most arrow might adopt innovations made in Velox into its spec that datafusion will then adopt?</div><br/><div id="39998880" class="c"><input type="checkbox" id="c-39998880" checked=""/><div class="controls bullet"><span class="by">hiyer</span><span>|</span><a href="#39995732">root</a><span>|</span><a href="#39997905">parent</a><span>|</span><a href="#39995281">next</a><span>|</span><label class="collapse" for="c-39998880">[-]</label><label class="expand" for="c-39998880">[1 more]</label></div><br/><div class="children"><div class="content">I meant the Arrow ecosystem. Datafusion is the query processing project therein at present, so I was curious to know what&#x27;s the future for that. As you said, it&#x27;s possible Datafition will adopt some stuff from Velox.</div><br/></div></div></div></div></div></div></div></div><div id="39995281" class="c"><input type="checkbox" id="c-39995281" checked=""/><div class="controls bullet"><span class="by">mempko</span><span>|</span><a href="#39995732">prev</a><span>|</span><a href="#39997052">next</a><span>|</span><label class="collapse" for="c-39995281">[-]</label><label class="expand" for="c-39995281">[2 more]</label></div><br/><div class="children"><div class="content">I would love to see support in Apache Arrow to read this format. Parquet is already supported.</div><br/><div id="39996944" class="c"><input type="checkbox" id="c-39996944" checked=""/><div class="controls bullet"><span class="by">nomel</span><span>|</span><a href="#39995281">parent</a><span>|</span><a href="#39997052">next</a><span>|</span><label class="collapse" for="c-39996944">[-]</label><label class="expand" for="c-39996944">[1 more]</label></div><br/><div class="children"><div class="content">This makes me assume it also doesn&#x27;t have proper support for multidimensional arrays.</div><br/></div></div></div></div><div id="39997052" class="c"><input type="checkbox" id="c-39997052" checked=""/><div class="controls bullet"><span class="by">yigitkonur35</span><span>|</span><a href="#39995281">prev</a><span>|</span><a href="#39995832">next</a><span>|</span><label class="collapse" for="c-39997052">[-]</label><label class="expand" for="c-39997052">[1 more]</label></div><br/><div class="children"><div class="content">Curious about Clickhouse’s approach to this compression structure.</div><br/></div></div><div id="39995832" class="c"><input type="checkbox" id="c-39995832" checked=""/><div class="controls bullet"><span class="by">gigatexal</span><span>|</span><a href="#39997052">prev</a><span>|</span><a href="#39995672">next</a><span>|</span><label class="collapse" for="c-39995832">[-]</label><label class="expand" for="c-39995832">[1 more]</label></div><br/><div class="children"><div class="content">Hmm another conte for in the open table format space. Nice.</div><br/></div></div><div id="39995672" class="c"><input type="checkbox" id="c-39995672" checked=""/><div class="controls bullet"><span class="by">khaledh</span><span>|</span><a href="#39995832">prev</a><span>|</span><label class="collapse" for="c-39995672">[-]</label><label class="expand" for="c-39995672">[2 more]</label></div><br/><div class="children"><div class="content">Fwiw, the name clashes with Nim&#x27;s package manager nimble: <a href="https:&#x2F;&#x2F;github.com&#x2F;nim-lang&#x2F;nimble">https:&#x2F;&#x2F;github.com&#x2F;nim-lang&#x2F;nimble</a></div><br/></div></div></div></div></div></div></div></body></html>