<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1714381266442" as="style"/><link rel="stylesheet" href="styles.css?v=1714381266442"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://github.com/gyf304/dotenv">Show HN: Dotenv, if it is a Unix utility</a> <span class="domain">(<a href="https://github.com">github.com</a>)</span></div><div class="subtext"><span>gyf304</span> | <span>84 comments</span></div><br/><div><div id="40194948" class="c"><input type="checkbox" id="c-40194948" checked=""/><div class="controls bullet"><span class="by">tuyiown</span><span>|</span><a href="#40192111">next</a><span>|</span><label class="collapse" for="c-40194948">[-]</label><label class="expand" for="c-40194948">[6 more]</label></div><br/><div class="children"><div class="content">Please just see this<p>`env -S &quot;$(cat .env)&quot; &lt;cmd&gt;`<p>Believe it or not that’s all you need.<p>&gt; S, --split-string=S
              process and split S into separate arguments; used to pass multiple arguments on shebang lines<p><i>edit: forgot the quotes around shell substitution</i></div><br/><div id="40195460" class="c"><input type="checkbox" id="c-40195460" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#40194948">parent</a><span>|</span><a href="#40195680">next</a><span>|</span><label class="collapse" for="c-40195460">[-]</label><label class="expand" for="c-40195460">[1 more]</label></div><br/><div class="children"><div class="content">Also, if we are going to involve the shell, we could also just make .env a shell fragment and do this:<p><pre><code>   sh -c &#x27;. .env; &lt;cmd&gt;&#x27;
</code></pre>
There is a way to pass commands to it which are reliably executed, like thisL<p><pre><code>   sh -c &#x27;. .env; &quot;$@&quot;&#x27; -- command arg1 arg2 arg3.
</code></pre>
The non-option arguments passed to the shell are available as `&quot;$@&quot;`. A command consisting of nothing but `&quot;$@&quot;` basically executes the arguments. We can use `exec`, speaking of which:<p><pre><code>   sh -c &#x27;. .env; exec &quot;$@&quot;&#x27; -- command arg1 arg2 arg3.
</code></pre>
What I&#x27;m getting at is that this form is fairly easily <i>exec</i>-able;<p><pre><code>   execl(&quot;&#x2F;bin&#x2F;sh&quot;, &quot;&#x2F;bin&#x2F;sh&quot;, &quot;. .env; exec \&quot;$@\&quot;&quot;, &quot;--&quot;, &quot;command&quot;,
         &quot;arg1&quot;, &quot;arg2&quot;, &quot;arg3&quot;, (char *) 0);
</code></pre>
The command and arguments can be arbitrary strings, not subject to any shell mangling.</div><br/></div></div><div id="40195680" class="c"><input type="checkbox" id="c-40195680" checked=""/><div class="controls bullet"><span class="by">ibotty</span><span>|</span><a href="#40194948">parent</a><span>|</span><a href="#40195460">prev</a><span>|</span><a href="#40195413">next</a><span>|</span><label class="collapse" for="c-40195680">[-]</label><label class="expand" for="c-40195680">[1 more]</label></div><br/><div class="children"><div class="content">This will fail with comments.  Of course you can script around that as well (I have done so), but it&#x27;s not bulletproof.  It makes sense to have a dedicated tool for the job.</div><br/></div></div><div id="40195413" class="c"><input type="checkbox" id="c-40195413" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#40194948">parent</a><span>|</span><a href="#40195680">prev</a><span>|</span><a href="#40195840">next</a><span>|</span><label class="collapse" for="c-40195413">[-]</label><label class="expand" for="c-40195413">[1 more]</label></div><br/><div class="children"><div class="content">This is now syntax that requires processing by the shell.<p>The nice thing about utilities like <i>env</i> and <i>dotenv</i> is that they can be easily <i>exec</i>-ed:<p><pre><code>  execl(&quot;&#x2F;usr&#x2F;bin&#x2F;dotenv&quot;, &quot;&#x2F;usr&#x2F;bin&#x2F;dotenv&quot;, &quot;command&quot;, &quot;arg&quot;, (char *) 0);
</code></pre>
-S is a fairly recently added option to the GNU Coreutils env (possibly inspired by BSD?). I have a window to an Ubuntu 18 VM where it&#x27;s not available.<p>You want $(cat .env) quoted, as in &quot;$(cat .env)&quot; so that the content of the file is reliably passed as one argument.<p>-S will split on whitespace; but it respects quoting, so spaces can be protected. Basically .env has to be prepared with the features of -S in mind.  Of which that thing has quite a few: escape sequences like \n, commenting, environment variable substitution.</div><br/></div></div><div id="40195849" class="c"><input type="checkbox" id="c-40195849" checked=""/><div class="controls bullet"><span class="by">tuyiown</span><span>|</span><a href="#40194948">parent</a><span>|</span><a href="#40195840">prev</a><span>|</span><a href="#40192111">next</a><span>|</span><label class="collapse" for="c-40195849">[-]</label><label class="expand" for="c-40195849">[1 more]</label></div><br/><div class="children"><div class="content"><i>edit 2: seems that there are expectation around a complex .env unspecified file format I was totally not aware of, I was just merely trying to share the simplest way I&#x27;ve ever found to store and reuse env vars</i></div><br/></div></div></div></div><div id="40192111" class="c"><input type="checkbox" id="c-40192111" checked=""/><div class="controls bullet"><span class="by">petepete</span><span>|</span><a href="#40194948">prev</a><span>|</span><a href="#40192399">next</a><span>|</span><label class="collapse" for="c-40192111">[-]</label><label class="expand" for="c-40192111">[14 more]</label></div><br/><div class="children"><div class="content">I think direnv already does a good job in this space, and it&#x27;s already available in your package manager.<p><a href="https:&#x2F;&#x2F;direnv.net&#x2F;" rel="nofollow">https:&#x2F;&#x2F;direnv.net&#x2F;</a></div><br/><div id="40192798" class="c"><input type="checkbox" id="c-40192798" checked=""/><div class="controls bullet"><span class="by">reissbaker</span><span>|</span><a href="#40192111">parent</a><span>|</span><a href="#40192340">next</a><span>|</span><label class="collapse" for="c-40192798">[-]</label><label class="expand" for="c-40192798">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think direnv and dotenv are really the same — dotenv manages environment variables for a program, whereas direnv manages environment variables for an interactive shell.<p>As an example of the difference, dotenv is useful for running programs inside Docker containers — which do not inherit your interactive shell&#x27;s environment variables — whereas direnv isn&#x27;t particularly useful there. Ditto for programs run via init systems like systemd or even classic SysV init. On the other hand, direnv is convenient for end-user env var config, since it&#x27;s aware of your shell&#x27;s working directory and updates the env vars based on it without needing to run extra commands.</div><br/></div></div><div id="40192340" class="c"><input type="checkbox" id="c-40192340" checked=""/><div class="controls bullet"><span class="by">kelnos</span><span>|</span><a href="#40192111">parent</a><span>|</span><a href="#40192798">prev</a><span>|</span><a href="#40195254">next</a><span>|</span><label class="collapse" for="c-40192340">[-]</label><label class="expand" for="c-40192340">[10 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve used direnv, but I think a nice property of OP&#x27;s dotenv is that it&#x27;s explicit: if I want to pass env vars, I run my program under it.  If I don&#x27;t, then I don&#x27;t.  There&#x27;s no &quot;hidden behavior&quot; for me to forget about and then get surprised by.</div><br/><div id="40192678" class="c"><input type="checkbox" id="c-40192678" checked=""/><div class="controls bullet"><span class="by">TheRoque</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40192340">parent</a><span>|</span><a href="#40195254">next</a><span>|</span><label class="collapse" for="c-40192678">[-]</label><label class="expand" for="c-40192678">[9 more]</label></div><br/><div class="children"><div class="content">As far as I&#x27;m aware of, Direnv&#x27;s behavior is not hidden at all. Whenever you cd into the directory, you get a message listing all the new en var activated. And when you change the .envrc, you get another message saying that direnv has been deactivated. I never had happen to me &quot;oh shoot !! I forgot this env var was activated because I&#x27;m in this dir&quot;.</div><br/><div id="40193799" class="c"><input type="checkbox" id="c-40193799" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40192678">parent</a><span>|</span><a href="#40194351">next</a><span>|</span><label class="collapse" for="c-40193799">[-]</label><label class="expand" for="c-40193799">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think &quot;hidden&quot; and &quot;explicit&quot; are true antonyms.<p>From your description, direnv is implicit and noisy, whereas dotenv seems to be (unless you embed it in a script) explicit and quiet.</div><br/></div></div><div id="40194351" class="c"><input type="checkbox" id="c-40194351" checked=""/><div class="controls bullet"><span class="by">cortesoft</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40192678">parent</a><span>|</span><a href="#40193799">prev</a><span>|</span><a href="#40193003">next</a><span>|</span><label class="collapse" for="c-40194351">[-]</label><label class="expand" for="c-40194351">[6 more]</label></div><br/><div class="children"><div class="content">What happens when, 30 commands later, you execute a command in your shell and didn&#x27;t remember that message from a day or so ago?</div><br/><div id="40194532" class="c"><input type="checkbox" id="c-40194532" checked=""/><div class="controls bullet"><span class="by">kreetx</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40194351">parent</a><span>|</span><a href="#40194434">next</a><span>|</span><label class="collapse" for="c-40194532">[-]</label><label class="expand" for="c-40194532">[3 more]</label></div><br/><div class="children"><div class="content">Of you&#x27;re in the directory, don&#x27;t you want the env to be loaded? For me, being able to forget it is one of the features.</div><br/><div id="40195323" class="c"><input type="checkbox" id="c-40195323" checked=""/><div class="controls bullet"><span class="by">steezeburger</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40194532">parent</a><span>|</span><a href="#40194434">next</a><span>|</span><label class="collapse" for="c-40195323">[-]</label><label class="expand" for="c-40195323">[2 more]</label></div><br/><div class="children"><div class="content">Not always. I can think of a scenario where I have an env I need to load for some infrastructure stuff, and I may call some commands in a directory that has another .env that&#x27;s part of what I&#x27;m trying to deploy. Generally this scenario is short lived as I&#x27;m quickly moving infra commands to automated ci&#x2F;cd, but I&#x27;ve definitely been in this scenario more than once.</div><br/><div id="40195618" class="c"><input type="checkbox" id="c-40195618" checked=""/><div class="controls bullet"><span class="by">kreetx</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40195323">parent</a><span>|</span><a href="#40194434">next</a><span>|</span><label class="collapse" for="c-40195618">[-]</label><label class="expand" for="c-40195618">[1 more]</label></div><br/><div class="children"><div class="content">Got it! I think nested envs become confusing really quickly, so there it is indeed better to do it explicitly.<p>My assumption overall in this is that most people have just one .env per project (or perhaps in sub-folders per environment, e.g prod, staging, local), but these don&#x27;t nest. With nested .env files, the mental overhead they bring remove (IMO) most of the benefits, if not more.</div><br/></div></div></div></div></div></div><div id="40194434" class="c"><input type="checkbox" id="c-40194434" checked=""/><div class="controls bullet"><span class="by">malicka</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40194351">parent</a><span>|</span><a href="#40194532">prev</a><span>|</span><a href="#40193003">next</a><span>|</span><label class="collapse" for="c-40194434">[-]</label><label class="expand" for="c-40194434">[2 more]</label></div><br/><div class="children"><div class="content">It’s the same as forgetting you put something in your .profile or .bashrc, no?
In any case, both forgetting the env config and using the same shell for days in a row seem like two things that probably don’t coincide too often.</div><br/><div id="40195224" class="c"><input type="checkbox" id="c-40195224" checked=""/><div class="controls bullet"><span class="by">jeffhuys</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40194434">parent</a><span>|</span><a href="#40193003">next</a><span>|</span><label class="collapse" for="c-40195224">[-]</label><label class="expand" for="c-40195224">[1 more]</label></div><br/><div class="children"><div class="content">I never close my shell, I never reboot my laptop unless necessary - an uptime of 6+ months is normal. So my experience may be different.</div><br/></div></div></div></div></div></div><div id="40193003" class="c"><input type="checkbox" id="c-40193003" checked=""/><div class="controls bullet"><span class="by">3836293648</span><span>|</span><a href="#40192111">root</a><span>|</span><a href="#40192678">parent</a><span>|</span><a href="#40194351">prev</a><span>|</span><a href="#40195254">next</a><span>|</span><label class="collapse" for="c-40193003">[-]</label><label class="expand" for="c-40193003">[1 more]</label></div><br/><div class="children"><div class="content">Oh yeah, that&#x27;s the default. Everyone I know im ediately disabled that and I even forgot about it till now</div><br/></div></div></div></div></div></div><div id="40195254" class="c"><input type="checkbox" id="c-40195254" checked=""/><div class="controls bullet"><span class="by">toastal</span><span>|</span><a href="#40192111">parent</a><span>|</span><a href="#40192340">prev</a><span>|</span><a href="#40193755">next</a><span>|</span><label class="collapse" for="c-40195254">[-]</label><label class="expand" for="c-40195254">[1 more]</label></div><br/><div class="children"><div class="content">…Just don’t commit your .envrc to a repository &amp; add it to the .(git|hg)*ignore. Provide an example if you want, but don’t expect everyone to want to use your exact settings. This is for your personal environment.</div><br/></div></div><div id="40193755" class="c"><input type="checkbox" id="c-40193755" checked=""/><div class="controls bullet"><span class="by">hk1337</span><span>|</span><a href="#40192111">parent</a><span>|</span><a href="#40195254">prev</a><span>|</span><a href="#40192399">next</a><span>|</span><label class="collapse" for="c-40193755">[-]</label><label class="expand" for="c-40193755">[1 more]</label></div><br/><div class="children"><div class="content">I know ohmyzsh and zsh has this covered for auto loading the .env when you enter the directory</div><br/></div></div></div></div><div id="40192399" class="c"><input type="checkbox" id="c-40192399" checked=""/><div class="controls bullet"><span class="by">grounder</span><span>|</span><a href="#40192111">prev</a><span>|</span><a href="#40195825">next</a><span>|</span><label class="collapse" for="c-40192399">[-]</label><label class="expand" for="c-40192399">[1 more]</label></div><br/><div class="children"><div class="content">Compare with dotenvx - <a href="https:&#x2F;&#x2F;github.com&#x2F;dotenvx&#x2F;dotenvx">https:&#x2F;&#x2F;github.com&#x2F;dotenvx&#x2F;dotenvx</a>
This is my current tool of choice.</div><br/></div></div><div id="40195825" class="c"><input type="checkbox" id="c-40195825" checked=""/><div class="controls bullet"><span class="by">wodenokoto</span><span>|</span><a href="#40192399">prev</a><span>|</span><a href="#40192130">next</a><span>|</span><label class="collapse" for="c-40195825">[-]</label><label class="expand" for="c-40195825">[1 more]</label></div><br/><div class="children"><div class="content">Since loading dotenv files happens together with executing code I  I have decided to trust my .env files just like I trust the rest of my code not to delete my entire system and therefore I source them.</div><br/></div></div><div id="40192130" class="c"><input type="checkbox" id="c-40192130" checked=""/><div class="controls bullet"><span class="by">tester457</span><span>|</span><a href="#40195825">prev</a><span>|</span><a href="#40192258">next</a><span>|</span><label class="collapse" for="c-40192130">[-]</label><label class="expand" for="c-40192130">[1 more]</label></div><br/><div class="children"><div class="content">dotenv started as a ruby library actually. The first implementation inspired the others such as the golang version of the library.</div><br/></div></div><div id="40192258" class="c"><input type="checkbox" id="c-40192258" checked=""/><div class="controls bullet"><span class="by">miohtama</span><span>|</span><a href="#40192130">prev</a><span>|</span><a href="#40192333">next</a><span>|</span><label class="collapse" for="c-40192258">[-]</label><label class="expand" for="c-40192258">[3 more]</label></div><br/><div class="children"><div class="content">There is also shdotenv that allows you to load different .env file formats and convert between them, e.g. for UNIX shell.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;ko1nksm&#x2F;shdotenv">https:&#x2F;&#x2F;github.com&#x2F;ko1nksm&#x2F;shdotenv</a></div><br/><div id="40195322" class="c"><input type="checkbox" id="c-40195322" checked=""/><div class="controls bullet"><span class="by">sirwitti</span><span>|</span><a href="#40192258">parent</a><span>|</span><a href="#40193158">next</a><span>|</span><label class="collapse" for="c-40195322">[-]</label><label class="expand" for="c-40195322">[1 more]</label></div><br/><div class="children"><div class="content">I recently discovered shdotenv and I like it a lot!</div><br/></div></div><div id="40193158" class="c"><input type="checkbox" id="c-40193158" checked=""/><div class="controls bullet"><span class="by">gyf304</span><span>|</span><a href="#40192258">parent</a><span>|</span><a href="#40195322">prev</a><span>|</span><a href="#40192333">next</a><span>|</span><label class="collapse" for="c-40193158">[-]</label><label class="expand" for="c-40193158">[1 more]</label></div><br/><div class="children"><div class="content">This is a very neat project that seems to accomplish the same goal and have some extra features.</div><br/></div></div></div></div><div id="40192333" class="c"><input type="checkbox" id="c-40192333" checked=""/><div class="controls bullet"><span class="by">mongol</span><span>|</span><a href="#40192258">prev</a><span>|</span><a href="#40194070">next</a><span>|</span><label class="collapse" for="c-40192333">[-]</label><label class="expand" for="c-40192333">[9 more]</label></div><br/><div class="children"><div class="content">Would not<p>sh -c &#x27;. .env; echo $MY_VAR&#x27;<p>do the same thing? (I am not in front of a shell at the moment.)</div><br/><div id="40193444" class="c"><input type="checkbox" id="c-40193444" checked=""/><div class="controls bullet"><span class="by">emmanueloga_</span><span>|</span><a href="#40192333">parent</a><span>|</span><a href="#40192375">next</a><span>|</span><label class="collapse" for="c-40193444">[-]</label><label class="expand" for="c-40193444">[3 more]</label></div><br/><div class="children"><div class="content">There are like a couple dozen different ways to do this...<p>I have this on my .bashrc:<p><pre><code>    alias loadenv=&#x27;export $(xargs &lt;.env)&#x27;
</code></pre>
source: [1]<p>--<p>1: <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;60406814&#x2F;855105" rel="nofollow">https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;60406814&#x2F;855105</a></div><br/><div id="40193644" class="c"><input type="checkbox" id="c-40193644" checked=""/><div class="controls bullet"><span class="by">geysersam</span><span>|</span><a href="#40192333">root</a><span>|</span><a href="#40193444">parent</a><span>|</span><a href="#40195101">next</a><span>|</span><label class="collapse" for="c-40193644">[-]</label><label class="expand" for="c-40193644">[1 more]</label></div><br/><div class="children"><div class="content">Very nice! Thanks for the suggestion. Seems more Unix-esque. Are there any important drawbacks of this version compared to the dedicated tool? (dotenv or dotenvx)</div><br/></div></div><div id="40195101" class="c"><input type="checkbox" id="c-40195101" checked=""/><div class="controls bullet"><span class="by">kilroy123</span><span>|</span><a href="#40192333">root</a><span>|</span><a href="#40193444">parent</a><span>|</span><a href="#40193644">prev</a><span>|</span><a href="#40192375">next</a><span>|</span><label class="collapse" for="c-40195101">[-]</label><label class="expand" for="c-40195101">[1 more]</label></div><br/><div class="children"><div class="content">I can&#x27;t believe I&#x27;ve never thought of doing this until now.</div><br/></div></div></div></div><div id="40192375" class="c"><input type="checkbox" id="c-40192375" checked=""/><div class="controls bullet"><span class="by">iokanuon</span><span>|</span><a href="#40192333">parent</a><span>|</span><a href="#40193444">prev</a><span>|</span><a href="#40192372">next</a><span>|</span><label class="collapse" for="c-40192375">[-]</label><label class="expand" for="c-40192375">[1 more]</label></div><br/><div class="children"><div class="content">You&#x27;d need to `set -a` or pass the `-a` as a flag to have them auto-exported though, so:<p><pre><code>    sh -ac &#x27;. .&#x2F;.env; .&#x2F;prog&#x27;
</code></pre>
Also if you use the `.` builtin it&#x27;s a good idea to specify the path with a slash in it, so that `.` doesn&#x27;t search $PATH first.</div><br/></div></div><div id="40192372" class="c"><input type="checkbox" id="c-40192372" checked=""/><div class="controls bullet"><span class="by">kelnos</span><span>|</span><a href="#40192333">parent</a><span>|</span><a href="#40192375">prev</a><span>|</span><a href="#40192810">next</a><span>|</span><label class="collapse" for="c-40192372">[-]</label><label class="expand" for="c-40192372">[2 more]</label></div><br/><div class="children"><div class="content">That would, but unless each line in your .env file is prefixed with &quot;export&quot;, those env vars won&#x27;t get passed into any subprocesses you run.</div><br/></div></div><div id="40192810" class="c"><input type="checkbox" id="c-40192810" checked=""/><div class="controls bullet"><span class="by">datascienced</span><span>|</span><a href="#40192333">parent</a><span>|</span><a href="#40192372">prev</a><span>|</span><a href="#40192354">next</a><span>|</span><label class="collapse" for="c-40192810">[-]</label><label class="expand" for="c-40192810">[1 more]</label></div><br/><div class="children"><div class="content">Now that is unixy!</div><br/></div></div><div id="40192354" class="c"><input type="checkbox" id="c-40192354" checked=""/><div class="controls bullet"><span class="by">mixmastamyk</span><span>|</span><a href="#40192333">parent</a><span>|</span><a href="#40192810">prev</a><span>|</span><a href="#40194070">next</a><span>|</span><label class="collapse" for="c-40192354">[-]</label><label class="expand" for="c-40192354">[1 more]</label></div><br/><div class="children"><div class="content">Seems to work.</div><br/></div></div></div></div><div id="40194070" class="c"><input type="checkbox" id="c-40194070" checked=""/><div class="controls bullet"><span class="by">vishvananda</span><span>|</span><a href="#40192333">prev</a><span>|</span><a href="#40195205">next</a><span>|</span><label class="collapse" for="c-40194070">[-]</label><label class="expand" for="c-40194070">[1 more]</label></div><br/><div class="children"><div class="content">Doesn’t this already exist as <a href="https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;dotenv-cli" rel="nofollow">https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;dotenv-cli</a> ?</div><br/></div></div><div id="40195205" class="c"><input type="checkbox" id="c-40195205" checked=""/><div class="controls bullet"><span class="by">fire_lake</span><span>|</span><a href="#40194070">prev</a><span>|</span><a href="#40195295">next</a><span>|</span><label class="collapse" for="c-40195205">[-]</label><label class="expand" for="c-40195205">[1 more]</label></div><br/><div class="children"><div class="content">Does this accept the exact same format (including quotes and whitespace) as a Docker env file? That’s a key feature for me</div><br/></div></div><div id="40195295" class="c"><input type="checkbox" id="c-40195295" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#40195205">prev</a><span>|</span><a href="#40193634">next</a><span>|</span><label class="collapse" for="c-40195295">[-]</label><label class="expand" for="c-40195295">[4 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand what more it does than sourcing a file on your shell would? Anyone can explain?</div><br/><div id="40195336" class="c"><input type="checkbox" id="c-40195336" checked=""/><div class="controls bullet"><span class="by">steezeburger</span><span>|</span><a href="#40195295">parent</a><span>|</span><a href="#40193634">next</a><span>|</span><label class="collapse" for="c-40195336">[-]</label><label class="expand" for="c-40195336">[3 more]</label></div><br/><div class="children"><div class="content">You can&#x27;t source an .env file without some munging. All the keys would need `export` in front of them I believe.</div><br/><div id="40195774" class="c"><input type="checkbox" id="c-40195774" checked=""/><div class="controls bullet"><span class="by">prmoustache</span><span>|</span><a href="#40195295">root</a><span>|</span><a href="#40195336">parent</a><span>|</span><a href="#40195467">next</a><span>|</span><label class="collapse" for="c-40195774">[-]</label><label class="expand" for="c-40195774">[1 more]</label></div><br/><div class="children"><div class="content">That doesn&#x27;t seem like a huge barrier compared to shipping a dotenv binary compiled specifically to all deployment arch.</div><br/></div></div><div id="40195467" class="c"><input type="checkbox" id="c-40195467" checked=""/><div class="controls bullet"><span class="by">kazinator</span><span>|</span><a href="#40195295">root</a><span>|</span><a href="#40195336">parent</a><span>|</span><a href="#40195774">prev</a><span>|</span><a href="#40193634">next</a><span>|</span><label class="collapse" for="c-40195467">[-]</label><label class="expand" for="c-40195467">[1 more]</label></div><br/><div class="children"><div class="content">A sourced .env would have to be correct shell syntax for a sourced environment file, yes.</div><br/></div></div></div></div></div></div><div id="40193634" class="c"><input type="checkbox" id="c-40193634" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#40195295">prev</a><span>|</span><a href="#40193860">next</a><span>|</span><label class="collapse" for="c-40193634">[-]</label><label class="expand" for="c-40193634">[18 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    export $(cat .env | xargs)
</code></pre>
Agree with the premise but this can be achieved with actual Unix concepts no need for anything else.<p>The language runtime dotenv projects are banned in my engineering org.</div><br/><div id="40193815" class="c"><input type="checkbox" id="c-40193815" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#40193634">parent</a><span>|</span><a href="#40195202">next</a><span>|</span><label class="collapse" for="c-40193815">[-]</label><label class="expand" for="c-40193815">[10 more]</label></div><br/><div class="children"><div class="content">Your example has the downside of making the environment variables sticky, however, so it&#x27;s not achieving the same thing.</div><br/><div id="40193962" class="c"><input type="checkbox" id="c-40193962" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193815">parent</a><span>|</span><a href="#40195202">next</a><span>|</span><label class="collapse" for="c-40193962">[-]</label><label class="expand" for="c-40193962">[9 more]</label></div><br/><div class="children"><div class="content">That is kinda the purpose of an environment.</div><br/><div id="40193982" class="c"><input type="checkbox" id="c-40193982" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193962">parent</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40193982">[-]</label><label class="expand" for="c-40193982">[7 more]</label></div><br/><div class="children"><div class="content">I jump around between multiple projects every day. Sticky environment variables carry risk.</div><br/><div id="40194015" class="c"><input type="checkbox" id="c-40194015" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193982">parent</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40194015">[-]</label><label class="expand" for="c-40194015">[6 more]</label></div><br/><div class="children"><div class="content">I would suggest using a tool like tmux to partition those projects entirely. Instead of tearing down env and building it back up to switch projects, just re-attach to that tmux session. I treat this stuff as though it’s immutable and try to consciously avoid cross pollination.</div><br/><div id="40194034" class="c"><input type="checkbox" id="c-40194034" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40194015">parent</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40194034">[-]</label><label class="expand" for="c-40194034">[5 more]</label></div><br/><div class="children"><div class="content">That’s reasonable, but my point stands: your original proposal is insufficient to be treated as equivalent.</div><br/><div id="40194381" class="c"><input type="checkbox" id="c-40194381" checked=""/><div class="controls bullet"><span class="by">colimbarna</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40194034">parent</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40194381">[-]</label><label class="expand" for="c-40194381">[4 more]</label></div><br/><div class="children"><div class="content"><p><pre><code>    env $(cat .env) my-cmd-wanting-dotenv
</code></pre>
would, though, wouldn&#x27;t it?<p>ETA: the main difference between `env` and `dotenv` seems to be that `env` gets its arguments from the command line, whereas `dotenv` gets its arguments from a file. I think that&#x27;s a fair difference, but I might also think that perhaps `env` should expand its offering to include some kind of `-f filename` option so that it can focus on the notion of &quot;a configurable sub-environment for a command&quot;  and we can avoid subtle distinctions.</div><br/><div id="40194504" class="c"><input type="checkbox" id="c-40194504" checked=""/><div class="controls bullet"><span class="by">colimbarna</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40194381">parent</a><span>|</span><a href="#40194493">next</a><span>|</span><label class="collapse" for="c-40194504">[-]</label><label class="expand" for="c-40194504">[1 more]</label></div><br/><div class="children"><div class="content">Further addition, I haven&#x27;t investigated dotenv deeply, but I suppose it would be a command that specialises in making sure the contents of .env are just environmental variables that get defined. The `env` command as I wrote it is probably not the sort of thing you want to just trust on a file in a git repo shared with colleagues. Anyway, like my ETA above suggests I&#x27;m in two minds about whether env and dotenv should be the same thing with different arguments or not.</div><br/></div></div><div id="40194493" class="c"><input type="checkbox" id="c-40194493" checked=""/><div class="controls bullet"><span class="by">malicka</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40194381">parent</a><span>|</span><a href="#40194504">prev</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40194493">[-]</label><label class="expand" for="c-40194493">[2 more]</label></div><br/><div class="children"><div class="content">Several people, including you, are proposing using env rather than sourcing; is that somehow preferable to something like this?<p><pre><code>    (. .env; my-cmd)</code></pre></div><br/><div id="40194576" class="c"><input type="checkbox" id="c-40194576" checked=""/><div class="controls bullet"><span class="by">colimbarna</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40194493">parent</a><span>|</span><a href="#40194238">next</a><span>|</span><label class="collapse" for="c-40194576">[-]</label><label class="expand" for="c-40194576">[1 more]</label></div><br/><div class="children"><div class="content">See my comment sibling to yours for some concerns with `env $(cat file)`; I would have these and then some with sourcing the file even in a subshell. You can do whatever you want in a shell script which can have effects outside of the subshell.<p>Another advantage of env is that you can type `man env` and learn something useful; sourcing and subshells via syntax is a little bit harder.<p>Finally, I think the major point of this branch of the discussion is to explicitly decorate a command with a special environment. Starting up a subshell isn&#x27;t the same thing. It might have the same effect, but you can see that you&#x27;re creating a subshell, running a builtin in the subshell, and then running a command in the subshell. It is something of a difference between declarative (dotenv&#x2F;env) and imperative (sourcing in a subshell) approaches, and inherits all the pros and cons of the imperative approach.<p>If it works for you, I make no recommendation against it.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="40194238" class="c"><input type="checkbox" id="c-40194238" checked=""/><div class="controls bullet"><span class="by">GolDDranks</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193962">parent</a><span>|</span><a href="#40193982">prev</a><span>|</span><a href="#40195202">next</a><span>|</span><label class="collapse" for="c-40194238">[-]</label><label class="expand" for="c-40194238">[1 more]</label></div><br/><div class="children"><div class="content">Not really, if we are just talking about the &quot;run environment&quot; of a single binary.</div><br/></div></div></div></div></div></div><div id="40195202" class="c"><input type="checkbox" id="c-40195202" checked=""/><div class="controls bullet"><span class="by">fire_lake</span><span>|</span><a href="#40193634">parent</a><span>|</span><a href="#40193815">prev</a><span>|</span><a href="#40193993">next</a><span>|</span><label class="collapse" for="c-40195202">[-]</label><label class="expand" for="c-40195202">[1 more]</label></div><br/><div class="children"><div class="content">When your environment variable values have spaces (e.g. some connection strings) this doesn’t work iirc</div><br/></div></div><div id="40193993" class="c"><input type="checkbox" id="c-40193993" checked=""/><div class="controls bullet"><span class="by">bentinata</span><span>|</span><a href="#40193634">parent</a><span>|</span><a href="#40195202">prev</a><span>|</span><a href="#40193713">next</a><span>|</span><label class="collapse" for="c-40193993">[-]</label><label class="expand" for="c-40193993">[2 more]</label></div><br/><div class="children"><div class="content">What about:<p><pre><code>    env $(cat .env) [program]</code></pre></div><br/><div id="40194241" class="c"><input type="checkbox" id="c-40194241" checked=""/><div class="controls bullet"><span class="by">arjvik</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193993">parent</a><span>|</span><a href="#40193713">next</a><span>|</span><label class="collapse" for="c-40194241">[-]</label><label class="expand" for="c-40194241">[1 more]</label></div><br/><div class="children"><div class="content">Has whitespace handling issues... but valiant effort!</div><br/></div></div></div></div><div id="40193713" class="c"><input type="checkbox" id="c-40193713" checked=""/><div class="controls bullet"><span class="by">netcraft</span><span>|</span><a href="#40193634">parent</a><span>|</span><a href="#40193993">prev</a><span>|</span><a href="#40193860">next</a><span>|</span><label class="collapse" for="c-40193713">[-]</label><label class="expand" for="c-40193713">[4 more]</label></div><br/><div class="children"><div class="content">I tend to agree, and we do this a lot actually. But it gets a little more complicated if you have several .env files.<p>Would love to hear more about why dotenv is banned at your org though.</div><br/><div id="40193728" class="c"><input type="checkbox" id="c-40193728" checked=""/><div class="controls bullet"><span class="by">whalesalad</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193713">parent</a><span>|</span><a href="#40193860">next</a><span>|</span><label class="collapse" for="c-40193728">[-]</label><label class="expand" for="c-40193728">[3 more]</label></div><br/><div class="children"><div class="content">Because I banned it haha. There should not be more than one .env file. Our projects have a .env.example that has any overrides a dev might want to override but this list is kept intentionally very short. Meanwhile .env is noted in gitignore. I absolutely hate seeing an entire application configured with environment variables. Some? Sure, where it makes sense. Most? No, those should be in version control, secrets aside.<p>I believe in convention over configuration. Most of our apps have hard-coded config, with a concise&#x2F;short and finite number of things that can be overridden (like 3-4 parameters, tops). Secrets get injected.<p>I do subscribe to the idea of the 12 factor app, but there is a line that needs to be drawn between env config which is more dynamic and more persistent config that should be baked in to the release.</div><br/><div id="40195313" class="c"><input type="checkbox" id="c-40195313" checked=""/><div class="controls bullet"><span class="by">silversmith</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193728">parent</a><span>|</span><a href="#40194901">next</a><span>|</span><label class="collapse" for="c-40195313">[-]</label><label class="expand" for="c-40195313">[1 more]</label></div><br/><div class="children"><div class="content">But then the problem is changing configs means building a new release, and needs code push access. Pretty much every config variable has env override in my apps - allows project owner to poke about in web UI without bothering me for changes.</div><br/></div></div><div id="40194901" class="c"><input type="checkbox" id="c-40194901" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#40193634">root</a><span>|</span><a href="#40193728">parent</a><span>|</span><a href="#40195313">prev</a><span>|</span><a href="#40193860">next</a><span>|</span><label class="collapse" for="c-40194901">[-]</label><label class="expand" for="c-40194901">[1 more]</label></div><br/><div class="children"><div class="content">To add to that, SOME_SECRET env vars should be banned (or at least overridable) in favor of SOME_SECRET_FILE env vars. I usually just put an example of the env vars into the readme or link to the file in the source code handling that directly.</div><br/></div></div></div></div></div></div></div></div><div id="40193860" class="c"><input type="checkbox" id="c-40193860" checked=""/><div class="controls bullet"><span class="by">supriyo-biswas</span><span>|</span><a href="#40193634">prev</a><span>|</span><a href="#40192137">next</a><span>|</span><label class="collapse" for="c-40193860">[-]</label><label class="expand" for="c-40193860">[1 more]</label></div><br/><div class="children"><div class="content">I wrote my own some time ago: <a href="https:&#x2F;&#x2F;github.com&#x2F;supriyo-biswas&#x2F;dotfiles&#x2F;commit&#x2F;39585b42c24ae2d18112d142cf6081354eb29c77">https:&#x2F;&#x2F;github.com&#x2F;supriyo-biswas&#x2F;dotfiles&#x2F;commit&#x2F;39585b42c2...</a></div><br/></div></div><div id="40193967" class="c"><input type="checkbox" id="c-40193967" checked=""/><div class="controls bullet"><span class="by">KevinMS</span><span>|</span><a href="#40192137">prev</a><span>|</span><a href="#40193012">next</a><span>|</span><label class="collapse" for="c-40193967">[-]</label><label class="expand" for="c-40193967">[1 more]</label></div><br/><div class="children"><div class="content">I never understood why it had to be a dot file, except for naming it.</div><br/></div></div><div id="40193012" class="c"><input type="checkbox" id="c-40193012" checked=""/><div class="controls bullet"><span class="by">kzrdude</span><span>|</span><a href="#40193967">prev</a><span>|</span><a href="#40194932">next</a><span>|</span><label class="collapse" for="c-40193012">[-]</label><label class="expand" for="c-40193012">[7 more]</label></div><br/><div class="children"><div class="content">This idea seems to be cloned everywhere now, so something is causing the popularity</div><br/><div id="40193313" class="c"><input type="checkbox" id="c-40193313" checked=""/><div class="controls bullet"><span class="by">fyrn_</span><span>|</span><a href="#40193012">parent</a><span>|</span><a href="#40194932">next</a><span>|</span><label class="collapse" for="c-40193313">[-]</label><label class="expand" for="c-40193313">[6 more]</label></div><br/><div class="children"><div class="content">Kubernetes &#x2F; containderd &#x2F; docker apps are much more convenient to configure through ENV vars, as they easily pass through the sandbox layer (whatever that may be) files are not so easy to make work.
Because that&#x27;s how prod works devs want to be able to recreate prod to run locally, hence the cambrian explosion of tools like this.</div><br/><div id="40194267" class="c"><input type="checkbox" id="c-40194267" checked=""/><div class="controls bullet"><span class="by">forrestthewoods</span><span>|</span><a href="#40193012">root</a><span>|</span><a href="#40193313">parent</a><span>|</span><a href="#40193765">next</a><span>|</span><label class="collapse" for="c-40194267">[-]</label><label class="expand" for="c-40194267">[4 more]</label></div><br/><div class="children"><div class="content">What a tragic state of affairs.<p>It&#x27;s a shame that running modern software requires carefully packaging a virtual environment and then injecting a bunch of ugly global env vars.<p>I still think Docker shouldn&#x27;t exist. Programs should simply bundle their dependencies. Running a program should be as simple as download, unzip, run. No complex hierarchical container management needed.<p>Alas I am not King.</div><br/><div id="40195998" class="c"><input type="checkbox" id="c-40195998" checked=""/><div class="controls bullet"><span class="by">bandie91</span><span>|</span><a href="#40193012">root</a><span>|</span><a href="#40194267">parent</a><span>|</span><a href="#40195021">next</a><span>|</span><label class="collapse" for="c-40195998">[-]</label><label class="expand" for="c-40195998">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Programs should simply bundle their dependencies.<p>awww. i don&#x27;t think it&#x27;s OK in any way to download libc6&#x2F;msvcrt as many times as I download __any__ software. even more, is there a strong difference between dependency and runtime environment? if sensible people does not bundle the whole python distribution to a &quot;stuff.py&quot; then why bundle libopenssl.so to a webserver application?<p>IMO, a saner approach would be just not to confuse dependencies: appX depends on libY 1.9; appZ depends on libY 2.0; people are quick to declare that appX and appZ are incompatibe as they can not run on the same system due to &quot;conflicting dependencies&quot;. but who said you have to seach libY in &#x2F;usr&#x2F;lib*&#x2F;libY.so? if you need different versions of a lib, just install them in separate dirs and make your apps find the right one (eg. by setting RPATH or versioned .so filenames).</div><br/></div></div><div id="40195021" class="c"><input type="checkbox" id="c-40195021" checked=""/><div class="controls bullet"><span class="by">imtringued</span><span>|</span><a href="#40193012">root</a><span>|</span><a href="#40194267">parent</a><span>|</span><a href="#40195998">prev</a><span>|</span><a href="#40193765">next</a><span>|</span><label class="collapse" for="c-40195021">[-]</label><label class="expand" for="c-40195021">[2 more]</label></div><br/><div class="children"><div class="content">Docker is &quot;programs bundling their dependencies&quot;.</div><br/><div id="40195293" class="c"><input type="checkbox" id="c-40195293" checked=""/><div class="controls bullet"><span class="by">forrestthewoods</span><span>|</span><a href="#40193012">root</a><span>|</span><a href="#40195021">parent</a><span>|</span><a href="#40193765">next</a><span>|</span><label class="collapse" for="c-40195293">[-]</label><label class="expand" for="c-40195293">[1 more]</label></div><br/><div class="children"><div class="content">In an extremely heavyweight and needlessly convoluted way.</div><br/></div></div></div></div></div></div></div></div></div></div><div id="40194932" class="c"><input type="checkbox" id="c-40194932" checked=""/><div class="controls bullet"><span class="by">bitwize</span><span>|</span><a href="#40193012">prev</a><span>|</span><a href="#40192814">next</a><span>|</span><label class="collapse" for="c-40194932">[-]</label><label class="expand" for="c-40194932">[3 more]</label></div><br/><div class="children"><div class="content">C? Y u no Rust?</div><br/><div id="40195106" class="c"><input type="checkbox" id="c-40195106" checked=""/><div class="controls bullet"><span class="by">masklinn</span><span>|</span><a href="#40194932">parent</a><span>|</span><a href="#40192814">next</a><span>|</span><label class="collapse" for="c-40195106">[-]</label><label class="expand" for="c-40195106">[2 more]</label></div><br/><div class="children"><div class="content">The same thing already exists in Rust, it’s both a library for in-process loading and a binary, I use it daily and only for the binary: <a href="https:&#x2F;&#x2F;github.com&#x2F;allan2&#x2F;dotenvy">https:&#x2F;&#x2F;github.com&#x2F;allan2&#x2F;dotenvy</a></div><br/><div id="40196032" class="c"><input type="checkbox" id="c-40196032" checked=""/><div class="controls bullet"><span class="by">bitwize</span><span>|</span><a href="#40194932">root</a><span>|</span><a href="#40195106">parent</a><span>|</span><a href="#40192814">next</a><span>|</span><label class="collapse" for="c-40196032">[-]</label><label class="expand" for="c-40196032">[1 more]</label></div><br/><div class="children"><div class="content">Once I actually wrote a version in Emacs Lisp, for purposes of being able to run stacks that depended on .env configuration in Emacs buffers.</div><br/></div></div></div></div></div></div><div id="40192814" class="c"><input type="checkbox" id="c-40192814" checked=""/><div class="controls bullet"><span class="by">spullara</span><span>|</span><a href="#40194932">prev</a><span>|</span><label class="collapse" for="c-40192814">[-]</label><label class="expand" for="c-40192814">[11 more]</label></div><br/><div class="children"><div class="content">Claude 3 Opus &amp; GPT-4 have some comments on a few things that you might want to check to make sure they aren&#x27;t hallucinating.</div><br/><div id="40192848" class="c"><input type="checkbox" id="c-40192848" checked=""/><div class="controls bullet"><span class="by">VWWHFSfQ</span><span>|</span><a href="#40192814">parent</a><span>|</span><label class="collapse" for="c-40192848">[-]</label><label class="expand" for="c-40192848">[10 more]</label></div><br/><div class="children"><div class="content">what are the suggestions</div><br/><div id="40192878" class="c"><input type="checkbox" id="c-40192878" checked=""/><div class="controls bullet"><span class="by">spullara</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40192848">parent</a><span>|</span><label class="collapse" for="c-40192878">[-]</label><label class="expand" for="c-40192878">[9 more]</label></div><br/><div class="children"><div class="content">GPT-4:<p>The code provided has a few potential issues, including security vulnerabilities:<p>Buffer Overflow and Memory Allocation Errors:
The malloc function in read_file does not check if the memory allocation fails (it checks if buffer is NULL instead of <i>buffer). This can lead to a null pointer dereference if malloc fails and returns NULL.
There&#x27;s a possibility of buffer overflow or improper handling if the file size read by ftell is exactly MAX_FILE_SIZE, because an additional byte is added (</i>buffer = malloc(<i>file_size + 1);).
Improper Input Validation:
The skip_until_charset and skip_charset functions do not check if the end of the buffer is reached within their loops. If the charset does not appear in the buffer, this could lead to reading beyond the buffer&#x27;s limit, causing undefined behavior.
Use of Uninitialized Variables:
In the main function, the value_end pointer is set conditionally inside the if (</i>cur == &#x27;&quot;&#x27; || <i>cur == &#x27;\&#x27;&#x27;) block but used unconditionally outside it. This can lead to the use of an uninitialized pointer if the if block is not executed.
Command Line Argument Handling:
The check if (argc &lt; 1) is unnecessary because argc will always be at least 1 in any C program, as it includes the name of the program itself.
Insufficient validation of command arguments, specifically not handling scenarios where argv[1] might not be provided correctly or safely.
Potential Command Injection:
The execvp call uses user-supplied input (argv[1] and argv[2...]) without sanitization. If the environment or the .env file can be manipulated, it could lead to command injection vulnerabilities.
Error Handling:
The program&#x27;s error messages (e.g., &quot;Missing equal after key&quot;) are clear but the handling of such errors (e.g., continuing to parse or halting operations) may need to be revisited based on desired robustness.<p>Claude:<p>Here are a few potential security vulnerabilities and bugs I noticed in the code:<p>The read_file function does not properly handle the case where malloc fails and returns NULL. It should check if </i>buffer is NULL after the malloc call and handle the error appropriately, likely by returning an error code. Currently it would dereference a NULL pointer.
The code trusts the contents of the .env file. If an attacker can modify the .env file, they could potentially inject malicious values into environment variables that might be used in an unsafe way by the child process.
There are no checks on the size of keys or values. A malicious .env file could contain extremely long keys or values that could potentially cause issues.
The code uses strchr to look for meta characters like &#x27;=&#x27;, &#x27;#&#x27;, etc. If the .env file contains non-ASCII characters, this could potentially lead to unexpected behavior.
The code uses execvp to execute the provided command with the parsed environment. If the command is provided by an untrusted source, this is a command injection vulnerability. The code should validate the command is on an allowlist before executing.
The parsing allows for escape sequences in values, but doesn&#x27;t have bounds checks. A maliciously crafted escape sequence could read or write out of bounds.
The code will modify the process environment even if executing the final command fails. It may be better to parse into a separate data structure and only update the environment if the final execvp call will succeed.
It&#x27;s a good practice to set a proper process umask before writing files or creating directories accessible to other users on the system.<p>While the code looks generally well written, for a utility like this that parses untrusted input and executes commands, it requires very careful security review and hardening. I&#x27;d recommend a thorough security audit before using it on untrusted .env files or with untrusted commands. Adding additional input validation, using allowlists, and limiting the scope of what env vars and commands are allowed would help mitigate some risks.</div><br/><div id="40193001" class="c"><input type="checkbox" id="c-40193001" checked=""/><div class="controls bullet"><span class="by">brenns10</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40192878">parent</a><span>|</span><a href="#40193146">next</a><span>|</span><label class="collapse" for="c-40193001">[-]</label><label class="expand" for="c-40193001">[3 more]</label></div><br/><div class="children"><div class="content">I think if you&#x27;re not willing to manually verify the output of these generative machine learned algorithms, then you probably shouldn&#x27;t present them to somebody as if you&#x27;ve done them the service of a free code review.</div><br/><div id="40193285" class="c"><input type="checkbox" id="c-40193285" checked=""/><div class="controls bullet"><span class="by">gertop</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40193001">parent</a><span>|</span><a href="#40193267">next</a><span>|</span><label class="collapse" for="c-40193285">[-]</label><label class="expand" for="c-40193285">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t understand people who chime in just to regurgitate GPT slop that they haven&#x27;t verified (and sometimes not even read!)<p>I don&#x27;t it hard to believe that they truly believe they&#x27;re doing us a favor. Surely they&#x27;re doing it just to feel smart or included?</div><br/></div></div><div id="40193267" class="c"><input type="checkbox" id="c-40193267" checked=""/><div class="controls bullet"><span class="by">spullara</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40193001">parent</a><span>|</span><a href="#40193285">prev</a><span>|</span><a href="#40193146">next</a><span>|</span><label class="collapse" for="c-40193267">[-]</label><label class="expand" for="c-40193267">[1 more]</label></div><br/><div class="children"><div class="content">I suggested he look at it since he is the expert on his code lol.</div><br/></div></div></div></div><div id="40193146" class="c"><input type="checkbox" id="c-40193146" checked=""/><div class="controls bullet"><span class="by">gyf304</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40192878">parent</a><span>|</span><a href="#40193001">prev</a><span>|</span><a href="#40192889">next</a><span>|</span><label class="collapse" for="c-40193146">[-]</label><label class="expand" for="c-40193146">[1 more]</label></div><br/><div class="children"><div class="content">* Memory allocation NULL check: this is a bona-fide bug introduced by my refactoring<p>* MAX_FILE_SIZE: I don&#x27;t think this is true.<p>* skip_until_charset, skip_charset bound check bug: I don&#x27;t think this is true<p>* Uninitialized value_end: I don&#x27;t think this is true - and if true should be caught by -Wall -Werror flags.<p>* argc &lt; 1 check not being necessary: This is not true, you can make argc == 0 by using the exec family of libc functions.<p>* Error Handling: Currently all parsing errors should cause the program to exit, which I think is the desired behavior.<p>* Unsanitized input for .env: Intended behavior.<p>* Unsanitized input for execvp: Intended behavior.</div><br/></div></div><div id="40192889" class="c"><input type="checkbox" id="c-40192889" checked=""/><div class="controls bullet"><span class="by">jmprspret</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40192878">parent</a><span>|</span><a href="#40193146">prev</a><span>|</span><label class="collapse" for="c-40192889">[-]</label><label class="expand" for="c-40192889">[4 more]</label></div><br/><div class="children"><div class="content">GPT-4 is not a static code analyser</div><br/><div id="40194464" class="c"><input type="checkbox" id="c-40194464" checked=""/><div class="controls bullet"><span class="by">dotancohen</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40192889">parent</a><span>|</span><label class="collapse" for="c-40194464">[-]</label><label class="expand" for="c-40194464">[3 more]</label></div><br/><div class="children"><div class="content">These LLMs are not a lot of things that people think they can use them for, apparently. Therapist, search engine, cheap coding labour, the list goes on.<p>These LLMs produce syntacticly valid language, no more. And information contained within is a by-product and not necessarily factual nor correct.</div><br/><div id="40195301" class="c"><input type="checkbox" id="c-40195301" checked=""/><div class="controls bullet"><span class="by">jeffhuys</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40194464">parent</a><span>|</span><label class="collapse" for="c-40195301">[-]</label><label class="expand" for="c-40195301">[2 more]</label></div><br/><div class="children"><div class="content">Still incredibly helpful. Therapy? Helped me a couple of times on some dark days. It’s not a replacement for it, but it helped me. Search engine? Why not? As long as you verify claims, you’re good, and especially nowadays the answers are preferable to whatever Google thinks should be on the first 10 pages (hint: it’s all crap). Cheap coding labour? Again, as long as you verify. A senior programmer can get a lot more done in a day this way.<p>It’s not necessarily factual or correct, no. But it’s incredibly helpful and useful. As always, the real answer is somewhere in the middle.<p>Just don’t ask it about politics. It’s so blatantly obviously biased.</div><br/><div id="40196121" class="c"><input type="checkbox" id="c-40196121" checked=""/><div class="controls bullet"><span class="by">dotancohen</span><span>|</span><a href="#40192814">root</a><span>|</span><a href="#40195301">parent</a><span>|</span><label class="collapse" for="c-40196121">[-]</label><label class="expand" for="c-40196121">[1 more]</label></div><br/><div class="children"><div class="content">If you don&#x27;t mind, I&#x27;m really interested in how you used an LLM for therapy. My Gmail username is the same as my HN username if you feel comfortable talking about it and helping others. Thank you!</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>