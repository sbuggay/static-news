<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1738573278853" as="style"/><link rel="stylesheet" href="styles.css?v=1738573278853"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://codestyleandtaste.com/globals-are-not-the-problem.html">Global variables are not the problem</a>Â <span class="domain">(<a href="https://codestyleandtaste.com">codestyleandtaste.com</a>)</span></div><div class="subtext"><span>levodelellis</span> | <span>98 comments</span></div><br/><div><div id="42913673" class="c"><input type="checkbox" id="c-42913673" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#42913958">next</a><span>|</span><label class="collapse" for="c-42913673">[-]</label><label class="expand" for="c-42913673">[9 more]</label></div><br/><div class="children"><div class="content">The bug in the program reveals a poor understanding of object lifecycles by whoever wrote it. The `obj` argument to `simple` is not globally unique and so it makes a poor location to store global state information (a count of how often `simple` is called, in this example).<p>Never tie global state information to ephemeral objects whose lifetime may be smaller than what you want to track. In this case, they want to know how many times `simple` is called across the <i>program&#x27;s</i> lifetime. Unless you can guarantee the `obj` argument or its `counter` member exists from before the first call to `simple` and through the last call to `simple` and is the only `obj` to ever be passed to `simple`, it is the wrong place to put the count information. And with those guarantees, you may as well remove `obj` as a parameter to both `simple` and `complex` and just treat it as a global.<p>State information needs to exist in objects or locations that last as long as that state information is relevant, no more, no less. If the information is about the overall program lifecycle, then a global can make sense. If you only need to know how many times `simple` was invoked with a particular `obj` instance, then tie it to the object passed in as the `obj` argument.</div><br/><div id="42913865" class="c"><input type="checkbox" id="c-42913865" checked=""/><div class="controls bullet"><span class="by">Izkata</span><span>|</span><a href="#42913673">parent</a><span>|</span><a href="#42913876">next</a><span>|</span><label class="collapse" for="c-42913865">[-]</label><label class="expand" for="c-42913865">[1 more]</label></div><br/><div class="children"><div class="content">&gt; it is the wrong place to put the count information.<p>I&#x27;d argue this is the case regardless of lifetime.  It&#x27;s trying to squash two unrelated things into one object and should have been two different arguments.<p>Way more obvious if &quot;obj&quot; is replaced with some example object instead of an empty one:<p><pre><code>  let person = { name: &quot;Foo Bar&quot;, age: 30, counter: counter };</code></pre></div><br/></div></div><div id="42913876" class="c"><input type="checkbox" id="c-42913876" checked=""/><div class="controls bullet"><span class="by">roenxi</span><span>|</span><a href="#42913673">parent</a><span>|</span><a href="#42913865">prev</a><span>|</span><a href="#42913774">next</a><span>|</span><label class="collapse" for="c-42913876">[-]</label><label class="expand" for="c-42913876">[1 more]</label></div><br/><div class="children"><div class="content">I like the diagnosis.<p>My JS is terrible, but it seems like once you make the counter a global variable it is just better to change it to have an atomic dedicated count function. So instead of incrementing the counter in simple, a globalCount() function gets called that isolates the state. Something like<p><pre><code>  {
    let i = 0;
    var counter = function (){
        console.log(++i);
    }
  }
</code></pre>
Then call counter() to count &amp; log and document that something horrible and stateful is happening. I wouldn&#x27;t call that a global variable although the article author disagrees.</div><br/></div></div><div id="42913774" class="c"><input type="checkbox" id="c-42913774" checked=""/><div class="controls bullet"><span class="by">levodelellis</span><span>|</span><a href="#42913673">parent</a><span>|</span><a href="#42913876">prev</a><span>|</span><a href="#42914264">next</a><span>|</span><label class="collapse" for="c-42913774">[-]</label><label class="expand" for="c-42913774">[3 more]</label></div><br/><div class="children"><div class="content">Could you tell me where this was posted? I thought no one would see this after I got no comments the first day<p>No one I showed this to complained about the first example but online many people did. I wrote a completely different article which I think is much better that uses examples I would have used in the follow up. I&#x27;ll post that article next week</div><br/><div id="42913828" class="c"><input type="checkbox" id="c-42913828" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#42913673">root</a><span>|</span><a href="#42913774">parent</a><span>|</span><a href="#42913846">next</a><span>|</span><label class="collapse" for="c-42913828">[-]</label><label class="expand" for="c-42913828">[1 more]</label></div><br/><div class="children"><div class="content">Second chance pool. This post is, per your submission history, from 2 days ago. HN has a second chance pool that lets articles continue collecting upvotes (more easily than digging through the full history). Some of those articles will get their timestamp updated to artificially inflate their ranking. This brings them to the front page again and gives them their &quot;second chance&quot;. After a few hours or whatever time, the timestamp is reverted and they&#x27;ll start falling back into their natural place in the rankings.<p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;submitted?id=levodelellis">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;submitted?id=levodelellis</a><p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;lists">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;lists</a><p><a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;pool">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;pool</a></div><br/></div></div></div></div><div id="42914264" class="c"><input type="checkbox" id="c-42914264" checked=""/><div class="controls bullet"><span class="by">SpaceNoodled</span><span>|</span><a href="#42913673">parent</a><span>|</span><a href="#42913774">prev</a><span>|</span><a href="#42915328">next</a><span>|</span><label class="collapse" for="c-42914264">[-]</label><label class="expand" for="c-42914264">[2 more]</label></div><br/><div class="children"><div class="content">The counter should be declared as static inside the function, thus limiting is scope and avoiding pollution of the global namespace.</div><br/><div id="42914324" class="c"><input type="checkbox" id="c-42914324" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#42913673">root</a><span>|</span><a href="#42914264">parent</a><span>|</span><a href="#42915328">next</a><span>|</span><label class="collapse" for="c-42914324">[-]</label><label class="expand" for="c-42914324">[1 more]</label></div><br/><div class="children"><div class="content">In this case, yes. Its scope should be the lowest necessary scope. Does JS provide static variables in functions? If not, then that forces you to lift it to some other scope like file or module scope or the surrounding function or class if that&#x27;s viable.</div><br/></div></div></div></div></div></div><div id="42913958" class="c"><input type="checkbox" id="c-42913958" checked=""/><div class="controls bullet"><span class="by">billforsternz</span><span>|</span><a href="#42913673">prev</a><span>|</span><a href="#42913881">next</a><span>|</span><label class="collapse" for="c-42913958">[-]</label><label class="expand" for="c-42913958">[4 more]</label></div><br/><div class="children"><div class="content">From the article&gt; &quot;Static Function Variable: In C inside a function, you can declare a static variable. You could consider this as a local variable but I don&#x27;t since it&#x27;s on the heap, and can be returned and modified outside of the functions. I absolutely avoid this except as a counter whose address I never return.&quot;<p>These variables are not on the heap. They are statically allocated. Their visibility is the only thing that differentiates them from global variables and static variables defined outside of functions.<p>I think such variables can be useful, if you need a simple way of keeping some persistent state within a function. Of course it&#x27;s more state you are carrying around, so it&#x27;s hard to defend in a code review as best practice.<p>Amusingly, you can modify such variables from outside the function, simply by getting your function to provide the modifying code with a pointer to the variable, eg by returning the variable&#x27;s address. If you do that though you&#x27;re probably creating a monster. In contrast I think returning the value of the static variable (which the author casts shade on in the quote above) seems absolutely fine.<p>Edit: I should have stated that the number one problem with this technique is that it&#x27;s absolutely not thread safe for obvious reasons.</div><br/><div id="42915941" class="c"><input type="checkbox" id="c-42915941" checked=""/><div class="controls bullet"><span class="by">tcoff91</span><span>|</span><a href="#42913958">parent</a><span>|</span><a href="#42915075">next</a><span>|</span><label class="collapse" for="c-42915941">[-]</label><label class="expand" for="c-42915941">[1 more]</label></div><br/><div class="children"><div class="content">Just in case anyone still doesn&#x27;t understand what that means to be statically allocated. It means that they are allocated in the Data Segment, which is a separate area of virtual memory from the stack and the heap.</div><br/></div></div><div id="42915075" class="c"><input type="checkbox" id="c-42915075" checked=""/><div class="controls bullet"><span class="by">ijustlovemath</span><span>|</span><a href="#42913958">parent</a><span>|</span><a href="#42915941">prev</a><span>|</span><a href="#42913881">next</a><span>|</span><label class="collapse" for="c-42915075">[-]</label><label class="expand" for="c-42915075">[2 more]</label></div><br/><div class="children"><div class="content">static variable addresses are an extremely important tool in static analysis, for proving certain program invariants hold. In C, a const static often will be able to tell you more about the structure of your code at runtime than a #define macro ever could!<p>though unless you&#x27;re programming extremely defensively (eg trying to thwart a nation state), I see no reason why you would use them at runtime</div><br/><div id="42915483" class="c"><input type="checkbox" id="c-42915483" checked=""/><div class="controls bullet"><span class="by">Panzer04</span><span>|</span><a href="#42913958">root</a><span>|</span><a href="#42915075">parent</a><span>|</span><a href="#42913881">next</a><span>|</span><label class="collapse" for="c-42915483">[-]</label><label class="expand" for="c-42915483">[1 more]</label></div><br/><div class="children"><div class="content">Could you expand on this? I don&#x27;t understand the point you&#x27;re making, or how it&#x27;s useful.</div><br/></div></div></div></div></div></div><div id="42913881" class="c"><input type="checkbox" id="c-42913881" checked=""/><div class="controls bullet"><span class="by">hansvm</span><span>|</span><a href="#42913958">prev</a><span>|</span><a href="#42913295">next</a><span>|</span><label class="collapse" for="c-42913881">[-]</label><label class="expand" for="c-42913881">[3 more]</label></div><br/><div class="children"><div class="content">Global variables (in languages where they otherwise make sense and don&#x27;t have footguns at initialization and whatnot) have two main problems:<p>1. They work against local reasoning as you analyze the code<p>2. The semantic lifetime for a bundle of data is rarely actually the lifetime of the program<p>The second of those is easy to guard against. Just give the bundle of data a name associated with its desired lifetime. If you really only need one of those lifetimes then globally allocate one of them (in most languages this is as cheap as independently handling a bunch of globals, baked into the binary in a low-level language). If necessary, give it a `reset()` method.<p>The first is a more interesting problem. Even if you bundle data into some sort of `HTTPRequest` lifetime or whatever, the fact that it&#x27;s bundled still works against local reasoning as you try to use your various counters and loggers and what have you. It&#x27;s the same battle between implicit and explicit parameters we&#x27;ve argued about for decades. I don&#x27;t have any concrete advice, but anecdotally I see more bugs from biggish collections of heterogeneous data types than I do from passing everything around manually (just the subsets people actually need).</div><br/><div id="42915009" class="c"><input type="checkbox" id="c-42915009" checked=""/><div class="controls bullet"><span class="by">Spivak</span><span>|</span><a href="#42913881">parent</a><span>|</span><a href="#42913295">next</a><span>|</span><label class="collapse" for="c-42915009">[-]</label><label class="expand" for="c-42915009">[2 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t think #1 is necessarily true. Take a common case for a global variable, a metric your app is exposing via prometheus. You have some global variable representing its value. Libraries like to hide the global variable sometimes with cuteness like MetricsRegistey.get_metric(&quot;foo&quot;) but they&#x27;re globally readable and writable state. And in your function you do a little metric.observe_event() to increment your counter. I think having this value global <i>helps</i> reasoning because the alternative is going to be a really clunky plumbing of the variable down the stack.</div><br/><div id="42915767" class="c"><input type="checkbox" id="c-42915767" checked=""/><div class="controls bullet"><span class="by">hansvm</span><span>|</span><a href="#42913881">root</a><span>|</span><a href="#42915009">parent</a><span>|</span><a href="#42913295">next</a><span>|</span><label class="collapse" for="c-42915767">[-]</label><label class="expand" for="c-42915767">[1 more]</label></div><br/><div class="children"><div class="content">It helps with reasoning in some sense, and the net balance might be positive in how much reasoning it enables, but it definitely hurts local reasoning. You need broader context to be able to analyze whether the function is correct (or even what it&#x27;s supposed to be doing if you don&#x27;t actively work to prevent entropic decay as the codebase changes). You can&#x27;t test that function without bringing in that outer context. It (often) doesn&#x27;t naturally compose well with other functions.</div><br/></div></div></div></div></div></div><div id="42913295" class="c"><input type="checkbox" id="c-42913295" checked=""/><div class="controls bullet"><span class="by">serbuvlad</span><span>|</span><a href="#42913881">prev</a><span>|</span><a href="#42916111">next</a><span>|</span><label class="collapse" for="c-42913295">[-]</label><label class="expand" for="c-42913295">[30 more]</label></div><br/><div class="children"><div class="content">I find the concept of a context structure passed as the first parameter to all your functions with all your &quot;globals&quot; to be very compelling for this sort of stuff.</div><br/><div id="42913926" class="c"><input type="checkbox" id="c-42913926" checked=""/><div class="controls bullet"><span class="by">sublinear</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42915773">next</a><span>|</span><label class="collapse" for="c-42913926">[-]</label><label class="expand" for="c-42913926">[1 more]</label></div><br/><div class="children"><div class="content"><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Dependency_injection" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Dependency_injection</a><p>This is very similar to dependency injection. Separating state and construction from function or method implementation makes things a lot easier to test. In my opinion it&#x27;s also easier to comprehend what the code actually does.</div><br/></div></div><div id="42915773" class="c"><input type="checkbox" id="c-42915773" checked=""/><div class="controls bullet"><span class="by">rurban</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42913926">prev</a><span>|</span><a href="#42913790">next</a><span>|</span><label class="collapse" for="c-42915773">[-]</label><label class="expand" for="c-42915773">[2 more]</label></div><br/><div class="children"><div class="content">That&#x27;s only needed if you use multiple threads. In a single thread global vars are just fine, and much simplier than passing around ctx</div><br/><div id="42916002" class="c"><input type="checkbox" id="c-42916002" checked=""/><div class="controls bullet"><span class="by">Tainnor</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42915773">parent</a><span>|</span><a href="#42913790">next</a><span>|</span><label class="collapse" for="c-42916002">[-]</label><label class="expand" for="c-42916002">[1 more]</label></div><br/><div class="children"><div class="content">And do you always know beyond any reasonable doubt that your code will be single-threaded for all time? Because the moment this changes, you&#x27;re in for a world of pain.</div><br/></div></div></div></div><div id="42913790" class="c"><input type="checkbox" id="c-42913790" checked=""/><div class="controls bullet"><span class="by">levodelellis</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42915773">prev</a><span>|</span><a href="#42913687">next</a><span>|</span><label class="collapse" for="c-42913790">[-]</label><label class="expand" for="c-42913790">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s exactly why I used this specific example. I seen many code bases that use clone to avoid mutation problems so I wrote this specifically to show it can become a problem too.<p>I wrote a better article on globals. I plan on posting it next week</div><br/></div></div><div id="42913687" class="c"><input type="checkbox" id="c-42913687" checked=""/><div class="controls bullet"><span class="by">bee_rider</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42913790">prev</a><span>|</span><a href="#42913326">next</a><span>|</span><label class="collapse" for="c-42913687">[-]</label><label class="expand" for="c-42913687">[2 more]</label></div><br/><div class="children"><div class="content">That just seems like globals with extra steps. Suddenly if your context structure has a weird value in it, youâll have to check every function to see who messed it up.</div><br/><div id="42913711" class="c"><input type="checkbox" id="c-42913711" checked=""/><div class="controls bullet"><span class="by">bigcat12345678</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913687">parent</a><span>|</span><a href="#42913326">next</a><span>|</span><label class="collapse" for="c-42913711">[-]</label><label class="expand" for="c-42913711">[1 more]</label></div><br/><div class="children"><div class="content">That&#x27;s 2 parts:
1. Global variable (mutable)
2. Local function with context argument (mutations)<p>You have clear tracking of when and how functions change the global variable</div><br/></div></div></div></div><div id="42913326" class="c"><input type="checkbox" id="c-42913326" checked=""/><div class="controls bullet"><span class="by">leetrout</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42913687">prev</a><span>|</span><a href="#42913434">next</a><span>|</span><label class="collapse" for="c-42913326">[-]</label><label class="expand" for="c-42913326">[3 more]</label></div><br/><div class="children"><div class="content">The &quot;god object&quot;</div><br/><div id="42913646" class="c"><input type="checkbox" id="c-42913646" checked=""/><div class="controls bullet"><span class="by">thaumasiotes</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913326">parent</a><span>|</span><a href="#42913434">next</a><span>|</span><label class="collapse" for="c-42913646">[-]</label><label class="expand" for="c-42913646">[2 more]</label></div><br/><div class="children"><div class="content">The &quot;environment&quot;.</div><br/><div id="42915602" class="c"><input type="checkbox" id="c-42915602" checked=""/><div class="controls bullet"><span class="by">KPGv2</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913646">parent</a><span>|</span><a href="#42913434">next</a><span>|</span><label class="collapse" for="c-42915602">[-]</label><label class="expand" for="c-42915602">[1 more]</label></div><br/><div class="children"><div class="content">couple dudes pooh-poohing the reader monad</div><br/></div></div></div></div></div></div><div id="42913434" class="c"><input type="checkbox" id="c-42913434" checked=""/><div class="controls bullet"><span class="by">caspper69</span><span>|</span><a href="#42913295">parent</a><span>|</span><a href="#42913326">prev</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42913434">[-]</label><label class="expand" for="c-42913434">[19 more]</label></div><br/><div class="children"><div class="content">Hard disagree.<p>If I have 500 functions, I don&#x27;t want to extrapolate out the overhead of passing a state object around to all of them. That&#x27;s a waste of effort, and frankly makes me think you want to code using an FP paradigm even in imperative languages.<p>Module-level and thread-level &quot;globals&quot; are fine. You gain nothing (other than some smug ivory tower sense of superiority) by making your functions pure and passing around a global state object to every single method invocation.</div><br/><div id="42913653" class="c"><input type="checkbox" id="c-42913653" checked=""/><div class="controls bullet"><span class="by">rafaelmn</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913434">parent</a><span>|</span><a href="#42916042">next</a><span>|</span><label class="collapse" for="c-42913653">[-]</label><label class="expand" for="c-42913653">[5 more]</label></div><br/><div class="children"><div class="content">You get functions that are easily testable in isolation with all state provided in parameters.<p>You also get explicit dependencies and scoping controlled by caller.<p>I don&#x27;t mind globals but saying you get nothing for avoiding them is :&#x2F;</div><br/><div id="42914060" class="c"><input type="checkbox" id="c-42914060" checked=""/><div class="controls bullet"><span class="by">Gibbon1</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913653">parent</a><span>|</span><a href="#42915505">next</a><span>|</span><label class="collapse" for="c-42914060">[-]</label><label class="expand" for="c-42914060">[1 more]</label></div><br/><div class="children"><div class="content">I tend to use getter and setter functions to access globals and manage state.<p>Advantage only the function that depends on the global needs to bring in the dependency.</div><br/></div></div><div id="42915505" class="c"><input type="checkbox" id="c-42915505" checked=""/><div class="controls bullet"><span class="by">wruza</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913653">parent</a><span>|</span><a href="#42914060">prev</a><span>|</span><a href="#42916042">next</a><span>|</span><label class="collapse" for="c-42915505">[-]</label><label class="expand" for="c-42915505">[3 more]</label></div><br/><div class="children"><div class="content">If thatâs so useful, make your language support the concept of lexical environments instead. Otherwise itâs just manual sunsetting every day of week. Our craft is full of this âletâs pretend weâre in a lisp with good syntaxâ where half of it is missing, but fine, weâll simulate it by hand. Dirt and sticks engineering.<p>(To be clear, Iâm just tangentially ranting about the state of things in general, might as well post this under somewhere else.)</div><br/><div id="42916047" class="c"><input type="checkbox" id="c-42916047" checked=""/><div class="controls bullet"><span class="by">silon42</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42915505">parent</a><span>|</span><a href="#42916042">next</a><span>|</span><label class="collapse" for="c-42916047">[-]</label><label class="expand" for="c-42916047">[2 more]</label></div><br/><div class="children"><div class="content">So, making it implicit again? No.</div><br/><div id="42916106" class="c"><input type="checkbox" id="c-42916106" checked=""/><div class="controls bullet"><span class="by">wruza</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42916047">parent</a><span>|</span><a href="#42916042">next</a><span>|</span><label class="collapse" for="c-42916106">[-]</label><label class="expand" for="c-42916106">[1 more]</label></div><br/><div class="children"><div class="content">You can have it either way, itâs not for you but for people who disagree with what they deem a preference that is the only option when thereâs no alternative.</div><br/></div></div></div></div></div></div></div></div><div id="42916042" class="c"><input type="checkbox" id="c-42916042" checked=""/><div class="controls bullet"><span class="by">Tainnor</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913434">parent</a><span>|</span><a href="#42913653">prev</a><span>|</span><a href="#42915575">next</a><span>|</span><label class="collapse" for="c-42916042">[-]</label><label class="expand" for="c-42916042">[1 more]</label></div><br/><div class="children"><div class="content">I got into this argument with my former coworkers. Huge legacy codebase. Important information (such as the current tenant of our multi-tenant app) was hidden away in thread-local vars. This made code <i>really</i> hard to understand for newcomers because you just <i>had</i> to know that you&#x27;d have to set certain variables before calling certain other functions. Writing tests was also much more difficult and verbose. None of these preconditions were of course documented. We started getting into more trouble once we started using Kotlin coroutines which share threads between each other. You can solve this (by setting the correct coroutine context), but it made the code even harder to understand and more error-prone.<p>I said we should either abolish the thread-local variables or not use coroutines, but they said &quot;we don&#x27;t want to pass so many parameters around&quot; and &quot;coroutines are the modern paradigm in Kotlin&quot;, so no dice.</div><br/></div></div><div id="42915575" class="c"><input type="checkbox" id="c-42915575" checked=""/><div class="controls bullet"><span class="by">billmcneale</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913434">parent</a><span>|</span><a href="#42916042">prev</a><span>|</span><a href="#42915501">next</a><span>|</span><label class="collapse" for="c-42915575">[-]</label><label class="expand" for="c-42915575">[1 more]</label></div><br/><div class="children"><div class="content">Yes, you gain testability.<p>If your global state contains something that runs in prod but should not run in a testing environment (e.g. a database connection), your global variable based code is now untestable.<p>Dependency Injection is popular for a very good reason.</div><br/></div></div><div id="42915501" class="c"><input type="checkbox" id="c-42915501" checked=""/><div class="controls bullet"><span class="by">Panzer04</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913434">parent</a><span>|</span><a href="#42915575">prev</a><span>|</span><a href="#42913524">next</a><span>|</span><label class="collapse" for="c-42915501">[-]</label><label class="expand" for="c-42915501">[1 more]</label></div><br/><div class="children"><div class="content">Just need to make sure your module doesn&#x27;t get too big or unwieldy. I work in a codebase with some &quot;module&quot; C files with a litany of global statics and it&#x27;s very difficult to understand the possible states it can be in or test it.<p>I agree that so long as overall complexity is limited these things can be OK. As soon as you&#x27;re reading and writing a global in multiple locations though I would be extremely, extremely wary.</div><br/></div></div><div id="42913524" class="c"><input type="checkbox" id="c-42913524" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913434">parent</a><span>|</span><a href="#42915501">prev</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42913524">[-]</label><label class="expand" for="c-42913524">[10 more]</label></div><br/><div class="children"><div class="content">Hard to take your comment seriously when you go out of your way to degrade a discussion opponent, FYI.</div><br/><div id="42913903" class="c"><input type="checkbox" id="c-42913903" checked=""/><div class="controls bullet"><span class="by">caspper69</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913524">parent</a><span>|</span><a href="#42913891">prev</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42913903">[-]</label><label class="expand" for="c-42913903">[8 more]</label></div><br/><div class="children"><div class="content">My comment was not intended to be personally degrading to OP. Apologies if it was taken that way.</div><br/><div id="42913937" class="c"><input type="checkbox" id="c-42913937" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913903">parent</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42913937">[-]</label><label class="expand" for="c-42913937">[7 more]</label></div><br/><div class="children"><div class="content">I did not say you are targeting OP. I meant that you are degrading your parent commenter.<p>This:<p>&quot;You gain nothing (other than some smug ivory tower sense of superiority) by making your functions pure and passing around a global state object to every single method invocation.&quot;<p>...is neither productive nor actually true. But I&#x27;ll save the latter part for your other reply.</div><br/><div id="42913988" class="c"><input type="checkbox" id="c-42913988" checked=""/><div class="controls bullet"><span class="by">caspper69</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913937">parent</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42913988">[-]</label><label class="expand" for="c-42913988">[6 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll take my medicine. :)<p>I&#x27;m not above being put in my place and being shown the light.<p>(And when I said OP, I did mean the parent poster)<p>You should also understand that the &quot;you&quot; in my comment you quoted is the colloquial you and not necessarily the parent poster.<p>So lay it on me.</div><br/><div id="42914016" class="c"><input type="checkbox" id="c-42914016" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42913988">parent</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42914016">[-]</label><label class="expand" for="c-42914016">[5 more]</label></div><br/><div class="children"><div class="content">OK, I will.<p>But I also got a notification about a big comment you posted but it is now deleted. Did you want to rewrite it or did you give up on it?</div><br/><div id="42914099" class="c"><input type="checkbox" id="c-42914099" checked=""/><div class="controls bullet"><span class="by">caspper69</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42914016">parent</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42914099">[-]</label><label class="expand" for="c-42914099">[4 more]</label></div><br/><div class="children"><div class="content">I could not initially reply to you. Your comment rubbed me the wrong way, because I had no intention of trying to degrade anyone, and frankly, I was offended. But I thought better of my hasty and emotional response. I would rather take a deep breath, re-focus, re-engage, and be educated in a thoughtful dialog than get into a mud slinging contest. I am always willing to be enlightened.</div><br/><div id="42914157" class="c"><input type="checkbox" id="c-42914157" checked=""/><div class="controls bullet"><span class="by">Jtsummers</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42914099">parent</a><span>|</span><a href="#42914159">next</a><span>|</span><label class="collapse" for="c-42914157">[-]</label><label class="expand" for="c-42914157">[2 more]</label></div><br/><div class="children"><div class="content">A tip, in your profile you can set a delay which is a number of minutes before your comments will become visible to other people. Mine is set to 2 right now. This gives you time to edit your comment (helpful for some longer ones) but also to write some garbage response and then think better and delete it before anyone&#x27;s the wiser.<p>It&#x27;s also helpful to give you time to re-read a mostly good, but maybe not polite, response and tone down your response.</div><br/><div id="42914271" class="c"><input type="checkbox" id="c-42914271" checked=""/><div class="controls bullet"><span class="by">caspper69</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42914157">parent</a><span>|</span><a href="#42914159">next</a><span>|</span><label class="collapse" for="c-42914271">[-]</label><label class="expand" for="c-42914271">[1 more]</label></div><br/><div class="children"><div class="content">Much appreciated :)</div><br/></div></div></div></div><div id="42914159" class="c"><input type="checkbox" id="c-42914159" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#42913295">root</a><span>|</span><a href="#42914099">parent</a><span>|</span><a href="#42914157">prev</a><span>|</span><a href="#42913523">next</a><span>|</span><label class="collapse" for="c-42914159">[-]</label><label class="expand" for="c-42914159">[1 more]</label></div><br/><div class="children"><div class="content">Commendable, still let&#x27;s not forget that the part I quoted was the beginning of a mud-slinging contest that you seemed willing to start. ;)<p>So indeed, let&#x27;s re-focus and re-engage.<p>To that end, I will post you a longer reply <i>Laterâ¢</i>.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div id="42916111" class="c"><input type="checkbox" id="c-42916111" checked=""/><div class="controls bullet"><span class="by">tedk-42</span><span>|</span><a href="#42913295">prev</a><span>|</span><a href="#42915965">next</a><span>|</span><label class="collapse" for="c-42916111">[-]</label><label class="expand" for="c-42916111">[1 more]</label></div><br/><div class="children"><div class="content">Global variables are fine when you read many times, but you write to them sparingly and when they are updated but the old value is read&#x2F;used you have mechanisms to handle errors and retry</div><br/></div></div><div id="42915965" class="c"><input type="checkbox" id="c-42915965" checked=""/><div class="controls bullet"><span class="by">Tainnor</span><span>|</span><a href="#42916111">prev</a><span>|</span><a href="#42915715">next</a><span>|</span><label class="collapse" for="c-42915965">[-]</label><label class="expand" for="c-42915965">[1 more]</label></div><br/><div class="children"><div class="content">&gt; If you run the code you&#x27;ll see 1 2 3 4 3 printed instead of 5.<p>I&#x27;m really confused, as this behaviour appears to be completely obvious to me.</div><br/></div></div><div id="42915715" class="c"><input type="checkbox" id="c-42915715" checked=""/><div class="controls bullet"><span class="by">js8</span><span>|</span><a href="#42915965">prev</a><span>|</span><a href="#42915634">next</a><span>|</span><label class="collapse" for="c-42915715">[-]</label><label class="expand" for="c-42915715">[3 more]</label></div><br/><div class="children"><div class="content">Any program that uses a database has a very similar problem to global variables.<p>As Gilad Bracha has pointed out, types are antimodular, and your database schema can be considered one giant type that pervades your program, just like globals can be.<p>I don&#x27;t think we have tools to compositionally solve this, across different programming languages.</div><br/><div id="42916212" class="c"><input type="checkbox" id="c-42916212" checked=""/><div class="controls bullet"><span class="by">nejsjsjsbsb</span><span>|</span><a href="#42915715">parent</a><span>|</span><a href="#42916068">next</a><span>|</span><label class="collapse" for="c-42916212">[-]</label><label class="expand" for="c-42916212">[1 more]</label></div><br/><div class="children"><div class="content">Your program is also one giant type.</div><br/></div></div><div id="42916068" class="c"><input type="checkbox" id="c-42916068" checked=""/><div class="controls bullet"><span class="by">cauefcr</span><span>|</span><a href="#42915715">parent</a><span>|</span><a href="#42916212">prev</a><span>|</span><a href="#42915634">next</a><span>|</span><label class="collapse" for="c-42916068">[-]</label><label class="expand" for="c-42916068">[1 more]</label></div><br/><div class="children"><div class="content">Migrations? Generate bindings for your queries automatically with query+schema definitions? (sqlc)</div><br/></div></div></div></div><div id="42915634" class="c"><input type="checkbox" id="c-42915634" checked=""/><div class="controls bullet"><span class="by">PeterStuer</span><span>|</span><a href="#42915715">prev</a><span>|</span><a href="#42915928">next</a><span>|</span><label class="collapse" for="c-42915634">[-]</label><label class="expand" for="c-42915634">[2 more]</label></div><br/><div class="children"><div class="content">The one where the author <i>almost</i> rediscovers the singleton pattern.</div><br/><div id="42916069" class="c"><input type="checkbox" id="c-42916069" checked=""/><div class="controls bullet"><span class="by">cauefcr</span><span>|</span><a href="#42915634">parent</a><span>|</span><a href="#42915928">next</a><span>|</span><label class="collapse" for="c-42916069">[-]</label><label class="expand" for="c-42916069">[1 more]</label></div><br/><div class="children"><div class="content">It can also be an almost rediscovery of closures.</div><br/></div></div></div></div><div id="42915928" class="c"><input type="checkbox" id="c-42915928" checked=""/><div class="controls bullet"><span class="by">fergie</span><span>|</span><a href="#42915634">prev</a><span>|</span><a href="#42913269">next</a><span>|</span><label class="collapse" for="c-42915928">[-]</label><label class="expand" for="c-42915928">[1 more]</label></div><br/><div class="children"><div class="content">Surely both of the examples in the article are using global variables? Nobody ever said global variables are ok if they are an object? (Or did they?)</div><br/></div></div><div id="42913269" class="c"><input type="checkbox" id="c-42913269" checked=""/><div class="controls bullet"><span class="by">bb88</span><span>|</span><a href="#42915928">prev</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42913269">[-]</label><label class="expand" for="c-42913269">[18 more]</label></div><br/><div class="children"><div class="content">Please no.<p>Singletons if you must.  At least you can wrap a mutex around access if you&#x27;re trying to make it thread safe.</div><br/><div id="42913275" class="c"><input type="checkbox" id="c-42913275" checked=""/><div class="controls bullet"><span class="by">bknight1983</span><span>|</span><a href="#42913269">parent</a><span>|</span><a href="#42913839">next</a><span>|</span><label class="collapse" for="c-42913275">[-]</label><label class="expand" for="c-42913275">[1 more]</label></div><br/><div class="children"><div class="content">For every example of a bug caused by not using a global variable Iâm sure could find 10 caused by a global variable</div><br/></div></div><div id="42913839" class="c"><input type="checkbox" id="c-42913839" checked=""/><div class="controls bullet"><span class="by">levodelellis</span><span>|</span><a href="#42913269">parent</a><span>|</span><a href="#42913275">prev</a><span>|</span><a href="#42913357">next</a><span>|</span><label class="collapse" for="c-42913839">[-]</label><label class="expand" for="c-42913839">[1 more]</label></div><br/><div class="children"><div class="content">You may hate my article next week, it&#x27;s meant to replace this article. If you want you can email me for early access and tell me how I can improve the article. Lets say you can guess my email if you&#x27;re emailing the right domain</div><br/></div></div><div id="42913357" class="c"><input type="checkbox" id="c-42913357" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">parent</a><span>|</span><a href="#42913839">prev</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42913357">[-]</label><label class="expand" for="c-42913357">[15 more]</label></div><br/><div class="children"><div class="content">Why are singletons better? That&#x27;s just a global object.<p>&gt;  wrap a mutex<p>What if my program has one thread? Or the threads have clearly defined responsibilities?</div><br/><div id="42913394" class="c"><input type="checkbox" id="c-42913394" checked=""/><div class="controls bullet"><span class="by">dragontamer</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913357">parent</a><span>|</span><a href="#42913405">next</a><span>|</span><label class="collapse" for="c-42913394">[-]</label><label class="expand" for="c-42913394">[2 more]</label></div><br/><div class="children"><div class="content">Global objects need to be initialized. And if two are ever initialized you run into problems like the above.<p>Singleton is a pattern to ensure that a global objects is only ever initialized once.</div><br/><div id="42915142" class="c"><input type="checkbox" id="c-42915142" checked=""/><div class="controls bullet"><span class="by">unscaled</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913394">parent</a><span>|</span><a href="#42913405">next</a><span>|</span><label class="collapse" for="c-42915142">[-]</label><label class="expand" for="c-42915142">[1 more]</label></div><br/><div class="children"><div class="content">Most programming languages written after 1990 let you initialize global variables lazily. The main problem is that the initialization order might be unexpected or you may run into conflicts. Singletons make the order slightly more predictable (based on first variable access), although it is till implicit (lazy).<p>But singletons are still a terrible idea. The issue with global variables is not just initialization. I would argue it&#x27;s one of the more minor issues.<p>The major issues with global variables are:<p>1. Action at distance (if the variable is mutable)<p>2. Tight coupling (global dependencies are hard-coded, you cannot use dependency injection)<p>3. Hidden dependency. The dependency is not only tightly-coupled, it is also hidden from the interface. Client code that calls your function doesn&#x27;t know that you rely on a global variable and that you can run into conflict with other code using that variable or that you may suddenly start accessing some database it didn&#x27;t even know about.<p>Singleton does not solve any of the above. The only thing it ensures is lazy initialization on access.</div><br/></div></div></div></div><div id="42913405" class="c"><input type="checkbox" id="c-42913405" checked=""/><div class="controls bullet"><span class="by">zabzonk</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913357">parent</a><span>|</span><a href="#42913394">prev</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42913405">[-]</label><label class="expand" for="c-42913405">[6 more]</label></div><br/><div class="children"><div class="content">how do you know that? just about every serious bug i have ever written was when i thought i understood multi-threaded code, but didn&#x27;t.</div><br/><div id="42913427" class="c"><input type="checkbox" id="c-42913427" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913405">parent</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42913427">[-]</label><label class="expand" for="c-42913427">[5 more]</label></div><br/><div class="children"><div class="content">Because as a programmer I have responsibility for the technical soundness of the program, and I don&#x27;t create threads haphazardly.<p>&gt; when i thought i understood multi-threaded code, but didn&#x27;t.<p>All the more reason to carefully plan and limit shared state among threads. It&#x27;s hard enough to get right when you know where the problems are and impossible if you spray and pray with mutexes.</div><br/><div id="42913805" class="c"><input type="checkbox" id="c-42913805" checked=""/><div class="controls bullet"><span class="by">catlifeonmars</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913427">parent</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42913805">[-]</label><label class="expand" for="c-42913805">[4 more]</label></div><br/><div class="children"><div class="content">Yeah but just because you do the right thing doesnât mean that others will. That one person that creates threads haphazardly will wreak havoc and at scale this will happen. Itâs an unstable equilibrium to put the onus of program soundness on the contributors to a program.</div><br/><div id="42913984" class="c"><input type="checkbox" id="c-42913984" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913805">parent</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42913984">[-]</label><label class="expand" for="c-42913984">[3 more]</label></div><br/><div class="children"><div class="content">&gt;  That one person that creates threads haphazardly will wreak havoc<p>What if someone comes along and starts adding threads and doesn&#x27;t check what they are accessing? And doesn&#x27;t read the documented invariants of the design?<p>Well I don&#x27;t think any project can succeed if that&#x27;s the level disorganization.<p>Are there certain kinds of bugs that are easy to regress last minute? Yes. A brand new thread without limited state is not one of them.<p>&gt; put the onus of program soundness on the contributors to a program.<p>Who then is responsible for making sure the program is correct?</div><br/><div id="42914130" class="c"><input type="checkbox" id="c-42914130" checked=""/><div class="controls bullet"><span class="by">catlifeonmars</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913984">parent</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42914130">[-]</label><label class="expand" for="c-42914130">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Who then is responsible for making sure the program is correct?<p>Iâd say this is mostly a function of the language or framework.<p>After that, itâs up to the tech leads to provide access patterns&#x2F;examples that align with the needs of a particular project.<p>My point is not so much that you shouldnât ever think about the implications of your code, just that contributors are humans and any project with enough contributors will have a mix of contributors with different knowledge, experience and skill sets. If you are leading one of those, it would behoove you to make doing the right thing easy for later contributors.</div><br/><div id="42915472" class="c"><input type="checkbox" id="c-42915472" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42914130">parent</a><span>|</span><a href="#42913391">next</a><span>|</span><label class="collapse" for="c-42915472">[-]</label><label class="expand" for="c-42915472">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Iâd say this is mostly a function of the language or framework.<p>frameworks cannot ensure your program does what it&#x27;s supposed to. People are responsible, not tools.<p>&gt; contributors are humans<p>Yes - which is why I would discourage haphazard thread usage, and document existing thread architecture.<p>That&#x27;s safer than &quot;hey I threw on a mutex because who knows where this is accessed from&quot;.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="42913391" class="c"><input type="checkbox" id="c-42913391" checked=""/><div class="controls bullet"><span class="by">rileymat2</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913357">parent</a><span>|</span><a href="#42913405">prev</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42913391">[-]</label><label class="expand" for="c-42913391">[6 more]</label></div><br/><div class="children"><div class="content">You know it is &#x2F;currently&#x2F; accessed on one thread.  These are little landmines that add up over time.</div><br/><div id="42913415" class="c"><input type="checkbox" id="c-42913415" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913391">parent</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42913415">[-]</label><label class="expand" for="c-42913415">[5 more]</label></div><br/><div class="children"><div class="content">The burden is on the programmer adding a new thread to know what they can safely access.<p>The conclusion of your argument looks like 2000s Java - throw a mutex on every property because you never know when it will need to be accessed on a thread.<p>Designs that spread complexity rather than encapsulate it are rarely a good idea.</div><br/><div id="42915099" class="c"><input type="checkbox" id="c-42915099" checked=""/><div class="controls bullet"><span class="by">rileymat2</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913415">parent</a><span>|</span><a href="#42913821">next</a><span>|</span><label class="collapse" for="c-42915099">[-]</label><label class="expand" for="c-42915099">[2 more]</label></div><br/><div class="children"><div class="content">&gt; Designs that spread complexity rather than encapsulate it are rarely a good idea.<p>Exactly, globals spread complexity.<p>You need to look at the implementation of each function to know if you can call it. Thatâs the landmine.</div><br/><div id="42915520" class="c"><input type="checkbox" id="c-42915520" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42915099">parent</a><span>|</span><a href="#42913821">next</a><span>|</span><label class="collapse" for="c-42915520">[-]</label><label class="expand" for="c-42915520">[1 more]</label></div><br/><div class="children"><div class="content">I agree that dependent sequences of events, coordinated through a global are bad. But there are other usages which are not error prone. For example an allocation, logger, readonly settings, or a cache.</div><br/></div></div></div></div><div id="42913821" class="c"><input type="checkbox" id="c-42913821" checked=""/><div class="controls bullet"><span class="by">catlifeonmars</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913415">parent</a><span>|</span><a href="#42915099">prev</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42913821">[-]</label><label class="expand" for="c-42913821">[2 more]</label></div><br/><div class="children"><div class="content">Thatâs sounds more like a weakness of the language: that preventing data races is not automatically tracked for you, no?</div><br/><div id="42914034" class="c"><input type="checkbox" id="c-42914034" checked=""/><div class="controls bullet"><span class="by">liontwist</span><span>|</span><a href="#42913269">root</a><span>|</span><a href="#42913821">parent</a><span>|</span><a href="#42913299">next</a><span>|</span><label class="collapse" for="c-42914034">[-]</label><label class="expand" for="c-42914034">[1 more]</label></div><br/><div class="children"><div class="content">If you care about performance, many locks across many pieces of shared state is always a bad idea.<p>If you donât care about performance and want safety you should be using processes. Explicit shared memory is safer than implicit.<p>and yes. Better thread management tools are always welcome when we can get them.</div><br/></div></div></div></div></div></div></div></div></div></div></div></div><div id="42913299" class="c"><input type="checkbox" id="c-42913299" checked=""/><div class="controls bullet"><span class="by">Puts</span><span>|</span><a href="#42913269">prev</a><span>|</span><a href="#42915474">next</a><span>|</span><label class="collapse" for="c-42913299">[-]</label><label class="expand" for="c-42913299">[2 more]</label></div><br/><div class="children"><div class="content">I think the author forgot the most useful use case for globals, and that is variables that has to do with the context the program is running under such as command line arguments and environment variables (properly validated and if needed escaped).</div><br/><div id="42913772" class="c"><input type="checkbox" id="c-42913772" checked=""/><div class="controls bullet"><span class="by">peanut-walrus</span><span>|</span><a href="#42913299">parent</a><span>|</span><a href="#42915474">next</a><span>|</span><label class="collapse" for="c-42913772">[-]</label><label class="expand" for="c-42913772">[1 more]</label></div><br/><div class="children"><div class="content">Do those change during program runtime though? I don&#x27;t think many people have problems with global constants.</div><br/></div></div></div></div><div id="42915474" class="c"><input type="checkbox" id="c-42915474" checked=""/><div class="controls bullet"><span class="by">qalmakka</span><span>|</span><a href="#42913299">prev</a><span>|</span><a href="#42914842">next</a><span>|</span><label class="collapse" for="c-42915474">[-]</label><label class="expand" for="c-42915474">[1 more]</label></div><br/><div class="children"><div class="content"><i>mutable</i> global variables are intrinsically incompatible with a multithreaded environment. Having mutable shared state is never the right solution, unless you basically can live with data races. And that&#x27;s before taking maintainability in consideration too</div><br/></div></div><div id="42914842" class="c"><input type="checkbox" id="c-42914842" checked=""/><div class="controls bullet"><span class="by">G_o_D</span><span>|</span><a href="#42915474">prev</a><span>|</span><a href="#42913624">next</a><span>|</span><label class="collapse" for="c-42914842">[-]</label><label class="expand" for="c-42914842">[1 more]</label></div><br/><div class="children"><div class="content">Globals are essential to track state&#x2F;values of variables in intermediate step, for debug, 
I create unique object on globals and store intermediate variables in it, so i can inspect values when something goes wrong, being only one unique object to maintain it will not override any existing vars thus not affecting existing programs</div><br/></div></div><div id="42913624" class="c"><input type="checkbox" id="c-42913624" checked=""/><div class="controls bullet"><span class="by">pdimitar</span><span>|</span><a href="#42914842">prev</a><span>|</span><a href="#42915109">next</a><span>|</span><label class="collapse" for="c-42913624">[-]</label><label class="expand" for="c-42913624">[1 more]</label></div><br/><div class="children"><div class="content">&gt; <i>The problem is data access. Nothing more, nothing less. There&#x27;s a term for this that has nothing to do with global variables: &quot;action at a distance.&quot;</i><p>I mean yes, using global variables is just one of the ways to cause action-at-a-distance and that is... apparently a big reveal?<p>Otherwise sure, there is no pattern that cannot be utilized 100% correctly and without introducing bugs. Theoretically. Now let&#x27;s look at the practical aspects and how often indiscriminately using such tempting patterns like global variables -- and mutexes-when-we-are-not-sure and I-will-remember-not-to-mutate-through-this-pointer -- lead to bugs down the road.<p>The answer is: fairly often.<p>IMO the article would be better titled as &quot;There is no pattern that a lazy or careless programmer cannot use to introduce a bug&quot;.</div><br/></div></div><div id="42915109" class="c"><input type="checkbox" id="c-42915109" checked=""/><div class="controls bullet"><span class="by">senderista</span><span>|</span><a href="#42913624">prev</a><span>|</span><a href="#42913373">next</a><span>|</span><label class="collapse" for="c-42915109">[-]</label><label class="expand" for="c-42915109">[2 more]</label></div><br/><div class="children"><div class="content">Instance variables are to instance methods what global variables are to free functions and have exactly the same problems.</div><br/></div></div><div id="42913373" class="c"><input type="checkbox" id="c-42913373" checked=""/><div class="controls bullet"><span class="by">grandempire</span><span>|</span><a href="#42915109">prev</a><span>|</span><a href="#42914787">next</a><span>|</span><label class="collapse" for="c-42913373">[-]</label><label class="expand" for="c-42913373">[1 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve recently found it helpful to think of problems at the scope of an individual process, rather than a set of functions in a library or framework. This makes it much clearer when a global variable makes sense or not, and generally where to initialize things, and place state.</div><br/></div></div><div id="42914047" class="c"><input type="checkbox" id="c-42914047" checked=""/><div class="controls bullet"><span class="by">AdieuToLogic</span><span>|</span><a href="#42914787">prev</a><span>|</span><a href="#42913424">next</a><span>|</span><label class="collapse" for="c-42914047">[-]</label><label class="expand" for="c-42914047">[3 more]</label></div><br/><div class="children"><div class="content">This assertion made in the article invalidates the premise of same:<p><pre><code>  With a little encapsulation, you can make globals error-proof ...</code></pre></div><br/><div id="42914427" class="c"><input type="checkbox" id="c-42914427" checked=""/><div class="controls bullet"><span class="by">levodelellis</span><span>|</span><a href="#42914047">parent</a><span>|</span><a href="#42913424">next</a><span>|</span><label class="collapse" for="c-42914427">[-]</label><label class="expand" for="c-42914427">[2 more]</label></div><br/><div class="children"><div class="content">What do you suppose is the recommended way to use the encapsulation? ;) This is partly why there&#x27;s a &quot;defining global variables&quot; section, I know people will will consider some usage as not using a global</div><br/><div id="42915222" class="c"><input type="checkbox" id="c-42915222" checked=""/><div class="controls bullet"><span class="by">AdieuToLogic</span><span>|</span><a href="#42914047">root</a><span>|</span><a href="#42914427">parent</a><span>|</span><a href="#42913424">next</a><span>|</span><label class="collapse" for="c-42915222">[-]</label><label class="expand" for="c-42915222">[1 more]</label></div><br/><div class="children"><div class="content">&gt; What do you suppose is the recommended way to use the encapsulation? ;) This is partly why there&#x27;s a &quot;defining global variables&quot; section, I know people will will consider some usage as not using a global<p>What the post discusses can be distilled into the concept of Referential Transparency[0]:<p><pre><code>  A linguistic construction is called referentially 
  transparent when for any expression built from it, 
  replacing a subexpression with another one that denotes the 
  same value[b] does not change the value of the expression.
</code></pre>
Any construct which is not referentially transparent can be classified as potentially effectual, which is not a Bad Thing(TM) as if there were no observable effects of a program, it would be useless.<p>What makes programs easier to prove correct and reason about is when effects are localized to well-defined areas often &quot;at the edges&quot; of the architecture.<p>What makes programs impossible to prove correct and very difficult to reason about is when effectual logic is pervasive throughout, such as most of the &quot;Global Variable Use Cases&quot; the post advocates.<p>0 - <a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Referential_transparency" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Referential_transparency</a></div><br/></div></div></div></div></div></div><div id="42913424" class="c"><input type="checkbox" id="c-42913424" checked=""/><div class="controls bullet"><span class="by">SpicyLemonZest</span><span>|</span><a href="#42914047">prev</a><span>|</span><a href="#42915557">next</a><span>|</span><label class="collapse" for="c-42913424">[-]</label><label class="expand" for="c-42913424">[2 more]</label></div><br/><div class="children"><div class="content">&gt; The problem is data access. Nothing more, nothing less.<p>I agree with this, but the problem with global variables is precisely that they make bad data access patterns look easy and natural. Speaking from experience, itâs a lot easier to enforce a âno global variablesâ rule than explain to a new graduate why you wonât allow them to assign a variable in module X even though itâs OK in module Y.</div><br/><div id="42913860" class="c"><input type="checkbox" id="c-42913860" checked=""/><div class="controls bullet"><span class="by">levodelellis</span><span>|</span><a href="#42913424">parent</a><span>|</span><a href="#42915557">next</a><span>|</span><label class="collapse" for="c-42913860">[-]</label><label class="expand" for="c-42913860">[1 more]</label></div><br/><div class="children"><div class="content">You might like the article I wrote for next week. Could you tell me where this post is linked from? I didn&#x27;t think anyone would see this when no one commented the first day</div><br/></div></div></div></div><div id="42915557" class="c"><input type="checkbox" id="c-42915557" checked=""/><div class="controls bullet"><span class="by">Joel_Mckay</span><span>|</span><a href="#42913424">prev</a><span>|</span><a href="#42913315">next</a><span>|</span><label class="collapse" for="c-42915557">[-]</label><label class="expand" for="c-42915557">[1 more]</label></div><br/><div class="children"><div class="content">There are only a few use-cases where global variables make sense:<p>1. Thread container registry with mutex lock for garbage collection and inter-process communication  (children know their thread ID)<p>2. volatile system register and memory DMA use in low level cpu&#x2F;mcu (the compiler and or linker could pooch the hardware memory layout)<p>3. Performance optimized pre-cached shared-memory state-machines with non-blocking magic<p>4. OS Unikernels<p>Not sure I have seen many other valid use-cases that splatter language scopes with bad&#x2F;naive designs.  YMMV =3</div><br/></div></div><div id="42913315" class="c"><input type="checkbox" id="c-42913315" checked=""/><div class="controls bullet"><span class="by">jongjong</span><span>|</span><a href="#42915557">prev</a><span>|</span><a href="#42914843">next</a><span>|</span><label class="collapse" for="c-42913315">[-]</label><label class="expand" for="c-42913315">[1 more]</label></div><br/><div class="children"><div class="content">Agreed, global variables are fine up to a certain scale, especially if they&#x27;re only used in the main file. They only really become a problem if you start modifying them from inside different files.<p>The real underlying problem is &#x27;Spooky action at a distance&#x27;; it&#x27;s not an issue that is specific to global variables. If you pass an instance between components by-reference and its properties get modified by multiple components, it can become difficult to track where the state changes originated and that can create very nasty, difficult-to-reproduce bugs. So this can happen even if your code is fully modularized; the issue is that passing instances by reference means that the properties of that instance behave similarly to global variables as they can be modified by multiple different components&#x2F;files (without a single component being responsible for it).<p>That&#x27;s partly where the motivation for functional programming comes from; it forces pass-by-value all the time to avoid all possibility of mutations. The core value is not unique to FP though; it comes from designing components such that they have a simple interface which requires mostly primitive types as parameters. Passing objects is OK too, so long as these objects only represent structured information and their references aren&#x27;t being held onto for future transformation.<p>So for example, you can let components fully encapsulate all the &#x27;instances&#x27; which they manage and only give those parent components INFORMATION about what they have to do (without trying to micromanage their child instances); I avoid passing instances or modules to each other as it generally indicates a leaky abstraction.<p>Sometimes it takes some creativity to find a solution which doesn&#x27;t require instance-passing but when you find such solution, the benefits are usually significant and lasting. The focus should be on message-passing. Like when logging, the code will be easier to follow if all the errors from all the components bubble up to the main file (e.g. via events, streams, callbacks...) and are logged inside the main file because then any developer debugging the code can find the log inside the main file and then trade it down to its originating component.<p>Methods should be given information about what to do, they should not be given the tools to do their job... Like if you catch a taxi in real life, you don&#x27;t bring a jerrycan of petrol and a steering wheel with you to give to the taxi driver. You just provide them with information; the address of your desired destination. You trust that the Taxi driver has all the tools they need to do the job.<p>If you do really want to pass an instance to another instance to manage, then the single-responsibility principle helps limit the complexity and possibility for spooky action. It should only be passed once to initialize and then the receiving component needs to have full control&#x2F;responsibility for that child. I try to avoid as much as possible though.</div><br/></div></div><div id="42914843" class="c"><input type="checkbox" id="c-42914843" checked=""/><div class="controls bullet"><span class="by">paulsutter</span><span>|</span><a href="#42913315">prev</a><span>|</span><label class="collapse" for="c-42914843">[-]</label><label class="expand" for="c-42914843">[9 more]</label></div><br/><div class="children"><div class="content">SQL databases are global variables</div><br/><div id="42916239" class="c"><input type="checkbox" id="c-42916239" checked=""/><div class="controls bullet"><span class="by">nejsjsjsbsb</span><span>|</span><a href="#42914843">parent</a><span>|</span><a href="#42915155">next</a><span>|</span><label class="collapse" for="c-42916239">[-]</label><label class="expand" for="c-42916239">[1 more]</label></div><br/><div class="children"><div class="content">What does the ideal look like then? Data storage encapsulation in the app? Perhaps different DB users with granular access, accessed from different non-global parts of the program. Chuck in some views later when you need performance pragmatism!</div><br/></div></div><div id="42915155" class="c"><input type="checkbox" id="c-42915155" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#42914843">parent</a><span>|</span><a href="#42916239">prev</a><span>|</span><a href="#42914984">next</a><span>|</span><label class="collapse" for="c-42915155">[-]</label><label class="expand" for="c-42915155">[3 more]</label></div><br/><div class="children"><div class="content">Yes, and code that mutates them in an unmanaged way should be banned.</div><br/><div id="42915744" class="c"><input type="checkbox" id="c-42915744" checked=""/><div class="controls bullet"><span class="by">ykonstant</span><span>|</span><a href="#42914843">root</a><span>|</span><a href="#42915155">parent</a><span>|</span><a href="#42914984">next</a><span>|</span><label class="collapse" for="c-42915744">[-]</label><label class="expand" for="c-42915744">[2 more]</label></div><br/><div class="children"><div class="content">What is the managed way in this context?</div><br/><div id="42915964" class="c"><input type="checkbox" id="c-42915964" checked=""/><div class="controls bullet"><span class="by">lmm</span><span>|</span><a href="#42914843">root</a><span>|</span><a href="#42915744">parent</a><span>|</span><a href="#42914984">next</a><span>|</span><label class="collapse" for="c-42915964">[-]</label><label class="expand" for="c-42915964">[1 more]</label></div><br/><div class="children"><div class="content">Well personally I favour event sourcing and so in my systems the SQL database (if there is one) is only written to by the event rollup component. But even if you&#x27;re not that extreme you probably want to have some clear structure to where your database writes happen rather than randomly writing it from any arbitrary line of code. The important thing is to have a structure that everyone working on the code understands so that you all know where any write to the database must have come from, not the specifics of what that structure is.</div><br/></div></div></div></div></div></div><div id="42914984" class="c"><input type="checkbox" id="c-42914984" checked=""/><div class="controls bullet"><span class="by">macintux</span><span>|</span><a href="#42914843">parent</a><span>|</span><a href="#42915155">prev</a><span>|</span><a href="#42914960">next</a><span>|</span><label class="collapse" for="c-42914984">[-]</label><label class="expand" for="c-42914984">[2 more]</label></div><br/><div class="children"><div class="content">And man, the bugs they cause.</div><br/><div id="42916282" class="c"><input type="checkbox" id="c-42916282" checked=""/><div class="controls bullet"><span class="by">nejsjsjsbsb</span><span>|</span><a href="#42914843">root</a><span>|</span><a href="#42914984">parent</a><span>|</span><a href="#42914960">next</a><span>|</span><label class="collapse" for="c-42916282">[-]</label><label class="expand" for="c-42916282">[1 more]</label></div><br/><div class="children"><div class="content">Man, the bugs they prevent. Vs everyone rolling their own multithreaded file reader&#x2F;writer code in C. How many programmers would think to journal transactions and ship them for backup for example.<p>SQL or 15000 lines of C++ or Go or Rust doing whatever with files.</div><br/></div></div></div></div><div id="42914960" class="c"><input type="checkbox" id="c-42914960" checked=""/><div class="controls bullet"><span class="by">tombert</span><span>|</span><a href="#42914843">parent</a><span>|</span><a href="#42914984">prev</a><span>|</span><label class="collapse" for="c-42914960">[-]</label><label class="expand" for="c-42914960">[2 more]</label></div><br/><div class="children"><div class="content">Or caches!<p>I have gotten shit before for using global variables, and sometimes that is justified, but I almost never see anyone given shit over treating Redis as a big olâ global map.</div><br/><div id="42915822" class="c"><input type="checkbox" id="c-42915822" checked=""/><div class="controls bullet"><span class="by">moring</span><span>|</span><a href="#42914843">root</a><span>|</span><a href="#42914960">parent</a><span>|</span><label class="collapse" for="c-42915822">[-]</label><label class="expand" for="c-42915822">[1 more]</label></div><br/><div class="children"><div class="content">When it comes to &quot;patterns&quot; and &quot;anti-patterns&quot;, double standards are common.</div><br/></div></div></div></div></div></div></div></div></div></div></div></body></html>