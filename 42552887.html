<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1735635663378" as="style"/><link rel="stylesheet" href="styles.css?v=1735635663378"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://lwn.net/SubscriberLink/1003059/41b1d2ea281b6779/">The Homa Network Protocol</a> <span class="domain">(<a href="https://lwn.net">lwn.net</a>)</span></div><div class="subtext"><span>harporoeder</span> | <span>15 comments</span></div><br/><div><div id="42553716" class="c"><input type="checkbox" id="c-42553716" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#42557244">next</a><span>|</span><label class="collapse" for="c-42553716">[-]</label><label class="expand" for="c-42553716">[1 more]</label></div><br/><div class="children"><div class="content">Various previous discussions:<p>It&#x27;s time to replace TCP in the datacenter position paper  <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33401480">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=33401480</a> <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=42168997">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=42168997</a><p>Review of Homa protocol <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28204808">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28204808</a><p>Review of Linux implementation of Homa <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28440542">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=28440542</a><p>TCP vs. RPC part 1 <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34871670">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34871670</a> part 2 <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34871710">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34871710</a> part 3 <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35228716">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=35228716</a></div><br/></div></div><div id="42557244" class="c"><input type="checkbox" id="c-42557244" checked=""/><div class="controls bullet"><span class="by">mongol</span><span>|</span><a href="#42553716">prev</a><span>|</span><a href="#42553966">next</a><span>|</span><label class="collapse" for="c-42557244">[-]</label><label class="expand" for="c-42557244">[2 more]</label></div><br/><div class="children"><div class="content">What is going on in a datacenter that motivates a protocol like this? I admit I am ignorarant. Is it for internal allocation, say traffic between Kubernetes nodes, this is envisioned?</div><br/><div id="42557484" class="c"><input type="checkbox" id="c-42557484" checked=""/><div class="controls bullet"><span class="by">nine_k</span><span>|</span><a href="#42557244">parent</a><span>|</span><a href="#42553966">next</a><span>|</span><label class="collapse" for="c-42557484">[-]</label><label class="expand" for="c-42557484">[1 more]</label></div><br/><div class="children"><div class="content">AFAICT Homa is intended to let machines on the same rack, or maybe VMs on the same hardware, to talk with very low latency. It allows to start a communication with zero ceremony, and make the server code as stateless as possible, not even caring to keep a connection, but rather marking the response with the same ID as the request had, and let the receiver sort it out.</div><br/></div></div></div></div><div id="42553966" class="c"><input type="checkbox" id="c-42553966" checked=""/><div class="controls bullet"><span class="by">sesm</span><span>|</span><a href="#42557244">prev</a><span>|</span><a href="#42553766">next</a><span>|</span><label class="collapse" for="c-42553966">[-]</label><label class="expand" for="c-42553966">[6 more]</label></div><br/><div class="children"><div class="content">For broader context: SCTP is already in the kernel, solves many of the same issues and has been used in mobile core networks for decades.</div><br/><div id="42554799" class="c"><input type="checkbox" id="c-42554799" checked=""/><div class="controls bullet"><span class="by">musicale</span><span>|</span><a href="#42553966">parent</a><span>|</span><a href="#42555139">next</a><span>|</span><label class="collapse" for="c-42554799">[-]</label><label class="expand" for="c-42554799">[2 more]</label></div><br/><div class="children"><div class="content">As I understand it, SCTP is still a TCP-like stream protocol with sender-driven congestion control (using packet drops or ECN as a signal) and multipathing to deal with in-network congestion, while HOMA is aimed at fast RPC (1 packet request, 1 packet response) for short messages and has receiver-driven congestion control to deal with incast congestion at the receiver.<p>SCTP still has TCP-like slow start and other things that HOMA seeks to avoid.</div><br/><div id="42554916" class="c"><input type="checkbox" id="c-42554916" checked=""/><div class="controls bullet"><span class="by">p_l</span><span>|</span><a href="#42553966">root</a><span>|</span><a href="#42554799">parent</a><span>|</span><a href="#42555139">next</a><span>|</span><label class="collapse" for="c-42554916">[-]</label><label class="expand" for="c-42554916">[1 more]</label></div><br/><div class="children"><div class="content">SCTP is message oriented and allows explicit control over how reliable a message is. You <i>can</i> run a TCP-like stream over it but it is not required. Slow-start is unfortunately a thing. SCTP was designed with lossy networks in mind, just like other long-range network protocols, not overprovisioned pseudo ethernet with DCB.</div><br/></div></div></div></div><div id="42555139" class="c"><input type="checkbox" id="c-42555139" checked=""/><div class="controls bullet"><span class="by">mananaysiempre</span><span>|</span><a href="#42553966">parent</a><span>|</span><a href="#42554799">prev</a><span>|</span><a href="#42554699">next</a><span>|</span><label class="collapse" for="c-42555139">[-]</label><label class="expand" for="c-42555139">[1 more]</label></div><br/><div class="children"><div class="content">At least looking from the outside, SCTP is also kind of stupid in places due to its telecom origins, e.g. you get only as many data streams as you negotiated for at the start of the connection[1], because we just can’t let circuit switching go.<p>[1] <a href="https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc9260.html#name-sequenced-delivery-within-s" rel="nofollow">https:&#x2F;&#x2F;www.rfc-editor.org&#x2F;rfc&#x2F;rfc9260.html#name-sequenced-d...</a></div><br/></div></div><div id="42554699" class="c"><input type="checkbox" id="c-42554699" checked=""/><div class="controls bullet"><span class="by">zokier</span><span>|</span><a href="#42553966">parent</a><span>|</span><a href="#42555139">prev</a><span>|</span><a href="#42554710">next</a><span>|</span><label class="collapse" for="c-42554699">[-]</label><label class="expand" for="c-42554699">[1 more]</label></div><br/><div class="children"><div class="content">The connection establishment in SCTP is so much more heavyweight that I wouldn&#x27;t really put them in the same category</div><br/></div></div><div id="42554710" class="c"><input type="checkbox" id="c-42554710" checked=""/><div class="controls bullet"><span class="by">m463</span><span>|</span><a href="#42553966">parent</a><span>|</span><a href="#42554699">prev</a><span>|</span><a href="#42553766">next</a><span>|</span><label class="collapse" for="c-42554710">[-]</label><label class="expand" for="c-42554710">[1 more]</label></div><br/><div class="children"><div class="content">I haven&#x27;t heard of it, but wikipedia makes it sound interesting:<p><a href="https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Stream_Control_Transmission_Protocol" rel="nofollow">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Stream_Control_Transmission_Pr...</a></div><br/></div></div></div></div><div id="42553766" class="c"><input type="checkbox" id="c-42553766" checked=""/><div class="controls bullet"><span class="by">meltyness</span><span>|</span><a href="#42553966">prev</a><span>|</span><a href="#42554352">next</a><span>|</span><label class="collapse" for="c-42553766">[-]</label><label class="expand" for="c-42553766">[4 more]</label></div><br/><div class="children"><div class="content">Without regard to the detailed background, design or analysis, the approach of plucking a concern out of the Network&#x2F;Data Link layer (prioritization &#x2F; QoS) and moving it up to the Transport is a remarkably simple &#x2F; clever start.<p>At least that&#x27;s how I picture the start of the study of such a design.</div><br/><div id="42553889" class="c"><input type="checkbox" id="c-42553889" checked=""/><div class="controls bullet"><span class="by">wmf</span><span>|</span><a href="#42553766">parent</a><span>|</span><a href="#42554352">next</a><span>|</span><label class="collapse" for="c-42553889">[-]</label><label class="expand" for="c-42553889">[3 more]</label></div><br/><div class="children"><div class="content">Congestion control has always(ish) been in the transport layer.</div><br/><div id="42554320" class="c"><input type="checkbox" id="c-42554320" checked=""/><div class="controls bullet"><span class="by">meltyness</span><span>|</span><a href="#42553766">root</a><span>|</span><a href="#42553889">parent</a><span>|</span><a href="#42554352">next</a><span>|</span><label class="collapse" for="c-42554320">[-]</label><label class="expand" for="c-42554320">[2 more]</label></div><br/><div class="children"><div class="content">TCP congestion control is a disaster. Setting DCTCP slightly improves things but for big slow pipes it can be impossible to get near line rate. Congestion control&#x27;s intent also differs from QoS&#x2F;CoS. It&#x27;s also a &#x27;reactive&#x27; design rather than a constructive one, usually a bad sign. Not to mention that TCP is itself really complex and susceptible to receiver resource exhaustion.<p>Still getting into the reading here, but making my intuition a little bit more explicit, it seems that at least the design, but possibly the implementation of Homa actually hinges on datacenter switches QoS queues being configured with a policy to explicitly respect the receiver-assigned priorities... cool!</div><br/><div id="42554940" class="c"><input type="checkbox" id="c-42554940" checked=""/><div class="controls bullet"><span class="by">p_l</span><span>|</span><a href="#42553766">root</a><span>|</span><a href="#42554320">parent</a><span>|</span><a href="#42554352">next</a><span>|</span><label class="collapse" for="c-42554940">[-]</label><label class="expand" for="c-42554940">[1 more]</label></div><br/><div class="children"><div class="content">The Homa approach seems to lift explicit flow control from reliable networks into IP layer, the classic token buckets of IEEE 1355&#x2F;SpaceWire and also used in InfiniBand, except Homa calls them &quot;grants&quot; and permits certain default level of buffering from what I see.</div><br/></div></div></div></div></div></div></div></div><div id="42554352" class="c"><input type="checkbox" id="c-42554352" checked=""/><div class="controls bullet"><span class="by">pclmulqdq</span><span>|</span><a href="#42553766">prev</a><span>|</span><label class="collapse" for="c-42554352">[-]</label><label class="expand" for="c-42554352">[1 more]</label></div><br/><div class="children"><div class="content">Is anyone actually using Homa? I have heard that it has a few fundamental issues as described in the paper, and many people who want what Homa offers are using their own thing.</div><br/></div></div></div></div></div></div></div></body></html>