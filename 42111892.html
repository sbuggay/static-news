<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1731488470162" as="style"/><link rel="stylesheet" href="styles.css?v=1731488470162"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://gitlab.brokenpipe.de/stettberger/avremu/tree/master">Avremu: An 8-Bit AVR Microcontroller Simulator Written in LaTeX</a> <span class="domain">(<a href="https://gitlab.brokenpipe.de">gitlab.brokenpipe.de</a>)</span></div><div class="subtext"><span>nurple</span> | <span>18 comments</span></div><br/><div><div id="42118516" class="c"><input type="checkbox" id="c-42118516" checked=""/><div class="controls bullet"><span class="by">stettberger</span><span>|</span><a href="#42118046">next</a><span>|</span><label class="collapse" for="c-42118516">[-]</label><label class="expand" for="c-42118516">[5 more]</label></div><br/><div class="children"><div class="content">I had quite some fun implementing this at a very lovely lake in Sweden, while my colleagues were attending GPCE.</div><br/><div id="42118665" class="c"><input type="checkbox" id="c-42118665" checked=""/><div class="controls bullet"><span class="by">jfim</span><span>|</span><a href="#42118516">parent</a><span>|</span><a href="#42121150">next</a><span>|</span><label class="collapse" for="c-42118665">[-]</label><label class="expand" for="c-42118665">[3 more]</label></div><br/><div class="children"><div class="content">That&#x27;s absolutely hilarious, and a pretty fun hack.<p>By the way, if I understood you correctly, this sentence<p>&gt; I&#x27;m still missing 5 opcodes (MULS, MULSU, FMUL,
FMULS, FMULSU), but until now I did not encounter a C file, the
AVR-GCC emits these opcodes.<p>could be rewritten as<p>&gt; There are 5 opcodes that are not implemented (MULS, MULSU, FMUL,
FMULS, FMULSU), as I have not yet encountered a C file for which
AVR-GCC emits these opcodes.</div><br/><div id="42119485" class="c"><input type="checkbox" id="c-42119485" checked=""/><div class="controls bullet"><span class="by">couchand</span><span>|</span><a href="#42118516">root</a><span>|</span><a href="#42118665">parent</a><span>|</span><a href="#42121150">next</a><span>|</span><label class="collapse" for="c-42119485">[-]</label><label class="expand" for="c-42119485">[2 more]</label></div><br/><div class="children"><div class="content">The classic AVR instruction set does not include multiplication, you have to be targeting a device that supports AVRe+, such as an ATmega rather than an ATtiny.  Try adding -mmcu=avr5 and it will show up pretty quick.  Example: <a href="https:&#x2F;&#x2F;godbolt.org&#x2F;z&#x2F;x951M8fn8" rel="nofollow">https:&#x2F;&#x2F;godbolt.org&#x2F;z&#x2F;x951M8fn8</a><p>Edit: nice work author, I love it!</div><br/><div id="42122028" class="c"><input type="checkbox" id="c-42122028" checked=""/><div class="controls bullet"><span class="by">kevin_thibedeau</span><span>|</span><a href="#42118516">root</a><span>|</span><a href="#42119485">parent</a><span>|</span><a href="#42121150">next</a><span>|</span><label class="collapse" for="c-42122028">[-]</label><label class="expand" for="c-42122028">[1 more]</label></div><br/><div class="children"><div class="content">&gt; rather than an ATtiny<p>The new ATtiny 0&#x2F;1&#x2F;2-series parts are full AVRxt cores with a few instructions removed due to lack of need for large memory access. The classic terminology differentiating product lines isn&#x27;t particularly useful anymore. ATtiny can multiply now.</div><br/></div></div></div></div></div></div><div id="42121150" class="c"><input type="checkbox" id="c-42121150" checked=""/><div class="controls bullet"><span class="by">tzs</span><span>|</span><a href="#42118516">parent</a><span>|</span><a href="#42118665">prev</a><span>|</span><a href="#42118046">next</a><span>|</span><label class="collapse" for="c-42121150">[-]</label><label class="expand" for="c-42121150">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I had quite some fun implementing this at a very lovely lake in Sweden<p>Was there a wonderful telephone system and many interesting furry animals?</div><br/></div></div></div></div><div id="42118046" class="c"><input type="checkbox" id="c-42118046" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#42118516">prev</a><span>|</span><a href="#42118182">next</a><span>|</span><label class="collapse" for="c-42118046">[-]</label><label class="expand" for="c-42118046">[1 more]</label></div><br/><div class="children"><div class="content">Related:<p><i>Avremu: An AVR Emulator Written in Pure LaTeX</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=13126595">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=13126595</a> - Dec 2016 (29 comments)<p><i>Show HN: Avremu – An 8-Bit Microcontroller in Pure LaTeX</i> - <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8448322">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8448322</a> - Oct 2014 (18 comments)</div><br/></div></div><div id="42118182" class="c"><input type="checkbox" id="c-42118182" checked=""/><div class="controls bullet"><span class="by">mmastrac</span><span>|</span><a href="#42118046">prev</a><span>|</span><a href="#42122507">next</a><span>|</span><label class="collapse" for="c-42118182">[-]</label><label class="expand" for="c-42118182">[1 more]</label></div><br/><div class="children"><div class="content">I love whimsy.<p>&gt; You are writing an CPU emulator in TeX, the TYPESETTING system?<p>Yep.<p>&gt; Are you insane?<p>Not that anybody knows of.</div><br/></div></div><div id="42122507" class="c"><input type="checkbox" id="c-42122507" checked=""/><div class="controls bullet"><span class="by">heraclius1729</span><span>|</span><a href="#42118182">prev</a><span>|</span><a href="#42122805">next</a><span>|</span><label class="collapse" for="c-42122507">[-]</label><label class="expand" for="c-42122507">[1 more]</label></div><br/><div class="children"><div class="content">The fact that you can do stuff like this with a typesetting system has always amused me. Back when I was in grad school for mechanical engineering, some other people in my research group were doing computational mechanics. We would always joke about writing all their simulations in TeX, so that the TeX file for their paper would include all of the simulation code too, and rebuilding the document would run all the simulations and generate the plots.</div><br/></div></div><div id="42122805" class="c"><input type="checkbox" id="c-42122805" checked=""/><div class="controls bullet"><span class="by">em3rgent0rdr</span><span>|</span><a href="#42122507">prev</a><span>|</span><a href="#42119973">next</a><span>|</span><label class="collapse" for="c-42122805">[-]</label><label class="expand" for="c-42122805">[1 more]</label></div><br/><div class="children"><div class="content">Next up: running LaTeX on an 8-Bit AVR, simulated inside LaTeX.</div><br/></div></div><div id="42119973" class="c"><input type="checkbox" id="c-42119973" checked=""/><div class="controls bullet"><span class="by">leni536</span><span>|</span><a href="#42122805">prev</a><span>|</span><a href="#42119119">next</a><span>|</span><label class="collapse" for="c-42119973">[-]</label><label class="expand" for="c-42119973">[1 more]</label></div><br/><div class="children"><div class="content">I guess postscript could be an other interesting target, so you could run your emulated C code on some printers.</div><br/></div></div><div id="42119119" class="c"><input type="checkbox" id="c-42119119" checked=""/><div class="controls bullet"><span class="by">marcodiego</span><span>|</span><a href="#42119973">prev</a><span>|</span><a href="#42121939">next</a><span>|</span><label class="collapse" for="c-42119119">[-]</label><label class="expand" for="c-42119119">[1 more]</label></div><br/><div class="children"><div class="content">Now, let&#x27;s get that 8bit microcontroller running Linux and run Linux inside a LaTeX document.</div><br/></div></div><div id="42121939" class="c"><input type="checkbox" id="c-42121939" checked=""/><div class="controls bullet"><span class="by">RangeError</span><span>|</span><a href="#42119119">prev</a><span>|</span><a href="#42119750">next</a><span>|</span><label class="collapse" for="c-42121939">[-]</label><label class="expand" for="c-42121939">[1 more]</label></div><br/><div class="children"><div class="content">&gt; Are you insane?<p>That&#x27;s quite funny.</div><br/></div></div><div id="42119750" class="c"><input type="checkbox" id="c-42119750" checked=""/><div class="controls bullet"><span class="by">kjs3</span><span>|</span><a href="#42121939">prev</a><span>|</span><a href="#42118268">next</a><span>|</span><label class="collapse" for="c-42119750">[-]</label><label class="expand" for="c-42119750">[1 more]</label></div><br/><div class="children"><div class="content">Nifty.  If you&#x27;re going to really nail the side-project, go weird or go home. <i>chef kiss</i></div><br/></div></div><div id="42118268" class="c"><input type="checkbox" id="c-42118268" checked=""/><div class="controls bullet"><span class="by">leonheld</span><span>|</span><a href="#42119750">prev</a><span>|</span><a href="#42118088">next</a><span>|</span><label class="collapse" for="c-42118268">[-]</label><label class="expand" for="c-42118268">[3 more]</label></div><br/><div class="children"><div class="content">Had to read the title 3 times.<p>It&#x27;s... actually readable? For example <a href="https:&#x2F;&#x2F;gitlab.brokenpipe.de&#x2F;stettberger&#x2F;avremu&#x2F;-&#x2F;blob&#x2F;master&#x2F;source&#x2F;simple-testsuite.tex" rel="nofollow">https:&#x2F;&#x2F;gitlab.brokenpipe.de&#x2F;stettberger&#x2F;avremu&#x2F;-&#x2F;blob&#x2F;maste...</a> hits me as a very usual pattern to write emulators.</div><br/><div id="42118493" class="c"><input type="checkbox" id="c-42118493" checked=""/><div class="controls bullet"><span class="by">Lerc</span><span>|</span><a href="#42118268">parent</a><span>|</span><a href="#42118781">next</a><span>|</span><label class="collapse" for="c-42118493">[-]</label><label class="expand" for="c-42118493">[1 more]</label></div><br/><div class="children"><div class="content">I made an AVR emulator in Haxe&#x2F;JavaScript.<p>It turned out to be more awkward than I expected.  Most 8-bit processors have instructions fairly clearly specified in the first byte.  So the bulk of the decoding work can be done with a small jump table. The avr is more bit packed.  Due to the way I progressively implemented the instructions I ended up with a kind-of tree of case statements.  At some stage I&#x27;d like to go back and have a converter to a larger but easier to decode format. Instructions being in ROM(ish) and being easy to detect when updated means AOT is easy enough to do.<p>It might only need 32 bits per instruction. Opcode in the first byte and then byte aligned operands.</div><br/></div></div></div></div><div id="42118088" class="c"><input type="checkbox" id="c-42118088" checked=""/><div class="controls bullet"><span class="by">dang</span><span>|</span><a href="#42118268">prev</a><span>|</span><label class="collapse" for="c-42118088">[-]</label><label class="expand" for="c-42118088">[1 more]</label></div><br/><div class="children"><div class="content">(Url changed from <a href="https:&#x2F;&#x2F;ctan.org&#x2F;texarchive&#x2F;macros&#x2F;latex&#x2F;contrib&#x2F;avremu" rel="nofollow">https:&#x2F;&#x2F;ctan.org&#x2F;texarchive&#x2F;macros&#x2F;latex&#x2F;contrib&#x2F;avremu</a>, which points to this.)</div><br/></div></div></div></div></div></div></div></body></html>