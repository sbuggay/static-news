<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1723453264502" as="style"/><link rel="stylesheet" href="styles.css?v=1723453264502"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://hackmd.gfuzz.de/s/Qsk14kc3i">OpenBSD 7.5 via QEMU on Hetzner physical machine (no phys. access / KVM console)</a> <span class="domain">(<a href="https://hackmd.gfuzz.de">hackmd.gfuzz.de</a>)</span></div><div class="subtext"><span>hoschi_</span> | <span>21 comments</span></div><br/><div><div id="41219391" class="c"><input type="checkbox" id="c-41219391" checked=""/><div class="controls bullet"><span class="by">clan</span><span>|</span><a href="#41220141">next</a><span>|</span><label class="collapse" for="c-41219391">[-]</label><label class="expand" for="c-41219391">[3 more]</label></div><br/><div class="children"><div class="content">Nice write-up. It should really not be that hard but unfortunately it is. And it is getting worse.<p>It made me sad to see that Hetzner had discontinued the FreeBSD rescue system. But it seems to be correct:
<a href="https:&#x2F;&#x2F;community.hetzner.com&#x2F;tutorials&#x2F;freebsd-openzfs-via-linux-rescue" rel="nofollow">https:&#x2F;&#x2F;community.hetzner.com&#x2F;tutorials&#x2F;freebsd-openzfs-via-...</a><p>How much did it really cost them to have the mfsbsd image available?</div><br/><div id="41222220" class="c"><input type="checkbox" id="c-41222220" checked=""/><div class="controls bullet"><span class="by">ninjin</span><span>|</span><a href="#41219391">parent</a><span>|</span><a href="#41219782">next</a><span>|</span><label class="collapse" for="c-41222220">[-]</label><label class="expand" for="c-41222220">[1 more]</label></div><br/><div class="children"><div class="content">Well, an alternative approach for their bare metal boxes is to request a KVM and link whatever image you in the KVM request form. They will then download it, put it into a USB stick, and plug in the KVM and USB stick. In my experience, you will have it all set up within the hour.<p>This is of course easier (although the KVM software is a heap of proprietary arse with a web interface or ancient Java blob), but if you are truly paranoid you will have to trust the Hetzner staff and their software stack not to bring something undesired along with your provided image.</div><br/></div></div><div id="41219782" class="c"><input type="checkbox" id="c-41219782" checked=""/><div class="controls bullet"><span class="by">networked</span><span>|</span><a href="#41219391">parent</a><span>|</span><a href="#41222220">prev</a><span>|</span><a href="#41220141">next</a><span>|</span><label class="collapse" for="c-41219782">[-]</label><label class="expand" for="c-41219782">[1 more]</label></div><br/><div class="children"><div class="content">For Hetzner and other dedicated servers, there is a prepackaged script to bootstrap FreeBSD from Linux: <a href="https:&#x2F;&#x2F;depenguin.me&#x2F;" rel="nofollow">https:&#x2F;&#x2F;depenguin.me&#x2F;</a>.</div><br/></div></div></div></div><div id="41220141" class="c"><input type="checkbox" id="c-41220141" checked=""/><div class="controls bullet"><span class="by">benlivengood</span><span>|</span><a href="#41219391">prev</a><span>|</span><a href="#41219960">next</a><span>|</span><label class="collapse" for="c-41220141">[-]</label><label class="expand" for="c-41220141">[4 more]</label></div><br/><div class="children"><div class="content">I tried a couple times to get OpenBSD 7.4 and 7.5 booting on EC2 and GCE with no luck (hang during the bootloader).  I ended up going with <a href="https:&#x2F;&#x2F;openbsd.amsterdam" rel="nofollow">https:&#x2F;&#x2F;openbsd.amsterdam</a> but it would be nice to have working images in the major cloud providers.</div><br/><div id="41222181" class="c"><input type="checkbox" id="c-41222181" checked=""/><div class="controls bullet"><span class="by">mvdwoord</span><span>|</span><a href="#41220141">parent</a><span>|</span><a href="#41221755">next</a><span>|</span><label class="collapse" for="c-41222181">[-]</label><label class="expand" for="c-41222181">[1 more]</label></div><br/><div class="children"><div class="content">Hi there neighbor!<p>Ended up there for more or less the same reason. Shame there isn&#x27;t more hosted BSD options around.</div><br/></div></div><div id="41221755" class="c"><input type="checkbox" id="c-41221755" checked=""/><div class="controls bullet"><span class="by">CodeCompost</span><span>|</span><a href="#41220141">parent</a><span>|</span><a href="#41222181">prev</a><span>|</span><a href="#41220258">next</a><span>|</span><label class="collapse" for="c-41221755">[-]</label><label class="expand" for="c-41221755">[1 more]</label></div><br/><div class="children"><div class="content">Just out of curiosity, what are you running on OpenBSD?</div><br/></div></div><div id="41220258" class="c"><input type="checkbox" id="c-41220258" checked=""/><div class="controls bullet"><span class="by">_n_b_</span><span>|</span><a href="#41220141">parent</a><span>|</span><a href="#41221755">prev</a><span>|</span><a href="#41219960">next</a><span>|</span><label class="collapse" for="c-41220258">[-]</label><label class="expand" for="c-41220258">[1 more]</label></div><br/><div class="children"><div class="content">Vultr has OpenBSD images too.</div><br/></div></div></div></div><div id="41219960" class="c"><input type="checkbox" id="c-41219960" checked=""/><div class="controls bullet"><span class="by">Cyph0n</span><span>|</span><a href="#41220141">prev</a><span>|</span><a href="#41219583">next</a><span>|</span><label class="collapse" for="c-41219960">[-]</label><label class="expand" for="c-41219960">[3 more]</label></div><br/><div class="children"><div class="content">nixos-anywhere is a tool that allows you to do something similar (?) to install NixOS in-place on a remote machine (using kexec “magic” under the hood).<p><a href="https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-anywhere">https:&#x2F;&#x2F;github.com&#x2F;nix-community&#x2F;nixos-anywhere</a><p>I tried it on a Hetzner VPS and was honestly pretty surprised that it even worked. What makes it even cooler is that you can continue to rebuild the machine’s config remotely even after initialization (thanks to NixOS).</div><br/><div id="41222507" class="c"><input type="checkbox" id="c-41222507" checked=""/><div class="controls bullet"><span class="by">irusensei</span><span>|</span><a href="#41219960">parent</a><span>|</span><a href="#41221230">next</a><span>|</span><label class="collapse" for="c-41222507">[-]</label><label class="expand" for="c-41222507">[1 more]</label></div><br/><div class="children"><div class="content">Hetzner offer Nixos isos. I got an arm server there running 24.05.</div><br/></div></div><div id="41221230" class="c"><input type="checkbox" id="c-41221230" checked=""/><div class="controls bullet"><span class="by">e3bc54b2</span><span>|</span><a href="#41219960">parent</a><span>|</span><a href="#41222507">prev</a><span>|</span><a href="#41219583">next</a><span>|</span><label class="collapse" for="c-41221230">[-]</label><label class="expand" for="c-41221230">[1 more]</label></div><br/><div class="children"><div class="content">I recently finally rented a VPS from Hetzner,  and to my pleasant surprise was done and ready with <i>my</i> config (shell, utils, services) in under 5 minutes. It took me longer to read about nixos-anywhere and disko in aggregate. NixOS lends itself pretty well to these kinds of magic works.</div><br/></div></div></div></div><div id="41219583" class="c"><input type="checkbox" id="c-41219583" checked=""/><div class="controls bullet"><span class="by">accrual</span><span>|</span><a href="#41219960">prev</a><span>|</span><a href="#41220357">next</a><span>|</span><label class="collapse" for="c-41219583">[-]</label><label class="expand" for="c-41219583">[4 more]</label></div><br/><div class="children"><div class="content">Pretty clever to boot a virtual QEMU VM and pass through the physical disks for installation. Nice that it can be done without a support request.</div><br/><div id="41221408" class="c"><input type="checkbox" id="c-41221408" checked=""/><div class="controls bullet"><span class="by">Nextgrid</span><span>|</span><a href="#41219583">parent</a><span>|</span><a href="#41219948">next</a><span>|</span><label class="collapse" for="c-41221408">[-]</label><label class="expand" for="c-41221408">[1 more]</label></div><br/><div class="children"><div class="content">I once did similar black magic to have a dual-OS set up (Linux &amp; Windows) where the _same_ Linux OS can be either booted into or ran in a VirtualBox VM from within Windows. I probably spent more time reading about it &amp; getting it to work than I ever actually used the OS, but it was a fun learning experience.</div><br/></div></div><div id="41219948" class="c"><input type="checkbox" id="c-41219948" checked=""/><div class="controls bullet"><span class="by">sureglymop</span><span>|</span><a href="#41219583">parent</a><span>|</span><a href="#41221408">prev</a><span>|</span><a href="#41220357">next</a><span>|</span><label class="collapse" for="c-41219948">[-]</label><label class="expand" for="c-41219948">[2 more]</label></div><br/><div class="children"><div class="content">Did the same to install Proxmox. Pretty straightforward though I probably wouldn&#x27;t have thought of it myself had I not read about it.</div><br/><div id="41220085" class="c"><input type="checkbox" id="c-41220085" checked=""/><div class="controls bullet"><span class="by">notarealllama</span><span>|</span><a href="#41219583">root</a><span>|</span><a href="#41219948">parent</a><span>|</span><a href="#41220357">next</a><span>|</span><label class="collapse" for="c-41220085">[-]</label><label class="expand" for="c-41220085">[1 more]</label></div><br/><div class="children"><div class="content">Struggling right now setting up various qemu on a hetzner, specifically with IPv6 on bridges etc. I used to have Proxmox servers for work before but never had to worry about networking.<p>Any issues or recommendations considering the Proxmox route? You do port forwarding or multiple ipv4?<p>Thanks for putting this idea in my head!</div><br/></div></div></div></div></div></div><div id="41220357" class="c"><input type="checkbox" id="c-41220357" checked=""/><div class="controls bullet"><span class="by">anyfoo</span><span>|</span><a href="#41219583">prev</a><span>|</span><a href="#41221254">next</a><span>|</span><label class="collapse" for="c-41220357">[-]</label><label class="expand" for="c-41220357">[1 more]</label></div><br/><div class="children"><div class="content">Website seems to have gotten HN’s hit of death, but the headline sounds fun.<p>I’ve also got OpenBSD 7.5 running on a Hetzner server, but it runs “natively”. By which I mean it’s still a VM from Hetzner, but I don’t have my own nested QEMU layer or anything.</div><br/></div></div><div id="41221254" class="c"><input type="checkbox" id="c-41221254" checked=""/><div class="controls bullet"><span class="by">dvzk</span><span>|</span><a href="#41220357">prev</a><span>|</span><a href="#41218738">next</a><span>|</span><label class="collapse" for="c-41221254">[-]</label><label class="expand" for="c-41221254">[3 more]</label></div><br/><div class="children"><div class="content">QEMU most likely is not required. OpenBSD&#x27;s installer is inside a single 4.5 MiB [1] ramdisk kernel image. Chainload or netboot it, or download the ramdisk to ffs on sd0 and run installboot [2]. Once the ramdisk kernel is loaded you can erase the disk containing it.<p>1. <a href="https:&#x2F;&#x2F;cdn.openbsd.org&#x2F;pub&#x2F;OpenBSD&#x2F;7.5&#x2F;amd64&#x2F;bsd.rd" rel="nofollow">https:&#x2F;&#x2F;cdn.openbsd.org&#x2F;pub&#x2F;OpenBSD&#x2F;7.5&#x2F;amd64&#x2F;bsd.rd</a><p>2. installboot also needs &#x2F;usr&#x2F;mdec&#x2F;biosboot and &#x2F;usr&#x2F;mdec&#x2F;boot from base75.tgz.</div><br/><div id="41222204" class="c"><input type="checkbox" id="c-41222204" checked=""/><div class="controls bullet"><span class="by">ninjin</span><span>|</span><a href="#41221254">parent</a><span>|</span><a href="#41218738">next</a><span>|</span><label class="collapse" for="c-41222204">[-]</label><label class="expand" for="c-41222204">[2 more]</label></div><br/><div class="children"><div class="content">At least for Hetzner&#x27;s VPS, I get away with the following and then a reboot:<p><pre><code>    wget -O - https:&#x2F;&#x2F;cdn.openbsd.org&#x2F;pub&#x2F;OpenBSD&#x2F;X.Y&#x2F;arm64&#x2F;minirootXY.img |
        dd if=&#x2F;dev&#x2F;stdin of=&#x2F;dev&#x2F;sda</code></pre></div><br/><div id="41222390" class="c"><input type="checkbox" id="c-41222390" checked=""/><div class="controls bullet"><span class="by">ralferoo</span><span>|</span><a href="#41221254">root</a><span>|</span><a href="#41222204">parent</a><span>|</span><a href="#41218738">next</a><span>|</span><label class="collapse" for="c-41222390">[-]</label><label class="expand" for="c-41222390">[1 more]</label></div><br/><div class="children"><div class="content">This is presumably fine for an initial install, as long as it auto-configures correctly via DHCP.<p>However, if you ever have issues and need a rescue image, you&#x27;d need to figure out how to do something like the OP, and do it while learning how to do it for the first time rather than having had a practice run when you first installed it.</div><br/></div></div></div></div></div></div><div id="41220738" class="c"><input type="checkbox" id="c-41220738" checked=""/><div class="controls bullet"><span class="by">dtx1</span><span>|</span><a href="#41218738">prev</a><span>|</span><label class="collapse" for="c-41220738">[-]</label><label class="expand" for="c-41220738">[1 more]</label></div><br/><div class="children"><div class="content">Linux&#x2F;Unix Kernels allow you to do some insane stuff. My best current example was swap on VRAM but this is even better.</div><br/></div></div></div></div></div></div></div></body></html>