<!DOCTYPE html><html lang="en"><head><title>Static News</title><meta charSet="utf-8"/><meta name="description" content="Static delayed Hacker News."/><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1d1f21"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="application-name" content="Static News"/><meta name="apple-mobile-web-app-title" content="Static News"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#1d1f21"/><link rel="preload" href="styles.css?v=1711098068509" as="style"/><link rel="stylesheet" href="styles.css?v=1711098068509"/></head><body><div id="container"><div id="inner"><header><a href="/">Static News</a><a href="/about">about</a></header><div id="content"><div><div id="title"><a href="https://www.pgrs.net/2024/03/21/duckdb-as-the-new-jq/">DuckDB as the New jq</a> <span class="domain">(<a href="https://www.pgrs.net">www.pgrs.net</a>)</span></div><div class="subtext"><span>pgr0ss</span> | <span>41 comments</span></div><br/><div><div id="39785829" class="c"><input type="checkbox" id="c-39785829" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#39786307">next</a><span>|</span><label class="collapse" for="c-39785829">[-]</label><label class="expand" for="c-39785829">[10 more]</label></div><br/><div class="children"><div class="content">The most effective combination I&#x27;ve found so far is jq + basic shell tools.<p>I still think jq&#x27;s syntax and data model is unbelievably elegant and powerful once you get the hang of it - but its &quot;standard library&quot; is unfortunately sorely lacking in many places and has some awkward design choices in others, which means that a lot of practical everyday tasks - such as aggregations or even just set membership - are a lot more complicated than they ought to be.<p>Luckily, what jq can do <i>really well</i> is bringing data of interest into a line-based text representation, which is ideal for all kinds of standard unix shell tools - so you can just use those to take over the parts of your pipeline that would be hard to do in &quot;pure&quot; jq.<p>So I think my solution to the OP&#x27;s task - get all distinct OSS licenses from the project list and count usages for each one - would be:<p>curl ... | jq &#x27;.[].license.key&#x27; | sort | uniq -c<p>That&#x27;s it.</div><br/><div id="39785906" class="c"><input type="checkbox" id="c-39785906" checked=""/><div class="controls bullet"><span class="by">pcthrowaway</span><span>|</span><a href="#39785829">parent</a><span>|</span><a href="#39786378">next</a><span>|</span><label class="collapse" for="c-39785906">[-]</label><label class="expand" for="c-39785906">[2 more]</label></div><br/><div class="children"><div class="content">&gt; I still think jq&#x27;s syntax and data model is unbelievably elegant and powerful once you get the hang of it - but its &quot;standard library&quot; is unfortunately sorely lacking in many places<p>After a few years of stalled development, jq has been taken over recently by a new team of maintainers and is rapidly working through a lot of longstanding issues (<a href="https:&#x2F;&#x2F;github.com&#x2F;jqlang&#x2F;jq">https:&#x2F;&#x2F;github.com&#x2F;jqlang&#x2F;jq</a>), so I&#x27;m not sure if this is still the case</div><br/><div id="39785956" class="c"><input type="checkbox" id="c-39785956" checked=""/><div class="controls bullet"><span class="by">xg15</span><span>|</span><a href="#39785829">root</a><span>|</span><a href="#39785906">parent</a><span>|</span><a href="#39786378">next</a><span>|</span><label class="collapse" for="c-39785956">[-]</label><label class="expand" for="c-39785956">[1 more]</label></div><br/><div class="children"><div class="content">Wasn&#x27;t aware of that, that&#x27;s great to hear! I think if there is one utility that deserves a great maintainer team then this one. But if we saw some actual improvements in the future, that would be awesome!<p>I have a list of pet peeves that I&#x27;d really like to see fixed, so I&#x27;m gonna risk a bit of hope.</div><br/></div></div></div></div><div id="39786378" class="c"><input type="checkbox" id="c-39786378" checked=""/><div class="controls bullet"><span class="by">salmo</span><span>|</span><a href="#39785829">parent</a><span>|</span><a href="#39785906">prev</a><span>|</span><a href="#39786364">next</a><span>|</span><label class="collapse" for="c-39786378">[-]</label><label class="expand" for="c-39786378">[5 more]</label></div><br/><div class="children"><div class="content">As an old Unix guy this is exactly how I see jq: a gateway to a fantastic library of text processing tools.  I see a lot of complicated things done inside the language, which is a valid approach.  But I don’t need it to be a programming language itself, just a transform to meet my next command after the pipe.<p>If I want logic beyond that, then I skip the shell and write “real” software.<p>I personally find those both to be more readable and easier to fit in my head than long complex jq expressions.  But that’s completely subjective and others may find the jq expression language easier to read than shell or (choose your programming language).</div><br/><div id="39786986" class="c"><input type="checkbox" id="c-39786986" checked=""/><div class="controls bullet"><span class="by">digdugdirk</span><span>|</span><a href="#39785829">root</a><span>|</span><a href="#39786378">parent</a><span>|</span><a href="#39786364">next</a><span>|</span><label class="collapse" for="c-39786986">[-]</label><label class="expand" for="c-39786986">[4 more]</label></div><br/><div class="children"><div class="content">Your comment made me go look up jq (even more than the article did) and the first paragraph of the repo [0] feels like a secret club&#x27;s secret language.<p>I&#x27;m very interested, but not a Linux person, do you know of any good resources for learning the Linux shell as a programming language?<p>[0] <a href="https:&#x2F;&#x2F;jqlang.github.io&#x2F;jq&#x2F;" rel="nofollow">https:&#x2F;&#x2F;jqlang.github.io&#x2F;jq&#x2F;</a></div><br/><div id="39787137" class="c"><input type="checkbox" id="c-39787137" checked=""/><div class="controls bullet"><span class="by">salmo</span><span>|</span><a href="#39785829">root</a><span>|</span><a href="#39786986">parent</a><span>|</span><a href="#39788428">next</a><span>|</span><label class="collapse" for="c-39787137">[-]</label><label class="expand" for="c-39787137">[1 more]</label></div><br/><div class="children"><div class="content">I’ll say, I did shell scripting for years from copy&#x2F;paste, cribbing smarter people, and reading online guides.  But I didn’t really understand until I read The Unix Programming Environment by Brian Kernighan and Rob Pike.<p>It’s a very old book and the audience was using dumb terminals.  But it made me understand why and how.  I think I’ve read every Kernighan book at this point and most he was involved in because he is just so amazing and not just conveying facts, but teaching how to think idiomatically in the topic.<p>I also used awk for 2 decades, kind of like how I use jq now.  But when I read his memoir I suddenly “got it.”  What I make with it now is intentional and not just me banging on the keyboard until it works.  A great middle ground for something a little sophisticated, but not worth writing a full program for.<p>Something else that helped me was to install a minimal distro… actually a base FreeBSD install would be great… and read the man pages for all the commands.  I don’t remember the details, but I learned that things existed.  I have many man pages that I look at the same options on every few months because I’m not positive I remember right.  Heck, I ‘man test’ all the time still. (‘test’ and ‘[‘ are the same thing)<p>I also had an advantage of 2 great coworkers.  They’d been working on Unix since the 80s and their feedback helped me be more efficient, clean, and avoid “useless use of cat” problems.<p>I also highly recommend using shellcheck.  I sometimes disagree with it when I’m intentionally abusing shell behavior, but it’s a great way to train good habits and prevent bugs that only crop up with bad input, scale, etc.  I get new devs to use it and it’s helped them “ramp up” quickly, with me explaining the “why” from time to time.<p>But yeah.  The biggest problem I see is that people think there is more syntax than there really is (like my test and [ comment).  And remember it’s all text, processes, and files.  Except when we pretend it’s not ;).</div><br/></div></div><div id="39788428" class="c"><input type="checkbox" id="c-39788428" checked=""/><div class="controls bullet"><span class="by">coldtea</span><span>|</span><a href="#39785829">root</a><span>|</span><a href="#39786986">parent</a><span>|</span><a href="#39787137">prev</a><span>|</span><a href="#39787210">next</a><span>|</span><label class="collapse" for="c-39788428">[-]</label><label class="expand" for="c-39788428">[1 more]</label></div><br/><div class="children"><div class="content">&gt;<i>Your comment made me go look up jq (even more than the article did) and the first paragraph of the repo [0] feels like a secret club&#x27;s secret language.</i><p>Or one of the most old standing widespread clubs of computing open standard language :)<p>&quot;jq is like sed for JSON data - you can use it to slice and filter and map and transform structured data with the same ease that sed, awk, grep and friends let you play with text.&quot;<p>Translation:<p>JQ is like a (UNIX&#x2F;POSIX staple command line text-manipulation tool) but specialized for text structured in JSON format. You can use it to extract parts of a JSON document (slice), keep nodes based on some criteria (filter), transform each element in a list of structured data to get a new list with the transformed versions (map), and do that as easily as you can with the sed (basic command line text manipulation program), awk (command line text manipulation program with a full featured text-processing oriented language), grep (command line program to search for strings), and other assorted unix userland programs.</div><br/></div></div><div id="39787210" class="c"><input type="checkbox" id="c-39787210" checked=""/><div class="controls bullet"><span class="by">NortySpock</span><span>|</span><a href="#39785829">root</a><span>|</span><a href="#39786986">parent</a><span>|</span><a href="#39788428">prev</a><span>|</span><a href="#39786364">next</a><span>|</span><label class="collapse" for="c-39787210">[-]</label><label class="expand" for="c-39787210">[1 more]</label></div><br/><div class="children"><div class="content">So, grab yourself a Linux box (I suggest Debian), a large CSV file or JSON lines file you need to slice up, and an hour of time, and start trying out some bash one-liners on your data. Set some goals like &quot;find the Yahoo email addresses in the data and sort by frequency&quot; or &quot;find error messages that look like X&quot; or &quot;find how many times Ben Franklin mentions his wife in his autobiography&quot;<p>Here&#x27;s the thing. These tools have been used since the &#x27;70s to slice, dice and filter log files, CSVs, or other semi-structured data. They can be chained together with the pipe command. Sys admins were going through 100MB logs with these tools before CPUs hit the gigahertz<p>These tools are blisteringly fast, and they are basically installed on every Linux machine.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;onceupon&#x2F;Bash-Oneliner">https:&#x2F;&#x2F;github.com&#x2F;onceupon&#x2F;Bash-Oneliner</a><p>And for a different play-by-play example:<p><a href="https:&#x2F;&#x2F;adamdrake.com&#x2F;command-line-tools-can-be-235x-faster-than-your-hadoop-cluster.html" rel="nofollow">https:&#x2F;&#x2F;adamdrake.com&#x2F;command-line-tools-can-be-235x-faster-...</a></div><br/></div></div></div></div></div></div><div id="39786364" class="c"><input type="checkbox" id="c-39786364" checked=""/><div class="controls bullet"><span class="by">eru</span><span>|</span><a href="#39785829">parent</a><span>|</span><a href="#39786378">prev</a><span>|</span><a href="#39786140">next</a><span>|</span><label class="collapse" for="c-39786364">[-]</label><label class="expand" for="c-39786364">[1 more]</label></div><br/><div class="children"><div class="content">&gt; I still think jq&#x27;s syntax and data model is unbelievably elegant and powerful once you get the hang of it [...]<p>It&#x27;s basically just functional programming.  (Or what you would get from a functional programmer given the task of writing such a tool as jq.)<p>That&#x27;s not to diminish jq, it&#x27;s a great tool.  I love it!</div><br/></div></div><div id="39786140" class="c"><input type="checkbox" id="c-39786140" checked=""/><div class="controls bullet"><span class="by">jimbokun</span><span>|</span><a href="#39785829">parent</a><span>|</span><a href="#39786364">prev</a><span>|</span><a href="#39786307">next</a><span>|</span><label class="collapse" for="c-39786140">[-]</label><label class="expand" for="c-39786140">[1 more]</label></div><br/><div class="children"><div class="content">The Unix philosophy continues to pass the test of time.</div><br/></div></div></div></div><div id="39786307" class="c"><input type="checkbox" id="c-39786307" checked=""/><div class="controls bullet"><span class="by">ndr</span><span>|</span><a href="#39785829">prev</a><span>|</span><a href="#39784942">next</a><span>|</span><label class="collapse" for="c-39786307">[-]</label><label class="expand" for="c-39786307">[1 more]</label></div><br/><div class="children"><div class="content">If you like lisp, and especially clojure, check out babashka[0]. This my first attempt but I bet you can do something nicer even if you keep forcing yourself to stay into a single pipe command.<p><pre><code>  cat repos.json | bb -e &#x27; (-&gt;&gt; (-&gt; *in* slurp (json&#x2F;parse-string true))
                                (group-by #(-&gt; % :license :key))
                                (map #(-&gt; {:license (key %)
                                           :count (-&gt; % val count)}))
                                json&#x2F;generate-string
                                println)&#x27;

</code></pre>
[0] <a href="https:&#x2F;&#x2F;babashka.org&#x2F;" rel="nofollow">https:&#x2F;&#x2F;babashka.org&#x2F;</a></div><br/></div></div><div id="39784942" class="c"><input type="checkbox" id="c-39784942" checked=""/><div class="controls bullet"><span class="by">hu3</span><span>|</span><a href="#39786307">prev</a><span>|</span><a href="#39784328">next</a><span>|</span><label class="collapse" for="c-39784942">[-]</label><label class="expand" for="c-39784942">[3 more]</label></div><br/><div class="children"><div class="content">Related, clickhouse local cli command is a speed demon to parse and query JSON and other formats such as CSV:<p>- &quot;The world’s fastest tool for querying JSON files&quot; <a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;worlds-fastest-json-querying-tool-clickhouse-local" rel="nofollow">https:&#x2F;&#x2F;clickhouse.com&#x2F;blog&#x2F;worlds-fastest-json-querying-too...</a><p>- &quot;Show HN: ClickHouse-local – a small tool for serverless data analytics&quot; <a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34265206">https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=34265206</a></div><br/><div id="39785472" class="c"><input type="checkbox" id="c-39785472" checked=""/><div class="controls bullet"><span class="by">mightybyte</span><span>|</span><a href="#39784942">parent</a><span>|</span><a href="#39784328">next</a><span>|</span><label class="collapse" for="c-39785472">[-]</label><label class="expand" for="c-39785472">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ll second this.  Clickhouse is amazing.  I was actually using it today to query some CSV files.  I had to refresh my memory on the syntax so if anyone is interested:<p><pre><code>  clickhouse local -q &quot;SELECT foo, sum(bar) FROM file(&#x27;foobar.csv&#x27;, CSV) GROUP BY foo FORMAT Pretty&quot;
</code></pre>
Way easier than opening in Excel and creating a pivot table which was my previous workflow.<p>Here&#x27;s a list of the different input and output formats that it supports.<p><a href="https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;interfaces&#x2F;formats" rel="nofollow">https:&#x2F;&#x2F;clickhouse.com&#x2F;docs&#x2F;en&#x2F;interfaces&#x2F;formats</a></div><br/><div id="39788575" class="c"><input type="checkbox" id="c-39788575" checked=""/><div class="controls bullet"><span class="by">gkbrk</span><span>|</span><a href="#39784942">root</a><span>|</span><a href="#39785472">parent</a><span>|</span><a href="#39784328">next</a><span>|</span><label class="collapse" for="c-39788575">[-]</label><label class="expand" for="c-39788575">[1 more]</label></div><br/><div class="children"><div class="content">You don&#x27;t even need to use file() for a lot of things recently. These just work with clickhouse local. Even wildcards work.<p><pre><code>  select * from `foobar.csv`
</code></pre>
or<p><pre><code>  select * from `monthly-report-*.csv`</code></pre></div><br/></div></div></div></div></div></div><div id="39784328" class="c"><input type="checkbox" id="c-39784328" checked=""/><div class="controls bullet"><span class="by">sshine</span><span>|</span><a href="#39784942">prev</a><span>|</span><a href="#39785205">next</a><span>|</span><label class="collapse" for="c-39784328">[-]</label><label class="expand" for="c-39784328">[3 more]</label></div><br/><div class="children"><div class="content">Very cool!<p>I am also a big fan of jq.<p>And I think using DuckDB and SQL probably makes a lot of sense in a lot of cases.<p>But I think the examples are very geared towards being better solved in SQL.<p>The ideal jq examples are combinations of filter (select), map (map) and concat (.[]).<p>For example, finding the right download link:<p><pre><code>  $ curl -s https:&#x2F;&#x2F;api.github.com&#x2F;repos&#x2F;go-gitea&#x2F;gitea&#x2F;releases&#x2F;latest \
    | jq -r &#x27;.assets[]
             | .browser_download_url
             | select(endswith(&quot;linux-amd64&quot;))&#x27;
  https:&#x2F;&#x2F;github.com&#x2F;go-gitea&#x2F;gitea&#x2F;releases&#x2F;download&#x2F;v1.15.7&#x2F;gitea-1.15.7-linux-amd64
</code></pre>
Or extracting the KUBE_CONFIG of a DigitalOcean Kubernetes cluster from Terraform state:<p><pre><code>  $ jq -r &#x27;.resources[]
          | select(.type == &quot;digitalocean_kubernetes_cluster&quot;)
          | .instances[].attributes.kube_config[].raw_config&#x27; \ 
      terraform.tfstate
  apiVersion: v1
  kind: Config
  clusters:
  - cluster:
      certificate-authority-data: ...
      server: https:&#x2F;&#x2F;...k8s.ondigitalocean.com
  ...</code></pre></div><br/><div id="39784665" class="c"><input type="checkbox" id="c-39784665" checked=""/><div class="controls bullet"><span class="by">pgr0ss</span><span>|</span><a href="#39784328">parent</a><span>|</span><a href="#39785205">next</a><span>|</span><label class="collapse" for="c-39784665">[-]</label><label class="expand" for="c-39784665">[2 more]</label></div><br/><div class="children"><div class="content">I think that&#x27;s a fair point. Unnesting arrays in SQL can be annoying. Here is your first example with duckdb:<p><pre><code>  duckdb -c \
    &quot;select * from ( \
      select unnest(assets)-&gt;&gt;&#x27;browser_download_url&#x27; as url \
      from read_json(&#x27;https:&#x2F;&#x2F;api.github.com&#x2F;repos&#x2F;go-gitea&#x2F;gitea&#x2F;releases&#x2F;latest&#x27;) \
    ) \
    where url like &#x27;%linux-amd64&#x27;&quot;</code></pre></div><br/><div id="39788127" class="c"><input type="checkbox" id="c-39788127" checked=""/><div class="controls bullet"><span class="by">_flux</span><span>|</span><a href="#39784328">root</a><span>|</span><a href="#39784665">parent</a><span>|</span><a href="#39785205">next</a><span>|</span><label class="collapse" for="c-39788127">[-]</label><label class="expand" for="c-39788127">[1 more]</label></div><br/><div class="children"><div class="content">In case someone else was wondering, one can get a shell-consumable output from that with<p><pre><code>  duckdb -noheader -list</code></pre></div><br/></div></div></div></div></div></div><div id="39785205" class="c"><input type="checkbox" id="c-39785205" checked=""/><div class="controls bullet"><span class="by">mritchie712</span><span>|</span><a href="#39784328">prev</a><span>|</span><a href="#39787847">next</a><span>|</span><label class="collapse" for="c-39785205">[-]</label><label class="expand" for="c-39785205">[1 more]</label></div><br/><div class="children"><div class="content">You can also query (public) Google Sheets [0]<p><pre><code>    SELECT * 
    FROM read_csv_auto(&#x27;https:&#x2F;&#x2F;docs.google.com&#x2F;spreadsheets&#x2F;export? 
    format=csv&amp;id=1GuEPkwjdICgJ31Ji3iUoarirZNDbPxQj_kf7fd4h4Ro&#x27;, normalize_names=True);

</code></pre>
0 - <a href="https:&#x2F;&#x2F;x.com&#x2F;thisritchie&#x2F;status&#x2F;1767922982046015840?s=20" rel="nofollow">https:&#x2F;&#x2F;x.com&#x2F;thisritchie&#x2F;status&#x2F;1767922982046015840?s=20</a></div><br/></div></div><div id="39787847" class="c"><input type="checkbox" id="c-39787847" checked=""/><div class="controls bullet"><span class="by">nf3</span><span>|</span><a href="#39785205">prev</a><span>|</span><a href="#39784594">next</a><span>|</span><label class="collapse" for="c-39787847">[-]</label><label class="expand" for="c-39787847">[1 more]</label></div><br/><div class="children"><div class="content">I run a pretty substantial platform where I implemented structured logging to SQLite databases. Each log event is stored as a JSON object in a row. A separate database is kept for each day. Daily log files are about 35GB, so that&#x27;s quite a lot of data to go through is you want to look for something specific. Being able to index on specific fields, as well as express searches as SQL queries is a real game changer IMO.</div><br/></div></div><div id="39784594" class="c"><input type="checkbox" id="c-39784594" checked=""/><div class="controls bullet"><span class="by">NortySpock</span><span>|</span><a href="#39787847">prev</a><span>|</span><a href="#39784739">next</a><span>|</span><label class="collapse" for="c-39784594">[-]</label><label class="expand" for="c-39784594">[4 more]</label></div><br/><div class="children"><div class="content">In a similar vein, I have found Benthos to be an incredible swiss-army-knife for transforming data and shoving it either into (or out of) a message bus, webhook, or a database.<p><a href="https:&#x2F;&#x2F;www.benthos.dev&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.benthos.dev&#x2F;</a></div><br/><div id="39786034" class="c"><input type="checkbox" id="c-39786034" checked=""/><div class="controls bullet"><span class="by">esafak</span><span>|</span><a href="#39784594">parent</a><span>|</span><a href="#39785107">next</a><span>|</span><label class="collapse" for="c-39786034">[-]</label><label class="expand" for="c-39786034">[1 more]</label></div><br/><div class="children"><div class="content">I wish it was not based on YAML. Pipelines are code, not configuration!!</div><br/></div></div><div id="39785107" class="c"><input type="checkbox" id="c-39785107" checked=""/><div class="controls bullet"><span class="by">krembo</span><span>|</span><a href="#39784594">parent</a><span>|</span><a href="#39786034">prev</a><span>|</span><a href="#39784739">next</a><span>|</span><label class="collapse" for="c-39785107">[-]</label><label class="expand" for="c-39785107">[2 more]</label></div><br/><div class="children"><div class="content">How does this defer from filebeat?</div><br/><div id="39787510" class="c"><input type="checkbox" id="c-39787510" checked=""/><div class="controls bullet"><span class="by">NortySpock</span><span>|</span><a href="#39784594">root</a><span>|</span><a href="#39785107">parent</a><span>|</span><a href="#39784739">next</a><span>|</span><label class="collapse" for="c-39787510">[-]</label><label class="expand" for="c-39787510">[1 more]</label></div><br/><div class="children"><div class="content">I don&#x27;t know which filebeat you are referring to...<p><a href="https:&#x2F;&#x2F;github.com&#x2F;elastic&#x2F;beats&#x2F;tree&#x2F;master&#x2F;filebeat">https:&#x2F;&#x2F;github.com&#x2F;elastic&#x2F;beats&#x2F;tree&#x2F;master&#x2F;filebeat</a><p>This one? I only looked for a moment,  but filebeat appears to be ingestion only. Benthos does input,  output, side-effects, stream-stream joins, metrics-on-the-side, tiny-json-wrangling-webooks, and more. I find it to be like plumbers putty, closing over tooling gaps and smoothing rough edges where ordinarily you&#x27;d have to write 20 lines of stream processing code and 300 lines of error handling, reporting,  and performance hacks.</div><br/></div></div></div></div></div></div><div id="39784739" class="c"><input type="checkbox" id="c-39784739" checked=""/><div class="controls bullet"><span class="by">haradion</span><span>|</span><a href="#39784594">prev</a><span>|</span><a href="#39787982">next</a><span>|</span><label class="collapse" for="c-39784739">[-]</label><label class="expand" for="c-39784739">[2 more]</label></div><br/><div class="children"><div class="content">I&#x27;ve found Nushell (<a href="https:&#x2F;&#x2F;www.nushell.sh&#x2F;" rel="nofollow">https:&#x2F;&#x2F;www.nushell.sh&#x2F;</a>) to be really handy for ad-hoc data manipulation (and a decent enough general-purpose shell).</div><br/><div id="39787608" class="c"><input type="checkbox" id="c-39787608" checked=""/><div class="controls bullet"><span class="by">wraptile</span><span>|</span><a href="#39784739">parent</a><span>|</span><a href="#39787982">next</a><span>|</span><label class="collapse" for="c-39787608">[-]</label><label class="expand" for="c-39787608">[1 more]</label></div><br/><div class="children"><div class="content">Nushell is really good but the learning curve is massive.<p>I&#x27;ve been on nushell for almost a year now and still struggle to put more complex commands together. The docs are huge but not very good and the community resources are very limited (it&#x27;s on Dicord smh) unfortunately. So, if anyone wants to get into it you really need to put down few days to understand the whole syntax suite but it&#x27;s worth it!</div><br/></div></div></div></div><div id="39787982" class="c"><input type="checkbox" id="c-39787982" checked=""/><div class="controls bullet"><span class="by">rpigab</span><span>|</span><a href="#39784739">prev</a><span>|</span><a href="#39785877">next</a><span>|</span><label class="collapse" for="c-39787982">[-]</label><label class="expand" for="c-39787982">[1 more]</label></div><br/><div class="children"><div class="content">I love jq and yq, but sometimes I don&#x27;t want to invest time in learning new syntax and just fallback to some python one liner, that can if necessary become a small python script.<p>Something like this, I have a version of this in a shell alias:<p><pre><code>  python3 -c &quot;import json,sys;d=json.load(sys.stdin);print(doStuff(d[&#x27;path&#x27;][&#x27;etc&#x27;]))&quot;
</code></pre>
Pretty print is done with json.dumps.</div><br/></div></div><div id="39785877" class="c"><input type="checkbox" id="c-39785877" checked=""/><div class="controls bullet"><span class="by">JeremyNT</span><span>|</span><a href="#39787982">prev</a><span>|</span><a href="#39787726">next</a><span>|</span><label class="collapse" for="c-39785877">[-]</label><label class="expand" for="c-39785877">[5 more]</label></div><br/><div class="children"><div class="content">I have a lot of trouble understanding the benefits of this versus just working with json with a programming language. It seems like you&#x27;re adding another layer of abstraction versus just dealing with a normal hashmap-like data structure in your language of choice.<p>If you want to work with it interactively, you could use a notebook or REPL.</div><br/><div id="39786260" class="c"><input type="checkbox" id="c-39786260" checked=""/><div class="controls bullet"><span class="by">edu_guitar</span><span>|</span><a href="#39785877">parent</a><span>|</span><a href="#39786362">next</a><span>|</span><label class="collapse" for="c-39786260">[-]</label><label class="expand" for="c-39786260">[1 more]</label></div><br/><div class="children"><div class="content">if you are used to the command line and knows some basic syntax, it is less verbose then opening a REPL and reading a file. The fact that you can pipe the json data into it is also a plus, making it easier to check quickly if the response of a curl call has the fields&#x2F;values you were expecting. Of course, if you are more comfortable doing that from the REPL, you get less value from learning jq. If you are fond of one liners, jq offers a lot of potential.</div><br/></div></div><div id="39786362" class="c"><input type="checkbox" id="c-39786362" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#39785877">parent</a><span>|</span><a href="#39786260">prev</a><span>|</span><a href="#39787726">next</a><span>|</span><label class="collapse" for="c-39786362">[-]</label><label class="expand" for="c-39786362">[3 more]</label></div><br/><div class="children"><div class="content">Pipelining CLI commands or bash scripts. From a security perspective, it may be preferable to not ship with a runtime.</div><br/><div id="39786502" class="c"><input type="checkbox" id="c-39786502" checked=""/><div class="controls bullet"><span class="by">vips7L</span><span>|</span><a href="#39785877">root</a><span>|</span><a href="#39786362">parent</a><span>|</span><a href="#39787726">next</a><span>|</span><label class="collapse" for="c-39786502">[-]</label><label class="expand" for="c-39786502">[2 more]</label></div><br/><div class="children"><div class="content">bash and jq are both runtimes.</div><br/><div id="39786671" class="c"><input type="checkbox" id="c-39786671" checked=""/><div class="controls bullet"><span class="by">bdcravens</span><span>|</span><a href="#39785877">root</a><span>|</span><a href="#39786502">parent</a><span>|</span><a href="#39787726">next</a><span>|</span><label class="collapse" for="c-39786671">[-]</label><label class="expand" for="c-39786671">[1 more]</label></div><br/><div class="children"><div class="content">Very difficult (or often impractical) to not have a shell at all, and jq is at least limited in scope, and has no dependencies that need to be installed. Far better than a full language with its own standard library and set of dependencies to lock down.</div><br/></div></div></div></div></div></div></div></div><div id="39787726" class="c"><input type="checkbox" id="c-39787726" checked=""/><div class="controls bullet"><span class="by">schindlabua</span><span>|</span><a href="#39785877">prev</a><span>|</span><a href="#39784680">next</a><span>|</span><label class="collapse" for="c-39787726">[-]</label><label class="expand" for="c-39787726">[1 more]</label></div><br/><div class="children"><div class="content">Shoutout to jqp, an interactive jq explorer.<p><a href="https:&#x2F;&#x2F;github.com&#x2F;noahgorstein&#x2F;jqp">https:&#x2F;&#x2F;github.com&#x2F;noahgorstein&#x2F;jqp</a></div><br/></div></div><div id="39784680" class="c"><input type="checkbox" id="c-39784680" checked=""/><div class="controls bullet"><span class="by">pletnes</span><span>|</span><a href="#39787726">prev</a><span>|</span><a href="#39784514">next</a><span>|</span><label class="collapse" for="c-39784680">[-]</label><label class="expand" for="c-39784680">[1 more]</label></div><br/><div class="children"><div class="content">Worth noting that both jq and duckdb can be used from python and from the command line. Both are very useful data tools!</div><br/></div></div><div id="39784514" class="c"><input type="checkbox" id="c-39784514" checked=""/><div class="controls bullet"><span class="by">hprotagonist</span><span>|</span><a href="#39784680">prev</a><span>|</span><a href="#39785789">next</a><span>|</span><label class="collapse" for="c-39784514">[-]</label><label class="expand" for="c-39784514">[1 more]</label></div><br/><div class="children"><div class="content">i&#x27;ve been using simonw&#x27;s sqlite-utils (<a href="https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;" rel="nofollow">https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;</a>) for this sort of thing; given structured json or jsonl, you can throw data at an in-memory sqlite database and query away: <a href="https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;cli.html#querying-data-directly-using-an-in-memory-database" rel="nofollow">https:&#x2F;&#x2F;sqlite-utils.datasette.io&#x2F;en&#x2F;stable&#x2F;cli.html#queryin...</a></div><br/></div></div><div id="39785789" class="c"><input type="checkbox" id="c-39785789" checked=""/><div class="controls bullet"><span class="by">ec109685</span><span>|</span><a href="#39784514">prev</a><span>|</span><a href="#39784775">next</a><span>|</span><label class="collapse" for="c-39785789">[-]</label><label class="expand" for="c-39785789">[1 more]</label></div><br/><div class="children"><div class="content">While jq’s syntax can be hard to remember, ChatGTP does an excellent job generating jq from an example json file and a description of how you want it parsed.</div><br/></div></div><div id="39784775" class="c"><input type="checkbox" id="c-39784775" checked=""/><div class="controls bullet"><span class="by">HellsMaddy</span><span>|</span><a href="#39785789">prev</a><span>|</span><a href="#39784902">next</a><span>|</span><label class="collapse" for="c-39784775">[-]</label><label class="expand" for="c-39784775">[2 more]</label></div><br/><div class="children"><div class="content">Jq tip: Instead of `sort_by(.count) | reverse`, you can do `sort_by(-.count)`</div><br/><div id="39785429" class="c"><input type="checkbox" id="c-39785429" checked=""/><div class="controls bullet"><span class="by">philsnow</span><span>|</span><a href="#39784775">parent</a><span>|</span><a href="#39784902">next</a><span>|</span><label class="collapse" for="c-39785429">[-]</label><label class="expand" for="c-39785429">[1 more]</label></div><br/><div class="children"><div class="content">only if you&#x27;re sure that .count is never null:<p><pre><code>  $ echo &#x27;[{&quot;a&quot;: {&quot;count&quot;: null}}]&#x27; | jq -c &#x27;sort_by(-.count)&#x27;
  jq: error (at &lt;stdin&gt;:1): null (null) cannot be negated
  $ echo &#x27;[{&quot;a&quot;: {&quot;count&quot;: null}}]&#x27; | jq -c &#x27;sort_by(.count) | reverse&#x27;
  [{&quot;a&quot;:{&quot;count&quot;:null}}]</code></pre></div><br/></div></div></div></div><div id="39784902" class="c"><input type="checkbox" id="c-39784902" checked=""/><div class="controls bullet"><span class="by">jeffbee</span><span>|</span><a href="#39784775">prev</a><span>|</span><a href="#39785442">next</a><span>|</span><label class="collapse" for="c-39784902">[-]</label><label class="expand" for="c-39784902">[1 more]</label></div><br/><div class="children"><div class="content">I tried this and it just seems to add bondage and discipline that I don&#x27;t need on top of what is, in practice, an extremely chaotic format.<p>Example: trying to pick one field out of 20000 large JSON files that represent local property records.<p>% duckdb -json -c &quot;select apn.apnNumber from read_json(&#x27;*&#x27;)&quot;
Invalid Input Error: JSON transform error in file &quot;052136400500&quot;, in record&#x2F;value 1: Could not convert string &#x27;fb1b1e68-89ee-11ea-bc55-0242ad1302303&#x27; to INT128<p>Well, I didn&#x27;t want that converted. I just want to ignore it. This has been my experience overall. DuckDB is great if there is a logical schema, not as good as jq when the corpus is just data soup.</div><br/></div></div><div id="39785442" class="c"><input type="checkbox" id="c-39785442" checked=""/><div class="controls bullet"><span class="by">dudus</span><span>|</span><a href="#39784902">prev</a><span>|</span><a href="#39785094">next</a><span>|</span><label class="collapse" for="c-39785442">[-]</label><label class="expand" for="c-39785442">[1 more]</label></div><br/><div class="children"><div class="content">DuckDB parses JSON using yyjson internally .<p><a href="https:&#x2F;&#x2F;github.com&#x2F;ibireme&#x2F;yyjson">https:&#x2F;&#x2F;github.com&#x2F;ibireme&#x2F;yyjson</a></div><br/></div></div><div id="39785094" class="c"><input type="checkbox" id="c-39785094" checked=""/><div class="controls bullet"><span class="by">hermitcrab</span><span>|</span><a href="#39785442">prev</a><span>|</span><label class="collapse" for="c-39785094">[-]</label><label class="expand" for="c-39785094">[1 more]</label></div><br/><div class="children"><div class="content">if you want a very visual way to transform JSON&#x2F;XML&#x2F;CSV&#x2F;Excel etc in a pipeline it might also be worth looking at Easy Data Transform.</div><br/></div></div></div></div></div></div></div></body></html>